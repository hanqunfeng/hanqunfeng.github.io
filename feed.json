{"version":"https://jsonfeed.org/version/1","name":"é£˜é€¸å³°çš„åšå®¢","home_page_url":"https://blog.hanqunfeng.com","feed_url":"https://blog.hanqunfeng.com/feed.json","author":{"name":"é£˜é€¸å³°"},"items":[{"id":"https://blog.hanqunfeng.com/2025/05/13/jvm-tools-01/","url":"https://blog.hanqunfeng.com/2025/05/13/jvm-tools-01/","title":"JVM ä¹‹ å‘½ä»¤è¡Œå·¥å…·","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç»JVMçš„å‘½ä»¤è¡Œå·¥å…·</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://docs.oracle.com/javase/specs/jvms/se8/html/index.html\">The JavaÂ® Virtual Machine Specification</a> ç‰ˆæœ¬jdk1.8</p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"JVM-çš„å‚æ•°-ä¸‰ç±»\">JVM çš„å‚æ•°(ä¸‰ç±»)</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ ‡å‡†å‚æ•°: ä»¥<code>-</code>å¼€å¤´ï¼Œæ‰€æœ‰ HotSpot éƒ½â½€æŒã€‚ä¾‹å¦‚<code>java -version</code>ã€‚è¿™ç±»å‚æ•°å¯ä»¥ä½¿â½¤<code>java -help</code> æˆ–è€…<code>java -?</code>å…¨éƒ¨æ‰“å°å‡ºæ¥</p>\n</li>\n<li class=\"lvl-2\">\n<p>â¾®æ ‡å‡†å‚æ•°: ä»¥<code>-X</code>å¼€å¤´ï¼Œæ˜¯ç‰¹å®š HotSpotç‰ˆæœ¬â½€æŒçš„æŒ‡ä»¤ã€‚ä¾‹å¦‚<code>java -Xms200M -Xmx200M</code>ã€‚è¿™ç±»æŒ‡ä»¤å¯ä»¥â½¤<code>java -X</code> å…¨éƒ¨æ‰“å°å‡ºæ¥ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä¸ç¨³å®šå‚æ•°: è¿™ä¹Ÿæ˜¯ JVMè°ƒä¼˜çš„å™©æ¢¦ã€‚ä»¥<code>-XX</code> å¼€å¤´ï¼Œè¿™äº›å‚æ•°æ˜¯è·Ÿç‰¹å®šHotSpotç‰ˆæœ¬å¯¹åº”çš„ï¼Œå¾ˆæœ‰å¯èƒ½æ¢ä¸ªç‰ˆæœ¬å°±æ²¡æœ‰äº†ã€‚è¯¦ç»†çš„â½‚æ¡£èµ„æ–™ä¹Ÿç‰¹åˆ«å°‘ã€‚JDK8 ä¸­çš„ä»¥ä¸‹â¼ä¸ªæŒ‡ä»¤å¯ä»¥å¸®åŠ©å¼€å‘è€…äº†è§£ JDK8 ä¸­çš„è¿™â¼€ç±»ä¸ç¨³å®šå‚æ•°ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">java -XX:+PrintFlagsInitial -version   <span class=\"comment\"># æ‰€æœ‰å‚æ•°çš„é»˜è®¤å€¼</span></span><br><span class=\"line\">java -XX:+PrintFlagsFinal -version      <span class=\"comment\"># æ‰€æœ‰å‚æ•°æœ€ç»ˆâ½£æ•ˆçš„å€¼ã€‚</span></span><br><span class=\"line\">java -XX:+UnlockExperimentalVMOptions -XX:+PrintFlagsFinal -version      <span class=\"comment\"># æ‰€æœ‰å‚æ•°æœ€ç»ˆâ½£æ•ˆçš„å€¼ï¼ŒåŒ…å«å®éªŒæ€§å‚æ•°ã€‚</span></span><br><span class=\"line\">java -XX:+PrintCommandLineFlags -version <span class=\"comment\"># å½“å‰å‘½ä»¤ç”Ÿæ•ˆçš„å€¼ï¼Œå¯ä»¥çœ‹åˆ°æ˜¯â½¤çš„å“ªç§GCã€‚ JDK1.8é»˜è®¤â½¤çš„ParallelGC</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"è¿è¡Œ-java-XX-UnlockExperimentalVMOptions-XX-PrintFlagsFinal-version-è¿”å›å€¼è¯´æ˜\">è¿è¡Œ <code>java -XX:+UnlockExperimentalVMOptions -XX:+PrintFlagsFinal -version</code> è¿”å›å€¼è¯´æ˜</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[Global flags]</span><br><span class=\"line\">     intx ActiveProcessorCount                      = -1                                  &#123;product&#125;</span><br><span class=\"line\">    uintx AdaptiveSizeDecrementScaleFactor          = 4                                   &#123;product&#125;</span><br><span class=\"line\">    uintx AdaptiveSizeMajorGCDecayTimeScale         = 10                                  &#123;product&#125;</span><br><span class=\"line\">    uintx AdaptiveSizePausePolicy                   = 0                                   &#123;product&#125;</span><br><span class=\"line\">    uintx AdaptiveSizePolicyCollectionCostMargin    = 50                                  &#123;product&#125;</span><br><span class=\"line\">    uintx AdaptiveSizePolicyInitializingSteps       = 20                                  &#123;product&#125;</span><br><span class=\"line\">    uintx AdaptiveSizePolicyOutputInterval          = 0                                   &#123;product&#125;</span><br><span class=\"line\">    uintx AdaptiveSizePolicyWeight                  = 10                                  &#123;product&#125;</span><br><span class=\"line\">    uintx AdaptiveSizeThroughPutPolicy              = 0                                   &#123;product&#125;</span><br><span class=\"line\">    uintx AdaptiveTimeWeight                        = 25                                  &#123;product&#125;</span><br><span class=\"line\">     bool AdjustConcurrency                         = <span class=\"literal\">false</span>                               &#123;product&#125;</span><br><span class=\"line\">     bool AggressiveHeap                            = <span class=\"literal\">false</span>                               &#123;product&#125;</span><br><span class=\"line\">     bool AggressiveOpts                            = <span class=\"literal\">false</span>                               &#123;product&#125;</span><br><span class=\"line\">     intx AliasLevel                                = 3                                   &#123;C2 product&#125;</span><br><span class=\"line\">     â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦</span><br><span class=\"line\"><span class=\"comment\"># æ ¼å¼ï¼šflagç±»å‹ï¼Œflagåç§°ï¼Œflagå€¼ï¼Œflagæ¥æºä¸ä½œç”¨åŸŸä¿®é¥°ç¬¦</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>flagç±»å‹:</p>\n</li>\n</ul>\n<blockquote>\n<p>jdk8</p>\n</blockquote>\n<table>\n<thead>\n<tr>\n<th>æ ‡è¯†ç¬¦</th>\n<th>å«ä¹‰</th>\n<th>æè¿°è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>intx</code></td>\n<td>æœ‰ç¬¦å·æ•´æ•°ï¼ˆint extendedï¼‰</td>\n<td>ç”¨äºè¡¨ç¤ºå¸¦ç¬¦å·æ•´æ•°å‹å‚æ•°</td>\n</tr>\n<tr>\n<td><code>uintx</code></td>\n<td>æ— ç¬¦å·æ•´æ•°ï¼ˆunsigned int extendedï¼‰</td>\n<td>è¡¨ç¤ºéè´Ÿæ•´æ•°å‹å‚æ•°</td>\n</tr>\n<tr>\n<td><code>uint64_t</code></td>\n<td>æ— ç¬¦å· 64 ä½æ•´æ•°</td>\n<td>é€‚ç”¨äºéœ€è¦æ›´å¤§æ•´æ•°å€¼çš„å‚æ•°ï¼Œæ¯”å¦‚å†…å­˜å¤§å°ã€çº³ç§’æ—¶é—´æˆ³ç­‰</td>\n</tr>\n<tr>\n<td><code>bool</code></td>\n<td>å¸ƒå°”å‹</td>\n<td><code>true</code> æˆ– <code>false</code>ï¼Œè¡¨ç¤ºå¼€å…³å‹å‚æ•°</td>\n</tr>\n<tr>\n<td><code>double</code></td>\n<td>åŒç²¾åº¦æµ®ç‚¹å‹</td>\n<td>ç”¨äºè¡¨ç¤ºæµ®ç‚¹æ•°å€¼ç±»å‹çš„ JVM å‚æ•°</td>\n</tr>\n<tr>\n<td><code>ccstr</code></td>\n<td>å¸¸é‡ C å­—ç¬¦ä¸²æŒ‡é’ˆ</td>\n<td>è¡¨ç¤ºå­—ç¬¦ä¸²å‚æ•°ï¼ˆä¸å¯å˜ï¼‰</td>\n</tr>\n<tr>\n<td><code>ccstrlist</code></td>\n<td>C å­—ç¬¦ä¸²åˆ—è¡¨</td>\n<td>è¡¨ç¤ºä»¥é€—å·åˆ†éš”çš„å­—ç¬¦ä¸²åˆ—è¡¨</td>\n</tr>\n</tbody>\n</table>\n<blockquote>\n<p>jdk11åå‡ºç°æ›´å¤šçš„ç±»å‹</p>\n</blockquote>\n<table>\n<thead>\n<tr>\n<th>æ ‡è¯†ç¬¦</th>\n<th>å«ä¹‰</th>\n<th>æè¿°è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>int</code></td>\n<td>æœ‰ç¬¦å·æ•´æ•°,é€šå¸¸æ˜¯ 32 ä½</td>\n<td>JVM å†…éƒ¨ä½¿ç”¨çš„æ™®é€š int å‚æ•°</td>\n</tr>\n<tr>\n<td><code>uint</code></td>\n<td>æ— ç¬¦å·æ•´æ•°,é€šå¸¸æ˜¯ 32 ä½</td>\n<td>å°‘é‡ç”¨äºç‰¹æ®Šåœºæ™¯çš„å‚æ•°</td>\n</tr>\n<tr>\n<td><code>size_t</code></td>\n<td>å†…å­˜å¤§å°</td>\n<td>è¡¨ç¤ºå†…å­˜å¤§å°å‚æ•°ï¼ˆå•ä½ä¸€èˆ¬ä¸ºå­—èŠ‚ï¼‰,jdk11åå‡ºç°ï¼ŒåŸæ¥æ˜¯ <code>uintx</code></td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>flagæ¥æºä¸ä½œç”¨åŸŸä¿®é¥°ç¬¦</p>\n</li>\n</ul>\n<blockquote>\n<p>jdk8</p>\n</blockquote>\n<table>\n<thead>\n<tr>\n<th>æ ‡è®°</th>\n<th>å«ä¹‰</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>&#123;product&#125;</code></td>\n<td>æ­£å¼äº§å“å‚æ•°ï¼ˆç”¨æˆ·å¯ç”¨ï¼Œå¯é€šè¿‡ <code>-XX:</code> è¿›è¡Œè®¾ç½®ï¼‰</td>\n</tr>\n<tr>\n<td><code>&#123;pd product&#125;</code></td>\n<td>å¹³å°ç›¸å…³çš„æ­£å¼å‚æ•°ï¼ˆplatform-dependentï¼‰ï¼Œåœ¨æŸäº›æ“ä½œç³»ç»Ÿ/CPU ä¸Šå¯ç”¨</td>\n</tr>\n<tr>\n<td><code>&#123;C1 product&#125;</code></td>\n<td>ä»…åœ¨ä½¿ç”¨ <strong>C1 ç¼–è¯‘å™¨ï¼ˆä¼˜åŒ–ç¼–è¯‘å™¨ï¼‰</strong> æ—¶æœ‰æ•ˆçš„å‚æ•°</td>\n</tr>\n<tr>\n<td><code>&#123;C2 product&#125;</code></td>\n<td>ä»…åœ¨ä½¿ç”¨ <strong>C2 ç¼–è¯‘å™¨ï¼ˆä¼˜åŒ–ç¼–è¯‘å™¨ï¼‰</strong> æ—¶æœ‰æ•ˆçš„å‚æ•°</td>\n</tr>\n<tr>\n<td><code>&#123;manageable&#125;</code></td>\n<td>å¯é€šè¿‡ JMX åŠ¨æ€ç®¡ç†çš„å‚æ•°ï¼ˆè¿è¡Œæ—¶å¯è°ƒæ•´ï¼‰</td>\n</tr>\n<tr>\n<td><code>&#123;ARCH product&#125;</code></td>\n<td>ä¸ CPU æ¶æ„ç›¸å…³çš„äº§å“å‚æ•°ï¼ˆå¦‚ x86ã€ARM ç­‰ï¼‰</td>\n</tr>\n<tr>\n<td><code>&#123;lp64_product&#125;</code></td>\n<td>ä»…åœ¨ 64 ä½ JVM ä¸Šæ‰æœ‰æ•ˆçš„äº§å“å‚æ•°</td>\n</tr>\n<tr>\n<td><code>&#123;experimental&#125;</code></td>\n<td>å®éªŒæ€§çš„ å‚æ•°ï¼Œå¯èƒ½åœ¨å°†æ¥çš„ç‰ˆæœ¬ä¸­åˆ é™¤æˆ–æ›´æ”¹ã€‚éœ€è¦å¼€å¯ -XX:+UnlockExperimentalVMOptions</td>\n</tr>\n</tbody>\n</table>\n<blockquote>\n<p>jdk11åå‡ºç°æ›´å¤šçš„ç±»å‹</p>\n</blockquote>\n<table>\n<thead>\n<tr>\n<th>æ ‡è®°</th>\n<th>å«ä¹‰</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>&#123;C1 pd product&#125;</code></td>\n<td>å¹³å°ç›¸å…³çš„æ­£å¼å‚æ•°,ä»…åœ¨ä½¿ç”¨ <strong>C1 ç¼–è¯‘å™¨ï¼ˆä¼˜åŒ–ç¼–è¯‘å™¨ï¼‰</strong> æ—¶æœ‰æ•ˆçš„å‚æ•°</td>\n</tr>\n<tr>\n<td><code>&#123;C2 pd product&#125;</code></td>\n<td>å¹³å°ç›¸å…³çš„æ­£å¼å‚æ•°,ä»…åœ¨ä½¿ç”¨ <strong>C2 ç¼–è¯‘å™¨ï¼ˆä¼˜åŒ–ç¼–è¯‘å™¨ï¼‰</strong> æ—¶æœ‰æ•ˆçš„å‚æ•°</td>\n</tr>\n<tr>\n<td><code>&#123;JVMCI product&#125;</code></td>\n<td>æ­¤å‚æ•°é€‚ç”¨äº JVMCI æˆ– Graal ç¼–è¯‘å™¨ç›¸å…³åŠŸèƒ½ï¼Œjdk21æ·»åŠ </td>\n</tr>\n</tbody>\n</table>\n<blockquote>\n<p>å¦å¤–ï¼Œjdk11+ ä¸­ï¼Œæœ€åè¿˜ä¼šå¤šå‡ºä¸€åˆ—ï¼Œå…¶ä½œç”¨æ˜¯è¯´æ˜è¯¥å‚æ•°çš„è®¾ç½®æ¥æº</p>\n</blockquote>\n<table>\n<thead>\n<tr>\n<th>æ¥æºæ ‡è¯†</th>\n<th>å«ä¹‰è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>&#123;default&#125;</code></td>\n<td>ä½¿ç”¨çš„æ˜¯è¯¥å‚æ•°çš„é»˜è®¤å€¼ï¼ˆæ²¡æœ‰è¢«ç”¨æˆ·æˆ–ç³»ç»Ÿè®¾ç½®ï¼‰</td>\n</tr>\n<tr>\n<td><code>&#123;command line&#125;</code></td>\n<td>ç”¨æˆ·é€šè¿‡å‘½ä»¤è¡Œæ˜¾å¼è®¾ç½®çš„å‚æ•°ï¼ˆå¦‚ <code>-XX:+UseG1GC</code>ï¼‰</td>\n</tr>\n<tr>\n<td><code>&#123;ergonomic&#125;</code></td>\n<td>JVM æ ¹æ®ç³»ç»Ÿç¯å¢ƒè‡ªåŠ¨é€‰æ‹©çš„å€¼ï¼ˆè‡ªé€‚åº”è®¾ç½®ï¼‰</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"jps-æŸ¥çœ‹å½“å‰jvmä¸­çš„è¿›ç¨‹\">jps: æŸ¥çœ‹å½“å‰jvmä¸­çš„è¿›ç¨‹</h2>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹javaè¿›ç¨‹ID</span></span><br><span class=\"line\">jps</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹javaè¿›ç¨‹ä¿¡æ¯ï¼ŒåŒ…æ‹¬IDå’Œå¯åŠ¨ç±»æˆ–jarçš„åç§°</span></span><br><span class=\"line\">jps -l</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹å¯åŠ¨javaè¿›ç¨‹æ—¶ä¼ é€’ç»™jvmçš„å‚æ•°è®¾ç½®</span></span><br><span class=\"line\">jps -v</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹javaè¿›ç¨‹ä¿¡æ¯ï¼ŒåŒæ—¶æ˜¾ç¤ºå¯åŠ¨javaè¿›ç¨‹æ—¶ä¼ é€’ç»™jvmçš„å‚æ•°è®¾ç½®</span></span><br><span class=\"line\">jps -lv</span><br></pre></td></tr></table></figure>\n<h2 id=\"jinfo-æŸ¥çœ‹JVMå‚æ•°\">jinfo: æŸ¥çœ‹JVMå‚æ•°</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>jinfo æ˜¯ JDK è‡ªå¸¦çš„å‘½ä»¤è¡Œå·¥å…·ä¹‹ä¸€ï¼Œç”¨äº æŸ¥çœ‹å’Œä¿®æ”¹æ­£åœ¨è¿è¡Œä¸­çš„ Java è¿›ç¨‹çš„é…ç½®ä¿¡æ¯ï¼Œä¸»è¦åŒ…æ‹¬ JVM å‚æ•°ã€ç³»ç»Ÿå±æ€§ç­‰ä¿¡æ¯ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>åœ¨ Java 9+ ä¹‹åè¢«æ ‡è®°ä¸º deprecatedï¼Œå»ºè®®æ”¹ç”¨ jcmd æ›¿ä»£</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹æ­£åœ¨è¿è¡Œçš„ JVM å‚æ•°</span></span><br><span class=\"line\">jinfo &lt;PID&gt;</span><br><span class=\"line\"><span class=\"comment\"># jcmd å‘½ä»¤ï¼Œåˆ†æˆä¸‰ä¸ª</span></span><br><span class=\"line\">jcmd &lt;pid&gt; VM.flags <span class=\"comment\"># VM Flags</span></span><br><span class=\"line\">jcmd &lt;pid&gt; VM.system_properties <span class=\"comment\"># System Properties</span></span><br><span class=\"line\">jcmd &lt;pid&gt; VM.command_line <span class=\"comment\"># Command Line</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹æŒ‡å®šè¿›ç¨‹çš„ç³»ç»Ÿå±æ€§ï¼ˆ-syspropsï¼‰</span></span><br><span class=\"line\">jinfo -sysprops &lt;PID&gt;</span><br><span class=\"line\"><span class=\"comment\"># jcmd å‘½ä»¤</span></span><br><span class=\"line\">jcmd &lt;pid&gt; VM.system_properties</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åŠ¨æ€ä¿®æ”¹ JVM å‚æ•°ï¼ˆä»…æ”¯æŒéƒ¨åˆ†å‚æ•°ï¼‰</span></span><br><span class=\"line\">jinfo -flag [+|-]&lt;flagname&gt; &lt;pid&gt;</span><br><span class=\"line\"><span class=\"comment\">## ä¾‹ï¼šæ‰“å¼€ GC æ—¥å¿—</span></span><br><span class=\"line\">jinfo -flag +PrintGC &lt;pid&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ£€æŸ¥æ˜¯å¦å¼€å¯äº†æŸä¸ª JVM ç‰¹æ€§ï¼ˆå¦‚ UseG1GCï¼‰</span></span><br><span class=\"line\">jinfo -flag UseG1GC &lt;pid&gt;</span><br></pre></td></tr></table></figure>\n<h2 id=\"jstat-æŸ¥çœ‹æŒ‡å®šJAVAè¿›ç¨‹çš„è¿è¡ŒçŠ¶æ€\">jstat: æŸ¥çœ‹æŒ‡å®šJAVAè¿›ç¨‹çš„è¿è¡ŒçŠ¶æ€</h2>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹è¿è¡ŒçŠ¶æ€</span></span><br><span class=\"line\">jstat -gc &lt;PID&gt;</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹è¿è¡ŒçŠ¶æ€ï¼Œæ¯éš”5000æ¯«ç§’è¾“å‡ºä¸€æ¬¡ï¼Œå…±è¾“å‡º20æ¬¡</span></span><br><span class=\"line\">jstat -gc &lt;PID&gt; 5000 20</span><br><span class=\"line\"><span class=\"comment\"># è¾“å‡º</span></span><br><span class=\"line\"> S0C    S1C    S0U    S1U      EC       EU        OC         OU       MC     MU    CCSC   CCSU   YGC     YGCT    FGC    FGCT     GCT</span><br><span class=\"line\">512.0  512.0   0.0   224.0  29696.0  27138.2   105984.0   96531.8   122368.0 114450.4 15360.0 14018.9    733    5.099   4      0.833    5.931</span><br><span class=\"line\">512.0  512.0   0.0   224.0  29696.0  27203.9   105984.0   96531.8   122368.0 114450.4 15360.0 14018.9    733    5.099   4      0.833    5.931</span><br><span class=\"line\">512.0  512.0   0.0   224.0  29696.0  27220.4   105984.0   96531.8   122368.0 114450.4 15360.0 14018.9    733    5.099   4      0.833    5.931</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å†…å­˜åŒºç»Ÿè®¡ï¼ˆå•ä½ï¼šKBï¼‰</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>åˆ—å</th>\n<th>å«ä¹‰è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>S0C</strong></td>\n<td>Survivor 0 åŒºçš„å®¹é‡ï¼ˆKBï¼‰</td>\n</tr>\n<tr>\n<td><strong>S1C</strong></td>\n<td>Survivor 1 åŒºçš„å®¹é‡ï¼ˆKBï¼‰</td>\n</tr>\n<tr>\n<td><strong>S0U</strong></td>\n<td>Survivor 0 åŒºå·²ä½¿ç”¨å†…å­˜ï¼ˆKBï¼‰</td>\n</tr>\n<tr>\n<td><strong>S1U</strong></td>\n<td>Survivor 1 åŒºå·²ä½¿ç”¨å†…å­˜ï¼ˆKBï¼‰</td>\n</tr>\n<tr>\n<td><strong>EC</strong></td>\n<td>Eden åŒºçš„å®¹é‡ï¼ˆKBï¼‰</td>\n</tr>\n<tr>\n<td><strong>EU</strong></td>\n<td>Eden åŒºå·²ä½¿ç”¨å†…å­˜ï¼ˆKBï¼‰</td>\n</tr>\n<tr>\n<td><strong>OC</strong></td>\n<td>Old Generationï¼ˆè€å¹´ä»£ï¼‰çš„å®¹é‡ï¼ˆKBï¼‰</td>\n</tr>\n<tr>\n<td><strong>OU</strong></td>\n<td>Old Generation å·²ä½¿ç”¨å†…å­˜ï¼ˆKBï¼‰</td>\n</tr>\n<tr>\n<td><strong>MC</strong></td>\n<td>Metaspaceï¼ˆå…ƒç©ºé—´ï¼‰çš„å®¹é‡ï¼ˆKBï¼‰</td>\n</tr>\n<tr>\n<td><strong>MU</strong></td>\n<td>Metaspace å·²ä½¿ç”¨å†…å­˜ï¼ˆKBï¼‰</td>\n</tr>\n<tr>\n<td><strong>CCSC</strong></td>\n<td>Compressed Class Space çš„å®¹é‡ï¼ˆKBï¼‰</td>\n</tr>\n<tr>\n<td><strong>CCSU</strong></td>\n<td>Compressed Class Space å·²ä½¿ç”¨å†…å­˜ï¼ˆKBï¼‰</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>GC æ¬¡æ•°ä¸è€—æ—¶(ä»åº”ç”¨ç¨‹åºå¯åŠ¨åˆ°é‡‡æ ·æ—¶)</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>åˆ—å</th>\n<th>å«ä¹‰è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>YGC</strong></td>\n<td>Young GCï¼ˆMinor GCï¼‰ çš„ç´¯è®¡æ¬¡æ•°</td>\n</tr>\n<tr>\n<td><strong>YGCT</strong></td>\n<td>Young GC ç´¯è®¡è€—æ—¶ï¼ˆå•ä½ï¼šç§’ï¼‰</td>\n</tr>\n<tr>\n<td><strong>FGC</strong></td>\n<td>Full GC çš„ç´¯è®¡æ¬¡æ•°</td>\n</tr>\n<tr>\n<td><strong>FGCT</strong></td>\n<td>Full GC ç´¯è®¡è€—æ—¶ï¼ˆå•ä½ï¼šç§’ï¼‰</td>\n</tr>\n<tr>\n<td><strong>GCT</strong></td>\n<td>GC æ€»è€—æ—¶ï¼ˆYGCT + FGCTï¼Œæ€»å’Œï¼‰</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"jstack-æŸ¥çœ‹æŒ‡å®šJAVAè¿›ç¨‹ä¸­å„çº¿ç¨‹çš„è°ƒç”¨å †æ ˆ\">jstack: æŸ¥çœ‹æŒ‡å®šJAVAè¿›ç¨‹ä¸­å„çº¿ç¨‹çš„è°ƒç”¨å †æ ˆ</h2>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æ‰“å°çº¿ç¨‹çš„æ ‡å‡†æ ˆä¿¡æ¯ï¼ˆæ ˆå¸§ + çº¿ç¨‹çŠ¶æ€ï¼‰</span></span><br><span class=\"line\">jstack &lt;PID&gt;</span><br><span class=\"line\"><span class=\"comment\"># åœ¨æ ‡å‡†è¾“å‡ºåŸºç¡€ä¸Šï¼Œé¢å¤–æ‰“å°çº¿ç¨‹æ‹¥æœ‰çš„é”ï¼ˆmonitorï¼‰å’Œ waited on é”å¯¹è±¡ä¿¡æ¯</span></span><br><span class=\"line\">jstack -l &lt;PID&gt;</span><br><span class=\"line\"><span class=\"comment\"># è¾“å‡ºåˆ°æ–‡ä»¶</span></span><br><span class=\"line\">jstack -l &lt;PID&gt; &gt; jstack.tdump <span class=\"comment\"># è¿™ä¸ªæ–‡ä»¶ååç¼€åªæ˜¯ä¸ºäº†æ–¹ä¾¿ jvisualvm æŸ¥çœ‹</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># è¾“å‡º</span></span><br><span class=\"line\"><span class=\"string\">&quot;idle-connection-reaper&quot;</span> <span class=\"comment\">#68 daemon prio=5 os_prio=0 tid=0x00007f38b6ae2800 nid=0x62e9 waiting on condition [0x00007f385b0f5000]</span></span><br><span class=\"line\">   java.lang.Thread.State: TIMED_WAITING (sleeping)</span><br><span class=\"line\">\tat java.lang.Thread.<span class=\"built_in\">sleep</span>(Native Method)</span><br><span class=\"line\">\tat software.amazon.awssdk.http.apache.internal.conn.IdleConnectionReaper<span class=\"variable\">$ReaperTask</span>.run(IdleConnectionReaper.java:151)</span><br><span class=\"line\">\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)</span><br><span class=\"line\">\tat java.util.concurrent.ThreadPoolExecutor<span class=\"variable\">$Worker</span>.run(ThreadPoolExecutor.java:624)</span><br><span class=\"line\">\tat java.lang.Thread.run(Thread.java:750)</span><br><span class=\"line\"></span><br><span class=\"line\">   Locked ownable synchronizers:</span><br><span class=\"line\">\t- &lt;0x00000000c561cfd8&gt; (a java.util.concurrent.ThreadPoolExecutor<span class=\"variable\">$Worker</span>)</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>jstackè¾“å‡ºå†…å®¹å«ä¹‰</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>å­—æ®µ</th>\n<th>å«ä¹‰</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>&quot;idle-connection-reaper&quot;</code></td>\n<td>çº¿ç¨‹åç§°ã€‚è¿™ä¸ªçº¿ç¨‹æ˜¯ AWS SDK ä¸­ç”¨äºæ¸…ç†ç©ºé—²è¿æ¥çš„åå°çº¿ç¨‹ã€‚</td>\n</tr>\n<tr>\n<td><code>#68</code></td>\n<td>çº¿ç¨‹ IDï¼ˆJava å±‚åˆ†é…çš„ç¼–å·ï¼‰ã€‚</td>\n</tr>\n<tr>\n<td><code>daemon</code></td>\n<td>è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ª <strong>å®ˆæŠ¤çº¿ç¨‹</strong>ã€‚JVM é€€å‡ºæ—¶ä¸ä¼šç­‰å¾…å®ˆæŠ¤çº¿ç¨‹è¿è¡Œç»“æŸã€‚</td>\n</tr>\n<tr>\n<td><code>prio=5</code></td>\n<td>Java å±‚çš„çº¿ç¨‹ä¼˜å…ˆçº§ï¼ˆé»˜è®¤ 1â€“10ï¼Œ5 æ˜¯é»˜è®¤ï¼‰ã€‚</td>\n</tr>\n<tr>\n<td><code>os_prio=0</code></td>\n<td>æ“ä½œç³»ç»Ÿå±‚çº¿ç¨‹ä¼˜å…ˆçº§ï¼ˆå–å†³äºæ“ä½œç³»ç»Ÿå’Œ JVM çš„å®ç°ï¼‰ã€‚</td>\n</tr>\n<tr>\n<td><code>tid=0x00007f38b6ae2800</code></td>\n<td>çº¿ç¨‹ IDï¼ˆJava å±‚ä½¿ç”¨çš„åœ°å€æ ‡è¯†ï¼‰ã€‚</td>\n</tr>\n<tr>\n<td><code>nid=0x62e9</code></td>\n<td>Native IDï¼Œæ“ä½œç³»ç»Ÿåˆ†é…çš„çº¿ç¨‹ IDï¼ˆåå…­è¿›åˆ¶è¡¨ç¤ºï¼‰ï¼Œå¯ä»¥é€šè¿‡å‘½ä»¤<code>printf &quot;%d\\n&quot; 0x62e9</code>è½¬æ¢ä¸º10è¿›åˆ¶ã€‚<br>  <code>ps -Lp &lt;PID&gt;</code> å’Œ <code>top -Hp &lt;PID&gt;</code> å±•ç¤ºçš„çº¿ç¨‹idæ˜¯10è¿›åˆ¶</td>\n</tr>\n<tr>\n<td><code>waiting on condition</code></td>\n<td>çº¿ç¨‹çŠ¶æ€è¯´æ˜ï¼šæ­£åœ¨ç­‰å¾…æŸç§æ¡ä»¶ï¼Œä¸€èˆ¬æŒ‡ <code>sleep()</code> æˆ– <code>wait()</code> ç­‰ã€‚</td>\n</tr>\n<tr>\n<td><code>[0x00007f385b0f5000]</code></td>\n<td>æ ˆå¸§çš„å†…å­˜åœ°å€ã€‚</td>\n</tr>\n<tr>\n<td><code>java.lang.Thread.State: TIMED_WAITING (sleeping)</code></td>\n<td>çº¿ç¨‹çŠ¶æ€ã€‚</td>\n</tr>\n<tr>\n<td><code>at java.lang.Thread.sleep(Native Method)</code> <br> â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦</td>\n<td>çº¿ç¨‹è°ƒç”¨æ ˆä¿¡æ¯ï¼ŒåŒ…æ‹¬è°ƒç”¨æ–¹æ³•ã€è°ƒç”¨å‚æ•°ã€è°ƒç”¨æ ˆå¸§ã€‚</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¦å¤–è¿˜æœ‰å¦‚ä¸‹ä¿¡æ¯ï¼Œè¡¨ç¤ºæ­¤çº¿ç¨‹æŒæœ‰çš„å¯æ‹¥æœ‰åŒæ­¥å™¨ï¼ˆä¾‹å¦‚ ReentrantLockï¼‰ï¼Œå…·ä½“å†…å®¹å¦‚ä¸‹ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Locked ownable synchronizers:</span><br><span class=\"line\">\t- &lt;0x00000000c561cfd8&gt; (a java.util.concurrent.ThreadPoolExecutor<span class=\"variable\">$Worker</span>)</span><br></pre></td></tr></table></figure>\n<table>\n<thead>\n<tr>\n<th>å†…å®¹</th>\n<th>å«ä¹‰</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>&lt;0x00000000c561cfd8&gt;</code></td>\n<td>æŒæœ‰é”çš„å¯¹è±¡åœ°å€ã€‚å¯ä»¥åœ¨å…¶ä»–çº¿ç¨‹ä¸­æŸ¥æ‰¾è¿™ä¸ªåœ°å€ï¼Œä»¥åˆ¤æ–­æ­»é”ç­‰é—®é¢˜ã€‚</td>\n</tr>\n<tr>\n<td><code>(a ThreadPoolExecutor$Worker)</code></td>\n<td>è¡¨ç¤ºè¯¥é”å±äº <code>ThreadPoolExecutor</code> çš„æŸä¸ª <code>Worker</code> çº¿ç¨‹ï¼ˆè¿™æ˜¯çº¿ç¨‹æ± çš„å·¥ä½œçº¿ç¨‹ï¼‰ã€‚</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>çº¿ç¨‹çŠ¶æ€</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>çŠ¶æ€</th>\n<th>å«ä¹‰</th>\n<th>å¸¸è§åŸå›  / ç¤ºä¾‹æ–¹æ³•</th>\n<th>ç¤ºä¾‹ jstack è¾“å‡º</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>RUNNABLE</code></td>\n<td>çº¿ç¨‹æ­£åœ¨è¿è¡Œæˆ–å‡†å¤‡è¿è¡Œï¼Œç­‰å¾… CPU æ—¶é—´ç‰‡ã€‚</td>\n<td>çº¿ç¨‹æ´»è·ƒè¿è¡Œä¸­</td>\n<td><code>&quot;Thread-0&quot; #1 prio=5 os_prio=0 tid=0x00007f8d9c001000 nid=0x1a runnable [0x00007f8dbf7fe000]</code></td>\n</tr>\n<tr>\n<td><code>BLOCKED (on object monitor)</code></td>\n<td>ç­‰å¾…è·å–å¯¹è±¡çš„ç›‘è§†å™¨é”ï¼ˆåŒæ­¥é”ï¼‰ï¼Œå³ç­‰å¾…è¿›å…¥åŒæ­¥å—æˆ–æ–¹æ³•ã€‚</td>\n<td><code>synchronized</code> åŒæ­¥å—æˆ–æ–¹æ³•</td>\n<td><code>&quot;Thread-1&quot; #2 prio=5 os_prio=0 tid=0x00007f8d9c002000 nid=0x1b waiting for monitor entry [0x00007f8dbeaff000]</code></td>\n</tr>\n<tr>\n<td><code>WAITING (on object monitor)</code></td>\n<td>æ— é™æœŸç­‰å¾…å…¶ä»–çº¿ç¨‹æ‰§è¡ŒæŸæ“ä½œã€‚</td>\n<td><code>Object.wait()</code><br><code>Thread.join()</code><br><code>LockSupport.park()</code><br><code>Condition.await()</code></td>\n<td><code>&quot;Thread-2&quot; #3 prio=5 os_prio=0 tid=0x00007f8d9c003000 nid=0x1c waiting on condition [0x00007f8dbebff000]</code></td>\n</tr>\n<tr>\n<td><code>TIMED_WAITING (on object monitor)</code></td>\n<td>ç­‰å¾…å›ºå®šæ—¶é—´ï¼Œç›´åˆ°æ¡ä»¶æ»¡è¶³æˆ–è¶…æ—¶ã€‚</td>\n<td><code>Object.wait(long)</code><br><code>Thread.sleep(long)</code><br><code>Condition.awaitNanos(long)</code><br><code>DelayQueue.take()</code></td>\n<td><code>&quot;Thread-3&quot; #4 prio=5 os_prio=0 tid=0x00007f8d9c004000 nid=0x1d timed_waiting [0x00007f8dbebff000]</code></td>\n</tr>\n<tr>\n<td><code>TERMINATED</code></td>\n<td>çº¿ç¨‹å·²è¿è¡Œå®Œæ¯•å¹¶é€€å‡ºï¼ˆé€šå¸¸ä¸åœ¨ jstack ä¸­æ˜¾ç¤ºï¼‰ã€‚</td>\n<td>-</td>\n<td>-</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"ä½¿ç”¨jstackæ£€æŸ¥æ­»é”\">ä½¿ç”¨jstackæ£€æŸ¥æ­»é”</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ­»é”æ˜¯æŒ‡å¤šä¸ªçº¿ç¨‹äº’ç›¸ç­‰å¾…å¯¹æ–¹é‡Šæ”¾é”ï¼Œå¯¼è‡´æ— æ³•ç»§ç»­è¿è¡Œçš„æƒ…å†µã€‚</p>\n</li>\n</ul>\n<h4 id=\"ç›´æ¥æŸ¥æ‰¾-Found-one-Java-level-deadlock-æç¤º\">ç›´æ¥æŸ¥æ‰¾ <code>Found one Java-level deadlock</code> æç¤º</h4>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Found one Java-level deadlock:</span><br><span class=\"line\">=============================</span><br><span class=\"line\"><span class=\"string\">&quot;Thread-1&quot;</span>:</span><br><span class=\"line\">  waiting to lock monitor 0x0000000005c0a098 (object 0x00000000d5c10a70, a java.lang.Object),</span><br><span class=\"line\">  <span class=\"built_in\">which</span> is held by <span class=\"string\">&quot;Thread-2&quot;</span></span><br><span class=\"line\"><span class=\"string\">&quot;Thread-2&quot;</span>:</span><br><span class=\"line\">  waiting to lock monitor 0x0000000005c0a128 (object 0x00000000d5c10aa0, a java.lang.Object),</span><br><span class=\"line\">  <span class=\"built_in\">which</span> is held by <span class=\"string\">&quot;Thread-1&quot;</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¡¨ç¤ºä¸¤ä¸ªçº¿ç¨‹äº’ç›¸ç­‰å¾…å¯¹æ–¹é‡Šæ”¾é”ï¼Œé€ æˆæ­»é”ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ç›®å‰åªæ”¯æŒæ‰¾å‡º <code>synchronized</code> å…³é”®å­—é˜»å¡ä½çš„çº¿ç¨‹ï¼Œå¦‚æœæ˜¯ <code>java.util.concurrent.Lock</code> ç›®å‰è¿˜ä¸æ”¯æŒã€‚</p>\n</li>\n</ul>\n<h4 id=\"æ‰‹åŠ¨åˆ¤æ–­æ­»é”çš„ç‰¹å¾ï¼ˆå¦‚æœæ²¡æœ‰ä¸Šé¢çš„æç¤ºï¼‰\">æ‰‹åŠ¨åˆ¤æ–­æ­»é”çš„ç‰¹å¾ï¼ˆå¦‚æœæ²¡æœ‰ä¸Šé¢çš„æç¤ºï¼‰</h4>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¦‚æœ JVM æ²¡æœ‰æ˜¾å¼æç¤ºï¼Œä½ å¯ä»¥é€šè¿‡ä»¥ä¸‹æ­»é”ç‰¹å¾è¿›è¡Œæ‰‹åŠ¨è¯†åˆ«ï¼š</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>ç‰¹å¾</th>\n<th>æè¿°</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>çº¿ç¨‹å¤„äº <code>BLOCKED</code> çŠ¶æ€</td>\n<td>çº¿ç¨‹è¢«é”é˜»å¡åœ¨ <code>monitor</code> ä¸Šã€‚</td>\n</tr>\n<tr>\n<td><code>waiting to lock</code> å’Œ <code>locked</code> å‡ºç°äº¤å‰</td>\n<td>ä¸€ä¸ªçº¿ç¨‹æ­£åœ¨ç­‰å¾…å¦ä¸€ä¸ªçº¿ç¨‹æŒæœ‰çš„é”ï¼Œè€Œå¦ä¸€ä¸ªçº¿ç¨‹ä¹Ÿåœ¨ç­‰å¾…å½“å‰çº¿ç¨‹çš„é”ã€‚</td>\n</tr>\n<tr>\n<td>æ²¡æœ‰èƒ½ç»§ç»­æ‰§è¡Œçš„çº¿ç¨‹</td>\n<td>å¤šä¸ªçº¿ç¨‹éƒ½å¤„äº <code>BLOCKED</code> çŠ¶æ€ï¼Œä¸”ç›¸äº’ä¾èµ–ã€‚</td>\n</tr>\n</tbody>\n</table>\n<div class=\"tips\">\n<p><em><strong>åœ¨ Java 8 ä¹‹åæ”¯æŒè·å– JVM å†…éƒ¨çº¿ç¨‹</strong></em></p>\n<ul class=\"lvl-1\">\n<li class=\"lvl-2\">VM å†…éƒ¨çº¿ç¨‹åŒ…æ‹¬ä¸‹é¢å‡ ç§ï¼š</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>çº¿ç¨‹ç±»å‹</th>\n<th>ç¤ºä¾‹åç§°</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>JITï¼ˆJust-In-Timeï¼‰ç¼–è¯‘çº¿ç¨‹</td>\n<td>C1 CompilerThread0, C2 CompilerThread0</td>\n</tr>\n<tr>\n<td>GC çº¿ç¨‹</td>\n<td>GC Thread0, G1 Young RemSet Sampling</td>\n</tr>\n<tr>\n<td>å…¶å®ƒå†…éƒ¨çº¿ç¨‹</td>\n<td>VM Periodic Task Thread, VM Thread, Service Thread</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-1\">\n<li class=\"lvl-2\">\n<p>è‡ª JDK 7 åŠä»¥ä¸Šç‰ˆæœ¬å¼€å§‹ï¼ŒHotSpot JVM é»˜è®¤å¯ç”¨äº†ï¼šåˆ†å±‚ç¼–è¯‘ï¼ˆTiered Compilationï¼‰ï¼Œå³åŒæ—¶ä½¿ç”¨ C1 å’Œ C2 ç¼–è¯‘å™¨ã€‚</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>ç¼–è¯‘å™¨</th>\n<th>ç‰¹æ€§</th>\n<th>ç”¨é€”</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>C1ï¼ˆClient Compilerï¼‰</strong></td>\n<td>ç¼–è¯‘é€Ÿåº¦å¿«ï¼Œä¼˜åŒ–å°‘</td>\n<td>ç¨‹åºå¯åŠ¨æ—¶ä½¿ç”¨ï¼Œæå‡å¯åŠ¨é€Ÿåº¦</td>\n</tr>\n<tr>\n<td><strong>C2ï¼ˆServer Compilerï¼‰</strong></td>\n<td>ç¼–è¯‘é€Ÿåº¦æ…¢ï¼Œä¼˜åŒ–å¼º</td>\n<td>çƒ­ç‚¹ä»£ç è¾¾åˆ°ä¸€å®šé—¨æ§›åä½¿ç”¨ï¼Œæå‡é•¿æœŸè¿è¡Œæ€§èƒ½</td>\n</tr>\n</tbody>\n</table>\n<blockquote>\n<p>JVM å¯åŠ¨åï¼Œå…ˆè§£é‡Šæ‰§è¡Œå­—èŠ‚ç ï¼›çƒ­ç‚¹ä»£ç é¦–å…ˆç”± C1 ç¼–è¯‘å™¨å¤„ç†ï¼›å¦‚æœè¿›ä¸€æ­¥å˜çƒ­ï¼Œäº¤ç”± C2 ç¼–è¯‘å™¨ä¼˜åŒ–ï¼›æ•´ä¸ªè¿‡ç¨‹ç”± JVM è‡ªåŠ¨ç®¡ç†ï¼Œä¸éœ€è¦æ‰‹åŠ¨å¹²é¢„ã€‚</p>\n</blockquote>\n<ul class=\"lvl-1\">\n<li class=\"lvl-2\">\n<p>æ˜¯å¦å¯ä»¥æŒ‡å®šåªç”¨æŸä¸ªç¼–è¯‘å™¨ï¼Ÿæ˜¯çš„ï¼Œä½ å¯ä»¥ç”¨ JVM å‚æ•°æ§åˆ¶ï¼Œä½†çœŸæ²¡å¿…è¦ã€‚</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>å‚æ•°</th>\n<th>å«ä¹‰</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>-client</code></td>\n<td>ä½¿ç”¨ C1 ç¼–è¯‘å™¨ï¼ˆé€‚åˆå¯åŠ¨å¿«ï¼‰</td>\n</tr>\n<tr>\n<td><code>-server</code></td>\n<td>ä½¿ç”¨ C2 ç¼–è¯‘å™¨ï¼ˆé€‚åˆé•¿æ—¶é—´è¿è¡Œçš„æœåŠ¡ï¼‰</td>\n</tr>\n<tr>\n<td><code>-XX:-TieredCompilation</code></td>\n<td>ç¦ç”¨åˆ†å±‚ç¼–è¯‘ï¼Œä»…ä½¿ç”¨ <code>-client</code> æˆ– <code>-server</code> æŒ‡å®šçš„ç¼–è¯‘å™¨</td>\n</tr>\n</tbody>\n</table>\n</div>\n<h2 id=\"jmap-åˆ†æè¿è¡Œä¸­-Java-è¿›ç¨‹çš„å†…å­˜ä½¿ç”¨æƒ…å†µ\">jmap: åˆ†æè¿è¡Œä¸­ Java è¿›ç¨‹çš„å†…å­˜ä½¿ç”¨æƒ…å†µ</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>jmap æ¯”è¾ƒæ¶ˆè€—å†…å­˜ï¼Œæ‰€ä»¥ä¸æ¨èç”Ÿäº§ç¯å¢ƒä½¿ç”¨ã€‚</p>\n</li>\n</ul>\n<h3 id=\"jmap-histo-pid-æŸ¥çœ‹ç±»å®ä¾‹æ•°é‡åŠå ç”¨å†…å­˜\"><code>jmap -histo &lt;pid&gt;</code>: æŸ¥çœ‹ç±»å®ä¾‹æ•°é‡åŠå ç”¨å†…å­˜</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ jmap -histo 25238</span><br><span class=\"line\">25238:</span><br><span class=\"line\"></span><br><span class=\"line\"> num     <span class=\"comment\">#instances         #bytes  class name</span></span><br><span class=\"line\">----------------------------------------------</span><br><span class=\"line\">   1:        106175       10838440  [C</span><br><span class=\"line\">   2:         94344        3019008  java.util.concurrent.ConcurrentHashMap<span class=\"variable\">$Node</span></span><br><span class=\"line\">   3:        105529        2532696  java.lang.String</span><br><span class=\"line\">   4:         11203        2496608  [B</span><br><span class=\"line\">   5:         20178        2430136  [Ljava.lang.Object;</span><br><span class=\"line\">   6:         21642        2399904  java.lang.Class</span><br><span class=\"line\">â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦</span><br><span class=\"line\">Total        857252       51328200</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># num: åºå·</span></span><br><span class=\"line\"><span class=\"comment\"># instances: å®ä¾‹æ•°é‡</span></span><br><span class=\"line\"><span class=\"comment\"># bytes: å®ä¾‹å­—èŠ‚æ•°</span></span><br><span class=\"line\"><span class=\"comment\"># class name: ç±»å, [C is a char[]ï¼Œ[S is a short[]ï¼Œ[I is a int[]ï¼Œ[B is a byte[]ï¼Œ[L is a List</span></span><br><span class=\"line\"><span class=\"comment\"># Total: æ€»æ•°</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"jmap-heap-pid-æŸ¥çœ‹å †ä½¿ç”¨æƒ…å†µ\"><code>jmap -heap &lt;pid&gt;</code>: æŸ¥çœ‹å †ä½¿ç”¨æƒ…å†µ</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ jmap -heap 25238</span><br><span class=\"line\">Attaching to process ID 25238, please <span class=\"built_in\">wait</span>...</span><br><span class=\"line\">Debugger attached successfully.</span><br><span class=\"line\">Server compiler detected.</span><br><span class=\"line\">JVM version is 25.371-b11</span><br><span class=\"line\"></span><br><span class=\"line\">using thread-local object allocation.</span><br><span class=\"line\">Parallel GC with 2 thread(s)</span><br><span class=\"line\"></span><br><span class=\"line\">Heap Configuration:    <span class=\"comment\"># å †é…ç½®</span></span><br><span class=\"line\">   MinHeapFreeRatio         = 0                     <span class=\"comment\"># æœ€å°ç©ºé—²ç™¾åˆ†æ¯”</span></span><br><span class=\"line\">   MaxHeapFreeRatio         = 100                     <span class=\"comment\"># æœ€å¤§ç©ºé—²ç™¾åˆ†æ¯”</span></span><br><span class=\"line\">   MaxHeapSize              = 1010827264 (964.0MB)    <span class=\"comment\"># æœ€å¤§å †å¤§å°</span></span><br><span class=\"line\">   NewSize                  = 21495808 (20.5MB)       <span class=\"comment\"># æ–°ç”Ÿä»£å¤§å°</span></span><br><span class=\"line\">   MaxNewSize               = 336592896 (321.0MB)     <span class=\"comment\"># æ–°ç”Ÿä»£æœ€å¤§å¤§å°</span></span><br><span class=\"line\">   OldSize                  = 43515904 (41.5MB)       <span class=\"comment\"># è€å¹´ä»£å¤§å°</span></span><br><span class=\"line\">   NewRatio                 = 2                       <span class=\"comment\"># æ–°ç”Ÿä»£ä¸è€å¹´ä»£æ¯”ä¾‹</span></span><br><span class=\"line\">   SurvivorRatio            = 8                       <span class=\"comment\"># å¹¸å­˜è€…æ¯”ä¾‹</span></span><br><span class=\"line\">   MetaspaceSize            = 21807104 (20.796875MB)   <span class=\"comment\"># å…ƒç©ºé—´å¤§å°</span></span><br><span class=\"line\">   CompressedClassSpaceSize = 1073741824 (1024.0MB)   <span class=\"comment\"># å‹ç¼©ç±»ç©ºé—´å¤§å°ï¼Œç”¨äºå­˜å‚¨æ‰€æœ‰ ç±»æŒ‡é’ˆï¼ˆKlass pointerï¼‰</span></span><br><span class=\"line\">   MaxMetaspaceSize         = 17592186044415 MB       <span class=\"comment\"># å…ƒç©ºé—´æœ€å¤§å¤§å°</span></span><br><span class=\"line\">   G1HeapRegionSize         = 0 (0.0MB)               <span class=\"comment\"># G1å †å¤§å°</span></span><br><span class=\"line\"></span><br><span class=\"line\">Heap Usage:       <span class=\"comment\"># å †ä½¿ç”¨æƒ…å†µ</span></span><br><span class=\"line\">PS Young Generation <span class=\"comment\"># å¹´è½»ç”Ÿä»£</span></span><br><span class=\"line\">Eden Space:         <span class=\"comment\"># Eden åŒº</span></span><br><span class=\"line\">   capacity = 30932992 (29.5MB)    <span class=\"comment\">#  Eden åŒºå¤§å°</span></span><br><span class=\"line\">   used     = 16705104 (15.931228637695312MB) <span class=\"comment\">#  Eden åŒºä½¿ç”¨æƒ…å†µ</span></span><br><span class=\"line\">   free     = 14227888 (13.568771362304688MB) <span class=\"comment\">#  Eden åŒºå‰©ä½™æƒ…å†µ</span></span><br><span class=\"line\">   54.00416487354343% used                    <span class=\"comment\">#  Eden åŒºä½¿ç”¨ç™¾åˆ†æ¯”</span></span><br><span class=\"line\">From Space:                      <span class=\"comment\"># å¹¸å­˜è€…åŒº survivor0</span></span><br><span class=\"line\">   capacity = 524288 (0.5MB)</span><br><span class=\"line\">   used     = 0 (0.0MB)</span><br><span class=\"line\">   free     = 524288 (0.5MB)</span><br><span class=\"line\">   0.0% used</span><br><span class=\"line\">To Space:                       <span class=\"comment\"># å¹¸å­˜è€…åŒº survivor1</span></span><br><span class=\"line\">   capacity = 524288 (0.5MB)</span><br><span class=\"line\">   used     = 0 (0.0MB)</span><br><span class=\"line\">   free     = 524288 (0.5MB)</span><br><span class=\"line\">   0.0% used</span><br><span class=\"line\">PS Old Generation                <span class=\"comment\"># è€å¹´ä»£</span></span><br><span class=\"line\">   capacity = 193462272 (184.5MB)</span><br><span class=\"line\">   used     = 43292112 (41.28657531738281MB)</span><br><span class=\"line\">   free     = 150170160 (143.2134246826172MB)</span><br><span class=\"line\">   22.377547597497458% used</span><br><span class=\"line\"></span><br><span class=\"line\">38722 interned Strings occupying 4184168 bytes. <span class=\"comment\"># å †ä¸­å­—ç¬¦ä¸²æ•°é‡åŠå ç”¨å†…å­˜</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"jmap-dump-live-format-b-file-file-pid-åˆ›å»ºä¸€ä¸ªå¿«ç…§ï¼Œå¹¶ä¿å­˜åˆ°æ–‡ä»¶ä¸­\"><code>jmap -dump:live,format=b,file=&lt;file&gt; &lt;pid&gt;</code>: åˆ›å»ºä¸€ä¸ªå¿«ç…§ï¼Œå¹¶ä¿å­˜åˆ°æ–‡ä»¶ä¸­</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åˆ›å»ºä¸€ä¸ªå¿«ç…§ï¼Œå¹¶ä¿å­˜åˆ°å½“å‰ç›®å½•ä¸‹</span></span><br><span class=\"line\">$ jmap -dump:live,format=b,file=test.hprof 25238</span><br><span class=\"line\">Dumping heap to /tmp/test.hprof ...</span><br><span class=\"line\">Heap dump file created</span><br></pre></td></tr></table></figure>\n<h2 id=\"jcmd-å¯ä»¥æ›¿ä»£jmapå‘½ä»¤ï¼Œjdk1-8-æ¨èä½¿ç”¨\">jcmd: å¯ä»¥æ›¿ä»£<code>jmap</code>å‘½ä»¤ï¼Œ<code>jdk1.8+</code>æ¨èä½¿ç”¨</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><code>jcmd</code> æ˜¯ <code>JDK</code> çš„ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼Œç”¨äºç®¡ç† <code>JVM</code>ï¼Œ<code>jcmd</code> å¯ä»¥æŸ¥çœ‹ <code>JVM</code> çš„è¿è¡ŒçŠ¶æ€ã€æŸ¥çœ‹å †å†…å­˜ä¿¡æ¯ã€è§¦å‘ GCã€æŸ¥çœ‹çº¿ç¨‹ä¿¡æ¯ã€æŸ¥çœ‹ç±»ä¿¡æ¯ç­‰ç­‰ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ç”Ÿäº§ç¯å¢ƒä¸å»ºè®®ä½¿ç”¨<code>jmap</code>ï¼Œå› å…¶ä¼šå ç”¨å¤§é‡å†…å­˜ï¼Œæ¨èä½¿ç”¨ <code>jcmd</code>ã€‚</p>\n</li>\n</ul>\n<h3 id=\"jcmd-pid-GC-heap-info-æŸ¥çœ‹å †ä½¿ç”¨æƒ…å†µ\"><code>jcmd &lt;pid&gt; GC.heap_info</code>: æŸ¥çœ‹å †ä½¿ç”¨æƒ…å†µ</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç±»ä¼¼ <code>jmap -heap &lt;pid&gt;</code></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ jcmd 25238 GC.heap_info</span><br><span class=\"line\">25238:</span><br><span class=\"line\"> PSYoungGen      total 30208K, used 23593K [0x00000000ebf00000, 0x00000000edd80000, 0x0000000100000000)</span><br><span class=\"line\">  eden space 29696K, 78% used [0x00000000ebf00000,0x00000000ed5d2560,0x00000000edc00000)</span><br><span class=\"line\">  from space 512K, 43% used [0x00000000edd00000,0x00000000edd38000,0x00000000edd80000)</span><br><span class=\"line\">  to   space 512K, 0% used [0x00000000edc80000,0x00000000edc80000,0x00000000edd00000)</span><br><span class=\"line\"> ParOldGen       total 105984K, used 96547K [0x00000000c3c00000, 0x00000000ca380000, 0x00000000ebf00000)</span><br><span class=\"line\">  object space 105984K, 91% used [0x00000000c3c00000,0x00000000c9a48f10,0x00000000ca380000)</span><br><span class=\"line\"> Metaspace       used 114450K, capacity 122262K, committed 122368K, reserved 1157120K</span><br><span class=\"line\">  class space    used 14018K, capacity 15294K, committed 15360K, reserved 1048576K</span><br></pre></td></tr></table></figure>\n<h3 id=\"jcmd-pid-GC-class-histogram-æŸ¥çœ‹ç±»åŠ è½½æƒ…å†µ\"><code>jcmd &lt;pid&gt; GC.class_histogram</code>: æŸ¥çœ‹ç±»åŠ è½½æƒ…å†µ</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç±»ä¼¼ <code>jmap -histo &lt;pid&gt;</code></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ jcmd 25238 GC.class_histogram</span><br><span class=\"line\">25238:</span><br><span class=\"line\"></span><br><span class=\"line\"> num     <span class=\"comment\">#instances         #bytes  class name</span></span><br><span class=\"line\">----------------------------------------------</span><br><span class=\"line\">   1:        106175       10838440  [C</span><br><span class=\"line\">   2:         94344        3019008  java.util.concurrent.ConcurrentHashMap<span class=\"variable\">$Node</span></span><br><span class=\"line\">   3:        105529        2532696  java.lang.String</span><br><span class=\"line\">   4:         11203        2496608  [B</span><br><span class=\"line\">   5:         20178        2430136  [Ljava.lang.Object;</span><br><span class=\"line\">   6:         21642        2399904  java.lang.Class</span><br><span class=\"line\">â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦</span><br><span class=\"line\">Total        857252       51328200</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># num: åºå·</span></span><br><span class=\"line\"><span class=\"comment\"># instances: å®ä¾‹æ•°é‡</span></span><br><span class=\"line\"><span class=\"comment\"># bytes: å®ä¾‹å­—èŠ‚æ•°</span></span><br><span class=\"line\"><span class=\"comment\"># class name: ç±»å, [C is a char[]ï¼Œ[S is a short[]ï¼Œ[I is a int[]ï¼Œ[B is a byte[]ï¼Œ[L is a List</span></span><br><span class=\"line\"><span class=\"comment\"># Total: æ€»æ•°</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"jcmd-pid-GC-heap-dump-path-to-heap-hprof-å¯¼å‡º-heap-dump\"><code>jcmd &lt;pid&gt; GC.heap_dump /path/to/heap.hprof</code>: å¯¼å‡º heap dump</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ›¿ä»£ <code>jmap -dump:format=b,file=heap.hprof &lt;pid&gt;</code>ï¼Œä½†ä»ä¼šæœ‰åœé¡¿ï¼ˆè§¦å‘FullGCï¼‰ï¼Œdump è¿‡ç¨‹æ…¢ï¼Œç”Ÿäº§ç¯å¢ƒæ…é‡ä½¿ç”¨</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ jcmd 25238 GC.heap_dump ./heap.hprof</span><br><span class=\"line\">25238:</span><br><span class=\"line\">Heap dump file created</span><br><span class=\"line\"><span class=\"comment\"># æ³¨æ„è¿™é‡Œä½¿ç”¨çš„æ˜¯ç›¸å¯¹ç›®å½•ï¼Œ./heap.hprofï¼Œä½†æ­¤æ—¶ &quot;./&quot; å¹¶ä¸æ˜¯è¿è¡Œå‘½ä»¤æ—¶æ‰€åœ¨çš„ç›®å½•ï¼Œè€Œæ˜¯æŒ‡ Java è¿›ç¨‹çš„å·¥ä½œç›®å½•ï¼Œå¦‚æœä½ ä¸çŸ¥é“å·¥ä½œç›®å½•ï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹</span></span><br><span class=\"line\">jcmd &lt;pid&gt; VM.system_properties | grep <span class=\"string\">&quot;user.dir&quot;</span></span><br><span class=\"line\"><span class=\"comment\"># linuxä¸‹ä¹Ÿå¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹</span></span><br><span class=\"line\"><span class=\"built_in\">ls</span> -l /proc/&lt;pid&gt;/cwd</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å› ä¸ºç”Ÿäº§ç¯å¢ƒä¸æ¨èä½¿ç”¨ <code>jmap</code> æˆ– <code>jcmd</code> å¯¼å‡º heap dumpï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦åœ¨ç”Ÿäº§ç¯å¢ƒä¸­é…ç½®å¦‚ä¸‹jvmå‚æ•°</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">-XX:+HeadDumpOnOutOfMemoryError <span class=\"comment\"># å†…å­˜æº¢å‡ºï¼ˆOOMï¼‰æ—¶ä¼šè‡ªåŠ¨ä¿å­˜å †å†…å­˜å¿«ç…§æ–‡ä»¶</span></span><br><span class=\"line\">-XX:HeapDumpPath=/path/to/dump.hprof <span class=\"comment\"># æŒ‡å®šå †å†…å­˜å¿«ç…§æ–‡ä»¶ä¿å­˜è·¯å¾„ï¼Œå¦‚æœä¸é…ç½®ï¼Œåˆ™é»˜è®¤ä¿å­˜åœ¨ Java è¿›ç¨‹çš„å·¥ä½œç›®å½•ä¸‹ï¼Œæ–‡ä»¶åç§°é»˜è®¤ä¸º java_&lt;pid&gt;.hprof</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"jhat-åˆ†æ-Java-Heap-Dump-æ–‡ä»¶ï¼ˆ-hprofï¼‰çš„å·¥å…·\">jhat: åˆ†æ Java Heap Dump æ–‡ä»¶ï¼ˆ.hprofï¼‰çš„å·¥å…·</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>jhatï¼ˆJava Heap Analysis Toolï¼‰æ˜¯ JDK é™„å¸¦çš„ä¸€ä¸ªç”¨äº**åˆ†æ Java Heap Dump æ–‡ä»¶ï¼ˆ.hprofï¼‰**çš„å·¥å…·ã€‚å®ƒå¯ä»¥å°†å †å¿«ç…§ä½œä¸º HTTP æœåŠ¡åŠ è½½ï¼Œå¹¶å…è®¸ä½ é€šè¿‡æµè§ˆå™¨äº¤äº’å¼åœ°æŸ¥çœ‹å’ŒæŸ¥è¯¢å¯¹è±¡ä¿¡æ¯ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä¸è¿‡éœ€è¦æ³¨æ„çš„æ˜¯ï¼š<br>\nğŸ”º ä» JDK 9 èµ·ï¼Œjhat å·²è¢«å®˜æ–¹åºŸå¼ƒï¼Œæ¨èä½¿ç”¨æ›´å¼ºå¤§çš„å·¥å…·å¦‚ <code>VisualVM</code>ã€<code>Eclipse MAT</code> æˆ– <code>jcmd + å¤–éƒ¨å·¥å…·</code>ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># é»˜è®¤ç«¯å£7000</span></span><br><span class=\"line\">jhat &lt;heap dump file&gt;</span><br><span class=\"line\"><span class=\"comment\"># æŒ‡å®šç«¯å£</span></span><br><span class=\"line\">jhat -port 8000 &lt;heap dump file&gt;</span><br></pre></td></tr></table></figure>\n<h2 id=\"jvisualvm-å›¾å½¢åŒ–çš„-JVM-ç›‘æ§ä¸åˆ†æå·¥å…·\">jvisualvm: å›¾å½¢åŒ–çš„ JVM ç›‘æ§ä¸åˆ†æå·¥å…·</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>jvisualvmï¼ˆå…¨ç§°ï¼šJava VisualVMï¼‰æ˜¯ Java å®˜æ–¹æä¾›çš„ä¸€æ¬¾ å›¾å½¢åŒ–çš„ JVM ç›‘æ§ä¸åˆ†æå·¥å…·ï¼Œç”¨äºè§‚å¯Ÿã€åˆ†æå’Œè°ƒè¯•æ­£åœ¨è¿è¡Œçš„ Java ç¨‹åºã€‚å®ƒéå¸¸é€‚åˆå¼€å‘å’Œæµ‹è¯•ç¯å¢ƒä¸­è¿›è¡Œå†…å­˜åˆ†æã€çº¿ç¨‹åˆ†æã€GC è¡Œä¸ºè§‚å¯Ÿç­‰ä»»åŠ¡ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>åŠŸèƒ½æ¦‚è§ˆ</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>åŠŸèƒ½</th>\n<th>æè¿°</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>è¿›ç¨‹ç›‘æ§</strong></td>\n<td>æŸ¥çœ‹æœ¬åœ°æˆ–è¿œç¨‹ JVM è¿›ç¨‹çš„å†…å­˜ã€CPUã€çº¿ç¨‹ç­‰è¿è¡ŒçŠ¶æ€</td>\n</tr>\n<tr>\n<td><strong>å†…å­˜ä½¿ç”¨åˆ†æ</strong></td>\n<td>æŸ¥çœ‹å †å†…å­˜ä½¿ç”¨æƒ…å†µã€GC æ¬¡æ•°å’Œæ—¶é—´ã€ç±»å®ä¾‹åˆ†å¸ƒç­‰</td>\n</tr>\n<tr>\n<td><strong>çº¿ç¨‹åˆ†æ</strong></td>\n<td>æŸ¥çœ‹çº¿ç¨‹çŠ¶æ€ã€çº¿ç¨‹æ ˆã€æ˜¯å¦å­˜åœ¨æ­»é”</td>\n</tr>\n<tr>\n<td><strong>GC åˆ†æ</strong></td>\n<td>å›¾å½¢åŒ–å±•ç¤º GC æ´»åŠ¨ã€é¢‘ç‡ä¸è€—æ—¶</td>\n</tr>\n<tr>\n<td><strong>å †è½¬å‚¨åˆ†æ</strong></td>\n<td>å¯¼å…¥ <code>.hprof</code> æ–‡ä»¶è¿›è¡Œå¯¹è±¡å®ä¾‹ã€ç±»ã€å¼•ç”¨å…³ç³»åˆ†æ</td>\n</tr>\n<tr>\n<td><strong>CPU åˆ†æ</strong></td>\n<td>åˆ†ææ–¹æ³•è°ƒç”¨è·¯å¾„ã€è€—æ—¶ã€çƒ­ç‚¹ä»£ç ï¼ˆéœ€æ‰‹åŠ¨å¯ç”¨ CPU profilerï¼‰</td>\n</tr>\n<tr>\n<td><strong>æ’ä»¶æ”¯æŒ</strong></td>\n<td>å¯ä»¥é€šè¿‡æ’ä»¶å®‰è£…æ›´å¤šåŠŸèƒ½ï¼ˆå¦‚ Visual GCï¼‰</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¯åŠ¨ jvisualvm</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ä¸è¦åœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ï¼Œå¦‚æœæ˜¯åˆ†ææœåŠ¡ç«¯ .hprof æ–‡ä»¶ï¼Œå¯ä»¥å¯¼å‡ºåˆ°æœ¬åœ°ååœ¨æœ¬åœ°å¯åŠ¨</span></span><br><span class=\"line\">$ jvisualvm</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åœ¨ jvisualvm ä¸­å¯¼å…¥ .hprof æ–‡ä»¶</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ jvisualvm --openfile &lt;heap dump file&gt;</span><br><span class=\"line\"><span class=\"comment\"># æˆ–è€… å…ˆæ‰“å¼€ jvisualvm åï¼Œç‚¹å‡» File -&gt; Open File -&gt; é€‰æ‹© .hprof æ–‡ä»¶</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>âš ï¸ æ³¨æ„äº‹é¡¹</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>æ³¨æ„ç‚¹</th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>ä¸é€‚ç”¨äºå¤§è§„æ¨¡ç”Ÿäº§ç¯å¢ƒç›‘æ§</td>\n<td>å› ä¸ºå…¶åˆ†æè¿‡ç¨‹å¯èƒ½ä¼šå¯¹ JVM æœ‰è½»å¾®å½±å“</td>\n</tr>\n<tr>\n<td><code>.hprof</code> æ–‡ä»¶è¿‡å¤§æ—¶åŠ è½½ç¼“æ…¢</td>\n<td>å¯é…åˆ Eclipse MAT ä½¿ç”¨</td>\n</tr>\n<tr>\n<td>CPU/Memory Profiler ä¼šå¢åŠ ç³»ç»Ÿè´Ÿæ‹…</td>\n<td>ä½¿ç”¨æ—¶è°¨æ…ï¼Œå»ºè®®åªåœ¨æµ‹è¯•ç¯å¢ƒå¯ç”¨</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"Eclipse-MAT-Java-Heap-Dump-åˆ†æå·¥å…·\">Eclipse MAT: Java Heap Dump åˆ†æå·¥å…·</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><a href=\"https://eclipse.dev/mat\">Eclipse MAT</a>ï¼ˆEclipse Memory Analyzer Toolï¼‰æ˜¯ä¸€ä¸ªç”¨äºåˆ†æ Java å †å¿«ç…§çš„å·¥å…·ï¼Œå®ƒæä¾›äº†è®¸å¤šåŠŸèƒ½æ¥å¸®åŠ©å¼€å‘äººå‘˜ç†è§£ Java åº”ç”¨ç¨‹åºä¸­çš„å†…å­˜é—®é¢˜ã€‚</p>\n</li>\n</ul>\n<div class=\"tips\">\n<p><em><strong>MaxOSç³»ç»Ÿå®‰è£…Eclipse MATåï¼Œå¯åŠ¨æŠ¥é”™ï¼ŒæŠ¥é”™ä¿¡æ¯ä¸ºï¼šThe JVM shared library â€œ/Library/Internet Plug-Ins/JavaAppletPlugin.plugin/Contents/Home/bin/â€¦/lib/server/libjvm.dylibâ€ does not contain the JNI_CreateJavaVM symbol.</strong></em></p>\n<ul class=\"lvl-1\">\n<li class=\"lvl-2\">è§£å†³æ–¹æ³•ï¼š<br>\n1.åœ¨åº”ç”¨åˆ—è¡¨ï¼Œæ‰¾åˆ°<code>MemoryAnalyzer.app</code>ï¼Œç„¶åå³é”®å•å‡»åï¼Œé€‰æ‹©<code>æ˜¾ç¤ºåŒ…å†…å®¹</code>,è¿›å…¥Contentsç›®å½•ï¼Œæ‰¾åˆ°<code>Info.plist</code>æ–‡ä»¶<br>\n2.æ‰“å¼€<code>Info.plist</code>æ–‡ä»¶åï¼Œå¯ä»¥çœ‹åˆ°æ³¨é‡Š<code>&lt;string&gt;-vm&lt;/string&gt;</code>é…ç½®é¡¹ï¼Œæˆ‘ä»¬éœ€è¦åšçš„å°±æ˜¯æ‰“å¼€è¿™ä¸ªé…ç½®é¡¹ï¼Œå¹¶ä¸”å°†å…¶è®¾ç½®ä¸ºæˆ‘ä»¬ç³»ç»Ÿçš„Javaè·¯å¾„ï¼Œæœ€æ–°ç‰ˆéœ€è¦<code>jdk17+</code></li>\n</ul>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">string</span>&gt;</span>-vm<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">string</span>&gt;</span>/Users/hanqf/develop_soft/jdk17/bin/java<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></span><br></pre></td></tr></table></figure>\n</div>\n<h2 id=\"Arthas-æ¨è\">Arthas : æ¨è</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><a href=\"https://arthas.aliyun.com\">Arthas</a> æ˜¯é˜¿é‡Œå·´å·´å¼€æºçš„ä¸€æ¬¾ Java è¯Šæ–­å·¥å…·ï¼Œä¸“ä¸ºçº¿ä¸Šè¯Šæ–­è€Œè®¾è®¡ã€‚å®ƒå¯ä»¥å¸®åŠ©å¼€å‘è€…åœ¨ä¸é‡å¯ã€ä¸ä¿®æ”¹ä»£ç çš„æƒ…å†µä¸‹ï¼Œæ’æŸ¥ç”Ÿäº§ç¯å¢ƒä¸­ Java åº”ç”¨çš„é—®é¢˜ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>Arthas æ”¯æŒ JDK 6+ï¼Œæ”¯æŒ Linux/Mac/Windowsï¼Œé‡‡ç”¨å‘½ä»¤è¡Œäº¤äº’æ¨¡å¼ï¼ŒåŒæ—¶æä¾›ä¸°å¯Œçš„ Tab è‡ªåŠ¨è¡¥å…¨åŠŸèƒ½ï¼Œè¿›ä¸€æ­¥æ–¹ä¾¿è¿›è¡Œé—®é¢˜çš„å®šä½å’Œè¯Šæ–­ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>è¿™é‡Œè¦æ³¨æ„ä¸€ç‚¹ï¼Œå°±æ˜¯Arthasä»<code>4.x</code>ç‰ˆæœ¬å¼€å§‹ï¼Œéœ€è¦ä¾èµ–<code>JDK8+</code>ï¼Œå¦‚æœæ˜¯<code>JDK6/7</code>ï¼Œå¯ä»¥ä¸‹è½½æœ€åä¸€ä¸ª3.xç‰ˆæœ¬ <a href=\"https://github.com/alibaba/arthas/releases/tag/arthas-all-3.7.2\">3.7.2</a>ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä¸ºäº†æ–¹ä¾¿æˆ‘ä»¬å­¦ä¹ ï¼ŒArthasè¿˜ä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªç»ƒä¹ åœºï¼Œ<a href=\"https://killercoda.com/arthas/course/arthas-tutorials-cn\">Arthas Playground</a>ã€‚</p>\n</li>\n</ul>\n<h3 id=\"Arthas-æ ¸å¿ƒç‰¹ç‚¹\">Arthas æ ¸å¿ƒç‰¹ç‚¹</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ— éœ€é‡å¯ã€ä¾µå…¥æ€§ä½<br>\nArthas å¯ä»¥ attach åˆ°æ­£åœ¨è¿è¡Œçš„ JVM ä¸Šï¼Œä¸éœ€è¦é‡å¯æœåŠ¡æˆ–ä¿®æ”¹æºä»£ç ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å‘½ä»¤å¼äº¤äº’ä½“éªŒ<br>\nç±»ä¼¼ Linux shell çš„æ“ä½œæ–¹å¼ï¼Œæ”¯æŒ tab è¡¥å…¨ã€ä¸Šä¸‹é”®å†å²å‘½ä»¤ç­‰ï¼Œéå¸¸ç›´è§‚ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å®æ—¶æŸ¥çœ‹å’Œç›‘æ§<br>\nå¯æŸ¥çœ‹æ–¹æ³•å‚æ•°ã€è¿”å›å€¼ã€è°ƒç”¨æ ˆã€æ‰§è¡Œè€—æ—¶ã€JVM çº¿ç¨‹ã€å†…å­˜ç­‰å®æ—¶æ•°æ®ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å¤šç§è¿æ¥æ–¹å¼<br>\næ”¯æŒå‘½ä»¤è¡Œç»ˆç«¯ã€æœ¬åœ° shellã€Web é¡µé¢ã€telnet ç­‰å¤šç§è¿æ¥æ–¹å¼ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>æ”¯æŒå¤šç§ JVM ç‰ˆæœ¬<br>\næ”¯æŒ Java 6+ï¼ŒåŒ…æ‹¬ OpenJDKã€Oracle JDKã€Alibaba Dragonwell ç­‰ã€‚</p>\n</li>\n</ul>\n<h3 id=\"Arthas-å¸¸ç”¨å‘½ä»¤\">Arthas å¸¸ç”¨å‘½ä»¤</h3>\n<h4 id=\"å¯åŠ¨\">å¯åŠ¨</h4>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">java -jar arthas-boot.jar</span><br><span class=\"line\"><span class=\"comment\">## è¾“å‡º</span></span><br><span class=\"line\">java -jar arthas-boot.jar --target-ip 0.0.0.0</span><br><span class=\"line\">[INFO] JAVA_HOME: /Library/Java/JavaVirtualMachines/jdk1.8.0_271.jdk/Contents/Home/jre</span><br><span class=\"line\">[INFO] arthas-boot version: 4.0.5</span><br><span class=\"line\">[INFO] Process 43959 already using port 3658</span><br><span class=\"line\">[INFO] Process 43959 already using port 8563</span><br><span class=\"line\">[INFO] Found existing java process, please choose one and input the serial number of the process, eg : 1. Then hit ENTER.</span><br><span class=\"line\">* [1]: 43959 demo-arthas-spring-boot.jar</span><br><span class=\"line\">  [2]: 50851 org.jetbrains.idea.maven.server.RemoteMavenServer36</span><br><span class=\"line\">  [3]: 50813 org.sonarsource.sonarlint.core.backend.cli.SonarLintServerCli</span><br><span class=\"line\">  [4]: 50655 com.intellij.idea.Main</span><br><span class=\"line\"><span class=\"comment\"># å¯åŠ¨åï¼Œä¼šè‡ªåŠ¨è¿›å…¥äº¤äº’æ¨¡å¼ï¼Œæ­¤æ—¶è¾“å…¥è¦ç›‘æ§çš„è¿›ç¨‹åºå·</span></span><br><span class=\"line\">1 <span class=\"comment\"># æ¯”å¦‚è¿™é‡Œè¾“å…¥ 1 å›è½¦</span></span><br><span class=\"line\"><span class=\"comment\">## è¾“å‡º</span></span><br><span class=\"line\">[INFO] arthas home: /Users/hanqf/.arthas/lib/4.0.5/arthas</span><br><span class=\"line\">[INFO] The target process already listen port 3658, skip attach.</span><br><span class=\"line\">[INFO] arthas-client connect 0.0.0.0 3658</span><br><span class=\"line\">  ,---.  ,------. ,--------.,--.  ,--.  ,---.   ,---.</span><br><span class=\"line\"> /  O  \\ |  .--. <span class=\"string\">&#x27;&#x27;</span>--.  .--<span class=\"string\">&#x27;|  &#x27;</span>--<span class=\"string\">&#x27;  | /  O  \\ &#x27;</span>   .-<span class=\"string\">&#x27;</span></span><br><span class=\"line\"><span class=\"string\">|  .-.  ||  &#x27;</span>--<span class=\"string\">&#x27;.&#x27;</span>   |  |   |  .--.  ||  .-.  |`.  `-.</span><br><span class=\"line\">|  | |  ||  |\\  \\    |  |   |  |  |  ||  | |  |.-<span class=\"string\">&#x27;    |</span></span><br><span class=\"line\"><span class=\"string\">`--&#x27;</span> `--<span class=\"string\">&#x27;`--&#x27;</span> <span class=\"string\">&#x27;--&#x27;</span>   `--<span class=\"string\">&#x27;   `--&#x27;</span>  `--<span class=\"string\">&#x27;`--&#x27;</span> `--<span class=\"string\">&#x27;`-----&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\">wiki        https://arthas.aliyun.com/doc</span><br><span class=\"line\">tutorials   https://arthas.aliyun.com/doc/arthas-tutorials.html</span><br><span class=\"line\">version     4.0.5</span><br><span class=\"line\">main_class  demo-arthas-spring-boot.jar</span><br><span class=\"line\">pid         43959</span><br><span class=\"line\">start_time  2025-05-14 14:57:18.031</span><br><span class=\"line\">currnt_time 2025-05-14 14:59:22.004</span><br><span class=\"line\"></span><br><span class=\"line\">[arthas@43959]$ <span class=\"comment\"># æ­¤æ—¶è¿›å…¥ arthas å‘½ä»¤è¡Œäº¤äº’çŠ¶æ€</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># é€€å‡º arthas</span></span><br><span class=\"line\">[arthas@43959]$ stop <span class=\"comment\"># é€€å‡º arthas</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>arthas å‘½ä»¤æœ‰å¾ˆå¤šï¼Œå½“å¸¸ç”¨çš„ä¹Ÿå°±å‡ ä¸ªï¼Œå¦å¤–å¦‚æœè®°ä¸ä½æŸä¸ªå‘½ä»¤æ€ä¹ˆç”¨äº†å¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤æŸ¥è¯¢</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;<span class=\"built_in\">command</span>&gt; -h æˆ–è€… <span class=\"built_in\">help</span> &lt;<span class=\"built_in\">command</span>&gt;</span><br></pre></td></tr></table></figure>\n<h4 id=\"dashboard-å®æ—¶æŸ¥çœ‹-JVM-è¿è¡ŒçŠ¶æ€\">dashboard :  å®æ—¶æŸ¥çœ‹ JVM è¿è¡ŒçŠ¶æ€</h4>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹ JVM è¿è¡ŒçŠ¶æ€ï¼Œ é»˜è®¤æ¯éš” 5 ç§’åˆ·æ–° CPUã€å†…å­˜ã€çº¿ç¨‹ã€GC ç­‰ä¿¡æ¯</span></span><br><span class=\"line\"><span class=\"comment\"># é»˜è®¤ä¼šä¸€ç›´åˆ·æ–°çŠ¶æ€ï¼ŒæŒ‰ `q` æˆ–  `Ctrl+C` é€€å‡º</span></span><br><span class=\"line\">dashboard</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ¯éš” 2 ç§’åˆ·æ–°ä¸€æ¬¡</span></span><br><span class=\"line\">dashboard -i 2000</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åˆ·æ–° 10 æ¬¡ååœæ­¢</span></span><br><span class=\"line\">dashboard -n 10</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ¯éš” 2 ç§’åˆ·æ–°ä¸€æ¬¡ï¼Œåˆ·æ–° 10 æ¬¡ååœæ­¢</span></span><br><span class=\"line\">dashboard -i 2000 -n 10</span><br></pre></td></tr></table></figure>\n<p><img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/uPic/2L73Hi.png\" alt=\"\" width=\"1400\" height=\"900\"></p>\n<h4 id=\"thread-æŸ¥çœ‹å½“å‰-JVM-çº¿ç¨‹ä¿¡æ¯\">thread : æŸ¥çœ‹å½“å‰ JVM çº¿ç¨‹ä¿¡æ¯</h4>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹å½“å‰ JVM çº¿ç¨‹ä¿¡æ¯ï¼ŒæŒ‰ CPU ä½¿ç”¨ç‡å€’åº</span></span><br><span class=\"line\">thread</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹æ‰€æœ‰çº¿ç¨‹ä¿¡æ¯</span></span><br><span class=\"line\">thread --all</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹æŒ‡å®šçº¿ç¨‹çš„å †æ ˆä¿¡æ¯</span></span><br><span class=\"line\">thread 18</span><br><span class=\"line\"><span class=\"comment\">## è¾“å‡º</span></span><br><span class=\"line\"><span class=\"string\">&quot;http-nio-80-exec-1&quot;</span> Id=18 WAITING on java.util.concurrent.locks.AbstractQueuedSynchronizer<span class=\"variable\">$ConditionObject</span>@51866c16</span><br><span class=\"line\">    at sun.misc.Unsafe.park(Native Method)</span><br><span class=\"line\">    -  waiting on java.util.concurrent.locks.AbstractQueuedSynchronizer<span class=\"variable\">$ConditionObject</span>@51866c16</span><br><span class=\"line\">    at java.util.concurrent.locks.LockSupport.park(LockSupport.java:175)</span><br><span class=\"line\">    at java.util.concurrent.locks.AbstractQueuedSynchronizer<span class=\"variable\">$ConditionObject</span>.await(AbstractQueuedSynchronizer.java:2039)</span><br><span class=\"line\">    at java.util.concurrent.LinkedBlockingQueue.take(LinkedBlockingQueue.java:442)</span><br><span class=\"line\">    at org.apache.tomcat.util.threads.TaskQueue.take(TaskQueue.java:103)</span><br><span class=\"line\">    at org.apache.tomcat.util.threads.TaskQueue.take(TaskQueue.java:31)</span><br><span class=\"line\">    at java.util.concurrent.ThreadPoolExecutor.getTask(ThreadPoolExecutor.java:1074)</span><br><span class=\"line\">    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1134)</span><br><span class=\"line\">    at java.util.concurrent.ThreadPoolExecutor<span class=\"variable\">$Worker</span>.run(ThreadPoolExecutor.java:624)</span><br><span class=\"line\">    at org.apache.tomcat.util.threads.TaskThread<span class=\"variable\">$WrappingRunnable</span>.run(TaskThread.java:61)</span><br><span class=\"line\">    at java.lang.Thread.run(Thread.java:748)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹æœ€å¿™çš„å‰5ä¸ªçº¿ç¨‹çš„å †æ ˆä¿¡æ¯</span></span><br><span class=\"line\">thread -n 5</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹å…¨éƒ¨çº¿ç¨‹çš„å †æ ˆä¿¡æ¯</span></span><br><span class=\"line\">thread -n -1</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŒ‡å®š cpu ä½¿ç”¨ç‡ç»Ÿè®¡çš„é‡‡æ ·é—´éš”ï¼Œå•ä½ä¸ºæ¯«ç§’ï¼Œé»˜è®¤å€¼ä¸º 200</span></span><br><span class=\"line\">thread -i 500</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ‰¾å‡ºå½“å‰é˜»å¡å…¶ä»–çº¿ç¨‹çš„çº¿ç¨‹</span></span><br><span class=\"line\">thread -b</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹æŒ‡å®šçŠ¶æ€çš„çº¿ç¨‹</span></span><br><span class=\"line\">thread --state WAITING</span><br></pre></td></tr></table></figure>\n<h4 id=\"sc-æŸ¥çœ‹-JVM-å·²åŠ è½½çš„ç±»ä¿¡æ¯\">sc : æŸ¥çœ‹ JVM å·²åŠ è½½çš„ç±»ä¿¡æ¯</h4>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><code>Search-Class</code> çš„ç®€å†™ï¼Œè¿™ä¸ªå‘½ä»¤èƒ½æœç´¢å‡ºæ‰€æœ‰å·²ç»åŠ è½½åˆ° JVM ä¸­çš„ Class ä¿¡æ¯</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># é€šé…ç¬¦åŒ¹é…ï¼Œæ‰“å°æœç´¢åˆ°çš„ç±»å…¨å</span></span><br><span class=\"line\">sc *.demo.*</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ‰“å°ç±»çš„è¯¦ç»†ä¿¡æ¯</span></span><br><span class=\"line\">sc -d com.example.demo.arthas.AdminFilterConfig</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ‰“å°å‡ºç±»çš„ Field ä¿¡æ¯</span></span><br><span class=\"line\">sc -d -f com.example.demo.arthas.AdminFilterConfig</span><br></pre></td></tr></table></figure>\n<h4 id=\"sm-æŸ¥çœ‹å·²åŠ è½½ç±»çš„æ–¹æ³•ä¿¡æ¯\">sm  : æŸ¥çœ‹å·²åŠ è½½ç±»çš„æ–¹æ³•ä¿¡æ¯</h4>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><code>Search-Method</code> çš„ç®€å†™ï¼Œè¿™ä¸ªå‘½ä»¤èƒ½æœç´¢å‡ºæ‰€æœ‰å·²ç»åŠ è½½åˆ° JVM ä¸­çš„ Method ä¿¡æ¯</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æ‰“å°æŒ‡å®šç±»ä¸­çš„æ–¹æ³•</span></span><br><span class=\"line\">sm java.lang.String</span><br><span class=\"line\"><span class=\"comment\"># å±•ç¤ºæ–¹æ³•çš„è¯¦ç»†ä¿¡æ¯</span></span><br><span class=\"line\">sm -d java.lang.String</span><br><span class=\"line\"><span class=\"comment\"># å±•ç¤ºæŒ‡å®šæ–¹æ³•çš„è¯¦ç»†ä¿¡æ¯</span></span><br><span class=\"line\">sm -d java.lang.String substring</span><br><span class=\"line\"><span class=\"comment\"># æ¨¡ç³ŠåŒ¹é…</span></span><br><span class=\"line\">sm -d java.lang.String eq*</span><br></pre></td></tr></table></figure>\n<h4 id=\"jad-Javaæºç åç¼–è¯‘å·¥å…·\">jad : Javaæºç åç¼–è¯‘å·¥å…·</h4>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>éªŒè¯ç”Ÿäº§ç¯å¢ƒä¸‹çš„ä»£ç æ˜¯å¦ä¸æäº¤çš„ä»£ç ä¸€è‡´</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æ‰“å°å‡ºç±»çš„æºç ï¼Œç±»å</span></span><br><span class=\"line\">jad com.example.demo.arthas.user.UserController</span><br><span class=\"line\"><span class=\"comment\">## è¾“å‡º</span></span><br><span class=\"line\">jad com.example.demo.arthas.user.UserController</span><br><span class=\"line\"></span><br><span class=\"line\">ClassLoader:</span><br><span class=\"line\">+-org.springframework.boot.loader.LaunchedURLClassLoader@5b2133b1</span><br><span class=\"line\">  +-sun.misc.Launcher<span class=\"variable\">$AppClassLoader</span>@5c647e05</span><br><span class=\"line\">    +-sun.misc.Launcher<span class=\"variable\">$ExtClassLoader</span>@452b3a41</span><br><span class=\"line\"></span><br><span class=\"line\">Location:</span><br><span class=\"line\">file:/Users/hanqf/Desktop/arhtas_dir/demo-arthas-spring-boot.jar!/BOOT-INF/classes!/</span><br><span class=\"line\"></span><br><span class=\"line\">       /*</span><br><span class=\"line\">        * Decompiled with CFR.</span><br><span class=\"line\">        *</span><br><span class=\"line\">        * Could not load the following classes:</span><br><span class=\"line\">        *  com.example.demo.arthas.user.User</span><br><span class=\"line\">        *  org.slf4j.Logger</span><br><span class=\"line\">        *  org.slf4j.LoggerFactory</span><br><span class=\"line\">        *  org.springframework.web.bind.annotation.GetMapping</span><br><span class=\"line\">        *  org.springframework.web.bind.annotation.PathVariable</span><br><span class=\"line\">        *  org.springframework.web.bind.annotation.RestController</span><br><span class=\"line\">        */</span><br><span class=\"line\">       package com.example.demo.arthas.user;</span><br><span class=\"line\"></span><br><span class=\"line\">       import com.example.demo.arthas.user.User;</span><br><span class=\"line\">       import org.slf4j.Logger;</span><br><span class=\"line\">       import org.slf4j.LoggerFactory;</span><br><span class=\"line\">       import org.springframework.web.bind.annotation.GetMapping;</span><br><span class=\"line\">       import org.springframework.web.bind.annotation.PathVariable;</span><br><span class=\"line\">       import org.springframework.web.bind.annotation.RestController;</span><br><span class=\"line\"></span><br><span class=\"line\">       @RestController</span><br><span class=\"line\">       public class UserController &#123;</span><br><span class=\"line\">           private static final Logger logger = LoggerFactory.getLogger(UserController.class);</span><br><span class=\"line\"></span><br><span class=\"line\">           @GetMapping(value=&#123;<span class=\"string\">&quot;/user/&#123;id&#125;&quot;</span>&#125;)</span><br><span class=\"line\">           public User findUserById(@PathVariable Integer <span class=\"built_in\">id</span>) &#123;</span><br><span class=\"line\">/*15*/         logger.info(<span class=\"string\">&quot;id: &#123;&#125;&quot;</span>, (Object)<span class=\"built_in\">id</span>);</span><br><span class=\"line\">/*17*/         <span class=\"keyword\">if</span> (<span class=\"built_in\">id</span> != null &amp;&amp; <span class=\"built_in\">id</span> &lt; 1) &#123;</span><br><span class=\"line\">                   throw new IllegalArgumentException(<span class=\"string\">&quot;id &lt; 1&quot;</span>);</span><br><span class=\"line\">               &#125;</span><br><span class=\"line\">               <span class=\"built_in\">return</span> new User(id.intValue(), <span class=\"string\">&quot;name&quot;</span> + <span class=\"built_in\">id</span>);</span><br><span class=\"line\">           &#125;</span><br><span class=\"line\">       &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">Affect(row-cnt:1) cost <span class=\"keyword\">in</span> 411 ms.</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åç¼–è¯‘åçš„æºç ä¼šæœ‰ç±»åŠ è½½å™¨çš„ä¿¡æ¯ï¼Œå¦‚æœåªå¸Œæœ›æ‰“å°æºç ï¼Œå¯ä»¥åŠ ä¸Š --source-only</span></span><br><span class=\"line\">jad --source-only com.example.demo.arthas.user.UserController</span><br><span class=\"line\"><span class=\"comment\"># ä¸æ˜¾ç¤ºè¡Œå·</span></span><br><span class=\"line\">jad --source-only com.example.demo.arthas.user.UserController --lineNumber <span class=\"literal\">false</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># è¾“å‡ºåˆ°æ–‡ä»¶</span></span><br><span class=\"line\">jad --source-only com.example.demo.arthas.user.UserController &gt; /tmp/UserController.java</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ‰“å°å‡ºç±»ä¸­æŸä¸ªæ–¹æ³•çš„æºç ï¼Œç±»å + æ–¹æ³•å</span></span><br><span class=\"line\">jad com.example.demo.arthas.user.UserController findUserById</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åç¼–è¯‘æ—¶æŒ‡å®šdump classæ–‡ä»¶ç›®å½•</span></span><br><span class=\"line\">jad --source-only com.example.demo.arthas.user.UserController --lineNumber <span class=\"literal\">false</span> -d /tmp/jad</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å½“æœ‰å¤šä¸ª ClassLoader éƒ½åŠ è½½äº†è¿™ä¸ªç±»æ—¶ï¼Œjad å‘½ä»¤ä¼šè¾“å‡ºå¯¹åº” ClassLoader å®ä¾‹çš„ hashcodeï¼Œç„¶åä½ åªéœ€è¦é‡æ–°æ‰§è¡Œ jad å‘½ä»¤ï¼Œå¹¶ä½¿ç”¨å‚æ•° -c <hashcode> å°±å¯ä»¥åç¼–è¯‘æŒ‡å®š ClassLoader åŠ è½½çš„é‚£ä¸ªç±»äº†ï¼›</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ jad org.apache.log4j.Logger</span><br><span class=\"line\"></span><br><span class=\"line\">Found more than one class <span class=\"keyword\">for</span>: org.apache.log4j.Logger, Please use jad -c hashcode org.apache.log4j.Logger</span><br><span class=\"line\">HASHCODE  CLASSLOADER</span><br><span class=\"line\">69dcaba4  +-monitor<span class=\"string\">&#x27;s ModuleClassLoader</span></span><br><span class=\"line\"><span class=\"string\">6e51ad67  +-java.net.URLClassLoader@6e51ad67</span></span><br><span class=\"line\"><span class=\"string\">            +-sun.misc.Launcher$AppClassLoader@6951a712</span></span><br><span class=\"line\"><span class=\"string\">            +-sun.misc.Launcher$ExtClassLoader@6fafc4c2</span></span><br><span class=\"line\"><span class=\"string\">2bdd9114  +-pandora-qos-service&#x27;</span>s ModuleClassLoader</span><br><span class=\"line\">4c0df5f8  +-pandora-framework<span class=\"string\">&#x27;s ModuleClassLoader</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">Affect(row-cnt:0) cost in 38 ms.</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\"># æŒ‡å®šç±»åŠ è½½å™¨</span></span><br><span class=\"line\"><span class=\"string\">$ jad org.apache.log4j.Logger -c 69dcaba4</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"mc-Memory-Compiler-å†…å­˜ç¼–è¯‘å™¨ï¼Œç¼–è¯‘-javaæ–‡ä»¶ç”Ÿæˆ-class\">mc : Memory Compiler/å†…å­˜ç¼–è¯‘å™¨ï¼Œç¼–è¯‘<code>.java</code>æ–‡ä»¶ç”Ÿæˆ<code>.class</code></h4>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ç¼–è¯‘ï¼Œè¿™é‡Œä¸€å®šè¦æŒ‡å®šç±»åŠ è½½å™¨ï¼Œå¦åˆ™ä¼šæŠ¥é”™ï¼Œå› ä¸ºä½ ç¼–è¯‘çš„ç±»ä¸­å¯èƒ½importå…¶å®ƒç±»ï¼Œä¸æŒ‡å®šå°±ä¼šæç¤ºæ‰¾ä¸åˆ°å¯¹åº”çš„ç±»ã€‚</span></span><br><span class=\"line\"><span class=\"comment\"># ç±»åŠ è½½å™¨å¯ä»¥é€šè¿‡ jad å‘½ä»¤è·å–</span></span><br><span class=\"line\">mc --classLoaderClass org.springframework.boot.loader.LaunchedURLClassLoader /tmp/UserController.java</span><br><span class=\"line\"><span class=\"comment\"># æŒ‡å®šç±»åŠ è½½å™¨çš„ç¼–å·</span></span><br><span class=\"line\">mc -c 5b2133b1 /tmp/UserController.java</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å°† UserController.class æ–‡ä»¶è¾“å‡ºåˆ°æŒ‡å®šç›®å½•ï¼Œ -d æŒ‡å®šè¾“å‡ºç›®å½•</span></span><br><span class=\"line\">mc --classLoaderClass org.springframework.boot.loader.LaunchedURLClassLoader /tmp/UserController.java -d /tmp</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>mc å‘½ä»¤æœ‰å¯èƒ½å¤±è´¥ã€‚å¦‚æœç¼–è¯‘å¤±è´¥å¯ä»¥åœ¨æœ¬åœ°ç¼–è¯‘å¥½.classæ–‡ä»¶ï¼Œå†ä¸Šä¼ åˆ°æœåŠ¡å™¨ã€‚</p>\n</li>\n</ul>\n<h4 id=\"retransform-é‡æ–°åŠ è½½ç±»-çƒ­ä¿®æ”¹ä»£ç \">retransform : é‡æ–°åŠ è½½ç±»(çƒ­ä¿®æ”¹ä»£ç )</h4>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">retransform /tmp/com/example/demo/arthas/user/UserController.class</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹ é€šè¿‡ retransform é‡æ–°åŠ è½½çš„ class</span></span><br><span class=\"line\">retransform -l</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åˆ é™¤é€šè¿‡ retransform é‡æ–°åŠ è½½çš„ classï¼Œé€šè¿‡ id åˆ é™¤</span></span><br><span class=\"line\">retransform -d 1</span><br><span class=\"line\"><span class=\"comment\"># åˆ é™¤æ‰€æœ‰</span></span><br><span class=\"line\">retransform --deleteAll</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åˆ é™¤åè¦é‡æ–°è§¦å‘ retransformï¼Œå¦åˆ™å†…å­˜ä¸­ä¾æ—§ä½¿ç”¨çš„æ˜¯åˆ é™¤å‰çš„ class</span></span><br><span class=\"line\">retransform --classPattern com.example.demo.arthas.user.UserController</span><br></pre></td></tr></table></figure>\n<h4 id=\"sysprop-æŸ¥çœ‹å½“å‰-JVM-çš„ç³»ç»Ÿå±æ€§\">sysprop : æŸ¥çœ‹å½“å‰ JVM çš„ç³»ç»Ÿå±æ€§</h4>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æ‰“å°ç³»ç»Ÿå±æ€§</span></span><br><span class=\"line\">sysprop</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŒ‡å®šå•ä¸ª keyï¼Œkeyæ”¯æŒè‡ªåŠ¨è¡¥å…¨</span></span><br><span class=\"line\">sysprop java.version</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># é€šè¿‡grepè¿‡æ»¤</span></span><br><span class=\"line\">sysprop | grep user</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># è®¾ç½® æˆ– ä¿®æ”¹ ç³»ç»Ÿå±æ€§</span></span><br><span class=\"line\">sysprop testKey testValue</span><br></pre></td></tr></table></figure>\n<h4 id=\"sysenv-æŸ¥çœ‹å½“å‰-JVM-çš„ç¯å¢ƒå˜é‡\">sysenv : æŸ¥çœ‹å½“å‰ JVM çš„ç¯å¢ƒå˜é‡</h4>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åˆ—å‡ºæ‰€æœ‰ç¯å¢ƒå˜é‡</span></span><br><span class=\"line\">sysenv</span><br><span class=\"line\"><span class=\"comment\"># æŒ‡å®šå•ä¸ª keyï¼Œkeyæ”¯æŒè‡ªåŠ¨è¡¥å…¨</span></span><br><span class=\"line\">sysenv PATH</span><br><span class=\"line\"><span class=\"comment\"># é€šè¿‡grepè¿‡æ»¤</span></span><br><span class=\"line\">sysenv | grep PATH</span><br></pre></td></tr></table></figure>\n<h4 id=\"jvm-æŸ¥çœ‹å½“å‰-JVM-çš„ä¿¡æ¯\">jvm : æŸ¥çœ‹å½“å‰ JVM çš„ä¿¡æ¯</h4>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">jvm</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><code>THREAD</code> ç›¸å…³</p>\n</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">COUNT: JVM å½“å‰æ´»è·ƒçš„çº¿ç¨‹æ•°</span><br><span class=\"line\">DAEMON-COUNT: JVM å½“å‰æ´»è·ƒçš„å®ˆæŠ¤çº¿ç¨‹æ•°</span><br><span class=\"line\">PEAK-COUNT: ä» JVM å¯åŠ¨å¼€å§‹æ›¾ç»æ´»ç€çš„æœ€å¤§çº¿ç¨‹æ•°</span><br><span class=\"line\">STARTED-COUNT: ä» JVM å¯åŠ¨å¼€å§‹æ€»å…±å¯åŠ¨è¿‡çš„çº¿ç¨‹æ¬¡æ•°</span><br><span class=\"line\">DEADLOCK-COUNT: JVM å½“å‰æ­»é”çš„çº¿ç¨‹æ•°</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><code>FILE-DESCRIPTOR</code> æ–‡ä»¶æè¿°ç¬¦ç›¸å…³</p>\n</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">MAX-FILE-DESCRIPTOR-COUNTï¼šJVM è¿›ç¨‹æœ€å¤§å¯ä»¥æ‰“å¼€çš„æ–‡ä»¶æè¿°ç¬¦æ•°</span><br><span class=\"line\">OPEN-FILE-DESCRIPTOR-COUNTï¼šJVM å½“å‰æ‰“å¼€çš„æ–‡ä»¶æè¿°ç¬¦æ•°</span><br></pre></td></tr></table></figure>\n<h4 id=\"watch-å‡½æ•°æ‰§è¡Œæ•°æ®è§‚æµ‹\">watch : å‡½æ•°æ‰§è¡Œæ•°æ®è§‚æµ‹</h4>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è®©ä½ èƒ½æ–¹ä¾¿çš„è§‚å¯Ÿåˆ°æŒ‡å®šå‡½æ•°çš„è°ƒç”¨æƒ…å†µã€‚èƒ½è§‚å¯Ÿåˆ°çš„èŒƒå›´ä¸ºï¼šè¿”å›å€¼ã€æŠ›å‡ºå¼‚å¸¸ã€å…¥å‚ï¼Œé€šè¿‡ç¼–å†™ OGNL è¡¨è¾¾å¼è¿›è¡Œå¯¹åº”å˜é‡çš„æŸ¥çœ‹ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># è§‚å¯ŸæŒ‡å®šç±»ä¸­æŸä¸ªæ–¹æ³•çš„è°ƒç”¨æƒ…å†µï¼ŒclassName +  methodName + è¿”å›å€¼è¡¨è¾¾å¼</span></span><br><span class=\"line\"><span class=\"comment\"># å¼€å¯åï¼Œå½“æ–¹æ³•è¢«è°ƒç”¨æ—¶ï¼Œä¼šæŒ‰ç…§æŒ‡å®šçš„ `è¿”å›å€¼è¡¨è¾¾å¼` è¾“å‡ºç»“æœï¼Œè¿”å›å€¼è¡¨è¾¾å¼ å¯ä»¥ä¸æŒ‡å®šï¼Œé»˜è®¤ä¸º &#123;params, target, returnObj&#125;</span></span><br><span class=\"line\">watch com.example.demo.arthas.user.UserController findUserById <span class=\"string\">&#x27;&#123;params, throwExp&#125;&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># è§‚å¯Ÿå…¨éƒ¨æ–¹æ³•ï¼Œé€šé…ç¬¦åŒ¹é…</span></span><br><span class=\"line\">watch com.example.demo.arthas.user.UserController <span class=\"string\">&#x27;*&#x27;</span> <span class=\"string\">&#x27;&#123;params, throwExp&#125;&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># é»˜è®¤è¾“å‡ºç»“æœæ²¡æœ‰å±•å¼€ï¼Œå¯ä»¥åŠ ä¸Š -x æŒ‡å®šè¾“å‡ºç»“æœçš„å±æ€§éå†æ·±åº¦ï¼Œé»˜è®¤ä¸º 1ï¼Œæœ€å¤§å€¼æ˜¯ 4</span></span><br><span class=\"line\">watch com.example.demo.arthas.user.UserController <span class=\"string\">&#x27;*&#x27;</span> <span class=\"string\">&#x27;&#123;params, throwExp&#125;&#x27;</span> -x 2</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ä»…å½“æŠ›å‡ºå¼‚å¸¸æ—¶æ‰æ‰“å°ï¼Œ-e åœ¨å‡½æ•°å¼‚å¸¸ä¹‹åè§‚å¯Ÿ</span></span><br><span class=\"line\">watch com.example.demo.arthas.user.UserController <span class=\"string\">&#x27;*&#x27;</span> <span class=\"string\">&#x27;&#123;params, throwExp&#125;&#x27;</span> -x 2 -e</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å‚æ•°æ¡ä»¶è¿‡æ»¤ï¼Œparams[0] &gt; 100 è¡¨ç¤ºæ–¹æ³•å…¥å‚ä¸­ç¬¬ä¸€ä¸ªå‚æ•°çš„å€¼å¤§äº 100 æ—¶æ‰è§¦å‘æ‰“å°</span></span><br><span class=\"line\">watch com.example.demo.arthas.user.UserController * returnObj <span class=\"string\">&#x27;params[0] &gt; 100&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŒ‰è¯·æ±‚è€—æ—¶è¿›è¡Œè¿‡æ»¤ï¼Œ#cost&gt;200 è¡¨ç¤ºè€—æ—¶å¤§äº200ms</span></span><br><span class=\"line\">watch com.example.demo.arthas.user.UserController * <span class=\"string\">&#x27;&#123;params, returnObj&#125;&#x27;</span> <span class=\"string\">&#x27;#cost&gt;200&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># é€€å‡ºwatch</span></span><br><span class=\"line\">q</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>watch å‘½ä»¤è¡¨è¾¾å¼æ”¯æŒå˜é‡è¯´æ˜è¡¨</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>åç§°</th>\n<th>ç±»å‹/è¯´æ˜</th>\n<th>ä½œç”¨/å«ä¹‰</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>loader</code></td>\n<td><code>ClassLoader</code></td>\n<td>æ–¹æ³•æ‰€åœ¨ç±»çš„ç±»åŠ è½½å™¨å¯¹è±¡</td>\n</tr>\n<tr>\n<td><code>clazz</code></td>\n<td><code>Class&lt;?&gt;</code></td>\n<td>æ–¹æ³•æ‰€å±çš„ç±»ï¼ˆ<code>Class</code> å¯¹è±¡ï¼‰</td>\n</tr>\n<tr>\n<td><code>method</code></td>\n<td><code>java.lang.reflect.Method</code></td>\n<td>è¢«è°ƒç”¨çš„æ–¹æ³•çš„åå°„å¯¹è±¡</td>\n</tr>\n<tr>\n<td><code>target</code></td>\n<td><code>Object</code></td>\n<td>æ–¹æ³•çš„è°ƒç”¨ç›®æ ‡å¯¹è±¡ï¼ˆå³ <code>this</code> å¯¹è±¡ï¼‰ï¼Œé™æ€æ–¹æ³•ä¸­ä¸º <code>null</code></td>\n</tr>\n<tr>\n<td><code>params</code></td>\n<td><code>Object[]</code></td>\n<td>æ–¹æ³•çš„å…¥å‚æ•°ç»„</td>\n</tr>\n<tr>\n<td><code>returnObj</code></td>\n<td><code>Object</code></td>\n<td>æ–¹æ³•çš„è¿”å›å€¼</td>\n</tr>\n<tr>\n<td><code>throwExp</code></td>\n<td><code>Throwable</code></td>\n<td>æ–¹æ³•æŠ›å‡ºçš„å¼‚å¸¸</td>\n</tr>\n<tr>\n<td><code>isBefore</code></td>\n<td><code>boolean</code></td>\n<td>å½“å‰æ‰§è¡Œä½ç½®æ˜¯å¦æ˜¯æ–¹æ³•è°ƒç”¨<strong>ä¹‹å‰</strong>ï¼ˆ<code>BEFORE</code> é˜¶æ®µï¼‰</td>\n</tr>\n<tr>\n<td><code>isThrow</code></td>\n<td><code>boolean</code></td>\n<td>å½“å‰æ–¹æ³•æ˜¯å¦ä»¥å¼‚å¸¸ç»“æŸï¼ˆ<code>THROWS</code> é˜¶æ®µï¼‰</td>\n</tr>\n<tr>\n<td><code>isReturn</code></td>\n<td><code>boolean</code></td>\n<td>å½“å‰æ–¹æ³•æ˜¯å¦æ­£å¸¸è¿”å›ï¼ˆ<code>RETURN</code> é˜¶æ®µï¼‰</td>\n</tr>\n</tbody>\n</table>\n<h4 id=\"jobs-æŸ¥çœ‹è¿è¡Œä¸­çš„ä»»åŠ¡\">jobs : æŸ¥çœ‹è¿è¡Œä¸­çš„ä»»åŠ¡</h4>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å¦‚ä¸‹å‘½ä»¤ä¼šè½¬åˆ°åå°è¿è¡Œ ï¼Œä¸linuxå‘½ä»¤ç±»ä¼¼ï¼Œå‘½ä»¤æœ€ååŠ ä¸Š `&amp;` å³å¯</span></span><br><span class=\"line\">watch com.example.demo.arthas.user.UserController * <span class=\"string\">&#x27;&#123;params, throwExp&#125;&#x27;</span> <span class=\"string\">&#x27;throwExp != null&#x27;</span> &gt;&gt; a.log &amp;</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹åå°ä»»åŠ¡</span></span><br><span class=\"line\"><span class=\"built_in\">jobs</span></span><br><span class=\"line\"><span class=\"comment\">## è¾“å‡º</span></span><br><span class=\"line\">[1]*</span><br><span class=\"line\">       Running           watch com.example.demo.arthas.user.UserController * <span class=\"string\">&#x27;&#123;params, throwExp&#125;&#x27;</span> <span class=\"string\">&#x27;throwExp != null&#x27;</span> &gt;&gt; a.log &amp;</span><br><span class=\"line\">       execution count : 0</span><br><span class=\"line\">       start time      : Thu May 15 15:10:04 CST 2025</span><br><span class=\"line\">       <span class=\"built_in\">timeout</span> <span class=\"built_in\">date</span>    : Fri May 16 15:10:04 CST 2025</span><br><span class=\"line\">       session         : ded56dfd-5683-4427-ac08-792f8fb75e5e (current)</span><br><span class=\"line\"><span class=\"comment\"># ç»“æŸä»»åŠ¡</span></span><br><span class=\"line\"><span class=\"built_in\">kill</span> 1 <span class=\"comment\"># 1ä¸ºåå°ä»»åŠ¡id</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å°†åå°ä»»åŠ¡è½¬åˆ°å‰å°</span></span><br><span class=\"line\"><span class=\"built_in\">fg</span> 1 <span class=\"comment\"># 1ä¸ºåå°ä»»åŠ¡id</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æš‚åœä»»åŠ¡ï¼Œä½†æ­¤æ—¶ä¼šå°†arthasè¿›ç¨‹éƒ½æŒ‚èµ·ï¼Œæ‰€ä»¥å¹¶ä¸å¥½ç”¨</span></span><br><span class=\"line\">ctrl+z</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å°†å‰å°ä»»åŠ¡è½¬åˆ°åå°ç»§ç»­æ‰§è¡Œ</span></span><br><span class=\"line\"><span class=\"built_in\">bg</span> 1 <span class=\"comment\"># 1ä¸ºå‰å°ä»»åŠ¡id</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"logger-æŸ¥çœ‹-logger-ä¿¡æ¯ï¼Œæ›´æ–°-logger-level\">logger : æŸ¥çœ‹ logger ä¿¡æ¯ï¼Œæ›´æ–° logger level</h4>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹ logger ä¿¡æ¯</span></span><br><span class=\"line\">logger</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹æŒ‡å®šåå­—çš„loggerä¿¡æ¯</span></span><br><span class=\"line\">logger -n ROOT</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹æ²¡æœ‰ appender çš„ logger çš„ä¿¡æ¯ï¼Œä¸åŠ è¿™ä¸ªå‚æ•°åªä¼šæ‰“å°æœ‰ appender çš„ logger çš„ä¿¡æ¯</span></span><br><span class=\"line\">logger --include-no-appender</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ›´æ–° logger levelï¼Œ-c classLoader çš„ hashcode</span></span><br><span class=\"line\">logger --name ROOT --level debug -c 5b2133b1</span><br><span class=\"line\">logger --name ROOT --level error --classLoaderClass org.springframework.boot.loader.LaunchedURLClassLoader</span><br></pre></td></tr></table></figure>\n<h4 id=\"classloader-æŸ¥çœ‹-classloader-çš„ç»§æ‰¿æ ‘ï¼Œurlsï¼Œç±»åŠ è½½ä¿¡æ¯\">classloader : æŸ¥çœ‹ classloader çš„ç»§æ‰¿æ ‘ï¼Œurlsï¼Œç±»åŠ è½½ä¿¡æ¯</h4>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹ classloader çš„ä¿¡æ¯ï¼ŒåŠ è½½classçš„æ•°é‡ï¼Œhashcodeï¼Œclassloader çš„ parent</span></span><br><span class=\"line\">classloader -l</span><br><span class=\"line\"><span class=\"comment\"># æ ‘å½¢å±•ç¤º</span></span><br><span class=\"line\">classloader -t</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥æ‰¾èµ„æºï¼Œæ¯”å¦‚æŸ¥æ‰¾æŒ‡å®šåç§°çš„æ–‡ä»¶</span></span><br><span class=\"line\">classloader -c 5b2133b1 -r application.properties</span><br></pre></td></tr></table></figure>","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç»JVMçš„å‘½ä»¤è¡Œå·¥å…· The JavaÂ® Virtual Machine Specification ç‰ˆæœ¬jdk1.8 JVM çš„å‚æ•°(ä¸‰ç±») æ ‡å‡†å‚æ•°: ä»¥-å¼€å¤´ï¼Œæ‰€æœ‰ HotSpot éƒ½â½€æŒã€‚ä¾‹å¦‚java -versionã€‚è¿™ç±»å‚æ•°å¯ä»¥ä½¿â½¤java -help æˆ–è€…java -?å…¨éƒ¨æ‰“å°å‡ºæ¥ â¾®æ ‡å‡†å‚æ•°: ä»¥-Xå¼€å¤´ï¼Œæ˜¯ç‰¹å®š HotSpotç‰ˆæœ¬â½€æŒçš„æŒ‡ä»¤ã€‚ä¾‹å¦‚java -Xms200M -Xmx200Mã€‚è¿™ç±»æŒ‡ä»¤å¯ä»¥â½¤java -X å…¨éƒ¨æ‰“å°å‡ºæ¥ã€‚ ä¸ç¨³å®šå‚æ•°: è¿™ä¹Ÿæ˜¯ JVMè°ƒä¼˜çš„å™©æ¢¦ã€‚ä»¥-XX å¼€å¤´ï¼Œè¿™äº›å‚æ•°æ˜¯è·Ÿç‰¹å®šHotSpotç‰ˆæœ¬å¯¹åº”çš„ï¼Œå¾ˆæœ‰å¯èƒ½æ¢ä¸ªç‰ˆæœ¬å°±æ²¡æœ‰äº†ã€‚è¯¦ç»†çš„â½‚æ¡£èµ„æ–™ä¹Ÿç‰¹åˆ«å°‘ã€‚JDK8 ä¸­çš„ä»¥ä¸‹â¼ä¸ªæŒ‡ä»¤å¯ä»¥å¸®åŠ©å¼€å‘è€…äº†è§£ JDK8 ä¸­çš„è¿™â¼€ç±»ä¸ç¨³å®šå‚æ•°ã€‚ 1234java -XX:+PrintFlagsInitial -version # æ‰€æœ‰å‚æ•°çš„é»˜è®¤å€¼java -XX:+PrintFlagsFinal -version # æ‰€æœ‰å‚æ•°æœ€ç»ˆâ½£æ•ˆçš„å€¼ã€‚java -XX:+UnlockExperimentalVMOptions -XX:+PrintFlagsFinal -version # æ‰€æœ‰å‚æ•°æœ€ç»ˆâ½£æ•ˆçš„å€¼ï¼ŒåŒ…å«å®éªŒæ€§å‚æ•°ã€‚java -XX:+PrintCommandLineFlags -version # å½“å‰å‘½ä»¤ç”Ÿæ•ˆçš„å€¼ï¼Œå¯ä»¥çœ‹åˆ°æ˜¯â½¤çš„å“ªç§GCã€‚ JDK1.8é»˜è®¤â½¤çš„ParallelGC è¿è¡Œ java -XX:+UnlockExperimentalVMOptions -XX:+PrintFlagsFinal -version è¿”å›å€¼è¯´æ˜ 1234567891011121314151617[Global flags] intx ActiveProcessorCount = -1 &#123;product&#125; uintx AdaptiveSizeDecrementScaleFactor = 4 &#123;product&#125; uintx AdaptiveSizeMajorGCDecayTimeScale = 10 &#123;product&#125; uintx AdaptiveSizePausePolicy = 0 &#123;product&#125; uintx AdaptiveSizePolicyCollectionCostMargin = 50 &#123;product&#125; uintx AdaptiveSizePolicyInitializingSteps = 20 &#123;product&#125; uintx AdaptiveSizePolicyOutputInterval = 0 &#123;product&#125; uintx AdaptiveSizePolicyWeight = 10 &#123;product&#125; uintx AdaptiveSizeThroughPutPolicy = 0 &#123;product&#125; uintx AdaptiveTimeWeight = 25 &#123;product&#125; bool AdjustConcurrency = false &#123;product&#125; bool AggressiveHeap = false &#123;product&#125; bool AggressiveOpts = false &#123;product&#125; intx AliasLevel = 3 &#123;C2 product&#125; â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦# æ ¼å¼ï¼šflagç±»å‹ï¼Œflagåç§°ï¼Œflagå€¼ï¼Œflagæ¥æºä¸ä½œç”¨åŸŸä¿®é¥°ç¬¦ flagç±»å‹: jdk8 æ ‡è¯†ç¬¦ å«ä¹‰ æè¿°è¯´æ˜ intx æœ‰ç¬¦å·æ•´æ•°ï¼ˆint extendedï¼‰ ç”¨äºè¡¨ç¤ºå¸¦ç¬¦å·æ•´æ•°å‹å‚æ•° uintx æ— ç¬¦å·æ•´æ•°ï¼ˆunsigned int extendedï¼‰ è¡¨ç¤ºéè´Ÿæ•´æ•°å‹å‚æ•° uint64_t æ— ç¬¦å· 64 ä½æ•´æ•° é€‚ç”¨äºéœ€è¦æ›´å¤§æ•´æ•°å€¼çš„å‚æ•°ï¼Œæ¯”å¦‚å†…å­˜å¤§å°ã€çº³ç§’æ—¶é—´æˆ³ç­‰ bool å¸ƒå°”å‹ true æˆ– falseï¼Œè¡¨ç¤ºå¼€å…³å‹å‚æ•° double åŒç²¾åº¦æµ®ç‚¹å‹ ç”¨äºè¡¨ç¤ºæµ®ç‚¹æ•°å€¼ç±»å‹çš„ JVM å‚æ•° ccstr å¸¸é‡ C å­—ç¬¦ä¸²æŒ‡é’ˆ è¡¨ç¤ºå­—ç¬¦ä¸²å‚æ•°ï¼ˆä¸å¯å˜ï¼‰ ccstrlist C å­—ç¬¦ä¸²åˆ—è¡¨ è¡¨ç¤ºä»¥é€—å·åˆ†éš”çš„å­—ç¬¦ä¸²åˆ—è¡¨ jdk11åå‡ºç°æ›´å¤šçš„ç±»å‹ æ ‡è¯†ç¬¦ å«ä¹‰ æè¿°è¯´æ˜ int æœ‰ç¬¦å·æ•´æ•°,é€šå¸¸æ˜¯ 32 ä½ JVM å†…éƒ¨ä½¿ç”¨çš„æ™®é€š int å‚æ•° uint æ— ç¬¦å·æ•´æ•°,é€šå¸¸æ˜¯ 32 ä½ å°‘é‡ç”¨äºç‰¹æ®Šåœºæ™¯çš„å‚æ•° size_t å†…å­˜å¤§å° è¡¨ç¤ºå†…å­˜å¤§å°å‚æ•°ï¼ˆå•ä½ä¸€èˆ¬ä¸ºå­—èŠ‚ï¼‰,jdk11åå‡ºç°ï¼ŒåŸæ¥æ˜¯ uintx flagæ¥æºä¸ä½œç”¨åŸŸä¿®é¥°ç¬¦ jdk8 æ ‡è®° å«ä¹‰ &#123;product&#125; æ­£å¼äº§å“å‚æ•°ï¼ˆç”¨æˆ·å¯ç”¨ï¼Œå¯é€šè¿‡ -XX: è¿›è¡Œè®¾ç½®ï¼‰ &#123;pd product&#125; å¹³å°ç›¸å…³çš„æ­£å¼å‚æ•°ï¼ˆplatform-dependentï¼‰ï¼Œåœ¨æŸäº›æ“ä½œç³»ç»Ÿ/CPU ä¸Šå¯ç”¨ &#123;C1 product&#125; ä»…åœ¨ä½¿ç”¨ C1 ç¼–è¯‘å™¨ï¼ˆä¼˜åŒ–ç¼–è¯‘å™¨ï¼‰ æ—¶æœ‰æ•ˆçš„å‚æ•° &#123;C2 product&#125; ä»…åœ¨ä½¿ç”¨ C2 ç¼–è¯‘å™¨ï¼ˆä¼˜åŒ–ç¼–è¯‘å™¨ï¼‰ æ—¶æœ‰æ•ˆçš„å‚æ•° &#123;manageable&#125; å¯é€šè¿‡ JMX åŠ¨æ€ç®¡ç†çš„å‚æ•°ï¼ˆè¿è¡Œæ—¶å¯è°ƒæ•´ï¼‰ &#123;ARCH product&#125; ä¸ CPU æ¶æ„ç›¸å…³çš„äº§å“å‚æ•°ï¼ˆå¦‚ x86ã€ARM ç­‰ï¼‰ &#123;lp64_product&#125; ä»…åœ¨ 64 ä½ JVM ä¸Šæ‰æœ‰æ•ˆçš„äº§å“å‚æ•° &#123;experimental&#125; å®éªŒæ€§çš„ å‚æ•°ï¼Œå¯èƒ½åœ¨å°†æ¥çš„ç‰ˆæœ¬ä¸­åˆ é™¤æˆ–æ›´æ”¹ã€‚éœ€è¦å¼€å¯ -XX:+UnlockExperimentalVMOptions jdk11åå‡ºç°æ›´å¤šçš„ç±»å‹ æ ‡è®° å«ä¹‰ &#123;C1 pd product&#125; å¹³å°ç›¸å…³çš„æ­£å¼å‚æ•°,ä»…åœ¨ä½¿ç”¨ C1 ç¼–è¯‘å™¨ï¼ˆä¼˜åŒ–ç¼–è¯‘å™¨ï¼‰ æ—¶æœ‰æ•ˆçš„å‚æ•° &#123;C2 pd product&#125; å¹³å°ç›¸å…³çš„æ­£å¼å‚æ•°,ä»…åœ¨ä½¿ç”¨ C2 ç¼–è¯‘å™¨ï¼ˆä¼˜åŒ–ç¼–è¯‘å™¨ï¼‰ æ—¶æœ‰æ•ˆçš„å‚æ•° &#123;JVMCI product&#125; æ­¤å‚æ•°é€‚ç”¨äº JVMCI æˆ– Graal ç¼–è¯‘å™¨ç›¸å…³åŠŸèƒ½ï¼Œjdk21æ·»åŠ  å¦å¤–ï¼Œjdk11+ ä¸­ï¼Œæœ€åè¿˜ä¼šå¤šå‡ºä¸€åˆ—ï¼Œå…¶ä½œç”¨æ˜¯è¯´æ˜è¯¥å‚æ•°çš„è®¾ç½®æ¥æº æ¥æºæ ‡è¯† å«ä¹‰è¯´æ˜ &#123;default&#125; ä½¿ç”¨çš„æ˜¯è¯¥å‚æ•°çš„é»˜è®¤å€¼ï¼ˆæ²¡æœ‰è¢«ç”¨æˆ·æˆ–ç³»ç»Ÿè®¾ç½®ï¼‰ &#123;command line&#125; ç”¨æˆ·é€šè¿‡å‘½ä»¤è¡Œæ˜¾å¼è®¾ç½®çš„å‚æ•°ï¼ˆå¦‚ -XX:+UseG1GCï¼‰ &#123;ergonomic&#125; JVM æ ¹æ®ç³»ç»Ÿç¯å¢ƒè‡ªåŠ¨é€‰æ‹©çš„å€¼ï¼ˆè‡ªé€‚åº”è®¾ç½®ï¼‰ jps: æŸ¥çœ‹å½“å‰jvmä¸­çš„è¿›ç¨‹ 12345678# æŸ¥çœ‹javaè¿›ç¨‹IDjps# æŸ¥çœ‹javaè¿›ç¨‹ä¿¡æ¯ï¼ŒåŒ…æ‹¬IDå’Œå¯åŠ¨ç±»æˆ–jarçš„åç§°jps -l# æŸ¥çœ‹å¯åŠ¨javaè¿›ç¨‹æ—¶ä¼ é€’ç»™jvmçš„å‚æ•°è®¾ç½®jps -v# æŸ¥çœ‹javaè¿›ç¨‹ä¿¡æ¯ï¼ŒåŒæ—¶æ˜¾ç¤ºå¯åŠ¨javaè¿›ç¨‹æ—¶ä¼ é€’ç»™jvmçš„å‚æ•°è®¾ç½®jps -lv jinfo: æŸ¥çœ‹JVMå‚æ•° jinfo æ˜¯ JDK è‡ªå¸¦çš„å‘½ä»¤è¡Œå·¥å…·ä¹‹ä¸€ï¼Œç”¨äº æŸ¥çœ‹å’Œä¿®æ”¹æ­£åœ¨è¿è¡Œä¸­çš„ Java è¿›ç¨‹çš„é…ç½®ä¿¡æ¯ï¼Œä¸»è¦åŒ…æ‹¬ JVM å‚æ•°ã€ç³»ç»Ÿå±æ€§ç­‰ä¿¡æ¯ã€‚ åœ¨ Java 9+ ä¹‹åè¢«æ ‡è®°ä¸º deprecatedï¼Œå»ºè®®æ”¹ç”¨ jcmd æ›¿ä»£ 12345678910111213141516171819# æŸ¥çœ‹æ­£åœ¨è¿è¡Œçš„ JVM å‚æ•°jinfo &lt;PID&gt;# jcmd å‘½ä»¤ï¼Œåˆ†æˆä¸‰ä¸ªjcmd &lt;pid&gt; VM.flags # VM Flagsjcmd &lt;pid&gt; VM.system_properties # System Propertiesjcmd &lt;pid&gt; VM.command_line # Command Line# æŸ¥çœ‹æŒ‡å®šè¿›ç¨‹çš„ç³»ç»Ÿå±æ€§ï¼ˆ-syspropsï¼‰jinfo -sysprops &lt;PID&gt;# jcmd å‘½ä»¤jcmd &lt;pid&gt; VM.system_properties# åŠ¨æ€ä¿®æ”¹ JVM å‚æ•°ï¼ˆä»…æ”¯æŒéƒ¨åˆ†å‚æ•°ï¼‰jinfo -flag [+|-]&lt;flagname&gt; &lt;pid&gt;## ä¾‹ï¼šæ‰“å¼€ GC æ—¥å¿—jinfo -flag +PrintGC &lt;pid&gt;# æ£€æŸ¥æ˜¯å¦å¼€å¯äº†æŸä¸ª JVM ç‰¹æ€§ï¼ˆå¦‚ UseG1GCï¼‰jinfo -flag UseG1GC &lt;pid&gt; jstat: æŸ¥çœ‹æŒ‡å®šJAVAè¿›ç¨‹çš„è¿è¡ŒçŠ¶æ€ 123456789# æŸ¥çœ‹è¿è¡ŒçŠ¶æ€jstat -gc &lt;PID&gt;# æŸ¥çœ‹è¿è¡ŒçŠ¶æ€ï¼Œæ¯éš”5000æ¯«ç§’è¾“å‡ºä¸€æ¬¡ï¼Œå…±è¾“å‡º20æ¬¡jstat -gc &lt;PID&gt; 5000 20# è¾“å‡º S0C S1C S0U S1U EC EU OC OU MC MU CCSC CCSU YGC YGCT FGC FGCT GCT512.0 512.0 0.0 224.0 29696.0 27138.2 105984.0 96531.8 122368.0 114450.4 15360.0 14018.9 733 5.099 4 0.833 5.931512.0 512.0 0.0 224.0 29696.0 27203.9 105984.0 96531.8 122368.0 114450.4 15360.0 14018.9 733 5.099 4 0.833 5.931512.0 512.0 0.0 224.0 29696.0 27220.4 105984.0 96531.8 122368.0 114450.4 15360.0 14018.9 733 5.099 4 0.833 5.931 å†…å­˜åŒºç»Ÿè®¡ï¼ˆå•ä½ï¼šKBï¼‰ åˆ—å å«ä¹‰è¯´æ˜ S0C Survivor 0 åŒºçš„å®¹é‡ï¼ˆKBï¼‰ S1C Survivor 1 åŒºçš„å®¹é‡ï¼ˆKBï¼‰ S0U Survivor 0 åŒºå·²ä½¿ç”¨å†…å­˜ï¼ˆKBï¼‰ S1U Survivor 1 åŒºå·²ä½¿ç”¨å†…å­˜ï¼ˆKBï¼‰ EC Eden åŒºçš„å®¹é‡ï¼ˆKBï¼‰ EU Eden åŒºå·²ä½¿ç”¨å†…å­˜ï¼ˆKBï¼‰ OC Old Generationï¼ˆè€å¹´ä»£ï¼‰çš„å®¹é‡ï¼ˆKBï¼‰ OU Old Generation å·²ä½¿ç”¨å†…å­˜ï¼ˆKBï¼‰ MC Metaspaceï¼ˆå…ƒç©ºé—´ï¼‰çš„å®¹é‡ï¼ˆKBï¼‰ MU Metaspace å·²ä½¿ç”¨å†…å­˜ï¼ˆKBï¼‰ CCSC Compressed Class Space çš„å®¹é‡ï¼ˆKBï¼‰ CCSU Compressed Class Space å·²ä½¿ç”¨å†…å­˜ï¼ˆKBï¼‰ GC æ¬¡æ•°ä¸è€—æ—¶(ä»åº”ç”¨ç¨‹åºå¯åŠ¨åˆ°é‡‡æ ·æ—¶) åˆ—å å«ä¹‰è¯´æ˜ YGC Young GCï¼ˆMinor GCï¼‰ çš„ç´¯è®¡æ¬¡æ•° YGCT Young GC ç´¯è®¡è€—æ—¶ï¼ˆå•ä½ï¼šç§’ï¼‰ FGC Full GC çš„ç´¯è®¡æ¬¡æ•° FGCT Full GC ç´¯è®¡è€—æ—¶ï¼ˆå•ä½ï¼šç§’ï¼‰ GCT GC æ€»è€—æ—¶ï¼ˆYGCT + FGCTï¼Œæ€»å’Œï¼‰ jstack: æŸ¥çœ‹æŒ‡å®šJAVAè¿›ç¨‹ä¸­å„çº¿ç¨‹çš„è°ƒç”¨å †æ ˆ 123456789101112131415161718# æ‰“å°çº¿ç¨‹çš„æ ‡å‡†æ ˆä¿¡æ¯ï¼ˆæ ˆå¸§ + çº¿ç¨‹çŠ¶æ€ï¼‰jstack &lt;PID&gt;# åœ¨æ ‡å‡†è¾“å‡ºåŸºç¡€ä¸Šï¼Œé¢å¤–æ‰“å°çº¿ç¨‹æ‹¥æœ‰çš„é”ï¼ˆmonitorï¼‰å’Œ waited on é”å¯¹è±¡ä¿¡æ¯jstack -l &lt;PID&gt;# è¾“å‡ºåˆ°æ–‡ä»¶jstack -l &lt;PID&gt; &gt; jstack.tdump # è¿™ä¸ªæ–‡ä»¶ååç¼€åªæ˜¯ä¸ºäº†æ–¹ä¾¿ jvisualvm æŸ¥çœ‹# è¾“å‡º&quot;idle-connection-reaper&quot; #68 daemon prio=5 os_prio=0 tid=0x00007f38b6ae2800 nid=0x62e9 waiting on condition [0x00007f385b0f5000] java.lang.Thread.State: TIMED_WAITING (sleeping) at java.lang.Thread.sleep(Native Method) at software.amazon.awssdk.http.apache.internal.conn.IdleConnectionReaper$ReaperTask.run(IdleConnectionReaper.java:151) at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) at java.lang.Thread.run(Thread.java:750) Locked ownable synchronizers: - &lt;0x00000000c561cfd8&gt; (a java.util.concurrent.ThreadPoolExecutor$Worker) jstackè¾“å‡ºå†…å®¹å«ä¹‰ å­—æ®µ å«ä¹‰ &quot;idle-connection-reaper&quot; çº¿ç¨‹åç§°ã€‚è¿™ä¸ªçº¿ç¨‹æ˜¯ AWS SDK ä¸­ç”¨äºæ¸…ç†ç©ºé—²è¿æ¥çš„åå°çº¿ç¨‹ã€‚ #68 çº¿ç¨‹ IDï¼ˆJava å±‚åˆ†é…çš„ç¼–å·ï¼‰ã€‚ daemon è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ª å®ˆæŠ¤çº¿ç¨‹ã€‚JVM é€€å‡ºæ—¶ä¸ä¼šç­‰å¾…å®ˆæŠ¤çº¿ç¨‹è¿è¡Œç»“æŸã€‚ prio=5 Java å±‚çš„çº¿ç¨‹ä¼˜å…ˆçº§ï¼ˆé»˜è®¤ 1â€“10ï¼Œ5 æ˜¯é»˜è®¤ï¼‰ã€‚ os_prio=0 æ“ä½œç³»ç»Ÿå±‚çº¿ç¨‹ä¼˜å…ˆçº§ï¼ˆå–å†³äºæ“ä½œç³»ç»Ÿå’Œ JVM çš„å®ç°ï¼‰ã€‚ tid=0x00007f38b6ae2800 çº¿ç¨‹ IDï¼ˆJava å±‚ä½¿ç”¨çš„åœ°å€æ ‡è¯†ï¼‰ã€‚ nid=0x62e9 Native IDï¼Œæ“ä½œç³»ç»Ÿåˆ†é…çš„çº¿ç¨‹ IDï¼ˆåå…­è¿›åˆ¶è¡¨ç¤ºï¼‰ï¼Œå¯ä»¥é€šè¿‡å‘½ä»¤printf &quot;%d\\n&quot; 0x62e9è½¬æ¢ä¸º10è¿›åˆ¶ã€‚ ps -Lp &lt;PID&gt; å’Œ top -Hp &lt;PID&gt; å±•ç¤ºçš„çº¿ç¨‹idæ˜¯10è¿›åˆ¶ waiting on condition çº¿ç¨‹çŠ¶æ€è¯´æ˜ï¼šæ­£åœ¨ç­‰å¾…æŸç§æ¡ä»¶ï¼Œä¸€èˆ¬æŒ‡ sleep() æˆ– wait() ç­‰ã€‚ [0x00007f385b0f5000] æ ˆå¸§çš„å†…å­˜åœ°å€ã€‚ java.lang.Thread.State: TIMED_WAITING (sleeping) çº¿ç¨‹çŠ¶æ€ã€‚ at java.lang.Thread.sleep(Native Method) â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦ çº¿ç¨‹è°ƒç”¨æ ˆä¿¡æ¯ï¼ŒåŒ…æ‹¬è°ƒç”¨æ–¹æ³•ã€è°ƒç”¨å‚æ•°ã€è°ƒç”¨æ ˆå¸§ã€‚ å¦å¤–è¿˜æœ‰å¦‚ä¸‹ä¿¡æ¯ï¼Œè¡¨ç¤ºæ­¤çº¿ç¨‹æŒæœ‰çš„å¯æ‹¥æœ‰åŒæ­¥å™¨ï¼ˆä¾‹å¦‚ ReentrantLockï¼‰ï¼Œå…·ä½“å†…å®¹å¦‚ä¸‹ï¼š 12Locked ownable synchronizers: - &lt;0x00000000c561cfd8&gt; (a java.util.concurrent.ThreadPoolExecutor$Worker) å†…å®¹ å«ä¹‰ &lt;0x00000000c561cfd8&gt; æŒæœ‰é”çš„å¯¹è±¡åœ°å€ã€‚å¯ä»¥åœ¨å…¶ä»–çº¿ç¨‹ä¸­æŸ¥æ‰¾è¿™ä¸ªåœ°å€ï¼Œä»¥åˆ¤æ–­æ­»é”ç­‰é—®é¢˜ã€‚ (a ThreadPoolExecutor$Worker) è¡¨ç¤ºè¯¥é”å±äº ThreadPoolExecutor çš„æŸä¸ª Worker çº¿ç¨‹ï¼ˆè¿™æ˜¯çº¿ç¨‹æ± çš„å·¥ä½œçº¿ç¨‹ï¼‰ã€‚ çº¿ç¨‹çŠ¶æ€ çŠ¶æ€ å«ä¹‰ å¸¸è§åŸå›  / ç¤ºä¾‹æ–¹æ³• ç¤ºä¾‹ jstack è¾“å‡º RUNNABLE çº¿ç¨‹æ­£åœ¨è¿è¡Œæˆ–å‡†å¤‡è¿è¡Œï¼Œç­‰å¾… CPU æ—¶é—´ç‰‡ã€‚ çº¿ç¨‹æ´»è·ƒè¿è¡Œä¸­ &quot;Thread-0&quot; #1 prio=5 os_prio=0 tid=0x00007f8d9c001000 nid=0x1a runnable [0x00007f8dbf7fe000] BLOCKED (on object monitor) ç­‰å¾…è·å–å¯¹è±¡çš„ç›‘è§†å™¨é”ï¼ˆåŒæ­¥é”ï¼‰ï¼Œå³ç­‰å¾…è¿›å…¥åŒæ­¥å—æˆ–æ–¹æ³•ã€‚ synchronized åŒæ­¥å—æˆ–æ–¹æ³• &quot;Thread-1&quot; #2 prio=5 os_prio=0 tid=0x00007f8d9c002000 nid=0x1b waiting for monitor entry [0x00007f8dbeaff000] WAITING (on object monitor) æ— é™æœŸç­‰å¾…å…¶ä»–çº¿ç¨‹æ‰§è¡ŒæŸæ“ä½œã€‚ Object.wait()Thread.join()LockSupport.park()Condition.await() &quot;Thread-2&quot; #3 prio=5 os_prio=0 tid=0x00007f8d9c003000 nid=0x1c waiting on condition [0x00007f8dbebff000] TIMED_WAITING (on object monitor) ç­‰å¾…å›ºå®šæ—¶é—´ï¼Œç›´åˆ°æ¡ä»¶æ»¡è¶³æˆ–è¶…æ—¶ã€‚ Object.wait(long)Thread.sleep(long)Condition.awaitNanos(long)DelayQueue.take() &quot;Thread-3&quot; #4 prio=5 os_prio=0 tid=0x00007f8d9c004000 nid=0x1d timed_waiting [0x00007f8dbebff000] TERMINATED çº¿ç¨‹å·²è¿è¡Œå®Œæ¯•å¹¶é€€å‡ºï¼ˆé€šå¸¸ä¸åœ¨ jstack ä¸­æ˜¾ç¤ºï¼‰ã€‚ - - ä½¿ç”¨jstackæ£€æŸ¥æ­»é” æ­»é”æ˜¯æŒ‡å¤šä¸ªçº¿ç¨‹äº’ç›¸ç­‰å¾…å¯¹æ–¹é‡Šæ”¾é”ï¼Œå¯¼è‡´æ— æ³•ç»§ç»­è¿è¡Œçš„æƒ…å†µã€‚ ç›´æ¥æŸ¥æ‰¾ Found one Java-level deadlock æç¤º 12345678Found one Java-level deadlock:=============================&quot;Thread-1&quot;: waiting to lock monitor 0x0000000005c0a098 (object 0x00000000d5c10a70, a java.lang.Object), which is held by &quot;Thread-2&quot;&quot;Thread-2&quot;: waiting to lock monitor 0x0000000005c0a128 (object 0x00000000d5c10aa0, a java.lang.Object), which is held by &quot;Thread-1&quot; è¡¨ç¤ºä¸¤ä¸ªçº¿ç¨‹äº’ç›¸ç­‰å¾…å¯¹æ–¹é‡Šæ”¾é”ï¼Œé€ æˆæ­»é”ã€‚ ç›®å‰åªæ”¯æŒæ‰¾å‡º synchronized å…³é”®å­—é˜»å¡ä½çš„çº¿ç¨‹ï¼Œå¦‚æœæ˜¯ java.util.concurrent.Lock ç›®å‰è¿˜ä¸æ”¯æŒã€‚ æ‰‹åŠ¨åˆ¤æ–­æ­»é”çš„ç‰¹å¾ï¼ˆå¦‚æœæ²¡æœ‰ä¸Šé¢çš„æç¤ºï¼‰ å¦‚æœ JVM æ²¡æœ‰æ˜¾å¼æç¤ºï¼Œä½ å¯ä»¥é€šè¿‡ä»¥ä¸‹æ­»é”ç‰¹å¾è¿›è¡Œæ‰‹åŠ¨è¯†åˆ«ï¼š ç‰¹å¾ æè¿° çº¿ç¨‹å¤„äº BLOCKED çŠ¶æ€ çº¿ç¨‹è¢«é”é˜»å¡åœ¨ monitor ä¸Šã€‚ waiting to lock å’Œ locked å‡ºç°äº¤å‰ ä¸€ä¸ªçº¿ç¨‹æ­£åœ¨ç­‰å¾…å¦ä¸€ä¸ªçº¿ç¨‹æŒæœ‰çš„é”ï¼Œè€Œå¦ä¸€ä¸ªçº¿ç¨‹ä¹Ÿåœ¨ç­‰å¾…å½“å‰çº¿ç¨‹çš„é”ã€‚ æ²¡æœ‰èƒ½ç»§ç»­æ‰§è¡Œçš„çº¿ç¨‹ å¤šä¸ªçº¿ç¨‹éƒ½å¤„äº BLOCKED çŠ¶æ€ï¼Œä¸”ç›¸äº’ä¾èµ–ã€‚ åœ¨ Java 8 ä¹‹åæ”¯æŒè·å– JVM å†…éƒ¨çº¿ç¨‹ VM å†…éƒ¨çº¿ç¨‹åŒ…æ‹¬ä¸‹é¢å‡ ç§ï¼š çº¿ç¨‹ç±»å‹ ç¤ºä¾‹åç§° JITï¼ˆJust-In-Timeï¼‰ç¼–è¯‘çº¿ç¨‹ C1 CompilerThread0, C2 CompilerThread0 GC çº¿ç¨‹ GC Thread0, G1 Young RemSet Sampling å…¶å®ƒå†…éƒ¨çº¿ç¨‹ VM Periodic Task Thread, VM Thread, Service Thread è‡ª JDK 7 åŠä»¥ä¸Šç‰ˆæœ¬å¼€å§‹ï¼ŒHotSpot JVM é»˜è®¤å¯ç”¨äº†ï¼šåˆ†å±‚ç¼–è¯‘ï¼ˆTiered Compilationï¼‰ï¼Œå³åŒæ—¶ä½¿ç”¨ C1 å’Œ C2 ç¼–è¯‘å™¨ã€‚ ç¼–è¯‘å™¨ ç‰¹æ€§ ç”¨é€” C1ï¼ˆClient Compilerï¼‰ ç¼–è¯‘é€Ÿåº¦å¿«ï¼Œä¼˜åŒ–å°‘ ç¨‹åºå¯åŠ¨æ—¶ä½¿ç”¨ï¼Œæå‡å¯åŠ¨é€Ÿåº¦ C2ï¼ˆServer Compilerï¼‰ ç¼–è¯‘é€Ÿåº¦æ…¢ï¼Œä¼˜åŒ–å¼º çƒ­ç‚¹ä»£ç è¾¾åˆ°ä¸€å®šé—¨æ§›åä½¿ç”¨ï¼Œæå‡é•¿æœŸè¿è¡Œæ€§èƒ½ JVM å¯åŠ¨åï¼Œå…ˆè§£é‡Šæ‰§è¡Œå­—èŠ‚ç ï¼›çƒ­ç‚¹ä»£ç é¦–å…ˆç”± C1 ç¼–è¯‘å™¨å¤„ç†ï¼›å¦‚æœè¿›ä¸€æ­¥å˜çƒ­ï¼Œäº¤ç”± C2 ç¼–è¯‘å™¨ä¼˜åŒ–ï¼›æ•´ä¸ªè¿‡ç¨‹ç”± JVM è‡ªåŠ¨ç®¡ç†ï¼Œä¸éœ€è¦æ‰‹åŠ¨å¹²é¢„ã€‚ æ˜¯å¦å¯ä»¥æŒ‡å®šåªç”¨æŸä¸ªç¼–è¯‘å™¨ï¼Ÿæ˜¯çš„ï¼Œä½ å¯ä»¥ç”¨ JVM å‚æ•°æ§åˆ¶ï¼Œä½†çœŸæ²¡å¿…è¦ã€‚ å‚æ•° å«ä¹‰ -client ä½¿ç”¨ C1 ç¼–è¯‘å™¨ï¼ˆé€‚åˆå¯åŠ¨å¿«ï¼‰ -server ä½¿ç”¨ C2 ç¼–è¯‘å™¨ï¼ˆé€‚åˆé•¿æ—¶é—´è¿è¡Œçš„æœåŠ¡ï¼‰ -XX:-TieredCompilation ç¦ç”¨åˆ†å±‚ç¼–è¯‘ï¼Œä»…ä½¿ç”¨ -client æˆ– -server æŒ‡å®šçš„ç¼–è¯‘å™¨ jmap: åˆ†æè¿è¡Œä¸­ Java è¿›ç¨‹çš„å†…å­˜ä½¿ç”¨æƒ…å†µ jmap æ¯”è¾ƒæ¶ˆè€—å†…å­˜ï¼Œæ‰€ä»¥ä¸æ¨èç”Ÿäº§ç¯å¢ƒä½¿ç”¨ã€‚ jmap -histo &lt;pid&gt;: æŸ¥çœ‹ç±»å®ä¾‹æ•°é‡åŠå ç”¨å†…å­˜ 12345678910111213141516171819$ jmap -histo 2523825238: num #instances #bytes class name---------------------------------------------- 1: 106175 10838440 [C 2: 94344 3019008 java.util.concurrent.ConcurrentHashMap$Node 3: 105529 2532696 java.lang.String 4: 11203 2496608 [B 5: 20178 2430136 [Ljava.lang.Object; 6: 21642 2399904 java.lang.Classâ€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦Total 857252 51328200# num: åºå·# instances: å®ä¾‹æ•°é‡# bytes: å®ä¾‹å­—èŠ‚æ•°# class name: ç±»å, [C is a char[]ï¼Œ[S is a short[]ï¼Œ[I is a int[]ï¼Œ[B is a byte[]ï¼Œ[L is a List# Total: æ€»æ•° jmap -heap &lt;pid&gt;: æŸ¥çœ‹å †ä½¿ç”¨æƒ…å†µ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647$ jmap -heap 25238Attaching to process ID 25238, please wait...Debugger attached successfully.Server compiler detected.JVM version is 25.371-b11using thread-local object allocation.Parallel GC with 2 thread(s)Heap Configuration: # å †é…ç½® MinHeapFreeRatio = 0 # æœ€å°ç©ºé—²ç™¾åˆ†æ¯” MaxHeapFreeRatio = 100 # æœ€å¤§ç©ºé—²ç™¾åˆ†æ¯” MaxHeapSize = 1010827264 (964.0MB) # æœ€å¤§å †å¤§å° NewSize = 21495808 (20.5MB) # æ–°ç”Ÿä»£å¤§å° MaxNewSize = 336592896 (321.0MB) # æ–°ç”Ÿä»£æœ€å¤§å¤§å° OldSize = 43515904 (41.5MB) # è€å¹´ä»£å¤§å° NewRatio = 2 # æ–°ç”Ÿä»£ä¸è€å¹´ä»£æ¯”ä¾‹ SurvivorRatio = 8 # å¹¸å­˜è€…æ¯”ä¾‹ MetaspaceSize = 21807104 (20.796875MB) # å…ƒç©ºé—´å¤§å° CompressedClassSpaceSize = 1073741824 (1024.0MB) # å‹ç¼©ç±»ç©ºé—´å¤§å°ï¼Œç”¨äºå­˜å‚¨æ‰€æœ‰ ç±»æŒ‡é’ˆï¼ˆKlass pointerï¼‰ MaxMetaspaceSize = 17592186044415 MB # å…ƒç©ºé—´æœ€å¤§å¤§å° G1HeapRegionSize = 0 (0.0MB) # G1å †å¤§å°Heap Usage: # å †ä½¿ç”¨æƒ…å†µPS Young Generation # å¹´è½»ç”Ÿä»£Eden Space: # Eden åŒº capacity = 30932992 (29.5MB) # Eden åŒºå¤§å° used = 16705104 (15.931228637695312MB) # Eden åŒºä½¿ç”¨æƒ…å†µ free = 14227888 (13.568771362304688MB) # Eden åŒºå‰©ä½™æƒ…å†µ 54.00416487354343% used # Eden åŒºä½¿ç”¨ç™¾åˆ†æ¯”From Space: # å¹¸å­˜è€…åŒº survivor0 capacity = 524288 (0.5MB) used = 0 (0.0MB) free = 524288 (0.5MB) 0.0% usedTo Space: # å¹¸å­˜è€…åŒº survivor1 capacity = 524288 (0.5MB) used = 0 (0.0MB) free = 524288 (0.5MB) 0.0% usedPS Old Generation # è€å¹´ä»£ capacity = 193462272 (184.5MB) used = 43292112 (41.28657531738281MB) free = 150170160 (143.2134246826172MB) 22.377547597497458% used38722 interned Strings occupying 4184168 bytes. # å †ä¸­å­—ç¬¦ä¸²æ•°é‡åŠå ç”¨å†…å­˜ jmap -dump:live,format=b,file=&lt;file&gt; &lt;pid&gt;: åˆ›å»ºä¸€ä¸ªå¿«ç…§ï¼Œå¹¶ä¿å­˜åˆ°æ–‡ä»¶ä¸­ 1234# åˆ›å»ºä¸€ä¸ªå¿«ç…§ï¼Œå¹¶ä¿å­˜åˆ°å½“å‰ç›®å½•ä¸‹$ jmap -dump:live,format=b,file=test.hprof 25238Dumping heap to /tmp/test.hprof ...Heap dump file created jcmd: å¯ä»¥æ›¿ä»£jmapå‘½ä»¤ï¼Œjdk1.8+æ¨èä½¿ç”¨ jcmd æ˜¯ JDK çš„ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼Œç”¨äºç®¡ç† JVMï¼Œjcmd å¯ä»¥æŸ¥çœ‹ JVM çš„è¿è¡ŒçŠ¶æ€ã€æŸ¥çœ‹å †å†…å­˜ä¿¡æ¯ã€è§¦å‘ GCã€æŸ¥çœ‹çº¿ç¨‹ä¿¡æ¯ã€æŸ¥çœ‹ç±»ä¿¡æ¯ç­‰ç­‰ã€‚ ç”Ÿäº§ç¯å¢ƒä¸å»ºè®®ä½¿ç”¨jmapï¼Œå› å…¶ä¼šå ç”¨å¤§é‡å†…å­˜ï¼Œæ¨èä½¿ç”¨ jcmdã€‚ jcmd &lt;pid&gt; GC.heap_info: æŸ¥çœ‹å †ä½¿ç”¨æƒ…å†µ ç±»ä¼¼ jmap -heap &lt;pid&gt; 12345678910$ jcmd 25238 GC.heap_info25238: PSYoungGen total 30208K, used 23593K [0x00000000ebf00000, 0x00000000edd80000, 0x0000000100000000) eden space 29696K, 78% used [0x00000000ebf00000,0x00000000ed5d2560,0x00000000edc00000) from space 512K, 43% used [0x00000000edd00000,0x00000000edd38000,0x00000000edd80000) to space 512K, 0% used [0x00000000edc80000,0x00000000edc80000,0x00000000edd00000) ParOldGen total 105984K, used 96547K [0x00000000c3c00000, 0x00000000ca380000, 0x00000000ebf00000) object space 105984K, 91% used [0x00000000c3c00000,0x00000000c9a48f10,0x00000000ca380000) Metaspace used 114450K, capacity 122262K, committed 122368K, reserved 1157120K class space used 14018K, capacity 15294K, committed 15360K, reserved 1048576K jcmd &lt;pid&gt; GC.class_histogram: æŸ¥çœ‹ç±»åŠ è½½æƒ…å†µ ç±»ä¼¼ jmap -histo &lt;pid&gt; 12345678910111213141516171819$ jcmd 25238 GC.class_histogram25238: num #instances #bytes class name---------------------------------------------- 1: 106175 10838440 [C 2: 94344 3019008 java.util.concurrent.ConcurrentHashMap$Node 3: 105529 2532696 java.lang.String 4: 11203 2496608 [B 5: 20178 2430136 [Ljava.lang.Object; 6: 21642 2399904 java.lang.Classâ€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦Total 857252 51328200# num: åºå·# instances: å®ä¾‹æ•°é‡# bytes: å®ä¾‹å­—èŠ‚æ•°# class name: ç±»å, [C is a char[]ï¼Œ[S is a short[]ï¼Œ[I is a int[]ï¼Œ[B is a byte[]ï¼Œ[L is a List# Total: æ€»æ•° jcmd &lt;pid&gt; GC.heap_dump /path/to/heap.hprof: å¯¼å‡º heap dump æ›¿ä»£ jmap -dump:format=b,file=heap.hprof &lt;pid&gt;ï¼Œä½†ä»ä¼šæœ‰åœé¡¿ï¼ˆè§¦å‘FullGCï¼‰ï¼Œdump è¿‡ç¨‹æ…¢ï¼Œç”Ÿäº§ç¯å¢ƒæ…é‡ä½¿ç”¨ 1234567$ jcmd 25238 GC.heap_dump ./heap.hprof25238:Heap dump file created# æ³¨æ„è¿™é‡Œä½¿ç”¨çš„æ˜¯ç›¸å¯¹ç›®å½•ï¼Œ./heap.hprofï¼Œä½†æ­¤æ—¶ &quot;./&quot; å¹¶ä¸æ˜¯è¿è¡Œå‘½ä»¤æ—¶æ‰€åœ¨çš„ç›®å½•ï¼Œè€Œæ˜¯æŒ‡ Java è¿›ç¨‹çš„å·¥ä½œç›®å½•ï¼Œå¦‚æœä½ ä¸çŸ¥é“å·¥ä½œç›®å½•ï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹jcmd &lt;pid&gt; VM.system_properties | grep &quot;user.dir&quot;# linuxä¸‹ä¹Ÿå¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹ls -l /proc/&lt;pid&gt;/cwd å› ä¸ºç”Ÿäº§ç¯å¢ƒä¸æ¨èä½¿ç”¨ jmap æˆ– jcmd å¯¼å‡º heap dumpï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦åœ¨ç”Ÿäº§ç¯å¢ƒä¸­é…ç½®å¦‚ä¸‹jvmå‚æ•° 12-XX:+HeadDumpOnOutOfMemoryError # å†…å­˜æº¢å‡ºï¼ˆOOMï¼‰æ—¶ä¼šè‡ªåŠ¨ä¿å­˜å †å†…å­˜å¿«ç…§æ–‡ä»¶-XX:HeapDumpPath=/path/to/dump.hprof # æŒ‡å®šå †å†…å­˜å¿«ç…§æ–‡ä»¶ä¿å­˜è·¯å¾„ï¼Œå¦‚æœä¸é…ç½®ï¼Œåˆ™é»˜è®¤ä¿å­˜åœ¨ Java è¿›ç¨‹çš„å·¥ä½œç›®å½•ä¸‹ï¼Œæ–‡ä»¶åç§°é»˜è®¤ä¸º java_&lt;pid&gt;.hprof jhat: åˆ†æ Java Heap Dump æ–‡ä»¶ï¼ˆ.hprofï¼‰çš„å·¥å…· jhatï¼ˆJava Heap Analysis Toolï¼‰æ˜¯ JDK é™„å¸¦çš„ä¸€ä¸ªç”¨äº**åˆ†æ Java Heap Dump æ–‡ä»¶ï¼ˆ.hprofï¼‰**çš„å·¥å…·ã€‚å®ƒå¯ä»¥å°†å †å¿«ç…§ä½œä¸º HTTP æœåŠ¡åŠ è½½ï¼Œå¹¶å…è®¸ä½ é€šè¿‡æµè§ˆå™¨äº¤äº’å¼åœ°æŸ¥çœ‹å’ŒæŸ¥è¯¢å¯¹è±¡ä¿¡æ¯ã€‚ ä¸è¿‡éœ€è¦æ³¨æ„çš„æ˜¯ï¼š ğŸ”º ä» JDK 9 èµ·ï¼Œjhat å·²è¢«å®˜æ–¹åºŸå¼ƒï¼Œæ¨èä½¿ç”¨æ›´å¼ºå¤§çš„å·¥å…·å¦‚ VisualVMã€Eclipse MAT æˆ– jcmd + å¤–éƒ¨å·¥å…·ã€‚ 1234# é»˜è®¤ç«¯å£7000jhat &lt;heap dump file&gt;# æŒ‡å®šç«¯å£jhat -port 8000 &lt;heap dump file&gt; jvisualvm: å›¾å½¢åŒ–çš„ JVM ç›‘æ§ä¸åˆ†æå·¥å…· jvisualvmï¼ˆå…¨ç§°ï¼šJava VisualVMï¼‰æ˜¯ Java å®˜æ–¹æä¾›çš„ä¸€æ¬¾ å›¾å½¢åŒ–çš„ JVM ç›‘æ§ä¸åˆ†æå·¥å…·ï¼Œç”¨äºè§‚å¯Ÿã€åˆ†æå’Œè°ƒè¯•æ­£åœ¨è¿è¡Œçš„ Java ç¨‹åºã€‚å®ƒéå¸¸é€‚åˆå¼€å‘å’Œæµ‹è¯•ç¯å¢ƒä¸­è¿›è¡Œå†…å­˜åˆ†æã€çº¿ç¨‹åˆ†æã€GC è¡Œä¸ºè§‚å¯Ÿç­‰ä»»åŠ¡ã€‚ åŠŸèƒ½æ¦‚è§ˆ åŠŸèƒ½ æè¿° è¿›ç¨‹ç›‘æ§ æŸ¥çœ‹æœ¬åœ°æˆ–è¿œç¨‹ JVM è¿›ç¨‹çš„å†…å­˜ã€CPUã€çº¿ç¨‹ç­‰è¿è¡ŒçŠ¶æ€ å†…å­˜ä½¿ç”¨åˆ†æ æŸ¥çœ‹å †å†…å­˜ä½¿ç”¨æƒ…å†µã€GC æ¬¡æ•°å’Œæ—¶é—´ã€ç±»å®ä¾‹åˆ†å¸ƒç­‰ çº¿ç¨‹åˆ†æ æŸ¥çœ‹çº¿ç¨‹çŠ¶æ€ã€çº¿ç¨‹æ ˆã€æ˜¯å¦å­˜åœ¨æ­»é” GC åˆ†æ å›¾å½¢åŒ–å±•ç¤º GC æ´»åŠ¨ã€é¢‘ç‡ä¸è€—æ—¶ å †è½¬å‚¨åˆ†æ å¯¼å…¥ .hprof æ–‡ä»¶è¿›è¡Œå¯¹è±¡å®ä¾‹ã€ç±»ã€å¼•ç”¨å…³ç³»åˆ†æ CPU åˆ†æ åˆ†ææ–¹æ³•è°ƒç”¨è·¯å¾„ã€è€—æ—¶ã€çƒ­ç‚¹ä»£ç ï¼ˆéœ€æ‰‹åŠ¨å¯ç”¨ CPU profilerï¼‰ æ’ä»¶æ”¯æŒ å¯ä»¥é€šè¿‡æ’ä»¶å®‰è£…æ›´å¤šåŠŸèƒ½ï¼ˆå¦‚ Visual GCï¼‰ å¯åŠ¨ jvisualvm 12# ä¸è¦åœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ï¼Œå¦‚æœæ˜¯åˆ†ææœåŠ¡ç«¯ .hprof æ–‡ä»¶ï¼Œå¯ä»¥å¯¼å‡ºåˆ°æœ¬åœ°ååœ¨æœ¬åœ°å¯åŠ¨$ jvisualvm åœ¨ jvisualvm ä¸­å¯¼å…¥ .hprof æ–‡ä»¶ 12$ jvisualvm --openfile &lt;heap dump file&gt;# æˆ–è€… å…ˆæ‰“å¼€ jvisualvm åï¼Œç‚¹å‡» File -&gt; Open File -&gt; é€‰æ‹© .hprof æ–‡ä»¶ âš ï¸ æ³¨æ„äº‹é¡¹ æ³¨æ„ç‚¹ è¯´æ˜ ä¸é€‚ç”¨äºå¤§è§„æ¨¡ç”Ÿäº§ç¯å¢ƒç›‘æ§ å› ä¸ºå…¶åˆ†æè¿‡ç¨‹å¯èƒ½ä¼šå¯¹ JVM æœ‰è½»å¾®å½±å“ .hprof æ–‡ä»¶è¿‡å¤§æ—¶åŠ è½½ç¼“æ…¢ å¯é…åˆ Eclipse MAT ä½¿ç”¨ CPU/Memory Profiler ä¼šå¢åŠ ç³»ç»Ÿè´Ÿæ‹… ä½¿ç”¨æ—¶è°¨æ…ï¼Œå»ºè®®åªåœ¨æµ‹è¯•ç¯å¢ƒå¯ç”¨ Eclipse MAT: Java Heap Dump åˆ†æå·¥å…· Eclipse MATï¼ˆEclipse Memory Analyzer Toolï¼‰æ˜¯ä¸€ä¸ªç”¨äºåˆ†æ Java å †å¿«ç…§çš„å·¥å…·ï¼Œå®ƒæä¾›äº†è®¸å¤šåŠŸèƒ½æ¥å¸®åŠ©å¼€å‘äººå‘˜ç†è§£ Java åº”ç”¨ç¨‹åºä¸­çš„å†…å­˜é—®é¢˜ã€‚ MaxOSç³»ç»Ÿå®‰è£…Eclipse MATåï¼Œå¯åŠ¨æŠ¥é”™ï¼ŒæŠ¥é”™ä¿¡æ¯ä¸ºï¼šThe JVM shared library â€œ/Library/Internet Plug-Ins/JavaAppletPlugin.plugin/Contents/Home/bin/â€¦/lib/server/libjvm.dylibâ€ does not contain the JNI_CreateJavaVM symbol. è§£å†³æ–¹æ³•ï¼š 1.åœ¨åº”ç”¨åˆ—è¡¨ï¼Œæ‰¾åˆ°MemoryAnalyzer.appï¼Œç„¶åå³é”®å•å‡»åï¼Œé€‰æ‹©æ˜¾ç¤ºåŒ…å†…å®¹,è¿›å…¥Contentsç›®å½•ï¼Œæ‰¾åˆ°Info.plistæ–‡ä»¶ 2.æ‰“å¼€Info.plistæ–‡ä»¶åï¼Œå¯ä»¥çœ‹åˆ°æ³¨é‡Š&lt;string&gt;-vm&lt;/string&gt;é…ç½®é¡¹ï¼Œæˆ‘ä»¬éœ€è¦åšçš„å°±æ˜¯æ‰“å¼€è¿™ä¸ªé…ç½®é¡¹ï¼Œå¹¶ä¸”å°†å…¶è®¾ç½®ä¸ºæˆ‘ä»¬ç³»ç»Ÿçš„Javaè·¯å¾„ï¼Œæœ€æ–°ç‰ˆéœ€è¦jdk17+ 12&lt;string&gt;-vm&lt;/string&gt;&lt;string&gt;/Users/hanqf/develop_soft/jdk17/bin/java&lt;/string&gt; Arthas : æ¨è Arthas æ˜¯é˜¿é‡Œå·´å·´å¼€æºçš„ä¸€æ¬¾ Java è¯Šæ–­å·¥å…·ï¼Œä¸“ä¸ºçº¿ä¸Šè¯Šæ–­è€Œè®¾è®¡ã€‚å®ƒå¯ä»¥å¸®åŠ©å¼€å‘è€…åœ¨ä¸é‡å¯ã€ä¸ä¿®æ”¹ä»£ç çš„æƒ…å†µä¸‹ï¼Œæ’æŸ¥ç”Ÿäº§ç¯å¢ƒä¸­ Java åº”ç”¨çš„é—®é¢˜ã€‚ Arthas æ”¯æŒ JDK 6+ï¼Œæ”¯æŒ Linux/Mac/Windowsï¼Œé‡‡ç”¨å‘½ä»¤è¡Œäº¤äº’æ¨¡å¼ï¼ŒåŒæ—¶æä¾›ä¸°å¯Œçš„ Tab è‡ªåŠ¨è¡¥å…¨åŠŸèƒ½ï¼Œè¿›ä¸€æ­¥æ–¹ä¾¿è¿›è¡Œé—®é¢˜çš„å®šä½å’Œè¯Šæ–­ã€‚ è¿™é‡Œè¦æ³¨æ„ä¸€ç‚¹ï¼Œå°±æ˜¯Arthasä»4.xç‰ˆæœ¬å¼€å§‹ï¼Œéœ€è¦ä¾èµ–JDK8+ï¼Œå¦‚æœæ˜¯JDK6/7ï¼Œå¯ä»¥ä¸‹è½½æœ€åä¸€ä¸ª3.xç‰ˆæœ¬ 3.7.2ã€‚ ä¸ºäº†æ–¹ä¾¿æˆ‘ä»¬å­¦ä¹ ï¼ŒArthasè¿˜ä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªç»ƒä¹ åœºï¼ŒArthas Playgroundã€‚ Arthas æ ¸å¿ƒç‰¹ç‚¹ æ— éœ€é‡å¯ã€ä¾µå…¥æ€§ä½ Arthas å¯ä»¥ attach åˆ°æ­£åœ¨è¿è¡Œçš„ JVM ä¸Šï¼Œä¸éœ€è¦é‡å¯æœåŠ¡æˆ–ä¿®æ”¹æºä»£ç ã€‚ å‘½ä»¤å¼äº¤äº’ä½“éªŒ ç±»ä¼¼ Linux shell çš„æ“ä½œæ–¹å¼ï¼Œæ”¯æŒ tab è¡¥å…¨ã€ä¸Šä¸‹é”®å†å²å‘½ä»¤ç­‰ï¼Œéå¸¸ç›´è§‚ã€‚ å®æ—¶æŸ¥çœ‹å’Œç›‘æ§ å¯æŸ¥çœ‹æ–¹æ³•å‚æ•°ã€è¿”å›å€¼ã€è°ƒç”¨æ ˆã€æ‰§è¡Œè€—æ—¶ã€JVM çº¿ç¨‹ã€å†…å­˜ç­‰å®æ—¶æ•°æ®ã€‚ å¤šç§è¿æ¥æ–¹å¼ æ”¯æŒå‘½ä»¤è¡Œç»ˆç«¯ã€æœ¬åœ° shellã€Web é¡µé¢ã€telnet ç­‰å¤šç§è¿æ¥æ–¹å¼ã€‚ æ”¯æŒå¤šç§ JVM ç‰ˆæœ¬ æ”¯æŒ Java 6+ï¼ŒåŒ…æ‹¬ OpenJDKã€Oracle JDKã€Alibaba Dragonwell ç­‰ã€‚ Arthas å¸¸ç”¨å‘½ä»¤ å¯åŠ¨ 123456789101112131415161718192021222324252627282930313233343536java -jar arthas-boot.jar## è¾“å‡ºjava -jar arthas-boot.jar --target-ip 0.0.0.0[INFO] JAVA_HOME: /Library/Java/JavaVirtualMachines/jdk1.8.0_271.jdk/Contents/Home/jre[INFO] arthas-boot version: 4.0.5[INFO] Process 43959 already using port 3658[INFO] Process 43959 already using port 8563[INFO] Found existing java process, please choose one and input the serial number of the process, eg : 1. Then hit ENTER.* [1]: 43959 demo-arthas-spring-boot.jar [2]: 50851 org.jetbrains.idea.maven.server.RemoteMavenServer36 [3]: 50813 org.sonarsource.sonarlint.core.backend.cli.SonarLintServerCli [4]: 50655 com.intellij.idea.Main# å¯åŠ¨åï¼Œä¼šè‡ªåŠ¨è¿›å…¥äº¤äº’æ¨¡å¼ï¼Œæ­¤æ—¶è¾“å…¥è¦ç›‘æ§çš„è¿›ç¨‹åºå·1 # æ¯”å¦‚è¿™é‡Œè¾“å…¥ 1 å›è½¦## è¾“å‡º[INFO] arthas home: /Users/hanqf/.arthas/lib/4.0.5/arthas[INFO] The target process already listen port 3658, skip attach.[INFO] arthas-client connect 0.0.0.0 3658 ,---. ,------. ,--------.,--. ,--. ,---. ,---. / O \\ | .--. &#x27;&#x27;--. .--&#x27;| &#x27;--&#x27; | / O \\ &#x27; .-&#x27;| .-. || &#x27;--&#x27;.&#x27; | | | .--. || .-. |`. `-.| | | || |\\ \\ | | | | | || | | |.-&#x27; |`--&#x27; `--&#x27;`--&#x27; &#x27;--&#x27; `--&#x27; `--&#x27; `--&#x27;`--&#x27; `--&#x27;`-----&#x27;wiki https://arthas.aliyun.com/doctutorials https://arthas.aliyun.com/doc/arthas-tutorials.htmlversion 4.0.5main_class demo-arthas-spring-boot.jarpid 43959start_time 2025-05-14 14:57:18.031currnt_time 2025-05-14 14:59:22.004[arthas@43959]$ # æ­¤æ—¶è¿›å…¥ arthas å‘½ä»¤è¡Œäº¤äº’çŠ¶æ€# é€€å‡º arthas[arthas@43959]$ stop # é€€å‡º arthas arthas å‘½ä»¤æœ‰å¾ˆå¤šï¼Œå½“å¸¸ç”¨çš„ä¹Ÿå°±å‡ ä¸ªï¼Œå¦å¤–å¦‚æœè®°ä¸ä½æŸä¸ªå‘½ä»¤æ€ä¹ˆç”¨äº†å¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤æŸ¥è¯¢ 1&lt;command&gt; -h æˆ–è€… help &lt;command&gt; dashboard : å®æ—¶æŸ¥çœ‹ JVM è¿è¡ŒçŠ¶æ€ 123456789101112# æŸ¥çœ‹ JVM è¿è¡ŒçŠ¶æ€ï¼Œ é»˜è®¤æ¯éš” 5 ç§’åˆ·æ–° CPUã€å†…å­˜ã€çº¿ç¨‹ã€GC ç­‰ä¿¡æ¯# é»˜è®¤ä¼šä¸€ç›´åˆ·æ–°çŠ¶æ€ï¼ŒæŒ‰ `q` æˆ– `Ctrl+C` é€€å‡ºdashboard# æ¯éš” 2 ç§’åˆ·æ–°ä¸€æ¬¡dashboard -i 2000# åˆ·æ–° 10 æ¬¡ååœæ­¢dashboard -n 10# æ¯éš” 2 ç§’åˆ·æ–°ä¸€æ¬¡ï¼Œåˆ·æ–° 10 æ¬¡ååœæ­¢dashboard -i 2000 -n 10 thread : æŸ¥çœ‹å½“å‰ JVM çº¿ç¨‹ä¿¡æ¯ 1234567891011121314151617181920212223242526272829303132333435# æŸ¥çœ‹å½“å‰ JVM çº¿ç¨‹ä¿¡æ¯ï¼ŒæŒ‰ CPU ä½¿ç”¨ç‡å€’åºthread# æŸ¥çœ‹æ‰€æœ‰çº¿ç¨‹ä¿¡æ¯thread --all# æŸ¥çœ‹æŒ‡å®šçº¿ç¨‹çš„å †æ ˆä¿¡æ¯thread 18## è¾“å‡º&quot;http-nio-80-exec-1&quot; Id=18 WAITING on java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject@51866c16 at sun.misc.Unsafe.park(Native Method) - waiting on java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject@51866c16 at java.util.concurrent.locks.LockSupport.park(LockSupport.java:175) at java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.await(AbstractQueuedSynchronizer.java:2039) at java.util.concurrent.LinkedBlockingQueue.take(LinkedBlockingQueue.java:442) at org.apache.tomcat.util.threads.TaskQueue.take(TaskQueue.java:103) at org.apache.tomcat.util.threads.TaskQueue.take(TaskQueue.java:31) at java.util.concurrent.ThreadPoolExecutor.getTask(ThreadPoolExecutor.java:1074) at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1134) at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61) at java.lang.Thread.run(Thread.java:748)# æŸ¥çœ‹æœ€å¿™çš„å‰5ä¸ªçº¿ç¨‹çš„å †æ ˆä¿¡æ¯thread -n 5# æŸ¥çœ‹å…¨éƒ¨çº¿ç¨‹çš„å †æ ˆä¿¡æ¯thread -n -1# æŒ‡å®š cpu ä½¿ç”¨ç‡ç»Ÿè®¡çš„é‡‡æ ·é—´éš”ï¼Œå•ä½ä¸ºæ¯«ç§’ï¼Œé»˜è®¤å€¼ä¸º 200thread -i 500# æ‰¾å‡ºå½“å‰é˜»å¡å…¶ä»–çº¿ç¨‹çš„çº¿ç¨‹thread -b# æŸ¥çœ‹æŒ‡å®šçŠ¶æ€çš„çº¿ç¨‹thread --state WAITING sc : æŸ¥çœ‹ JVM å·²åŠ è½½çš„ç±»ä¿¡æ¯ Search-Class çš„ç®€å†™ï¼Œè¿™ä¸ªå‘½ä»¤èƒ½æœç´¢å‡ºæ‰€æœ‰å·²ç»åŠ è½½åˆ° JVM ä¸­çš„ Class ä¿¡æ¯ 12345678# é€šé…ç¬¦åŒ¹é…ï¼Œæ‰“å°æœç´¢åˆ°çš„ç±»å…¨åsc *.demo.*# æ‰“å°ç±»çš„è¯¦ç»†ä¿¡æ¯sc -d com.example.demo.arthas.AdminFilterConfig# æ‰“å°å‡ºç±»çš„ Field ä¿¡æ¯sc -d -f com.example.demo.arthas.AdminFilterConfig sm : æŸ¥çœ‹å·²åŠ è½½ç±»çš„æ–¹æ³•ä¿¡æ¯ Search-Method çš„ç®€å†™ï¼Œè¿™ä¸ªå‘½ä»¤èƒ½æœç´¢å‡ºæ‰€æœ‰å·²ç»åŠ è½½åˆ° JVM ä¸­çš„ Method ä¿¡æ¯ 12345678# æ‰“å°æŒ‡å®šç±»ä¸­çš„æ–¹æ³•sm java.lang.String# å±•ç¤ºæ–¹æ³•çš„è¯¦ç»†ä¿¡æ¯sm -d java.lang.String# å±•ç¤ºæŒ‡å®šæ–¹æ³•çš„è¯¦ç»†ä¿¡æ¯sm -d java.lang.String substring# æ¨¡ç³ŠåŒ¹é…sm -d java.lang.String eq* jad : Javaæºç åç¼–è¯‘å·¥å…· éªŒè¯ç”Ÿäº§ç¯å¢ƒä¸‹çš„ä»£ç æ˜¯å¦ä¸æäº¤çš„ä»£ç ä¸€è‡´ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748# æ‰“å°å‡ºç±»çš„æºç ï¼Œç±»åjad com.example.demo.arthas.user.UserController## è¾“å‡ºjad com.example.demo.arthas.user.UserControllerClassLoader:+-org.springframework.boot.loader.LaunchedURLClassLoader@5b2133b1 +-sun.misc.Launcher$AppClassLoader@5c647e05 +-sun.misc.Launcher$ExtClassLoader@452b3a41Location:file:/Users/hanqf/Desktop/arhtas_dir/demo-arthas-spring-boot.jar!/BOOT-INF/classes!/ /* * Decompiled with CFR. * * Could not load the following classes: * com.example.demo.arthas.user.User * org.slf4j.Logger * org.slf4j.LoggerFactory * org.springframework.web.bind.annotation.GetMapping * org.springframework.web.bind.annotation.PathVariable * org.springframework.web.bind.annotation.RestController */ package com.example.demo.arthas.user; import com.example.demo.arthas.user.User; import org.slf4j.Logger; import org.slf4j.LoggerFactory; import org.springframework.web.bind.annotation.GetMapping; import org.springframework.web.bind.annotation.PathVariable; import org.springframework.web.bind.annotation.RestController; @RestController public class UserController &#123; private static final Logger logger = LoggerFactory.getLogger(UserController.class); @GetMapping(value=&#123;&quot;/user/&#123;id&#125;&quot;&#125;) public User findUserById(@PathVariable Integer id) &#123;/*15*/ logger.info(&quot;id: &#123;&#125;&quot;, (Object)id);/*17*/ if (id != null &amp;&amp; id &lt; 1) &#123; throw new IllegalArgumentException(&quot;id &lt; 1&quot;); &#125; return new User(id.intValue(), &quot;name&quot; + id); &#125; &#125;Affect(row-cnt:1) cost in 411 ms. 12345678910111213# åç¼–è¯‘åçš„æºç ä¼šæœ‰ç±»åŠ è½½å™¨çš„ä¿¡æ¯ï¼Œå¦‚æœåªå¸Œæœ›æ‰“å°æºç ï¼Œå¯ä»¥åŠ ä¸Š --source-onlyjad --source-only com.example.demo.arthas.user.UserController# ä¸æ˜¾ç¤ºè¡Œå·jad --source-only com.example.demo.arthas.user.UserController --lineNumber false# è¾“å‡ºåˆ°æ–‡ä»¶jad --source-only com.example.demo.arthas.user.UserController &gt; /tmp/UserController.java# æ‰“å°å‡ºç±»ä¸­æŸä¸ªæ–¹æ³•çš„æºç ï¼Œç±»å + æ–¹æ³•åjad com.example.demo.arthas.user.UserController findUserById# åç¼–è¯‘æ—¶æŒ‡å®šdump classæ–‡ä»¶ç›®å½•jad --source-only com.example.demo.arthas.user.UserController --lineNumber false -d /tmp/jad å½“æœ‰å¤šä¸ª ClassLoader éƒ½åŠ è½½äº†è¿™ä¸ªç±»æ—¶ï¼Œjad å‘½ä»¤ä¼šè¾“å‡ºå¯¹åº” ClassLoader å®ä¾‹çš„ hashcodeï¼Œç„¶åä½ åªéœ€è¦é‡æ–°æ‰§è¡Œ jad å‘½ä»¤ï¼Œå¹¶ä½¿ç”¨å‚æ•° -c å°±å¯ä»¥åç¼–è¯‘æŒ‡å®š ClassLoader åŠ è½½çš„é‚£ä¸ªç±»äº†ï¼› 123456789101112131415$ jad org.apache.log4j.LoggerFound more than one class for: org.apache.log4j.Logger, Please use jad -c hashcode org.apache.log4j.LoggerHASHCODE CLASSLOADER69dcaba4 +-monitor&#x27;s ModuleClassLoader6e51ad67 +-java.net.URLClassLoader@6e51ad67 +-sun.misc.Launcher$AppClassLoader@6951a712 +-sun.misc.Launcher$ExtClassLoader@6fafc4c22bdd9114 +-pandora-qos-service&#x27;s ModuleClassLoader4c0df5f8 +-pandora-framework&#x27;s ModuleClassLoaderAffect(row-cnt:0) cost in 38 ms.# æŒ‡å®šç±»åŠ è½½å™¨$ jad org.apache.log4j.Logger -c 69dcaba4 mc : Memory Compiler/å†…å­˜ç¼–è¯‘å™¨ï¼Œç¼–è¯‘.javaæ–‡ä»¶ç”Ÿæˆ.class 12345678# ç¼–è¯‘ï¼Œè¿™é‡Œä¸€å®šè¦æŒ‡å®šç±»åŠ è½½å™¨ï¼Œå¦åˆ™ä¼šæŠ¥é”™ï¼Œå› ä¸ºä½ ç¼–è¯‘çš„ç±»ä¸­å¯èƒ½importå…¶å®ƒç±»ï¼Œä¸æŒ‡å®šå°±ä¼šæç¤ºæ‰¾ä¸åˆ°å¯¹åº”çš„ç±»ã€‚# ç±»åŠ è½½å™¨å¯ä»¥é€šè¿‡ jad å‘½ä»¤è·å–mc --classLoaderClass org.springframework.boot.loader.LaunchedURLClassLoader /tmp/UserController.java# æŒ‡å®šç±»åŠ è½½å™¨çš„ç¼–å·mc -c 5b2133b1 /tmp/UserController.java# å°† UserController.class æ–‡ä»¶è¾“å‡ºåˆ°æŒ‡å®šç›®å½•ï¼Œ -d æŒ‡å®šè¾“å‡ºç›®å½•mc --classLoaderClass org.springframework.boot.loader.LaunchedURLClassLoader /tmp/UserController.java -d /tmp mc å‘½ä»¤æœ‰å¯èƒ½å¤±è´¥ã€‚å¦‚æœç¼–è¯‘å¤±è´¥å¯ä»¥åœ¨æœ¬åœ°ç¼–è¯‘å¥½.classæ–‡ä»¶ï¼Œå†ä¸Šä¼ åˆ°æœåŠ¡å™¨ã€‚ retransform : é‡æ–°åŠ è½½ç±»(çƒ­ä¿®æ”¹ä»£ç ) 123456789101112retransform /tmp/com/example/demo/arthas/user/UserController.class# æŸ¥çœ‹ é€šè¿‡ retransform é‡æ–°åŠ è½½çš„ classretransform -l# åˆ é™¤é€šè¿‡ retransform é‡æ–°åŠ è½½çš„ classï¼Œé€šè¿‡ id åˆ é™¤retransform -d 1# åˆ é™¤æ‰€æœ‰retransform --deleteAll# åˆ é™¤åè¦é‡æ–°è§¦å‘ retransformï¼Œå¦åˆ™å†…å­˜ä¸­ä¾æ—§ä½¿ç”¨çš„æ˜¯åˆ é™¤å‰çš„ classretransform --classPattern com.example.demo.arthas.user.UserController sysprop : æŸ¥çœ‹å½“å‰ JVM çš„ç³»ç»Ÿå±æ€§ 1234567891011# æ‰“å°ç³»ç»Ÿå±æ€§sysprop# æŒ‡å®šå•ä¸ª keyï¼Œkeyæ”¯æŒè‡ªåŠ¨è¡¥å…¨sysprop java.version# é€šè¿‡grepè¿‡æ»¤sysprop | grep user# è®¾ç½® æˆ– ä¿®æ”¹ ç³»ç»Ÿå±æ€§sysprop testKey testValue sysenv : æŸ¥çœ‹å½“å‰ JVM çš„ç¯å¢ƒå˜é‡ 123456# åˆ—å‡ºæ‰€æœ‰ç¯å¢ƒå˜é‡sysenv# æŒ‡å®šå•ä¸ª keyï¼Œkeyæ”¯æŒè‡ªåŠ¨è¡¥å…¨sysenv PATH# é€šè¿‡grepè¿‡æ»¤sysenv | grep PATH jvm : æŸ¥çœ‹å½“å‰ JVM çš„ä¿¡æ¯ 1jvm THREAD ç›¸å…³ 12345COUNT: JVM å½“å‰æ´»è·ƒçš„çº¿ç¨‹æ•°DAEMON-COUNT: JVM å½“å‰æ´»è·ƒçš„å®ˆæŠ¤çº¿ç¨‹æ•°PEAK-COUNT: ä» JVM å¯åŠ¨å¼€å§‹æ›¾ç»æ´»ç€çš„æœ€å¤§çº¿ç¨‹æ•°STARTED-COUNT: ä» JVM å¯åŠ¨å¼€å§‹æ€»å…±å¯åŠ¨è¿‡çš„çº¿ç¨‹æ¬¡æ•°DEADLOCK-COUNT: JVM å½“å‰æ­»é”çš„çº¿ç¨‹æ•° FILE-DESCRIPTOR æ–‡ä»¶æè¿°ç¬¦ç›¸å…³ 12MAX-FILE-DESCRIPTOR-COUNTï¼šJVM è¿›ç¨‹æœ€å¤§å¯ä»¥æ‰“å¼€çš„æ–‡ä»¶æè¿°ç¬¦æ•°OPEN-FILE-DESCRIPTOR-COUNTï¼šJVM å½“å‰æ‰“å¼€çš„æ–‡ä»¶æè¿°ç¬¦æ•° watch : å‡½æ•°æ‰§è¡Œæ•°æ®è§‚æµ‹ è®©ä½ èƒ½æ–¹ä¾¿çš„è§‚å¯Ÿåˆ°æŒ‡å®šå‡½æ•°çš„è°ƒç”¨æƒ…å†µã€‚èƒ½è§‚å¯Ÿåˆ°çš„èŒƒå›´ä¸ºï¼šè¿”å›å€¼ã€æŠ›å‡ºå¼‚å¸¸ã€å…¥å‚ï¼Œé€šè¿‡ç¼–å†™ OGNL è¡¨è¾¾å¼è¿›è¡Œå¯¹åº”å˜é‡çš„æŸ¥çœ‹ã€‚ 123456789101112131415161718192021# è§‚å¯ŸæŒ‡å®šç±»ä¸­æŸä¸ªæ–¹æ³•çš„è°ƒç”¨æƒ…å†µï¼ŒclassName + methodName + è¿”å›å€¼è¡¨è¾¾å¼# å¼€å¯åï¼Œå½“æ–¹æ³•è¢«è°ƒç”¨æ—¶ï¼Œä¼šæŒ‰ç…§æŒ‡å®šçš„ `è¿”å›å€¼è¡¨è¾¾å¼` è¾“å‡ºç»“æœï¼Œè¿”å›å€¼è¡¨è¾¾å¼ å¯ä»¥ä¸æŒ‡å®šï¼Œé»˜è®¤ä¸º &#123;params, target, returnObj&#125;watch com.example.demo.arthas.user.UserController findUserById &#x27;&#123;params, throwExp&#125;&#x27;# è§‚å¯Ÿå…¨éƒ¨æ–¹æ³•ï¼Œé€šé…ç¬¦åŒ¹é…watch com.example.demo.arthas.user.UserController &#x27;*&#x27; &#x27;&#123;params, throwExp&#125;&#x27;# é»˜è®¤è¾“å‡ºç»“æœæ²¡æœ‰å±•å¼€ï¼Œå¯ä»¥åŠ ä¸Š -x æŒ‡å®šè¾“å‡ºç»“æœçš„å±æ€§éå†æ·±åº¦ï¼Œé»˜è®¤ä¸º 1ï¼Œæœ€å¤§å€¼æ˜¯ 4watch com.example.demo.arthas.user.UserController &#x27;*&#x27; &#x27;&#123;params, throwExp&#125;&#x27; -x 2# ä»…å½“æŠ›å‡ºå¼‚å¸¸æ—¶æ‰æ‰“å°ï¼Œ-e åœ¨å‡½æ•°å¼‚å¸¸ä¹‹åè§‚å¯Ÿwatch com.example.demo.arthas.user.UserController &#x27;*&#x27; &#x27;&#123;params, throwExp&#125;&#x27; -x 2 -e# å‚æ•°æ¡ä»¶è¿‡æ»¤ï¼Œparams[0] &gt; 100 è¡¨ç¤ºæ–¹æ³•å…¥å‚ä¸­ç¬¬ä¸€ä¸ªå‚æ•°çš„å€¼å¤§äº 100 æ—¶æ‰è§¦å‘æ‰“å°watch com.example.demo.arthas.user.UserController * returnObj &#x27;params[0] &gt; 100&#x27;# æŒ‰è¯·æ±‚è€—æ—¶è¿›è¡Œè¿‡æ»¤ï¼Œ#cost&gt;200 è¡¨ç¤ºè€—æ—¶å¤§äº200mswatch com.example.demo.arthas.user.UserController * &#x27;&#123;params, returnObj&#125;&#x27; &#x27;#cost&gt;200&#x27;# é€€å‡ºwatchq watch å‘½ä»¤è¡¨è¾¾å¼æ”¯æŒå˜é‡è¯´æ˜è¡¨ åç§° ç±»å‹/è¯´æ˜ ä½œç”¨/å«ä¹‰ loader ClassLoader æ–¹æ³•æ‰€åœ¨ç±»çš„ç±»åŠ è½½å™¨å¯¹è±¡ clazz Class&lt;?&gt; æ–¹æ³•æ‰€å±çš„ç±»ï¼ˆClass å¯¹è±¡ï¼‰ method java.lang.reflect.Method è¢«è°ƒç”¨çš„æ–¹æ³•çš„åå°„å¯¹è±¡ target Object æ–¹æ³•çš„è°ƒç”¨ç›®æ ‡å¯¹è±¡ï¼ˆå³ this å¯¹è±¡ï¼‰ï¼Œé™æ€æ–¹æ³•ä¸­ä¸º null params Object[] æ–¹æ³•çš„å…¥å‚æ•°ç»„ returnObj Object æ–¹æ³•çš„è¿”å›å€¼ throwExp Throwable æ–¹æ³•æŠ›å‡ºçš„å¼‚å¸¸ isBefore boolean å½“å‰æ‰§è¡Œä½ç½®æ˜¯å¦æ˜¯æ–¹æ³•è°ƒç”¨ä¹‹å‰ï¼ˆBEFORE é˜¶æ®µï¼‰ isThrow boolean å½“å‰æ–¹æ³•æ˜¯å¦ä»¥å¼‚å¸¸ç»“æŸï¼ˆTHROWS é˜¶æ®µï¼‰ isReturn boolean å½“å‰æ–¹æ³•æ˜¯å¦æ­£å¸¸è¿”å›ï¼ˆRETURN é˜¶æ®µï¼‰ jobs : æŸ¥çœ‹è¿è¡Œä¸­çš„ä»»åŠ¡ 12345678910111213141516171819202122# å¦‚ä¸‹å‘½ä»¤ä¼šè½¬åˆ°åå°è¿è¡Œ ï¼Œä¸linuxå‘½ä»¤ç±»ä¼¼ï¼Œå‘½ä»¤æœ€ååŠ ä¸Š `&amp;` å³å¯watch com.example.demo.arthas.user.UserController * &#x27;&#123;params, throwExp&#125;&#x27; &#x27;throwExp != null&#x27; &gt;&gt; a.log &amp;# æŸ¥çœ‹åå°ä»»åŠ¡jobs## è¾“å‡º[1]* Running watch com.example.demo.arthas.user.UserController * &#x27;&#123;params, throwExp&#125;&#x27; &#x27;throwExp != null&#x27; &gt;&gt; a.log &amp; execution count : 0 start time : Thu May 15 15:10:04 CST 2025 timeout date : Fri May 16 15:10:04 CST 2025 session : ded56dfd-5683-4427-ac08-792f8fb75e5e (current)# ç»“æŸä»»åŠ¡kill 1 # 1ä¸ºåå°ä»»åŠ¡id# å°†åå°ä»»åŠ¡è½¬åˆ°å‰å°fg 1 # 1ä¸ºåå°ä»»åŠ¡id# æš‚åœä»»åŠ¡ï¼Œä½†æ­¤æ—¶ä¼šå°†arthasè¿›ç¨‹éƒ½æŒ‚èµ·ï¼Œæ‰€ä»¥å¹¶ä¸å¥½ç”¨ctrl+z# å°†å‰å°ä»»åŠ¡è½¬åˆ°åå°ç»§ç»­æ‰§è¡Œbg 1 # 1ä¸ºå‰å°ä»»åŠ¡id logger : æŸ¥çœ‹ logger ä¿¡æ¯ï¼Œæ›´æ–° logger level 1234567891011# æŸ¥çœ‹ logger ä¿¡æ¯logger# æŸ¥çœ‹æŒ‡å®šåå­—çš„loggerä¿¡æ¯logger -n ROOT# æŸ¥çœ‹æ²¡æœ‰ appender çš„ logger çš„ä¿¡æ¯ï¼Œä¸åŠ è¿™ä¸ªå‚æ•°åªä¼šæ‰“å°æœ‰ appender çš„ logger çš„ä¿¡æ¯logger --include-no-appender# æ›´æ–° logger levelï¼Œ-c classLoader çš„ hashcodelogger --name ROOT --level debug -c 5b2133b1logger --name ROOT --level error --classLoaderClass org.springframework.boot.loader.LaunchedURLClassLoader classloader : æŸ¥çœ‹ classloader çš„ç»§æ‰¿æ ‘ï¼Œurlsï¼Œç±»åŠ è½½ä¿¡æ¯ 1234567# æŸ¥çœ‹ classloader çš„ä¿¡æ¯ï¼ŒåŠ è½½classçš„æ•°é‡ï¼Œhashcodeï¼Œclassloader çš„ parentclassloader -l# æ ‘å½¢å±•ç¤ºclassloader -t# æŸ¥æ‰¾èµ„æºï¼Œæ¯”å¦‚æŸ¥æ‰¾æŒ‡å®šåç§°çš„æ–‡ä»¶classloader -c 5b2133b1 -r application.properties","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç»JVMçš„å‘½ä»¤è¡Œå·¥å…· The JavaÂ® Virtual Machine Specification ç‰ˆæœ¬jdk1.8","date_published":"2025-05-13T13:30:05.000Z","tags":["æŠ€æœ¯","jvm","jvm"]},{"id":"https://blog.hanqunfeng.com/2025/05/12/jvm-gc-01/","url":"https://blog.hanqunfeng.com/2025/05/12/jvm-gc-01/","title":"JVM ä¹‹ å†…å­˜æ¨¡å‹ä¸åƒåœ¾å›æ”¶æœºåˆ¶(GC)","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç»JVMçš„å†…å­˜æ¨¡å‹ä¸åƒåœ¾å›æ”¶æœºåˆ¶</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://docs.oracle.com/javase/specs/jvms/se8/html/index.html\">The JavaÂ® Virtual Machine Specification</a> ç‰ˆæœ¬jdk1.8</p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"JVMè™šæ‹Ÿæœºç»“æ„-HotSpot\">JVMè™šæ‹Ÿæœºç»“æ„(HotSpot)</h2>\n<p><img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/uPic/cGMyEe.png\" alt=\"\"></p>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è®¾ç½®å†…å­˜åˆ†é…ç¤ºä¾‹</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># jdk1.8+</span></span><br><span class=\"line\">java â€Xms2048M â€Xmx2048M â€Xmn1024M â€Xss512K â€XX:MetaspaceSize=256M â€XX:MaxMetaspaceSize=256M â€jar server.jar</span><br><span class=\"line\"><span class=\"comment\"># jdk1.6/1.7</span></span><br><span class=\"line\">java â€Xms2048M â€Xmx2048M â€Xmn1024M â€Xss512K â€XX:PermSize=256M â€XX:MaxPermSize=256M â€jar server.jar</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å„å‚æ•°å«ä¹‰ä¸é»˜è®¤å€¼ï¼ˆé’ˆå¯¹ JDK 1.8ï¼‰</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>å‚æ•°</th>\n<th>å«ä¹‰è¯´æ˜</th>\n<th>é»˜è®¤å€¼ï¼ˆJDK 1.8ï¼‰</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>-Xms2048M</code></td>\n<td><strong>åˆå§‹å †å¤§å°</strong>ï¼Œå³ JVM å¯åŠ¨æ—¶åˆ†é…çš„å †å†…å­˜å¤§å°ï¼ˆè¿™é‡Œæ˜¯ 2GBï¼‰</td>\n<td>ç‰©ç†å†…å­˜çš„ 1/64ï¼ˆæœ€å° 1MBï¼‰ï¼Œæ¨èé…ç½®ä¸ºä¸ -Xmx ä¸€è‡´</td>\n</tr>\n<tr>\n<td><code>-Xmx2048M</code></td>\n<td><strong>æœ€å¤§å †å†…å­˜å¤§å°</strong>ï¼ŒJVM å…è®¸åˆ†é…çš„æœ€å¤§å †å†…å­˜</td>\n<td>ç‰©ç†å†…å­˜çš„ 1/4ï¼ˆå—é™äº 32ä½/64ä½ï¼‰</td>\n</tr>\n<tr>\n<td><code>-Xmn1024M</code></td>\n<td><strong>æ–°ç”Ÿä»£å¤§å°</strong>ï¼ˆEden + Survivorï¼‰ä¸º 1GB</td>\n<td>æœªæ˜¾å¼æŒ‡å®šæ—¶ï¼Œé€šå¸¸å å †çš„ 1/3 å·¦å³</td>\n</tr>\n<tr>\n<td><code>-Xss512K</code></td>\n<td><strong>æ¯ä¸ªçº¿ç¨‹çš„æ ˆå¤§å°</strong>ï¼ˆThread Stack Sizeï¼‰ï¼Œè¿™é‡Œè®¾ç½®ä¸º 512KB</td>\n<td>1MBï¼ˆ64ä½ç³»ç»Ÿï¼‰æˆ– 512KBï¼ˆ32ä½ç³»ç»Ÿï¼‰</td>\n</tr>\n<tr>\n<td><code>-XX:MetaspaceSize=256M</code></td>\n<td><strong>å…ƒç©ºé—´åˆå§‹å¤§å°</strong>ï¼ˆç”¨äºåŠ è½½ç±»çš„å…ƒæ•°æ®ï¼Œä¸å†ä½¿ç”¨ PermGenï¼‰</td>\n<td>21MBï¼ˆå®¢æˆ·ç«¯ï¼‰æˆ– 16MBï¼ˆæœåŠ¡å™¨ç«¯ï¼‰,æ¨èé…ç½®ä¸ºä¸  MaxMetaspaceSize ä¸€è‡´</td>\n</tr>\n<tr>\n<td><code>-XX:MaxMetaspaceSize=256M</code></td>\n<td><strong>å…ƒç©ºé—´æœ€å¤§å¤§å°</strong>ï¼Œè¶…è¿‡åè§¦å‘ Full GC</td>\n<td>æ— é™åˆ¶ï¼ˆé»˜è®¤åªå—ç‰©ç†å†…å­˜çº¦æŸï¼‰ ï¼Œæ¨èé…ç½®ä¸€ä¸ªåˆé€‚çš„æ•°å€¼ï¼Œæ¯”å¦‚8Gçš„å†…å­˜å¯ä»¥é…ç½®ä¸º256M</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"ç±»è£…è½½å­ç³»ç»Ÿï¼ˆClass-Loading-Subsystemï¼‰\">ç±»è£…è½½å­ç³»ç»Ÿï¼ˆClass Loading Subsystemï¼‰</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç±»è£…è½½å­ç³»ç»Ÿè´Ÿè´£å°† <code>.class</code> æ–‡ä»¶åŠ è½½åˆ° JVM ä¸­ï¼Œå¹¶è¿›è¡Œè§£æã€éªŒè¯ã€åˆå§‹åŒ–ç­‰è¿‡ç¨‹ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>åŠ è½½è¿‡ç¨‹çš„å‡ ä¸ªé˜¶æ®µï¼š</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>é˜¶æ®µ</th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>åŠ è½½ï¼ˆLoadingï¼‰</strong></td>\n<td>å°† <code>.class</code> æ–‡ä»¶è¯»å–ä¸ºäºŒè¿›åˆ¶æ•°æ®ï¼Œæ„é€  <code>Class</code> å¯¹è±¡</td>\n</tr>\n<tr>\n<td><strong>éªŒè¯ï¼ˆVerificationï¼‰</strong></td>\n<td>ç¡®ä¿å­—èŠ‚ç æ–‡ä»¶æ ¼å¼æ­£ç¡®ã€å®‰å…¨åˆæ³•ï¼ˆé˜²æ­¢æ¶æ„ä»£ç ï¼‰</td>\n</tr>\n<tr>\n<td><strong>å‡†å¤‡ï¼ˆPreparationï¼‰</strong></td>\n<td>ä¸ºç±»çš„é™æ€å˜é‡åˆ†é…å†…å­˜ï¼Œå¹¶è®¾ç½®é»˜è®¤åˆå§‹å€¼</td>\n</tr>\n<tr>\n<td><strong>è§£æï¼ˆResolutionï¼‰</strong></td>\n<td>å°†å¸¸é‡æ± ä¸­çš„ç¬¦å·å¼•ç”¨æ›¿æ¢ä¸ºç›´æ¥å¼•ç”¨ï¼ˆæ–¹æ³•ã€å­—æ®µç­‰ï¼‰</td>\n</tr>\n<tr>\n<td><strong>åˆå§‹åŒ–ï¼ˆInitializationï¼‰</strong></td>\n<td>æ‰§è¡Œ <code>&lt;clinit&gt;</code> é™æ€åˆå§‹åŒ–æ–¹æ³•ï¼Œå¯¹é™æ€å˜é‡èµ‹åˆå§‹å€¼</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç±»åŠ è½½å™¨ï¼ˆClassLoaderï¼‰ä½“ç³»ç»“æ„ï¼šè¯¦ç»†å‚è€ƒ <a href=\"/2025/05/08/jvm-classloader-01/\" title=\"JVM ä¹‹ ç±»åŠ è½½å™¨\">JVM ä¹‹ ç±»åŠ è½½å™¨</a></p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>ç±»åŠ è½½å™¨åç§°</th>\n<th>åŠ è½½å†…å®¹</th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>å¼•å¯¼ç±»åŠ è½½å™¨ï¼ˆBootstrap ClassLoaderï¼‰</strong></td>\n<td>Java æ ¸å¿ƒç±»åº“ï¼ˆå¦‚ <code>java.lang.*</code>ï¼‰</td>\n<td>ç”± JVM è‡ªèº«å®ç°ï¼Œç”¨æœ¬åœ°ä»£ç å®ç°ï¼Œæ— æ³•ç›´æ¥è®¿é—®</td>\n</tr>\n<tr>\n<td><strong>æ‰©å±•ç±»åŠ è½½å™¨ï¼ˆExtension ClassLoaderï¼‰</strong></td>\n<td><code>JAVA_HOME/jre/lib/ext</code> ç›®å½•ä¸‹çš„ç±»</td>\n<td>åŠ è½½æ ‡å‡†æ‰©å±•ç±»åº“</td>\n</tr>\n<tr>\n<td><strong>åº”ç”¨ç±»åŠ è½½å™¨ï¼ˆApplication ClassLoaderï¼‰</strong></td>\n<td>ç”¨æˆ·åº”ç”¨ç±»è·¯å¾„ï¼ˆCLASSPATH æŒ‡å®šçš„ç›®å½•ï¼‰</td>\n<td>æœ€å¸¸ç”¨ï¼ŒåŠ è½½å¤§å¤šæ•°åº”ç”¨ä»£ç </td>\n</tr>\n<tr>\n<td><strong>è‡ªå®šä¹‰ç±»åŠ è½½å™¨ï¼ˆCustom ClassLoaderï¼‰</strong></td>\n<td>ç”¨æˆ·æ‰‹åŠ¨å®ç°çš„ç±»åŠ è½½å™¨</td>\n<td>å¯ä»¥æ‰“ç ´åŒäº²å§”æ´¾æœºåˆ¶ï¼Œå®ç°çƒ­åŠ è½½ã€åŠ å¯†ç±»åŠ è½½ç­‰</td>\n</tr>\n</tbody>\n</table>\n<blockquote>\n<p>ç±»åŠ è½½é‡‡ç”¨ åŒäº²å§”æ´¾æ¨¡å‹ï¼šè¯·æ±‚ä¼šå…ˆå‘çˆ¶åŠ è½½å™¨å§”æ‰˜ï¼Œåªæœ‰åœ¨çˆ¶åŠ è½½å™¨åŠ è½½å¤±è´¥æ—¶æ‰å°è¯•è‡ªèº«åŠ è½½ã€‚</p>\n</blockquote>\n<h3 id=\"å­—èŠ‚ç æ‰§è¡Œå¼•æ“ï¼ˆExecution-Engineï¼‰\">å­—èŠ‚ç æ‰§è¡Œå¼•æ“ï¼ˆExecution Engineï¼‰</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å­—èŠ‚ç æ‰§è¡Œå¼•æ“è´Ÿè´£å°† Java å­—èŠ‚ç è§£é‡Šæˆ–ç¼–è¯‘ä¸ºæœºå™¨ä»£ç ï¼Œå¹¶åœ¨åº•å±‚å¹³å°ä¸Šæ‰§è¡Œã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>æ‰§è¡Œå¼•æ“çš„æ ¸å¿ƒæ¨¡å—</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>ç»„ä»¶åç§°</th>\n<th>ä½œç”¨è¯´æ˜</th>\n<th>å…³é”®ç‰¹æ€§</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>è§£é‡Šå™¨ï¼ˆInterpreterï¼‰</strong></td>\n<td>å°†å­—èŠ‚ç é€æ¡è§£é‡Šæ‰§è¡Œ</td>\n<td>å¯åŠ¨å¿«ï¼Œé€‚åˆå†·ä»£ç ï¼ˆéçƒ­ç‚¹ä»£ç ï¼‰ï¼Œæ‰§è¡Œæ•ˆç‡ç›¸å¯¹è¾ƒä½</td>\n</tr>\n<tr>\n<td><strong>å³æ—¶ç¼–è¯‘å™¨ï¼ˆJIT Compilerï¼‰</strong></td>\n<td>å°†çƒ­ç‚¹ä»£ç ç¼–è¯‘ä¸ºæœ¬åœ°æœºå™¨ç ï¼Œæé«˜æ‰§è¡Œæ•ˆç‡</td>\n<td>åŒ…å« C1ï¼ˆClientï¼‰å’Œ C2ï¼ˆServerï¼‰ä¸¤ç§ï¼Œæ”¯æŒä¼˜åŒ–å¦‚ï¼šæ–¹æ³•å†…è”ã€é€ƒé€¸åˆ†æã€å¾ªç¯å±•å¼€ç­‰</td>\n</tr>\n<tr>\n<td><strong>åƒåœ¾æ”¶é›†å™¨ï¼ˆGarbage Collector, GCï¼‰</strong></td>\n<td>è‡ªåŠ¨å†…å­˜ç®¡ç†ï¼Œè´Ÿè´£å¯¹è±¡ç”Ÿå‘½å‘¨æœŸçš„å›æ”¶</td>\n<td>å¸¸è§ç®—æ³•åŒ…æ‹¬ï¼šSerialã€Parallelã€CMSã€G1ã€ZGCï¼ˆä½å»¶è¿Ÿï¼‰ç­‰ï¼Œæ ¹æ®ä¸åŒåœºæ™¯é€‰æ‹©</td>\n</tr>\n<tr>\n<td><strong>æœ¬åœ°æ¥å£ï¼ˆNative Interfaceï¼‰</strong></td>\n<td>æ”¯æŒ Java ä¸æœ¬åœ°è¯­è¨€ï¼ˆå¦‚ C/C++ï¼‰çš„äº’æ“ä½œ</td>\n<td>é€šè¿‡ JNIï¼ˆJava Native Interfaceï¼‰å®ç°ï¼Œè°ƒç”¨åº•å±‚æ“ä½œç³»ç»Ÿæˆ–ç¬¬ä¸‰æ–¹åº“åŠŸèƒ½</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"JVM-å†…å­˜æ¨¡å‹ï¼ˆJava-Memory-Modelï¼ŒJMMï¼‰\">JVM å†…å­˜æ¨¡å‹ï¼ˆJava Memory Modelï¼ŒJMMï¼‰</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>JMM æ˜¯ Java è™šæ‹Ÿæœºè§„èŒƒä¸­å®šä¹‰çš„ä¸€ç§ æŠ½è±¡å†…å­˜æ¨¡å‹ï¼Œå®ƒå†³å®šäº†å¤šçº¿ç¨‹ç¨‹åºä¸­å˜é‡çš„è¯»å†™å¯è§æ€§ã€æœ‰åºæ€§å’ŒåŸå­æ€§ã€‚åŒæ—¶ï¼ŒJVM åœ¨ç‰©ç†å±‚ä¹Ÿæœ‰ä¸€ä¸ªå®é™…çš„å†…å­˜ç»“æ„ï¼Œç§°ä¸ºè¿è¡Œæ—¶æ•°æ®åŒºåŸŸï¼ˆRuntime Data Areasï¼‰ï¼Œè¿™ä¸¤ä¸ªå¯ä»¥ç»“åˆç†è§£ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>JMM çš„ä¸»è¦ç›®æ ‡</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-6\">ä¿è¯å¤šçº¿ç¨‹ç¯å¢ƒä¸‹çš„æ•°æ®ä¸€è‡´æ€§</li>\n<li class=\"lvl-6\">æŒ‡å¯¼ JVM å’Œ CPU çš„å†…å­˜äº¤äº’è¡Œä¸ºï¼ˆå¦‚é‡æ’åºã€ç¼“å­˜ï¼‰</li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<p>å®é™…è¿è¡Œæ—¶å†…å­˜ç»“æ„å¦‚ä¸‹ï¼š</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>å†…å­˜åŒºåŸŸ</th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>ğŸ“Œ <strong>ç¨‹åºè®¡æ•°å™¨ï¼ˆPCï¼‰</strong></td>\n<td>æ¯ä¸ªçº¿ç¨‹ç§æœ‰ï¼Œè®°å½•å½“å‰æ‰§è¡Œçš„å­—èŠ‚ç æŒ‡ä»¤åœ°å€</td>\n</tr>\n<tr>\n<td>ğŸ“Œ <strong>Java çº¿ç¨‹æ ˆ</strong></td>\n<td>æ¯ä¸ªçº¿ç¨‹ç§æœ‰ï¼Œæ–¹æ³•è°ƒç”¨æ—¶ç”¨äºå­˜å‚¨å±€éƒ¨å˜é‡ã€æ“ä½œæ•°æ ˆç­‰</td>\n</tr>\n<tr>\n<td>ğŸ“Œ <strong>æœ¬åœ°æ–¹æ³•æ ˆ</strong></td>\n<td>ä¸è™šæ‹Ÿæœºæ ˆç±»ä¼¼ï¼Œç”¨äº native æ–¹æ³•</td>\n</tr>\n<tr>\n<td>ğŸ“Œ <strong>å †ï¼ˆHeapï¼‰</strong></td>\n<td>æ‰€æœ‰çº¿ç¨‹å…±äº«ï¼Œå­˜å‚¨å¯¹è±¡å®ä¾‹ã€æ•°ç»„ç­‰ï¼ŒGC çš„ä¸»è¦åŒºåŸŸ</td>\n</tr>\n<tr>\n<td>ğŸ“Œ <strong>æ–¹æ³•åŒºï¼ˆæˆ–å…ƒç©ºé—´ï¼‰</strong></td>\n<td>æ‰€æœ‰çº¿ç¨‹å…±äº«ï¼Œå­˜å‚¨ç±»ä¿¡æ¯ã€é™æ€å˜é‡ã€å¸¸é‡æ± ç­‰ï¼ˆJDK8 åç§°ä¸º Metaspaceï¼‰</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"åƒåœ¾å›æ”¶å™¨\">åƒåœ¾å›æ”¶å™¨</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åƒåœ¾å›æ”¶å™¨è´Ÿè´£è‡ªåŠ¨ç®¡ç†å†…å­˜ï¼Œå›æ”¶ä¸å†ä½¿ç”¨çš„å¯¹è±¡ï¼Œé¿å…å†…å­˜æ³„æ¼å’Œæº¢å‡ºã€‚</p>\n</li>\n</ul>\n<h3 id=\"ä»€ä¹ˆæ˜¯åƒåœ¾\">ä»€ä¹ˆæ˜¯åƒåœ¾</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å†…å­˜ä¸­æ²¡æœ‰è¢«ï¼ˆçº¿ç¨‹æ ˆå˜é‡ï¼Œé™æ€å˜é‡ï¼Œå¸¸é‡æ± ï¼ŒJNIæŒ‡é’ˆï¼‰å¼•ç”¨çš„åœ°å€å°±æ˜¯åƒåœ¾</p>\n</li>\n<li class=\"lvl-2\">\n<p>å¯è¾¾æ€§åˆ†æç®—æ³•ï¼šæ˜¯ç°ä»£ JVM åˆ¤æ–­ä¸€ä¸ªå¯¹è±¡æ˜¯å¦â€œè¿˜æ´»ç€â€çš„ä¸»è¦ç®—æ³•ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">åŸºæœ¬æ€æƒ³ï¼š</span><br><span class=\"line\">ä»ä¸€ç»„ç§°ä¸º â€œGC Rootsâ€ çš„å¯¹è±¡å‡ºå‘ï¼Œæ²¿ç€å¯¹è±¡ä¹‹é—´çš„å¼•ç”¨é“¾å‘ä¸‹æœç´¢ã€‚</span><br><span class=\"line\">å¦‚æœæŸä¸ªå¯¹è±¡ å¯ä»¥ä» GC Roots è¿½è¸ªåˆ°ï¼Œå°±è®¤ä¸ºå®ƒæ˜¯ â€œå¯è¾¾â€ çš„ï¼ˆAliveï¼‰ã€‚</span><br><span class=\"line\">å¦åˆ™å°±è®¤ä¸ºæ˜¯ â€œä¸å¯è¾¾â€ çš„ï¼ˆGarbageï¼‰ï¼Œå¯ä»¥è¢«å›æ”¶ã€‚</span><br></pre></td></tr></table></figure>\n<div class=\"tips\">\n<ul class=\"lvl-1\">\n<li class=\"lvl-2\">\n<p>åœ¨ JVM ä¸­ï¼Œ<code>GC Roots</code> æ˜¯ä¸€äº› å§‹ç»ˆå¯ç”¨çš„ã€ä¸ä¼šè¢«åƒåœ¾å›æ”¶çš„å¼•ç”¨èµ·ç‚¹ï¼Œä¸»è¦åŒ…æ‹¬ï¼š</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>GC Roots æ¥æº</th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>å½“å‰çº¿ç¨‹æ ˆä¸­çš„å¼•ç”¨ï¼ˆå±€éƒ¨å˜é‡è¡¨ï¼‰</td>\n<td>å„ä¸ªçº¿ç¨‹æ­£åœ¨è°ƒç”¨çš„æ–¹æ³•ä¸­çš„å±€éƒ¨å˜é‡ã€å‚æ•°ç­‰</td>\n</tr>\n<tr>\n<td>é™æ€å­—æ®µå¼•ç”¨</td>\n<td>ç±»çš„é™æ€å­—æ®µå¼•ç”¨çš„å¯¹è±¡</td>\n</tr>\n<tr>\n<td>JNI å¼•ç”¨ï¼ˆNative æ–¹æ³•å¼•ç”¨ï¼‰</td>\n<td>Java æœ¬åœ°æ–¹æ³•ä¸­å¼•ç”¨çš„å¯¹è±¡</td>\n</tr>\n<tr>\n<td>å¸¸é‡å¼•ç”¨æ± ä¸­çš„å¯¹è±¡</td>\n<td>å­—ç¬¦ä¸²å¸¸é‡ç­‰å¯èƒ½æŒæœ‰å¯¹è±¡å¼•ç”¨</td>\n</tr>\n<tr>\n<td>æ´»åŠ¨çº¿ç¨‹å¯¹è±¡</td>\n<td>çº¿ç¨‹è‡ªèº«åœ¨ GC æ—¶ä¸ä¼šè¢«å›æ”¶</td>\n</tr>\n<tr>\n<td>JVM å†…éƒ¨ç»“æ„ï¼ˆå¦‚ç³»ç»Ÿç±»åŠ è½½å™¨ç­‰ï¼‰</td>\n<td>JVM å…³é”®ç³»ç»Ÿå¯¹è±¡</td>\n</tr>\n</tbody>\n</table>\n</div>\n<h3 id=\"åƒåœ¾å›æ”¶å™¨ç§ç±»ï¼š\">åƒåœ¾å›æ”¶å™¨ç§ç±»ï¼š</h3>\n<p><img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/uPic/TEILZ9.png\" alt=\"\"></p>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å·¦è¾¹6ç§å«åˆ†ä»£æ¨¡å‹ï¼Œå³è¾¹çš„4ç§å«åˆ†åŒºæ¨¡å‹</p>\n</li>\n</ul>\n<div class=\"tips\">\n<p><em><strong>åˆ†ä»£æ¨¡å‹ï¼ˆGenerational Modelï¼‰</strong></em><br>\nå †å†…å­˜åˆ’åˆ†ä¸ºï¼š<br>\nå¹´è½»ä»£ï¼ˆYoung Generationï¼‰ï¼šå­˜æ”¾æ–°åˆ›å»ºçš„å¯¹è±¡ï¼Œåˆ†ä¸º Eden å’Œ Survivor åŒºã€‚<br>\nè€å¹´ä»£ï¼ˆOld Generationï¼‰ï¼šå­˜æ”¾ç»è¿‡å¤šæ¬¡ GC åä»ç„¶å­˜æ´»çš„å¯¹è±¡ã€‚</p>\n<p><em><strong>åˆ†åŒºæ¨¡å‹ï¼ˆRegion-based Modelï¼‰</strong></em><br>\nåˆ†åŒºæ¨¡å‹ï¼ˆå¦‚ G1ã€ZGCã€Shenandoahï¼‰ä¸å†ä¸¥æ ¼æŒ‰ç…§ä»£åˆ’åˆ†å†…å­˜ï¼Œè€Œæ˜¯æŠŠå †åˆ’åˆ†ä¸ºå¤šä¸ª å¤§å°ç›¸åŒçš„ Regionã€‚æ¯ä¸ª Region å¯ä»¥åœ¨è¿è¡Œæ—¶è¢«åŠ¨æ€æ ‡è®°ä¸º Edenã€Survivor æˆ– Oldã€‚</p>\n</div>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ†ä»£æ¨¡å‹ä¸­ï¼Œä¸Šé¢3ä¸ªæ˜¯æ–°ç”Ÿä»£åƒåœ¾å›æ”¶å™¨ï¼Œä¸‹é¢3ä¸ªæ˜¯è€å¹´ä»£åƒåœ¾å›æ”¶å™¨ï¼Œå¯ä»¥äº¤å‰é…å¯¹ï¼ˆè§ä¸Šå›¾è™šçº¿ï¼‰ï¼Œä½†æœ€å¸¸ç”¨æ˜¯ä¸Šä¸‹ä¸¤ä¸¤é…å¯¹ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>CMSå³å¯ä»¥ä½œä¸ºæ–°ç”Ÿä»£åƒåœ¾å›æ”¶å™¨ï¼Œä¹Ÿå¯ä»¥ä½œä¸ºè€å¹´ä»£åƒåœ¾å›æ”¶å™¨ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>EpsilonGCï¼Œæ˜¯ä¸€ä¸ªç‰¹æ®Šçš„åƒåœ¾å›æ”¶å™¨ï¼Œå®ƒä¸å›æ”¶ä»»ä½•å¯¹è±¡ï¼Œåªè´Ÿè´£æœ€ç»ˆè®°å½•ï¼Œåšæµ‹è¯•ç”¨çš„ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ç›®å‰æœ€å…ˆè¿›çš„æ¨¡å‹æ˜¯ <code>ZGC</code>ï¼Œjkd11å¼€å§‹æ”¯æŒï¼Œä½†ç›´åˆ°JDK16æ‰æ¯”è¾ƒå®Œå–„ï¼Œç›®å‰éé»˜è®¤é…ç½®ï¼Œéœ€è¦æ‰‹åŠ¨é…ç½®ã€‚å…¶ä¸Redhatå‡ºå“çš„ <code>Shenandoah</code> æ˜¯ç«äº‰å…³ç³»ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å¸¸è§åƒåœ¾å›æ”¶å™¨åŠå…¶åˆ†ç±»ã€JDKç‰ˆæœ¬</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>åƒåœ¾å›æ”¶å™¨</th>\n<th>æ‰€å±æ¨¡å‹</th>\n<th>è¯´æ˜</th>\n<th>é¦–æ¬¡å‡ºç° JDK ç‰ˆæœ¬</th>\n<th>å¯ç”¨å‘½ä»¤ï¼ˆJVM å‚æ•°ï¼‰</th>\n<th>é€‚åˆçš„å †å†…å­˜å¤§å°</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>Serial</strong></td>\n<td>åˆ†ä»£æ¨¡å‹</td>\n<td>å•çº¿ç¨‹ï¼Œæ–°ç”Ÿä»£å’Œè€å¹´ä»£éƒ½ä½¿ç”¨ Serialï¼Œé€‚ç”¨äºå°å †å†…å­˜</td>\n<td>JDK 1.2</td>\n<td><code>-XX:+UseSerialGC</code></td>\n<td>ğŸ’¾ å°äº 1GB</td>\n</tr>\n<tr>\n<td><strong>ParNew</strong></td>\n<td>åˆ†ä»£æ¨¡å‹</td>\n<td>Serial çš„å¤šçº¿ç¨‹ç‰ˆæœ¬ï¼Œ<strong>ä»…ç”¨äº CMS æ–°ç”Ÿä»£</strong></td>\n<td>JDK 1.4</td>\n<td><code>-XX:+UseParNewGC -XX:+UseConcMarkSweepGC</code></td>\n<td>ğŸ’¾ 1GB ~ 4GB</td>\n</tr>\n<tr>\n<td><strong>Parallelï¼ˆååé‡ GCï¼‰</strong></td>\n<td>åˆ†ä»£æ¨¡å‹</td>\n<td>å¤šçº¿ç¨‹ GCï¼Œé€‚åˆååé‡ä¼˜å…ˆçš„åº”ç”¨åœºæ™¯</td>\n<td>JDK 1.4</td>\n<td><code>-XX:+UseParallelGC</code>ï¼ˆæ–°ç”Ÿä»£ï¼‰<br><code>-XX:+UseParallelOldGC</code>ï¼ˆè€å¹´ä»£ï¼‰</td>\n<td>ğŸ’¾ 2GB ~ 8GB</td>\n</tr>\n<tr>\n<td><strong>CMSï¼ˆConcurrent Mark Sweepï¼‰</strong></td>\n<td>åˆ†ä»£æ¨¡å‹</td>\n<td>è€å¹´ä»£å¹¶å‘æ ‡è®°-æ¸…é™¤ï¼Œä½å»¶è¿Ÿï¼Œä½†å­˜åœ¨ç¢ç‰‡ï¼Œ<strong>å·²å¼ƒç”¨</strong></td>\n<td>JDK 1.4</td>\n<td><code>-XX:+UseConcMarkSweepGC</code></td>\n<td>ğŸ’¾ 2GB ~ 8GBï¼ˆå·²è¿‡æ—¶ï¼‰</td>\n</tr>\n<tr>\n<td><strong>G1ï¼ˆGarbage Firstï¼‰</strong></td>\n<td>åˆ†åŒºæ¨¡å‹</td>\n<td>å°†å †åˆ’åˆ†ä¸º Regionï¼Œé€»è¾‘åˆ†ä»£ï¼Œæ”¯æŒå¹¶å‘å‹ç¼©ï¼Œå¹³è¡¡å»¶è¿Ÿä¸åå</td>\n<td>JDK 7u4ï¼ˆæ­£å¼ï¼‰</td>\n<td><code>-XX:+UseG1GC</code></td>\n<td>ğŸ’¾ 4GB ~ æ•°å GB</td>\n</tr>\n<tr>\n<td><strong>ZGCï¼ˆZ Garbage Collectorï¼‰</strong></td>\n<td>åˆ†åŒºæ¨¡å‹</td>\n<td>Region å¼¹æ€§å¤§å°ï¼Œæ”¯æŒè¶…å¤§å †ï¼Œä½å»¶è¿Ÿï¼ˆ&lt;10ms åœé¡¿ï¼‰</td>\n<td>JDK 11ï¼ˆå®éªŒï¼‰ï¼ŒJDK 15ï¼ˆæ­£å¼ï¼‰</td>\n<td><code>-XX:+UseZGC</code></td>\n<td>ğŸ’¾ 8GB ~ æ•° TBï¼ˆè¶…å¤§å †ï¼‰</td>\n</tr>\n<tr>\n<td><strong>Shenandoah</strong></td>\n<td>åˆ†åŒºæ¨¡å‹</td>\n<td>çº¢å¸½ä¸»å¯¼ï¼Œä½å»¶è¿Ÿï¼Œå¹¶å‘å›æ”¶ä¸å¹¶å‘å‹ç¼©</td>\n<td>JDK 12ï¼ˆå®éªŒï¼‰ï¼ŒJDK 15ï¼ˆæ­£å¼ï¼‰</td>\n<td><code>-XX:+UseShenandoahGC</code></td>\n<td>ğŸ’¾ 2GB ~ æ•°å GB</td>\n</tr>\n</tbody>\n</table>\n<blockquote>\n<p>å¯¹äº CMSï¼Œå¯ç”¨åä¼šè‡ªåŠ¨ä½¿ç”¨ ParNew ä½œä¸ºæ–°ç”Ÿä»£å›æ”¶å™¨ï¼ˆé™¤éæ˜¾å¼ç¦æ­¢ï¼‰ã€‚<br>\nCMS å·²åœ¨ JDK 9 å¼€å§‹æ ‡è®°ä¸ºå¼ƒç”¨ï¼ŒJDK 14 å®Œå…¨ç§»é™¤ï¼Œä¸æ¨èå†ä½¿ç”¨ã€‚<br>\nå¯¹äº Parallel GC å¯ç”¨ <code>-XX:+UseParallelGC</code>ï¼ˆæ–°ç”Ÿä»£ï¼‰ä¼šè‡ªåŠ¨å¯ç”¨ <code>-XX:+UseParallelOldGC</code>ï¼ˆè€å¹´ä»£ï¼‰ã€‚<br>\nå¯¹äºZGCï¼Œjdk15ä»¥å‰æœ€å¤§æ”¯æŒ4Tå†…å­˜ï¼Œä¹‹åæœ€å¤§æ”¯æŒ16Tå†…å­˜ã€‚</p>\n</blockquote>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å„ç‰ˆæœ¬é»˜è®¤åƒåœ¾å›æ”¶å™¨åŠæ¨èé…ç½®ï¼ˆJDK 1.6 èµ·ï¼‰</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>JDK ç‰ˆæœ¬</th>\n<th>é»˜è®¤ GC</th>\n<th>å»ºè®®ä½¿ç”¨ GCï¼ˆæŒ‰åœºæ™¯åˆ†ç±»ï¼‰</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>JDK 1.6</strong></td>\n<td>Serial / Parallel</td>\n<td>- å°å‹åº”ç”¨ï¼ˆå¦‚æ¡Œé¢ç¨‹åºï¼‰ï¼š<code>-XX:+UseSerialGC</code>  <br> - ä¸­å¤§å‹åº”ç”¨ï¼ˆååé‡ä¼˜å…ˆï¼‰ï¼š<code>-XX:+UseParallelGC</code></td>\n</tr>\n<tr>\n<td><strong>JDK 1.7</strong></td>\n<td>åŒä¸Š</td>\n<td>åŒ JDK 1.6</td>\n</tr>\n<tr>\n<td><strong>JDK 1.8</strong></td>\n<td>Parallel</td>\n<td>- ååä¼˜å…ˆï¼šé»˜è®¤ <code>-XX:+UseParallelGC</code> <br> - å“åº”ä¼˜å…ˆï¼š<code>-XX:+UseConcMarkSweepGC</code>ï¼ˆCMSï¼‰<br> - å¤§å † + æœªæ¥å‡çº§è€ƒè™‘ï¼š<code>-XX:+UseG1GC</code>ï¼ˆæ¨èï¼‰</td>\n</tr>\n<tr>\n<td><strong>JDK 9-14</strong></td>\n<td>G1 GC</td>\n<td>- ä¸€èˆ¬é»˜è®¤å³å¯ï¼š<code>-XX:+UseG1GC</code>ï¼ˆå»¶è¿Ÿä¸ååå¹³è¡¡ï¼‰<br> - æç«¯ä½å»¶è¿Ÿè¦æ±‚ï¼šå‡çº§åˆ° JDK 11+ ä½¿ç”¨ ZGC/Shenandoah</td>\n</tr>\n<tr>\n<td><strong>JDK 15+</strong></td>\n<td>G1 GCï¼ˆé»˜è®¤ï¼‰ï¼ŒZGC / Shenandoah å¯é€‰</td>\n<td>- å»¶è¿Ÿæ•æ„Ÿï¼ˆåœ¨çº¿æœåŠ¡ã€RTç³»ç»Ÿï¼‰ï¼š<code>-XX:+UseZGC</code> æˆ– <code>-XX:+UseShenandoahGC</code><br> - ååä¸ºä¸»ï¼š<code>-XX:+UseParallelGC</code><br> - ç»¼åˆå¹³è¡¡ï¼š<code>-XX:+UseG1GC</code>ï¼ˆé»˜è®¤ï¼‰</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ¤æ–­é»˜è®¤ GC çš„æ–¹å¼</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">java -XX:+PrintCommandLineFlags -version</span><br></pre></td></tr></table></figure>\n<h3 id=\"åƒåœ¾å›æ”¶ç®—æ³•\">åƒåœ¾å›æ”¶ç®—æ³•</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>JVM ä¸­å¸¸è§åƒåœ¾å›æ”¶ç®—æ³•æ±‡æ€»</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>ç®—æ³•åç§°</th>\n<th>æ ¸å¿ƒæ€æƒ³</th>\n<th>é€‚ç”¨é˜¶æ®µ/åŒºåŸŸ</th>\n<th>ä¼˜ç¼ºç‚¹ç®€è¿°</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>æ ‡è®°-æ¸…é™¤ï¼ˆMark-Sweepï¼‰</strong></td>\n<td>æ ‡è®°å‡ºå­˜æ´»å¯¹è±¡ï¼Œæ¸…é™¤æœªæ ‡è®°å¯¹è±¡</td>\n<td>è€å¹´ä»£</td>\n<td>ç®€å•é«˜æ•ˆï¼Œä½†ä¼šäº§ç”Ÿå¤§é‡ç¢ç‰‡ï¼Œä¸é€‚åˆè¿ç»­å†…å­˜åˆ†é…</td>\n</tr>\n<tr>\n<td><strong>æ ‡è®°-æ•´ç†ï¼ˆMark-Compactï¼‰</strong></td>\n<td>æ ‡è®°åç§»åŠ¨å­˜æ´»å¯¹è±¡ï¼Œæ•´ç†ç¢ç‰‡</td>\n<td>è€å¹´ä»£</td>\n<td>æ¶ˆé™¤ç¢ç‰‡ï¼Œä»£ä»·æ˜¯ç§»åŠ¨å¯¹è±¡ï¼Œé€‚ç”¨äºè€å¹´ä»£å‹ç¼©</td>\n</tr>\n<tr>\n<td><strong>å¤åˆ¶ç®—æ³•ï¼ˆCopyingï¼‰</strong></td>\n<td>å°†å¯¹è±¡å¤åˆ¶åˆ°å¦ä¸€å—å†…å­˜ï¼ˆå¦‚ Eden â†’ Survivorï¼‰</td>\n<td>æ–°ç”Ÿä»£</td>\n<td>é«˜æ•ˆç‡ï¼Œé€‚åˆå›æ”¶å¤§å¤šæ•°å¯¹è±¡çŸ­å‘½çš„æ–°ç”Ÿä»£ï¼Œä½†éœ€è¦é¢å¤–ç©ºé—´</td>\n</tr>\n<tr>\n<td><strong>åˆ†ä»£å›æ”¶ï¼ˆGenerationalï¼‰</strong></td>\n<td>å°†å¯¹è±¡æŒ‰ç”Ÿå‘½å‘¨æœŸåˆ’åˆ†ï¼ˆæ–°ç”Ÿä»£/è€å¹´ä»£ï¼‰</td>\n<td>æ•´ä¸ªå †ç»“æ„</td>\n<td>å®ç”¨æ€§å¼ºï¼Œç»“åˆä¸åŒç®—æ³•åº”ç”¨äºä¸åŒä»£ï¼Œç°ä»£ GC åŸºç¡€</td>\n</tr>\n<tr>\n<td><strong>åˆ†åŒºå›æ”¶ï¼ˆRegion-basedï¼‰</strong></td>\n<td>å°†å †åˆ’åˆ†ä¸ºè‹¥å¹²ç­‰å¤§å°çš„ Region åŠ¨æ€åˆ†é…</td>\n<td>æ•´ä¸ªå †ï¼ˆå¦‚ G1ã€ZGCï¼‰</td>\n<td>æ›´çµæ´»ï¼Œæ”¯æŒå¹¶å‘å¹¶è¡Œï¼Œå‡å°‘ STW åœé¡¿ï¼Œé€‚ç”¨äºå¤§å †ã€ä½å»¶è¿Ÿåœºæ™¯</td>\n</tr>\n<tr>\n<td><strong>å¢é‡å›æ”¶ï¼ˆIncrementalï¼‰</strong></td>\n<td>åˆ†é˜¶æ®µå°æ­¥æ‰§è¡Œ GC ä»¥å‡å°‘å•æ¬¡åœé¡¿</td>\n<td>æŸäº›å¹¶å‘/ä½å»¶è¿Ÿ GC</td>\n<td>å‡å°‘æš‚åœæ—¶é—´ï¼Œä½†æ•´ä½“æ•ˆç‡å¯èƒ½é™ä½</td>\n</tr>\n<tr>\n<td><strong>å¹¶å‘å›æ”¶ï¼ˆConcurrentï¼‰</strong></td>\n<td>æ ‡è®°ã€æ¸…ç†ç­‰æ­¥éª¤ä¸åº”ç”¨çº¿ç¨‹å¹¶å‘æ‰§è¡Œ</td>\n<td>CMSã€G1ã€ZGC ç­‰</td>\n<td>åœé¡¿æ—¶é—´çŸ­ï¼Œå¯¹å“åº”æ—¶é—´è¦æ±‚é«˜çš„ç³»ç»Ÿå‹å¥½</td>\n</tr>\n<tr>\n<td><strong>ä¸‰è‰²æ ‡è®°ï¼ˆTri-color Markingï¼‰</strong></td>\n<td>å¹¶å‘æ ‡è®°ç®—æ³•çš„ä¸€ç§å®ç°æ€æƒ³</td>\n<td>CMSã€G1ã€ZGC ç­‰</td>\n<td>ç™½ï¼ˆå¾…å›æ”¶ï¼‰ã€ç°ï¼ˆå·²æ ‡è®°æœªæ‰«æï¼‰ã€é»‘ï¼ˆå·²æ ‡è®°å·²æ‰«æï¼‰ï¼Œé¿å…â€œæ¼æ ‡â€é—®é¢˜</td>\n</tr>\n<tr>\n<td><strong>SATBï¼ˆSnapshot-At-The-Beginningï¼‰</strong></td>\n<td>å¹¶å‘æ ‡è®°çš„å¿«ç…§ç­–ç•¥</td>\n<td>G1ã€ZGC</td>\n<td>ä¿è¯åœ¨å¹¶å‘æ ‡è®°è¿‡ç¨‹ä¸­ä¸é—æ¼æ–°å¼•ç”¨ï¼Œé€‚åˆé«˜å¹¶å‘åœºæ™¯</td>\n</tr>\n<tr>\n<td><strong>Lazy Compactionï¼ˆå»¶è¿Ÿå‹ç¼©ï¼‰</strong></td>\n<td>ä¸æ¯æ¬¡ GC éƒ½å‹ç¼©ï¼Œè§†æƒ…å†µè€Œå®š</td>\n<td>G1 ç­‰</td>\n<td>é™ä½ä¸å¿…è¦çš„ç§»åŠ¨æˆæœ¬</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¯¹åº”å…³ç³»ï¼šGC å›æ”¶å™¨å’Œåº•å±‚ç®—æ³•</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>å›æ”¶å™¨</th>\n<th>ä½¿ç”¨çš„ç®—æ³•ç»„åˆ</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>Serial</strong></td>\n<td>æ–°ç”Ÿä»£ï¼šå¤åˆ¶ç®—æ³•<br>è€å¹´ä»£ï¼šæ ‡è®°-æ•´ç†</td>\n</tr>\n<tr>\n<td><strong>ParNew</strong></td>\n<td>æ–°ç”Ÿä»£ï¼šå¤åˆ¶ç®—æ³•ï¼ˆå¤šçº¿ç¨‹ï¼‰</td>\n</tr>\n<tr>\n<td><strong>Parallel</strong></td>\n<td>æ–°ç”Ÿä»£ï¼šå¤åˆ¶ç®—æ³•<br>è€å¹´ä»£ï¼šæ ‡è®°-æ•´ç†</td>\n</tr>\n<tr>\n<td><strong>CMS</strong></td>\n<td>æ–°ç”Ÿä»£ï¼šParNewï¼ˆå¤åˆ¶ï¼‰<br>è€å¹´ä»£ï¼šæ ‡è®°-æ¸…é™¤ + ä¸‰è‰²æ ‡è®° + å¹¶å‘</td>\n</tr>\n<tr>\n<td><strong>G1</strong></td>\n<td>åˆ†åŒºå›æ”¶ + ä¸‰è‰²æ ‡è®° + SATB + Lazy Compaction</td>\n</tr>\n<tr>\n<td><strong>ZGC</strong></td>\n<td>åˆ†åŒºå›æ”¶ + å¹¶å‘æ ‡è®° + SATB + Region Remapping</td>\n</tr>\n<tr>\n<td><strong>Shenandoah</strong></td>\n<td>åˆ†åŒºå›æ”¶ + å¹¶å‘æ ‡è®° + å¹¶å‘å‹ç¼© + ä¸‰è‰²æ ‡è®°</td>\n</tr>\n</tbody>\n</table>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class=\"line\">       â”‚   å¸¸è§ GC ç®—æ³•åˆ†ç±»       â”‚</span><br><span class=\"line\">       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><br><span class=\"line\">                 â”‚</span><br><span class=\"line\">   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class=\"line\">   â”‚                            â”‚</span><br><span class=\"line\">åˆ†ä»£æ¨¡å‹                      åˆ†åŒºæ¨¡å‹</span><br><span class=\"line\">   â”‚                            â”‚</span><br><span class=\"line\"> â”Œâ”€â”´â”€â”€â”€â”€â”€â”                  â”Œâ”€â”€â”€â”´â”€â”€â”€â”€â”€â”</span><br><span class=\"line\">å¤åˆ¶   æ ‡è®°-æ¸…é™¤         Region-based å¹¶å‘</span><br><span class=\"line\">      æ ‡è®°-æ•´ç†             SATB / ä¸‰è‰²æ ‡è®°</span><br></pre></td></tr></table></figure>\n<h4 id=\"ä»€ä¹ˆæ˜¯-STWï¼ˆStop-The-Worldï¼‰\">ä»€ä¹ˆæ˜¯ STWï¼ˆStop-The-Worldï¼‰</h4>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>STWï¼ˆStop-The-Worldï¼‰ æŒ‡çš„æ˜¯ï¼šåœ¨æŸäº›åƒåœ¾å›æ”¶é˜¶æ®µï¼ŒJVM ä¼šæš‚åœæ‰€æœ‰åº”ç”¨çº¿ç¨‹ï¼ˆä¹Ÿå«ç”¨æˆ·çº¿ç¨‹ï¼‰ï¼Œè®©åƒåœ¾å›æ”¶çº¿ç¨‹ç‹¬å  CPU æ‰§è¡Œ GC é€»è¾‘ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä½ å¯ä»¥è¿™æ ·ç†è§£ STW</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-6\">JVM ä¼šâ€œæŒ‰ä¸‹æš‚åœé”®â€æš‚åœæ‰€æœ‰æ­£åœ¨è¿è¡Œçš„ Java ç¨‹åºä»£ç ï¼›</li>\n<li class=\"lvl-6\">ç„¶å ä¸“å¿ƒè¿›è¡Œ GC çš„æŸäº›é˜¶æ®µï¼ˆå¦‚æ ‡è®°ã€æ•´ç†ã€å¤åˆ¶ç­‰ï¼‰ï¼›</li>\n<li class=\"lvl-6\">GC å®Œæˆåï¼Œæ‰ä¼šâ€œæ¢å¤è¿è¡Œâ€åº”ç”¨çº¿ç¨‹ã€‚</li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<p>å„ GC ä¸­ STW çš„å­˜åœ¨æƒ…å†µ</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>å›æ”¶å™¨</th>\n<th>æ˜¯å¦å­˜åœ¨ STWï¼Ÿ</th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Serial</td>\n<td>âœ… æ˜¯ï¼Œå…¨åœé¡¿ï¼Œå…¨é˜¶æ®µå•çº¿ç¨‹</td>\n<td>å †è¶Šå¤§ STW è¶Šé•¿</td>\n</tr>\n<tr>\n<td>Parallel</td>\n<td>âœ… æ˜¯ï¼Œå…¨åœé¡¿ï¼Œå¤šçº¿ç¨‹æ‰§è¡Œ GC</td>\n<td>æé«˜æ•ˆç‡ä½†ä»ä¼šæš‚åœ</td>\n</tr>\n<tr>\n<td>CMS</td>\n<td>âœ… æœ‰ï¼Œåˆå§‹æ ‡è®°å’Œæœ€ç»ˆé‡æ–°æ ‡è®°æ˜¯ STW</td>\n<td>å¤§éƒ¨åˆ†é˜¶æ®µå¹¶å‘æ‰§è¡Œ</td>\n</tr>\n<tr>\n<td>G1</td>\n<td>âœ… æœ‰ï¼Œä½†è®¾è®¡ä¸ºå°½å¯èƒ½ç¼©çŸ­ STW</td>\n<td>åˆ†é˜¶æ®µå¹¶å‘ + å¹¶è¡Œå¤„ç†</td>\n</tr>\n<tr>\n<td>ZGC</td>\n<td>âœ… æçŸ­ï¼ˆ&lt;10msï¼‰</td>\n<td>ä»…ä¸ªåˆ«é˜¶æ®µæ˜¯ STWï¼Œå‡ ä¹æ„ŸçŸ¥ä¸åˆ°</td>\n</tr>\n<tr>\n<td>Shenandoah</td>\n<td>âœ… æçŸ­</td>\n<td>é«˜åº¦å¹¶å‘ï¼ŒSTW æ—¶é—´ä¹ŸæçŸ­</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¸ºä»€ä¹ˆè¦å…³æ³¨ STWï¼Ÿ</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-6\">åœ¨å“åº”æ—¶é—´æ•æ„Ÿå‹ç³»ç»Ÿï¼ˆå¦‚åœ¨çº¿äº¤æ˜“ç³»ç»Ÿã€æ¸¸æˆæœåŠ¡å™¨ã€API ç½‘å…³ï¼‰ä¸­ï¼Œé•¿æ—¶é—´çš„ STW ä¼šé€ æˆç”¨æˆ·è¯·æ±‚å¡é¡¿ã€è¶…æ—¶ã€‚</li>\n<li class=\"lvl-6\">å› æ­¤ï¼Œé€‰æ‹© ä½ STW çš„ GCï¼ˆå¦‚ G1ã€ZGCã€Shenandoahï¼‰ å¯¹è¿™ç±»ç³»ç»Ÿè‡³å…³é‡è¦ã€‚</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"å †å†…å­˜ç»“æ„\">å †å†…å­˜ç»“æ„</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¸åŒçš„åƒåœ¾å›æ”¶å™¨å†³å®šäº†å †å†…å­˜çš„ç»“æ„ä¸åŒï¼Œä½†æ€»ä½“ä¸Šåˆ†ä¸ºä¸¤ç§ç±»å‹ï¼šåˆ†ä»£æ¨¡å‹å’Œåˆ†åŒºæ¨¡å‹ã€‚</p>\n</li>\n</ul>\n<h3 id=\"åˆ†ä»£æ¨¡å‹\">åˆ†ä»£æ¨¡å‹</h3>\n<h4 id=\"Parallel-åƒåœ¾å›æ”¶å™¨\">Parallel åƒåœ¾å›æ”¶å™¨</h4>\n<p><img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/uPic/Apr5aY.png\" alt=\"\"></p>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å †ç»“æ„è¢«åˆ’åˆ†ä¸º <code>Old Generationï¼ˆè€å¹´ä»£ï¼‰</code> å’Œ <code>Young Generationï¼ˆæ–°ç”Ÿä»£ï¼‰</code> ä¸¤éƒ¨åˆ†ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><code>Young Generation</code> ç”± <code>Eden</code> å’Œ ä¸¤ä¸ª <code>Survivor</code> ç»„æˆï¼Œå…¶ä¸­ <code>Eden</code> æ˜¯ä¸€ä¸ªè¿ç»­çš„å†…å­˜åŒºåŸŸï¼Œ<code>Survivor</code> æ˜¯ä¸€ä¸ªéè¿ç»­çš„å†…å­˜åŒºåŸŸã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œ<code>Young Generation</code>å å †å†…å­˜çš„ <code>1/3</code>,  <code>Old Generation</code> å å †å†…å­˜çš„ <code>2/3</code>ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œ<code>Eden:S0:S1 = 8:1:1</code> ,å¦‚æœå¸Œæœ›ä¸º 4:1:1ï¼Œä½¿ç”¨ <code>-XX:SurvivorRatio=4</code>ï¼Œä½†å®é™…ä¸Šè¿™ä¸ªæ¯”ä¾‹å¹¶ä¸æ˜¯å›ºå®šçš„ï¼Œè€Œæ˜¯ç”±jvmåŸºäºæƒ…å†µè‡ªåŠ¨å˜åŒ–çš„ï¼Œå› ä¸ºJVMé»˜è®¤å¼€å¯äº†è¿™ä¸ªå‚æ•°<code>-XX:+UseAdaptiveSizePolicy</code>ï¼Œå¦‚æœå¸Œæœ›å›ºå®šè¿™ä¸ªæ¯”ä¾‹ï¼Œå¯ä»¥è®¾ç½®ä¸º <code>-XX:-UseAdaptiveSizePolicy</code>æ¥å…³é—­è¿™ä¸ªé…ç½®ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œå¯¹è±¡æœ€å¤šç»å†<code>15æ¬¡</code>Minor GCåè¿›å…¥è€å¹´ä»£ï¼Œå¯ä»¥é€šè¿‡ <code>-XX:MaxTenuringThreshold=n</code> è®¾ç½®ã€‚</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>åŒºåŸŸ</th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>Eden</strong></td>\n<td>å¯¹è±¡é¦–æ¬¡åˆ›å»ºçš„åŒºåŸŸï¼Œå¤§éƒ¨åˆ†å¯¹è±¡åœ¨è¿™é‡Œåˆ›å»ºå¹¶å¾ˆå¿«è¢«å›æ”¶</td>\n</tr>\n<tr>\n<td><strong>S0/S1</strong></td>\n<td>Survivor åŒºåŸŸï¼šä¸¤ä¸ªäº¤æ›¿ä½¿ç”¨çš„ç¼“å†²åŒºï¼ˆFrom å’Œ Toï¼‰ï¼Œç”¨äºæ‹·è´å­˜æ´»å¯¹è±¡</td>\n</tr>\n<tr>\n<td><strong>Old</strong></td>\n<td>è€å¹´ä»£ï¼šå­˜æ´»æ¬¡æ•°å¤šã€ç”Ÿå‘½å‘¨æœŸé•¿çš„å¯¹è±¡ä¼šä»æ–°ç”Ÿä»£æ™‹å‡åˆ°è€å¹´ä»£ï¼Œå›æ”¶é¢‘ç‡ä½</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¯¹è±¡å†…å­˜åˆ†é…å›¾è§£(ç®€åŒ–)</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">åˆ›å»ºå¯¹è±¡</span><br><span class=\"line\">   â†“</span><br><span class=\"line\">è¿›å…¥ Eden åŒºï¼ˆæ–°ç”Ÿä»£ï¼‰</span><br><span class=\"line\">   â†“ Eden åŒºæ»¡</span><br><span class=\"line\">ç¬¬ä¸€æ¬¡ Minor GCï¼ˆå­˜æ´»å¯¹è±¡[Eden]å¤åˆ¶åˆ° S0ï¼‰</span><br><span class=\"line\">   â†“ Eden åŒºæ»¡ æˆ– S0 åŒºæ»¡</span><br><span class=\"line\">ç¬¬äºŒæ¬¡ Minor GCï¼ˆå­˜æ´»å¯¹è±¡[Edenå’ŒS0]å¤åˆ¶åˆ° S1ï¼Œå¹´é¾„ +1ï¼‰</span><br><span class=\"line\">   â†“ Eden åŒºæ»¡ æˆ– S1 åŒºæ»¡</span><br><span class=\"line\">ç¬¬ä¸‰æ¬¡ Minor GCï¼ˆå­˜æ´»å¯¹è±¡[Edenå’ŒS1]å¤åˆ¶åˆ° S0ï¼Œå¹´é¾„ +1ï¼‰</span><br><span class=\"line\">   â†“</span><br><span class=\"line\">â€¦â€¦  S0/S1 äº¤æ›¿ï¼Œå¹´é¾„è¾¾åˆ°é˜ˆå€¼ï¼ˆå¦‚ 15ï¼‰</span><br><span class=\"line\">   â†“ è¿˜æ²¡æœ‰è¢«å›æ”¶</span><br><span class=\"line\">æ™‹å‡åˆ° Old åŒºï¼ˆè€å¹´ä»£ï¼‰ï¼Œç­‰å¾…OldåŒºæ»¡ è§¦å‘ Full GC</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¤§å¯¹è±¡ç›´æ¥è¿›å…¥è€å¹´ä»£</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-6\">å¤§å¯¹è±¡å°±æ˜¯éœ€è¦å¤§é‡è¿ç»­å†…å­˜ç©ºé—´çš„å¯¹è±¡ï¼ˆæ¯”å¦‚ï¼šå­—ç¬¦ä¸²ã€æ•°ç»„ï¼‰ï¼Œå¦‚æœå¯¹è±¡å¾ˆå¤§ï¼ˆå¦‚è¶…è¿‡ Eden åŒºå¤§å°ï¼Œæˆ–æ˜¯è¶…è¿‡ Survivor åŒºå¤§å°ï¼‰ï¼Œå¯èƒ½ç›´æ¥åˆ†é…åˆ°è€å¹´ä»£</li>\n<li class=\"lvl-6\">ä¹Ÿå¯ä»¥é€šè¿‡ <code>-XX:PretenureSizeThreshold=&lt;å¤§å°ï¼Œå•ä½å­—èŠ‚&gt;</code> æ§åˆ¶è¶…è¿‡ä¸€å®šå¤§å°çš„å¯¹è±¡æ˜¯å¦ç›´æ¥åˆ†é…åˆ°è€å¹´ä»£ï¼ˆOld Generationï¼‰ï¼Œè·³è¿‡æ–°ç”Ÿä»£ï¼ˆEdenï¼‰ï¼Œä»¥é¿å…å¤§å¯¹è±¡é¢‘ç¹åœ¨å¹´è½»ä»£é€ æˆ GC å‹åŠ›ã€‚è¿™ä¸ªå‚æ•°åªåœ¨ Serial å’ŒParNewä¸¤ä¸ªæ”¶é›†å™¨ä¸‹æœ‰æ•ˆã€‚</li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<p>å¯¹è±¡åŠ¨æ€å¹´é¾„åˆ¤æ–­</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-6\">å¯¹è±¡åœ¨SurvivoråŒºæ¥å›ç§»åŠ¨æ—¶ï¼Œå¦‚æœè¿™æ‰¹å¯¹è±¡çš„æ€»å¤§å°å¤§äºè¿™å—SurvivoråŒºåŸŸå†…å­˜å¤§å°çš„50%(-XX:TargetSurvivorRatioå¯ä»¥æŒ‡å®š)ï¼Œé‚£ä¹ˆæ­¤æ—¶å¤§äºç­‰äºè¿™æ‰¹å¯¹è±¡å¹´é¾„æœ€å¤§å€¼çš„å¯¹è±¡ï¼Œå°±å¯ä»¥ç›´æ¥è¿›å…¥è€å¹´ä»£äº†ï¼Œ</li>\n<li class=\"lvl-6\">ä¾‹å¦‚SurvivoråŒºåŸŸé‡Œç°åœ¨æœ‰ä¸€æ‰¹å¯¹è±¡ï¼Œå¹´é¾„1+å¹´é¾„2+å¹´é¾„nçš„å¤šä¸ªå¹´é¾„å¯¹è±¡æ€»å’Œè¶…è¿‡äº†SurvivoråŒºåŸŸçš„50%ï¼Œæ­¤æ—¶å°±ä¼šæŠŠå¹´é¾„n(å«)ä»¥ä¸Šçš„å¯¹è±¡éƒ½æ”¾å…¥è€å¹´ä»£ã€‚è¿™ä¸ªè§„åˆ™å…¶å®æ˜¯å¸Œæœ›é‚£äº›å¯èƒ½æ˜¯é•¿æœŸå­˜æ´»çš„å¯¹è±¡ï¼Œå°½æ—©è¿›å…¥è€å¹´ä»£ã€‚</li>\n<li class=\"lvl-6\">å¯¹è±¡åŠ¨æ€å¹´é¾„åˆ¤æ–­æœºåˆ¶ä¸€èˆ¬æ˜¯åœ¨minor gcä¹‹åè§¦å‘çš„ã€‚</li>\n</ul>\n</li>\n</ul>\n<div class=\"tips\">\n<ul class=\"lvl-1\">\n<li class=\"lvl-2\">\n<p>å¯¹è±¡é€ƒé€¸åˆ†æ</p>\n<ul class=\"lvl-3\">\n<li class=\"lvl-6\">å¦‚æœå¯¹è±¡å¾ˆå°ï¼Œä¸”åªåœ¨æ–¹æ³•å†…éƒ¨ä½¿ç”¨ï¼Œå¹¶æ²¡æœ‰è¢«å¤–éƒ¨å¼•ç”¨ï¼Œåˆ™å…¶æœ‰å¯èƒ½ç›´æ¥åˆ†é…åˆ°æ ˆå†…å­˜ï¼Œè€Œä¸è¿›å…¥å †å†…å­˜</li>\n<li class=\"lvl-6\">JVMå¯¹äºè¿™ç§æƒ…å†µå¯ä»¥é€šè¿‡å¼€å¯é€ƒé€¸åˆ†æå‚æ•°(-XX:+DoEscapeAnalysis)æ¥ä¼˜åŒ–å¯¹è±¡å†…å­˜åˆ†é…ä½ç½®ï¼Œä½¿å…¶é€šè¿‡<code>æ ‡é‡æ›¿æ¢</code>ä¼˜å…ˆåˆ†é…åœ¨æ ˆä¸Š(æ ˆä¸Šåˆ†é…)ï¼ŒJDK7ä¹‹åé»˜è®¤å¼€å¯é€ƒé€¸åˆ†æï¼Œå¦‚æœè¦å…³é—­ä½¿ç”¨å‚æ•°(-XX:-DoEscapeAnalysis)</li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<p>æ ‡é‡æ›¿æ¢</p>\n<ul class=\"lvl-3\">\n<li class=\"lvl-6\">é€šè¿‡é€ƒé€¸åˆ†æç¡®å®šè¯¥å¯¹è±¡ä¸ä¼šè¢«å¤–éƒ¨è®¿é—®ï¼Œå¹¶ä¸”å¯¹è±¡å¯ä»¥è¢«è¿›ä¸€æ­¥åˆ†è§£æ—¶ï¼ŒJVMä¸ä¼šåˆ›å»ºè¯¥å¯¹è±¡ï¼Œè€Œæ˜¯å°†è¯¥å¯¹è±¡æˆå‘˜å˜é‡åˆ†è§£è‹¥å¹²ä¸ªè¢«è¿™ä¸ªæ–¹æ³•ä½¿ç”¨çš„æˆå‘˜å˜é‡æ‰€ä»£æ›¿ï¼Œè¿™äº›ä»£æ›¿çš„æˆå‘˜å˜é‡åœ¨æ ˆå¸§æˆ–å¯„å­˜å™¨ä¸Šåˆ†é…ç©ºé—´ï¼Œè¿™æ ·å°±ä¸ä¼šå› ä¸ºæ²¡æœ‰ä¸€å¤§å—è¿ç»­ç©ºé—´å¯¼è‡´å¯¹è±¡å†…å­˜ä¸å¤Ÿåˆ†é…ã€‚</li>\n<li class=\"lvl-6\">å¼€å¯æ ‡é‡æ›¿æ¢å‚æ•°(-XX:+EliminateAllocations)ï¼ŒJDK7ä¹‹åé»˜è®¤å¼€å¯ã€‚</li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<p>æ ‡é‡ä¸èšåˆé‡</p>\n<ul class=\"lvl-3\">\n<li class=\"lvl-6\">æ ‡é‡å³ä¸å¯è¢«è¿›ä¸€æ­¥åˆ†è§£çš„é‡ï¼Œè€ŒJAVAçš„åŸºæœ¬æ•°æ®ç±»å‹å°±æ˜¯æ ‡é‡ï¼ˆå¦‚ï¼šintï¼Œlongç­‰åŸºæœ¬æ•°æ®ç±»å‹ä»¥åŠreferenceç±»å‹ç­‰ï¼‰ï¼Œ</li>\n<li class=\"lvl-6\">æ ‡é‡çš„å¯¹ç«‹å°±æ˜¯å¯ä»¥è¢«è¿›ä¸€æ­¥åˆ†è§£çš„é‡ï¼Œè€Œè¿™ç§é‡ç§°ä¹‹ä¸ºèšåˆé‡ã€‚è€Œåœ¨JAVAä¸­å¯¹è±¡å°±æ˜¯å¯ä»¥è¢«è¿›ä¸€æ­¥åˆ†è§£çš„èšåˆé‡ã€‚</li>\n</ul>\n</li>\n</ul>\n</div>\n<h4 id=\"Parallel-åƒåœ¾å›æ”¶å™¨ï¼ˆParallel-GCï¼‰-çš„å·¥ä½œæ–¹å¼\">Parallel åƒåœ¾å›æ”¶å™¨ï¼ˆParallel GCï¼‰ çš„å·¥ä½œæ–¹å¼</h4>\n<p><img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/uPic/fo2Egs.png\" alt=\"\" width=\"1200\" height=\"600\"></p>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Parallel GC æ˜¯å¤šçº¿ç¨‹åƒåœ¾å›æ”¶å™¨ï¼Œå¯ä»¥é€šè¿‡ <code>-XX:ParallelGCThreads</code> æ¥è®¾ç½®GCçº¿ç¨‹æ•°é‡ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å½“ Parallel GC è¢«è§¦å‘ï¼ˆä¾‹å¦‚ Minor GC æˆ– Full GCï¼‰æ—¶ï¼Œæ‰€æœ‰ç”¨æˆ·çº¿ç¨‹ è¢«å®Œå…¨æš‚åœï¼ˆStop-The-World, STWï¼‰</p>\n</li>\n</ul>\n<h4 id=\"Parallel-GC-å‚æ•°é…ç½®è¡¨ï¼ˆååé‡ä¼˜å…ˆ-GCï¼‰\">Parallel GC å‚æ•°é…ç½®è¡¨ï¼ˆååé‡ä¼˜å…ˆ GCï¼‰</h4>\n<table>\n<thead>\n<tr>\n<th>å‚æ•°å</th>\n<th>è¯´æ˜</th>\n<th>é»˜è®¤å€¼ï¼ˆå¦‚æœªç‰¹åˆ«è¯´æ˜ï¼‰</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>-XX:+UseParallelGC</code></td>\n<td>å¼€å¯ Parallel GCï¼Œç”¨äºæ–°ç”Ÿä»£æ”¶é›†</td>\n<td>-</td>\n</tr>\n<tr>\n<td><code>-XX:+UseParallelOldGC</code></td>\n<td>å¼€å¯è€å¹´ä»£å¹¶è¡Œæ”¶é›†ï¼ˆParallel Oldï¼‰</td>\n<td>-</td>\n</tr>\n<tr>\n<td><code>-XX:ParallelGCThreads</code></td>\n<td>åƒåœ¾å›æ”¶æ—¶çš„å¹¶è¡Œçº¿ç¨‹æ•°ï¼ˆä¸ CPU æ•°é‡ç›¸å…³ï¼‰</td>\n<td>æ ¹æ®ç¡¬ä»¶è‡ªåŠ¨é…ç½®</td>\n</tr>\n<tr>\n<td><code>-XX:MaxGCPauseMillis</code></td>\n<td>è®¾ç½® GC æœ€å¤§æš‚åœæ—¶é—´ç›®æ ‡ï¼ˆå½±å“å†…å­˜åˆ†é…ç­–ç•¥ï¼‰</td>\n<td>ä¸€ä¸ªéå¸¸å¤§çš„å€¼ï¼Œå¯ä»¥è®¤ä¸ºæ— é™åˆ¶ï¼ˆå»ºè®®æŒ‰éœ€è®¾ç½®ï¼‰</td>\n</tr>\n<tr>\n<td><code>-XX:GCTimeRatio</code></td>\n<td>è®¾ç½® GC æ—¶é—´ä¸åº”ç”¨è¿è¡Œæ—¶é—´çš„æ¯”å€¼ï¼ˆ0~100ï¼‰<br>å€¼è¶Šå°ï¼ŒGC è¶Šé¢‘ç¹ï¼Œå€¼è¶Šå¤§ GC è¶Šå°‘</td>\n<td>99ï¼ˆè¡¨ç¤º 1% ç”¨äº GCï¼Œ99% ç”¨äºåº”ç”¨ï¼‰</td>\n</tr>\n<tr>\n<td><code>-XX:+UseAdaptiveSizePolicy</code></td>\n<td>å¯ç”¨è‡ªé€‚åº” GC ç­–ç•¥ï¼ˆæ ¹æ®è¿è¡ŒçŠ¶å†µè‡ªåŠ¨è°ƒæ•´å„åŒºåŸŸå¤§å°ï¼‰</td>\n<td>é»˜è®¤å¼€å¯</td>\n</tr>\n<tr>\n<td><code>-XX:SurvivorRatio</code></td>\n<td>Eden ä¸ Survivor çš„å†…å­˜æ¯”ä¾‹ï¼ˆå¦‚ 8 è¡¨ç¤º Eden:S0:S1 = 8:1:1ï¼‰</td>\n<td>8</td>\n</tr>\n<tr>\n<td><code>-XX:InitialTenuringThreshold</code></td>\n<td>å¯¹è±¡æ™‹å‡åˆ°è€å¹´ä»£çš„åˆå§‹å¹´é¾„ï¼ˆä¼šéšè¿è¡ŒåŠ¨æ€è°ƒæ•´ï¼‰</td>\n<td>7</td>\n</tr>\n<tr>\n<td><code>-XX:MaxTenuringThreshold</code></td>\n<td>æ™‹å‡åˆ°è€å¹´ä»£çš„æœ€å¤§å¹´é¾„ï¼ˆå¯¹è±¡åœ¨ Survivor åŒºç»å†å‡ æ¬¡ GCï¼‰</td>\n<td>15</td>\n</tr>\n<tr>\n<td><code>-XX:PretenureSizeThreshold</code></td>\n<td>è®¾ç½®å¤§å¯¹è±¡é˜ˆå€¼ï¼Œè¶…è¿‡è¯¥å¤§å°çš„å¯¹è±¡ç›´æ¥åˆ†é…åˆ°è€å¹´ä»£</td>\n<td>0ï¼ˆå³ç¦ç”¨ï¼‰</td>\n</tr>\n<tr>\n<td><code>-XX:+ScavengeBeforeFullGC</code></td>\n<td>åœ¨ Full GC ä¹‹å‰æ˜¯å¦å…ˆæ‰§è¡Œä¸€æ¬¡ Minor GC</td>\n<td>trueå¯</td>\n</tr>\n<tr>\n<td><code>-XX:+UseFastAccessorMethods</code></td>\n<td>ä¼˜åŒ–åŸå§‹ç±»å‹çš„ get/set æ–¹æ³•æ€§èƒ½</td>\n<td>falseå¯</td>\n</tr>\n<tr>\n<td><code>-XX:+AlwaysPreTouch</code></td>\n<td>JVM å¯åŠ¨æ—¶ç«‹å³åˆ†é…å¹¶åˆå§‹åŒ–æ‰€æœ‰å†…å­˜é¡µï¼Œé¿å…è¿è¡Œæ—¶é¦–æ¬¡åˆ†é…å¸¦æ¥çš„åœé¡¿</td>\n<td>false</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"åˆ†åŒºæ¨¡å‹\">åˆ†åŒºæ¨¡å‹</h3>\n<h4 id=\"G1-åƒåœ¾å›æ”¶å™¨\">G1 åƒåœ¾å›æ”¶å™¨</h4>\n<p><img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/uPic/AaqBxm.png\" alt=\"\" width=\"900\" height=\"300\"></p>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>G1(Garbage-First) å±äº ç‰©ç†ä¸Šåˆ†åŒºï¼Œé€»è¾‘ä¸Šåˆ†ä»£ï¼ŒçœŸæ­£çš„åˆ†åŒºæ¨¡å‹æ˜¯ <code>ZGC</code>ï¼ˆjdk21åä¹Ÿæ”¯æŒåˆ†ä»£ï¼‰</p>\n</li>\n<li class=\"lvl-2\">\n<p>G1å°†Javaå †åˆ’åˆ†ä¸ºå¤šä¸ªå¤§å°ç›¸ç­‰çš„ç‹¬ç«‹åŒºåŸŸï¼ˆRegionï¼‰ï¼Œåœ¨JDK10ä»¥å‰ï¼ŒJVMæœ€å¤šå¯ä»¥æœ‰<code>2048</code>ä¸ªRegionï¼Œæ¯ä¸ª Region çš„å¤§å°æ˜¯ 2^n MBï¼Œå¹¶ä¸”è½åœ¨ 1MB åˆ° 32MB ä¹‹é—´ï¼Œè¿™å°±å¯¼è‡´G1æœ€å¤§æ”¯æŒ64G çš„å † (<code>2048 Regions Ã— 32MB = 64GB</code>)ï¼Œåœ¨JDK10ä»¥åï¼ŒG1 æ”¯æŒ æ›´å¤š Regionï¼ˆæœ€å¤šçº¦ 32,768 ä¸ªï¼‰ï¼Œè€ŒRegion å¤§å°ä»æ˜¯ 1MBï½32MB çš„ 2 çš„å¹‚ï¼Œä½¿å…¶æœ€å¤§å¯ä»¥æ”¯æŒ 1T  çš„å †ã€‚JDK17å¼€å§‹ï¼ŒHotSpot JVM å·²æ”¹è¿› G1 çš„ Region æ˜ å°„æ–¹å¼ï¼ˆå¦‚æå‡æ¯ä¸ªRegionçš„å¤§å°ï¼‰ï¼Œå¯ä»¥è¿›ä¸€æ­¥æå‡æ”¯æŒçš„å †å¤§å°ä¸Šé™ã€‚ä½†å †è¶Šå¤§ï¼ŒFullGCå°±è¶Šæ…¢ï¼Œå»ºè®® <code>&gt;1T</code> çš„å †ä½¿ç”¨<code>ZGC</code>æˆ–<code>Shenandoah GC</code>ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä¸€èˆ¬Regionå¤§å°ç”±JVMè‡ªåŠ¨è®¡ç®—ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ç”¨å‚æ•°<code>-XX:G1HeapRegionSize</code>æ‰‹åŠ¨æŒ‡å®šRegionå¤§å°ï¼Œä½†æ˜¯æ¨èé»˜è®¤çš„è®¡ç®—æ–¹å¼ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>G1ä¿ç•™äº†å¹´è½»ä»£å’Œè€å¹´ä»£çš„æ¦‚å¿µï¼Œä½†ä¸å†æ˜¯ç‰©ç†éš”é˜‚äº†ï¼Œå®ƒä»¬éƒ½æ˜¯ï¼ˆå¯ä»¥ä¸è¿ç»­ï¼‰Regionçš„é›†åˆã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>åœ¨ G1 GC ä¸­ï¼Œä¸è¦ä½¿ç”¨ <code>-Xmn</code>ï¼ŒG1 ä¸­æ¨èä½¿ç”¨ä»¥ä¸‹æ›´ç»†ç²’åº¦çš„æ§åˆ¶æ–¹å¼ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># è¿™æ˜¯å®éªŒæ€§å‚æ•°ï¼Œéœ€è¦å¼€å¯ `-XX:+UnlockExperimentalVMOptions`ï¼Œä½†ä¾æ—§æ¨èåœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨</span></span><br><span class=\"line\">-XX:G1NewSizePercent=5</span><br><span class=\"line\">-XX:G1MaxNewSizePercent=60</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>é»˜è®¤å¹´è½»ä»£å¯¹å †å†…å­˜çš„å æ¯”æ˜¯<code>5%</code>ï¼Œå¦‚æœå †å¤§å°ä¸º4096Mï¼Œé‚£ä¹ˆå¹´è½»ä»£å æ®200MBå·¦å³çš„å†…å­˜ï¼Œå¯¹åº”å¤§æ¦‚æ˜¯100ä¸ªRegionï¼Œå¯ä»¥é€šè¿‡   <code>-XX:G1NewSizePercent</code>è®¾ç½®æ–°ç”Ÿä»£åˆå§‹å æ¯”ï¼Œè¿™æ˜¯å®éªŒæ€§å‚æ•°ï¼Œéœ€è¦å¼€å¯ <code>-XX:+UnlockExperimentalVMOptions</code>ï¼Œä½†ä¾æ—§æ¨èåœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>åœ¨ç³»ç»Ÿè¿è¡Œä¸­ï¼ŒJVMä¼šä¸åœçš„ç»™å¹´è½»ä»£å¢åŠ æ›´å¤šçš„Regionï¼Œä½†æ˜¯æœ€å¤šæ–°ç”Ÿä»£çš„å æ¯”ä¸ä¼šè¶…è¿‡<code>60%</code>ï¼Œå¯ä»¥é€šè¿‡<code>-XX:G1MaxNewSizePercent</code>è°ƒæ•´ï¼Œè¿™æ˜¯å®éªŒæ€§å‚æ•°ï¼Œéœ€è¦å¼€å¯ <code>-XX:+UnlockExperimentalVMOptions</code>ï¼Œä½†ä¾æ—§æ¨èåœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å¹´è½»ä»£ä¸­çš„Edenå’ŒSurvivorå¯¹åº”çš„regionä¹Ÿè·Ÿä¹‹å‰ä¸€æ ·ï¼Œé»˜è®¤<code>8:1:1</code>ï¼Œå‡è®¾å¹´è½»ä»£ç°åœ¨æœ‰1000ä¸ªregionï¼ŒedenåŒºå¯¹åº”800ä¸ªï¼Œs0å¯¹åº”100ä¸ªï¼Œs1å¯¹åº”100ä¸ªã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä¸€ä¸ªRegionå¯èƒ½ä¹‹å‰æ˜¯å¹´è½»ä»£ï¼Œå¦‚æœRegionè¿›è¡Œäº†åƒåœ¾å›æ”¶ï¼Œä¹‹åå¯èƒ½åˆä¼šå˜æˆè€å¹´ä»£ï¼Œä¹Ÿå°±æ˜¯è¯´Regionçš„åŒºåŸŸåŠŸèƒ½å¯èƒ½ä¼šåŠ¨æ€å˜åŒ–ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>G1åƒåœ¾æ”¶é›†å™¨å¯¹äºå¯¹è±¡ä»€ä¹ˆæ—¶å€™ä¼šè½¬ç§»åˆ°è€å¹´ä»£è·Ÿä¹‹å‰è®²è¿‡çš„åŸåˆ™ä¸€æ ·ï¼Œå”¯ä¸€ä¸åŒçš„æ˜¯å¯¹å¤§å¯¹è±¡çš„å¤„ç†ï¼ŒG1æœ‰ä¸“é—¨åˆ†é…å¤§å¯¹è±¡çš„Regionå«<code>Humongous</code>åŒºï¼Œè€Œä¸æ˜¯è®©å¤§å¯¹è±¡ç›´æ¥è¿›å…¥è€å¹´ä»£çš„Regionä¸­ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>åœ¨G1ä¸­ï¼Œå¤§å¯¹è±¡çš„åˆ¤å®šè§„åˆ™å°±æ˜¯ä¸€ä¸ªå¤§å¯¹è±¡è¶…è¿‡äº†ä¸€ä¸ªRegionå¤§å°çš„<code>50%</code>ï¼Œæ¯”å¦‚æŒ‰ç…§ä¸Šé¢ç®—çš„ï¼Œæ¯ä¸ªRegionæ˜¯2Mï¼Œåªè¦ä¸€ä¸ªå¤§å¯¹è±¡è¶…è¿‡äº†1Mï¼Œå°±ä¼šè¢«æ”¾å…¥Humongousä¸­ï¼Œè€Œä¸”ä¸€ä¸ªå¤§å¯¹è±¡å¦‚æœå¤ªå¤§ï¼Œå¯èƒ½ä¼šæ¨ªè·¨å¤šä¸ªRegionæ¥å­˜æ”¾ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>HumongousåŒºä¸“é—¨å­˜æ”¾çŸ­æœŸå·¨å‹å¯¹è±¡ï¼Œä¸ç”¨ç›´æ¥è¿›è€å¹´ä»£ï¼Œå¯ä»¥èŠ‚çº¦è€å¹´ä»£çš„ç©ºé—´ï¼Œé¿å…å› ä¸ºè€å¹´ä»£ç©ºé—´ä¸å¤Ÿçš„GCå¼€é”€ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>Full GCçš„æ—¶å€™é™¤äº†æ”¶é›†å¹´è½»ä»£å’Œè€å¹´ä»£ä¹‹å¤–ï¼Œä¹Ÿä¼šå°†HumongousåŒºä¸€å¹¶å›æ”¶ã€‚</p>\n</li>\n</ul>\n<h5 id=\"G1åƒåœ¾æ”¶é›†åˆ†ç±»\">G1åƒåœ¾æ”¶é›†åˆ†ç±»</h5>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>YoungGC<br>\nYoungGCå¹¶ä¸æ˜¯è¯´ç°æœ‰çš„EdenåŒºæ”¾æ»¡äº†å°±ä¼šé©¬ä¸Šè§¦å‘ï¼ŒG1ä¼šè®¡ç®—ä¸‹ç°åœ¨EdenåŒºå›æ”¶å¤§æ¦‚è¦å¤šä¹…æ—¶é—´ï¼Œå¦‚æœå›æ”¶æ—¶é—´è¿œè¿œå°äºå‚æ•° <code>-XX:MaxGCPauseMills</code> è®¾å®šçš„å€¼ï¼Œé‚£ä¹ˆå¢åŠ å¹´è½»ä»£çš„regionï¼Œç»§ç»­ç»™æ–°å¯¹è±¡å­˜æ”¾ï¼Œä¸ä¼šé©¬ä¸ŠåšYoungGCï¼Œç›´åˆ°ä¸‹ä¸€æ¬¡EdenåŒºæ”¾æ»¡ï¼ŒG1è®¡ç®—å›æ”¶æ—¶é—´æ¥è¿‘å‚æ•° <code>-XX:MaxGCPauseMills</code> è®¾å®šçš„å€¼ï¼Œé‚£ä¹ˆå°±ä¼šè§¦å‘Young GC</p>\n</li>\n<li class=\"lvl-2\">\n<p>MixedGC<br>\nä¸æ˜¯FullGCï¼Œè€å¹´ä»£çš„å †å æœ‰ç‡è¾¾åˆ°å‚æ•° <code>-XX:InitiatingHeapOccupancyPercent</code> è®¾å®šçš„å€¼åˆ™è§¦å‘ï¼Œå›æ”¶æ‰€æœ‰çš„Youngå’Œéƒ¨åˆ†Old(æ ¹æ®æœŸæœ›çš„GCåœé¡¿æ—¶é—´ç¡®å®šoldåŒºåƒåœ¾æ”¶é›†çš„ä¼˜å…ˆé¡ºåº)ä»¥åŠå¤§å¯¹è±¡åŒºï¼Œæ­£å¸¸æƒ…å†µG1çš„åƒåœ¾æ”¶é›†æ˜¯å…ˆåšMixedGCï¼Œä¸»è¦ä½¿ç”¨å¤åˆ¶ç®—æ³•ï¼Œéœ€è¦æŠŠå„ä¸ªregionä¸­å­˜æ´»çš„å¯¹è±¡æ‹·è´åˆ°åˆ«çš„regioné‡Œå»ï¼Œæ‹·è´è¿‡ç¨‹ä¸­å¦‚æœå‘ç°æ²¡æœ‰è¶³å¤Ÿçš„ç©ºregionèƒ½å¤Ÿæ‰¿è½½æ‹·è´å¯¹è±¡å°±ä¼šè§¦å‘ä¸€æ¬¡Full GC</p>\n</li>\n<li class=\"lvl-2\">\n<p>Full GC<br>\nåœæ­¢ç³»ç»Ÿç¨‹åºï¼Œç„¶åé‡‡ç”¨å•çº¿ç¨‹è¿›è¡Œæ ‡è®°ã€æ¸…ç†å’Œå‹ç¼©æ•´ç†ï¼Œå¥½ç©ºé—²å‡ºæ¥ä¸€æ‰¹Regionæ¥ä¾›ä¸‹ä¸€æ¬¡MixedGCä½¿ç”¨ï¼Œè¿™ä¸ªè¿‡ç¨‹æ˜¯éå¸¸è€—æ—¶çš„ã€‚(Shenandoahä¼˜åŒ–æˆå¤šçº¿ç¨‹æ”¶é›†äº†)</p>\n</li>\n</ul>\n<h4 id=\"G1-æ”¶é›†å™¨çš„å·¥ä½œæ–¹å¼\">G1 æ”¶é›†å™¨çš„å·¥ä½œæ–¹å¼</h4>\n<p><img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/uPic/XbkEoh.png\" alt=\"\" width=\"1200\" height=\"400\"></p>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å›¾ä¸­ä¸»è¦å±•ç¤ºäº†ä¸€ä¸ªå…¸å‹çš„ G1 GC çš„ å¹¶å‘æ ‡è®°å‘¨æœŸï¼ˆConcurrent Mark Cycleï¼‰ çš„è¿‡ç¨‹ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å›¾ä¸­çš„æ°´å¹³ç®­å¤´è¡¨ç¤ºå„çº¿ç¨‹ï¼ˆç”¨æˆ·çº¿ç¨‹å’ŒGCçº¿ç¨‹ï¼‰çš„æ‰§è¡Œè·¯å¾„ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ç«–ç›´çš„<code>Safepoint</code>çº¿è¡¨ç¤ºä¸€æ¬¡GCè¿‡ç¨‹ä¸­ä¼šæš‚åœæ‰€æœ‰ç”¨æˆ·çº¿ç¨‹çš„æ—¶åˆ»ï¼ˆStop-The-Worldï¼‰ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1ï¸âƒ£ åˆå§‹æ ‡è®°ï¼ˆInitial Markï¼‰</span><br><span class=\"line\">    è¿›å…¥ Safepointï¼š æ‰€æœ‰ç”¨æˆ·çº¿ç¨‹åœ¨æ­¤åˆ»æš‚åœï¼ˆSTWï¼‰ã€‚</span><br><span class=\"line\">    æ ‡è®° GC Roots ç›´æ¥å¯è¾¾å¯¹è±¡ã€‚</span><br><span class=\"line\">    éå¸¸çŸ­æš‚ï¼Œä½†å±äº Stop-The-World é˜¶æ®µã€‚</span><br><span class=\"line\">    å›¾ä¸­æ˜¯â€œåˆå§‹æ ‡è®°â€ç®­å¤´åœ¨ Safepoint ä¹‹åç«‹åˆ»æ‰§è¡Œã€‚</span><br><span class=\"line\"></span><br><span class=\"line\">2ï¸âƒ£ å¹¶å‘æ ‡è®°ï¼ˆConcurrent Markï¼‰</span><br><span class=\"line\">    ç”¨æˆ·çº¿ç¨‹ æ¢å¤è¿è¡Œï¼ˆå›¾ä¸­ç”¨æˆ·çº¿ç¨‹ç»§ç»­å‘å³å»¶ä¼¸ï¼‰ã€‚</span><br><span class=\"line\">    GC çº¿ç¨‹ å¹¶å‘è¿›è¡Œæ ‡è®°å·¥ä½œï¼ˆå³åœ¨ç”¨æˆ·çº¿ç¨‹è¿è¡ŒæœŸé—´è¿›è¡Œæ ‡è®°ï¼‰ã€‚</span><br><span class=\"line\">    å›¾ä¸­è“è‰²çš„â€œå¹¶å‘æ ‡è®°â€ç®­å¤´ä¸ç”¨æˆ·çº¿ç¨‹ç®­å¤´å¹¶è¡Œæ˜¾ç¤ºï¼Œè¡¨ç¤ºå¹¶å‘æ‰§è¡Œã€‚</span><br><span class=\"line\"></span><br><span class=\"line\">3ï¸âƒ£ æœ€ç»ˆæ ‡è®°ï¼ˆRemark / Final Markï¼‰</span><br><span class=\"line\">    å†æ¬¡è¿›å…¥ Safepointã€‚</span><br><span class=\"line\">    é‡æ–°æš‚åœæ‰€æœ‰ç”¨æˆ·çº¿ç¨‹ã€‚</span><br><span class=\"line\">    å¤„ç†å¹¶å‘æ ‡è®°é˜¶æ®µä¸­é—æ¼çš„å¼•ç”¨æ›´æ–°ç­‰ä¿¡æ¯ï¼Œä¿è¯æ ‡è®°çš„å‡†ç¡®æ€§ã€‚</span><br><span class=\"line\"></span><br><span class=\"line\">4ï¸âƒ£ ç­›é€‰å›æ”¶ï¼ˆCleanup / Filtered Collectionï¼‰</span><br><span class=\"line\">    å¯¹å·²æ ‡è®°çš„å¯¹è±¡åšæ¸…ç†ï¼ˆå›æ”¶ä¸å¯è¾¾å¯¹è±¡ï¼‰ã€‚</span><br><span class=\"line\">    åˆ¤æ–­æ˜¯å¦éœ€è¦å›æ”¶æŸäº› Regionã€‚</span><br><span class=\"line\">    å›¾ä¸­è“è‰²ç®­å¤´æ ‡æ³¨ä¸ºâ€œç­›é€‰å›æ”¶â€ã€‚</span><br><span class=\"line\"></span><br><span class=\"line\">5ï¸âƒ£ æ¢å¤ç”¨æˆ·çº¿ç¨‹</span><br><span class=\"line\">    åœ¨æœ€åä¸€ä¸ª Safepoint ä¹‹åï¼Œæ‰€æœ‰ç”¨æˆ·çº¿ç¨‹é‡æ–°å¼€å§‹æ‰§è¡Œï¼ˆå›¾ä¸­é»„è‰²ç®­å¤´é‡æ–°å‘å³å»¶ä¼¸ï¼‰ã€‚</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>G1çš„GC è¿‡ç¨‹ä¼šç»å†å¤šæ¬¡<code>Safepoint</code>ï¼Œä½†åªæœ‰ <code>å¹¶å‘æ ‡è®°é˜¶æ®µ</code> æ˜¯æ•´ä¸ªå‘¨æœŸä¸­æœ€è€—æ—¶ä½†ä¸ä¼šæš‚åœç”¨æˆ·çº¿ç¨‹(STW)çš„éƒ¨åˆ†ã€‚</p>\n</li>\n</ul>\n<div class=\"tips\">\n<p><em><strong>Safepointï¼ˆå®‰å…¨ç‚¹ï¼‰</strong></em></p>\n<ul class=\"lvl-1\">\n<li class=\"lvl-2\">åœ¨ JVMï¼ˆJava è™šæ‹Ÿæœºï¼‰ä¸­ï¼ŒSafepointï¼ˆå®‰å…¨ç‚¹ï¼‰ æ˜¯ä¸€ä¸ªéå¸¸é‡è¦çš„æ¦‚å¿µï¼Œå®ƒä»£è¡¨ æ‰€æœ‰çº¿ç¨‹å¿…é¡»â€œå®‰å…¨åœ°â€æš‚åœçš„æŸä¸ªæ—¶é—´ç‚¹ï¼Œä»¥ä¾¿ JVM èƒ½å¤Ÿæ‰§è¡ŒæŸäº›å…¨å±€æ“ä½œï¼Œæ¯”å¦‚ï¼š<br>\nåƒåœ¾å›æ”¶ï¼ˆGCï¼‰<br>\næ ˆéå†ï¼ˆä¾‹å¦‚ç”Ÿæˆå †å¿«ç…§ã€åšé€ƒé€¸åˆ†æç­‰ï¼‰<br>\nç±»å¸è½½<br>\nJIT ç¼–è¯‘çš„ä¸€äº›é‡å†™æ“ä½œç­‰</li>\n<li class=\"lvl-2\">å¦‚æœçº¿ç¨‹æ­£åœ¨è¿è¡Œã€æ”¹å˜å †ä¸­å¯¹è±¡çš„æ•°æ®ï¼Œé‚£ä¹ˆ GC å°±æ— æ³•å‡†ç¡®æ ‡è®°å’Œå›æ”¶å¯¹è±¡ã€‚å› æ­¤ JVM éœ€è¦ è®©æ‰€æœ‰çº¿ç¨‹åœ¨ä¸€ä¸ªâ€œå¯æ§ã€å®‰å…¨çš„ä½ç½®â€ä¸Šæš‚åœï¼Œè¿™ä¸ªä½ç½®å°±å« Safepointã€‚</li>\n<li class=\"lvl-2\">Safepoint æ˜¯æ€ä¹ˆå·¥ä½œçš„ï¼Ÿ<br>\n1.JVM å‘å‡ºâ€œè¿›å…¥ Safepointâ€çš„ä¿¡å·ï¼ˆæ¯”å¦‚è¦å¼€å§‹ GCï¼‰<br>\n2.æ‰€æœ‰çº¿ç¨‹æ”¶åˆ°ä¿¡å·åï¼Œå¿…é¡»ç­‰åˆ°â€œæœ€è¿‘çš„ Safepointâ€å†åœä¸‹æ¥ï¼š<br>\nSafepoint ä¸æ˜¯ä»»æ„ä½ç½®éƒ½å¯ä»¥åœï¼Œå®ƒåªå‡ºç°åœ¨å­—èŠ‚ç ä¸­ä¸€äº›ç‰¹å®šçš„æŒ‡ä»¤ç‚¹ï¼ˆæ¯”å¦‚æ–¹æ³•è°ƒç”¨ã€å¾ªç¯è·³è½¬ç­‰ï¼‰<br>\n3.ç­‰æ‰€æœ‰çº¿ç¨‹éƒ½è¿›å…¥ Safepoint åï¼ŒJVM æ‰èƒ½å¼€å§‹æ‰§è¡Œ GC ç­‰å…¨å±€æ“ä½œã€‚</li>\n</ul>\n</div>\n<h5 id=\"G1-æ”¶é›†å™¨å‚æ•°é…ç½®è¡¨\">G1 æ”¶é›†å™¨å‚æ•°é…ç½®è¡¨</h5>\n<table>\n<thead>\n<tr>\n<th>å‚æ•°å</th>\n<th>è¯´æ˜</th>\n<th>é»˜è®¤å€¼</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>-XX:+UseG1GC</code></td>\n<td>ä½¿ç”¨ G1 åƒåœ¾æ”¶é›†å™¨</td>\n<td>-</td>\n</tr>\n<tr>\n<td><code>-XX:ParallelGCThreads</code></td>\n<td>æŒ‡å®š GC å·¥ä½œçš„çº¿ç¨‹æ•°é‡</td>\n<td>ä¸ CPU æ•°é‡ç›¸å…³</td>\n</tr>\n<tr>\n<td><code>-XX:G1HeapRegionSize</code></td>\n<td>è®¾ç½®å †åˆ†åŒºå¤§å°ï¼ˆ1MB~32MBï¼Œ2 çš„å¹‚ï¼‰ï¼Œå †é»˜è®¤åˆ’åˆ†ä¸º 2048 ä¸ª Region</td>\n<td>è‡ªåŠ¨è®¡ç®—</td>\n</tr>\n<tr>\n<td><code>-XX:MaxGCPauseMillis</code></td>\n<td>è®¾ç½® GC ç›®æ ‡æœ€å¤§æš‚åœæ—¶é—´</td>\n<td>200ms</td>\n</tr>\n<tr>\n<td><code>-XX:G1NewSizePercent</code></td>\n<td>æ–°ç”Ÿä»£åˆå§‹å æ¯”ï¼ˆå æ•´ä¸ªå †ï¼‰ï¼Œå®éªŒæ€§å‚æ•°ï¼Œ-XX:+UnlockExperimentalVMOptions</td>\n<td>5%</td>\n</tr>\n<tr>\n<td><code>-XX:G1MaxNewSizePercent</code></td>\n<td>æ–°ç”Ÿä»£æœ€å¤§å æ¯”ï¼ˆå æ•´ä¸ªå †ï¼‰ï¼Œå®éªŒæ€§å‚æ•°ï¼Œ-XX:+UnlockExperimentalVMOptions</td>\n<td>60%</td>\n</tr>\n<tr>\n<td><code>-XX:TargetSurvivorRatio</code></td>\n<td>Survivor åŒºå¡«å……ç›®æ ‡ï¼ˆè¶…è¿‡è¯¥æ¯”ä¾‹ï¼Œæ™‹å‡è€å¹´ä»£ï¼‰</td>\n<td>50%</td>\n</tr>\n<tr>\n<td><code>-XX:MaxTenuringThreshold</code></td>\n<td>æœ€å¤§å¯¹è±¡å¹´é¾„é˜ˆå€¼ï¼ˆå¹´é¾„è¶…è¿‡å°†è¿›å…¥è€å¹´ä»£ï¼‰</td>\n<td>15</td>\n</tr>\n<tr>\n<td><code>-XX:InitiatingHeapOccupancyPercent</code></td>\n<td>æ•´ä¸ªå †çš„ä½¿ç”¨ç‡è¶…è¿‡è¯¥å€¼è§¦å‘ Mixed GC</td>\n<td>45%</td>\n</tr>\n<tr>\n<td><code>-XX:G1MixedGCLiveThresholdPercent</code></td>\n<td>Mixed GC ä¸­ï¼šRegion å­˜æ´»å¯¹è±¡å æ¯”ä½äºè¯¥å€¼æ‰ä¼šè¢«å›æ”¶ï¼Œå®éªŒæ€§å‚æ•°ï¼Œ-XX:+UnlockExperimentalVMOptions</td>\n<td>85%</td>\n</tr>\n<tr>\n<td><code>-XX:G1MixedGCCountTarget</code></td>\n<td>æ¯æ¬¡ Mixed GC çš„æœ€å¤§å›æ”¶è½®æ¬¡</td>\n<td>8</td>\n</tr>\n<tr>\n<td><code>-XX:G1HeapWastePercent</code></td>\n<td>Mixed GC å›æ”¶ç›®æ ‡ï¼šç©ºé—² Region è¾¾å †æ€»é‡è¯¥ç™¾åˆ†æ¯”å°±ç»“æŸæ··åˆå›æ”¶</td>\n<td>5%</td>\n</tr>\n</tbody>\n</table>\n<h4 id=\"ZGC-åƒåœ¾å›æ”¶å™¨\">ZGC åƒåœ¾å›æ”¶å™¨</h4>\n<p><img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/uPic/bBUAYt.png\" alt=\"\" width=\"700\" height=\"500\"></p>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ZGC(Z Garbage Collector)æ˜¯ä¸€æ¬¾JDK 11ä¸­æ–°åŠ å…¥çš„å…·æœ‰å®éªŒæ€§è´¨çš„ä½å»¶è¿Ÿåƒåœ¾æ”¶é›†å™¨ï¼ŒZGCå¯ä»¥è¯´æºè‡ªäºæ˜¯Azul Systemå…¬å¸å¼€å‘çš„C4ï¼ˆConcurrent Continuously Compacting Collectorï¼‰ æ”¶é›†å™¨</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>Platform</th>\n<th>Supported</th>\n<th>Since</th>\n<th>Comment</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Linux/x64</td>\n<td>âœ…</td>\n<td>JDK 11</td>\n<td></td>\n</tr>\n<tr>\n<td>Linux/AArch64</td>\n<td>âœ…</td>\n<td>JDK 13</td>\n<td></td>\n</tr>\n<tr>\n<td>macOS</td>\n<td>âœ…</td>\n<td>JDK 14</td>\n<td></td>\n</tr>\n<tr>\n<td>Windows</td>\n<td>âœ…</td>\n<td>JDK 14</td>\n<td>Requires Windows version 1803 (Windows 10 or Windows Server 2019) or later.</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ZGCæ”¶é›†å™¨æ˜¯ä¸€æ¬¾åŸºäºRegionå†…å­˜å¸ƒå±€çš„ï¼Œæš‚æ—¶ä¸è®¾åˆ†ä»£çš„(jdk21åæ”¯æŒåˆ†ä»£)ï¼Œä½¿ç”¨äº†<code>è¯»å±éšœ</code>ã€<code>é¢œè‰²æŒ‡é’ˆ</code>ç­‰æŠ€æœ¯æ¥å®ç°å¯å¹¶å‘çš„æ ‡è®°-æ•´ç†ç®—æ³•çš„ï¼Œä»¥ä½å»¶è¿Ÿä¸ºé¦–è¦ç›®æ ‡çš„ä¸€æ¬¾åƒåœ¾æ”¶é›†å™¨ã€‚</p>\n</li>\n</ul>\n<div class=\"tips\">\n<p><em><strong>é¢œè‰²æŒ‡é’ˆ</strong></em></p>\n<ul class=\"lvl-1\">\n<li class=\"lvl-2\">åœ¨ ZGCï¼ˆZ Garbage Collectorï¼‰ä¸­ï¼Œé¢œè‰²æŒ‡é’ˆï¼ˆColored Pointerï¼‰æ˜¯ä¸€ç§æ ¸å¿ƒæœºåˆ¶ï¼ŒæŠŠå¯¹è±¡çš„ GC çŠ¶æ€ä¿¡æ¯ç›´æ¥åµŒå…¥åˆ°å¯¹è±¡çš„å¼•ç”¨ï¼ˆåœ°å€ï¼‰ä¸­ï¼Œç”¨äºåœ¨ä¸å¢åŠ å¯¹è±¡é¢å¤–å…ƒæ•°æ®çš„å‰æä¸‹ï¼Œè·Ÿè¸ªå¯¹è±¡åœ¨åƒåœ¾å›æ”¶è¿‡ç¨‹ä¸­çš„çŠ¶æ€ã€‚</li>\n<li class=\"lvl-2\">åœ¨ä¼ ç»Ÿ GC ä¸­ï¼Œå¯¹è±¡çš„â€œé¢œè‰²â€ï¼ˆå¦‚ç™½è‰²ã€ç°è‰²ã€é»‘è‰²ï¼‰è¡¨ç¤ºå…¶åœ¨ GC ä¸åŒé˜¶æ®µçš„çŠ¶æ€ï¼Œè¿™äº›ä¿¡æ¯ä¸€èˆ¬å­˜å‚¨åœ¨é¢å¤–çš„æ•°æ®ç»“æ„ä¸­ï¼ˆå¦‚è®°å¿†é›†åˆã€ä½å›¾ç­‰ï¼‰ã€‚</li>\n<li class=\"lvl-2\">è€Œåœ¨ ZGC ä¸­ï¼ŒZGC å°†å¯¹è±¡çš„è¿™äº›çŠ¶æ€ä¿¡æ¯ç¼–ç è¿›æŒ‡é’ˆçš„é«˜ä½ä¸­ã€‚æ‰€ä»¥ä¸€ä¸ªå¯¹è±¡å¼•ç”¨ï¼ˆpointerï¼‰ä¸ä»…ä»…æ˜¯å†…å­˜åœ°å€ï¼Œè¿˜æºå¸¦äº†å¯¹è±¡åœ¨ GC è¿‡ç¨‹ä¸­çš„â€œé¢œè‰²â€ä¿¡æ¯ã€‚</li>\n<li class=\"lvl-2\">ZGC ä¸»è¦è¿è¡Œåœ¨ 64 ä½ç³»ç»Ÿä¸Šï¼Œä½†å½“å‰çš„æ“ä½œç³»ç»Ÿå’Œ CPU å®é™…ä¸Šåªä½¿ç”¨ 48ï½57 ä½è™šæ‹Ÿåœ°å€ã€‚ZGC åˆ©ç”¨æœªä½¿ç”¨çš„é«˜ä½è¿›è¡Œç¼–ç ã€‚<br>\n<img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/uPic/LD51Zb.png\" alt=\"\" width=\"900\" height=\"300\"></li>\n<li class=\"lvl-2\">æ¯ä¸ªå¯¹è±¡æœ‰ä¸€ä¸ª64ä½æŒ‡é’ˆï¼Œè¿™64ä½è¢«åˆ†ä¸ºï¼š</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>ä½æ•°</th>\n<th>åç§°</th>\n<th>å«ä¹‰</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>18 ä½</td>\n<td>é¢„ç•™</td>\n<td>ä¿ç•™ä½ï¼Œæœªæ¥å¯èƒ½ç”¨äºæ‰©å±•åŠŸèƒ½</td>\n</tr>\n<tr>\n<td>1 ä½</td>\n<td>Finalizable</td>\n<td>è¡¨ç¤ºå¯¹è±¡å¯ç»ˆç»“ï¼ˆå³å®ç°äº† <code>finalize()</code> æ–¹æ³•ï¼‰</td>\n</tr>\n<tr>\n<td>1 ä½</td>\n<td>Remapped</td>\n<td>æ ‡è¯†å¯¹è±¡æ˜¯å¦å·²è¢«è½¬ç§»(ç”¨äºæ ‡è¯†æŸä¸ªå¼•ç”¨æ˜¯å¦å·²ç»è¢«é‡å®šå‘ï¼ˆæ›´æ–°ä¸ºæ–°åœ°å€ï¼‰)ï¼›ä¸º 1 è¡¨ç¤ºè¯¥å¯¹è±¡æœªåœ¨é‡å®šä½é›†ï¼ˆRelocation Setï¼‰ä¸­ï¼Œå³æ–°åœ°å€ï¼Œä¸º0è¡¨ç¤ºæ—§åœ°å€</td>\n</tr>\n<tr>\n<td>1 ä½</td>\n<td>Marked1</td>\n<td>æ ‡è®°ä½ä¹‹ä¸€ï¼Œç”¨äº GC è¿‡ç¨‹ä¸­çš„å¯¹è±¡æ ‡è®°é˜¶æ®µ ,ç”±äº ZGC æ˜¯å¹¶å‘ GCï¼Œéœ€è¦ä¸¤ä½æ¥æ”¯æŒé¢œè‰²åˆ‡æ¢æœºåˆ¶ï¼ˆColor Flipï¼‰ï¼Œç¡®ä¿åœ¨ä¸åŒ GC å‘¨æœŸä¸­å¯ä»¥åŒºåˆ†æ–°æ—§æ ‡è®°ï¼Œéœ€è¦è§¦å‘ä¸€æ¬¡è¯»å–å±éšœï¼ˆload barrierï¼‰ï¼Œæ‰¾åˆ°å¯¹è±¡çš„æ–°ä½ç½®ï¼Œå¹¶æ›´æ–°è¿™ä¸ªå¼•ç”¨ã€‚</td>\n</tr>\n<tr>\n<td>1 ä½</td>\n<td>Marked0</td>\n<td>å¦ä¸€ä¸ªæ ‡è®°ä½ï¼Œä¸ Marked1 é…åˆç”¨äº GC æ ‡è®°é˜¶æ®µ</td>\n</tr>\n<tr>\n<td>42 ä½</td>\n<td>å¯¹è±¡åœ°å€éƒ¨åˆ†</td>\n<td>å®é™…çš„å†…å­˜åœ°å€éƒ¨åˆ†ï¼Œæœ€å¤šå¯è¡¨ç¤º 2^42 å­—èŠ‚ï¼ˆå³ 4 TBï¼‰,jdk15åå ç”¨ 44ä½ï¼Œæ”¯æŒ 16TB</td>\n</tr>\n</tbody>\n</table>\n<p><em><strong>è¯»å±éšœ</strong></em></p>\n<ul class=\"lvl-1\">\n<li class=\"lvl-2\">\n<p>ZGCï¼ˆZ Garbage Collectorï¼‰ä¸­çš„**è¯»å±éšœï¼ˆRead Barrierï¼‰æ˜¯å…¶æ ¸å¿ƒæœºåˆ¶ä¹‹ä¸€ï¼Œå®ƒä¿è¯äº†å¹¶å‘å‹ç¼©ï¼ˆå¯¹è±¡ç§»åŠ¨ï¼‰**æ—¶ç¨‹åºçš„æ­£ç¡®æ€§ï¼Œæ˜¯å®ç°ä½å»¶è¿Ÿã€é«˜å¹¶å‘åƒåœ¾å›æ”¶çš„å…³é”®ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>åœ¨ä¼ ç»Ÿ GC ä¸­ï¼Œå¦‚æœå¯¹è±¡åœ¨ GC è¿‡ç¨‹ä¸­è¢«ç§»åŠ¨ï¼Œç¨‹åºè®¿é—®åˆ°çš„å¯¹è±¡åœ°å€å¯èƒ½å°±æ— æ•ˆäº†ã€‚å› æ­¤ï¼Œéœ€è¦**â€œåœä¸–ç•Œâ€**å°†æ‰€æœ‰å¼•ç”¨æ›´æ–°ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>è€Œ ZGC çš„è®¾è®¡ç›®æ ‡æ˜¯ &lt;10ms çš„ GC åœé¡¿æ—¶é—´ï¼Œæ‰€ä»¥å®ƒé‡‡ç”¨ <code>å¹¶å‘æ ‡è®° + å¹¶å‘ç§»åŠ¨ + å¹¶å‘å¼•ç”¨æ›´æ–°</code> çš„æ¨¡å¼ã€‚åœ¨è¿™ç§æ¨¡å¼ä¸‹ï¼Œå¯¹è±¡å¯ä»¥åœ¨ç¨‹åºè¿è¡Œæ—¶è¢«ç§»åŠ¨ï¼Œä½†ç¨‹åºè®¿é—®æ—¶å¿…é¡»â€œçŸ¥é“â€è¿™ä¸ªå¯¹è±¡æ˜¯å¦å·²ç»è¢«ç§»åŠ¨ï¼Œå¹¶è·å–å…¶æœ€æ–°åœ°å€ï¼Œè¿™å°±æ˜¯è¯»å±éšœçš„èŒè´£ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>è¯»å±éšœæ˜¯ä¸€ç§åœ¨è¯»å–å¯¹è±¡å¼•ç”¨æ—¶è‡ªåŠ¨æ’å…¥çš„é€»è¾‘ï¼Œç”¨äºæ£€æŸ¥å¼•ç”¨æ˜¯å¦æœ‰æ•ˆï¼Œå¹¶åœ¨å¿…è¦æ—¶è¿›è¡Œä¿®æ­£ï¼ˆå³åœ°å€é‡å®šå‘ï¼‰ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ZGC æ˜¯ç›®å‰å”¯ä¸€åœ¨æ‰€æœ‰å¯¹è±¡è®¿é—®ä¸­éƒ½ä½¿ç”¨è¯»å±éšœçš„ GCï¼Œå®ƒåœ¨æ¯æ¬¡å¯¹è±¡æŒ‡é’ˆè§£å¼•ç”¨æ—¶éƒ½è¿›è¡Œå¦‚ä¸‹æ“ä½œï¼š</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>èŒè´£</th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>æ£€æµ‹å¼•ç”¨æ˜¯å¦æ˜¯è€åœ°å€</strong></td>\n<td>åˆ©ç”¨æŒ‡é’ˆä¸­çš„å…ƒä¿¡æ¯ï¼ˆé¢œè‰²æŒ‡é’ˆï¼Œå¦‚ Remapped ä½ï¼‰åˆ¤æ–­å¼•ç”¨æ˜¯å¦å·²ç»è¢«æ›´æ–°</td>\n</tr>\n<tr>\n<td><strong>å¦‚æœæœªæ›´æ–°åˆ™é‡å®šå‘å¼•ç”¨</strong></td>\n<td>å¦‚æœå¼•ç”¨çš„æ˜¯æ—§åœ°å€ï¼Œå±éšœä¼šé€šè¿‡ forwarding table æ‰¾åˆ°æ–°åœ°å€å¹¶æ›´æ–°</td>\n</tr>\n<tr>\n<td><strong>ä¿è¯æœ€ç»ˆè®¿é—®å¯¹è±¡çš„åœ°å€æ­£ç¡®</strong></td>\n<td>å³ä½¿åœ¨å¯¹è±¡ç§»åŠ¨è¿‡ç¨‹ä¸­ï¼Œç¨‹åºä¹Ÿæ€»èƒ½è®¿é—®åˆ°æœ‰æ•ˆåœ°å€ï¼Œæ— éœ€åœé¡¿æ‰€æœ‰çº¿ç¨‹</td>\n</tr>\n</tbody>\n</table>\n<pre>\n<code class=\"mermaid\">\ngraph TD\nA[ç¨‹åºè®¿é—®å¯¹è±¡å¼•ç”¨&lt;br&#x2F;&gt;ä¾‹å¦‚ï¼šPerson p &#x3D; personField] --&gt; B[JVM æ’å…¥è¯»å±éšœé€»è¾‘]\nB --&gt; C[è¯»å±éšœæ£€æŸ¥é¢œè‰²æŒ‡é’ˆä¸­çš„ Remapped ä½]\nC --&gt; D{Remapped ä½ä¸º 0 å—ï¼Ÿ}\nD -- æ˜¯ --&gt; E[æ£€æŸ¥å¯¹è±¡æ˜¯å¦å·²è¢«ç§»åŠ¨]\nE --&gt; F[æ›´æ–°å¼•ç”¨åœ°å€ä¸ºæ–°åœ°å€]\nF --&gt; G[è®¾ç½® Remapped ä½ä¸º 1]\nG --&gt; H[ä½¿ç”¨æ›´æ–°åçš„å¼•ç”¨è®¿é—®å¯¹è±¡]\nD -- å¦ --&gt; I[ç›´æ¥ä½¿ç”¨å½“å‰å¼•ç”¨è®¿é—®å¯¹è±¡]\n</code>\n</pre>\n</div>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ZGCçš„Regionå¯ä»¥å…·æœ‰å¤§ã€ä¸­ã€å°ä¸‰ç±»å®¹é‡ï¼š</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-6\">å°å‹Regionï¼ˆSmall Regionï¼‰ ï¼š å®¹é‡å›ºå®šä¸º2MBï¼Œç”¨äºæ”¾ç½®å°äº256KBçš„å°å¯¹è±¡ã€‚</li>\n<li class=\"lvl-6\">ä¸­å‹Regionï¼ˆMedium Regionï¼‰ ï¼š å®¹é‡å›ºå®šä¸º32MBï¼Œç”¨äºæ”¾ç½®å¤§äºç­‰äº256KBä½†å°äº4MBçš„å¯¹è±¡ã€‚</li>\n<li class=\"lvl-6\">å¤§å‹Regionï¼ˆLarge Regionï¼‰ ï¼š å®¹é‡ä¸å›ºå®šï¼Œå¯ä»¥åŠ¨æ€å˜åŒ–ï¼Œä½†å¿…é¡»ä¸º2MBçš„æ•´æ•°å€ï¼Œç”¨äºæ”¾ç½®4MBæˆ–ä»¥ä¸Šçš„å¤§å¯¹è±¡ã€‚</li>\n</ul>\n<blockquote>\n<p>æ¯ä¸ªå¤§å‹Regionä¸­åªä¼šå­˜æ”¾ä¸€ä¸ªå¤§å¯¹è±¡ï¼Œè¿™ä¹Ÿé¢„ç¤ºç€è™½ç„¶åå­—å«ä½œâ€œå¤§å‹Regionâ€ï¼Œä½†å®ƒçš„å®é™…å®¹é‡å®Œå…¨æœ‰å¯èƒ½å°äºä¸­å‹Regionï¼Œæœ€å°å®¹é‡å¯ä½è‡³4MBã€‚</p>\n</blockquote>\n</li>\n<li class=\"lvl-2\">\n<p>ZGC ç‰¹ç‚¹ï¼š</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-6\">æ”¯æŒæå¤§å †ï¼ˆJDK 15 èµ·æ”¯æŒæœ€é«˜ 16TBï¼‰</li>\n<li class=\"lvl-6\">GC åœé¡¿æ—¶é—´é€šå¸¸ä½äº 1msï¼ˆä¸å †å¤§å°åŸºæœ¬æ— å…³ï¼‰</li>\n<li class=\"lvl-6\">é€‚åˆä½å»¶è¿Ÿã€é«˜ååã€é«˜å¯ç”¨çš„åº”ç”¨åœºæ™¯ï¼Œå¦‚äº¤æ˜“ç³»ç»Ÿã€å¹¿å‘Šæ¨èç­‰</li>\n</ul>\n</li>\n</ul>\n<h5 id=\"ZGC-æ”¶é›†å™¨çš„å·¥ä½œæ–¹å¼\">ZGC æ”¶é›†å™¨çš„å·¥ä½œæ–¹å¼</h5>\n<p><img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/uPic/94yKcU.png\" alt=\"\"></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1ï¸âƒ£ å¹¶å‘æ ‡è®°ï¼ˆConcurrent Markï¼‰ï¼š</span><br><span class=\"line\">   ä¸G1ä¸€æ ·ï¼Œå¹¶å‘æ ‡è®°æ˜¯éå†å¯¹è±¡å›¾åšå¯è¾¾æ€§åˆ†æçš„é˜¶æ®µï¼Œ</span><br><span class=\"line\">   å®ƒçš„åˆå§‹æ ‡è®°(Mark Start)å’Œæœ€ç»ˆæ ‡è®°(Mark End)ä¹Ÿä¼šå‡ºç°çŸ­æš‚çš„åœé¡¿ï¼Œ</span><br><span class=\"line\">   ä¸G1ä¸åŒçš„æ˜¯ï¼ŒZGCçš„æ ‡è®°æ˜¯åœ¨æŒ‡é’ˆä¸Šè€Œä¸æ˜¯åœ¨å¯¹è±¡ä¸Šè¿›è¡Œçš„ï¼Œ</span><br><span class=\"line\">   æ ‡è®°é˜¶æ®µä¼šæ›´æ–°æŸ“è‰²æŒ‡é’ˆä¸­çš„ Marked 0ã€ Marked 1 æ ‡å¿—ä½ã€‚</span><br><span class=\"line\"></span><br><span class=\"line\">2ï¸âƒ£ å¹¶å‘é¢„å¤‡é‡åˆ†é…ï¼ˆConcurrent Prepare <span class=\"keyword\">for</span> Relocateï¼‰ï¼š</span><br><span class=\"line\">   è¿™ä¸ªé˜¶æ®µéœ€è¦æ ¹æ®ç‰¹å®šçš„æŸ¥è¯¢æ¡ä»¶ç»Ÿè®¡å¾—å‡ºæœ¬æ¬¡æ”¶é›†è¿‡ç¨‹è¦æ¸…ç†å“ªäº›Regionï¼Œå°†è¿™äº›Regionç»„æˆé‡åˆ†é…é›†ï¼ˆRelocation Setï¼‰ã€‚</span><br><span class=\"line\">   ZGCæ¯æ¬¡å›æ”¶éƒ½ä¼šæ‰«ææ‰€æœ‰çš„Regionï¼Œç”¨èŒƒå›´æ›´å¤§çš„æ‰«ææˆæœ¬æ¢å–çœå»G1ä¸­è®°å¿†é›†çš„ç»´æŠ¤æˆæœ¬ã€‚</span><br><span class=\"line\"></span><br><span class=\"line\">3ï¸âƒ£ å¹¶å‘é‡åˆ†é…ï¼ˆConcurrent Relocateï¼‰ï¼š</span><br><span class=\"line\">   é‡åˆ†é…æ˜¯ZGCæ‰§è¡Œè¿‡ç¨‹ä¸­çš„æ ¸å¿ƒé˜¶æ®µï¼Œè¿™ä¸ªè¿‡ç¨‹è¦æŠŠé‡åˆ†é…é›†ä¸­çš„å­˜æ´»å¯¹è±¡å¤åˆ¶åˆ°æ–°çš„Regionä¸Šï¼Œ</span><br><span class=\"line\">   å¹¶ä¸ºé‡åˆ†é…é›†ä¸­çš„æ¯ä¸ªRegionç»´æŠ¤ä¸€ä¸ªè½¬å‘è¡¨ï¼ˆForward Tableï¼‰ï¼Œè®°å½•ä»æ—§å¯¹è±¡åˆ°æ–°å¯¹è±¡çš„è½¬å‘å…³ç³»ã€‚</span><br><span class=\"line\">   ZGCæ”¶é›†å™¨èƒ½ä»…ä»å¼•ç”¨ä¸Šå°±æ˜ç¡®å¾—çŸ¥ä¸€ä¸ªå¯¹è±¡æ˜¯å¦å¤„äºé‡åˆ†é…é›†ä¹‹ä¸­ï¼Œå¦‚æœç”¨æˆ·çº¿ç¨‹æ­¤æ—¶å¹¶å‘è®¿é—®äº†ä½äºé‡åˆ†é…é›†ä¸­çš„å¯¹è±¡ï¼Œ</span><br><span class=\"line\">   è¿™æ¬¡è®¿é—®å°†ä¼šè¢«é¢„ç½®çš„å†…å­˜å±éšœ(è¯»å±éšœ)æ‰€æˆªè·ï¼Œç„¶åç«‹å³æ ¹æ®Regionä¸Šçš„è½¬å‘è¡¨è®°å½•å°†è®¿é—®è½¬å‘åˆ°æ–°å¤åˆ¶çš„å¯¹è±¡ä¸Šï¼Œ</span><br><span class=\"line\">   å¹¶åŒæ—¶ä¿®æ­£æ›´æ–°è¯¥å¼•ç”¨çš„å€¼ï¼Œä½¿å…¶ç›´æ¥æŒ‡å‘æ–°å¯¹è±¡ï¼ŒZGCå°†è¿™ç§è¡Œä¸ºç§°ä¸ºæŒ‡é’ˆçš„â€œè‡ªæ„ˆâ€ï¼ˆSelf-Healingï¼‰èƒ½åŠ›ã€‚</span><br><span class=\"line\"></span><br><span class=\"line\">4ï¸âƒ£ å¹¶å‘é‡æ˜ å°„ï¼ˆConcurrent Remapï¼‰ï¼š</span><br><span class=\"line\">   é‡æ˜ å°„æ‰€åšçš„å°±æ˜¯ä¿®æ­£æ•´ä¸ªå †ä¸­æŒ‡å‘é‡åˆ†é…é›†ä¸­æ—§å¯¹è±¡çš„æ‰€æœ‰å¼•ç”¨ï¼Œä½†æ˜¯ZGCä¸­å¯¹è±¡å¼•ç”¨å­˜åœ¨â€œè‡ªæ„ˆâ€åŠŸèƒ½ï¼Œæ‰€ä»¥è¿™ä¸ªé‡æ˜ å°„æ“ä½œå¹¶ä¸æ˜¯å¾ˆè¿«åˆ‡ã€‚</span><br><span class=\"line\">   ZGCå¾ˆå·§å¦™åœ°æŠŠå¹¶å‘é‡æ˜ å°„é˜¶æ®µï¼ˆConcurrent Remapï¼‰è¦åšçš„å·¥ä½œï¼Œåˆå¹¶åˆ°äº†ä¸‹ä¸€æ¬¡åƒåœ¾æ”¶é›†å¾ªç¯ä¸­çš„å¹¶å‘æ ‡è®°é˜¶æ®µï¼ˆConcurrent Markï¼‰é‡Œå»å®Œæˆï¼Œ</span><br><span class=\"line\">   åæ­£å®ƒä»¬éƒ½æ˜¯è¦éå†æ‰€æœ‰å¯¹è±¡çš„ï¼Œè¿™æ ·åˆå¹¶å°±èŠ‚çœäº†ä¸€æ¬¡éå†å¯¹è±¡å›¾çš„å¼€é”€ã€‚</span><br><span class=\"line\">   ä¸€æ—¦æ‰€æœ‰æŒ‡é’ˆéƒ½è¢«ä¿®æ­£ä¹‹åï¼Œ åŸæ¥è®°å½•æ–°æ—§å¯¹è±¡å…³ç³»çš„è½¬å‘è¡¨å°±å¯ä»¥é‡Šæ”¾æ‰äº†ã€‚</span><br></pre></td></tr></table></figure>\n<h5 id=\"ZGCå­˜åœ¨çš„é—®é¢˜\">ZGCå­˜åœ¨çš„é—®é¢˜</h5>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ZGCæœ€å¤§çš„é—®é¢˜æ˜¯<code>æµ®åŠ¨åƒåœ¾</code>ã€‚ZGCçš„åœé¡¿æ—¶é—´æ˜¯åœ¨10msä»¥ä¸‹ï¼Œä½†æ˜¯ZGCçš„æ‰§è¡Œæ—¶é—´è¿˜æ˜¯è¿œè¿œå¤§äºè¿™ä¸ªæ—¶é—´çš„ã€‚å‡å¦‚ZGCå…¨è¿‡ç¨‹éœ€è¦æ‰§è¡Œ10åˆ†é’Ÿï¼Œåœ¨è¿™ä¸ªæœŸé—´ç”±äºå¯¹è±¡åˆ†é…é€Ÿç‡å¾ˆé«˜ï¼Œå°†åˆ›å»ºå¤§é‡çš„æ–°å¯¹è±¡ï¼Œè¿™äº›å¯¹è±¡å¾ˆéš¾è¿›å…¥å½“æ¬¡GCï¼Œæ‰€ä»¥åªèƒ½åœ¨ä¸‹æ¬¡GCçš„æ—¶å€™è¿›è¡Œå›æ”¶ï¼Œè¿™äº›åªèƒ½ç­‰åˆ°ä¸‹æ¬¡GCæ‰èƒ½å›æ”¶çš„å¯¹è±¡å°±æ˜¯æµ®åŠ¨åƒåœ¾ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ZGCæ²¡æœ‰åˆ†ä»£æ¦‚å¿µï¼Œæ¯æ¬¡éƒ½éœ€è¦è¿›è¡Œå…¨å †æ‰«æï¼Œå¯¼è‡´ä¸€äº›â€œæœç”Ÿå¤•æ­»â€çš„å¯¹è±¡æ²¡èƒ½åŠæ—¶çš„è¢«å›æ”¶ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ç›®å‰å”¯ä¸€çš„åŠæ³•æ˜¯å¢å¤§å †çš„å®¹é‡ï¼Œä½¿å¾—ç¨‹åºå¾—åˆ°æ›´å¤šçš„å–˜æ¯æ—¶é—´ï¼Œä½†æ˜¯è¿™ä¸ªä¹Ÿæ˜¯ä¸€ä¸ªæ²»æ ‡ä¸æ²»æœ¬çš„æ–¹æ¡ˆã€‚å¦‚æœéœ€è¦ä»æ ¹æœ¬ä¸Šè§£å†³è¿™ä¸ªé—®é¢˜ï¼Œè¿˜æ˜¯éœ€è¦å¼•å…¥åˆ†ä»£æ”¶é›†ï¼Œè®©æ–°ç”Ÿå¯¹è±¡éƒ½åœ¨ä¸€ä¸ªä¸“é—¨çš„åŒºåŸŸä¸­åˆ›å»ºï¼Œç„¶åä¸“é—¨é’ˆå¯¹è¿™ä¸ªåŒºåŸŸè¿›è¡Œæ›´é¢‘ç¹ã€æ›´å¿«çš„æ”¶é›†ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>JDK21æ­£å¼å¼•å…¥äº†åˆ†ä»£ï¼ˆjdk17æ˜¯é¢„è§ˆç‰ˆï¼‰ï¼Œå¯ä»¥åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨ï¼Œéœ€è¦æ‰‹åŠ¨å¼€å¯ï¼š<code>-XX:+ZGenerational</code></p>\n</li>\n</ul>\n<h5 id=\"ZGC-æ”¶é›†å™¨å‚æ•°é…ç½®è¡¨\">ZGC æ”¶é›†å™¨å‚æ•°é…ç½®è¡¨</h5>\n<table>\n<thead>\n<tr>\n<th>å‚æ•°å</th>\n<th>è¯´æ˜</th>\n<th>é»˜è®¤å€¼ï¼ˆå¦‚æœªç‰¹æ®Šæ ‡æ³¨ï¼‰</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>-XX:+UseZGC</code></td>\n<td>å¯ç”¨ ZGC åƒåœ¾æ”¶é›†å™¨</td>\n<td>-</td>\n</tr>\n<tr>\n<td><code>-XX:+UnlockExperimentalVMOptions</code></td>\n<td>è§£é”å®éªŒæ€§å‚æ•°ï¼ˆJDK 11~14 ä½¿ç”¨ ZGC å¿…é¡»ï¼‰</td>\n<td>-</td>\n</tr>\n<tr>\n<td><code>-XX:+UseLargePages</code></td>\n<td>å¯ç”¨å¤§é¡µå†…å­˜ï¼ˆæ€§èƒ½ä¼˜åŒ–ï¼‰</td>\n<td>false</td>\n</tr>\n<tr>\n<td><code>-XX:+UseTransparentHugePages</code></td>\n<td>å¯ç”¨é€æ˜å¤§é¡µï¼ˆéƒ¨åˆ† Linux ä¸Šå¯ç»“åˆä½¿ç”¨ï¼‰</td>\n<td>false</td>\n</tr>\n<tr>\n<td><code>-Xmx</code> / <code>-Xms</code></td>\n<td>è®¾ç½®æœ€å¤§/åˆå§‹å †å¤§å°</td>\n<td>ç”¨æˆ·é…ç½®</td>\n</tr>\n<tr>\n<td><code>-XX:ZUncommitDelay=&lt;ç§’&gt;</code></td>\n<td>æœªä½¿ç”¨å†…å­˜é‡Šæ”¾å›æ“ä½œç³»ç»Ÿçš„å»¶è¿Ÿæ—¶é—´ï¼ˆZGC ä¼šè‡ªåŠ¨é‡Šæ”¾å†…å­˜ï¼‰</td>\n<td>300ï¼ˆ5åˆ†é’Ÿï¼‰</td>\n</tr>\n<tr>\n<td><code>-XX:SoftMaxHeapSize=&lt;å¤§å°&gt;</code></td>\n<td>è½¯æœ€å¤§å †ï¼ˆSoft Heap Limitï¼‰ï¼šZGC å°è¯•å°†ä½¿ç”¨çš„å †æ§åˆ¶åœ¨è¯¥å€¼ä»¥å†…</td>\n<td>é»˜è®¤ç­‰äº -Xmx</td>\n</tr>\n<tr>\n<td><code>-XX:MaxHeapFreeRatio</code></td>\n<td>æœ€å¤§å †ç©ºé—²æ¯”ä¾‹ï¼ˆè¶…è¿‡æ­¤æ¯”ä¾‹å¯èƒ½è§¦å‘å†…å­˜é‡Šæ”¾ï¼‰</td>\n<td>70</td>\n</tr>\n<tr>\n<td><code>-XX:MinHeapFreeRatio</code></td>\n<td>æœ€å°å †ç©ºé—²æ¯”ä¾‹ï¼ˆä½äºæ­¤æ¯”ä¾‹å¯èƒ½è§¦å‘æ‰©å®¹ï¼‰</td>\n<td>40</td>\n</tr>\n<tr>\n<td><code>-XX:+ZGenerational</code></td>\n<td>å¯ç”¨ ZGC åˆ†ä»£æ”¶é›†ï¼ˆä» JDK 21 èµ·æ”¯æŒï¼Œé»˜è®¤å…³é—­ï¼‰</td>\n<td>falseï¼ˆJDK 21+ï¼‰</td>\n</tr>\n<tr>\n<td><code>-XX:+PrintGC</code> / <code>-Xlog:gc*</code></td>\n<td>å¼€å¯ GC æ—¥å¿—è¾“å‡º</td>\n<td>-</td>\n</tr>\n<tr>\n<td><code>-XX:+ZProactive</code></td>\n<td>ä¸»åŠ¨å›æ”¶ç­–ç•¥ï¼ˆåœ¨ç³»ç»Ÿç©ºé—²æ—¶å°è¯•å›æ”¶ï¼‰</td>\n<td>true</td>\n</tr>\n<tr>\n<td><code>-XX:ZCollectionInterval=&lt;ç§’&gt;</code></td>\n<td>ä¸»åŠ¨å›æ”¶ä¹‹é—´çš„æœ€å°æ—¶é—´é—´éš”ï¼ˆé…åˆ ZProactiveï¼‰</td>\n<td>é»˜è®¤å€¼å› ç‰ˆæœ¬è€Œå¼‚</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"ZGC-vs-G1-GC-vs-Parallel-GC-å¯¹æ¯”è¡¨\">ZGC vs G1 GC vs Parallel GC å¯¹æ¯”è¡¨</h3>\n<table>\n<thead>\n<tr>\n<th>ç‰¹æ€§</th>\n<th><strong>ZGC</strong></th>\n<th><strong>G1 GC</strong></th>\n<th><strong>Parallel GC</strong></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>è®¾è®¡ç›®æ ‡</strong></td>\n<td><strong>æä½å»¶è¿Ÿ</strong>ï¼Œ&lt;1ms åœé¡¿</td>\n<td>å¹³è¡¡ <strong>ä½å»¶è¿Ÿ</strong> ä¸ <strong>é«˜åå</strong></td>\n<td><strong>é«˜åå</strong>ï¼Œæœ€å¤§åŒ– CPU ä½¿ç”¨</td>\n</tr>\n<tr>\n<td><strong>GC åœé¡¿æ—¶é—´</strong></td>\n<td>&lt;1msï¼Œå †å¤§å°å¢åŠ ä¸å½±å“åœé¡¿æ—¶é—´</td>\n<td>å‡ ååˆ°å‡ ç™¾æ¯«ç§’ï¼Œå †è¶Šå¤§åœé¡¿è¶Šæ˜æ˜¾</td>\n<td>åœé¡¿æ—¶é—´å¯èƒ½è¾¾åˆ°ç§’çº§ï¼Œ<strong>å †è¶Šå¤§è¶Šæ˜æ˜¾</strong></td>\n</tr>\n<tr>\n<td><strong>å †å¤§å°æ”¯æŒ</strong></td>\n<td>æ”¯æŒé«˜è¾¾ <strong>16TB</strong>ï¼ˆJDK 15+ï¼‰</td>\n<td>æ”¯æŒ <strong>æœ€å¤š 4TB</strong></td>\n<td>æ”¯æŒå¤§å †ï¼Œä½†åœé¡¿æ˜æ˜¾</td>\n</tr>\n<tr>\n<td><strong>æ˜¯å¦åˆ†ä»£</strong></td>\n<td>é»˜è®¤ä¸åˆ†ä»£ï¼ˆJDK 21+ å¯å¼€å¯ <code>-XX:+ZGenerational</code>ï¼‰</td>\n<td>åˆ†ä»£ï¼ˆæ–°ç”Ÿä»£ + è€å¹´ä»£ï¼‰</td>\n<td>åˆ†ä»£ï¼ˆæ–°ç”Ÿä»£ + è€å¹´ä»£ï¼‰</td>\n</tr>\n<tr>\n<td><strong>å¹¶å‘å›æ”¶</strong></td>\n<td>æ˜¯ï¼Œ<strong>åŒ…æ‹¬æ ‡è®°ã€å‹ç¼©ã€å¼•ç”¨å¤„ç†éƒ½å¹¶å‘</strong></td>\n<td>éƒ¨åˆ†å¹¶å‘ï¼Œä»åŒ…å«æ˜æ˜¾ Stop-The-World é˜¶æ®µ</td>\n<td>å¦ï¼Œ<strong>å…¨éƒ¨ Stop-The-World</strong></td>\n</tr>\n<tr>\n<td><strong>ç§»åŠ¨å¯¹è±¡æ—¶æ˜¯å¦åœé¡¿</strong></td>\n<td>å¦ï¼Œä½¿ç”¨è¯»å±éšœå¹¶å‘è½¬ç§»å¯¹è±¡</td>\n<td>æ˜¯ï¼ˆé€šè¿‡å¤åˆ¶åŒºåŸŸï¼‰</td>\n<td>æ˜¯</td>\n</tr>\n<tr>\n<td><strong>å®ç°æœºåˆ¶</strong></td>\n<td>æ ‡è®°-é‡å®šä½ï¼ŒåŸºäºè¯»å±éšœ</td>\n<td>Region åˆ†åŒº + æ ‡è®°-å¤åˆ¶ + Mixed GC</td>\n<td>æ ‡è®°-å¤åˆ¶ï¼ˆæ–°ç”Ÿä»£ï¼‰ã€æ ‡è®°-æ•´ç†ï¼ˆè€å¹´ä»£ï¼‰</td>\n</tr>\n<tr>\n<td><strong>ååèƒ½åŠ›</strong></td>\n<td>ä¸­é«˜</td>\n<td>é«˜</td>\n<td><strong>æœ€é«˜</strong></td>\n</tr>\n<tr>\n<td><strong>é€‚ç”¨åœºæ™¯</strong></td>\n<td>ä½å»¶è¿Ÿç³»ç»Ÿï¼Œå¦‚é‡‘èã€äº¤æ˜“ã€æ¨èç­‰å®æ—¶åº”ç”¨</td>\n<td>é€šç”¨åå°ç³»ç»Ÿã€Web æœåŠ¡ç­‰</td>\n<td>æ‰¹å¤„ç†ã€æ•°æ®è®¡ç®—ã€æ—¥å¿—åˆ†æç­‰ä¸æ•æ„Ÿäºåœé¡¿çš„ç³»ç»Ÿ</td>\n</tr>\n<tr>\n<td><strong>é»˜è®¤å¯ç”¨</strong></td>\n<td>å¦ï¼Œéœ€æŒ‡å®š <code>-XX:+UseZGC</code></td>\n<td>JDK 9+ é»˜è®¤ GC</td>\n<td>JDK 8 åŠä»¥å‰é»˜è®¤ GC</td>\n</tr>\n<tr>\n<td><strong>è°ƒä¼˜å¤æ‚åº¦</strong></td>\n<td>ä½ï¼Œå¤§å¤šæ•°å‚æ•°å¯çœç•¥</td>\n<td>ä¸­ï¼Œéœ€è¦è®¾ç½®ç›®æ ‡åœé¡¿æ—¶é—´ç­‰</td>\n<td>é«˜ï¼Œéœ€è¦ç²¾ç»†é…ç½® Eden/Survivor ç­‰æ¯”ä¾‹</td>\n</tr>\n<tr>\n<td><strong>GC æ—¥å¿—é…ç½®æ–¹å¼</strong></td>\n<td>ç»Ÿä¸€æ—¥å¿—æ ¼å¼ï¼š<code>-Xlog:gc*</code>ï¼ˆJDK 9+ï¼‰</td>\n<td>æ”¯æŒä¼ ç»Ÿçš„ <code>-XX:+PrintGCDetails</code> å’Œ <code>-Xlog:gc*</code> æ—¥å¿—è¾“å‡º</td>\n<td>ä¸»è¦ä½¿ç”¨æ—§å‚æ•°ï¼š<code>-XX:+PrintGCDetails</code> ç­‰</td>\n</tr>\n</tbody>\n</table>\n<div class=\"tips\">\n<p><em><strong>ZGC ååèƒ½åŠ›è¾ƒå¼±çš„åŸå› </strong></em></p>\n<table>\n<thead>\n<tr>\n<th>åŸå› </th>\n<th>è§£é‡Š</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>1. å¹¶å‘é˜¶æ®µä»£ä»·è¾ƒé«˜</strong></td>\n<td>ZGC å‡ ä¹æ‰€æœ‰çš„ GC å·¥ä½œï¼ˆåŒ…æ‹¬æ ‡è®°ã€æ•´ç†ã€å¼•ç”¨å¤„ç†ã€è½¬ç§»å¯¹è±¡ï¼‰éƒ½åœ¨ä¸åº”ç”¨çº¿ç¨‹å¹¶å‘æ‰§è¡Œã€‚è™½ç„¶å‡å°‘äº†åœé¡¿ï¼Œä½†è¿™äº› GC çº¿ç¨‹ä¸ä¸šåŠ¡çº¿ç¨‹å…±äº« CPU èµ„æºï¼Œ<strong>å¢åŠ äº† CPU ä¸Šä¸‹æ–‡åˆ‡æ¢å’Œç¼“å­˜ç«äº‰</strong>ï¼Œä»è€Œå½±å“ä¸šåŠ¡çº¿ç¨‹çš„æ‰§è¡Œæ•ˆç‡ã€‚</td>\n</tr>\n<tr>\n<td><strong>2. è¯»å±éšœå¼€é”€</strong></td>\n<td>ZGC ä¾èµ–<strong>ç€è‰²æŒ‡é’ˆå’Œè¯»å±éšœï¼ˆload barrierï¼‰æœºåˆ¶</strong>æ¥è·Ÿè¸ªå¯¹è±¡å¼•ç”¨çŠ¶æ€ï¼Œæ”¯æŒå¹¶å‘è½¬ç§»ã€‚è™½ç„¶éå¸¸é«˜æ•ˆï¼Œä½†ä»æ¯”ä¼ ç»Ÿ GC çš„æ™®é€šè¯»å†™è·¯å¾„æ…¢ä¸€äº›ï¼Œåœ¨é«˜é¢‘è®¿é—®å¯¹è±¡åœºæ™¯ä¸‹ä¼šå¸¦æ¥ä¸€å®š CPU å¼€é”€ã€‚</td>\n</tr>\n<tr>\n<td><strong>3. å¯¹ç¡¬ä»¶ä¾èµ–é«˜ï¼Œè°ƒåº¦ä¿å®ˆ</strong></td>\n<td>ä¸ºäº†å®ç°â€œ&lt;1ms åœé¡¿â€çš„ç›®æ ‡ï¼ŒZGC ä¼šé€‰æ‹©æ›´ä¿å®ˆçš„è°ƒåº¦ç­–ç•¥ï¼ˆå¦‚é¿å…å¹¶å‘çº¿ç¨‹ä½¿ç”¨è¿‡å¤š CPUï¼‰ï¼Œè€Œä¸ä¼šåƒ Parallel GC é‚£æ ·â€œæ¦¨å¹²â€æ‰€æœ‰æ ¸å¿ƒèµ„æºã€‚</td>\n</tr>\n<tr>\n<td><strong>4. å†…å­˜å¼€é”€æ›´é«˜</strong></td>\n<td>ä¸ºäº†æ”¯æŒå¹¶å‘å‹ç¼©å’Œè½¬ç§»ï¼ŒZGC é€šå¸¸éœ€è¦ä¸ºæ¯ä¸ªå¯¹è±¡ä¿ç•™å…ƒæ•°æ®å’Œæ›´å¤šçš„è½¬ç§»ç©ºé—´ï¼ˆå³â€œæµ®åŠ¨åƒåœ¾â€åŒºåŸŸï¼‰ï¼Œè¿™å¯èƒ½å¯¼è‡´<strong>é¢‘ç¹çš„ GC å‘¨æœŸ</strong>ï¼Œå½±å“ååã€‚</td>\n</tr>\n<tr>\n<td><strong>5. è®¾è®¡ç›®æ ‡éååä¼˜å…ˆ</strong></td>\n<td>ZGC çš„é¦–è¦ç›®æ ‡æ˜¯<strong>ä½å»¶è¿Ÿè€Œéæœ€å¤§åå</strong>ã€‚ä¸ Parallel GCï¼ˆä»¥ååä¸ºæ ¸å¿ƒï¼‰è®¾è®¡ç›®æ ‡ä¸åŒï¼ŒZGC æ›´é€‚åˆåœºæ™¯ä¸ºâ€œå¯¹å»¶è¿Ÿæ•æ„Ÿä½†ååå¯æ¥å—â€çš„ç³»ç»Ÿã€‚</td>\n</tr>\n</tbody>\n</table>\n<p>æœ€ç³Ÿç³•çš„æƒ…å†µä¸‹ååé‡ä¼šé™ä½15%ã€‚è¿™éƒ½ä¸æ˜¯äº‹ï¼Œåœé¡¿æ—¶é—´è¶³å¤Ÿä¼˜ç§€ã€‚è‡³äºååé‡ï¼Œé€šè¿‡æ‰©å®¹åˆ†åˆ†é’Ÿè§£å†³ã€‚<br>\nå¦å¤–ï¼ŒOracleå®˜æ–¹æåˆ°äº†å®ƒæœ€å¤§çš„ä¼˜ç‚¹æ˜¯ï¼šå®ƒçš„åœé¡¿æ—¶é—´ä¸ä¼šéšç€å †çš„å¢å¤§è€Œå¢é•¿ï¼<br>\nä¹Ÿå°±æ˜¯è¯´ï¼Œå‡ åGå †çš„åœé¡¿æ—¶é—´æ˜¯10msä»¥ä¸‹ï¼Œå‡ ç™¾Gç”šè‡³ä¸ŠTå †çš„åœé¡¿æ—¶é—´ä¹Ÿæ˜¯10msä»¥ä¸‹ã€‚</p>\n<p>ZGC ååå¼±ï¼Œä¸æ˜¯å› ä¸ºæŠ€æœ¯è½åï¼Œè€Œæ˜¯å› ä¸ºå®ƒä¸»åŠ¨é€‰æ‹©åœ¨ä½å»¶è¿Ÿå’Œé«˜ååä¹‹é—´åå‘äº†ä½å»¶è¿Ÿã€‚<br>\nåœ¨å¯¹å“åº”æ—¶é—´è¦æ±‚æé«˜çš„ç³»ç»Ÿä¸­ï¼Œå®ƒæ˜¯éå¸¸åˆé€‚çš„é€‰æ‹©ã€‚<br>\nä½†å¦‚æœä½ çš„ç›®æ ‡æ˜¯å‹æ¦¨æœºå™¨æ€§èƒ½è·‘æ‰¹å¤„ç†ã€æ—¥å¿—åˆ†æè¿™ç±»ååå¯¼å‘å‹ä»»åŠ¡ï¼ŒParallel GC æˆ– G1 ä¼šæ›´åˆé€‚ã€‚</p>\n</div>\n<h2 id=\"å†…å­˜æº¢å‡º-OutOfMemoryErrorï¼Œç®€ç§°-OOM\">å†…å­˜æº¢å‡º(OutOfMemoryErrorï¼Œç®€ç§° OOM)</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>JVM å¸¸è§å†…å­˜æº¢å‡ºç±»å‹æ±‡æ€»è¡¨</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>æº¢å‡ºç±»å‹</th>\n<th>å¼‚å¸¸ä¿¡æ¯</th>\n<th>è§¦å‘åŸå› /æè¿°</th>\n<th>ç›¸å…³å‚æ•°å’Œå»ºè®®é…ç½®</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>å †å†…å­˜æº¢å‡º</strong></td>\n<td><code>java.lang.OutOfMemoryError: Java heap space</code></td>\n<td>- åˆ›å»ºå¤§é‡å¯¹è±¡ï¼Œå †ç©ºé—´ä¸è¶³<br>- å†…å­˜æ³„æ¼ï¼šå¯¹è±¡ä¸å†ä½¿ç”¨å´æœ‰å¼ºå¼•ç”¨<br>- è€å¹´ä»£å¯¹è±¡å¤ªå¤šæ— æ³•æ™‹å‡</td>\n<td><code>-Xms</code> / <code>-Xmx</code> è®¾ç½®å †å¤§å°</td>\n</tr>\n<tr>\n<td><strong>æ ˆæº¢å‡ºï¼ˆé€’å½’ï¼‰</strong></td>\n<td><code>java.lang.StackOverflowError</code></td>\n<td>- æ–¹æ³•æ— é™é€’å½’æˆ–é€’å½’å±‚çº§å¤ªæ·±</td>\n<td><code>-Xss</code> è®¾ç½®çº¿ç¨‹æ ˆå¤§å°</td>\n</tr>\n<tr>\n<td><strong>æ— æ³•åˆ›å»ºæ–°çº¿ç¨‹</strong></td>\n<td><code>java.lang.OutOfMemoryError: unable to create new native thread</code></td>\n<td>- åˆ›å»ºçº¿ç¨‹è¿‡å¤šï¼ˆå¦‚çº¿ç¨‹æ± é…ç½®è¿‡å¤§ï¼‰<br>- ç³»ç»Ÿæˆ– JVM native çº¿ç¨‹èµ„æºè€—å°½</td>\n<td>æ§åˆ¶çº¿ç¨‹æ± å¤§å°ï¼Œé¿å…æ— é™æ–°å»ºçº¿ç¨‹</td>\n</tr>\n<tr>\n<td><strong>å…ƒç©ºé—´æº¢å‡º</strong></td>\n<td><code>java.lang.OutOfMemoryError: Metaspace</code></td>\n<td>- åŠ¨æ€åŠ è½½ç±»è¿‡å¤šï¼ˆå¦‚ä½¿ç”¨ CGLIBã€JSP åŠ¨æ€ç”Ÿæˆç±»ï¼‰<br>- ç±»æ— æ³•å¸è½½ï¼ˆå¦‚ ClassLoader æ³„æ¼ï¼‰</td>\n<td><code>-XX:MetaspaceSize</code> / <code>-XX:MaxMetaspaceSize</code></td>\n</tr>\n<tr>\n<td><strong>ç›´æ¥å†…å­˜æº¢å‡º</strong></td>\n<td><code>java.lang.OutOfMemoryError: Direct buffer memory</code></td>\n<td>- ä½¿ç”¨ <code>ByteBuffer.allocateDirect()</code> åˆ†é…å¤§é‡ç›´æ¥å†…å­˜<br>- Netty ç­‰æ¡†æ¶é»˜è®¤ä½¿ç”¨ç›´æ¥å†…å­˜</td>\n<td><code>-XX:MaxDirectMemorySize</code></td>\n</tr>\n<tr>\n<td><strong>GC å¼€é”€è¿‡é«˜</strong></td>\n<td><code>java.lang.OutOfMemoryError: GC overhead limit exceeded</code></td>\n<td>- JVM èŠ±è´¹ &gt;98% çš„æ—¶é—´ GC ä½†å›æ”¶ &lt;2% çš„å†…å­˜ï¼Œè®¤ä¸ºè¿›å…¥â€œGC æ­»å¾ªç¯â€</td>\n<td>åˆ†æ GC æ—¥å¿—ã€ä¼˜åŒ–å †è®¾ç½®</td>\n</tr>\n<tr>\n<td><strong>ç±»å¸è½½å¤±è´¥ï¼ˆå†…å­˜æ³„æ¼ï¼‰</strong></td>\n<td>ï¼ˆä¸ä¸€å®šæŠ¥é”™ï¼Œä½†å¯èƒ½å¯¼è‡´ Metaspace OOMï¼‰</td>\n<td>- Web å®¹å™¨é¢‘ç¹éƒ¨ç½²çƒ­æ›´æ–° WAR åŒ…æ—¶ï¼ŒClassLoader æ— æ³•å¸è½½ï¼Œå¯¼è‡´ç±»æ°¸ä¹…é©»ç•™</td>\n<td>ä¼˜åŒ– ClassLoader ç®¡ç†ï¼Œä½¿ç”¨å†…å­˜åˆ†æå·¥å…·</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å †å¿«ç…§(å †è½¬å‚¨)æ–‡ä»¶åˆ†æ</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>å‚æ•°</th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>-XX:+HeapDumpOnOutOfMemoryError</code></td>\n<td>OOM æ—¶ç”Ÿæˆå †è½¬å‚¨æ–‡ä»¶ ,å»ºè®®ç”Ÿäº§ç¯å¢ƒå¼€å¯</td>\n</tr>\n<tr>\n<td><code>-XX:HeapDumpPath=xxx.hprof</code></td>\n<td>æŒ‡å®šå †è½¬å‚¨æ–‡ä»¶ä¿å­˜è·¯å¾„ <br> é»˜è®¤ä¿å­˜åœ¨å½“å‰ç›®å½•</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¸¸ç”¨åˆ†æå·¥å…·ä¸å‘½ä»¤</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>å·¥å…·/å‘½ä»¤</th>\n<th>ç®€ä»‹ä¸åŠŸèƒ½</th>\n<th>ä½¿ç”¨è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>MATï¼ˆMemory Analyzer Toolï¼‰</strong></td>\n<td>Eclipse å‡ºå“çš„å¼ºå¤§å›¾å½¢å·¥å…·ï¼Œæ”¯æŒæ³„æ¼åˆ†æã€å¯¹è±¡å¼•ç”¨é“¾åˆ†æã€å†…å­˜å ç”¨ç»Ÿè®¡ç­‰</td>\n<td>ä¸‹è½½åœ°å€ï¼š<br><a href=\"https://www.eclipse.org/mat/\">https://www.eclipse.org/mat/</a><br>æ‰“å¼€åç›´æ¥å¯¼å…¥ <code>.hprof</code> æ–‡ä»¶å³å¯åˆ†æ</td>\n</tr>\n<tr>\n<td><strong>VisualVM</strong></td>\n<td>å®˜æ–¹å¯è§†åŒ– JVM ç›‘æ§å·¥å…·ï¼Œæ”¯æŒå®æ—¶åˆ†æã€GC æŸ¥çœ‹ã€çº¿ç¨‹çŠ¶æ€ä¸å †è½¬å‚¨æŸ¥çœ‹</td>\n<td>é™„å¸¦äº JDKï¼ˆæˆ–å•ç‹¬å®‰è£…ï¼‰ï¼Œæ‰“å¼€ <code>.hprof</code> æ–‡ä»¶è¿›è¡Œå¯è§†åŒ–åˆ†æ</td>\n</tr>\n<tr>\n<td><strong>JProfiler</strong></td>\n<td>å•†ä¸šçº§ Java æ€§èƒ½åˆ†æå·¥å…·ï¼Œæä¾›å †åˆ†æã€CPU åˆ†æã€çº¿ç¨‹åˆ†æç­‰å…¨å¥—åŠŸèƒ½</td>\n<td>æ”¯æŒæ‰“å¼€ <code>.hprof</code> æ–‡ä»¶ï¼Œä¹Ÿå¯åœ¨è¿è¡Œæ—¶é…åˆä½¿ç”¨ï¼ˆéœ€ä»˜è´¹æˆ–è¯•ç”¨ï¼‰</td>\n</tr>\n<tr>\n<td><strong>YourKit</strong></td>\n<td>å•†ä¸šæ€§èƒ½åˆ†æå·¥å…·ï¼Œç•Œé¢å‹å¥½ï¼Œæ”¯æŒä¸°å¯Œçš„åˆ†æåŠŸèƒ½</td>\n<td>æ”¯æŒå †åˆ†æï¼Œé€‚åˆå†…å­˜æ³„æ¼æ’æŸ¥</td>\n</tr>\n<tr>\n<td><strong>jhat</strong>ï¼ˆè¿‡æ—¶ï¼‰</td>\n<td>JDK é™„å¸¦çš„æ—§å·¥å…·ï¼Œç”¨äºåˆ†æ <code>.hprof</code> æ–‡ä»¶ï¼Œå¼€å¯ Web ç•Œé¢æŸ¥çœ‹ï¼ˆå·²åºŸå¼ƒï¼‰</td>\n<td>å‘½ä»¤ï¼š<code>jhat heapdump.hprof</code>ï¼Œæµè§ˆå™¨è®¿é—® <code>http://localhost:7000</code>ï¼ˆJDK 8 åŠä»¥ä¸‹ï¼‰</td>\n</tr>\n<tr>\n<td><strong>jmap</strong></td>\n<td>ç”¨äºç”Ÿæˆå †è½¬å‚¨æ–‡ä»¶æˆ–æŸ¥çœ‹å †å¯¹è±¡ç»Ÿè®¡ä¿¡æ¯ï¼ˆ<strong>ä¸æ˜¯åˆ†æå·¥å…·æœ¬èº«</strong>ï¼‰</td>\n<td>å‘½ä»¤ï¼š<code>jmap -dump:format=b,file=heap.hprof &lt;pid&gt;</code> ç”Ÿæˆè½¬å‚¨ï¼›é…åˆ MAT ä½¿ç”¨</td>\n</tr>\n<tr>\n<td><strong>jcmd</strong></td>\n<td>æ›´ç°ä»£çš„è¯Šæ–­å‘½ä»¤å·¥å…·ï¼Œå¯ç”Ÿæˆ heap dumpã€æ‰§è¡Œ GCã€æ‰“å° VM çŠ¶æ€ç­‰</td>\n<td>å‘½ä»¤ï¼š<code>jcmd &lt;pid&gt; GC.heap_dump heap.hprof</code></td>\n</tr>\n<tr>\n<td><strong><a href=\"http://GCEasy.io\">GCEasy.io</a></strong></td>\n<td>åœ¨çº¿åˆ†æå·¥å…·ï¼Œæ”¯æŒ <code>.hprof</code> æ–‡ä»¶å’Œ GC æ—¥å¿—ä¸Šä¼ åˆ†æ</td>\n<td>ç½‘ç«™ï¼š<a href=\"https://gceasy.io\">https://gceasy.io</a></td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>GCæ—¥å¿—ç›¸å…³å‚æ•°(JDK1.8åŠä»¥ä¸‹)</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>å‚æ•°</th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>-XX:+PrintGC</code></td>\n<td>æ‰“å°åŸºæœ¬ GC ä¿¡æ¯ï¼ˆå»ºè®®é…åˆ <code>-XX:+PrintGCDetails</code> ä½¿ç”¨ï¼‰</td>\n</tr>\n<tr>\n<td><code>-XX:+PrintGCDetails</code></td>\n<td>æ‰“å°è¯¦ç»†çš„ GC æ—¥å¿—ä¿¡æ¯ï¼ˆå¦‚å„åŒºåŸŸä½¿ç”¨æƒ…å†µã€å¯¹è±¡åˆ†é…ã€æ™‹å‡ç­‰ï¼‰</td>\n</tr>\n<tr>\n<td><code>-XX:+PrintGCDateStamps</code></td>\n<td>åœ¨ GC æ—¥å¿—ä¸­æ·»åŠ æ—¥æœŸæ—¶é—´æˆ³</td>\n</tr>\n<tr>\n<td><code>-XX:+PrintGCTimeStamps</code></td>\n<td>åœ¨ GC æ—¥å¿—ä¸­æ·»åŠ  JVM å¯åŠ¨ä»¥æ¥çš„æ—¶é—´æˆ³</td>\n</tr>\n<tr>\n<td><code>-Xloggc:/var/log/myapp/gc.log</code></td>\n<td>å°† GC æ—¥å¿—è¾“å‡ºåˆ°æŒ‡å®šæ–‡ä»¶</td>\n</tr>\n<tr>\n<td><code>-XX:+UseGCLogFileRotation</code></td>\n<td>å¯ç”¨ GC æ—¥å¿—æ–‡ä»¶è½®è½¬ï¼ˆé€‚ç”¨äºå¤§è§„æ¨¡ç³»ç»Ÿçš„ GC æ—¥å¿—ç®¡ç†ï¼‰</td>\n</tr>\n<tr>\n<td><code>-XX:NumberOfGCLogFiles=5</code></td>\n<td>æœ€å¤šä¿ç•™ 5 ä¸ª GC æ—¥å¿—å†å²æ–‡ä»¶</td>\n</tr>\n<tr>\n<td><code>-XX:GCLogFileSize=10M</code></td>\n<td>æ¯ä¸ª GC æ—¥å¿—æ–‡ä»¶æœ€å¤§ä¸º 10MB</td>\n</tr>\n<tr>\n<td><code>-XX:+PrintGCCause</code></td>\n<td>æ‰“å° GC çš„è§¦å‘åŸå› ï¼ˆå¦‚ Minor GCã€System.gc() ç­‰ï¼‰</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>GCæ—¥å¿—ç›¸å…³å‚æ•°(JDK9+)</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">-Xlog:gc*:file=/var/log/app/gc.log:time,<span class=\"built_in\">uptime</span>,level,tags:filecount=5,filesize=20M</span><br></pre></td></tr></table></figure>\n<table>\n<thead>\n<tr>\n<th>éƒ¨åˆ†</th>\n<th>å«ä¹‰</th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>gc*</code></td>\n<td>æ—¥å¿—ç±»åˆ«</td>\n<td>è¡¨ç¤ºè®°å½•æ‰€æœ‰ GC ç›¸å…³æ—¥å¿—ï¼ˆå¦‚ gcã€gc+startã€gc+heap ç­‰ï¼‰ã€‚<code>*</code> æ˜¯é€šé…ç¬¦ã€‚</td>\n</tr>\n<tr>\n<td><code>file=/var/log/app/gc.log</code></td>\n<td>è¾“å‡ºè·¯å¾„</td>\n<td>å°† GC æ—¥å¿—è¾“å‡ºåˆ°æŒ‡å®šè·¯å¾„ï¼Œè€Œä¸æ˜¯æ§åˆ¶å°ã€‚å¯ä»¥æ˜¯ç›¸å¯¹æˆ–ç»å¯¹è·¯å¾„ã€‚</td>\n</tr>\n<tr>\n<td><code>time</code></td>\n<td>æ—¥å¿—æ—¶é—´æˆ³</td>\n<td>æ·»åŠ æ ¼å¼åŒ–æ—¶é—´ï¼ˆå¦‚ 2025-05-12T10:21:33.123+0800ï¼‰ã€‚ä¾¿äºå®šä½å…·ä½“æ—¶é—´ã€‚</td>\n</tr>\n<tr>\n<td><code>uptime</code></td>\n<td>JVM å¯åŠ¨ä»¥æ¥çš„æ—¶é—´æˆ³</td>\n<td>æ˜¾ç¤º GC å‘ç”Ÿæ—¶è·ç¦» JVM å¯åŠ¨çš„æ¯«ç§’æ•°ï¼ˆä¾‹å¦‚ <code>3.254s</code>ï¼‰ã€‚æœ‰åŠ©äºè°ƒè¯•å¯åŠ¨æœŸé—´çš„é—®é¢˜ã€‚</td>\n</tr>\n<tr>\n<td><code>level</code></td>\n<td>æ—¥å¿—çº§åˆ«</td>\n<td>æ˜¾ç¤ºæ—¥å¿—çº§åˆ«ï¼ˆinfoã€debugã€warning ç­‰ï¼‰ï¼Œé»˜è®¤ infoã€‚</td>\n</tr>\n<tr>\n<td><code>tags</code></td>\n<td>æ—¥å¿—æ ‡ç­¾</td>\n<td>æ˜¾ç¤ºæ—¥å¿—çš„æ¨¡å—æ ‡ç­¾ï¼Œå¦‚ <code>[gc,start]</code>ï¼Œå¸®åŠ©å¿«é€Ÿå®šä½ç±»åˆ«ã€‚</td>\n</tr>\n<tr>\n<td><code>filecount=5</code></td>\n<td>æ–‡ä»¶è½®è½¬ä¸ªæ•°</td>\n<td>æœ€å¤šä¿ç•™ 5 ä¸ªæ—¥å¿—æ–‡ä»¶ï¼ˆå½“å‰æ—¥å¿— + 4 ä¸ªå†å²ï¼‰ã€‚</td>\n</tr>\n<tr>\n<td><code>filesize=20M</code></td>\n<td>å•æ–‡ä»¶æœ€å¤§å¤§å°</td>\n<td>æ¯ä¸ªæ—¥å¿—æ–‡ä»¶æœ€å¤§ 20MBï¼Œè¶…å‡ºæ—¶è‡ªåŠ¨æ»šåŠ¨åˆ°ä¸‹ä¸€ä¸ªæ–‡ä»¶ã€‚</td>\n</tr>\n</tbody>\n</table>\n","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç»JVMçš„å†…å­˜æ¨¡å‹ä¸åƒåœ¾å›æ”¶æœºåˆ¶ The JavaÂ® Virtual Machine Specification ç‰ˆæœ¬jdk1.8 JVMè™šæ‹Ÿæœºç»“æ„(HotSpot) è®¾ç½®å†…å­˜åˆ†é…ç¤ºä¾‹ 1234# jdk1.8+java â€Xms2048M â€Xmx2048M â€Xmn1024M â€Xss512K â€XX:MetaspaceSize=256M â€XX:MaxMetaspaceSize=256M â€jar server.jar# jdk1.6/1.7java â€Xms2048M â€Xmx2048M â€Xmn1024M â€Xss512K â€XX:PermSize=256M â€XX:MaxPermSize=256M â€jar server.jar å„å‚æ•°å«ä¹‰ä¸é»˜è®¤å€¼ï¼ˆé’ˆå¯¹ JDK 1.8ï¼‰ å‚æ•° å«ä¹‰è¯´æ˜ é»˜è®¤å€¼ï¼ˆJDK 1.8ï¼‰ -Xms2048M åˆå§‹å †å¤§å°ï¼Œå³ JVM å¯åŠ¨æ—¶åˆ†é…çš„å †å†…å­˜å¤§å°ï¼ˆè¿™é‡Œæ˜¯ 2GBï¼‰ ç‰©ç†å†…å­˜çš„ 1/64ï¼ˆæœ€å° 1MBï¼‰ï¼Œæ¨èé…ç½®ä¸ºä¸ -Xmx ä¸€è‡´ -Xmx2048M æœ€å¤§å †å†…å­˜å¤§å°ï¼ŒJVM å…è®¸åˆ†é…çš„æœ€å¤§å †å†…å­˜ ç‰©ç†å†…å­˜çš„ 1/4ï¼ˆå—é™äº 32ä½/64ä½ï¼‰ -Xmn1024M æ–°ç”Ÿä»£å¤§å°ï¼ˆEden + Survivorï¼‰ä¸º 1GB æœªæ˜¾å¼æŒ‡å®šæ—¶ï¼Œé€šå¸¸å å †çš„ 1/3 å·¦å³ -Xss512K æ¯ä¸ªçº¿ç¨‹çš„æ ˆå¤§å°ï¼ˆThread Stack Sizeï¼‰ï¼Œè¿™é‡Œè®¾ç½®ä¸º 512KB 1MBï¼ˆ64ä½ç³»ç»Ÿï¼‰æˆ– 512KBï¼ˆ32ä½ç³»ç»Ÿï¼‰ -XX:MetaspaceSize=256M å…ƒç©ºé—´åˆå§‹å¤§å°ï¼ˆç”¨äºåŠ è½½ç±»çš„å…ƒæ•°æ®ï¼Œä¸å†ä½¿ç”¨ PermGenï¼‰ 21MBï¼ˆå®¢æˆ·ç«¯ï¼‰æˆ– 16MBï¼ˆæœåŠ¡å™¨ç«¯ï¼‰,æ¨èé…ç½®ä¸ºä¸ MaxMetaspaceSize ä¸€è‡´ -XX:MaxMetaspaceSize=256M å…ƒç©ºé—´æœ€å¤§å¤§å°ï¼Œè¶…è¿‡åè§¦å‘ Full GC æ— é™åˆ¶ï¼ˆé»˜è®¤åªå—ç‰©ç†å†…å­˜çº¦æŸï¼‰ ï¼Œæ¨èé…ç½®ä¸€ä¸ªåˆé€‚çš„æ•°å€¼ï¼Œæ¯”å¦‚8Gçš„å†…å­˜å¯ä»¥é…ç½®ä¸º256M ç±»è£…è½½å­ç³»ç»Ÿï¼ˆClass Loading Subsystemï¼‰ ç±»è£…è½½å­ç³»ç»Ÿè´Ÿè´£å°† .class æ–‡ä»¶åŠ è½½åˆ° JVM ä¸­ï¼Œå¹¶è¿›è¡Œè§£æã€éªŒè¯ã€åˆå§‹åŒ–ç­‰è¿‡ç¨‹ã€‚ åŠ è½½è¿‡ç¨‹çš„å‡ ä¸ªé˜¶æ®µï¼š é˜¶æ®µ è¯´æ˜ åŠ è½½ï¼ˆLoadingï¼‰ å°† .class æ–‡ä»¶è¯»å–ä¸ºäºŒè¿›åˆ¶æ•°æ®ï¼Œæ„é€  Class å¯¹è±¡ éªŒè¯ï¼ˆVerificationï¼‰ ç¡®ä¿å­—èŠ‚ç æ–‡ä»¶æ ¼å¼æ­£ç¡®ã€å®‰å…¨åˆæ³•ï¼ˆé˜²æ­¢æ¶æ„ä»£ç ï¼‰ å‡†å¤‡ï¼ˆPreparationï¼‰ ä¸ºç±»çš„é™æ€å˜é‡åˆ†é…å†…å­˜ï¼Œå¹¶è®¾ç½®é»˜è®¤åˆå§‹å€¼ è§£æï¼ˆResolutionï¼‰ å°†å¸¸é‡æ± ä¸­çš„ç¬¦å·å¼•ç”¨æ›¿æ¢ä¸ºç›´æ¥å¼•ç”¨ï¼ˆæ–¹æ³•ã€å­—æ®µç­‰ï¼‰ åˆå§‹åŒ–ï¼ˆInitializationï¼‰ æ‰§è¡Œ &lt;clinit&gt; é™æ€åˆå§‹åŒ–æ–¹æ³•ï¼Œå¯¹é™æ€å˜é‡èµ‹åˆå§‹å€¼ ç±»åŠ è½½å™¨ï¼ˆClassLoaderï¼‰ä½“ç³»ç»“æ„ï¼šè¯¦ç»†å‚è€ƒ JVM ä¹‹ ç±»åŠ è½½å™¨ ç±»åŠ è½½å™¨åç§° åŠ è½½å†…å®¹ è¯´æ˜ å¼•å¯¼ç±»åŠ è½½å™¨ï¼ˆBootstrap ClassLoaderï¼‰ Java æ ¸å¿ƒç±»åº“ï¼ˆå¦‚ java.lang.*ï¼‰ ç”± JVM è‡ªèº«å®ç°ï¼Œç”¨æœ¬åœ°ä»£ç å®ç°ï¼Œæ— æ³•ç›´æ¥è®¿é—® æ‰©å±•ç±»åŠ è½½å™¨ï¼ˆExtension ClassLoaderï¼‰ JAVA_HOME/jre/lib/ext ç›®å½•ä¸‹çš„ç±» åŠ è½½æ ‡å‡†æ‰©å±•ç±»åº“ åº”ç”¨ç±»åŠ è½½å™¨ï¼ˆApplication ClassLoaderï¼‰ ç”¨æˆ·åº”ç”¨ç±»è·¯å¾„ï¼ˆCLASSPATH æŒ‡å®šçš„ç›®å½•ï¼‰ æœ€å¸¸ç”¨ï¼ŒåŠ è½½å¤§å¤šæ•°åº”ç”¨ä»£ç  è‡ªå®šä¹‰ç±»åŠ è½½å™¨ï¼ˆCustom ClassLoaderï¼‰ ç”¨æˆ·æ‰‹åŠ¨å®ç°çš„ç±»åŠ è½½å™¨ å¯ä»¥æ‰“ç ´åŒäº²å§”æ´¾æœºåˆ¶ï¼Œå®ç°çƒ­åŠ è½½ã€åŠ å¯†ç±»åŠ è½½ç­‰ ç±»åŠ è½½é‡‡ç”¨ åŒäº²å§”æ´¾æ¨¡å‹ï¼šè¯·æ±‚ä¼šå…ˆå‘çˆ¶åŠ è½½å™¨å§”æ‰˜ï¼Œåªæœ‰åœ¨çˆ¶åŠ è½½å™¨åŠ è½½å¤±è´¥æ—¶æ‰å°è¯•è‡ªèº«åŠ è½½ã€‚ å­—èŠ‚ç æ‰§è¡Œå¼•æ“ï¼ˆExecution Engineï¼‰ å­—èŠ‚ç æ‰§è¡Œå¼•æ“è´Ÿè´£å°† Java å­—èŠ‚ç è§£é‡Šæˆ–ç¼–è¯‘ä¸ºæœºå™¨ä»£ç ï¼Œå¹¶åœ¨åº•å±‚å¹³å°ä¸Šæ‰§è¡Œã€‚ æ‰§è¡Œå¼•æ“çš„æ ¸å¿ƒæ¨¡å— ç»„ä»¶åç§° ä½œç”¨è¯´æ˜ å…³é”®ç‰¹æ€§ è§£é‡Šå™¨ï¼ˆInterpreterï¼‰ å°†å­—èŠ‚ç é€æ¡è§£é‡Šæ‰§è¡Œ å¯åŠ¨å¿«ï¼Œé€‚åˆå†·ä»£ç ï¼ˆéçƒ­ç‚¹ä»£ç ï¼‰ï¼Œæ‰§è¡Œæ•ˆç‡ç›¸å¯¹è¾ƒä½ å³æ—¶ç¼–è¯‘å™¨ï¼ˆJIT Compilerï¼‰ å°†çƒ­ç‚¹ä»£ç ç¼–è¯‘ä¸ºæœ¬åœ°æœºå™¨ç ï¼Œæé«˜æ‰§è¡Œæ•ˆç‡ åŒ…å« C1ï¼ˆClientï¼‰å’Œ C2ï¼ˆServerï¼‰ä¸¤ç§ï¼Œæ”¯æŒä¼˜åŒ–å¦‚ï¼šæ–¹æ³•å†…è”ã€é€ƒé€¸åˆ†æã€å¾ªç¯å±•å¼€ç­‰ åƒåœ¾æ”¶é›†å™¨ï¼ˆGarbage Collector, GCï¼‰ è‡ªåŠ¨å†…å­˜ç®¡ç†ï¼Œè´Ÿè´£å¯¹è±¡ç”Ÿå‘½å‘¨æœŸçš„å›æ”¶ å¸¸è§ç®—æ³•åŒ…æ‹¬ï¼šSerialã€Parallelã€CMSã€G1ã€ZGCï¼ˆä½å»¶è¿Ÿï¼‰ç­‰ï¼Œæ ¹æ®ä¸åŒåœºæ™¯é€‰æ‹© æœ¬åœ°æ¥å£ï¼ˆNative Interfaceï¼‰ æ”¯æŒ Java ä¸æœ¬åœ°è¯­è¨€ï¼ˆå¦‚ C/C++ï¼‰çš„äº’æ“ä½œ é€šè¿‡ JNIï¼ˆJava Native Interfaceï¼‰å®ç°ï¼Œè°ƒç”¨åº•å±‚æ“ä½œç³»ç»Ÿæˆ–ç¬¬ä¸‰æ–¹åº“åŠŸèƒ½ JVM å†…å­˜æ¨¡å‹ï¼ˆJava Memory Modelï¼ŒJMMï¼‰ JMM æ˜¯ Java è™šæ‹Ÿæœºè§„èŒƒä¸­å®šä¹‰çš„ä¸€ç§ æŠ½è±¡å†…å­˜æ¨¡å‹ï¼Œå®ƒå†³å®šäº†å¤šçº¿ç¨‹ç¨‹åºä¸­å˜é‡çš„è¯»å†™å¯è§æ€§ã€æœ‰åºæ€§å’ŒåŸå­æ€§ã€‚åŒæ—¶ï¼ŒJVM åœ¨ç‰©ç†å±‚ä¹Ÿæœ‰ä¸€ä¸ªå®é™…çš„å†…å­˜ç»“æ„ï¼Œç§°ä¸ºè¿è¡Œæ—¶æ•°æ®åŒºåŸŸï¼ˆRuntime Data Areasï¼‰ï¼Œè¿™ä¸¤ä¸ªå¯ä»¥ç»“åˆç†è§£ã€‚ JMM çš„ä¸»è¦ç›®æ ‡ ä¿è¯å¤šçº¿ç¨‹ç¯å¢ƒä¸‹çš„æ•°æ®ä¸€è‡´æ€§ æŒ‡å¯¼ JVM å’Œ CPU çš„å†…å­˜äº¤äº’è¡Œä¸ºï¼ˆå¦‚é‡æ’åºã€ç¼“å­˜ï¼‰ å®é™…è¿è¡Œæ—¶å†…å­˜ç»“æ„å¦‚ä¸‹ï¼š å†…å­˜åŒºåŸŸ è¯´æ˜ ğŸ“Œ ç¨‹åºè®¡æ•°å™¨ï¼ˆPCï¼‰ æ¯ä¸ªçº¿ç¨‹ç§æœ‰ï¼Œè®°å½•å½“å‰æ‰§è¡Œçš„å­—èŠ‚ç æŒ‡ä»¤åœ°å€ ğŸ“Œ Java çº¿ç¨‹æ ˆ æ¯ä¸ªçº¿ç¨‹ç§æœ‰ï¼Œæ–¹æ³•è°ƒç”¨æ—¶ç”¨äºå­˜å‚¨å±€éƒ¨å˜é‡ã€æ“ä½œæ•°æ ˆç­‰ ğŸ“Œ æœ¬åœ°æ–¹æ³•æ ˆ ä¸è™šæ‹Ÿæœºæ ˆç±»ä¼¼ï¼Œç”¨äº native æ–¹æ³• ğŸ“Œ å †ï¼ˆHeapï¼‰ æ‰€æœ‰çº¿ç¨‹å…±äº«ï¼Œå­˜å‚¨å¯¹è±¡å®ä¾‹ã€æ•°ç»„ç­‰ï¼ŒGC çš„ä¸»è¦åŒºåŸŸ ğŸ“Œ æ–¹æ³•åŒºï¼ˆæˆ–å…ƒç©ºé—´ï¼‰ æ‰€æœ‰çº¿ç¨‹å…±äº«ï¼Œå­˜å‚¨ç±»ä¿¡æ¯ã€é™æ€å˜é‡ã€å¸¸é‡æ± ç­‰ï¼ˆJDK8 åç§°ä¸º Metaspaceï¼‰ åƒåœ¾å›æ”¶å™¨ åƒåœ¾å›æ”¶å™¨è´Ÿè´£è‡ªåŠ¨ç®¡ç†å†…å­˜ï¼Œå›æ”¶ä¸å†ä½¿ç”¨çš„å¯¹è±¡ï¼Œé¿å…å†…å­˜æ³„æ¼å’Œæº¢å‡ºã€‚ ä»€ä¹ˆæ˜¯åƒåœ¾ å†…å­˜ä¸­æ²¡æœ‰è¢«ï¼ˆçº¿ç¨‹æ ˆå˜é‡ï¼Œé™æ€å˜é‡ï¼Œå¸¸é‡æ± ï¼ŒJNIæŒ‡é’ˆï¼‰å¼•ç”¨çš„åœ°å€å°±æ˜¯åƒåœ¾ å¯è¾¾æ€§åˆ†æç®—æ³•ï¼šæ˜¯ç°ä»£ JVM åˆ¤æ–­ä¸€ä¸ªå¯¹è±¡æ˜¯å¦â€œè¿˜æ´»ç€â€çš„ä¸»è¦ç®—æ³•ã€‚ 1234åŸºæœ¬æ€æƒ³ï¼šä»ä¸€ç»„ç§°ä¸º â€œGC Rootsâ€ çš„å¯¹è±¡å‡ºå‘ï¼Œæ²¿ç€å¯¹è±¡ä¹‹é—´çš„å¼•ç”¨é“¾å‘ä¸‹æœç´¢ã€‚å¦‚æœæŸä¸ªå¯¹è±¡ å¯ä»¥ä» GC Roots è¿½è¸ªåˆ°ï¼Œå°±è®¤ä¸ºå®ƒæ˜¯ â€œå¯è¾¾â€ çš„ï¼ˆAliveï¼‰ã€‚å¦åˆ™å°±è®¤ä¸ºæ˜¯ â€œä¸å¯è¾¾â€ çš„ï¼ˆGarbageï¼‰ï¼Œå¯ä»¥è¢«å›æ”¶ã€‚ åœ¨ JVM ä¸­ï¼ŒGC Roots æ˜¯ä¸€äº› å§‹ç»ˆå¯ç”¨çš„ã€ä¸ä¼šè¢«åƒåœ¾å›æ”¶çš„å¼•ç”¨èµ·ç‚¹ï¼Œä¸»è¦åŒ…æ‹¬ï¼š GC Roots æ¥æº è¯´æ˜ å½“å‰çº¿ç¨‹æ ˆä¸­çš„å¼•ç”¨ï¼ˆå±€éƒ¨å˜é‡è¡¨ï¼‰ å„ä¸ªçº¿ç¨‹æ­£åœ¨è°ƒç”¨çš„æ–¹æ³•ä¸­çš„å±€éƒ¨å˜é‡ã€å‚æ•°ç­‰ é™æ€å­—æ®µå¼•ç”¨ ç±»çš„é™æ€å­—æ®µå¼•ç”¨çš„å¯¹è±¡ JNI å¼•ç”¨ï¼ˆNative æ–¹æ³•å¼•ç”¨ï¼‰ Java æœ¬åœ°æ–¹æ³•ä¸­å¼•ç”¨çš„å¯¹è±¡ å¸¸é‡å¼•ç”¨æ± ä¸­çš„å¯¹è±¡ å­—ç¬¦ä¸²å¸¸é‡ç­‰å¯èƒ½æŒæœ‰å¯¹è±¡å¼•ç”¨ æ´»åŠ¨çº¿ç¨‹å¯¹è±¡ çº¿ç¨‹è‡ªèº«åœ¨ GC æ—¶ä¸ä¼šè¢«å›æ”¶ JVM å†…éƒ¨ç»“æ„ï¼ˆå¦‚ç³»ç»Ÿç±»åŠ è½½å™¨ç­‰ï¼‰ JVM å…³é”®ç³»ç»Ÿå¯¹è±¡ åƒåœ¾å›æ”¶å™¨ç§ç±»ï¼š å·¦è¾¹6ç§å«åˆ†ä»£æ¨¡å‹ï¼Œå³è¾¹çš„4ç§å«åˆ†åŒºæ¨¡å‹ åˆ†ä»£æ¨¡å‹ï¼ˆGenerational Modelï¼‰ å †å†…å­˜åˆ’åˆ†ä¸ºï¼š å¹´è½»ä»£ï¼ˆYoung Generationï¼‰ï¼šå­˜æ”¾æ–°åˆ›å»ºçš„å¯¹è±¡ï¼Œåˆ†ä¸º Eden å’Œ Survivor åŒºã€‚ è€å¹´ä»£ï¼ˆOld Generationï¼‰ï¼šå­˜æ”¾ç»è¿‡å¤šæ¬¡ GC åä»ç„¶å­˜æ´»çš„å¯¹è±¡ã€‚ åˆ†åŒºæ¨¡å‹ï¼ˆRegion-based Modelï¼‰ åˆ†åŒºæ¨¡å‹ï¼ˆå¦‚ G1ã€ZGCã€Shenandoahï¼‰ä¸å†ä¸¥æ ¼æŒ‰ç…§ä»£åˆ’åˆ†å†…å­˜ï¼Œè€Œæ˜¯æŠŠå †åˆ’åˆ†ä¸ºå¤šä¸ª å¤§å°ç›¸åŒçš„ Regionã€‚æ¯ä¸ª Region å¯ä»¥åœ¨è¿è¡Œæ—¶è¢«åŠ¨æ€æ ‡è®°ä¸º Edenã€Survivor æˆ– Oldã€‚ åˆ†ä»£æ¨¡å‹ä¸­ï¼Œä¸Šé¢3ä¸ªæ˜¯æ–°ç”Ÿä»£åƒåœ¾å›æ”¶å™¨ï¼Œä¸‹é¢3ä¸ªæ˜¯è€å¹´ä»£åƒåœ¾å›æ”¶å™¨ï¼Œå¯ä»¥äº¤å‰é…å¯¹ï¼ˆè§ä¸Šå›¾è™šçº¿ï¼‰ï¼Œä½†æœ€å¸¸ç”¨æ˜¯ä¸Šä¸‹ä¸¤ä¸¤é…å¯¹ã€‚ CMSå³å¯ä»¥ä½œä¸ºæ–°ç”Ÿä»£åƒåœ¾å›æ”¶å™¨ï¼Œä¹Ÿå¯ä»¥ä½œä¸ºè€å¹´ä»£åƒåœ¾å›æ”¶å™¨ã€‚ EpsilonGCï¼Œæ˜¯ä¸€ä¸ªç‰¹æ®Šçš„åƒåœ¾å›æ”¶å™¨ï¼Œå®ƒä¸å›æ”¶ä»»ä½•å¯¹è±¡ï¼Œåªè´Ÿè´£æœ€ç»ˆè®°å½•ï¼Œåšæµ‹è¯•ç”¨çš„ã€‚ ç›®å‰æœ€å…ˆè¿›çš„æ¨¡å‹æ˜¯ ZGCï¼Œjkd11å¼€å§‹æ”¯æŒï¼Œä½†ç›´åˆ°JDK16æ‰æ¯”è¾ƒå®Œå–„ï¼Œç›®å‰éé»˜è®¤é…ç½®ï¼Œéœ€è¦æ‰‹åŠ¨é…ç½®ã€‚å…¶ä¸Redhatå‡ºå“çš„ Shenandoah æ˜¯ç«äº‰å…³ç³»ã€‚ å¸¸è§åƒåœ¾å›æ”¶å™¨åŠå…¶åˆ†ç±»ã€JDKç‰ˆæœ¬ åƒåœ¾å›æ”¶å™¨ æ‰€å±æ¨¡å‹ è¯´æ˜ é¦–æ¬¡å‡ºç° JDK ç‰ˆæœ¬ å¯ç”¨å‘½ä»¤ï¼ˆJVM å‚æ•°ï¼‰ é€‚åˆçš„å †å†…å­˜å¤§å° Serial åˆ†ä»£æ¨¡å‹ å•çº¿ç¨‹ï¼Œæ–°ç”Ÿä»£å’Œè€å¹´ä»£éƒ½ä½¿ç”¨ Serialï¼Œé€‚ç”¨äºå°å †å†…å­˜ JDK 1.2 -XX:+UseSerialGC ğŸ’¾ å°äº 1GB ParNew åˆ†ä»£æ¨¡å‹ Serial çš„å¤šçº¿ç¨‹ç‰ˆæœ¬ï¼Œä»…ç”¨äº CMS æ–°ç”Ÿä»£ JDK 1.4 -XX:+UseParNewGC -XX:+UseConcMarkSweepGC ğŸ’¾ 1GB ~ 4GB Parallelï¼ˆååé‡ GCï¼‰ åˆ†ä»£æ¨¡å‹ å¤šçº¿ç¨‹ GCï¼Œé€‚åˆååé‡ä¼˜å…ˆçš„åº”ç”¨åœºæ™¯ JDK 1.4 -XX:+UseParallelGCï¼ˆæ–°ç”Ÿä»£ï¼‰-XX:+UseParallelOldGCï¼ˆè€å¹´ä»£ï¼‰ ğŸ’¾ 2GB ~ 8GB CMSï¼ˆConcurrent Mark Sweepï¼‰ åˆ†ä»£æ¨¡å‹ è€å¹´ä»£å¹¶å‘æ ‡è®°-æ¸…é™¤ï¼Œä½å»¶è¿Ÿï¼Œä½†å­˜åœ¨ç¢ç‰‡ï¼Œå·²å¼ƒç”¨ JDK 1.4 -XX:+UseConcMarkSweepGC ğŸ’¾ 2GB ~ 8GBï¼ˆå·²è¿‡æ—¶ï¼‰ G1ï¼ˆGarbage Firstï¼‰ åˆ†åŒºæ¨¡å‹ å°†å †åˆ’åˆ†ä¸º Regionï¼Œé€»è¾‘åˆ†ä»£ï¼Œæ”¯æŒå¹¶å‘å‹ç¼©ï¼Œå¹³è¡¡å»¶è¿Ÿä¸åå JDK 7u4ï¼ˆæ­£å¼ï¼‰ -XX:+UseG1GC ğŸ’¾ 4GB ~ æ•°å GB ZGCï¼ˆZ Garbage Collectorï¼‰ åˆ†åŒºæ¨¡å‹ Region å¼¹æ€§å¤§å°ï¼Œæ”¯æŒè¶…å¤§å †ï¼Œä½å»¶è¿Ÿï¼ˆ&lt;10ms åœé¡¿ï¼‰ JDK 11ï¼ˆå®éªŒï¼‰ï¼ŒJDK 15ï¼ˆæ­£å¼ï¼‰ -XX:+UseZGC ğŸ’¾ 8GB ~ æ•° TBï¼ˆè¶…å¤§å †ï¼‰ Shenandoah åˆ†åŒºæ¨¡å‹ çº¢å¸½ä¸»å¯¼ï¼Œä½å»¶è¿Ÿï¼Œå¹¶å‘å›æ”¶ä¸å¹¶å‘å‹ç¼© JDK 12ï¼ˆå®éªŒï¼‰ï¼ŒJDK 15ï¼ˆæ­£å¼ï¼‰ -XX:+UseShenandoahGC ğŸ’¾ 2GB ~ æ•°å GB å¯¹äº CMSï¼Œå¯ç”¨åä¼šè‡ªåŠ¨ä½¿ç”¨ ParNew ä½œä¸ºæ–°ç”Ÿä»£å›æ”¶å™¨ï¼ˆé™¤éæ˜¾å¼ç¦æ­¢ï¼‰ã€‚ CMS å·²åœ¨ JDK 9 å¼€å§‹æ ‡è®°ä¸ºå¼ƒç”¨ï¼ŒJDK 14 å®Œå…¨ç§»é™¤ï¼Œä¸æ¨èå†ä½¿ç”¨ã€‚ å¯¹äº Parallel GC å¯ç”¨ -XX:+UseParallelGCï¼ˆæ–°ç”Ÿä»£ï¼‰ä¼šè‡ªåŠ¨å¯ç”¨ -XX:+UseParallelOldGCï¼ˆè€å¹´ä»£ï¼‰ã€‚ å¯¹äºZGCï¼Œjdk15ä»¥å‰æœ€å¤§æ”¯æŒ4Tå†…å­˜ï¼Œä¹‹åæœ€å¤§æ”¯æŒ16Tå†…å­˜ã€‚ å„ç‰ˆæœ¬é»˜è®¤åƒåœ¾å›æ”¶å™¨åŠæ¨èé…ç½®ï¼ˆJDK 1.6 èµ·ï¼‰ JDK ç‰ˆæœ¬ é»˜è®¤ GC å»ºè®®ä½¿ç”¨ GCï¼ˆæŒ‰åœºæ™¯åˆ†ç±»ï¼‰ JDK 1.6 Serial / Parallel - å°å‹åº”ç”¨ï¼ˆå¦‚æ¡Œé¢ç¨‹åºï¼‰ï¼š-XX:+UseSerialGC - ä¸­å¤§å‹åº”ç”¨ï¼ˆååé‡ä¼˜å…ˆï¼‰ï¼š-XX:+UseParallelGC JDK 1.7 åŒä¸Š åŒ JDK 1.6 JDK 1.8 Parallel - ååä¼˜å…ˆï¼šé»˜è®¤ -XX:+UseParallelGC - å“åº”ä¼˜å…ˆï¼š-XX:+UseConcMarkSweepGCï¼ˆCMSï¼‰ - å¤§å † + æœªæ¥å‡çº§è€ƒè™‘ï¼š-XX:+UseG1GCï¼ˆæ¨èï¼‰ JDK 9-14 G1 GC - ä¸€èˆ¬é»˜è®¤å³å¯ï¼š-XX:+UseG1GCï¼ˆå»¶è¿Ÿä¸ååå¹³è¡¡ï¼‰ - æç«¯ä½å»¶è¿Ÿè¦æ±‚ï¼šå‡çº§åˆ° JDK 11+ ä½¿ç”¨ ZGC/Shenandoah JDK 15+ G1 GCï¼ˆé»˜è®¤ï¼‰ï¼ŒZGC / Shenandoah å¯é€‰ - å»¶è¿Ÿæ•æ„Ÿï¼ˆåœ¨çº¿æœåŠ¡ã€RTç³»ç»Ÿï¼‰ï¼š-XX:+UseZGC æˆ– -XX:+UseShenandoahGC - ååä¸ºä¸»ï¼š-XX:+UseParallelGC - ç»¼åˆå¹³è¡¡ï¼š-XX:+UseG1GCï¼ˆé»˜è®¤ï¼‰ åˆ¤æ–­é»˜è®¤ GC çš„æ–¹å¼ 1java -XX:+PrintCommandLineFlags -version åƒåœ¾å›æ”¶ç®—æ³• JVM ä¸­å¸¸è§åƒåœ¾å›æ”¶ç®—æ³•æ±‡æ€» ç®—æ³•åç§° æ ¸å¿ƒæ€æƒ³ é€‚ç”¨é˜¶æ®µ/åŒºåŸŸ ä¼˜ç¼ºç‚¹ç®€è¿° æ ‡è®°-æ¸…é™¤ï¼ˆMark-Sweepï¼‰ æ ‡è®°å‡ºå­˜æ´»å¯¹è±¡ï¼Œæ¸…é™¤æœªæ ‡è®°å¯¹è±¡ è€å¹´ä»£ ç®€å•é«˜æ•ˆï¼Œä½†ä¼šäº§ç”Ÿå¤§é‡ç¢ç‰‡ï¼Œä¸é€‚åˆè¿ç»­å†…å­˜åˆ†é… æ ‡è®°-æ•´ç†ï¼ˆMark-Compactï¼‰ æ ‡è®°åç§»åŠ¨å­˜æ´»å¯¹è±¡ï¼Œæ•´ç†ç¢ç‰‡ è€å¹´ä»£ æ¶ˆé™¤ç¢ç‰‡ï¼Œä»£ä»·æ˜¯ç§»åŠ¨å¯¹è±¡ï¼Œé€‚ç”¨äºè€å¹´ä»£å‹ç¼© å¤åˆ¶ç®—æ³•ï¼ˆCopyingï¼‰ å°†å¯¹è±¡å¤åˆ¶åˆ°å¦ä¸€å—å†…å­˜ï¼ˆå¦‚ Eden â†’ Survivorï¼‰ æ–°ç”Ÿä»£ é«˜æ•ˆç‡ï¼Œé€‚åˆå›æ”¶å¤§å¤šæ•°å¯¹è±¡çŸ­å‘½çš„æ–°ç”Ÿä»£ï¼Œä½†éœ€è¦é¢å¤–ç©ºé—´ åˆ†ä»£å›æ”¶ï¼ˆGenerationalï¼‰ å°†å¯¹è±¡æŒ‰ç”Ÿå‘½å‘¨æœŸåˆ’åˆ†ï¼ˆæ–°ç”Ÿä»£/è€å¹´ä»£ï¼‰ æ•´ä¸ªå †ç»“æ„ å®ç”¨æ€§å¼ºï¼Œç»“åˆä¸åŒç®—æ³•åº”ç”¨äºä¸åŒä»£ï¼Œç°ä»£ GC åŸºç¡€ åˆ†åŒºå›æ”¶ï¼ˆRegion-basedï¼‰ å°†å †åˆ’åˆ†ä¸ºè‹¥å¹²ç­‰å¤§å°çš„ Region åŠ¨æ€åˆ†é… æ•´ä¸ªå †ï¼ˆå¦‚ G1ã€ZGCï¼‰ æ›´çµæ´»ï¼Œæ”¯æŒå¹¶å‘å¹¶è¡Œï¼Œå‡å°‘ STW åœé¡¿ï¼Œé€‚ç”¨äºå¤§å †ã€ä½å»¶è¿Ÿåœºæ™¯ å¢é‡å›æ”¶ï¼ˆIncrementalï¼‰ åˆ†é˜¶æ®µå°æ­¥æ‰§è¡Œ GC ä»¥å‡å°‘å•æ¬¡åœé¡¿ æŸäº›å¹¶å‘/ä½å»¶è¿Ÿ GC å‡å°‘æš‚åœæ—¶é—´ï¼Œä½†æ•´ä½“æ•ˆç‡å¯èƒ½é™ä½ å¹¶å‘å›æ”¶ï¼ˆConcurrentï¼‰ æ ‡è®°ã€æ¸…ç†ç­‰æ­¥éª¤ä¸åº”ç”¨çº¿ç¨‹å¹¶å‘æ‰§è¡Œ CMSã€G1ã€ZGC ç­‰ åœé¡¿æ—¶é—´çŸ­ï¼Œå¯¹å“åº”æ—¶é—´è¦æ±‚é«˜çš„ç³»ç»Ÿå‹å¥½ ä¸‰è‰²æ ‡è®°ï¼ˆTri-color Markingï¼‰ å¹¶å‘æ ‡è®°ç®—æ³•çš„ä¸€ç§å®ç°æ€æƒ³ CMSã€G1ã€ZGC ç­‰ ç™½ï¼ˆå¾…å›æ”¶ï¼‰ã€ç°ï¼ˆå·²æ ‡è®°æœªæ‰«æï¼‰ã€é»‘ï¼ˆå·²æ ‡è®°å·²æ‰«æï¼‰ï¼Œé¿å…â€œæ¼æ ‡â€é—®é¢˜ SATBï¼ˆSnapshot-At-The-Beginningï¼‰ å¹¶å‘æ ‡è®°çš„å¿«ç…§ç­–ç•¥ G1ã€ZGC ä¿è¯åœ¨å¹¶å‘æ ‡è®°è¿‡ç¨‹ä¸­ä¸é—æ¼æ–°å¼•ç”¨ï¼Œé€‚åˆé«˜å¹¶å‘åœºæ™¯ Lazy Compactionï¼ˆå»¶è¿Ÿå‹ç¼©ï¼‰ ä¸æ¯æ¬¡ GC éƒ½å‹ç¼©ï¼Œè§†æƒ…å†µè€Œå®š G1 ç­‰ é™ä½ä¸å¿…è¦çš„ç§»åŠ¨æˆæœ¬ å¯¹åº”å…³ç³»ï¼šGC å›æ”¶å™¨å’Œåº•å±‚ç®—æ³• å›æ”¶å™¨ ä½¿ç”¨çš„ç®—æ³•ç»„åˆ Serial æ–°ç”Ÿä»£ï¼šå¤åˆ¶ç®—æ³•è€å¹´ä»£ï¼šæ ‡è®°-æ•´ç† ParNew æ–°ç”Ÿä»£ï¼šå¤åˆ¶ç®—æ³•ï¼ˆå¤šçº¿ç¨‹ï¼‰ Parallel æ–°ç”Ÿä»£ï¼šå¤åˆ¶ç®—æ³•è€å¹´ä»£ï¼šæ ‡è®°-æ•´ç† CMS æ–°ç”Ÿä»£ï¼šParNewï¼ˆå¤åˆ¶ï¼‰è€å¹´ä»£ï¼šæ ‡è®°-æ¸…é™¤ + ä¸‰è‰²æ ‡è®° + å¹¶å‘ G1 åˆ†åŒºå›æ”¶ + ä¸‰è‰²æ ‡è®° + SATB + Lazy Compaction ZGC åˆ†åŒºå›æ”¶ + å¹¶å‘æ ‡è®° + SATB + Region Remapping Shenandoah åˆ†åŒºå›æ”¶ + å¹¶å‘æ ‡è®° + å¹¶å‘å‹ç¼© + ä¸‰è‰²æ ‡è®° 1234567891011 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ å¸¸è§ GC ç®—æ³•åˆ†ç±» â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚åˆ†ä»£æ¨¡å‹ åˆ†åŒºæ¨¡å‹ â”‚ â”‚ â”Œâ”€â”´â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”´â”€â”€â”€â”€â”€â”å¤åˆ¶ æ ‡è®°-æ¸…é™¤ Region-based å¹¶å‘ æ ‡è®°-æ•´ç† SATB / ä¸‰è‰²æ ‡è®° ä»€ä¹ˆæ˜¯ STWï¼ˆStop-The-Worldï¼‰ STWï¼ˆStop-The-Worldï¼‰ æŒ‡çš„æ˜¯ï¼šåœ¨æŸäº›åƒåœ¾å›æ”¶é˜¶æ®µï¼ŒJVM ä¼šæš‚åœæ‰€æœ‰åº”ç”¨çº¿ç¨‹ï¼ˆä¹Ÿå«ç”¨æˆ·çº¿ç¨‹ï¼‰ï¼Œè®©åƒåœ¾å›æ”¶çº¿ç¨‹ç‹¬å  CPU æ‰§è¡Œ GC é€»è¾‘ã€‚ ä½ å¯ä»¥è¿™æ ·ç†è§£ STW JVM ä¼šâ€œæŒ‰ä¸‹æš‚åœé”®â€æš‚åœæ‰€æœ‰æ­£åœ¨è¿è¡Œçš„ Java ç¨‹åºä»£ç ï¼› ç„¶å ä¸“å¿ƒè¿›è¡Œ GC çš„æŸäº›é˜¶æ®µï¼ˆå¦‚æ ‡è®°ã€æ•´ç†ã€å¤åˆ¶ç­‰ï¼‰ï¼› GC å®Œæˆåï¼Œæ‰ä¼šâ€œæ¢å¤è¿è¡Œâ€åº”ç”¨çº¿ç¨‹ã€‚ å„ GC ä¸­ STW çš„å­˜åœ¨æƒ…å†µ å›æ”¶å™¨ æ˜¯å¦å­˜åœ¨ STWï¼Ÿ è¯´æ˜ Serial âœ… æ˜¯ï¼Œå…¨åœé¡¿ï¼Œå…¨é˜¶æ®µå•çº¿ç¨‹ å †è¶Šå¤§ STW è¶Šé•¿ Parallel âœ… æ˜¯ï¼Œå…¨åœé¡¿ï¼Œå¤šçº¿ç¨‹æ‰§è¡Œ GC æé«˜æ•ˆç‡ä½†ä»ä¼šæš‚åœ CMS âœ… æœ‰ï¼Œåˆå§‹æ ‡è®°å’Œæœ€ç»ˆé‡æ–°æ ‡è®°æ˜¯ STW å¤§éƒ¨åˆ†é˜¶æ®µå¹¶å‘æ‰§è¡Œ G1 âœ… æœ‰ï¼Œä½†è®¾è®¡ä¸ºå°½å¯èƒ½ç¼©çŸ­ STW åˆ†é˜¶æ®µå¹¶å‘ + å¹¶è¡Œå¤„ç† ZGC âœ… æçŸ­ï¼ˆ&lt;10msï¼‰ ä»…ä¸ªåˆ«é˜¶æ®µæ˜¯ STWï¼Œå‡ ä¹æ„ŸçŸ¥ä¸åˆ° Shenandoah âœ… æçŸ­ é«˜åº¦å¹¶å‘ï¼ŒSTW æ—¶é—´ä¹ŸæçŸ­ ä¸ºä»€ä¹ˆè¦å…³æ³¨ STWï¼Ÿ åœ¨å“åº”æ—¶é—´æ•æ„Ÿå‹ç³»ç»Ÿï¼ˆå¦‚åœ¨çº¿äº¤æ˜“ç³»ç»Ÿã€æ¸¸æˆæœåŠ¡å™¨ã€API ç½‘å…³ï¼‰ä¸­ï¼Œé•¿æ—¶é—´çš„ STW ä¼šé€ æˆç”¨æˆ·è¯·æ±‚å¡é¡¿ã€è¶…æ—¶ã€‚ å› æ­¤ï¼Œé€‰æ‹© ä½ STW çš„ GCï¼ˆå¦‚ G1ã€ZGCã€Shenandoahï¼‰ å¯¹è¿™ç±»ç³»ç»Ÿè‡³å…³é‡è¦ã€‚ å †å†…å­˜ç»“æ„ ä¸åŒçš„åƒåœ¾å›æ”¶å™¨å†³å®šäº†å †å†…å­˜çš„ç»“æ„ä¸åŒï¼Œä½†æ€»ä½“ä¸Šåˆ†ä¸ºä¸¤ç§ç±»å‹ï¼šåˆ†ä»£æ¨¡å‹å’Œåˆ†åŒºæ¨¡å‹ã€‚ åˆ†ä»£æ¨¡å‹ Parallel åƒåœ¾å›æ”¶å™¨ å †ç»“æ„è¢«åˆ’åˆ†ä¸º Old Generationï¼ˆè€å¹´ä»£ï¼‰ å’Œ Young Generationï¼ˆæ–°ç”Ÿä»£ï¼‰ ä¸¤éƒ¨åˆ†ã€‚ Young Generation ç”± Eden å’Œ ä¸¤ä¸ª Survivor ç»„æˆï¼Œå…¶ä¸­ Eden æ˜¯ä¸€ä¸ªè¿ç»­çš„å†…å­˜åŒºåŸŸï¼ŒSurvivor æ˜¯ä¸€ä¸ªéè¿ç»­çš„å†…å­˜åŒºåŸŸã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼ŒYoung Generationå å †å†…å­˜çš„ 1/3, Old Generation å å †å†…å­˜çš„ 2/3ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼ŒEden:S0:S1 = 8:1:1 ,å¦‚æœå¸Œæœ›ä¸º 4:1:1ï¼Œä½¿ç”¨ -XX:SurvivorRatio=4ï¼Œä½†å®é™…ä¸Šè¿™ä¸ªæ¯”ä¾‹å¹¶ä¸æ˜¯å›ºå®šçš„ï¼Œè€Œæ˜¯ç”±jvmåŸºäºæƒ…å†µè‡ªåŠ¨å˜åŒ–çš„ï¼Œå› ä¸ºJVMé»˜è®¤å¼€å¯äº†è¿™ä¸ªå‚æ•°-XX:+UseAdaptiveSizePolicyï¼Œå¦‚æœå¸Œæœ›å›ºå®šè¿™ä¸ªæ¯”ä¾‹ï¼Œå¯ä»¥è®¾ç½®ä¸º -XX:-UseAdaptiveSizePolicyæ¥å…³é—­è¿™ä¸ªé…ç½®ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œå¯¹è±¡æœ€å¤šç»å†15æ¬¡Minor GCåè¿›å…¥è€å¹´ä»£ï¼Œå¯ä»¥é€šè¿‡ -XX:MaxTenuringThreshold=n è®¾ç½®ã€‚ åŒºåŸŸ è¯´æ˜ Eden å¯¹è±¡é¦–æ¬¡åˆ›å»ºçš„åŒºåŸŸï¼Œå¤§éƒ¨åˆ†å¯¹è±¡åœ¨è¿™é‡Œåˆ›å»ºå¹¶å¾ˆå¿«è¢«å›æ”¶ S0/S1 Survivor åŒºåŸŸï¼šä¸¤ä¸ªäº¤æ›¿ä½¿ç”¨çš„ç¼“å†²åŒºï¼ˆFrom å’Œ Toï¼‰ï¼Œç”¨äºæ‹·è´å­˜æ´»å¯¹è±¡ Old è€å¹´ä»£ï¼šå­˜æ´»æ¬¡æ•°å¤šã€ç”Ÿå‘½å‘¨æœŸé•¿çš„å¯¹è±¡ä¼šä»æ–°ç”Ÿä»£æ™‹å‡åˆ°è€å¹´ä»£ï¼Œå›æ”¶é¢‘ç‡ä½ å¯¹è±¡å†…å­˜åˆ†é…å›¾è§£(ç®€åŒ–) 12345678910111213åˆ›å»ºå¯¹è±¡ â†“è¿›å…¥ Eden åŒºï¼ˆæ–°ç”Ÿä»£ï¼‰ â†“ Eden åŒºæ»¡ç¬¬ä¸€æ¬¡ Minor GCï¼ˆå­˜æ´»å¯¹è±¡[Eden]å¤åˆ¶åˆ° S0ï¼‰ â†“ Eden åŒºæ»¡ æˆ– S0 åŒºæ»¡ç¬¬äºŒæ¬¡ Minor GCï¼ˆå­˜æ´»å¯¹è±¡[Edenå’ŒS0]å¤åˆ¶åˆ° S1ï¼Œå¹´é¾„ +1ï¼‰ â†“ Eden åŒºæ»¡ æˆ– S1 åŒºæ»¡ç¬¬ä¸‰æ¬¡ Minor GCï¼ˆå­˜æ´»å¯¹è±¡[Edenå’ŒS1]å¤åˆ¶åˆ° S0ï¼Œå¹´é¾„ +1ï¼‰ â†“â€¦â€¦ S0/S1 äº¤æ›¿ï¼Œå¹´é¾„è¾¾åˆ°é˜ˆå€¼ï¼ˆå¦‚ 15ï¼‰ â†“ è¿˜æ²¡æœ‰è¢«å›æ”¶æ™‹å‡åˆ° Old åŒºï¼ˆè€å¹´ä»£ï¼‰ï¼Œç­‰å¾…OldåŒºæ»¡ è§¦å‘ Full GC å¤§å¯¹è±¡ç›´æ¥è¿›å…¥è€å¹´ä»£ å¤§å¯¹è±¡å°±æ˜¯éœ€è¦å¤§é‡è¿ç»­å†…å­˜ç©ºé—´çš„å¯¹è±¡ï¼ˆæ¯”å¦‚ï¼šå­—ç¬¦ä¸²ã€æ•°ç»„ï¼‰ï¼Œå¦‚æœå¯¹è±¡å¾ˆå¤§ï¼ˆå¦‚è¶…è¿‡ Eden åŒºå¤§å°ï¼Œæˆ–æ˜¯è¶…è¿‡ Survivor åŒºå¤§å°ï¼‰ï¼Œå¯èƒ½ç›´æ¥åˆ†é…åˆ°è€å¹´ä»£ ä¹Ÿå¯ä»¥é€šè¿‡ -XX:PretenureSizeThreshold=&lt;å¤§å°ï¼Œå•ä½å­—èŠ‚&gt; æ§åˆ¶è¶…è¿‡ä¸€å®šå¤§å°çš„å¯¹è±¡æ˜¯å¦ç›´æ¥åˆ†é…åˆ°è€å¹´ä»£ï¼ˆOld Generationï¼‰ï¼Œè·³è¿‡æ–°ç”Ÿä»£ï¼ˆEdenï¼‰ï¼Œä»¥é¿å…å¤§å¯¹è±¡é¢‘ç¹åœ¨å¹´è½»ä»£é€ æˆ GC å‹åŠ›ã€‚è¿™ä¸ªå‚æ•°åªåœ¨ Serial å’ŒParNewä¸¤ä¸ªæ”¶é›†å™¨ä¸‹æœ‰æ•ˆã€‚ å¯¹è±¡åŠ¨æ€å¹´é¾„åˆ¤æ–­ å¯¹è±¡åœ¨SurvivoråŒºæ¥å›ç§»åŠ¨æ—¶ï¼Œå¦‚æœè¿™æ‰¹å¯¹è±¡çš„æ€»å¤§å°å¤§äºè¿™å—SurvivoråŒºåŸŸå†…å­˜å¤§å°çš„50%(-XX:TargetSurvivorRatioå¯ä»¥æŒ‡å®š)ï¼Œé‚£ä¹ˆæ­¤æ—¶å¤§äºç­‰äºè¿™æ‰¹å¯¹è±¡å¹´é¾„æœ€å¤§å€¼çš„å¯¹è±¡ï¼Œå°±å¯ä»¥ç›´æ¥è¿›å…¥è€å¹´ä»£äº†ï¼Œ ä¾‹å¦‚SurvivoråŒºåŸŸé‡Œç°åœ¨æœ‰ä¸€æ‰¹å¯¹è±¡ï¼Œå¹´é¾„1+å¹´é¾„2+å¹´é¾„nçš„å¤šä¸ªå¹´é¾„å¯¹è±¡æ€»å’Œè¶…è¿‡äº†SurvivoråŒºåŸŸçš„50%ï¼Œæ­¤æ—¶å°±ä¼šæŠŠå¹´é¾„n(å«)ä»¥ä¸Šçš„å¯¹è±¡éƒ½æ”¾å…¥è€å¹´ä»£ã€‚è¿™ä¸ªè§„åˆ™å…¶å®æ˜¯å¸Œæœ›é‚£äº›å¯èƒ½æ˜¯é•¿æœŸå­˜æ´»çš„å¯¹è±¡ï¼Œå°½æ—©è¿›å…¥è€å¹´ä»£ã€‚ å¯¹è±¡åŠ¨æ€å¹´é¾„åˆ¤æ–­æœºåˆ¶ä¸€èˆ¬æ˜¯åœ¨minor gcä¹‹åè§¦å‘çš„ã€‚ å¯¹è±¡é€ƒé€¸åˆ†æ å¦‚æœå¯¹è±¡å¾ˆå°ï¼Œä¸”åªåœ¨æ–¹æ³•å†…éƒ¨ä½¿ç”¨ï¼Œå¹¶æ²¡æœ‰è¢«å¤–éƒ¨å¼•ç”¨ï¼Œåˆ™å…¶æœ‰å¯èƒ½ç›´æ¥åˆ†é…åˆ°æ ˆå†…å­˜ï¼Œè€Œä¸è¿›å…¥å †å†…å­˜ JVMå¯¹äºè¿™ç§æƒ…å†µå¯ä»¥é€šè¿‡å¼€å¯é€ƒé€¸åˆ†æå‚æ•°(-XX:+DoEscapeAnalysis)æ¥ä¼˜åŒ–å¯¹è±¡å†…å­˜åˆ†é…ä½ç½®ï¼Œä½¿å…¶é€šè¿‡æ ‡é‡æ›¿æ¢ä¼˜å…ˆåˆ†é…åœ¨æ ˆä¸Š(æ ˆä¸Šåˆ†é…)ï¼ŒJDK7ä¹‹åé»˜è®¤å¼€å¯é€ƒé€¸åˆ†æï¼Œå¦‚æœè¦å…³é—­ä½¿ç”¨å‚æ•°(-XX:-DoEscapeAnalysis) æ ‡é‡æ›¿æ¢ é€šè¿‡é€ƒé€¸åˆ†æç¡®å®šè¯¥å¯¹è±¡ä¸ä¼šè¢«å¤–éƒ¨è®¿é—®ï¼Œå¹¶ä¸”å¯¹è±¡å¯ä»¥è¢«è¿›ä¸€æ­¥åˆ†è§£æ—¶ï¼ŒJVMä¸ä¼šåˆ›å»ºè¯¥å¯¹è±¡ï¼Œè€Œæ˜¯å°†è¯¥å¯¹è±¡æˆå‘˜å˜é‡åˆ†è§£è‹¥å¹²ä¸ªè¢«è¿™ä¸ªæ–¹æ³•ä½¿ç”¨çš„æˆå‘˜å˜é‡æ‰€ä»£æ›¿ï¼Œè¿™äº›ä»£æ›¿çš„æˆå‘˜å˜é‡åœ¨æ ˆå¸§æˆ–å¯„å­˜å™¨ä¸Šåˆ†é…ç©ºé—´ï¼Œè¿™æ ·å°±ä¸ä¼šå› ä¸ºæ²¡æœ‰ä¸€å¤§å—è¿ç»­ç©ºé—´å¯¼è‡´å¯¹è±¡å†…å­˜ä¸å¤Ÿåˆ†é…ã€‚ å¼€å¯æ ‡é‡æ›¿æ¢å‚æ•°(-XX:+EliminateAllocations)ï¼ŒJDK7ä¹‹åé»˜è®¤å¼€å¯ã€‚ æ ‡é‡ä¸èšåˆé‡ æ ‡é‡å³ä¸å¯è¢«è¿›ä¸€æ­¥åˆ†è§£çš„é‡ï¼Œè€ŒJAVAçš„åŸºæœ¬æ•°æ®ç±»å‹å°±æ˜¯æ ‡é‡ï¼ˆå¦‚ï¼šintï¼Œlongç­‰åŸºæœ¬æ•°æ®ç±»å‹ä»¥åŠreferenceç±»å‹ç­‰ï¼‰ï¼Œ æ ‡é‡çš„å¯¹ç«‹å°±æ˜¯å¯ä»¥è¢«è¿›ä¸€æ­¥åˆ†è§£çš„é‡ï¼Œè€Œè¿™ç§é‡ç§°ä¹‹ä¸ºèšåˆé‡ã€‚è€Œåœ¨JAVAä¸­å¯¹è±¡å°±æ˜¯å¯ä»¥è¢«è¿›ä¸€æ­¥åˆ†è§£çš„èšåˆé‡ã€‚ Parallel åƒåœ¾å›æ”¶å™¨ï¼ˆParallel GCï¼‰ çš„å·¥ä½œæ–¹å¼ Parallel GC æ˜¯å¤šçº¿ç¨‹åƒåœ¾å›æ”¶å™¨ï¼Œå¯ä»¥é€šè¿‡ -XX:ParallelGCThreads æ¥è®¾ç½®GCçº¿ç¨‹æ•°é‡ã€‚ å½“ Parallel GC è¢«è§¦å‘ï¼ˆä¾‹å¦‚ Minor GC æˆ– Full GCï¼‰æ—¶ï¼Œæ‰€æœ‰ç”¨æˆ·çº¿ç¨‹ è¢«å®Œå…¨æš‚åœï¼ˆStop-The-World, STWï¼‰ Parallel GC å‚æ•°é…ç½®è¡¨ï¼ˆååé‡ä¼˜å…ˆ GCï¼‰ å‚æ•°å è¯´æ˜ é»˜è®¤å€¼ï¼ˆå¦‚æœªç‰¹åˆ«è¯´æ˜ï¼‰ -XX:+UseParallelGC å¼€å¯ Parallel GCï¼Œç”¨äºæ–°ç”Ÿä»£æ”¶é›† - -XX:+UseParallelOldGC å¼€å¯è€å¹´ä»£å¹¶è¡Œæ”¶é›†ï¼ˆParallel Oldï¼‰ - -XX:ParallelGCThreads åƒåœ¾å›æ”¶æ—¶çš„å¹¶è¡Œçº¿ç¨‹æ•°ï¼ˆä¸ CPU æ•°é‡ç›¸å…³ï¼‰ æ ¹æ®ç¡¬ä»¶è‡ªåŠ¨é…ç½® -XX:MaxGCPauseMillis è®¾ç½® GC æœ€å¤§æš‚åœæ—¶é—´ç›®æ ‡ï¼ˆå½±å“å†…å­˜åˆ†é…ç­–ç•¥ï¼‰ ä¸€ä¸ªéå¸¸å¤§çš„å€¼ï¼Œå¯ä»¥è®¤ä¸ºæ— é™åˆ¶ï¼ˆå»ºè®®æŒ‰éœ€è®¾ç½®ï¼‰ -XX:GCTimeRatio è®¾ç½® GC æ—¶é—´ä¸åº”ç”¨è¿è¡Œæ—¶é—´çš„æ¯”å€¼ï¼ˆ0~100ï¼‰å€¼è¶Šå°ï¼ŒGC è¶Šé¢‘ç¹ï¼Œå€¼è¶Šå¤§ GC è¶Šå°‘ 99ï¼ˆè¡¨ç¤º 1% ç”¨äº GCï¼Œ99% ç”¨äºåº”ç”¨ï¼‰ -XX:+UseAdaptiveSizePolicy å¯ç”¨è‡ªé€‚åº” GC ç­–ç•¥ï¼ˆæ ¹æ®è¿è¡ŒçŠ¶å†µè‡ªåŠ¨è°ƒæ•´å„åŒºåŸŸå¤§å°ï¼‰ é»˜è®¤å¼€å¯ -XX:SurvivorRatio Eden ä¸ Survivor çš„å†…å­˜æ¯”ä¾‹ï¼ˆå¦‚ 8 è¡¨ç¤º Eden:S0:S1 = 8:1:1ï¼‰ 8 -XX:InitialTenuringThreshold å¯¹è±¡æ™‹å‡åˆ°è€å¹´ä»£çš„åˆå§‹å¹´é¾„ï¼ˆä¼šéšè¿è¡ŒåŠ¨æ€è°ƒæ•´ï¼‰ 7 -XX:MaxTenuringThreshold æ™‹å‡åˆ°è€å¹´ä»£çš„æœ€å¤§å¹´é¾„ï¼ˆå¯¹è±¡åœ¨ Survivor åŒºç»å†å‡ æ¬¡ GCï¼‰ 15 -XX:PretenureSizeThreshold è®¾ç½®å¤§å¯¹è±¡é˜ˆå€¼ï¼Œè¶…è¿‡è¯¥å¤§å°çš„å¯¹è±¡ç›´æ¥åˆ†é…åˆ°è€å¹´ä»£ 0ï¼ˆå³ç¦ç”¨ï¼‰ -XX:+ScavengeBeforeFullGC åœ¨ Full GC ä¹‹å‰æ˜¯å¦å…ˆæ‰§è¡Œä¸€æ¬¡ Minor GC trueå¯ -XX:+UseFastAccessorMethods ä¼˜åŒ–åŸå§‹ç±»å‹çš„ get/set æ–¹æ³•æ€§èƒ½ falseå¯ -XX:+AlwaysPreTouch JVM å¯åŠ¨æ—¶ç«‹å³åˆ†é…å¹¶åˆå§‹åŒ–æ‰€æœ‰å†…å­˜é¡µï¼Œé¿å…è¿è¡Œæ—¶é¦–æ¬¡åˆ†é…å¸¦æ¥çš„åœé¡¿ false åˆ†åŒºæ¨¡å‹ G1 åƒåœ¾å›æ”¶å™¨ G1(Garbage-First) å±äº ç‰©ç†ä¸Šåˆ†åŒºï¼Œé€»è¾‘ä¸Šåˆ†ä»£ï¼ŒçœŸæ­£çš„åˆ†åŒºæ¨¡å‹æ˜¯ ZGCï¼ˆjdk21åä¹Ÿæ”¯æŒåˆ†ä»£ï¼‰ G1å°†Javaå †åˆ’åˆ†ä¸ºå¤šä¸ªå¤§å°ç›¸ç­‰çš„ç‹¬ç«‹åŒºåŸŸï¼ˆRegionï¼‰ï¼Œåœ¨JDK10ä»¥å‰ï¼ŒJVMæœ€å¤šå¯ä»¥æœ‰2048ä¸ªRegionï¼Œæ¯ä¸ª Region çš„å¤§å°æ˜¯ 2^n MBï¼Œå¹¶ä¸”è½åœ¨ 1MB åˆ° 32MB ä¹‹é—´ï¼Œè¿™å°±å¯¼è‡´G1æœ€å¤§æ”¯æŒ64G çš„å † (2048 Regions Ã— 32MB = 64GB)ï¼Œåœ¨JDK10ä»¥åï¼ŒG1 æ”¯æŒ æ›´å¤š Regionï¼ˆæœ€å¤šçº¦ 32,768 ä¸ªï¼‰ï¼Œè€ŒRegion å¤§å°ä»æ˜¯ 1MBï½32MB çš„ 2 çš„å¹‚ï¼Œä½¿å…¶æœ€å¤§å¯ä»¥æ”¯æŒ 1T çš„å †ã€‚JDK17å¼€å§‹ï¼ŒHotSpot JVM å·²æ”¹è¿› G1 çš„ Region æ˜ å°„æ–¹å¼ï¼ˆå¦‚æå‡æ¯ä¸ªRegionçš„å¤§å°ï¼‰ï¼Œå¯ä»¥è¿›ä¸€æ­¥æå‡æ”¯æŒçš„å †å¤§å°ä¸Šé™ã€‚ä½†å †è¶Šå¤§ï¼ŒFullGCå°±è¶Šæ…¢ï¼Œå»ºè®® &gt;1T çš„å †ä½¿ç”¨ZGCæˆ–Shenandoah GCã€‚ ä¸€èˆ¬Regionå¤§å°ç”±JVMè‡ªåŠ¨è®¡ç®—ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ç”¨å‚æ•°-XX:G1HeapRegionSizeæ‰‹åŠ¨æŒ‡å®šRegionå¤§å°ï¼Œä½†æ˜¯æ¨èé»˜è®¤çš„è®¡ç®—æ–¹å¼ã€‚ G1ä¿ç•™äº†å¹´è½»ä»£å’Œè€å¹´ä»£çš„æ¦‚å¿µï¼Œä½†ä¸å†æ˜¯ç‰©ç†éš”é˜‚äº†ï¼Œå®ƒä»¬éƒ½æ˜¯ï¼ˆå¯ä»¥ä¸è¿ç»­ï¼‰Regionçš„é›†åˆã€‚ åœ¨ G1 GC ä¸­ï¼Œä¸è¦ä½¿ç”¨ -Xmnï¼ŒG1 ä¸­æ¨èä½¿ç”¨ä»¥ä¸‹æ›´ç»†ç²’åº¦çš„æ§åˆ¶æ–¹å¼ï¼š 123# è¿™æ˜¯å®éªŒæ€§å‚æ•°ï¼Œéœ€è¦å¼€å¯ `-XX:+UnlockExperimentalVMOptions`ï¼Œä½†ä¾æ—§æ¨èåœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨-XX:G1NewSizePercent=5-XX:G1MaxNewSizePercent=60 é»˜è®¤å¹´è½»ä»£å¯¹å †å†…å­˜çš„å æ¯”æ˜¯5%ï¼Œå¦‚æœå †å¤§å°ä¸º4096Mï¼Œé‚£ä¹ˆå¹´è½»ä»£å æ®200MBå·¦å³çš„å†…å­˜ï¼Œå¯¹åº”å¤§æ¦‚æ˜¯100ä¸ªRegionï¼Œå¯ä»¥é€šè¿‡ -XX:G1NewSizePercentè®¾ç½®æ–°ç”Ÿä»£åˆå§‹å æ¯”ï¼Œè¿™æ˜¯å®éªŒæ€§å‚æ•°ï¼Œéœ€è¦å¼€å¯ -XX:+UnlockExperimentalVMOptionsï¼Œä½†ä¾æ—§æ¨èåœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨ã€‚ åœ¨ç³»ç»Ÿè¿è¡Œä¸­ï¼ŒJVMä¼šä¸åœçš„ç»™å¹´è½»ä»£å¢åŠ æ›´å¤šçš„Regionï¼Œä½†æ˜¯æœ€å¤šæ–°ç”Ÿä»£çš„å æ¯”ä¸ä¼šè¶…è¿‡60%ï¼Œå¯ä»¥é€šè¿‡-XX:G1MaxNewSizePercentè°ƒæ•´ï¼Œè¿™æ˜¯å®éªŒæ€§å‚æ•°ï¼Œéœ€è¦å¼€å¯ -XX:+UnlockExperimentalVMOptionsï¼Œä½†ä¾æ—§æ¨èåœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨ã€‚ å¹´è½»ä»£ä¸­çš„Edenå’ŒSurvivorå¯¹åº”çš„regionä¹Ÿè·Ÿä¹‹å‰ä¸€æ ·ï¼Œé»˜è®¤8:1:1ï¼Œå‡è®¾å¹´è½»ä»£ç°åœ¨æœ‰1000ä¸ªregionï¼ŒedenåŒºå¯¹åº”800ä¸ªï¼Œs0å¯¹åº”100ä¸ªï¼Œs1å¯¹åº”100ä¸ªã€‚ ä¸€ä¸ªRegionå¯èƒ½ä¹‹å‰æ˜¯å¹´è½»ä»£ï¼Œå¦‚æœRegionè¿›è¡Œäº†åƒåœ¾å›æ”¶ï¼Œä¹‹åå¯èƒ½åˆä¼šå˜æˆè€å¹´ä»£ï¼Œä¹Ÿå°±æ˜¯è¯´Regionçš„åŒºåŸŸåŠŸèƒ½å¯èƒ½ä¼šåŠ¨æ€å˜åŒ–ã€‚ G1åƒåœ¾æ”¶é›†å™¨å¯¹äºå¯¹è±¡ä»€ä¹ˆæ—¶å€™ä¼šè½¬ç§»åˆ°è€å¹´ä»£è·Ÿä¹‹å‰è®²è¿‡çš„åŸåˆ™ä¸€æ ·ï¼Œå”¯ä¸€ä¸åŒçš„æ˜¯å¯¹å¤§å¯¹è±¡çš„å¤„ç†ï¼ŒG1æœ‰ä¸“é—¨åˆ†é…å¤§å¯¹è±¡çš„Regionå«HumongousåŒºï¼Œè€Œä¸æ˜¯è®©å¤§å¯¹è±¡ç›´æ¥è¿›å…¥è€å¹´ä»£çš„Regionä¸­ã€‚ åœ¨G1ä¸­ï¼Œå¤§å¯¹è±¡çš„åˆ¤å®šè§„åˆ™å°±æ˜¯ä¸€ä¸ªå¤§å¯¹è±¡è¶…è¿‡äº†ä¸€ä¸ªRegionå¤§å°çš„50%ï¼Œæ¯”å¦‚æŒ‰ç…§ä¸Šé¢ç®—çš„ï¼Œæ¯ä¸ªRegionæ˜¯2Mï¼Œåªè¦ä¸€ä¸ªå¤§å¯¹è±¡è¶…è¿‡äº†1Mï¼Œå°±ä¼šè¢«æ”¾å…¥Humongousä¸­ï¼Œè€Œä¸”ä¸€ä¸ªå¤§å¯¹è±¡å¦‚æœå¤ªå¤§ï¼Œå¯èƒ½ä¼šæ¨ªè·¨å¤šä¸ªRegionæ¥å­˜æ”¾ã€‚ HumongousåŒºä¸“é—¨å­˜æ”¾çŸ­æœŸå·¨å‹å¯¹è±¡ï¼Œä¸ç”¨ç›´æ¥è¿›è€å¹´ä»£ï¼Œå¯ä»¥èŠ‚çº¦è€å¹´ä»£çš„ç©ºé—´ï¼Œé¿å…å› ä¸ºè€å¹´ä»£ç©ºé—´ä¸å¤Ÿçš„GCå¼€é”€ã€‚ Full GCçš„æ—¶å€™é™¤äº†æ”¶é›†å¹´è½»ä»£å’Œè€å¹´ä»£ä¹‹å¤–ï¼Œä¹Ÿä¼šå°†HumongousåŒºä¸€å¹¶å›æ”¶ã€‚ G1åƒåœ¾æ”¶é›†åˆ†ç±» YoungGC YoungGCå¹¶ä¸æ˜¯è¯´ç°æœ‰çš„EdenåŒºæ”¾æ»¡äº†å°±ä¼šé©¬ä¸Šè§¦å‘ï¼ŒG1ä¼šè®¡ç®—ä¸‹ç°åœ¨EdenåŒºå›æ”¶å¤§æ¦‚è¦å¤šä¹…æ—¶é—´ï¼Œå¦‚æœå›æ”¶æ—¶é—´è¿œè¿œå°äºå‚æ•° -XX:MaxGCPauseMills è®¾å®šçš„å€¼ï¼Œé‚£ä¹ˆå¢åŠ å¹´è½»ä»£çš„regionï¼Œç»§ç»­ç»™æ–°å¯¹è±¡å­˜æ”¾ï¼Œä¸ä¼šé©¬ä¸ŠåšYoungGCï¼Œç›´åˆ°ä¸‹ä¸€æ¬¡EdenåŒºæ”¾æ»¡ï¼ŒG1è®¡ç®—å›æ”¶æ—¶é—´æ¥è¿‘å‚æ•° -XX:MaxGCPauseMills è®¾å®šçš„å€¼ï¼Œé‚£ä¹ˆå°±ä¼šè§¦å‘Young GC MixedGC ä¸æ˜¯FullGCï¼Œè€å¹´ä»£çš„å †å æœ‰ç‡è¾¾åˆ°å‚æ•° -XX:InitiatingHeapOccupancyPercent è®¾å®šçš„å€¼åˆ™è§¦å‘ï¼Œå›æ”¶æ‰€æœ‰çš„Youngå’Œéƒ¨åˆ†Old(æ ¹æ®æœŸæœ›çš„GCåœé¡¿æ—¶é—´ç¡®å®šoldåŒºåƒåœ¾æ”¶é›†çš„ä¼˜å…ˆé¡ºåº)ä»¥åŠå¤§å¯¹è±¡åŒºï¼Œæ­£å¸¸æƒ…å†µG1çš„åƒåœ¾æ”¶é›†æ˜¯å…ˆåšMixedGCï¼Œä¸»è¦ä½¿ç”¨å¤åˆ¶ç®—æ³•ï¼Œéœ€è¦æŠŠå„ä¸ªregionä¸­å­˜æ´»çš„å¯¹è±¡æ‹·è´åˆ°åˆ«çš„regioné‡Œå»ï¼Œæ‹·è´è¿‡ç¨‹ä¸­å¦‚æœå‘ç°æ²¡æœ‰è¶³å¤Ÿçš„ç©ºregionèƒ½å¤Ÿæ‰¿è½½æ‹·è´å¯¹è±¡å°±ä¼šè§¦å‘ä¸€æ¬¡Full GC Full GC åœæ­¢ç³»ç»Ÿç¨‹åºï¼Œç„¶åé‡‡ç”¨å•çº¿ç¨‹è¿›è¡Œæ ‡è®°ã€æ¸…ç†å’Œå‹ç¼©æ•´ç†ï¼Œå¥½ç©ºé—²å‡ºæ¥ä¸€æ‰¹Regionæ¥ä¾›ä¸‹ä¸€æ¬¡MixedGCä½¿ç”¨ï¼Œè¿™ä¸ªè¿‡ç¨‹æ˜¯éå¸¸è€—æ—¶çš„ã€‚(Shenandoahä¼˜åŒ–æˆå¤šçº¿ç¨‹æ”¶é›†äº†) G1 æ”¶é›†å™¨çš„å·¥ä½œæ–¹å¼ å›¾ä¸­ä¸»è¦å±•ç¤ºäº†ä¸€ä¸ªå…¸å‹çš„ G1 GC çš„ å¹¶å‘æ ‡è®°å‘¨æœŸï¼ˆConcurrent Mark Cycleï¼‰ çš„è¿‡ç¨‹ã€‚ å›¾ä¸­çš„æ°´å¹³ç®­å¤´è¡¨ç¤ºå„çº¿ç¨‹ï¼ˆç”¨æˆ·çº¿ç¨‹å’ŒGCçº¿ç¨‹ï¼‰çš„æ‰§è¡Œè·¯å¾„ã€‚ ç«–ç›´çš„Safepointçº¿è¡¨ç¤ºä¸€æ¬¡GCè¿‡ç¨‹ä¸­ä¼šæš‚åœæ‰€æœ‰ç”¨æˆ·çº¿ç¨‹çš„æ—¶åˆ»ï¼ˆStop-The-Worldï¼‰ã€‚ 12345678910111213141516171819202122231ï¸âƒ£ åˆå§‹æ ‡è®°ï¼ˆInitial Markï¼‰ è¿›å…¥ Safepointï¼š æ‰€æœ‰ç”¨æˆ·çº¿ç¨‹åœ¨æ­¤åˆ»æš‚åœï¼ˆSTWï¼‰ã€‚ æ ‡è®° GC Roots ç›´æ¥å¯è¾¾å¯¹è±¡ã€‚ éå¸¸çŸ­æš‚ï¼Œä½†å±äº Stop-The-World é˜¶æ®µã€‚ å›¾ä¸­æ˜¯â€œåˆå§‹æ ‡è®°â€ç®­å¤´åœ¨ Safepoint ä¹‹åç«‹åˆ»æ‰§è¡Œã€‚2ï¸âƒ£ å¹¶å‘æ ‡è®°ï¼ˆConcurrent Markï¼‰ ç”¨æˆ·çº¿ç¨‹ æ¢å¤è¿è¡Œï¼ˆå›¾ä¸­ç”¨æˆ·çº¿ç¨‹ç»§ç»­å‘å³å»¶ä¼¸ï¼‰ã€‚ GC çº¿ç¨‹ å¹¶å‘è¿›è¡Œæ ‡è®°å·¥ä½œï¼ˆå³åœ¨ç”¨æˆ·çº¿ç¨‹è¿è¡ŒæœŸé—´è¿›è¡Œæ ‡è®°ï¼‰ã€‚ å›¾ä¸­è“è‰²çš„â€œå¹¶å‘æ ‡è®°â€ç®­å¤´ä¸ç”¨æˆ·çº¿ç¨‹ç®­å¤´å¹¶è¡Œæ˜¾ç¤ºï¼Œè¡¨ç¤ºå¹¶å‘æ‰§è¡Œã€‚3ï¸âƒ£ æœ€ç»ˆæ ‡è®°ï¼ˆRemark / Final Markï¼‰ å†æ¬¡è¿›å…¥ Safepointã€‚ é‡æ–°æš‚åœæ‰€æœ‰ç”¨æˆ·çº¿ç¨‹ã€‚ å¤„ç†å¹¶å‘æ ‡è®°é˜¶æ®µä¸­é—æ¼çš„å¼•ç”¨æ›´æ–°ç­‰ä¿¡æ¯ï¼Œä¿è¯æ ‡è®°çš„å‡†ç¡®æ€§ã€‚4ï¸âƒ£ ç­›é€‰å›æ”¶ï¼ˆCleanup / Filtered Collectionï¼‰ å¯¹å·²æ ‡è®°çš„å¯¹è±¡åšæ¸…ç†ï¼ˆå›æ”¶ä¸å¯è¾¾å¯¹è±¡ï¼‰ã€‚ åˆ¤æ–­æ˜¯å¦éœ€è¦å›æ”¶æŸäº› Regionã€‚ å›¾ä¸­è“è‰²ç®­å¤´æ ‡æ³¨ä¸ºâ€œç­›é€‰å›æ”¶â€ã€‚5ï¸âƒ£ æ¢å¤ç”¨æˆ·çº¿ç¨‹ åœ¨æœ€åä¸€ä¸ª Safepoint ä¹‹åï¼Œæ‰€æœ‰ç”¨æˆ·çº¿ç¨‹é‡æ–°å¼€å§‹æ‰§è¡Œï¼ˆå›¾ä¸­é»„è‰²ç®­å¤´é‡æ–°å‘å³å»¶ä¼¸ï¼‰ã€‚ G1çš„GC è¿‡ç¨‹ä¼šç»å†å¤šæ¬¡Safepointï¼Œä½†åªæœ‰ å¹¶å‘æ ‡è®°é˜¶æ®µ æ˜¯æ•´ä¸ªå‘¨æœŸä¸­æœ€è€—æ—¶ä½†ä¸ä¼šæš‚åœç”¨æˆ·çº¿ç¨‹(STW)çš„éƒ¨åˆ†ã€‚ Safepointï¼ˆå®‰å…¨ç‚¹ï¼‰ åœ¨ JVMï¼ˆJava è™šæ‹Ÿæœºï¼‰ä¸­ï¼ŒSafepointï¼ˆå®‰å…¨ç‚¹ï¼‰ æ˜¯ä¸€ä¸ªéå¸¸é‡è¦çš„æ¦‚å¿µï¼Œå®ƒä»£è¡¨ æ‰€æœ‰çº¿ç¨‹å¿…é¡»â€œå®‰å…¨åœ°â€æš‚åœçš„æŸä¸ªæ—¶é—´ç‚¹ï¼Œä»¥ä¾¿ JVM èƒ½å¤Ÿæ‰§è¡ŒæŸäº›å…¨å±€æ“ä½œï¼Œæ¯”å¦‚ï¼š åƒåœ¾å›æ”¶ï¼ˆGCï¼‰ æ ˆéå†ï¼ˆä¾‹å¦‚ç”Ÿæˆå †å¿«ç…§ã€åšé€ƒé€¸åˆ†æç­‰ï¼‰ ç±»å¸è½½ JIT ç¼–è¯‘çš„ä¸€äº›é‡å†™æ“ä½œç­‰ å¦‚æœçº¿ç¨‹æ­£åœ¨è¿è¡Œã€æ”¹å˜å †ä¸­å¯¹è±¡çš„æ•°æ®ï¼Œé‚£ä¹ˆ GC å°±æ— æ³•å‡†ç¡®æ ‡è®°å’Œå›æ”¶å¯¹è±¡ã€‚å› æ­¤ JVM éœ€è¦ è®©æ‰€æœ‰çº¿ç¨‹åœ¨ä¸€ä¸ªâ€œå¯æ§ã€å®‰å…¨çš„ä½ç½®â€ä¸Šæš‚åœï¼Œè¿™ä¸ªä½ç½®å°±å« Safepointã€‚ Safepoint æ˜¯æ€ä¹ˆå·¥ä½œçš„ï¼Ÿ 1.JVM å‘å‡ºâ€œè¿›å…¥ Safepointâ€çš„ä¿¡å·ï¼ˆæ¯”å¦‚è¦å¼€å§‹ GCï¼‰ 2.æ‰€æœ‰çº¿ç¨‹æ”¶åˆ°ä¿¡å·åï¼Œå¿…é¡»ç­‰åˆ°â€œæœ€è¿‘çš„ Safepointâ€å†åœä¸‹æ¥ï¼š Safepoint ä¸æ˜¯ä»»æ„ä½ç½®éƒ½å¯ä»¥åœï¼Œå®ƒåªå‡ºç°åœ¨å­—èŠ‚ç ä¸­ä¸€äº›ç‰¹å®šçš„æŒ‡ä»¤ç‚¹ï¼ˆæ¯”å¦‚æ–¹æ³•è°ƒç”¨ã€å¾ªç¯è·³è½¬ç­‰ï¼‰ 3.ç­‰æ‰€æœ‰çº¿ç¨‹éƒ½è¿›å…¥ Safepoint åï¼ŒJVM æ‰èƒ½å¼€å§‹æ‰§è¡Œ GC ç­‰å…¨å±€æ“ä½œã€‚ G1 æ”¶é›†å™¨å‚æ•°é…ç½®è¡¨ å‚æ•°å è¯´æ˜ é»˜è®¤å€¼ -XX:+UseG1GC ä½¿ç”¨ G1 åƒåœ¾æ”¶é›†å™¨ - -XX:ParallelGCThreads æŒ‡å®š GC å·¥ä½œçš„çº¿ç¨‹æ•°é‡ ä¸ CPU æ•°é‡ç›¸å…³ -XX:G1HeapRegionSize è®¾ç½®å †åˆ†åŒºå¤§å°ï¼ˆ1MB~32MBï¼Œ2 çš„å¹‚ï¼‰ï¼Œå †é»˜è®¤åˆ’åˆ†ä¸º 2048 ä¸ª Region è‡ªåŠ¨è®¡ç®— -XX:MaxGCPauseMillis è®¾ç½® GC ç›®æ ‡æœ€å¤§æš‚åœæ—¶é—´ 200ms -XX:G1NewSizePercent æ–°ç”Ÿä»£åˆå§‹å æ¯”ï¼ˆå æ•´ä¸ªå †ï¼‰ï¼Œå®éªŒæ€§å‚æ•°ï¼Œ-XX:+UnlockExperimentalVMOptions 5% -XX:G1MaxNewSizePercent æ–°ç”Ÿä»£æœ€å¤§å æ¯”ï¼ˆå æ•´ä¸ªå †ï¼‰ï¼Œå®éªŒæ€§å‚æ•°ï¼Œ-XX:+UnlockExperimentalVMOptions 60% -XX:TargetSurvivorRatio Survivor åŒºå¡«å……ç›®æ ‡ï¼ˆè¶…è¿‡è¯¥æ¯”ä¾‹ï¼Œæ™‹å‡è€å¹´ä»£ï¼‰ 50% -XX:MaxTenuringThreshold æœ€å¤§å¯¹è±¡å¹´é¾„é˜ˆå€¼ï¼ˆå¹´é¾„è¶…è¿‡å°†è¿›å…¥è€å¹´ä»£ï¼‰ 15 -XX:InitiatingHeapOccupancyPercent æ•´ä¸ªå †çš„ä½¿ç”¨ç‡è¶…è¿‡è¯¥å€¼è§¦å‘ Mixed GC 45% -XX:G1MixedGCLiveThresholdPercent Mixed GC ä¸­ï¼šRegion å­˜æ´»å¯¹è±¡å æ¯”ä½äºè¯¥å€¼æ‰ä¼šè¢«å›æ”¶ï¼Œå®éªŒæ€§å‚æ•°ï¼Œ-XX:+UnlockExperimentalVMOptions 85% -XX:G1MixedGCCountTarget æ¯æ¬¡ Mixed GC çš„æœ€å¤§å›æ”¶è½®æ¬¡ 8 -XX:G1HeapWastePercent Mixed GC å›æ”¶ç›®æ ‡ï¼šç©ºé—² Region è¾¾å †æ€»é‡è¯¥ç™¾åˆ†æ¯”å°±ç»“æŸæ··åˆå›æ”¶ 5% ZGC åƒåœ¾å›æ”¶å™¨ ZGC(Z Garbage Collector)æ˜¯ä¸€æ¬¾JDK 11ä¸­æ–°åŠ å…¥çš„å…·æœ‰å®éªŒæ€§è´¨çš„ä½å»¶è¿Ÿåƒåœ¾æ”¶é›†å™¨ï¼ŒZGCå¯ä»¥è¯´æºè‡ªäºæ˜¯Azul Systemå…¬å¸å¼€å‘çš„C4ï¼ˆConcurrent Continuously Compacting Collectorï¼‰ æ”¶é›†å™¨ Platform Supported Since Comment Linux/x64 âœ… JDK 11 Linux/AArch64 âœ… JDK 13 macOS âœ… JDK 14 Windows âœ… JDK 14 Requires Windows version 1803 (Windows 10 or Windows Server 2019) or later. ZGCæ”¶é›†å™¨æ˜¯ä¸€æ¬¾åŸºäºRegionå†…å­˜å¸ƒå±€çš„ï¼Œæš‚æ—¶ä¸è®¾åˆ†ä»£çš„(jdk21åæ”¯æŒåˆ†ä»£)ï¼Œä½¿ç”¨äº†è¯»å±éšœã€é¢œè‰²æŒ‡é’ˆç­‰æŠ€æœ¯æ¥å®ç°å¯å¹¶å‘çš„æ ‡è®°-æ•´ç†ç®—æ³•çš„ï¼Œä»¥ä½å»¶è¿Ÿä¸ºé¦–è¦ç›®æ ‡çš„ä¸€æ¬¾åƒåœ¾æ”¶é›†å™¨ã€‚ é¢œè‰²æŒ‡é’ˆ åœ¨ ZGCï¼ˆZ Garbage Collectorï¼‰ä¸­ï¼Œé¢œè‰²æŒ‡é’ˆï¼ˆColored Pointerï¼‰æ˜¯ä¸€ç§æ ¸å¿ƒæœºåˆ¶ï¼ŒæŠŠå¯¹è±¡çš„ GC çŠ¶æ€ä¿¡æ¯ç›´æ¥åµŒå…¥åˆ°å¯¹è±¡çš„å¼•ç”¨ï¼ˆåœ°å€ï¼‰ä¸­ï¼Œç”¨äºåœ¨ä¸å¢åŠ å¯¹è±¡é¢å¤–å…ƒæ•°æ®çš„å‰æä¸‹ï¼Œè·Ÿè¸ªå¯¹è±¡åœ¨åƒåœ¾å›æ”¶è¿‡ç¨‹ä¸­çš„çŠ¶æ€ã€‚ åœ¨ä¼ ç»Ÿ GC ä¸­ï¼Œå¯¹è±¡çš„â€œé¢œè‰²â€ï¼ˆå¦‚ç™½è‰²ã€ç°è‰²ã€é»‘è‰²ï¼‰è¡¨ç¤ºå…¶åœ¨ GC ä¸åŒé˜¶æ®µçš„çŠ¶æ€ï¼Œè¿™äº›ä¿¡æ¯ä¸€èˆ¬å­˜å‚¨åœ¨é¢å¤–çš„æ•°æ®ç»“æ„ä¸­ï¼ˆå¦‚è®°å¿†é›†åˆã€ä½å›¾ç­‰ï¼‰ã€‚ è€Œåœ¨ ZGC ä¸­ï¼ŒZGC å°†å¯¹è±¡çš„è¿™äº›çŠ¶æ€ä¿¡æ¯ç¼–ç è¿›æŒ‡é’ˆçš„é«˜ä½ä¸­ã€‚æ‰€ä»¥ä¸€ä¸ªå¯¹è±¡å¼•ç”¨ï¼ˆpointerï¼‰ä¸ä»…ä»…æ˜¯å†…å­˜åœ°å€ï¼Œè¿˜æºå¸¦äº†å¯¹è±¡åœ¨ GC è¿‡ç¨‹ä¸­çš„â€œé¢œè‰²â€ä¿¡æ¯ã€‚ ZGC ä¸»è¦è¿è¡Œåœ¨ 64 ä½ç³»ç»Ÿä¸Šï¼Œä½†å½“å‰çš„æ“ä½œç³»ç»Ÿå’Œ CPU å®é™…ä¸Šåªä½¿ç”¨ 48ï½57 ä½è™šæ‹Ÿåœ°å€ã€‚ZGC åˆ©ç”¨æœªä½¿ç”¨çš„é«˜ä½è¿›è¡Œç¼–ç ã€‚ æ¯ä¸ªå¯¹è±¡æœ‰ä¸€ä¸ª64ä½æŒ‡é’ˆï¼Œè¿™64ä½è¢«åˆ†ä¸ºï¼š ä½æ•° åç§° å«ä¹‰ 18 ä½ é¢„ç•™ ä¿ç•™ä½ï¼Œæœªæ¥å¯èƒ½ç”¨äºæ‰©å±•åŠŸèƒ½ 1 ä½ Finalizable è¡¨ç¤ºå¯¹è±¡å¯ç»ˆç»“ï¼ˆå³å®ç°äº† finalize() æ–¹æ³•ï¼‰ 1 ä½ Remapped æ ‡è¯†å¯¹è±¡æ˜¯å¦å·²è¢«è½¬ç§»(ç”¨äºæ ‡è¯†æŸä¸ªå¼•ç”¨æ˜¯å¦å·²ç»è¢«é‡å®šå‘ï¼ˆæ›´æ–°ä¸ºæ–°åœ°å€ï¼‰)ï¼›ä¸º 1 è¡¨ç¤ºè¯¥å¯¹è±¡æœªåœ¨é‡å®šä½é›†ï¼ˆRelocation Setï¼‰ä¸­ï¼Œå³æ–°åœ°å€ï¼Œä¸º0è¡¨ç¤ºæ—§åœ°å€ 1 ä½ Marked1 æ ‡è®°ä½ä¹‹ä¸€ï¼Œç”¨äº GC è¿‡ç¨‹ä¸­çš„å¯¹è±¡æ ‡è®°é˜¶æ®µ ,ç”±äº ZGC æ˜¯å¹¶å‘ GCï¼Œéœ€è¦ä¸¤ä½æ¥æ”¯æŒé¢œè‰²åˆ‡æ¢æœºåˆ¶ï¼ˆColor Flipï¼‰ï¼Œç¡®ä¿åœ¨ä¸åŒ GC å‘¨æœŸä¸­å¯ä»¥åŒºåˆ†æ–°æ—§æ ‡è®°ï¼Œéœ€è¦è§¦å‘ä¸€æ¬¡è¯»å–å±éšœï¼ˆload barrierï¼‰ï¼Œæ‰¾åˆ°å¯¹è±¡çš„æ–°ä½ç½®ï¼Œå¹¶æ›´æ–°è¿™ä¸ªå¼•ç”¨ã€‚ 1 ä½ Marked0 å¦ä¸€ä¸ªæ ‡è®°ä½ï¼Œä¸ Marked1 é…åˆç”¨äº GC æ ‡è®°é˜¶æ®µ 42 ä½ å¯¹è±¡åœ°å€éƒ¨åˆ† å®é™…çš„å†…å­˜åœ°å€éƒ¨åˆ†ï¼Œæœ€å¤šå¯è¡¨ç¤º 2^42 å­—èŠ‚ï¼ˆå³ 4 TBï¼‰,jdk15åå ç”¨ 44ä½ï¼Œæ”¯æŒ 16TB è¯»å±éšœ ZGCï¼ˆZ Garbage Collectorï¼‰ä¸­çš„**è¯»å±éšœï¼ˆRead Barrierï¼‰æ˜¯å…¶æ ¸å¿ƒæœºåˆ¶ä¹‹ä¸€ï¼Œå®ƒä¿è¯äº†å¹¶å‘å‹ç¼©ï¼ˆå¯¹è±¡ç§»åŠ¨ï¼‰**æ—¶ç¨‹åºçš„æ­£ç¡®æ€§ï¼Œæ˜¯å®ç°ä½å»¶è¿Ÿã€é«˜å¹¶å‘åƒåœ¾å›æ”¶çš„å…³é”®ã€‚ åœ¨ä¼ ç»Ÿ GC ä¸­ï¼Œå¦‚æœå¯¹è±¡åœ¨ GC è¿‡ç¨‹ä¸­è¢«ç§»åŠ¨ï¼Œç¨‹åºè®¿é—®åˆ°çš„å¯¹è±¡åœ°å€å¯èƒ½å°±æ— æ•ˆäº†ã€‚å› æ­¤ï¼Œéœ€è¦**â€œåœä¸–ç•Œâ€**å°†æ‰€æœ‰å¼•ç”¨æ›´æ–°ã€‚ è€Œ ZGC çš„è®¾è®¡ç›®æ ‡æ˜¯ &lt;10ms çš„ GC åœé¡¿æ—¶é—´ï¼Œæ‰€ä»¥å®ƒé‡‡ç”¨ å¹¶å‘æ ‡è®° + å¹¶å‘ç§»åŠ¨ + å¹¶å‘å¼•ç”¨æ›´æ–° çš„æ¨¡å¼ã€‚åœ¨è¿™ç§æ¨¡å¼ä¸‹ï¼Œå¯¹è±¡å¯ä»¥åœ¨ç¨‹åºè¿è¡Œæ—¶è¢«ç§»åŠ¨ï¼Œä½†ç¨‹åºè®¿é—®æ—¶å¿…é¡»â€œçŸ¥é“â€è¿™ä¸ªå¯¹è±¡æ˜¯å¦å·²ç»è¢«ç§»åŠ¨ï¼Œå¹¶è·å–å…¶æœ€æ–°åœ°å€ï¼Œè¿™å°±æ˜¯è¯»å±éšœçš„èŒè´£ã€‚ è¯»å±éšœæ˜¯ä¸€ç§åœ¨è¯»å–å¯¹è±¡å¼•ç”¨æ—¶è‡ªåŠ¨æ’å…¥çš„é€»è¾‘ï¼Œç”¨äºæ£€æŸ¥å¼•ç”¨æ˜¯å¦æœ‰æ•ˆï¼Œå¹¶åœ¨å¿…è¦æ—¶è¿›è¡Œä¿®æ­£ï¼ˆå³åœ°å€é‡å®šå‘ï¼‰ã€‚ ZGC æ˜¯ç›®å‰å”¯ä¸€åœ¨æ‰€æœ‰å¯¹è±¡è®¿é—®ä¸­éƒ½ä½¿ç”¨è¯»å±éšœçš„ GCï¼Œå®ƒåœ¨æ¯æ¬¡å¯¹è±¡æŒ‡é’ˆè§£å¼•ç”¨æ—¶éƒ½è¿›è¡Œå¦‚ä¸‹æ“ä½œï¼š èŒè´£ è¯´æ˜ æ£€æµ‹å¼•ç”¨æ˜¯å¦æ˜¯è€åœ°å€ åˆ©ç”¨æŒ‡é’ˆä¸­çš„å…ƒä¿¡æ¯ï¼ˆé¢œè‰²æŒ‡é’ˆï¼Œå¦‚ Remapped ä½ï¼‰åˆ¤æ–­å¼•ç”¨æ˜¯å¦å·²ç»è¢«æ›´æ–° å¦‚æœæœªæ›´æ–°åˆ™é‡å®šå‘å¼•ç”¨ å¦‚æœå¼•ç”¨çš„æ˜¯æ—§åœ°å€ï¼Œå±éšœä¼šé€šè¿‡ forwarding table æ‰¾åˆ°æ–°åœ°å€å¹¶æ›´æ–° ä¿è¯æœ€ç»ˆè®¿é—®å¯¹è±¡çš„åœ°å€æ­£ç¡® å³ä½¿åœ¨å¯¹è±¡ç§»åŠ¨è¿‡ç¨‹ä¸­ï¼Œç¨‹åºä¹Ÿæ€»èƒ½è®¿é—®åˆ°æœ‰æ•ˆåœ°å€ï¼Œæ— éœ€åœé¡¿æ‰€æœ‰çº¿ç¨‹ graph TD A[ç¨‹åºè®¿é—®å¯¹è±¡å¼•ç”¨&lt;br&#x2F;&gt;ä¾‹å¦‚ï¼šPerson p &#x3D; personField] --&gt; B[JVM æ’å…¥è¯»å±éšœé€»è¾‘] B --&gt; C[è¯»å±éšœæ£€æŸ¥é¢œè‰²æŒ‡é’ˆä¸­çš„ Remapped ä½] C --&gt; D{Remapped ä½ä¸º 0 å—ï¼Ÿ} D -- æ˜¯ --&gt; E[æ£€æŸ¥å¯¹è±¡æ˜¯å¦å·²è¢«ç§»åŠ¨] E --&gt; F[æ›´æ–°å¼•ç”¨åœ°å€ä¸ºæ–°åœ°å€] F --&gt; G[è®¾ç½® Remapped ä½ä¸º 1] G --&gt; H[ä½¿ç”¨æ›´æ–°åçš„å¼•ç”¨è®¿é—®å¯¹è±¡] D -- å¦ --&gt; I[ç›´æ¥ä½¿ç”¨å½“å‰å¼•ç”¨è®¿é—®å¯¹è±¡] ZGCçš„Regionå¯ä»¥å…·æœ‰å¤§ã€ä¸­ã€å°ä¸‰ç±»å®¹é‡ï¼š å°å‹Regionï¼ˆSmall Regionï¼‰ ï¼š å®¹é‡å›ºå®šä¸º2MBï¼Œç”¨äºæ”¾ç½®å°äº256KBçš„å°å¯¹è±¡ã€‚ ä¸­å‹Regionï¼ˆMedium Regionï¼‰ ï¼š å®¹é‡å›ºå®šä¸º32MBï¼Œç”¨äºæ”¾ç½®å¤§äºç­‰äº256KBä½†å°äº4MBçš„å¯¹è±¡ã€‚ å¤§å‹Regionï¼ˆLarge Regionï¼‰ ï¼š å®¹é‡ä¸å›ºå®šï¼Œå¯ä»¥åŠ¨æ€å˜åŒ–ï¼Œä½†å¿…é¡»ä¸º2MBçš„æ•´æ•°å€ï¼Œç”¨äºæ”¾ç½®4MBæˆ–ä»¥ä¸Šçš„å¤§å¯¹è±¡ã€‚ æ¯ä¸ªå¤§å‹Regionä¸­åªä¼šå­˜æ”¾ä¸€ä¸ªå¤§å¯¹è±¡ï¼Œè¿™ä¹Ÿé¢„ç¤ºç€è™½ç„¶åå­—å«ä½œâ€œå¤§å‹Regionâ€ï¼Œä½†å®ƒçš„å®é™…å®¹é‡å®Œå…¨æœ‰å¯èƒ½å°äºä¸­å‹Regionï¼Œæœ€å°å®¹é‡å¯ä½è‡³4MBã€‚ ZGC ç‰¹ç‚¹ï¼š æ”¯æŒæå¤§å †ï¼ˆJDK 15 èµ·æ”¯æŒæœ€é«˜ 16TBï¼‰ GC åœé¡¿æ—¶é—´é€šå¸¸ä½äº 1msï¼ˆä¸å †å¤§å°åŸºæœ¬æ— å…³ï¼‰ é€‚åˆä½å»¶è¿Ÿã€é«˜ååã€é«˜å¯ç”¨çš„åº”ç”¨åœºæ™¯ï¼Œå¦‚äº¤æ˜“ç³»ç»Ÿã€å¹¿å‘Šæ¨èç­‰ ZGC æ”¶é›†å™¨çš„å·¥ä½œæ–¹å¼ 123456789101112131415161718192021221ï¸âƒ£ å¹¶å‘æ ‡è®°ï¼ˆConcurrent Markï¼‰ï¼š ä¸G1ä¸€æ ·ï¼Œå¹¶å‘æ ‡è®°æ˜¯éå†å¯¹è±¡å›¾åšå¯è¾¾æ€§åˆ†æçš„é˜¶æ®µï¼Œ å®ƒçš„åˆå§‹æ ‡è®°(Mark Start)å’Œæœ€ç»ˆæ ‡è®°(Mark End)ä¹Ÿä¼šå‡ºç°çŸ­æš‚çš„åœé¡¿ï¼Œ ä¸G1ä¸åŒçš„æ˜¯ï¼ŒZGCçš„æ ‡è®°æ˜¯åœ¨æŒ‡é’ˆä¸Šè€Œä¸æ˜¯åœ¨å¯¹è±¡ä¸Šè¿›è¡Œçš„ï¼Œ æ ‡è®°é˜¶æ®µä¼šæ›´æ–°æŸ“è‰²æŒ‡é’ˆä¸­çš„ Marked 0ã€ Marked 1 æ ‡å¿—ä½ã€‚2ï¸âƒ£ å¹¶å‘é¢„å¤‡é‡åˆ†é…ï¼ˆConcurrent Prepare for Relocateï¼‰ï¼š è¿™ä¸ªé˜¶æ®µéœ€è¦æ ¹æ®ç‰¹å®šçš„æŸ¥è¯¢æ¡ä»¶ç»Ÿè®¡å¾—å‡ºæœ¬æ¬¡æ”¶é›†è¿‡ç¨‹è¦æ¸…ç†å“ªäº›Regionï¼Œå°†è¿™äº›Regionç»„æˆé‡åˆ†é…é›†ï¼ˆRelocation Setï¼‰ã€‚ ZGCæ¯æ¬¡å›æ”¶éƒ½ä¼šæ‰«ææ‰€æœ‰çš„Regionï¼Œç”¨èŒƒå›´æ›´å¤§çš„æ‰«ææˆæœ¬æ¢å–çœå»G1ä¸­è®°å¿†é›†çš„ç»´æŠ¤æˆæœ¬ã€‚3ï¸âƒ£ å¹¶å‘é‡åˆ†é…ï¼ˆConcurrent Relocateï¼‰ï¼š é‡åˆ†é…æ˜¯ZGCæ‰§è¡Œè¿‡ç¨‹ä¸­çš„æ ¸å¿ƒé˜¶æ®µï¼Œè¿™ä¸ªè¿‡ç¨‹è¦æŠŠé‡åˆ†é…é›†ä¸­çš„å­˜æ´»å¯¹è±¡å¤åˆ¶åˆ°æ–°çš„Regionä¸Šï¼Œ å¹¶ä¸ºé‡åˆ†é…é›†ä¸­çš„æ¯ä¸ªRegionç»´æŠ¤ä¸€ä¸ªè½¬å‘è¡¨ï¼ˆForward Tableï¼‰ï¼Œè®°å½•ä»æ—§å¯¹è±¡åˆ°æ–°å¯¹è±¡çš„è½¬å‘å…³ç³»ã€‚ ZGCæ”¶é›†å™¨èƒ½ä»…ä»å¼•ç”¨ä¸Šå°±æ˜ç¡®å¾—çŸ¥ä¸€ä¸ªå¯¹è±¡æ˜¯å¦å¤„äºé‡åˆ†é…é›†ä¹‹ä¸­ï¼Œå¦‚æœç”¨æˆ·çº¿ç¨‹æ­¤æ—¶å¹¶å‘è®¿é—®äº†ä½äºé‡åˆ†é…é›†ä¸­çš„å¯¹è±¡ï¼Œ è¿™æ¬¡è®¿é—®å°†ä¼šè¢«é¢„ç½®çš„å†…å­˜å±éšœ(è¯»å±éšœ)æ‰€æˆªè·ï¼Œç„¶åç«‹å³æ ¹æ®Regionä¸Šçš„è½¬å‘è¡¨è®°å½•å°†è®¿é—®è½¬å‘åˆ°æ–°å¤åˆ¶çš„å¯¹è±¡ä¸Šï¼Œ å¹¶åŒæ—¶ä¿®æ­£æ›´æ–°è¯¥å¼•ç”¨çš„å€¼ï¼Œä½¿å…¶ç›´æ¥æŒ‡å‘æ–°å¯¹è±¡ï¼ŒZGCå°†è¿™ç§è¡Œä¸ºç§°ä¸ºæŒ‡é’ˆçš„â€œè‡ªæ„ˆâ€ï¼ˆSelf-Healingï¼‰èƒ½åŠ›ã€‚4ï¸âƒ£ å¹¶å‘é‡æ˜ å°„ï¼ˆConcurrent Remapï¼‰ï¼š é‡æ˜ å°„æ‰€åšçš„å°±æ˜¯ä¿®æ­£æ•´ä¸ªå †ä¸­æŒ‡å‘é‡åˆ†é…é›†ä¸­æ—§å¯¹è±¡çš„æ‰€æœ‰å¼•ç”¨ï¼Œä½†æ˜¯ZGCä¸­å¯¹è±¡å¼•ç”¨å­˜åœ¨â€œè‡ªæ„ˆâ€åŠŸèƒ½ï¼Œæ‰€ä»¥è¿™ä¸ªé‡æ˜ å°„æ“ä½œå¹¶ä¸æ˜¯å¾ˆè¿«åˆ‡ã€‚ ZGCå¾ˆå·§å¦™åœ°æŠŠå¹¶å‘é‡æ˜ å°„é˜¶æ®µï¼ˆConcurrent Remapï¼‰è¦åšçš„å·¥ä½œï¼Œåˆå¹¶åˆ°äº†ä¸‹ä¸€æ¬¡åƒåœ¾æ”¶é›†å¾ªç¯ä¸­çš„å¹¶å‘æ ‡è®°é˜¶æ®µï¼ˆConcurrent Markï¼‰é‡Œå»å®Œæˆï¼Œ åæ­£å®ƒä»¬éƒ½æ˜¯è¦éå†æ‰€æœ‰å¯¹è±¡çš„ï¼Œè¿™æ ·åˆå¹¶å°±èŠ‚çœäº†ä¸€æ¬¡éå†å¯¹è±¡å›¾çš„å¼€é”€ã€‚ ä¸€æ—¦æ‰€æœ‰æŒ‡é’ˆéƒ½è¢«ä¿®æ­£ä¹‹åï¼Œ åŸæ¥è®°å½•æ–°æ—§å¯¹è±¡å…³ç³»çš„è½¬å‘è¡¨å°±å¯ä»¥é‡Šæ”¾æ‰äº†ã€‚ ZGCå­˜åœ¨çš„é—®é¢˜ ZGCæœ€å¤§çš„é—®é¢˜æ˜¯æµ®åŠ¨åƒåœ¾ã€‚ZGCçš„åœé¡¿æ—¶é—´æ˜¯åœ¨10msä»¥ä¸‹ï¼Œä½†æ˜¯ZGCçš„æ‰§è¡Œæ—¶é—´è¿˜æ˜¯è¿œè¿œå¤§äºè¿™ä¸ªæ—¶é—´çš„ã€‚å‡å¦‚ZGCå…¨è¿‡ç¨‹éœ€è¦æ‰§è¡Œ10åˆ†é’Ÿï¼Œåœ¨è¿™ä¸ªæœŸé—´ç”±äºå¯¹è±¡åˆ†é…é€Ÿç‡å¾ˆé«˜ï¼Œå°†åˆ›å»ºå¤§é‡çš„æ–°å¯¹è±¡ï¼Œè¿™äº›å¯¹è±¡å¾ˆéš¾è¿›å…¥å½“æ¬¡GCï¼Œæ‰€ä»¥åªèƒ½åœ¨ä¸‹æ¬¡GCçš„æ—¶å€™è¿›è¡Œå›æ”¶ï¼Œè¿™äº›åªèƒ½ç­‰åˆ°ä¸‹æ¬¡GCæ‰èƒ½å›æ”¶çš„å¯¹è±¡å°±æ˜¯æµ®åŠ¨åƒåœ¾ã€‚ ZGCæ²¡æœ‰åˆ†ä»£æ¦‚å¿µï¼Œæ¯æ¬¡éƒ½éœ€è¦è¿›è¡Œå…¨å †æ‰«æï¼Œå¯¼è‡´ä¸€äº›â€œæœç”Ÿå¤•æ­»â€çš„å¯¹è±¡æ²¡èƒ½åŠæ—¶çš„è¢«å›æ”¶ã€‚ ç›®å‰å”¯ä¸€çš„åŠæ³•æ˜¯å¢å¤§å †çš„å®¹é‡ï¼Œä½¿å¾—ç¨‹åºå¾—åˆ°æ›´å¤šçš„å–˜æ¯æ—¶é—´ï¼Œä½†æ˜¯è¿™ä¸ªä¹Ÿæ˜¯ä¸€ä¸ªæ²»æ ‡ä¸æ²»æœ¬çš„æ–¹æ¡ˆã€‚å¦‚æœéœ€è¦ä»æ ¹æœ¬ä¸Šè§£å†³è¿™ä¸ªé—®é¢˜ï¼Œè¿˜æ˜¯éœ€è¦å¼•å…¥åˆ†ä»£æ”¶é›†ï¼Œè®©æ–°ç”Ÿå¯¹è±¡éƒ½åœ¨ä¸€ä¸ªä¸“é—¨çš„åŒºåŸŸä¸­åˆ›å»ºï¼Œç„¶åä¸“é—¨é’ˆå¯¹è¿™ä¸ªåŒºåŸŸè¿›è¡Œæ›´é¢‘ç¹ã€æ›´å¿«çš„æ”¶é›†ã€‚ JDK21æ­£å¼å¼•å…¥äº†åˆ†ä»£ï¼ˆjdk17æ˜¯é¢„è§ˆç‰ˆï¼‰ï¼Œå¯ä»¥åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨ï¼Œéœ€è¦æ‰‹åŠ¨å¼€å¯ï¼š-XX:+ZGenerational ZGC æ”¶é›†å™¨å‚æ•°é…ç½®è¡¨ å‚æ•°å è¯´æ˜ é»˜è®¤å€¼ï¼ˆå¦‚æœªç‰¹æ®Šæ ‡æ³¨ï¼‰ -XX:+UseZGC å¯ç”¨ ZGC åƒåœ¾æ”¶é›†å™¨ - -XX:+UnlockExperimentalVMOptions è§£é”å®éªŒæ€§å‚æ•°ï¼ˆJDK 11~14 ä½¿ç”¨ ZGC å¿…é¡»ï¼‰ - -XX:+UseLargePages å¯ç”¨å¤§é¡µå†…å­˜ï¼ˆæ€§èƒ½ä¼˜åŒ–ï¼‰ false -XX:+UseTransparentHugePages å¯ç”¨é€æ˜å¤§é¡µï¼ˆéƒ¨åˆ† Linux ä¸Šå¯ç»“åˆä½¿ç”¨ï¼‰ false -Xmx / -Xms è®¾ç½®æœ€å¤§/åˆå§‹å †å¤§å° ç”¨æˆ·é…ç½® -XX:ZUncommitDelay=&lt;ç§’&gt; æœªä½¿ç”¨å†…å­˜é‡Šæ”¾å›æ“ä½œç³»ç»Ÿçš„å»¶è¿Ÿæ—¶é—´ï¼ˆZGC ä¼šè‡ªåŠ¨é‡Šæ”¾å†…å­˜ï¼‰ 300ï¼ˆ5åˆ†é’Ÿï¼‰ -XX:SoftMaxHeapSize=&lt;å¤§å°&gt; è½¯æœ€å¤§å †ï¼ˆSoft Heap Limitï¼‰ï¼šZGC å°è¯•å°†ä½¿ç”¨çš„å †æ§åˆ¶åœ¨è¯¥å€¼ä»¥å†… é»˜è®¤ç­‰äº -Xmx -XX:MaxHeapFreeRatio æœ€å¤§å †ç©ºé—²æ¯”ä¾‹ï¼ˆè¶…è¿‡æ­¤æ¯”ä¾‹å¯èƒ½è§¦å‘å†…å­˜é‡Šæ”¾ï¼‰ 70 -XX:MinHeapFreeRatio æœ€å°å †ç©ºé—²æ¯”ä¾‹ï¼ˆä½äºæ­¤æ¯”ä¾‹å¯èƒ½è§¦å‘æ‰©å®¹ï¼‰ 40 -XX:+ZGenerational å¯ç”¨ ZGC åˆ†ä»£æ”¶é›†ï¼ˆä» JDK 21 èµ·æ”¯æŒï¼Œé»˜è®¤å…³é—­ï¼‰ falseï¼ˆJDK 21+ï¼‰ -XX:+PrintGC / -Xlog:gc* å¼€å¯ GC æ—¥å¿—è¾“å‡º - -XX:+ZProactive ä¸»åŠ¨å›æ”¶ç­–ç•¥ï¼ˆåœ¨ç³»ç»Ÿç©ºé—²æ—¶å°è¯•å›æ”¶ï¼‰ true -XX:ZCollectionInterval=&lt;ç§’&gt; ä¸»åŠ¨å›æ”¶ä¹‹é—´çš„æœ€å°æ—¶é—´é—´éš”ï¼ˆé…åˆ ZProactiveï¼‰ é»˜è®¤å€¼å› ç‰ˆæœ¬è€Œå¼‚ ZGC vs G1 GC vs Parallel GC å¯¹æ¯”è¡¨ ç‰¹æ€§ ZGC G1 GC Parallel GC è®¾è®¡ç›®æ ‡ æä½å»¶è¿Ÿï¼Œ&lt;1ms åœé¡¿ å¹³è¡¡ ä½å»¶è¿Ÿ ä¸ é«˜åå é«˜ååï¼Œæœ€å¤§åŒ– CPU ä½¿ç”¨ GC åœé¡¿æ—¶é—´ &lt;1msï¼Œå †å¤§å°å¢åŠ ä¸å½±å“åœé¡¿æ—¶é—´ å‡ ååˆ°å‡ ç™¾æ¯«ç§’ï¼Œå †è¶Šå¤§åœé¡¿è¶Šæ˜æ˜¾ åœé¡¿æ—¶é—´å¯èƒ½è¾¾åˆ°ç§’çº§ï¼Œå †è¶Šå¤§è¶Šæ˜æ˜¾ å †å¤§å°æ”¯æŒ æ”¯æŒé«˜è¾¾ 16TBï¼ˆJDK 15+ï¼‰ æ”¯æŒ æœ€å¤š 4TB æ”¯æŒå¤§å †ï¼Œä½†åœé¡¿æ˜æ˜¾ æ˜¯å¦åˆ†ä»£ é»˜è®¤ä¸åˆ†ä»£ï¼ˆJDK 21+ å¯å¼€å¯ -XX:+ZGenerationalï¼‰ åˆ†ä»£ï¼ˆæ–°ç”Ÿä»£ + è€å¹´ä»£ï¼‰ åˆ†ä»£ï¼ˆæ–°ç”Ÿä»£ + è€å¹´ä»£ï¼‰ å¹¶å‘å›æ”¶ æ˜¯ï¼ŒåŒ…æ‹¬æ ‡è®°ã€å‹ç¼©ã€å¼•ç”¨å¤„ç†éƒ½å¹¶å‘ éƒ¨åˆ†å¹¶å‘ï¼Œä»åŒ…å«æ˜æ˜¾ Stop-The-World é˜¶æ®µ å¦ï¼Œå…¨éƒ¨ Stop-The-World ç§»åŠ¨å¯¹è±¡æ—¶æ˜¯å¦åœé¡¿ å¦ï¼Œä½¿ç”¨è¯»å±éšœå¹¶å‘è½¬ç§»å¯¹è±¡ æ˜¯ï¼ˆé€šè¿‡å¤åˆ¶åŒºåŸŸï¼‰ æ˜¯ å®ç°æœºåˆ¶ æ ‡è®°-é‡å®šä½ï¼ŒåŸºäºè¯»å±éšœ Region åˆ†åŒº + æ ‡è®°-å¤åˆ¶ + Mixed GC æ ‡è®°-å¤åˆ¶ï¼ˆæ–°ç”Ÿä»£ï¼‰ã€æ ‡è®°-æ•´ç†ï¼ˆè€å¹´ä»£ï¼‰ ååèƒ½åŠ› ä¸­é«˜ é«˜ æœ€é«˜ é€‚ç”¨åœºæ™¯ ä½å»¶è¿Ÿç³»ç»Ÿï¼Œå¦‚é‡‘èã€äº¤æ˜“ã€æ¨èç­‰å®æ—¶åº”ç”¨ é€šç”¨åå°ç³»ç»Ÿã€Web æœåŠ¡ç­‰ æ‰¹å¤„ç†ã€æ•°æ®è®¡ç®—ã€æ—¥å¿—åˆ†æç­‰ä¸æ•æ„Ÿäºåœé¡¿çš„ç³»ç»Ÿ é»˜è®¤å¯ç”¨ å¦ï¼Œéœ€æŒ‡å®š -XX:+UseZGC JDK 9+ é»˜è®¤ GC JDK 8 åŠä»¥å‰é»˜è®¤ GC è°ƒä¼˜å¤æ‚åº¦ ä½ï¼Œå¤§å¤šæ•°å‚æ•°å¯çœç•¥ ä¸­ï¼Œéœ€è¦è®¾ç½®ç›®æ ‡åœé¡¿æ—¶é—´ç­‰ é«˜ï¼Œéœ€è¦ç²¾ç»†é…ç½® Eden/Survivor ç­‰æ¯”ä¾‹ GC æ—¥å¿—é…ç½®æ–¹å¼ ç»Ÿä¸€æ—¥å¿—æ ¼å¼ï¼š-Xlog:gc*ï¼ˆJDK 9+ï¼‰ æ”¯æŒä¼ ç»Ÿçš„ -XX:+PrintGCDetails å’Œ -Xlog:gc* æ—¥å¿—è¾“å‡º ä¸»è¦ä½¿ç”¨æ—§å‚æ•°ï¼š-XX:+PrintGCDetails ç­‰ ZGC ååèƒ½åŠ›è¾ƒå¼±çš„åŸå›  åŸå›  è§£é‡Š 1. å¹¶å‘é˜¶æ®µä»£ä»·è¾ƒé«˜ ZGC å‡ ä¹æ‰€æœ‰çš„ GC å·¥ä½œï¼ˆåŒ…æ‹¬æ ‡è®°ã€æ•´ç†ã€å¼•ç”¨å¤„ç†ã€è½¬ç§»å¯¹è±¡ï¼‰éƒ½åœ¨ä¸åº”ç”¨çº¿ç¨‹å¹¶å‘æ‰§è¡Œã€‚è™½ç„¶å‡å°‘äº†åœé¡¿ï¼Œä½†è¿™äº› GC çº¿ç¨‹ä¸ä¸šåŠ¡çº¿ç¨‹å…±äº« CPU èµ„æºï¼Œå¢åŠ äº† CPU ä¸Šä¸‹æ–‡åˆ‡æ¢å’Œç¼“å­˜ç«äº‰ï¼Œä»è€Œå½±å“ä¸šåŠ¡çº¿ç¨‹çš„æ‰§è¡Œæ•ˆç‡ã€‚ 2. è¯»å±éšœå¼€é”€ ZGC ä¾èµ–ç€è‰²æŒ‡é’ˆå’Œè¯»å±éšœï¼ˆload barrierï¼‰æœºåˆ¶æ¥è·Ÿè¸ªå¯¹è±¡å¼•ç”¨çŠ¶æ€ï¼Œæ”¯æŒå¹¶å‘è½¬ç§»ã€‚è™½ç„¶éå¸¸é«˜æ•ˆï¼Œä½†ä»æ¯”ä¼ ç»Ÿ GC çš„æ™®é€šè¯»å†™è·¯å¾„æ…¢ä¸€äº›ï¼Œåœ¨é«˜é¢‘è®¿é—®å¯¹è±¡åœºæ™¯ä¸‹ä¼šå¸¦æ¥ä¸€å®š CPU å¼€é”€ã€‚ 3. å¯¹ç¡¬ä»¶ä¾èµ–é«˜ï¼Œè°ƒåº¦ä¿å®ˆ ä¸ºäº†å®ç°â€œ&lt;1ms åœé¡¿â€çš„ç›®æ ‡ï¼ŒZGC ä¼šé€‰æ‹©æ›´ä¿å®ˆçš„è°ƒåº¦ç­–ç•¥ï¼ˆå¦‚é¿å…å¹¶å‘çº¿ç¨‹ä½¿ç”¨è¿‡å¤š CPUï¼‰ï¼Œè€Œä¸ä¼šåƒ Parallel GC é‚£æ ·â€œæ¦¨å¹²â€æ‰€æœ‰æ ¸å¿ƒèµ„æºã€‚ 4. å†…å­˜å¼€é”€æ›´é«˜ ä¸ºäº†æ”¯æŒå¹¶å‘å‹ç¼©å’Œè½¬ç§»ï¼ŒZGC é€šå¸¸éœ€è¦ä¸ºæ¯ä¸ªå¯¹è±¡ä¿ç•™å…ƒæ•°æ®å’Œæ›´å¤šçš„è½¬ç§»ç©ºé—´ï¼ˆå³â€œæµ®åŠ¨åƒåœ¾â€åŒºåŸŸï¼‰ï¼Œè¿™å¯èƒ½å¯¼è‡´é¢‘ç¹çš„ GC å‘¨æœŸï¼Œå½±å“ååã€‚ 5. è®¾è®¡ç›®æ ‡éååä¼˜å…ˆ ZGC çš„é¦–è¦ç›®æ ‡æ˜¯ä½å»¶è¿Ÿè€Œéæœ€å¤§ååã€‚ä¸ Parallel GCï¼ˆä»¥ååä¸ºæ ¸å¿ƒï¼‰è®¾è®¡ç›®æ ‡ä¸åŒï¼ŒZGC æ›´é€‚åˆåœºæ™¯ä¸ºâ€œå¯¹å»¶è¿Ÿæ•æ„Ÿä½†ååå¯æ¥å—â€çš„ç³»ç»Ÿã€‚ æœ€ç³Ÿç³•çš„æƒ…å†µä¸‹ååé‡ä¼šé™ä½15%ã€‚è¿™éƒ½ä¸æ˜¯äº‹ï¼Œåœé¡¿æ—¶é—´è¶³å¤Ÿä¼˜ç§€ã€‚è‡³äºååé‡ï¼Œé€šè¿‡æ‰©å®¹åˆ†åˆ†é’Ÿè§£å†³ã€‚ å¦å¤–ï¼ŒOracleå®˜æ–¹æåˆ°äº†å®ƒæœ€å¤§çš„ä¼˜ç‚¹æ˜¯ï¼šå®ƒçš„åœé¡¿æ—¶é—´ä¸ä¼šéšç€å †çš„å¢å¤§è€Œå¢é•¿ï¼ ä¹Ÿå°±æ˜¯è¯´ï¼Œå‡ åGå †çš„åœé¡¿æ—¶é—´æ˜¯10msä»¥ä¸‹ï¼Œå‡ ç™¾Gç”šè‡³ä¸ŠTå †çš„åœé¡¿æ—¶é—´ä¹Ÿæ˜¯10msä»¥ä¸‹ã€‚ ZGC ååå¼±ï¼Œä¸æ˜¯å› ä¸ºæŠ€æœ¯è½åï¼Œè€Œæ˜¯å› ä¸ºå®ƒä¸»åŠ¨é€‰æ‹©åœ¨ä½å»¶è¿Ÿå’Œé«˜ååä¹‹é—´åå‘äº†ä½å»¶è¿Ÿã€‚ åœ¨å¯¹å“åº”æ—¶é—´è¦æ±‚æé«˜çš„ç³»ç»Ÿä¸­ï¼Œå®ƒæ˜¯éå¸¸åˆé€‚çš„é€‰æ‹©ã€‚ ä½†å¦‚æœä½ çš„ç›®æ ‡æ˜¯å‹æ¦¨æœºå™¨æ€§èƒ½è·‘æ‰¹å¤„ç†ã€æ—¥å¿—åˆ†æè¿™ç±»ååå¯¼å‘å‹ä»»åŠ¡ï¼ŒParallel GC æˆ– G1 ä¼šæ›´åˆé€‚ã€‚ å†…å­˜æº¢å‡º(OutOfMemoryErrorï¼Œç®€ç§° OOM) JVM å¸¸è§å†…å­˜æº¢å‡ºç±»å‹æ±‡æ€»è¡¨ æº¢å‡ºç±»å‹ å¼‚å¸¸ä¿¡æ¯ è§¦å‘åŸå› /æè¿° ç›¸å…³å‚æ•°å’Œå»ºè®®é…ç½® å †å†…å­˜æº¢å‡º java.lang.OutOfMemoryError: Java heap space - åˆ›å»ºå¤§é‡å¯¹è±¡ï¼Œå †ç©ºé—´ä¸è¶³- å†…å­˜æ³„æ¼ï¼šå¯¹è±¡ä¸å†ä½¿ç”¨å´æœ‰å¼ºå¼•ç”¨- è€å¹´ä»£å¯¹è±¡å¤ªå¤šæ— æ³•æ™‹å‡ -Xms / -Xmx è®¾ç½®å †å¤§å° æ ˆæº¢å‡ºï¼ˆé€’å½’ï¼‰ java.lang.StackOverflowError - æ–¹æ³•æ— é™é€’å½’æˆ–é€’å½’å±‚çº§å¤ªæ·± -Xss è®¾ç½®çº¿ç¨‹æ ˆå¤§å° æ— æ³•åˆ›å»ºæ–°çº¿ç¨‹ java.lang.OutOfMemoryError: unable to create new native thread - åˆ›å»ºçº¿ç¨‹è¿‡å¤šï¼ˆå¦‚çº¿ç¨‹æ± é…ç½®è¿‡å¤§ï¼‰- ç³»ç»Ÿæˆ– JVM native çº¿ç¨‹èµ„æºè€—å°½ æ§åˆ¶çº¿ç¨‹æ± å¤§å°ï¼Œé¿å…æ— é™æ–°å»ºçº¿ç¨‹ å…ƒç©ºé—´æº¢å‡º java.lang.OutOfMemoryError: Metaspace - åŠ¨æ€åŠ è½½ç±»è¿‡å¤šï¼ˆå¦‚ä½¿ç”¨ CGLIBã€JSP åŠ¨æ€ç”Ÿæˆç±»ï¼‰- ç±»æ— æ³•å¸è½½ï¼ˆå¦‚ ClassLoader æ³„æ¼ï¼‰ -XX:MetaspaceSize / -XX:MaxMetaspaceSize ç›´æ¥å†…å­˜æº¢å‡º java.lang.OutOfMemoryError: Direct buffer memory - ä½¿ç”¨ ByteBuffer.allocateDirect() åˆ†é…å¤§é‡ç›´æ¥å†…å­˜- Netty ç­‰æ¡†æ¶é»˜è®¤ä½¿ç”¨ç›´æ¥å†…å­˜ -XX:MaxDirectMemorySize GC å¼€é”€è¿‡é«˜ java.lang.OutOfMemoryError: GC overhead limit exceeded - JVM èŠ±è´¹ &gt;98% çš„æ—¶é—´ GC ä½†å›æ”¶ &lt;2% çš„å†…å­˜ï¼Œè®¤ä¸ºè¿›å…¥â€œGC æ­»å¾ªç¯â€ åˆ†æ GC æ—¥å¿—ã€ä¼˜åŒ–å †è®¾ç½® ç±»å¸è½½å¤±è´¥ï¼ˆå†…å­˜æ³„æ¼ï¼‰ ï¼ˆä¸ä¸€å®šæŠ¥é”™ï¼Œä½†å¯èƒ½å¯¼è‡´ Metaspace OOMï¼‰ - Web å®¹å™¨é¢‘ç¹éƒ¨ç½²çƒ­æ›´æ–° WAR åŒ…æ—¶ï¼ŒClassLoader æ— æ³•å¸è½½ï¼Œå¯¼è‡´ç±»æ°¸ä¹…é©»ç•™ ä¼˜åŒ– ClassLoader ç®¡ç†ï¼Œä½¿ç”¨å†…å­˜åˆ†æå·¥å…· å †å¿«ç…§(å †è½¬å‚¨)æ–‡ä»¶åˆ†æ å‚æ•° è¯´æ˜ -XX:+HeapDumpOnOutOfMemoryError OOM æ—¶ç”Ÿæˆå †è½¬å‚¨æ–‡ä»¶ ,å»ºè®®ç”Ÿäº§ç¯å¢ƒå¼€å¯ -XX:HeapDumpPath=xxx.hprof æŒ‡å®šå †è½¬å‚¨æ–‡ä»¶ä¿å­˜è·¯å¾„ é»˜è®¤ä¿å­˜åœ¨å½“å‰ç›®å½• å¸¸ç”¨åˆ†æå·¥å…·ä¸å‘½ä»¤ å·¥å…·/å‘½ä»¤ ç®€ä»‹ä¸åŠŸèƒ½ ä½¿ç”¨è¯´æ˜ MATï¼ˆMemory Analyzer Toolï¼‰ Eclipse å‡ºå“çš„å¼ºå¤§å›¾å½¢å·¥å…·ï¼Œæ”¯æŒæ³„æ¼åˆ†æã€å¯¹è±¡å¼•ç”¨é“¾åˆ†æã€å†…å­˜å ç”¨ç»Ÿè®¡ç­‰ ä¸‹è½½åœ°å€ï¼šhttps://www.eclipse.org/mat/æ‰“å¼€åç›´æ¥å¯¼å…¥ .hprof æ–‡ä»¶å³å¯åˆ†æ VisualVM å®˜æ–¹å¯è§†åŒ– JVM ç›‘æ§å·¥å…·ï¼Œæ”¯æŒå®æ—¶åˆ†æã€GC æŸ¥çœ‹ã€çº¿ç¨‹çŠ¶æ€ä¸å †è½¬å‚¨æŸ¥çœ‹ é™„å¸¦äº JDKï¼ˆæˆ–å•ç‹¬å®‰è£…ï¼‰ï¼Œæ‰“å¼€ .hprof æ–‡ä»¶è¿›è¡Œå¯è§†åŒ–åˆ†æ JProfiler å•†ä¸šçº§ Java æ€§èƒ½åˆ†æå·¥å…·ï¼Œæä¾›å †åˆ†æã€CPU åˆ†æã€çº¿ç¨‹åˆ†æç­‰å…¨å¥—åŠŸèƒ½ æ”¯æŒæ‰“å¼€ .hprof æ–‡ä»¶ï¼Œä¹Ÿå¯åœ¨è¿è¡Œæ—¶é…åˆä½¿ç”¨ï¼ˆéœ€ä»˜è´¹æˆ–è¯•ç”¨ï¼‰ YourKit å•†ä¸šæ€§èƒ½åˆ†æå·¥å…·ï¼Œç•Œé¢å‹å¥½ï¼Œæ”¯æŒä¸°å¯Œçš„åˆ†æåŠŸèƒ½ æ”¯æŒå †åˆ†æï¼Œé€‚åˆå†…å­˜æ³„æ¼æ’æŸ¥ jhatï¼ˆè¿‡æ—¶ï¼‰ JDK é™„å¸¦çš„æ—§å·¥å…·ï¼Œç”¨äºåˆ†æ .hprof æ–‡ä»¶ï¼Œå¼€å¯ Web ç•Œé¢æŸ¥çœ‹ï¼ˆå·²åºŸå¼ƒï¼‰ å‘½ä»¤ï¼šjhat heapdump.hprofï¼Œæµè§ˆå™¨è®¿é—® http://localhost:7000ï¼ˆJDK 8 åŠä»¥ä¸‹ï¼‰ jmap ç”¨äºç”Ÿæˆå †è½¬å‚¨æ–‡ä»¶æˆ–æŸ¥çœ‹å †å¯¹è±¡ç»Ÿè®¡ä¿¡æ¯ï¼ˆä¸æ˜¯åˆ†æå·¥å…·æœ¬èº«ï¼‰ å‘½ä»¤ï¼šjmap -dump:format=b,file=heap.hprof &lt;pid&gt; ç”Ÿæˆè½¬å‚¨ï¼›é…åˆ MAT ä½¿ç”¨ jcmd æ›´ç°ä»£çš„è¯Šæ–­å‘½ä»¤å·¥å…·ï¼Œå¯ç”Ÿæˆ heap dumpã€æ‰§è¡Œ GCã€æ‰“å° VM çŠ¶æ€ç­‰ å‘½ä»¤ï¼šjcmd &lt;pid&gt; GC.heap_dump heap.hprof GCEasy.io åœ¨çº¿åˆ†æå·¥å…·ï¼Œæ”¯æŒ .hprof æ–‡ä»¶å’Œ GC æ—¥å¿—ä¸Šä¼ åˆ†æ ç½‘ç«™ï¼šhttps://gceasy.io GCæ—¥å¿—ç›¸å…³å‚æ•°(JDK1.8åŠä»¥ä¸‹) å‚æ•° è¯´æ˜ -XX:+PrintGC æ‰“å°åŸºæœ¬ GC ä¿¡æ¯ï¼ˆå»ºè®®é…åˆ -XX:+PrintGCDetails ä½¿ç”¨ï¼‰ -XX:+PrintGCDetails æ‰“å°è¯¦ç»†çš„ GC æ—¥å¿—ä¿¡æ¯ï¼ˆå¦‚å„åŒºåŸŸä½¿ç”¨æƒ…å†µã€å¯¹è±¡åˆ†é…ã€æ™‹å‡ç­‰ï¼‰ -XX:+PrintGCDateStamps åœ¨ GC æ—¥å¿—ä¸­æ·»åŠ æ—¥æœŸæ—¶é—´æˆ³ -XX:+PrintGCTimeStamps åœ¨ GC æ—¥å¿—ä¸­æ·»åŠ  JVM å¯åŠ¨ä»¥æ¥çš„æ—¶é—´æˆ³ -Xloggc:/var/log/myapp/gc.log å°† GC æ—¥å¿—è¾“å‡ºåˆ°æŒ‡å®šæ–‡ä»¶ -XX:+UseGCLogFileRotation å¯ç”¨ GC æ—¥å¿—æ–‡ä»¶è½®è½¬ï¼ˆé€‚ç”¨äºå¤§è§„æ¨¡ç³»ç»Ÿçš„ GC æ—¥å¿—ç®¡ç†ï¼‰ -XX:NumberOfGCLogFiles=5 æœ€å¤šä¿ç•™ 5 ä¸ª GC æ—¥å¿—å†å²æ–‡ä»¶ -XX:GCLogFileSize=10M æ¯ä¸ª GC æ—¥å¿—æ–‡ä»¶æœ€å¤§ä¸º 10MB -XX:+PrintGCCause æ‰“å° GC çš„è§¦å‘åŸå› ï¼ˆå¦‚ Minor GCã€System.gc() ç­‰ï¼‰ GCæ—¥å¿—ç›¸å…³å‚æ•°(JDK9+) 1-Xlog:gc*:file=/var/log/app/gc.log:time,uptime,level,tags:filecount=5,filesize=20M éƒ¨åˆ† å«ä¹‰ è¯´æ˜ gc* æ—¥å¿—ç±»åˆ« è¡¨ç¤ºè®°å½•æ‰€æœ‰ GC ç›¸å…³æ—¥å¿—ï¼ˆå¦‚ gcã€gc+startã€gc+heap ç­‰ï¼‰ã€‚* æ˜¯é€šé…ç¬¦ã€‚ file=/var/log/app/gc.log è¾“å‡ºè·¯å¾„ å°† GC æ—¥å¿—è¾“å‡ºåˆ°æŒ‡å®šè·¯å¾„ï¼Œè€Œä¸æ˜¯æ§åˆ¶å°ã€‚å¯ä»¥æ˜¯ç›¸å¯¹æˆ–ç»å¯¹è·¯å¾„ã€‚ time æ—¥å¿—æ—¶é—´æˆ³ æ·»åŠ æ ¼å¼åŒ–æ—¶é—´ï¼ˆå¦‚ 2025-05-12T10:21:33.123+0800ï¼‰ã€‚ä¾¿äºå®šä½å…·ä½“æ—¶é—´ã€‚ uptime JVM å¯åŠ¨ä»¥æ¥çš„æ—¶é—´æˆ³ æ˜¾ç¤º GC å‘ç”Ÿæ—¶è·ç¦» JVM å¯åŠ¨çš„æ¯«ç§’æ•°ï¼ˆä¾‹å¦‚ 3.254sï¼‰ã€‚æœ‰åŠ©äºè°ƒè¯•å¯åŠ¨æœŸé—´çš„é—®é¢˜ã€‚ level æ—¥å¿—çº§åˆ« æ˜¾ç¤ºæ—¥å¿—çº§åˆ«ï¼ˆinfoã€debugã€warning ç­‰ï¼‰ï¼Œé»˜è®¤ infoã€‚ tags æ—¥å¿—æ ‡ç­¾ æ˜¾ç¤ºæ—¥å¿—çš„æ¨¡å—æ ‡ç­¾ï¼Œå¦‚ [gc,start]ï¼Œå¸®åŠ©å¿«é€Ÿå®šä½ç±»åˆ«ã€‚ filecount=5 æ–‡ä»¶è½®è½¬ä¸ªæ•° æœ€å¤šä¿ç•™ 5 ä¸ªæ—¥å¿—æ–‡ä»¶ï¼ˆå½“å‰æ—¥å¿— + 4 ä¸ªå†å²ï¼‰ã€‚ filesize=20M å•æ–‡ä»¶æœ€å¤§å¤§å° æ¯ä¸ªæ—¥å¿—æ–‡ä»¶æœ€å¤§ 20MBï¼Œè¶…å‡ºæ—¶è‡ªåŠ¨æ»šåŠ¨åˆ°ä¸‹ä¸€ä¸ªæ–‡ä»¶ã€‚","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç»JVMçš„å†…å­˜æ¨¡å‹ä¸åƒåœ¾å›æ”¶æœºåˆ¶ The JavaÂ® Virtual Machine Specification ç‰ˆæœ¬jdk1.8","date_published":"2025-05-12T14:30:05.000Z","tags":["æŠ€æœ¯","jvm","jvm"]},{"id":"https://blog.hanqunfeng.com/2025/05/08/jvm-classloader-01/","url":"https://blog.hanqunfeng.com/2025/05/08/jvm-classloader-01/","title":"JVM ä¹‹ ç±»åŠ è½½å™¨","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç»JVMçš„ç±»åŠ è½½å™¨</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://docs.oracle.com/javase/specs/jvms/se8/html/index.html\">The JavaÂ® Virtual Machine Specification</a> ç‰ˆæœ¬jdk1.8</p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"ç±»åŠ è½½å™¨\">ç±»åŠ è½½å™¨</h2>\n<p><img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/uPic/weBeGe.png\" alt=\"\" width=\"1200\" height=\"400\"></p>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å·¦ä¾§æ˜¯JDKä¸­å®ç°çš„ç±»åŠ è½½å™¨ï¼Œé€šè¿‡<code>parent</code>å±æ€§å½¢æˆâ½—â¼¦å…³ç³»ã€‚åº”â½¤ä¸­â¾ƒå®šä¹‰çš„ç±»åŠ è½½å™¨çš„<code>parent</code>éƒ½æ˜¯<br>\n<code>AppClassLoader</code></p>\n</li>\n<li class=\"lvl-2\">\n<p>å³ä¾§æ˜¯JDKä¸­çš„ç±»åŠ è½½å™¨å®ç°ç±»ã€‚é€šè¿‡ç±»ç»§æ‰¿çš„æœºåˆ¶å½¢æˆä½“ç³»ã€‚æœªæ¥æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ç»§æ‰¿ç›¸å…³çš„ç±»å®ç°â¾ƒå®šä¹‰ç±»<br>\nåŠ è½½å™¨ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>åœ¨ä»£ç ä¸­æŸ¥çœ‹ç±»åŠ è½½å™¨å…³ç³»</p>\n</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">LoaderDemo</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> ClassNotFoundException &#123;</span><br><span class=\"line\">        <span class=\"comment\">// â½—â¼¦å…³ç³» AppClassLoader &lt;- ExtClassLoader &lt;- BootStrap Classloader</span></span><br><span class=\"line\">        <span class=\"type\">ClassLoader</span> <span class=\"variable\">cl1</span> <span class=\"operator\">=</span> LoaderDemo.class.getClassLoader();</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;cl1 &gt; &quot;</span> + cl1); <span class=\"comment\">// sun.misc.Launcher$AppClassLoader@18b4aac2</span></span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;parent of cl1 &gt; &quot;</span> + cl1.getParent()); <span class=\"comment\">// sun.misc.Launcher$ExtClassLoader@1b6d3586</span></span><br><span class=\"line\">        <span class=\"comment\">// BootStrap Classloaderç”±C++å¼€å‘ï¼Œæ˜¯JVMè™šæ‹Ÿæœºçš„â¼€éƒ¨åˆ†ï¼Œæœ¬èº«ä¸æ˜¯JAVAç±»ã€‚</span></span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;grant parent of cl1 &gt; &quot;</span> + cl1.getParent().getParent()); <span class=\"comment\">// null</span></span><br><span class=\"line\">        <span class=\"comment\">// String,Intç­‰åŸºç¡€ç±»ç”±BootStrap ClassloaderåŠ è½½ã€‚</span></span><br><span class=\"line\">        <span class=\"type\">ClassLoader</span> <span class=\"variable\">cl2</span> <span class=\"operator\">=</span> String.class.getClassLoader();</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;cl2 &gt; &quot;</span> + cl2); <span class=\"comment\">// null</span></span><br><span class=\"line\">        System.out.println(cl1.loadClass(<span class=\"string\">&quot;java.util.List&quot;</span>).getClass().getClassLoader()); <span class=\"comment\">// null</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"åŒäº²å§”æ´¾æœºåˆ¶\">åŒäº²å§”æ´¾æœºåˆ¶</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å½“â¼€ä¸ªç±»åŠ è½½å™¨è¦åŠ è½½â¼€ä¸ªç±»æ—¶ï¼Œæ•´ä½“çš„è¿‡ç¨‹å°±æ˜¯é€šè¿‡åŒäº²å§”æ´¾æœºåˆ¶å‘ä¸Šå§”æ‰˜æŸ¥æ‰¾ï¼Œå¦‚æœæ²¡æœ‰æŸ¥æ‰¾åˆ°ï¼Œå°±å‘ä¸‹å§”æ‰˜åŠ è½½ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>Java ç±»åŠ è½½æœºåˆ¶ä¸­çš„<code>åŒäº²å§”æ´¾æ¨¡å‹ï¼ˆParent Delegation Modelï¼‰</code>æ˜¯ä¸€ç§ä¿è¯äº†ç±»åŠ è½½å™¨æŒ‰ç…§å±‚æ¬¡ç»“æ„ä»ä¸Šåˆ°ä¸‹æ¥åŠ è½½ç±»çš„ç­–ç•¥ã€‚è¿™ç§å±‚çº§åŒ–çš„åŠ è½½æµç¨‹ç¡®ä¿äº†åº”ç”¨ç¨‹åºèƒ½å¤Ÿå®‰å…¨åœ°åŠ è½½å¹¶ä½¿ç”¨æ¥è‡ªä¸åŒæ¥æºçš„ç±»ï¼ŒåŒæ—¶ä¹Ÿé¿å…äº†å†…å­˜ä¸­å‡ºç°ç›¸åŒç±»çš„å¤šä¸ªæ‹·è´ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä»¥ä¸‹æ˜¯åŒäº²å§”æ´¾æœºåˆ¶çš„å·¥ä½œåŸç†ï¼š</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">1.å½“ä¸€ä¸ªç±»åŠ è½½å™¨æ¥æ”¶åˆ°ç±»åŠ è½½è¯·æ±‚æ—¶ï¼Œå®ƒé¦–å…ˆä¸ä¼šè‡ªè¡Œå°è¯•å»å¯»æ‰¾ç±»æ–‡ä»¶ï¼Œè€Œæ˜¯å°†è¿™ä¸ªè¯·æ±‚å§”æ´¾ç»™å®ƒçš„çˆ¶ç±»åŠ è½½å™¨ã€‚</li>\n<li class=\"lvl-4\">2.çˆ¶ç±»åŠ è½½å™¨åŒæ ·éµå¾ªæ­¤è§„åˆ™ï¼Œå®ƒä¼šç»§ç»­æŠŠè¯·æ±‚å‘ä¸Šå§”æ´¾ç»™å®ƒçš„çˆ¶ç±»åŠ è½½å™¨ï¼Œç›´åˆ°è¾¾åˆ°æ ¹ï¼ˆbootstrappï¼‰ç±»åŠ è½½å™¨ä¸ºæ­¢ã€‚</li>\n<li class=\"lvl-4\">3.æ ¹ç±»åŠ è½½å™¨ä¸€èˆ¬ä¼šç›´æ¥è®¿é—®æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿæ¥æŸ¥æ‰¾ç±»æ–‡ä»¶ï¼Œæ¯”å¦‚ JDK è‡ªå¸¦çš„æ ¸å¿ƒç±»åº“ï¼Œæˆ–è€…åœ¨-XbootclasspathæŒ‡å®šçš„è·¯å¾„ä¸‹æŸ¥æ‰¾ã€‚</li>\n<li class=\"lvl-4\">4.å¦‚æœæ ¹ç±»åŠ è½½å™¨æ‰¾åˆ°äº†è¯¥ç±»ï¼Œåˆ™è¿›è¡Œç±»çš„åŠ è½½ï¼›å¦‚æœæ‰¾ä¸åˆ°ï¼Œåˆ™æŠŠè¿™ä¸ªä»»åŠ¡äº¤å›ç»™å‘å‡ºè¯·æ±‚çš„å­ç±»åŠ è½½å™¨ã€‚</li>\n<li class=\"lvl-4\">5.å­ç±»åŠ è½½å™¨ä¹Ÿé‡å¤æ­¥éª¤ 4ï¼Œè‹¥æ‰¾åˆ°åˆ™åŠ è½½ï¼Œå¦åˆ™ä¼ é€’ç»™ä¸‹ä¸€ä¸ªå­ç±»åŠ è½½å™¨ï¼Œç›´è‡³åŸå§‹æå‡ºè¯·æ±‚çš„ç±»åŠ è½½å™¨ã€‚</li>\n<li class=\"lvl-4\">6.è‹¥æ‰€æœ‰çš„ç±»åŠ è½½å™¨éƒ½æœªèƒ½æ‰¾åˆ°æ‰€éœ€çš„ç±»ï¼Œåˆ™æœ€ç»ˆæŠ›å‡ºClassNotFoundExceptionå¼‚å¸¸ã€‚<br>\n<img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/uPic/ftDnCj.png\" alt=\"\" width=\"600\" height=\"800\"></li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<p>åŒäº²å§”æ´¾æœ‰ä»¥ä¸‹å‡ ä¸ªä¼˜ç‚¹ï¼š</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">å®‰å…¨æ€§ï¼šç”±äºç±»åŠ è½½æ˜¯ä»é¡¶å±‚å¼€å§‹ï¼Œè¿™èƒ½é˜²æ­¢æ¶æ„ä»£ç é€šè¿‡åŠ è½½ç›¸åŒçš„åŒ…åå’Œç±»åæ›¿ä»£ç³»ç»Ÿçš„å…³é”®ç±»ã€‚</li>\n<li class=\"lvl-4\">å”¯ä¸€æ€§ï¼šæ¯ä¸ªç±»éƒ½ä¼šè¢«ç‰¹å®šçš„ç±»åŠ è½½å™¨åŠ è½½ä¸€æ¬¡ï¼Œå³ä¾¿æ˜¯åœ¨åˆ†å¸ƒå¼çš„ç¯å¢ƒä¸­ä¹Ÿèƒ½ä¿è¯ç±»çš„ç»Ÿä¸€æ€§ï¼Œé¿å…å› ä¸ºå¤šæ¬¡åŠ è½½å¯¼è‡´çš„é”™è¯¯ã€‚</li>\n<li class=\"lvl-4\">å¯é æ€§ï¼šç”¨æˆ·è‡ªå®šä¹‰çš„ç±»åŠ è½½å™¨ä¸ç”¨æ‹…å¿ƒåŸºç¡€ç±»å·²ç»è¢«åŠ è½½ï¼Œå®ƒä»¬å¯ä»¥ä¸“å¿ƒäºè‡ªå·±éœ€è¦å¤„ç†çš„éƒ¨åˆ†ã€‚</li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<p>ä¾‹å¦‚ï¼Œå½“åº”ç”¨ç¨‹åºè¿è¡Œæ—¶ï¼Œåº”ç”¨ç±»åŠ è½½å™¨ï¼ˆApplication ClassLoaderï¼‰æ¥æ”¶åˆ°å¯¹java.lang.Stringç±»çš„åŠ è½½è¯·æ±‚æ—¶ï¼Œå®ƒä¼šé¦–å…ˆå°†è¯·æ±‚ä¼ é€’ç»™æ‰©å±•ç±»åŠ è½½å™¨ï¼ˆExtension ClassLoaderï¼‰ï¼Œåè€…å†ä¼ é€’ç»™å¼•å¯¼ç±»åŠ è½½å™¨ï¼ˆBootstrap ClassLoaderï¼‰ã€‚å¼•å¯¼ç±»åŠ è½½å™¨ä¼šåœ¨å…¶æœç´¢è·¯å¾„ä¸­æ‰¾åˆ°Stringç±»ï¼Œå¹¶å®ŒæˆåŠ è½½è¿‡ç¨‹ã€‚å¦‚æœåº”ç”¨ç¨‹åºè¯•å›¾æä¾›è‡ªå·±çš„Stringç±»ï¼Œç”±äºåŒäº²å§”æ´¾çš„å­˜åœ¨ï¼Œåº”ç”¨ç¨‹åºæ‰€æŒ‡å®šçš„ç±»å¹¶ä¸ä¼šè¢«åŠ è½½ï¼Œä»è€Œä¿è¯äº†å¹³å°æ ¸å¿ƒ API çš„ä¸€è‡´æ€§ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>æ€»ä¹‹ï¼ŒåŒäº²å§”æ´¾æœºåˆ¶æ˜¯ Java ç±»åŠ è½½è¿‡ç¨‹ä¸­ä¸€ä¸ªéå¸¸é‡è¦çš„ç‰¹æ€§ï¼Œå®ƒä¸ä»…ç»´æŠ¤äº†ç±»åŠ è½½çš„å®‰å…¨æ€§å’Œä¸€è‡´æ€§ï¼Œä¹Ÿä¸ºå¼€å‘è€…æä¾›äº†çµæ´»å®šåˆ¶ç±»åŠ è½½è§„åˆ™çš„èƒ½åŠ›ã€‚</p>\n</li>\n</ul>\n<h3 id=\"æ¯ä¸ªç±»åŠ è½½å™¨æŸ¥æ‰¾ç±»çš„é»˜è®¤è·¯å¾„\">æ¯ä¸ªç±»åŠ è½½å™¨æŸ¥æ‰¾ç±»çš„é»˜è®¤è·¯å¾„</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åœ¨ Java ä¸­ï¼Œæ¯ä¸ªç±»åŠ è½½å™¨éƒ½æœ‰è‡ªå·±çš„ç±»è·¯å¾„ï¼ˆClasspathï¼‰å»æŸ¥æ‰¾ç±»æ–‡ä»¶ã€‚ä¸‹é¢æ˜¯å‡ ä¸ªä¸»è¦çš„ç±»åŠ è½½å™¨ä»¥åŠå®ƒä»¬çš„é»˜è®¤æŸ¥æ‰¾è·¯å¾„ï¼š</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>ç±»åŠ è½½å™¨åç§°</th>\n<th>ç±»å / åˆ«å</th>\n<th>çˆ¶ç±»åŠ è½½å™¨</th>\n<th>åŠ è½½å†…å®¹æè¿°</th>\n<th>é»˜è®¤æŸ¥æ‰¾è·¯å¾„ / ç³»ç»Ÿå±æ€§</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>å¯åŠ¨ç±»åŠ è½½å™¨</strong></td>\n<td>BootstrapClassLoader</td>\n<td>æ— </td>\n<td>åŠ è½½ <strong>æ ¸å¿ƒ Java ç±»åº“</strong></td>\n<td><code>&lt;JAVA_HOME&gt;/jre/lib/rt.jar</code>ï¼ˆJDK8 åŠä¹‹å‰ï¼‰æˆ– <code>sun.boot.class.path</code> æŒ‡å®šè·¯å¾„</td>\n</tr>\n<tr>\n<td><strong>æ‰©å±•ç±»åŠ è½½å™¨</strong></td>\n<td>ExtClassLoader</td>\n<td>BootstrapClassLoader</td>\n<td>åŠ è½½ Java å¹³å°æ‰©å±•ç±»åº“</td>\n<td><code>&lt;JAVA_HOME&gt;/jre/lib/ext</code> æˆ–ç”± <code>java.ext.dirs</code> ç³»ç»Ÿå±æ€§æŒ‡å®š</td>\n</tr>\n<tr>\n<td><strong>åº”ç”¨ç±»åŠ è½½å™¨</strong></td>\n<td>AppClassLoader</td>\n<td>ExtClassLoader</td>\n<td>åŠ è½½ <strong>åº”ç”¨ç¨‹åºç±»</strong>ï¼ˆç”¨æˆ·ç¼–å†™çš„ä»£ç ï¼‰</td>\n<td><code>-classpath</code>ã€<code>-cp</code> å‚æ•°ã€<code>CLASSPATH</code> ç¯å¢ƒå˜é‡ã€<code>java.class.path</code> å±æ€§ã€å½“å‰ç›®å½• (.)</td>\n</tr>\n<tr>\n<td><strong>è‡ªå®šä¹‰ç±»åŠ è½½å™¨</strong></td>\n<td>ç”¨æˆ·è‡ªå®šä¹‰</td>\n<td>å¯æŒ‡å®š</td>\n<td>å¯é€šè¿‡ç»§æ‰¿ <code>ClassLoader</code> å¹¶é‡å†™ <code>findClass()</code> æ–¹æ³•å®ç°è‡ªå®šä¹‰ç±»åŠ è½½é€»è¾‘ï¼Œå¦‚ä»ç½‘ç»œã€æ•°æ®åº“ç­‰åŠ è½½ç±»æ–‡ä»¶</td>\n<td>é»˜è®¤ç»§æ‰¿çˆ¶åŠ è½½å™¨æŸ¥æ‰¾è·¯å¾„ï¼Œä¹Ÿå¯è‡ªå®šä¹‰</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œé™¤äº† Bootstrap ClassLoader å¤–ï¼Œå…¶ä»–çš„æ‰€æœ‰ç±»åŠ è½½å™¨æœ€ç»ˆéƒ½æ˜¯java.lang.ClassLoaderçš„å­ç±»ï¼Œå¹¶ä¸”æ¯ä¸ªç±»åŠ è½½å™¨å®ä¾‹éƒ½æœ‰ä¸€ä¸ªç›´æ¥çš„çˆ¶ç±»åŠ è½½å™¨ã€‚å¦‚æœä½ åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„ç±»åŠ è½½å™¨ï¼Œå®ƒå°†ç»§æ‰¿ Application ClassLoader ä½œä¸ºå®ƒçš„çˆ¶ç±»ï¼Œé™¤éä½ åœ¨åˆ›å»ºæ—¶æŒ‡å®šäº†ä¸åŒçš„çˆ¶ç±»åŠ è½½å™¨ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>æ­¤å¤–ï¼ŒJava 9 å¼•å…¥äº†æ¨¡å—åŒ–ç³»ç»Ÿåï¼Œç±»åŠ è½½æœºåˆ¶ä¹Ÿæœ‰äº†ä¸€äº›å˜åŒ–ï¼Œå¯¹äºæ¨¡å—è·¯å¾„ä¸Šçš„ç±»åŠ è½½ï¼Œä¼šä½¿ç”¨æ–°çš„å±‚æ¬¡ç»“æ„æ¥å¤„ç†ï¼Œè¿™ä½¿å¾—ç±»åŠ è½½è¿‡ç¨‹æ›´åŠ çµæ´»åŒæ—¶ä¿æŒäº†å‘åçš„å…¼å®¹æ€§ã€‚ä¸è¿‡ï¼Œå¯¹äºä¼ ç»Ÿçš„ç±»è·¯å¾„ä¸Šçš„ç±»åŠ è½½ï¼ŒåŒäº²å§”æ´¾æ¨¡å‹ä»ç„¶é€‚ç”¨ã€‚<br>\n<img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/uPic/50fvA9.png\" alt=\"\" width=\"1200\" height=\"400\"></p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>ç±»åŠ è½½å™¨åç§°</th>\n<th>ç±»å / åˆ«å</th>\n<th>çˆ¶ç±»åŠ è½½å™¨</th>\n<th>åŠ è½½æ¨¡å—èŒƒå›´</th>\n<th>é»˜è®¤æŸ¥æ‰¾è·¯å¾„ / æ¨¡å—æ¥æº</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>å¼•å¯¼ç±»åŠ è½½å™¨</strong></td>\n<td><code>BootstrapClassLoader</code></td>\n<td>æ— </td>\n<td>åŠ è½½ <code>java.*</code> æ¨¡å—ï¼Œä¾‹å¦‚ <code>java.base</code>ï¼ˆåŒ…å« <code>java.lang</code>, <code>java.util</code> ç­‰ï¼‰</td>\n<td><code>$JAVA_HOME/jmods</code> ä¸­çš„æ¨¡å—æ–‡ä»¶ï¼Œæ ¸å¿ƒæ¨¡å—ç”± JVM å¯åŠ¨æ—¶ç›´æ¥åŠ è½½</td>\n</tr>\n<tr>\n<td><strong>å¹³å°ç±»åŠ è½½å™¨</strong></td>\n<td><code>PlatformClassLoader</code></td>\n<td>BootstrapClassLoader</td>\n<td>åŠ è½½ <code>jdk.*</code>ã€<code>javafx.*</code> ç­‰å¹³å°æ‰©å±•æ¨¡å—</td>\n<td><code>$JAVA_HOME/jmods</code>ï¼Œæ¨¡å—åä¸º <code>jdk.*</code>ã€<code>javafx.*</code> ç­‰ï¼›</td>\n</tr>\n<tr>\n<td><strong>åº”ç”¨ç±»åŠ è½½å™¨</strong></td>\n<td><code>AppClassLoader</code></td>\n<td>PlatformClassLoader</td>\n<td>åŠ è½½åº”ç”¨æ¨¡å—ï¼ˆç”¨æˆ·ä»£ç ï¼‰ï¼ŒåŒ…æ‹¬æ¨¡å—è·¯å¾„ <code>--module-path</code> å’Œç±»è·¯å¾„ <code>-classpath</code> ä¸‹çš„ç±»</td>\n<td>åº”ç”¨ç¨‹åºç¼–å†™çš„æ¨¡å—æˆ–ç±»ï¼Œæ¥è‡ªå‘½ä»¤è¡Œ <code>--module-path</code>ã€<code>-classpath</code> å‚æ•°ã€<code>CLASSPATH</code> ç¯å¢ƒå˜é‡ç­‰</td>\n</tr>\n<tr>\n<td><strong>è‡ªå®šä¹‰ç±»åŠ è½½å™¨</strong></td>\n<td>ç”¨æˆ·è‡ªå®šä¹‰</td>\n<td>å¯æŒ‡å®šçˆ¶åŠ è½½å™¨</td>\n<td>åŠ è½½éæ ‡å‡†ä½ç½®çš„ç±»ï¼Œå¯ç”¨äºæ’ä»¶ã€ç½‘ç»œåŠ è½½ã€åŠ å¯†ç±»åŠ è½½ç­‰</td>\n<td>é»˜è®¤éµå¾ªåŒäº²å§”æ´¾ï¼Œå¯é‡å†™ <code>findClass()</code> å®ç°è‡ªå®šä¹‰è·¯å¾„æŸ¥æ‰¾æˆ–å…¶ä»–æ•°æ®æºï¼Œå¦‚ç½‘ç»œã€æ•°æ®åº“ã€åŠ å¯†æ–‡ä»¶ç­‰</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åœ¨ä»£ç ä¸­æŸ¥çœ‹ç±»åŠ è½½è·¯å¾„</p>\n</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// BootStrap Classloaderï¼ŒåŠ è½½javaåŸºç¡€ç±»ã€‚</span></span><br><span class=\"line\">System.out.println(<span class=\"string\">&quot;BootStrap ClassLoaderåŠ è½½â½¬å½•ï¼š&quot;</span> + System.getProperty(<span class=\"string\">&quot;sun.boot.class.path&quot;</span>));</span><br><span class=\"line\"><span class=\"comment\">// Extention Classloader åŠ è½½â¼€äº›æ‰©å±•ç±»ã€‚ å¯é€šè¿‡-D java.ext.dirså¦â¾æŒ‡å®šâ½¬å½•</span></span><br><span class=\"line\">System.out.println(<span class=\"string\">&quot;Extention ClassLoaderåŠ è½½â½¬å½•ï¼š&quot;</span> + System.getProperty(<span class=\"string\">&quot;java.ext.dirs&quot;</span>));</span><br><span class=\"line\"><span class=\"comment\">// AppClassLoader åŠ è½½CLASSPATHï¼Œåº”â½¤ä¸‹çš„JaråŒ…ã€‚å¯é€šè¿‡-D java.class.pathå¦â¾æŒ‡å®šâ½¬å½•</span></span><br><span class=\"line\">System.out.println(<span class=\"string\">&quot;AppClassLoaderåŠ è½½â½¬å½•ï¼š&quot;</span> + System.getProperty(<span class=\"string\">&quot;java.class.path&quot;</span>));</span><br></pre></td></tr></table></figure>\n<h3 id=\"åŒäº²å§”æ´¾æœºåˆ¶çš„å®ç°åŸç†\">åŒäº²å§”æ´¾æœºåˆ¶çš„å®ç°åŸç†</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>java.lang.ClassLoader ç±»çš„ loadClass æ–¹æ³•æ˜¯åŒäº²å§”æ´¾çš„æ ¸å¿ƒå®ç°</p>\n</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * åŠ è½½æŒ‡å®šåç§°çš„ç±»ï¼Œå¹¶æ ¹æ® resolve å‚æ•°å†³å®šæ˜¯å¦è§£æè¯¥ç±»ã€‚</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * è¯¥æ–¹æ³•å®ç°äº†ç±»åŠ è½½çš„åŸºæœ¬é€»è¾‘ï¼ŒåŒ…æ‹¬æ£€æŸ¥ç±»æ˜¯å¦å·²åŠ è½½ã€å§”æ‰˜çˆ¶ç±»åŠ è½½å™¨åŠ è½½ã€</span></span><br><span class=\"line\"><span class=\"comment\"> * è‡ªè¡ŒåŠ è½½ç±»ä»¥åŠè§£æç±»ç­‰æ­¥éª¤ã€‚è¯¥æ–¹æ³•æ˜¯ Java ç±»åŠ è½½æœºåˆ¶çš„æ ¸å¿ƒéƒ¨åˆ†ä¹‹ä¸€ï¼Œ</span></span><br><span class=\"line\"><span class=\"comment\"> * éµå¾ªåŒäº²å§”æ´¾æ¨¡å‹ã€‚</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> name    è¦åŠ è½½çš„ç±»çš„å…¨é™å®šå</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> resolve å¦‚æœä¸º trueï¼Œåˆ™åœ¨åŠ è½½åè§£æè¯¥ç±»</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return</span> åŠ è½½çš„ Class å¯¹è±¡</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@throws</span> ClassNotFoundException å¦‚æœæ‰¾ä¸åˆ°æŒ‡å®šçš„ç±»</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"comment\">// è¿™ä¸ªâ½…æ³•æ˜¯protectedå£°æ˜çš„ï¼Œæ„å‘³ç€ï¼Œæ˜¯å¯ä»¥è¢«â¼¦ç±»è¦†ç›–çš„ï¼Œæ‰€ä»¥ï¼ŒåŒäº²å§”æ´¾æœºåˆ¶ä¹Ÿæ˜¯å¯ä»¥è¢«æ‰“ç ´çš„ï¼Œå¦‚Tomcatâ¼¦ç±»é‡å†™è¿™ä¸ªâ½…æ³•ï¼Œå¹¶ä½¿â½¤è‡ªå·±çš„ç±»åŠ è½½é€»è¾‘ã€‚</span></span><br><span class=\"line\"><span class=\"keyword\">protected</span> Class&lt;?&gt; loadClass(String name, <span class=\"type\">boolean</span> resolve)</span><br><span class=\"line\">        <span class=\"keyword\">throws</span> ClassNotFoundException &#123;</span><br><span class=\"line\">    <span class=\"comment\">// ä½¿ç”¨ synchronized ç¡®ä¿å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ç±»åŠ è½½çš„åŒæ­¥</span></span><br><span class=\"line\">    <span class=\"keyword\">synchronized</span> (getClassLoadingLock(name)) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// First, check if the class has already been loaded</span></span><br><span class=\"line\">        <span class=\"comment\">// æ¯ä¸ªç±»åŠ è½½å™¨å¯¹ä»–åŠ è½½è¿‡çš„ç±»éƒ½æœ‰â¼€ä¸ªç¼“å­˜ï¼Œå…ˆå»ç¼“å­˜ä¸­æŸ¥çœ‹æœ‰æ²¡æœ‰åŠ è½½è¿‡</span></span><br><span class=\"line\">        Class&lt;?&gt; c = findLoadedClass(name);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (c == <span class=\"literal\">null</span>) &#123; <span class=\"comment\">//æ²¡æœ‰åŠ è½½è¿‡ï¼Œå°±â¾›åŒäº²å§”æ´¾</span></span><br><span class=\"line\">            <span class=\"type\">long</span> <span class=\"variable\">t0</span> <span class=\"operator\">=</span> System.nanoTime();</span><br><span class=\"line\">            <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                <span class=\"comment\">// çˆ¶ç±»å­˜åœ¨åˆ™è®©â½—ç±»åŠ è½½å™¨è¿›â¾åŠ è½½</span></span><br><span class=\"line\">                <span class=\"keyword\">if</span> (parent != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                    c = parent.loadClass(name, <span class=\"literal\">false</span>);</span><br><span class=\"line\">                &#125; <span class=\"keyword\">else</span> &#123; <span class=\"comment\">//å¦‚æœçˆ¶ç±»ä¸å­˜åœ¨ï¼Œåˆ™ä»å¼•å¯¼ç±»åŠ è½½å™¨è¿›â¾åŠ è½½</span></span><br><span class=\"line\">                    c = findBootstrapClassOrNull(name);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125; <span class=\"keyword\">catch</span> (ClassNotFoundException e) &#123;</span><br><span class=\"line\">                <span class=\"comment\">// ClassNotFoundException thrown if class not found</span></span><br><span class=\"line\">                <span class=\"comment\">// from the non-null parent class loader</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (c == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                <span class=\"comment\">// If still not found, then invoke findClass in order</span></span><br><span class=\"line\">                <span class=\"comment\">// to find the class.</span></span><br><span class=\"line\">                <span class=\"type\">long</span> <span class=\"variable\">t1</span> <span class=\"operator\">=</span> System.nanoTime();</span><br><span class=\"line\">                <span class=\"comment\">// findClass æ–¹æ³•æ˜¯å­ç±»å®ç°çš„ï¼Œç”¨äºåŠ è½½æŒ‡å®šåç§°çš„ç±»</span></span><br><span class=\"line\">                <span class=\"comment\">// â½—ç±»åŠ è½½å™¨æ²¡æœ‰åŠ è½½è¿‡ï¼Œå°±â¾ƒâ¾è§£æclassâ½‚ä»¶åŠ è½½</span></span><br><span class=\"line\">                c = findClass(name);</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"comment\">// this is the defining class loader; record the stats</span></span><br><span class=\"line\">                <span class=\"comment\">// æ€§èƒ½ç»Ÿè®¡ï¼šè®°å½•ç±»åŠ è½½è¿‡ç¨‹ä¸­çš„æ—¶é—´æ¶ˆè€—å’Œè°ƒç”¨æ¬¡æ•°ï¼Œä¾¿äºç›‘æ§å’Œä¼˜åŒ–ã€‚</span></span><br><span class=\"line\">                sun.misc.PerfCounter.getParentDelegationTime().addTime(t1 - t0);</span><br><span class=\"line\">                sun.misc.PerfCounter.getFindClassTime().addElapsedTimeFrom(t1);</span><br><span class=\"line\">                sun.misc.PerfCounter.getFindClasses().increment();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// é»˜è®¤æƒ…å†µä¸‹ï¼ŒåŒäº²å§”æ´¾æ¨¡å‹åªè¿›â¾äº†éªŒè¯å’Œå‡†å¤‡é˜¶æ®µï¼Œâ½½ä¸è¿›â¾è§£æ(å¦‚é“¾æ¥ã€åˆå§‹åŒ–)</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (resolve) &#123;</span><br><span class=\"line\">            resolveClass(c);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> c;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¯¥æ–¹æ³•å®ç°äº†ç±»åŠ è½½çš„åŸºæœ¬é€»è¾‘ï¼ŒåŒ…æ‹¬æ£€æŸ¥ç±»æ˜¯å¦å·²åŠ è½½ã€å§”æ‰˜çˆ¶ç±»åŠ è½½å™¨åŠ è½½ã€è‡ªè¡ŒåŠ è½½ç±»ä»¥åŠè§£æç±»ç­‰æ­¥éª¤ã€‚è¯¥æ–¹æ³•æ˜¯ Java ç±»åŠ è½½æœºåˆ¶çš„æ ¸å¿ƒéƒ¨åˆ†ä¹‹ä¸€ï¼Œéµå¾ªåŒäº²å§”æ´¾æ¨¡å‹ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>è¿™ä¸ªâ½…æ³•æ˜¯<code>protected</code>å£°æ˜çš„ï¼Œæ„å‘³ç€ï¼Œæ˜¯å¯ä»¥è¢«â¼¦ç±»è¦†ç›–çš„ï¼Œæ‰€ä»¥ï¼ŒåŒäº²å§”æ´¾æœºåˆ¶ä¹Ÿæ˜¯å¯ä»¥è¢«æ‰“ç ´çš„ï¼Œå¦‚Tomcatâ¼¦ç±»é‡å†™è¿™ä¸ªâ½…æ³•ï¼Œå¹¶ä½¿â½¤è‡ªå·±çš„ç±»åŠ è½½é€»è¾‘ã€‚</p>\n</li>\n</ul>\n<h2 id=\"æ²™ç®±ä¿æŠ¤æœºåˆ¶\">æ²™ç®±ä¿æŠ¤æœºåˆ¶</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ²™ç®±ä¿æŠ¤æœºåˆ¶æ˜¯ Java è™šæ‹Ÿæœºæä¾›çš„ä¸€ç§å®‰å…¨æœºåˆ¶ï¼Œç”¨äºä¿æŠ¤åº”ç”¨ç¨‹åºå…å—æ¶æ„ä»£ç çš„æ”»å‡»ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>java.lang.ClassLoader ç±»çš„ preDefineClass æ–¹æ³•æ˜¯æ²™ç®±ä¿æŠ¤æœºåˆ¶çš„æ ¸å¿ƒå®ç°</p>\n</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// è¿™ä¸ªæ–¹æ³•åœ¨åŒäº²å§”æ´¾æ¨¡å‹ä¹‹å‰è¢«è°ƒç”¨ï¼Œç”¨äºåœ¨åŠ è½½ç±»ä¹‹å‰è¿›è¡Œä¸€äº›é¢„å¤„ç†æ“ä½œã€‚</span></span><br><span class=\"line\"><span class=\"comment\">// å‚æ•°ï¼š</span></span><br><span class=\"line\"><span class=\"comment\">// name: è¦åŠ è½½çš„ç±»çš„å…¨é™å®šåã€‚</span></span><br><span class=\"line\"><span class=\"comment\">// pd: æä¾›çš„ä¿æŠ¤åŸŸä¿¡æ¯ï¼Œå¯èƒ½ä¸º nullã€‚</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> ProtectionDomain <span class=\"title function_\">preDefineClass</span><span class=\"params\">(String name,</span></span><br><span class=\"line\"><span class=\"params\">                                            ProtectionDomain pd)</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!checkName(name))</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">NoClassDefFoundError</span>(<span class=\"string\">&quot;IllegalName: &quot;</span> + name);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// Note:  Checking logic in java.lang.invoke.MemberName.checkForTypeAlias</span></span><br><span class=\"line\">        <span class=\"comment\">// relies on the fact that spoofing is impossible if a class has a name</span></span><br><span class=\"line\">        <span class=\"comment\">// of the form &quot;java.*&quot;</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> ((name != <span class=\"literal\">null</span>) &amp;&amp; name.startsWith(<span class=\"string\">&quot;java.&quot;</span>)) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">SecurityException</span></span><br><span class=\"line\">                (<span class=\"string\">&quot;Prohibited package name: &quot;</span> +</span><br><span class=\"line\">                 name.substring(<span class=\"number\">0</span>, name.lastIndexOf(<span class=\"string\">&#x27;.&#x27;</span>)));</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (pd == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">            pd = defaultDomain;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (name != <span class=\"literal\">null</span>) checkCerts(name, pd.getCodeSource());</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> pd;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¿™ä¸ªæ–¹æ³• <code>preDefineClass</code> çš„ä½œç”¨æ˜¯åœ¨ç±»è¢«å®šä¹‰ä¹‹å‰è¿›è¡Œä¸€äº›å®‰å…¨æ£€æŸ¥å’Œå‡†å¤‡å·¥ä½œï¼Œç¡®ä¿ç±»çš„åˆæ³•æ€§ä¸å®‰å…¨æ€§ã€‚å®ƒé€šå¸¸ç”¨äºè‡ªå®šä¹‰ç±»åŠ è½½å™¨ä¸­ï¼Œä»¥å¢å¼ºç±»åŠ è½½è¿‡ç¨‹ä¸­çš„å®‰å…¨æ§åˆ¶ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>æ–¹æ³•ä½œç”¨è¯¦è§£ï¼š</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">1.é˜²æ­¢å®šä¹‰éæ³•ç±»åçš„ç±»ï¼ˆå¦‚ java.* åŒ…ä¸‹çš„ç±»ï¼‰ï¼š\n<ul class=\"lvl-4\">\n<li class=\"lvl-6\">å¦‚æœå°è¯•åŠ è½½çš„ç±»å±äº java. å¼€å¤´çš„æ ‡å‡†åŒ…ï¼ˆå¦‚ java.lang, java.util ç­‰ï¼‰ï¼Œä¼šæŠ›å‡º SecurityExceptionã€‚</li>\n<li class=\"lvl-6\">è¿™æ˜¯ä¸ºäº†é˜²æ­¢ç”¨æˆ·è‡ªå®šä¹‰ç±»ä¼ªè£…æˆ Java æ ¸å¿ƒç±»åº“ä¸­çš„ç±»ï¼Œä»è€Œé€ æˆå®‰å…¨é£é™©ã€‚</li>\n</ul>\n</li>\n<li class=\"lvl-4\">2.æ ¡éªŒç±»ååˆæ³•æ€§ï¼š\n<ul class=\"lvl-4\">\n<li class=\"lvl-6\">è°ƒç”¨ checkName(name) æ£€æŸ¥ç±»åæ˜¯å¦åˆæ³•ï¼ˆä¾‹å¦‚ä¸èƒ½åŒ…å« /ã€éæ³•å­—ç¬¦ç­‰ï¼‰ï¼Œè‹¥ä¸åˆæ³•åˆ™æŠ›å‡º NoClassDefFoundErrorã€‚</li>\n</ul>\n</li>\n<li class=\"lvl-4\">3.è¯ä¹¦ä¸€è‡´æ€§æ ¡éªŒï¼ˆç­¾åä¸€è‡´æ€§æ ¡éªŒï¼‰ï¼š\n<ul class=\"lvl-4\">\n<li class=\"lvl-6\">å¦‚æœç±»æœ‰åç§°ä¸”æä¾›äº† ProtectionDomainï¼Œä¼šè°ƒç”¨ checkCerts(name, codeSource) æ¥ç¡®ä¿å½“å‰ç±»çš„ç­¾åä¸å…¶æ‰€åœ¨åŒ…ä¸­å…¶ä»–ç±»çš„ç­¾åä¸€è‡´ã€‚</li>\n<li class=\"lvl-6\">é˜²æ­¢åŒä¸€åŒ…ä¸­æ··å…¥ä¸åŒç­¾åçš„ç±»ï¼Œé¿å…æ½œåœ¨çš„æ¶æ„ç¯¡æ”¹ã€‚</li>\n</ul>\n</li>\n<li class=\"lvl-4\">4.è®¾ç½®é»˜è®¤ä¿æŠ¤åŸŸï¼ˆProtectionDomainï¼‰ï¼š\n<ul class=\"lvl-4\">\n<li class=\"lvl-6\">å¦‚æœä¼ å…¥çš„ ProtectionDomain ä¸º nullï¼Œåˆ™ä½¿ç”¨ç±»åŠ è½½å™¨çš„é»˜è®¤åŸŸ defaultDomainã€‚</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"Linkingé“¾æ¥è¿‡ç¨‹\">Linkingé“¾æ¥è¿‡ç¨‹</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åœ¨ClassLoaderçš„<code>loadClass</code>â½…æ³•ä¸­ï¼Œè¿˜æœ‰â¼€ä¸ªä¸èµ·çœ¼çš„æ­¥éª¤ï¼Œ<code>resolveClass</code>ã€‚è¿™æ˜¯â¼€ä¸ª<code>native</code>â½…æ³•ã€‚â½½å…¶å®ç°çš„è¿‡ç¨‹ç§°ä¸º<code>linking-é“¾æ¥</code>ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>é“¾æ¥è¿‡ç¨‹çš„å®ç°åŠŸèƒ½å¦‚ä¸‹å›¾ï¼š<br>\n<img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/uPic/9vkhLN.png\" alt=\"\" width=\"900\" height=\"500\"></p>\n</li>\n<li class=\"lvl-2\">\n<p>å…¶ä¸­å…³äºåŠåˆå§‹åŒ–çŠ¶æ€å°±æ˜¯JDKåœ¨å¤„ç†â¼€ä¸ªç±»çš„staticé™æ€å±æ€§æ—¶ï¼Œä¼šå…ˆç»™è¿™ä¸ªå±æ€§åˆ†é…â¼€ä¸ªé»˜è®¤å€¼ï¼Œä½œâ½¤æ˜¯å ä½å†…å­˜ã€‚ç„¶åç­‰è¿æ¥è¿‡ç¨‹å®Œæˆåï¼Œåœ¨åâ¾¯çš„åˆå§‹åŒ–é˜¶æ®µï¼Œå†å°†é™æ€å±æ€§ä»é»˜è®¤å€¼ä¿®æ”¹ä¸ºæŒ‡å®šçš„åˆå§‹å€¼ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ç¬¦å·å¼•â½¤å’Œç›´æ¥å¼•â½¤</p>\n</li>\n</ul>\n<blockquote>\n<p>å¦‚æœAç±»ä¸­æœ‰â¼€ä¸ªé™æ€å±æ€§ï¼Œå¼•â½¤äº†å¦â¼€ä¸ªBç±»ã€‚é‚£ä¹ˆåœ¨å¯¹ç±»è¿›â¾åˆå§‹åŒ–çš„è¿‡ç¨‹ä¸­ï¼Œå› ä¸ºAå’ŒBè¿™ä¸¤ä¸ªç±»éƒ½æ²¡æœ‰åˆå§‹åŒ–ï¼ŒJVMå¹¶ä¸çŸ¥é“Aå’ŒBè¿™ä¸¤ä¸ªç±»çš„å…·ä½“åœ°å€ã€‚æ‰€ä»¥è¿™æ—¶ï¼Œåœ¨Aç±»ä¸­ï¼Œåªèƒ½åˆ›å»ºâ¼€ä¸ªä¸çŸ¥é“å…·ä½“åœ°å€çš„å¼•â½¤ï¼ŒæŒ‡å‘Bç±»ã€‚è¿™ä¸ªå¼•â½¤å°±ç§°ä¸ºç¬¦å·å¼•â½¤ã€‚â½½å½“Aç±»å’ŒBç±»éƒ½å®Œæˆåˆå§‹åŒ–åï¼ŒJVMâ¾ƒç„¶å°±éœ€è¦å°†è¿™ä¸ªç¬¦å·å¼•â½¤è½¬â½½æŒ‡å‘Bç±»å…·ä½“çš„å†…å­˜åœ°å€ï¼Œè¿™ä¸ªå¼•â½¤å°±ç§°ä¸ºç›´æ¥å¼•â½¤ã€‚</p>\n</blockquote>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ¥çœ‹ä¸€ä¸ªæœ‰æ„æ€çš„ç¤ºä¾‹</p>\n</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Apple</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// é™æ€å˜é‡æŒ‰å£°æ˜é¡ºåºåˆå§‹åŒ–</span></span><br><span class=\"line\">    <span class=\"comment\">// æ„é€ æ–¹æ³•åˆå§‹åŒ–appleå¯¹è±¡æ—¶ï¼Œpriceè¿˜æ²¡æœ‰è¢«åˆå§‹åŒ–ï¼Œå¤„äºé“¾æ¥è¿‡ç¨‹ä¸­çš„å‡†å¤‡é˜¶æ®µï¼Œå³åŠåˆå§‹åŒ–çŠ¶æ€ï¼Œæ‰€ä»¥priceä¸ºé»˜è®¤å€¼0.0</span></span><br><span class=\"line\">    <span class=\"keyword\">static</span> <span class=\"type\">Apple</span> <span class=\"variable\">apple</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Apple</span>(<span class=\"number\">10</span>);</span><br><span class=\"line\">    <span class=\"comment\">// è§£å†³æ–¹æ³•æ˜¯å°†priceå£°æ˜åœ¨appleçš„ä¸Šé¢å³å¯</span></span><br><span class=\"line\">    <span class=\"keyword\">static</span> <span class=\"type\">double</span> <span class=\"variable\">price</span> <span class=\"operator\">=</span> <span class=\"number\">20.00</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"type\">double</span> totalpay;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">Apple</span><span class=\"params\">(<span class=\"type\">double</span> discount)</span> &#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;====&quot;</span> + price);</span><br><span class=\"line\">        totalpay = price - discount;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">PriceTest</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> &#123;</span><br><span class=\"line\">        System.out.println(Apple.apple.totalpay); <span class=\"comment\">// -10.0</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¿™é‡Œæœ‰ä¸€ä¸ªæœ‰æ„æ€çš„é—®é¢˜ï¼Œå°±æ˜¯åªæœ‰å½“<code>loadClass</code>æ–¹æ³•ä¸­çš„<code>resolve</code>å‚æ•°ä¸º<code>true</code>æ—¶<code>resolveClass</code>æ–¹æ³•æ‰ä¼šè¢«è°ƒç”¨ï¼Œä½†æ˜¯å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œ<code>resolve</code>å‚æ•°éƒ½æ˜¯<code>false</code>ï¼Œè¿™ä¸æ˜¯å¼ºåˆ¶é™åˆ¶è€Œæ˜¯å‡ºäºä»¥ä¸‹åŸå› ï¼š</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">\n<ol>\n<li class=\"lvl-7\">é¿å…é€’å½’è§£æä¸­å‡ºç°é”™è¯¯æˆ–æ­»å¾ªç¯<br>\nåœ¨ç±»çš„è§£æè¿‡ç¨‹ä¸­ï¼Œå¦‚æœè¯¥ç±»å¼•ç”¨äº†å¦ä¸€ä¸ªè¿˜æ²¡åŠ è½½çš„ç±»ï¼Œç«‹å³è§£æå¯èƒ½ä¼šå¯¼è‡´æ— é™é€’å½’æˆ–åŠ è½½é¡ºåºé—®é¢˜ã€‚é€šè¿‡å»¶è¿Ÿè§£æï¼Œå¯ä»¥æ›´å¥½åœ°æ§åˆ¶åŠ è½½æµç¨‹ã€‚</li>\n</ol>\n</li>\n<li class=\"lvl-4\">\n<ol start=\"2\">\n<li class=\"lvl-7\">æé«˜åŠ è½½æ•ˆç‡<br>\nåŠ è½½ç±»å¯èƒ½ä¸ä¸€å®šé©¬ä¸Šå°±ç”¨åˆ°æ‰€æœ‰æ–¹æ³•ã€å­—æ®µç­‰ç¬¦å·å¼•ç”¨ï¼Œæ¨è¿Ÿè§£æå¯ä»¥æé«˜æ€§èƒ½ï¼Œå°¤å…¶åœ¨æ‰¹é‡åŠ è½½å¾ˆå¤šç±»æ—¶ã€‚</li>\n</ol>\n</li>\n<li class=\"lvl-4\">\n<ol start=\"3\">\n<li class=\"lvl-7\">æ›´çµæ´»åœ°å¤„ç†ç±»çš„ä¾èµ–<br>\nå¼€å‘è€…å¯ä»¥å…ˆåŠ è½½ç±»ï¼Œç¨åæ ¹æ®éœ€è¦å†è§£æã€‚ä¾‹å¦‚ï¼Œåœ¨è‡ªå®šä¹‰ç±»åŠ è½½å™¨ä¸­ï¼Œå¯èƒ½å…ˆåˆ¤æ–­ç±»æ˜¯å¦å·²ç»å­˜åœ¨ã€æ˜¯å¦éœ€è¦è¢«å¢å¼ºï¼ˆæ¯”å¦‚å­—èŠ‚ç å¢å¼ºï¼‰ï¼Œå†å†³å®šæ˜¯å¦è§£æã€‚</li>\n</ol>\n</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"é€šè¿‡ç±»åŠ è½½å™¨å¼•â¼Šå¤–éƒ¨JaråŒ…\">é€šè¿‡ç±»åŠ è½½å™¨å¼•â¼Šå¤–éƒ¨JaråŒ…</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è™½ç„¶é€šå¸¸æˆ‘ä»¬ä¼šå°†ä¾èµ–çš„ jar åŒ…ç›´æ¥æ”¾å…¥é¡¹ç›®çš„ classpath ä¸­ï¼ˆæ¯”å¦‚é€šè¿‡æ„å»ºå·¥å…·å¦‚ Maven æˆ– Gradle ç®¡ç†ï¼‰ï¼Œä½†åœ¨æŸäº›ç‰¹å®šåœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬ç¡®å®éœ€è¦åŠ¨æ€åœ°é€šè¿‡ URLClassLoader åŠ è½½å¤–éƒ¨ jar åŒ…ï¼Œè¿™æ˜¯ Java æä¾›çš„ä¸€ç§æ›´çµæ´»çš„ç±»åŠ è½½æœºåˆ¶ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä»¥ä¸‹æ˜¯ä¸€äº›å¿…é¡»æˆ–æ¨èä½¿ç”¨ URLClassLoader çš„å…¸å‹åº”ç”¨åœºæ™¯ï¼š</p>\n</li>\n</ul>\n<h3 id=\"1-æ’ä»¶æœºåˆ¶ï¼ˆPlugin-Systemï¼‰\">1. æ’ä»¶æœºåˆ¶ï¼ˆPlugin Systemï¼‰</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åœºæ™¯è¯´æ˜ï¼š<br>\nç³»ç»Ÿæ”¯æŒç”¨æˆ·è‡ªå®šä¹‰æ’ä»¶ï¼ˆå¦‚ IDE æ’ä»¶ã€æµè§ˆå™¨æ‰©å±•ã€æ¸¸æˆ modï¼‰ï¼Œè¿™äº›æ’ä»¶åœ¨è¿è¡Œæ—¶æ‰åŠ è½½ï¼Œé¡¹ç›®æœ¬èº«åœ¨ç¼–è¯‘æœŸå¹¶ä¸çŸ¥é“æœ‰å“ªäº›æ’ä»¶ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä¸¾ä¾‹ï¼š<br>\nEclipse æˆ– IntelliJ çš„æ’ä»¶ç³»ç»Ÿ<br>\nMinecraft çš„ mod åŠ è½½å™¨<br>\nSpring Boot Devtools é‡æ–°åŠ è½½æœºåˆ¶</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä¸ºä»€ä¹ˆä¸èƒ½ç›´æ¥æ”¾å…¥ classpathï¼Ÿ<br>\nå› ä¸ºæ’ä»¶æ˜¯åŠ¨æ€å‘ç°å’ŒåŠ è½½çš„ï¼Œä¸æ˜¯ç¼–è¯‘æ—¶ç¡®å®šçš„ã€‚</p>\n</li>\n</ul>\n<h3 id=\"2-çƒ­éƒ¨ç½²-åŠ¨æ€åŠ è½½ç±»\">2. çƒ­éƒ¨ç½² / åŠ¨æ€åŠ è½½ç±»</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åœºæ™¯è¯´æ˜ï¼š<br>\nä½ æƒ³åœ¨åº”ç”¨è¿è¡Œè¿‡ç¨‹ä¸­åŠ è½½æ–°çš„ jar æˆ–ç±»ï¼Œæ¯”å¦‚çƒ­æ›´æ–°ä¸€ä¸ªæ¨¡å—è€Œæ— éœ€é‡å¯æœåŠ¡ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä¸¾ä¾‹ï¼š<br>\nWeb å®¹å™¨ï¼ˆå¦‚ Tomcatï¼‰çš„åº”ç”¨é‡æ–°éƒ¨ç½²<br>\nä½¿ç”¨ URLClassLoader åŠ è½½æŸä¸ªæ¨¡å—çš„æ–°ç‰ˆæœ¬ä»¥å®ç°çƒ­æ›¿æ¢</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä¸ºä»€ä¹ˆä¸èƒ½æ”¾å…¥ classpathï¼Ÿ<br>\nclasspath åœ¨å¯åŠ¨æ—¶å°±å›ºå®šäº†ï¼Œä¸èƒ½åŠ¨æ€æ·»åŠ ï¼›è€Œ URLClassLoader å¯ä»¥è¿è¡Œæ—¶åŠ è½½æ–° jarã€‚</p>\n</li>\n</ul>\n<h3 id=\"3-å¤šç‰ˆæœ¬éš”ç¦»\">3. å¤šç‰ˆæœ¬éš”ç¦»</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åœºæ™¯è¯´æ˜ï¼š<br>\nä½ å¸Œæœ›ä¸åŒçš„æ¨¡å—ä½¿ç”¨åŒä¸€ä¸ªåº“çš„ä¸åŒç‰ˆæœ¬ï¼Œä½† classpath æ— æ³•æ”¯æŒä¸¤ä¸ªç‰ˆæœ¬çš„åŒä¸€ä¸ªç±»ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä¸¾ä¾‹ï¼š<br>\nä¸€ä¸ªæœåŠ¡å™¨è¿è¡Œå¤šä¸ªæœåŠ¡å®ä¾‹ï¼Œå®ƒä»¬åˆ†åˆ«ä¾èµ– log4j çš„ä¸åŒç‰ˆæœ¬<br>\nä¸€ä¸ªç³»ç»Ÿçš„æ’ä»¶ A ä½¿ç”¨ fastjson 1.xï¼Œæ’ä»¶ B ä½¿ç”¨ fastjson 2.x</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä¸ºä»€ä¹ˆä¸èƒ½æ”¾å…¥ classpathï¼Ÿ<br>\nclasspath æ˜¯å…±äº«çš„ï¼Œä¼šå‘ç”Ÿç±»å†²çªã€‚ä½¿ç”¨å¤šä¸ª URLClassLoaderï¼Œå¯å®ç°ç±»éš”ç¦»ã€‚</p>\n</li>\n</ul>\n<h3 id=\"4-è„šæœ¬æˆ–ç”¨æˆ·ä¸Šä¼ ä»£ç æ‰§è¡Œ\">4. è„šæœ¬æˆ–ç”¨æˆ·ä¸Šä¼ ä»£ç æ‰§è¡Œ</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åœºæ™¯è¯´æ˜ï¼š<br>\nç³»ç»Ÿå…è®¸ç”¨æˆ·ä¸Šä¼  jar æˆ– class æ–‡ä»¶ï¼Œç„¶ååœ¨æœåŠ¡ç«¯æ‰§è¡Œå…¶ä¸­çš„ç±»é€»è¾‘ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä¸¾ä¾‹ï¼š<br>\nåœ¨çº¿ç¼–ç¨‹å¹³å°ï¼ˆå¦‚ LeetCode åç«¯ï¼‰<br>\nç”¨æˆ·ä¸Šä¼ ç®—æ³• jarï¼Œå¹³å°è¿è¡Œå¹¶è¿”å›ç»“æœ</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä¸ºä»€ä¹ˆä¸èƒ½æ”¾å…¥ classpathï¼Ÿ<br>\nç”¨æˆ·ä¸Šä¼ å†…å®¹æ˜¯åŠ¨æ€çš„ï¼Œç³»ç»Ÿåœ¨è¿è¡Œå‰æ— æ³•é¢„çŸ¥ã€‚</p>\n</li>\n</ul>\n<h3 id=\"5-å®ç°ç±»çš„å»¶è¿ŸåŠ è½½ï¼ˆèŠ‚çœèµ„æºï¼‰\">5. å®ç°ç±»çš„å»¶è¿ŸåŠ è½½ï¼ˆèŠ‚çœèµ„æºï¼‰</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åœºæ™¯è¯´æ˜ï¼š<br>\næŸäº›ç±»/æ¨¡å—ä½“ç§¯è¾ƒå¤§æˆ–ä¾èµ–è¾ƒå¤šï¼Œä¸å¸Œæœ›åœ¨ç¨‹åºå¯åŠ¨æ—¶å°±åŠ è½½ï¼Œåªæœ‰çœŸæ­£ä½¿ç”¨æ—¶å†åŠ è½½ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä¸¾ä¾‹ï¼š<br>\nå¤§å‹æ¡Œé¢åº”ç”¨ï¼ˆå¦‚ IntelliJï¼‰åœ¨æ‰“å¼€æŸä¸ªåŠŸèƒ½æ¨¡å—æ—¶æ‰åŠ è½½ç›¸åº” jar</p>\n</li>\n</ul>\n<h3 id=\"æ€»ç»“\">æ€»ç»“</h3>\n<table>\n<thead>\n<tr>\n<th>åœºæ™¯</th>\n<th>ä½¿ç”¨ <code>URLClassLoader</code> çš„åŸå› </th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>æ’ä»¶ç³»ç»Ÿ</td>\n<td>æ’ä»¶åŠ¨æ€åŠ è½½ï¼Œä¸åœ¨é¡¹ç›®ç¼–è¯‘æ—¶å¯çŸ¥</td>\n</tr>\n<tr>\n<td>çƒ­éƒ¨ç½²</td>\n<td>åŠ¨æ€æ›¿æ¢æ¨¡å—ï¼Œæ— éœ€é‡å¯</td>\n</tr>\n<tr>\n<td>å¤šç‰ˆæœ¬å…±å­˜</td>\n<td>é¿å…ç±»å†²çªï¼Œå®ç°ç±»åŠ è½½éš”ç¦»</td>\n</tr>\n<tr>\n<td>ç”¨æˆ·ä¸Šä¼  jar</td>\n<td>å†…å®¹åŠ¨æ€ç”Ÿæˆï¼Œclasspath æ— æ³•é¢„å…ˆé…ç½®</td>\n</tr>\n<tr>\n<td>å»¶è¿ŸåŠ è½½æ¨¡å—</td>\n<td>å¯åŠ¨æ›´å¿«ï¼ŒèŠ‚çœå†…å­˜</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¦‚æœä½ æ˜¯åœ¨åšæ¡†æ¶è®¾è®¡æˆ–éœ€è¦åŠ¨æ€æ‰©å±•èƒ½åŠ›çš„åœºæ™¯ï¼Œç†è§£å¹¶ä½¿ç”¨ URLClassLoader ä¼šéå¸¸æœ‰å¸®åŠ©ã€‚</p>\n</li>\n</ul>\n<h3 id=\"åœºæ™¯å‡è®¾\">åœºæ™¯å‡è®¾</h3>\n<h4 id=\"è°ƒç”¨å¤–éƒ¨jar\">è°ƒç”¨å¤–éƒ¨jar</h4>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æˆ‘ä»¬æœ‰ä¸€ä¸ªå¤–éƒ¨ jar æ–‡ä»¶ï¼šhello-plugin.jarï¼Œå®ƒåŒ…å«ä¸€ä¸ªç±»ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// è¿™ä¸ªç±»ç¼–è¯‘åæ‰“åŒ…è¿› hello-plugin.jar</span></span><br><span class=\"line\"><span class=\"keyword\">package</span> com.example.plugin;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">HelloPlugin</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">sayHello</span><span class=\"params\">(String name)</span> &#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;Hello from plugin! :&quot;</span> + name);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¸»ç¨‹åºä½¿ç”¨ URLClassLoader åŠ¨æ€åŠ è½½è¿™ä¸ª jar</p>\n</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> java.io.File;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.lang.reflect.Method;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.net.URL;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.net.URLClassLoader;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">PluginLoader</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> Exception &#123;</span><br><span class=\"line\">        <span class=\"comment\">// å¤–éƒ¨ jar çš„è·¯å¾„</span></span><br><span class=\"line\">        <span class=\"type\">File</span> <span class=\"variable\">jarFile</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">File</span>(<span class=\"string\">&quot;plugins/hello-plugin.jar&quot;</span>);</span><br><span class=\"line\">        <span class=\"type\">URL</span> <span class=\"variable\">jarUrl</span> <span class=\"operator\">=</span> jarFile.toURI().toURL();</span><br><span class=\"line\">        <span class=\"comment\">// HTTPS jar çš„ URL</span></span><br><span class=\"line\">        <span class=\"comment\">// URL jarUrl = new URL(&quot;https://your-domain.com/libs/hello-plugin.jar&quot;);</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// æ„å»º URLClassLoaderï¼ˆä¹Ÿå¯ä»¥è®¾ç½®çˆ¶åŠ è½½å™¨ï¼‰</span></span><br><span class=\"line\">        <span class=\"type\">URLClassLoader</span> <span class=\"variable\">classLoader</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">URLClassLoader</span>(<span class=\"keyword\">new</span> <span class=\"title class_\">URL</span>[]&#123;jarUrl&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// åŠ è½½æ’ä»¶ç±»</span></span><br><span class=\"line\">        Class&lt;?&gt; clazz = classLoader.loadClass(<span class=\"string\">&quot;com.example.plugin.HelloPlugin&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// åˆ›å»ºå®ä¾‹å¹¶è°ƒç”¨æ–¹æ³•</span></span><br><span class=\"line\">        <span class=\"type\">Object</span> <span class=\"variable\">plugin</span> <span class=\"operator\">=</span> clazz.getDeclaredConstructor().newInstance();</span><br><span class=\"line\">        <span class=\"type\">Method</span> <span class=\"variable\">sayHello</span> <span class=\"operator\">=</span> clazz.getMethod(<span class=\"string\">&quot;sayHello&quot;</span>, String.class);</span><br><span class=\"line\">        sayHello.invoke(plugin, <span class=\"string\">&quot;World&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// å…³é—­ ClassLoaderï¼ˆJava 7+ æ¨èï¼‰</span></span><br><span class=\"line\">        classLoader.close();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"è¿è¡Œæ—¶åŠ¨æ€ç¼–è¯‘-Java-æºä»£ç \">è¿è¡Œæ—¶åŠ¨æ€ç¼–è¯‘ Java æºä»£ç </h4>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æˆ‘ä»¬æœ‰ä¸€ä¸ª java ä»£ç ç‰‡æ®µï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> javax.tools.JavaCompiler;</span><br><span class=\"line\"><span class=\"keyword\">import</span> javax.tools.ToolProvider;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.File;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.FileWriter;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.lang.reflect.Method;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.net.URL;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.net.URLClassLoader;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.nio.file.Files;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.nio.file.Path;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">DynamicJavaRunner</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> Exception &#123;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">className</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;com.example.dynamic.Hello&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// Java æºä»£ç </span></span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">sourceCode</span> <span class=\"operator\">=</span></span><br><span class=\"line\">                <span class=\"string\">&quot;package com.example.dynamic;\\n&quot;</span> +</span><br><span class=\"line\">                        <span class=\"string\">&quot;\\n&quot;</span> +</span><br><span class=\"line\">                        <span class=\"string\">&quot;public class Hello &#123;\\n&quot;</span> +</span><br><span class=\"line\">                        <span class=\"string\">&quot;    public void say() &#123;\\n&quot;</span> +</span><br><span class=\"line\">                        <span class=\"string\">&quot;        System.out.println(\\&quot;Hello from dynamic source!\\&quot;);\\n&quot;</span> +</span><br><span class=\"line\">                        <span class=\"string\">&quot;    &#125;\\n&quot;</span> +</span><br><span class=\"line\">                        <span class=\"string\">&quot;&#125;\\n&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// åˆ›å»ºä¸´æ—¶ç›®å½•</span></span><br><span class=\"line\">        <span class=\"type\">Path</span> <span class=\"variable\">tempDir</span> <span class=\"operator\">=</span> Files.createTempDirectory(<span class=\"string\">&quot;dynamic-classes&quot;</span>);</span><br><span class=\"line\">        <span class=\"type\">File</span> <span class=\"variable\">outputDir</span> <span class=\"operator\">=</span> tempDir.toFile();</span><br><span class=\"line\">        <span class=\"comment\">// System.out.println(&quot;ä¸´æ—¶ç›®å½•ï¼š&quot; + outputDir.getAbsolutePath());</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// åˆ›å»º .java æ–‡ä»¶</span></span><br><span class=\"line\">        <span class=\"type\">File</span> <span class=\"variable\">javaFile</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">File</span>(outputDir, <span class=\"string\">&quot;com/example/dynamic/Hello.java&quot;</span>);</span><br><span class=\"line\">        javaFile.getParentFile().mkdirs();</span><br><span class=\"line\">        <span class=\"keyword\">try</span> (<span class=\"type\">FileWriter</span> <span class=\"variable\">writer</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">FileWriter</span>(javaFile)) &#123;</span><br><span class=\"line\">            writer.write(sourceCode);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// ç¼–è¯‘ Java æ–‡ä»¶</span></span><br><span class=\"line\">        <span class=\"type\">JavaCompiler</span> <span class=\"variable\">compiler</span> <span class=\"operator\">=</span> ToolProvider.getSystemJavaCompiler();</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (compiler == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">            System.err.println(<span class=\"string\">&quot;è¯·ç”¨ JDK è€Œé JRE è¿è¡Œï¼&quot;</span>);</span><br><span class=\"line\">            <span class=\"keyword\">return</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"type\">int</span> <span class=\"variable\">result</span> <span class=\"operator\">=</span> compiler.run(<span class=\"literal\">null</span>, <span class=\"literal\">null</span>, <span class=\"literal\">null</span>, javaFile.getPath());</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (result != <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">            System.err.println(<span class=\"string\">&quot;ç¼–è¯‘å¤±è´¥ï¼&quot;</span>);</span><br><span class=\"line\">            <span class=\"keyword\">return</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// åŠ è½½ç±»å¹¶è°ƒç”¨</span></span><br><span class=\"line\">        <span class=\"type\">URLClassLoader</span> <span class=\"variable\">classLoader</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">URLClassLoader</span>(<span class=\"keyword\">new</span> <span class=\"title class_\">URL</span>[]&#123;outputDir.toURI().toURL()&#125;);</span><br><span class=\"line\">        Class&lt;?&gt; clazz = classLoader.loadClass(className);</span><br><span class=\"line\">        <span class=\"type\">Object</span> <span class=\"variable\">instance</span> <span class=\"operator\">=</span> clazz.getDeclaredConstructor().newInstance();</span><br><span class=\"line\">        <span class=\"type\">Method</span> <span class=\"variable\">method</span> <span class=\"operator\">=</span> clazz.getMethod(<span class=\"string\">&quot;say&quot;</span>);</span><br><span class=\"line\">        method.invoke(instance);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// æ¸…ç†ï¼ˆå¯é€‰ï¼‰</span></span><br><span class=\"line\">        classLoader.close();</span><br><span class=\"line\">        <span class=\"comment\">// åˆ é™¤ä¸´æ—¶ç›®å½•</span></span><br><span class=\"line\">        Files.walk(outputDir.toPath())</span><br><span class=\"line\">                .sorted(Comparator.reverseOrder()) <span class=\"comment\">// å…ˆåˆ æ–‡ä»¶ï¼Œå†åˆ ç›®å½•</span></span><br><span class=\"line\">                .map(Path::toFile)</span><br><span class=\"line\">                .forEach(File::delete);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å…³é”®ç‚¹è¯´æ˜</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>æœºåˆ¶</th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>JavaCompiler</code></td>\n<td>JDK è‡ªå¸¦çš„ç¼–è¯‘å™¨ï¼ˆ<code>tools.jar</code>ï¼‰</td>\n</tr>\n<tr>\n<td><code>ToolProvider.getSystemJavaCompiler()</code></td>\n<td>åªèƒ½åœ¨ JDK ç¯å¢ƒä¸­å·¥ä½œï¼ŒJRE æ— æ³•ä½¿ç”¨</td>\n</tr>\n<tr>\n<td><code>URLClassLoader</code></td>\n<td>ç”¨äºåŠ è½½ç¼–è¯‘åçš„ .class æ–‡ä»¶</td>\n</tr>\n<tr>\n<td><code>FileWriter</code></td>\n<td>ä¿å­˜ä»£ç ä¸ºä¸´æ—¶ Java æ–‡ä»¶</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"è‡ªå®šä¹‰ç±»åŠ è½½å™¨\">è‡ªå®šä¹‰ç±»åŠ è½½å™¨</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¦è‡ªå®šä¹‰ ClassLoaderï¼Œåªéœ€è¦ç»§æ‰¿äº <code>ClassLoader</code> æˆ–è€… <code>SecureClassLoader</code>ï¼Œå¹¶é‡å†™ <code>findClass()</code> æ–¹æ³•å³å¯</p>\n</li>\n<li class=\"lvl-2\">\n<p>ç¤ºä¾‹ï¼šæˆ‘ä»¬å¯¹ä¸Šé¢çš„ä»£ç è¿›è¡Œå‡çº§ï¼Œä¸åˆ›å»ºä¸´æ—¶æ–‡ä»¶ï¼Œè€Œæ˜¯åœ¨å†…å­˜ä¸­ç¼–è¯‘ä»£ç ï¼Œå¹¶ä»å†…å­˜ä¸­åŠ è½½å­—èŠ‚ç ï¼Œè€Œä¸ä¾èµ–ç£ç›˜æ–‡ä»¶ï¼Œæ›´é«˜æ•ˆä¹Ÿæ›´é€‚åˆç”Ÿäº§ç¯å¢ƒä¸­åŠ¨æ€ç±»åŠ è½½ï¼ˆå¦‚åœ¨çº¿ä»£ç æ‰§è¡Œã€è„šæœ¬å¼•æ“ç­‰ï¼‰ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> javax.tools.*;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.*;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.net.URI;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.*;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.lang.reflect.*;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">InMemoryJavaRunner</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> Exception &#123;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">className</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;com.example.dynamic.Hello&quot;</span>;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">sourceCode</span> <span class=\"operator\">=</span></span><br><span class=\"line\">                <span class=\"string\">&quot;package com.example.dynamic;\\n&quot;</span> +</span><br><span class=\"line\">                        <span class=\"string\">&quot;public class Hello &#123;\\n&quot;</span> +</span><br><span class=\"line\">                        <span class=\"string\">&quot;    public void say() &#123;\\n&quot;</span> +</span><br><span class=\"line\">                        <span class=\"string\">&quot;        System.out.println(\\&quot;Hello from memory compiled class!\\&quot;);\\n&quot;</span> +</span><br><span class=\"line\">                        <span class=\"string\">&quot;    &#125;\\n&quot;</span> +</span><br><span class=\"line\">                        <span class=\"string\">&quot;&#125;&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// è·å–ç³»ç»Ÿ Java ç¼–è¯‘å™¨</span></span><br><span class=\"line\">        <span class=\"type\">JavaCompiler</span> <span class=\"variable\">compiler</span> <span class=\"operator\">=</span> ToolProvider.getSystemJavaCompiler();</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (compiler == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">            System.err.println(<span class=\"string\">&quot;è¯·ä½¿ç”¨ JDK è¿è¡Œæ­¤ç¨‹åºï¼ˆé JREï¼‰&quot;</span>);</span><br><span class=\"line\">            <span class=\"keyword\">return</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// å‡†å¤‡ç¼–è¯‘æºä»£ç ï¼šä¸€ä¸ª JavaFileObject è¡¨ç¤ºæºä»£ç </span></span><br><span class=\"line\">        <span class=\"type\">JavaFileObject</span> <span class=\"variable\">sourceFile</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">JavaSourceFromString</span>(className, sourceCode);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// åˆ›å»ºè‡ªå®šä¹‰çš„å†…å­˜æ–‡ä»¶ç®¡ç†å™¨ï¼ˆæ›¿ä»£æ ‡å‡†çš„ç£ç›˜ç®¡ç†å™¨ï¼‰</span></span><br><span class=\"line\">        <span class=\"type\">StandardJavaFileManager</span> <span class=\"variable\">standardFileManager</span> <span class=\"operator\">=</span> compiler.getStandardFileManager(<span class=\"literal\">null</span>, <span class=\"literal\">null</span>, <span class=\"literal\">null</span>);</span><br><span class=\"line\">        <span class=\"type\">MemoryJavaFileManager</span> <span class=\"variable\">fileManager</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">MemoryJavaFileManager</span>(standardFileManager);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// æ‰§è¡Œç¼–è¯‘ä»»åŠ¡</span></span><br><span class=\"line\">        JavaCompiler.<span class=\"type\">CompilationTask</span> <span class=\"variable\">task</span> <span class=\"operator\">=</span> compiler.getTask(<span class=\"literal\">null</span>, fileManager, <span class=\"literal\">null</span>, <span class=\"literal\">null</span>, <span class=\"literal\">null</span>, Collections.singletonList(sourceFile));</span><br><span class=\"line\">        <span class=\"type\">boolean</span> <span class=\"variable\">success</span> <span class=\"operator\">=</span> task.call();</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!success) &#123;</span><br><span class=\"line\">            System.err.println(<span class=\"string\">&quot;ç¼–è¯‘å¤±è´¥ï¼&quot;</span>);</span><br><span class=\"line\">            <span class=\"keyword\">return</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// åŠ è½½ç¼–è¯‘åçš„ç±»</span></span><br><span class=\"line\">        Map&lt;String, <span class=\"type\">byte</span>[]&gt; classBytes = fileManager.getClassBytes();</span><br><span class=\"line\">        <span class=\"type\">InMemoryClassLoader</span> <span class=\"variable\">classLoader</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">InMemoryClassLoader</span>(classBytes);</span><br><span class=\"line\">        Class&lt;?&gt; clazz = classLoader.loadClass(className);</span><br><span class=\"line\">        <span class=\"type\">Object</span> <span class=\"variable\">instance</span> <span class=\"operator\">=</span> clazz.getDeclaredConstructor().newInstance();</span><br><span class=\"line\">        <span class=\"type\">Method</span> <span class=\"variable\">method</span> <span class=\"operator\">=</span> clazz.getMethod(<span class=\"string\">&quot;say&quot;</span>);</span><br><span class=\"line\">        method.invoke(instance);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// ç”¨äºè¡¨ç¤ºå†…å­˜ä¸­çš„ Java æºä»£ç </span></span><br><span class=\"line\">    <span class=\"keyword\">static</span> <span class=\"keyword\">class</span> <span class=\"title class_\">JavaSourceFromString</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">SimpleJavaFileObject</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">final</span> String code;</span><br><span class=\"line\"></span><br><span class=\"line\">        JavaSourceFromString(String className, String code) &#123;</span><br><span class=\"line\">            <span class=\"built_in\">super</span>(URI.create(<span class=\"string\">&quot;string:///&quot;</span> + className.replace(<span class=\"string\">&#x27;.&#x27;</span>, <span class=\"string\">&#x27;/&#x27;</span>) + Kind.SOURCE.extension), Kind.SOURCE);</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.code = code;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">public</span> CharSequence <span class=\"title function_\">getCharContent</span><span class=\"params\">(<span class=\"type\">boolean</span> ignoreEncodingErrors)</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> code;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// å°†ç¼–è¯‘çš„ class æ–‡ä»¶ä¿å­˜åœ¨å†…å­˜ä¸­ï¼ˆä¸æ˜¯æ–‡ä»¶ç³»ç»Ÿï¼‰</span></span><br><span class=\"line\">    <span class=\"keyword\">static</span> <span class=\"keyword\">class</span> <span class=\"title class_\">MemoryJavaFileManager</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">ForwardingJavaFileManager</span>&lt;StandardJavaFileManager&gt; &#123;</span><br><span class=\"line\">        <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> Map&lt;String, ByteArrayOutputStream&gt; classOutputBuffers = <span class=\"keyword\">new</span> <span class=\"title class_\">HashMap</span>&lt;&gt;();</span><br><span class=\"line\"></span><br><span class=\"line\">        MemoryJavaFileManager(StandardJavaFileManager standardManager) &#123;</span><br><span class=\"line\">            <span class=\"built_in\">super</span>(standardManager);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"keyword\">public</span> JavaFileObject <span class=\"title function_\">getJavaFileForOutput</span><span class=\"params\">(Location location, String className,</span></span><br><span class=\"line\"><span class=\"params\">                                                   JavaFileObject.Kind kind, FileObject sibling)</span> &#123;</span><br><span class=\"line\">            <span class=\"type\">ByteArrayOutputStream</span> <span class=\"variable\">outputStream</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ByteArrayOutputStream</span>();</span><br><span class=\"line\">            classOutputBuffers.put(className, outputStream);</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">SimpleJavaFileObject</span>(</span><br><span class=\"line\">                    URI.create(<span class=\"string\">&quot;mem:///&quot;</span> + className.replace(<span class=\"string\">&#x27;.&#x27;</span>, <span class=\"string\">&#x27;/&#x27;</span>) + kind.extension), kind) &#123;</span><br><span class=\"line\">                <span class=\"meta\">@Override</span></span><br><span class=\"line\">                <span class=\"keyword\">public</span> OutputStream <span class=\"title function_\">openOutputStream</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> outputStream;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">public</span> Map&lt;String, <span class=\"type\">byte</span>[]&gt; getClassBytes() &#123;</span><br><span class=\"line\">            Map&lt;String, <span class=\"type\">byte</span>[]&gt; result = <span class=\"keyword\">new</span> <span class=\"title class_\">HashMap</span>&lt;&gt;();</span><br><span class=\"line\">            <span class=\"keyword\">for</span> (Map.Entry&lt;String, ByteArrayOutputStream&gt; entry : classOutputBuffers.entrySet()) &#123;</span><br><span class=\"line\">                result.put(entry.getKey(), entry.getValue().toByteArray());</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> result;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// è‡ªå®šä¹‰ ClassLoaderï¼Œç”¨äºä»å†…å­˜ä¸­åŠ è½½å­—èŠ‚ç </span></span><br><span class=\"line\">    <span class=\"keyword\">static</span> <span class=\"keyword\">class</span> <span class=\"title class_\">InMemoryClassLoader</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">ClassLoader</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> Map&lt;String, <span class=\"type\">byte</span>[]&gt; classBytes;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"title function_\">InMemoryClassLoader</span><span class=\"params\">(Map&lt;String, <span class=\"type\">byte</span>[]&gt; classBytes)</span> &#123;</span><br><span class=\"line\">            <span class=\"built_in\">super</span>(ClassLoader.getSystemClassLoader());</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.classBytes = classBytes;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"keyword\">protected</span> Class&lt;?&gt; findClass(String name) <span class=\"keyword\">throws</span> ClassNotFoundException &#123;</span><br><span class=\"line\">            <span class=\"comment\">// ä»å†…å­˜ä¸­è·å–å­—èŠ‚ç </span></span><br><span class=\"line\">            <span class=\"type\">byte</span>[] bytes = classBytes.get(name);</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (bytes == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"built_in\">super</span>.findClass(name);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"comment\">// å®šä¹‰ç±»å¹¶è¿”å›ï¼Œä¸€å®šè¦ä½¿ç”¨ defineClass æ–¹æ³•</span></span><br><span class=\"line\">            <span class=\"keyword\">return</span> defineClass(name, bytes, <span class=\"number\">0</span>, bytes.length);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¿›ä¸€æ­¥å‡çº§ï¼šæˆ‘ä»¬ç°åœ¨å°†è¿™ä¸ªç³»ç»Ÿæ‰©å±•ä¸ºæ”¯æŒå¤šä¸ªç±»åŒæ—¶åŠ¨æ€ç¼–è¯‘ã€å†…å­˜åŠ è½½å¹¶æ‰§è¡Œã€‚è¿™å¯¹äºéœ€è¦å¤„ç†å¤šä¸ªç±»ï¼ˆä¾‹å¦‚æ¥å£ + å®ç°ã€å†…éƒ¨ä¾èµ–ç­‰ï¼‰éå¸¸å®ç”¨ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> javax.tools.*;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.*;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.net.URI;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.*;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.lang.reflect.*;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// ä¸»ç±»</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">MultiClassInMemoryCompiler</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> Exception &#123;</span><br><span class=\"line\">        <span class=\"comment\">// å‡†å¤‡å¤šä¸ªç±»çš„æºä»£ç </span></span><br><span class=\"line\">        Map&lt;String, String&gt; sources = <span class=\"keyword\">new</span> <span class=\"title class_\">HashMap</span>&lt;&gt;();</span><br><span class=\"line\">        sources.put(<span class=\"string\">&quot;com.example.api.Greeter&quot;</span>,</span><br><span class=\"line\">                <span class=\"string\">&quot;package com.example.api;\\n&quot;</span> +</span><br><span class=\"line\">                        <span class=\"string\">&quot;public interface Greeter &#123;\\n&quot;</span> +</span><br><span class=\"line\">                        <span class=\"string\">&quot;    void greet();\\n&quot;</span> +</span><br><span class=\"line\">                        <span class=\"string\">&quot;&#125;\\n&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        sources.put(<span class=\"string\">&quot;com.example.impl.EnglishGreeter&quot;</span>,</span><br><span class=\"line\">                <span class=\"string\">&quot;package com.example.impl;\\n&quot;</span> +</span><br><span class=\"line\">                        <span class=\"string\">&quot;import com.example.api.Greeter;\\n&quot;</span> +</span><br><span class=\"line\">                        <span class=\"string\">&quot;public class EnglishGreeter implements Greeter &#123;\\n&quot;</span> +</span><br><span class=\"line\">                        <span class=\"string\">&quot;    public void greet() &#123;\\n&quot;</span> +</span><br><span class=\"line\">                        <span class=\"string\">&quot;        System.out.println(\\&quot;Hello from EnglishGreeter!\\&quot;);\\n&quot;</span> +</span><br><span class=\"line\">                        <span class=\"string\">&quot;    &#125;\\n&quot;</span> +</span><br><span class=\"line\">                        <span class=\"string\">&quot;&#125;\\n&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">entryClassName</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;com.example.impl.EnglishGreeter&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// ç¼–è¯‘</span></span><br><span class=\"line\">        Map&lt;String, <span class=\"type\">byte</span>[]&gt; compiledClasses = compile(sources);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (compiledClasses == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">            System.err.println(<span class=\"string\">&quot;ç¼–è¯‘å¤±è´¥&quot;</span>);</span><br><span class=\"line\">            <span class=\"keyword\">return</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// åŠ è½½å¹¶æ‰§è¡Œ</span></span><br><span class=\"line\">        <span class=\"type\">InMemoryClassLoader</span> <span class=\"variable\">classLoader</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">InMemoryClassLoader</span>(compiledClasses);</span><br><span class=\"line\">        Class&lt;?&gt; clazz = classLoader.loadClass(entryClassName);</span><br><span class=\"line\">        <span class=\"type\">Object</span> <span class=\"variable\">obj</span> <span class=\"operator\">=</span> clazz.getDeclaredConstructor().newInstance();</span><br><span class=\"line\">        <span class=\"type\">Method</span> <span class=\"variable\">method</span> <span class=\"operator\">=</span> clazz.getMethod(<span class=\"string\">&quot;greet&quot;</span>);</span><br><span class=\"line\">        method.invoke(obj);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// ç¼–è¯‘å™¨å…¥å£ï¼Œæ”¯æŒå¤šä¸ªç±»</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> Map&lt;String, <span class=\"type\">byte</span>[]&gt; compile(Map&lt;String, String&gt; sources) &#123;</span><br><span class=\"line\">        <span class=\"type\">JavaCompiler</span> <span class=\"variable\">compiler</span> <span class=\"operator\">=</span> ToolProvider.getSystemJavaCompiler();</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (compiler == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">            System.err.println(<span class=\"string\">&quot;è¯·ä½¿ç”¨ JDK è¿è¡Œ&quot;</span>);</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        List&lt;JavaFileObject&gt; compilationUnits = <span class=\"keyword\">new</span> <span class=\"title class_\">ArrayList</span>&lt;&gt;();</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (Map.Entry&lt;String, String&gt; entry : sources.entrySet()) &#123;</span><br><span class=\"line\">            compilationUnits.add(<span class=\"keyword\">new</span> <span class=\"title class_\">JavaSourceFromString</span>(entry.getKey(), entry.getValue()));</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">StandardJavaFileManager</span> <span class=\"variable\">stdManager</span> <span class=\"operator\">=</span> compiler.getStandardFileManager(<span class=\"literal\">null</span>, <span class=\"literal\">null</span>, <span class=\"literal\">null</span>);</span><br><span class=\"line\">        <span class=\"type\">MemoryJavaFileManager</span> <span class=\"variable\">memManager</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">MemoryJavaFileManager</span>(stdManager);</span><br><span class=\"line\"></span><br><span class=\"line\">        JavaCompiler.<span class=\"type\">CompilationTask</span> <span class=\"variable\">task</span> <span class=\"operator\">=</span> compiler.getTask(<span class=\"literal\">null</span>, memManager, <span class=\"literal\">null</span>, <span class=\"literal\">null</span>, <span class=\"literal\">null</span>, compilationUnits);</span><br><span class=\"line\">        <span class=\"type\">boolean</span> <span class=\"variable\">success</span> <span class=\"operator\">=</span> task.call();</span><br><span class=\"line\">        <span class=\"keyword\">return</span> success ? memManager.getClassBytes() : <span class=\"literal\">null</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// æºæ–‡ä»¶è¡¨ç¤ºï¼ˆJava ä»£ç ä»¥å­—ç¬¦ä¸²æä¾›ï¼‰</span></span><br><span class=\"line\">    <span class=\"keyword\">static</span> <span class=\"keyword\">class</span> <span class=\"title class_\">JavaSourceFromString</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">SimpleJavaFileObject</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">final</span> String code;</span><br><span class=\"line\"></span><br><span class=\"line\">        JavaSourceFromString(String className, String code) &#123;</span><br><span class=\"line\">            <span class=\"built_in\">super</span>(URI.create(<span class=\"string\">&quot;string:///&quot;</span> + className.replace(<span class=\"string\">&#x27;.&#x27;</span>, <span class=\"string\">&#x27;/&#x27;</span>) + Kind.SOURCE.extension), Kind.SOURCE);</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.code = code;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"keyword\">public</span> CharSequence <span class=\"title function_\">getCharContent</span><span class=\"params\">(<span class=\"type\">boolean</span> ignoreEncodingErrors)</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> code;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// å†…å­˜ä¸­çš„ç¼–è¯‘è¾“å‡ºç®¡ç†å™¨</span></span><br><span class=\"line\">    <span class=\"keyword\">static</span> <span class=\"keyword\">class</span> <span class=\"title class_\">MemoryJavaFileManager</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">ForwardingJavaFileManager</span>&lt;StandardJavaFileManager&gt; &#123;</span><br><span class=\"line\">        <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> Map&lt;String, ByteArrayOutputStream&gt; classOutputBuffers = <span class=\"keyword\">new</span> <span class=\"title class_\">HashMap</span>&lt;&gt;();</span><br><span class=\"line\"></span><br><span class=\"line\">        MemoryJavaFileManager(StandardJavaFileManager standardManager) &#123;</span><br><span class=\"line\">            <span class=\"built_in\">super</span>(standardManager);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"keyword\">public</span> JavaFileObject <span class=\"title function_\">getJavaFileForOutput</span><span class=\"params\">(Location location, String className,</span></span><br><span class=\"line\"><span class=\"params\">                                                   JavaFileObject.Kind kind, FileObject sibling)</span> &#123;</span><br><span class=\"line\">            <span class=\"type\">ByteArrayOutputStream</span> <span class=\"variable\">outputStream</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ByteArrayOutputStream</span>();</span><br><span class=\"line\">            classOutputBuffers.put(className, outputStream);</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">SimpleJavaFileObject</span>(</span><br><span class=\"line\">                    URI.create(<span class=\"string\">&quot;mem:///&quot;</span> + className.replace(<span class=\"string\">&#x27;.&#x27;</span>, <span class=\"string\">&#x27;/&#x27;</span>) + kind.extension), kind) &#123;</span><br><span class=\"line\">                <span class=\"meta\">@Override</span></span><br><span class=\"line\">                <span class=\"keyword\">public</span> OutputStream <span class=\"title function_\">openOutputStream</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> outputStream;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">public</span> Map&lt;String, <span class=\"type\">byte</span>[]&gt; getClassBytes() &#123;</span><br><span class=\"line\">            Map&lt;String, <span class=\"type\">byte</span>[]&gt; result = <span class=\"keyword\">new</span> <span class=\"title class_\">HashMap</span>&lt;&gt;();</span><br><span class=\"line\">            <span class=\"keyword\">for</span> (Map.Entry&lt;String, ByteArrayOutputStream&gt; entry : classOutputBuffers.entrySet()) &#123;</span><br><span class=\"line\">                result.put(entry.getKey(), entry.getValue().toByteArray());</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> result;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// ç”¨äºåŠ è½½å†…å­˜ä¸­çš„ class</span></span><br><span class=\"line\">    <span class=\"keyword\">static</span> <span class=\"keyword\">class</span> <span class=\"title class_\">InMemoryClassLoader</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">ClassLoader</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> Map&lt;String, <span class=\"type\">byte</span>[]&gt; classBytes;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"title function_\">InMemoryClassLoader</span><span class=\"params\">(Map&lt;String, <span class=\"type\">byte</span>[]&gt; classBytes)</span> &#123;</span><br><span class=\"line\">            <span class=\"built_in\">super</span>(ClassLoader.getSystemClassLoader());</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.classBytes = classBytes;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"keyword\">protected</span> Class&lt;?&gt; findClass(String name) <span class=\"keyword\">throws</span> ClassNotFoundException &#123;</span><br><span class=\"line\">            <span class=\"type\">byte</span>[] bytes = classBytes.get(name);</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (bytes == <span class=\"literal\">null</span>) <span class=\"keyword\">return</span> <span class=\"built_in\">super</span>.findClass(name);</span><br><span class=\"line\">            <span class=\"keyword\">return</span> defineClass(name, bytes, <span class=\"number\">0</span>, bytes.length);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"æ‰“ç ´åŒäº²å§”æ´¾ï¼Œå®ç°åŒç±»å¤šç‰ˆæœ¬å…±å­˜\">æ‰“ç ´åŒäº²å§”æ´¾ï¼Œå®ç°åŒç±»å¤šç‰ˆæœ¬å…±å­˜</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å‡è®¾æˆ‘ä»¬æœ‰åŒä¸€ä¸ªjaråŒ…çš„ä¸åŒç‰ˆæœ¬ï¼Œæ¯”å¦‚ï¼š<code>a-1.0.jar</code>å’Œ<code>a-2.0.jar</code>ï¼Œä»–ä»¬å…·æœ‰åŒåçš„ <code>DemoClass</code>ç±» ,ç³»ç»Ÿ<code>classpath</code>ä¸­å¼•å…¥çš„æ˜¯ <code>a-1.0.jar</code>ï¼Œè€Œæ­¤æ—¶æˆ‘ä»¬é€šè¿‡â¾ƒå®šçš„ClassLoaderåŠ è½½ <code>a-2.0.jar</code>ï¼Œå¹¶è°ƒç”¨ <code>DemoClass</code>ç±» ï¼Œæˆ‘ä»¬ä¼šå‘ç°ï¼Œâ¾ƒå®šçš„ClassLoaderåŠ è½½çš„ç±»ä¾æ—§æ˜¯ <code>a-1.0.jar</code> ä¸­çš„ç±»ï¼Œè€Œä¸æ˜¯ <code>a-2.0.jar</code> ä¸­çš„ç±»ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä¸ºä»€ä¹ˆä¼šå‡ºç°è¿™ç§æƒ…å†µå‘¢ï¼Ÿè¿™å°±æ˜¯å› ä¸ºJDKçš„åŒäº²å§”æ´¾æœºåˆ¶ã€‚â¾ƒå®šçš„ClassLoaderçš„<code>parent</code>å±æ€§æŒ‡å‘çš„æ˜¯JDKå†…çš„<code>AppClassLoader</code>ï¼Œâ½½ <code>AppClassLoader</code> ä¼šåŠ è½½ç³»ç»Ÿå½“ä¸­çš„æ‰€æœ‰ä»£ç ï¼Œå°±åŒ…æ‹¬ <code>a-1.0.jar</code>ä¸­çš„ <code>DemoClass</code>ç±»ã€‚è¿™æ—¶ï¼Œâ¾ƒå®šçš„ClassLoaderå»åŠ è½½ <code>DemoClass</code>ç±»æ—¶ï¼Œé€šè¿‡åŒäº²å§”æ´¾å‘ä¸ŠæŸ¥æ‰¾ï¼Œâ¾ƒç„¶åŠ è½½å‡ºæ¥çš„å°±æ˜¯APPClassloaderä¸­çš„<code>DemoClass</code>äº†ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å¦‚ä½•æ‰“ç ´åŒäº²å§”æ´¾å‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥é€šè¿‡é‡å†™ <code>loadClass()</code>æ–¹æ³•ï¼Œæ¥æ‰“ç ´åŒäº²å§”æ´¾ï¼Œå®ç°ç±»â½‚ä»¶çš„åŠ è½½ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> java.io.ByteArrayOutputStream;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.InputStream;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.net.URL;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.net.URLConnection;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.security.SecureClassLoader;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">CustomClassLoader</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">SecureClassLoader</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> URL jarUrl;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">CustomClassLoader</span><span class=\"params\">(URL jarUrl)</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// åˆ›å»ºä¸€ä¸ªç‹¬ç«‹çš„å­ç±»åŠ è½½å™¨ï¼ŒåªåŠ è½½æŒ‡å®š JAR</span></span><br><span class=\"line\">        <span class=\"built_in\">this</span>.jarUrl = jarUrl;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> Class&lt;?&gt; loadClass(String name, <span class=\"type\">boolean</span> resolve) <span class=\"keyword\">throws</span> ClassNotFoundException &#123;</span><br><span class=\"line\">        <span class=\"comment\">// æŠŠåŒäº²å§”æ´¾æœºåˆ¶åè¿‡æ¥ï¼Œå…ˆåˆ°â¼¦ç±»åŠ è½½å™¨ä¸­åŠ è½½ï¼ŒåŠ è½½ä¸åˆ°å†å»â½—ç±»åŠ è½½å™¨ä¸­åŠ è½½ã€‚</span></span><br><span class=\"line\">        <span class=\"keyword\">synchronized</span> (getClassLoadingLock(name)) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// å¦‚æœç±»å·²åŠ è½½ï¼Œåˆ™ç›´æ¥è¿”å›</span></span><br><span class=\"line\">            Class&lt;?&gt; loadedClass = findLoadedClass(name);</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (loadedClass == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                loadedClass = findClass(name);</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                <span class=\"comment\">// å§”æ´¾ç»™çˆ¶ç±»åŠ è½½å™¨</span></span><br><span class=\"line\">                loadedClass = <span class=\"built_in\">super</span>.loadClass(name, resolve);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> loadedClass;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">protected</span> Class&lt;?&gt; findClass(String name) &#123;</span><br><span class=\"line\">        <span class=\"type\">int</span> code;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">// è®¿é—®jaråŒ…çš„url</span></span><br><span class=\"line\">            <span class=\"type\">URLConnection</span> <span class=\"variable\">urlConnection</span> <span class=\"operator\">=</span> jarUrl.openConnection();</span><br><span class=\"line\">            urlConnection.setUseCaches(<span class=\"literal\">false</span>);</span><br><span class=\"line\">            <span class=\"type\">InputStream</span> <span class=\"variable\">is</span> <span class=\"operator\">=</span> urlConnection.getInputStream();</span><br><span class=\"line\">            <span class=\"type\">ByteArrayOutputStream</span> <span class=\"variable\">bos</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ByteArrayOutputStream</span>();</span><br><span class=\"line\">            <span class=\"keyword\">while</span> ((code = is.read()) != -<span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">                bos.write(code);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"type\">byte</span>[] data = bos.toByteArray();</span><br><span class=\"line\">            is.close();</span><br><span class=\"line\">            bos.close();</span><br><span class=\"line\">            <span class=\"keyword\">return</span> defineClass(name, data, <span class=\"number\">0</span>, data.length);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æµ‹è¯•ä»£ç </p>\n</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> java.io.File;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.net.URL;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Test</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> Exception &#123;</span><br><span class=\"line\">        <span class=\"type\">File</span> <span class=\"variable\">jarFile</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">File</span>(<span class=\"string\">&quot;path/to/a-2.0.jar&quot;</span>);</span><br><span class=\"line\">        <span class=\"type\">URL</span> <span class=\"variable\">jarUrl</span> <span class=\"operator\">=</span> jarFile.toURI().toURL();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">CustomClassLoader</span> <span class=\"variable\">loader</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">CustomClassLoader</span>(jarUrl);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// åŠ è½½ DemoClass</span></span><br><span class=\"line\">        Class&lt;?&gt; clazz = loader.loadClass(<span class=\"string\">&quot;com.example.DemoClass&quot;</span>);</span><br><span class=\"line\">        <span class=\"type\">Object</span> <span class=\"variable\">obj</span> <span class=\"operator\">=</span> clazz.getDeclaredConstructor().newInstance();</span><br><span class=\"line\">        clazz.getMethod(<span class=\"string\">&quot;print&quot;</span>).invoke(obj);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"æ‰“ç ´åŒäº²å§”æ´¾æœºåˆ¶çš„å…¸å‹åœºæ™¯\">æ‰“ç ´åŒäº²å§”æ´¾æœºåˆ¶çš„å…¸å‹åœºæ™¯</h3>\n<h4 id=\"Tomcatç±»åŠ è½½å™¨\">Tomcatç±»åŠ è½½å™¨</h4>\n<p><img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/uPic/eGKhDn.png\" alt=\"\" width=\"550\" height=\"700\"></p>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>CommonClassLoaderï¼šTomcatæœ€åŸºæœ¬çš„ç±»åŠ è½½å™¨ï¼ŒåŠ è½½è·¯å¾„ä¸­çš„classå¯ä»¥è¢«Tomcatå®¹å™¨æœ¬èº«ä»¥åŠå„ä¸ªWebappè®¿é—®ï¼›</p>\n</li>\n<li class=\"lvl-2\">\n<p>CatalinaClassLoaderï¼šTomcatå®¹å™¨ç§æœ‰çš„ç±»åŠ è½½å™¨ï¼ŒåŠ è½½è·¯å¾„ä¸­çš„classå¯¹äºWebappä¸å¯â»…ï¼›</p>\n</li>\n<li class=\"lvl-2\">\n<p>SharedClassLoaderï¼šå„ä¸ªWebappå…±äº«çš„ç±»åŠ è½½å™¨ï¼ŒåŠ è½½è·¯å¾„ä¸­çš„classå¯¹äºæ‰€æœ‰Webappå¯â»…ï¼Œä½†æ˜¯å¯¹äºTomcatå®¹å™¨ä¸å¯â»…ï¼›</p>\n</li>\n<li class=\"lvl-2\">\n<p>WebappClassLoaderï¼šå„ä¸ªWebappç§æœ‰çš„ç±»åŠ è½½å™¨ï¼ŒåŠ è½½è·¯å¾„ä¸­çš„classåªå¯¹å½“å‰Webappå¯â»…ï¼Œâ½å¦‚åŠ è½½waråŒ…â¾¥ç›¸å…³çš„ç±»ï¼Œæ¯ä¸ªwaråŒ…åº”â½¤éƒ½æœ‰â¾ƒâ¼°çš„WebappClassLoaderï¼Œå®ç°ç›¸äº’éš”ç¦»ï¼Œâ½å¦‚ä¸åŒwaråŒ…åº”â½¤å¼•â¼Šäº†ä¸åŒçš„springç‰ˆæœ¬ï¼Œè¿™æ ·å®ç°å°±èƒ½åŠ è½½å„â¾ƒçš„springç‰ˆæœ¬ï¼›</p>\n</li>\n<li class=\"lvl-2\">\n<p>Jspç±»åŠ è½½å™¨ï¼šé’ˆå¯¹æ¯ä¸ªJSPâ»šâ¾¯åˆ›å»ºâ¼€ä¸ªåŠ è½½å™¨ã€‚è¿™ä¸ªåŠ è½½å™¨â½è¾ƒè½»é‡çº§ï¼Œæ‰€ä»¥Tomcatè¿˜å®ç°äº†çƒ­åŠ è½½ï¼Œä¹Ÿå°±æ˜¯JSPåªè¦ä¿®æ”¹äº†ï¼Œå°±åˆ›å»ºâ¼€ä¸ªæ–°çš„åŠ è½½å™¨ï¼Œä»â½½å®ç°äº†JSPâ»šâ¾¯çš„çƒ­æ›´æ–°ã€‚</p>\n</li>\n</ul>\n","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç»JVMçš„ç±»åŠ è½½å™¨ The JavaÂ® Virtual Machine Specification ç‰ˆæœ¬jdk1.8 ç±»åŠ è½½å™¨ å·¦ä¾§æ˜¯JDKä¸­å®ç°çš„ç±»åŠ è½½å™¨ï¼Œé€šè¿‡parentå±æ€§å½¢æˆâ½—â¼¦å…³ç³»ã€‚åº”â½¤ä¸­â¾ƒå®šä¹‰çš„ç±»åŠ è½½å™¨çš„parentéƒ½æ˜¯ AppClassLoader å³ä¾§æ˜¯JDKä¸­çš„ç±»åŠ è½½å™¨å®ç°ç±»ã€‚é€šè¿‡ç±»ç»§æ‰¿çš„æœºåˆ¶å½¢æˆä½“ç³»ã€‚æœªæ¥æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ç»§æ‰¿ç›¸å…³çš„ç±»å®ç°â¾ƒå®šä¹‰ç±» åŠ è½½å™¨ã€‚ åœ¨ä»£ç ä¸­æŸ¥çœ‹ç±»åŠ è½½å™¨å…³ç³» 1234567891011121314public class LoaderDemo &#123; public static void main(String[] args) throws ClassNotFoundException &#123; // â½—â¼¦å…³ç³» AppClassLoader &lt;- ExtClassLoader &lt;- BootStrap Classloader ClassLoader cl1 = LoaderDemo.class.getClassLoader(); System.out.println(&quot;cl1 &gt; &quot; + cl1); // sun.misc.Launcher$AppClassLoader@18b4aac2 System.out.println(&quot;parent of cl1 &gt; &quot; + cl1.getParent()); // sun.misc.Launcher$ExtClassLoader@1b6d3586 // BootStrap Classloaderç”±C++å¼€å‘ï¼Œæ˜¯JVMè™šæ‹Ÿæœºçš„â¼€éƒ¨åˆ†ï¼Œæœ¬èº«ä¸æ˜¯JAVAç±»ã€‚ System.out.println(&quot;grant parent of cl1 &gt; &quot; + cl1.getParent().getParent()); // null // String,Intç­‰åŸºç¡€ç±»ç”±BootStrap ClassloaderåŠ è½½ã€‚ ClassLoader cl2 = String.class.getClassLoader(); System.out.println(&quot;cl2 &gt; &quot; + cl2); // null System.out.println(cl1.loadClass(&quot;java.util.List&quot;).getClass().getClassLoader()); // null &#125;&#125; åŒäº²å§”æ´¾æœºåˆ¶ å½“â¼€ä¸ªç±»åŠ è½½å™¨è¦åŠ è½½â¼€ä¸ªç±»æ—¶ï¼Œæ•´ä½“çš„è¿‡ç¨‹å°±æ˜¯é€šè¿‡åŒäº²å§”æ´¾æœºåˆ¶å‘ä¸Šå§”æ‰˜æŸ¥æ‰¾ï¼Œå¦‚æœæ²¡æœ‰æŸ¥æ‰¾åˆ°ï¼Œå°±å‘ä¸‹å§”æ‰˜åŠ è½½ã€‚ Java ç±»åŠ è½½æœºåˆ¶ä¸­çš„åŒäº²å§”æ´¾æ¨¡å‹ï¼ˆParent Delegation Modelï¼‰æ˜¯ä¸€ç§ä¿è¯äº†ç±»åŠ è½½å™¨æŒ‰ç…§å±‚æ¬¡ç»“æ„ä»ä¸Šåˆ°ä¸‹æ¥åŠ è½½ç±»çš„ç­–ç•¥ã€‚è¿™ç§å±‚çº§åŒ–çš„åŠ è½½æµç¨‹ç¡®ä¿äº†åº”ç”¨ç¨‹åºèƒ½å¤Ÿå®‰å…¨åœ°åŠ è½½å¹¶ä½¿ç”¨æ¥è‡ªä¸åŒæ¥æºçš„ç±»ï¼ŒåŒæ—¶ä¹Ÿé¿å…äº†å†…å­˜ä¸­å‡ºç°ç›¸åŒç±»çš„å¤šä¸ªæ‹·è´ã€‚ ä»¥ä¸‹æ˜¯åŒäº²å§”æ´¾æœºåˆ¶çš„å·¥ä½œåŸç†ï¼š 1.å½“ä¸€ä¸ªç±»åŠ è½½å™¨æ¥æ”¶åˆ°ç±»åŠ è½½è¯·æ±‚æ—¶ï¼Œå®ƒé¦–å…ˆä¸ä¼šè‡ªè¡Œå°è¯•å»å¯»æ‰¾ç±»æ–‡ä»¶ï¼Œè€Œæ˜¯å°†è¿™ä¸ªè¯·æ±‚å§”æ´¾ç»™å®ƒçš„çˆ¶ç±»åŠ è½½å™¨ã€‚ 2.çˆ¶ç±»åŠ è½½å™¨åŒæ ·éµå¾ªæ­¤è§„åˆ™ï¼Œå®ƒä¼šç»§ç»­æŠŠè¯·æ±‚å‘ä¸Šå§”æ´¾ç»™å®ƒçš„çˆ¶ç±»åŠ è½½å™¨ï¼Œç›´åˆ°è¾¾åˆ°æ ¹ï¼ˆbootstrappï¼‰ç±»åŠ è½½å™¨ä¸ºæ­¢ã€‚ 3.æ ¹ç±»åŠ è½½å™¨ä¸€èˆ¬ä¼šç›´æ¥è®¿é—®æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿæ¥æŸ¥æ‰¾ç±»æ–‡ä»¶ï¼Œæ¯”å¦‚ JDK è‡ªå¸¦çš„æ ¸å¿ƒç±»åº“ï¼Œæˆ–è€…åœ¨-XbootclasspathæŒ‡å®šçš„è·¯å¾„ä¸‹æŸ¥æ‰¾ã€‚ 4.å¦‚æœæ ¹ç±»åŠ è½½å™¨æ‰¾åˆ°äº†è¯¥ç±»ï¼Œåˆ™è¿›è¡Œç±»çš„åŠ è½½ï¼›å¦‚æœæ‰¾ä¸åˆ°ï¼Œåˆ™æŠŠè¿™ä¸ªä»»åŠ¡äº¤å›ç»™å‘å‡ºè¯·æ±‚çš„å­ç±»åŠ è½½å™¨ã€‚ 5.å­ç±»åŠ è½½å™¨ä¹Ÿé‡å¤æ­¥éª¤ 4ï¼Œè‹¥æ‰¾åˆ°åˆ™åŠ è½½ï¼Œå¦åˆ™ä¼ é€’ç»™ä¸‹ä¸€ä¸ªå­ç±»åŠ è½½å™¨ï¼Œç›´è‡³åŸå§‹æå‡ºè¯·æ±‚çš„ç±»åŠ è½½å™¨ã€‚ 6.è‹¥æ‰€æœ‰çš„ç±»åŠ è½½å™¨éƒ½æœªèƒ½æ‰¾åˆ°æ‰€éœ€çš„ç±»ï¼Œåˆ™æœ€ç»ˆæŠ›å‡ºClassNotFoundExceptionå¼‚å¸¸ã€‚ åŒäº²å§”æ´¾æœ‰ä»¥ä¸‹å‡ ä¸ªä¼˜ç‚¹ï¼š å®‰å…¨æ€§ï¼šç”±äºç±»åŠ è½½æ˜¯ä»é¡¶å±‚å¼€å§‹ï¼Œè¿™èƒ½é˜²æ­¢æ¶æ„ä»£ç é€šè¿‡åŠ è½½ç›¸åŒçš„åŒ…åå’Œç±»åæ›¿ä»£ç³»ç»Ÿçš„å…³é”®ç±»ã€‚ å”¯ä¸€æ€§ï¼šæ¯ä¸ªç±»éƒ½ä¼šè¢«ç‰¹å®šçš„ç±»åŠ è½½å™¨åŠ è½½ä¸€æ¬¡ï¼Œå³ä¾¿æ˜¯åœ¨åˆ†å¸ƒå¼çš„ç¯å¢ƒä¸­ä¹Ÿèƒ½ä¿è¯ç±»çš„ç»Ÿä¸€æ€§ï¼Œé¿å…å› ä¸ºå¤šæ¬¡åŠ è½½å¯¼è‡´çš„é”™è¯¯ã€‚ å¯é æ€§ï¼šç”¨æˆ·è‡ªå®šä¹‰çš„ç±»åŠ è½½å™¨ä¸ç”¨æ‹…å¿ƒåŸºç¡€ç±»å·²ç»è¢«åŠ è½½ï¼Œå®ƒä»¬å¯ä»¥ä¸“å¿ƒäºè‡ªå·±éœ€è¦å¤„ç†çš„éƒ¨åˆ†ã€‚ ä¾‹å¦‚ï¼Œå½“åº”ç”¨ç¨‹åºè¿è¡Œæ—¶ï¼Œåº”ç”¨ç±»åŠ è½½å™¨ï¼ˆApplication ClassLoaderï¼‰æ¥æ”¶åˆ°å¯¹java.lang.Stringç±»çš„åŠ è½½è¯·æ±‚æ—¶ï¼Œå®ƒä¼šé¦–å…ˆå°†è¯·æ±‚ä¼ é€’ç»™æ‰©å±•ç±»åŠ è½½å™¨ï¼ˆExtension ClassLoaderï¼‰ï¼Œåè€…å†ä¼ é€’ç»™å¼•å¯¼ç±»åŠ è½½å™¨ï¼ˆBootstrap ClassLoaderï¼‰ã€‚å¼•å¯¼ç±»åŠ è½½å™¨ä¼šåœ¨å…¶æœç´¢è·¯å¾„ä¸­æ‰¾åˆ°Stringç±»ï¼Œå¹¶å®ŒæˆåŠ è½½è¿‡ç¨‹ã€‚å¦‚æœåº”ç”¨ç¨‹åºè¯•å›¾æä¾›è‡ªå·±çš„Stringç±»ï¼Œç”±äºåŒäº²å§”æ´¾çš„å­˜åœ¨ï¼Œåº”ç”¨ç¨‹åºæ‰€æŒ‡å®šçš„ç±»å¹¶ä¸ä¼šè¢«åŠ è½½ï¼Œä»è€Œä¿è¯äº†å¹³å°æ ¸å¿ƒ API çš„ä¸€è‡´æ€§ã€‚ æ€»ä¹‹ï¼ŒåŒäº²å§”æ´¾æœºåˆ¶æ˜¯ Java ç±»åŠ è½½è¿‡ç¨‹ä¸­ä¸€ä¸ªéå¸¸é‡è¦çš„ç‰¹æ€§ï¼Œå®ƒä¸ä»…ç»´æŠ¤äº†ç±»åŠ è½½çš„å®‰å…¨æ€§å’Œä¸€è‡´æ€§ï¼Œä¹Ÿä¸ºå¼€å‘è€…æä¾›äº†çµæ´»å®šåˆ¶ç±»åŠ è½½è§„åˆ™çš„èƒ½åŠ›ã€‚ æ¯ä¸ªç±»åŠ è½½å™¨æŸ¥æ‰¾ç±»çš„é»˜è®¤è·¯å¾„ åœ¨ Java ä¸­ï¼Œæ¯ä¸ªç±»åŠ è½½å™¨éƒ½æœ‰è‡ªå·±çš„ç±»è·¯å¾„ï¼ˆClasspathï¼‰å»æŸ¥æ‰¾ç±»æ–‡ä»¶ã€‚ä¸‹é¢æ˜¯å‡ ä¸ªä¸»è¦çš„ç±»åŠ è½½å™¨ä»¥åŠå®ƒä»¬çš„é»˜è®¤æŸ¥æ‰¾è·¯å¾„ï¼š ç±»åŠ è½½å™¨åç§° ç±»å / åˆ«å çˆ¶ç±»åŠ è½½å™¨ åŠ è½½å†…å®¹æè¿° é»˜è®¤æŸ¥æ‰¾è·¯å¾„ / ç³»ç»Ÿå±æ€§ å¯åŠ¨ç±»åŠ è½½å™¨ BootstrapClassLoader æ—  åŠ è½½ æ ¸å¿ƒ Java ç±»åº“ &lt;JAVA_HOME&gt;/jre/lib/rt.jarï¼ˆJDK8 åŠä¹‹å‰ï¼‰æˆ– sun.boot.class.path æŒ‡å®šè·¯å¾„ æ‰©å±•ç±»åŠ è½½å™¨ ExtClassLoader BootstrapClassLoader åŠ è½½ Java å¹³å°æ‰©å±•ç±»åº“ &lt;JAVA_HOME&gt;/jre/lib/ext æˆ–ç”± java.ext.dirs ç³»ç»Ÿå±æ€§æŒ‡å®š åº”ç”¨ç±»åŠ è½½å™¨ AppClassLoader ExtClassLoader åŠ è½½ åº”ç”¨ç¨‹åºç±»ï¼ˆç”¨æˆ·ç¼–å†™çš„ä»£ç ï¼‰ -classpathã€-cp å‚æ•°ã€CLASSPATH ç¯å¢ƒå˜é‡ã€java.class.path å±æ€§ã€å½“å‰ç›®å½• (.) è‡ªå®šä¹‰ç±»åŠ è½½å™¨ ç”¨æˆ·è‡ªå®šä¹‰ å¯æŒ‡å®š å¯é€šè¿‡ç»§æ‰¿ ClassLoader å¹¶é‡å†™ findClass() æ–¹æ³•å®ç°è‡ªå®šä¹‰ç±»åŠ è½½é€»è¾‘ï¼Œå¦‚ä»ç½‘ç»œã€æ•°æ®åº“ç­‰åŠ è½½ç±»æ–‡ä»¶ é»˜è®¤ç»§æ‰¿çˆ¶åŠ è½½å™¨æŸ¥æ‰¾è·¯å¾„ï¼Œä¹Ÿå¯è‡ªå®šä¹‰ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œé™¤äº† Bootstrap ClassLoader å¤–ï¼Œå…¶ä»–çš„æ‰€æœ‰ç±»åŠ è½½å™¨æœ€ç»ˆéƒ½æ˜¯java.lang.ClassLoaderçš„å­ç±»ï¼Œå¹¶ä¸”æ¯ä¸ªç±»åŠ è½½å™¨å®ä¾‹éƒ½æœ‰ä¸€ä¸ªç›´æ¥çš„çˆ¶ç±»åŠ è½½å™¨ã€‚å¦‚æœä½ åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„ç±»åŠ è½½å™¨ï¼Œå®ƒå°†ç»§æ‰¿ Application ClassLoader ä½œä¸ºå®ƒçš„çˆ¶ç±»ï¼Œé™¤éä½ åœ¨åˆ›å»ºæ—¶æŒ‡å®šäº†ä¸åŒçš„çˆ¶ç±»åŠ è½½å™¨ã€‚ æ­¤å¤–ï¼ŒJava 9 å¼•å…¥äº†æ¨¡å—åŒ–ç³»ç»Ÿåï¼Œç±»åŠ è½½æœºåˆ¶ä¹Ÿæœ‰äº†ä¸€äº›å˜åŒ–ï¼Œå¯¹äºæ¨¡å—è·¯å¾„ä¸Šçš„ç±»åŠ è½½ï¼Œä¼šä½¿ç”¨æ–°çš„å±‚æ¬¡ç»“æ„æ¥å¤„ç†ï¼Œè¿™ä½¿å¾—ç±»åŠ è½½è¿‡ç¨‹æ›´åŠ çµæ´»åŒæ—¶ä¿æŒäº†å‘åçš„å…¼å®¹æ€§ã€‚ä¸è¿‡ï¼Œå¯¹äºä¼ ç»Ÿçš„ç±»è·¯å¾„ä¸Šçš„ç±»åŠ è½½ï¼ŒåŒäº²å§”æ´¾æ¨¡å‹ä»ç„¶é€‚ç”¨ã€‚ ç±»åŠ è½½å™¨åç§° ç±»å / åˆ«å çˆ¶ç±»åŠ è½½å™¨ åŠ è½½æ¨¡å—èŒƒå›´ é»˜è®¤æŸ¥æ‰¾è·¯å¾„ / æ¨¡å—æ¥æº å¼•å¯¼ç±»åŠ è½½å™¨ BootstrapClassLoader æ—  åŠ è½½ java.* æ¨¡å—ï¼Œä¾‹å¦‚ java.baseï¼ˆåŒ…å« java.lang, java.util ç­‰ï¼‰ $JAVA_HOME/jmods ä¸­çš„æ¨¡å—æ–‡ä»¶ï¼Œæ ¸å¿ƒæ¨¡å—ç”± JVM å¯åŠ¨æ—¶ç›´æ¥åŠ è½½ å¹³å°ç±»åŠ è½½å™¨ PlatformClassLoader BootstrapClassLoader åŠ è½½ jdk.*ã€javafx.* ç­‰å¹³å°æ‰©å±•æ¨¡å— $JAVA_HOME/jmodsï¼Œæ¨¡å—åä¸º jdk.*ã€javafx.* ç­‰ï¼› åº”ç”¨ç±»åŠ è½½å™¨ AppClassLoader PlatformClassLoader åŠ è½½åº”ç”¨æ¨¡å—ï¼ˆç”¨æˆ·ä»£ç ï¼‰ï¼ŒåŒ…æ‹¬æ¨¡å—è·¯å¾„ --module-path å’Œç±»è·¯å¾„ -classpath ä¸‹çš„ç±» åº”ç”¨ç¨‹åºç¼–å†™çš„æ¨¡å—æˆ–ç±»ï¼Œæ¥è‡ªå‘½ä»¤è¡Œ --module-pathã€-classpath å‚æ•°ã€CLASSPATH ç¯å¢ƒå˜é‡ç­‰ è‡ªå®šä¹‰ç±»åŠ è½½å™¨ ç”¨æˆ·è‡ªå®šä¹‰ å¯æŒ‡å®šçˆ¶åŠ è½½å™¨ åŠ è½½éæ ‡å‡†ä½ç½®çš„ç±»ï¼Œå¯ç”¨äºæ’ä»¶ã€ç½‘ç»œåŠ è½½ã€åŠ å¯†ç±»åŠ è½½ç­‰ é»˜è®¤éµå¾ªåŒäº²å§”æ´¾ï¼Œå¯é‡å†™ findClass() å®ç°è‡ªå®šä¹‰è·¯å¾„æŸ¥æ‰¾æˆ–å…¶ä»–æ•°æ®æºï¼Œå¦‚ç½‘ç»œã€æ•°æ®åº“ã€åŠ å¯†æ–‡ä»¶ç­‰ åœ¨ä»£ç ä¸­æŸ¥çœ‹ç±»åŠ è½½è·¯å¾„ 123456// BootStrap Classloaderï¼ŒåŠ è½½javaåŸºç¡€ç±»ã€‚System.out.println(&quot;BootStrap ClassLoaderåŠ è½½â½¬å½•ï¼š&quot; + System.getProperty(&quot;sun.boot.class.path&quot;));// Extention Classloader åŠ è½½â¼€äº›æ‰©å±•ç±»ã€‚ å¯é€šè¿‡-D java.ext.dirså¦â¾æŒ‡å®šâ½¬å½•System.out.println(&quot;Extention ClassLoaderåŠ è½½â½¬å½•ï¼š&quot; + System.getProperty(&quot;java.ext.dirs&quot;));// AppClassLoader åŠ è½½CLASSPATHï¼Œåº”â½¤ä¸‹çš„JaråŒ…ã€‚å¯é€šè¿‡-D java.class.pathå¦â¾æŒ‡å®šâ½¬å½•System.out.println(&quot;AppClassLoaderåŠ è½½â½¬å½•ï¼š&quot; + System.getProperty(&quot;java.class.path&quot;)); åŒäº²å§”æ´¾æœºåˆ¶çš„å®ç°åŸç† java.lang.ClassLoader ç±»çš„ loadClass æ–¹æ³•æ˜¯åŒäº²å§”æ´¾çš„æ ¸å¿ƒå®ç° 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657/** * åŠ è½½æŒ‡å®šåç§°çš„ç±»ï¼Œå¹¶æ ¹æ® resolve å‚æ•°å†³å®šæ˜¯å¦è§£æè¯¥ç±»ã€‚ * * è¯¥æ–¹æ³•å®ç°äº†ç±»åŠ è½½çš„åŸºæœ¬é€»è¾‘ï¼ŒåŒ…æ‹¬æ£€æŸ¥ç±»æ˜¯å¦å·²åŠ è½½ã€å§”æ‰˜çˆ¶ç±»åŠ è½½å™¨åŠ è½½ã€ * è‡ªè¡ŒåŠ è½½ç±»ä»¥åŠè§£æç±»ç­‰æ­¥éª¤ã€‚è¯¥æ–¹æ³•æ˜¯ Java ç±»åŠ è½½æœºåˆ¶çš„æ ¸å¿ƒéƒ¨åˆ†ä¹‹ä¸€ï¼Œ * éµå¾ªåŒäº²å§”æ´¾æ¨¡å‹ã€‚ * * @param name è¦åŠ è½½çš„ç±»çš„å…¨é™å®šå * @param resolve å¦‚æœä¸º trueï¼Œåˆ™åœ¨åŠ è½½åè§£æè¯¥ç±» * @return åŠ è½½çš„ Class å¯¹è±¡ * @throws ClassNotFoundException å¦‚æœæ‰¾ä¸åˆ°æŒ‡å®šçš„ç±» */// è¿™ä¸ªâ½…æ³•æ˜¯protectedå£°æ˜çš„ï¼Œæ„å‘³ç€ï¼Œæ˜¯å¯ä»¥è¢«â¼¦ç±»è¦†ç›–çš„ï¼Œæ‰€ä»¥ï¼ŒåŒäº²å§”æ´¾æœºåˆ¶ä¹Ÿæ˜¯å¯ä»¥è¢«æ‰“ç ´çš„ï¼Œå¦‚Tomcatâ¼¦ç±»é‡å†™è¿™ä¸ªâ½…æ³•ï¼Œå¹¶ä½¿â½¤è‡ªå·±çš„ç±»åŠ è½½é€»è¾‘ã€‚protected Class&lt;?&gt; loadClass(String name, boolean resolve) throws ClassNotFoundException &#123; // ä½¿ç”¨ synchronized ç¡®ä¿å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ç±»åŠ è½½çš„åŒæ­¥ synchronized (getClassLoadingLock(name)) &#123; // First, check if the class has already been loaded // æ¯ä¸ªç±»åŠ è½½å™¨å¯¹ä»–åŠ è½½è¿‡çš„ç±»éƒ½æœ‰â¼€ä¸ªç¼“å­˜ï¼Œå…ˆå»ç¼“å­˜ä¸­æŸ¥çœ‹æœ‰æ²¡æœ‰åŠ è½½è¿‡ Class&lt;?&gt; c = findLoadedClass(name); if (c == null) &#123; //æ²¡æœ‰åŠ è½½è¿‡ï¼Œå°±â¾›åŒäº²å§”æ´¾ long t0 = System.nanoTime(); try &#123; // çˆ¶ç±»å­˜åœ¨åˆ™è®©â½—ç±»åŠ è½½å™¨è¿›â¾åŠ è½½ if (parent != null) &#123; c = parent.loadClass(name, false); &#125; else &#123; //å¦‚æœçˆ¶ç±»ä¸å­˜åœ¨ï¼Œåˆ™ä»å¼•å¯¼ç±»åŠ è½½å™¨è¿›â¾åŠ è½½ c = findBootstrapClassOrNull(name); &#125; &#125; catch (ClassNotFoundException e) &#123; // ClassNotFoundException thrown if class not found // from the non-null parent class loader &#125; if (c == null) &#123; // If still not found, then invoke findClass in order // to find the class. long t1 = System.nanoTime(); // findClass æ–¹æ³•æ˜¯å­ç±»å®ç°çš„ï¼Œç”¨äºåŠ è½½æŒ‡å®šåç§°çš„ç±» // â½—ç±»åŠ è½½å™¨æ²¡æœ‰åŠ è½½è¿‡ï¼Œå°±â¾ƒâ¾è§£æclassâ½‚ä»¶åŠ è½½ c = findClass(name); // this is the defining class loader; record the stats // æ€§èƒ½ç»Ÿè®¡ï¼šè®°å½•ç±»åŠ è½½è¿‡ç¨‹ä¸­çš„æ—¶é—´æ¶ˆè€—å’Œè°ƒç”¨æ¬¡æ•°ï¼Œä¾¿äºç›‘æ§å’Œä¼˜åŒ–ã€‚ sun.misc.PerfCounter.getParentDelegationTime().addTime(t1 - t0); sun.misc.PerfCounter.getFindClassTime().addElapsedTimeFrom(t1); sun.misc.PerfCounter.getFindClasses().increment(); &#125; &#125; // é»˜è®¤æƒ…å†µä¸‹ï¼ŒåŒäº²å§”æ´¾æ¨¡å‹åªè¿›â¾äº†éªŒè¯å’Œå‡†å¤‡é˜¶æ®µï¼Œâ½½ä¸è¿›â¾è§£æ(å¦‚é“¾æ¥ã€åˆå§‹åŒ–) if (resolve) &#123; resolveClass(c); &#125; return c; &#125;&#125; è¯¥æ–¹æ³•å®ç°äº†ç±»åŠ è½½çš„åŸºæœ¬é€»è¾‘ï¼ŒåŒ…æ‹¬æ£€æŸ¥ç±»æ˜¯å¦å·²åŠ è½½ã€å§”æ‰˜çˆ¶ç±»åŠ è½½å™¨åŠ è½½ã€è‡ªè¡ŒåŠ è½½ç±»ä»¥åŠè§£æç±»ç­‰æ­¥éª¤ã€‚è¯¥æ–¹æ³•æ˜¯ Java ç±»åŠ è½½æœºåˆ¶çš„æ ¸å¿ƒéƒ¨åˆ†ä¹‹ä¸€ï¼Œéµå¾ªåŒäº²å§”æ´¾æ¨¡å‹ã€‚ è¿™ä¸ªâ½…æ³•æ˜¯protectedå£°æ˜çš„ï¼Œæ„å‘³ç€ï¼Œæ˜¯å¯ä»¥è¢«â¼¦ç±»è¦†ç›–çš„ï¼Œæ‰€ä»¥ï¼ŒåŒäº²å§”æ´¾æœºåˆ¶ä¹Ÿæ˜¯å¯ä»¥è¢«æ‰“ç ´çš„ï¼Œå¦‚Tomcatâ¼¦ç±»é‡å†™è¿™ä¸ªâ½…æ³•ï¼Œå¹¶ä½¿â½¤è‡ªå·±çš„ç±»åŠ è½½é€»è¾‘ã€‚ æ²™ç®±ä¿æŠ¤æœºåˆ¶ æ²™ç®±ä¿æŠ¤æœºåˆ¶æ˜¯ Java è™šæ‹Ÿæœºæä¾›çš„ä¸€ç§å®‰å…¨æœºåˆ¶ï¼Œç”¨äºä¿æŠ¤åº”ç”¨ç¨‹åºå…å—æ¶æ„ä»£ç çš„æ”»å‡»ã€‚ java.lang.ClassLoader ç±»çš„ preDefineClass æ–¹æ³•æ˜¯æ²™ç®±ä¿æŠ¤æœºåˆ¶çš„æ ¸å¿ƒå®ç° 1234567891011121314151617181920212223242526// è¿™ä¸ªæ–¹æ³•åœ¨åŒäº²å§”æ´¾æ¨¡å‹ä¹‹å‰è¢«è°ƒç”¨ï¼Œç”¨äºåœ¨åŠ è½½ç±»ä¹‹å‰è¿›è¡Œä¸€äº›é¢„å¤„ç†æ“ä½œã€‚// å‚æ•°ï¼š// name: è¦åŠ è½½çš„ç±»çš„å…¨é™å®šåã€‚// pd: æä¾›çš„ä¿æŠ¤åŸŸä¿¡æ¯ï¼Œå¯èƒ½ä¸º nullã€‚private ProtectionDomain preDefineClass(String name, ProtectionDomain pd) &#123; if (!checkName(name)) throw new NoClassDefFoundError(&quot;IllegalName: &quot; + name); // Note: Checking logic in java.lang.invoke.MemberName.checkForTypeAlias // relies on the fact that spoofing is impossible if a class has a name // of the form &quot;java.*&quot; if ((name != null) &amp;&amp; name.startsWith(&quot;java.&quot;)) &#123; throw new SecurityException (&quot;Prohibited package name: &quot; + name.substring(0, name.lastIndexOf(&#x27;.&#x27;))); &#125; if (pd == null) &#123; pd = defaultDomain; &#125; if (name != null) checkCerts(name, pd.getCodeSource()); return pd; &#125; è¿™ä¸ªæ–¹æ³• preDefineClass çš„ä½œç”¨æ˜¯åœ¨ç±»è¢«å®šä¹‰ä¹‹å‰è¿›è¡Œä¸€äº›å®‰å…¨æ£€æŸ¥å’Œå‡†å¤‡å·¥ä½œï¼Œç¡®ä¿ç±»çš„åˆæ³•æ€§ä¸å®‰å…¨æ€§ã€‚å®ƒé€šå¸¸ç”¨äºè‡ªå®šä¹‰ç±»åŠ è½½å™¨ä¸­ï¼Œä»¥å¢å¼ºç±»åŠ è½½è¿‡ç¨‹ä¸­çš„å®‰å…¨æ§åˆ¶ã€‚ æ–¹æ³•ä½œç”¨è¯¦è§£ï¼š 1.é˜²æ­¢å®šä¹‰éæ³•ç±»åçš„ç±»ï¼ˆå¦‚ java.* åŒ…ä¸‹çš„ç±»ï¼‰ï¼š å¦‚æœå°è¯•åŠ è½½çš„ç±»å±äº java. å¼€å¤´çš„æ ‡å‡†åŒ…ï¼ˆå¦‚ java.lang, java.util ç­‰ï¼‰ï¼Œä¼šæŠ›å‡º SecurityExceptionã€‚ è¿™æ˜¯ä¸ºäº†é˜²æ­¢ç”¨æˆ·è‡ªå®šä¹‰ç±»ä¼ªè£…æˆ Java æ ¸å¿ƒç±»åº“ä¸­çš„ç±»ï¼Œä»è€Œé€ æˆå®‰å…¨é£é™©ã€‚ 2.æ ¡éªŒç±»ååˆæ³•æ€§ï¼š è°ƒç”¨ checkName(name) æ£€æŸ¥ç±»åæ˜¯å¦åˆæ³•ï¼ˆä¾‹å¦‚ä¸èƒ½åŒ…å« /ã€éæ³•å­—ç¬¦ç­‰ï¼‰ï¼Œè‹¥ä¸åˆæ³•åˆ™æŠ›å‡º NoClassDefFoundErrorã€‚ 3.è¯ä¹¦ä¸€è‡´æ€§æ ¡éªŒï¼ˆç­¾åä¸€è‡´æ€§æ ¡éªŒï¼‰ï¼š å¦‚æœç±»æœ‰åç§°ä¸”æä¾›äº† ProtectionDomainï¼Œä¼šè°ƒç”¨ checkCerts(name, codeSource) æ¥ç¡®ä¿å½“å‰ç±»çš„ç­¾åä¸å…¶æ‰€åœ¨åŒ…ä¸­å…¶ä»–ç±»çš„ç­¾åä¸€è‡´ã€‚ é˜²æ­¢åŒä¸€åŒ…ä¸­æ··å…¥ä¸åŒç­¾åçš„ç±»ï¼Œé¿å…æ½œåœ¨çš„æ¶æ„ç¯¡æ”¹ã€‚ 4.è®¾ç½®é»˜è®¤ä¿æŠ¤åŸŸï¼ˆProtectionDomainï¼‰ï¼š å¦‚æœä¼ å…¥çš„ ProtectionDomain ä¸º nullï¼Œåˆ™ä½¿ç”¨ç±»åŠ è½½å™¨çš„é»˜è®¤åŸŸ defaultDomainã€‚ Linkingé“¾æ¥è¿‡ç¨‹ åœ¨ClassLoaderçš„loadClassâ½…æ³•ä¸­ï¼Œè¿˜æœ‰â¼€ä¸ªä¸èµ·çœ¼çš„æ­¥éª¤ï¼ŒresolveClassã€‚è¿™æ˜¯â¼€ä¸ªnativeâ½…æ³•ã€‚â½½å…¶å®ç°çš„è¿‡ç¨‹ç§°ä¸ºlinking-é“¾æ¥ã€‚ é“¾æ¥è¿‡ç¨‹çš„å®ç°åŠŸèƒ½å¦‚ä¸‹å›¾ï¼š å…¶ä¸­å…³äºåŠåˆå§‹åŒ–çŠ¶æ€å°±æ˜¯JDKåœ¨å¤„ç†â¼€ä¸ªç±»çš„staticé™æ€å±æ€§æ—¶ï¼Œä¼šå…ˆç»™è¿™ä¸ªå±æ€§åˆ†é…â¼€ä¸ªé»˜è®¤å€¼ï¼Œä½œâ½¤æ˜¯å ä½å†…å­˜ã€‚ç„¶åç­‰è¿æ¥è¿‡ç¨‹å®Œæˆåï¼Œåœ¨åâ¾¯çš„åˆå§‹åŒ–é˜¶æ®µï¼Œå†å°†é™æ€å±æ€§ä»é»˜è®¤å€¼ä¿®æ”¹ä¸ºæŒ‡å®šçš„åˆå§‹å€¼ã€‚ ç¬¦å·å¼•â½¤å’Œç›´æ¥å¼•â½¤ å¦‚æœAç±»ä¸­æœ‰â¼€ä¸ªé™æ€å±æ€§ï¼Œå¼•â½¤äº†å¦â¼€ä¸ªBç±»ã€‚é‚£ä¹ˆåœ¨å¯¹ç±»è¿›â¾åˆå§‹åŒ–çš„è¿‡ç¨‹ä¸­ï¼Œå› ä¸ºAå’ŒBè¿™ä¸¤ä¸ªç±»éƒ½æ²¡æœ‰åˆå§‹åŒ–ï¼ŒJVMå¹¶ä¸çŸ¥é“Aå’ŒBè¿™ä¸¤ä¸ªç±»çš„å…·ä½“åœ°å€ã€‚æ‰€ä»¥è¿™æ—¶ï¼Œåœ¨Aç±»ä¸­ï¼Œåªèƒ½åˆ›å»ºâ¼€ä¸ªä¸çŸ¥é“å…·ä½“åœ°å€çš„å¼•â½¤ï¼ŒæŒ‡å‘Bç±»ã€‚è¿™ä¸ªå¼•â½¤å°±ç§°ä¸ºç¬¦å·å¼•â½¤ã€‚â½½å½“Aç±»å’ŒBç±»éƒ½å®Œæˆåˆå§‹åŒ–åï¼ŒJVMâ¾ƒç„¶å°±éœ€è¦å°†è¿™ä¸ªç¬¦å·å¼•â½¤è½¬â½½æŒ‡å‘Bç±»å…·ä½“çš„å†…å­˜åœ°å€ï¼Œè¿™ä¸ªå¼•â½¤å°±ç§°ä¸ºç›´æ¥å¼•â½¤ã€‚ æ¥çœ‹ä¸€ä¸ªæœ‰æ„æ€çš„ç¤ºä¾‹ 1234567891011121314151617181920class Apple &#123; // é™æ€å˜é‡æŒ‰å£°æ˜é¡ºåºåˆå§‹åŒ– // æ„é€ æ–¹æ³•åˆå§‹åŒ–appleå¯¹è±¡æ—¶ï¼Œpriceè¿˜æ²¡æœ‰è¢«åˆå§‹åŒ–ï¼Œå¤„äºé“¾æ¥è¿‡ç¨‹ä¸­çš„å‡†å¤‡é˜¶æ®µï¼Œå³åŠåˆå§‹åŒ–çŠ¶æ€ï¼Œæ‰€ä»¥priceä¸ºé»˜è®¤å€¼0.0 static Apple apple = new Apple(10); // è§£å†³æ–¹æ³•æ˜¯å°†priceå£°æ˜åœ¨appleçš„ä¸Šé¢å³å¯ static double price = 20.00; double totalpay; public Apple(double discount) &#123; System.out.println(&quot;====&quot; + price); totalpay = price - discount; &#125;&#125;public class PriceTest &#123; public static void main(String[] args) &#123; System.out.println(Apple.apple.totalpay); // -10.0 &#125;&#125; è¿™é‡Œæœ‰ä¸€ä¸ªæœ‰æ„æ€çš„é—®é¢˜ï¼Œå°±æ˜¯åªæœ‰å½“loadClassæ–¹æ³•ä¸­çš„resolveå‚æ•°ä¸ºtrueæ—¶resolveClassæ–¹æ³•æ‰ä¼šè¢«è°ƒç”¨ï¼Œä½†æ˜¯å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œresolveå‚æ•°éƒ½æ˜¯falseï¼Œè¿™ä¸æ˜¯å¼ºåˆ¶é™åˆ¶è€Œæ˜¯å‡ºäºä»¥ä¸‹åŸå› ï¼š é¿å…é€’å½’è§£æä¸­å‡ºç°é”™è¯¯æˆ–æ­»å¾ªç¯ åœ¨ç±»çš„è§£æè¿‡ç¨‹ä¸­ï¼Œå¦‚æœè¯¥ç±»å¼•ç”¨äº†å¦ä¸€ä¸ªè¿˜æ²¡åŠ è½½çš„ç±»ï¼Œç«‹å³è§£æå¯èƒ½ä¼šå¯¼è‡´æ— é™é€’å½’æˆ–åŠ è½½é¡ºåºé—®é¢˜ã€‚é€šè¿‡å»¶è¿Ÿè§£æï¼Œå¯ä»¥æ›´å¥½åœ°æ§åˆ¶åŠ è½½æµç¨‹ã€‚ æé«˜åŠ è½½æ•ˆç‡ åŠ è½½ç±»å¯èƒ½ä¸ä¸€å®šé©¬ä¸Šå°±ç”¨åˆ°æ‰€æœ‰æ–¹æ³•ã€å­—æ®µç­‰ç¬¦å·å¼•ç”¨ï¼Œæ¨è¿Ÿè§£æå¯ä»¥æé«˜æ€§èƒ½ï¼Œå°¤å…¶åœ¨æ‰¹é‡åŠ è½½å¾ˆå¤šç±»æ—¶ã€‚ æ›´çµæ´»åœ°å¤„ç†ç±»çš„ä¾èµ– å¼€å‘è€…å¯ä»¥å…ˆåŠ è½½ç±»ï¼Œç¨åæ ¹æ®éœ€è¦å†è§£æã€‚ä¾‹å¦‚ï¼Œåœ¨è‡ªå®šä¹‰ç±»åŠ è½½å™¨ä¸­ï¼Œå¯èƒ½å…ˆåˆ¤æ–­ç±»æ˜¯å¦å·²ç»å­˜åœ¨ã€æ˜¯å¦éœ€è¦è¢«å¢å¼ºï¼ˆæ¯”å¦‚å­—èŠ‚ç å¢å¼ºï¼‰ï¼Œå†å†³å®šæ˜¯å¦è§£æã€‚ é€šè¿‡ç±»åŠ è½½å™¨å¼•â¼Šå¤–éƒ¨JaråŒ… è™½ç„¶é€šå¸¸æˆ‘ä»¬ä¼šå°†ä¾èµ–çš„ jar åŒ…ç›´æ¥æ”¾å…¥é¡¹ç›®çš„ classpath ä¸­ï¼ˆæ¯”å¦‚é€šè¿‡æ„å»ºå·¥å…·å¦‚ Maven æˆ– Gradle ç®¡ç†ï¼‰ï¼Œä½†åœ¨æŸäº›ç‰¹å®šåœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬ç¡®å®éœ€è¦åŠ¨æ€åœ°é€šè¿‡ URLClassLoader åŠ è½½å¤–éƒ¨ jar åŒ…ï¼Œè¿™æ˜¯ Java æä¾›çš„ä¸€ç§æ›´çµæ´»çš„ç±»åŠ è½½æœºåˆ¶ã€‚ ä»¥ä¸‹æ˜¯ä¸€äº›å¿…é¡»æˆ–æ¨èä½¿ç”¨ URLClassLoader çš„å…¸å‹åº”ç”¨åœºæ™¯ï¼š 1. æ’ä»¶æœºåˆ¶ï¼ˆPlugin Systemï¼‰ åœºæ™¯è¯´æ˜ï¼š ç³»ç»Ÿæ”¯æŒç”¨æˆ·è‡ªå®šä¹‰æ’ä»¶ï¼ˆå¦‚ IDE æ’ä»¶ã€æµè§ˆå™¨æ‰©å±•ã€æ¸¸æˆ modï¼‰ï¼Œè¿™äº›æ’ä»¶åœ¨è¿è¡Œæ—¶æ‰åŠ è½½ï¼Œé¡¹ç›®æœ¬èº«åœ¨ç¼–è¯‘æœŸå¹¶ä¸çŸ¥é“æœ‰å“ªäº›æ’ä»¶ã€‚ ä¸¾ä¾‹ï¼š Eclipse æˆ– IntelliJ çš„æ’ä»¶ç³»ç»Ÿ Minecraft çš„ mod åŠ è½½å™¨ Spring Boot Devtools é‡æ–°åŠ è½½æœºåˆ¶ ä¸ºä»€ä¹ˆä¸èƒ½ç›´æ¥æ”¾å…¥ classpathï¼Ÿ å› ä¸ºæ’ä»¶æ˜¯åŠ¨æ€å‘ç°å’ŒåŠ è½½çš„ï¼Œä¸æ˜¯ç¼–è¯‘æ—¶ç¡®å®šçš„ã€‚ 2. çƒ­éƒ¨ç½² / åŠ¨æ€åŠ è½½ç±» åœºæ™¯è¯´æ˜ï¼š ä½ æƒ³åœ¨åº”ç”¨è¿è¡Œè¿‡ç¨‹ä¸­åŠ è½½æ–°çš„ jar æˆ–ç±»ï¼Œæ¯”å¦‚çƒ­æ›´æ–°ä¸€ä¸ªæ¨¡å—è€Œæ— éœ€é‡å¯æœåŠ¡ã€‚ ä¸¾ä¾‹ï¼š Web å®¹å™¨ï¼ˆå¦‚ Tomcatï¼‰çš„åº”ç”¨é‡æ–°éƒ¨ç½² ä½¿ç”¨ URLClassLoader åŠ è½½æŸä¸ªæ¨¡å—çš„æ–°ç‰ˆæœ¬ä»¥å®ç°çƒ­æ›¿æ¢ ä¸ºä»€ä¹ˆä¸èƒ½æ”¾å…¥ classpathï¼Ÿ classpath åœ¨å¯åŠ¨æ—¶å°±å›ºå®šäº†ï¼Œä¸èƒ½åŠ¨æ€æ·»åŠ ï¼›è€Œ URLClassLoader å¯ä»¥è¿è¡Œæ—¶åŠ è½½æ–° jarã€‚ 3. å¤šç‰ˆæœ¬éš”ç¦» åœºæ™¯è¯´æ˜ï¼š ä½ å¸Œæœ›ä¸åŒçš„æ¨¡å—ä½¿ç”¨åŒä¸€ä¸ªåº“çš„ä¸åŒç‰ˆæœ¬ï¼Œä½† classpath æ— æ³•æ”¯æŒä¸¤ä¸ªç‰ˆæœ¬çš„åŒä¸€ä¸ªç±»ã€‚ ä¸¾ä¾‹ï¼š ä¸€ä¸ªæœåŠ¡å™¨è¿è¡Œå¤šä¸ªæœåŠ¡å®ä¾‹ï¼Œå®ƒä»¬åˆ†åˆ«ä¾èµ– log4j çš„ä¸åŒç‰ˆæœ¬ ä¸€ä¸ªç³»ç»Ÿçš„æ’ä»¶ A ä½¿ç”¨ fastjson 1.xï¼Œæ’ä»¶ B ä½¿ç”¨ fastjson 2.x ä¸ºä»€ä¹ˆä¸èƒ½æ”¾å…¥ classpathï¼Ÿ classpath æ˜¯å…±äº«çš„ï¼Œä¼šå‘ç”Ÿç±»å†²çªã€‚ä½¿ç”¨å¤šä¸ª URLClassLoaderï¼Œå¯å®ç°ç±»éš”ç¦»ã€‚ 4. è„šæœ¬æˆ–ç”¨æˆ·ä¸Šä¼ ä»£ç æ‰§è¡Œ åœºæ™¯è¯´æ˜ï¼š ç³»ç»Ÿå…è®¸ç”¨æˆ·ä¸Šä¼  jar æˆ– class æ–‡ä»¶ï¼Œç„¶ååœ¨æœåŠ¡ç«¯æ‰§è¡Œå…¶ä¸­çš„ç±»é€»è¾‘ã€‚ ä¸¾ä¾‹ï¼š åœ¨çº¿ç¼–ç¨‹å¹³å°ï¼ˆå¦‚ LeetCode åç«¯ï¼‰ ç”¨æˆ·ä¸Šä¼ ç®—æ³• jarï¼Œå¹³å°è¿è¡Œå¹¶è¿”å›ç»“æœ ä¸ºä»€ä¹ˆä¸èƒ½æ”¾å…¥ classpathï¼Ÿ ç”¨æˆ·ä¸Šä¼ å†…å®¹æ˜¯åŠ¨æ€çš„ï¼Œç³»ç»Ÿåœ¨è¿è¡Œå‰æ— æ³•é¢„çŸ¥ã€‚ 5. å®ç°ç±»çš„å»¶è¿ŸåŠ è½½ï¼ˆèŠ‚çœèµ„æºï¼‰ åœºæ™¯è¯´æ˜ï¼š æŸäº›ç±»/æ¨¡å—ä½“ç§¯è¾ƒå¤§æˆ–ä¾èµ–è¾ƒå¤šï¼Œä¸å¸Œæœ›åœ¨ç¨‹åºå¯åŠ¨æ—¶å°±åŠ è½½ï¼Œåªæœ‰çœŸæ­£ä½¿ç”¨æ—¶å†åŠ è½½ã€‚ ä¸¾ä¾‹ï¼š å¤§å‹æ¡Œé¢åº”ç”¨ï¼ˆå¦‚ IntelliJï¼‰åœ¨æ‰“å¼€æŸä¸ªåŠŸèƒ½æ¨¡å—æ—¶æ‰åŠ è½½ç›¸åº” jar æ€»ç»“ åœºæ™¯ ä½¿ç”¨ URLClassLoader çš„åŸå›  æ’ä»¶ç³»ç»Ÿ æ’ä»¶åŠ¨æ€åŠ è½½ï¼Œä¸åœ¨é¡¹ç›®ç¼–è¯‘æ—¶å¯çŸ¥ çƒ­éƒ¨ç½² åŠ¨æ€æ›¿æ¢æ¨¡å—ï¼Œæ— éœ€é‡å¯ å¤šç‰ˆæœ¬å…±å­˜ é¿å…ç±»å†²çªï¼Œå®ç°ç±»åŠ è½½éš”ç¦» ç”¨æˆ·ä¸Šä¼  jar å†…å®¹åŠ¨æ€ç”Ÿæˆï¼Œclasspath æ— æ³•é¢„å…ˆé…ç½® å»¶è¿ŸåŠ è½½æ¨¡å— å¯åŠ¨æ›´å¿«ï¼ŒèŠ‚çœå†…å­˜ å¦‚æœä½ æ˜¯åœ¨åšæ¡†æ¶è®¾è®¡æˆ–éœ€è¦åŠ¨æ€æ‰©å±•èƒ½åŠ›çš„åœºæ™¯ï¼Œç†è§£å¹¶ä½¿ç”¨ URLClassLoader ä¼šéå¸¸æœ‰å¸®åŠ©ã€‚ åœºæ™¯å‡è®¾ è°ƒç”¨å¤–éƒ¨jar æˆ‘ä»¬æœ‰ä¸€ä¸ªå¤–éƒ¨ jar æ–‡ä»¶ï¼šhello-plugin.jarï¼Œå®ƒåŒ…å«ä¸€ä¸ªç±»ï¼š 12345678// è¿™ä¸ªç±»ç¼–è¯‘åæ‰“åŒ…è¿› hello-plugin.jarpackage com.example.plugin;public class HelloPlugin &#123; public void sayHello(String name) &#123; System.out.println(&quot;Hello from plugin! :&quot; + name); &#125;&#125; ä¸»ç¨‹åºä½¿ç”¨ URLClassLoader åŠ¨æ€åŠ è½½è¿™ä¸ª jar 12345678910111213141516171819202122232425262728import java.io.File;import java.lang.reflect.Method;import java.net.URL;import java.net.URLClassLoader;public class PluginLoader &#123; public static void main(String[] args) throws Exception &#123; // å¤–éƒ¨ jar çš„è·¯å¾„ File jarFile = new File(&quot;plugins/hello-plugin.jar&quot;); URL jarUrl = jarFile.toURI().toURL(); // HTTPS jar çš„ URL // URL jarUrl = new URL(&quot;https://your-domain.com/libs/hello-plugin.jar&quot;); // æ„å»º URLClassLoaderï¼ˆä¹Ÿå¯ä»¥è®¾ç½®çˆ¶åŠ è½½å™¨ï¼‰ URLClassLoader classLoader = new URLClassLoader(new URL[]&#123;jarUrl&#125;); // åŠ è½½æ’ä»¶ç±» Class&lt;?&gt; clazz = classLoader.loadClass(&quot;com.example.plugin.HelloPlugin&quot;); // åˆ›å»ºå®ä¾‹å¹¶è°ƒç”¨æ–¹æ³• Object plugin = clazz.getDeclaredConstructor().newInstance(); Method sayHello = clazz.getMethod(&quot;sayHello&quot;, String.class); sayHello.invoke(plugin, &quot;World&quot;); // å…³é—­ ClassLoaderï¼ˆJava 7+ æ¨èï¼‰ classLoader.close(); &#125;&#125; è¿è¡Œæ—¶åŠ¨æ€ç¼–è¯‘ Java æºä»£ç  æˆ‘ä»¬æœ‰ä¸€ä¸ª java ä»£ç ç‰‡æ®µï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364import javax.tools.JavaCompiler;import javax.tools.ToolProvider;import java.io.File;import java.io.FileWriter;import java.lang.reflect.Method;import java.net.URL;import java.net.URLClassLoader;import java.nio.file.Files;import java.nio.file.Path;public class DynamicJavaRunner &#123; public static void main(String[] args) throws Exception &#123; String className = &quot;com.example.dynamic.Hello&quot;; // Java æºä»£ç  String sourceCode = &quot;package com.example.dynamic;\\n&quot; + &quot;\\n&quot; + &quot;public class Hello &#123;\\n&quot; + &quot; public void say() &#123;\\n&quot; + &quot; System.out.println(\\&quot;Hello from dynamic source!\\&quot;);\\n&quot; + &quot; &#125;\\n&quot; + &quot;&#125;\\n&quot;; // åˆ›å»ºä¸´æ—¶ç›®å½• Path tempDir = Files.createTempDirectory(&quot;dynamic-classes&quot;); File outputDir = tempDir.toFile(); // System.out.println(&quot;ä¸´æ—¶ç›®å½•ï¼š&quot; + outputDir.getAbsolutePath()); // åˆ›å»º .java æ–‡ä»¶ File javaFile = new File(outputDir, &quot;com/example/dynamic/Hello.java&quot;); javaFile.getParentFile().mkdirs(); try (FileWriter writer = new FileWriter(javaFile)) &#123; writer.write(sourceCode); &#125; // ç¼–è¯‘ Java æ–‡ä»¶ JavaCompiler compiler = ToolProvider.getSystemJavaCompiler(); if (compiler == null) &#123; System.err.println(&quot;è¯·ç”¨ JDK è€Œé JRE è¿è¡Œï¼&quot;); return; &#125; int result = compiler.run(null, null, null, javaFile.getPath()); if (result != 0) &#123; System.err.println(&quot;ç¼–è¯‘å¤±è´¥ï¼&quot;); return; &#125; // åŠ è½½ç±»å¹¶è°ƒç”¨ URLClassLoader classLoader = new URLClassLoader(new URL[]&#123;outputDir.toURI().toURL()&#125;); Class&lt;?&gt; clazz = classLoader.loadClass(className); Object instance = clazz.getDeclaredConstructor().newInstance(); Method method = clazz.getMethod(&quot;say&quot;); method.invoke(instance); // æ¸…ç†ï¼ˆå¯é€‰ï¼‰ classLoader.close(); // åˆ é™¤ä¸´æ—¶ç›®å½• Files.walk(outputDir.toPath()) .sorted(Comparator.reverseOrder()) // å…ˆåˆ æ–‡ä»¶ï¼Œå†åˆ ç›®å½• .map(Path::toFile) .forEach(File::delete); &#125;&#125; å…³é”®ç‚¹è¯´æ˜ æœºåˆ¶ è¯´æ˜ JavaCompiler JDK è‡ªå¸¦çš„ç¼–è¯‘å™¨ï¼ˆtools.jarï¼‰ ToolProvider.getSystemJavaCompiler() åªèƒ½åœ¨ JDK ç¯å¢ƒä¸­å·¥ä½œï¼ŒJRE æ— æ³•ä½¿ç”¨ URLClassLoader ç”¨äºåŠ è½½ç¼–è¯‘åçš„ .class æ–‡ä»¶ FileWriter ä¿å­˜ä»£ç ä¸ºä¸´æ—¶ Java æ–‡ä»¶ è‡ªå®šä¹‰ç±»åŠ è½½å™¨ è¦è‡ªå®šä¹‰ ClassLoaderï¼Œåªéœ€è¦ç»§æ‰¿äº ClassLoader æˆ–è€… SecureClassLoaderï¼Œå¹¶é‡å†™ findClass() æ–¹æ³•å³å¯ ç¤ºä¾‹ï¼šæˆ‘ä»¬å¯¹ä¸Šé¢çš„ä»£ç è¿›è¡Œå‡çº§ï¼Œä¸åˆ›å»ºä¸´æ—¶æ–‡ä»¶ï¼Œè€Œæ˜¯åœ¨å†…å­˜ä¸­ç¼–è¯‘ä»£ç ï¼Œå¹¶ä»å†…å­˜ä¸­åŠ è½½å­—èŠ‚ç ï¼Œè€Œä¸ä¾èµ–ç£ç›˜æ–‡ä»¶ï¼Œæ›´é«˜æ•ˆä¹Ÿæ›´é€‚åˆç”Ÿäº§ç¯å¢ƒä¸­åŠ¨æ€ç±»åŠ è½½ï¼ˆå¦‚åœ¨çº¿ä»£ç æ‰§è¡Œã€è„šæœ¬å¼•æ“ç­‰ï¼‰ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114import javax.tools.*;import java.io.*;import java.net.URI;import java.util.*;import java.lang.reflect.*;public class InMemoryJavaRunner &#123; public static void main(String[] args) throws Exception &#123; String className = &quot;com.example.dynamic.Hello&quot;; String sourceCode = &quot;package com.example.dynamic;\\n&quot; + &quot;public class Hello &#123;\\n&quot; + &quot; public void say() &#123;\\n&quot; + &quot; System.out.println(\\&quot;Hello from memory compiled class!\\&quot;);\\n&quot; + &quot; &#125;\\n&quot; + &quot;&#125;&quot;; // è·å–ç³»ç»Ÿ Java ç¼–è¯‘å™¨ JavaCompiler compiler = ToolProvider.getSystemJavaCompiler(); if (compiler == null) &#123; System.err.println(&quot;è¯·ä½¿ç”¨ JDK è¿è¡Œæ­¤ç¨‹åºï¼ˆé JREï¼‰&quot;); return; &#125; // å‡†å¤‡ç¼–è¯‘æºä»£ç ï¼šä¸€ä¸ª JavaFileObject è¡¨ç¤ºæºä»£ç  JavaFileObject sourceFile = new JavaSourceFromString(className, sourceCode); // åˆ›å»ºè‡ªå®šä¹‰çš„å†…å­˜æ–‡ä»¶ç®¡ç†å™¨ï¼ˆæ›¿ä»£æ ‡å‡†çš„ç£ç›˜ç®¡ç†å™¨ï¼‰ StandardJavaFileManager standardFileManager = compiler.getStandardFileManager(null, null, null); MemoryJavaFileManager fileManager = new MemoryJavaFileManager(standardFileManager); // æ‰§è¡Œç¼–è¯‘ä»»åŠ¡ JavaCompiler.CompilationTask task = compiler.getTask(null, fileManager, null, null, null, Collections.singletonList(sourceFile)); boolean success = task.call(); if (!success) &#123; System.err.println(&quot;ç¼–è¯‘å¤±è´¥ï¼&quot;); return; &#125; // åŠ è½½ç¼–è¯‘åçš„ç±» Map&lt;String, byte[]&gt; classBytes = fileManager.getClassBytes(); InMemoryClassLoader classLoader = new InMemoryClassLoader(classBytes); Class&lt;?&gt; clazz = classLoader.loadClass(className); Object instance = clazz.getDeclaredConstructor().newInstance(); Method method = clazz.getMethod(&quot;say&quot;); method.invoke(instance); &#125; // ç”¨äºè¡¨ç¤ºå†…å­˜ä¸­çš„ Java æºä»£ç  static class JavaSourceFromString extends SimpleJavaFileObject &#123; final String code; JavaSourceFromString(String className, String code) &#123; super(URI.create(&quot;string:///&quot; + className.replace(&#x27;.&#x27;, &#x27;/&#x27;) + Kind.SOURCE.extension), Kind.SOURCE); this.code = code; &#125; public CharSequence getCharContent(boolean ignoreEncodingErrors) &#123; return code; &#125; &#125; // å°†ç¼–è¯‘çš„ class æ–‡ä»¶ä¿å­˜åœ¨å†…å­˜ä¸­ï¼ˆä¸æ˜¯æ–‡ä»¶ç³»ç»Ÿï¼‰ static class MemoryJavaFileManager extends ForwardingJavaFileManager&lt;StandardJavaFileManager&gt; &#123; private final Map&lt;String, ByteArrayOutputStream&gt; classOutputBuffers = new HashMap&lt;&gt;(); MemoryJavaFileManager(StandardJavaFileManager standardManager) &#123; super(standardManager); &#125; @Override public JavaFileObject getJavaFileForOutput(Location location, String className, JavaFileObject.Kind kind, FileObject sibling) &#123; ByteArrayOutputStream outputStream = new ByteArrayOutputStream(); classOutputBuffers.put(className, outputStream); return new SimpleJavaFileObject( URI.create(&quot;mem:///&quot; + className.replace(&#x27;.&#x27;, &#x27;/&#x27;) + kind.extension), kind) &#123; @Override public OutputStream openOutputStream() &#123; return outputStream; &#125; &#125;; &#125; public Map&lt;String, byte[]&gt; getClassBytes() &#123; Map&lt;String, byte[]&gt; result = new HashMap&lt;&gt;(); for (Map.Entry&lt;String, ByteArrayOutputStream&gt; entry : classOutputBuffers.entrySet()) &#123; result.put(entry.getKey(), entry.getValue().toByteArray()); &#125; return result; &#125; &#125; // è‡ªå®šä¹‰ ClassLoaderï¼Œç”¨äºä»å†…å­˜ä¸­åŠ è½½å­—èŠ‚ç  static class InMemoryClassLoader extends ClassLoader &#123; private final Map&lt;String, byte[]&gt; classBytes; public InMemoryClassLoader(Map&lt;String, byte[]&gt; classBytes) &#123; super(ClassLoader.getSystemClassLoader()); this.classBytes = classBytes; &#125; @Override protected Class&lt;?&gt; findClass(String name) throws ClassNotFoundException &#123; // ä»å†…å­˜ä¸­è·å–å­—èŠ‚ç  byte[] bytes = classBytes.get(name); if (bytes == null) &#123; return super.findClass(name); &#125; // å®šä¹‰ç±»å¹¶è¿”å›ï¼Œä¸€å®šè¦ä½¿ç”¨ defineClass æ–¹æ³• return defineClass(name, bytes, 0, bytes.length); &#125; &#125;&#125; è¿›ä¸€æ­¥å‡çº§ï¼šæˆ‘ä»¬ç°åœ¨å°†è¿™ä¸ªç³»ç»Ÿæ‰©å±•ä¸ºæ”¯æŒå¤šä¸ªç±»åŒæ—¶åŠ¨æ€ç¼–è¯‘ã€å†…å­˜åŠ è½½å¹¶æ‰§è¡Œã€‚è¿™å¯¹äºéœ€è¦å¤„ç†å¤šä¸ªç±»ï¼ˆä¾‹å¦‚æ¥å£ + å®ç°ã€å†…éƒ¨ä¾èµ–ç­‰ï¼‰éå¸¸å®ç”¨ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127import javax.tools.*;import java.io.*;import java.net.URI;import java.util.*;import java.lang.reflect.*;// ä¸»ç±»public class MultiClassInMemoryCompiler &#123; public static void main(String[] args) throws Exception &#123; // å‡†å¤‡å¤šä¸ªç±»çš„æºä»£ç  Map&lt;String, String&gt; sources = new HashMap&lt;&gt;(); sources.put(&quot;com.example.api.Greeter&quot;, &quot;package com.example.api;\\n&quot; + &quot;public interface Greeter &#123;\\n&quot; + &quot; void greet();\\n&quot; + &quot;&#125;\\n&quot;); sources.put(&quot;com.example.impl.EnglishGreeter&quot;, &quot;package com.example.impl;\\n&quot; + &quot;import com.example.api.Greeter;\\n&quot; + &quot;public class EnglishGreeter implements Greeter &#123;\\n&quot; + &quot; public void greet() &#123;\\n&quot; + &quot; System.out.println(\\&quot;Hello from EnglishGreeter!\\&quot;);\\n&quot; + &quot; &#125;\\n&quot; + &quot;&#125;\\n&quot;); String entryClassName = &quot;com.example.impl.EnglishGreeter&quot;; // ç¼–è¯‘ Map&lt;String, byte[]&gt; compiledClasses = compile(sources); if (compiledClasses == null) &#123; System.err.println(&quot;ç¼–è¯‘å¤±è´¥&quot;); return; &#125; // åŠ è½½å¹¶æ‰§è¡Œ InMemoryClassLoader classLoader = new InMemoryClassLoader(compiledClasses); Class&lt;?&gt; clazz = classLoader.loadClass(entryClassName); Object obj = clazz.getDeclaredConstructor().newInstance(); Method method = clazz.getMethod(&quot;greet&quot;); method.invoke(obj); &#125; // ç¼–è¯‘å™¨å…¥å£ï¼Œæ”¯æŒå¤šä¸ªç±» public static Map&lt;String, byte[]&gt; compile(Map&lt;String, String&gt; sources) &#123; JavaCompiler compiler = ToolProvider.getSystemJavaCompiler(); if (compiler == null) &#123; System.err.println(&quot;è¯·ä½¿ç”¨ JDK è¿è¡Œ&quot;); return null; &#125; List&lt;JavaFileObject&gt; compilationUnits = new ArrayList&lt;&gt;(); for (Map.Entry&lt;String, String&gt; entry : sources.entrySet()) &#123; compilationUnits.add(new JavaSourceFromString(entry.getKey(), entry.getValue())); &#125; StandardJavaFileManager stdManager = compiler.getStandardFileManager(null, null, null); MemoryJavaFileManager memManager = new MemoryJavaFileManager(stdManager); JavaCompiler.CompilationTask task = compiler.getTask(null, memManager, null, null, null, compilationUnits); boolean success = task.call(); return success ? memManager.getClassBytes() : null; &#125; // æºæ–‡ä»¶è¡¨ç¤ºï¼ˆJava ä»£ç ä»¥å­—ç¬¦ä¸²æä¾›ï¼‰ static class JavaSourceFromString extends SimpleJavaFileObject &#123; final String code; JavaSourceFromString(String className, String code) &#123; super(URI.create(&quot;string:///&quot; + className.replace(&#x27;.&#x27;, &#x27;/&#x27;) + Kind.SOURCE.extension), Kind.SOURCE); this.code = code; &#125; @Override public CharSequence getCharContent(boolean ignoreEncodingErrors) &#123; return code; &#125; &#125; // å†…å­˜ä¸­çš„ç¼–è¯‘è¾“å‡ºç®¡ç†å™¨ static class MemoryJavaFileManager extends ForwardingJavaFileManager&lt;StandardJavaFileManager&gt; &#123; private final Map&lt;String, ByteArrayOutputStream&gt; classOutputBuffers = new HashMap&lt;&gt;(); MemoryJavaFileManager(StandardJavaFileManager standardManager) &#123; super(standardManager); &#125; @Override public JavaFileObject getJavaFileForOutput(Location location, String className, JavaFileObject.Kind kind, FileObject sibling) &#123; ByteArrayOutputStream outputStream = new ByteArrayOutputStream(); classOutputBuffers.put(className, outputStream); return new SimpleJavaFileObject( URI.create(&quot;mem:///&quot; + className.replace(&#x27;.&#x27;, &#x27;/&#x27;) + kind.extension), kind) &#123; @Override public OutputStream openOutputStream() &#123; return outputStream; &#125; &#125;; &#125; public Map&lt;String, byte[]&gt; getClassBytes() &#123; Map&lt;String, byte[]&gt; result = new HashMap&lt;&gt;(); for (Map.Entry&lt;String, ByteArrayOutputStream&gt; entry : classOutputBuffers.entrySet()) &#123; result.put(entry.getKey(), entry.getValue().toByteArray()); &#125; return result; &#125; &#125; // ç”¨äºåŠ è½½å†…å­˜ä¸­çš„ class static class InMemoryClassLoader extends ClassLoader &#123; private final Map&lt;String, byte[]&gt; classBytes; public InMemoryClassLoader(Map&lt;String, byte[]&gt; classBytes) &#123; super(ClassLoader.getSystemClassLoader()); this.classBytes = classBytes; &#125; @Override protected Class&lt;?&gt; findClass(String name) throws ClassNotFoundException &#123; byte[] bytes = classBytes.get(name); if (bytes == null) return super.findClass(name); return defineClass(name, bytes, 0, bytes.length); &#125; &#125;&#125; æ‰“ç ´åŒäº²å§”æ´¾ï¼Œå®ç°åŒç±»å¤šç‰ˆæœ¬å…±å­˜ å‡è®¾æˆ‘ä»¬æœ‰åŒä¸€ä¸ªjaråŒ…çš„ä¸åŒç‰ˆæœ¬ï¼Œæ¯”å¦‚ï¼ša-1.0.jarå’Œa-2.0.jarï¼Œä»–ä»¬å…·æœ‰åŒåçš„ DemoClassç±» ,ç³»ç»Ÿclasspathä¸­å¼•å…¥çš„æ˜¯ a-1.0.jarï¼Œè€Œæ­¤æ—¶æˆ‘ä»¬é€šè¿‡â¾ƒå®šçš„ClassLoaderåŠ è½½ a-2.0.jarï¼Œå¹¶è°ƒç”¨ DemoClassç±» ï¼Œæˆ‘ä»¬ä¼šå‘ç°ï¼Œâ¾ƒå®šçš„ClassLoaderåŠ è½½çš„ç±»ä¾æ—§æ˜¯ a-1.0.jar ä¸­çš„ç±»ï¼Œè€Œä¸æ˜¯ a-2.0.jar ä¸­çš„ç±»ã€‚ ä¸ºä»€ä¹ˆä¼šå‡ºç°è¿™ç§æƒ…å†µå‘¢ï¼Ÿè¿™å°±æ˜¯å› ä¸ºJDKçš„åŒäº²å§”æ´¾æœºåˆ¶ã€‚â¾ƒå®šçš„ClassLoaderçš„parentå±æ€§æŒ‡å‘çš„æ˜¯JDKå†…çš„AppClassLoaderï¼Œâ½½ AppClassLoader ä¼šåŠ è½½ç³»ç»Ÿå½“ä¸­çš„æ‰€æœ‰ä»£ç ï¼Œå°±åŒ…æ‹¬ a-1.0.jarä¸­çš„ DemoClassç±»ã€‚è¿™æ—¶ï¼Œâ¾ƒå®šçš„ClassLoaderå»åŠ è½½ DemoClassç±»æ—¶ï¼Œé€šè¿‡åŒäº²å§”æ´¾å‘ä¸ŠæŸ¥æ‰¾ï¼Œâ¾ƒç„¶åŠ è½½å‡ºæ¥çš„å°±æ˜¯APPClassloaderä¸­çš„DemoClassäº†ã€‚ å¦‚ä½•æ‰“ç ´åŒäº²å§”æ´¾å‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥é€šè¿‡é‡å†™ loadClass()æ–¹æ³•ï¼Œæ¥æ‰“ç ´åŒäº²å§”æ´¾ï¼Œå®ç°ç±»â½‚ä»¶çš„åŠ è½½ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152import java.io.ByteArrayOutputStream;import java.io.InputStream;import java.net.URL;import java.net.URLConnection;import java.security.SecureClassLoader;public class CustomClassLoader extends SecureClassLoader &#123; private URL jarUrl; public CustomClassLoader(URL jarUrl) &#123; // åˆ›å»ºä¸€ä¸ªç‹¬ç«‹çš„å­ç±»åŠ è½½å™¨ï¼ŒåªåŠ è½½æŒ‡å®š JAR this.jarUrl = jarUrl; &#125; @Override public Class&lt;?&gt; loadClass(String name, boolean resolve) throws ClassNotFoundException &#123; // æŠŠåŒäº²å§”æ´¾æœºåˆ¶åè¿‡æ¥ï¼Œå…ˆåˆ°â¼¦ç±»åŠ è½½å™¨ä¸­åŠ è½½ï¼ŒåŠ è½½ä¸åˆ°å†å»â½—ç±»åŠ è½½å™¨ä¸­åŠ è½½ã€‚ synchronized (getClassLoadingLock(name)) &#123; // å¦‚æœç±»å·²åŠ è½½ï¼Œåˆ™ç›´æ¥è¿”å› Class&lt;?&gt; loadedClass = findLoadedClass(name); if (loadedClass == null) &#123; loadedClass = findClass(name); &#125; else &#123; // å§”æ´¾ç»™çˆ¶ç±»åŠ è½½å™¨ loadedClass = super.loadClass(name, resolve); &#125; return loadedClass; &#125; &#125; @Override protected Class&lt;?&gt; findClass(String name) &#123; int code; try &#123; // è®¿é—®jaråŒ…çš„url URLConnection urlConnection = jarUrl.openConnection(); urlConnection.setUseCaches(false); InputStream is = urlConnection.getInputStream(); ByteArrayOutputStream bos = new ByteArrayOutputStream(); while ((code = is.read()) != -1) &#123; bos.write(code); &#125; byte[] data = bos.toByteArray(); is.close(); bos.close(); return defineClass(name, data, 0, data.length); &#125; catch (Exception e) &#123; return null; &#125; &#125;&#125; æµ‹è¯•ä»£ç  12345678910111213141516import java.io.File;import java.net.URL;public class Test &#123; public static void main(String[] args) throws Exception &#123; File jarFile = new File(&quot;path/to/a-2.0.jar&quot;); URL jarUrl = jarFile.toURI().toURL(); CustomClassLoader loader = new CustomClassLoader(jarUrl); // åŠ è½½ DemoClass Class&lt;?&gt; clazz = loader.loadClass(&quot;com.example.DemoClass&quot;); Object obj = clazz.getDeclaredConstructor().newInstance(); clazz.getMethod(&quot;print&quot;).invoke(obj); &#125;&#125; æ‰“ç ´åŒäº²å§”æ´¾æœºåˆ¶çš„å…¸å‹åœºæ™¯ Tomcatç±»åŠ è½½å™¨ CommonClassLoaderï¼šTomcatæœ€åŸºæœ¬çš„ç±»åŠ è½½å™¨ï¼ŒåŠ è½½è·¯å¾„ä¸­çš„classå¯ä»¥è¢«Tomcatå®¹å™¨æœ¬èº«ä»¥åŠå„ä¸ªWebappè®¿é—®ï¼› CatalinaClassLoaderï¼šTomcatå®¹å™¨ç§æœ‰çš„ç±»åŠ è½½å™¨ï¼ŒåŠ è½½è·¯å¾„ä¸­çš„classå¯¹äºWebappä¸å¯â»…ï¼› SharedClassLoaderï¼šå„ä¸ªWebappå…±äº«çš„ç±»åŠ è½½å™¨ï¼ŒåŠ è½½è·¯å¾„ä¸­çš„classå¯¹äºæ‰€æœ‰Webappå¯â»…ï¼Œä½†æ˜¯å¯¹äºTomcatå®¹å™¨ä¸å¯â»…ï¼› WebappClassLoaderï¼šå„ä¸ªWebappç§æœ‰çš„ç±»åŠ è½½å™¨ï¼ŒåŠ è½½è·¯å¾„ä¸­çš„classåªå¯¹å½“å‰Webappå¯â»…ï¼Œâ½å¦‚åŠ è½½waråŒ…â¾¥ç›¸å…³çš„ç±»ï¼Œæ¯ä¸ªwaråŒ…åº”â½¤éƒ½æœ‰â¾ƒâ¼°çš„WebappClassLoaderï¼Œå®ç°ç›¸äº’éš”ç¦»ï¼Œâ½å¦‚ä¸åŒwaråŒ…åº”â½¤å¼•â¼Šäº†ä¸åŒçš„springç‰ˆæœ¬ï¼Œè¿™æ ·å®ç°å°±èƒ½åŠ è½½å„â¾ƒçš„springç‰ˆæœ¬ï¼› Jspç±»åŠ è½½å™¨ï¼šé’ˆå¯¹æ¯ä¸ªJSPâ»šâ¾¯åˆ›å»ºâ¼€ä¸ªåŠ è½½å™¨ã€‚è¿™ä¸ªåŠ è½½å™¨â½è¾ƒè½»é‡çº§ï¼Œæ‰€ä»¥Tomcatè¿˜å®ç°äº†çƒ­åŠ è½½ï¼Œä¹Ÿå°±æ˜¯JSPåªè¦ä¿®æ”¹äº†ï¼Œå°±åˆ›å»ºâ¼€ä¸ªæ–°çš„åŠ è½½å™¨ï¼Œä»â½½å®ç°äº†JSPâ»šâ¾¯çš„çƒ­æ›´æ–°ã€‚","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç»JVMçš„ç±»åŠ è½½å™¨ The JavaÂ® Virtual Machine Specification ç‰ˆæœ¬jdk1.8","date_published":"2025-05-08T13:30:05.000Z","tags":["æŠ€æœ¯","jvm","jvm"]},{"id":"https://blog.hanqunfeng.com/2025/04/22/elasticsearch-06-api-aggs/","url":"https://blog.hanqunfeng.com/2025/04/22/elasticsearch-06-api-aggs/","title":"Elasticsearch çš„ REST APIs:èšåˆæŸ¥è¯¢","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç» Elasticsearch çš„ REST APIsï¼šèšåˆæŸ¥è¯¢</p>\n</li>\n<li class=\"lvl-2\">\n<p>Elasticsearchç‰ˆæœ¬8.17.3</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://www.elastic.co/guide/en/elasticsearch/reference/8.17/rest-apis.html\">å®˜æ–¹æ–‡æ¡£:REST APIs</a></p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://www.elastic.co/guide/en/elasticsearch/reference/8.17/search-aggregations.html\">å®˜æ–¹æ–‡æ¡£:Aggregations</a></p>\n</li>\n<li class=\"lvl-2\">\n<a href=\"/2025/04/17/elasticsearch-05-api/\" title=\"Elasticsearch çš„ REST APIs\">Elasticsearch çš„ REST APIs</a>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"èšåˆæŸ¥è¯¢\">èšåˆæŸ¥è¯¢</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><a href=\"https://www.elastic.co/guide/en/elasticsearch/reference/current/search-aggregations.html\">èšåˆæŸ¥è¯¢</a>ï¼Œå¯ä»¥è®©æˆ‘ä»¬æå…¶æ–¹ä¾¿çš„å®ç°å¯¹ç´¢å¼•æ•°æ®çš„ç»Ÿè®¡ã€åˆ†æã€è¿ç®—ç­‰æ“ä½œã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>åŸºæœ¬è¯­æ³•åŒ…æ‹¬ä»¥ä¸‹éƒ¨åˆ†ï¼š</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">æŸ¥è¯¢æ¡ä»¶ï¼šæŒ‡å®šéœ€è¦èšåˆçš„æ–‡æ¡£ï¼Œå¯ä»¥ä½¿ç”¨æ ‡å‡†çš„ Elasticsearch æŸ¥è¯¢è¯­æ³•ï¼Œå¦‚ termã€matchã€range ç­‰ç­‰ã€‚</li>\n<li class=\"lvl-4\">èšåˆå‡½æ•°ï¼šæŒ‡å®šè¦æ‰§è¡Œçš„èšåˆæ“ä½œï¼Œå¦‚ sumã€avgã€minã€maxã€termsã€date_histogram ç­‰ç­‰ã€‚æ¯ä¸ªèšåˆå‘½ä»¤éƒ½ä¼šç”Ÿæˆä¸€ä¸ªèšåˆç»“æœã€‚</li>\n<li class=\"lvl-4\">èšåˆåµŒå¥—ï¼šèšåˆå‘½ä»¤å¯ä»¥åµŒå¥—ï¼Œä»¥ä¾¿æ›´ç»†ç²’åº¦åœ°åˆ†ææ•°æ®ã€‚</li>\n</ul>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">GET &lt;index_name&gt;/_search</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">&quot;aggs&quot;</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;&lt;aggs_name&gt;&quot;</span>: &#123;</span><br><span class=\"line\">      <span class=\"string\">&quot;&lt;agg_type&gt;&quot;</span>: &#123;</span><br><span class=\"line\">        <span class=\"string\">&quot;field&quot;</span>: <span class=\"string\">&quot;&lt;field_name&gt;&quot;</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\"># è¯´æ˜</span></span><br><span class=\"line\">  <span class=\"comment\"># aggsï¼šèšåˆçš„æ ¹èŠ‚ç‚¹ï¼Œå›ºå®šå†™æ³•</span></span><br><span class=\"line\">  <span class=\"comment\"># aggs_nameï¼šèšåˆå‡½æ•°çš„åç§°ï¼Œè‡ªå·±éšæ„å®šä¹‰</span></span><br><span class=\"line\">  <span class=\"comment\"># agg_typeï¼šèšåˆç§ç±»ï¼Œæ¯”å¦‚æ˜¯æ¡¶èšåˆï¼ˆtermsï¼‰æˆ–è€…æ˜¯æŒ‡æ ‡èšåˆï¼ˆavgã€sumã€minã€maxç­‰ï¼‰</span></span><br><span class=\"line\">  <span class=\"comment\"># field_nameï¼šå­—æ®µåç§°æˆ–è€…å«åŸŸåã€‚</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>èšåˆçš„åˆ†ç±»</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">Metric Aggregationï¼šâ€”äº›æ•°å­¦è¿ç®—ï¼Œå¯ä»¥å¯¹æ–‡æ¡£å­—æ®µè¿›è¡Œç»Ÿè®¡åˆ†æï¼Œç±»æ¯”Mysqlä¸­çš„ min(), max(), sum() æ“ä½œã€‚</li>\n<li class=\"lvl-4\">Bucket Aggregationï¼šä¸€äº›æ»¡è¶³ç‰¹å®šæ¡ä»¶çš„æ–‡æ¡£çš„é›†åˆæ”¾ç½®åˆ°ä¸€ä¸ªæ¡¶é‡Œï¼Œæ¯ä¸€ä¸ªæ¡¶å…³è”ä¸€ä¸ªkeyï¼Œç±»æ¯”Mysqlä¸­çš„group byæ“ä½œã€‚</li>\n<li class=\"lvl-4\">Pipeline Aggregationï¼šå¯¹å…¶ä»–çš„èšåˆç»“æœè¿›è¡ŒäºŒæ¬¡èšåˆ</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"ç¤ºä¾‹æ•°æ®å‡†å¤‡\">ç¤ºä¾‹æ•°æ®å‡†å¤‡</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æˆ‘ä»¬éœ€è¦å…ˆå‡†å¤‡ä¸€äº›æ•°æ®ï¼Œæ‰èƒ½è¿›è¡Œèšåˆåˆ†æã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>åˆ›å»ºç´¢å¼•</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å¦‚æœå­˜åœ¨å…ˆåˆ é™¤</span></span><br><span class=\"line\">curl -X DELETE -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/shopping&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åˆ›å»ºç´¢å¼•</span></span><br><span class=\"line\">curl -X PUT -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/shopping&#x27;</span> \\</span><br><span class=\"line\">  -H <span class=\"string\">&#x27;Content-Type: application/json&#x27;</span> \\</span><br><span class=\"line\">  -d <span class=\"string\">&#x27;&#123;</span></span><br><span class=\"line\"><span class=\"string\">    &quot;settings&quot;:&#123;</span></span><br><span class=\"line\"><span class=\"string\">      &quot;number_of_shards&quot;:&quot;1&quot;,</span></span><br><span class=\"line\"><span class=\"string\">      &quot;number_of_replicas&quot;:&quot;2&quot;</span></span><br><span class=\"line\"><span class=\"string\">    &#125;,</span></span><br><span class=\"line\"><span class=\"string\">    &quot;mappings&quot;:&#123;</span></span><br><span class=\"line\"><span class=\"string\">      &quot;properties&quot;:&#123;</span></span><br><span class=\"line\"><span class=\"string\">        &quot;category&quot;:&#123;</span></span><br><span class=\"line\"><span class=\"string\">          &quot;type&quot;:&quot;keyword&quot;</span></span><br><span class=\"line\"><span class=\"string\">        &#125;,</span></span><br><span class=\"line\"><span class=\"string\">        &quot;price&quot;:&#123;</span></span><br><span class=\"line\"><span class=\"string\">          &quot;type&quot;:&quot;double&quot;</span></span><br><span class=\"line\"><span class=\"string\">        &#125;,</span></span><br><span class=\"line\"><span class=\"string\">        &quot;count&quot;:&#123;</span></span><br><span class=\"line\"><span class=\"string\">          &quot;type&quot;:&quot;integer&quot;</span></span><br><span class=\"line\"><span class=\"string\">        &#125;,</span></span><br><span class=\"line\"><span class=\"string\">        &quot;title&quot;:&#123;</span></span><br><span class=\"line\"><span class=\"string\">          &quot;type&quot;:&quot;text&quot;,</span></span><br><span class=\"line\"><span class=\"string\">          &quot;analyzer&quot;:&quot;ik_max_word&quot;,</span></span><br><span class=\"line\"><span class=\"string\">          &quot;search_analyzer&quot;:&quot;ik_smart&quot;</span></span><br><span class=\"line\"><span class=\"string\">        &#125;,</span></span><br><span class=\"line\"><span class=\"string\">        &quot;remark&quot;:&#123;</span></span><br><span class=\"line\"><span class=\"string\">        &quot;type&quot;:&quot;text&quot;,</span></span><br><span class=\"line\"><span class=\"string\">        &quot;analyzer&quot;:&quot;ik_max_word&quot;,</span></span><br><span class=\"line\"><span class=\"string\">        &quot;search_analyzer&quot;:&quot;ik_smart&quot;</span></span><br><span class=\"line\"><span class=\"string\">      &#125;,</span></span><br><span class=\"line\"><span class=\"string\">      &quot;address&quot;: &#123;</span></span><br><span class=\"line\"><span class=\"string\">        &quot;type&quot;: &quot;text&quot;,</span></span><br><span class=\"line\"><span class=\"string\">        &quot;analyzer&quot;: &quot;ik_max_word&quot;,</span></span><br><span class=\"line\"><span class=\"string\">        &quot;fields&quot;: &#123;</span></span><br><span class=\"line\"><span class=\"string\">          &quot;keyword&quot;: &#123;</span></span><br><span class=\"line\"><span class=\"string\">            &quot;type&quot;: &quot;keyword&quot;</span></span><br><span class=\"line\"><span class=\"string\">          &#125;</span></span><br><span class=\"line\"><span class=\"string\">        &#125;</span></span><br><span class=\"line\"><span class=\"string\">      &#125;,</span></span><br><span class=\"line\"><span class=\"string\">      &quot;tags&quot;: &#123;</span></span><br><span class=\"line\"><span class=\"string\">        &quot;type&quot;: &quot;keyword&quot;</span></span><br><span class=\"line\"><span class=\"string\">      &#125;,</span></span><br><span class=\"line\"><span class=\"string\">      &quot;created_at&quot;: &#123;&quot;type&quot;: &quot;date&quot;, &quot;format&quot;: &quot;yyyy-MM-dd HH:mm:ss&quot;&#125;</span></span><br><span class=\"line\"><span class=\"string\">      &#125;</span></span><br><span class=\"line\"><span class=\"string\">    &#125;</span></span><br><span class=\"line\"><span class=\"string\">  &#125;&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ’å…¥æ•°æ®</span></span><br><span class=\"line\">curl -X POST -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/_bulk&#x27;</span> \\</span><br><span class=\"line\">  -H <span class=\"string\">&#x27;Content-Type: application/json&#x27;</span> \\</span><br><span class=\"line\">  -d <span class=\"string\">&#x27;&#123; &quot;index&quot;: &#123; &quot;_index&quot;: &quot;shopping&quot;, &quot;_id&quot;: &quot;1&quot; &#125; &#125;</span></span><br><span class=\"line\"><span class=\"string\">&#123; &quot;category&quot;: &quot;electronics&quot;, &quot;price&quot;: 999.99, &quot;count&quot;: 10, &quot;title&quot;: &quot;Smartphone X - 128GB&quot;, &quot;remark&quot;: &quot;This latest Smartphone X comes with a powerful processor and high-resolution camera.&quot;, &quot;address&quot;: &quot;å¹¿å·å¤©æ²³å…¬å›­&quot;, &quot;tags&quot;: [&quot;latest&quot;, &quot;smartphone&quot;, &quot;technology&quot;], &quot;created_at&quot;: &quot;2025-04-22 03:30:02&quot; &#125;</span></span><br><span class=\"line\"><span class=\"string\">&#123; &quot;index&quot;: &#123; &quot;_index&quot;: &quot;shopping&quot;, &quot;_id&quot;: &quot;2&quot; &#125; &#125;</span></span><br><span class=\"line\"><span class=\"string\">&#123; &quot;category&quot;: &quot;fashion&quot;, &quot;price&quot;: 49.99, &quot;count&quot;: 25, &quot;title&quot;: &quot;Designer T-shirt&quot;, &quot;remark&quot;: &quot;Trendy designer T-shirt made with high quality fabric.&quot;, &quot;address&quot;: &quot;å¹¿å·è”æ¹¾å¤§å¦&quot;, &quot;tags&quot;: [&quot;clothing&quot;, &quot;designer&quot;, &quot;style&quot;], &quot;created_at&quot;: &quot;2025-04-21 12:15:00&quot; &#125;</span></span><br><span class=\"line\"><span class=\"string\">&#123; &quot;index&quot;: &#123; &quot;_index&quot;: &quot;shopping&quot;, &quot;_id&quot;: &quot;3&quot; &#125; &#125;</span></span><br><span class=\"line\"><span class=\"string\">&#123; &quot;category&quot;: &quot;home_appliances&quot;, &quot;price&quot;: 299.99, &quot;count&quot;: 5, &quot;title&quot;: &quot;Robot Vacuum Cleaner&quot;, &quot;remark&quot;: &quot;Efficient robot vacuum cleaner with smart navigation.&quot;, &quot;address&quot;: &quot;å¹¿å·ç™½äº‘å±±å…¬å›­&quot;, &quot;tags&quot;: [&quot;appliances&quot;, &quot;vacuum&quot;, &quot;robot&quot;], &quot;created_at&quot;: &quot;2025-04-20 08:45:30&quot; &#125;</span></span><br><span class=\"line\"><span class=\"string\">&#123; &quot;index&quot;: &#123; &quot;_index&quot;: &quot;shopping&quot;, &quot;_id&quot;: &quot;4&quot; &#125; &#125;</span></span><br><span class=\"line\"><span class=\"string\">&#123; &quot;category&quot;: &quot;books&quot;, &quot;price&quot;: 19.99, &quot;count&quot;: 100, &quot;title&quot;: &quot;Inspirational Novel&quot;, &quot;remark&quot;: &quot;A gripping novel that inspires and motivates.&quot;, &quot;address&quot;: &quot;321 Book Rd, Shenzhen, China&quot;, &quot;tags&quot;: [&quot;book&quot;, &quot;novel&quot;, &quot;inspiration&quot;], &quot;created_at&quot;: &quot;2025-04-19 10:05:00&quot; &#125;</span></span><br><span class=\"line\"><span class=\"string\">&#123; &quot;index&quot;: &#123; &quot;_index&quot;: &quot;shopping&quot;, &quot;_id&quot;: &quot;5&quot; &#125; &#125;</span></span><br><span class=\"line\"><span class=\"string\">&#123; &quot;category&quot;: &quot;groceries&quot;, &quot;price&quot;: 3.99, &quot;count&quot;: 200, &quot;title&quot;: &quot;Organic Apples&quot;, &quot;remark&quot;: &quot;Fresh and crispy organic apples.&quot;, &quot;address&quot;: &quot;654 Grocery Ln, Chengdu, China&quot;, &quot;tags&quot;: [&quot;fruit&quot;, &quot;organic&quot;, &quot;healthy&quot;], &quot;created_at&quot;: &quot;2025-04-18 14:30:45&quot; &#125;</span></span><br><span class=\"line\"><span class=\"string\">&#123; &quot;index&quot;: &#123; &quot;_index&quot;: &quot;shopping&quot;, &quot;_id&quot;: &quot;6&quot; &#125; &#125;</span></span><br><span class=\"line\"><span class=\"string\">&#123; &quot;category&quot;: &quot;electronics&quot;, &quot;price&quot;: 1999.99, &quot;count&quot;: 15, &quot;title&quot;: &quot;Smartphone X - 256GB&quot;, &quot;remark&quot;: &quot;This latest Smartphone X comes with a powerful processor and high-resolution camera.&quot;, &quot;address&quot;: &quot;å¹¿å·å¤©æ²³å…¬å›­&quot;, &quot;tags&quot;: [&quot;latest&quot;, &quot;smartphone&quot;, &quot;technology&quot;], &quot;created_at&quot;: &quot;2025-04-22 03:30:02&quot; &#125;</span></span><br><span class=\"line\"><span class=\"string\">&#x27;</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"Metric-Aggregation-æŒ‡æ ‡èšåˆ\">Metric Aggregation(æŒ‡æ ‡èšåˆ)</h2>\n<h3 id=\"å•å€¼åˆ†æï¸°åªè¾“å‡ºä¸€ä¸ªåˆ†æç»“æœ\">å•å€¼åˆ†æï¸°åªè¾“å‡ºä¸€ä¸ªåˆ†æç»“æœ</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>min, max, avg, sum</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æœ€å¤§å€¼ã€æœ€å°å€¼ã€å¹³å‡å€¼ã€æ€»å’Œ</span></span><br><span class=\"line\">GET /shopping/_search</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">&quot;size&quot;</span>: 0,  <span class=\"comment\"># ä¸è¿”å›æ–‡æ¡£ï¼Œåªè¿”å›èšåˆç»“æœ</span></span><br><span class=\"line\">  <span class=\"string\">&quot;aggs&quot;</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;max_price&quot;</span>: &#123; <span class=\"comment\"># è‡ªå®šä¹‰åç§°ï¼Œè¿™é‡Œè¿”å›æœ€å¤§å€¼</span></span><br><span class=\"line\">      <span class=\"string\">&quot;max&quot;</span>: &#123;     <span class=\"comment\"># æŒ‡æ ‡èšåˆå‡½æ•°åç§°</span></span><br><span class=\"line\">        <span class=\"string\">&quot;field&quot;</span>: <span class=\"string\">&quot;price&quot;</span> <span class=\"comment\"># æŒ‡æ ‡èšåˆå­—æ®µ</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"string\">&quot;min_price&quot;</span>: &#123;</span><br><span class=\"line\">      <span class=\"string\">&quot;min&quot;</span>: &#123;</span><br><span class=\"line\">        <span class=\"string\">&quot;field&quot;</span>: <span class=\"string\">&quot;price&quot;</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"string\">&quot;avg_price&quot;</span>: &#123;</span><br><span class=\"line\">      <span class=\"string\">&quot;avg&quot;</span>: &#123;</span><br><span class=\"line\">        <span class=\"string\">&quot;field&quot;</span>: <span class=\"string\">&quot;price&quot;</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"string\">&quot;sum_price&quot;</span>: &#123;</span><br><span class=\"line\">      <span class=\"string\">&quot;sum&quot;</span>: &#123;</span><br><span class=\"line\">        <span class=\"string\">&quot;field&quot;</span>: <span class=\"string\">&quot;price&quot;</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Cardinalityï¼ˆç±»ä¼¼distinct Count)</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">GET /shopping/_search</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">&quot;size&quot;</span>: 0, <span class=\"comment\"># ä¸è¿”å›æ–‡æ¡£ï¼Œåªè¿”å›èšåˆç»“æœ</span></span><br><span class=\"line\">  <span class=\"string\">&quot;aggs&quot;</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;cardinality_count&quot;</span>: &#123; <span class=\"comment\"># è‡ªå®šä¹‰åç§°ï¼Œè¿”å›å»é‡åçš„æ•°é‡</span></span><br><span class=\"line\">      <span class=\"string\">&quot;cardinality&quot;</span>: &#123;  <span class=\"comment\"># æŒ‡æ ‡èšåˆå‡½æ•°åç§°ï¼Œcardinalityè¡¨ç¤ºå»é‡</span></span><br><span class=\"line\">        <span class=\"string\">&quot;field&quot;</span>: <span class=\"string\">&quot;category&quot;</span> <span class=\"comment\"># æŒ‡æ ‡èšåˆå­—æ®µï¼Œå»é‡çš„å­—æ®µ</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"å¤šå€¼åˆ†æ-è¾“å‡ºå¤šä¸ªåˆ†æç»“æœ\">å¤šå€¼åˆ†æ:è¾“å‡ºå¤šä¸ªåˆ†æç»“æœ</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>statsï¼ˆç»Ÿè®¡ï¼‰, extended stats</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">GET /shopping/_search</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">&quot;size&quot;</span>: 0,</span><br><span class=\"line\">  <span class=\"string\">&quot;aggs&quot;</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;stats_price&quot;</span>: &#123;</span><br><span class=\"line\">      <span class=\"string\">&quot;stats&quot;</span>: &#123; <span class=\"comment\"># æŒ‡æ ‡èšåˆå‡½æ•°åç§°ï¼Œstatsè¡¨ç¤ºç»Ÿè®¡ï¼Œä¼šè¿”å›å¤šä¸ªæŒ‡æ ‡</span></span><br><span class=\"line\">        <span class=\"string\">&quot;field&quot;</span>: <span class=\"string\">&quot;price&quot;</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\"># ç»“æœ</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">&quot;took&quot;</span>: 15,</span><br><span class=\"line\">  <span class=\"string\">&quot;timed_out&quot;</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;_shards&quot;</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;total&quot;</span>: 1,</span><br><span class=\"line\">    <span class=\"string\">&quot;successful&quot;</span>: 1,</span><br><span class=\"line\">    <span class=\"string\">&quot;skipped&quot;</span>: 0,</span><br><span class=\"line\">    <span class=\"string\">&quot;failed&quot;</span>: 0</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"string\">&quot;hits&quot;</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;total&quot;</span>: &#123;</span><br><span class=\"line\">      <span class=\"string\">&quot;value&quot;</span>: 12,</span><br><span class=\"line\">      <span class=\"string\">&quot;relation&quot;</span>: <span class=\"string\">&quot;eq&quot;</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"string\">&quot;max_score&quot;</span>: null,</span><br><span class=\"line\">    <span class=\"string\">&quot;hits&quot;</span>: []     <span class=\"comment\"># å› ä¸ºè®¾ç½®size ä¸º 0ï¼Œæ‰€ä»¥è¿”å›çš„ç»“æœä¸ºç©º</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"string\">&quot;aggregations&quot;</span>: &#123; <span class=\"comment\"># èšåˆç»“æœ</span></span><br><span class=\"line\">    <span class=\"string\">&quot;stats_price&quot;</span>: &#123; <span class=\"comment\"># è‡ªå®šä¹‰åç§°ï¼Œè¿”å›å¤šç»„èšåˆç»“æœ</span></span><br><span class=\"line\">      <span class=\"string\">&quot;count&quot;</span>: 12,</span><br><span class=\"line\">      <span class=\"string\">&quot;min&quot;</span>: 3.99,</span><br><span class=\"line\">      <span class=\"string\">&quot;max&quot;</span>: 1999.99,</span><br><span class=\"line\">      <span class=\"string\">&quot;avg&quot;</span>: 562.1666666666666,</span><br><span class=\"line\">      <span class=\"string\">&quot;sum&quot;</span>: 6746</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>percentile ï¼ˆç™¾åˆ†ä½ï¼‰, percentile rank</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">GET /shopping/_search</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">&quot;size&quot;</span>: 0,</span><br><span class=\"line\">  <span class=\"string\">&quot;aggs&quot;</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;percentile_price&quot;</span>: &#123;</span><br><span class=\"line\">      <span class=\"string\">&quot;percentiles&quot;</span>: &#123; <span class=\"comment\"># æŒ‡æ ‡èšåˆå‡½æ•°åç§°ï¼Œpercentilesè¡¨ç¤ºç™¾åˆ†ä½æ•°èšåˆè®¡ç®—</span></span><br><span class=\"line\">        <span class=\"string\">&quot;field&quot;</span>: <span class=\"string\">&quot;price&quot;</span>, <span class=\"comment\"># æŒ‡æ ‡èšåˆå­—æ®µ</span></span><br><span class=\"line\">        <span class=\"string\">&quot;percents&quot;</span>: [1, 5, 25, 50, 75, 95, 99] <span class=\"comment\"># éœ€è¦è®¡ç®—ç™¾åˆ†ä½æ•°çš„æ•°ç»„</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\"># ç™¾åˆ†ä½æ•°æ˜¯ä¸€ä¸ªç»Ÿè®¡å­¦æ¦‚å¿µï¼Œç”¨äºæè¿°ä¸€ä¸ªç»™å®šé›†åˆçš„æ’åºå€¼ã€‚ä¾‹å¦‚ï¼š</span></span><br><span class=\"line\"><span class=\"comment\"># ç¬¬ 1 ç™¾åˆ†ä½æ•°è¡¨ç¤ºæ•°æ®ä¸­å°äºè¿™ä¸ªå€¼çš„æ‰€æœ‰æ•°æ®å æ€»æ•°çš„ 1%ã€‚</span></span><br><span class=\"line\"><span class=\"comment\"># ç¬¬ 50 ç™¾åˆ†ä½æ•°ï¼ˆä¸­ä½æ•°ï¼‰è¡¨ç¤ºæ•°æ®ä¸­çš„ä¸€åŠå°äºè¿™ä¸ªå€¼ï¼Œå¦ä¸€åŠå¤§äºè¿™ä¸ªå€¼ã€‚</span></span><br><span class=\"line\"><span class=\"comment\"># ç¬¬ 99 ç™¾åˆ†ä½æ•°è¡¨ç¤ºæ•°æ®ä¸­å°äºè¿™ä¸ªå€¼çš„æ‰€æœ‰æ•°æ®å æ€»æ•°çš„ 99%ã€‚</span></span><br><span class=\"line\"><span class=\"comment\"># é€šè¿‡è®¡ç®—è¿™äº›ç™¾åˆ†ä½æ•°ï¼Œä½ å¯ä»¥äº†è§£ price å­—æ®µåœ¨æ•´ä¸ªshoppingç´¢å¼•ä¸­çš„åˆ†å¸ƒæƒ…å†µï¼Œä»è€Œå¯ä»¥ç”¨äºæ•°æ®åˆ†æã€è¶‹åŠ¿åˆ¤æ–­ç­‰ã€‚</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>top hits(æ’åœ¨å‰é¢çš„ç¤ºä¾‹)</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">GET /shopping/_search</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">&quot;size&quot;</span>: 0,</span><br><span class=\"line\">  <span class=\"string\">&quot;aggs&quot;</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;top_hits&quot;</span>: &#123; <span class=\"comment\"># è‡ªå®šä¹‰åç§°ï¼Œè¿”å›æ’åœ¨å‰é¢çš„ç¤ºä¾‹</span></span><br><span class=\"line\">      <span class=\"string\">&quot;top_hits&quot;</span>: &#123; <span class=\"comment\"># æŒ‡æ ‡èšåˆå‡½æ•°åç§°ï¼Œtop_hitsè¡¨ç¤ºè¿”å›æ’åœ¨å‰é¢çš„ç¤ºä¾‹</span></span><br><span class=\"line\">        <span class=\"string\">&quot;sort&quot;</span>: [&#123;<span class=\"string\">&quot;price&quot;</span>: &#123;<span class=\"string\">&quot;order&quot;</span>: <span class=\"string\">&quot;desc&quot;</span>&#125;&#125;], <span class=\"comment\"># æ’åºï¼ŒæŒ‰ç…§priceå­—æ®µé™åºæ’åº</span></span><br><span class=\"line\">        <span class=\"string\">&quot;size&quot;</span>: 3 <span class=\"comment\"># åªè¿”å›å‰3ä¸ª</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"Bucket-Aggregation-æ¡¶èšåˆ\">Bucket Aggregation(æ¡¶èšåˆ)</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æŒ‰ç…§ä¸€å®šçš„è§„åˆ™ï¼Œå°†æ–‡æ¡£åˆ†é…åˆ°ä¸åŒçš„æ¡¶ä¸­ï¼Œä»è€Œè¾¾åˆ°åˆ†ç±»çš„ç›®çš„ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ESæä¾›çš„ä¸€äº›å¸¸è§çš„ Bucket Aggregationã€‚</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">termsï¼ˆè¯æ¡ï¼‰, rangeï¼ˆèŒƒå›´ï¼‰, date_rangeï¼ˆæ—¥æœŸèŒƒå›´ï¼‰, ip_rangeï¼ˆIPèŒƒå›´ï¼‰, missingï¼ˆç¼ºå¤±ï¼‰, histogramï¼ˆç›´æ–¹å›¾ï¼‰, date_histogramï¼ˆæ—¥æœŸç›´æ–¹å›¾ï¼‰, geo_distanceï¼ˆåœ°ç†è·ç¦»ï¼‰, significant_termsï¼ˆé‡è¦è¯æ¡ï¼‰, compositeï¼ˆç»„åˆï¼‰</li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<p>æ¡¶èšåˆå¯ä»¥ç”¨äºå„ç§åœºæ™¯ï¼Œä¾‹å¦‚ï¼š</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">å¯¹æ•°æ®è¿›è¡Œåˆ†ç»„ç»Ÿè®¡ï¼Œæ¯”å¦‚æŒ‰ç…§åœ°åŒºã€å¹´é¾„æ®µã€æ€§åˆ«ç­‰å­—æ®µè¿›è¡Œåˆ†ç»„ç»Ÿè®¡ã€‚</li>\n<li class=\"lvl-4\">å¯¹æ—¶é—´åºåˆ—æ•°æ®è¿›è¡Œæ—¶é—´æ®µåˆ†æï¼Œæ¯”å¦‚æŒ‰ç…§æ¯å°æ—¶ã€æ¯å¤©ã€æ¯æœˆã€æ¯å­£åº¦ã€æ¯å¹´ç­‰æ—¶é—´æ®µè¿›è¡Œåˆ†æã€‚</li>\n<li class=\"lvl-4\">å¯¹å„ç§æ ‡ç­¾ä¿¡æ¯åˆ†ç±»ï¼Œå¹¶ç»Ÿè®¡å…¶æ•°é‡ã€‚</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"termsï¼ˆè¯æ¡ï¼‰\">termsï¼ˆè¯æ¡ï¼‰</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æŒ‰ç…§å­—æ®µçš„å€¼è¿›è¡Œåˆ†ç»„ï¼Œå¹¶ç»Ÿè®¡æ¯ä¸ªç»„çš„æ•°é‡ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ç¤ºä¾‹ï¼šæŒ‰ç…§categoryå­—æ®µè¿›è¡Œåˆ†ç»„ï¼Œå¹¶ç»Ÿè®¡æ¯ä¸ªç»„çš„æ•°é‡ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">GET /shopping/_search</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">&quot;size&quot;</span>: 0,</span><br><span class=\"line\">  <span class=\"string\">&quot;aggs&quot;</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;category_count&quot;</span>: &#123; <span class=\"comment\"># è‡ªå®šä¹‰åç§°ï¼Œè¿”å›æ¯ä¸ªç»„çš„æ•°é‡</span></span><br><span class=\"line\">      <span class=\"string\">&quot;terms&quot;</span>: &#123; <span class=\"comment\"># æ¡¶èšåˆå‡½æ•°åç§°ï¼Œtermsè¡¨ç¤ºæŒ‰ç…§å­—æ®µçš„å€¼è¿›è¡Œåˆ†ç»„</span></span><br><span class=\"line\">        <span class=\"string\">&quot;field&quot;</span>: <span class=\"string\">&quot;category&quot;</span>, <span class=\"comment\"># æŒ‰ç…§categoryå­—æ®µè¿›è¡Œåˆ†ç»„ï¼Œæ³¨æ„ä¸èƒ½æ˜¯textç±»å‹ï¼Œå¦åˆ™ä¼šæŠ¥é”™</span></span><br><span class=\"line\">        <span class=\"string\">&quot;size&quot;</span>: 10, <span class=\"comment\"># åªè¿”å›å‰10ä¸ªï¼Œé»˜è®¤æ˜¯10</span></span><br><span class=\"line\">        <span class=\"string\">&quot;order&quot;</span>: &#123;<span class=\"string\">&quot;_count&quot;</span>: <span class=\"string\">&quot;desc&quot;</span>&#125; <span class=\"comment\"># æŒ‰ç…§æ•°é‡é™åºæ’åºï¼Œé»˜è®¤æ˜¯descï¼ŒBucketèšåˆä¼šç»Ÿè®¡Bucketå†…çš„æ–‡æ¡£æ•°é‡ï¼Œè®°ä¸º_countï¼Œå¹¶ä¸”æŒ‰ç…§_counté™åºæ’åº</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ç»“æœ</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">&quot;took&quot;</span>: 15,</span><br><span class=\"line\">  <span class=\"string\">&quot;timed_out&quot;</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;_shards&quot;</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;total&quot;</span>: 1,</span><br><span class=\"line\">    <span class=\"string\">&quot;successful&quot;</span>: 1,</span><br><span class=\"line\">    <span class=\"string\">&quot;skipped&quot;</span>: 0,</span><br><span class=\"line\">    <span class=\"string\">&quot;failed&quot;</span>: 0</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"string\">&quot;hits&quot;</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;total&quot;</span>: &#123;</span><br><span class=\"line\">      <span class=\"string\">&quot;value&quot;</span>: 12,</span><br><span class=\"line\">      <span class=\"string\">&quot;relation&quot;</span>: <span class=\"string\">&quot;eq&quot;</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"string\">&quot;max_score&quot;</span>: null,</span><br><span class=\"line\">    <span class=\"string\">&quot;hits&quot;</span>: []</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"string\">&quot;aggregations&quot;</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;category_count&quot;</span>: &#123;</span><br><span class=\"line\">      <span class=\"string\">&quot;doc_count_error_upper_bound&quot;</span>: 0,  <span class=\"comment\"># é”™è¯¯ä¸Šç•Œï¼Œè¡¨ç¤ºåœ¨èšåˆè¿‡ç¨‹ä¸­å¯èƒ½å­˜åœ¨ä¸€äº›é”™è¯¯ï¼Œä½†é”™è¯¯æ•°é‡ä¸ä¼šè¶…è¿‡è¿™ä¸ªå€¼</span></span><br><span class=\"line\">      <span class=\"string\">&quot;sum_other_doc_count&quot;</span>: 0,         <span class=\"comment\"># è¡¨ç¤ºåœ¨èšåˆè¿‡ç¨‹ä¸­ï¼Œé™¤äº†è¿”å›çš„10ä¸ªbucketï¼Œè¿˜æœ‰å…¶ä»–æ•°é‡ï¼Œè¿™ä¸ªæ•°é‡å°±æ˜¯sum_other_doc_count</span></span><br><span class=\"line\">      <span class=\"string\">&quot;buckets&quot;</span>: [                     <span class=\"comment\"># è¿”å›çš„bucket</span></span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"string\">&quot;key&quot;</span>: <span class=\"string\">&quot;electronics&quot;</span>,          <span class=\"comment\"># åˆ†ç»„çš„key</span></span><br><span class=\"line\">          <span class=\"string\">&quot;doc_count&quot;</span>: 4                 <span class=\"comment\"># åˆ†ç»„çš„æ•°é‡</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"string\">&quot;key&quot;</span>: <span class=\"string\">&quot;books&quot;</span>,</span><br><span class=\"line\">          <span class=\"string\">&quot;doc_count&quot;</span>: 2</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"string\">&quot;key&quot;</span>: <span class=\"string\">&quot;fashion&quot;</span>,</span><br><span class=\"line\">          <span class=\"string\">&quot;doc_count&quot;</span>: 2</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"string\">&quot;key&quot;</span>: <span class=\"string\">&quot;groceries&quot;</span>,</span><br><span class=\"line\">          <span class=\"string\">&quot;doc_count&quot;</span>: 2</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"string\">&quot;key&quot;</span>: <span class=\"string\">&quot;home_appliances&quot;</span>,</span><br><span class=\"line\">          <span class=\"string\">&quot;doc_count&quot;</span>: 2</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      ]</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>é™å®šèšåˆèŒƒå›´</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">GET /shopping/_search</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">&quot;query&quot;</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;range&quot;</span>: &#123;</span><br><span class=\"line\">      <span class=\"string\">&quot;price&quot;</span>: &#123;</span><br><span class=\"line\">        <span class=\"string\">&quot;gte&quot;</span>: 100 <span class=\"comment\"># é™å®šä»·æ ¼èŒƒå›´</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"string\">&quot;size&quot;</span>: 0,</span><br><span class=\"line\">  <span class=\"string\">&quot;aggs&quot;</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;category_count&quot;</span>: &#123; <span class=\"comment\"># è‡ªå®šä¹‰åç§°ï¼Œè¿”å›æ¯ä¸ªç»„çš„æ•°é‡</span></span><br><span class=\"line\">      <span class=\"string\">&quot;terms&quot;</span>: &#123; <span class=\"comment\"># æ¡¶èšåˆå‡½æ•°åç§°ï¼Œtermsè¡¨ç¤ºæŒ‰ç…§å­—æ®µçš„å€¼è¿›è¡Œåˆ†ç»„</span></span><br><span class=\"line\">        <span class=\"string\">&quot;field&quot;</span>: <span class=\"string\">&quot;category&quot;</span>, <span class=\"comment\"># æŒ‰ç…§categoryå­—æ®µè¿›è¡Œåˆ†ç»„</span></span><br><span class=\"line\">        <span class=\"string\">&quot;size&quot;</span>: 10, <span class=\"comment\"># åªè¿”å›å‰10ä¸ªï¼Œé»˜è®¤æ˜¯10</span></span><br><span class=\"line\">        <span class=\"string\">&quot;order&quot;</span>: &#123;<span class=\"string\">&quot;_count&quot;</span>: <span class=\"string\">&quot;desc&quot;</span>&#125; <span class=\"comment\"># æŒ‰ç…§æ•°é‡é™åºæ’åºï¼Œé»˜è®¤æ˜¯descï¼ŒBucketèšåˆä¼šç»Ÿè®¡Bucketå†…çš„æ–‡æ¡£æ•°é‡ï¼Œè®°ä¸º_countï¼Œå¹¶ä¸”æŒ‰ç…§_counté™åºæ’åº</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"rangeï¼ˆèŒƒå›´ï¼‰\">rangeï¼ˆèŒƒå›´ï¼‰</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æŒ‰ç…§å­—æ®µçš„å€¼è¿›è¡Œåˆ†ç»„ï¼Œå¹¶ç»Ÿè®¡æ¯ä¸ªç»„çš„æ•°é‡ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ç¤ºä¾‹ï¼šæŒ‰ç…§ä»·æ ¼èŒƒå›´è¿›è¡Œåˆ†ç»„ï¼Œå¹¶ç»Ÿè®¡æ¯ä¸ªç»„çš„æ•°é‡ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">GET /shopping/_search</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">&quot;size&quot;</span>: 0,</span><br><span class=\"line\">  <span class=\"string\">&quot;aggs&quot;</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;price_range&quot;</span>: &#123; <span class=\"comment\"># è‡ªå®šä¹‰åç§°ï¼Œè¿”å›æ¯ä¸ªç»„çš„æ•°é‡</span></span><br><span class=\"line\">      <span class=\"string\">&quot;range&quot;</span>: &#123; <span class=\"comment\"># æ¡¶èšåˆå‡½æ•°åç§°ï¼Œrangeè¡¨ç¤ºæŒ‰ç…§å­—æ®µçš„å€¼è¿›è¡Œåˆ†ç»„</span></span><br><span class=\"line\">        <span class=\"string\">&quot;field&quot;</span>: <span class=\"string\">&quot;price&quot;</span>, <span class=\"comment\"># æŒ‰ç…§priceå­—æ®µè¿›è¡Œåˆ†ç»„</span></span><br><span class=\"line\">        <span class=\"string\">&quot;ranges&quot;</span>: [</span><br><span class=\"line\">          &#123;<span class=\"string\">&quot;to&quot;</span>: 100&#125;, <span class=\"comment\"># å°äº100</span></span><br><span class=\"line\">          &#123;<span class=\"string\">&quot;from&quot;</span>: 100, <span class=\"string\">&quot;to&quot;</span>: 200&#125;, <span class=\"comment\"># 100-200ï¼ŒåŒ…æ‹¬100ï¼Œä¸åŒ…æ‹¬200</span></span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            <span class=\"string\">&quot;key&quot;</span>:<span class=\"string\">&quot;&gt;=200&quot;</span>, <span class=\"comment\"># è®¾å®šé”®å€¼ï¼Œç”¨äºåŒºåˆ†ä¸åŒèŒƒå›´</span></span><br><span class=\"line\">            <span class=\"string\">&quot;from&quot;</span>:200 <span class=\"comment\"># å¤§äºç­‰äº200</span></span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        ]</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\"># ç»“æœ</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">&quot;took&quot;</span>: 5,</span><br><span class=\"line\">  <span class=\"string\">&quot;timed_out&quot;</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;_shards&quot;</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;total&quot;</span>: 1,</span><br><span class=\"line\">    <span class=\"string\">&quot;successful&quot;</span>: 1,</span><br><span class=\"line\">    <span class=\"string\">&quot;skipped&quot;</span>: 0,</span><br><span class=\"line\">    <span class=\"string\">&quot;failed&quot;</span>: 0</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"string\">&quot;hits&quot;</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;total&quot;</span>: &#123;</span><br><span class=\"line\">      <span class=\"string\">&quot;value&quot;</span>: 12,</span><br><span class=\"line\">      <span class=\"string\">&quot;relation&quot;</span>: <span class=\"string\">&quot;eq&quot;</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"string\">&quot;max_score&quot;</span>: null,</span><br><span class=\"line\">    <span class=\"string\">&quot;hits&quot;</span>: []</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"string\">&quot;aggregations&quot;</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;price_range&quot;</span>: &#123;</span><br><span class=\"line\">      <span class=\"string\">&quot;buckets&quot;</span>: [</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"string\">&quot;key&quot;</span>: <span class=\"string\">&quot;*-100.0&quot;</span>,</span><br><span class=\"line\">          <span class=\"string\">&quot;to&quot;</span>: 100,</span><br><span class=\"line\">          <span class=\"string\">&quot;doc_count&quot;</span>: 6</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"string\">&quot;key&quot;</span>: <span class=\"string\">&quot;100.0-200.0&quot;</span>,</span><br><span class=\"line\">          <span class=\"string\">&quot;from&quot;</span>: 100,</span><br><span class=\"line\">          <span class=\"string\">&quot;to&quot;</span>: 200,</span><br><span class=\"line\">          <span class=\"string\">&quot;doc_count&quot;</span>: 0</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"string\">&quot;key&quot;</span>: <span class=\"string\">&quot;&gt;=200&quot;</span>,</span><br><span class=\"line\">          <span class=\"string\">&quot;from&quot;</span>: 200,</span><br><span class=\"line\">          <span class=\"string\">&quot;doc_count&quot;</span>: 6</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      ]</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"date-rangeï¼ˆæ—¥æœŸèŒƒå›´ï¼‰\">date_rangeï¼ˆæ—¥æœŸèŒƒå›´ï¼‰</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æŒ‰ç…§å­—æ®µçš„å€¼è¿›è¡Œåˆ†ç»„ï¼Œå¹¶ç»Ÿè®¡æ¯ä¸ªç»„çš„æ•°é‡ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ç¤ºä¾‹ï¼šæŒ‰ç…§æ—¥æœŸèŒƒå›´è¿›è¡Œåˆ†ç»„ï¼Œå¹¶ç»Ÿè®¡æ¯ä¸ªç»„çš„æ•°é‡ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">GET /shopping/_search</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">&quot;size&quot;</span>: 0,</span><br><span class=\"line\">  <span class=\"string\">&quot;aggs&quot;</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;date_range&quot;</span>: &#123;</span><br><span class=\"line\">      <span class=\"string\">&quot;date_range&quot;</span>: &#123;</span><br><span class=\"line\">        <span class=\"string\">&quot;field&quot;</span>: <span class=\"string\">&quot;created_at&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;ranges&quot;</span>: [</span><br><span class=\"line\">          &#123;<span class=\"string\">&quot;to&quot;</span>: <span class=\"string\">&quot;now-3d&quot;</span>&#125;, <span class=\"comment\"># å°äºå½“å‰æ—¶é—´å‡å»3å¤©</span></span><br><span class=\"line\">          &#123;<span class=\"string\">&quot;from&quot;</span>: <span class=\"string\">&quot;now-3d&quot;</span>,<span class=\"string\">&quot;to&quot;</span>: <span class=\"string\">&quot;now-1d&quot;</span>&#125;, <span class=\"comment\"># å¤§äºå½“å‰æ—¶é—´å‡å»3å¤©ï¼ˆåŒ…å«ï¼‰ï¼Œå°äºå½“å‰æ—¶é—´å‡å»1å¤©</span></span><br><span class=\"line\">          &#123;<span class=\"string\">&quot;key&quot;</span>:<span class=\"string\">&quot;now-1d&quot;</span>,<span class=\"string\">&quot;from&quot;</span>: <span class=\"string\">&quot;now-1d&quot;</span>&#125; <span class=\"comment\"># å¤§äºå½“å‰æ—¶é—´å‡å»1å¤©ï¼ˆåŒ…å«ï¼‰ï¼Œå¹¶è®¾ç½®é”®å€¼</span></span><br><span class=\"line\">        ]</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\"># ç»“æœ</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">&quot;took&quot;</span>: 3,</span><br><span class=\"line\">  <span class=\"string\">&quot;timed_out&quot;</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;_shards&quot;</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;total&quot;</span>: 1,</span><br><span class=\"line\">    <span class=\"string\">&quot;successful&quot;</span>: 1,</span><br><span class=\"line\">    <span class=\"string\">&quot;skipped&quot;</span>: 0,</span><br><span class=\"line\">    <span class=\"string\">&quot;failed&quot;</span>: 0</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"string\">&quot;hits&quot;</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;total&quot;</span>: &#123;</span><br><span class=\"line\">      <span class=\"string\">&quot;value&quot;</span>: 12,</span><br><span class=\"line\">      <span class=\"string\">&quot;relation&quot;</span>: <span class=\"string\">&quot;eq&quot;</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"string\">&quot;max_score&quot;</span>: null,</span><br><span class=\"line\">    <span class=\"string\">&quot;hits&quot;</span>: []</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"string\">&quot;aggregations&quot;</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;date_range&quot;</span>: &#123;</span><br><span class=\"line\">      <span class=\"string\">&quot;buckets&quot;</span>: [</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"string\">&quot;key&quot;</span>: <span class=\"string\">&quot;*-2025-04-20 03:14:17&quot;</span>,</span><br><span class=\"line\">          <span class=\"string\">&quot;to&quot;</span>: 1745118857610,</span><br><span class=\"line\">          <span class=\"string\">&quot;to_as_string&quot;</span>: <span class=\"string\">&quot;2025-04-20 03:14:17&quot;</span>,</span><br><span class=\"line\">          <span class=\"string\">&quot;doc_count&quot;</span>: 4</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"string\">&quot;key&quot;</span>: <span class=\"string\">&quot;2025-04-20 03:14:17-2025-04-22 03:14:17&quot;</span>,</span><br><span class=\"line\">          <span class=\"string\">&quot;from&quot;</span>: 1745118857610,</span><br><span class=\"line\">          <span class=\"string\">&quot;from_as_string&quot;</span>: <span class=\"string\">&quot;2025-04-20 03:14:17&quot;</span>,</span><br><span class=\"line\">          <span class=\"string\">&quot;to&quot;</span>: 1745291657610,</span><br><span class=\"line\">          <span class=\"string\">&quot;to_as_string&quot;</span>: <span class=\"string\">&quot;2025-04-22 03:14:17&quot;</span>,</span><br><span class=\"line\">          <span class=\"string\">&quot;doc_count&quot;</span>: 4</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"string\">&quot;key&quot;</span>: <span class=\"string\">&quot;now-1d&quot;</span>,</span><br><span class=\"line\">          <span class=\"string\">&quot;from&quot;</span>: 1745291657610,</span><br><span class=\"line\">          <span class=\"string\">&quot;from_as_string&quot;</span>: <span class=\"string\">&quot;2025-04-22 03:14:17&quot;</span>,</span><br><span class=\"line\">          <span class=\"string\">&quot;doc_count&quot;</span>: 4</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      ]</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ—¥æœŸæ ¼å¼</span></span><br><span class=\"line\">GET /shopping/_search</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">&quot;size&quot;</span>: 0,</span><br><span class=\"line\">  <span class=\"string\">&quot;aggs&quot;</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;date_range&quot;</span>: &#123;</span><br><span class=\"line\">      <span class=\"string\">&quot;date_range&quot;</span>: &#123;</span><br><span class=\"line\">        <span class=\"string\">&quot;field&quot;</span>: <span class=\"string\">&quot;created_at&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;ranges&quot;</span>: [</span><br><span class=\"line\">          &#123;<span class=\"string\">&quot;to&quot;</span>: <span class=\"string\">&quot;2025-04-20 00:00:00&quot;</span>&#125;, <span class=\"comment\"># æ³¨æ„è¿™é‡Œçš„æ ¼å¼å¿…é¡»ä¸å­—æ®µæ ¼å¼ä¸€è‡´</span></span><br><span class=\"line\">          &#123;<span class=\"string\">&quot;from&quot;</span>: <span class=\"string\">&quot;2025-04-20 00:00:00&quot;</span>,<span class=\"string\">&quot;to&quot;</span>: <span class=\"string\">&quot;2025-04-22 00:00:00&quot;</span>&#125;,</span><br><span class=\"line\">          &#123;<span class=\"string\">&quot;key&quot;</span>:<span class=\"string\">&quot;2025-04-22 00:00:00&quot;</span>,<span class=\"string\">&quot;from&quot;</span>: <span class=\"string\">&quot;2025-04-22 00:00:00&quot;</span>&#125;</span><br><span class=\"line\">        ]</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"histogramï¼ˆç›´æ–¹å›¾ï¼‰\">histogramï¼ˆç›´æ–¹å›¾ï¼‰</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æŒ‰ç…§é—´éš”è¿›è¡Œåˆ†ç»„ï¼Œå¹¶ç»Ÿè®¡æ¯ä¸ªç»„çš„æ•°é‡ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ç¤ºä¾‹ï¼šæŒ‰ç…§ä»·æ ¼çš„é—´éš”è¿›è¡Œåˆ†ç»„ï¼Œå¹¶ç»Ÿè®¡æ¯ä¸ªç»„çš„æ•°é‡ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">GET /shopping/_search</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">&quot;size&quot;</span>: 0,</span><br><span class=\"line\">  <span class=\"string\">&quot;aggs&quot;</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;price_histogram&quot;</span>: &#123;</span><br><span class=\"line\">      <span class=\"string\">&quot;histogram&quot;</span>: &#123;</span><br><span class=\"line\">        <span class=\"string\">&quot;field&quot;</span>: <span class=\"string\">&quot;price&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;interval&quot;</span>: 500, <span class=\"comment\"># é—´éš”500</span></span><br><span class=\"line\">        <span class=\"string\">&quot;extended_bounds&quot;</span>:&#123; <span class=\"comment\"># è®¾ç½®è¾¹ç•Œ</span></span><br><span class=\"line\">          <span class=\"string\">&quot;min&quot;</span>:0, <span class=\"comment\"># æœ€å°å€¼0</span></span><br><span class=\"line\">          <span class=\"string\">&quot;max&quot;</span>:2000 <span class=\"comment\"># æœ€å¤§å€¼2000</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\"># ç»“æœ</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">&quot;took&quot;</span>: 2,</span><br><span class=\"line\">  <span class=\"string\">&quot;timed_out&quot;</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;_shards&quot;</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;total&quot;</span>: 1,</span><br><span class=\"line\">    <span class=\"string\">&quot;successful&quot;</span>: 1,</span><br><span class=\"line\">    <span class=\"string\">&quot;skipped&quot;</span>: 0,</span><br><span class=\"line\">    <span class=\"string\">&quot;failed&quot;</span>: 0</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"string\">&quot;hits&quot;</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;total&quot;</span>: &#123;</span><br><span class=\"line\">      <span class=\"string\">&quot;value&quot;</span>: 12,</span><br><span class=\"line\">      <span class=\"string\">&quot;relation&quot;</span>: <span class=\"string\">&quot;eq&quot;</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"string\">&quot;max_score&quot;</span>: null,</span><br><span class=\"line\">    <span class=\"string\">&quot;hits&quot;</span>: []</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"string\">&quot;aggregations&quot;</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;price_histogram&quot;</span>: &#123;</span><br><span class=\"line\">      <span class=\"string\">&quot;buckets&quot;</span>: [</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"string\">&quot;key&quot;</span>: 0,</span><br><span class=\"line\">          <span class=\"string\">&quot;doc_count&quot;</span>: 8</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"string\">&quot;key&quot;</span>: 500,</span><br><span class=\"line\">          <span class=\"string\">&quot;doc_count&quot;</span>: 1</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"string\">&quot;key&quot;</span>: 1000,</span><br><span class=\"line\">          <span class=\"string\">&quot;doc_count&quot;</span>: 1</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"string\">&quot;key&quot;</span>: 1500,</span><br><span class=\"line\">          <span class=\"string\">&quot;doc_count&quot;</span>: 2</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"string\">&quot;key&quot;</span>: 2000,</span><br><span class=\"line\">          <span class=\"string\">&quot;doc_count&quot;</span>: 0</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      ]</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"top-hitsï¼ˆåˆ†æ¡¶å–å‰Næ¡ï¼‰\">top_hitsï¼ˆåˆ†æ¡¶å–å‰Næ¡ï¼‰</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æŒ‰ç…§å­—æ®µçš„å€¼è¿›è¡Œåˆ†ç»„ï¼Œå¹¶è¿”å›æ¯ä¸ªç»„çš„å‰Næ¡æ•°æ®ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ç¤ºä¾‹ï¼šæŒ‰ç…§categoryè¿›è¡Œåˆ†ç»„ï¼Œå¹¶è¿”å›æ¯ä¸ªç»„çš„å‰3æ¡æ•°æ®ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">GET /shopping/_search</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">&quot;size&quot;</span>: 0,</span><br><span class=\"line\">  <span class=\"string\">&quot;aggs&quot;</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;price_top_hits&quot;</span>: &#123; <span class=\"comment\"># è‡ªå®šä¹‰åç§°</span></span><br><span class=\"line\">      <span class=\"string\">&quot;terms&quot;</span>: &#123;</span><br><span class=\"line\">        <span class=\"string\">&quot;field&quot;</span>: <span class=\"string\">&quot;category&quot;</span>  <span class=\"comment\"># æŒ‰ç…§categoryå­—æ®µè¿›è¡Œåˆ†ç»„</span></span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      <span class=\"string\">&quot;aggs&quot;</span>: &#123;</span><br><span class=\"line\">        <span class=\"string\">&quot;top_hits&quot;</span>: &#123; <span class=\"comment\"># è‡ªå®šä¹‰åç§°</span></span><br><span class=\"line\">          <span class=\"string\">&quot;top_hits&quot;</span>: &#123; <span class=\"comment\"># è¿”å›æ¯ä¸ªç»„çš„å‰3æ¡æ•°æ®</span></span><br><span class=\"line\">            <span class=\"string\">&quot;size&quot;</span>: 3, <span class=\"comment\"># è¿”å›å‰3æ¡æ•°æ®</span></span><br><span class=\"line\">            <span class=\"string\">&quot;sort&quot;</span>: &#123; <span class=\"comment\"># æŒ‰ç…§created_atå­—æ®µè¿›è¡Œæ’åº</span></span><br><span class=\"line\">              <span class=\"string\">&quot;created_at&quot;</span>: &#123;</span><br><span class=\"line\">                <span class=\"string\">&quot;order&quot;</span>: <span class=\"string\">&quot;desc&quot;</span> <span class=\"comment\"># é™åº</span></span><br><span class=\"line\">              &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"å­èšåˆ\">å­èšåˆ</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å­èšåˆï¼šåœ¨èšåˆå‡½æ•°ä¸­ï¼Œè¿˜å¯ä»¥å†å®šä¹‰ä¸€ä¸ªèšåˆå‡½æ•°ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ç¤ºä¾‹ï¼šæŒ‰ç…§categoryè¿›è¡Œåˆ†ç»„ï¼Œå¹¶ç»Ÿè®¡ä»·æ ¼ä¿¡æ¯</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">GET /shopping/_search</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">&quot;size&quot;</span>: 0,</span><br><span class=\"line\">  <span class=\"string\">&quot;aggs&quot;</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;category_buckets&quot;</span>: &#123; <span class=\"comment\"># è‡ªå®šä¹‰åç§°</span></span><br><span class=\"line\">      <span class=\"string\">&quot;terms&quot;</span>: &#123;</span><br><span class=\"line\">        <span class=\"string\">&quot;field&quot;</span>: <span class=\"string\">&quot;category&quot;</span>  <span class=\"comment\"># æŒ‰ç…§categoryå­—æ®µè¿›è¡Œåˆ†ç»„</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"string\">&quot;aggs&quot;</span>: &#123; <span class=\"comment\"># å®šä¹‰å­èšåˆ</span></span><br><span class=\"line\">        <span class=\"string\">&quot;price_stats&quot;</span>: &#123;</span><br><span class=\"line\">          <span class=\"string\">&quot;stats&quot;</span>: &#123; <span class=\"comment\"># ç»Ÿè®¡ä»·æ ¼ä¿¡æ¯</span></span><br><span class=\"line\">            <span class=\"string\">&quot;field&quot;</span>: <span class=\"string\">&quot;price&quot;</span></span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å¤šå±‚åµŒå¥—</span></span><br><span class=\"line\"><span class=\"comment\"># å…ˆæŒ‰ç…§categoryè¿›è¡Œåˆ†ç»„ï¼Œå†æŒ‰ç…§addressè¿›è¡Œåˆ†ç»„ï¼Œå¹¶ç»Ÿè®¡ä»·æ ¼ä¿¡æ¯</span></span><br><span class=\"line\">GET /shopping/_search</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">&quot;size&quot;</span>:0,</span><br><span class=\"line\">  <span class=\"string\">&quot;aggs&quot;</span>:&#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;category_buckets&quot;</span>:&#123;</span><br><span class=\"line\">      <span class=\"string\">&quot;terms&quot;</span>:&#123;</span><br><span class=\"line\">        <span class=\"string\">&quot;field&quot;</span>:<span class=\"string\">&quot;category&quot;</span></span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      <span class=\"string\">&quot;aggs&quot;</span>:&#123;</span><br><span class=\"line\">        <span class=\"string\">&quot;address_buckets&quot;</span>:&#123;</span><br><span class=\"line\">          <span class=\"string\">&quot;terms&quot;</span>:&#123;</span><br><span class=\"line\">            <span class=\"string\">&quot;field&quot;</span>:<span class=\"string\">&quot;address.keyword&quot;</span></span><br><span class=\"line\">          &#125;,</span><br><span class=\"line\">          <span class=\"string\">&quot;aggs&quot;</span>:&#123;</span><br><span class=\"line\">            <span class=\"string\">&quot;price_stats&quot;</span>:&#123;</span><br><span class=\"line\">              <span class=\"string\">&quot;stats&quot;</span>:&#123;</span><br><span class=\"line\">                <span class=\"string\">&quot;field&quot;</span>:<span class=\"string\">&quot;price&quot;</span></span><br><span class=\"line\">              &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"Pipeline-Aggregation-ç®¡é“èšåˆ\">Pipeline Aggregation(ç®¡é“èšåˆ)</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ”¯æŒå¯¹èšåˆåˆ†æçš„ç»“æœï¼Œå†æ¬¡è¿›è¡Œèšåˆåˆ†æã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>Pipeline çš„åˆ†æç»“æœä¼šè¾“å‡ºåˆ°åŸç»“æœä¸­ï¼Œæ ¹æ®ä½ç½®çš„ä¸åŒï¼Œåˆ†ä¸ºä¸¤ç±»ï¼š</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">Sibling - ç»“æœå’Œç°æœ‰åˆ†æç»“æœåŒçº§\n<ul class=\"lvl-4\">\n<li class=\"lvl-6\">Maxï¼Œminï¼ŒAvg &amp; Sum Bucket</li>\n<li class=\"lvl-6\">Statsï¼ŒExtended Status Bucket</li>\n<li class=\"lvl-6\">Percentiles Bucket</li>\n</ul>\n</li>\n<li class=\"lvl-4\">Parent -ç»“æœå†…åµŒåˆ°ç°æœ‰çš„èšåˆåˆ†æç»“æœä¹‹ä¸­\n<ul class=\"lvl-4\">\n<li class=\"lvl-6\">Derivative(æ±‚å¯¼)</li>\n<li class=\"lvl-6\">Cumultive Sum(ç´¯è®¡æ±‚å’Œ)</li>\n<li class=\"lvl-6\">Moving Function(ç§»åŠ¨å¹³å‡å€¼)</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"Maxï¼Œminï¼ŒAvg-Sum-Bucket\">Maxï¼Œminï¼ŒAvg &amp; Sum Bucket</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Maxï¼Œminï¼ŒAvg &amp; Sum Bucketï¼šå¯¹èšåˆåˆ†æçš„ç»“æœè¿›è¡Œæœ€å¤§å€¼ã€æœ€å°å€¼ã€å¹³å‡å€¼ã€æ±‚å’Œç­‰æ“ä½œã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ç¤ºä¾‹ï¼šæŒ‰ç…§categoryè¿›è¡Œåˆ†ç»„æ±‚å‡ºå•†å“çš„å¹³å‡ä»·æ ¼ï¼Œå¹¶æ‰¾å‡ºå¹³å‡ä»·æ ¼æœ€ä½çš„åˆ†ç»„</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">GET /shopping/_search</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">&quot;size&quot;</span>:0,</span><br><span class=\"line\">  <span class=\"string\">&quot;aggs&quot;</span>:&#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;category_buckets&quot;</span>:&#123;</span><br><span class=\"line\">      <span class=\"string\">&quot;terms&quot;</span>:&#123;</span><br><span class=\"line\">        <span class=\"string\">&quot;field&quot;</span>:<span class=\"string\">&quot;category&quot;</span> <span class=\"comment\"># æŒ‰ç…§categoryå­—æ®µè¿›è¡Œåˆ†ç»„</span></span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      <span class=\"string\">&quot;aggs&quot;</span>:&#123;</span><br><span class=\"line\">        <span class=\"string\">&quot;price_avg&quot;</span>:&#123;</span><br><span class=\"line\">          <span class=\"string\">&quot;avg&quot;</span>:&#123; <span class=\"comment\"># æ±‚ä»·æ ¼å¹³å‡å€¼</span></span><br><span class=\"line\">            <span class=\"string\">&quot;field&quot;</span>:<span class=\"string\">&quot;price&quot;</span></span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"string\">&quot;min_price_in_category&quot;</span>:&#123; <span class=\"comment\"># æ‰¾å‡ºå¹³å‡ä»·æ ¼æœ€ä½çš„åˆ†ç»„</span></span><br><span class=\"line\">      <span class=\"string\">&quot;min_bucket&quot;</span>:&#123; <span class=\"comment\"># å¯¹èšåˆç»“æœè¿›è¡Œæœ€å°å€¼æ“ä½œ</span></span><br><span class=\"line\">        <span class=\"string\">&quot;buckets_path&quot;</span>:<span class=\"string\">&quot;category_buckets&gt;price_avg&quot;</span> <span class=\"comment\"># æŒ‡å®šè·¯å¾„ï¼Œå¯¹category_bucketsèšåˆç»“æœä¸­çš„price_avgå­—æ®µè¿›è¡Œæœ€å°å€¼æ“ä½œ</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"Statsï¼ŒExtended-Status-Bucket\">Statsï¼ŒExtended Status Bucket</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Statsï¼ŒExtended Status Bucketï¼šå¯¹èšåˆåˆ†æçš„ç»“æœè¿›è¡Œç»Ÿè®¡æ“ä½œï¼ŒåŒ…æ‹¬æœ€å¤§å€¼ã€æœ€å°å€¼ã€å¹³å‡å€¼ã€æ±‚å’Œã€æ•°é‡ç­‰ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ç¤ºä¾‹ï¼šæŒ‰ç…§categoryè¿›è¡Œåˆ†ç»„æ±‚å‡ºå•†å“çš„å¹³å‡ä»·æ ¼ï¼Œå¹¶å¯¹åˆ†ç»„ç»“æœè¿›è¡Œç»Ÿè®¡æ“ä½œ</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">GET /shopping/_search</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">&quot;size&quot;</span>: 0,</span><br><span class=\"line\">  <span class=\"string\">&quot;aggs&quot;</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;category_buckets&quot;</span>: &#123;</span><br><span class=\"line\">      <span class=\"string\">&quot;terms&quot;</span>: &#123;</span><br><span class=\"line\">        <span class=\"string\">&quot;field&quot;</span>: <span class=\"string\">&quot;category&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;size&quot;</span>: 10 <span class=\"comment\"># æŒ‡å®šåˆ†ç»„æ•°é‡</span></span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      <span class=\"string\">&quot;aggs&quot;</span>: &#123;</span><br><span class=\"line\">        <span class=\"string\">&quot;avg_price&quot;</span>: &#123;</span><br><span class=\"line\">          <span class=\"string\">&quot;avg&quot;</span>: &#123;</span><br><span class=\"line\">            <span class=\"string\">&quot;field&quot;</span>: <span class=\"string\">&quot;price&quot;</span></span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"string\">&quot;stats_price_by_job&quot;</span>:&#123;</span><br><span class=\"line\">      <span class=\"string\">&quot;stats_bucket&quot;</span>: &#123; <span class=\"comment\"># å¯¹èšåˆç»“æœè¿›è¡Œç»Ÿè®¡æ“ä½œ</span></span><br><span class=\"line\">        <span class=\"string\">&quot;buckets_path&quot;</span>: <span class=\"string\">&quot;category_buckets&gt;avg_price&quot;</span> <span class=\"comment\"># æŒ‡å®šè·¯å¾„ï¼Œå¯¹category_bucketsèšåˆç»“æœä¸­çš„avg_priceå­—æ®µè¿›è¡Œç»Ÿè®¡æ“ä½œ</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"Percentiles-Bucket\">Percentiles Bucket</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Percentiles Bucketï¼šå¯¹èšåˆåˆ†æçš„ç»“æœè¿›è¡Œç™¾åˆ†æ¯”æ“ä½œï¼ŒåŒ…æ‹¬ç™¾åˆ†æ¯”ã€ä¸­ä½æ•°ç­‰ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ç¤ºä¾‹ï¼šæŒ‰ç…§categoryè¿›è¡Œåˆ†ç»„æ±‚å‡ºå•†å“çš„å¹³å‡ä»·æ ¼ï¼Œå¹¶å¯¹åˆ†ç»„ç»“æœè¿›è¡Œç™¾åˆ†æ¯”æ“ä½œ</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">GET /shopping/_search</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">&quot;size&quot;</span>: 0,</span><br><span class=\"line\">  <span class=\"string\">&quot;aggs&quot;</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;category_buckets&quot;</span>: &#123;</span><br><span class=\"line\">      <span class=\"string\">&quot;terms&quot;</span>: &#123;</span><br><span class=\"line\">        <span class=\"string\">&quot;field&quot;</span>: <span class=\"string\">&quot;category&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;size&quot;</span>: 10</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      <span class=\"string\">&quot;aggs&quot;</span>: &#123;</span><br><span class=\"line\">        <span class=\"string\">&quot;avg_price&quot;</span>: &#123;</span><br><span class=\"line\">          <span class=\"string\">&quot;avg&quot;</span>: &#123;</span><br><span class=\"line\">            <span class=\"string\">&quot;field&quot;</span>: <span class=\"string\">&quot;price&quot;</span></span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"string\">&quot;percentiles_price_by_category&quot;</span>:&#123;</span><br><span class=\"line\">      <span class=\"string\">&quot;percentiles_bucket&quot;</span>: &#123; <span class=\"comment\"># å¯¹èšåˆç»“æœè¿›è¡Œç»Ÿè®¡æ“ä½œ</span></span><br><span class=\"line\">        <span class=\"string\">&quot;buckets_path&quot;</span>: <span class=\"string\">&quot;category_buckets&gt;avg_price&quot;</span> <span class=\"comment\"># æŒ‡å®šè·¯å¾„ï¼Œå¯¹category_bucketsèšåˆç»“æœä¸­çš„avg_priceå­—æ®µè¿›è¡Œç»Ÿè®¡æ“ä½œ</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"Cumulative-Sum\">Cumulative Sum</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Cumulative Sumï¼šå¯¹èšåˆåˆ†æçš„ç»“æœè¿›è¡Œç´¯è®¡æ±‚å’Œæ“ä½œã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ç¤ºä¾‹: æŒ‰ç…§ä»·æ ¼è¿›è¡Œåˆ†ç»„ï¼Œå¹¶ç»Ÿè®¡å¹³å‡ä»·æ ¼ä¿¡æ¯ï¼Œå¯¹åˆ†ç»„ç»“æœè¿›è¡Œç´¯è®¡æ±‚å’Œæ“ä½œã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">GET /shopping/_search</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">&quot;size&quot;</span>: 0,</span><br><span class=\"line\">  <span class=\"string\">&quot;aggs&quot;</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;price_histogram&quot;</span>: &#123;</span><br><span class=\"line\">      <span class=\"string\">&quot;histogram&quot;</span>: &#123;</span><br><span class=\"line\">        <span class=\"string\">&quot;field&quot;</span>: <span class=\"string\">&quot;price&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;interval&quot;</span>: 500, <span class=\"comment\"># é—´éš”500</span></span><br><span class=\"line\">        <span class=\"string\">&quot;extended_bounds&quot;</span>:&#123; <span class=\"comment\"># è®¾ç½®è¾¹ç•Œ</span></span><br><span class=\"line\">          <span class=\"string\">&quot;min&quot;</span>:0, <span class=\"comment\"># æœ€å°å€¼0</span></span><br><span class=\"line\">          <span class=\"string\">&quot;max&quot;</span>:2000 <span class=\"comment\"># æœ€å¤§å€¼2000</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      <span class=\"string\">&quot;aggs&quot;</span>: &#123;</span><br><span class=\"line\">        <span class=\"string\">&quot;avg_price&quot;</span>: &#123;</span><br><span class=\"line\">          <span class=\"string\">&quot;avg&quot;</span>: &#123;</span><br><span class=\"line\">            <span class=\"string\">&quot;field&quot;</span>: <span class=\"string\">&quot;price&quot;</span></span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        <span class=\"string\">&quot;cumulative_sum_price&quot;</span>: &#123;</span><br><span class=\"line\">          <span class=\"string\">&quot;cumulative_sum&quot;</span>: &#123; <span class=\"comment\"># å¯¹èšåˆç»“æœè¿›è¡Œç´¯è®¡æ±‚å’Œæ“ä½œ</span></span><br><span class=\"line\">            <span class=\"string\">&quot;buckets_path&quot;</span>: <span class=\"string\">&quot;avg_price&quot;</span> <span class=\"comment\"># æŒ‡å®šè·¯å¾„ï¼Œå¯¹avg_priceå­—æ®µè¿›è¡Œç´¯è®¡æ±‚å’Œæ“ä½œ</span></span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"Derivative\">Derivative</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Derivativeï¼šå¯¹èšåˆåˆ†æçš„ç»“æœè¿›è¡Œæ±‚å¯¼æ“ä½œã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>Derivative èšåˆæŸ¥è¯¢æ˜¯ Elasticsearch ä¸­çš„ä¸€ç§é«˜çº§èšåˆç±»å‹ï¼Œç”¨äºè®¡ç®—æŸä¸ªåº¦é‡å€¼éšæ—¶é—´ï¼ˆæˆ–å…¶ä»–é¡ºåºå­—æ®µï¼‰å˜åŒ–çš„é€Ÿç‡ã€‚å®ƒé€šå¸¸ç”¨äºæ—¶é—´åºåˆ—åˆ†æï¼Œä»¥æ­ç¤ºåº¦é‡å€¼çš„å¢å‡è¶‹åŠ¿ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ç¤ºä¾‹ï¼šæ˜¾ç¤ºæ¯å¤©çš„å¹³å‡ä»·æ ¼ä»¥åŠå¹³å‡ä»·æ ¼çš„å˜åŒ–è¶‹åŠ¿</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">GET /shopping/_search</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">&quot;size&quot;</span>: 0,</span><br><span class=\"line\">  <span class=\"string\">&quot;aggs&quot;</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;price_over_time&quot;</span>: &#123;</span><br><span class=\"line\">      <span class=\"string\">&quot;date_histogram&quot;</span>: &#123; <span class=\"comment\"># æŒ‰ç…§æ—¥æœŸè¿›è¡Œåˆ†ç»„</span></span><br><span class=\"line\">        <span class=\"string\">&quot;field&quot;</span>: <span class=\"string\">&quot;created_at&quot;</span>, <span class=\"comment\"># æŒ‡å®šå­—æ®µ</span></span><br><span class=\"line\">        <span class=\"string\">&quot;calendar_interval&quot;</span>: <span class=\"string\">&quot;day&quot;</span> <span class=\"comment\"># æŒ‡å®šæ—¶é—´é—´éš”ï¼Œå¯ç”¨çš„å€¼ï¼šyearã€quarterã€monthã€weekã€dayã€hourã€minuteã€second</span></span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      <span class=\"string\">&quot;aggs&quot;</span>: &#123;</span><br><span class=\"line\">        <span class=\"string\">&quot;average_price&quot;</span>: &#123;</span><br><span class=\"line\">          <span class=\"string\">&quot;avg&quot;</span>: &#123;</span><br><span class=\"line\">            <span class=\"string\">&quot;field&quot;</span>: <span class=\"string\">&quot;price&quot;</span></span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        <span class=\"string\">&quot;price_derivative&quot;</span>: &#123;</span><br><span class=\"line\">          <span class=\"string\">&quot;derivative&quot;</span>: &#123; <span class=\"comment\"># å¯¹èšåˆç»“æœè¿›è¡Œæ±‚å¯¼æ“ä½œ</span></span><br><span class=\"line\">            <span class=\"string\">&quot;buckets_path&quot;</span>: <span class=\"string\">&quot;average_price&quot;</span></span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"Moving-Function\">Moving Function</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Moving Functionï¼šå¯¹èšåˆåˆ†æçš„ç»“æœè¿›è¡Œç§»åŠ¨å¹³å‡å€¼æ“ä½œã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>Moving Function èšåˆæŸ¥è¯¢æ˜¯ Elasticsearch ä¸­çš„ä¸€ç§é«˜çº§èšåˆç±»å‹ï¼Œç”¨äºè®¡ç®—æŸä¸ªåº¦é‡å€¼åœ¨æ—¶é—´çª—å£å†…çš„ç§»åŠ¨å¹³å‡å€¼ã€‚å®ƒé€šå¸¸ç”¨äºæ—¶é—´åºåˆ—åˆ†æï¼Œä»¥äº†è§£åº¦é‡å€¼çš„å˜åŒ–è¶‹åŠ¿ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ç¤ºä¾‹ï¼šè®¡ç®— price å­—æ®µçš„ 7 å¤©ç§»åŠ¨å¹³å‡å€¼</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">GET /shopping/_search</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">&quot;size&quot;</span>: 0,</span><br><span class=\"line\">  <span class=\"string\">&quot;aggs&quot;</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;price_over_time&quot;</span>: &#123;</span><br><span class=\"line\">      <span class=\"string\">&quot;date_histogram&quot;</span>: &#123;</span><br><span class=\"line\">        <span class=\"string\">&quot;field&quot;</span>: <span class=\"string\">&quot;created_at&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;calendar_interval&quot;</span>: <span class=\"string\">&quot;day&quot;</span></span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      <span class=\"string\">&quot;aggs&quot;</span>: &#123;</span><br><span class=\"line\">        <span class=\"string\">&quot;daily_avg_price&quot;</span>: &#123;</span><br><span class=\"line\">          <span class=\"string\">&quot;avg&quot;</span>: &#123;</span><br><span class=\"line\">            <span class=\"string\">&quot;field&quot;</span>: <span class=\"string\">&quot;price&quot;</span></span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        <span class=\"string\">&quot;moving_avg_price&quot;</span>: &#123;</span><br><span class=\"line\">          <span class=\"string\">&quot;moving_fn&quot;</span>: &#123; <span class=\"comment\"># å¯¹èšåˆç»“æœè¿›è¡Œç§»åŠ¨å¹³å‡å€¼æ“ä½œ</span></span><br><span class=\"line\">            <span class=\"string\">&quot;buckets_path&quot;</span>: <span class=\"string\">&quot;daily_avg_price&quot;</span>, <span class=\"comment\"># æŒ‡å®šè·¯å¾„ï¼Œå¯¹daily_avg_priceå­—æ®µè¿›è¡Œç§»åŠ¨å¹³å‡å€¼æ“ä½œ</span></span><br><span class=\"line\">            <span class=\"string\">&quot;script&quot;</span>: <span class=\"string\">&quot;MovingFunctions.unweightedAvg(values)&quot;</span>, <span class=\"comment\"># æŒ‡å®šè„šæœ¬ï¼Œè®¡ç®—ç§»åŠ¨å¹³å‡å€¼</span></span><br><span class=\"line\">            <span class=\"string\">&quot;window&quot;</span>: 7, <span class=\"comment\"># çª—å£å¤§å°ï¼Œé»˜è®¤ä¸º 10</span></span><br><span class=\"line\">            <span class=\"string\">&quot;shift&quot;</span>: 0 <span class=\"comment\"># çª—å£åç§»é‡ï¼Œé»˜è®¤ä¸º 0</span></span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"ES-èšåˆæ€§èƒ½ä¼˜åŒ–\">ES èšåˆæ€§èƒ½ä¼˜åŒ–</h2>\n<h3 id=\"ç´¢å¼•é¢„æ’åº\">ç´¢å¼•é¢„æ’åº</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¦‚æœæ˜¯ Elasticsearch 6.X ä¹‹åç‰ˆæœ¬ï¼Œå¯ä»¥åœ¨æ’å…¥æ•°æ®æ—¶å¯¹ç´¢å¼•è¿›è¡Œé¢„æ’åºï¼Œè€Œä¸æ˜¯åœ¨æŸ¥è¯¢æ—¶å†å¯¹ç´¢å¼•è¿›è¡Œæ’åºï¼Œè¿™å°†æé«˜èŒƒå›´æŸ¥è¯¢ï¼ˆrange queryï¼‰å’Œæ’åºæ“ä½œçš„æ€§èƒ½ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä½†é¢„æ’åºå°†å¢åŠ  Elasticsearch å†™å…¥çš„æˆæœ¬ï¼Œå¯¼è‡´å¤§çº¦ 40%-50% çš„å†™æ€§èƒ½ä¸‹é™ï¼Œå¦‚æœåº”ç”¨åœºæ™¯æ˜¯æ›´å…³æ³¨å†™æ€§èƒ½çš„ä¸šåŠ¡ï¼Œå¼€å¯ç´¢å¼•é¢„æ’åºä¸æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é€‰æ‹©ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">PUT /my_index</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">&quot;settings&quot;</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;index&quot;</span>:&#123;</span><br><span class=\"line\">      <span class=\"string\">&quot;sort.field&quot;</span>: <span class=\"string\">&quot;create_time&quot;</span>,</span><br><span class=\"line\">      <span class=\"string\">&quot;sort.order&quot;</span>: <span class=\"string\">&quot;desc&quot;</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"string\">&quot;mappings&quot;</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;properties&quot;</span>: &#123;</span><br><span class=\"line\">      <span class=\"string\">&quot;create_time&quot;</span>:&#123;</span><br><span class=\"line\">        <span class=\"string\">&quot;type&quot;</span>: <span class=\"string\">&quot;date&quot;</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"ä½¿ç”¨åˆ†ç‰‡è¯·æ±‚ç¼“å­˜\">ä½¿ç”¨åˆ†ç‰‡è¯·æ±‚ç¼“å­˜</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>èšåˆè¯­å¥ä¸­ï¼Œè®¾ç½®ï¼šsizeï¼š0ï¼Œå°±ä¼šä½¿ç”¨åˆ†ç‰‡è¯·æ±‚ç¼“å­˜ç¼“å­˜ç»“æœã€‚size = 0 çš„å«ä¹‰æ˜¯ï¼šåªè¿”å›èšåˆç»“æœï¼Œä¸è¿”å›æŸ¥è¯¢ç»“æœã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">GET /my_index/_search</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">&quot;size&quot;</span>: 0,</span><br><span class=\"line\">  <span class=\"string\">&quot;aggs&quot;</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;remark_agg&quot;</span>: &#123;</span><br><span class=\"line\">      <span class=\"string\">&quot;terms&quot;</span>: &#123;</span><br><span class=\"line\">        <span class=\"string\">&quot;field&quot;</span>: <span class=\"string\">&quot;remark.keyword&quot;</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"æ‹†åˆ†èšåˆï¼Œä½¿èšåˆå¹¶è¡ŒåŒ–\">æ‹†åˆ†èšåˆï¼Œä½¿èšåˆå¹¶è¡ŒåŒ–</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Elasticsearch æŸ¥è¯¢æ¡ä»¶ä¸­åŒæ—¶æœ‰å¤šä¸ªæ¡ä»¶èšåˆï¼Œé»˜è®¤æƒ…å†µä¸‹èšåˆä¸æ˜¯å¹¶è¡Œè¿è¡Œçš„ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å½“ä¸ºæ¯ä¸ªèšåˆæä¾›è‡ªå·±çš„æŸ¥è¯¢å¹¶æ‰§è¡Œ msearch æ—¶ï¼Œæ€§èƒ½ä¼šæœ‰æ˜¾è‘—æå‡ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å› æ­¤ï¼Œåœ¨ CPU èµ„æºä¸æ˜¯ç“¶é¢ˆçš„å‰æä¸‹ï¼Œå¦‚æœæƒ³ç¼©çŸ­å“åº”æ—¶é—´ï¼Œå¯ä»¥å°†å¤šä¸ªèšåˆæ‹†åˆ†ä¸ºå¤šä¸ªæŸ¥è¯¢ï¼Œå€ŸåŠ©ï¼šmsearch å®ç°å¹¶è¡Œèšåˆã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#å¸¸è§„çš„å¤šæ¡ä»¶èšåˆå®ç°</span></span><br><span class=\"line\">GET /employees/_search</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">&quot;size&quot;</span>: 0,</span><br><span class=\"line\">  <span class=\"string\">&quot;aggs&quot;</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;job_agg&quot;</span>: &#123;</span><br><span class=\"line\">      <span class=\"string\">&quot;terms&quot;</span>: &#123;</span><br><span class=\"line\">        <span class=\"string\">&quot;field&quot;</span>: <span class=\"string\">&quot;job.keyword&quot;</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"string\">&quot;max_salary&quot;</span>:&#123;</span><br><span class=\"line\">      <span class=\"string\">&quot;max&quot;</span>: &#123;</span><br><span class=\"line\">        <span class=\"string\">&quot;field&quot;</span>: <span class=\"string\">&quot;salary&quot;</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\"># msearch æ‹†åˆ†å¤šä¸ªè¯­å¥çš„èšåˆå®ç°</span></span><br><span class=\"line\">GET _msearch</span><br><span class=\"line\">&#123;<span class=\"string\">&quot;index&quot;</span>:<span class=\"string\">&quot;employees&quot;</span>&#125;</span><br><span class=\"line\">&#123;<span class=\"string\">&quot;size&quot;</span>:0,<span class=\"string\">&quot;aggs&quot;</span>:&#123;<span class=\"string\">&quot;job_agg&quot;</span>:&#123;<span class=\"string\">&quot;terms&quot;</span>:&#123;<span class=\"string\">&quot;field&quot;</span>: <span class=\"string\">&quot;job.keyword&quot;</span>&#125;&#125;&#125;&#125;</span><br><span class=\"line\">&#123;<span class=\"string\">&quot;index&quot;</span>:<span class=\"string\">&quot;employees&quot;</span>&#125;</span><br><span class=\"line\">&#123;<span class=\"string\">&quot;size&quot;</span>:0,<span class=\"string\">&quot;aggs&quot;</span>:&#123;<span class=\"string\">&quot;max_salary&quot;</span>:&#123;<span class=\"string\">&quot;max&quot;</span>:&#123;<span class=\"string\">&quot;field&quot;</span>: <span class=\"string\">&quot;salary&quot;</span>&#125;&#125;&#125;&#125;</span><br></pre></td></tr></table></figure>","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» Elasticsearch çš„ REST APIsï¼šèšåˆæŸ¥è¯¢ Elasticsearchç‰ˆæœ¬8.17.3 å®˜æ–¹æ–‡æ¡£:REST APIs å®˜æ–¹æ–‡æ¡£:Aggregations Elasticsearch çš„ REST APIs èšåˆæŸ¥è¯¢ èšåˆæŸ¥è¯¢ï¼Œå¯ä»¥è®©æˆ‘ä»¬æå…¶æ–¹ä¾¿çš„å®ç°å¯¹ç´¢å¼•æ•°æ®çš„ç»Ÿè®¡ã€åˆ†æã€è¿ç®—ç­‰æ“ä½œã€‚ åŸºæœ¬è¯­æ³•åŒ…æ‹¬ä»¥ä¸‹éƒ¨åˆ†ï¼š æŸ¥è¯¢æ¡ä»¶ï¼šæŒ‡å®šéœ€è¦èšåˆçš„æ–‡æ¡£ï¼Œå¯ä»¥ä½¿ç”¨æ ‡å‡†çš„ Elasticsearch æŸ¥è¯¢è¯­æ³•ï¼Œå¦‚ termã€matchã€range ç­‰ç­‰ã€‚ èšåˆå‡½æ•°ï¼šæŒ‡å®šè¦æ‰§è¡Œçš„èšåˆæ“ä½œï¼Œå¦‚ sumã€avgã€minã€maxã€termsã€date_histogram ç­‰ç­‰ã€‚æ¯ä¸ªèšåˆå‘½ä»¤éƒ½ä¼šç”Ÿæˆä¸€ä¸ªèšåˆç»“æœã€‚ èšåˆåµŒå¥—ï¼šèšåˆå‘½ä»¤å¯ä»¥åµŒå¥—ï¼Œä»¥ä¾¿æ›´ç»†ç²’åº¦åœ°åˆ†ææ•°æ®ã€‚ 123456789101112131415GET &lt;index_name&gt;/_search&#123; &quot;aggs&quot;: &#123; &quot;&lt;aggs_name&gt;&quot;: &#123; &quot;&lt;agg_type&gt;&quot;: &#123; &quot;field&quot;: &quot;&lt;field_name&gt;&quot; &#125; &#125; &#125;&#125;# è¯´æ˜ # aggsï¼šèšåˆçš„æ ¹èŠ‚ç‚¹ï¼Œå›ºå®šå†™æ³• # aggs_nameï¼šèšåˆå‡½æ•°çš„åç§°ï¼Œè‡ªå·±éšæ„å®šä¹‰ # agg_typeï¼šèšåˆç§ç±»ï¼Œæ¯”å¦‚æ˜¯æ¡¶èšåˆï¼ˆtermsï¼‰æˆ–è€…æ˜¯æŒ‡æ ‡èšåˆï¼ˆavgã€sumã€minã€maxç­‰ï¼‰ # field_nameï¼šå­—æ®µåç§°æˆ–è€…å«åŸŸåã€‚ èšåˆçš„åˆ†ç±» Metric Aggregationï¼šâ€”äº›æ•°å­¦è¿ç®—ï¼Œå¯ä»¥å¯¹æ–‡æ¡£å­—æ®µè¿›è¡Œç»Ÿè®¡åˆ†æï¼Œç±»æ¯”Mysqlä¸­çš„ min(), max(), sum() æ“ä½œã€‚ Bucket Aggregationï¼šä¸€äº›æ»¡è¶³ç‰¹å®šæ¡ä»¶çš„æ–‡æ¡£çš„é›†åˆæ”¾ç½®åˆ°ä¸€ä¸ªæ¡¶é‡Œï¼Œæ¯ä¸€ä¸ªæ¡¶å…³è”ä¸€ä¸ªkeyï¼Œç±»æ¯”Mysqlä¸­çš„group byæ“ä½œã€‚ Pipeline Aggregationï¼šå¯¹å…¶ä»–çš„èšåˆç»“æœè¿›è¡ŒäºŒæ¬¡èšåˆ ç¤ºä¾‹æ•°æ®å‡†å¤‡ æˆ‘ä»¬éœ€è¦å…ˆå‡†å¤‡ä¸€äº›æ•°æ®ï¼Œæ‰èƒ½è¿›è¡Œèšåˆåˆ†æã€‚ åˆ›å»ºç´¢å¼• 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465# å¦‚æœå­˜åœ¨å…ˆåˆ é™¤curl -X DELETE -u elastic:123456 -k &#x27;https://127.0.0.1:9200/shopping&#x27;# åˆ›å»ºç´¢å¼•curl -X PUT -u elastic:123456 -k &#x27;https://127.0.0.1:9200/shopping&#x27; \\ -H &#x27;Content-Type: application/json&#x27; \\ -d &#x27;&#123; &quot;settings&quot;:&#123; &quot;number_of_shards&quot;:&quot;1&quot;, &quot;number_of_replicas&quot;:&quot;2&quot; &#125;, &quot;mappings&quot;:&#123; &quot;properties&quot;:&#123; &quot;category&quot;:&#123; &quot;type&quot;:&quot;keyword&quot; &#125;, &quot;price&quot;:&#123; &quot;type&quot;:&quot;double&quot; &#125;, &quot;count&quot;:&#123; &quot;type&quot;:&quot;integer&quot; &#125;, &quot;title&quot;:&#123; &quot;type&quot;:&quot;text&quot;, &quot;analyzer&quot;:&quot;ik_max_word&quot;, &quot;search_analyzer&quot;:&quot;ik_smart&quot; &#125;, &quot;remark&quot;:&#123; &quot;type&quot;:&quot;text&quot;, &quot;analyzer&quot;:&quot;ik_max_word&quot;, &quot;search_analyzer&quot;:&quot;ik_smart&quot; &#125;, &quot;address&quot;: &#123; &quot;type&quot;: &quot;text&quot;, &quot;analyzer&quot;: &quot;ik_max_word&quot;, &quot;fields&quot;: &#123; &quot;keyword&quot;: &#123; &quot;type&quot;: &quot;keyword&quot; &#125; &#125; &#125;, &quot;tags&quot;: &#123; &quot;type&quot;: &quot;keyword&quot; &#125;, &quot;created_at&quot;: &#123;&quot;type&quot;: &quot;date&quot;, &quot;format&quot;: &quot;yyyy-MM-dd HH:mm:ss&quot;&#125; &#125; &#125; &#125;&#x27;# æ’å…¥æ•°æ®curl -X POST -u elastic:123456 -k &#x27;https://127.0.0.1:9200/_bulk&#x27; \\ -H &#x27;Content-Type: application/json&#x27; \\ -d &#x27;&#123; &quot;index&quot;: &#123; &quot;_index&quot;: &quot;shopping&quot;, &quot;_id&quot;: &quot;1&quot; &#125; &#125;&#123; &quot;category&quot;: &quot;electronics&quot;, &quot;price&quot;: 999.99, &quot;count&quot;: 10, &quot;title&quot;: &quot;Smartphone X - 128GB&quot;, &quot;remark&quot;: &quot;This latest Smartphone X comes with a powerful processor and high-resolution camera.&quot;, &quot;address&quot;: &quot;å¹¿å·å¤©æ²³å…¬å›­&quot;, &quot;tags&quot;: [&quot;latest&quot;, &quot;smartphone&quot;, &quot;technology&quot;], &quot;created_at&quot;: &quot;2025-04-22 03:30:02&quot; &#125;&#123; &quot;index&quot;: &#123; &quot;_index&quot;: &quot;shopping&quot;, &quot;_id&quot;: &quot;2&quot; &#125; &#125;&#123; &quot;category&quot;: &quot;fashion&quot;, &quot;price&quot;: 49.99, &quot;count&quot;: 25, &quot;title&quot;: &quot;Designer T-shirt&quot;, &quot;remark&quot;: &quot;Trendy designer T-shirt made with high quality fabric.&quot;, &quot;address&quot;: &quot;å¹¿å·è”æ¹¾å¤§å¦&quot;, &quot;tags&quot;: [&quot;clothing&quot;, &quot;designer&quot;, &quot;style&quot;], &quot;created_at&quot;: &quot;2025-04-21 12:15:00&quot; &#125;&#123; &quot;index&quot;: &#123; &quot;_index&quot;: &quot;shopping&quot;, &quot;_id&quot;: &quot;3&quot; &#125; &#125;&#123; &quot;category&quot;: &quot;home_appliances&quot;, &quot;price&quot;: 299.99, &quot;count&quot;: 5, &quot;title&quot;: &quot;Robot Vacuum Cleaner&quot;, &quot;remark&quot;: &quot;Efficient robot vacuum cleaner with smart navigation.&quot;, &quot;address&quot;: &quot;å¹¿å·ç™½äº‘å±±å…¬å›­&quot;, &quot;tags&quot;: [&quot;appliances&quot;, &quot;vacuum&quot;, &quot;robot&quot;], &quot;created_at&quot;: &quot;2025-04-20 08:45:30&quot; &#125;&#123; &quot;index&quot;: &#123; &quot;_index&quot;: &quot;shopping&quot;, &quot;_id&quot;: &quot;4&quot; &#125; &#125;&#123; &quot;category&quot;: &quot;books&quot;, &quot;price&quot;: 19.99, &quot;count&quot;: 100, &quot;title&quot;: &quot;Inspirational Novel&quot;, &quot;remark&quot;: &quot;A gripping novel that inspires and motivates.&quot;, &quot;address&quot;: &quot;321 Book Rd, Shenzhen, China&quot;, &quot;tags&quot;: [&quot;book&quot;, &quot;novel&quot;, &quot;inspiration&quot;], &quot;created_at&quot;: &quot;2025-04-19 10:05:00&quot; &#125;&#123; &quot;index&quot;: &#123; &quot;_index&quot;: &quot;shopping&quot;, &quot;_id&quot;: &quot;5&quot; &#125; &#125;&#123; &quot;category&quot;: &quot;groceries&quot;, &quot;price&quot;: 3.99, &quot;count&quot;: 200, &quot;title&quot;: &quot;Organic Apples&quot;, &quot;remark&quot;: &quot;Fresh and crispy organic apples.&quot;, &quot;address&quot;: &quot;654 Grocery Ln, Chengdu, China&quot;, &quot;tags&quot;: [&quot;fruit&quot;, &quot;organic&quot;, &quot;healthy&quot;], &quot;created_at&quot;: &quot;2025-04-18 14:30:45&quot; &#125;&#123; &quot;index&quot;: &#123; &quot;_index&quot;: &quot;shopping&quot;, &quot;_id&quot;: &quot;6&quot; &#125; &#125;&#123; &quot;category&quot;: &quot;electronics&quot;, &quot;price&quot;: 1999.99, &quot;count&quot;: 15, &quot;title&quot;: &quot;Smartphone X - 256GB&quot;, &quot;remark&quot;: &quot;This latest Smartphone X comes with a powerful processor and high-resolution camera.&quot;, &quot;address&quot;: &quot;å¹¿å·å¤©æ²³å…¬å›­&quot;, &quot;tags&quot;: [&quot;latest&quot;, &quot;smartphone&quot;, &quot;technology&quot;], &quot;created_at&quot;: &quot;2025-04-22 03:30:02&quot; &#125;&#x27; Metric Aggregation(æŒ‡æ ‡èšåˆ) å•å€¼åˆ†æï¸°åªè¾“å‡ºä¸€ä¸ªåˆ†æç»“æœ min, max, avg, sum 123456789101112131415161718192021222324252627# æœ€å¤§å€¼ã€æœ€å°å€¼ã€å¹³å‡å€¼ã€æ€»å’ŒGET /shopping/_search&#123; &quot;size&quot;: 0, # ä¸è¿”å›æ–‡æ¡£ï¼Œåªè¿”å›èšåˆç»“æœ &quot;aggs&quot;: &#123; &quot;max_price&quot;: &#123; # è‡ªå®šä¹‰åç§°ï¼Œè¿™é‡Œè¿”å›æœ€å¤§å€¼ &quot;max&quot;: &#123; # æŒ‡æ ‡èšåˆå‡½æ•°åç§° &quot;field&quot;: &quot;price&quot; # æŒ‡æ ‡èšåˆå­—æ®µ &#125; &#125;, &quot;min_price&quot;: &#123; &quot;min&quot;: &#123; &quot;field&quot;: &quot;price&quot; &#125; &#125;, &quot;avg_price&quot;: &#123; &quot;avg&quot;: &#123; &quot;field&quot;: &quot;price&quot; &#125; &#125;, &quot;sum_price&quot;: &#123; &quot;sum&quot;: &#123; &quot;field&quot;: &quot;price&quot; &#125; &#125; &#125;&#125; Cardinalityï¼ˆç±»ä¼¼distinct Count) 1234567891011GET /shopping/_search&#123; &quot;size&quot;: 0, # ä¸è¿”å›æ–‡æ¡£ï¼Œåªè¿”å›èšåˆç»“æœ &quot;aggs&quot;: &#123; &quot;cardinality_count&quot;: &#123; # è‡ªå®šä¹‰åç§°ï¼Œè¿”å›å»é‡åçš„æ•°é‡ &quot;cardinality&quot;: &#123; # æŒ‡æ ‡èšåˆå‡½æ•°åç§°ï¼Œcardinalityè¡¨ç¤ºå»é‡ &quot;field&quot;: &quot;category&quot; # æŒ‡æ ‡èšåˆå­—æ®µï¼Œå»é‡çš„å­—æ®µ &#125; &#125; &#125;&#125; å¤šå€¼åˆ†æ:è¾“å‡ºå¤šä¸ªåˆ†æç»“æœ statsï¼ˆç»Ÿè®¡ï¼‰, extended stats 123456789101112131415161718192021222324252627282930313233343536373839GET /shopping/_search&#123; &quot;size&quot;: 0, &quot;aggs&quot;: &#123; &quot;stats_price&quot;: &#123; &quot;stats&quot;: &#123; # æŒ‡æ ‡èšåˆå‡½æ•°åç§°ï¼Œstatsè¡¨ç¤ºç»Ÿè®¡ï¼Œä¼šè¿”å›å¤šä¸ªæŒ‡æ ‡ &quot;field&quot;: &quot;price&quot; &#125; &#125; &#125;&#125;# ç»“æœ&#123; &quot;took&quot;: 15, &quot;timed_out&quot;: false, &quot;_shards&quot;: &#123; &quot;total&quot;: 1, &quot;successful&quot;: 1, &quot;skipped&quot;: 0, &quot;failed&quot;: 0 &#125;, &quot;hits&quot;: &#123; &quot;total&quot;: &#123; &quot;value&quot;: 12, &quot;relation&quot;: &quot;eq&quot; &#125;, &quot;max_score&quot;: null, &quot;hits&quot;: [] # å› ä¸ºè®¾ç½®size ä¸º 0ï¼Œæ‰€ä»¥è¿”å›çš„ç»“æœä¸ºç©º &#125;, &quot;aggregations&quot;: &#123; # èšåˆç»“æœ &quot;stats_price&quot;: &#123; # è‡ªå®šä¹‰åç§°ï¼Œè¿”å›å¤šç»„èšåˆç»“æœ &quot;count&quot;: 12, &quot;min&quot;: 3.99, &quot;max&quot;: 1999.99, &quot;avg&quot;: 562.1666666666666, &quot;sum&quot;: 6746 &#125; &#125;&#125; percentile ï¼ˆç™¾åˆ†ä½ï¼‰, percentile rank 1234567891011121314151617GET /shopping/_search&#123; &quot;size&quot;: 0, &quot;aggs&quot;: &#123; &quot;percentile_price&quot;: &#123; &quot;percentiles&quot;: &#123; # æŒ‡æ ‡èšåˆå‡½æ•°åç§°ï¼Œpercentilesè¡¨ç¤ºç™¾åˆ†ä½æ•°èšåˆè®¡ç®— &quot;field&quot;: &quot;price&quot;, # æŒ‡æ ‡èšåˆå­—æ®µ &quot;percents&quot;: [1, 5, 25, 50, 75, 95, 99] # éœ€è¦è®¡ç®—ç™¾åˆ†ä½æ•°çš„æ•°ç»„ &#125; &#125; &#125;&#125;# ç™¾åˆ†ä½æ•°æ˜¯ä¸€ä¸ªç»Ÿè®¡å­¦æ¦‚å¿µï¼Œç”¨äºæè¿°ä¸€ä¸ªç»™å®šé›†åˆçš„æ’åºå€¼ã€‚ä¾‹å¦‚ï¼š# ç¬¬ 1 ç™¾åˆ†ä½æ•°è¡¨ç¤ºæ•°æ®ä¸­å°äºè¿™ä¸ªå€¼çš„æ‰€æœ‰æ•°æ®å æ€»æ•°çš„ 1%ã€‚# ç¬¬ 50 ç™¾åˆ†ä½æ•°ï¼ˆä¸­ä½æ•°ï¼‰è¡¨ç¤ºæ•°æ®ä¸­çš„ä¸€åŠå°äºè¿™ä¸ªå€¼ï¼Œå¦ä¸€åŠå¤§äºè¿™ä¸ªå€¼ã€‚# ç¬¬ 99 ç™¾åˆ†ä½æ•°è¡¨ç¤ºæ•°æ®ä¸­å°äºè¿™ä¸ªå€¼çš„æ‰€æœ‰æ•°æ®å æ€»æ•°çš„ 99%ã€‚# é€šè¿‡è®¡ç®—è¿™äº›ç™¾åˆ†ä½æ•°ï¼Œä½ å¯ä»¥äº†è§£ price å­—æ®µåœ¨æ•´ä¸ªshoppingç´¢å¼•ä¸­çš„åˆ†å¸ƒæƒ…å†µï¼Œä»è€Œå¯ä»¥ç”¨äºæ•°æ®åˆ†æã€è¶‹åŠ¿åˆ¤æ–­ç­‰ã€‚ top hits(æ’åœ¨å‰é¢çš„ç¤ºä¾‹) 123456789101112GET /shopping/_search&#123; &quot;size&quot;: 0, &quot;aggs&quot;: &#123; &quot;top_hits&quot;: &#123; # è‡ªå®šä¹‰åç§°ï¼Œè¿”å›æ’åœ¨å‰é¢çš„ç¤ºä¾‹ &quot;top_hits&quot;: &#123; # æŒ‡æ ‡èšåˆå‡½æ•°åç§°ï¼Œtop_hitsè¡¨ç¤ºè¿”å›æ’åœ¨å‰é¢çš„ç¤ºä¾‹ &quot;sort&quot;: [&#123;&quot;price&quot;: &#123;&quot;order&quot;: &quot;desc&quot;&#125;&#125;], # æ’åºï¼ŒæŒ‰ç…§priceå­—æ®µé™åºæ’åº &quot;size&quot;: 3 # åªè¿”å›å‰3ä¸ª &#125; &#125; &#125;&#125; Bucket Aggregation(æ¡¶èšåˆ) æŒ‰ç…§ä¸€å®šçš„è§„åˆ™ï¼Œå°†æ–‡æ¡£åˆ†é…åˆ°ä¸åŒçš„æ¡¶ä¸­ï¼Œä»è€Œè¾¾åˆ°åˆ†ç±»çš„ç›®çš„ã€‚ ESæä¾›çš„ä¸€äº›å¸¸è§çš„ Bucket Aggregationã€‚ termsï¼ˆè¯æ¡ï¼‰, rangeï¼ˆèŒƒå›´ï¼‰, date_rangeï¼ˆæ—¥æœŸèŒƒå›´ï¼‰, ip_rangeï¼ˆIPèŒƒå›´ï¼‰, missingï¼ˆç¼ºå¤±ï¼‰, histogramï¼ˆç›´æ–¹å›¾ï¼‰, date_histogramï¼ˆæ—¥æœŸç›´æ–¹å›¾ï¼‰, geo_distanceï¼ˆåœ°ç†è·ç¦»ï¼‰, significant_termsï¼ˆé‡è¦è¯æ¡ï¼‰, compositeï¼ˆç»„åˆï¼‰ æ¡¶èšåˆå¯ä»¥ç”¨äºå„ç§åœºæ™¯ï¼Œä¾‹å¦‚ï¼š å¯¹æ•°æ®è¿›è¡Œåˆ†ç»„ç»Ÿè®¡ï¼Œæ¯”å¦‚æŒ‰ç…§åœ°åŒºã€å¹´é¾„æ®µã€æ€§åˆ«ç­‰å­—æ®µè¿›è¡Œåˆ†ç»„ç»Ÿè®¡ã€‚ å¯¹æ—¶é—´åºåˆ—æ•°æ®è¿›è¡Œæ—¶é—´æ®µåˆ†æï¼Œæ¯”å¦‚æŒ‰ç…§æ¯å°æ—¶ã€æ¯å¤©ã€æ¯æœˆã€æ¯å­£åº¦ã€æ¯å¹´ç­‰æ—¶é—´æ®µè¿›è¡Œåˆ†æã€‚ å¯¹å„ç§æ ‡ç­¾ä¿¡æ¯åˆ†ç±»ï¼Œå¹¶ç»Ÿè®¡å…¶æ•°é‡ã€‚ termsï¼ˆè¯æ¡ï¼‰ æŒ‰ç…§å­—æ®µçš„å€¼è¿›è¡Œåˆ†ç»„ï¼Œå¹¶ç»Ÿè®¡æ¯ä¸ªç»„çš„æ•°é‡ã€‚ ç¤ºä¾‹ï¼šæŒ‰ç…§categoryå­—æ®µè¿›è¡Œåˆ†ç»„ï¼Œå¹¶ç»Ÿè®¡æ¯ä¸ªç»„çš„æ•°é‡ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061GET /shopping/_search&#123; &quot;size&quot;: 0, &quot;aggs&quot;: &#123; &quot;category_count&quot;: &#123; # è‡ªå®šä¹‰åç§°ï¼Œè¿”å›æ¯ä¸ªç»„çš„æ•°é‡ &quot;terms&quot;: &#123; # æ¡¶èšåˆå‡½æ•°åç§°ï¼Œtermsè¡¨ç¤ºæŒ‰ç…§å­—æ®µçš„å€¼è¿›è¡Œåˆ†ç»„ &quot;field&quot;: &quot;category&quot;, # æŒ‰ç…§categoryå­—æ®µè¿›è¡Œåˆ†ç»„ï¼Œæ³¨æ„ä¸èƒ½æ˜¯textç±»å‹ï¼Œå¦åˆ™ä¼šæŠ¥é”™ &quot;size&quot;: 10, # åªè¿”å›å‰10ä¸ªï¼Œé»˜è®¤æ˜¯10 &quot;order&quot;: &#123;&quot;_count&quot;: &quot;desc&quot;&#125; # æŒ‰ç…§æ•°é‡é™åºæ’åºï¼Œé»˜è®¤æ˜¯descï¼ŒBucketèšåˆä¼šç»Ÿè®¡Bucketå†…çš„æ–‡æ¡£æ•°é‡ï¼Œè®°ä¸º_countï¼Œå¹¶ä¸”æŒ‰ç…§_counté™åºæ’åº &#125; &#125; &#125;&#125;# ç»“æœ&#123; &quot;took&quot;: 15, &quot;timed_out&quot;: false, &quot;_shards&quot;: &#123; &quot;total&quot;: 1, &quot;successful&quot;: 1, &quot;skipped&quot;: 0, &quot;failed&quot;: 0 &#125;, &quot;hits&quot;: &#123; &quot;total&quot;: &#123; &quot;value&quot;: 12, &quot;relation&quot;: &quot;eq&quot; &#125;, &quot;max_score&quot;: null, &quot;hits&quot;: [] &#125;, &quot;aggregations&quot;: &#123; &quot;category_count&quot;: &#123; &quot;doc_count_error_upper_bound&quot;: 0, # é”™è¯¯ä¸Šç•Œï¼Œè¡¨ç¤ºåœ¨èšåˆè¿‡ç¨‹ä¸­å¯èƒ½å­˜åœ¨ä¸€äº›é”™è¯¯ï¼Œä½†é”™è¯¯æ•°é‡ä¸ä¼šè¶…è¿‡è¿™ä¸ªå€¼ &quot;sum_other_doc_count&quot;: 0, # è¡¨ç¤ºåœ¨èšåˆè¿‡ç¨‹ä¸­ï¼Œé™¤äº†è¿”å›çš„10ä¸ªbucketï¼Œè¿˜æœ‰å…¶ä»–æ•°é‡ï¼Œè¿™ä¸ªæ•°é‡å°±æ˜¯sum_other_doc_count &quot;buckets&quot;: [ # è¿”å›çš„bucket &#123; &quot;key&quot;: &quot;electronics&quot;, # åˆ†ç»„çš„key &quot;doc_count&quot;: 4 # åˆ†ç»„çš„æ•°é‡ &#125;, &#123; &quot;key&quot;: &quot;books&quot;, &quot;doc_count&quot;: 2 &#125;, &#123; &quot;key&quot;: &quot;fashion&quot;, &quot;doc_count&quot;: 2 &#125;, &#123; &quot;key&quot;: &quot;groceries&quot;, &quot;doc_count&quot;: 2 &#125;, &#123; &quot;key&quot;: &quot;home_appliances&quot;, &quot;doc_count&quot;: 2 &#125; ] &#125; &#125;&#125; é™å®šèšåˆèŒƒå›´ 1234567891011121314151617181920GET /shopping/_search&#123; &quot;query&quot;: &#123; &quot;range&quot;: &#123; &quot;price&quot;: &#123; &quot;gte&quot;: 100 # é™å®šä»·æ ¼èŒƒå›´ &#125; &#125; &#125;, &quot;size&quot;: 0, &quot;aggs&quot;: &#123; &quot;category_count&quot;: &#123; # è‡ªå®šä¹‰åç§°ï¼Œè¿”å›æ¯ä¸ªç»„çš„æ•°é‡ &quot;terms&quot;: &#123; # æ¡¶èšåˆå‡½æ•°åç§°ï¼Œtermsè¡¨ç¤ºæŒ‰ç…§å­—æ®µçš„å€¼è¿›è¡Œåˆ†ç»„ &quot;field&quot;: &quot;category&quot;, # æŒ‰ç…§categoryå­—æ®µè¿›è¡Œåˆ†ç»„ &quot;size&quot;: 10, # åªè¿”å›å‰10ä¸ªï¼Œé»˜è®¤æ˜¯10 &quot;order&quot;: &#123;&quot;_count&quot;: &quot;desc&quot;&#125; # æŒ‰ç…§æ•°é‡é™åºæ’åºï¼Œé»˜è®¤æ˜¯descï¼ŒBucketèšåˆä¼šç»Ÿè®¡Bucketå†…çš„æ–‡æ¡£æ•°é‡ï¼Œè®°ä¸º_countï¼Œå¹¶ä¸”æŒ‰ç…§_counté™åºæ’åº &#125; &#125; &#125;&#125; rangeï¼ˆèŒƒå›´ï¼‰ æŒ‰ç…§å­—æ®µçš„å€¼è¿›è¡Œåˆ†ç»„ï¼Œå¹¶ç»Ÿè®¡æ¯ä¸ªç»„çš„æ•°é‡ã€‚ ç¤ºä¾‹ï¼šæŒ‰ç…§ä»·æ ¼èŒƒå›´è¿›è¡Œåˆ†ç»„ï¼Œå¹¶ç»Ÿè®¡æ¯ä¸ªç»„çš„æ•°é‡ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960GET /shopping/_search&#123; &quot;size&quot;: 0, &quot;aggs&quot;: &#123; &quot;price_range&quot;: &#123; # è‡ªå®šä¹‰åç§°ï¼Œè¿”å›æ¯ä¸ªç»„çš„æ•°é‡ &quot;range&quot;: &#123; # æ¡¶èšåˆå‡½æ•°åç§°ï¼Œrangeè¡¨ç¤ºæŒ‰ç…§å­—æ®µçš„å€¼è¿›è¡Œåˆ†ç»„ &quot;field&quot;: &quot;price&quot;, # æŒ‰ç…§priceå­—æ®µè¿›è¡Œåˆ†ç»„ &quot;ranges&quot;: [ &#123;&quot;to&quot;: 100&#125;, # å°äº100 &#123;&quot;from&quot;: 100, &quot;to&quot;: 200&#125;, # 100-200ï¼ŒåŒ…æ‹¬100ï¼Œä¸åŒ…æ‹¬200 &#123; &quot;key&quot;:&quot;&gt;=200&quot;, # è®¾å®šé”®å€¼ï¼Œç”¨äºåŒºåˆ†ä¸åŒèŒƒå›´ &quot;from&quot;:200 # å¤§äºç­‰äº200 &#125; ] &#125; &#125; &#125;&#125;# ç»“æœ&#123; &quot;took&quot;: 5, &quot;timed_out&quot;: false, &quot;_shards&quot;: &#123; &quot;total&quot;: 1, &quot;successful&quot;: 1, &quot;skipped&quot;: 0, &quot;failed&quot;: 0 &#125;, &quot;hits&quot;: &#123; &quot;total&quot;: &#123; &quot;value&quot;: 12, &quot;relation&quot;: &quot;eq&quot; &#125;, &quot;max_score&quot;: null, &quot;hits&quot;: [] &#125;, &quot;aggregations&quot;: &#123; &quot;price_range&quot;: &#123; &quot;buckets&quot;: [ &#123; &quot;key&quot;: &quot;*-100.0&quot;, &quot;to&quot;: 100, &quot;doc_count&quot;: 6 &#125;, &#123; &quot;key&quot;: &quot;100.0-200.0&quot;, &quot;from&quot;: 100, &quot;to&quot;: 200, &quot;doc_count&quot;: 0 &#125;, &#123; &quot;key&quot;: &quot;&gt;=200&quot;, &quot;from&quot;: 200, &quot;doc_count&quot;: 6 &#125; ] &#125; &#125;&#125; date_rangeï¼ˆæ—¥æœŸèŒƒå›´ï¼‰ æŒ‰ç…§å­—æ®µçš„å€¼è¿›è¡Œåˆ†ç»„ï¼Œå¹¶ç»Ÿè®¡æ¯ä¸ªç»„çš„æ•°é‡ã€‚ ç¤ºä¾‹ï¼šæŒ‰ç…§æ—¥æœŸèŒƒå›´è¿›è¡Œåˆ†ç»„ï¼Œå¹¶ç»Ÿè®¡æ¯ä¸ªç»„çš„æ•°é‡ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879GET /shopping/_search&#123; &quot;size&quot;: 0, &quot;aggs&quot;: &#123; &quot;date_range&quot;: &#123; &quot;date_range&quot;: &#123; &quot;field&quot;: &quot;created_at&quot;, &quot;ranges&quot;: [ &#123;&quot;to&quot;: &quot;now-3d&quot;&#125;, # å°äºå½“å‰æ—¶é—´å‡å»3å¤© &#123;&quot;from&quot;: &quot;now-3d&quot;,&quot;to&quot;: &quot;now-1d&quot;&#125;, # å¤§äºå½“å‰æ—¶é—´å‡å»3å¤©ï¼ˆåŒ…å«ï¼‰ï¼Œå°äºå½“å‰æ—¶é—´å‡å»1å¤© &#123;&quot;key&quot;:&quot;now-1d&quot;,&quot;from&quot;: &quot;now-1d&quot;&#125; # å¤§äºå½“å‰æ—¶é—´å‡å»1å¤©ï¼ˆåŒ…å«ï¼‰ï¼Œå¹¶è®¾ç½®é”®å€¼ ] &#125; &#125; &#125;&#125;# ç»“æœ&#123; &quot;took&quot;: 3, &quot;timed_out&quot;: false, &quot;_shards&quot;: &#123; &quot;total&quot;: 1, &quot;successful&quot;: 1, &quot;skipped&quot;: 0, &quot;failed&quot;: 0 &#125;, &quot;hits&quot;: &#123; &quot;total&quot;: &#123; &quot;value&quot;: 12, &quot;relation&quot;: &quot;eq&quot; &#125;, &quot;max_score&quot;: null, &quot;hits&quot;: [] &#125;, &quot;aggregations&quot;: &#123; &quot;date_range&quot;: &#123; &quot;buckets&quot;: [ &#123; &quot;key&quot;: &quot;*-2025-04-20 03:14:17&quot;, &quot;to&quot;: 1745118857610, &quot;to_as_string&quot;: &quot;2025-04-20 03:14:17&quot;, &quot;doc_count&quot;: 4 &#125;, &#123; &quot;key&quot;: &quot;2025-04-20 03:14:17-2025-04-22 03:14:17&quot;, &quot;from&quot;: 1745118857610, &quot;from_as_string&quot;: &quot;2025-04-20 03:14:17&quot;, &quot;to&quot;: 1745291657610, &quot;to_as_string&quot;: &quot;2025-04-22 03:14:17&quot;, &quot;doc_count&quot;: 4 &#125;, &#123; &quot;key&quot;: &quot;now-1d&quot;, &quot;from&quot;: 1745291657610, &quot;from_as_string&quot;: &quot;2025-04-22 03:14:17&quot;, &quot;doc_count&quot;: 4 &#125; ] &#125; &#125;&#125;# æ—¥æœŸæ ¼å¼GET /shopping/_search&#123; &quot;size&quot;: 0, &quot;aggs&quot;: &#123; &quot;date_range&quot;: &#123; &quot;date_range&quot;: &#123; &quot;field&quot;: &quot;created_at&quot;, &quot;ranges&quot;: [ &#123;&quot;to&quot;: &quot;2025-04-20 00:00:00&quot;&#125;, # æ³¨æ„è¿™é‡Œçš„æ ¼å¼å¿…é¡»ä¸å­—æ®µæ ¼å¼ä¸€è‡´ &#123;&quot;from&quot;: &quot;2025-04-20 00:00:00&quot;,&quot;to&quot;: &quot;2025-04-22 00:00:00&quot;&#125;, &#123;&quot;key&quot;:&quot;2025-04-22 00:00:00&quot;,&quot;from&quot;: &quot;2025-04-22 00:00:00&quot;&#125; ] &#125; &#125; &#125;&#125; histogramï¼ˆç›´æ–¹å›¾ï¼‰ æŒ‰ç…§é—´éš”è¿›è¡Œåˆ†ç»„ï¼Œå¹¶ç»Ÿè®¡æ¯ä¸ªç»„çš„æ•°é‡ã€‚ ç¤ºä¾‹ï¼šæŒ‰ç…§ä»·æ ¼çš„é—´éš”è¿›è¡Œåˆ†ç»„ï¼Œå¹¶ç»Ÿè®¡æ¯ä¸ªç»„çš„æ•°é‡ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061GET /shopping/_search&#123; &quot;size&quot;: 0, &quot;aggs&quot;: &#123; &quot;price_histogram&quot;: &#123; &quot;histogram&quot;: &#123; &quot;field&quot;: &quot;price&quot;, &quot;interval&quot;: 500, # é—´éš”500 &quot;extended_bounds&quot;:&#123; # è®¾ç½®è¾¹ç•Œ &quot;min&quot;:0, # æœ€å°å€¼0 &quot;max&quot;:2000 # æœ€å¤§å€¼2000 &#125; &#125; &#125; &#125;&#125;# ç»“æœ&#123; &quot;took&quot;: 2, &quot;timed_out&quot;: false, &quot;_shards&quot;: &#123; &quot;total&quot;: 1, &quot;successful&quot;: 1, &quot;skipped&quot;: 0, &quot;failed&quot;: 0 &#125;, &quot;hits&quot;: &#123; &quot;total&quot;: &#123; &quot;value&quot;: 12, &quot;relation&quot;: &quot;eq&quot; &#125;, &quot;max_score&quot;: null, &quot;hits&quot;: [] &#125;, &quot;aggregations&quot;: &#123; &quot;price_histogram&quot;: &#123; &quot;buckets&quot;: [ &#123; &quot;key&quot;: 0, &quot;doc_count&quot;: 8 &#125;, &#123; &quot;key&quot;: 500, &quot;doc_count&quot;: 1 &#125;, &#123; &quot;key&quot;: 1000, &quot;doc_count&quot;: 1 &#125;, &#123; &quot;key&quot;: 1500, &quot;doc_count&quot;: 2 &#125;, &#123; &quot;key&quot;: 2000, &quot;doc_count&quot;: 0 &#125; ] &#125; &#125;&#125; top_hitsï¼ˆåˆ†æ¡¶å–å‰Næ¡ï¼‰ æŒ‰ç…§å­—æ®µçš„å€¼è¿›è¡Œåˆ†ç»„ï¼Œå¹¶è¿”å›æ¯ä¸ªç»„çš„å‰Næ¡æ•°æ®ã€‚ ç¤ºä¾‹ï¼šæŒ‰ç…§categoryè¿›è¡Œåˆ†ç»„ï¼Œå¹¶è¿”å›æ¯ä¸ªç»„çš„å‰3æ¡æ•°æ®ã€‚ 1234567891011121314151617181920212223GET /shopping/_search&#123; &quot;size&quot;: 0, &quot;aggs&quot;: &#123; &quot;price_top_hits&quot;: &#123; # è‡ªå®šä¹‰åç§° &quot;terms&quot;: &#123; &quot;field&quot;: &quot;category&quot; # æŒ‰ç…§categoryå­—æ®µè¿›è¡Œåˆ†ç»„ &#125;, &quot;aggs&quot;: &#123; &quot;top_hits&quot;: &#123; # è‡ªå®šä¹‰åç§° &quot;top_hits&quot;: &#123; # è¿”å›æ¯ä¸ªç»„çš„å‰3æ¡æ•°æ® &quot;size&quot;: 3, # è¿”å›å‰3æ¡æ•°æ® &quot;sort&quot;: &#123; # æŒ‰ç…§created_atå­—æ®µè¿›è¡Œæ’åº &quot;created_at&quot;: &#123; &quot;order&quot;: &quot;desc&quot; # é™åº &#125; &#125; &#125; &#125; &#125; &#125; &#125;&#125; å­èšåˆ å­èšåˆï¼šåœ¨èšåˆå‡½æ•°ä¸­ï¼Œè¿˜å¯ä»¥å†å®šä¹‰ä¸€ä¸ªèšåˆå‡½æ•°ã€‚ ç¤ºä¾‹ï¼šæŒ‰ç…§categoryè¿›è¡Œåˆ†ç»„ï¼Œå¹¶ç»Ÿè®¡ä»·æ ¼ä¿¡æ¯ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546GET /shopping/_search&#123; &quot;size&quot;: 0, &quot;aggs&quot;: &#123; &quot;category_buckets&quot;: &#123; # è‡ªå®šä¹‰åç§° &quot;terms&quot;: &#123; &quot;field&quot;: &quot;category&quot; # æŒ‰ç…§categoryå­—æ®µè¿›è¡Œåˆ†ç»„ &#125; &quot;aggs&quot;: &#123; # å®šä¹‰å­èšåˆ &quot;price_stats&quot;: &#123; &quot;stats&quot;: &#123; # ç»Ÿè®¡ä»·æ ¼ä¿¡æ¯ &quot;field&quot;: &quot;price&quot; &#125; &#125; &#125; &#125; &#125;&#125;# å¤šå±‚åµŒå¥—# å…ˆæŒ‰ç…§categoryè¿›è¡Œåˆ†ç»„ï¼Œå†æŒ‰ç…§addressè¿›è¡Œåˆ†ç»„ï¼Œå¹¶ç»Ÿè®¡ä»·æ ¼ä¿¡æ¯GET /shopping/_search&#123; &quot;size&quot;:0, &quot;aggs&quot;:&#123; &quot;category_buckets&quot;:&#123; &quot;terms&quot;:&#123; &quot;field&quot;:&quot;category&quot; &#125;, &quot;aggs&quot;:&#123; &quot;address_buckets&quot;:&#123; &quot;terms&quot;:&#123; &quot;field&quot;:&quot;address.keyword&quot; &#125;, &quot;aggs&quot;:&#123; &quot;price_stats&quot;:&#123; &quot;stats&quot;:&#123; &quot;field&quot;:&quot;price&quot; &#125; &#125; &#125; &#125; &#125; &#125; &#125;&#125; Pipeline Aggregation(ç®¡é“èšåˆ) æ”¯æŒå¯¹èšåˆåˆ†æçš„ç»“æœï¼Œå†æ¬¡è¿›è¡Œèšåˆåˆ†æã€‚ Pipeline çš„åˆ†æç»“æœä¼šè¾“å‡ºåˆ°åŸç»“æœä¸­ï¼Œæ ¹æ®ä½ç½®çš„ä¸åŒï¼Œåˆ†ä¸ºä¸¤ç±»ï¼š Sibling - ç»“æœå’Œç°æœ‰åˆ†æç»“æœåŒçº§ Maxï¼Œminï¼ŒAvg &amp; Sum Bucket Statsï¼ŒExtended Status Bucket Percentiles Bucket Parent -ç»“æœå†…åµŒåˆ°ç°æœ‰çš„èšåˆåˆ†æç»“æœä¹‹ä¸­ Derivative(æ±‚å¯¼) Cumultive Sum(ç´¯è®¡æ±‚å’Œ) Moving Function(ç§»åŠ¨å¹³å‡å€¼) Maxï¼Œminï¼ŒAvg &amp; Sum Bucket Maxï¼Œminï¼ŒAvg &amp; Sum Bucketï¼šå¯¹èšåˆåˆ†æçš„ç»“æœè¿›è¡Œæœ€å¤§å€¼ã€æœ€å°å€¼ã€å¹³å‡å€¼ã€æ±‚å’Œç­‰æ“ä½œã€‚ ç¤ºä¾‹ï¼šæŒ‰ç…§categoryè¿›è¡Œåˆ†ç»„æ±‚å‡ºå•†å“çš„å¹³å‡ä»·æ ¼ï¼Œå¹¶æ‰¾å‡ºå¹³å‡ä»·æ ¼æœ€ä½çš„åˆ†ç»„ 1234567891011121314151617181920212223GET /shopping/_search&#123; &quot;size&quot;:0, &quot;aggs&quot;:&#123; &quot;category_buckets&quot;:&#123; &quot;terms&quot;:&#123; &quot;field&quot;:&quot;category&quot; # æŒ‰ç…§categoryå­—æ®µè¿›è¡Œåˆ†ç»„ &#125;, &quot;aggs&quot;:&#123; &quot;price_avg&quot;:&#123; &quot;avg&quot;:&#123; # æ±‚ä»·æ ¼å¹³å‡å€¼ &quot;field&quot;:&quot;price&quot; &#125; &#125; &#125; &#125;, &quot;min_price_in_category&quot;:&#123; # æ‰¾å‡ºå¹³å‡ä»·æ ¼æœ€ä½çš„åˆ†ç»„ &quot;min_bucket&quot;:&#123; # å¯¹èšåˆç»“æœè¿›è¡Œæœ€å°å€¼æ“ä½œ &quot;buckets_path&quot;:&quot;category_buckets&gt;price_avg&quot; # æŒ‡å®šè·¯å¾„ï¼Œå¯¹category_bucketsèšåˆç»“æœä¸­çš„price_avgå­—æ®µè¿›è¡Œæœ€å°å€¼æ“ä½œ &#125; &#125; &#125;&#125; Statsï¼ŒExtended Status Bucket Statsï¼ŒExtended Status Bucketï¼šå¯¹èšåˆåˆ†æçš„ç»“æœè¿›è¡Œç»Ÿè®¡æ“ä½œï¼ŒåŒ…æ‹¬æœ€å¤§å€¼ã€æœ€å°å€¼ã€å¹³å‡å€¼ã€æ±‚å’Œã€æ•°é‡ç­‰ã€‚ ç¤ºä¾‹ï¼šæŒ‰ç…§categoryè¿›è¡Œåˆ†ç»„æ±‚å‡ºå•†å“çš„å¹³å‡ä»·æ ¼ï¼Œå¹¶å¯¹åˆ†ç»„ç»“æœè¿›è¡Œç»Ÿè®¡æ“ä½œ 123456789101112131415161718192021222324GET /shopping/_search&#123; &quot;size&quot;: 0, &quot;aggs&quot;: &#123; &quot;category_buckets&quot;: &#123; &quot;terms&quot;: &#123; &quot;field&quot;: &quot;category&quot;, &quot;size&quot;: 10 # æŒ‡å®šåˆ†ç»„æ•°é‡ &#125;, &quot;aggs&quot;: &#123; &quot;avg_price&quot;: &#123; &quot;avg&quot;: &#123; &quot;field&quot;: &quot;price&quot; &#125; &#125; &#125; &#125;, &quot;stats_price_by_job&quot;:&#123; &quot;stats_bucket&quot;: &#123; # å¯¹èšåˆç»“æœè¿›è¡Œç»Ÿè®¡æ“ä½œ &quot;buckets_path&quot;: &quot;category_buckets&gt;avg_price&quot; # æŒ‡å®šè·¯å¾„ï¼Œå¯¹category_bucketsèšåˆç»“æœä¸­çš„avg_priceå­—æ®µè¿›è¡Œç»Ÿè®¡æ“ä½œ &#125; &#125; &#125;&#125; Percentiles Bucket Percentiles Bucketï¼šå¯¹èšåˆåˆ†æçš„ç»“æœè¿›è¡Œç™¾åˆ†æ¯”æ“ä½œï¼ŒåŒ…æ‹¬ç™¾åˆ†æ¯”ã€ä¸­ä½æ•°ç­‰ã€‚ ç¤ºä¾‹ï¼šæŒ‰ç…§categoryè¿›è¡Œåˆ†ç»„æ±‚å‡ºå•†å“çš„å¹³å‡ä»·æ ¼ï¼Œå¹¶å¯¹åˆ†ç»„ç»“æœè¿›è¡Œç™¾åˆ†æ¯”æ“ä½œ 123456789101112131415161718192021222324GET /shopping/_search&#123; &quot;size&quot;: 0, &quot;aggs&quot;: &#123; &quot;category_buckets&quot;: &#123; &quot;terms&quot;: &#123; &quot;field&quot;: &quot;category&quot;, &quot;size&quot;: 10 &#125;, &quot;aggs&quot;: &#123; &quot;avg_price&quot;: &#123; &quot;avg&quot;: &#123; &quot;field&quot;: &quot;price&quot; &#125; &#125; &#125; &#125;, &quot;percentiles_price_by_category&quot;:&#123; &quot;percentiles_bucket&quot;: &#123; # å¯¹èšåˆç»“æœè¿›è¡Œç»Ÿè®¡æ“ä½œ &quot;buckets_path&quot;: &quot;category_buckets&gt;avg_price&quot; # æŒ‡å®šè·¯å¾„ï¼Œå¯¹category_bucketsèšåˆç»“æœä¸­çš„avg_priceå­—æ®µè¿›è¡Œç»Ÿè®¡æ“ä½œ &#125; &#125; &#125;&#125; Cumulative Sum Cumulative Sumï¼šå¯¹èšåˆåˆ†æçš„ç»“æœè¿›è¡Œç´¯è®¡æ±‚å’Œæ“ä½œã€‚ ç¤ºä¾‹: æŒ‰ç…§ä»·æ ¼è¿›è¡Œåˆ†ç»„ï¼Œå¹¶ç»Ÿè®¡å¹³å‡ä»·æ ¼ä¿¡æ¯ï¼Œå¯¹åˆ†ç»„ç»“æœè¿›è¡Œç´¯è®¡æ±‚å’Œæ“ä½œã€‚ 12345678910111213141516171819202122232425262728GET /shopping/_search&#123; &quot;size&quot;: 0, &quot;aggs&quot;: &#123; &quot;price_histogram&quot;: &#123; &quot;histogram&quot;: &#123; &quot;field&quot;: &quot;price&quot;, &quot;interval&quot;: 500, # é—´éš”500 &quot;extended_bounds&quot;:&#123; # è®¾ç½®è¾¹ç•Œ &quot;min&quot;:0, # æœ€å°å€¼0 &quot;max&quot;:2000 # æœ€å¤§å€¼2000 &#125; &#125;, &quot;aggs&quot;: &#123; &quot;avg_price&quot;: &#123; &quot;avg&quot;: &#123; &quot;field&quot;: &quot;price&quot; &#125; &#125;, &quot;cumulative_sum_price&quot;: &#123; &quot;cumulative_sum&quot;: &#123; # å¯¹èšåˆç»“æœè¿›è¡Œç´¯è®¡æ±‚å’Œæ“ä½œ &quot;buckets_path&quot;: &quot;avg_price&quot; # æŒ‡å®šè·¯å¾„ï¼Œå¯¹avg_priceå­—æ®µè¿›è¡Œç´¯è®¡æ±‚å’Œæ“ä½œ &#125; &#125; &#125; &#125; &#125;&#125; Derivative Derivativeï¼šå¯¹èšåˆåˆ†æçš„ç»“æœè¿›è¡Œæ±‚å¯¼æ“ä½œã€‚ Derivative èšåˆæŸ¥è¯¢æ˜¯ Elasticsearch ä¸­çš„ä¸€ç§é«˜çº§èšåˆç±»å‹ï¼Œç”¨äºè®¡ç®—æŸä¸ªåº¦é‡å€¼éšæ—¶é—´ï¼ˆæˆ–å…¶ä»–é¡ºåºå­—æ®µï¼‰å˜åŒ–çš„é€Ÿç‡ã€‚å®ƒé€šå¸¸ç”¨äºæ—¶é—´åºåˆ—åˆ†æï¼Œä»¥æ­ç¤ºåº¦é‡å€¼çš„å¢å‡è¶‹åŠ¿ã€‚ ç¤ºä¾‹ï¼šæ˜¾ç¤ºæ¯å¤©çš„å¹³å‡ä»·æ ¼ä»¥åŠå¹³å‡ä»·æ ¼çš„å˜åŒ–è¶‹åŠ¿ 123456789101112131415161718192021222324GET /shopping/_search&#123; &quot;size&quot;: 0, &quot;aggs&quot;: &#123; &quot;price_over_time&quot;: &#123; &quot;date_histogram&quot;: &#123; # æŒ‰ç…§æ—¥æœŸè¿›è¡Œåˆ†ç»„ &quot;field&quot;: &quot;created_at&quot;, # æŒ‡å®šå­—æ®µ &quot;calendar_interval&quot;: &quot;day&quot; # æŒ‡å®šæ—¶é—´é—´éš”ï¼Œå¯ç”¨çš„å€¼ï¼šyearã€quarterã€monthã€weekã€dayã€hourã€minuteã€second &#125;, &quot;aggs&quot;: &#123; &quot;average_price&quot;: &#123; &quot;avg&quot;: &#123; &quot;field&quot;: &quot;price&quot; &#125; &#125;, &quot;price_derivative&quot;: &#123; &quot;derivative&quot;: &#123; # å¯¹èšåˆç»“æœè¿›è¡Œæ±‚å¯¼æ“ä½œ &quot;buckets_path&quot;: &quot;average_price&quot; &#125; &#125; &#125; &#125; &#125;&#125; Moving Function Moving Functionï¼šå¯¹èšåˆåˆ†æçš„ç»“æœè¿›è¡Œç§»åŠ¨å¹³å‡å€¼æ“ä½œã€‚ Moving Function èšåˆæŸ¥è¯¢æ˜¯ Elasticsearch ä¸­çš„ä¸€ç§é«˜çº§èšåˆç±»å‹ï¼Œç”¨äºè®¡ç®—æŸä¸ªåº¦é‡å€¼åœ¨æ—¶é—´çª—å£å†…çš„ç§»åŠ¨å¹³å‡å€¼ã€‚å®ƒé€šå¸¸ç”¨äºæ—¶é—´åºåˆ—åˆ†æï¼Œä»¥äº†è§£åº¦é‡å€¼çš„å˜åŒ–è¶‹åŠ¿ã€‚ ç¤ºä¾‹ï¼šè®¡ç®— price å­—æ®µçš„ 7 å¤©ç§»åŠ¨å¹³å‡å€¼ 123456789101112131415161718192021222324252627GET /shopping/_search&#123; &quot;size&quot;: 0, &quot;aggs&quot;: &#123; &quot;price_over_time&quot;: &#123; &quot;date_histogram&quot;: &#123; &quot;field&quot;: &quot;created_at&quot;, &quot;calendar_interval&quot;: &quot;day&quot; &#125;, &quot;aggs&quot;: &#123; &quot;daily_avg_price&quot;: &#123; &quot;avg&quot;: &#123; &quot;field&quot;: &quot;price&quot; &#125; &#125;, &quot;moving_avg_price&quot;: &#123; &quot;moving_fn&quot;: &#123; # å¯¹èšåˆç»“æœè¿›è¡Œç§»åŠ¨å¹³å‡å€¼æ“ä½œ &quot;buckets_path&quot;: &quot;daily_avg_price&quot;, # æŒ‡å®šè·¯å¾„ï¼Œå¯¹daily_avg_priceå­—æ®µè¿›è¡Œç§»åŠ¨å¹³å‡å€¼æ“ä½œ &quot;script&quot;: &quot;MovingFunctions.unweightedAvg(values)&quot;, # æŒ‡å®šè„šæœ¬ï¼Œè®¡ç®—ç§»åŠ¨å¹³å‡å€¼ &quot;window&quot;: 7, # çª—å£å¤§å°ï¼Œé»˜è®¤ä¸º 10 &quot;shift&quot;: 0 # çª—å£åç§»é‡ï¼Œé»˜è®¤ä¸º 0 &#125; &#125; &#125; &#125; &#125;&#125; ES èšåˆæ€§èƒ½ä¼˜åŒ– ç´¢å¼•é¢„æ’åº å¦‚æœæ˜¯ Elasticsearch 6.X ä¹‹åç‰ˆæœ¬ï¼Œå¯ä»¥åœ¨æ’å…¥æ•°æ®æ—¶å¯¹ç´¢å¼•è¿›è¡Œé¢„æ’åºï¼Œè€Œä¸æ˜¯åœ¨æŸ¥è¯¢æ—¶å†å¯¹ç´¢å¼•è¿›è¡Œæ’åºï¼Œè¿™å°†æé«˜èŒƒå›´æŸ¥è¯¢ï¼ˆrange queryï¼‰å’Œæ’åºæ“ä½œçš„æ€§èƒ½ã€‚ ä½†é¢„æ’åºå°†å¢åŠ  Elasticsearch å†™å…¥çš„æˆæœ¬ï¼Œå¯¼è‡´å¤§çº¦ 40%-50% çš„å†™æ€§èƒ½ä¸‹é™ï¼Œå¦‚æœåº”ç”¨åœºæ™¯æ˜¯æ›´å…³æ³¨å†™æ€§èƒ½çš„ä¸šåŠ¡ï¼Œå¼€å¯ç´¢å¼•é¢„æ’åºä¸æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é€‰æ‹©ã€‚ 12345678910111213141516PUT /my_index&#123; &quot;settings&quot;: &#123; &quot;index&quot;:&#123; &quot;sort.field&quot;: &quot;create_time&quot;, &quot;sort.order&quot;: &quot;desc&quot; &#125; &#125;, &quot;mappings&quot;: &#123; &quot;properties&quot;: &#123; &quot;create_time&quot;:&#123; &quot;type&quot;: &quot;date&quot; &#125; &#125; &#125;&#125; ä½¿ç”¨åˆ†ç‰‡è¯·æ±‚ç¼“å­˜ èšåˆè¯­å¥ä¸­ï¼Œè®¾ç½®ï¼šsizeï¼š0ï¼Œå°±ä¼šä½¿ç”¨åˆ†ç‰‡è¯·æ±‚ç¼“å­˜ç¼“å­˜ç»“æœã€‚size = 0 çš„å«ä¹‰æ˜¯ï¼šåªè¿”å›èšåˆç»“æœï¼Œä¸è¿”å›æŸ¥è¯¢ç»“æœã€‚ 1234567891011GET /my_index/_search&#123; &quot;size&quot;: 0, &quot;aggs&quot;: &#123; &quot;remark_agg&quot;: &#123; &quot;terms&quot;: &#123; &quot;field&quot;: &quot;remark.keyword&quot; &#125; &#125; &#125;&#125; æ‹†åˆ†èšåˆï¼Œä½¿èšåˆå¹¶è¡ŒåŒ– Elasticsearch æŸ¥è¯¢æ¡ä»¶ä¸­åŒæ—¶æœ‰å¤šä¸ªæ¡ä»¶èšåˆï¼Œé»˜è®¤æƒ…å†µä¸‹èšåˆä¸æ˜¯å¹¶è¡Œè¿è¡Œçš„ã€‚ å½“ä¸ºæ¯ä¸ªèšåˆæä¾›è‡ªå·±çš„æŸ¥è¯¢å¹¶æ‰§è¡Œ msearch æ—¶ï¼Œæ€§èƒ½ä¼šæœ‰æ˜¾è‘—æå‡ã€‚ å› æ­¤ï¼Œåœ¨ CPU èµ„æºä¸æ˜¯ç“¶é¢ˆçš„å‰æä¸‹ï¼Œå¦‚æœæƒ³ç¼©çŸ­å“åº”æ—¶é—´ï¼Œå¯ä»¥å°†å¤šä¸ªèšåˆæ‹†åˆ†ä¸ºå¤šä¸ªæŸ¥è¯¢ï¼Œå€ŸåŠ©ï¼šmsearch å®ç°å¹¶è¡Œèšåˆã€‚ 1234567891011121314151617181920212223#å¸¸è§„çš„å¤šæ¡ä»¶èšåˆå®ç°GET /employees/_search&#123; &quot;size&quot;: 0, &quot;aggs&quot;: &#123; &quot;job_agg&quot;: &#123; &quot;terms&quot;: &#123; &quot;field&quot;: &quot;job.keyword&quot; &#125; &#125;, &quot;max_salary&quot;:&#123; &quot;max&quot;: &#123; &quot;field&quot;: &quot;salary&quot; &#125; &#125; &#125;&#125;# msearch æ‹†åˆ†å¤šä¸ªè¯­å¥çš„èšåˆå®ç°GET _msearch&#123;&quot;index&quot;:&quot;employees&quot;&#125;&#123;&quot;size&quot;:0,&quot;aggs&quot;:&#123;&quot;job_agg&quot;:&#123;&quot;terms&quot;:&#123;&quot;field&quot;: &quot;job.keyword&quot;&#125;&#125;&#125;&#125;&#123;&quot;index&quot;:&quot;employees&quot;&#125;&#123;&quot;size&quot;:0,&quot;aggs&quot;:&#123;&quot;max_salary&quot;:&#123;&quot;max&quot;:&#123;&quot;field&quot;: &quot;salary&quot;&#125;&#125;&#125;&#125;","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» Elasticsearch çš„ REST APIsï¼šèšåˆæŸ¥è¯¢ Elasticsearchç‰ˆæœ¬8.17.3 å®˜æ–¹æ–‡æ¡£:REST APIs å®˜æ–¹æ–‡æ¡£:Aggregations Elasticsearch çš„ REST APIs","date_published":"2025-04-22T13:30:05.000Z","tags":["æŠ€æœ¯","elastic","elasticsearch","elasticsearch"]},{"id":"https://blog.hanqunfeng.com/2025/04/17/elasticsearch-05-api/","url":"https://blog.hanqunfeng.com/2025/04/17/elasticsearch-05-api/","title":"Elasticsearch çš„ REST APIs","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç» Elasticsearch çš„ REST APIs</p>\n</li>\n<li class=\"lvl-2\">\n<p>Elasticsearchç‰ˆæœ¬8.17.3</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://www.elastic.co/guide/en/elasticsearch/reference/8.17/rest-apis.html\">å®˜æ–¹æ–‡æ¡£:REST APIs</a></p>\n</li>\n<li class=\"lvl-2\">\n<a href=\"/2025/04/22/elasticsearch-06-api-aggs/\" title=\"Elasticsearch çš„ REST APIs:èšåˆæŸ¥è¯¢\">Elasticsearch çš„ REST APIs:èšåˆæŸ¥è¯¢</a>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"è¿”å›å†…å®¹æ ¼å¼åŒ–\">è¿”å›å†…å®¹æ ¼å¼åŒ–</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¿”å›jsonä¿¡æ¯æ ¼å¼: <code>?pretty</code> è¾“å‡ºæ ¼å¼åŒ–åçš„jsonï¼Œæ¯”å¦‚ï¼š<code>curl http://localhost:9200/_cluster/health?pretty</code></p>\n</li>\n<li class=\"lvl-2\">\n<p>è¿”å›è¡Œä¿¡æ¯æ ¼å¼: <code>?v</code> è¾“å‡ºå†…å®¹ä¸Šæ–¹ä¼šåŠ ä¸Šæ ‡é¢˜è¡Œï¼Œæ¯”å¦‚ï¼š<code>curl http://localhost:9200/_cat/health?v</code></p>\n</li>\n</ul>\n<h2 id=\"CAT-APIs\">CAT APIs</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Elasticsearch æä¾›äº† <a href=\"https://www.elastic.co/guide/en/elasticsearch/reference/8.17/cat.html\">CAT APIs</a>ï¼Œå®ƒä»¬æä¾›äº†ä¸€ç§ç®€å•çš„æ–¹å¼æ¥æŸ¥çœ‹é›†ç¾¤çŠ¶æ€å’Œé›†ç¾¤ä¸­çš„å„ç§èµ„æºï¼Œæ¯”å¦‚ç´¢å¼•ã€åˆ†ç‰‡ã€èŠ‚ç‚¹ç­‰ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">GET     /_cat/health             <span class=\"comment\">#æŸ¥çœ‹é›†ç¾¤å½“å‰çŠ¶æ€ï¼šçº¢ã€é»„ã€ç»¿</span></span><br><span class=\"line\">GET     /_cat/master             <span class=\"comment\">#æŸ¥çœ‹masterèŠ‚ç‚¹ä¿¡æ¯</span></span><br><span class=\"line\">GET     /_cat/nodes              <span class=\"comment\">#æŸ¥çœ‹æ‰€æœ‰èŠ‚ç‚¹ä¿¡æ¯</span></span><br><span class=\"line\">GET     /_cat/plugins            <span class=\"comment\">#æŸ¥çœ‹é›†ç¾¤å„ä¸ªèŠ‚ç‚¹ä¸Šçš„pluginä¿¡æ¯</span></span><br><span class=\"line\">GET     /_cat/indices            <span class=\"comment\">#æŸ¥çœ‹é›†ç¾¤ä¸­æ‰€æœ‰indexçš„è¯¦ç»†ä¿¡æ¯</span></span><br><span class=\"line\">GET     /_cat/indices/&#123;index&#125;    <span class=\"comment\">#æŸ¥çœ‹é›†ç¾¤ä¸­æŒ‡å®šindexçš„è¯¦ç»†ä¿¡æ¯ï¼Œindexï¼šç´¢å¼•åç§°</span></span><br><span class=\"line\">GET     /_cat/allocation         <span class=\"comment\">#æŸ¥çœ‹å•èŠ‚ç‚¹çš„shardåˆ†é…æ•´ä½“æƒ…å†µ</span></span><br><span class=\"line\">GET     /_cat/shards             <span class=\"comment\">#æŸ¥çœ‹å„shardçš„è¯¦ç»†æƒ…å†µ</span></span><br><span class=\"line\">GET     /_cat/shards/&#123;index&#125;     <span class=\"comment\">#æŸ¥çœ‹æŒ‡å®šåˆ†ç‰‡çš„è¯¦ç»†æƒ…å†µ</span></span><br><span class=\"line\">GET     /_cat/segments           <span class=\"comment\">#æŸ¥çœ‹å„indexçš„segmentè¯¦ç»†ä¿¡æ¯,åŒ…æ‹¬segmentå, æ‰€å±shard, å†…å­˜(ç£ç›˜)å ç”¨å¤§å°, æ˜¯å¦åˆ·ç›˜</span></span><br><span class=\"line\">GET     /_cat/segments/&#123;index&#125;   <span class=\"comment\">#æŸ¥çœ‹æŒ‡å®šindexçš„segmentè¯¦ç»†ä¿¡æ¯</span></span><br><span class=\"line\">GET     /_cat/count              <span class=\"comment\">#æŸ¥çœ‹å½“å‰é›†ç¾¤çš„docæ•°é‡</span></span><br><span class=\"line\">GET     /_cat/count/&#123;index&#125;      <span class=\"comment\">#æŸ¥çœ‹æŒ‡å®šç´¢å¼•çš„docæ•°é‡</span></span><br><span class=\"line\">GET     /_cat/recovery           <span class=\"comment\">#æŸ¥çœ‹é›†ç¾¤å†…æ¯ä¸ªshardçš„recoveryè¿‡ç¨‹.è°ƒæ•´replicaã€‚</span></span><br><span class=\"line\">GET     /_cat/recovery/&#123;index&#125;   <span class=\"comment\">#æŸ¥çœ‹æŒ‡å®šç´¢å¼•shardçš„recoveryè¿‡ç¨‹</span></span><br><span class=\"line\">GET     /_cat/pending_tasks      <span class=\"comment\">#æŸ¥çœ‹å½“å‰é›†ç¾¤çš„pending task</span></span><br><span class=\"line\">GET     /_cat/aliases            <span class=\"comment\">#æŸ¥çœ‹é›†ç¾¤ä¸­æ‰€æœ‰aliasä¿¡æ¯,è·¯ç”±é…ç½®ç­‰</span></span><br><span class=\"line\">GET     /_cat/aliases/&#123;<span class=\"built_in\">alias</span>&#125;    <span class=\"comment\">#æŸ¥çœ‹æŒ‡å®šç´¢å¼•çš„aliasä¿¡æ¯</span></span><br><span class=\"line\">GET     /_cat/thread_pool        <span class=\"comment\">#æŸ¥çœ‹é›†ç¾¤å„èŠ‚ç‚¹å†…éƒ¨ä¸åŒç±»å‹çš„threadpoolçš„ç»Ÿè®¡ä¿¡æ¯,</span></span><br><span class=\"line\">GET     /_cat/fielddata          <span class=\"comment\">#æŸ¥çœ‹å½“å‰é›†ç¾¤å„ä¸ªèŠ‚ç‚¹çš„fielddataå†…å­˜ä½¿ç”¨æƒ…å†µ</span></span><br><span class=\"line\">GET     /_cat/fielddata/&#123;fields&#125; <span class=\"comment\">#æŸ¥çœ‹æŒ‡å®šfieldçš„å†…å­˜ä½¿ç”¨æƒ…å†µ,é‡Œé¢ä¼ fieldå±æ€§å¯¹åº”çš„å€¼</span></span><br><span class=\"line\">GET     /_cat/nodeattrs          <span class=\"comment\">#æŸ¥çœ‹å•èŠ‚ç‚¹çš„è‡ªå®šä¹‰å±æ€§</span></span><br><span class=\"line\">GET     /_cat/repositories       <span class=\"comment\">#è¾“å‡ºé›†ç¾¤ä¸­æ³¨å†Œå¿«ç…§å­˜å‚¨åº“</span></span><br><span class=\"line\">GET     /_cat/templates          <span class=\"comment\">#è¾“å‡ºå½“å‰æ­£åœ¨å­˜åœ¨çš„æ¨¡æ¿ä¿¡æ¯</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"Cluster-APIs\">Cluster APIs</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Elasticsearch æä¾›äº†ä¸€ç³»åˆ—çš„ <a href=\"https://www.elastic.co/guide/en/elasticsearch/reference/8.17/cluster.html\">Cluster APIs</a>ï¼Œå®ƒä»¬æä¾›äº†ç®¡ç†å’Œç›‘æ§é›†ç¾¤çŠ¶æ€çš„åŠŸèƒ½</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">GET     /_cluster/health            <span class=\"comment\"># è·å–é›†ç¾¤çš„å¥åº·çŠ¶æ€ä¿¡æ¯ï¼ŒåŒ…æ‹¬äº†é›†ç¾¤æ€»ä½“çš„çŠ¶å†µå¦‚statusã€number_of_nodesç­‰ã€‚</span></span><br><span class=\"line\">GET     /_cluster/stats             <span class=\"comment\"># æä¾›æ•´ä¸ªé›†ç¾¤å±‚é¢çš„ç»Ÿè®¡ä¿¡æ¯ï¼ŒåŒ…å«ç´¢å¼•ã€èŠ‚ç‚¹å’Œå…¶ä»–é«˜çº§æŒ‡æ ‡ã€‚</span></span><br><span class=\"line\">GET     /_cluster/state             <span class=\"comment\"># æ˜¾ç¤ºé›†ç¾¤å…ƒæ•°æ®çš„çŠ¶æ€ï¼ŒåŒ…æ‹¬è®¾ç½®ã€å—ã€è·¯ç”±è¡¨åŠå…ƒæ•°æ®ç­‰ï¼Œå…è®¸ç”¨æˆ·æŸ¥çœ‹é›†ç¾¤çš„å½“å‰è§†å›¾ã€‚</span></span><br><span class=\"line\">POST    /_cluster/reroute           <span class=\"comment\"># POSTè¯·æ±‚ï¼Œç”¨äºæ‰‹åŠ¨æ”¹å˜åˆ†ç‰‡åˆ†é…æƒ…å†µï¼Œå¯ä»¥å®ç°å¦‚è¿ç§»åˆ†ç‰‡ã€å–æ¶ˆåˆ†é…ç­‰æ“ä½œã€‚</span></span><br><span class=\"line\">GET     /_cluster/nodes/hot_threads <span class=\"comment\"># è¿”å›é›†ç¾¤ä¸­å„ä¸ªèŠ‚ç‚¹â€œæœ€çƒ­â€çš„çº¿ç¨‹å †æ ˆè·Ÿè¸ªï¼Œé»˜è®¤æ˜¾ç¤ºå‰ä¸‰ä¸ªCPUæ—¶é—´æœ€é•¿çš„çº¿ç¨‹ã€‚</span></span><br><span class=\"line\">GET     /_cluster/allocation/explain <span class=\"comment\"># è§£é‡Šä¸ºä½•æŸä¸ªåˆ†ç‰‡è¢«å¦‚æ­¤åˆ†é…ï¼Œå¹¶æä¾›å¦‚ä½•è°ƒæ•´çš„å»ºè®®ã€‚</span></span><br><span class=\"line\">GET     /_cluster/pending_tasks     <span class=\"comment\"># åˆ—å‡ºæ‰€æœ‰ç­‰å¾…æ‰§è¡Œçš„ä»»åŠ¡åˆ—è¡¨ã€‚</span></span><br><span class=\"line\">GET     /_cluster/settings          <span class=\"comment\"># æŸ¥çœ‹æ•´ä¸ªé›†ç¾¤çº§åˆ«çš„è®¾ç½®ã€‚</span></span><br><span class=\"line\">PUT     /_cluster/settings          <span class=\"comment\"># æ›´æ–°æ•´ä¸ªé›†ç¾¤çº§åˆ«çš„è®¾ç½®ã€‚</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"Index-APIs\">Index APIs</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Elasticsearch æä¾›äº† <a href=\"https://www.elastic.co/guide/en/elasticsearch/reference/8.17/indices.html\">Index APIs</a>ï¼Œå®ƒä»¬æä¾›äº†å¯¹ç´¢å¼•çš„åˆ›å»ºã€æ›´æ–°ã€æŸ¥è¯¢å’Œåˆ é™¤ç­‰æ“ä½œã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>åˆ›å»ºç´¢å¼•</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># PUT /&lt;target&gt;</span></span><br><span class=\"line\"><span class=\"comment\"># è¿™é‡Œ shopping ä¸ºç´¢å¼•åç§°ï¼Œä½†æ­¤æ—¶æ²¡æœ‰ä¸ºç´¢å¼•è®¾ç½®åˆ†ç‰‡ç­–ç•¥ï¼Œä¹Ÿæ²¡æœ‰è®¾ç½®å­—æ®µä¿¡æ¯</span></span><br><span class=\"line\">curl -X PUT -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/shopping&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"># è¿”å›å€¼</span></span><br><span class=\"line\">&#123;<span class=\"string\">&quot;acknowledged&quot;</span>:<span class=\"literal\">true</span>,<span class=\"string\">&quot;shards_acknowledged&quot;</span>:<span class=\"literal\">true</span>,<span class=\"string\">&quot;index&quot;</span>:<span class=\"string\">&quot;shopping&quot;</span>&#125;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ›å»ºç´¢å¼•å¹¶è®¾ç½®ç´¢å¼•</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># PUT /&lt;target&gt;</span></span><br><span class=\"line\">curl -X PUT -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/shopping&#x27;</span> \\</span><br><span class=\"line\">  -H <span class=\"string\">&#x27;Content-Type: application/json&#x27;</span> \\</span><br><span class=\"line\">  -d <span class=\"string\">&#x27;&#123;&quot;settings&quot;:&#123;&quot;number_of_shards&quot;:&quot;1&quot;,&quot;number_of_replicas&quot;:&quot;2&quot;&#125;&#125;&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"># è¿”å›å€¼</span></span><br><span class=\"line\">&#123;<span class=\"string\">&quot;acknowledged&quot;</span>:<span class=\"literal\">true</span>,<span class=\"string\">&quot;shards_acknowledged&quot;</span>:<span class=\"literal\">true</span>,<span class=\"string\">&quot;index&quot;</span>:<span class=\"string\">&quot;shopping&quot;</span>&#125;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ›å»ºå¹¶æ˜ å°„ç´¢å¼•</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># PUT /&lt;target&gt;</span></span><br><span class=\"line\"><span class=\"comment\"># è¿™é‡Œè®¾ç½®ç´¢å¼•åˆ†ç‰‡æ•°é‡ä¸º1ï¼Œå‰¯æœ¬æ•°é‡ä¸º2ï¼Œå¹¶è®¾ç½®å­—æ®µä¿¡æ¯</span></span><br><span class=\"line\">curl -X PUT -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/shopping&#x27;</span> \\</span><br><span class=\"line\">  -H <span class=\"string\">&#x27;Content-Type: application/json&#x27;</span> \\</span><br><span class=\"line\">  -d <span class=\"string\">&#x27;&#123;</span></span><br><span class=\"line\"><span class=\"string\">    &quot;settings&quot;:&#123;</span></span><br><span class=\"line\"><span class=\"string\">      &quot;number_of_shards&quot;:&quot;1&quot;,</span></span><br><span class=\"line\"><span class=\"string\">      &quot;number_of_replicas&quot;:&quot;2&quot;</span></span><br><span class=\"line\"><span class=\"string\">    &#125;,</span></span><br><span class=\"line\"><span class=\"string\">    &quot;mappings&quot;:&#123;</span></span><br><span class=\"line\"><span class=\"string\">      &quot;properties&quot;:&#123;</span></span><br><span class=\"line\"><span class=\"string\">        &quot;title&quot;:&#123;</span></span><br><span class=\"line\"><span class=\"string\">          &quot;type&quot;:&quot;text&quot;</span></span><br><span class=\"line\"><span class=\"string\">        &#125;,</span></span><br><span class=\"line\"><span class=\"string\">        &quot;category&quot;:&#123;</span></span><br><span class=\"line\"><span class=\"string\">          &quot;type&quot;:&quot;keyword&quot;</span></span><br><span class=\"line\"><span class=\"string\">        &#125;,</span></span><br><span class=\"line\"><span class=\"string\">        &quot;price&quot;:&#123;</span></span><br><span class=\"line\"><span class=\"string\">          &quot;type&quot;:&quot;double&quot;</span></span><br><span class=\"line\"><span class=\"string\">        &#125;,</span></span><br><span class=\"line\"><span class=\"string\">        &quot;count&quot;:&#123;</span></span><br><span class=\"line\"><span class=\"string\">          &quot;type&quot;:&quot;integer&quot;</span></span><br><span class=\"line\"><span class=\"string\">        &#125;</span></span><br><span class=\"line\"><span class=\"string\">      &#125;</span></span><br><span class=\"line\"><span class=\"string\">    &#125;</span></span><br><span class=\"line\"><span class=\"string\">  &#125;&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å‚æ•°è¯´æ˜</span></span><br><span class=\"line\"><span class=\"comment\">## settings: è¿™ä¸ªå‚æ•°ç”¨äºé…ç½®ç´¢å¼•çš„è®¾ç½®ï¼ŒåŒ…æ‹¬åˆ†ç‰‡æ•°é‡å’Œå‰¯æœ¬æ•°é‡ã€‚</span></span><br><span class=\"line\"><span class=\"comment\">### number_of_shards: è¿™ä¸ªå‚æ•°æŒ‡å®šäº†ç´¢å¼•ä¸­åˆ†ç‰‡çš„æ•°é‡ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œnumber_of_shards è®¾ç½®ä¸º 1ï¼Œæ„å‘³ç€ç´¢å¼•å°†åªæœ‰ä¸€ä¸ªä¸»åˆ†ç‰‡ã€‚</span></span><br><span class=\"line\"><span class=\"comment\">### number_of_replicas: è¿™ä¸ªå‚æ•°æŒ‡å®šäº†æ¯ä¸ªä¸»åˆ†ç‰‡çš„å‰¯æœ¬æ•°é‡ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œnumber_of_replicas è®¾ç½®ä¸º 2ï¼Œæ„å‘³ç€æ¯ä¸ªä¸»åˆ†ç‰‡å°†æœ‰ä¸¤ä¸ªå‰¯æœ¬ã€‚</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">## mappings: è¿™ä¸ªå‚æ•°ç”¨äºå®šä¹‰ç´¢å¼•ä¸­çš„å­—æ®µå’Œå­—æ®µç±»å‹ã€‚</span></span><br><span class=\"line\"><span class=\"comment\">### properties: è¿™ä¸ªå‚æ•°å®šä¹‰äº†ç´¢å¼•ä¸­çš„å­—æ®µå’Œå­—æ®µç±»å‹ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæœ‰å››ä¸ªå­—æ®µï¼štitleã€categoryã€images å’Œ priceã€‚</span></span><br><span class=\"line\"><span class=\"comment\">### title: è¿™ä¸ªå­—æ®µçš„ç±»å‹æ˜¯ textï¼Œè¡¨ç¤ºå®ƒæ˜¯ä¸€ä¸ªå…¨æ–‡æ£€ç´¢å­—æ®µã€‚text é€‚åˆå­˜å‚¨é•¿æ–‡æœ¬æ•°æ®ï¼Œå¹¶æ”¯æŒå…¨æ–‡æœç´¢ã€‚</span></span><br><span class=\"line\"><span class=\"comment\">### category: è¿™ä¸ªå­—æ®µçš„ç±»å‹æ˜¯ keywordï¼Œè¡¨ç¤ºå®ƒæ˜¯ä¸€ä¸ªå…³é”®å­—å­—æ®µï¼Œä¸æ”¯æŒå…¨æ–‡æ£€ç´¢ã€‚keyword é€‚åˆå­˜å‚¨ä¸éœ€è¦åˆ†è¯çš„çŸ­æ–‡æœ¬æ•°æ®ï¼ˆå¦‚æ ‡ç­¾ã€ç±»åˆ«ç­‰ï¼‰ï¼Œå¹¶ä¸”å¯ä»¥ç”¨äºèšåˆå’Œè¿‡æ»¤ã€‚</span></span><br><span class=\"line\"><span class=\"comment\">### price: è¿™ä¸ªå­—æ®µçš„ç±»å‹æ˜¯ doubleï¼Œè¡¨ç¤ºå®ƒæ˜¯ä¸€ä¸ªæ•°å­—å­—æ®µã€‚double è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªåŒç²¾åº¦æµ®ç‚¹æ•°å­—æ®µï¼Œé€‚åˆå­˜å‚¨æ•°å€¼æ•°æ®ï¼Œå¦‚ä»·æ ¼</span></span><br><span class=\"line\"><span class=\"comment\">### count: è¿™ä¸ªå­—æ®µçš„ç±»å‹æ˜¯ integerï¼Œè¡¨ç¤ºå®ƒæ˜¯ä¸€ä¸ªæ•´æ•°å­—æ®µã€‚integer è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªæ•´æ•°å­—æ®µï¼Œé€‚åˆå­˜å‚¨æ•´æ•°æ•°æ®ï¼Œå¦‚å•†å“æ•°é‡ç­‰ã€‚</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># è¿”å›å€¼</span></span><br><span class=\"line\">&#123;<span class=\"string\">&quot;acknowledged&quot;</span>:<span class=\"literal\">true</span>,<span class=\"string\">&quot;shards_acknowledged&quot;</span>:<span class=\"literal\">true</span>,<span class=\"string\">&quot;index&quot;</span>:<span class=\"string\">&quot;shopping&quot;</span>&#125;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ›´æ–°ç´¢å¼•æ˜ å°„</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># PUT /&lt;target&gt;/_mapping</span></span><br><span class=\"line\"><span class=\"comment\"># æ³¨æ„è¯¥apiåªèƒ½å¢åŠ æ–°çš„å­—æ®µï¼Œä¸èƒ½ä¿®æ”¹å·²æœ‰å­—æ®µï¼Œå¦‚æœè¦ä¿®æ”¹æºå­—æ®µç±»å‹æˆ–è€…åˆ†è¯å™¨ç±»å‹ï¼Œä¸‹æ–‡ä¼šä»‹ç»</span></span><br><span class=\"line\">curl -X PUT -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/shopping/_mapping&#x27;</span> \\</span><br><span class=\"line\">  -H <span class=\"string\">&#x27;Content-Type: application/json&#x27;</span> \\</span><br><span class=\"line\">  -d <span class=\"string\">&#x27;&#123;</span></span><br><span class=\"line\"><span class=\"string\">    &quot;properties&quot;:&#123;</span></span><br><span class=\"line\"><span class=\"string\">      &quot;remark&quot;:&#123;</span></span><br><span class=\"line\"><span class=\"string\">        &quot;type&quot;:&quot;text&quot;,</span></span><br><span class=\"line\"><span class=\"string\">        &quot;analyzer&quot;:&quot;ik_max_word&quot;,</span></span><br><span class=\"line\"><span class=\"string\">        &quot;search_analyzer&quot;:&quot;ik_smart&quot;</span></span><br><span class=\"line\"><span class=\"string\">      &#125;,</span></span><br><span class=\"line\"><span class=\"string\">      &quot;address&quot;: &#123;</span></span><br><span class=\"line\"><span class=\"string\">        &quot;type&quot;: &quot;text&quot;,</span></span><br><span class=\"line\"><span class=\"string\">        &quot;analyzer&quot;: &quot;ik_max_word&quot;,</span></span><br><span class=\"line\"><span class=\"string\">        &quot;fields&quot;: &#123;</span></span><br><span class=\"line\"><span class=\"string\">          &quot;keyword&quot;: &#123;</span></span><br><span class=\"line\"><span class=\"string\">            &quot;type&quot;: &quot;keyword&quot;</span></span><br><span class=\"line\"><span class=\"string\">          &#125;</span></span><br><span class=\"line\"><span class=\"string\">        &#125;</span></span><br><span class=\"line\"><span class=\"string\">      &#125;,</span></span><br><span class=\"line\"><span class=\"string\">      &quot;tags&quot;: &#123;</span></span><br><span class=\"line\"><span class=\"string\">        &quot;type&quot;: &quot;keyword&quot;</span></span><br><span class=\"line\"><span class=\"string\">      &#125;,</span></span><br><span class=\"line\"><span class=\"string\">      &quot;created_at&quot;: &#123;&quot;type&quot;: &quot;date&quot;, &quot;format&quot;: &quot;yyyy-MM-dd HH:mm:ss&quot;&#125;</span></span><br><span class=\"line\"><span class=\"string\">    &#125;</span></span><br><span class=\"line\"><span class=\"string\">  &#125;&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"># å‚æ•°è¯´æ˜</span></span><br><span class=\"line\"><span class=\"comment\"># è¿™é‡Œä¸ºç´¢å¼•æ·»åŠ äº†4ä¸ªå­—æ®µ</span></span><br><span class=\"line\"><span class=\"comment\"># remarkï¼šæ–°å¢å­—æ®µï¼Œç±»å‹ä¸ºtextï¼Œåˆ†è¯å™¨ä¸ºik_max_wordï¼Œæœç´¢åˆ†è¯å™¨ä¸ºik_smart</span></span><br><span class=\"line\">  <span class=\"comment\"># analyzer: ç´¢å¼•åˆ†è¯å™¨</span></span><br><span class=\"line\">  <span class=\"comment\"># search_analyzerï¼šæœç´¢åˆ†è¯å™¨</span></span><br><span class=\"line\">  <span class=\"comment\"># ik_max_wordï¼šä¸­æ–‡åˆ†è¯å™¨ï¼Œå°†å¥å­æ‹†åˆ†ä¸ºæœ€å¤šè¯å…ƒï¼Œé€‚åˆé•¿å¥å­</span></span><br><span class=\"line\">  <span class=\"comment\"># ik_smartï¼šä¸­æ–‡åˆ†è¯å™¨ï¼Œå°†å¥å­æ‹†åˆ†ä¸ºæœ€å°‘è¯å…ƒï¼Œé€‚åˆçŸ­å¥å­</span></span><br><span class=\"line\"><span class=\"comment\"># addressï¼šæ–°å¢å­—æ®µï¼Œç±»å‹ä¸ºtextï¼Œåˆ†è¯å™¨ä¸ºik_max_wordï¼Œæœç´¢åˆ†è¯å™¨æœªæŒ‡å®šï¼Œé»˜è®¤ä¸åˆ†è¯å™¨åŒä¸€ä¸ªï¼Œè¿™é‡Œè¿˜ä¸ºaddressæ·»åŠ äº†keywordå­—æ®µï¼Œç”¨äºå­˜å‚¨åŸå§‹æ•°æ®ï¼Œä»¥æ”¯æŒç²¾ç¡®æœç´¢</span></span><br><span class=\"line\"><span class=\"comment\"># tagsï¼šæ–°å¢å­—æ®µï¼Œç±»å‹ä¸ºkeywordï¼Œä¸æ”¯æŒåˆ†è¯ï¼Œé€‚åˆå­˜å‚¨çŸ­æ–‡æœ¬æ•°æ®ï¼ˆå¦‚æ ‡ç­¾ã€ç±»åˆ«ç­‰ï¼‰ï¼Œå¹¶ä¸”å¯ä»¥ç”¨äºèšåˆå’Œè¿‡æ»¤ï¼Œå¯ä»¥å­˜å‚¨æ•°ç»„</span></span><br><span class=\"line\"><span class=\"comment\"># created_atï¼šæ–°å¢å­—æ®µï¼Œç±»å‹ä¸ºdateï¼Œæ ¼å¼ä¸ºyyyy-MM-dd HH:mm:ss</span></span><br><span class=\"line\"><span class=\"comment\"># è¿”å›å€¼</span></span><br><span class=\"line\">&#123;<span class=\"string\">&quot;acknowledged&quot;</span>:<span class=\"literal\">true</span>&#125;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ›´æ–°ç´¢å¼•è®¾ç½®</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># PUT /&lt;target&gt;/_settings</span></span><br><span class=\"line\"><span class=\"comment\"># æ³¨æ„è¿™é‡Œä¸èƒ½æ›´æ–°number_of_shards</span></span><br><span class=\"line\">curl -X PUT -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/shopping/_settings&#x27;</span> \\</span><br><span class=\"line\">  -H <span class=\"string\">&#x27;Content-Type: application/json&#x27;</span> \\</span><br><span class=\"line\">  -d <span class=\"string\">&#x27;&#123;&quot;number_of_replicas&quot;:&quot;1&quot;&#125;&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"># è¿”å›å€¼</span></span><br><span class=\"line\">&#123;<span class=\"string\">&quot;acknowledged&quot;</span>:<span class=\"literal\">true</span>&#125;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æŸ¥çœ‹æŒ‡å®šç´¢å¼•</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># GET /&lt;target&gt;</span></span><br><span class=\"line\">curl -X GET -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/shopping?pretty&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"># è¿”å›å€¼</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">&quot;shopping&quot;</span> : &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;aliases&quot;</span> : &#123; &#125;,</span><br><span class=\"line\">    <span class=\"string\">&quot;mappings&quot;</span> : &#123;</span><br><span class=\"line\">      <span class=\"string\">&quot;properties&quot;</span> : &#123;</span><br><span class=\"line\">        <span class=\"string\">&quot;address&quot;</span> : &#123;</span><br><span class=\"line\">          <span class=\"string\">&quot;type&quot;</span> : <span class=\"string\">&quot;text&quot;</span>,</span><br><span class=\"line\">          <span class=\"string\">&quot;fields&quot;</span> : &#123;</span><br><span class=\"line\">            <span class=\"string\">&quot;keyword&quot;</span> : &#123;</span><br><span class=\"line\">              <span class=\"string\">&quot;type&quot;</span> : <span class=\"string\">&quot;keyword&quot;</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">          &#125;,</span><br><span class=\"line\">          <span class=\"string\">&quot;analyzer&quot;</span> : <span class=\"string\">&quot;ik_max_word&quot;</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        <span class=\"string\">&quot;category&quot;</span> : &#123;</span><br><span class=\"line\">          <span class=\"string\">&quot;type&quot;</span> : <span class=\"string\">&quot;keyword&quot;</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        <span class=\"string\">&quot;count&quot;</span> : &#123;</span><br><span class=\"line\">          <span class=\"string\">&quot;type&quot;</span> : <span class=\"string\">&quot;integer&quot;</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        <span class=\"string\">&quot;created_at&quot;</span> : &#123;</span><br><span class=\"line\">          <span class=\"string\">&quot;type&quot;</span> : <span class=\"string\">&quot;date&quot;</span>,</span><br><span class=\"line\">          <span class=\"string\">&quot;format&quot;</span> : <span class=\"string\">&quot;yyyy-MM-dd HH:mm:ss&quot;</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        <span class=\"string\">&quot;price&quot;</span> : &#123;</span><br><span class=\"line\">          <span class=\"string\">&quot;type&quot;</span> : <span class=\"string\">&quot;double&quot;</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        <span class=\"string\">&quot;remark&quot;</span> : &#123;</span><br><span class=\"line\">          <span class=\"string\">&quot;type&quot;</span> : <span class=\"string\">&quot;text&quot;</span>,</span><br><span class=\"line\">          <span class=\"string\">&quot;analyzer&quot;</span> : <span class=\"string\">&quot;ik_max_word&quot;</span>,</span><br><span class=\"line\">          <span class=\"string\">&quot;search_analyzer&quot;</span> : <span class=\"string\">&quot;ik_smart&quot;</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        <span class=\"string\">&quot;tags&quot;</span> : &#123;</span><br><span class=\"line\">          <span class=\"string\">&quot;type&quot;</span> : <span class=\"string\">&quot;keyword&quot;</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        <span class=\"string\">&quot;title&quot;</span> : &#123;</span><br><span class=\"line\">          <span class=\"string\">&quot;type&quot;</span> : <span class=\"string\">&quot;text&quot;</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"string\">&quot;settings&quot;</span> : &#123;</span><br><span class=\"line\">      <span class=\"string\">&quot;index&quot;</span> : &#123;</span><br><span class=\"line\">        <span class=\"string\">&quot;routing&quot;</span> : &#123;</span><br><span class=\"line\">          <span class=\"string\">&quot;allocation&quot;</span> : &#123;</span><br><span class=\"line\">            <span class=\"string\">&quot;include&quot;</span> : &#123;</span><br><span class=\"line\">              <span class=\"string\">&quot;_tier_preference&quot;</span> : <span class=\"string\">&quot;data_content&quot;</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        <span class=\"string\">&quot;number_of_shards&quot;</span> : <span class=\"string\">&quot;1&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;provided_name&quot;</span> : <span class=\"string\">&quot;shopping&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;creation_date&quot;</span> : <span class=\"string\">&quot;1745291743120&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;number_of_replicas&quot;</span> : <span class=\"string\">&quot;1&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;uuid&quot;</span> : <span class=\"string\">&quot;Y1IWrdlQTUm-CbbIWweSxQ&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;version&quot;</span> : &#123;</span><br><span class=\"line\">          <span class=\"string\">&quot;created&quot;</span> : <span class=\"string\">&quot;8525000&quot;</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æŸ¥çœ‹ç´¢å¼•è®¾ç½®</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># GET /&lt;target&gt;/_settings</span></span><br><span class=\"line\">curl -X GET -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/shopping/_settings?pretty&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"># è¿”å›å€¼</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">&quot;shopping&quot;</span> : &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;mappings&quot;</span> : &#123;</span><br><span class=\"line\">      <span class=\"string\">&quot;properties&quot;</span> : &#123;</span><br><span class=\"line\">        <span class=\"string\">&quot;address&quot;</span> : &#123;</span><br><span class=\"line\">          <span class=\"string\">&quot;type&quot;</span> : <span class=\"string\">&quot;text&quot;</span>,</span><br><span class=\"line\">          <span class=\"string\">&quot;fields&quot;</span> : &#123;</span><br><span class=\"line\">            <span class=\"string\">&quot;keyword&quot;</span> : &#123;</span><br><span class=\"line\">              <span class=\"string\">&quot;type&quot;</span> : <span class=\"string\">&quot;keyword&quot;</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">          &#125;,</span><br><span class=\"line\">          <span class=\"string\">&quot;analyzer&quot;</span> : <span class=\"string\">&quot;ik_max_word&quot;</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        <span class=\"string\">&quot;category&quot;</span> : &#123;</span><br><span class=\"line\">          <span class=\"string\">&quot;type&quot;</span> : <span class=\"string\">&quot;keyword&quot;</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        <span class=\"string\">&quot;count&quot;</span> : &#123;</span><br><span class=\"line\">          <span class=\"string\">&quot;type&quot;</span> : <span class=\"string\">&quot;integer&quot;</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        <span class=\"string\">&quot;created_at&quot;</span> : &#123;</span><br><span class=\"line\">          <span class=\"string\">&quot;type&quot;</span> : <span class=\"string\">&quot;date&quot;</span>,</span><br><span class=\"line\">          <span class=\"string\">&quot;format&quot;</span> : <span class=\"string\">&quot;yyyy-MM-dd HH:mm:ss&quot;</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        <span class=\"string\">&quot;price&quot;</span> : &#123;</span><br><span class=\"line\">          <span class=\"string\">&quot;type&quot;</span> : <span class=\"string\">&quot;double&quot;</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        <span class=\"string\">&quot;remark&quot;</span> : &#123;</span><br><span class=\"line\">          <span class=\"string\">&quot;type&quot;</span> : <span class=\"string\">&quot;text&quot;</span>,</span><br><span class=\"line\">          <span class=\"string\">&quot;analyzer&quot;</span> : <span class=\"string\">&quot;ik_max_word&quot;</span>,</span><br><span class=\"line\">          <span class=\"string\">&quot;search_analyzer&quot;</span> : <span class=\"string\">&quot;ik_smart&quot;</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        <span class=\"string\">&quot;tags&quot;</span> : &#123;</span><br><span class=\"line\">          <span class=\"string\">&quot;type&quot;</span> : <span class=\"string\">&quot;keyword&quot;</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        <span class=\"string\">&quot;title&quot;</span> : &#123;</span><br><span class=\"line\">          <span class=\"string\">&quot;type&quot;</span> : <span class=\"string\">&quot;text&quot;</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æŸ¥çœ‹å­—æ®µæ˜ å°„</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># GET /&lt;target&gt;/_mapping/field/&lt;field&gt;</span></span><br><span class=\"line\"><span class=\"comment\"># shopping ä¸ºç´¢å¼•åç§°ï¼Œtitle ä¸ºå­—æ®µåç§°</span></span><br><span class=\"line\">curl -X GET -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/shopping/_mapping/field/title?pretty&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"># è¿”å›å€¼</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">&quot;shopping&quot;</span> : &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;mappings&quot;</span> : &#123;</span><br><span class=\"line\">      <span class=\"string\">&quot;title&quot;</span> : &#123;</span><br><span class=\"line\">        <span class=\"string\">&quot;full_name&quot;</span> : <span class=\"string\">&quot;title&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;mapping&quot;</span> : &#123;</span><br><span class=\"line\">          <span class=\"string\">&quot;title&quot;</span> : &#123;</span><br><span class=\"line\">            <span class=\"string\">&quot;type&quot;</span> : <span class=\"string\">&quot;text&quot;</span></span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ¤æ–­ç´¢å¼•æ˜¯å¦å­˜åœ¨</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ä½¿ç”¨ -I å‚æ•°æ¥å‘é€ HEAD è¯·æ±‚ï¼Œå¯ä»¥è·å–å“åº”å¤´è€Œä¸å¿…ä¸‹è½½å“åº”ä½“ã€‚</span></span><br><span class=\"line\"><span class=\"comment\"># HEAD /&lt;target&gt;</span></span><br><span class=\"line\">curl -I -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/shopping&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"># è¿”å›å€¼</span></span><br><span class=\"line\">HTTP/1.1 200 OK</span><br><span class=\"line\">X-elastic-product: Elasticsearch</span><br><span class=\"line\">content-type: application/json</span><br><span class=\"line\">content-length: 603</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># è¿™ä¸ªå‘½ä»¤ä¸ä¼šè¿”å›å“åº”ä½“ï¼Œä½†å®ƒçš„ HTTP å“åº”ä»£ç å¯ä»¥å‘Šè¯‰ä½ ç´¢å¼•çš„å­˜åœ¨æƒ…å†µï¼š</span></span><br><span class=\"line\">  <span class=\"comment\"># 200 OK è¡¨ç¤ºç´¢å¼•å­˜åœ¨ã€‚</span></span><br><span class=\"line\">  <span class=\"comment\"># 404 Not Found è¡¨ç¤ºç´¢å¼•ä¸å­˜åœ¨ã€‚</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ é™¤ç´¢å¼•</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># DELETE /&lt;target&gt;</span></span><br><span class=\"line\">curl -X DELETE -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/shopping&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"># è¿”å›å€¼</span></span><br><span class=\"line\">&#123;<span class=\"string\">&quot;acknowledged&quot;</span>:<span class=\"literal\">true</span>&#125;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¸ºç´¢å¼•åˆ›å»ºåˆ«å</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æ³¨æ„ï¼šä¸åŒç´¢å¼•å¯ä»¥æœ‰ç›¸åŒåç§°çš„åˆ«åï¼Œæ‰€ä»¥åœ¨æ•°æ®ç»“æ„ä¸€è‡´çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥ä¸ºä¸åŒçš„ç´¢å¼•åˆ›å»ºç›¸åŒçš„åˆ«åï¼Œç„¶åæ ¹æ®åˆ«åè¿›è¡Œæ•°æ®æŸ¥è¯¢</span></span><br><span class=\"line\"><span class=\"comment\"># POST /&lt;target&gt;/_alias/&lt;alias&gt;</span></span><br><span class=\"line\">curl -X POST -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/shopping/_alias/shopping_alias&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"># è¿”å›å€¼</span></span><br><span class=\"line\">&#123;<span class=\"string\">&quot;acknowledged&quot;</span>:<span class=\"literal\">true</span>&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ä¹Ÿå¯ä»¥ä½¿ç”¨å¦‚ä¸‹æ–¹æ³•</span></span><br><span class=\"line\">curl -X POST -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/_aliases&#x27;</span> \\</span><br><span class=\"line\">  -H <span class=\"string\">&#x27;Content-Type: application/json&#x27;</span> \\</span><br><span class=\"line\">  -d <span class=\"string\">&#x27;&#123;</span></span><br><span class=\"line\"><span class=\"string\">    &quot;actions&quot;: [</span></span><br><span class=\"line\"><span class=\"string\">      &#123;</span></span><br><span class=\"line\"><span class=\"string\">        &quot;add&quot;: &#123;</span></span><br><span class=\"line\"><span class=\"string\">          &quot;index&quot;: &quot;shopping&quot;,</span></span><br><span class=\"line\"><span class=\"string\">          &quot;alias&quot;: &quot;shopping_alias2&quot;</span></span><br><span class=\"line\"><span class=\"string\">        &#125;</span></span><br><span class=\"line\"><span class=\"string\">      &#125;</span></span><br><span class=\"line\"><span class=\"string\">    ]</span></span><br><span class=\"line\"><span class=\"string\">  &#125;&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"># è¿”å›å€¼</span></span><br><span class=\"line\">&#123;<span class=\"string\">&quot;acknowledged&quot;</span>:<span class=\"literal\">true</span>&#125;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æŸ¥çœ‹ç´¢å¼•åˆ«å</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># GET /&lt;target&gt;/_alias/&lt;alias&gt;</span></span><br><span class=\"line\">curl -X GET -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/shopping/_alias/shopping_alias?pretty&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"># è¿”å›å€¼</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">&quot;shopping&quot;</span> : &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;aliases&quot;</span> : &#123;</span><br><span class=\"line\">      <span class=\"string\">&quot;shopping_alias&quot;</span> : &#123; &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹å½“å‰ç´¢å¼•çš„æ‰€æœ‰åˆ«å</span></span><br><span class=\"line\">curl -X GET -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/shopping/_alias?pretty&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹æ‰€æœ‰ç´¢å¼•çš„åˆ«å</span></span><br><span class=\"line\">curl -X GET -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/_alias?pretty&#x27;</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¸ºç´¢å¼•åˆ é™¤åˆ«å</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># DELETE /&lt;target&gt;/_alias/&lt;alias&gt;</span></span><br><span class=\"line\">curl -X DELETE -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/shopping/_alias/shopping_alias&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"># è¿”å›å€¼</span></span><br><span class=\"line\">&#123;<span class=\"string\">&quot;acknowledged&quot;</span>:<span class=\"literal\">true</span>&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"å¦‚ä½•ä¿®æ”¹ç´¢å¼•å­—æ®µç±»å‹æˆ–åˆ†è¯å™¨ç±»å‹ï¼Ÿ\">å¦‚ä½•ä¿®æ”¹ç´¢å¼•å­—æ®µç±»å‹æˆ–åˆ†è¯å™¨ç±»å‹ï¼Ÿ</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ›å»ºæ–°çš„ç´¢å¼•</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># è¿™é‡Œä¸ºtitleå­—æ®µå¢åŠ åˆ†è¯å™¨</span></span><br><span class=\"line\">curl -X PUT -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/shopping_new&#x27;</span> \\</span><br><span class=\"line\">  -H <span class=\"string\">&#x27;Content-Type: application/json&#x27;</span> \\</span><br><span class=\"line\">  -d <span class=\"string\">&#x27;&#123;</span></span><br><span class=\"line\"><span class=\"string\">    &quot;settings&quot;:&#123;</span></span><br><span class=\"line\"><span class=\"string\">      &quot;number_of_shards&quot;:&quot;1&quot;,</span></span><br><span class=\"line\"><span class=\"string\">      &quot;number_of_replicas&quot;:&quot;2&quot;</span></span><br><span class=\"line\"><span class=\"string\">    &#125;,</span></span><br><span class=\"line\"><span class=\"string\">    &quot;mappings&quot;:&#123;</span></span><br><span class=\"line\"><span class=\"string\">      &quot;properties&quot;:&#123;</span></span><br><span class=\"line\"><span class=\"string\">        &quot;category&quot;:&#123;</span></span><br><span class=\"line\"><span class=\"string\">          &quot;type&quot;:&quot;keyword&quot;</span></span><br><span class=\"line\"><span class=\"string\">        &#125;,</span></span><br><span class=\"line\"><span class=\"string\">        &quot;price&quot;:&#123;</span></span><br><span class=\"line\"><span class=\"string\">          &quot;type&quot;:&quot;double&quot;</span></span><br><span class=\"line\"><span class=\"string\">        &#125;,</span></span><br><span class=\"line\"><span class=\"string\">        &quot;count&quot;:&#123;</span></span><br><span class=\"line\"><span class=\"string\">          &quot;type&quot;:&quot;integer&quot;</span></span><br><span class=\"line\"><span class=\"string\">        &#125;,</span></span><br><span class=\"line\"><span class=\"string\">        &quot;title&quot;:&#123;</span></span><br><span class=\"line\"><span class=\"string\">          &quot;type&quot;:&quot;text&quot;,</span></span><br><span class=\"line\"><span class=\"string\">          &quot;analyzer&quot;:&quot;ik_max_word&quot;,</span></span><br><span class=\"line\"><span class=\"string\">          &quot;search_analyzer&quot;:&quot;ik_smart&quot;</span></span><br><span class=\"line\"><span class=\"string\">        &#125;,</span></span><br><span class=\"line\"><span class=\"string\">        &quot;remark&quot;:&#123;</span></span><br><span class=\"line\"><span class=\"string\">        &quot;type&quot;:&quot;text&quot;,</span></span><br><span class=\"line\"><span class=\"string\">        &quot;analyzer&quot;:&quot;ik_max_word&quot;,</span></span><br><span class=\"line\"><span class=\"string\">        &quot;search_analyzer&quot;:&quot;ik_smart&quot;</span></span><br><span class=\"line\"><span class=\"string\">      &#125;,</span></span><br><span class=\"line\"><span class=\"string\">      &quot;address&quot;: &#123;</span></span><br><span class=\"line\"><span class=\"string\">        &quot;type&quot;: &quot;text&quot;,</span></span><br><span class=\"line\"><span class=\"string\">        &quot;analyzer&quot;: &quot;ik_max_word&quot;,</span></span><br><span class=\"line\"><span class=\"string\">        &quot;fields&quot;: &#123;</span></span><br><span class=\"line\"><span class=\"string\">          &quot;keyword&quot;: &#123;</span></span><br><span class=\"line\"><span class=\"string\">            &quot;type&quot;: &quot;keyword&quot;</span></span><br><span class=\"line\"><span class=\"string\">          &#125;</span></span><br><span class=\"line\"><span class=\"string\">        &#125;</span></span><br><span class=\"line\"><span class=\"string\">      &#125;,</span></span><br><span class=\"line\"><span class=\"string\">      &quot;tags&quot;: &#123;</span></span><br><span class=\"line\"><span class=\"string\">        &quot;type&quot;: &quot;keyword&quot;</span></span><br><span class=\"line\"><span class=\"string\">      &#125;,</span></span><br><span class=\"line\"><span class=\"string\">      &quot;created_at&quot;: &#123;&quot;type&quot;: &quot;date&quot;, &quot;format&quot;: &quot;yyyy-MM-dd HH:mm:ss&quot;&#125;</span></span><br><span class=\"line\"><span class=\"string\">      &#125;</span></span><br><span class=\"line\"><span class=\"string\">    &#125;</span></span><br><span class=\"line\"><span class=\"string\">  &#125;&#x27;</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å°†åŸç´¢å¼•çš„æ•°æ®è¿ç§»åˆ°æ–°ç´¢å¼•</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -X POST -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/_reindex&#x27;</span> \\</span><br><span class=\"line\">  -H <span class=\"string\">&#x27;Content-Type: application/json&#x27;</span> \\</span><br><span class=\"line\">  -d <span class=\"string\">&#x27;&#123;</span></span><br><span class=\"line\"><span class=\"string\">  &quot;source&quot;: &#123;</span></span><br><span class=\"line\"><span class=\"string\">    &quot;index&quot;: &quot;shopping&quot;</span></span><br><span class=\"line\"><span class=\"string\">  &#125;,</span></span><br><span class=\"line\"><span class=\"string\">  &quot;dest&quot;: &#123;</span></span><br><span class=\"line\"><span class=\"string\">    &quot;index&quot;: &quot;shopping_new&quot;</span></span><br><span class=\"line\"><span class=\"string\">  &#125;</span></span><br><span class=\"line\"><span class=\"string\">&#125;&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"># è¿”å›å€¼</span></span><br><span class=\"line\">&#123;<span class=\"string\">&quot;took&quot;</span>:101,<span class=\"string\">&quot;timed_out&quot;</span>:<span class=\"literal\">false</span>,<span class=\"string\">&quot;total&quot;</span>:2,<span class=\"string\">&quot;updated&quot;</span>:0,<span class=\"string\">&quot;created&quot;</span>:2,<span class=\"string\">&quot;deleted&quot;</span>:0,<span class=\"string\">&quot;batches&quot;</span>:1,<span class=\"string\">&quot;version_conflicts&quot;</span>:0,<span class=\"string\">&quot;noops&quot;</span>:0,<span class=\"string\">&quot;retries&quot;</span>:&#123;<span class=\"string\">&quot;bulk&quot;</span>:0,<span class=\"string\">&quot;search&quot;</span>:0&#125;,<span class=\"string\">&quot;throttled_millis&quot;</span>:0,<span class=\"string\">&quot;requests_per_second&quot;</span>:-1.0,<span class=\"string\">&quot;throttled_until_millis&quot;</span>:0,<span class=\"string\">&quot;failures&quot;</span>:[]&#125;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ é™¤åŸç´¢å¼•</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -X DELETE -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/shopping&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"># è¿”å›å€¼</span></span><br><span class=\"line\">&#123;<span class=\"string\">&quot;acknowledged&quot;</span>:<span class=\"literal\">true</span>&#125;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¸ºæ–°ç´¢å¼•åˆ›å»ºåˆ«å</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -X POST -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/shopping_new/_alias/shopping&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"># è¿”å›å€¼</span></span><br><span class=\"line\">&#123;<span class=\"string\">&quot;acknowledged&quot;</span>:<span class=\"literal\">true</span>,<span class=\"string\">&quot;errors&quot;</span>:<span class=\"literal\">false</span>&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"æ•°æ®å¢åˆ æ”¹åŸºæœ¬æ“ä½œ\">æ•°æ®å¢åˆ æ”¹åŸºæœ¬æ“ä½œ</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ–°å¢æ•°æ®</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">1.ä¸ºæŒ‡å®šç´¢å¼•æ’å…¥ä¸€æ¡æ•°æ®(_docæ–¹å¼ï¼šä¸æŒ‡å®šidé»˜è®¤éšæœºå­—ç¬¦ä¸²)</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># _doc çš„æ–¹å¼åˆ›å»ºç´¢å¼•æ•°æ®æ—¶ï¼Œå¯ä»¥ä¸æŒ‡å®šidï¼Œé»˜è®¤ä¼šåˆ›å»ºæ–°çš„idï¼Œidç±»å‹ä¸ºéšæœºå­—ç¬¦ä¸²</span></span><br><span class=\"line\"><span class=\"comment\"># POST /&lt;target&gt;/_doc</span></span><br><span class=\"line\">curl -X POST -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/shopping/_doc?pretty&#x27;</span> \\</span><br><span class=\"line\">  -H <span class=\"string\">&#x27;Content-Type: application/json&#x27;</span> \\</span><br><span class=\"line\">  -d <span class=\"string\">&#x27;&#123;</span></span><br><span class=\"line\"><span class=\"string\">    &quot;category&quot;: &quot;electronics&quot;,</span></span><br><span class=\"line\"><span class=\"string\">    &quot;price&quot;: 999.99,</span></span><br><span class=\"line\"><span class=\"string\">    &quot;count&quot;: 10,</span></span><br><span class=\"line\"><span class=\"string\">    &quot;title&quot;: &quot;Smartphone X - 128GB&quot;,</span></span><br><span class=\"line\"><span class=\"string\">    &quot;remark&quot;: &quot;This latest Smartphone X comes with a powerful processor and high-resolution camera.&quot;,</span></span><br><span class=\"line\"><span class=\"string\">    &quot;address&quot;: &quot;123 Electronic Ave, Beijing, China&quot;,</span></span><br><span class=\"line\"><span class=\"string\">    &quot;tags&quot;: [&quot;latest&quot;, &quot;smartphone&quot;, &quot;technology&quot;],</span></span><br><span class=\"line\"><span class=\"string\">    &quot;created_at&quot;: &quot;2025-04-22 03:30:02&quot;</span></span><br><span class=\"line\"><span class=\"string\">  &#125;&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"># è¿”å›å€¼</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">&quot;_index&quot;</span> : <span class=\"string\">&quot;shopping_new&quot;</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;_id&quot;</span> : <span class=\"string\">&quot;sImNW5YBmgASmV9McVvI&quot;</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;_version&quot;</span> : 1,</span><br><span class=\"line\">  <span class=\"string\">&quot;result&quot;</span> : <span class=\"string\">&quot;created&quot;</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;_shards&quot;</span> : &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;total&quot;</span> : 3,</span><br><span class=\"line\">    <span class=\"string\">&quot;successful&quot;</span> : 1,</span><br><span class=\"line\">    <span class=\"string\">&quot;failed&quot;</span> : 0</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"string\">&quot;_seq_no&quot;</span> : 1,</span><br><span class=\"line\">  <span class=\"string\">&quot;_primary_term&quot;</span> : 1</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">2.ä¸ºæŒ‡å®šç´¢å¼•æ’å…¥ä¸€æ¡æ•°æ®(_docæ–¹å¼ï¼šæŒ‡å®šid)</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># _doc çš„æ–¹å¼åˆ›å»ºç´¢å¼•æ•°æ®æ—¶ï¼Œå¦‚æœæŒ‡å®šidï¼Œå†æ¬¡æ‰§è¡Œæ—¶ä¼šå…ˆåˆ é™¤åŸæ•°æ®å†åˆ›å»ºæ–°æ•°æ®ï¼Œæ‰€ä»¥å¿…é¡»å…¨é‡æ›´æ–°æ‰è¡Œã€‚</span></span><br><span class=\"line\"><span class=\"comment\"># PUT /&lt;target&gt;/_doc</span></span><br><span class=\"line\">curl -X PUT -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/shopping/_doc/100?pretty&#x27;</span> \\</span><br><span class=\"line\">  -H <span class=\"string\">&#x27;Content-Type: application/json&#x27;</span> \\</span><br><span class=\"line\">  -d <span class=\"string\">&#x27;&#123;</span></span><br><span class=\"line\"><span class=\"string\">    &quot;category&quot;: &quot;electronics&quot;,</span></span><br><span class=\"line\"><span class=\"string\">    &quot;price&quot;: 999.99,</span></span><br><span class=\"line\"><span class=\"string\">    &quot;count&quot;: 10,</span></span><br><span class=\"line\"><span class=\"string\">    &quot;title&quot;: &quot;Smartphone X - 128GB&quot;,</span></span><br><span class=\"line\"><span class=\"string\">    &quot;remark&quot;: &quot;This latest Smartphone X comes with a powerful processor and high-resolution camera.&quot;,</span></span><br><span class=\"line\"><span class=\"string\">    &quot;address&quot;: &quot;123 Electronic Ave, Beijing, China&quot;,</span></span><br><span class=\"line\"><span class=\"string\">    &quot;tags&quot;: [&quot;latest&quot;, &quot;smartphone&quot;, &quot;technology&quot;],</span></span><br><span class=\"line\"><span class=\"string\">    &quot;created_at&quot;: &quot;2025-04-22 03:30:02&quot;</span></span><br><span class=\"line\"><span class=\"string\">  &#125;&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"># è¿”å›å€¼</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">&quot;_index&quot;</span> : <span class=\"string\">&quot;shopping_new&quot;</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;_id&quot;</span> : <span class=\"string\">&quot;100&quot;</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;_version&quot;</span> : 1,</span><br><span class=\"line\">  <span class=\"string\">&quot;result&quot;</span> : <span class=\"string\">&quot;created&quot;</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;_shards&quot;</span> : &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;total&quot;</span> : 3,</span><br><span class=\"line\">    <span class=\"string\">&quot;successful&quot;</span> : 1,</span><br><span class=\"line\">    <span class=\"string\">&quot;failed&quot;</span> : 0</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"string\">&quot;_seq_no&quot;</span> : 2,</span><br><span class=\"line\">  <span class=\"string\">&quot;_primary_term&quot;</span> : 1</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">\n<p>3.ä¸ºæŒ‡å®šç´¢å¼•æ’å…¥ä¸€æ¡æ•°æ®(_createæ–¹å¼ï¼šæŒ‡å®šid)</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># _create çš„æ–¹å¼åˆ›å»ºç´¢å¼•æ•°æ®æ—¶ï¼Œå¿…é¡»æŒ‡å®šid,è€Œä¸”åªèƒ½æ‰§è¡Œä¸€æ¬¡ï¼Œå› ä¸ºæ‰§è¡Œè¿‡ä¸€æ¬¡åæŒ‡å®šidçš„æ•°æ®å°±å­˜åœ¨äº†ï¼Œä¸èƒ½å†æ¬¡åˆ›å»º</span></span><br><span class=\"line\"><span class=\"comment\"># POST /&lt;target&gt;/_create/&lt;id&gt;</span></span><br><span class=\"line\">curl -X POST -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/shopping/_create/1?pretty&#x27;</span> \\</span><br><span class=\"line\">  -H <span class=\"string\">&#x27;Content-Type: application/json&#x27;</span> \\</span><br><span class=\"line\">  -d <span class=\"string\">&#x27;&#123;</span></span><br><span class=\"line\"><span class=\"string\">    &quot;category&quot;: &quot;electronics&quot;,</span></span><br><span class=\"line\"><span class=\"string\">    &quot;price&quot;: 999.99,</span></span><br><span class=\"line\"><span class=\"string\">    &quot;count&quot;: 10,</span></span><br><span class=\"line\"><span class=\"string\">    &quot;title&quot;: &quot;Smartphone X - 128GB&quot;,</span></span><br><span class=\"line\"><span class=\"string\">    &quot;remark&quot;: &quot;This latest Smartphone X comes with a powerful processor and high-resolution camera.&quot;,</span></span><br><span class=\"line\"><span class=\"string\">    &quot;address&quot;: &quot;123 Electronic Ave, Beijing, China&quot;,</span></span><br><span class=\"line\"><span class=\"string\">    &quot;tags&quot;: [&quot;latest&quot;, &quot;smartphone&quot;, &quot;technology&quot;],</span></span><br><span class=\"line\"><span class=\"string\">    &quot;created_at&quot;: &quot;2025-04-22 03:30:02&quot;</span></span><br><span class=\"line\"><span class=\"string\">  &#125;&#x27;</span></span><br></pre></td></tr></table></figure>\n</li>\n<li class=\"lvl-2\">\n<p>ä¿®æ”¹æ•°æ®</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">1.ä¿®æ”¹å…¨éƒ¨æ•°æ®</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># POST /&lt;target&gt;/_doc/&lt;id&gt;</span></span><br><span class=\"line\"><span class=\"comment\"># æ‰§è¡Œæ—¶ä¼šå…ˆåˆ é™¤åŸæ•°æ®å†åˆ›å»ºæ–°æ•°æ®ï¼Œæ‰€ä»¥å¿…é¡»å…¨é‡æ›´æ–°æ‰è¡Œã€‚</span></span><br><span class=\"line\">curl -X POST -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/shopping/_doc/sImNW5YBmgASmV9McVvI&#x27;</span> \\</span><br><span class=\"line\">  -H <span class=\"string\">&#x27;Content-Type: application/json&#x27;</span> \\</span><br><span class=\"line\">  -d <span class=\"string\">&#x27;&#123;</span></span><br><span class=\"line\"><span class=\"string\">    &quot;category&quot;: &quot;electronics&quot;,</span></span><br><span class=\"line\"><span class=\"string\">    &quot;price&quot;: 999.99,</span></span><br><span class=\"line\"><span class=\"string\">    &quot;count&quot;: 20,</span></span><br><span class=\"line\"><span class=\"string\">    &quot;title&quot;: &quot;Smartphone X - 128GB&quot;,</span></span><br><span class=\"line\"><span class=\"string\">    &quot;remark&quot;: &quot;This latest Smartphone X comes with a powerful processor and high-resolution camera.&quot;,</span></span><br><span class=\"line\"><span class=\"string\">    &quot;address&quot;: &quot;123 Electronic Ave, Beijing, China&quot;,</span></span><br><span class=\"line\"><span class=\"string\">    &quot;tags&quot;: [&quot;latest&quot;, &quot;smartphone&quot;, &quot;technology&quot;],</span></span><br><span class=\"line\"><span class=\"string\">    &quot;created_at&quot;: &quot;2025-04-22 03:30:02&quot;</span></span><br><span class=\"line\"><span class=\"string\">  &#125;&#x27;</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">2.ä¿®æ”¹éƒ¨åˆ†æ•°æ®</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># POST /&lt;target&gt;/_update/&lt;id&gt;</span></span><br><span class=\"line\"><span class=\"comment\"># æ‰§è¡Œæ—¶åªä¼šä¿®æ”¹æŒ‡å®šå­—æ®µï¼Œä¸ä¼šåˆ é™¤åŸæ•°æ®ï¼Œæ‰€ä»¥å¯ä»¥éƒ¨åˆ†æ›´æ–°ã€‚</span></span><br><span class=\"line\">curl -X POST -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/shopping/_update/1&#x27;</span> \\</span><br><span class=\"line\">  -H <span class=\"string\">&#x27;Content-Type: application/json&#x27;</span> \\</span><br><span class=\"line\">  -d <span class=\"string\">&#x27;&#123;&quot;doc&quot;:&#123;&quot;count&quot;:100&#125;&#125;&#x27;</span></span><br></pre></td></tr></table></figure>\n</li>\n<li class=\"lvl-2\">\n<p>æŸ¥è¯¢æŒ‡å®šç´¢å¼•çš„æŒ‡å®šidçš„æ•°æ®</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># GET /&lt;target&gt;/_doc/&lt;id&gt;</span></span><br><span class=\"line\">curl -X GET -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/shopping/_doc/100?pretty&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"># è¿”å›å€¼</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">&quot;_index&quot;</span> : <span class=\"string\">&quot;shopping_new&quot;</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;_id&quot;</span> : <span class=\"string\">&quot;100&quot;</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;_version&quot;</span> : 1,</span><br><span class=\"line\">  <span class=\"string\">&quot;_seq_no&quot;</span> : 2,</span><br><span class=\"line\">  <span class=\"string\">&quot;_primary_term&quot;</span> : 1,</span><br><span class=\"line\">  <span class=\"string\">&quot;found&quot;</span> : <span class=\"literal\">true</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;_source&quot;</span> : &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;category&quot;</span> : <span class=\"string\">&quot;electronics&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;price&quot;</span> : 999.99,</span><br><span class=\"line\">    <span class=\"string\">&quot;count&quot;</span> : 10,</span><br><span class=\"line\">    <span class=\"string\">&quot;title&quot;</span> : <span class=\"string\">&quot;Smartphone X - 128GB&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;remark&quot;</span> : <span class=\"string\">&quot;This latest Smartphone X comes with a powerful processor and high-resolution camera.&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;address&quot;</span> : <span class=\"string\">&quot;123 Electronic Ave, Beijing, China&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;tags&quot;</span> : [</span><br><span class=\"line\">      <span class=\"string\">&quot;latest&quot;</span>,</span><br><span class=\"line\">      <span class=\"string\">&quot;smartphone&quot;</span>,</span><br><span class=\"line\">      <span class=\"string\">&quot;technology&quot;</span></span><br><span class=\"line\">    ],</span><br><span class=\"line\">    <span class=\"string\">&quot;created_at&quot;</span> : <span class=\"string\">&quot;2025-04-22 03:30:02&quot;</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ é™¤æŒ‡å®šç´¢å¼•çš„æŒ‡å®šidçš„æ•°æ®</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># DELETE /&lt;target&gt;/_doc/&lt;id&gt;</span></span><br><span class=\"line\">curl -X DELETE -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/shopping/_doc/100&#x27;</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ é™¤ç´¢å¼•å…¨éƒ¨æ•°æ®</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -X POST -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/shopping/_delete_by_query?pretty&#x27;</span> \\</span><br><span class=\"line\">  -H <span class=\"string\">&#x27;Content-Type: application/json&#x27;</span> \\</span><br><span class=\"line\">  -d <span class=\"string\">&#x27;&#123;&quot;query&quot;:&#123;&quot;match_all&quot;:&#123;&#125;&#125;&#125;&#x27;</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"æ‰¹é‡æ“ä½œ\">æ‰¹é‡æ“ä½œ</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ‰¹é‡æ–°å¢æ•°æ®</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æ³¨æ„æ•°æ®è¡Œè¦é¡¶è¡Œå†™ï¼Œå‰é¢ä¸è¦æœ‰ç©ºæ ¼</span></span><br><span class=\"line\"><span class=\"comment\"># POST /_bulk</span></span><br><span class=\"line\">curl -X POST -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/_bulk&#x27;</span> \\</span><br><span class=\"line\">  -H <span class=\"string\">&#x27;Content-Type: application/json&#x27;</span> \\</span><br><span class=\"line\">  -d <span class=\"string\">&#x27;&#123; &quot;index&quot;: &#123; &quot;_index&quot;: &quot;shopping&quot;, &quot;_id&quot;: &quot;1&quot; &#125; &#125;</span></span><br><span class=\"line\"><span class=\"string\">&#123; &quot;category&quot;: &quot;electronics&quot;, &quot;price&quot;: 999.99, &quot;count&quot;: 10, &quot;title&quot;: &quot;Smartphone X - 128GB&quot;, &quot;remark&quot;: &quot;This latest Smartphone X comes with a powerful processor and high-resolution camera.&quot;, &quot;address&quot;: &quot;å¹¿å·å¤©æ²³å…¬å›­&quot;, &quot;tags&quot;: [&quot;latest&quot;, &quot;smartphone&quot;, &quot;technology&quot;], &quot;created_at&quot;: &quot;2025-04-22 03:30:02&quot; &#125;</span></span><br><span class=\"line\"><span class=\"string\">&#123; &quot;index&quot;: &#123; &quot;_index&quot;: &quot;shopping&quot;, &quot;_id&quot;: &quot;2&quot; &#125; &#125;</span></span><br><span class=\"line\"><span class=\"string\">&#123; &quot;category&quot;: &quot;fashion&quot;, &quot;price&quot;: 49.99, &quot;count&quot;: 25, &quot;title&quot;: &quot;Designer T-shirt&quot;, &quot;remark&quot;: &quot;Trendy designer T-shirt made with high quality fabric.&quot;, &quot;address&quot;: &quot;å¹¿å·è”æ¹¾å¤§å¦&quot;, &quot;tags&quot;: [&quot;clothing&quot;, &quot;designer&quot;, &quot;style&quot;], &quot;created_at&quot;: &quot;2025-04-21 12:15:00&quot; &#125;</span></span><br><span class=\"line\"><span class=\"string\">&#123; &quot;index&quot;: &#123; &quot;_index&quot;: &quot;shopping&quot;, &quot;_id&quot;: &quot;3&quot; &#125; &#125;</span></span><br><span class=\"line\"><span class=\"string\">&#123; &quot;category&quot;: &quot;home_appliances&quot;, &quot;price&quot;: 299.99, &quot;count&quot;: 5, &quot;title&quot;: &quot;Robot Vacuum Cleaner&quot;, &quot;remark&quot;: &quot;Efficient robot vacuum cleaner with smart navigation.&quot;, &quot;address&quot;: &quot;å¹¿å·ç™½äº‘å±±å…¬å›­&quot;, &quot;tags&quot;: [&quot;appliances&quot;, &quot;vacuum&quot;, &quot;robot&quot;], &quot;created_at&quot;: &quot;2025-04-20 08:45:30&quot; &#125;</span></span><br><span class=\"line\"><span class=\"string\">&#123; &quot;index&quot;: &#123; &quot;_index&quot;: &quot;shopping&quot;, &quot;_id&quot;: &quot;4&quot; &#125; &#125;</span></span><br><span class=\"line\"><span class=\"string\">&#123; &quot;category&quot;: &quot;books&quot;, &quot;price&quot;: 19.99, &quot;count&quot;: 100, &quot;title&quot;: &quot;Inspirational Novel&quot;, &quot;remark&quot;: &quot;A gripping novel that inspires and motivates.&quot;, &quot;address&quot;: &quot;321 Book Rd, Shenzhen, China&quot;, &quot;tags&quot;: [&quot;book&quot;, &quot;novel&quot;, &quot;inspiration&quot;], &quot;created_at&quot;: &quot;2025-04-19 10:05:00&quot; &#125;</span></span><br><span class=\"line\"><span class=\"string\">&#123; &quot;index&quot;: &#123; &quot;_index&quot;: &quot;shopping&quot;, &quot;_id&quot;: &quot;5&quot; &#125; &#125;</span></span><br><span class=\"line\"><span class=\"string\">&#123; &quot;category&quot;: &quot;groceries&quot;, &quot;price&quot;: 3.99, &quot;count&quot;: 200, &quot;title&quot;: &quot;Organic Apples&quot;, &quot;remark&quot;: &quot;Fresh and crispy organic apples.&quot;, &quot;address&quot;: &quot;654 Grocery Ln, Chengdu, China&quot;, &quot;tags&quot;: [&quot;fruit&quot;, &quot;organic&quot;, &quot;healthy&quot;], &quot;created_at&quot;: &quot;2025-04-18 14:30:45&quot; &#125;</span></span><br><span class=\"line\"><span class=\"string\">&#123; &quot;index&quot;: &#123; &quot;_index&quot;: &quot;shopping&quot;, &quot;_id&quot;: &quot;6&quot; &#125; &#125;</span></span><br><span class=\"line\"><span class=\"string\">&#123; &quot;category&quot;: &quot;electronics&quot;, &quot;price&quot;: 1999.99, &quot;count&quot;: 15, &quot;title&quot;: &quot;Smartphone X - 256GB&quot;, &quot;remark&quot;: &quot;This latest Smartphone X comes with a powerful processor and high-resolution camera.&quot;, &quot;address&quot;: &quot;å¹¿å·å¤©æ²³å…¬å›­&quot;, &quot;tags&quot;: [&quot;latest&quot;, &quot;smartphone&quot;, &quot;technology&quot;], &quot;created_at&quot;: &quot;2025-04-22 03:30:02&quot; &#125;</span></span><br><span class=\"line\"><span class=\"string\">&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"># å‚æ•°è¯´æ˜</span></span><br><span class=\"line\"><span class=\"comment\"># index: ç”¨äºåˆ›å»ºæ–°æ–‡æ¡£æˆ–æ›¿æ¢å·²æœ‰æ–‡æ¡£ã€‚</span></span><br><span class=\"line\"><span class=\"comment\"># create: ç”¨äºåˆ›å»ºæ–°æ–‡æ¡£ï¼Œå¦‚æœæ–‡æ¡£å·²å­˜åœ¨ï¼Œåˆ™è¿”å›é”™è¯¯ã€‚</span></span><br><span class=\"line\"><span class=\"comment\"># _index: æŒ‡å®šç´¢å¼•åç§°ã€‚</span></span><br><span class=\"line\"><span class=\"comment\"># _id: æŒ‡å®šæ–‡æ¡£IDã€‚å¦‚æœä¸æŒ‡å®šåˆ™ä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªéšæœºçš„IDã€‚</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ‰¹é‡æ–°å¢æ•°æ®æ—¶ä¹Ÿå¯ä»¥åœ¨urlä¸­æŒ‡å®šç´¢å¼•åç§°</span></span><br><span class=\"line\"><span class=\"comment\"># æ­¤æ—¶å¯ä»¥æŒ‡å®šidï¼Œå¦‚æœä¸æŒ‡å®šåˆ™è‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªéšæœºå­—ç¬¦ä¸²çš„ID</span></span><br><span class=\"line\"><span class=\"comment\"># POST /&lt;target&gt;/_bulk</span></span><br><span class=\"line\">curl -X POST -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/shopping/_bulk&#x27;</span> \\</span><br><span class=\"line\">  -H <span class=\"string\">&#x27;Content-Type: application/json&#x27;</span> \\</span><br><span class=\"line\">  -d <span class=\"string\">&#x27;&#123; &quot;index&quot;: &#123;&#125; &#125;</span></span><br><span class=\"line\"><span class=\"string\">&#123; &quot;category&quot;: &quot;electronics&quot;, &quot;price&quot;: 999.99, &quot;count&quot;: 10, &quot;title&quot;: &quot;Smartphone X - 128GB&quot;, &quot;remark&quot;: &quot;This latest Smartphone X comes with a powerful processor and high-resolution camera.&quot;, &quot;address&quot;: &quot;å¹¿å·å¤©æ²³å…¬å›­&quot;, &quot;tags&quot;: [&quot;latest&quot;, &quot;smartphone&quot;, &quot;technology&quot;], &quot;created_at&quot;: &quot;2025-04-22 03:30:02&quot; &#125;</span></span><br><span class=\"line\"><span class=\"string\">&#123; &quot;index&quot;: &#123;&#125; &#125;</span></span><br><span class=\"line\"><span class=\"string\">&#123; &quot;category&quot;: &quot;fashion&quot;, &quot;price&quot;: 49.99, &quot;count&quot;: 25, &quot;title&quot;: &quot;Designer T-shirt&quot;, &quot;remark&quot;: &quot;Trendy designer T-shirt made with high quality fabric.&quot;, &quot;address&quot;: &quot;å¹¿å·è”æ¹¾å¤§å¦&quot;, &quot;tags&quot;: [&quot;clothing&quot;, &quot;designer&quot;, &quot;style&quot;], &quot;created_at&quot;: &quot;2025-04-21 12:15:00&quot; &#125;</span></span><br><span class=\"line\"><span class=\"string\">&#123; &quot;index&quot;: &#123;&#125; &#125;</span></span><br><span class=\"line\"><span class=\"string\">&#123; &quot;category&quot;: &quot;home_appliances&quot;, &quot;price&quot;: 299.99, &quot;count&quot;: 5, &quot;title&quot;: &quot;Robot Vacuum Cleaner&quot;, &quot;remark&quot;: &quot;Efficient robot vacuum cleaner with smart navigation.&quot;, &quot;address&quot;: &quot;å¹¿å·ç™½äº‘å±±å…¬å›­&quot;, &quot;tags&quot;: [&quot;appliances&quot;, &quot;vacuum&quot;, &quot;robot&quot;], &quot;created_at&quot;: &quot;2025-04-20 08:45:30&quot; &#125;</span></span><br><span class=\"line\"><span class=\"string\">&#123; &quot;index&quot;: &#123;&#125; &#125;</span></span><br><span class=\"line\"><span class=\"string\">&#123; &quot;category&quot;: &quot;books&quot;, &quot;price&quot;: 19.99, &quot;count&quot;: 100, &quot;title&quot;: &quot;Inspirational Novel&quot;, &quot;remark&quot;: &quot;A gripping novel that inspires and motivates.&quot;, &quot;address&quot;: &quot;321 Book Rd, Shenzhen, China&quot;, &quot;tags&quot;: [&quot;book&quot;, &quot;novel&quot;, &quot;inspiration&quot;], &quot;created_at&quot;: &quot;2025-04-19 10:05:00&quot; &#125;</span></span><br><span class=\"line\"><span class=\"string\">&#123; &quot;index&quot;: &#123;&#125; &#125;</span></span><br><span class=\"line\"><span class=\"string\">&#123; &quot;category&quot;: &quot;groceries&quot;, &quot;price&quot;: 3.99, &quot;count&quot;: 200, &quot;title&quot;: &quot;Organic Apples&quot;, &quot;remark&quot;: &quot;Fresh and crispy organic apples.&quot;, &quot;address&quot;: &quot;654 Grocery Ln, Chengdu, China&quot;, &quot;tags&quot;: [&quot;fruit&quot;, &quot;organic&quot;, &quot;healthy&quot;], &quot;created_at&quot;: &quot;2025-04-18 14:30:45&quot; &#125;</span></span><br><span class=\"line\"><span class=\"string\">&#123; &quot;index&quot;: &#123;&#125; &#125;</span></span><br><span class=\"line\"><span class=\"string\">&#123; &quot;category&quot;: &quot;electronics&quot;, &quot;price&quot;: 1999.99, &quot;count&quot;: 15, &quot;title&quot;: &quot;Smartphone X - 256GB&quot;, &quot;remark&quot;: &quot;This latest Smartphone X comes with a powerful processor and high-resolution camera.&quot;, &quot;address&quot;: &quot;å¹¿å·å¤©æ²³å…¬å›­&quot;, &quot;tags&quot;: [&quot;latest&quot;, &quot;smartphone&quot;, &quot;technology&quot;], &quot;created_at&quot;: &quot;2025-04-22 03:30:02&quot; &#125;</span></span><br><span class=\"line\"><span class=\"string\">&#x27;</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ‰¹é‡ä¿®æ”¹æ•°æ®</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æ³¨æ„æ•°æ®è¡Œè¦é¡¶è¡Œå†™ï¼Œå‰é¢ä¸è¦æœ‰ç©ºæ ¼</span></span><br><span class=\"line\">curl -X POST -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/_bulk&#x27;</span> \\</span><br><span class=\"line\">  -H <span class=\"string\">&#x27;Content-Type: application/json&#x27;</span> \\</span><br><span class=\"line\">  -d <span class=\"string\">&#x27;&#123;&quot;update&quot;:&#123;&quot;_index&quot;:&quot;shopping&quot;,&quot;_id&quot;:&quot;1&quot;&#125;&#125;</span></span><br><span class=\"line\"><span class=\"string\">&#123;&quot;doc&quot;:&#123;&quot;title&quot;:&quot;Smartphone X2 - 128GB&quot;,&quot;price&quot;:1000.11&#125;&#125;</span></span><br><span class=\"line\"><span class=\"string\">&#123;&quot;update&quot;:&#123;&quot;_index&quot;:&quot;shopping&quot;,&quot;_id&quot;:&quot;2&quot;&#125;&#125;</span></span><br><span class=\"line\"><span class=\"string\">&#123;&quot;doc&quot;:&#123;&quot;title&quot;:&quot;T-shirt&quot;,&quot;price&quot;:45.99&#125;&#125;</span></span><br><span class=\"line\"><span class=\"string\">&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"># å‚æ•°è¯´æ˜</span></span><br><span class=\"line\"><span class=\"comment\"># update: ç”¨äºæ›´æ–°æ–‡æ¡£ã€‚</span></span><br><span class=\"line\"><span class=\"comment\"># doc: æŒ‡å®šè¦æ›´æ–°çš„å­—æ®µã€‚</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ‰¹é‡åˆ é™¤æ•°æ®</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æ³¨æ„æ•°æ®è¡Œè¦é¡¶è¡Œå†™ï¼Œå‰é¢ä¸è¦æœ‰ç©ºæ ¼</span></span><br><span class=\"line\">curl -X POST -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/_bulk&#x27;</span> \\</span><br><span class=\"line\">  -H <span class=\"string\">&#x27;Content-Type: application/json&#x27;</span> \\</span><br><span class=\"line\">  -d <span class=\"string\">&#x27;&#123;&quot;delete&quot;:&#123;&quot;_index&quot;:&quot;shopping&quot;,&quot;_id&quot;:&quot;1&quot;&#125;&#125;</span></span><br><span class=\"line\"><span class=\"string\">&#123;&quot;delete&quot;:&#123;&quot;_index&quot;:&quot;shopping&quot;,&quot;_id&quot;:&quot;2&quot;&#125;&#125;</span></span><br><span class=\"line\"><span class=\"string\">&#123;&quot;delete&quot;:&#123;&quot;_index&quot;:&quot;shopping&quot;,&quot;_id&quot;:&quot;3&quot;&#125;&#125;</span></span><br><span class=\"line\"><span class=\"string\">&#123;&quot;delete&quot;:&#123;&quot;_index&quot;:&quot;shopping&quot;,&quot;_id&quot;:&quot;4&quot;&#125;&#125;</span></span><br><span class=\"line\"><span class=\"string\">&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"># å‚æ•°è¯´æ˜</span></span><br><span class=\"line\"><span class=\"comment\"># delete: ç”¨äºåˆ é™¤æ–‡æ¡£ã€‚</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"æ¡ä»¶æ›´æ–°\">æ¡ä»¶æ›´æ–°</h2>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># POST /&lt;target&gt;/_update_by_query</span></span><br><span class=\"line\"><span class=\"comment\"># è¿™é‡Œå°†categoryä¸ºåä¸ºçš„æ•°æ®ä»·æ ¼æ”¹ä¸º1999</span></span><br><span class=\"line\">curl -X POST -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/shopping/_update_by_query?pretty&#x27;</span> \\</span><br><span class=\"line\">  -H <span class=\"string\">&#x27;Content-Type: application/json&#x27;</span> \\</span><br><span class=\"line\">  -d <span class=\"string\">&#x27;&#123;</span></span><br><span class=\"line\"><span class=\"string\">    &quot;query&quot;: &#123;</span></span><br><span class=\"line\"><span class=\"string\">      &quot;match&quot;: &#123;</span></span><br><span class=\"line\"><span class=\"string\">        &quot;category&quot;: &quot;books&quot;</span></span><br><span class=\"line\"><span class=\"string\">      &#125;</span></span><br><span class=\"line\"><span class=\"string\">    &#125;,</span></span><br><span class=\"line\"><span class=\"string\">    &quot;script&quot;: &#123;</span></span><br><span class=\"line\"><span class=\"string\">      &quot;source&quot;: &quot;ctx._source.price = 20.99&quot;,</span></span><br><span class=\"line\"><span class=\"string\">      &quot;lang&quot;: &quot;painless&quot;</span></span><br><span class=\"line\"><span class=\"string\">    &#125;</span></span><br><span class=\"line\"><span class=\"string\">  &#125;&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"># å‚æ•°è¯´æ˜</span></span><br><span class=\"line\"><span class=\"comment\">## &quot;query&quot;: &#123;&#125;  æŸ¥è¯¢æ¡ä»¶</span></span><br><span class=\"line\"><span class=\"comment\">## &quot;script&quot;: &#123;&#125;  è„šæœ¬</span></span><br><span class=\"line\"><span class=\"comment\">### source: è„šæœ¬å†…å®¹</span></span><br><span class=\"line\"><span class=\"comment\">### lang: è„šæœ¬è¯­è¨€</span></span><br><span class=\"line\"><span class=\"comment\">#### painless æ˜¯ Elasticsearch å®˜æ–¹æä¾›çš„è„šæœ¬è¯­è¨€ï¼Œå®ƒæä¾›äº†è®¸å¤šå†…ç½®å‡½æ•°å’Œå˜é‡ï¼Œå¯ä»¥æ–¹ä¾¿åœ°å®ç°å„ç§å¤æ‚çš„é€»è¾‘æ“ä½œã€‚https://www.elastic.co/guide/en/elasticsearch/painless/current/painless-lang-spec.html</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"æ¡ä»¶åˆ é™¤\">æ¡ä»¶åˆ é™¤</h2>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># POST /&lt;target&gt;/_delete_by_query</span></span><br><span class=\"line\">curl -X POST -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/shopping/_delete_by_query?pretty&#x27;</span> \\</span><br><span class=\"line\">  -H <span class=\"string\">&#x27;Content-Type: application/json&#x27;</span> \\</span><br><span class=\"line\">  -d <span class=\"string\">&#x27;&#123;&quot;query&quot;:&#123;&quot;match&quot;:&#123;&quot;category&quot;:&quot;books&quot;&#125;&#125;&#125;&#x27;</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"æ¡ä»¶æŸ¥è¯¢\">æ¡ä»¶æŸ¥è¯¢</h2>\n<h3 id=\"match-all-å…¨éƒ¨åŒ¹é…æŸ¥è¯¢\">match_all: å…¨éƒ¨åŒ¹é…æŸ¥è¯¢</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># GET /&lt;target&gt;/_search</span></span><br><span class=\"line\">curl -X GET -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27;</span></span><br><span class=\"line\">  -H <span class=\"string\">&#x27;Content-Type: application/json&#x27;</span> \\</span><br><span class=\"line\">  -d <span class=\"string\">&#x27;&#123;&quot;query&quot;:&#123;&quot;match_all&quot;:&#123;&#125;&#125;&#125;&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æˆ–è€…ç®€å†™ä¸º</span></span><br><span class=\"line\">curl -X GET -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"term-ç²¾ç¡®åŒ¹é…æŸ¥è¯¢ï¼ˆå…³é”®å­—æŸ¥è¯¢ï¼Œå³ä¸åˆ†è¯ï¼‰\">term: ç²¾ç¡®åŒ¹é…æŸ¥è¯¢ï¼ˆå…³é”®å­—æŸ¥è¯¢ï¼Œå³ä¸åˆ†è¯ï¼‰</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -X GET -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27;</span> \\</span><br><span class=\"line\">  -H <span class=\"string\">&#x27;Content-Type: application/json&#x27;</span> \\</span><br><span class=\"line\">  -d <span class=\"string\">&#x27;&#123;&quot;query&quot;:&#123;&quot;term&quot;:&#123;&quot;category&quot;:&quot;electronics&quot;&#125;&#125;&#125;&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å¦‚æœå­—æ®µè¢«é¢å¤–è®¾ç½® keyword ç±»å‹ï¼Œåˆ™éœ€è¦åŠ ä¸Š .keyword åç¼€</span></span><br><span class=\"line\">curl -X GET -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27;</span> \\</span><br><span class=\"line\">  -H <span class=\"string\">&#x27;Content-Type: application/json&#x27;</span> \\</span><br><span class=\"line\">  -d <span class=\"string\">&#x27;&#123;&quot;query&quot;:&#123;&quot;term&quot;:&#123;&quot;address.keyword&quot;:&quot;å¹¿å·ç™½äº‘å±±å…¬å›­&quot;&#125;&#125;&#125;&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># termå¤„ç†å¤šå€¼å­—æ®µ(æ•°ç»„)æ—¶ï¼ŒtermæŸ¥è¯¢æ˜¯åŒ…å«ï¼Œä¸æ˜¯ç­‰äº</span></span><br><span class=\"line\">curl -X GET -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27;</span> \\</span><br><span class=\"line\">  -H <span class=\"string\">&#x27;Content-Type: application/json&#x27;</span> \\</span><br><span class=\"line\">  -d <span class=\"string\">&#x27;&#123;&quot;query&quot;:&#123;&quot;term&quot;:&#123;&quot;tags&quot;:&quot;technology&quot;&#125;&#125;&#125;&#x27;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"terms-å¤šå…³é”®å­—ç²¾ç¡®åŒ¹é…æŸ¥è¯¢\">terms: å¤šå…³é”®å­—ç²¾ç¡®åŒ¹é…æŸ¥è¯¢</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -X GET -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27;</span> \\</span><br><span class=\"line\">  -H <span class=\"string\">&#x27;Content-Type: application/json&#x27;</span> \\</span><br><span class=\"line\">  -d <span class=\"string\">&#x27;&#123;&quot;query&quot;:&#123;&quot;terms&quot;:&#123;&quot;category&quot;:[&quot;electronics&quot;,&quot;books&quot;]&#125;&#125;&#125;&#x27;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"range-èŒƒå›´æŸ¥è¯¢\">range: èŒƒå›´æŸ¥è¯¢</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -X GET -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27;</span> \\</span><br><span class=\"line\">  -H <span class=\"string\">&#x27;Content-Type: application/json&#x27;</span> \\</span><br><span class=\"line\">  -d <span class=\"string\">&#x27;&#123;&quot;query&quot;:&#123;&quot;range&quot;:&#123;&quot;price&quot;:&#123;&quot;gte&quot;:20,&quot;lte&quot;:30&#125;&#125;&#125;&#125;&#x27;</span></span><br><span class=\"line\">  <span class=\"comment\"># gte: å¤§äºç­‰äº</span></span><br><span class=\"line\">  <span class=\"comment\"># lte: å°äºç­‰äº</span></span><br><span class=\"line\">  <span class=\"comment\"># gt: å¤§äº</span></span><br><span class=\"line\">  <span class=\"comment\"># lt: å°äº</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ—¶é—´èŒƒå›´æŸ¥è¯¢</span></span><br><span class=\"line\">curl -X GET -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27;</span> \\</span><br><span class=\"line\">  -H <span class=\"string\">&#x27;Content-Type: application/json&#x27;</span> \\</span><br><span class=\"line\">  -d <span class=\"string\">&#x27;&#123;&quot;query&quot;:&#123;&quot;range&quot;:&#123;&quot;created_at&quot;:&#123;&quot;gte&quot;:&quot;2025-04-20 00:00:00&quot;,&quot;lte&quot;:&quot;2025-05-20 23:59:59&quot;&#125;&#125;&#125;&#125;&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åŸºäºæ—¥æœŸæ•°å­¦è¡¨è¾¾å¼æŸ¥è¯¢</span></span><br><span class=\"line\">curl -X GET -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27;</span> \\</span><br><span class=\"line\">  -H <span class=\"string\">&#x27;Content-Type: application/json&#x27;</span> \\</span><br><span class=\"line\">  -d <span class=\"string\">&#x27;&#123;&quot;query&quot;:&#123;&quot;range&quot;:&#123;&quot;created_at&quot;:&#123;&quot;gte&quot;:&quot;now-1y&quot;&#125;&#125;&#125;&#125;&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ”¯æŒçš„æ—¥æœŸè¡¨è¾¾å¼</span></span><br><span class=\"line\"><span class=\"comment\"># - nowï¼šå½“å‰æ—¶é—´ç‚¹ã€‚</span></span><br><span class=\"line\"><span class=\"comment\"># - now-1dï¼šä»å½“å‰æ—¶é—´ç‚¹å‘å‰æ¨1å¤©çš„æ—¶é—´ç‚¹ã€‚</span></span><br><span class=\"line\"><span class=\"comment\"># - now-1wï¼šä»å½“å‰æ—¶é—´ç‚¹å‘å‰æ¨1å‘¨çš„æ—¶é—´ç‚¹ã€‚</span></span><br><span class=\"line\"><span class=\"comment\"># - now-1Mï¼šä»å½“å‰æ—¶é—´ç‚¹å‘å‰æ¨1ä¸ªæœˆçš„æ—¶é—´ç‚¹ã€‚</span></span><br><span class=\"line\"><span class=\"comment\"># - now-1yï¼šä»å½“å‰æ—¶é—´ç‚¹å‘å‰æ¨1å¹´çš„æ—¶é—´ç‚¹ã€‚</span></span><br><span class=\"line\"><span class=\"comment\"># - now+1hï¼šä»å½“å‰æ—¶é—´ç‚¹å‘åæ¨1å°æ—¶çš„æ—¶é—´ç‚¹ã€‚</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"exists-æŸ¥è¯¢å­—æ®µå­˜åœ¨çš„æ•°æ®\">exists: æŸ¥è¯¢å­—æ®µå­˜åœ¨çš„æ•°æ®</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -X GET -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27;</span> \\</span><br><span class=\"line\">  -H <span class=\"string\">&#x27;Content-Type: application/json&#x27;</span> \\</span><br><span class=\"line\">  -d <span class=\"string\">&#x27;&#123;&quot;query&quot;:&#123;&quot;exists&quot;:&#123;&quot;field&quot;:&quot;title&quot;&#125;&#125;&#125;&#x27;</span></span><br><span class=\"line\">  <span class=\"comment\"># field: æŒ‡å®šè¦æŸ¥è¯¢çš„å­—æ®µ</span></span><br><span class=\"line\">  <span class=\"comment\"># ç¤ºä¾‹ï¼šæŸ¥è¯¢ title å­—æ®µå­˜åœ¨çš„æ–‡æ¡£</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"ids-æ ¹æ®ä¸€ç»„IDæŸ¥è¯¢\">ids: æ ¹æ®ä¸€ç»„IDæŸ¥è¯¢</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -X GET -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27;</span> \\</span><br><span class=\"line\">  -H <span class=\"string\">&#x27;Content-Type: application/json&#x27;</span> \\</span><br><span class=\"line\">  -d <span class=\"string\">&#x27;&#123;&quot;query&quot;:&#123;&quot;ids&quot;:&#123;&quot;values&quot;:[&quot;1&quot;,&quot;2&quot;]&#125;&#125;&#125;&#x27;</span></span><br><span class=\"line\">  <span class=\"comment\"># values: æŒ‡å®šè¦æŸ¥è¯¢çš„IDåˆ—è¡¨</span></span><br><span class=\"line\">  <span class=\"comment\"># ç¤ºä¾‹ï¼šæŸ¥è¯¢IDä¸º1å’Œ2çš„æ–‡æ¡£</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"prefix-å‰ç¼€æŸ¥è¯¢\">prefix: å‰ç¼€æŸ¥è¯¢</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä»…é€‚ç”¨äºå…³é”®å­—ç±»å‹(keyword)çš„å­—æ®µ</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -X GET -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27;</span> \\</span><br><span class=\"line\">  -H <span class=\"string\">&#x27;Content-Type: application/json&#x27;</span> \\</span><br><span class=\"line\">  -d <span class=\"string\">&#x27;&#123;&quot;query&quot;:&#123;&quot;prefix&quot;:&#123;&quot;category&quot;:&quot;elec&quot;&#125;&#125;&#125;&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ä»…é€‚ç”¨äºkeywordç±»å‹å­—æ®µï¼Œæ‰€ä»¥ä¸‹é¢è¿™ä¸ªè¯·æ±‚æŸ¥è¯¢ä¸åˆ°æ•°æ®</span></span><br><span class=\"line\">curl -X GET -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27;</span> \\</span><br><span class=\"line\">  -H <span class=\"string\">&#x27;Content-Type: application/json&#x27;</span> \\</span><br><span class=\"line\">  -d <span class=\"string\">&#x27;&#123;&quot;query&quot;:&#123;&quot;prefix&quot;:&#123;&quot;address&quot;:&quot;å¹¿å·ç™½äº‘å±±&quot;&#125;&#125;&#125;&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"># å› ä¸ºaddressè¢«é™„åŠ äº†keywordç±»å‹ï¼Œæ‰€ä»¥éœ€è¦åŠ ä¸Š.keywordåç¼€åå¯ä»¥æŸ¥è¯¢åˆ°æ•°æ®</span></span><br><span class=\"line\">curl -X GET -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27;</span> \\</span><br><span class=\"line\">  -H <span class=\"string\">&#x27;Content-Type: application/json&#x27;</span> \\</span><br><span class=\"line\">  -d <span class=\"string\">&#x27;&#123;&quot;query&quot;:&#123;&quot;prefix&quot;:&#123;&quot;address.keyword&quot;:&quot;å¹¿å·ç™½äº‘å±±&quot;&#125;&#125;&#125;&#x27;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"wildcard-é€šé…ç¬¦æŸ¥è¯¢\">wildcard: é€šé…ç¬¦æŸ¥è¯¢</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä»…é€‚ç”¨äºå…³é”®å­—ç±»å‹(keyword)çš„å­—æ®µ</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -X GET -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27;</span> \\</span><br><span class=\"line\">  -H <span class=\"string\">&#x27;Content-Type: application/json&#x27;</span> \\</span><br><span class=\"line\">  -d <span class=\"string\">&#x27;&#123;&quot;query&quot;:&#123;&quot;wildcard&quot;:&#123;&quot;category&quot;:&quot;e?e*&quot;&#125;&#125;&#125;&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"># ?: ä»»æ„å•ä¸ªå­—ç¬¦</span></span><br><span class=\"line\"><span class=\"comment\"># *: ä»»æ„å¤šä¸ªå­—ç¬¦</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"regexp-æ­£åˆ™è¡¨è¾¾å¼æŸ¥è¯¢\">regexp: æ­£åˆ™è¡¨è¾¾å¼æŸ¥è¯¢</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä»…é€‚ç”¨äºå…³é”®å­—ç±»å‹(keyword)çš„å­—æ®µ</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -X GET -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27;</span> \\</span><br><span class=\"line\">  -H <span class=\"string\">&#x27;Content-Type: application/json&#x27;</span> \\</span><br><span class=\"line\">  -d <span class=\"string\">&#x27;&#123;&quot;query&quot;:&#123;&quot;regexp&quot;:&#123;&quot;category&quot;:&quot;e.e.*&quot;&#125;&#125;&#125;&#x27;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"fuzzy-æ”¯æŒç¼–è¾‘è·ç¦»çš„æ¨¡ç³ŠæŸ¥è¯¢\">fuzzy: æ”¯æŒç¼–è¾‘è·ç¦»çš„æ¨¡ç³ŠæŸ¥è¯¢</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä»…é€‚ç”¨äºå…³é”®å­—ç±»å‹(keyword)çš„å­—æ®µ</p>\n</li>\n<li class=\"lvl-2\">\n<p>fuzzyæ£€ç´¢æ˜¯ä¸€ç§å¼ºå¤§çš„æœç´¢åŠŸèƒ½ï¼Œå®ƒèƒ½å¤Ÿåœ¨ç”¨æˆ·è¾“å…¥å†…å®¹å­˜åœ¨æ‹¼å†™é”™è¯¯æˆ–ä¸Šä¸‹æ–‡ä¸ä¸€è‡´æ—¶ï¼Œä»ç„¶è¿”å›ä¸æœç´¢è¯ç›¸ä¼¼çš„æ–‡æ¡£ã€‚é€šè¿‡ä½¿ç”¨ç¼–è¾‘è·ç¦»ç®—æ³•æ¥åº¦é‡è¾“å…¥è¯ä¸æ–‡æ¡£ä¸­è¯æ¡çš„ç›¸ä¼¼ç¨‹åº¦ï¼Œæ¨¡ç³ŠæŸ¥è¯¢åœ¨ä¿è¯æœç´¢ç»“æœç›¸å…³æ€§çš„åŒæ—¶ï¼Œæœ‰æ•ˆåœ°æé«˜äº†æœç´¢å®¹é”™èƒ½åŠ›ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ç¼–è¾‘è·ç¦»æ˜¯æŒ‡ä»ä¸€ä¸ªå•è¯è½¬æ¢åˆ°å¦ä¸€ä¸ªå•è¯éœ€è¦ç¼–è¾‘å•å­—ç¬¦çš„æ¬¡æ•°ã€‚å¦‚ä¸­æ–‡é›†å›¢åˆ°ä¸­å¨é›†å›¢ç¼–è¾‘è·ç¦»å°±æ˜¯1ï¼Œåªéœ€è¦ä¿®æ”¹ä¸€ä¸ªå­—ç¬¦ï¼›å¦‚æœfuzzinesså€¼åœ¨è¿™é‡Œè®¾ç½®æˆ2ï¼Œä¼šæŠŠç¼–è¾‘è·ç¦»ä¸º2çš„ä¸œä¸œé›†å›¢ä¹ŸæŸ¥å‡ºæ¥ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -X GET -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27;</span> \\</span><br><span class=\"line\">  -H <span class=\"string\">&#x27;Content-Type: application/json&#x27;</span> \\</span><br><span class=\"line\">  -d <span class=\"string\">&#x27;&#123;</span></span><br><span class=\"line\"><span class=\"string\">      &quot;query&quot;:&#123;</span></span><br><span class=\"line\"><span class=\"string\">        &quot;fuzzy&quot;:&#123;</span></span><br><span class=\"line\"><span class=\"string\">          &quot;category&quot;:&#123;</span></span><br><span class=\"line\"><span class=\"string\">            &quot;value&quot;:&quot;beeks&quot;,</span></span><br><span class=\"line\"><span class=\"string\">            &quot;fuzziness&quot;:&quot;2&quot;,</span></span><br><span class=\"line\"><span class=\"string\">            &quot;prefix_length&quot;:1</span></span><br><span class=\"line\"><span class=\"string\">          &#125;</span></span><br><span class=\"line\"><span class=\"string\">        &#125;</span></span><br><span class=\"line\"><span class=\"string\">      &#125;</span></span><br><span class=\"line\"><span class=\"string\">    &#125;&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"># fuzzinessï¼šç”¨äºç¼–è¾‘è·ç¦»çš„è®¾ç½®ï¼Œå…¶é»˜è®¤å€¼ä¸ºAUTOï¼Œæ”¯æŒçš„æ•°å€¼ä¸º[0ï¼Œ1ï¼Œ2]ã€‚å¦‚æœå€¼è®¾ç½®è¶Šç•Œä¼šæŠ¥é”™ã€‚</span></span><br><span class=\"line\"><span class=\"comment\"># prefix_length: æœç´¢è¯çš„å‰ç¼€é•¿åº¦ï¼Œåœ¨æ­¤é•¿åº¦å†…ä¸ä¼šåº”ç”¨æ¨¡ç³ŠåŒ¹é…ã€‚é»˜è®¤æ˜¯0ï¼Œå³æ•´ä¸ªè¯éƒ½ä¼šè¢«æ¨¡ç³ŠåŒ¹é…ã€‚</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"match-å…¨æ–‡æ£€ç´¢-å³åˆ†è¯\">match: å…¨æ–‡æ£€ç´¢(å³åˆ†è¯)</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -X GET -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27;</span> \\</span><br><span class=\"line\">  -H <span class=\"string\">&#x27;Content-Type: application/json&#x27;</span> \\</span><br><span class=\"line\">  -d <span class=\"string\">&#x27;&#123;&quot;query&quot;:&#123;&quot;match&quot;:&#123;&quot;address&quot;:&quot;å¹¿å·ç™½äº‘å±±å…¬å›­&quot;&#125;&#125;&#125;&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å› ä¸º desc çš„ç´¢å¼•åˆ†è¯å™¨æ˜¯ ik_max_wordï¼ŒæŸ¥çœ‹â€œå¹¿å·ç™½äº‘å±±å…¬å›­â€è¢«åˆ†è¯åçš„ç»“æœ</span></span><br><span class=\"line\">curl -X GET -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/_analyze?pretty&#x27;</span> \\</span><br><span class=\"line\">  -H <span class=\"string\">&#x27;Content-Type: application/json&#x27;</span> \\</span><br><span class=\"line\">  -d <span class=\"string\">&#x27;&#123;</span></span><br><span class=\"line\"><span class=\"string\">        &quot;analyzer&quot;: &quot;ik_max_word&quot;,</span></span><br><span class=\"line\"><span class=\"string\">        &quot;text&quot;: &quot;å¹¿å·ç™½äº‘å±±å…¬å›­&quot;</span></span><br><span class=\"line\"><span class=\"string\">    &#125;&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"># è¿”å›å€¼</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">&quot;tokens&quot;</span> : [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      <span class=\"string\">&quot;token&quot;</span> : <span class=\"string\">&quot;å¹¿å·&quot;</span>,</span><br><span class=\"line\">      <span class=\"string\">&quot;start_offset&quot;</span> : 0,</span><br><span class=\"line\">      <span class=\"string\">&quot;end_offset&quot;</span> : 2,</span><br><span class=\"line\">      <span class=\"string\">&quot;type&quot;</span> : <span class=\"string\">&quot;CN_WORD&quot;</span>,</span><br><span class=\"line\">      <span class=\"string\">&quot;position&quot;</span> : 0</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      <span class=\"string\">&quot;token&quot;</span> : <span class=\"string\">&quot;ç™½äº‘å±±&quot;</span>,</span><br><span class=\"line\">      <span class=\"string\">&quot;start_offset&quot;</span> : 2,</span><br><span class=\"line\">      <span class=\"string\">&quot;end_offset&quot;</span> : 5,</span><br><span class=\"line\">      <span class=\"string\">&quot;type&quot;</span> : <span class=\"string\">&quot;CN_WORD&quot;</span>,</span><br><span class=\"line\">      <span class=\"string\">&quot;position&quot;</span> : 1</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      <span class=\"string\">&quot;token&quot;</span> : <span class=\"string\">&quot;ç™½äº‘&quot;</span>,</span><br><span class=\"line\">      <span class=\"string\">&quot;start_offset&quot;</span> : 2,</span><br><span class=\"line\">      <span class=\"string\">&quot;end_offset&quot;</span> : 4,</span><br><span class=\"line\">      <span class=\"string\">&quot;type&quot;</span> : <span class=\"string\">&quot;CN_WORD&quot;</span>,</span><br><span class=\"line\">      <span class=\"string\">&quot;position&quot;</span> : 2</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      <span class=\"string\">&quot;token&quot;</span> : <span class=\"string\">&quot;äº‘å±±&quot;</span>,</span><br><span class=\"line\">      <span class=\"string\">&quot;start_offset&quot;</span> : 3,</span><br><span class=\"line\">      <span class=\"string\">&quot;end_offset&quot;</span> : 5,</span><br><span class=\"line\">      <span class=\"string\">&quot;type&quot;</span> : <span class=\"string\">&quot;CN_WORD&quot;</span>,</span><br><span class=\"line\">      <span class=\"string\">&quot;position&quot;</span> : 3</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      <span class=\"string\">&quot;token&quot;</span> : <span class=\"string\">&quot;å…¬å›­&quot;</span>,</span><br><span class=\"line\">      <span class=\"string\">&quot;start_offset&quot;</span> : 5,</span><br><span class=\"line\">      <span class=\"string\">&quot;end_offset&quot;</span> : 7,</span><br><span class=\"line\">      <span class=\"string\">&quot;type&quot;</span> : <span class=\"string\">&quot;CN_WORD&quot;</span>,</span><br><span class=\"line\">      <span class=\"string\">&quot;position&quot;</span> : 4</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\"># æ‰€ä»¥åªè¦descä¸­åŒ…å«å¦‚ä¸Šè¿™äº›å†…å®¹çš„æ•°æ®éƒ½ä¼šè¢«åŒ¹é…ä¸Š</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ä½†æ˜¯è¿™æ ·åŒ¹é…çš„ç»“æœå°±ä¸å¤Ÿç²¾ç¡®ï¼Œå¦‚ä½•å°½é‡åŒ¹é…æ›´å¤šçš„åˆ†è¯å‘¢ï¼Œå¯ä»¥å¢åŠ  minimum_should_match</span></span><br><span class=\"line\">curl -X GET -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27;</span> \\</span><br><span class=\"line\">  -H <span class=\"string\">&#x27;Content-Type: application/json&#x27;</span> \\</span><br><span class=\"line\">  -d <span class=\"string\">&#x27;&#123;</span></span><br><span class=\"line\"><span class=\"string\">    &quot;query&quot;:&#123;</span></span><br><span class=\"line\"><span class=\"string\">      &quot;match&quot;:&#123;</span></span><br><span class=\"line\"><span class=\"string\">        &quot;address&quot;:&#123;</span></span><br><span class=\"line\"><span class=\"string\">          &quot;query&quot;: &quot;å¹¿å·ç™½äº‘å±±å…¬å›­&quot;,</span></span><br><span class=\"line\"><span class=\"string\">          &quot;minimum_should_match&quot;: 2</span></span><br><span class=\"line\"><span class=\"string\">        &#125;</span></span><br><span class=\"line\"><span class=\"string\">      &#125;</span></span><br><span class=\"line\"><span class=\"string\">    &#125;</span></span><br><span class=\"line\"><span class=\"string\">  &#125;&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"># minimum_should_match: 2 è¡¨ç¤ºè‡³å°‘åŒ¹é…ä¸¤ä¸ª</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å¦‚æœå¸Œæœ›å…¨éƒ¨éƒ½åŒ¹é…å‘¢</span></span><br><span class=\"line\">curl -X GET -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27;</span> \\</span><br><span class=\"line\">  -H <span class=\"string\">&#x27;Content-Type: application/json&#x27;</span> \\</span><br><span class=\"line\">  -d <span class=\"string\">&#x27;&#123;</span></span><br><span class=\"line\"><span class=\"string\">    &quot;query&quot;:&#123;</span></span><br><span class=\"line\"><span class=\"string\">      &quot;match&quot;:&#123;</span></span><br><span class=\"line\"><span class=\"string\">        &quot;address&quot;:&#123;</span></span><br><span class=\"line\"><span class=\"string\">          &quot;query&quot;: &quot;å¹¿å·ç™½äº‘å±±å…¬å›­&quot;,</span></span><br><span class=\"line\"><span class=\"string\">          &quot;operator&quot;: &quot;and&quot;</span></span><br><span class=\"line\"><span class=\"string\">        &#125;</span></span><br><span class=\"line\"><span class=\"string\">      &#125;</span></span><br><span class=\"line\"><span class=\"string\">    &#125;</span></span><br><span class=\"line\"><span class=\"string\">  &#125;&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"># operator: and è¡¨ç¤ºå…¨éƒ¨åŒ¹é…ï¼Œæ­¤æ—¶ç›¸å½“äºç²¾ç¡®åŒ¹é…ï¼Œå…¶é»˜è®¤å€¼æ˜¯ or</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"multi-match-å¤šå­—æ®µæŸ¥è¯¢\">multi_match: å¤šå­—æ®µæŸ¥è¯¢</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>multi_matchæŸ¥è¯¢åœ¨Elasticsearchä¸­ç”¨äºåœ¨å¤šä¸ªå­—æ®µä¸Šæ‰§è¡Œç›¸åŒçš„æœç´¢æ“ä½œã€‚å®ƒå¯ä»¥æ¥å—ä¸€ä¸ªæŸ¥è¯¢å­—ç¬¦ä¸²ï¼Œå¹¶åœ¨æŒ‡å®šçš„å­—æ®µé›†åˆä¸­æœç´¢è¿™ä¸ªå­—ç¬¦ä¸²ã€‚multi_matchæŸ¥è¯¢æä¾›äº†çµæ´»çš„åŒ¹é…ç±»å‹å’Œæ“ä½œç¬¦é€‰é¡¹ï¼Œä»¥ä¾¿æ ¹æ®ä¸åŒçš„æœç´¢éœ€æ±‚è°ƒæ•´æœç´¢è¡Œä¸ºã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -X GET -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27;</span> \\</span><br><span class=\"line\">  -H <span class=\"string\">&#x27;Content-Type: application/json&#x27;</span> \\</span><br><span class=\"line\">  -d <span class=\"string\">&#x27;&#123;</span></span><br><span class=\"line\"><span class=\"string\">    &quot;query&quot;:&#123;</span></span><br><span class=\"line\"><span class=\"string\">      &quot;multi_match&quot;:&#123;</span></span><br><span class=\"line\"><span class=\"string\">        &quot;query&quot;: &quot;å¹¿å·shirt&quot;,</span></span><br><span class=\"line\"><span class=\"string\">        &quot;fields&quot;:[&quot;title&quot;,&quot;address&quot;]</span></span><br><span class=\"line\"><span class=\"string\">      &#125;</span></span><br><span class=\"line\"><span class=\"string\">    &#125;</span></span><br><span class=\"line\"><span class=\"string\">  &#125;&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"># query: æŸ¥è¯¢æ¡ä»¶</span></span><br><span class=\"line\"><span class=\"comment\"># fields: æŒ‡å®šå¤šä¸ªå­—æ®µè¿›è¡ŒåŒ¹é…</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"match-phrase-çŸ­è¯­æŸ¥è¯¢\">match_phrase: çŸ­è¯­æŸ¥è¯¢</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>match_phraseæŸ¥è¯¢åœ¨Elasticsearchä¸­ç”¨äºæ‰§è¡ŒçŸ­è¯­æœç´¢ï¼Œå®ƒä¸ä»…åŒ¹é…æ•´ä¸ªçŸ­è¯­ï¼Œè€Œä¸”è¿˜è€ƒè™‘äº†çŸ­è¯­ä¸­å„ä¸ªè¯çš„é¡ºåºå’Œä½ç½®ã€‚è¿™ç§æŸ¥è¯¢ç±»å‹å¯¹äºæœç´¢ç²¾ç¡®çŸ­è¯­éå¸¸æœ‰ç”¨ï¼Œå°¤å…¶æ˜¯åœ¨ç”¨æˆ·è¾“å…¥çš„æŸ¥è¯¢ä¸æ–‡æ¡£ä¸­çš„æ–‡æœ¬è¡¨è¾¾æ–¹å¼éœ€è¦ä¸¥æ ¼åŒ¹é…æ—¶ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -X GET -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27;</span> \\</span><br><span class=\"line\">  -H <span class=\"string\">&#x27;Content-Type: application/json&#x27;</span> \\</span><br><span class=\"line\">  -d <span class=\"string\">&#x27;&#123;</span></span><br><span class=\"line\"><span class=\"string\">  &quot;query&quot;:&#123;</span></span><br><span class=\"line\"><span class=\"string\">      &quot;match_phrase&quot;:&#123;</span></span><br><span class=\"line\"><span class=\"string\">        &quot;address&quot;:&#123;</span></span><br><span class=\"line\"><span class=\"string\">          &quot;query&quot;:&quot;å¹¿å·ç™½äº‘å±±&quot;</span></span><br><span class=\"line\"><span class=\"string\">        &#125;</span></span><br><span class=\"line\"><span class=\"string\">      &#125;</span></span><br><span class=\"line\"><span class=\"string\">    &#125;</span></span><br><span class=\"line\"><span class=\"string\">  &#125;&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"># è¦æ±‚æŸ¥è¯¢ç»“æœä¸­çš„æ•°æ®å¿…é¡»åŒ…å«&quot;å¹¿å·ç™½äº‘å±±&quot;ï¼Œè€Œä¸”â€œå¹¿å·â€å’Œâ€œç™½äº‘å±±â€è¿™ä¸¤ä¸ªè¯æ˜¯ä¸èƒ½åˆ†å¼€çš„ï¼Œå› ä¸º match_phrase åŒ¹é…çš„æ˜¯ç›¸é‚»è¯æ¡</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"query-string-æ”¯æŒä¸æˆ–éè¡¨è¾¾å¼çš„æŸ¥è¯¢\">query_string: æ”¯æŒ<code>ä¸æˆ–é</code>è¡¨è¾¾å¼çš„æŸ¥è¯¢</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>query_stringæŸ¥è¯¢æ˜¯ä¸€ç§çµæ´»çš„æŸ¥è¯¢ç±»å‹ï¼Œå®ƒå…è®¸ä½¿ç”¨LuceneæŸ¥è¯¢è¯­æ³•æ¥æ„å»ºå¤æ‚çš„æœç´¢æŸ¥è¯¢ã€‚è¿™ç§æŸ¥è¯¢ç±»å‹æ”¯æŒå¤šç§é€»è¾‘è¿ç®—ç¬¦ï¼ŒåŒ…æ‹¬ä¸ï¼ˆANDï¼‰ã€æˆ–ï¼ˆORï¼‰å’Œéï¼ˆNOTï¼‰ï¼Œä»¥åŠé€šé…ç¬¦ã€æ¨¡ç³Šæœç´¢å’Œæ­£åˆ™è¡¨è¾¾å¼ç­‰åŠŸèƒ½ã€‚query_stringæŸ¥è¯¢å¯ä»¥åœ¨å•ä¸ªæˆ–å¤šä¸ªå­—æ®µä¸Šè¿›è¡Œæœç´¢ï¼Œå¹¶ä¸”å¯ä»¥å¤„ç†å¤æ‚çš„æŸ¥è¯¢é€»è¾‘ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>æ³¨æ„: æŸ¥è¯¢å­—æ®µåˆ†è¯å°±å°†æŸ¥è¯¢æ¡ä»¶åˆ†è¯æŸ¥è¯¢ï¼ŒæŸ¥è¯¢å­—æ®µä¸åˆ†è¯å°†æŸ¥è¯¢æ¡ä»¶ä¸åˆ†è¯æŸ¥è¯¢</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æŸ¥è¯¢æ‰€æœ‰å­—æ®µä¸­åŒ…å« &quot;å…¬å›­&quot;å’Œ &quot;åä¸º&quot; çš„æ–‡æ¡£</span></span><br><span class=\"line\">curl -X GET -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27;</span> \\</span><br><span class=\"line\">  -H <span class=\"string\">&#x27;Content-Type: application/json&#x27;</span> \\</span><br><span class=\"line\">  -d <span class=\"string\">&#x27;&#123;</span></span><br><span class=\"line\"><span class=\"string\">  &quot;query&quot;:&#123;</span></span><br><span class=\"line\"><span class=\"string\">      &quot;query_string&quot;:&#123;</span></span><br><span class=\"line\"><span class=\"string\">        &quot;query&quot;:&quot;å…¬å›­ AND electronics&quot;</span></span><br><span class=\"line\"><span class=\"string\">      &#125;</span></span><br><span class=\"line\"><span class=\"string\">    &#125;</span></span><br><span class=\"line\"><span class=\"string\">  &#125;&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŒ‡å®šæŸ¥è¯¢çš„å•ä¸ªå­—æ®µ</span></span><br><span class=\"line\">curl -X GET -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27;</span> \\</span><br><span class=\"line\">  -H <span class=\"string\">&#x27;Content-Type: application/json&#x27;</span> \\</span><br><span class=\"line\">  -d <span class=\"string\">&#x27;&#123;</span></span><br><span class=\"line\"><span class=\"string\">  &quot;query&quot;:&#123;</span></span><br><span class=\"line\"><span class=\"string\">      &quot;query_string&quot;:&#123;</span></span><br><span class=\"line\"><span class=\"string\">        &quot;default_field&quot;:&quot;category&quot;,</span></span><br><span class=\"line\"><span class=\"string\">        &quot;query&quot;:&quot;ç™½äº‘å±± OR books&quot;</span></span><br><span class=\"line\"><span class=\"string\">      &#125;</span></span><br><span class=\"line\"><span class=\"string\">    &#125;</span></span><br><span class=\"line\"><span class=\"string\">  &#125;&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŒ‡å®šæŸ¥è¯¢çš„å¤šä¸ªå­—æ®µ</span></span><br><span class=\"line\">curl -X GET -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27;</span> \\</span><br><span class=\"line\">  -H <span class=\"string\">&#x27;Content-Type: application/json&#x27;</span> \\</span><br><span class=\"line\">  -d <span class=\"string\">&#x27;&#123;</span></span><br><span class=\"line\"><span class=\"string\">  &quot;query&quot;:&#123;</span></span><br><span class=\"line\"><span class=\"string\">      &quot;query_string&quot;:&#123;</span></span><br><span class=\"line\"><span class=\"string\">        &quot;fields&quot;:[&quot;category&quot;,&quot;address&quot;],</span></span><br><span class=\"line\"><span class=\"string\">        &quot;query&quot;:&quot;ç™½äº‘å±± OR (electronics AND shirt)&quot;</span></span><br><span class=\"line\"><span class=\"string\">      &#125;</span></span><br><span class=\"line\"><span class=\"string\">    &#125;</span></span><br><span class=\"line\"><span class=\"string\">  &#125;&#x27;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"simple-query-string-ç±»ä¼¼-query-stringï¼Œä½†æ˜¯ä¼šå¿½ç•¥é”™è¯¯çš„è¯­æ³•ï¼ŒåŒæ—¶åªæ”¯æŒéƒ¨åˆ†æŸ¥è¯¢è¯­æ³•\">simple_query_string: ç±»ä¼¼ <code>query_string</code>ï¼Œä½†æ˜¯ä¼šå¿½ç•¥é”™è¯¯çš„è¯­æ³•ï¼ŒåŒæ—¶åªæ”¯æŒéƒ¨åˆ†æŸ¥è¯¢è¯­æ³•</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -X GET -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27;</span> \\</span><br><span class=\"line\">  -H <span class=\"string\">&#x27;Content-Type: application/json&#x27;</span> \\</span><br><span class=\"line\">  -d <span class=\"string\">&#x27;&#123;</span></span><br><span class=\"line\"><span class=\"string\">  &quot;query&quot;:&#123;</span></span><br><span class=\"line\"><span class=\"string\">      &quot;simple_query_string&quot;:&#123;</span></span><br><span class=\"line\"><span class=\"string\">        &quot;query&quot;:&quot;å¹¿å·å…¬å›­&quot;,</span></span><br><span class=\"line\"><span class=\"string\">        &quot;default_operator&quot;:&quot;AND&quot;</span></span><br><span class=\"line\"><span class=\"string\">      &#125;</span></span><br><span class=\"line\"><span class=\"string\">    &#125;</span></span><br><span class=\"line\"><span class=\"string\">  &#125;&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"># default_operator: é»˜è®¤ä¸º ORï¼Œè®¾ç½®ä¸º AND åˆ™å¿…é¡»åŒæ—¶åŒ¹é…</span></span><br></pre></td></tr></table></figure>\n<div class=\"tips\">\n<p><em><strong>ESæŸ¥è¯¢ç»“æœå±æ€§å«ä¹‰</strong></em></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">&quot;took&quot;</span>:16,          <span class=\"comment\"># è¡¨ç¤ºæŸ¥è¯¢ä»è¯·æ±‚åˆ°å®Œæˆè€—æ—¶ 16 æ¯«ç§’ã€‚</span></span><br><span class=\"line\">  <span class=\"string\">&quot;timed_out&quot;</span>:<span class=\"literal\">false</span>,  <span class=\"comment\"># è¡¨ç¤ºæŸ¥è¯¢åœ¨è§„å®šçš„æ—¶é—´å†…å®Œæˆï¼Œæ²¡æœ‰å‘ç”Ÿè¶…æ—¶ã€‚å¦‚æœä¸º trueï¼Œåˆ™è¡¨ç¤ºæŸ¥è¯¢è¶…æ—¶ã€‚</span></span><br><span class=\"line\">  <span class=\"string\">&quot;_shards&quot;</span>:&#123;         <span class=\"comment\"># æ¶‰åŠåˆ°æŸ¥è¯¢è¿‡ç¨‹ä¸­ä½¿ç”¨çš„åˆ†ç‰‡ä¿¡æ¯</span></span><br><span class=\"line\">    <span class=\"string\">&quot;total&quot;</span>:1,        <span class=\"comment\"># è¡¨ç¤ºæŸ¥è¯¢æ¶‰åŠåˆ°çš„æ€»åˆ†ç‰‡æ•°ä¸º 1</span></span><br><span class=\"line\">    <span class=\"string\">&quot;successful&quot;</span>:1,   <span class=\"comment\"># è¡¨ç¤ºæŸ¥è¯¢æˆåŠŸå®Œæˆçš„åˆ†ç‰‡æ•°ä¸º 1</span></span><br><span class=\"line\">    <span class=\"string\">&quot;skipped&quot;</span>:0,      <span class=\"comment\"># è¡¨ç¤ºæŸ¥è¯¢è¿‡ç¨‹ä¸­è¢«è·³è¿‡çš„åˆ†ç‰‡æ•°ä¸º 0</span></span><br><span class=\"line\">    <span class=\"string\">&quot;failed&quot;</span>:0        <span class=\"comment\"># è¡¨ç¤ºæŸ¥è¯¢è¿‡ç¨‹ä¸­å¤±è´¥çš„åˆ†ç‰‡æ•°ä¸º 0</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"string\">&quot;hits&quot;</span>:&#123;            <span class=\"comment\"># åŒ…å«æŸ¥è¯¢ç»“æœçš„è¯¦ç»†ä¿¡æ¯</span></span><br><span class=\"line\">    <span class=\"string\">&quot;total&quot;</span>:&#123;         <span class=\"comment\"># åŒ…å«æŸ¥è¯¢ç»“æœçš„æ€»æ•°</span></span><br><span class=\"line\">      <span class=\"string\">&quot;value&quot;</span>:4,      <span class=\"comment\"># è¡¨ç¤ºæŸ¥è¯¢ç»“æœçš„æ€»æ•°ä¸º 4</span></span><br><span class=\"line\">      <span class=\"string\">&quot;relation&quot;</span>:<span class=\"string\">&quot;eq&quot;</span> <span class=\"comment\"># è¡¨ç¤ºè¿”å›çš„æ€»æ•° value æ˜¯ç¡®åˆ‡çš„ï¼ˆequalï¼‰ã€‚å¦‚æœä¸º gteï¼Œåˆ™è¡¨ç¤ºè¿”å›çš„æ€»æ•°æ˜¯ä¸€ä¸ªä¸‹é™å€¼ã€‚</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"string\">&quot;max_score&quot;</span>:0.0,  <span class=\"comment\"># è¡¨ç¤ºåŒ¹é…åˆ°çš„æ–‡æ¡£ä¸­æœ€é«˜çš„å¾—åˆ†ã€‚å¦‚æœæ˜¯æ’åºæŸ¥è¯¢ï¼Œè¿™ä¸ªå€¼ä¼šæœ‰æ„ä¹‰ã€‚å½“å‰ç»“æœå› ä¸º size: 0ï¼Œæ²¡æœ‰å®é™…è¿”å›æ–‡æ¡£ï¼Œæ‰€ä»¥å¾—åˆ†ä¸º 0.0</span></span><br><span class=\"line\">    <span class=\"string\">&quot;hits&quot;</span>:[ ]        <span class=\"comment\"># åŒ…å«æŸ¥è¯¢ç»“æœçš„åˆ—è¡¨ï¼Œæ¯ä¸ªç»“æœéƒ½æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼ŒåŒ…å«æ–‡æ¡£çš„å…ƒæ•°æ®ï¼Œå¦‚ idã€åˆ†æ•°ç­‰ã€‚</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</div>\n<h2 id=\"bool-æŸ¥è¯¢\">bool æŸ¥è¯¢</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¸ƒå°”æŸ¥è¯¢å¯ä»¥æŒ‰ç…§å¸ƒå°”é€»è¾‘æ¡ä»¶ç»„ç»‡å¤šæ¡æŸ¥è¯¢è¯­å¥ï¼Œåªæœ‰ç¬¦åˆæ•´ä¸ªå¸ƒå°”æ¡ä»¶çš„æ–‡æ¡£æ‰ä¼šè¢«æœç´¢å‡ºæ¥ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>åœ¨å¸ƒå°”æ¡ä»¶ä¸­ï¼Œå¯ä»¥åŒ…å«ä¸¤ç§ä¸åŒçš„ä¸Šä¸‹æ–‡ã€‚</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">1.æœç´¢ä¸Šä¸‹æ–‡(query context)ï¼šä½¿ç”¨æœç´¢ä¸Šä¸‹æ–‡æ—¶ï¼ŒElasticsearchéœ€è¦è®¡ç®—æ¯ä¸ªæ–‡æ¡£ä¸æœç´¢æ¡ä»¶çš„ç›¸å…³åº¦å¾—åˆ†ï¼Œè¿™ä¸ªå¾—åˆ†çš„è®¡ç®—éœ€ä½¿ç”¨ä¸€å¥—å¤æ‚çš„è®¡ç®—å…¬å¼ï¼Œæœ‰ä¸€å®šçš„æ€§èƒ½å¼€é”€ï¼Œå¸¦æ–‡æœ¬åˆ†æçš„å…¨æ–‡æ£€ç´¢çš„æŸ¥è¯¢è¯­å¥å¾ˆé€‚åˆæ”¾åœ¨æœç´¢ä¸Šä¸‹æ–‡ä¸­ã€‚</li>\n<li class=\"lvl-4\">2.è¿‡æ»¤ä¸Šä¸‹æ–‡(filter context)ï¼šä½¿ç”¨è¿‡æ»¤ä¸Šä¸‹æ–‡æ—¶ï¼ŒElasticsearchåªéœ€è¦åˆ¤æ–­æœç´¢æ¡ä»¶è·Ÿæ–‡æ¡£æ•°æ®æ˜¯å¦åŒ¹é…ï¼Œä¾‹å¦‚ä½¿ç”¨<code>Term query</code>åˆ¤æ–­ä¸€ä¸ªå€¼æ˜¯å¦è·Ÿæœç´¢å†…å®¹ä¸€è‡´ï¼Œä½¿ç”¨<code>Range query</code>åˆ¤æ–­æŸæ•°æ®æ˜¯å¦ä½äºæŸä¸ªåŒºé—´ç­‰ã€‚è¿‡æ»¤ä¸Šä¸‹æ–‡çš„æŸ¥è¯¢ä¸éœ€è¦è¿›è¡Œç›¸å…³åº¦å¾—åˆ†è®¡ç®—ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ç¼“å­˜åŠ å¿«å“åº”é€Ÿåº¦ï¼Œå¾ˆå¤šæœ¯è¯­çº§æŸ¥è¯¢è¯­å¥éƒ½é€‚åˆæ”¾åœ¨è¿‡æ»¤ä¸Šä¸‹æ–‡ä¸­ã€‚</li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<p>bool æŸ¥è¯¢åŒ…å« mustã€must_notã€shouldã€filter å››ç§å­å¥ã€‚</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>ç±»å‹</th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>must</td>\n<td>å¯åŒ…å«å¤šä¸ªæŸ¥è¯¢æ¡ä»¶ï¼Œæ¯ä¸ªæ¡ä»¶å‡æ»¡è¶³çš„æ–‡æ¡£æ‰èƒ½è¢«æœç´¢åˆ°ï¼Œæ¯æ¬¡æŸ¥è¯¢éœ€è¦è®¡ç®—ç›¸å…³åº¦å¾—åˆ†ï¼Œå±äºæœç´¢ä¸Šä¸‹æ–‡</td>\n</tr>\n<tr>\n<td>should</td>\n<td>å¯åŒ…å«å¤šä¸ªæŸ¥è¯¢æ¡ä»¶ï¼Œä¸å­˜åœ¨mustå’Œfiteræ¡ä»¶æ—¶ï¼Œè‡³å°‘è¦æ»¡è¶³å¤šä¸ªæŸ¥è¯¢æ¡ä»¶ä¸­çš„ä¸€ä¸ªï¼Œæ–‡æ¡£æ‰èƒ½è¢«æœç´¢åˆ°ï¼Œå¦åˆ™éœ€æ»¡è¶³çš„æ¡ä»¶æ•°é‡ä¸å—é™åˆ¶,åŒ¹é…åˆ°çš„æŸ¥è¯¢è¶Šå¤šç›¸å…³åº¦è¶Šé«˜ï¼Œä¹Ÿå±äºæœç´¢ä¸Šä¸‹æ–‡</td>\n</tr>\n<tr>\n<td>filter</td>\n<td>å¯åŒ…å«å¤šä¸ªè¿‡æ»¤æ¡ä»¶ï¼Œæ¯ä¸ªæ¡ä»¶å‡æ»¡è¶³çš„æ–‡æ¡£æ‰èƒ½è¢«æœç´¢åˆ°ï¼Œæ¯ä¸ªè¿‡æ»¤æ¡ä»¶ä¸è®¡ç®—ç›¸å…³åº¦å¾—åˆ†ï¼Œç»“æœåœ¨ä¸€å®šæ¡ä»¶ä¸‹ä¼šè¢«ç¼“å­˜ï¼Œ å±äºè¿‡æ»¤ä¸Šä¸‹æ–‡</td>\n</tr>\n<tr>\n<td>must_not</td>\n<td>å¯åŒ…å«å¤šä¸ªè¿‡æ»¤æ¡ä»¶ï¼Œæ¯ä¸ªæ¡ä»¶å‡ä¸æ»¡è¶³çš„æ–‡æ¡£æ‰èƒ½è¢«æœç´¢åˆ°ï¼Œæ¯ä¸ªè¿‡æ»¤æ¡ä»¶ä¸è®¡ç®—ç›¸å…³åº¦å¾—åˆ†ï¼Œç»“æœåœ¨ä¸€å®šæ¡ä»¶ä¸‹ä¼šè¢«ç¼“å­˜ï¼Œ å±äºè¿‡æ»¤ä¸Šä¸‹æ–‡</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"must\">must</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ä¸¤ä¸ªæ¡ä»¶éƒ½éœ€è¦æ»¡è¶³</span></span><br><span class=\"line\">curl -X GET -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27;</span> \\</span><br><span class=\"line\">  -H <span class=\"string\">&#x27;Content-Type: application/json&#x27;</span> \\</span><br><span class=\"line\">  -d <span class=\"string\">&#x27;&#123;</span></span><br><span class=\"line\"><span class=\"string\">  &quot;query&quot;:&#123;</span></span><br><span class=\"line\"><span class=\"string\">      &quot;bool&quot;:&#123;</span></span><br><span class=\"line\"><span class=\"string\">        &quot;must&quot;:[</span></span><br><span class=\"line\"><span class=\"string\">          &#123;&quot;match&quot;:&#123;&quot;category&quot;:&quot;electronics&quot;&#125;&#125;,</span></span><br><span class=\"line\"><span class=\"string\">          &#123;&quot;match&quot;:&#123;&quot;desc&quot;:&quot;å…¬å›­&quot;&#125;&#125;</span></span><br><span class=\"line\"><span class=\"string\">        ]</span></span><br><span class=\"line\"><span class=\"string\">      &#125;</span></span><br><span class=\"line\"><span class=\"string\">    &#125;</span></span><br><span class=\"line\"><span class=\"string\">  &#125;&#x27;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"must-not\">must_not</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ä¸¤ä¸ªæ¡ä»¶éƒ½ä¸æ»¡è¶³</span></span><br><span class=\"line\">curl -X GET -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27;</span> \\</span><br><span class=\"line\">  -H <span class=\"string\">&#x27;Content-Type: application/json&#x27;</span> \\</span><br><span class=\"line\">  -d <span class=\"string\">&#x27;&#123;</span></span><br><span class=\"line\"><span class=\"string\">  &quot;query&quot;:&#123;</span></span><br><span class=\"line\"><span class=\"string\">      &quot;bool&quot;:&#123;</span></span><br><span class=\"line\"><span class=\"string\">        &quot;must_not&quot;:[</span></span><br><span class=\"line\"><span class=\"string\">          &#123;&quot;match&quot;:&#123;&quot;category&quot;:&quot;electronics&quot;&#125;&#125;,</span></span><br><span class=\"line\"><span class=\"string\">          &#123;&quot;match&quot;:&#123;&quot;desc&quot;:&quot;å…¬å›­&quot;&#125;&#125;</span></span><br><span class=\"line\"><span class=\"string\">        ]</span></span><br><span class=\"line\"><span class=\"string\">      &#125;</span></span><br><span class=\"line\"><span class=\"string\">    &#125;</span></span><br><span class=\"line\"><span class=\"string\">  &#125;&#x27;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"should\">should</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ä¸¤ä¸ªæ¡ä»¶æ»¡è¶³ä¸€ä¸ªå³å¯</span></span><br><span class=\"line\">curl -X GET -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27;</span> \\</span><br><span class=\"line\">  -H <span class=\"string\">&#x27;Content-Type: application/json&#x27;</span> \\</span><br><span class=\"line\">  -d <span class=\"string\">&#x27;&#123;</span></span><br><span class=\"line\"><span class=\"string\">  &quot;query&quot;:&#123;</span></span><br><span class=\"line\"><span class=\"string\">      &quot;bool&quot;:&#123;</span></span><br><span class=\"line\"><span class=\"string\">        &quot;should&quot;:[</span></span><br><span class=\"line\"><span class=\"string\">          &#123;&quot;match&quot;:&#123;&quot;category&quot;:&quot;electronics&quot;&#125;&#125;,</span></span><br><span class=\"line\"><span class=\"string\">          &#123;&quot;match&quot;:&#123;&quot;desc&quot;:&quot;å…¬å›­&quot;&#125;&#125;</span></span><br><span class=\"line\"><span class=\"string\">        ]</span></span><br><span class=\"line\"><span class=\"string\">      &#125;</span></span><br><span class=\"line\"><span class=\"string\">    &#125;</span></span><br><span class=\"line\"><span class=\"string\">  &#125;&#x27;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"filter\">filter</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># filterä¸­çš„æ¡ä»¶ä¸ºé matchï¼Œå³ä¸èƒ½æ˜¯å…¨æ–‡æ£€ç´¢</span></span><br><span class=\"line\">curl -X GET -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27;</span> \\</span><br><span class=\"line\">  -H <span class=\"string\">&#x27;Content-Type: application/json&#x27;</span> \\</span><br><span class=\"line\">  -d <span class=\"string\">&#x27;&#123;</span></span><br><span class=\"line\"><span class=\"string\">  &quot;query&quot;:&#123;</span></span><br><span class=\"line\"><span class=\"string\">      &quot;bool&quot;:&#123;</span></span><br><span class=\"line\"><span class=\"string\">        &quot;filter&quot;:[</span></span><br><span class=\"line\"><span class=\"string\">          &#123;&quot;term&quot;:&#123;&quot;category&quot;:&quot;electronics&quot;&#125;&#125;,</span></span><br><span class=\"line\"><span class=\"string\">          &#123;&quot;range&quot;:&#123;&quot;price&quot;:&#123;&quot;gte&quot;:20&#125;&#125;&#125;</span></span><br><span class=\"line\"><span class=\"string\">        ]</span></span><br><span class=\"line\"><span class=\"string\">      &#125;</span></span><br><span class=\"line\"><span class=\"string\">    &#125;</span></span><br><span class=\"line\"><span class=\"string\">  &#125;&#x27;</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"åˆ†é¡µä¸æ’åº\">åˆ†é¡µä¸æ’åº</h2>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># from: ä»ç¬¬å‡ æ¡å¼€å§‹ï¼Œé»˜è®¤0</span></span><br><span class=\"line\"><span class=\"comment\"># size: å–å¤šå°‘æ¡</span></span><br><span class=\"line\"><span class=\"comment\"># sort: æ’åºï¼Œé»˜è®¤ä¸ºæŒ‰æ–‡æ¡£idå‡åº</span></span><br><span class=\"line\">curl -X GET -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27;</span> \\</span><br><span class=\"line\">  -H <span class=\"string\">&#x27;Content-Type: application/json&#x27;</span> \\</span><br><span class=\"line\">  -d <span class=\"string\">&#x27;&#123;</span></span><br><span class=\"line\"><span class=\"string\">  &quot;query&quot;:&#123;&quot;range&quot;:&#123;&quot;price&quot;:&#123;&quot;gte&quot;:20,&quot;lte&quot;:30&#125;&#125;&#125;,</span></span><br><span class=\"line\"><span class=\"string\">  &quot;sort&quot;:[&#123;&quot;price&quot;:&quot;address&quot;&#125;],</span></span><br><span class=\"line\"><span class=\"string\">  &quot;from&quot;:0,</span></span><br><span class=\"line\"><span class=\"string\">  &quot;size&quot;:5</span></span><br><span class=\"line\"><span class=\"string\">  &#125;&#x27;</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"åªè¿”å›éƒ¨åˆ†å­—æ®µ\">åªè¿”å›éƒ¨åˆ†å­—æ®µ</h2>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># _source: æŒ‡å®šè¦è¿”å›çš„å­—æ®µåˆ—è¡¨</span></span><br><span class=\"line\">curl -X GET -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27;</span> \\</span><br><span class=\"line\">  -H <span class=\"string\">&#x27;Content-Type: application/json&#x27;</span> \\</span><br><span class=\"line\">  -d <span class=\"string\">&#x27;</span></span><br><span class=\"line\"><span class=\"string\">  &#123;&quot;query&quot;:&#123;&quot;range&quot;:&#123;&quot;price&quot;:&#123;&quot;gte&quot;:20,&quot;lte&quot;:30&#125;&#125;&#125;,</span></span><br><span class=\"line\"><span class=\"string\">  &quot;_source&quot;:[&quot;category&quot;,&quot;title&quot;,&quot;price&quot;]</span></span><br><span class=\"line\"><span class=\"string\">  &#125;&#x27;</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"é«˜äº®æ˜¾ç¤º\">é«˜äº®æ˜¾ç¤º</h2>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># é«˜äº®æ˜¾ç¤ºä»…æ”¯æŒå…¨æ–‡æ£€ç´¢å­—æ®µ</span></span><br><span class=\"line\">curl -X GET -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27;</span> \\</span><br><span class=\"line\">  -H <span class=\"string\">&#x27;Content-Type: application/json&#x27;</span> \\</span><br><span class=\"line\">  -d <span class=\"string\">&#x27;&#123;</span></span><br><span class=\"line\"><span class=\"string\">    &quot;query&quot;: &#123;</span></span><br><span class=\"line\"><span class=\"string\">      &quot;multi_match&quot;: &#123;</span></span><br><span class=\"line\"><span class=\"string\">        &quot;fields&quot;: [&quot;title&quot;,&quot;address&quot;],</span></span><br><span class=\"line\"><span class=\"string\">        &quot;query&quot;: &quot;å…¬å›­shirt&quot;</span></span><br><span class=\"line\"><span class=\"string\">      &#125;</span></span><br><span class=\"line\"><span class=\"string\">    &#125;,</span></span><br><span class=\"line\"><span class=\"string\">    &quot;highlight&quot;: &#123;</span></span><br><span class=\"line\"><span class=\"string\">      &quot;post_tags&quot;: [&quot;&lt;/span&gt;&quot;],</span></span><br><span class=\"line\"><span class=\"string\">      &quot;pre_tags&quot;: [&quot;&lt;span style=&#x27;</span>color:red<span class=\"string\">&#x27;&gt;&quot;],</span></span><br><span class=\"line\"><span class=\"string\">      &quot;fields&quot;: &#123;</span></span><br><span class=\"line\"><span class=\"string\">        &quot;*&quot;:&#123;&#125;</span></span><br><span class=\"line\"><span class=\"string\">      &#125;</span></span><br><span class=\"line\"><span class=\"string\">    &#125;</span></span><br><span class=\"line\"><span class=\"string\">  &#125;&#x27;</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"åœ°ç†ç©ºé—´ä½ç½®æŸ¥è¯¢\">åœ°ç†ç©ºé—´ä½ç½®æŸ¥è¯¢</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åœ°ç†ç©ºé—´ä½ç½®æŸ¥è¯¢æ˜¯æ•°æ®åº“å’Œæœç´¢ç³»ç»Ÿä¸­çš„ä¸€ä¸ªé‡è¦ç‰¹æ€§ï¼Œç‰¹åˆ«æ˜¯åœ¨åœ°ç†ä¿¡æ¯ç³»ç»Ÿï¼ˆGISï¼‰å’Œä½ç½®æœåŠ¡ä¸­ã€‚å®ƒå…è®¸ç”¨æˆ·åŸºäºåœ°ç†ä½ç½®ä¿¡æ¯æ¥æœç´¢å’Œè¿‡æ»¤æ•°æ®ã€‚åœ¨Elasticsearchè¿™æ ·çš„å…¨æ–‡æœç´¢å¼•æ“ä¸­ï¼Œåœ°ç†ç©ºé—´ä½ç½®æŸ¥è¯¢è¢«å¹¿æ³›åº”ç”¨ï¼Œä¾‹å¦‚åœ¨æ—…è¡Œã€æˆ¿åœ°äº§ã€ç‰©æµå’Œé›¶å”®ç­‰è¡Œä¸šï¼Œç”¨äºæä¾›åŸºäºä½ç½®çš„æœç´¢åŠŸèƒ½ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>åœ¨Elasticsearchä¸­ï¼Œåœ°ç†ç©ºé—´æ•°æ®é€šå¸¸å­˜å‚¨åœ¨<code>geo_point</code>å­—æ®µç±»å‹ä¸­ã€‚è¿™ç§å­—æ®µç±»å‹å¯ä»¥å­˜å‚¨çº¬åº¦å’Œç»åº¦åæ ‡ï¼Œç”¨äºè¡¨ç¤ºåœ°çƒä¸Šçš„ä¸€ä¸ªç‚¹ã€‚</p>\n</li>\n</ul>\n<h3 id=\"ç¤ºä¾‹\">ç¤ºä¾‹</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ›å»ºä¸€ä¸ªç´¢å¼•ï¼Œå¹¶æ·»åŠ ä¸€ä¸ª<code>geo_point</code>å­—æ®µï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -X PUT -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/tourist_spots&#x27;</span> \\</span><br><span class=\"line\">  -H <span class=\"string\">&#x27;Content-Type: application/json&#x27;</span> \\</span><br><span class=\"line\">  -d <span class=\"string\">&#x27;&#123;</span></span><br><span class=\"line\"><span class=\"string\">    &quot;mappings&quot;: &#123;</span></span><br><span class=\"line\"><span class=\"string\">      &quot;properties&quot;: &#123;</span></span><br><span class=\"line\"><span class=\"string\">        &quot;name&quot;: &#123;</span></span><br><span class=\"line\"><span class=\"string\">          &quot;type&quot;: &quot;text&quot;,</span></span><br><span class=\"line\"><span class=\"string\">          &quot;analyzer&quot;: &quot;ik_max_word&quot;,</span></span><br><span class=\"line\"><span class=\"string\">          &quot;search_analyzer&quot;: &quot;ik_max_word&quot;</span></span><br><span class=\"line\"><span class=\"string\">        &#125;,</span></span><br><span class=\"line\"><span class=\"string\">        &quot;location&quot;: &#123;</span></span><br><span class=\"line\"><span class=\"string\">          &quot;type&quot;: &quot;geo_point&quot;</span></span><br><span class=\"line\"><span class=\"string\">        &#125;</span></span><br><span class=\"line\"><span class=\"string\">      &#125;</span></span><br><span class=\"line\"><span class=\"string\">    &#125;</span></span><br><span class=\"line\"><span class=\"string\">  &#125;&#x27;</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ’å…¥æ•°æ®</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -X POST -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/tourist_spots/_bulk&#x27;</span> \\</span><br><span class=\"line\">  -H <span class=\"string\">&#x27;Content-Type: application/json&#x27;</span> \\</span><br><span class=\"line\">  -d <span class=\"string\">&#x27;&#123;&quot;index&quot;:&#123;&#125;&#125;</span></span><br><span class=\"line\"><span class=\"string\">&#123;&quot;name&quot;:&quot;é›·å³°å¡”&quot;,&quot;location&quot;:&#123;&quot;lat&quot;:30.2615,&quot;lon&quot;:120.1480&#125;&#125;</span></span><br><span class=\"line\"><span class=\"string\">&#123;&quot;index&quot;:&#123;&#125;&#125;</span></span><br><span class=\"line\"><span class=\"string\">&#123;&quot;name&quot;:&quot;è¥¿æ¹–&quot;,&quot;location&quot;:&#123;&quot;lat&quot;:30.2614,&quot;lon&quot;:120.1479&#125;&#125;</span></span><br><span class=\"line\"><span class=\"string\">&#123;&quot;index&quot;:&#123;&#125;&#125;</span></span><br><span class=\"line\"><span class=\"string\">&#123;&quot;name&quot;:&quot;è‹å ¤æ˜¥æ™“&quot;,&quot;location&quot;:&#123;&quot;lat&quot;:30.2624,&quot;lon&quot;:120.1708&#125;&#125;</span></span><br><span class=\"line\"><span class=\"string\">&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"># lat: çº¬åº¦</span></span><br><span class=\"line\"><span class=\"comment\"># lon: ç»åº¦</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æŸ¥è¯¢æ•°æ®</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æŸ¥è¯¢æ­å·è¥¿æ¹–5kmé™„è¿‘çš„æ™¯ç‚¹</span></span><br><span class=\"line\"><span class=\"comment\"># é›·å³°å¡” - ä½äºè¥¿æ¹–é™„è¿‘ï¼Œè·ç¦»çº¦2.8å…¬é‡Œã€‚</span></span><br><span class=\"line\"><span class=\"comment\"># è‹å ¤æ˜¥æ™“ - ä½äºè¥¿æ¹–è¾¹ï¼Œè·ç¦»è¥¿æ¹–ä¸­å¿ƒçº¦1å…¬é‡Œã€‚</span></span><br><span class=\"line\">curl -X GET -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/tourist_spots/_search?pretty&#x27;</span> \\</span><br><span class=\"line\">  -H <span class=\"string\">&#x27;Content-Type: application/json&#x27;</span> \\</span><br><span class=\"line\">  -d <span class=\"string\">&#x27;&#123;</span></span><br><span class=\"line\"><span class=\"string\">    &quot;query&quot;: &#123;</span></span><br><span class=\"line\"><span class=\"string\">      &quot;bool&quot;: &#123;</span></span><br><span class=\"line\"><span class=\"string\">        &quot;must&quot;: &#123;</span></span><br><span class=\"line\"><span class=\"string\">          &quot;match_all&quot;: &#123;&#125;</span></span><br><span class=\"line\"><span class=\"string\">        &#125;,</span></span><br><span class=\"line\"><span class=\"string\">        &quot;filter&quot;: &#123;</span></span><br><span class=\"line\"><span class=\"string\">          &quot;geo_distance&quot;: &#123;</span></span><br><span class=\"line\"><span class=\"string\">            &quot;distance&quot;: &quot;5km&quot;,</span></span><br><span class=\"line\"><span class=\"string\">            &quot;distance_type&quot;: &quot;arc&quot;,</span></span><br><span class=\"line\"><span class=\"string\">            &quot;location&quot;: &#123;</span></span><br><span class=\"line\"><span class=\"string\">              &quot;lat&quot;: 30.2614,</span></span><br><span class=\"line\"><span class=\"string\">              &quot;lon&quot;: 120.1479</span></span><br><span class=\"line\"><span class=\"string\">            &#125;</span></span><br><span class=\"line\"><span class=\"string\">          &#125;</span></span><br><span class=\"line\"><span class=\"string\">        &#125;</span></span><br><span class=\"line\"><span class=\"string\">      &#125;</span></span><br><span class=\"line\"><span class=\"string\">    &#125;</span></span><br><span class=\"line\"><span class=\"string\">  &#125;&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># distance: 5km è¡¨ç¤ºè·ç¦»ä¸º5å…¬é‡Œ</span></span><br><span class=\"line\"><span class=\"comment\"># distance_type: arc, plane, sloppy_arc,</span></span><br><span class=\"line\">  <span class=\"comment\"># arc: é»˜è®¤å€¼ï¼Œä½¿ç”¨haversineå…¬å¼è®¡ç®—è·ç¦»ï¼Œç»“æœæ˜¯ç²¾ç¡®çš„ï¼Œä½†è®¡ç®—é€Ÿåº¦è¾ƒæ…¢ã€‚</span></span><br><span class=\"line\">  <span class=\"comment\"># plane: ä½¿ç”¨å¹³é¢ç›´è§’åæ ‡ç³»è®¡ç®—è·ç¦»ï¼Œç»“æœæ˜¯ç²—ç•¥çš„ï¼Œä½†è®¡ç®—é€Ÿåº¦æ›´å¿«ã€‚</span></span><br><span class=\"line\">  <span class=\"comment\"># sloppy_arc: ä½¿ç”¨haversineå…¬å¼è®¡ç®—è·ç¦»ï¼Œä½†å…è®¸è¯¯å·®ã€‚</span></span><br><span class=\"line\"><span class=\"comment\"># location: æœç´¢æ¡ä»¶</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"å‘é‡æœç´¢\">å‘é‡æœç´¢</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Elasticsearch 8.x å¼•å…¥äº†ä¸€ä¸ªé‡è¦çš„æ–°ç‰¹æ€§ï¼šå‘é‡æ£€ç´¢ï¼ˆVector Searchï¼‰ï¼Œç‰¹åˆ«æ˜¯é€šè¿‡KNNï¼ˆK-Nearest Neighborsï¼‰ç®—æ³•æ”¯æŒå‘é‡è¿‘é‚»æ£€ç´¢ã€‚è¿™ä¸€ç‰¹æ€§ä½¿å¾—Elasticsearchåœ¨æœºå™¨å­¦ä¹ ã€æ•°æ®åˆ†æå’Œæ¨èç³»ç»Ÿç­‰é¢†åŸŸçš„åº”ç”¨å˜å¾—æ›´åŠ å¹¿æ³›å’Œå¼ºå¤§ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å‘é‡æ£€ç´¢çš„åŸºæœ¬æ€è·¯æ˜¯ï¼Œå°†æ–‡æ¡£ï¼ˆæˆ–æ•°æ®é¡¹ï¼‰è¡¨ç¤ºä¸ºé«˜ç»´å‘é‡ï¼Œå¹¶ä½¿ç”¨è¿™äº›å‘é‡æ¥æ‰§è¡Œç›¸ä¼¼æ€§æœç´¢ã€‚åœ¨Elasticsearchä¸­ï¼Œè¿™äº›å‘é‡è¢«å­˜å‚¨åœ¨<code>dense_vector</code>ç±»å‹çš„å­—æ®µä¸­ï¼Œç„¶åä½¿ç”¨KNNç®—æ³•æ¥æ‰¾åˆ°ä¸ç»™å®šå‘é‡æœ€ç›¸ä¼¼çš„å…¶ä»–å‘é‡ã€‚</p>\n</li>\n</ul>\n<h3 id=\"ç¤ºä¾‹-2\">ç¤ºä¾‹</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ›å»ºç´¢å¼•</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -X PUT -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/image-index&#x27;</span> \\</span><br><span class=\"line\">  -H <span class=\"string\">&#x27;Content-Type: application/json&#x27;</span> \\</span><br><span class=\"line\">  -d <span class=\"string\">&#x27;&#123;</span></span><br><span class=\"line\"><span class=\"string\">    &quot;mappings&quot;: &#123;</span></span><br><span class=\"line\"><span class=\"string\">      &quot;properties&quot;: &#123;</span></span><br><span class=\"line\"><span class=\"string\">        &quot;image-vector&quot;: &#123;</span></span><br><span class=\"line\"><span class=\"string\">          &quot;type&quot;: &quot;dense_vector&quot;,</span></span><br><span class=\"line\"><span class=\"string\">          &quot;dims&quot;: 3</span></span><br><span class=\"line\"><span class=\"string\">        &#125;,</span></span><br><span class=\"line\"><span class=\"string\">        &quot;title&quot;: &#123;</span></span><br><span class=\"line\"><span class=\"string\">          &quot;type&quot;: &quot;text&quot;</span></span><br><span class=\"line\"><span class=\"string\">        &#125;,</span></span><br><span class=\"line\"><span class=\"string\">        &quot;file-type&quot;: &#123;</span></span><br><span class=\"line\"><span class=\"string\">          &quot;type&quot;: &quot;keyword&quot;</span></span><br><span class=\"line\"><span class=\"string\">        &#125;,</span></span><br><span class=\"line\"><span class=\"string\">        &quot;my_label&quot;: &#123;</span></span><br><span class=\"line\"><span class=\"string\">          &quot;type&quot;: &quot;text&quot;</span></span><br><span class=\"line\"><span class=\"string\">        &#125;</span></span><br><span class=\"line\"><span class=\"string\">      &#125;</span></span><br><span class=\"line\"><span class=\"string\">    &#125;</span></span><br><span class=\"line\"><span class=\"string\">  &#125;&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"># dims: 3  è¡¨ç¤º3ç»´å‘é‡ï¼Œæœ€é«˜æ”¯æŒ2048</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ·»åŠ æ•°æ®</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -X POST -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/image-index/_bulk&#x27;</span> \\</span><br><span class=\"line\">  -H <span class=\"string\">&#x27;Content-Type: application/json&#x27;</span> \\</span><br><span class=\"line\">  -d <span class=\"string\">&#x27;&#123; &quot;index&quot;: &#123;&#125; &#125;</span></span><br><span class=\"line\"><span class=\"string\">&#123; &quot;image-vector&quot;: [-5, 9, -12], &quot;title&quot;: &quot;Image A&quot;, &quot;file-type&quot;: &quot;jpeg&quot;, &quot;my_label&quot;: &quot;red&quot; &#125;</span></span><br><span class=\"line\"><span class=\"string\">&#123; &quot;index&quot;: &#123;&#125; &#125;</span></span><br><span class=\"line\"><span class=\"string\">&#123; &quot;image-vector&quot;: [10, -2, 3], &quot;title&quot;: &quot;Image B&quot;, &quot;file-type&quot;: &quot;png&quot;, &quot;my_label&quot;: &quot;blue&quot; &#125;</span></span><br><span class=\"line\"><span class=\"string\">&#123; &quot;index&quot;: &#123;&#125; &#125;</span></span><br><span class=\"line\"><span class=\"string\">&#123; &quot;image-vector&quot;: [4, 0, -1], &quot;title&quot;: &quot;Image C&quot;, &quot;file-type&quot;: &quot;gif&quot;, &quot;my_label&quot;: &quot;red&quot; &#125;</span></span><br><span class=\"line\"><span class=\"string\">&#x27;</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å‘é‡æ£€ç´¢</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -X POST -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/image-index/_search?pretty&#x27;</span> \\</span><br><span class=\"line\">  -H <span class=\"string\">&#x27;Content-Type: application/json&#x27;</span> \\</span><br><span class=\"line\">  -d <span class=\"string\">&#x27;&#123;</span></span><br><span class=\"line\"><span class=\"string\">    &quot;query&quot;:&#123; &quot;match_all&quot;: &#123;&#125; &#125;,</span></span><br><span class=\"line\"><span class=\"string\">    &quot;knn&quot;: &#123;</span></span><br><span class=\"line\"><span class=\"string\">      &quot;field&quot;: &quot;image-vector&quot;,</span></span><br><span class=\"line\"><span class=\"string\">      &quot;query_vector&quot;: [-5, 10, -12],</span></span><br><span class=\"line\"><span class=\"string\">      &quot;k&quot;: 10,</span></span><br><span class=\"line\"><span class=\"string\">      &quot;num_candidates&quot;: 100</span></span><br><span class=\"line\"><span class=\"string\">    &#125;,</span></span><br><span class=\"line\"><span class=\"string\">    &quot;fields&quot;: [ &quot;title&quot;, &quot;file-type&quot; ]</span></span><br><span class=\"line\"><span class=\"string\">  &#125;&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># query: æœç´¢æ¡ä»¶ï¼Œè¿™é‡Œå¯ä»¥ä¸åŠ è¿™ä¸ª</span></span><br><span class=\"line\"><span class=\"comment\"># knn: 8.8.1 ç‰ˆæœ¬å¼€å§‹é»˜è®¤æ”¯æŒ</span></span><br><span class=\"line\"><span class=\"comment\"># field: æœç´¢å‘é‡å­—æ®µ</span></span><br><span class=\"line\"><span class=\"comment\"># query_vector: æœç´¢å‘é‡</span></span><br><span class=\"line\"><span class=\"comment\"># k: æœç´¢ç»“æœæ•°é‡</span></span><br><span class=\"line\"><span class=\"comment\"># num_candidates: æœç´¢å€™é€‰æ•°é‡ï¼Œç”¨äºä¼˜åŒ–æ€§èƒ½</span></span><br><span class=\"line\"><span class=\"comment\"># fields: æœç´¢ç»“æœè¿”å›å­—æ®µ</span></span><br></pre></td></tr></table></figure>","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» Elasticsearch çš„ REST APIs Elasticsearchç‰ˆæœ¬8.17.3 å®˜æ–¹æ–‡æ¡£:REST APIs Elasticsearch çš„ REST APIs:èšåˆæŸ¥è¯¢ è¿”å›å†…å®¹æ ¼å¼åŒ– è¿”å›jsonä¿¡æ¯æ ¼å¼: ?pretty è¾“å‡ºæ ¼å¼åŒ–åçš„jsonï¼Œæ¯”å¦‚ï¼šcurl http://localhost:9200/_cluster/health?pretty è¿”å›è¡Œä¿¡æ¯æ ¼å¼: ?v è¾“å‡ºå†…å®¹ä¸Šæ–¹ä¼šåŠ ä¸Šæ ‡é¢˜è¡Œï¼Œæ¯”å¦‚ï¼šcurl http://localhost:9200/_cat/health?v CAT APIs Elasticsearch æä¾›äº† CAT APIsï¼Œå®ƒä»¬æä¾›äº†ä¸€ç§ç®€å•çš„æ–¹å¼æ¥æŸ¥çœ‹é›†ç¾¤çŠ¶æ€å’Œé›†ç¾¤ä¸­çš„å„ç§èµ„æºï¼Œæ¯”å¦‚ç´¢å¼•ã€åˆ†ç‰‡ã€èŠ‚ç‚¹ç­‰ã€‚ 123456789101112131415161718192021222324GET /_cat/health #æŸ¥çœ‹é›†ç¾¤å½“å‰çŠ¶æ€ï¼šçº¢ã€é»„ã€ç»¿GET /_cat/master #æŸ¥çœ‹masterèŠ‚ç‚¹ä¿¡æ¯GET /_cat/nodes #æŸ¥çœ‹æ‰€æœ‰èŠ‚ç‚¹ä¿¡æ¯GET /_cat/plugins #æŸ¥çœ‹é›†ç¾¤å„ä¸ªèŠ‚ç‚¹ä¸Šçš„pluginä¿¡æ¯GET /_cat/indices #æŸ¥çœ‹é›†ç¾¤ä¸­æ‰€æœ‰indexçš„è¯¦ç»†ä¿¡æ¯GET /_cat/indices/&#123;index&#125; #æŸ¥çœ‹é›†ç¾¤ä¸­æŒ‡å®šindexçš„è¯¦ç»†ä¿¡æ¯ï¼Œindexï¼šç´¢å¼•åç§°GET /_cat/allocation #æŸ¥çœ‹å•èŠ‚ç‚¹çš„shardåˆ†é…æ•´ä½“æƒ…å†µGET /_cat/shards #æŸ¥çœ‹å„shardçš„è¯¦ç»†æƒ…å†µGET /_cat/shards/&#123;index&#125; #æŸ¥çœ‹æŒ‡å®šåˆ†ç‰‡çš„è¯¦ç»†æƒ…å†µGET /_cat/segments #æŸ¥çœ‹å„indexçš„segmentè¯¦ç»†ä¿¡æ¯,åŒ…æ‹¬segmentå, æ‰€å±shard, å†…å­˜(ç£ç›˜)å ç”¨å¤§å°, æ˜¯å¦åˆ·ç›˜GET /_cat/segments/&#123;index&#125; #æŸ¥çœ‹æŒ‡å®šindexçš„segmentè¯¦ç»†ä¿¡æ¯GET /_cat/count #æŸ¥çœ‹å½“å‰é›†ç¾¤çš„docæ•°é‡GET /_cat/count/&#123;index&#125; #æŸ¥çœ‹æŒ‡å®šç´¢å¼•çš„docæ•°é‡GET /_cat/recovery #æŸ¥çœ‹é›†ç¾¤å†…æ¯ä¸ªshardçš„recoveryè¿‡ç¨‹.è°ƒæ•´replicaã€‚GET /_cat/recovery/&#123;index&#125; #æŸ¥çœ‹æŒ‡å®šç´¢å¼•shardçš„recoveryè¿‡ç¨‹GET /_cat/pending_tasks #æŸ¥çœ‹å½“å‰é›†ç¾¤çš„pending taskGET /_cat/aliases #æŸ¥çœ‹é›†ç¾¤ä¸­æ‰€æœ‰aliasä¿¡æ¯,è·¯ç”±é…ç½®ç­‰GET /_cat/aliases/&#123;alias&#125; #æŸ¥çœ‹æŒ‡å®šç´¢å¼•çš„aliasä¿¡æ¯GET /_cat/thread_pool #æŸ¥çœ‹é›†ç¾¤å„èŠ‚ç‚¹å†…éƒ¨ä¸åŒç±»å‹çš„threadpoolçš„ç»Ÿè®¡ä¿¡æ¯,GET /_cat/fielddata #æŸ¥çœ‹å½“å‰é›†ç¾¤å„ä¸ªèŠ‚ç‚¹çš„fielddataå†…å­˜ä½¿ç”¨æƒ…å†µGET /_cat/fielddata/&#123;fields&#125; #æŸ¥çœ‹æŒ‡å®šfieldçš„å†…å­˜ä½¿ç”¨æƒ…å†µ,é‡Œé¢ä¼ fieldå±æ€§å¯¹åº”çš„å€¼GET /_cat/nodeattrs #æŸ¥çœ‹å•èŠ‚ç‚¹çš„è‡ªå®šä¹‰å±æ€§GET /_cat/repositories #è¾“å‡ºé›†ç¾¤ä¸­æ³¨å†Œå¿«ç…§å­˜å‚¨åº“GET /_cat/templates #è¾“å‡ºå½“å‰æ­£åœ¨å­˜åœ¨çš„æ¨¡æ¿ä¿¡æ¯ Cluster APIs Elasticsearch æä¾›äº†ä¸€ç³»åˆ—çš„ Cluster APIsï¼Œå®ƒä»¬æä¾›äº†ç®¡ç†å’Œç›‘æ§é›†ç¾¤çŠ¶æ€çš„åŠŸèƒ½ 123456789GET /_cluster/health # è·å–é›†ç¾¤çš„å¥åº·çŠ¶æ€ä¿¡æ¯ï¼ŒåŒ…æ‹¬äº†é›†ç¾¤æ€»ä½“çš„çŠ¶å†µå¦‚statusã€number_of_nodesç­‰ã€‚GET /_cluster/stats # æä¾›æ•´ä¸ªé›†ç¾¤å±‚é¢çš„ç»Ÿè®¡ä¿¡æ¯ï¼ŒåŒ…å«ç´¢å¼•ã€èŠ‚ç‚¹å’Œå…¶ä»–é«˜çº§æŒ‡æ ‡ã€‚GET /_cluster/state # æ˜¾ç¤ºé›†ç¾¤å…ƒæ•°æ®çš„çŠ¶æ€ï¼ŒåŒ…æ‹¬è®¾ç½®ã€å—ã€è·¯ç”±è¡¨åŠå…ƒæ•°æ®ç­‰ï¼Œå…è®¸ç”¨æˆ·æŸ¥çœ‹é›†ç¾¤çš„å½“å‰è§†å›¾ã€‚POST /_cluster/reroute # POSTè¯·æ±‚ï¼Œç”¨äºæ‰‹åŠ¨æ”¹å˜åˆ†ç‰‡åˆ†é…æƒ…å†µï¼Œå¯ä»¥å®ç°å¦‚è¿ç§»åˆ†ç‰‡ã€å–æ¶ˆåˆ†é…ç­‰æ“ä½œã€‚GET /_cluster/nodes/hot_threads # è¿”å›é›†ç¾¤ä¸­å„ä¸ªèŠ‚ç‚¹â€œæœ€çƒ­â€çš„çº¿ç¨‹å †æ ˆè·Ÿè¸ªï¼Œé»˜è®¤æ˜¾ç¤ºå‰ä¸‰ä¸ªCPUæ—¶é—´æœ€é•¿çš„çº¿ç¨‹ã€‚GET /_cluster/allocation/explain # è§£é‡Šä¸ºä½•æŸä¸ªåˆ†ç‰‡è¢«å¦‚æ­¤åˆ†é…ï¼Œå¹¶æä¾›å¦‚ä½•è°ƒæ•´çš„å»ºè®®ã€‚GET /_cluster/pending_tasks # åˆ—å‡ºæ‰€æœ‰ç­‰å¾…æ‰§è¡Œçš„ä»»åŠ¡åˆ—è¡¨ã€‚GET /_cluster/settings # æŸ¥çœ‹æ•´ä¸ªé›†ç¾¤çº§åˆ«çš„è®¾ç½®ã€‚PUT /_cluster/settings # æ›´æ–°æ•´ä¸ªé›†ç¾¤çº§åˆ«çš„è®¾ç½®ã€‚ Index APIs Elasticsearch æä¾›äº† Index APIsï¼Œå®ƒä»¬æä¾›äº†å¯¹ç´¢å¼•çš„åˆ›å»ºã€æ›´æ–°ã€æŸ¥è¯¢å’Œåˆ é™¤ç­‰æ“ä½œã€‚ åˆ›å»ºç´¢å¼• 12345# PUT /&lt;target&gt;# è¿™é‡Œ shopping ä¸ºç´¢å¼•åç§°ï¼Œä½†æ­¤æ—¶æ²¡æœ‰ä¸ºç´¢å¼•è®¾ç½®åˆ†ç‰‡ç­–ç•¥ï¼Œä¹Ÿæ²¡æœ‰è®¾ç½®å­—æ®µä¿¡æ¯curl -X PUT -u elastic:123456 -k &#x27;https://127.0.0.1:9200/shopping&#x27;# è¿”å›å€¼&#123;&quot;acknowledged&quot;:true,&quot;shards_acknowledged&quot;:true,&quot;index&quot;:&quot;shopping&quot;&#125; åˆ›å»ºç´¢å¼•å¹¶è®¾ç½®ç´¢å¼• 123456# PUT /&lt;target&gt;curl -X PUT -u elastic:123456 -k &#x27;https://127.0.0.1:9200/shopping&#x27; \\ -H &#x27;Content-Type: application/json&#x27; \\ -d &#x27;&#123;&quot;settings&quot;:&#123;&quot;number_of_shards&quot;:&quot;1&quot;,&quot;number_of_replicas&quot;:&quot;2&quot;&#125;&#125;&#x27;# è¿”å›å€¼&#123;&quot;acknowledged&quot;:true,&quot;shards_acknowledged&quot;:true,&quot;index&quot;:&quot;shopping&quot;&#125; åˆ›å»ºå¹¶æ˜ å°„ç´¢å¼• 1234567891011121314151617181920212223242526272829303132333435363738394041# PUT /&lt;target&gt;# è¿™é‡Œè®¾ç½®ç´¢å¼•åˆ†ç‰‡æ•°é‡ä¸º1ï¼Œå‰¯æœ¬æ•°é‡ä¸º2ï¼Œå¹¶è®¾ç½®å­—æ®µä¿¡æ¯curl -X PUT -u elastic:123456 -k &#x27;https://127.0.0.1:9200/shopping&#x27; \\ -H &#x27;Content-Type: application/json&#x27; \\ -d &#x27;&#123; &quot;settings&quot;:&#123; &quot;number_of_shards&quot;:&quot;1&quot;, &quot;number_of_replicas&quot;:&quot;2&quot; &#125;, &quot;mappings&quot;:&#123; &quot;properties&quot;:&#123; &quot;title&quot;:&#123; &quot;type&quot;:&quot;text&quot; &#125;, &quot;category&quot;:&#123; &quot;type&quot;:&quot;keyword&quot; &#125;, &quot;price&quot;:&#123; &quot;type&quot;:&quot;double&quot; &#125;, &quot;count&quot;:&#123; &quot;type&quot;:&quot;integer&quot; &#125; &#125; &#125; &#125;&#x27;# å‚æ•°è¯´æ˜## settings: è¿™ä¸ªå‚æ•°ç”¨äºé…ç½®ç´¢å¼•çš„è®¾ç½®ï¼ŒåŒ…æ‹¬åˆ†ç‰‡æ•°é‡å’Œå‰¯æœ¬æ•°é‡ã€‚### number_of_shards: è¿™ä¸ªå‚æ•°æŒ‡å®šäº†ç´¢å¼•ä¸­åˆ†ç‰‡çš„æ•°é‡ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œnumber_of_shards è®¾ç½®ä¸º 1ï¼Œæ„å‘³ç€ç´¢å¼•å°†åªæœ‰ä¸€ä¸ªä¸»åˆ†ç‰‡ã€‚### number_of_replicas: è¿™ä¸ªå‚æ•°æŒ‡å®šäº†æ¯ä¸ªä¸»åˆ†ç‰‡çš„å‰¯æœ¬æ•°é‡ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œnumber_of_replicas è®¾ç½®ä¸º 2ï¼Œæ„å‘³ç€æ¯ä¸ªä¸»åˆ†ç‰‡å°†æœ‰ä¸¤ä¸ªå‰¯æœ¬ã€‚## mappings: è¿™ä¸ªå‚æ•°ç”¨äºå®šä¹‰ç´¢å¼•ä¸­çš„å­—æ®µå’Œå­—æ®µç±»å‹ã€‚### properties: è¿™ä¸ªå‚æ•°å®šä¹‰äº†ç´¢å¼•ä¸­çš„å­—æ®µå’Œå­—æ®µç±»å‹ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæœ‰å››ä¸ªå­—æ®µï¼štitleã€categoryã€images å’Œ priceã€‚### title: è¿™ä¸ªå­—æ®µçš„ç±»å‹æ˜¯ textï¼Œè¡¨ç¤ºå®ƒæ˜¯ä¸€ä¸ªå…¨æ–‡æ£€ç´¢å­—æ®µã€‚text é€‚åˆå­˜å‚¨é•¿æ–‡æœ¬æ•°æ®ï¼Œå¹¶æ”¯æŒå…¨æ–‡æœç´¢ã€‚### category: è¿™ä¸ªå­—æ®µçš„ç±»å‹æ˜¯ keywordï¼Œè¡¨ç¤ºå®ƒæ˜¯ä¸€ä¸ªå…³é”®å­—å­—æ®µï¼Œä¸æ”¯æŒå…¨æ–‡æ£€ç´¢ã€‚keyword é€‚åˆå­˜å‚¨ä¸éœ€è¦åˆ†è¯çš„çŸ­æ–‡æœ¬æ•°æ®ï¼ˆå¦‚æ ‡ç­¾ã€ç±»åˆ«ç­‰ï¼‰ï¼Œå¹¶ä¸”å¯ä»¥ç”¨äºèšåˆå’Œè¿‡æ»¤ã€‚### price: è¿™ä¸ªå­—æ®µçš„ç±»å‹æ˜¯ doubleï¼Œè¡¨ç¤ºå®ƒæ˜¯ä¸€ä¸ªæ•°å­—å­—æ®µã€‚double è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªåŒç²¾åº¦æµ®ç‚¹æ•°å­—æ®µï¼Œé€‚åˆå­˜å‚¨æ•°å€¼æ•°æ®ï¼Œå¦‚ä»·æ ¼### count: è¿™ä¸ªå­—æ®µçš„ç±»å‹æ˜¯ integerï¼Œè¡¨ç¤ºå®ƒæ˜¯ä¸€ä¸ªæ•´æ•°å­—æ®µã€‚integer è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªæ•´æ•°å­—æ®µï¼Œé€‚åˆå­˜å‚¨æ•´æ•°æ•°æ®ï¼Œå¦‚å•†å“æ•°é‡ç­‰ã€‚# è¿”å›å€¼&#123;&quot;acknowledged&quot;:true,&quot;shards_acknowledged&quot;:true,&quot;index&quot;:&quot;shopping&quot;&#125; æ›´æ–°ç´¢å¼•æ˜ å°„ 1234567891011121314151617181920212223242526272829303132333435363738# PUT /&lt;target&gt;/_mapping# æ³¨æ„è¯¥apiåªèƒ½å¢åŠ æ–°çš„å­—æ®µï¼Œä¸èƒ½ä¿®æ”¹å·²æœ‰å­—æ®µï¼Œå¦‚æœè¦ä¿®æ”¹æºå­—æ®µç±»å‹æˆ–è€…åˆ†è¯å™¨ç±»å‹ï¼Œä¸‹æ–‡ä¼šä»‹ç»curl -X PUT -u elastic:123456 -k &#x27;https://127.0.0.1:9200/shopping/_mapping&#x27; \\ -H &#x27;Content-Type: application/json&#x27; \\ -d &#x27;&#123; &quot;properties&quot;:&#123; &quot;remark&quot;:&#123; &quot;type&quot;:&quot;text&quot;, &quot;analyzer&quot;:&quot;ik_max_word&quot;, &quot;search_analyzer&quot;:&quot;ik_smart&quot; &#125;, &quot;address&quot;: &#123; &quot;type&quot;: &quot;text&quot;, &quot;analyzer&quot;: &quot;ik_max_word&quot;, &quot;fields&quot;: &#123; &quot;keyword&quot;: &#123; &quot;type&quot;: &quot;keyword&quot; &#125; &#125; &#125;, &quot;tags&quot;: &#123; &quot;type&quot;: &quot;keyword&quot; &#125;, &quot;created_at&quot;: &#123;&quot;type&quot;: &quot;date&quot;, &quot;format&quot;: &quot;yyyy-MM-dd HH:mm:ss&quot;&#125; &#125; &#125;&#x27;# å‚æ•°è¯´æ˜# è¿™é‡Œä¸ºç´¢å¼•æ·»åŠ äº†4ä¸ªå­—æ®µ# remarkï¼šæ–°å¢å­—æ®µï¼Œç±»å‹ä¸ºtextï¼Œåˆ†è¯å™¨ä¸ºik_max_wordï¼Œæœç´¢åˆ†è¯å™¨ä¸ºik_smart # analyzer: ç´¢å¼•åˆ†è¯å™¨ # search_analyzerï¼šæœç´¢åˆ†è¯å™¨ # ik_max_wordï¼šä¸­æ–‡åˆ†è¯å™¨ï¼Œå°†å¥å­æ‹†åˆ†ä¸ºæœ€å¤šè¯å…ƒï¼Œé€‚åˆé•¿å¥å­ # ik_smartï¼šä¸­æ–‡åˆ†è¯å™¨ï¼Œå°†å¥å­æ‹†åˆ†ä¸ºæœ€å°‘è¯å…ƒï¼Œé€‚åˆçŸ­å¥å­# addressï¼šæ–°å¢å­—æ®µï¼Œç±»å‹ä¸ºtextï¼Œåˆ†è¯å™¨ä¸ºik_max_wordï¼Œæœç´¢åˆ†è¯å™¨æœªæŒ‡å®šï¼Œé»˜è®¤ä¸åˆ†è¯å™¨åŒä¸€ä¸ªï¼Œè¿™é‡Œè¿˜ä¸ºaddressæ·»åŠ äº†keywordå­—æ®µï¼Œç”¨äºå­˜å‚¨åŸå§‹æ•°æ®ï¼Œä»¥æ”¯æŒç²¾ç¡®æœç´¢# tagsï¼šæ–°å¢å­—æ®µï¼Œç±»å‹ä¸ºkeywordï¼Œä¸æ”¯æŒåˆ†è¯ï¼Œé€‚åˆå­˜å‚¨çŸ­æ–‡æœ¬æ•°æ®ï¼ˆå¦‚æ ‡ç­¾ã€ç±»åˆ«ç­‰ï¼‰ï¼Œå¹¶ä¸”å¯ä»¥ç”¨äºèšåˆå’Œè¿‡æ»¤ï¼Œå¯ä»¥å­˜å‚¨æ•°ç»„# created_atï¼šæ–°å¢å­—æ®µï¼Œç±»å‹ä¸ºdateï¼Œæ ¼å¼ä¸ºyyyy-MM-dd HH:mm:ss# è¿”å›å€¼&#123;&quot;acknowledged&quot;:true&#125; æ›´æ–°ç´¢å¼•è®¾ç½® 1234567# PUT /&lt;target&gt;/_settings# æ³¨æ„è¿™é‡Œä¸èƒ½æ›´æ–°number_of_shardscurl -X PUT -u elastic:123456 -k &#x27;https://127.0.0.1:9200/shopping/_settings&#x27; \\ -H &#x27;Content-Type: application/json&#x27; \\ -d &#x27;&#123;&quot;number_of_replicas&quot;:&quot;1&quot;&#125;&#x27;# è¿”å›å€¼&#123;&quot;acknowledged&quot;:true&#125; æŸ¥çœ‹æŒ‡å®šç´¢å¼• 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364# GET /&lt;target&gt;curl -X GET -u elastic:123456 -k &#x27;https://127.0.0.1:9200/shopping?pretty&#x27;# è¿”å›å€¼&#123; &quot;shopping&quot; : &#123; &quot;aliases&quot; : &#123; &#125;, &quot;mappings&quot; : &#123; &quot;properties&quot; : &#123; &quot;address&quot; : &#123; &quot;type&quot; : &quot;text&quot;, &quot;fields&quot; : &#123; &quot;keyword&quot; : &#123; &quot;type&quot; : &quot;keyword&quot; &#125; &#125;, &quot;analyzer&quot; : &quot;ik_max_word&quot; &#125;, &quot;category&quot; : &#123; &quot;type&quot; : &quot;keyword&quot; &#125;, &quot;count&quot; : &#123; &quot;type&quot; : &quot;integer&quot; &#125;, &quot;created_at&quot; : &#123; &quot;type&quot; : &quot;date&quot;, &quot;format&quot; : &quot;yyyy-MM-dd HH:mm:ss&quot; &#125;, &quot;price&quot; : &#123; &quot;type&quot; : &quot;double&quot; &#125;, &quot;remark&quot; : &#123; &quot;type&quot; : &quot;text&quot;, &quot;analyzer&quot; : &quot;ik_max_word&quot;, &quot;search_analyzer&quot; : &quot;ik_smart&quot; &#125;, &quot;tags&quot; : &#123; &quot;type&quot; : &quot;keyword&quot; &#125;, &quot;title&quot; : &#123; &quot;type&quot; : &quot;text&quot; &#125; &#125; &#125;, &quot;settings&quot; : &#123; &quot;index&quot; : &#123; &quot;routing&quot; : &#123; &quot;allocation&quot; : &#123; &quot;include&quot; : &#123; &quot;_tier_preference&quot; : &quot;data_content&quot; &#125; &#125; &#125;, &quot;number_of_shards&quot; : &quot;1&quot;, &quot;provided_name&quot; : &quot;shopping&quot;, &quot;creation_date&quot; : &quot;1745291743120&quot;, &quot;number_of_replicas&quot; : &quot;1&quot;, &quot;uuid&quot; : &quot;Y1IWrdlQTUm-CbbIWweSxQ&quot;, &quot;version&quot; : &#123; &quot;created&quot; : &quot;8525000&quot; &#125; &#125; &#125; &#125;&#125; æŸ¥çœ‹ç´¢å¼•è®¾ç½® 1234567891011121314151617181920212223242526272829303132333435363738394041424344# GET /&lt;target&gt;/_settingscurl -X GET -u elastic:123456 -k &#x27;https://127.0.0.1:9200/shopping/_settings?pretty&#x27;# è¿”å›å€¼&#123; &quot;shopping&quot; : &#123; &quot;mappings&quot; : &#123; &quot;properties&quot; : &#123; &quot;address&quot; : &#123; &quot;type&quot; : &quot;text&quot;, &quot;fields&quot; : &#123; &quot;keyword&quot; : &#123; &quot;type&quot; : &quot;keyword&quot; &#125; &#125;, &quot;analyzer&quot; : &quot;ik_max_word&quot; &#125;, &quot;category&quot; : &#123; &quot;type&quot; : &quot;keyword&quot; &#125;, &quot;count&quot; : &#123; &quot;type&quot; : &quot;integer&quot; &#125;, &quot;created_at&quot; : &#123; &quot;type&quot; : &quot;date&quot;, &quot;format&quot; : &quot;yyyy-MM-dd HH:mm:ss&quot; &#125;, &quot;price&quot; : &#123; &quot;type&quot; : &quot;double&quot; &#125;, &quot;remark&quot; : &#123; &quot;type&quot; : &quot;text&quot;, &quot;analyzer&quot; : &quot;ik_max_word&quot;, &quot;search_analyzer&quot; : &quot;ik_smart&quot; &#125;, &quot;tags&quot; : &#123; &quot;type&quot; : &quot;keyword&quot; &#125;, &quot;title&quot; : &#123; &quot;type&quot; : &quot;text&quot; &#125; &#125; &#125; &#125;&#125; æŸ¥çœ‹å­—æ®µæ˜ å°„ 123456789101112131415161718# GET /&lt;target&gt;/_mapping/field/&lt;field&gt;# shopping ä¸ºç´¢å¼•åç§°ï¼Œtitle ä¸ºå­—æ®µåç§°curl -X GET -u elastic:123456 -k &#x27;https://127.0.0.1:9200/shopping/_mapping/field/title?pretty&#x27;# è¿”å›å€¼&#123; &quot;shopping&quot; : &#123; &quot;mappings&quot; : &#123; &quot;title&quot; : &#123; &quot;full_name&quot; : &quot;title&quot;, &quot;mapping&quot; : &#123; &quot;title&quot; : &#123; &quot;type&quot; : &quot;text&quot; &#125; &#125; &#125; &#125; &#125;&#125; åˆ¤æ–­ç´¢å¼•æ˜¯å¦å­˜åœ¨ 12345678910111213# ä½¿ç”¨ -I å‚æ•°æ¥å‘é€ HEAD è¯·æ±‚ï¼Œå¯ä»¥è·å–å“åº”å¤´è€Œä¸å¿…ä¸‹è½½å“åº”ä½“ã€‚# HEAD /&lt;target&gt;curl -I -u elastic:123456 -k &#x27;https://127.0.0.1:9200/shopping&#x27;# è¿”å›å€¼HTTP/1.1 200 OKX-elastic-product: Elasticsearchcontent-type: application/jsoncontent-length: 603# è¿™ä¸ªå‘½ä»¤ä¸ä¼šè¿”å›å“åº”ä½“ï¼Œä½†å®ƒçš„ HTTP å“åº”ä»£ç å¯ä»¥å‘Šè¯‰ä½ ç´¢å¼•çš„å­˜åœ¨æƒ…å†µï¼š # 200 OK è¡¨ç¤ºç´¢å¼•å­˜åœ¨ã€‚ # 404 Not Found è¡¨ç¤ºç´¢å¼•ä¸å­˜åœ¨ã€‚ åˆ é™¤ç´¢å¼• 1234# DELETE /&lt;target&gt;curl -X DELETE -u elastic:123456 -k &#x27;https://127.0.0.1:9200/shopping&#x27;# è¿”å›å€¼&#123;&quot;acknowledged&quot;:true&#125; ä¸ºç´¢å¼•åˆ›å»ºåˆ«å 123456789101112131415161718192021# æ³¨æ„ï¼šä¸åŒç´¢å¼•å¯ä»¥æœ‰ç›¸åŒåç§°çš„åˆ«åï¼Œæ‰€ä»¥åœ¨æ•°æ®ç»“æ„ä¸€è‡´çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥ä¸ºä¸åŒçš„ç´¢å¼•åˆ›å»ºç›¸åŒçš„åˆ«åï¼Œç„¶åæ ¹æ®åˆ«åè¿›è¡Œæ•°æ®æŸ¥è¯¢# POST /&lt;target&gt;/_alias/&lt;alias&gt;curl -X POST -u elastic:123456 -k &#x27;https://127.0.0.1:9200/shopping/_alias/shopping_alias&#x27;# è¿”å›å€¼&#123;&quot;acknowledged&quot;:true&#125;# ä¹Ÿå¯ä»¥ä½¿ç”¨å¦‚ä¸‹æ–¹æ³•curl -X POST -u elastic:123456 -k &#x27;https://127.0.0.1:9200/_aliases&#x27; \\ -H &#x27;Content-Type: application/json&#x27; \\ -d &#x27;&#123; &quot;actions&quot;: [ &#123; &quot;add&quot;: &#123; &quot;index&quot;: &quot;shopping&quot;, &quot;alias&quot;: &quot;shopping_alias2&quot; &#125; &#125; ] &#125;&#x27;# è¿”å›å€¼&#123;&quot;acknowledged&quot;:true&#125; æŸ¥çœ‹ç´¢å¼•åˆ«å 12345678910111213141516# GET /&lt;target&gt;/_alias/&lt;alias&gt;curl -X GET -u elastic:123456 -k &#x27;https://127.0.0.1:9200/shopping/_alias/shopping_alias?pretty&#x27;# è¿”å›å€¼&#123; &quot;shopping&quot; : &#123; &quot;aliases&quot; : &#123; &quot;shopping_alias&quot; : &#123; &#125; &#125; &#125;&#125;# æŸ¥çœ‹å½“å‰ç´¢å¼•çš„æ‰€æœ‰åˆ«åcurl -X GET -u elastic:123456 -k &#x27;https://127.0.0.1:9200/shopping/_alias?pretty&#x27;# æŸ¥çœ‹æ‰€æœ‰ç´¢å¼•çš„åˆ«åcurl -X GET -u elastic:123456 -k &#x27;https://127.0.0.1:9200/_alias?pretty&#x27; ä¸ºç´¢å¼•åˆ é™¤åˆ«å 1234# DELETE /&lt;target&gt;/_alias/&lt;alias&gt;curl -X DELETE -u elastic:123456 -k &#x27;https://127.0.0.1:9200/shopping/_alias/shopping_alias&#x27;# è¿”å›å€¼&#123;&quot;acknowledged&quot;:true&#125; å¦‚ä½•ä¿®æ”¹ç´¢å¼•å­—æ®µç±»å‹æˆ–åˆ†è¯å™¨ç±»å‹ï¼Ÿ åˆ›å»ºæ–°çš„ç´¢å¼• 123456789101112131415161718192021222324252627282930313233343536373839404142434445# è¿™é‡Œä¸ºtitleå­—æ®µå¢åŠ åˆ†è¯å™¨curl -X PUT -u elastic:123456 -k &#x27;https://127.0.0.1:9200/shopping_new&#x27; \\ -H &#x27;Content-Type: application/json&#x27; \\ -d &#x27;&#123; &quot;settings&quot;:&#123; &quot;number_of_shards&quot;:&quot;1&quot;, &quot;number_of_replicas&quot;:&quot;2&quot; &#125;, &quot;mappings&quot;:&#123; &quot;properties&quot;:&#123; &quot;category&quot;:&#123; &quot;type&quot;:&quot;keyword&quot; &#125;, &quot;price&quot;:&#123; &quot;type&quot;:&quot;double&quot; &#125;, &quot;count&quot;:&#123; &quot;type&quot;:&quot;integer&quot; &#125;, &quot;title&quot;:&#123; &quot;type&quot;:&quot;text&quot;, &quot;analyzer&quot;:&quot;ik_max_word&quot;, &quot;search_analyzer&quot;:&quot;ik_smart&quot; &#125;, &quot;remark&quot;:&#123; &quot;type&quot;:&quot;text&quot;, &quot;analyzer&quot;:&quot;ik_max_word&quot;, &quot;search_analyzer&quot;:&quot;ik_smart&quot; &#125;, &quot;address&quot;: &#123; &quot;type&quot;: &quot;text&quot;, &quot;analyzer&quot;: &quot;ik_max_word&quot;, &quot;fields&quot;: &#123; &quot;keyword&quot;: &#123; &quot;type&quot;: &quot;keyword&quot; &#125; &#125; &#125;, &quot;tags&quot;: &#123; &quot;type&quot;: &quot;keyword&quot; &#125;, &quot;created_at&quot;: &#123;&quot;type&quot;: &quot;date&quot;, &quot;format&quot;: &quot;yyyy-MM-dd HH:mm:ss&quot;&#125; &#125; &#125; &#125;&#x27; å°†åŸç´¢å¼•çš„æ•°æ®è¿ç§»åˆ°æ–°ç´¢å¼• 123456789101112curl -X POST -u elastic:123456 -k &#x27;https://127.0.0.1:9200/_reindex&#x27; \\ -H &#x27;Content-Type: application/json&#x27; \\ -d &#x27;&#123; &quot;source&quot;: &#123; &quot;index&quot;: &quot;shopping&quot; &#125;, &quot;dest&quot;: &#123; &quot;index&quot;: &quot;shopping_new&quot; &#125;&#125;&#x27;# è¿”å›å€¼&#123;&quot;took&quot;:101,&quot;timed_out&quot;:false,&quot;total&quot;:2,&quot;updated&quot;:0,&quot;created&quot;:2,&quot;deleted&quot;:0,&quot;batches&quot;:1,&quot;version_conflicts&quot;:0,&quot;noops&quot;:0,&quot;retries&quot;:&#123;&quot;bulk&quot;:0,&quot;search&quot;:0&#125;,&quot;throttled_millis&quot;:0,&quot;requests_per_second&quot;:-1.0,&quot;throttled_until_millis&quot;:0,&quot;failures&quot;:[]&#125; åˆ é™¤åŸç´¢å¼• 123curl -X DELETE -u elastic:123456 -k &#x27;https://127.0.0.1:9200/shopping&#x27;# è¿”å›å€¼&#123;&quot;acknowledged&quot;:true&#125; ä¸ºæ–°ç´¢å¼•åˆ›å»ºåˆ«å 123curl -X POST -u elastic:123456 -k &#x27;https://127.0.0.1:9200/shopping_new/_alias/shopping&#x27;# è¿”å›å€¼&#123;&quot;acknowledged&quot;:true,&quot;errors&quot;:false&#125; æ•°æ®å¢åˆ æ”¹åŸºæœ¬æ“ä½œ æ–°å¢æ•°æ® 1.ä¸ºæŒ‡å®šç´¢å¼•æ’å…¥ä¸€æ¡æ•°æ®(_docæ–¹å¼ï¼šä¸æŒ‡å®šidé»˜è®¤éšæœºå­—ç¬¦ä¸²) 12345678910111213141516171819202122232425262728# _doc çš„æ–¹å¼åˆ›å»ºç´¢å¼•æ•°æ®æ—¶ï¼Œå¯ä»¥ä¸æŒ‡å®šidï¼Œé»˜è®¤ä¼šåˆ›å»ºæ–°çš„idï¼Œidç±»å‹ä¸ºéšæœºå­—ç¬¦ä¸²# POST /&lt;target&gt;/_doccurl -X POST -u elastic:123456 -k &#x27;https://127.0.0.1:9200/shopping/_doc?pretty&#x27; \\ -H &#x27;Content-Type: application/json&#x27; \\ -d &#x27;&#123; &quot;category&quot;: &quot;electronics&quot;, &quot;price&quot;: 999.99, &quot;count&quot;: 10, &quot;title&quot;: &quot;Smartphone X - 128GB&quot;, &quot;remark&quot;: &quot;This latest Smartphone X comes with a powerful processor and high-resolution camera.&quot;, &quot;address&quot;: &quot;123 Electronic Ave, Beijing, China&quot;, &quot;tags&quot;: [&quot;latest&quot;, &quot;smartphone&quot;, &quot;technology&quot;], &quot;created_at&quot;: &quot;2025-04-22 03:30:02&quot; &#125;&#x27;# è¿”å›å€¼&#123; &quot;_index&quot; : &quot;shopping_new&quot;, &quot;_id&quot; : &quot;sImNW5YBmgASmV9McVvI&quot;, &quot;_version&quot; : 1, &quot;result&quot; : &quot;created&quot;, &quot;_shards&quot; : &#123; &quot;total&quot; : 3, &quot;successful&quot; : 1, &quot;failed&quot; : 0 &#125;, &quot;_seq_no&quot; : 1, &quot;_primary_term&quot; : 1&#125; 2.ä¸ºæŒ‡å®šç´¢å¼•æ’å…¥ä¸€æ¡æ•°æ®(_docæ–¹å¼ï¼šæŒ‡å®šid) 12345678910111213141516171819202122232425262728# _doc çš„æ–¹å¼åˆ›å»ºç´¢å¼•æ•°æ®æ—¶ï¼Œå¦‚æœæŒ‡å®šidï¼Œå†æ¬¡æ‰§è¡Œæ—¶ä¼šå…ˆåˆ é™¤åŸæ•°æ®å†åˆ›å»ºæ–°æ•°æ®ï¼Œæ‰€ä»¥å¿…é¡»å…¨é‡æ›´æ–°æ‰è¡Œã€‚# PUT /&lt;target&gt;/_doccurl -X PUT -u elastic:123456 -k &#x27;https://127.0.0.1:9200/shopping/_doc/100?pretty&#x27; \\ -H &#x27;Content-Type: application/json&#x27; \\ -d &#x27;&#123; &quot;category&quot;: &quot;electronics&quot;, &quot;price&quot;: 999.99, &quot;count&quot;: 10, &quot;title&quot;: &quot;Smartphone X - 128GB&quot;, &quot;remark&quot;: &quot;This latest Smartphone X comes with a powerful processor and high-resolution camera.&quot;, &quot;address&quot;: &quot;123 Electronic Ave, Beijing, China&quot;, &quot;tags&quot;: [&quot;latest&quot;, &quot;smartphone&quot;, &quot;technology&quot;], &quot;created_at&quot;: &quot;2025-04-22 03:30:02&quot; &#125;&#x27;# è¿”å›å€¼&#123; &quot;_index&quot; : &quot;shopping_new&quot;, &quot;_id&quot; : &quot;100&quot;, &quot;_version&quot; : 1, &quot;result&quot; : &quot;created&quot;, &quot;_shards&quot; : &#123; &quot;total&quot; : 3, &quot;successful&quot; : 1, &quot;failed&quot; : 0 &#125;, &quot;_seq_no&quot; : 2, &quot;_primary_term&quot; : 1&#125; 3.ä¸ºæŒ‡å®šç´¢å¼•æ’å…¥ä¸€æ¡æ•°æ®(_createæ–¹å¼ï¼šæŒ‡å®šid) 1234567891011121314# _create çš„æ–¹å¼åˆ›å»ºç´¢å¼•æ•°æ®æ—¶ï¼Œå¿…é¡»æŒ‡å®šid,è€Œä¸”åªèƒ½æ‰§è¡Œä¸€æ¬¡ï¼Œå› ä¸ºæ‰§è¡Œè¿‡ä¸€æ¬¡åæŒ‡å®šidçš„æ•°æ®å°±å­˜åœ¨äº†ï¼Œä¸èƒ½å†æ¬¡åˆ›å»º# POST /&lt;target&gt;/_create/&lt;id&gt;curl -X POST -u elastic:123456 -k &#x27;https://127.0.0.1:9200/shopping/_create/1?pretty&#x27; \\ -H &#x27;Content-Type: application/json&#x27; \\ -d &#x27;&#123; &quot;category&quot;: &quot;electronics&quot;, &quot;price&quot;: 999.99, &quot;count&quot;: 10, &quot;title&quot;: &quot;Smartphone X - 128GB&quot;, &quot;remark&quot;: &quot;This latest Smartphone X comes with a powerful processor and high-resolution camera.&quot;, &quot;address&quot;: &quot;123 Electronic Ave, Beijing, China&quot;, &quot;tags&quot;: [&quot;latest&quot;, &quot;smartphone&quot;, &quot;technology&quot;], &quot;created_at&quot;: &quot;2025-04-22 03:30:02&quot; &#125;&#x27; ä¿®æ”¹æ•°æ® 1.ä¿®æ”¹å…¨éƒ¨æ•°æ® 1234567891011121314# POST /&lt;target&gt;/_doc/&lt;id&gt;# æ‰§è¡Œæ—¶ä¼šå…ˆåˆ é™¤åŸæ•°æ®å†åˆ›å»ºæ–°æ•°æ®ï¼Œæ‰€ä»¥å¿…é¡»å…¨é‡æ›´æ–°æ‰è¡Œã€‚curl -X POST -u elastic:123456 -k &#x27;https://127.0.0.1:9200/shopping/_doc/sImNW5YBmgASmV9McVvI&#x27; \\ -H &#x27;Content-Type: application/json&#x27; \\ -d &#x27;&#123; &quot;category&quot;: &quot;electronics&quot;, &quot;price&quot;: 999.99, &quot;count&quot;: 20, &quot;title&quot;: &quot;Smartphone X - 128GB&quot;, &quot;remark&quot;: &quot;This latest Smartphone X comes with a powerful processor and high-resolution camera.&quot;, &quot;address&quot;: &quot;123 Electronic Ave, Beijing, China&quot;, &quot;tags&quot;: [&quot;latest&quot;, &quot;smartphone&quot;, &quot;technology&quot;], &quot;created_at&quot;: &quot;2025-04-22 03:30:02&quot; &#125;&#x27; 2.ä¿®æ”¹éƒ¨åˆ†æ•°æ® 12345# POST /&lt;target&gt;/_update/&lt;id&gt;# æ‰§è¡Œæ—¶åªä¼šä¿®æ”¹æŒ‡å®šå­—æ®µï¼Œä¸ä¼šåˆ é™¤åŸæ•°æ®ï¼Œæ‰€ä»¥å¯ä»¥éƒ¨åˆ†æ›´æ–°ã€‚curl -X POST -u elastic:123456 -k &#x27;https://127.0.0.1:9200/shopping/_update/1&#x27; \\ -H &#x27;Content-Type: application/json&#x27; \\ -d &#x27;&#123;&quot;doc&quot;:&#123;&quot;count&quot;:100&#125;&#125;&#x27; æŸ¥è¯¢æŒ‡å®šç´¢å¼•çš„æŒ‡å®šidçš„æ•°æ® 12345678910111213141516171819202122232425# GET /&lt;target&gt;/_doc/&lt;id&gt;curl -X GET -u elastic:123456 -k &#x27;https://127.0.0.1:9200/shopping/_doc/100?pretty&#x27;# è¿”å›å€¼&#123; &quot;_index&quot; : &quot;shopping_new&quot;, &quot;_id&quot; : &quot;100&quot;, &quot;_version&quot; : 1, &quot;_seq_no&quot; : 2, &quot;_primary_term&quot; : 1, &quot;found&quot; : true, &quot;_source&quot; : &#123; &quot;category&quot; : &quot;electronics&quot;, &quot;price&quot; : 999.99, &quot;count&quot; : 10, &quot;title&quot; : &quot;Smartphone X - 128GB&quot;, &quot;remark&quot; : &quot;This latest Smartphone X comes with a powerful processor and high-resolution camera.&quot;, &quot;address&quot; : &quot;123 Electronic Ave, Beijing, China&quot;, &quot;tags&quot; : [ &quot;latest&quot;, &quot;smartphone&quot;, &quot;technology&quot; ], &quot;created_at&quot; : &quot;2025-04-22 03:30:02&quot; &#125;&#125; åˆ é™¤æŒ‡å®šç´¢å¼•çš„æŒ‡å®šidçš„æ•°æ® 12# DELETE /&lt;target&gt;/_doc/&lt;id&gt;curl -X DELETE -u elastic:123456 -k &#x27;https://127.0.0.1:9200/shopping/_doc/100&#x27; åˆ é™¤ç´¢å¼•å…¨éƒ¨æ•°æ® 123curl -X POST -u elastic:123456 -k &#x27;https://127.0.0.1:9200/shopping/_delete_by_query?pretty&#x27; \\ -H &#x27;Content-Type: application/json&#x27; \\ -d &#x27;&#123;&quot;query&quot;:&#123;&quot;match_all&quot;:&#123;&#125;&#125;&#125;&#x27; æ‰¹é‡æ“ä½œ æ‰¹é‡æ–°å¢æ•°æ® 1234567891011121314151617181920212223242526272829303132333435363738394041# æ³¨æ„æ•°æ®è¡Œè¦é¡¶è¡Œå†™ï¼Œå‰é¢ä¸è¦æœ‰ç©ºæ ¼# POST /_bulkcurl -X POST -u elastic:123456 -k &#x27;https://127.0.0.1:9200/_bulk&#x27; \\ -H &#x27;Content-Type: application/json&#x27; \\ -d &#x27;&#123; &quot;index&quot;: &#123; &quot;_index&quot;: &quot;shopping&quot;, &quot;_id&quot;: &quot;1&quot; &#125; &#125;&#123; &quot;category&quot;: &quot;electronics&quot;, &quot;price&quot;: 999.99, &quot;count&quot;: 10, &quot;title&quot;: &quot;Smartphone X - 128GB&quot;, &quot;remark&quot;: &quot;This latest Smartphone X comes with a powerful processor and high-resolution camera.&quot;, &quot;address&quot;: &quot;å¹¿å·å¤©æ²³å…¬å›­&quot;, &quot;tags&quot;: [&quot;latest&quot;, &quot;smartphone&quot;, &quot;technology&quot;], &quot;created_at&quot;: &quot;2025-04-22 03:30:02&quot; &#125;&#123; &quot;index&quot;: &#123; &quot;_index&quot;: &quot;shopping&quot;, &quot;_id&quot;: &quot;2&quot; &#125; &#125;&#123; &quot;category&quot;: &quot;fashion&quot;, &quot;price&quot;: 49.99, &quot;count&quot;: 25, &quot;title&quot;: &quot;Designer T-shirt&quot;, &quot;remark&quot;: &quot;Trendy designer T-shirt made with high quality fabric.&quot;, &quot;address&quot;: &quot;å¹¿å·è”æ¹¾å¤§å¦&quot;, &quot;tags&quot;: [&quot;clothing&quot;, &quot;designer&quot;, &quot;style&quot;], &quot;created_at&quot;: &quot;2025-04-21 12:15:00&quot; &#125;&#123; &quot;index&quot;: &#123; &quot;_index&quot;: &quot;shopping&quot;, &quot;_id&quot;: &quot;3&quot; &#125; &#125;&#123; &quot;category&quot;: &quot;home_appliances&quot;, &quot;price&quot;: 299.99, &quot;count&quot;: 5, &quot;title&quot;: &quot;Robot Vacuum Cleaner&quot;, &quot;remark&quot;: &quot;Efficient robot vacuum cleaner with smart navigation.&quot;, &quot;address&quot;: &quot;å¹¿å·ç™½äº‘å±±å…¬å›­&quot;, &quot;tags&quot;: [&quot;appliances&quot;, &quot;vacuum&quot;, &quot;robot&quot;], &quot;created_at&quot;: &quot;2025-04-20 08:45:30&quot; &#125;&#123; &quot;index&quot;: &#123; &quot;_index&quot;: &quot;shopping&quot;, &quot;_id&quot;: &quot;4&quot; &#125; &#125;&#123; &quot;category&quot;: &quot;books&quot;, &quot;price&quot;: 19.99, &quot;count&quot;: 100, &quot;title&quot;: &quot;Inspirational Novel&quot;, &quot;remark&quot;: &quot;A gripping novel that inspires and motivates.&quot;, &quot;address&quot;: &quot;321 Book Rd, Shenzhen, China&quot;, &quot;tags&quot;: [&quot;book&quot;, &quot;novel&quot;, &quot;inspiration&quot;], &quot;created_at&quot;: &quot;2025-04-19 10:05:00&quot; &#125;&#123; &quot;index&quot;: &#123; &quot;_index&quot;: &quot;shopping&quot;, &quot;_id&quot;: &quot;5&quot; &#125; &#125;&#123; &quot;category&quot;: &quot;groceries&quot;, &quot;price&quot;: 3.99, &quot;count&quot;: 200, &quot;title&quot;: &quot;Organic Apples&quot;, &quot;remark&quot;: &quot;Fresh and crispy organic apples.&quot;, &quot;address&quot;: &quot;654 Grocery Ln, Chengdu, China&quot;, &quot;tags&quot;: [&quot;fruit&quot;, &quot;organic&quot;, &quot;healthy&quot;], &quot;created_at&quot;: &quot;2025-04-18 14:30:45&quot; &#125;&#123; &quot;index&quot;: &#123; &quot;_index&quot;: &quot;shopping&quot;, &quot;_id&quot;: &quot;6&quot; &#125; &#125;&#123; &quot;category&quot;: &quot;electronics&quot;, &quot;price&quot;: 1999.99, &quot;count&quot;: 15, &quot;title&quot;: &quot;Smartphone X - 256GB&quot;, &quot;remark&quot;: &quot;This latest Smartphone X comes with a powerful processor and high-resolution camera.&quot;, &quot;address&quot;: &quot;å¹¿å·å¤©æ²³å…¬å›­&quot;, &quot;tags&quot;: [&quot;latest&quot;, &quot;smartphone&quot;, &quot;technology&quot;], &quot;created_at&quot;: &quot;2025-04-22 03:30:02&quot; &#125;&#x27;# å‚æ•°è¯´æ˜# index: ç”¨äºåˆ›å»ºæ–°æ–‡æ¡£æˆ–æ›¿æ¢å·²æœ‰æ–‡æ¡£ã€‚# create: ç”¨äºåˆ›å»ºæ–°æ–‡æ¡£ï¼Œå¦‚æœæ–‡æ¡£å·²å­˜åœ¨ï¼Œåˆ™è¿”å›é”™è¯¯ã€‚# _index: æŒ‡å®šç´¢å¼•åç§°ã€‚# _id: æŒ‡å®šæ–‡æ¡£IDã€‚å¦‚æœä¸æŒ‡å®šåˆ™ä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªéšæœºçš„IDã€‚# æ‰¹é‡æ–°å¢æ•°æ®æ—¶ä¹Ÿå¯ä»¥åœ¨urlä¸­æŒ‡å®šç´¢å¼•åç§°# æ­¤æ—¶å¯ä»¥æŒ‡å®šidï¼Œå¦‚æœä¸æŒ‡å®šåˆ™è‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªéšæœºå­—ç¬¦ä¸²çš„ID# POST /&lt;target&gt;/_bulkcurl -X POST -u elastic:123456 -k &#x27;https://127.0.0.1:9200/shopping/_bulk&#x27; \\ -H &#x27;Content-Type: application/json&#x27; \\ -d &#x27;&#123; &quot;index&quot;: &#123;&#125; &#125;&#123; &quot;category&quot;: &quot;electronics&quot;, &quot;price&quot;: 999.99, &quot;count&quot;: 10, &quot;title&quot;: &quot;Smartphone X - 128GB&quot;, &quot;remark&quot;: &quot;This latest Smartphone X comes with a powerful processor and high-resolution camera.&quot;, &quot;address&quot;: &quot;å¹¿å·å¤©æ²³å…¬å›­&quot;, &quot;tags&quot;: [&quot;latest&quot;, &quot;smartphone&quot;, &quot;technology&quot;], &quot;created_at&quot;: &quot;2025-04-22 03:30:02&quot; &#125;&#123; &quot;index&quot;: &#123;&#125; &#125;&#123; &quot;category&quot;: &quot;fashion&quot;, &quot;price&quot;: 49.99, &quot;count&quot;: 25, &quot;title&quot;: &quot;Designer T-shirt&quot;, &quot;remark&quot;: &quot;Trendy designer T-shirt made with high quality fabric.&quot;, &quot;address&quot;: &quot;å¹¿å·è”æ¹¾å¤§å¦&quot;, &quot;tags&quot;: [&quot;clothing&quot;, &quot;designer&quot;, &quot;style&quot;], &quot;created_at&quot;: &quot;2025-04-21 12:15:00&quot; &#125;&#123; &quot;index&quot;: &#123;&#125; &#125;&#123; &quot;category&quot;: &quot;home_appliances&quot;, &quot;price&quot;: 299.99, &quot;count&quot;: 5, &quot;title&quot;: &quot;Robot Vacuum Cleaner&quot;, &quot;remark&quot;: &quot;Efficient robot vacuum cleaner with smart navigation.&quot;, &quot;address&quot;: &quot;å¹¿å·ç™½äº‘å±±å…¬å›­&quot;, &quot;tags&quot;: [&quot;appliances&quot;, &quot;vacuum&quot;, &quot;robot&quot;], &quot;created_at&quot;: &quot;2025-04-20 08:45:30&quot; &#125;&#123; &quot;index&quot;: &#123;&#125; &#125;&#123; &quot;category&quot;: &quot;books&quot;, &quot;price&quot;: 19.99, &quot;count&quot;: 100, &quot;title&quot;: &quot;Inspirational Novel&quot;, &quot;remark&quot;: &quot;A gripping novel that inspires and motivates.&quot;, &quot;address&quot;: &quot;321 Book Rd, Shenzhen, China&quot;, &quot;tags&quot;: [&quot;book&quot;, &quot;novel&quot;, &quot;inspiration&quot;], &quot;created_at&quot;: &quot;2025-04-19 10:05:00&quot; &#125;&#123; &quot;index&quot;: &#123;&#125; &#125;&#123; &quot;category&quot;: &quot;groceries&quot;, &quot;price&quot;: 3.99, &quot;count&quot;: 200, &quot;title&quot;: &quot;Organic Apples&quot;, &quot;remark&quot;: &quot;Fresh and crispy organic apples.&quot;, &quot;address&quot;: &quot;654 Grocery Ln, Chengdu, China&quot;, &quot;tags&quot;: [&quot;fruit&quot;, &quot;organic&quot;, &quot;healthy&quot;], &quot;created_at&quot;: &quot;2025-04-18 14:30:45&quot; &#125;&#123; &quot;index&quot;: &#123;&#125; &#125;&#123; &quot;category&quot;: &quot;electronics&quot;, &quot;price&quot;: 1999.99, &quot;count&quot;: 15, &quot;title&quot;: &quot;Smartphone X - 256GB&quot;, &quot;remark&quot;: &quot;This latest Smartphone X comes with a powerful processor and high-resolution camera.&quot;, &quot;address&quot;: &quot;å¹¿å·å¤©æ²³å…¬å›­&quot;, &quot;tags&quot;: [&quot;latest&quot;, &quot;smartphone&quot;, &quot;technology&quot;], &quot;created_at&quot;: &quot;2025-04-22 03:30:02&quot; &#125;&#x27; æ‰¹é‡ä¿®æ”¹æ•°æ® 1234567891011# æ³¨æ„æ•°æ®è¡Œè¦é¡¶è¡Œå†™ï¼Œå‰é¢ä¸è¦æœ‰ç©ºæ ¼curl -X POST -u elastic:123456 -k &#x27;https://127.0.0.1:9200/_bulk&#x27; \\ -H &#x27;Content-Type: application/json&#x27; \\ -d &#x27;&#123;&quot;update&quot;:&#123;&quot;_index&quot;:&quot;shopping&quot;,&quot;_id&quot;:&quot;1&quot;&#125;&#125;&#123;&quot;doc&quot;:&#123;&quot;title&quot;:&quot;Smartphone X2 - 128GB&quot;,&quot;price&quot;:1000.11&#125;&#125;&#123;&quot;update&quot;:&#123;&quot;_index&quot;:&quot;shopping&quot;,&quot;_id&quot;:&quot;2&quot;&#125;&#125;&#123;&quot;doc&quot;:&#123;&quot;title&quot;:&quot;T-shirt&quot;,&quot;price&quot;:45.99&#125;&#125;&#x27;# å‚æ•°è¯´æ˜# update: ç”¨äºæ›´æ–°æ–‡æ¡£ã€‚# doc: æŒ‡å®šè¦æ›´æ–°çš„å­—æ®µã€‚ æ‰¹é‡åˆ é™¤æ•°æ® 12345678910# æ³¨æ„æ•°æ®è¡Œè¦é¡¶è¡Œå†™ï¼Œå‰é¢ä¸è¦æœ‰ç©ºæ ¼curl -X POST -u elastic:123456 -k &#x27;https://127.0.0.1:9200/_bulk&#x27; \\ -H &#x27;Content-Type: application/json&#x27; \\ -d &#x27;&#123;&quot;delete&quot;:&#123;&quot;_index&quot;:&quot;shopping&quot;,&quot;_id&quot;:&quot;1&quot;&#125;&#125;&#123;&quot;delete&quot;:&#123;&quot;_index&quot;:&quot;shopping&quot;,&quot;_id&quot;:&quot;2&quot;&#125;&#125;&#123;&quot;delete&quot;:&#123;&quot;_index&quot;:&quot;shopping&quot;,&quot;_id&quot;:&quot;3&quot;&#125;&#125;&#123;&quot;delete&quot;:&#123;&quot;_index&quot;:&quot;shopping&quot;,&quot;_id&quot;:&quot;4&quot;&#125;&#125;&#x27;# å‚æ•°è¯´æ˜# delete: ç”¨äºåˆ é™¤æ–‡æ¡£ã€‚ æ¡ä»¶æ›´æ–° 123456789101112131415161718192021# POST /&lt;target&gt;/_update_by_query# è¿™é‡Œå°†categoryä¸ºåä¸ºçš„æ•°æ®ä»·æ ¼æ”¹ä¸º1999curl -X POST -u elastic:123456 -k &#x27;https://127.0.0.1:9200/shopping/_update_by_query?pretty&#x27; \\ -H &#x27;Content-Type: application/json&#x27; \\ -d &#x27;&#123; &quot;query&quot;: &#123; &quot;match&quot;: &#123; &quot;category&quot;: &quot;books&quot; &#125; &#125;, &quot;script&quot;: &#123; &quot;source&quot;: &quot;ctx._source.price = 20.99&quot;, &quot;lang&quot;: &quot;painless&quot; &#125; &#125;&#x27;# å‚æ•°è¯´æ˜## &quot;query&quot;: &#123;&#125; æŸ¥è¯¢æ¡ä»¶## &quot;script&quot;: &#123;&#125; è„šæœ¬### source: è„šæœ¬å†…å®¹### lang: è„šæœ¬è¯­è¨€#### painless æ˜¯ Elasticsearch å®˜æ–¹æä¾›çš„è„šæœ¬è¯­è¨€ï¼Œå®ƒæä¾›äº†è®¸å¤šå†…ç½®å‡½æ•°å’Œå˜é‡ï¼Œå¯ä»¥æ–¹ä¾¿åœ°å®ç°å„ç§å¤æ‚çš„é€»è¾‘æ“ä½œã€‚https://www.elastic.co/guide/en/elasticsearch/painless/current/painless-lang-spec.html æ¡ä»¶åˆ é™¤ 1234# POST /&lt;target&gt;/_delete_by_querycurl -X POST -u elastic:123456 -k &#x27;https://127.0.0.1:9200/shopping/_delete_by_query?pretty&#x27; \\ -H &#x27;Content-Type: application/json&#x27; \\ -d &#x27;&#123;&quot;query&quot;:&#123;&quot;match&quot;:&#123;&quot;category&quot;:&quot;books&quot;&#125;&#125;&#125;&#x27; æ¡ä»¶æŸ¥è¯¢ match_all: å…¨éƒ¨åŒ¹é…æŸ¥è¯¢ 1234567# GET /&lt;target&gt;/_searchcurl -X GET -u elastic:123456 -k &#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27; -H &#x27;Content-Type: application/json&#x27; \\ -d &#x27;&#123;&quot;query&quot;:&#123;&quot;match_all&quot;:&#123;&#125;&#125;&#125;&#x27;# æˆ–è€…ç®€å†™ä¸ºcurl -X GET -u elastic:123456 -k &#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27; term: ç²¾ç¡®åŒ¹é…æŸ¥è¯¢ï¼ˆå…³é”®å­—æŸ¥è¯¢ï¼Œå³ä¸åˆ†è¯ï¼‰ 12345678910111213curl -X GET -u elastic:123456 -k &#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27; \\ -H &#x27;Content-Type: application/json&#x27; \\ -d &#x27;&#123;&quot;query&quot;:&#123;&quot;term&quot;:&#123;&quot;category&quot;:&quot;electronics&quot;&#125;&#125;&#125;&#x27;# å¦‚æœå­—æ®µè¢«é¢å¤–è®¾ç½® keyword ç±»å‹ï¼Œåˆ™éœ€è¦åŠ ä¸Š .keyword åç¼€curl -X GET -u elastic:123456 -k &#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27; \\ -H &#x27;Content-Type: application/json&#x27; \\ -d &#x27;&#123;&quot;query&quot;:&#123;&quot;term&quot;:&#123;&quot;address.keyword&quot;:&quot;å¹¿å·ç™½äº‘å±±å…¬å›­&quot;&#125;&#125;&#125;&#x27;# termå¤„ç†å¤šå€¼å­—æ®µ(æ•°ç»„)æ—¶ï¼ŒtermæŸ¥è¯¢æ˜¯åŒ…å«ï¼Œä¸æ˜¯ç­‰äºcurl -X GET -u elastic:123456 -k &#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27; \\ -H &#x27;Content-Type: application/json&#x27; \\ -d &#x27;&#123;&quot;query&quot;:&#123;&quot;term&quot;:&#123;&quot;tags&quot;:&quot;technology&quot;&#125;&#125;&#125;&#x27; terms: å¤šå…³é”®å­—ç²¾ç¡®åŒ¹é…æŸ¥è¯¢ 123curl -X GET -u elastic:123456 -k &#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27; \\ -H &#x27;Content-Type: application/json&#x27; \\ -d &#x27;&#123;&quot;query&quot;:&#123;&quot;terms&quot;:&#123;&quot;category&quot;:[&quot;electronics&quot;,&quot;books&quot;]&#125;&#125;&#125;&#x27; range: èŒƒå›´æŸ¥è¯¢ 12345678910111213141516171819202122232425curl -X GET -u elastic:123456 -k &#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27; \\ -H &#x27;Content-Type: application/json&#x27; \\ -d &#x27;&#123;&quot;query&quot;:&#123;&quot;range&quot;:&#123;&quot;price&quot;:&#123;&quot;gte&quot;:20,&quot;lte&quot;:30&#125;&#125;&#125;&#125;&#x27; # gte: å¤§äºç­‰äº # lte: å°äºç­‰äº # gt: å¤§äº # lt: å°äº# æ—¶é—´èŒƒå›´æŸ¥è¯¢curl -X GET -u elastic:123456 -k &#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27; \\ -H &#x27;Content-Type: application/json&#x27; \\ -d &#x27;&#123;&quot;query&quot;:&#123;&quot;range&quot;:&#123;&quot;created_at&quot;:&#123;&quot;gte&quot;:&quot;2025-04-20 00:00:00&quot;,&quot;lte&quot;:&quot;2025-05-20 23:59:59&quot;&#125;&#125;&#125;&#125;&#x27;# åŸºäºæ—¥æœŸæ•°å­¦è¡¨è¾¾å¼æŸ¥è¯¢curl -X GET -u elastic:123456 -k &#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27; \\ -H &#x27;Content-Type: application/json&#x27; \\ -d &#x27;&#123;&quot;query&quot;:&#123;&quot;range&quot;:&#123;&quot;created_at&quot;:&#123;&quot;gte&quot;:&quot;now-1y&quot;&#125;&#125;&#125;&#125;&#x27;# æ”¯æŒçš„æ—¥æœŸè¡¨è¾¾å¼# - nowï¼šå½“å‰æ—¶é—´ç‚¹ã€‚# - now-1dï¼šä»å½“å‰æ—¶é—´ç‚¹å‘å‰æ¨1å¤©çš„æ—¶é—´ç‚¹ã€‚# - now-1wï¼šä»å½“å‰æ—¶é—´ç‚¹å‘å‰æ¨1å‘¨çš„æ—¶é—´ç‚¹ã€‚# - now-1Mï¼šä»å½“å‰æ—¶é—´ç‚¹å‘å‰æ¨1ä¸ªæœˆçš„æ—¶é—´ç‚¹ã€‚# - now-1yï¼šä»å½“å‰æ—¶é—´ç‚¹å‘å‰æ¨1å¹´çš„æ—¶é—´ç‚¹ã€‚# - now+1hï¼šä»å½“å‰æ—¶é—´ç‚¹å‘åæ¨1å°æ—¶çš„æ—¶é—´ç‚¹ã€‚ exists: æŸ¥è¯¢å­—æ®µå­˜åœ¨çš„æ•°æ® 12345curl -X GET -u elastic:123456 -k &#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27; \\ -H &#x27;Content-Type: application/json&#x27; \\ -d &#x27;&#123;&quot;query&quot;:&#123;&quot;exists&quot;:&#123;&quot;field&quot;:&quot;title&quot;&#125;&#125;&#125;&#x27; # field: æŒ‡å®šè¦æŸ¥è¯¢çš„å­—æ®µ # ç¤ºä¾‹ï¼šæŸ¥è¯¢ title å­—æ®µå­˜åœ¨çš„æ–‡æ¡£ ids: æ ¹æ®ä¸€ç»„IDæŸ¥è¯¢ 12345curl -X GET -u elastic:123456 -k &#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27; \\ -H &#x27;Content-Type: application/json&#x27; \\ -d &#x27;&#123;&quot;query&quot;:&#123;&quot;ids&quot;:&#123;&quot;values&quot;:[&quot;1&quot;,&quot;2&quot;]&#125;&#125;&#125;&#x27; # values: æŒ‡å®šè¦æŸ¥è¯¢çš„IDåˆ—è¡¨ # ç¤ºä¾‹ï¼šæŸ¥è¯¢IDä¸º1å’Œ2çš„æ–‡æ¡£ prefix: å‰ç¼€æŸ¥è¯¢ ä»…é€‚ç”¨äºå…³é”®å­—ç±»å‹(keyword)çš„å­—æ®µ 123456789101112curl -X GET -u elastic:123456 -k &#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27; \\ -H &#x27;Content-Type: application/json&#x27; \\ -d &#x27;&#123;&quot;query&quot;:&#123;&quot;prefix&quot;:&#123;&quot;category&quot;:&quot;elec&quot;&#125;&#125;&#125;&#x27;# ä»…é€‚ç”¨äºkeywordç±»å‹å­—æ®µï¼Œæ‰€ä»¥ä¸‹é¢è¿™ä¸ªè¯·æ±‚æŸ¥è¯¢ä¸åˆ°æ•°æ®curl -X GET -u elastic:123456 -k &#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27; \\ -H &#x27;Content-Type: application/json&#x27; \\ -d &#x27;&#123;&quot;query&quot;:&#123;&quot;prefix&quot;:&#123;&quot;address&quot;:&quot;å¹¿å·ç™½äº‘å±±&quot;&#125;&#125;&#125;&#x27;# å› ä¸ºaddressè¢«é™„åŠ äº†keywordç±»å‹ï¼Œæ‰€ä»¥éœ€è¦åŠ ä¸Š.keywordåç¼€åå¯ä»¥æŸ¥è¯¢åˆ°æ•°æ®curl -X GET -u elastic:123456 -k &#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27; \\ -H &#x27;Content-Type: application/json&#x27; \\ -d &#x27;&#123;&quot;query&quot;:&#123;&quot;prefix&quot;:&#123;&quot;address.keyword&quot;:&quot;å¹¿å·ç™½äº‘å±±&quot;&#125;&#125;&#125;&#x27; wildcard: é€šé…ç¬¦æŸ¥è¯¢ ä»…é€‚ç”¨äºå…³é”®å­—ç±»å‹(keyword)çš„å­—æ®µ 12345curl -X GET -u elastic:123456 -k &#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27; \\ -H &#x27;Content-Type: application/json&#x27; \\ -d &#x27;&#123;&quot;query&quot;:&#123;&quot;wildcard&quot;:&#123;&quot;category&quot;:&quot;e?e*&quot;&#125;&#125;&#125;&#x27;# ?: ä»»æ„å•ä¸ªå­—ç¬¦# *: ä»»æ„å¤šä¸ªå­—ç¬¦ regexp: æ­£åˆ™è¡¨è¾¾å¼æŸ¥è¯¢ ä»…é€‚ç”¨äºå…³é”®å­—ç±»å‹(keyword)çš„å­—æ®µ 123curl -X GET -u elastic:123456 -k &#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27; \\ -H &#x27;Content-Type: application/json&#x27; \\ -d &#x27;&#123;&quot;query&quot;:&#123;&quot;regexp&quot;:&#123;&quot;category&quot;:&quot;e.e.*&quot;&#125;&#125;&#125;&#x27; fuzzy: æ”¯æŒç¼–è¾‘è·ç¦»çš„æ¨¡ç³ŠæŸ¥è¯¢ ä»…é€‚ç”¨äºå…³é”®å­—ç±»å‹(keyword)çš„å­—æ®µ fuzzyæ£€ç´¢æ˜¯ä¸€ç§å¼ºå¤§çš„æœç´¢åŠŸèƒ½ï¼Œå®ƒèƒ½å¤Ÿåœ¨ç”¨æˆ·è¾“å…¥å†…å®¹å­˜åœ¨æ‹¼å†™é”™è¯¯æˆ–ä¸Šä¸‹æ–‡ä¸ä¸€è‡´æ—¶ï¼Œä»ç„¶è¿”å›ä¸æœç´¢è¯ç›¸ä¼¼çš„æ–‡æ¡£ã€‚é€šè¿‡ä½¿ç”¨ç¼–è¾‘è·ç¦»ç®—æ³•æ¥åº¦é‡è¾“å…¥è¯ä¸æ–‡æ¡£ä¸­è¯æ¡çš„ç›¸ä¼¼ç¨‹åº¦ï¼Œæ¨¡ç³ŠæŸ¥è¯¢åœ¨ä¿è¯æœç´¢ç»“æœç›¸å…³æ€§çš„åŒæ—¶ï¼Œæœ‰æ•ˆåœ°æé«˜äº†æœç´¢å®¹é”™èƒ½åŠ›ã€‚ ç¼–è¾‘è·ç¦»æ˜¯æŒ‡ä»ä¸€ä¸ªå•è¯è½¬æ¢åˆ°å¦ä¸€ä¸ªå•è¯éœ€è¦ç¼–è¾‘å•å­—ç¬¦çš„æ¬¡æ•°ã€‚å¦‚ä¸­æ–‡é›†å›¢åˆ°ä¸­å¨é›†å›¢ç¼–è¾‘è·ç¦»å°±æ˜¯1ï¼Œåªéœ€è¦ä¿®æ”¹ä¸€ä¸ªå­—ç¬¦ï¼›å¦‚æœfuzzinesså€¼åœ¨è¿™é‡Œè®¾ç½®æˆ2ï¼Œä¼šæŠŠç¼–è¾‘è·ç¦»ä¸º2çš„ä¸œä¸œé›†å›¢ä¹ŸæŸ¥å‡ºæ¥ã€‚ 123456789101112131415curl -X GET -u elastic:123456 -k &#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27; \\ -H &#x27;Content-Type: application/json&#x27; \\ -d &#x27;&#123; &quot;query&quot;:&#123; &quot;fuzzy&quot;:&#123; &quot;category&quot;:&#123; &quot;value&quot;:&quot;beeks&quot;, &quot;fuzziness&quot;:&quot;2&quot;, &quot;prefix_length&quot;:1 &#125; &#125; &#125; &#125;&#x27;# fuzzinessï¼šç”¨äºç¼–è¾‘è·ç¦»çš„è®¾ç½®ï¼Œå…¶é»˜è®¤å€¼ä¸ºAUTOï¼Œæ”¯æŒçš„æ•°å€¼ä¸º[0ï¼Œ1ï¼Œ2]ã€‚å¦‚æœå€¼è®¾ç½®è¶Šç•Œä¼šæŠ¥é”™ã€‚# prefix_length: æœç´¢è¯çš„å‰ç¼€é•¿åº¦ï¼Œåœ¨æ­¤é•¿åº¦å†…ä¸ä¼šåº”ç”¨æ¨¡ç³ŠåŒ¹é…ã€‚é»˜è®¤æ˜¯0ï¼Œå³æ•´ä¸ªè¯éƒ½ä¼šè¢«æ¨¡ç³ŠåŒ¹é…ã€‚ match: å…¨æ–‡æ£€ç´¢(å³åˆ†è¯) 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182curl -X GET -u elastic:123456 -k &#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27; \\ -H &#x27;Content-Type: application/json&#x27; \\ -d &#x27;&#123;&quot;query&quot;:&#123;&quot;match&quot;:&#123;&quot;address&quot;:&quot;å¹¿å·ç™½äº‘å±±å…¬å›­&quot;&#125;&#125;&#125;&#x27;# å› ä¸º desc çš„ç´¢å¼•åˆ†è¯å™¨æ˜¯ ik_max_wordï¼ŒæŸ¥çœ‹â€œå¹¿å·ç™½äº‘å±±å…¬å›­â€è¢«åˆ†è¯åçš„ç»“æœcurl -X GET -u elastic:123456 -k &#x27;https://127.0.0.1:9200/_analyze?pretty&#x27; \\ -H &#x27;Content-Type: application/json&#x27; \\ -d &#x27;&#123; &quot;analyzer&quot;: &quot;ik_max_word&quot;, &quot;text&quot;: &quot;å¹¿å·ç™½äº‘å±±å…¬å›­&quot; &#125;&#x27;# è¿”å›å€¼&#123; &quot;tokens&quot; : [ &#123; &quot;token&quot; : &quot;å¹¿å·&quot;, &quot;start_offset&quot; : 0, &quot;end_offset&quot; : 2, &quot;type&quot; : &quot;CN_WORD&quot;, &quot;position&quot; : 0 &#125;, &#123; &quot;token&quot; : &quot;ç™½äº‘å±±&quot;, &quot;start_offset&quot; : 2, &quot;end_offset&quot; : 5, &quot;type&quot; : &quot;CN_WORD&quot;, &quot;position&quot; : 1 &#125;, &#123; &quot;token&quot; : &quot;ç™½äº‘&quot;, &quot;start_offset&quot; : 2, &quot;end_offset&quot; : 4, &quot;type&quot; : &quot;CN_WORD&quot;, &quot;position&quot; : 2 &#125;, &#123; &quot;token&quot; : &quot;äº‘å±±&quot;, &quot;start_offset&quot; : 3, &quot;end_offset&quot; : 5, &quot;type&quot; : &quot;CN_WORD&quot;, &quot;position&quot; : 3 &#125;, &#123; &quot;token&quot; : &quot;å…¬å›­&quot;, &quot;start_offset&quot; : 5, &quot;end_offset&quot; : 7, &quot;type&quot; : &quot;CN_WORD&quot;, &quot;position&quot; : 4 &#125; ]&#125;# æ‰€ä»¥åªè¦descä¸­åŒ…å«å¦‚ä¸Šè¿™äº›å†…å®¹çš„æ•°æ®éƒ½ä¼šè¢«åŒ¹é…ä¸Š# ä½†æ˜¯è¿™æ ·åŒ¹é…çš„ç»“æœå°±ä¸å¤Ÿç²¾ç¡®ï¼Œå¦‚ä½•å°½é‡åŒ¹é…æ›´å¤šçš„åˆ†è¯å‘¢ï¼Œå¯ä»¥å¢åŠ  minimum_should_matchcurl -X GET -u elastic:123456 -k &#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27; \\ -H &#x27;Content-Type: application/json&#x27; \\ -d &#x27;&#123; &quot;query&quot;:&#123; &quot;match&quot;:&#123; &quot;address&quot;:&#123; &quot;query&quot;: &quot;å¹¿å·ç™½äº‘å±±å…¬å›­&quot;, &quot;minimum_should_match&quot;: 2 &#125; &#125; &#125; &#125;&#x27;# minimum_should_match: 2 è¡¨ç¤ºè‡³å°‘åŒ¹é…ä¸¤ä¸ª# å¦‚æœå¸Œæœ›å…¨éƒ¨éƒ½åŒ¹é…å‘¢curl -X GET -u elastic:123456 -k &#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27; \\ -H &#x27;Content-Type: application/json&#x27; \\ -d &#x27;&#123; &quot;query&quot;:&#123; &quot;match&quot;:&#123; &quot;address&quot;:&#123; &quot;query&quot;: &quot;å¹¿å·ç™½äº‘å±±å…¬å›­&quot;, &quot;operator&quot;: &quot;and&quot; &#125; &#125; &#125; &#125;&#x27;# operator: and è¡¨ç¤ºå…¨éƒ¨åŒ¹é…ï¼Œæ­¤æ—¶ç›¸å½“äºç²¾ç¡®åŒ¹é…ï¼Œå…¶é»˜è®¤å€¼æ˜¯ or multi_match: å¤šå­—æ®µæŸ¥è¯¢ multi_matchæŸ¥è¯¢åœ¨Elasticsearchä¸­ç”¨äºåœ¨å¤šä¸ªå­—æ®µä¸Šæ‰§è¡Œç›¸åŒçš„æœç´¢æ“ä½œã€‚å®ƒå¯ä»¥æ¥å—ä¸€ä¸ªæŸ¥è¯¢å­—ç¬¦ä¸²ï¼Œå¹¶åœ¨æŒ‡å®šçš„å­—æ®µé›†åˆä¸­æœç´¢è¿™ä¸ªå­—ç¬¦ä¸²ã€‚multi_matchæŸ¥è¯¢æä¾›äº†çµæ´»çš„åŒ¹é…ç±»å‹å’Œæ“ä½œç¬¦é€‰é¡¹ï¼Œä»¥ä¾¿æ ¹æ®ä¸åŒçš„æœç´¢éœ€æ±‚è°ƒæ•´æœç´¢è¡Œä¸ºã€‚ 123456789101112curl -X GET -u elastic:123456 -k &#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27; \\ -H &#x27;Content-Type: application/json&#x27; \\ -d &#x27;&#123; &quot;query&quot;:&#123; &quot;multi_match&quot;:&#123; &quot;query&quot;: &quot;å¹¿å·shirt&quot;, &quot;fields&quot;:[&quot;title&quot;,&quot;address&quot;] &#125; &#125; &#125;&#x27;# query: æŸ¥è¯¢æ¡ä»¶# fields: æŒ‡å®šå¤šä¸ªå­—æ®µè¿›è¡ŒåŒ¹é… match_phrase: çŸ­è¯­æŸ¥è¯¢ match_phraseæŸ¥è¯¢åœ¨Elasticsearchä¸­ç”¨äºæ‰§è¡ŒçŸ­è¯­æœç´¢ï¼Œå®ƒä¸ä»…åŒ¹é…æ•´ä¸ªçŸ­è¯­ï¼Œè€Œä¸”è¿˜è€ƒè™‘äº†çŸ­è¯­ä¸­å„ä¸ªè¯çš„é¡ºåºå’Œä½ç½®ã€‚è¿™ç§æŸ¥è¯¢ç±»å‹å¯¹äºæœç´¢ç²¾ç¡®çŸ­è¯­éå¸¸æœ‰ç”¨ï¼Œå°¤å…¶æ˜¯åœ¨ç”¨æˆ·è¾“å…¥çš„æŸ¥è¯¢ä¸æ–‡æ¡£ä¸­çš„æ–‡æœ¬è¡¨è¾¾æ–¹å¼éœ€è¦ä¸¥æ ¼åŒ¹é…æ—¶ã€‚ 123456789101112curl -X GET -u elastic:123456 -k &#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27; \\ -H &#x27;Content-Type: application/json&#x27; \\ -d &#x27;&#123; &quot;query&quot;:&#123; &quot;match_phrase&quot;:&#123; &quot;address&quot;:&#123; &quot;query&quot;:&quot;å¹¿å·ç™½äº‘å±±&quot; &#125; &#125; &#125; &#125;&#x27;# è¦æ±‚æŸ¥è¯¢ç»“æœä¸­çš„æ•°æ®å¿…é¡»åŒ…å«&quot;å¹¿å·ç™½äº‘å±±&quot;ï¼Œè€Œä¸”â€œå¹¿å·â€å’Œâ€œç™½äº‘å±±â€è¿™ä¸¤ä¸ªè¯æ˜¯ä¸èƒ½åˆ†å¼€çš„ï¼Œå› ä¸º match_phrase åŒ¹é…çš„æ˜¯ç›¸é‚»è¯æ¡ query_string: æ”¯æŒä¸æˆ–éè¡¨è¾¾å¼çš„æŸ¥è¯¢ query_stringæŸ¥è¯¢æ˜¯ä¸€ç§çµæ´»çš„æŸ¥è¯¢ç±»å‹ï¼Œå®ƒå…è®¸ä½¿ç”¨LuceneæŸ¥è¯¢è¯­æ³•æ¥æ„å»ºå¤æ‚çš„æœç´¢æŸ¥è¯¢ã€‚è¿™ç§æŸ¥è¯¢ç±»å‹æ”¯æŒå¤šç§é€»è¾‘è¿ç®—ç¬¦ï¼ŒåŒ…æ‹¬ä¸ï¼ˆANDï¼‰ã€æˆ–ï¼ˆORï¼‰å’Œéï¼ˆNOTï¼‰ï¼Œä»¥åŠé€šé…ç¬¦ã€æ¨¡ç³Šæœç´¢å’Œæ­£åˆ™è¡¨è¾¾å¼ç­‰åŠŸèƒ½ã€‚query_stringæŸ¥è¯¢å¯ä»¥åœ¨å•ä¸ªæˆ–å¤šä¸ªå­—æ®µä¸Šè¿›è¡Œæœç´¢ï¼Œå¹¶ä¸”å¯ä»¥å¤„ç†å¤æ‚çš„æŸ¥è¯¢é€»è¾‘ã€‚ æ³¨æ„: æŸ¥è¯¢å­—æ®µåˆ†è¯å°±å°†æŸ¥è¯¢æ¡ä»¶åˆ†è¯æŸ¥è¯¢ï¼ŒæŸ¥è¯¢å­—æ®µä¸åˆ†è¯å°†æŸ¥è¯¢æ¡ä»¶ä¸åˆ†è¯æŸ¥è¯¢ 12345678910111213141516171819202122232425262728293031323334# æŸ¥è¯¢æ‰€æœ‰å­—æ®µä¸­åŒ…å« &quot;å…¬å›­&quot;å’Œ &quot;åä¸º&quot; çš„æ–‡æ¡£curl -X GET -u elastic:123456 -k &#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27; \\ -H &#x27;Content-Type: application/json&#x27; \\ -d &#x27;&#123; &quot;query&quot;:&#123; &quot;query_string&quot;:&#123; &quot;query&quot;:&quot;å…¬å›­ AND electronics&quot; &#125; &#125; &#125;&#x27;# æŒ‡å®šæŸ¥è¯¢çš„å•ä¸ªå­—æ®µcurl -X GET -u elastic:123456 -k &#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27; \\ -H &#x27;Content-Type: application/json&#x27; \\ -d &#x27;&#123; &quot;query&quot;:&#123; &quot;query_string&quot;:&#123; &quot;default_field&quot;:&quot;category&quot;, &quot;query&quot;:&quot;ç™½äº‘å±± OR books&quot; &#125; &#125; &#125;&#x27;# æŒ‡å®šæŸ¥è¯¢çš„å¤šä¸ªå­—æ®µcurl -X GET -u elastic:123456 -k &#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27; \\ -H &#x27;Content-Type: application/json&#x27; \\ -d &#x27;&#123; &quot;query&quot;:&#123; &quot;query_string&quot;:&#123; &quot;fields&quot;:[&quot;category&quot;,&quot;address&quot;], &quot;query&quot;:&quot;ç™½äº‘å±± OR (electronics AND shirt)&quot; &#125; &#125; &#125;&#x27; simple_query_string: ç±»ä¼¼ query_stringï¼Œä½†æ˜¯ä¼šå¿½ç•¥é”™è¯¯çš„è¯­æ³•ï¼ŒåŒæ—¶åªæ”¯æŒéƒ¨åˆ†æŸ¥è¯¢è¯­æ³• 1234567891011curl -X GET -u elastic:123456 -k &#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27; \\ -H &#x27;Content-Type: application/json&#x27; \\ -d &#x27;&#123; &quot;query&quot;:&#123; &quot;simple_query_string&quot;:&#123; &quot;query&quot;:&quot;å¹¿å·å…¬å›­&quot;, &quot;default_operator&quot;:&quot;AND&quot; &#125; &#125; &#125;&#x27;# default_operator: é»˜è®¤ä¸º ORï¼Œè®¾ç½®ä¸º AND åˆ™å¿…é¡»åŒæ—¶åŒ¹é… ESæŸ¥è¯¢ç»“æœå±æ€§å«ä¹‰ 123456789101112131415161718&#123; &quot;took&quot;:16, # è¡¨ç¤ºæŸ¥è¯¢ä»è¯·æ±‚åˆ°å®Œæˆè€—æ—¶ 16 æ¯«ç§’ã€‚ &quot;timed_out&quot;:false, # è¡¨ç¤ºæŸ¥è¯¢åœ¨è§„å®šçš„æ—¶é—´å†…å®Œæˆï¼Œæ²¡æœ‰å‘ç”Ÿè¶…æ—¶ã€‚å¦‚æœä¸º trueï¼Œåˆ™è¡¨ç¤ºæŸ¥è¯¢è¶…æ—¶ã€‚ &quot;_shards&quot;:&#123; # æ¶‰åŠåˆ°æŸ¥è¯¢è¿‡ç¨‹ä¸­ä½¿ç”¨çš„åˆ†ç‰‡ä¿¡æ¯ &quot;total&quot;:1, # è¡¨ç¤ºæŸ¥è¯¢æ¶‰åŠåˆ°çš„æ€»åˆ†ç‰‡æ•°ä¸º 1 &quot;successful&quot;:1, # è¡¨ç¤ºæŸ¥è¯¢æˆåŠŸå®Œæˆçš„åˆ†ç‰‡æ•°ä¸º 1 &quot;skipped&quot;:0, # è¡¨ç¤ºæŸ¥è¯¢è¿‡ç¨‹ä¸­è¢«è·³è¿‡çš„åˆ†ç‰‡æ•°ä¸º 0 &quot;failed&quot;:0 # è¡¨ç¤ºæŸ¥è¯¢è¿‡ç¨‹ä¸­å¤±è´¥çš„åˆ†ç‰‡æ•°ä¸º 0 &#125;, &quot;hits&quot;:&#123; # åŒ…å«æŸ¥è¯¢ç»“æœçš„è¯¦ç»†ä¿¡æ¯ &quot;total&quot;:&#123; # åŒ…å«æŸ¥è¯¢ç»“æœçš„æ€»æ•° &quot;value&quot;:4, # è¡¨ç¤ºæŸ¥è¯¢ç»“æœçš„æ€»æ•°ä¸º 4 &quot;relation&quot;:&quot;eq&quot; # è¡¨ç¤ºè¿”å›çš„æ€»æ•° value æ˜¯ç¡®åˆ‡çš„ï¼ˆequalï¼‰ã€‚å¦‚æœä¸º gteï¼Œåˆ™è¡¨ç¤ºè¿”å›çš„æ€»æ•°æ˜¯ä¸€ä¸ªä¸‹é™å€¼ã€‚ &#125;, &quot;max_score&quot;:0.0, # è¡¨ç¤ºåŒ¹é…åˆ°çš„æ–‡æ¡£ä¸­æœ€é«˜çš„å¾—åˆ†ã€‚å¦‚æœæ˜¯æ’åºæŸ¥è¯¢ï¼Œè¿™ä¸ªå€¼ä¼šæœ‰æ„ä¹‰ã€‚å½“å‰ç»“æœå› ä¸º size: 0ï¼Œæ²¡æœ‰å®é™…è¿”å›æ–‡æ¡£ï¼Œæ‰€ä»¥å¾—åˆ†ä¸º 0.0 &quot;hits&quot;:[ ] # åŒ…å«æŸ¥è¯¢ç»“æœçš„åˆ—è¡¨ï¼Œæ¯ä¸ªç»“æœéƒ½æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼ŒåŒ…å«æ–‡æ¡£çš„å…ƒæ•°æ®ï¼Œå¦‚ idã€åˆ†æ•°ç­‰ã€‚ &#125;&#125; bool æŸ¥è¯¢ å¸ƒå°”æŸ¥è¯¢å¯ä»¥æŒ‰ç…§å¸ƒå°”é€»è¾‘æ¡ä»¶ç»„ç»‡å¤šæ¡æŸ¥è¯¢è¯­å¥ï¼Œåªæœ‰ç¬¦åˆæ•´ä¸ªå¸ƒå°”æ¡ä»¶çš„æ–‡æ¡£æ‰ä¼šè¢«æœç´¢å‡ºæ¥ã€‚ åœ¨å¸ƒå°”æ¡ä»¶ä¸­ï¼Œå¯ä»¥åŒ…å«ä¸¤ç§ä¸åŒçš„ä¸Šä¸‹æ–‡ã€‚ 1.æœç´¢ä¸Šä¸‹æ–‡(query context)ï¼šä½¿ç”¨æœç´¢ä¸Šä¸‹æ–‡æ—¶ï¼ŒElasticsearchéœ€è¦è®¡ç®—æ¯ä¸ªæ–‡æ¡£ä¸æœç´¢æ¡ä»¶çš„ç›¸å…³åº¦å¾—åˆ†ï¼Œè¿™ä¸ªå¾—åˆ†çš„è®¡ç®—éœ€ä½¿ç”¨ä¸€å¥—å¤æ‚çš„è®¡ç®—å…¬å¼ï¼Œæœ‰ä¸€å®šçš„æ€§èƒ½å¼€é”€ï¼Œå¸¦æ–‡æœ¬åˆ†æçš„å…¨æ–‡æ£€ç´¢çš„æŸ¥è¯¢è¯­å¥å¾ˆé€‚åˆæ”¾åœ¨æœç´¢ä¸Šä¸‹æ–‡ä¸­ã€‚ 2.è¿‡æ»¤ä¸Šä¸‹æ–‡(filter context)ï¼šä½¿ç”¨è¿‡æ»¤ä¸Šä¸‹æ–‡æ—¶ï¼ŒElasticsearchåªéœ€è¦åˆ¤æ–­æœç´¢æ¡ä»¶è·Ÿæ–‡æ¡£æ•°æ®æ˜¯å¦åŒ¹é…ï¼Œä¾‹å¦‚ä½¿ç”¨Term queryåˆ¤æ–­ä¸€ä¸ªå€¼æ˜¯å¦è·Ÿæœç´¢å†…å®¹ä¸€è‡´ï¼Œä½¿ç”¨Range queryåˆ¤æ–­æŸæ•°æ®æ˜¯å¦ä½äºæŸä¸ªåŒºé—´ç­‰ã€‚è¿‡æ»¤ä¸Šä¸‹æ–‡çš„æŸ¥è¯¢ä¸éœ€è¦è¿›è¡Œç›¸å…³åº¦å¾—åˆ†è®¡ç®—ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ç¼“å­˜åŠ å¿«å“åº”é€Ÿåº¦ï¼Œå¾ˆå¤šæœ¯è¯­çº§æŸ¥è¯¢è¯­å¥éƒ½é€‚åˆæ”¾åœ¨è¿‡æ»¤ä¸Šä¸‹æ–‡ä¸­ã€‚ bool æŸ¥è¯¢åŒ…å« mustã€must_notã€shouldã€filter å››ç§å­å¥ã€‚ ç±»å‹ è¯´æ˜ must å¯åŒ…å«å¤šä¸ªæŸ¥è¯¢æ¡ä»¶ï¼Œæ¯ä¸ªæ¡ä»¶å‡æ»¡è¶³çš„æ–‡æ¡£æ‰èƒ½è¢«æœç´¢åˆ°ï¼Œæ¯æ¬¡æŸ¥è¯¢éœ€è¦è®¡ç®—ç›¸å…³åº¦å¾—åˆ†ï¼Œå±äºæœç´¢ä¸Šä¸‹æ–‡ should å¯åŒ…å«å¤šä¸ªæŸ¥è¯¢æ¡ä»¶ï¼Œä¸å­˜åœ¨mustå’Œfiteræ¡ä»¶æ—¶ï¼Œè‡³å°‘è¦æ»¡è¶³å¤šä¸ªæŸ¥è¯¢æ¡ä»¶ä¸­çš„ä¸€ä¸ªï¼Œæ–‡æ¡£æ‰èƒ½è¢«æœç´¢åˆ°ï¼Œå¦åˆ™éœ€æ»¡è¶³çš„æ¡ä»¶æ•°é‡ä¸å—é™åˆ¶,åŒ¹é…åˆ°çš„æŸ¥è¯¢è¶Šå¤šç›¸å…³åº¦è¶Šé«˜ï¼Œä¹Ÿå±äºæœç´¢ä¸Šä¸‹æ–‡ filter å¯åŒ…å«å¤šä¸ªè¿‡æ»¤æ¡ä»¶ï¼Œæ¯ä¸ªæ¡ä»¶å‡æ»¡è¶³çš„æ–‡æ¡£æ‰èƒ½è¢«æœç´¢åˆ°ï¼Œæ¯ä¸ªè¿‡æ»¤æ¡ä»¶ä¸è®¡ç®—ç›¸å…³åº¦å¾—åˆ†ï¼Œç»“æœåœ¨ä¸€å®šæ¡ä»¶ä¸‹ä¼šè¢«ç¼“å­˜ï¼Œ å±äºè¿‡æ»¤ä¸Šä¸‹æ–‡ must_not å¯åŒ…å«å¤šä¸ªè¿‡æ»¤æ¡ä»¶ï¼Œæ¯ä¸ªæ¡ä»¶å‡ä¸æ»¡è¶³çš„æ–‡æ¡£æ‰èƒ½è¢«æœç´¢åˆ°ï¼Œæ¯ä¸ªè¿‡æ»¤æ¡ä»¶ä¸è®¡ç®—ç›¸å…³åº¦å¾—åˆ†ï¼Œç»“æœåœ¨ä¸€å®šæ¡ä»¶ä¸‹ä¼šè¢«ç¼“å­˜ï¼Œ å±äºè¿‡æ»¤ä¸Šä¸‹æ–‡ must 12345678910111213# ä¸¤ä¸ªæ¡ä»¶éƒ½éœ€è¦æ»¡è¶³curl -X GET -u elastic:123456 -k &#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27; \\ -H &#x27;Content-Type: application/json&#x27; \\ -d &#x27;&#123; &quot;query&quot;:&#123; &quot;bool&quot;:&#123; &quot;must&quot;:[ &#123;&quot;match&quot;:&#123;&quot;category&quot;:&quot;electronics&quot;&#125;&#125;, &#123;&quot;match&quot;:&#123;&quot;desc&quot;:&quot;å…¬å›­&quot;&#125;&#125; ] &#125; &#125; &#125;&#x27; must_not 12345678910111213# ä¸¤ä¸ªæ¡ä»¶éƒ½ä¸æ»¡è¶³curl -X GET -u elastic:123456 -k &#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27; \\ -H &#x27;Content-Type: application/json&#x27; \\ -d &#x27;&#123; &quot;query&quot;:&#123; &quot;bool&quot;:&#123; &quot;must_not&quot;:[ &#123;&quot;match&quot;:&#123;&quot;category&quot;:&quot;electronics&quot;&#125;&#125;, &#123;&quot;match&quot;:&#123;&quot;desc&quot;:&quot;å…¬å›­&quot;&#125;&#125; ] &#125; &#125; &#125;&#x27; should 12345678910111213# ä¸¤ä¸ªæ¡ä»¶æ»¡è¶³ä¸€ä¸ªå³å¯curl -X GET -u elastic:123456 -k &#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27; \\ -H &#x27;Content-Type: application/json&#x27; \\ -d &#x27;&#123; &quot;query&quot;:&#123; &quot;bool&quot;:&#123; &quot;should&quot;:[ &#123;&quot;match&quot;:&#123;&quot;category&quot;:&quot;electronics&quot;&#125;&#125;, &#123;&quot;match&quot;:&#123;&quot;desc&quot;:&quot;å…¬å›­&quot;&#125;&#125; ] &#125; &#125; &#125;&#x27; filter 12345678910111213# filterä¸­çš„æ¡ä»¶ä¸ºé matchï¼Œå³ä¸èƒ½æ˜¯å…¨æ–‡æ£€ç´¢curl -X GET -u elastic:123456 -k &#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27; \\ -H &#x27;Content-Type: application/json&#x27; \\ -d &#x27;&#123; &quot;query&quot;:&#123; &quot;bool&quot;:&#123; &quot;filter&quot;:[ &#123;&quot;term&quot;:&#123;&quot;category&quot;:&quot;electronics&quot;&#125;&#125;, &#123;&quot;range&quot;:&#123;&quot;price&quot;:&#123;&quot;gte&quot;:20&#125;&#125;&#125; ] &#125; &#125; &#125;&#x27; åˆ†é¡µä¸æ’åº 1234567891011# from: ä»ç¬¬å‡ æ¡å¼€å§‹ï¼Œé»˜è®¤0# size: å–å¤šå°‘æ¡# sort: æ’åºï¼Œé»˜è®¤ä¸ºæŒ‰æ–‡æ¡£idå‡åºcurl -X GET -u elastic:123456 -k &#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27; \\ -H &#x27;Content-Type: application/json&#x27; \\ -d &#x27;&#123; &quot;query&quot;:&#123;&quot;range&quot;:&#123;&quot;price&quot;:&#123;&quot;gte&quot;:20,&quot;lte&quot;:30&#125;&#125;&#125;, &quot;sort&quot;:[&#123;&quot;price&quot;:&quot;address&quot;&#125;], &quot;from&quot;:0, &quot;size&quot;:5 &#125;&#x27; åªè¿”å›éƒ¨åˆ†å­—æ®µ 1234567# _source: æŒ‡å®šè¦è¿”å›çš„å­—æ®µåˆ—è¡¨curl -X GET -u elastic:123456 -k &#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27; \\ -H &#x27;Content-Type: application/json&#x27; \\ -d &#x27; &#123;&quot;query&quot;:&#123;&quot;range&quot;:&#123;&quot;price&quot;:&#123;&quot;gte&quot;:20,&quot;lte&quot;:30&#125;&#125;&#125;, &quot;_source&quot;:[&quot;category&quot;,&quot;title&quot;,&quot;price&quot;] &#125;&#x27; é«˜äº®æ˜¾ç¤º 123456789101112131415161718# é«˜äº®æ˜¾ç¤ºä»…æ”¯æŒå…¨æ–‡æ£€ç´¢å­—æ®µcurl -X GET -u elastic:123456 -k &#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27; \\ -H &#x27;Content-Type: application/json&#x27; \\ -d &#x27;&#123; &quot;query&quot;: &#123; &quot;multi_match&quot;: &#123; &quot;fields&quot;: [&quot;title&quot;,&quot;address&quot;], &quot;query&quot;: &quot;å…¬å›­shirt&quot; &#125; &#125;, &quot;highlight&quot;: &#123; &quot;post_tags&quot;: [&quot;&lt;/span&gt;&quot;], &quot;pre_tags&quot;: [&quot;&lt;span style=&#x27;color:red&#x27;&gt;&quot;], &quot;fields&quot;: &#123; &quot;*&quot;:&#123;&#125; &#125; &#125; &#125;&#x27; åœ°ç†ç©ºé—´ä½ç½®æŸ¥è¯¢ åœ°ç†ç©ºé—´ä½ç½®æŸ¥è¯¢æ˜¯æ•°æ®åº“å’Œæœç´¢ç³»ç»Ÿä¸­çš„ä¸€ä¸ªé‡è¦ç‰¹æ€§ï¼Œç‰¹åˆ«æ˜¯åœ¨åœ°ç†ä¿¡æ¯ç³»ç»Ÿï¼ˆGISï¼‰å’Œä½ç½®æœåŠ¡ä¸­ã€‚å®ƒå…è®¸ç”¨æˆ·åŸºäºåœ°ç†ä½ç½®ä¿¡æ¯æ¥æœç´¢å’Œè¿‡æ»¤æ•°æ®ã€‚åœ¨Elasticsearchè¿™æ ·çš„å…¨æ–‡æœç´¢å¼•æ“ä¸­ï¼Œåœ°ç†ç©ºé—´ä½ç½®æŸ¥è¯¢è¢«å¹¿æ³›åº”ç”¨ï¼Œä¾‹å¦‚åœ¨æ—…è¡Œã€æˆ¿åœ°äº§ã€ç‰©æµå’Œé›¶å”®ç­‰è¡Œä¸šï¼Œç”¨äºæä¾›åŸºäºä½ç½®çš„æœç´¢åŠŸèƒ½ã€‚ åœ¨Elasticsearchä¸­ï¼Œåœ°ç†ç©ºé—´æ•°æ®é€šå¸¸å­˜å‚¨åœ¨geo_pointå­—æ®µç±»å‹ä¸­ã€‚è¿™ç§å­—æ®µç±»å‹å¯ä»¥å­˜å‚¨çº¬åº¦å’Œç»åº¦åæ ‡ï¼Œç”¨äºè¡¨ç¤ºåœ°çƒä¸Šçš„ä¸€ä¸ªç‚¹ã€‚ ç¤ºä¾‹ åˆ›å»ºä¸€ä¸ªç´¢å¼•ï¼Œå¹¶æ·»åŠ ä¸€ä¸ªgeo_pointå­—æ®µï¼š 12345678910111213141516curl -X PUT -u elastic:123456 -k &#x27;https://127.0.0.1:9200/tourist_spots&#x27; \\ -H &#x27;Content-Type: application/json&#x27; \\ -d &#x27;&#123; &quot;mappings&quot;: &#123; &quot;properties&quot;: &#123; &quot;name&quot;: &#123; &quot;type&quot;: &quot;text&quot;, &quot;analyzer&quot;: &quot;ik_max_word&quot;, &quot;search_analyzer&quot;: &quot;ik_max_word&quot; &#125;, &quot;location&quot;: &#123; &quot;type&quot;: &quot;geo_point&quot; &#125; &#125; &#125; &#125;&#x27; æ’å…¥æ•°æ® 1234567891011curl -X POST -u elastic:123456 -k &#x27;https://127.0.0.1:9200/tourist_spots/_bulk&#x27; \\ -H &#x27;Content-Type: application/json&#x27; \\ -d &#x27;&#123;&quot;index&quot;:&#123;&#125;&#125;&#123;&quot;name&quot;:&quot;é›·å³°å¡”&quot;,&quot;location&quot;:&#123;&quot;lat&quot;:30.2615,&quot;lon&quot;:120.1480&#125;&#125;&#123;&quot;index&quot;:&#123;&#125;&#125;&#123;&quot;name&quot;:&quot;è¥¿æ¹–&quot;,&quot;location&quot;:&#123;&quot;lat&quot;:30.2614,&quot;lon&quot;:120.1479&#125;&#125;&#123;&quot;index&quot;:&#123;&#125;&#125;&#123;&quot;name&quot;:&quot;è‹å ¤æ˜¥æ™“&quot;,&quot;location&quot;:&#123;&quot;lat&quot;:30.2624,&quot;lon&quot;:120.1708&#125;&#125;&#x27;# lat: çº¬åº¦# lon: ç»åº¦ æŸ¥è¯¢æ•°æ® 12345678910111213141516171819202122232425262728293031# æŸ¥è¯¢æ­å·è¥¿æ¹–5kmé™„è¿‘çš„æ™¯ç‚¹# é›·å³°å¡” - ä½äºè¥¿æ¹–é™„è¿‘ï¼Œè·ç¦»çº¦2.8å…¬é‡Œã€‚# è‹å ¤æ˜¥æ™“ - ä½äºè¥¿æ¹–è¾¹ï¼Œè·ç¦»è¥¿æ¹–ä¸­å¿ƒçº¦1å…¬é‡Œã€‚curl -X GET -u elastic:123456 -k &#x27;https://127.0.0.1:9200/tourist_spots/_search?pretty&#x27; \\ -H &#x27;Content-Type: application/json&#x27; \\ -d &#x27;&#123; &quot;query&quot;: &#123; &quot;bool&quot;: &#123; &quot;must&quot;: &#123; &quot;match_all&quot;: &#123;&#125; &#125;, &quot;filter&quot;: &#123; &quot;geo_distance&quot;: &#123; &quot;distance&quot;: &quot;5km&quot;, &quot;distance_type&quot;: &quot;arc&quot;, &quot;location&quot;: &#123; &quot;lat&quot;: 30.2614, &quot;lon&quot;: 120.1479 &#125; &#125; &#125; &#125; &#125; &#125;&#x27;# distance: 5km è¡¨ç¤ºè·ç¦»ä¸º5å…¬é‡Œ# distance_type: arc, plane, sloppy_arc, # arc: é»˜è®¤å€¼ï¼Œä½¿ç”¨haversineå…¬å¼è®¡ç®—è·ç¦»ï¼Œç»“æœæ˜¯ç²¾ç¡®çš„ï¼Œä½†è®¡ç®—é€Ÿåº¦è¾ƒæ…¢ã€‚ # plane: ä½¿ç”¨å¹³é¢ç›´è§’åæ ‡ç³»è®¡ç®—è·ç¦»ï¼Œç»“æœæ˜¯ç²—ç•¥çš„ï¼Œä½†è®¡ç®—é€Ÿåº¦æ›´å¿«ã€‚ # sloppy_arc: ä½¿ç”¨haversineå…¬å¼è®¡ç®—è·ç¦»ï¼Œä½†å…è®¸è¯¯å·®ã€‚# location: æœç´¢æ¡ä»¶ å‘é‡æœç´¢ Elasticsearch 8.x å¼•å…¥äº†ä¸€ä¸ªé‡è¦çš„æ–°ç‰¹æ€§ï¼šå‘é‡æ£€ç´¢ï¼ˆVector Searchï¼‰ï¼Œç‰¹åˆ«æ˜¯é€šè¿‡KNNï¼ˆK-Nearest Neighborsï¼‰ç®—æ³•æ”¯æŒå‘é‡è¿‘é‚»æ£€ç´¢ã€‚è¿™ä¸€ç‰¹æ€§ä½¿å¾—Elasticsearchåœ¨æœºå™¨å­¦ä¹ ã€æ•°æ®åˆ†æå’Œæ¨èç³»ç»Ÿç­‰é¢†åŸŸçš„åº”ç”¨å˜å¾—æ›´åŠ å¹¿æ³›å’Œå¼ºå¤§ã€‚ å‘é‡æ£€ç´¢çš„åŸºæœ¬æ€è·¯æ˜¯ï¼Œå°†æ–‡æ¡£ï¼ˆæˆ–æ•°æ®é¡¹ï¼‰è¡¨ç¤ºä¸ºé«˜ç»´å‘é‡ï¼Œå¹¶ä½¿ç”¨è¿™äº›å‘é‡æ¥æ‰§è¡Œç›¸ä¼¼æ€§æœç´¢ã€‚åœ¨Elasticsearchä¸­ï¼Œè¿™äº›å‘é‡è¢«å­˜å‚¨åœ¨dense_vectorç±»å‹çš„å­—æ®µä¸­ï¼Œç„¶åä½¿ç”¨KNNç®—æ³•æ¥æ‰¾åˆ°ä¸ç»™å®šå‘é‡æœ€ç›¸ä¼¼çš„å…¶ä»–å‘é‡ã€‚ ç¤ºä¾‹ åˆ›å»ºç´¢å¼• 12345678910111213141516171819202122curl -X PUT -u elastic:123456 -k &#x27;https://127.0.0.1:9200/image-index&#x27; \\ -H &#x27;Content-Type: application/json&#x27; \\ -d &#x27;&#123; &quot;mappings&quot;: &#123; &quot;properties&quot;: &#123; &quot;image-vector&quot;: &#123; &quot;type&quot;: &quot;dense_vector&quot;, &quot;dims&quot;: 3 &#125;, &quot;title&quot;: &#123; &quot;type&quot;: &quot;text&quot; &#125;, &quot;file-type&quot;: &#123; &quot;type&quot;: &quot;keyword&quot; &#125;, &quot;my_label&quot;: &#123; &quot;type&quot;: &quot;text&quot; &#125; &#125; &#125; &#125;&#x27;# dims: 3 è¡¨ç¤º3ç»´å‘é‡ï¼Œæœ€é«˜æ”¯æŒ2048 æ·»åŠ æ•°æ® 123456789curl -X POST -u elastic:123456 -k &#x27;https://127.0.0.1:9200/image-index/_bulk&#x27; \\ -H &#x27;Content-Type: application/json&#x27; \\ -d &#x27;&#123; &quot;index&quot;: &#123;&#125; &#125;&#123; &quot;image-vector&quot;: [-5, 9, -12], &quot;title&quot;: &quot;Image A&quot;, &quot;file-type&quot;: &quot;jpeg&quot;, &quot;my_label&quot;: &quot;red&quot; &#125;&#123; &quot;index&quot;: &#123;&#125; &#125;&#123; &quot;image-vector&quot;: [10, -2, 3], &quot;title&quot;: &quot;Image B&quot;, &quot;file-type&quot;: &quot;png&quot;, &quot;my_label&quot;: &quot;blue&quot; &#125;&#123; &quot;index&quot;: &#123;&#125; &#125;&#123; &quot;image-vector&quot;: [4, 0, -1], &quot;title&quot;: &quot;Image C&quot;, &quot;file-type&quot;: &quot;gif&quot;, &quot;my_label&quot;: &quot;red&quot; &#125;&#x27; å‘é‡æ£€ç´¢ 1234567891011121314151617181920curl -X POST -u elastic:123456 -k &#x27;https://127.0.0.1:9200/image-index/_search?pretty&#x27; \\ -H &#x27;Content-Type: application/json&#x27; \\ -d &#x27;&#123; &quot;query&quot;:&#123; &quot;match_all&quot;: &#123;&#125; &#125;, &quot;knn&quot;: &#123; &quot;field&quot;: &quot;image-vector&quot;, &quot;query_vector&quot;: [-5, 10, -12], &quot;k&quot;: 10, &quot;num_candidates&quot;: 100 &#125;, &quot;fields&quot;: [ &quot;title&quot;, &quot;file-type&quot; ] &#125;&#x27;# query: æœç´¢æ¡ä»¶ï¼Œè¿™é‡Œå¯ä»¥ä¸åŠ è¿™ä¸ª# knn: 8.8.1 ç‰ˆæœ¬å¼€å§‹é»˜è®¤æ”¯æŒ# field: æœç´¢å‘é‡å­—æ®µ# query_vector: æœç´¢å‘é‡# k: æœç´¢ç»“æœæ•°é‡# num_candidates: æœç´¢å€™é€‰æ•°é‡ï¼Œç”¨äºä¼˜åŒ–æ€§èƒ½# fields: æœç´¢ç»“æœè¿”å›å­—æ®µ","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» Elasticsearch çš„ REST APIs Elasticsearchç‰ˆæœ¬8.17.3 å®˜æ–¹æ–‡æ¡£:REST APIs Elasticsearch çš„ REST APIs:èšåˆæŸ¥è¯¢","date_published":"2025-04-17T13:30:05.000Z","tags":["æŠ€æœ¯","elastic","elasticsearch","elasticsearch"]},{"id":"https://blog.hanqunfeng.com/2025/04/16/elasticsearch-04-cert/","url":"https://blog.hanqunfeng.com/2025/04/16/elasticsearch-04-cert/","title":"Elasticsearchçš„è¯ä¹¦è¿‡æœŸå¤„ç†æ–¹æ³•","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç»Elasticsearchè¯ä¹¦è¿‡æœŸæ—¶çš„å¤„ç†æ–¹æ³•</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://www.elastic.co/guide/en/elasticsearch/reference/8.17/index.html\">Elasticsearch</a>ç‰ˆæœ¬8.17.3</p>\n</li>\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡åŸºäº <a href=\"/2025/03/20/elasticsearch-01-install/\" title=\"linuxä¸‹å®‰è£…Elasticsearch\">linuxä¸‹å®‰è£…Elasticsearch</a></p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://www.elastic.co/guide/en/elasticsearch/reference/8.17/update-node-certs.html\">å®˜æ–¹æ–‡æ¡£:Updating node security certificates</a></p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"ESè¯ä¹¦ç®€ä»‹\">ESè¯ä¹¦ç®€ä»‹</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Elasticsearch 8 é»˜è®¤æƒ…å†µä¸‹åˆ›å»ºçš„è¯ä¹¦åªæœ‰3å¹´æœ‰æ•ˆæœŸï¼Œè¿‡æœŸæ—¶éœ€è¦åˆ›å»ºæ–°çš„è¯ä¹¦ï¼Œä¸ºäº†ä¸å¿…è¦çš„éº»çƒ¦ï¼Œä¹Ÿå¯ä»¥ä¸€å¼€å§‹å°±åˆ›å»ºä¸€ä¸ªæœ‰æ•ˆæœŸæ¯”è¾ƒé•¿çš„è¯ä¹¦ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>åœ¨ Elasticsearch 8 çš„é…ç½®ä¸‹ï¼Œ<code>config/certs</code> ç›®å½•é€šå¸¸å­˜æ”¾çš„æ˜¯ç”¨äºå®‰å…¨é€šä¿¡çš„è¯ä¹¦å’Œå¯†é’¥æ–‡ä»¶ã€‚è¿™äº›æ–‡ä»¶ç¡®ä¿äº† Elasticsearch å®ä¾‹ä¹‹é—´çš„é€šè®¯ä»¥åŠä¸å¤–éƒ¨å®¢æˆ·ç«¯çš„é€šè®¯èƒ½å¤Ÿè¢«åŠ å¯†ä¸”ç»è¿‡è®¤è¯ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><code>config/certs</code> ç›®å½•åŒ…å«ä¸‰ä¸ªæ–‡ä»¶åˆ†åˆ«æ˜¯ï¼š</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\"><code>http.p12</code>: è¿™æ˜¯ä¸€ä¸ª PKCS#12 æ ¼å¼çš„æ–‡ä»¶ï¼ˆé€šå¸¸å¸¦æœ‰.p12æˆ–.pfxæ‰©å±•åï¼‰ï¼ŒåŒ…å«äº† Elasticsearch HTTP å±‚ç”¨æ¥è¿›è¡Œ TLS/SSL é€šä¿¡æ‰€éœ€çš„ä¸€åˆ‡ï¼ŒåŒ…æ‹¬ä¸€ä¸ªç§é’¥ã€ç›¸åº”çš„å…¬é’¥è¯ä¹¦ï¼ˆæœåŠ¡å™¨è¯ä¹¦ï¼‰åŠ CA è¯ä¹¦é“¾ã€‚å®¢æˆ·ç«¯ä½¿ç”¨è¿™ä¸ªæ–‡ä»¶æ¥éªŒè¯å®ƒä»¬æ­£åœ¨ä¸æ­£ç¡®çš„æœåŠ¡å™¨è¿›è¡Œé€šä¿¡ï¼Œå¹¶ä¸”æ­¤æœåŠ¡å™¨ä¹Ÿä¿¡ä»»è¯¥å®¢æˆ·ç«¯ã€‚</li>\n<li class=\"lvl-4\"><code>http_ca.crt</code>: CA (Certificate Authority) æ ¹è¯ä¹¦æˆ–ä¸­é—´è¯ä¹¦ï¼Œç”¨äºéªŒè¯é€šè¿‡ HTTP åè®®è¿æ¥è‡³ Elasticsearch æœåŠ¡ç«¯ç‚¹çš„èº«ä»½ã€‚å½“å®¢æˆ·ç«¯å°è¯•å»ºç«‹ HTTPS è¿æ¥æ—¶ï¼Œå®ƒä¼šæ£€æŸ¥æ¥è‡ª Elasticsearch çš„è¯ä¹¦æ˜¯å¦ç”±è¿™ä¸ª CA ç­¾åï¼›è¿™æ˜¯ç¡®ä¿åŒæ–¹é€šä¿¡å®‰å…¨çš„é‡è¦æ­¥éª¤ä¹‹ä¸€ã€‚</li>\n<li class=\"lvl-4\"><code>transport.p12</code>: åŒæ ·ä¸º PKCS#12 æ ¼å¼ï¼Œä½†è¿™ä¸ªç‰¹å®šçš„æ–‡ä»¶æ˜¯ç»™ Elasticsearch èŠ‚ç‚¹ä¹‹é—´å†…éƒ¨ä¼ è¾“å±‚ä½¿ç”¨çš„ã€‚åœ¨é›†ç¾¤å†…ï¼ŒèŠ‚ç‚¹é—´éœ€<br>\nè¦ç›¸äº’è®¤è¯ï¼Œtransport.p12å°±åŒ…å«ç€è®©ä¸åŒ Elasticsearch å®ä¾‹èƒ½äº’ç›¸è¯†åˆ«æ‰€éœ€çš„ç§é’¥å’Œè¯ä¹¦ã€‚</li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<p>æ€»ä¹‹ï¼Œ<code>http.p12</code>æœåŠ¡äºé¢å‘ Web çš„æ¥å£ï¼Œè€Œ<code>transport.p12</code>åˆ™å¤„ç† Elasticsearch ç¾¤é›†å†…çš„äº¤äº’ï¼›ä¸¤è€…éƒ½ä¾èµ–äº<code>http_ca.crt</code>æ¥è¿›è¡Œèº«ä»½éªŒè¯è¿‡ç¨‹çš„ä¸€éƒ¨åˆ†ã€‚</p>\n</li>\n</ul>\n<h2 id=\"ESè¯ä¹¦è¿‡æœŸçš„å½±å“\">ESè¯ä¹¦è¿‡æœŸçš„å½±å“</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>â€Œé›†ç¾¤æ— æ³•å¢åŠ æ–°èŠ‚ç‚¹â€Œï¼šç‰¹åˆ«æ˜¯åœ¨é‡å¯é›†ç¾¤æ—¶ï¼ŒèŠ‚ç‚¹æ— æ³•åŠ å…¥é›†ç¾¤ï¼Œå¯¼è‡´æ— æ³•æ­£å¸¸é‡å¯ã€‚â€Œ</p>\n</li>\n<li class=\"lvl-2\">\n<p>â€Œè®¿é—®å¼‚å¸¸â€Œï¼šå¦‚æœä½¿ç”¨è¯ä¹¦è¿æ¥ESé›†ç¾¤ï¼Œä¼šå¯¼è‡´æ— æ³•æ­£å¸¸è®¿é—®é›†ç¾¤ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>â€Œå®‰å…¨é£é™©â€Œï¼šè¯ä¹¦è¿‡æœŸä¼šç ´åè¯ä¹¦é“¾çš„ä¿¡ä»»ï¼Œå¯èƒ½å¼•å‘å®‰å…¨æ¼æ´ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>â€Œæ—¥å¿—å¹²æ‰°â€Œï¼šä¼šæŒç»­å‡ºç°è¯ä¹¦è¿‡æœŸçš„é”™è¯¯æ—¥å¿—ï¼Œå¹²æ‰°é—®é¢˜æ’æŸ¥å’Œè¯Šæ–­ã€‚</p>\n</li>\n</ul>\n<h2 id=\"æŸ¥çœ‹è¯ä¹¦çš„è¿‡æœŸæ—¶é—´\">æŸ¥çœ‹è¯ä¹¦çš„è¿‡æœŸæ—¶é—´</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>é€šè¿‡opensslæŸ¥çœ‹è¯ä¹¦çš„è¿‡æœŸæ—¶é—´</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹crtè¯ä¹¦åˆ°æœŸæ—¶é—´</span></span><br><span class=\"line\"><span class=\"comment\"># -dates: æ˜¾ç¤ºè¯ä¹¦çš„å¼€å§‹æ—¶é—´å’Œç»“æŸæ—¶é—´</span></span><br><span class=\"line\"><span class=\"comment\"># -noout: ä¸è¾“å‡ºè¯ä¹¦çš„è¯¦ç»†ä¿¡æ¯</span></span><br><span class=\"line\">openssl x509 -<span class=\"keyword\">in</span> config/certs/http_ca.crt -dates -noout</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹p12è¯ä¹¦åˆ°æœŸæ—¶é—´</span></span><br><span class=\"line\"><span class=\"comment\"># -clcerts: åªæ˜¾ç¤ºè¯ä¹¦ï¼Œä¸æ˜¾ç¤ºç§é’¥</span></span><br><span class=\"line\"><span class=\"comment\"># -nokeys: ä¸è¾“å‡ºç§é’¥</span></span><br><span class=\"line\"><span class=\"comment\"># -password pass: æŒ‡å®šç§é’¥çš„å¯†ç ï¼Œè¿™é‡Œä¸ºç©º(å› ä¸ºåœ¨åˆ›å»ºè¯ä¹¦æ—¶æ²¡æœ‰è®¾ç½®å¯†ç )ï¼Œæ³¨æ„å¯†ç å¿…é¡»å†™åœ¨pass:çš„åé¢ï¼Œä¸åŠ è¿™ä¸ªå‚æ•°ä¼šæç¤ºä½ è¾“å…¥å¯†ç ï¼Œç›´æ¥å›è½¦å³å¯</span></span><br><span class=\"line\">openssl pkcs12 -<span class=\"keyword\">in</span> ca.p12 -password pass: -clcerts -nokeys | openssl x509 -dates -noout</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>é€šè¿‡ESçš„APIæŸ¥çœ‹è¯ä¹¦è¿‡æœŸæ—¶é—´</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -XGET -k -u <span class=\"string\">&#x27;elastic:123456&#x27;</span> <span class=\"string\">&#x27;https://127.0.0.1:9200/_ssl/certificates?pretty&#x27;</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"è¯ä¹¦è¿‡æœŸå¤„ç†\">è¯ä¹¦è¿‡æœŸå¤„ç†</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Elasticsearch 8 çš„è¯ä¹¦åˆ›å»ºéœ€è¦ä½¿ç”¨å‘½ä»¤è¡Œå·¥å…· <code>elasticsearch-certutil</code>ï¼Œè¿™éƒ¨åˆ†çš„è¯¦ç»†ä¿¡æ¯å¯ä»¥å‚è€ƒ<a href=\"https://www.elastic.co/guide/en/elasticsearch/reference/8.17/certutil.html\">å®˜æ–¹æ–‡æ¡£:elasticsearch-certutil</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>å½“è¯ä¹¦è¿‡æœŸæ—¶ï¼Œéœ€è¦é‡æ–°ç”Ÿæˆè¯ä¹¦ï¼Œå¹¶æ›´æ–°<code>config/certs</code>ç›®å½•ä¸‹çš„æ–‡ä»¶ï¼Œæ›´æ–°å‰è¦å¤‡ä»½åŸè¯ä¹¦ã€‚</p>\n</li>\n</ul>\n<h3 id=\"å¤‡ä»½åŸè¯ä¹¦\">å¤‡ä»½åŸè¯ä¹¦</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ <span class=\"built_in\">cp</span> -r config/certs config/certs.bak</span><br><span class=\"line\">$ <span class=\"built_in\">rm</span> -rf config/certs/*</span><br></pre></td></tr></table></figure>\n<h3 id=\"ç”Ÿæˆæ–°è¯ä¹¦\">ç”Ÿæˆæ–°è¯ä¹¦</h3>\n<h4 id=\"ç”ŸæˆCAè¯ä¹¦\">ç”ŸæˆCAè¯ä¹¦</h4>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç”Ÿæˆcrtè¯ä¹¦</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># --days 36500: æŒ‡å®šè¯ä¹¦çš„æœ‰æ•ˆæœŸï¼Œå•ä½ä¸ºå¤©ï¼Œè¿™é‡Œè®¾ç½®ä¸º 36500 å¤©ï¼Œå¤§çº¦ 10 å¹´</span></span><br><span class=\"line\">$ bin/elasticsearch-certutil ca --pem --out new-ca.zip --days 36500</span><br><span class=\"line\"><span class=\"comment\"># è§£å‹</span></span><br><span class=\"line\">$ unzip new-ca.zip</span><br><span class=\"line\"><span class=\"comment\"># å°†åˆ›å»ºçš„è¯ä¹¦ç§»åŠ¨åˆ°æŒ‡å®šç›®å½•</span></span><br><span class=\"line\">$ <span class=\"built_in\">mv</span> ca/ca.crt config/certs/http_ca.crt</span><br><span class=\"line\">$ <span class=\"built_in\">mv</span> ca/ca.key config/certs/http_ca.key</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¹Ÿå¯ä»¥ç”ŸæˆPKCS#12æ ¼å¼çš„è¯ä¹¦</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ bin/elasticsearch-certutil ca --out config/certs/ca.p12 --days 36500</span><br></pre></td></tr></table></figure>\n<h4 id=\"ç”Ÿæˆtransportè¯ä¹¦\">ç”Ÿæˆtransportè¯ä¹¦</h4>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åŸºäºcrtè¯ä¹¦</span></span><br><span class=\"line\">$ bin/elasticsearch-certutil cert --ca-cert config/certs/http_ca.crt --ca-key config/certs/http_ca.key --out config/certs/transport.p12 --days 36500</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åŸºäºPKCS#12æ ¼å¼çš„è¯ä¹¦</span></span><br><span class=\"line\">$ bin/elasticsearch-certutil cert --ca config/certs/ca.p12 --out config/certs/transport.p12 --days 36500</span><br></pre></td></tr></table></figure>\n<h4 id=\"ç”Ÿæˆhttpè¯ä¹¦\">ç”Ÿæˆhttpè¯ä¹¦</h4>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># è¿™é‡Œæ˜¯äº¤äº’å¼å‘½ä»¤è¡Œ</span></span><br><span class=\"line\">$ bin/elasticsearch-certutil http</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¾“å‡ºè¯´æ˜</p>\n</li>\n</ul>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Generate a CSR? [y/N]n # ä¸ç”ŸæˆCSR</span><br><span class=\"line\">Use an existing CA? [y/N]y # ä½¿ç”¨å·²æœ‰çš„CA</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">ä»¥ä¸‹åŒºåˆ†crtè¯ä¹¦å’ŒPKCS#12æ ¼å¼çš„è¯ä¹¦</span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">crt è¯ä¹¦</span></span><br><span class=\"line\">CA Path: certs/http_ca.crt # CAè¯ä¹¦ï¼Œè¿™é‡Œç›¸å¯¹è·¯å¾„æ˜¯ç›¸å¯¹åº” config ç›®å½•ï¼Œä¹Ÿå¯ä»¥æ˜¯ç»å¯¹è·¯å¾„</span><br><span class=\"line\">CA Key: certs/http_ca.key # CAå¯†é’¥ï¼Œè¿™é‡Œç›¸å¯¹è·¯å¾„æ˜¯ç›¸å¯¹åº” config ç›®å½•ï¼Œä¹Ÿå¯ä»¥æ˜¯ç»å¯¹è·¯å¾„</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">PKCS#12æ ¼å¼çš„è¯ä¹¦</span></span><br><span class=\"line\">CA Path: certs/ca.p12 # CAè¯ä¹¦ï¼Œè¿™é‡Œç›¸å¯¹è·¯å¾„æ˜¯ç›¸å¯¹åº” config ç›®å½•ï¼Œä¹Ÿå¯ä»¥æ˜¯ç»å¯¹è·¯å¾„</span><br><span class=\"line\">Password for ca.p12: # CAå¯†ç ï¼Œå› ä¸ºæ²¡æœ‰è®¾ç½®å¯†ç ï¼Œæ‰€ä»¥è¿™é‡Œç›´æ¥å›è½¦</span><br><span class=\"line\"></span><br><span class=\"line\">For how long should your certificate be valid? [5y] 100y # è¯ä¹¦æœ‰æ•ˆæœŸï¼Œå•ä½ä¸ºå¹´ï¼Œé»˜è®¤æ˜¯ 5 å¹´ï¼Œè¿™é‡Œè®¾ç½®ä¸º 100 å¹´</span><br><span class=\"line\">Generate a certificate per node? [y/N]n # ä¸ä¸ºæ¯ä¸ªèŠ‚ç‚¹åˆ›å»ºç‹¬ç«‹çš„è¯ä¹¦ï¼Œå³æ‰€æœ‰èŠ‚ç‚¹éƒ½ä½¿ç”¨åŒä¸€ä¸ªè¯ä¹¦</span><br><span class=\"line\">Enter all the hostnames that you need, one per line.</span><br><span class=\"line\">When you are done, press &lt;ENTER&gt; once more to move on to the next step.</span><br><span class=\"line\"></span><br><span class=\"line\">localhost # ä¸»æœºåï¼Œè¿™é‡Œå¯ä»¥æ·»åŠ å¤šä¸ªï¼Œå›è½¦ä¸€è¡Œä¸€ä¸ªï¼Œè¿™é‡Œåº”è¯¥å¡«å†™é›†ç¾¤å†…æ‰€æœ‰èŠ‚ç‚¹æœåŠ¡å™¨çš„hostnameï¼Œå¯ä»¥é€šè¿‡ hostname å‘½ä»¤æŸ¥çœ‹</span><br><span class=\"line\">ip-10-250-0-17.cn-northwest-1.compute.internal</span><br><span class=\"line\">ip-10-250-0-173.cn-northwest-1.compute.internal</span><br><span class=\"line\">ip-10-250-0-239.cn-northwest-1.compute.internal</span><br><span class=\"line\"></span><br><span class=\"line\">You entered the following hostnames.</span><br><span class=\"line\"></span><br><span class=\"line\"> - localhost</span><br><span class=\"line\"> - ip-10-250-0-17.cn-northwest-1.compute.internal</span><br><span class=\"line\"> - ip-10-250-0-173.cn-northwest-1.compute.internal</span><br><span class=\"line\"> - ip-10-250-0-239.cn-northwest-1.compute.internal</span><br><span class=\"line\"></span><br><span class=\"line\">Is this correct [Y/n]y # ç¡®è®¤ä¸»æœºåæ˜¯å¦æ­£ç¡®</span><br><span class=\"line\"></span><br><span class=\"line\">Enter all the IP addresses that you need, one per line.</span><br><span class=\"line\">When you are done, press &lt;ENTER&gt; once more to move on to the next step.</span><br><span class=\"line\"></span><br><span class=\"line\">127.0.0.1 # ä¸»æœºIPï¼Œè¿™é‡Œå¯ä»¥æ·»åŠ å¤šä¸ªï¼Œå›è½¦ä¸€è¡Œä¸€ä¸ªï¼Œè¿™é‡Œåº”è¯¥å¡«å†™é›†ç¾¤å†…æ‰€æœ‰èŠ‚ç‚¹æœåŠ¡å™¨çš„IPåœ°å€</span><br><span class=\"line\">10.250.0.17</span><br><span class=\"line\">10.250.0.173</span><br><span class=\"line\">10.250.0.239</span><br><span class=\"line\"></span><br><span class=\"line\">You entered the following IP addresses.</span><br><span class=\"line\"></span><br><span class=\"line\"> - 127.0.0.1</span><br><span class=\"line\"> - 10.250.0.17</span><br><span class=\"line\"> - 10.250.0.173</span><br><span class=\"line\"> - 10.250.0.239</span><br><span class=\"line\"></span><br><span class=\"line\">Is this correct [Y/n]y # ç¡®è®¤IPæ˜¯å¦æ­£ç¡®</span><br><span class=\"line\"></span><br><span class=\"line\">Do you wish to change any of these options? [y/N]n # ä¸ä¿®æ”¹ä»»ä½•é€‰é¡¹</span><br><span class=\"line\"></span><br><span class=\"line\">If you wish to use a blank password, simply press &lt;enter&gt; at the prompt below.</span><br><span class=\"line\">Provide a password for the &quot;http.p12&quot; file:  [&lt;ENTER&gt; for none] # ç›´æ¥å›è½¦ä¸è®¾ç½®å¯†ç </span><br><span class=\"line\"></span><br><span class=\"line\">What filename should be used for the output zip file? [/usr/local/elasticsearch/elasticsearch-8.17.3/elasticsearch-ssl-http.zip] # è¾“å‡ºæ–‡ä»¶åï¼Œè¿™é‡Œå¯ä»¥è‡ªå®šä¹‰ï¼Œé»˜è®¤æ˜¯ elasticsearch-ssl-http.zip</span><br><span class=\"line\"></span><br><span class=\"line\">Zip file written to /usr/local/elasticsearch/elasticsearch-8.17.3/elasticsearch-ssl-http.zip</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è§£å‹å¹¶å°†httpè¯ä¹¦æ‹·è´åˆ°config/certsç›®å½•ä¸‹</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ unzip elasticsearch-ssl-http.zip</span><br><span class=\"line\">Archive:  elasticsearch-ssl-http.zip</span><br><span class=\"line\">   creating: elasticsearch/</span><br><span class=\"line\">  inflating: elasticsearch/README.txt <span class=\"comment\"># è¯´æ˜æ–‡ä»¶</span></span><br><span class=\"line\">  inflating: elasticsearch/http.p12  <span class=\"comment\"># httpè¯ä¹¦</span></span><br><span class=\"line\">  inflating: elasticsearch/sample-elasticsearch.yml <span class=\"comment\"># ç¤ºä¾‹elasticsearché…ç½®æ–‡ä»¶</span></span><br><span class=\"line\">   creating: kibana/</span><br><span class=\"line\">  inflating: kibana/README.txt <span class=\"comment\"># è¯´æ˜æ–‡ä»¶</span></span><br><span class=\"line\">  inflating: kibana/elasticsearch-ca.pem  <span class=\"comment\"># kibanaç”¨äºéªŒè¯ESçš„è¯ä¹¦ï¼Œå³ elasticsearch.ssl.certificateAuthorities ä¸­çš„é…ç½®</span></span><br><span class=\"line\">  inflating: kibana/sample-kibana.yml <span class=\"comment\"># ç¤ºä¾‹kibanaé…ç½®æ–‡ä»¶</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å°†httpè¯ä¹¦æ‹·è´åˆ°config/certsç›®å½•ä¸‹</span></span><br><span class=\"line\">$ <span class=\"built_in\">cp</span> elasticsearch/http.p12 config/certs/http.p12</span><br></pre></td></tr></table></figure>\n<h3 id=\"åˆ†å‘åˆ°ESé›†ç¾¤ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹\">åˆ†å‘åˆ°ESé›†ç¾¤ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¸Šé¢åˆ›å»ºæ–°çš„è¯ä¹¦æ—¶æˆ‘ä»¬åªåœ¨ä¸€ä¸ªèŠ‚ç‚¹ä¸Šè¿›è¡Œå³å¯ï¼Œä¹‹åå°†ç”Ÿæˆå¥½çš„è¯ä¹¦åˆ†å‘åˆ°ESé›†ç¾¤ä¸­çš„å…¶å®ƒèŠ‚ç‚¹ï¼Œè¿™é‡Œå°±æ˜¯ <code>http.p12</code> å’Œ <code>transport.p12</code>ï¼Œå°†å…¶æ‹·è´åˆ°æ¯ä¸ªèŠ‚ç‚¹çš„ <code>config/certs</code> ç›®å½•ä¸‹ï¼Œæ‹·è´å‰åšå¥½åŸè¯ä¹¦çš„å¤‡ä»½ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å¦‚æœ‰å¿…è¦ä¹Ÿå¯ä»¥æ‹·è´ <code>ca.p12</code> æˆ–è€… <code>http_ca.crt</code> å’Œ <code>http_ca.key</code> åˆ°æ¯ä¸ªèŠ‚ç‚¹çš„ <code>config/certs</code> ç›®å½•ä¸‹</p>\n</li>\n</ul>\n<h3 id=\"é‡å¯ESæœåŠ¡\">é‡å¯ESæœåŠ¡</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>é›†ç¾¤ä¸­çš„èŠ‚ç‚¹ä¾æ¬¡é‡å¯</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ bin/elasticsearch -d</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>é‡å¯æ—¶å¯èƒ½ä¼šæŠ¥é”™</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">org.elasticsearch.ElasticsearchSecurityException: failed to load SSL configuration [xpack.security.transport.ssl] - cannot <span class=\"built_in\">read</span> configured [PKCS12] keystore (as a truststore) [/usr/local/elasticsearch/elasticsearch-8.17.3/config/certs/transport.p12] - this is usually caused by an incorrect password; (a keystore password was provided)</span><br><span class=\"line\"><span class=\"comment\"># è™½ç„¶æˆ‘ä»¬æ²¡æœ‰ç»™transport.p12è®¾ç½®å¯†ç ï¼Œä½†è¿™é‡Œä¾æ—§æç¤ºæä¾›çš„å¯†ç ä¸æ­£ç¡®ï¼Œå®é™…ä¸Šè¿™é‡Œä½¿ç”¨çš„æ˜¯ secure_password</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è§£å†³æ–¹æ³•</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ä½¿ç”¨bin/elasticsearch-keystore listæŸ¥çœ‹ç°æœ‰çš„å¯†é’¥åˆ—è¡¨</span></span><br><span class=\"line\">$ bin/elasticsearch-keystore list</span><br><span class=\"line\">keystore.seed</span><br><span class=\"line\">xpack.security.http.ssl.keystore.secure_password</span><br><span class=\"line\">xpack.security.transport.ssl.keystore.secure_password</span><br><span class=\"line\">xpack.security.transport.ssl.truststore.secure_password</span><br><span class=\"line\"><span class=\"comment\"># åˆ é™¤secure_passwordåå†æ¬¡é‡å¯ESæœåŠ¡å°±ä¼šæ­£å¸¸äº†</span></span><br><span class=\"line\">$ bin/elasticsearch-keystore remove xpack.security.http.ssl.keystore.secure_password</span><br><span class=\"line\">$ bin/elasticsearch-keystore remove xpack.security.transport.ssl.keystore.secure_password</span><br><span class=\"line\">$ bin/elasticsearch-keystore remove xpack.security.transport.ssl.truststore.secure_password</span><br></pre></td></tr></table></figure>\n<h3 id=\"æ›¿æ¢Kibanaçš„è¯ä¹¦\">æ›¿æ¢Kibanaçš„è¯ä¹¦</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å°†ä¸Šé¢åˆ›å»ºå¥½çš„ <code>kibana/elasticsearch-ca.pem</code> æ‹·è´åˆ°KibanaæœåŠ¡å™¨ï¼Œæ¯”å¦‚ <code>/usr/local/kibana/kibana-8.17.3/config/certs/elasticsearch-ca.pem</code></p>\n</li>\n<li class=\"lvl-2\">\n<p>ä¿®æ”¹Kibanaé…ç½®æ–‡ä»¶ <code>config/kibana.yml</code> ä¸­çš„ <code>elasticsearch.ssl.certificateAuthorities</code> é…ç½®ï¼Œä½¿å…¶æŒ‡å‘ <code>/usr/local/kibana/kibana-8.17.3/config/certs/elasticsearch-ca.pem</code></p>\n</li>\n</ul>\n<figure class=\"highlight yml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">elasticsearch.ssl.certificateAuthorities:</span> [<span class=\"string\">&quot;/usr/local/kibana/kibana-8.17.3/config/certs/elasticsearch-ca.pem&quot;</span>]</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>é‡å¯KibanaæœåŠ¡</p>\n</li>\n</ul>\n<h2 id=\"è¯ä¹¦æ ¼å¼è½¬æ¢\">è¯ä¹¦æ ¼å¼è½¬æ¢</h2>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># p12è½¬æ¢ä¸ºcrtæ ¼å¼</span></span><br><span class=\"line\">$ openssl pkcs12 -<span class=\"keyword\">in</span> config/certs/ca.p12 -out config/certs/http_ca.crt -nokeys</span><br><span class=\"line\"><span class=\"comment\"># p12è½¬æ¢ä¸ºkeyæ ¼å¼</span></span><br><span class=\"line\">$ openssl pkcs12 -<span class=\"keyword\">in</span> config/certs/ca.p12 -out config/certs/http_ca.key -nocerts -nodes</span><br><span class=\"line\"><span class=\"comment\"># p12è½¬æ¢ä¸ºpemæ ¼å¼</span></span><br><span class=\"line\">$ openssl pkcs12 -<span class=\"keyword\">in</span> config/certs/ca.p12 -out config/certs/http_ca.pem -nodes</span><br><span class=\"line\"><span class=\"comment\"># crtè½¬æ¢å›PKCS12æ ¼å¼</span></span><br><span class=\"line\">$ openssl pkcs12 -<span class=\"built_in\">export</span> -out config/certs/http_ca.p12 -inkey config/certs/http_ca.key -<span class=\"keyword\">in</span> config/certs/http_ca.crt -name <span class=\"string\">&quot;My CA&quot;</span></span><br></pre></td></tr></table></figure>\n<div class=\"tips\">\n<p><em><strong>ç”Ÿæˆhttpè¯ä¹¦æ—¶ä¸ºæ¯ä¸ªèŠ‚ç‚¹å•ç‹¬é…ç½®è¯ä¹¦</strong></em></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Generate a certificate per node? [y/N]y <span class=\"comment\"># æ˜¯å¦ä¸ºæ¯ä¸ªèŠ‚ç‚¹å•ç‹¬é…ç½®è¯ä¹¦ï¼Œè¿™é‡Œé€‰æ‹©æ˜¯</span></span><br><span class=\"line\">node <span class=\"comment\">#1 name: node-1 # èŠ‚ç‚¹åç§°ï¼Œå¿…é¡»ä¸ESé…ç½®æ–‡ä»¶ä¸­çš„node.nameä¸€è‡´</span></span><br><span class=\"line\"></span><br><span class=\"line\">Enter all the hostnames that you need, one per line. <span class=\"comment\"># è¾“å…¥ node-1 èŠ‚ç‚¹çš„hostname</span></span><br><span class=\"line\">When you are <span class=\"keyword\">done</span>, press &lt;ENTER&gt; once more to move on to the next step.</span><br><span class=\"line\"></span><br><span class=\"line\">localhost                                         <span class=\"comment\"># ä¹ æƒ¯åŠ ä¸Š localhost</span></span><br><span class=\"line\">ip-10-250-0-239.cn-northwest-1.compute.internal   <span class=\"comment\"># node-1 çš„ hostname</span></span><br><span class=\"line\"></span><br><span class=\"line\">You entered the following hostnames.</span><br><span class=\"line\"></span><br><span class=\"line\"> - localhost</span><br><span class=\"line\"> - ip-10-250-0-239.cn-northwest-1.compute.internal</span><br><span class=\"line\"></span><br><span class=\"line\">Is this correct [Y/n]y <span class=\"comment\"># ç¡®è®¤æ˜¯å¦æ­£ç¡®</span></span><br><span class=\"line\"></span><br><span class=\"line\">Enter all the IP addresses that you need, one per line. <span class=\"comment\"># è¾“å…¥ node-1 èŠ‚ç‚¹çš„IPåœ°å€</span></span><br><span class=\"line\">When you are <span class=\"keyword\">done</span>, press &lt;ENTER&gt; once more to move on to the next step.</span><br><span class=\"line\"></span><br><span class=\"line\">127.0.0.1                                         <span class=\"comment\"># ä¹ æƒ¯åŠ ä¸Š 127.0.0.1</span></span><br><span class=\"line\">10.250.0.239                                      <span class=\"comment\"># node-1 çš„ IP</span></span><br><span class=\"line\"></span><br><span class=\"line\">You entered the following IP addresses.</span><br><span class=\"line\"></span><br><span class=\"line\"> - 127.0.0.1</span><br><span class=\"line\"> - 10.250.0.239</span><br><span class=\"line\"></span><br><span class=\"line\">Is this correct [Y/n]y <span class=\"comment\"># ç¡®è®¤æ˜¯å¦æ­£ç¡®</span></span><br><span class=\"line\"></span><br><span class=\"line\">Do you wish to change any of these options? [y/N]n <span class=\"comment\"># ä¸ä¿®æ”¹ä»»ä½•é€‰é¡¹</span></span><br><span class=\"line\">Generate additional certificates? [Y/n]y  <span class=\"comment\"># æ˜¯å¦ç”Ÿæˆå…¶ä»–è¯ä¹¦ï¼Œè¿™é‡Œé€‰æ‹©æ˜¯ï¼Œæ¥ç€ä¸ºå…¶å®ƒèŠ‚ç‚¹åˆ›å»ºè¯ä¹¦</span></span><br><span class=\"line\">node <span class=\"comment\">#2 name: node-2 # èŠ‚ç‚¹åç§°ï¼Œå¿…é¡»ä¸ESé…ç½®æ–‡ä»¶ä¸­çš„node.nameä¸€è‡´</span></span><br><span class=\"line\"><span class=\"comment\"># ä¾æ¬¡ä¸ºæ¯ä¸ªèŠ‚ç‚¹åˆ›å»ºè¯ä¹¦</span></span><br><span class=\"line\">â€¦â€¦â€¦â€¦â€¦â€¦</span><br><span class=\"line\"></span><br><span class=\"line\">Generate additional certificates? [Y/n]n <span class=\"comment\"># åˆ›å»ºå¥½æ‰€æœ‰èŠ‚ç‚¹çš„è¯ä¹¦åï¼Œé€‰æ‹©nï¼Œä¸å†åˆ›å»ºæ–°çš„è¯ä¹¦</span></span><br><span class=\"line\"></span><br><span class=\"line\">If you wish to use a blank password, simply press &lt;enter&gt; at the prompt below.</span><br><span class=\"line\">Provide a password <span class=\"keyword\">for</span> the <span class=\"string\">&quot;http.p12&quot;</span> file:  [&lt;ENTER&gt; <span class=\"keyword\">for</span> none] <span class=\"comment\"># ç›´æ¥å›è½¦ä¸è®¾ç½®å¯†ç </span></span><br><span class=\"line\"></span><br><span class=\"line\">What filename should be used <span class=\"keyword\">for</span> the output zip file? [/usr/local/elasticsearch/elasticsearch-8.17.3/elasticsearch-ssl-http.zip] <span class=\"comment\"># è¾“å‡ºæ–‡ä»¶åï¼Œè¿™é‡Œå¯ä»¥è‡ªå®šä¹‰ï¼Œé»˜è®¤æ˜¯ elasticsearch-ssl-http.zip</span></span><br><span class=\"line\"></span><br><span class=\"line\">Zip file written to /usr/local/elasticsearch/elasticsearch-8.17.3/elasticsearch-ssl-http.zip</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-1\">\n<li class=\"lvl-2\">æ­¤æ—¶è§£å‹æŸ¥çœ‹æ–‡ä»¶ç»“æ„</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">unzip elasticsearch-ssl-http.zip</span><br><span class=\"line\">Archive:  elasticsearch-ssl-http.zip</span><br><span class=\"line\">   creating: elasticsearch/</span><br><span class=\"line\">   creating: elasticsearch/node-1/</span><br><span class=\"line\">  inflating: elasticsearch/node-1/README.txt</span><br><span class=\"line\">  inflating: elasticsearch/node-1/http.p12  <span class=\"comment\"># node-1 çš„è¯ä¹¦</span></span><br><span class=\"line\">  inflating: elasticsearch/node-1/sample-elasticsearch.yml</span><br><span class=\"line\">   creating: elasticsearch/node-2/</span><br><span class=\"line\">  inflating: elasticsearch/node-2/README.txt</span><br><span class=\"line\">  inflating: elasticsearch/node-2/http.p12 <span class=\"comment\"># node-2 çš„è¯ä¹¦</span></span><br><span class=\"line\">  inflating: elasticsearch/node-2/sample-elasticsearch.yml</span><br><span class=\"line\">  creating: elasticsearch/node-3/</span><br><span class=\"line\">  inflating: elasticsearch/node-3/README.txt</span><br><span class=\"line\">  inflating: elasticsearch/node-3/http.p12 <span class=\"comment\"># node-3 çš„è¯ä¹¦</span></span><br><span class=\"line\">  inflating: elasticsearch/node-3/sample-elasticsearch.yml</span><br><span class=\"line\">   creating: kibana/</span><br><span class=\"line\">  inflating: kibana/README.txt</span><br><span class=\"line\">  inflating: kibana/elasticsearch-ca.pem <span class=\"comment\"># kibana çš„è¯ä¹¦</span></span><br><span class=\"line\">  inflating: kibana/sample-kibana.yml</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-1\">\n<li class=\"lvl-2\">\n<p>å°†å¯¹åº”çš„è¯ä¹¦æ‹·è´åˆ°å¯¹åº”èŠ‚ç‚¹çš„ <code>config/certs</code> ç›®å½•ä¸‹</p>\n</li>\n</ul>\n</div>\n","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç»Elasticsearchè¯ä¹¦è¿‡æœŸæ—¶çš„å¤„ç†æ–¹æ³• Elasticsearchç‰ˆæœ¬8.17.3 æœ¬æ–‡åŸºäº linuxä¸‹å®‰è£…Elasticsearch å®˜æ–¹æ–‡æ¡£:Updating node security certificates ESè¯ä¹¦ç®€ä»‹ Elasticsearch 8 é»˜è®¤æƒ…å†µä¸‹åˆ›å»ºçš„è¯ä¹¦åªæœ‰3å¹´æœ‰æ•ˆæœŸï¼Œè¿‡æœŸæ—¶éœ€è¦åˆ›å»ºæ–°çš„è¯ä¹¦ï¼Œä¸ºäº†ä¸å¿…è¦çš„éº»çƒ¦ï¼Œä¹Ÿå¯ä»¥ä¸€å¼€å§‹å°±åˆ›å»ºä¸€ä¸ªæœ‰æ•ˆæœŸæ¯”è¾ƒé•¿çš„è¯ä¹¦ã€‚ åœ¨ Elasticsearch 8 çš„é…ç½®ä¸‹ï¼Œconfig/certs ç›®å½•é€šå¸¸å­˜æ”¾çš„æ˜¯ç”¨äºå®‰å…¨é€šä¿¡çš„è¯ä¹¦å’Œå¯†é’¥æ–‡ä»¶ã€‚è¿™äº›æ–‡ä»¶ç¡®ä¿äº† Elasticsearch å®ä¾‹ä¹‹é—´çš„é€šè®¯ä»¥åŠä¸å¤–éƒ¨å®¢æˆ·ç«¯çš„é€šè®¯èƒ½å¤Ÿè¢«åŠ å¯†ä¸”ç»è¿‡è®¤è¯ã€‚ config/certs ç›®å½•åŒ…å«ä¸‰ä¸ªæ–‡ä»¶åˆ†åˆ«æ˜¯ï¼š http.p12: è¿™æ˜¯ä¸€ä¸ª PKCS#12 æ ¼å¼çš„æ–‡ä»¶ï¼ˆé€šå¸¸å¸¦æœ‰.p12æˆ–.pfxæ‰©å±•åï¼‰ï¼ŒåŒ…å«äº† Elasticsearch HTTP å±‚ç”¨æ¥è¿›è¡Œ TLS/SSL é€šä¿¡æ‰€éœ€çš„ä¸€åˆ‡ï¼ŒåŒ…æ‹¬ä¸€ä¸ªç§é’¥ã€ç›¸åº”çš„å…¬é’¥è¯ä¹¦ï¼ˆæœåŠ¡å™¨è¯ä¹¦ï¼‰åŠ CA è¯ä¹¦é“¾ã€‚å®¢æˆ·ç«¯ä½¿ç”¨è¿™ä¸ªæ–‡ä»¶æ¥éªŒè¯å®ƒä»¬æ­£åœ¨ä¸æ­£ç¡®çš„æœåŠ¡å™¨è¿›è¡Œé€šä¿¡ï¼Œå¹¶ä¸”æ­¤æœåŠ¡å™¨ä¹Ÿä¿¡ä»»è¯¥å®¢æˆ·ç«¯ã€‚ http_ca.crt: CA (Certificate Authority) æ ¹è¯ä¹¦æˆ–ä¸­é—´è¯ä¹¦ï¼Œç”¨äºéªŒè¯é€šè¿‡ HTTP åè®®è¿æ¥è‡³ Elasticsearch æœåŠ¡ç«¯ç‚¹çš„èº«ä»½ã€‚å½“å®¢æˆ·ç«¯å°è¯•å»ºç«‹ HTTPS è¿æ¥æ—¶ï¼Œå®ƒä¼šæ£€æŸ¥æ¥è‡ª Elasticsearch çš„è¯ä¹¦æ˜¯å¦ç”±è¿™ä¸ª CA ç­¾åï¼›è¿™æ˜¯ç¡®ä¿åŒæ–¹é€šä¿¡å®‰å…¨çš„é‡è¦æ­¥éª¤ä¹‹ä¸€ã€‚ transport.p12: åŒæ ·ä¸º PKCS#12 æ ¼å¼ï¼Œä½†è¿™ä¸ªç‰¹å®šçš„æ–‡ä»¶æ˜¯ç»™ Elasticsearch èŠ‚ç‚¹ä¹‹é—´å†…éƒ¨ä¼ è¾“å±‚ä½¿ç”¨çš„ã€‚åœ¨é›†ç¾¤å†…ï¼ŒèŠ‚ç‚¹é—´éœ€ è¦ç›¸äº’è®¤è¯ï¼Œtransport.p12å°±åŒ…å«ç€è®©ä¸åŒ Elasticsearch å®ä¾‹èƒ½äº’ç›¸è¯†åˆ«æ‰€éœ€çš„ç§é’¥å’Œè¯ä¹¦ã€‚ æ€»ä¹‹ï¼Œhttp.p12æœåŠ¡äºé¢å‘ Web çš„æ¥å£ï¼Œè€Œtransport.p12åˆ™å¤„ç† Elasticsearch ç¾¤é›†å†…çš„äº¤äº’ï¼›ä¸¤è€…éƒ½ä¾èµ–äºhttp_ca.crtæ¥è¿›è¡Œèº«ä»½éªŒè¯è¿‡ç¨‹çš„ä¸€éƒ¨åˆ†ã€‚ ESè¯ä¹¦è¿‡æœŸçš„å½±å“ â€Œé›†ç¾¤æ— æ³•å¢åŠ æ–°èŠ‚ç‚¹â€Œï¼šç‰¹åˆ«æ˜¯åœ¨é‡å¯é›†ç¾¤æ—¶ï¼ŒèŠ‚ç‚¹æ— æ³•åŠ å…¥é›†ç¾¤ï¼Œå¯¼è‡´æ— æ³•æ­£å¸¸é‡å¯ã€‚â€Œ â€Œè®¿é—®å¼‚å¸¸â€Œï¼šå¦‚æœä½¿ç”¨è¯ä¹¦è¿æ¥ESé›†ç¾¤ï¼Œä¼šå¯¼è‡´æ— æ³•æ­£å¸¸è®¿é—®é›†ç¾¤ã€‚ â€Œå®‰å…¨é£é™©â€Œï¼šè¯ä¹¦è¿‡æœŸä¼šç ´åè¯ä¹¦é“¾çš„ä¿¡ä»»ï¼Œå¯èƒ½å¼•å‘å®‰å…¨æ¼æ´ã€‚ â€Œæ—¥å¿—å¹²æ‰°â€Œï¼šä¼šæŒç»­å‡ºç°è¯ä¹¦è¿‡æœŸçš„é”™è¯¯æ—¥å¿—ï¼Œå¹²æ‰°é—®é¢˜æ’æŸ¥å’Œè¯Šæ–­ã€‚ æŸ¥çœ‹è¯ä¹¦çš„è¿‡æœŸæ—¶é—´ é€šè¿‡opensslæŸ¥çœ‹è¯ä¹¦çš„è¿‡æœŸæ—¶é—´ 12345678910# æŸ¥çœ‹crtè¯ä¹¦åˆ°æœŸæ—¶é—´# -dates: æ˜¾ç¤ºè¯ä¹¦çš„å¼€å§‹æ—¶é—´å’Œç»“æŸæ—¶é—´# -noout: ä¸è¾“å‡ºè¯ä¹¦çš„è¯¦ç»†ä¿¡æ¯openssl x509 -in config/certs/http_ca.crt -dates -noout# æŸ¥çœ‹p12è¯ä¹¦åˆ°æœŸæ—¶é—´# -clcerts: åªæ˜¾ç¤ºè¯ä¹¦ï¼Œä¸æ˜¾ç¤ºç§é’¥# -nokeys: ä¸è¾“å‡ºç§é’¥# -password pass: æŒ‡å®šç§é’¥çš„å¯†ç ï¼Œè¿™é‡Œä¸ºç©º(å› ä¸ºåœ¨åˆ›å»ºè¯ä¹¦æ—¶æ²¡æœ‰è®¾ç½®å¯†ç )ï¼Œæ³¨æ„å¯†ç å¿…é¡»å†™åœ¨pass:çš„åé¢ï¼Œä¸åŠ è¿™ä¸ªå‚æ•°ä¼šæç¤ºä½ è¾“å…¥å¯†ç ï¼Œç›´æ¥å›è½¦å³å¯openssl pkcs12 -in ca.p12 -password pass: -clcerts -nokeys | openssl x509 -dates -noout é€šè¿‡ESçš„APIæŸ¥çœ‹è¯ä¹¦è¿‡æœŸæ—¶é—´ 1curl -XGET -k -u &#x27;elastic:123456&#x27; &#x27;https://127.0.0.1:9200/_ssl/certificates?pretty&#x27; è¯ä¹¦è¿‡æœŸå¤„ç† Elasticsearch 8 çš„è¯ä¹¦åˆ›å»ºéœ€è¦ä½¿ç”¨å‘½ä»¤è¡Œå·¥å…· elasticsearch-certutilï¼Œè¿™éƒ¨åˆ†çš„è¯¦ç»†ä¿¡æ¯å¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£:elasticsearch-certutil å½“è¯ä¹¦è¿‡æœŸæ—¶ï¼Œéœ€è¦é‡æ–°ç”Ÿæˆè¯ä¹¦ï¼Œå¹¶æ›´æ–°config/certsç›®å½•ä¸‹çš„æ–‡ä»¶ï¼Œæ›´æ–°å‰è¦å¤‡ä»½åŸè¯ä¹¦ã€‚ å¤‡ä»½åŸè¯ä¹¦ 12$ cp -r config/certs config/certs.bak$ rm -rf config/certs/* ç”Ÿæˆæ–°è¯ä¹¦ ç”ŸæˆCAè¯ä¹¦ ç”Ÿæˆcrtè¯ä¹¦ 1234567# --days 36500: æŒ‡å®šè¯ä¹¦çš„æœ‰æ•ˆæœŸï¼Œå•ä½ä¸ºå¤©ï¼Œè¿™é‡Œè®¾ç½®ä¸º 36500 å¤©ï¼Œå¤§çº¦ 10 å¹´$ bin/elasticsearch-certutil ca --pem --out new-ca.zip --days 36500# è§£å‹$ unzip new-ca.zip# å°†åˆ›å»ºçš„è¯ä¹¦ç§»åŠ¨åˆ°æŒ‡å®šç›®å½•$ mv ca/ca.crt config/certs/http_ca.crt$ mv ca/ca.key config/certs/http_ca.key ä¹Ÿå¯ä»¥ç”ŸæˆPKCS#12æ ¼å¼çš„è¯ä¹¦ 1$ bin/elasticsearch-certutil ca --out config/certs/ca.p12 --days 36500 ç”Ÿæˆtransportè¯ä¹¦ 12345# åŸºäºcrtè¯ä¹¦$ bin/elasticsearch-certutil cert --ca-cert config/certs/http_ca.crt --ca-key config/certs/http_ca.key --out config/certs/transport.p12 --days 36500# åŸºäºPKCS#12æ ¼å¼çš„è¯ä¹¦$ bin/elasticsearch-certutil cert --ca config/certs/ca.p12 --out config/certs/transport.p12 --days 36500 ç”Ÿæˆhttpè¯ä¹¦ 12# è¿™é‡Œæ˜¯äº¤äº’å¼å‘½ä»¤è¡Œ$ bin/elasticsearch-certutil http è¾“å‡ºè¯´æ˜ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556Generate a CSR? [y/N]n # ä¸ç”ŸæˆCSRUse an existing CA? [y/N]y # ä½¿ç”¨å·²æœ‰çš„CA# ä»¥ä¸‹åŒºåˆ†crtè¯ä¹¦å’ŒPKCS#12æ ¼å¼çš„è¯ä¹¦# crt è¯ä¹¦CA Path: certs/http_ca.crt # CAè¯ä¹¦ï¼Œè¿™é‡Œç›¸å¯¹è·¯å¾„æ˜¯ç›¸å¯¹åº” config ç›®å½•ï¼Œä¹Ÿå¯ä»¥æ˜¯ç»å¯¹è·¯å¾„CA Key: certs/http_ca.key # CAå¯†é’¥ï¼Œè¿™é‡Œç›¸å¯¹è·¯å¾„æ˜¯ç›¸å¯¹åº” config ç›®å½•ï¼Œä¹Ÿå¯ä»¥æ˜¯ç»å¯¹è·¯å¾„# PKCS#12æ ¼å¼çš„è¯ä¹¦CA Path: certs/ca.p12 # CAè¯ä¹¦ï¼Œè¿™é‡Œç›¸å¯¹è·¯å¾„æ˜¯ç›¸å¯¹åº” config ç›®å½•ï¼Œä¹Ÿå¯ä»¥æ˜¯ç»å¯¹è·¯å¾„Password for ca.p12: # CAå¯†ç ï¼Œå› ä¸ºæ²¡æœ‰è®¾ç½®å¯†ç ï¼Œæ‰€ä»¥è¿™é‡Œç›´æ¥å›è½¦For how long should your certificate be valid? [5y] 100y # è¯ä¹¦æœ‰æ•ˆæœŸï¼Œå•ä½ä¸ºå¹´ï¼Œé»˜è®¤æ˜¯ 5 å¹´ï¼Œè¿™é‡Œè®¾ç½®ä¸º 100 å¹´Generate a certificate per node? [y/N]n # ä¸ä¸ºæ¯ä¸ªèŠ‚ç‚¹åˆ›å»ºç‹¬ç«‹çš„è¯ä¹¦ï¼Œå³æ‰€æœ‰èŠ‚ç‚¹éƒ½ä½¿ç”¨åŒä¸€ä¸ªè¯ä¹¦Enter all the hostnames that you need, one per line.When you are done, press &lt;ENTER&gt; once more to move on to the next step.localhost # ä¸»æœºåï¼Œè¿™é‡Œå¯ä»¥æ·»åŠ å¤šä¸ªï¼Œå›è½¦ä¸€è¡Œä¸€ä¸ªï¼Œè¿™é‡Œåº”è¯¥å¡«å†™é›†ç¾¤å†…æ‰€æœ‰èŠ‚ç‚¹æœåŠ¡å™¨çš„hostnameï¼Œå¯ä»¥é€šè¿‡ hostname å‘½ä»¤æŸ¥çœ‹ip-10-250-0-17.cn-northwest-1.compute.internalip-10-250-0-173.cn-northwest-1.compute.internalip-10-250-0-239.cn-northwest-1.compute.internalYou entered the following hostnames. - localhost - ip-10-250-0-17.cn-northwest-1.compute.internal - ip-10-250-0-173.cn-northwest-1.compute.internal - ip-10-250-0-239.cn-northwest-1.compute.internalIs this correct [Y/n]y # ç¡®è®¤ä¸»æœºåæ˜¯å¦æ­£ç¡®Enter all the IP addresses that you need, one per line.When you are done, press &lt;ENTER&gt; once more to move on to the next step.127.0.0.1 # ä¸»æœºIPï¼Œè¿™é‡Œå¯ä»¥æ·»åŠ å¤šä¸ªï¼Œå›è½¦ä¸€è¡Œä¸€ä¸ªï¼Œè¿™é‡Œåº”è¯¥å¡«å†™é›†ç¾¤å†…æ‰€æœ‰èŠ‚ç‚¹æœåŠ¡å™¨çš„IPåœ°å€10.250.0.1710.250.0.17310.250.0.239You entered the following IP addresses. - 127.0.0.1 - 10.250.0.17 - 10.250.0.173 - 10.250.0.239Is this correct [Y/n]y # ç¡®è®¤IPæ˜¯å¦æ­£ç¡®Do you wish to change any of these options? [y/N]n # ä¸ä¿®æ”¹ä»»ä½•é€‰é¡¹If you wish to use a blank password, simply press &lt;enter&gt; at the prompt below.Provide a password for the &quot;http.p12&quot; file: [&lt;ENTER&gt; for none] # ç›´æ¥å›è½¦ä¸è®¾ç½®å¯†ç What filename should be used for the output zip file? [/usr/local/elasticsearch/elasticsearch-8.17.3/elasticsearch-ssl-http.zip] # è¾“å‡ºæ–‡ä»¶åï¼Œè¿™é‡Œå¯ä»¥è‡ªå®šä¹‰ï¼Œé»˜è®¤æ˜¯ elasticsearch-ssl-http.zipZip file written to /usr/local/elasticsearch/elasticsearch-8.17.3/elasticsearch-ssl-http.zip è§£å‹å¹¶å°†httpè¯ä¹¦æ‹·è´åˆ°config/certsç›®å½•ä¸‹ 12345678910111213$ unzip elasticsearch-ssl-http.zipArchive: elasticsearch-ssl-http.zip creating: elasticsearch/ inflating: elasticsearch/README.txt # è¯´æ˜æ–‡ä»¶ inflating: elasticsearch/http.p12 # httpè¯ä¹¦ inflating: elasticsearch/sample-elasticsearch.yml # ç¤ºä¾‹elasticsearché…ç½®æ–‡ä»¶ creating: kibana/ inflating: kibana/README.txt # è¯´æ˜æ–‡ä»¶ inflating: kibana/elasticsearch-ca.pem # kibanaç”¨äºéªŒè¯ESçš„è¯ä¹¦ï¼Œå³ elasticsearch.ssl.certificateAuthorities ä¸­çš„é…ç½® inflating: kibana/sample-kibana.yml # ç¤ºä¾‹kibanaé…ç½®æ–‡ä»¶# å°†httpè¯ä¹¦æ‹·è´åˆ°config/certsç›®å½•ä¸‹$ cp elasticsearch/http.p12 config/certs/http.p12 åˆ†å‘åˆ°ESé›†ç¾¤ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹ ä¸Šé¢åˆ›å»ºæ–°çš„è¯ä¹¦æ—¶æˆ‘ä»¬åªåœ¨ä¸€ä¸ªèŠ‚ç‚¹ä¸Šè¿›è¡Œå³å¯ï¼Œä¹‹åå°†ç”Ÿæˆå¥½çš„è¯ä¹¦åˆ†å‘åˆ°ESé›†ç¾¤ä¸­çš„å…¶å®ƒèŠ‚ç‚¹ï¼Œè¿™é‡Œå°±æ˜¯ http.p12 å’Œ transport.p12ï¼Œå°†å…¶æ‹·è´åˆ°æ¯ä¸ªèŠ‚ç‚¹çš„ config/certs ç›®å½•ä¸‹ï¼Œæ‹·è´å‰åšå¥½åŸè¯ä¹¦çš„å¤‡ä»½ã€‚ å¦‚æœ‰å¿…è¦ä¹Ÿå¯ä»¥æ‹·è´ ca.p12 æˆ–è€… http_ca.crt å’Œ http_ca.key åˆ°æ¯ä¸ªèŠ‚ç‚¹çš„ config/certs ç›®å½•ä¸‹ é‡å¯ESæœåŠ¡ é›†ç¾¤ä¸­çš„èŠ‚ç‚¹ä¾æ¬¡é‡å¯ 1$ bin/elasticsearch -d é‡å¯æ—¶å¯èƒ½ä¼šæŠ¥é”™ 12org.elasticsearch.ElasticsearchSecurityException: failed to load SSL configuration [xpack.security.transport.ssl] - cannot read configured [PKCS12] keystore (as a truststore) [/usr/local/elasticsearch/elasticsearch-8.17.3/config/certs/transport.p12] - this is usually caused by an incorrect password; (a keystore password was provided)# è™½ç„¶æˆ‘ä»¬æ²¡æœ‰ç»™transport.p12è®¾ç½®å¯†ç ï¼Œä½†è¿™é‡Œä¾æ—§æç¤ºæä¾›çš„å¯†ç ä¸æ­£ç¡®ï¼Œå®é™…ä¸Šè¿™é‡Œä½¿ç”¨çš„æ˜¯ secure_password è§£å†³æ–¹æ³• 12345678910# ä½¿ç”¨bin/elasticsearch-keystore listæŸ¥çœ‹ç°æœ‰çš„å¯†é’¥åˆ—è¡¨$ bin/elasticsearch-keystore listkeystore.seedxpack.security.http.ssl.keystore.secure_passwordxpack.security.transport.ssl.keystore.secure_passwordxpack.security.transport.ssl.truststore.secure_password# åˆ é™¤secure_passwordåå†æ¬¡é‡å¯ESæœåŠ¡å°±ä¼šæ­£å¸¸äº†$ bin/elasticsearch-keystore remove xpack.security.http.ssl.keystore.secure_password$ bin/elasticsearch-keystore remove xpack.security.transport.ssl.keystore.secure_password$ bin/elasticsearch-keystore remove xpack.security.transport.ssl.truststore.secure_password æ›¿æ¢Kibanaçš„è¯ä¹¦ å°†ä¸Šé¢åˆ›å»ºå¥½çš„ kibana/elasticsearch-ca.pem æ‹·è´åˆ°KibanaæœåŠ¡å™¨ï¼Œæ¯”å¦‚ /usr/local/kibana/kibana-8.17.3/config/certs/elasticsearch-ca.pem ä¿®æ”¹Kibanaé…ç½®æ–‡ä»¶ config/kibana.yml ä¸­çš„ elasticsearch.ssl.certificateAuthorities é…ç½®ï¼Œä½¿å…¶æŒ‡å‘ /usr/local/kibana/kibana-8.17.3/config/certs/elasticsearch-ca.pem 1elasticsearch.ssl.certificateAuthorities: [&quot;/usr/local/kibana/kibana-8.17.3/config/certs/elasticsearch-ca.pem&quot;] é‡å¯KibanaæœåŠ¡ è¯ä¹¦æ ¼å¼è½¬æ¢ 12345678# p12è½¬æ¢ä¸ºcrtæ ¼å¼$ openssl pkcs12 -in config/certs/ca.p12 -out config/certs/http_ca.crt -nokeys# p12è½¬æ¢ä¸ºkeyæ ¼å¼$ openssl pkcs12 -in config/certs/ca.p12 -out config/certs/http_ca.key -nocerts -nodes# p12è½¬æ¢ä¸ºpemæ ¼å¼$ openssl pkcs12 -in config/certs/ca.p12 -out config/certs/http_ca.pem -nodes# crtè½¬æ¢å›PKCS12æ ¼å¼$ openssl pkcs12 -export -out config/certs/http_ca.p12 -inkey config/certs/http_ca.key -in config/certs/http_ca.crt -name &quot;My CA&quot; ç”Ÿæˆhttpè¯ä¹¦æ—¶ä¸ºæ¯ä¸ªèŠ‚ç‚¹å•ç‹¬é…ç½®è¯ä¹¦ 12345678910111213141516171819202122232425262728293031323334353637383940414243Generate a certificate per node? [y/N]y # æ˜¯å¦ä¸ºæ¯ä¸ªèŠ‚ç‚¹å•ç‹¬é…ç½®è¯ä¹¦ï¼Œè¿™é‡Œé€‰æ‹©æ˜¯node #1 name: node-1 # èŠ‚ç‚¹åç§°ï¼Œå¿…é¡»ä¸ESé…ç½®æ–‡ä»¶ä¸­çš„node.nameä¸€è‡´Enter all the hostnames that you need, one per line. # è¾“å…¥ node-1 èŠ‚ç‚¹çš„hostnameWhen you are done, press &lt;ENTER&gt; once more to move on to the next step.localhost # ä¹ æƒ¯åŠ ä¸Š localhostip-10-250-0-239.cn-northwest-1.compute.internal # node-1 çš„ hostnameYou entered the following hostnames. - localhost - ip-10-250-0-239.cn-northwest-1.compute.internalIs this correct [Y/n]y # ç¡®è®¤æ˜¯å¦æ­£ç¡®Enter all the IP addresses that you need, one per line. # è¾“å…¥ node-1 èŠ‚ç‚¹çš„IPåœ°å€When you are done, press &lt;ENTER&gt; once more to move on to the next step.127.0.0.1 # ä¹ æƒ¯åŠ ä¸Š 127.0.0.110.250.0.239 # node-1 çš„ IPYou entered the following IP addresses. - 127.0.0.1 - 10.250.0.239Is this correct [Y/n]y # ç¡®è®¤æ˜¯å¦æ­£ç¡®Do you wish to change any of these options? [y/N]n # ä¸ä¿®æ”¹ä»»ä½•é€‰é¡¹Generate additional certificates? [Y/n]y # æ˜¯å¦ç”Ÿæˆå…¶ä»–è¯ä¹¦ï¼Œè¿™é‡Œé€‰æ‹©æ˜¯ï¼Œæ¥ç€ä¸ºå…¶å®ƒèŠ‚ç‚¹åˆ›å»ºè¯ä¹¦node #2 name: node-2 # èŠ‚ç‚¹åç§°ï¼Œå¿…é¡»ä¸ESé…ç½®æ–‡ä»¶ä¸­çš„node.nameä¸€è‡´# ä¾æ¬¡ä¸ºæ¯ä¸ªèŠ‚ç‚¹åˆ›å»ºè¯ä¹¦â€¦â€¦â€¦â€¦â€¦â€¦Generate additional certificates? [Y/n]n # åˆ›å»ºå¥½æ‰€æœ‰èŠ‚ç‚¹çš„è¯ä¹¦åï¼Œé€‰æ‹©nï¼Œä¸å†åˆ›å»ºæ–°çš„è¯ä¹¦If you wish to use a blank password, simply press &lt;enter&gt; at the prompt below.Provide a password for the &quot;http.p12&quot; file: [&lt;ENTER&gt; for none] # ç›´æ¥å›è½¦ä¸è®¾ç½®å¯†ç What filename should be used for the output zip file? [/usr/local/elasticsearch/elasticsearch-8.17.3/elasticsearch-ssl-http.zip] # è¾“å‡ºæ–‡ä»¶åï¼Œè¿™é‡Œå¯ä»¥è‡ªå®šä¹‰ï¼Œé»˜è®¤æ˜¯ elasticsearch-ssl-http.zipZip file written to /usr/local/elasticsearch/elasticsearch-8.17.3/elasticsearch-ssl-http.zip æ­¤æ—¶è§£å‹æŸ¥çœ‹æ–‡ä»¶ç»“æ„ 12345678910111213141516171819unzip elasticsearch-ssl-http.zipArchive: elasticsearch-ssl-http.zip creating: elasticsearch/ creating: elasticsearch/node-1/ inflating: elasticsearch/node-1/README.txt inflating: elasticsearch/node-1/http.p12 # node-1 çš„è¯ä¹¦ inflating: elasticsearch/node-1/sample-elasticsearch.yml creating: elasticsearch/node-2/ inflating: elasticsearch/node-2/README.txt inflating: elasticsearch/node-2/http.p12 # node-2 çš„è¯ä¹¦ inflating: elasticsearch/node-2/sample-elasticsearch.yml creating: elasticsearch/node-3/ inflating: elasticsearch/node-3/README.txt inflating: elasticsearch/node-3/http.p12 # node-3 çš„è¯ä¹¦ inflating: elasticsearch/node-3/sample-elasticsearch.yml creating: kibana/ inflating: kibana/README.txt inflating: kibana/elasticsearch-ca.pem # kibana çš„è¯ä¹¦ inflating: kibana/sample-kibana.yml å°†å¯¹åº”çš„è¯ä¹¦æ‹·è´åˆ°å¯¹åº”èŠ‚ç‚¹çš„ config/certs ç›®å½•ä¸‹","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç»Elasticsearchè¯ä¹¦è¿‡æœŸæ—¶çš„å¤„ç†æ–¹æ³• Elasticsearchç‰ˆæœ¬8.17.3 æœ¬æ–‡åŸºäº linuxä¸‹å®‰è£…Elasticsearch å®˜æ–¹æ–‡æ¡£:Updating node security certificates","date_published":"2025-04-16T13:30:05.000Z","tags":["æŠ€æœ¯","elastic","elasticsearch","elasticsearch"]},{"id":"https://blog.hanqunfeng.com/2025/04/07/elk-02-springboot/","url":"https://blog.hanqunfeng.com/2025/04/07/elk-02-springboot/","title":"Springbootæ•´åˆLogstashå®ç°æ—¥å¿—é‡‡é›†","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç»å¦‚ä½•åœ¨Springbooté¡¹ç›®ä¸­æ•´åˆLogStashå®ç°æ—¥å¿—é‡‡é›†</p>\n</li>\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡åŸºäºSpringboot2.7.xç‰ˆæœ¬è¿›è¡Œæµ‹è¯•ï¼ŒLogstashç‰ˆæœ¬ä¸º8.17.3</p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"ä½¿ç”¨logstashæ—¥å¿—æ’ä»¶\">ä½¿ç”¨logstashæ—¥å¿—æ’ä»¶</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><a href=\"https://github.com/logfellow/logstash-logback-encoder\">SpringBootçš„Logstashæ—¥å¿—æ’ä»¶</a>ï¼Œæœ¬æ–‡åªè¿›è¡Œç®€å•ä»‹ç»ï¼Œæ›´å¤šè¯¦ç»†é…ç½®å¯ä»¥å‚è€ƒ<a href=\"https://github.com/logfellow/logstash-logback-encoder\">å®˜æ–¹æ–‡æ¡£</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>å¼•å…¥ä¾èµ–ï¼Œè¿™é‡Œéœ€è¦æ³¨æ„8.xä»¥ä¸Šçš„ç‰ˆæœ¬éœ€è¦jdk11ï¼Œå¦‚æœæ˜¯jdk8çš„è¯å¯ä»¥ä½¿ç”¨6.xæˆ–7.xç‰ˆæœ¬</p>\n</li>\n</ul>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">   <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>net.logstash.logback<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">   <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>logstash-logback-encoder<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">   <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>7.3<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span> <span class=\"comment\">&lt;!-- ç‰ˆæœ¬å·æ ¹æ®å®é™…æƒ…å†µä¿®æ”¹ --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>æ³¨æ„ï¼š<br>\nspringboot2.7.xä»¥ä¸‹ç‰ˆæœ¬ï¼Œå»ºè®®ä½¿ç”¨logstash-logback-encoderçš„7.3ä»¥ä¸‹ç‰ˆæœ¬ã€‚<br>\nspringboot3.x.xä»¥ä¸Šç‰ˆæœ¬ï¼Œå»ºè®®ä½¿ç”¨logstash-logback-encoderçš„7.4åŠä»¥ä¸Šç‰ˆæœ¬ã€‚</p>\n</blockquote>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><code>logback-spring.xml</code>ä¸­æ·»åŠ logstashé…ç½®</p>\n</li>\n</ul>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?xml version=<span class=\"string\">&quot;1.0&quot;</span> encoding=<span class=\"string\">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">configuration</span> <span class=\"attr\">debug</span>=<span class=\"string\">&quot;false&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- æ§åˆ¶å°è¾“å‡º --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">appender</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;STDOUT&quot;</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;ch.qos.logback.core.ConsoleAppender&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">encoder</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;ch.qos.logback.classic.encoder.PatternLayoutEncoder&quot;</span>&gt;</span></span><br><span class=\"line\">            <span class=\"comment\">&lt;!--æ ¼å¼åŒ–è¾“å‡ºï¼š%dè¡¨ç¤ºæ—¥æœŸï¼Œ%threadè¡¨ç¤ºçº¿ç¨‹åï¼Œ%-5levelï¼šçº§åˆ«ä»å·¦æ˜¾ç¤º5ä¸ªå­—ç¬¦å®½åº¦ %logger&#123;50&#125;ï¼šç±»è·¯å¾„ï¼Œæœ€å¤§æ˜¾ç¤º50ä¸ªå­—ç¬¦ %Mï¼šæ–¹æ³•åç§° %Lï¼šè¡Œå· %msgï¼šæ—¥å¿—æ¶ˆæ¯ï¼Œ%næ˜¯æ¢è¡Œç¬¦--&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">pattern</span>&gt;</span>[%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125;] [%thread] %-5level [%X&#123;userName&#125;][%X&#123;userLocale&#125;] %logger&#123;50&#125; - %M - %L - %msg%n<span class=\"tag\">&lt;/<span class=\"name\">pattern</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">encoder</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">appender</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- logstashè¾“å‡º --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">appender</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;LOGSTASH&quot;</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;net.logstash.logback.appender.LogstashTcpSocketAppender&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">destination</span>&gt;</span>161.189.78.202:4560<span class=\"tag\">&lt;/<span class=\"name\">destination</span>&gt;</span> <span class=\"comment\">&lt;!-- logstashåœ°å€å’Œç«¯å£ --&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">encoder</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;net.logstash.logback.encoder.LogstashEncoder&quot;</span> &gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">timestampPattern</span>&gt;</span>yyyy-MM-dd&#x27;T&#x27;HH:mm:ss.SSS<span class=\"tag\">&lt;/<span class=\"name\">timestampPattern</span>&gt;</span> <span class=\"comment\">&lt;!-- æ—¶é—´æ ¼å¼ï¼Œè¿™ä¸ªæ˜¯é»˜è®¤å€¼ --&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">includeMdc</span>&gt;</span>true<span class=\"tag\">&lt;/<span class=\"name\">includeMdc</span>&gt;</span>   <span class=\"comment\">&lt;!-- é»˜è®¤true, trueè¡¨ç¤ºè¾“å‡ºMDCä¿¡æ¯ --&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">includeCallerData</span>&gt;</span>true<span class=\"tag\">&lt;/<span class=\"name\">includeCallerData</span>&gt;</span> <span class=\"comment\">&lt;!-- é»˜è®¤false, trueè¡¨ç¤ºè¾“å‡ºæ‰“å°æ—¥å¿—çš„ç±»åã€æ–¹æ³•åã€è¡Œå·ç­‰ä¿¡æ¯ --&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">customFields</span>&gt;</span>&#123;&quot;appname&quot;: &quot;springboot-logstash-demo&quot;&#125;<span class=\"tag\">&lt;/<span class=\"name\">customFields</span>&gt;</span> <span class=\"comment\">&lt;!-- è‡ªå®šä¹‰å­—æ®µ --&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">encoder</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">appender</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- æ—¥å¿—è¾“å‡ºçº§åˆ« --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">root</span> <span class=\"attr\">level</span>=<span class=\"string\">&quot;info&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">appender-ref</span> <span class=\"attr\">ref</span>=<span class=\"string\">&quot;STDOUT&quot;</span>/&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">appender-ref</span> <span class=\"attr\">ref</span>=<span class=\"string\">&quot;LOGSTASH&quot;</span>/&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">root</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ·»åŠ <code>config/springboot-demo.conf</code>é…ç½®</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">input &#123;</span><br><span class=\"line\">  tcp &#123;</span><br><span class=\"line\">    host =&gt; <span class=\"string\">&quot;0.0.0.0&quot;</span> <span class=\"comment\"># ç›‘å¬ä»»æ„åœ°å€</span></span><br><span class=\"line\">    port =&gt; <span class=\"string\">&quot;4560&quot;</span> <span class=\"comment\"># ç›‘å¬ç«¯å£</span></span><br><span class=\"line\">    mode =&gt; <span class=\"string\">&quot;server&quot;</span> <span class=\"comment\"># serveræ¨¡å¼</span></span><br><span class=\"line\">    codec =&gt; json_lines <span class=\"comment\"># ä½¿ç”¨json_linesæ ¼å¼</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">output &#123;</span><br><span class=\"line\">  stdout &#123;</span><br><span class=\"line\">    codec =&gt; rubydebug</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  elasticsearch &#123; <span class=\"comment\"># è¾“å‡ºåˆ°ES</span></span><br><span class=\"line\">        index =&gt; <span class=\"string\">&quot;%&#123;[appname]&#125;-%&#123;+YYYY-MM-DD&#125;&quot;</span> <span class=\"comment\"># ç´¢å¼•å,æŒ‰å¤©åˆ†éš”ï¼Œè¿™é‡Œä½¿ç”¨å˜é‡appnameä½œä¸ºç´¢å¼•å</span></span><br><span class=\"line\">        hosts =&gt; [<span class=\"string\">&quot;https://10.250.0.239:9200&quot;</span>] <span class=\"comment\"># ESåœ°å€</span></span><br><span class=\"line\">        user =&gt; <span class=\"string\">&quot;elastic&quot;</span>                   <span class=\"comment\"># ESç”¨æˆ·å</span></span><br><span class=\"line\">        password =&gt; <span class=\"string\">&quot;123456&quot;</span>                <span class=\"comment\"># ESå¯†ç </span></span><br><span class=\"line\">        ssl =&gt; <span class=\"literal\">true</span>                         <span class=\"comment\"># æ˜¯å¦å¯ç”¨SSLï¼Œå› ä¸ºè¿™é‡Œæ˜¯httpsè®¿é—®ES</span></span><br><span class=\"line\">        ssl_certificate_verification =&gt; <span class=\"literal\">false</span> <span class=\"comment\"># ç¦ç”¨è¯ä¹¦éªŒè¯</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¯åŠ¨logstash</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">bin/logstash -f config/springboot-demo.conf --config.reload.automatic</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>logstashå¯åŠ¨æˆåŠŸåï¼Œä¼šè¾“å‡ºç±»ä¼¼å¦‚ä¸‹ä¿¡æ¯</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">            <span class=\"string\">&quot;message&quot;</span> =&gt; <span class=\"string\">&quot;Tomcat started on port(s): 8088 (http) with context path &#x27;/springboot-logstash&#x27;&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;level_value&quot;</span> =&gt; 20000,</span><br><span class=\"line\">            <span class=\"string\">&quot;appname&quot;</span> =&gt; <span class=\"string\">&quot;springboot-logstash-demo&quot;</span>,</span><br><span class=\"line\">              <span class=\"string\">&quot;level&quot;</span> =&gt; <span class=\"string\">&quot;INFO&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;logger_name&quot;</span> =&gt; <span class=\"string\">&quot;org.springframework.boot.web.embedded.tomcat.TomcatWebServer&quot;</span>,</span><br><span class=\"line\">         <span class=\"string\">&quot;@timestamp&quot;</span> =&gt; 2025-04-07T09:39:43.569Z,</span><br><span class=\"line\">           <span class=\"string\">&quot;@version&quot;</span> =&gt; <span class=\"string\">&quot;1&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;thread_name&quot;</span> =&gt; <span class=\"string\">&quot;restartedMain&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;caller_class_name&quot;</span> =&gt; <span class=\"string\">&quot;org.springframework.boot.web.embedded.tomcat.TomcatWebServer&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;caller_file_name&quot;</span> =&gt; <span class=\"string\">&quot;TomcatWebServer.java&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;caller_method_name&quot;</span> =&gt; <span class=\"string\">&quot;start&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;caller_line_number&quot;</span> =&gt; 220,</span><br><span class=\"line\">        <span class=\"string\">&quot;userName&quot;</span> =&gt; <span class=\"string\">&quot;admin&quot;</span>, <span class=\"comment\"># MDCä¿¡æ¯é»˜è®¤ä¼šæ‰“å°</span></span><br><span class=\"line\">        <span class=\"string\">&quot;userLocale&quot;</span> =&gt; <span class=\"string\">&quot;zh_CN&quot;</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¯ä»¥è®¿é—®ESæˆ–è€…KibanaæŸ¥çœ‹ç´¢å¼•ä¿¡æ¯ï¼Œè¿™é‡Œä¸å†èµ˜è¿°ã€‚</p>\n</li>\n</ul>\n","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç»å¦‚ä½•åœ¨Springbooté¡¹ç›®ä¸­æ•´åˆLogStashå®ç°æ—¥å¿—é‡‡é›† æœ¬æ–‡åŸºäºSpringboot2.7.xç‰ˆæœ¬è¿›è¡Œæµ‹è¯•ï¼ŒLogstashç‰ˆæœ¬ä¸º8.17.3 ä½¿ç”¨logstashæ—¥å¿—æ’ä»¶ SpringBootçš„Logstashæ—¥å¿—æ’ä»¶ï¼Œæœ¬æ–‡åªè¿›è¡Œç®€å•ä»‹ç»ï¼Œæ›´å¤šè¯¦ç»†é…ç½®å¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£ å¼•å…¥ä¾èµ–ï¼Œè¿™é‡Œéœ€è¦æ³¨æ„8.xä»¥ä¸Šçš„ç‰ˆæœ¬éœ€è¦jdk11ï¼Œå¦‚æœæ˜¯jdk8çš„è¯å¯ä»¥ä½¿ç”¨6.xæˆ–7.xç‰ˆæœ¬ 12345&lt;dependency&gt; &lt;groupId&gt;net.logstash.logback&lt;/groupId&gt; &lt;artifactId&gt;logstash-logback-encoder&lt;/artifactId&gt; &lt;version&gt;7.3&lt;/version&gt; &lt;!-- ç‰ˆæœ¬å·æ ¹æ®å®é™…æƒ…å†µä¿®æ”¹ --&gt;&lt;/dependency&gt; æ³¨æ„ï¼š springboot2.7.xä»¥ä¸‹ç‰ˆæœ¬ï¼Œå»ºè®®ä½¿ç”¨logstash-logback-encoderçš„7.3ä»¥ä¸‹ç‰ˆæœ¬ã€‚ springboot3.x.xä»¥ä¸Šç‰ˆæœ¬ï¼Œå»ºè®®ä½¿ç”¨logstash-logback-encoderçš„7.4åŠä»¥ä¸Šç‰ˆæœ¬ã€‚ logback-spring.xmlä¸­æ·»åŠ logstashé…ç½® 123456789101112131415161718192021222324252627&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;configuration debug=&quot;false&quot;&gt; &lt;!-- æ§åˆ¶å°è¾“å‡º --&gt; &lt;appender name=&quot;STDOUT&quot; class=&quot;ch.qos.logback.core.ConsoleAppender&quot;&gt; &lt;encoder class=&quot;ch.qos.logback.classic.encoder.PatternLayoutEncoder&quot;&gt; &lt;!--æ ¼å¼åŒ–è¾“å‡ºï¼š%dè¡¨ç¤ºæ—¥æœŸï¼Œ%threadè¡¨ç¤ºçº¿ç¨‹åï¼Œ%-5levelï¼šçº§åˆ«ä»å·¦æ˜¾ç¤º5ä¸ªå­—ç¬¦å®½åº¦ %logger&#123;50&#125;ï¼šç±»è·¯å¾„ï¼Œæœ€å¤§æ˜¾ç¤º50ä¸ªå­—ç¬¦ %Mï¼šæ–¹æ³•åç§° %Lï¼šè¡Œå· %msgï¼šæ—¥å¿—æ¶ˆæ¯ï¼Œ%næ˜¯æ¢è¡Œç¬¦--&gt; &lt;pattern&gt;[%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125;] [%thread] %-5level [%X&#123;userName&#125;][%X&#123;userLocale&#125;] %logger&#123;50&#125; - %M - %L - %msg%n&lt;/pattern&gt; &lt;/encoder&gt; &lt;/appender&gt; &lt;!-- logstashè¾“å‡º --&gt; &lt;appender name=&quot;LOGSTASH&quot; class=&quot;net.logstash.logback.appender.LogstashTcpSocketAppender&quot;&gt; &lt;destination&gt;161.189.78.202:4560&lt;/destination&gt; &lt;!-- logstashåœ°å€å’Œç«¯å£ --&gt; &lt;encoder class=&quot;net.logstash.logback.encoder.LogstashEncoder&quot; &gt; &lt;timestampPattern&gt;yyyy-MM-dd&#x27;T&#x27;HH:mm:ss.SSS&lt;/timestampPattern&gt; &lt;!-- æ—¶é—´æ ¼å¼ï¼Œè¿™ä¸ªæ˜¯é»˜è®¤å€¼ --&gt; &lt;includeMdc&gt;true&lt;/includeMdc&gt; &lt;!-- é»˜è®¤true, trueè¡¨ç¤ºè¾“å‡ºMDCä¿¡æ¯ --&gt; &lt;includeCallerData&gt;true&lt;/includeCallerData&gt; &lt;!-- é»˜è®¤false, trueè¡¨ç¤ºè¾“å‡ºæ‰“å°æ—¥å¿—çš„ç±»åã€æ–¹æ³•åã€è¡Œå·ç­‰ä¿¡æ¯ --&gt; &lt;customFields&gt;&#123;&quot;appname&quot;: &quot;springboot-logstash-demo&quot;&#125;&lt;/customFields&gt; &lt;!-- è‡ªå®šä¹‰å­—æ®µ --&gt; &lt;/encoder&gt; &lt;/appender&gt; &lt;!-- æ—¥å¿—è¾“å‡ºçº§åˆ« --&gt; &lt;root level=&quot;info&quot;&gt; &lt;appender-ref ref=&quot;STDOUT&quot;/&gt; &lt;appender-ref ref=&quot;LOGSTASH&quot;/&gt; &lt;/root&gt;&lt;/configuration&gt; æ·»åŠ config/springboot-demo.confé…ç½® 123456789101112131415161718192021input &#123; tcp &#123; host =&gt; &quot;0.0.0.0&quot; # ç›‘å¬ä»»æ„åœ°å€ port =&gt; &quot;4560&quot; # ç›‘å¬ç«¯å£ mode =&gt; &quot;server&quot; # serveræ¨¡å¼ codec =&gt; json_lines # ä½¿ç”¨json_linesæ ¼å¼ &#125;&#125;output &#123; stdout &#123; codec =&gt; rubydebug &#125; elasticsearch &#123; # è¾“å‡ºåˆ°ES index =&gt; &quot;%&#123;[appname]&#125;-%&#123;+YYYY-MM-DD&#125;&quot; # ç´¢å¼•å,æŒ‰å¤©åˆ†éš”ï¼Œè¿™é‡Œä½¿ç”¨å˜é‡appnameä½œä¸ºç´¢å¼•å hosts =&gt; [&quot;https://10.250.0.239:9200&quot;] # ESåœ°å€ user =&gt; &quot;elastic&quot; # ESç”¨æˆ·å password =&gt; &quot;123456&quot; # ESå¯†ç  ssl =&gt; true # æ˜¯å¦å¯ç”¨SSLï¼Œå› ä¸ºè¿™é‡Œæ˜¯httpsè®¿é—®ES ssl_certificate_verification =&gt; false # ç¦ç”¨è¯ä¹¦éªŒè¯ &#125;&#125; å¯åŠ¨logstash 1bin/logstash -f config/springboot-demo.conf --config.reload.automatic logstashå¯åŠ¨æˆåŠŸåï¼Œä¼šè¾“å‡ºç±»ä¼¼å¦‚ä¸‹ä¿¡æ¯ 12345678910111213141516&#123; &quot;message&quot; =&gt; &quot;Tomcat started on port(s): 8088 (http) with context path &#x27;/springboot-logstash&#x27;&quot;, &quot;level_value&quot; =&gt; 20000, &quot;appname&quot; =&gt; &quot;springboot-logstash-demo&quot;, &quot;level&quot; =&gt; &quot;INFO&quot;, &quot;logger_name&quot; =&gt; &quot;org.springframework.boot.web.embedded.tomcat.TomcatWebServer&quot;, &quot;@timestamp&quot; =&gt; 2025-04-07T09:39:43.569Z, &quot;@version&quot; =&gt; &quot;1&quot;, &quot;thread_name&quot; =&gt; &quot;restartedMain&quot;, &quot;caller_class_name&quot; =&gt; &quot;org.springframework.boot.web.embedded.tomcat.TomcatWebServer&quot;, &quot;caller_file_name&quot; =&gt; &quot;TomcatWebServer.java&quot;, &quot;caller_method_name&quot; =&gt; &quot;start&quot;, &quot;caller_line_number&quot; =&gt; 220, &quot;userName&quot; =&gt; &quot;admin&quot;, # MDCä¿¡æ¯é»˜è®¤ä¼šæ‰“å° &quot;userLocale&quot; =&gt; &quot;zh_CN&quot;&#125; å¯ä»¥è®¿é—®ESæˆ–è€…KibanaæŸ¥çœ‹ç´¢å¼•ä¿¡æ¯ï¼Œè¿™é‡Œä¸å†èµ˜è¿°ã€‚","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç»å¦‚ä½•åœ¨Springbooté¡¹ç›®ä¸­æ•´åˆLogStashå®ç°æ—¥å¿—é‡‡é›† æœ¬æ–‡åŸºäºSpringboot2.7.xç‰ˆæœ¬è¿›è¡Œæµ‹è¯•ï¼ŒLogstashç‰ˆæœ¬ä¸º8.17.3","date_published":"2025-04-07T13:30:05.000Z","tags":["æŠ€æœ¯","springboot","logstash","springboot","logstash"]},{"id":"https://blog.hanqunfeng.com/2025/03/27/elk-01/","url":"https://blog.hanqunfeng.com/2025/03/27/elk-01/","title":"ä¸€æ–‡ææ‡‚ELK","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç»å¦‚ä½•åœ¨linuxä¸‹å®‰è£…LogStashå’ŒFileBeat</p>\n</li>\n<li class=\"lvl-2\">\n<p>é€šè¿‡ç¤ºä¾‹è®²è§£ELKçš„ç»å…¸æ¶æ„å’Œé«˜å¹¶å‘æ¶æ„çš„å®ç°è¿‡ç¨‹</p>\n</li>\n<li class=\"lvl-2\">\n<p>LogStashç‰ˆæœ¬8.17.3ï¼ŒFileBeatç‰ˆæœ¬8.17.3</p>\n</li>\n<li class=\"lvl-2\">\n<p>Elasticsearchç‰ˆæœ¬8.17.3ï¼Œ<a href=\"/2025/03/20/elasticsearch-01-install/\" title=\"linuxä¸‹å®‰è£…Elasticsearch\">linuxä¸‹å®‰è£…Elasticsearch</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>Kibanaç‰ˆæœ¬8.17.3ï¼Œ<a href=\"/2025/03/21/kibana-01-install/\" title=\"linuxä¸‹å®‰è£…Kibana\">linuxä¸‹å®‰è£…Kibana</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>Elasticsearché›†ç¾¤æ­å»ºï¼Œ<a href=\"/2025/03/24/elasticsearch-02-install-cluster/\" title=\"linuxä¸‹å®‰è£…Elasticsearché›†ç¾¤\">linuxä¸‹å®‰è£…Elasticsearché›†ç¾¤</a></p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"Logstashæ¦‚è¿°\">Logstashæ¦‚è¿°</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><a href=\"https://www.elastic.co/cn/logstash\">Logstash</a> æ˜¯å…è´¹ä¸”å¼€æ”¾çš„æœåŠ¡å™¨ç«¯æ•°æ®å¤„ç†ç®¡é“ï¼Œèƒ½å¤Ÿä»å¤šä¸ªæ¥æºé‡‡é›†æ•°æ®ï¼Œè½¬æ¢æ•°æ®ï¼Œç„¶åå°†æ•°æ®å‘é€åˆ°æ‚¨æœ€å–œæ¬¢çš„å­˜å‚¨åº“ä¸­ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>Logstashæ•°æ®ä¼ è¾“åŸç†<br>\n<img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/uPic/image-2.png\" alt=\"\"></p>\n</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1.æ•°æ®é‡‡é›†ä¸è¾“å…¥ï¼šLogstashæ”¯æŒå„ç§è¾“å…¥é€‰æ‹©ï¼Œèƒ½å¤Ÿä»¥è¿ç»­çš„æµå¼ä¼ è¾“æ–¹å¼ï¼Œè½»æ¾åœ°ä»æ—¥å¿—ã€æŒ‡æ ‡ã€Webåº”ç”¨ä»¥åŠæ•°æ®å­˜å‚¨ä¸­é‡‡é›†æ•°æ®ã€‚</span><br><span class=\"line\">2.å®æ—¶è§£æå’Œæ•°æ®è½¬æ¢ï¼šé€šè¿‡Logstashè¿‡æ»¤å™¨è§£æå„ä¸ªäº‹ä»¶ï¼Œè¯†åˆ«å·²å‘½åçš„å­—æ®µæ¥æ„å»ºç»“æ„ï¼Œå¹¶å°†å®ƒä»¬è½¬æ¢æˆé€šç”¨æ ¼å¼ï¼Œæœ€ç»ˆå°†æ•°æ®ä»æºç«¯ä¼ è¾“åˆ°å­˜å‚¨åº“ä¸­ã€‚</span><br><span class=\"line\">3.å­˜å‚¨ä¸æ•°æ®å¯¼å‡ºï¼šLogstashæä¾›å¤šç§è¾“å‡ºé€‰æ‹©ï¼Œå¯ä»¥å°†æ•°æ®å‘é€åˆ°æŒ‡å®šçš„åœ°æ–¹ã€‚</span><br></pre></td></tr></table></figure>\n<p><img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/uPic/%E6%88%AA%E5%9B%BE-3.png\" alt=\"\"></p>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Logstashé€šè¿‡ç®¡é“å®Œæˆæ•°æ®çš„é‡‡é›†ä¸å¤„ç†ï¼Œç®¡é“é…ç½®ä¸­åŒ…å«inputã€outputå’Œfilterï¼ˆå¯é€‰ï¼‰æ’ä»¶ï¼Œinputå’Œoutputç”¨æ¥é…ç½®è¾“å…¥å’Œè¾“å‡ºæ•°æ®æºã€filterç”¨æ¥å¯¹æ•°æ®è¿›è¡Œè¿‡æ»¤æˆ–é¢„å¤„ç†ã€‚</p>\n</li>\n</ul>\n<h2 id=\"Logstashä¸‹è½½å®‰è£…\">Logstashä¸‹è½½å®‰è£…</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¸‹è½½åœ°å€ï¼š<a href=\"https://www.elastic.co/cn/downloads/past-releases#logstash\">https://www.elastic.co/cn/downloads/past-releases#logstash</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>é€‰æ‹©å¯¹åº”çš„ç‰ˆæœ¬ï¼šè¿™é‡Œé€‰æ‹©å½“å‰çš„æœ€æ–°ç‰ˆ<code>LogStash 8.17.3</code>ï¼Œä¹‹åé€‰æ‹©å¯¹åº”çš„æ“ä½œç³»ç»Ÿ<code>LINUX X86_64</code></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget https://artifacts.elastic.co/downloads/logstash/logstash-8.17.3-linux-x86_64.tar.gz</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¸‹è½½å®Œæˆåè§£å‹åˆ°<code>/usr/local/logstash</code>ç›®å½•ä¸‹ï¼Œè§£å‹å‘½ä»¤å¦‚ä¸‹ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">mkdir</span> /usr/local/logstash</span><br><span class=\"line\">tar -zxvf logstash-8.17.3-linux-x86_64.tar.gz -C /usr/local/logstash</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>elasticsearchå’Œkibanaéƒ½ä¸èƒ½ç”¨rootç”¨æˆ·å¯åŠ¨ï¼Œä¸ºäº†ç»Ÿä¸€ç®¡ç†ï¼Œlogstashä¹Ÿä½¿ç”¨è¿™ä¸ªç”¨æˆ·ï¼ˆéå¿…è¦ï¼‰</p>\n</li>\n<li class=\"lvl-2\">\n<p>åˆ›å»ºç”¨æˆ·<code>elastic</code>ï¼Œå¹¶è®¾ç½®å¯†ç ï¼Œè¿™ä¸€æ­¥æˆ‘ä»¬åœ¨å®‰è£…elasticsearchçš„æ—¶å€™å·²ç»é…ç½®è¿‡äº†ï¼Œè¿™é‡Œå°±ä¸å†èµ˜è¿°äº†</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">useradd elastic</span><br><span class=\"line\">passwd elastic</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¿®æ”¹logstashå®‰è£…ç›®å½•çš„ç”¨æˆ·æƒé™</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">chown</span> -R elastic:elastic /usr/local/logstash</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ‡æ¢åˆ°elasticç”¨æˆ·ä¸‹æ‰§è¡Œå‘½ä»¤</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åˆ‡æ¢ç”¨æˆ·</span></span><br><span class=\"line\">su - elastic</span><br><span class=\"line\"><span class=\"comment\"># è¿›å…¥logstashå®‰è£…ç›®å½•</span></span><br><span class=\"line\"><span class=\"built_in\">cd</span> /usr/local/logstash/logstash-8.17.3/</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¿è¡Œä¸€ä¸ªç®€å•çš„æµ‹è¯•</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># -e: ç›´æ¥æŠŠé…ç½®æ”¾åœ¨å‘½ä»¤ä¸­ï¼Œè¿™æ ·å¯ä»¥æœ‰æ•ˆå¿«é€Ÿè¿›è¡Œæµ‹è¯•</span></span><br><span class=\"line\"><span class=\"comment\"># input &#123; stdin &#123; &#125; &#125;: è¾“å…¥æ’ä»¶ï¼Œä»æ ‡å‡†è¾“å…¥ä¸­è¯»å–æ•°æ®</span></span><br><span class=\"line\"><span class=\"comment\"># output &#123; stdout &#123;&#125; &#125;: è¾“å‡ºæ’ä»¶ï¼Œå°†æ•°æ®è¾“å‡ºåˆ°æ ‡å‡†è¾“å‡º</span></span><br><span class=\"line\"><span class=\"comment\"># è¿™é‡ŒåªåŒ…å«äº† input å’Œ output ä¸¤ä¸ªéƒ¨åˆ†ï¼Œå®é™…ä½¿ç”¨ä¸­è¿˜éœ€è¦æ·»åŠ  filter éƒ¨åˆ†</span></span><br><span class=\"line\">./bin/logstash -e <span class=\"string\">&#x27;input &#123; stdin &#123; &#125; &#125; output &#123; stdout &#123;&#125; &#125;&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"># è¾“å‡ºï¼š</span></span><br><span class=\"line\">ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ <span class=\"comment\"># è¾“å‡ºå¯åŠ¨ä¿¡æ¯</span></span><br><span class=\"line\">The stdin plugin is now waiting <span class=\"keyword\">for</span> input: <span class=\"comment\"># è¾“å‡ºæç¤ºä¿¡æ¯ï¼Œæç¤ºä½ è¾“å…¥å†…å®¹</span></span><br><span class=\"line\">hello world  <span class=\"comment\"># æˆ‘è¾“å…¥å†…å®¹</span></span><br><span class=\"line\"><span class=\"comment\"># logstashè¾“å‡ºå†…å®¹</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">       <span class=\"string\">&quot;message&quot;</span> =&gt; <span class=\"string\">&quot;hello world&quot;</span>,</span><br><span class=\"line\">      <span class=\"string\">&quot;@version&quot;</span> =&gt; <span class=\"string\">&quot;1&quot;</span>,</span><br><span class=\"line\">         <span class=\"string\">&quot;event&quot;</span> =&gt; &#123;</span><br><span class=\"line\">        <span class=\"string\">&quot;original&quot;</span> =&gt; <span class=\"string\">&quot;hello world&quot;</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">          <span class=\"string\">&quot;host&quot;</span> =&gt; &#123;</span><br><span class=\"line\">        <span class=\"string\">&quot;hostname&quot;</span> =&gt; <span class=\"string\">&quot;ip-10-250-0-239.cn-northwest-1.compute.internal&quot;</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"string\">&quot;@timestamp&quot;</span> =&gt; 2025-03-27T06:48:12.810617855Z</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¹Ÿå¯ä»¥é€šè¿‡é…ç½®æ–‡ä»¶å¯åŠ¨logstash</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># vim test.conf</span></span><br><span class=\"line\">input &#123;</span><br><span class=\"line\">  stdin &#123; &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">output &#123;</span><br><span class=\"line\">  stdout &#123; codec =&gt; rubydebug &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># codec =&gt; rubydebug : æ˜¯æŒ‡å®šäº†ä¸€ä¸ªç¼–ç å™¨ï¼ˆCodecï¼‰ä¸º rubydebugã€‚</span></span><br><span class=\"line\"><span class=\"comment\"># ç¼–ç å™¨è´Ÿè´£å¦‚ä½•æ ¼å¼åŒ–è¾“å‡ºçš„æ•°æ®ã€‚</span></span><br><span class=\"line\"><span class=\"comment\"># Rubydebug ç¼–ç å™¨æ˜¯ä¸€ç§ç‰¹åˆ«é€‚åˆå¼€å‘å’Œè°ƒè¯•ç›®çš„çš„ç¼–ç å™¨ï¼Œå› ä¸ºå®ƒèƒ½ä»¥ç›¸å½“æ˜“è¯»çš„å½¢å¼å±•ç¤ºå¤æ‚çš„ç»“æ„åŒ–æ•°æ®ï¼Œæ¯”å¦‚åµŒå¥—çš„å“ˆå¸Œè¡¨æˆ–è€…æ•°ç»„ã€‚</span></span><br><span class=\"line\"><span class=\"comment\"># é™¤äº† Rubydebug ç¼–ç å™¨ï¼ŒLogstash è¿˜æä¾›äº†å…¶ä»–å‡ ç§ç¼–ç å™¨ï¼Œæ¯”å¦‚ jsonã€plainã€multiline ç­‰ç­‰ã€‚</span></span><br><span class=\"line\"><span class=\"comment\"># å…·ä½“å¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼šhttps://www.elastic.co/guide/en/logstash/current/codec-plugins.html</span></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">./bin/logstash -f ./test.conf</span><br></pre></td></tr></table></figure>\n<h2 id=\"Logstashæ’ä»¶\">Logstashæ’ä»¶</h2>\n<h3 id=\"Input-Plugins\">Input Plugins</h3>\n<blockquote>\n<p><a href=\"https://www.elastic.co/guide/en/logstash/8.17/input-plugins.html\">https://www.elastic.co/guide/en/logstash/8.17/input-plugins.html</a></p>\n</blockquote>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¸€ä¸ª Pipelineå¯ä»¥æœ‰å¤šä¸ªinputæ’ä»¶</p>\n</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- Stdin / File</span><br><span class=\"line\">- Beats / Log4J /Elasticsearch / JDBC / Kafka /Rabbitmq /Redis</span><br><span class=\"line\">- JMX/ HTTP / Websocket / UDP / TCP</span><br><span class=\"line\">- Google Cloud Storage / S3</span><br><span class=\"line\">- Github / Twitter</span><br></pre></td></tr></table></figure>\n<h3 id=\"Filter-Plugins\">Filter Plugins</h3>\n<blockquote>\n<p><a href=\"https://www.elastic.co/guide/en/logstash/8.17/filter-plugins.html\">https://www.elastic.co/guide/en/logstash/8.17/filter-plugins.html</a></p>\n</blockquote>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Filter Pluginå¯ä»¥å¯¹Logstash Eventè¿›è¡Œå„ç§å¤„ç†ï¼Œä¾‹å¦‚è§£æï¼Œåˆ é™¤å­—æ®µï¼Œç±»å‹è½¬æ¢</p>\n</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- Date: æ—¥æœŸè§£æ</span><br><span class=\"line\">- Dissect: åˆ†å‰²ç¬¦è§£æ</span><br><span class=\"line\">- Grok: æ­£åˆ™åŒ¹é…è§£æ</span><br><span class=\"line\">- Mutate: å¯¹å­—æ®µåšå„ç§æ“ä½œ</span><br><span class=\"line\">- Convert : ç±»å‹è½¬æ¢</span><br><span class=\"line\">- Gsub : å­—ç¬¦ä¸²æ›¿æ¢</span><br><span class=\"line\">- Split / Join /Merge:  å­—ç¬¦ä¸²åˆ‡å‰²ï¼Œæ•°ç»„åˆå¹¶å­—ç¬¦ä¸²ï¼Œæ•°ç»„åˆå¹¶æ•°ç»„</span><br><span class=\"line\">- Rename: å­—æ®µé‡å‘½å</span><br><span class=\"line\">- Update / Replace: å­—æ®µå†…å®¹æ›´æ–°æ›¿æ¢</span><br><span class=\"line\">- Remove_field: å­—æ®µåˆ é™¤</span><br><span class=\"line\">- Ruby: åˆ©ç”¨Ruby ä»£ç æ¥åŠ¨æ€ä¿®æ”¹Event</span><br></pre></td></tr></table></figure>\n<h3 id=\"Output-Plugins\">Output Plugins</h3>\n<blockquote>\n<p><a href=\"https://www.elastic.co/guide/en/logstash/8.17/output-plugins.html\">https://www.elastic.co/guide/en/logstash/8.17/output-plugins.html</a></p>\n</blockquote>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å°†Eventå‘é€åˆ°ç‰¹å®šçš„ç›®çš„åœ°ï¼Œæ˜¯ Pipeline çš„æœ€åä¸€ä¸ªé˜¶æ®µã€‚å¸¸è§ Output Pluginsï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- Elasticsearch</span><br><span class=\"line\">- Email / Pageduty</span><br><span class=\"line\">- Influxdb / Kafka / Mongodb / Opentsdb / Zabbix</span><br><span class=\"line\">- Http / TCP / Websocket</span><br></pre></td></tr></table></figure>\n<h3 id=\"Codec-Plugins\">Codec Plugins</h3>\n<blockquote>\n<p><a href=\"https://www.elastic.co/guide/en/logstash/8.17/codec-plugins.html\">https://www.elastic.co/guide/en/logstash/8.17/codec-plugins.html</a></p>\n</blockquote>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å°†åŸå§‹æ•°æ®decodeæˆEvent;å°†Event encodeæˆç›®æ ‡æ•°æ®ï¼Œå†…ç½®çš„Codec Plugins:</p>\n</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- Line / Multiline</span><br><span class=\"line\">- JSON / Avro / Cef (ArcSight Common Event Format)</span><br><span class=\"line\">- Dots / Rubydebug</span><br></pre></td></tr></table></figure>\n<h2 id=\"FileBeatæ¦‚è¿°\">FileBeatæ¦‚è¿°</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><a href=\"https://www.elastic.co/cn/beats\">Beats</a> æ˜¯ä¸€ä¸ªå…è´¹ä¸”å¼€æ”¾çš„å¹³å°ï¼Œé›†åˆäº†å¤šç§å•ä¸€ç”¨é€”çš„æ•°æ®é‡‡é›†å™¨ã€‚å®ƒä»¬ä»æˆç™¾ä¸Šåƒæˆ–æˆåƒä¸Šä¸‡å°æœºå™¨å’Œç³»ç»Ÿå‘ Logstash æˆ– Elasticsearch å‘é€æ•°æ®ã€‚<br>\n<img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/uPic/iEmI1C.png\" alt=\"\"></p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://www.elastic.co/cn/beats/filebeat\">FileBeat</a> ä¸“é—¨ç”¨äºè½¬å‘å’Œæ”¶é›†æ—¥å¿—æ•°æ®çš„è½»é‡çº§é‡‡é›†å·¥å…·ã€‚å®ƒå¯ä»¥ä½œä¸ºä»£ç†å®‰è£…åœ¨æœåŠ¡å™¨ä¸Šï¼ŒFileBeatç›‘è§†æŒ‡å®šè·¯å¾„çš„æ—¥å¿—æ–‡ä»¶ï¼Œæ”¶é›†æ—¥å¿—æ•°æ®ï¼Œå¹¶å°†æ”¶é›†åˆ°çš„æ—¥å¿—è½¬å‘åˆ°Elasticsearchæˆ–è€…Logstashã€‚</p>\n</li>\n</ul>\n<h2 id=\"logstash-vs-FileBeat\">logstash vs FileBeat</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Logstashæ˜¯åœ¨jvmä¸Šè¿è¡Œçš„ï¼Œèµ„æºæ¶ˆè€—æ¯”è¾ƒå¤§ã€‚è€ŒFileBeatæ˜¯åŸºäºgolangç¼–å†™çš„ï¼ŒåŠŸèƒ½è¾ƒå°‘ä½†èµ„æºæ¶ˆè€—ä¹Ÿæ¯”è¾ƒå°ï¼Œæ›´è½»é‡çº§ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>Logstash å’ŒFilebeatéƒ½å…·æœ‰æ—¥å¿—æ”¶é›†åŠŸèƒ½ï¼ŒFilebeatæ›´è½»é‡ï¼Œå ç”¨èµ„æºæ›´å°‘</p>\n</li>\n<li class=\"lvl-2\">\n<p>Logstash å…·æœ‰FilteråŠŸèƒ½ï¼Œèƒ½è¿‡æ»¤åˆ†ææ—¥å¿—</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä¸€èˆ¬ç»“æ„éƒ½æ˜¯Filebeaté‡‡é›†æ—¥å¿—ï¼Œç„¶åå‘é€åˆ°æ¶ˆæ¯é˜Ÿåˆ—ã€Redisã€MQä¸­ï¼Œç„¶åLogstashå»è·å–ï¼Œåˆ©ç”¨FilteråŠŸèƒ½è¿‡æ»¤åˆ†æï¼Œç„¶åå­˜å‚¨åˆ°Elasticsearchä¸­</p>\n</li>\n<li class=\"lvl-2\">\n<p>FileBeatå’ŒLogstashé…åˆï¼Œå®ç°èƒŒå‹æœºåˆ¶ã€‚å½“å°†æ•°æ®å‘é€åˆ°Logstashæˆ– Elasticsearchæ—¶ï¼ŒFilebeatä½¿ç”¨èƒŒå‹æ•æ„Ÿåè®®ï¼Œä»¥åº”å¯¹æ›´å¤šçš„æ•°æ®é‡ã€‚å¦‚æœLogstashæ­£åœ¨å¿™äºå¤„ç†æ•°æ®ï¼Œåˆ™ä¼šå‘Šè¯‰Filebeat å‡æ…¢è¯»å–é€Ÿåº¦ã€‚ä¸€æ—¦æ‹¥å µå¾—åˆ°è§£å†³ï¼ŒFilebeatå°±ä¼šæ¢å¤åˆ°åŸæ¥çš„æ­¥ä¼å¹¶ç»§ç»­ä¼ è¾“æ•°æ®ã€‚</p>\n</li>\n</ul>\n<h2 id=\"FileBeatä¸‹è½½å’Œå®‰è£…\">FileBeatä¸‹è½½å’Œå®‰è£…</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¸‹è½½åœ°å€ï¼š<a href=\"https://www.elastic.co/cn/downloads/past-releases#filebeat\">https://www.elastic.co/cn/downloads/past-releases#filebeat</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>é€‰æ‹©å¯¹åº”çš„ç‰ˆæœ¬ï¼šè¿™é‡Œé€‰æ‹©å½“å‰çš„æœ€æ–°ç‰ˆ<code>FileBeat 8.17.3</code>ï¼Œä¹‹åé€‰æ‹©å¯¹åº”çš„æ“ä½œç³»ç»Ÿ<code>LINUX X86_64</code></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget https://artifacts.elastic.co/downloads/beats/filebeat/filebeat-8.17.3-linux-x86_64.tar.gz</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¸‹è½½å®Œæˆåè§£å‹åˆ°<code>/usr/local/filebeat</code>ç›®å½•ä¸‹ï¼Œè§£å‹å‘½ä»¤å¦‚ä¸‹ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">mkdir</span> /usr/local/filebeat</span><br><span class=\"line\">tar -zxvf filebeat-8.17.3-linux-x86_64.tar.gz -C /usr/local/filebeat</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¿®æ”¹logstashå®‰è£…ç›®å½•çš„ç”¨æˆ·æƒé™</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">chown</span> -R elastic:elastic /usr/local/filebeat</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ‡æ¢åˆ°elasticç”¨æˆ·ä¸‹æ‰§è¡Œå‘½ä»¤</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åˆ‡æ¢ç”¨æˆ·</span></span><br><span class=\"line\">su - elastic</span><br><span class=\"line\"><span class=\"comment\"># è¿›å…¥ filebeat å®‰è£…ç›®å½•</span></span><br><span class=\"line\"><span class=\"built_in\">cd</span> /usr/local/filebeat/filebeat-8.17.3-linux-x86_64/</span><br></pre></td></tr></table></figure>\n<h2 id=\"ç»å…¸çš„ELKæ¶æ„\">ç»å…¸çš„ELKæ¶æ„</h2>\n<p><img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/uPic/%E6%88%AA%E5%9B%BE.png\" alt=\"\"></p>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Filebeatæ—¥å¿—æ”¶é›†ï¼šFilebeatä½œä¸ºè½»é‡çº§çš„æ—¥å¿—æ”¶é›†ä»£ç†ï¼Œéƒ¨ç½²åœ¨å®¢æˆ·ç«¯ä¸Šï¼Œæ¶ˆè€—èµ„æºå°‘ï¼Œèƒ½å¤Ÿé«˜æ•ˆåœ°æ”¶é›†æ—¥å¿—æ•°æ®ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>Logstashæ•°æ®å¤„ç†ï¼šLogstashä½œä¸ºæ•°æ®å¤„ç†ç®¡é“ï¼Œè´Ÿè´£å°†Filebeatæ”¶é›†çš„æ—¥å¿—æ•°æ®è¿›è¡Œè¿‡æ»¤ã€è½¬æ¢ç­‰æ“ä½œï¼Œç„¶åå‘é€åˆ°Elasticsearchè¿›è¡Œå­˜å‚¨ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>Elasticsearchå­˜å‚¨ä¸æœç´¢ï¼šElasticsearchæ˜¯ä¸€ä¸ªåŸºäºLuceneçš„åˆ†å¸ƒå¼æœç´¢å’Œåˆ†æå¼•æ“ï¼Œæä¾›å¼ºå¤§çš„æ•°æ®å­˜å‚¨å’Œæœç´¢èƒ½åŠ›ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>Kibanaå¯è§†åŒ–ï¼šKibanaä¸ºElasticsearchæä¾›Webå¯è§†åŒ–ç•Œé¢ï¼Œå…è®¸ç”¨æˆ·é€šè¿‡å›¾è¡¨ã€ä»ªè¡¨ç›˜ç­‰æ–¹å¼ç›´è§‚åœ°æŸ¥çœ‹å’Œåˆ†ææ—¥å¿—æ•°æ®ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>é€‚ç”¨åœºæ™¯ï¼šç»å…¸çš„ELKæ¶æ„ä¸»è¦é€‚ç”¨äºæ•°æ®é‡è¾ƒå°çš„å¼€å‘ç¯å¢ƒã€‚ç„¶è€Œï¼Œç”±äºç¼ºå°‘æ¶ˆæ¯é˜Ÿåˆ—çš„ç¼“å†²æœºåˆ¶ï¼Œå½“Logstashæˆ–Elasticsearchå‡ºç°æ•…éšœæ—¶ï¼Œå¯èƒ½å­˜åœ¨æ•°æ®ä¸¢å¤±çš„é£é™©ã€‚</p>\n</li>\n</ul>\n<h2 id=\"ä¸€ä¸ªç»å…¸ELKæ¶æ„ç¤ºä¾‹\">ä¸€ä¸ªç»å…¸ELKæ¶æ„ç¤ºä¾‹</h2>\n<h3 id=\"FileBeaté‡‡é›†NginxæœåŠ¡å™¨æ—¥å¿—å¹¶å‘é€åˆ°Logstash\">FileBeaté‡‡é›†NginxæœåŠ¡å™¨æ—¥å¿—å¹¶å‘é€åˆ°Logstash</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ›å»ºé…ç½®æ–‡ä»¶<code>filebeat-nginx.yml</code>ï¼Œå°†å…¶ä¿å­˜åˆ°Filebeatå®‰è£…ç›®å½•ä¸‹çš„confç›®å½•ä¸‹ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å› ä¸ºNginxçš„access.logæ—¥å¿—éƒ½æ˜¯ä»¥IPåœ°å€å¼€å¤´çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¿®æ”¹ä¸‹åŒ¹é…å­—æ®µã€‚</span></span><br><span class=\"line\"><span class=\"comment\"># ä¸ä»¥ipåœ°å€å¼€å¤´çš„è¡Œè¿½åŠ åˆ°ä¸Šä¸€è¡Œ</span></span><br><span class=\"line\"><span class=\"attr\">filebeat.inputs:</span> <span class=\"comment\"># è¾“å…¥æºé…ç½®</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">type:</span> <span class=\"string\">log</span> <span class=\"comment\"># æ—¥å¿—ç±»å‹</span></span><br><span class=\"line\">  <span class=\"attr\">enabled:</span> <span class=\"literal\">true</span> <span class=\"comment\"># æ˜¯å¦å¯ç”¨</span></span><br><span class=\"line\">  <span class=\"attr\">paths:</span> <span class=\"comment\"># é‡‡é›†è·¯å¾„</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">/var/log/nginx/access*.*</span></span><br><span class=\"line\">  <span class=\"attr\">exclude_files:</span> [<span class=\"string\">&quot;.gz$&quot;</span>] <span class=\"comment\"># æ’é™¤ä»¥.gz ç»“å°¾çš„æ–‡ä»¶</span></span><br><span class=\"line\">  <span class=\"attr\">multiline.pattern:</span> <span class=\"string\">&#x27;^\\\\d&#123;1,3&#125;\\\\.\\\\d&#123;1,3&#125;\\\\.\\\\d&#123;1,3&#125;\\\\.\\\\d&#123;1,3&#125;\\\\s&#x27;</span> <span class=\"comment\"># åŒ¹é…ä»¥IPåœ°å€å¼€å¤´ï¼Œå¹¶ç´§è·Ÿä¸€ä¸ªç©ºç™½å­—ç¬¦</span></span><br><span class=\"line\">  <span class=\"attr\">multiline.negate:</span> <span class=\"literal\">true</span> <span class=\"comment\"># ä¸ä»¥ipåœ°å€å¼€å¤´çš„è¡Œè¿½åŠ åˆ°ä¸Šä¸€è¡Œ</span></span><br><span class=\"line\">  <span class=\"attr\">multiline.match:</span> <span class=\"string\">after</span> <span class=\"comment\"># è¿½åŠ åˆ°ä¸Šä¸€è¡Œçš„åé¢</span></span><br><span class=\"line\">  <span class=\"comment\"># multiline: å¤šè¡Œæ—¥å¿—é…ç½®ï¼Œè¿™é‡Œå®é™…ä¸Šä¸éœ€è¦é…ç½®å¤šè¡Œè®¾ç½®ï¼Œå› ä¸ºnginxçš„accessæ—¥å¿—éƒ½æ˜¯å•è¡Œæ—¥å¿—ï¼Œè¿™é‡Œåªåšæ¼”ç¤º</span></span><br><span class=\"line\">    <span class=\"comment\"># pattern: æ­£åˆ™è¡¨è¾¾å¼</span></span><br><span class=\"line\">    <span class=\"comment\"># negate: falseï¼ŒåŒ¹é…patternçš„è¡Œåˆå¹¶åˆ°ä¸Šä¸€è¡Œï¼›trueï¼Œä¸åŒ¹é…patternçš„è¡Œåˆå¹¶åˆ°ä¸Šä¸€è¡Œ</span></span><br><span class=\"line\">    <span class=\"comment\"># match: afterï¼Œåˆå¹¶åˆ°ä¸Šä¸€è¡Œçš„æœ«å°¾ï¼›beforeï¼Œåˆå¹¶åˆ°ä¸Šä¸€è¡Œçš„å¼€å¤´</span></span><br><span class=\"line\">  <span class=\"attr\">scan_frequency:</span> <span class=\"string\">10s</span> <span class=\"comment\"># æ¯ 10 ç§’æ‰«æä¸€æ¬¡æ—¥å¿—æ–‡ä»¶</span></span><br><span class=\"line\">  <span class=\"attr\">clean_removed:</span> <span class=\"literal\">true</span> <span class=\"comment\"># åœ¨æ—¥å¿—æ–‡ä»¶è¢«åˆ é™¤åæ˜¯å¦ä»å…¶å†…éƒ¨çŠ¶æ€ä¸­ç§»é™¤è¯¥æ–‡ä»¶çš„è®°å½•</span></span><br><span class=\"line\">  <span class=\"attr\">clean_inactive:</span> <span class=\"string\">2h</span> <span class=\"comment\"># åœ¨æ—¥å¿—æ–‡ä»¶å¤„äºéæ´»åŠ¨çŠ¶æ€å¤šé•¿æ—¶é—´åå°†å…¶ä»çŠ¶æ€æ•°æ®åº“ä¸­ç§»,è®¾ç½®ä¸ºæ¯” ignore_older + scan_frequency æ›´å¤§çš„å€¼</span></span><br><span class=\"line\">  <span class=\"attr\">ignore_older:</span> <span class=\"string\">1h</span> <span class=\"comment\"># å¿½ç•¥é‚£äº›æ¯”å½“å‰æ—¶é—´æ—©äº 1 å°æ—¶çš„æ—¥å¿—æ–‡ä»¶</span></span><br><span class=\"line\"><span class=\"attr\">output.logstash:</span> <span class=\"comment\"># è¾“å‡ºé…ç½®ï¼Œè¿™é‡Œæ˜¯å‘é€åˆ°Logstash</span></span><br><span class=\"line\">  <span class=\"attr\">enabled:</span> <span class=\"literal\">true</span> <span class=\"comment\"># æ˜¯å¦å¯ç”¨</span></span><br><span class=\"line\">  <span class=\"attr\">hosts:</span> [<span class=\"string\">&quot;10.250.0.239:5044&quot;</span>] <span class=\"comment\"># LogstashæœåŠ¡åœ°å€</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¸ºFileBeatçš„ç”¨æˆ·åˆ†é…æ—¥å¿—ç›®å½•çš„è¯»å–æƒé™</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ä½¿ç”¨ setfaclå‘½ä»¤ä¸ºelasticç”¨æˆ·åˆ†é…æ—¥å¿—ç›®å½•çš„è¯»å–æƒé™</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> setfacl -d -m u:elastic:r-x -R /var/log/nginx/</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¯åŠ¨FileBeat</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">./filebeat -e -c conf/filebeat-nginx.yml</span><br><span class=\"line\"><span class=\"comment\"># åå°å¯åŠ¨</span></span><br><span class=\"line\"><span class=\"built_in\">nohup</span> ./filebeat -e -c conf/filebeat-nginx.yml &amp;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åœ¨å¯åŠ¨filebeatæ—¶å¯èƒ½ä¼šé‡åˆ°å¦‚ä¸‹é”™è¯¯</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Exiting: error loading config file: config file (<span class=\"string\">&quot;conf/filebeat-nginx.yml&quot;</span>) can only be writable by the owner but the permissions are <span class=\"string\">&quot;-rw-rw-r--&quot;</span> (to fix the permissions use: <span class=\"string\">&#x27;chmod go-w /usr/local/filebeat/filebeat-8.17.3-linux-x86_64/conf/filebeat-nginx.yml&#x27;</span>)</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-4\">\n<p>å› ä¸ºå®‰å…¨åŸå› ä¸è¦å…¶ä»–ç”¨æˆ·å†™çš„æƒé™ï¼Œå»æ‰å†™çš„æƒé™å°±å¯ä»¥äº†</p>\n</li>\n</ul>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">chmod</span> go-w conf/filebeat-nginx.yml</span><br></pre></td></tr></table></figure>\n<h3 id=\"é…ç½®Logstashæ¥æ”¶FileBeatæ”¶é›†çš„æ•°æ®å¹¶æ‰“å°\">é…ç½®Logstashæ¥æ”¶FileBeatæ”¶é›†çš„æ•°æ®å¹¶æ‰“å°</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ›å»ºé…ç½®æ–‡ä»¶<code>logstash-nginx.conf</code>ï¼Œå°†å…¶ä¿å­˜åˆ°Logstashå®‰è£…ç›®å½•ä¸‹çš„configç›®å½•ä¸‹ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># è¿›å…¥logstashå®‰è£…ç›®å½•</span></span><br><span class=\"line\"><span class=\"comment\"># vim config/logstash-nginx.conf</span></span><br><span class=\"line\"><span class=\"comment\"># é…ç½®ä»FileBeatæ¥æ”¶æ•°æ®</span></span><br><span class=\"line\">input &#123; <span class=\"comment\"># è¾“å…¥æºé…ç½®</span></span><br><span class=\"line\">    beats &#123; <span class=\"comment\"># ä»FileBeatæ¥æ”¶æ•°æ®</span></span><br><span class=\"line\">      port =&gt; 5044 <span class=\"comment\"># ç›‘å¬5044ç«¯å£</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">output &#123; <span class=\"comment\"># è¾“å‡ºé…ç½®</span></span><br><span class=\"line\">    stdout &#123; <span class=\"comment\"># æ‰“å°åˆ°æ§åˆ¶å°</span></span><br><span class=\"line\">      codec =&gt; rubydebug <span class=\"comment\"># æŒ‡å®šç¼–ç å™¨</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æµ‹è¯•logstashé…ç½®æ˜¯å¦æ­£ç¡®</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">bin/logstash -f config/logstash-nginx.conf --config.test_and_exit</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¯åŠ¨logstash</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># reload.automaticï¼šä¿®æ”¹é…ç½®æ–‡ä»¶æ—¶è‡ªåŠ¨é‡æ–°åŠ è½½</span></span><br><span class=\"line\">bin/logstash -f config/logstash-nginx.conf --config.reload.automatic</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ­¤æ—¶åœ¨æ§åˆ¶å°ä¼šçœ‹åˆ°å¦‚ä¸‹è¾“å‡ºï¼š</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">         <span class=\"string\">&quot;input&quot;</span> =&gt; &#123;</span><br><span class=\"line\">        <span class=\"string\">&quot;type&quot;</span> =&gt; <span class=\"string\">&quot;log&quot;</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">      <span class=\"string\">&quot;@version&quot;</span> =&gt; <span class=\"string\">&quot;1&quot;</span>,</span><br><span class=\"line\">       <span class=\"string\">&quot;message&quot;</span> =&gt; <span class=\"string\">&quot;1.119.161.30 - elastic [27/Mar/2025:08:52:41 +0000] \\&quot;GET /_cluster/stats HTTP/1.1\\&quot; 200 7445 \\&quot;-\\&quot; \\&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/134.0.0.0 Safari/537.36\\&quot; \\&quot;-\\&quot;&quot;</span>,</span><br><span class=\"line\">           <span class=\"string\">&quot;log&quot;</span> =&gt; &#123;</span><br><span class=\"line\">          <span class=\"string\">&quot;file&quot;</span> =&gt; &#123;</span><br><span class=\"line\">            <span class=\"string\">&quot;path&quot;</span> =&gt; <span class=\"string\">&quot;/var/log/nginx/access.log&quot;</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        <span class=\"string\">&quot;offset&quot;</span> =&gt; 42985</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">          <span class=\"string\">&quot;tags&quot;</span> =&gt; [</span><br><span class=\"line\">        [0] <span class=\"string\">&quot;beats_input_codec_plain_applied&quot;</span></span><br><span class=\"line\">    ],</span><br><span class=\"line\">    <span class=\"string\">&quot;@timestamp&quot;</span> =&gt; 2025-03-27T08:52:42.947Z,</span><br><span class=\"line\">           <span class=\"string\">&quot;ecs&quot;</span> =&gt; &#123;</span><br><span class=\"line\">        <span class=\"string\">&quot;version&quot;</span> =&gt; <span class=\"string\">&quot;8.0.0&quot;</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">         <span class=\"string\">&quot;agent&quot;</span> =&gt; &#123;</span><br><span class=\"line\">                  <span class=\"string\">&quot;id&quot;</span> =&gt; <span class=\"string\">&quot;4dbe185b-900d-4990-b841-c13bf9618fc6&quot;</span>,</span><br><span class=\"line\">                <span class=\"string\">&quot;name&quot;</span> =&gt; <span class=\"string\">&quot;ip-10-250-0-239.cn-northwest-1.compute.internal&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;ephemeral_id&quot;</span> =&gt; <span class=\"string\">&quot;6bb04808-7da7-4acb-95fd-f3f915651457&quot;</span>,</span><br><span class=\"line\">                <span class=\"string\">&quot;type&quot;</span> =&gt; <span class=\"string\">&quot;filebeat&quot;</span>,</span><br><span class=\"line\">             <span class=\"string\">&quot;version&quot;</span> =&gt; <span class=\"string\">&quot;8.17.3&quot;</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">         <span class=\"string\">&quot;event&quot;</span> =&gt; &#123;</span><br><span class=\"line\">        <span class=\"string\">&quot;original&quot;</span> =&gt; <span class=\"string\">&quot;1.119.161.30 - elastic [27/Mar/2025:08:52:41 +0000] \\&quot;GET /_cluster/stats HTTP/1.1\\&quot; 200 7445 \\&quot;-\\&quot; \\&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/134.0.0.0 Safari/537.36\\&quot; \\&quot;-\\&quot;&quot;</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">          <span class=\"string\">&quot;host&quot;</span> =&gt; &#123;</span><br><span class=\"line\">        <span class=\"string\">&quot;name&quot;</span> =&gt; <span class=\"string\">&quot;ip-10-250-0-239.cn-northwest-1.compute.internal&quot;</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"åˆ©ç”¨Logstashè¿‡æ»¤å™¨è§£ææ—¥å¿—\">åˆ©ç”¨Logstashè¿‡æ»¤å™¨è§£ææ—¥å¿—</h4>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä»æ‰“å°ç»“æœçœ‹åˆ°åŒ…å«äº†å¤§é‡çš„æ— å…³æ•°æ®ï¼Œæ­¤æ—¶å¯ä»¥åˆ©ç”¨Logstashè¿‡æ»¤å™¨è§£ææ—¥å¿—ï¼Œè¿™é‡Œä½¿ç”¨<code>Grok</code>æ’ä»¶</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://www.elastic.co/guide/en/logstash/8.17/plugins-filters-grok.html\">Grok</a>æ˜¯ä¸€ç§å°†éç»“æ„åŒ–æ—¥å¿—è§£æä¸ºç»“æ„åŒ–çš„æ’ä»¶ã€‚è¿™ä¸ªå·¥å…·éå¸¸é€‚åˆç”¨æ¥è§£æç³»ç»Ÿæ—¥å¿—ã€WebæœåŠ¡å™¨æ—¥å¿—ã€MySQLæˆ–è€…æ˜¯ä»»æ„å…¶ä»–çš„æ—¥å¿—æ ¼å¼ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>Grokæ˜¯é€šè¿‡æ¨¡å¼åŒ¹é…çš„æ–¹å¼æ¥è¯†åˆ«æ—¥å¿—ä¸­çš„æ•°æ®,å¯ä»¥æŠŠGrokæ’ä»¶ç®€å•ç†è§£ä¸ºå‡çº§ç‰ˆæœ¬çš„æ­£åˆ™è¡¨è¾¾å¼ã€‚å®ƒæ‹¥æœ‰æ›´å¤šçš„æ¨¡å¼ï¼Œé»˜è®¤Logstashæ‹¥æœ‰120ä¸ªæ¨¡å¼ã€‚å¦‚æœè¿™äº›æ¨¡å¼ä¸æ»¡è¶³æˆ‘ä»¬è§£ææ—¥å¿—çš„éœ€æ±‚ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æ¥è¿›è¡ŒåŒ¹é…ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://help.aliyun.com/zh/sls/user-guide/grok-patterns\">GROKæ¨¡å¼å‚è€ƒ</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>grokæ¨¡å¼çš„è¯­æ³•æ˜¯:</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">%&#123;SYNTAX:SEMANTIC&#125;</span><br><span class=\"line\"><span class=\"comment\"># SYNTAXï¼ˆè¯­æ³•ï¼‰æŒ‡çš„æ˜¯Grokæ¨¡å¼åç§°ï¼ŒSEMANTICï¼ˆè¯­ä¹‰ï¼‰æ˜¯ç»™æ¨¡å¼åŒ¹é…åˆ°çš„æ–‡æœ¬å­—æ®µåã€‚ä¾‹å¦‚ï¼š</span></span><br><span class=\"line\">%&#123;NUMBER:duration&#125; %&#123;IP:client&#125;</span><br><span class=\"line\"><span class=\"comment\"># durationè¡¨ç¤ºï¼šåŒ¹é…ä¸€ä¸ªæ•°å­—ï¼Œclientè¡¨ç¤ºåŒ¹é…ä¸€ä¸ªIPåœ°å€ã€‚</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åŒ¹é…nginxæ—¥å¿—</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># nginx accessæ—¥å¿—æ ¼å¼</span></span><br><span class=\"line\">1.119.161.30 - elastic [27/Mar/2025:03:05:36 +0000] <span class=\"string\">&quot;GET /_cluster/stats HTTP/1.1&quot;</span> 200 7446 <span class=\"string\">&quot;-&quot;</span> <span class=\"string\">&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/134.0.0.0 Safari/537.36&quot;</span> <span class=\"string\">&quot;-&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># grok</span></span><br><span class=\"line\">%&#123;IP:client_ip&#125; - %&#123;USER:remote_user&#125; \\[%&#123;HTTPDATE:timestamp&#125;\\] \\&quot;%&#123;WORD:verb&#125; %&#123;URIPATHPARAM:request&#125; HTTP/%&#123;NUMBER:httpversion&#125;\\&quot; %&#123;INT:http_status&#125; %&#123;INT:body_bytes_sent&#125; \\&quot;%&#123;NOTSPACE:referrer&#125;\\&quot; \\&quot;%&#123;GREEDYDATA:agent&#125;\\&quot; %&#123;QUOTEDSTRING:x_forwarded_for&#125;</span><br><span class=\"line\"><span class=\"comment\"># è§£é‡Šæ¯ä¸ªéƒ¨åˆ†çš„ä½œç”¨ï¼š</span></span><br><span class=\"line\"><span class=\"comment\"># %&#123;IP:client_ip&#125;ï¼šåŒ¹é…å®¢æˆ·ç«¯ IP åœ°å€ã€‚</span></span><br><span class=\"line\"><span class=\"comment\"># -ï¼šåŒ¹é…ä¸€ä¸ªç ´æŠ˜å·ï¼ˆ-ï¼‰ï¼Œè¡¨ç¤ºåŒ¿åç”¨æˆ·æˆ–æœªè®¤è¯ç”¨æˆ·ã€‚</span></span><br><span class=\"line\"><span class=\"comment\"># %&#123;USER:remote_user&#125;ï¼šåŒ¹é…è¿œç¨‹ç”¨æˆ·åï¼Œ - è¡¨ç¤ºåŒ¿åç”¨æˆ·ã€‚</span></span><br><span class=\"line\"><span class=\"comment\"># \\[%&#123;HTTPDATE:timestamp&#125;\\]ï¼šåŒ¹é…è¯·æ±‚çš„æ—¶é—´æˆ³ï¼Œæ ¼å¼ä¸º [27/Mar/2025:03:05:36 +0000]ã€‚</span></span><br><span class=\"line\"><span class=\"comment\"># \\&quot;%&#123;WORD:verb&#125; : åŒ¹é…è¯·æ±‚æ–¹æ³• (GET)</span></span><br><span class=\"line\"><span class=\"comment\"># %&#123;URIPATHPARAM:request&#125; : åŒ¹é…è¯·æ±‚è·¯å¾„ (/_cluster/stats)</span></span><br><span class=\"line\"><span class=\"comment\"># HTTP/%&#123;NUMBER:httpversion&#125;\\\\\\&quot;ï¼šåŒ¹é… HTTP ç‰ˆæœ¬ (HTTP/1.1)ã€‚</span></span><br><span class=\"line\"><span class=\"comment\"># %&#123;INT:http_status&#125;ï¼šåŒ¹é… HTTP å“åº”çŠ¶æ€ç  (200)ã€‚</span></span><br><span class=\"line\"><span class=\"comment\"># %&#123;INT:body_bytes_sent&#125;ï¼šåŒ¹é…å“åº”ä½“çš„å­—èŠ‚æ•° (7446)ã€‚</span></span><br><span class=\"line\"><span class=\"comment\"># \\&quot;%&#123;NOTSPACE:referrer&#125;\\&quot;ï¼šåŒ¹é…å¼•ç”¨é¡µ (Referer) å­—æ®µï¼Œè¿™é‡Œä¸ºç©º (&quot;-&quot;)ã€‚</span></span><br><span class=\"line\"><span class=\"comment\"># \\&quot;%&#123;GREEDYDATA:agent&#125;\\&quot;ï¼šåŒ¹é…ç”¨æˆ·ä»£ç† (User-Agent) å­—æ®µã€‚GREEDYDATA ä¼šåŒ¹é…å°½å¯èƒ½å¤šçš„æ•°æ®ï¼Œç›´åˆ°é‡åˆ°ä¸‹ä¸€ä¸ªåˆ†éš”ç¬¦ã€‚</span></span><br><span class=\"line\"><span class=\"comment\"># %&#123;QUOTEDSTRING:x_forwarded_for&#125;ï¼šåŒ¹é… X-Forwarded-For å¤´å­—æ®µï¼Œè¿™é‡Œä¸ºç©º (&quot;-&quot;)ã€‚</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åŒ¹é…ç»“æœ</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">&quot;request&quot;</span>: <span class=\"string\">&quot;/_cluster/stats&quot;</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;agent&quot;</span>: <span class=\"string\">&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/134.0.0.0 Safari/537.36&quot;</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;body_bytes_sent&quot;</span>: <span class=\"string\">&quot;7446&quot;</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;verb&quot;</span>: <span class=\"string\">&quot;GET&quot;</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;x_forwarded_for&quot;</span>: <span class=\"string\">&quot;\\&quot;-\\&quot;&quot;</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;remote_user&quot;</span>: <span class=\"string\">&quot;elastic&quot;</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;referrer&quot;</span>: <span class=\"string\">&quot;-&quot;</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;client_ip&quot;</span>: <span class=\"string\">&quot;1.119.161.30&quot;</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;httpversion&quot;</span>: <span class=\"string\">&quot;1.1&quot;</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;http_status&quot;</span>: <span class=\"string\">&quot;200&quot;</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;timestamp&quot;</span>: <span class=\"string\">&quot;27/Mar/2025:03:05:36 +0000&quot;</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åŒ¹é…Grokæ¨¡å¼æ˜¯ä¸ªéå¸¸ç¹ççš„è¿‡ç¨‹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨Kibanaæ¥è¿›è¡Œå¯è§†åŒ–çš„Grokè°ƒè¯•<br>\n<img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/uPic/nhgnKY.png\" alt=\"\"></p>\n</li>\n<li class=\"lvl-2\">\n<p>groké…ç½®</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">grok &#123;</span><br><span class=\"line\">    match =&gt; &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;message&quot;</span> =&gt; <span class=\"string\">&quot;%&#123;IP:client_ip&#125; - %&#123;USER:remote_user&#125; \\[%&#123;HTTPDATE:timestamp&#125;\\] \\&quot;%&#123;WORD:verb&#125; %&#123;URIPATHPARAM:request&#125; HTTP/%&#123;NUMBER:httpversion&#125;\\&quot; %&#123;INT:http_status&#125; %&#123;INT:body_bytes_sent&#125; \\&quot;%&#123;NOTSPACE:referrer&#125;\\&quot; \\&quot;%&#123;GREEDYDATA:agent&#125;\\&quot; %&#123;QUOTEDSTRING:x_forwarded_for&#125;&quot;</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"ä½¿ç”¨mutateæ’ä»¶è¿‡æ»¤æ‰ä¸éœ€è¦çš„å­—æ®µ\">ä½¿ç”¨mutateæ’ä»¶è¿‡æ»¤æ‰ä¸éœ€è¦çš„å­—æ®µ</h4>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>é™¤äº†nginxæ—¥å¿—æœ¬èº«çš„æ ¼å¼å¤–ï¼Œlogstashè¿˜ä¼šæ‰“å°è®¸å¤šæˆ‘ä»¬ä¸éœ€è¦çš„å­—æ®µï¼Œæ­¤æ—¶å¯ä»¥ä½¿ç”¨<code>mutate</code>æ’ä»¶æ¥è¿‡æ»¤æ‰ä¸éœ€è¦çš„å­—æ®µã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mutate &#123;</span><br><span class=\"line\">    enable_metric =&gt; <span class=\"string\">&quot;false&quot;</span> <span class=\"comment\"># ç¦ç”¨æŒ‡æ ‡ä¸ŠæŠ¥</span></span><br><span class=\"line\">    remove_field =&gt; [<span class=\"string\">&quot;message&quot;</span>, <span class=\"string\">&quot;log&quot;</span>, <span class=\"string\">&quot;tags&quot;</span>, <span class=\"string\">&quot;input&quot;</span>, <span class=\"string\">&quot;agent&quot;</span>, <span class=\"string\">&quot;host&quot;</span>, <span class=\"string\">&quot;ecs&quot;</span>, <span class=\"string\">&quot;@version&quot;</span>] <span class=\"comment\"># ç§»é™¤ä¸éœ€è¦çš„å­—æ®µ</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"ä½¿ç”¨Dateæ’ä»¶å¯¹æ—¶é—´è¿›è¡Œæ ¼å¼è½¬æ¢\">ä½¿ç”¨Dateæ’ä»¶å¯¹æ—¶é—´è¿›è¡Œæ ¼å¼è½¬æ¢</h4>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">date</span> &#123;</span><br><span class=\"line\">    match =&gt; [<span class=\"string\">&quot;timestamp&quot;</span>,<span class=\"string\">&quot;dd/MMM/yyyy:HH:mm:ss Z&quot;</span>,<span class=\"string\">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>] <span class=\"comment\"># æ—¶é—´æ ¼å¼è½¬æ¢</span></span><br><span class=\"line\">    target =&gt; <span class=\"string\">&quot;timestamp&quot;</span> <span class=\"comment\"># ç›®æ ‡å­—æ®µ</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"å®Œæ•´çš„Logstashé…ç½®\">å®Œæ•´çš„Logstashé…ç½®</h4>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># è¿›å…¥logstashå®‰è£…ç›®å½•</span></span><br><span class=\"line\"><span class=\"comment\"># vim config/logstsh-nginx.conf</span></span><br><span class=\"line\"><span class=\"comment\"># é…ç½®ä»FileBeatæ¥æ”¶æ•°æ®</span></span><br><span class=\"line\">input &#123; <span class=\"comment\"># è¾“å…¥æºé…ç½®</span></span><br><span class=\"line\">    beats &#123; <span class=\"comment\"># ä»FileBeatæ¥æ”¶æ•°æ®</span></span><br><span class=\"line\">      port =&gt; 5044 <span class=\"comment\"># ç›‘å¬5044ç«¯å£</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">filter &#123; <span class=\"comment\"># è¿‡æ»¤å™¨é…ç½®</span></span><br><span class=\"line\">    grok &#123;</span><br><span class=\"line\">        match =&gt; &#123;</span><br><span class=\"line\">        <span class=\"string\">&quot;message&quot;</span> =&gt; <span class=\"string\">&quot;%&#123;IP:client_ip&#125; - %&#123;USER:remote_user&#125; \\[%&#123;HTTPDATE:timestamp&#125;\\] \\&quot;%&#123;WORD:verb&#125; %&#123;URIPATHPARAM:request&#125; HTTP/%&#123;NUMBER:httpversion&#125;\\&quot; %&#123;INT:http_status&#125; %&#123;INT:body_bytes_sent&#125; \\&quot;%&#123;NOTSPACE:referrer&#125;\\&quot; \\&quot;%&#123;GREEDYDATA:agent&#125;\\&quot; %&#123;QUOTEDSTRING:x_forwarded_for&#125;&quot;</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    mutate &#123;</span><br><span class=\"line\">        enable_metric =&gt; <span class=\"string\">&quot;false&quot;</span> <span class=\"comment\"># ç¦ç”¨æŒ‡æ ‡ä¸ŠæŠ¥</span></span><br><span class=\"line\">        remove_field =&gt; [<span class=\"string\">&quot;message&quot;</span>, <span class=\"string\">&quot;log&quot;</span>, <span class=\"string\">&quot;tags&quot;</span>, <span class=\"string\">&quot;input&quot;</span>, <span class=\"string\">&quot;agent&quot;</span>, <span class=\"string\">&quot;host&quot;</span>, <span class=\"string\">&quot;ecs&quot;</span>, <span class=\"string\">&quot;@version&quot;</span>] <span class=\"comment\"># ç§»é™¤ä¸éœ€è¦çš„å­—æ®µ</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">date</span> &#123;</span><br><span class=\"line\">        match =&gt; [<span class=\"string\">&quot;timestamp&quot;</span>,<span class=\"string\">&quot;dd/MMM/yyyy:HH:mm:ss Z&quot;</span>,<span class=\"string\">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>] <span class=\"comment\"># æ—¶é—´æ ¼å¼è½¬æ¢</span></span><br><span class=\"line\">        target =&gt; <span class=\"string\">&quot;timestamp&quot;</span> <span class=\"comment\"># ç›®æ ‡å­—æ®µ</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">output &#123; <span class=\"comment\"># è¾“å‡ºé…ç½®</span></span><br><span class=\"line\">    stdout &#123; <span class=\"comment\"># æ‰“å°åˆ°æ§åˆ¶å°</span></span><br><span class=\"line\">      codec =&gt; rubydebug <span class=\"comment\"># æŒ‡å®šç¼–ç å™¨</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>é‡æ–°å¯åŠ¨logstashåå¾—åˆ°å¦‚ä¸‹ç»“æœï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">              <span class=\"string\">&quot;event&quot;</span> =&gt; &#123;</span><br><span class=\"line\">        <span class=\"string\">&quot;original&quot;</span> =&gt; <span class=\"string\">&quot;1.119.161.30 - elastic [27/Mar/2025:09:49:41 +0000] \\&quot;GET /_cluster/stats HTTP/1.1\\&quot; 200 7445 \\&quot;-\\&quot; \\&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/134.0.0.0 Safari/537.36\\&quot; \\&quot;-\\&quot;&quot;</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">          <span class=\"string\">&quot;client_ip&quot;</span> =&gt; <span class=\"string\">&quot;1.119.161.30&quot;</span>,</span><br><span class=\"line\">            <span class=\"string\">&quot;request&quot;</span> =&gt; <span class=\"string\">&quot;/_cluster/stats&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;http_status&quot;</span> =&gt; <span class=\"string\">&quot;200&quot;</span>,</span><br><span class=\"line\">         <span class=\"string\">&quot;@timestamp&quot;</span> =&gt; 2025-03-27T09:49:45.751Z,</span><br><span class=\"line\">    <span class=\"string\">&quot;body_bytes_sent&quot;</span> =&gt; <span class=\"string\">&quot;7445&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;x_forwarded_for&quot;</span> =&gt; <span class=\"string\">&quot;\\&quot;-\\&quot;&quot;</span>,</span><br><span class=\"line\">          <span class=\"string\">&quot;timestamp&quot;</span> =&gt; 2025-03-27T09:49:41.000Z,</span><br><span class=\"line\">           <span class=\"string\">&quot;referrer&quot;</span> =&gt; <span class=\"string\">&quot;-&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;remote_user&quot;</span> =&gt; <span class=\"string\">&quot;elastic&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;httpversion&quot;</span> =&gt; <span class=\"string\">&quot;1.1&quot;</span>,</span><br><span class=\"line\">               <span class=\"string\">&quot;verb&quot;</span> =&gt; <span class=\"string\">&quot;GET&quot;</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"å°†ç»“æœè¾“å‡ºåˆ°ES\">å°†ç»“æœè¾“å‡ºåˆ°ES</h4>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åœ¨è¾“å‡ºé…ç½®ä¸­æ·»åŠ ESè¾“å‡ºé…ç½®</span></span><br><span class=\"line\">output &#123; <span class=\"comment\"># è¾“å‡ºé…ç½®</span></span><br><span class=\"line\">    stdout &#123; <span class=\"comment\"># æ‰“å°åˆ°æ§åˆ¶å°</span></span><br><span class=\"line\">      codec =&gt; rubydebug <span class=\"comment\"># æŒ‡å®šç¼–ç å™¨</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    elasticsearch &#123; <span class=\"comment\"># è¾“å‡ºåˆ°ES</span></span><br><span class=\"line\">        index =&gt; <span class=\"string\">&quot;nginx_access_log_%&#123;+YYYY-MM&#125;&quot;</span> <span class=\"comment\"># ç´¢å¼•å,æŒ‰æœˆåˆ†éš”</span></span><br><span class=\"line\">        hosts =&gt; [<span class=\"string\">&quot;https://10.250.0.239:9200&quot;</span>] <span class=\"comment\"># ESåœ°å€</span></span><br><span class=\"line\">        user =&gt; <span class=\"string\">&quot;elastic&quot;</span>                   <span class=\"comment\"># ESç”¨æˆ·å</span></span><br><span class=\"line\">        password =&gt; <span class=\"string\">&quot;123456&quot;</span>                <span class=\"comment\"># ESå¯†ç </span></span><br><span class=\"line\">        ssl =&gt; <span class=\"literal\">true</span>                         <span class=\"comment\"># æ˜¯å¦å¯ç”¨SSLï¼Œå› ä¸ºè¿™é‡Œæ˜¯httpsè®¿é—®ES</span></span><br><span class=\"line\">        ssl_certificate_verification =&gt; <span class=\"literal\">false</span> <span class=\"comment\"># ç¦ç”¨è¯ä¹¦éªŒè¯</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¦‚æœéœ€è¦å¼€å¯è¯ä¹¦æ ¡éªŒï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹æ³•è¿›è¡Œé…ç½®</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-6\">è·å– Elasticsearch çš„ SSL è¯ä¹¦ï¼š</li>\n</ul>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ä» Elasticsearch çš„é…ç½®æ–‡ä»¶æˆ–è¯ä¹¦æ–‡ä»¶è·¯å¾„ä¸­è·å–è¯ä¹¦ï¼ˆé€šå¸¸æ˜¯ .pem æˆ– .crt æ–‡ä»¶ï¼‰ã€‚</span></span><br><span class=\"line\">/usr/local/elasticsearch/elasticsearch-8.17.3/config/certs/http_ca.crt</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-2\">\n<li class=\"lvl-6\">å¯¼å…¥è¯ä¹¦åˆ° Java ä¿¡ä»»åº“ï¼šæ³¨æ„è¿™é‡Œè¦å¯¼å…¥åˆ°å¯åŠ¨Logstashçš„JAVAè¿›ç¨‹çš„ä¿¡ä»»åº“</li>\n</ul>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># logstashçš„jdkè·¯å¾„ï¼Œé»˜è®¤åœ¨logstashçš„å®‰è£…ç›®å½•ä¸‹</span></span><br><span class=\"line\"><span class=\"built_in\">cd</span> /usr/local/logstash/logstash-8.17.3/jdk</span><br><span class=\"line\"></span><br><span class=\"line\">bin/keytool -importcert -<span class=\"built_in\">alias</span> es-cert -keystore /usr/local/logstash/logstash-8.17.3/logstash.keystore -file /usr/local/elasticsearch/elasticsearch-8.17.3/config/certs/http_ca.crt</span><br><span class=\"line\"><span class=\"comment\"># è¾“å‡º</span></span><br><span class=\"line\">Enter keystore password:  <span class=\"comment\"># è¾“å…¥å¯†ç  è¿™é‡Œæ˜¯123456</span></span><br><span class=\"line\">Re-enter new password:</span><br><span class=\"line\">Owner: CN=Elasticsearch security auto-configuration HTTP CA</span><br><span class=\"line\">Issuer: CN=Elasticsearch security auto-configuration HTTP CA</span><br><span class=\"line\">Serial number: 89d5c501a2efd5d45a6ee5e08daa16bd605d8c28</span><br><span class=\"line\">Valid from: Thu Mar 20 08:53:26 UTC 2025 <span class=\"keyword\">until</span>: Sun Mar 19 08:53:26 UTC 2028</span><br><span class=\"line\">Certificate fingerprints:</span><br><span class=\"line\">    SHA1: DE:73:0C:EC:46:59:69:83:52:7C:C4:CC:6B:65:EC:B6:31:BE:10:22</span><br><span class=\"line\">    SHA256: 3F:14:1C:16:DF:C6:E1:65:89:4B:C1:67:20:84:B2:20:DC:DD:22:FF:E0:21:16:D5:1A:C1:80:03:CF:AA:5A:1D</span><br><span class=\"line\">Signature algorithm name: SHA256withRSA</span><br><span class=\"line\">Subject Public Key Algorithm: 4096-bit RSA key</span><br><span class=\"line\">Version: 3</span><br><span class=\"line\"></span><br><span class=\"line\">Extensions:</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#1: ObjectId: 2.5.29.35 Criticality=false</span></span><br><span class=\"line\">AuthorityKeyIdentifier [</span><br><span class=\"line\">KeyIdentifier [</span><br><span class=\"line\">0000: 25 EF BA 81 AE 5E 14 1C   7E FF A1 87 12 F8 D0 2E  %....^..........</span><br><span class=\"line\">0010: 3A D7 54 5F                                        :.T_</span><br><span class=\"line\">]</span><br><span class=\"line\">]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#2: ObjectId: 2.5.29.19 Criticality=true</span></span><br><span class=\"line\">BasicConstraints:[</span><br><span class=\"line\">CA:<span class=\"literal\">true</span></span><br><span class=\"line\">PathLen: no <span class=\"built_in\">limit</span></span><br><span class=\"line\">]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#3: ObjectId: 2.5.29.14 Criticality=false</span></span><br><span class=\"line\">SubjectKeyIdentifier [</span><br><span class=\"line\">KeyIdentifier [</span><br><span class=\"line\">0000: 25 EF BA 81 AE 5E 14 1C   7E FF A1 87 12 F8 D0 2E  %....^..........</span><br><span class=\"line\">0010: 3A D7 54 5F                                        :.T_</span><br><span class=\"line\">]</span><br><span class=\"line\">]</span><br><span class=\"line\"></span><br><span class=\"line\">Trust this certificate? [no]:  <span class=\"built_in\">yes</span> <span class=\"comment\"># yesç¡®è®¤</span></span><br><span class=\"line\">Certificate was added to keystore</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-2\">\n<li class=\"lvl-6\">\n<p>é…ç½® Logstash ä½¿ç”¨ä¿¡ä»»åº“</p>\n</li>\n</ul>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">output &#123;</span><br><span class=\"line\">    elasticsearch &#123;</span><br><span class=\"line\">        index =&gt; <span class=\"string\">&quot;nginx_access_log_%&#123;+YYYY-MM&#125;&quot;</span> <span class=\"comment\"># ç´¢å¼•å,æŒ‰æœˆåˆ†éš”</span></span><br><span class=\"line\">        hosts =&gt; [<span class=\"string\">&quot;https://10.250.0.239:9200&quot;</span>] <span class=\"comment\"># ESåœ°å€</span></span><br><span class=\"line\">        user =&gt; <span class=\"string\">&quot;elastic&quot;</span>                     <span class=\"comment\"># ESç”¨æˆ·å</span></span><br><span class=\"line\">        password =&gt; <span class=\"string\">&quot;123456&quot;</span>                  <span class=\"comment\"># ESå¯†ç </span></span><br><span class=\"line\">        ssl =&gt; <span class=\"literal\">true</span>                           <span class=\"comment\"># æ˜¯å¦å¯ç”¨SSLï¼Œå› ä¸ºè¿™é‡Œæ˜¯httpsè®¿é—®ES</span></span><br><span class=\"line\">        ssl_certificate_verification =&gt; <span class=\"literal\">true</span>  <span class=\"comment\"># å¯ç”¨è¯ä¹¦æ ¡éªŒ</span></span><br><span class=\"line\">        ssl_truststore_path =&gt; <span class=\"string\">&quot;/usr/local/logstash/logstash-8.17.3/logstash.keystore&quot;</span> <span class=\"comment\"># æŒ‡å®šä¿¡ä»»åº“è·¯å¾„</span></span><br><span class=\"line\">        ssl_truststore_password =&gt; <span class=\"string\">&quot;123456&quot;</span>   <span class=\"comment\"># ä¿¡ä»»åº“å¯†ç </span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<h2 id=\"æ•´åˆæ¶ˆæ¯é˜Ÿåˆ—-Nginxçš„ELKæ¶æ„\">æ•´åˆæ¶ˆæ¯é˜Ÿåˆ—+Nginxçš„ELKæ¶æ„</h2>\n<p><img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/uPic/%E6%88%AA%E5%9B%BE-2.png\" alt=\"\"></p>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ¶ˆæ¯é˜Ÿåˆ—ï¼šå¼•å…¥æ¶ˆæ¯é˜Ÿåˆ—ä½œä¸ºç¼“å†²æœºåˆ¶ï¼Œç¡®ä¿å³ä½¿åœ¨Logstashæˆ–Elasticsearchå‡ºç°æ•…éšœæ—¶ï¼Œæ—¥å¿—æ•°æ®ä¹Ÿä¸ä¼šä¸¢å¤±ã€‚æ¶ˆæ¯é˜Ÿåˆ—èƒ½å¤Ÿå‡è¡¡ç½‘ç»œä¼ è¾“ï¼Œé™ä½æ•°æ®ä¸¢å¤±çš„å¯èƒ½æ€§ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>Nginxï¼šNginxä½œä¸ºé«˜æ€§èƒ½çš„Webå’Œåå‘ä»£ç†æœåŠ¡å™¨ï¼Œå¯ä»¥è¿›ä¸€æ­¥ä¼˜åŒ–æ•´ä¸ªç³»ç»Ÿçš„æ€§èƒ½å’Œå¯ç”¨æ€§ã€‚å®ƒå¯ä»¥åœ¨è´Ÿè½½å‡è¡¡ã€ç¼“å­˜ç­‰æ–¹é¢å‘æŒ¥ä½œç”¨ï¼Œæå‡ç”¨æˆ·è®¿é—®ä½“éªŒã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>æ‰©å±•æ€§ï¼šç”±äºå¼•å…¥äº†æ¶ˆæ¯é˜Ÿåˆ—å’ŒNginxç­‰ç»„ä»¶ï¼Œæ•´ä¸ªæ¶æ„çš„æ‰©å±•æ€§å¾—åˆ°å¢å¼ºã€‚å¯ä»¥æ ¹æ®å®é™…éœ€æ±‚åŠ¨æ€è°ƒæ•´å„ç»„ä»¶çš„èµ„æºåˆ†é…å’Œéƒ¨ç½²è§„æ¨¡ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>é€‚ç”¨åœºæ™¯ï¼šæ•´åˆæ¶ˆæ¯é˜Ÿåˆ—+Nginxçš„æ¶æ„ä¸»è¦é€‚ç”¨äºç”Ÿäº§ç¯å¢ƒï¼Œç‰¹åˆ«æ˜¯éœ€è¦å¤„ç†å¤§æ•°æ®é‡çš„åœºæ™¯ã€‚å®ƒèƒ½å¤Ÿç¡®ä¿æ•°æ®çš„å®‰å…¨æ€§å’Œå®Œæ•´æ€§ï¼ŒåŒæ—¶æä¾›é«˜æ€§èƒ½çš„æ—¥å¿—å¤„ç†å’Œå¯è§†åŒ–åˆ†ææœåŠ¡ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>æ€»ç»“æ¥è¯´å°±æ˜¯</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">filebeatå°†é‡‡é›†çš„æ—¥å¿—å‘é€åˆ°Redis\\RabbitMQ\\Kafkaç­‰</li>\n<li class=\"lvl-4\">Logstashå†ä»Redis\\RabbitMQ\\Kafkaä¸­è¯»å–æ—¥å¿—æ•°æ®ï¼Œå¹¶è¿›è¡Œè§£æåå‘é€åˆ°ESä¸­ã€‚</li>\n<li class=\"lvl-4\">ESé›†ç¾¤ä½¿ç”¨nginxè¿›è¡Œè´Ÿè½½å‡è¡¡ï¼Œä»¥å®ç°é«˜å¯ç”¨å’Œé«˜æ€§èƒ½ã€‚å…·ä½“å®ç°æ–¹æ³•æŸ¥çœ‹ï¼š<a href=\"/2025/03/24/elasticsearch-02-install-cluster/\" title=\"linuxä¸‹å®‰è£…Elasticsearché›†ç¾¤\">linuxä¸‹å®‰è£…Elasticsearché›†ç¾¤</a></li>\n</ul>\n</li>\n</ul>\n<h2 id=\"åŸºäºRedisçš„ELKæ¶æ„ç¤ºä¾‹\">åŸºäºRedisçš„ELKæ¶æ„ç¤ºä¾‹</h2>\n<h3 id=\"filebeatå°†é‡‡é›†çš„æ—¥å¿—å‘é€åˆ°Redis\">filebeatå°†é‡‡é›†çš„æ—¥å¿—å‘é€åˆ°Redis</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ›å»ºé…ç½®æ–‡ä»¶<code>filebeat-nginx-to-redis.yml</code>ï¼Œå°†å…¶ä¿å­˜åˆ°Filebeatå®‰è£…ç›®å½•ä¸‹çš„confç›®å½•ä¸‹ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å› ä¸ºNginxçš„access.logæ—¥å¿—éƒ½æ˜¯ä»¥IPåœ°å€å¼€å¤´çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¿®æ”¹ä¸‹åŒ¹é…å­—æ®µã€‚</span></span><br><span class=\"line\"><span class=\"comment\"># ä¸ä»¥ipåœ°å€å¼€å¤´çš„è¡Œè¿½åŠ åˆ°ä¸Šä¸€è¡Œ</span></span><br><span class=\"line\"><span class=\"attr\">filebeat.inputs:</span> <span class=\"comment\"># è¾“å…¥æºé…ç½®</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">type:</span> <span class=\"string\">log</span> <span class=\"comment\"># æ—¥å¿—ç±»å‹</span></span><br><span class=\"line\">  <span class=\"attr\">enabled:</span> <span class=\"literal\">true</span> <span class=\"comment\"># æ˜¯å¦å¯ç”¨</span></span><br><span class=\"line\">  <span class=\"attr\">paths:</span> <span class=\"comment\"># é‡‡é›†è·¯å¾„</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">/var/log/nginx/access*.*</span></span><br><span class=\"line\">  <span class=\"attr\">exclude_files:</span> [<span class=\"string\">&quot;.gz$&quot;</span>] <span class=\"comment\"># æ’é™¤ä»¥.gz ç»“å°¾çš„æ–‡ä»¶</span></span><br><span class=\"line\">  <span class=\"attr\">multiline.pattern:</span> <span class=\"string\">&#x27;^\\\\d&#123;1,3&#125;\\\\.\\\\d&#123;1,3&#125;\\\\.\\\\d&#123;1,3&#125;\\\\.\\\\d&#123;1,3&#125;\\\\s&#x27;</span> <span class=\"comment\"># åŒ¹é…ä»¥IPåœ°å€å¼€å¤´ï¼Œå¹¶ç´§è·Ÿä¸€ä¸ªç©ºç™½å­—ç¬¦</span></span><br><span class=\"line\">  <span class=\"attr\">multiline.negate:</span> <span class=\"literal\">true</span> <span class=\"comment\"># ä¸ä»¥ipåœ°å€å¼€å¤´çš„è¡Œè¿½åŠ åˆ°ä¸Šä¸€è¡Œ</span></span><br><span class=\"line\">  <span class=\"attr\">multiline.match:</span> <span class=\"string\">after</span> <span class=\"comment\"># è¿½åŠ åˆ°ä¸Šä¸€è¡Œçš„åé¢</span></span><br><span class=\"line\">  <span class=\"comment\"># multiline: å¤šè¡Œæ—¥å¿—é…ç½®ï¼Œè¿™é‡Œå®é™…ä¸Šä¸éœ€è¦é…ç½®å¤šè¡Œè®¾ç½®ï¼Œå› ä¸ºnginxçš„accessæ—¥å¿—éƒ½æ˜¯å•è¡Œæ—¥å¿—ï¼Œè¿™é‡Œåªåšæ¼”ç¤º</span></span><br><span class=\"line\">    <span class=\"comment\"># pattern: æ­£åˆ™è¡¨è¾¾å¼</span></span><br><span class=\"line\">    <span class=\"comment\"># negate: falseï¼ŒåŒ¹é…patternçš„è¡Œåˆå¹¶åˆ°ä¸Šä¸€è¡Œï¼›trueï¼Œä¸åŒ¹é…patternçš„è¡Œåˆå¹¶åˆ°ä¸Šä¸€è¡Œ</span></span><br><span class=\"line\">    <span class=\"comment\"># match: afterï¼Œåˆå¹¶åˆ°ä¸Šä¸€è¡Œçš„æœ«å°¾ï¼›beforeï¼Œåˆå¹¶åˆ°ä¸Šä¸€è¡Œçš„å¼€å¤´</span></span><br><span class=\"line\">  <span class=\"attr\">scan_frequency:</span> <span class=\"string\">10s</span> <span class=\"comment\"># æ¯ 10 ç§’æ‰«æä¸€æ¬¡æ—¥å¿—æ–‡ä»¶</span></span><br><span class=\"line\">  <span class=\"attr\">clean_removed:</span> <span class=\"literal\">true</span> <span class=\"comment\"># åœ¨æ—¥å¿—æ–‡ä»¶è¢«åˆ é™¤åæ˜¯å¦ä»å…¶å†…éƒ¨çŠ¶æ€ä¸­ç§»é™¤è¯¥æ–‡ä»¶çš„è®°å½•</span></span><br><span class=\"line\">  <span class=\"attr\">clean_inactive:</span> <span class=\"string\">2h</span> <span class=\"comment\"># åœ¨æ—¥å¿—æ–‡ä»¶å¤„äºéæ´»åŠ¨çŠ¶æ€å¤šé•¿æ—¶é—´åå°†å…¶ä»çŠ¶æ€æ•°æ®åº“ä¸­ç§»,è®¾ç½®ä¸ºæ¯” ignore_older + scan_frequency æ›´å¤§çš„å€¼</span></span><br><span class=\"line\">  <span class=\"attr\">ignore_older:</span> <span class=\"string\">1h</span> <span class=\"comment\"># å¿½ç•¥é‚£äº›æ¯”å½“å‰æ—¶é—´æ—©äº 1 å°æ—¶çš„æ—¥å¿—æ–‡ä»¶</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">output.redis:</span> <span class=\"comment\"># Redisè¾“å‡ºé…ç½®</span></span><br><span class=\"line\">  <span class=\"attr\">hosts:</span> [<span class=\"string\">&quot;10.250.0.214:6379&quot;</span>] <span class=\"comment\"># RedisæœåŠ¡å™¨åœ°å€</span></span><br><span class=\"line\">  <span class=\"attr\">password:</span> <span class=\"string\">&quot;123456&quot;</span> <span class=\"comment\"># Rediså¯†ç </span></span><br><span class=\"line\">  <span class=\"attr\">key:</span> <span class=\"string\">&quot;filebeat_nginx&quot;</span> <span class=\"comment\"># Redisçš„keyï¼Œç±»å‹ä¸º list</span></span><br><span class=\"line\">  <span class=\"attr\">db:</span> <span class=\"number\">3</span> <span class=\"comment\"># Redisæ•°æ®åº“</span></span><br><span class=\"line\">  <span class=\"attr\">timeout:</span> <span class=\"number\">3</span> <span class=\"comment\"># Redisè¿æ¥è¶…æ—¶æ—¶é—´ï¼Œå•ä½ç§’</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¯åŠ¨Filebeatï¼Œå¹¶æŸ¥çœ‹æ—¥å¿—è¾“å‡ºã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">./filebeat -e -c conf/filebeat-nginx-to-redis.yml</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æŸ¥çœ‹Redisä¸­çš„æ•°æ®</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ redis-cli -h 10.250.0.214 -p 6379 -a 123456</span><br><span class=\"line\">10.250.0.214:6379&gt; <span class=\"keyword\">select</span> 3</span><br><span class=\"line\">OK</span><br><span class=\"line\">10.250.0.214:6379[3]&gt; keys filebeat*</span><br><span class=\"line\">1) <span class=\"string\">&quot;filebeat_nginx&quot;</span></span><br><span class=\"line\">10.250.0.214:6379[3]&gt; <span class=\"built_in\">type</span> filebeat_nginx</span><br><span class=\"line\">list</span><br><span class=\"line\">10.250.0.214:6379[3]&gt; LLEN filebeat_nginx</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 14</span><br><span class=\"line\">10.250.0.214:6379[3]&gt; LINDEX filebeat_nginx 1</span><br><span class=\"line\"><span class=\"string\">&quot;&#123;\\&quot;@timestamp\\&quot;:\\&quot;2025-03-28T09:15:23.402Z\\&quot;,\\&quot;@metadata\\&quot;:&#123;\\&quot;beat\\&quot;:\\&quot;filebeat\\&quot;,\\&quot;type\\&quot;:\\&quot;_doc\\&quot;,\\&quot;version\\&quot;:\\&quot;8.17.3\\&quot;&#125;,\\&quot;host\\&quot;:&#123;\\&quot;name\\&quot;:\\&quot;ip-10-250-0-239.cn-northwest-1.compute.internal\\&quot;&#125;,\\&quot;agent\\&quot;:&#123;\\&quot;version\\&quot;:\\&quot;8.17.3\\&quot;,\\&quot;ephemeral_id\\&quot;:\\&quot;c0a521fe-690b-46b1-aadc-bbe16ef1db9a\\&quot;,\\&quot;id\\&quot;:\\&quot;4dbe185b-900d-4990-b841-c13bf9618fc6\\&quot;,\\&quot;name\\&quot;:\\&quot;ip-10-250-0-239.cn-northwest-1.compute.internal\\&quot;,\\&quot;type\\&quot;:\\&quot;filebeat\\&quot;&#125;,\\&quot;log\\&quot;:&#123;\\&quot;offset\\&quot;:46745,\\&quot;file\\&quot;:&#123;\\&quot;path\\&quot;:\\&quot;/var/log/nginx/access.log\\&quot;&#125;&#125;,\\&quot;message\\&quot;:\\&quot;1.119.161.30 - elastic [28/Mar/2025:09:15:13 +0000] \\\\\\&quot;GET /_cluster/stats HTTP/1.1\\\\\\&quot; 200 7457 \\\\\\&quot;-\\\\\\&quot; \\\\\\&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/134.0.0.0 Safari/537.36\\\\\\&quot; \\\\\\&quot;-\\\\\\&quot;\\&quot;,\\&quot;input\\&quot;:&#123;\\&quot;type\\&quot;:\\&quot;log\\&quot;&#125;,\\&quot;ecs\\&quot;:&#123;\\&quot;version\\&quot;:\\&quot;8.0.0\\&quot;&#125;&#125;&quot;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"Logstashä»Redisä¸­è¯»å–æ—¥å¿—å¹¶å†™å…¥Elasticsearch\">Logstashä»Redisä¸­è¯»å–æ—¥å¿—å¹¶å†™å…¥Elasticsearch</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ›å»ºé…ç½®æ–‡ä»¶<code>logstash-nginx-redis-to-es.conf</code>ï¼Œå°†å…¶ä¿å­˜åˆ°Logstashå®‰è£…ç›®å½•ä¸‹çš„confç›®å½•ä¸‹ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># è¿›å…¥logstashå®‰è£…ç›®å½•</span></span><br><span class=\"line\"><span class=\"comment\"># vim logstash-nginx-redis-to-es.conf</span></span><br><span class=\"line\"><span class=\"comment\"># é…ç½®ä» redis æ¥æ”¶æ•°æ®</span></span><br><span class=\"line\">input &#123; <span class=\"comment\"># è¾“å…¥æºé…ç½®</span></span><br><span class=\"line\">    redis &#123; <span class=\"comment\"># Redisè¾“å…¥é…ç½®</span></span><br><span class=\"line\">        host =&gt; <span class=\"string\">&#x27;10.250.0.214&#x27;</span> <span class=\"comment\"># RedisæœåŠ¡å™¨åœ°å€</span></span><br><span class=\"line\">        port =&gt; <span class=\"string\">&quot;6379&quot;</span> <span class=\"comment\"># RedisæœåŠ¡å™¨ç«¯å£</span></span><br><span class=\"line\">        password =&gt; <span class=\"string\">&quot;123456&quot;</span> <span class=\"comment\"># Rediså¯†ç </span></span><br><span class=\"line\">        db =&gt; <span class=\"string\">&quot;3&quot;</span>           <span class=\"comment\"># Redisæ•°æ®åº“</span></span><br><span class=\"line\">        data_type =&gt; <span class=\"string\">&#x27;list&#x27;</span> <span class=\"comment\"># æ•°æ®ç±»å‹ä¸ºlist</span></span><br><span class=\"line\">        key =&gt; <span class=\"string\">&quot;filebeat_nginx&quot;</span>   <span class=\"comment\"># Redisçš„key</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">filter &#123; <span class=\"comment\"># è¿‡æ»¤å™¨é…ç½®</span></span><br><span class=\"line\">    grok &#123;</span><br><span class=\"line\">        match =&gt; &#123;</span><br><span class=\"line\">        <span class=\"string\">&quot;message&quot;</span> =&gt; <span class=\"string\">&quot;%&#123;IP:client_ip&#125; - %&#123;USER:remote_user&#125; \\[%&#123;HTTPDATE:timestamp&#125;\\] \\&quot;%&#123;WORD:verb&#125; %&#123;URIPATHPARAM:request&#125; HTTP/%&#123;NUMBER:httpversion&#125;\\&quot; %&#123;INT:http_status&#125; %&#123;INT:body_bytes_sent&#125; \\&quot;%&#123;NOTSPACE:referrer&#125;\\&quot; \\&quot;%&#123;GREEDYDATA:agent&#125;\\&quot; %&#123;QUOTEDSTRING:x_forwarded_for&#125;&quot;</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    mutate &#123;</span><br><span class=\"line\">        enable_metric =&gt; <span class=\"string\">&quot;false&quot;</span> <span class=\"comment\"># ç¦ç”¨æŒ‡æ ‡ä¸ŠæŠ¥</span></span><br><span class=\"line\">        remove_field =&gt; [<span class=\"string\">&quot;message&quot;</span>, <span class=\"string\">&quot;log&quot;</span>, <span class=\"string\">&quot;tags&quot;</span>, <span class=\"string\">&quot;input&quot;</span>, <span class=\"string\">&quot;agent&quot;</span>, <span class=\"string\">&quot;host&quot;</span>, <span class=\"string\">&quot;ecs&quot;</span>, <span class=\"string\">&quot;@version&quot;</span>] <span class=\"comment\"># ç§»é™¤ä¸éœ€è¦çš„å­—æ®µ</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">date</span> &#123;</span><br><span class=\"line\">        match =&gt; [<span class=\"string\">&quot;timestamp&quot;</span>,<span class=\"string\">&quot;dd/MMM/yyyy:HH:mm:ss Z&quot;</span>,<span class=\"string\">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>] <span class=\"comment\"># æ—¶é—´æ ¼å¼è½¬æ¢</span></span><br><span class=\"line\">        target =&gt; <span class=\"string\">&quot;timestamp&quot;</span> <span class=\"comment\"># ç›®æ ‡å­—æ®µ</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åœ¨è¾“å‡ºé…ç½®ä¸­æ·»åŠ ESè¾“å‡ºé…ç½®</span></span><br><span class=\"line\">output &#123; <span class=\"comment\"># è¾“å‡ºé…ç½®</span></span><br><span class=\"line\">    stdout &#123; <span class=\"comment\"># æ‰“å°åˆ°æ§åˆ¶å°</span></span><br><span class=\"line\">      codec =&gt; rubydebug <span class=\"comment\"># æŒ‡å®šç¼–ç å™¨</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    elasticsearch &#123; <span class=\"comment\"># è¾“å‡ºåˆ°ES</span></span><br><span class=\"line\">        index =&gt; <span class=\"string\">&quot;redis_nginx_access_log_%&#123;+YYYY-MM&#125;&quot;</span> <span class=\"comment\"># ç´¢å¼•å,æŒ‰æœˆåˆ†éš”</span></span><br><span class=\"line\">        hosts =&gt; [<span class=\"string\">&quot;https://10.250.0.239:9200&quot;</span>] <span class=\"comment\"># ESåœ°å€</span></span><br><span class=\"line\">        user =&gt; <span class=\"string\">&quot;elastic&quot;</span>                   <span class=\"comment\"># ESç”¨æˆ·å</span></span><br><span class=\"line\">        password =&gt; <span class=\"string\">&quot;123456&quot;</span>                <span class=\"comment\"># ESå¯†ç </span></span><br><span class=\"line\">        ssl =&gt; <span class=\"literal\">true</span>                         <span class=\"comment\"># æ˜¯å¦å¯ç”¨SSLï¼Œå› ä¸ºè¿™é‡Œæ˜¯httpsè®¿é—®ES</span></span><br><span class=\"line\">        ssl_certificate_verification =&gt; <span class=\"literal\">false</span> <span class=\"comment\"># ç¦ç”¨è¯ä¹¦éªŒè¯</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æµ‹è¯•logstashé…ç½®æ˜¯å¦æ­£ç¡®</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">bin/logstash -f config/logstash-nginx-redis-to-es.conf --config.test_and_exit</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¯åŠ¨logstash</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># reload.automaticï¼šä¿®æ”¹é…ç½®æ–‡ä»¶æ—¶è‡ªåŠ¨é‡æ–°åŠ è½½</span></span><br><span class=\"line\">bin/logstash -f config/logstash-nginx-redis-to-es.conf --config.reload.automatic</span><br></pre></td></tr></table></figure>","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç»å¦‚ä½•åœ¨linuxä¸‹å®‰è£…LogStashå’ŒFileBeat é€šè¿‡ç¤ºä¾‹è®²è§£ELKçš„ç»å…¸æ¶æ„å’Œé«˜å¹¶å‘æ¶æ„çš„å®ç°è¿‡ç¨‹ LogStashç‰ˆæœ¬8.17.3ï¼ŒFileBeatç‰ˆæœ¬8.17.3 Elasticsearchç‰ˆæœ¬8.17.3ï¼Œlinuxä¸‹å®‰è£…Elasticsearch Kibanaç‰ˆæœ¬8.17.3ï¼Œlinuxä¸‹å®‰è£…Kibana Elasticsearché›†ç¾¤æ­å»ºï¼Œlinuxä¸‹å®‰è£…Elasticsearché›†ç¾¤ Logstashæ¦‚è¿° Logstash æ˜¯å…è´¹ä¸”å¼€æ”¾çš„æœåŠ¡å™¨ç«¯æ•°æ®å¤„ç†ç®¡é“ï¼Œèƒ½å¤Ÿä»å¤šä¸ªæ¥æºé‡‡é›†æ•°æ®ï¼Œè½¬æ¢æ•°æ®ï¼Œç„¶åå°†æ•°æ®å‘é€åˆ°æ‚¨æœ€å–œæ¬¢çš„å­˜å‚¨åº“ä¸­ã€‚ Logstashæ•°æ®ä¼ è¾“åŸç† 1231.æ•°æ®é‡‡é›†ä¸è¾“å…¥ï¼šLogstashæ”¯æŒå„ç§è¾“å…¥é€‰æ‹©ï¼Œèƒ½å¤Ÿä»¥è¿ç»­çš„æµå¼ä¼ è¾“æ–¹å¼ï¼Œè½»æ¾åœ°ä»æ—¥å¿—ã€æŒ‡æ ‡ã€Webåº”ç”¨ä»¥åŠæ•°æ®å­˜å‚¨ä¸­é‡‡é›†æ•°æ®ã€‚2.å®æ—¶è§£æå’Œæ•°æ®è½¬æ¢ï¼šé€šè¿‡Logstashè¿‡æ»¤å™¨è§£æå„ä¸ªäº‹ä»¶ï¼Œè¯†åˆ«å·²å‘½åçš„å­—æ®µæ¥æ„å»ºç»“æ„ï¼Œå¹¶å°†å®ƒä»¬è½¬æ¢æˆé€šç”¨æ ¼å¼ï¼Œæœ€ç»ˆå°†æ•°æ®ä»æºç«¯ä¼ è¾“åˆ°å­˜å‚¨åº“ä¸­ã€‚3.å­˜å‚¨ä¸æ•°æ®å¯¼å‡ºï¼šLogstashæä¾›å¤šç§è¾“å‡ºé€‰æ‹©ï¼Œå¯ä»¥å°†æ•°æ®å‘é€åˆ°æŒ‡å®šçš„åœ°æ–¹ã€‚ Logstashé€šè¿‡ç®¡é“å®Œæˆæ•°æ®çš„é‡‡é›†ä¸å¤„ç†ï¼Œç®¡é“é…ç½®ä¸­åŒ…å«inputã€outputå’Œfilterï¼ˆå¯é€‰ï¼‰æ’ä»¶ï¼Œinputå’Œoutputç”¨æ¥é…ç½®è¾“å…¥å’Œè¾“å‡ºæ•°æ®æºã€filterç”¨æ¥å¯¹æ•°æ®è¿›è¡Œè¿‡æ»¤æˆ–é¢„å¤„ç†ã€‚ Logstashä¸‹è½½å®‰è£… ä¸‹è½½åœ°å€ï¼šhttps://www.elastic.co/cn/downloads/past-releases#logstash é€‰æ‹©å¯¹åº”çš„ç‰ˆæœ¬ï¼šè¿™é‡Œé€‰æ‹©å½“å‰çš„æœ€æ–°ç‰ˆLogStash 8.17.3ï¼Œä¹‹åé€‰æ‹©å¯¹åº”çš„æ“ä½œç³»ç»ŸLINUX X86_64 1wget https://artifacts.elastic.co/downloads/logstash/logstash-8.17.3-linux-x86_64.tar.gz ä¸‹è½½å®Œæˆåè§£å‹åˆ°/usr/local/logstashç›®å½•ä¸‹ï¼Œè§£å‹å‘½ä»¤å¦‚ä¸‹ï¼š 12mkdir /usr/local/logstashtar -zxvf logstash-8.17.3-linux-x86_64.tar.gz -C /usr/local/logstash elasticsearchå’Œkibanaéƒ½ä¸èƒ½ç”¨rootç”¨æˆ·å¯åŠ¨ï¼Œä¸ºäº†ç»Ÿä¸€ç®¡ç†ï¼Œlogstashä¹Ÿä½¿ç”¨è¿™ä¸ªç”¨æˆ·ï¼ˆéå¿…è¦ï¼‰ åˆ›å»ºç”¨æˆ·elasticï¼Œå¹¶è®¾ç½®å¯†ç ï¼Œè¿™ä¸€æ­¥æˆ‘ä»¬åœ¨å®‰è£…elasticsearchçš„æ—¶å€™å·²ç»é…ç½®è¿‡äº†ï¼Œè¿™é‡Œå°±ä¸å†èµ˜è¿°äº† 12useradd elasticpasswd elastic ä¿®æ”¹logstashå®‰è£…ç›®å½•çš„ç”¨æˆ·æƒé™ 1chown -R elastic:elastic /usr/local/logstash åˆ‡æ¢åˆ°elasticç”¨æˆ·ä¸‹æ‰§è¡Œå‘½ä»¤ 1234# åˆ‡æ¢ç”¨æˆ·su - elastic# è¿›å…¥logstashå®‰è£…ç›®å½•cd /usr/local/logstash/logstash-8.17.3/ è¿è¡Œä¸€ä¸ªç®€å•çš„æµ‹è¯• 123456789101112131415161718192021# -e: ç›´æ¥æŠŠé…ç½®æ”¾åœ¨å‘½ä»¤ä¸­ï¼Œè¿™æ ·å¯ä»¥æœ‰æ•ˆå¿«é€Ÿè¿›è¡Œæµ‹è¯•# input &#123; stdin &#123; &#125; &#125;: è¾“å…¥æ’ä»¶ï¼Œä»æ ‡å‡†è¾“å…¥ä¸­è¯»å–æ•°æ®# output &#123; stdout &#123;&#125; &#125;: è¾“å‡ºæ’ä»¶ï¼Œå°†æ•°æ®è¾“å‡ºåˆ°æ ‡å‡†è¾“å‡º# è¿™é‡ŒåªåŒ…å«äº† input å’Œ output ä¸¤ä¸ªéƒ¨åˆ†ï¼Œå®é™…ä½¿ç”¨ä¸­è¿˜éœ€è¦æ·»åŠ  filter éƒ¨åˆ†./bin/logstash -e &#x27;input &#123; stdin &#123; &#125; &#125; output &#123; stdout &#123;&#125; &#125;&#x27;# è¾“å‡ºï¼šã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ # è¾“å‡ºå¯åŠ¨ä¿¡æ¯The stdin plugin is now waiting for input: # è¾“å‡ºæç¤ºä¿¡æ¯ï¼Œæç¤ºä½ è¾“å…¥å†…å®¹hello world # æˆ‘è¾“å…¥å†…å®¹# logstashè¾“å‡ºå†…å®¹&#123; &quot;message&quot; =&gt; &quot;hello world&quot;, &quot;@version&quot; =&gt; &quot;1&quot;, &quot;event&quot; =&gt; &#123; &quot;original&quot; =&gt; &quot;hello world&quot; &#125;, &quot;host&quot; =&gt; &#123; &quot;hostname&quot; =&gt; &quot;ip-10-250-0-239.cn-northwest-1.compute.internal&quot; &#125;, &quot;@timestamp&quot; =&gt; 2025-03-27T06:48:12.810617855Z&#125; ä¹Ÿå¯ä»¥é€šè¿‡é…ç½®æ–‡ä»¶å¯åŠ¨logstash 1234567891011121314# vim test.confinput &#123; stdin &#123; &#125;&#125;output &#123; stdout &#123; codec =&gt; rubydebug &#125;&#125;# codec =&gt; rubydebug : æ˜¯æŒ‡å®šäº†ä¸€ä¸ªç¼–ç å™¨ï¼ˆCodecï¼‰ä¸º rubydebugã€‚# ç¼–ç å™¨è´Ÿè´£å¦‚ä½•æ ¼å¼åŒ–è¾“å‡ºçš„æ•°æ®ã€‚# Rubydebug ç¼–ç å™¨æ˜¯ä¸€ç§ç‰¹åˆ«é€‚åˆå¼€å‘å’Œè°ƒè¯•ç›®çš„çš„ç¼–ç å™¨ï¼Œå› ä¸ºå®ƒèƒ½ä»¥ç›¸å½“æ˜“è¯»çš„å½¢å¼å±•ç¤ºå¤æ‚çš„ç»“æ„åŒ–æ•°æ®ï¼Œæ¯”å¦‚åµŒå¥—çš„å“ˆå¸Œè¡¨æˆ–è€…æ•°ç»„ã€‚# é™¤äº† Rubydebug ç¼–ç å™¨ï¼ŒLogstash è¿˜æä¾›äº†å…¶ä»–å‡ ç§ç¼–ç å™¨ï¼Œæ¯”å¦‚ jsonã€plainã€multiline ç­‰ç­‰ã€‚# å…·ä½“å¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼šhttps://www.elastic.co/guide/en/logstash/current/codec-plugins.html 1./bin/logstash -f ./test.conf Logstashæ’ä»¶ Input Plugins https://www.elastic.co/guide/en/logstash/8.17/input-plugins.html ä¸€ä¸ª Pipelineå¯ä»¥æœ‰å¤šä¸ªinputæ’ä»¶ 12345- Stdin / File- Beats / Log4J /Elasticsearch / JDBC / Kafka /Rabbitmq /Redis- JMX/ HTTP / Websocket / UDP / TCP- Google Cloud Storage / S3- Github / Twitter Filter Plugins https://www.elastic.co/guide/en/logstash/8.17/filter-plugins.html Filter Pluginå¯ä»¥å¯¹Logstash Eventè¿›è¡Œå„ç§å¤„ç†ï¼Œä¾‹å¦‚è§£æï¼Œåˆ é™¤å­—æ®µï¼Œç±»å‹è½¬æ¢ 1234567891011- Date: æ—¥æœŸè§£æ- Dissect: åˆ†å‰²ç¬¦è§£æ- Grok: æ­£åˆ™åŒ¹é…è§£æ- Mutate: å¯¹å­—æ®µåšå„ç§æ“ä½œ- Convert : ç±»å‹è½¬æ¢- Gsub : å­—ç¬¦ä¸²æ›¿æ¢- Split / Join /Merge: å­—ç¬¦ä¸²åˆ‡å‰²ï¼Œæ•°ç»„åˆå¹¶å­—ç¬¦ä¸²ï¼Œæ•°ç»„åˆå¹¶æ•°ç»„- Rename: å­—æ®µé‡å‘½å- Update / Replace: å­—æ®µå†…å®¹æ›´æ–°æ›¿æ¢- Remove_field: å­—æ®µåˆ é™¤- Ruby: åˆ©ç”¨Ruby ä»£ç æ¥åŠ¨æ€ä¿®æ”¹Event Output Plugins https://www.elastic.co/guide/en/logstash/8.17/output-plugins.html å°†Eventå‘é€åˆ°ç‰¹å®šçš„ç›®çš„åœ°ï¼Œæ˜¯ Pipeline çš„æœ€åä¸€ä¸ªé˜¶æ®µã€‚å¸¸è§ Output Pluginsï¼š 1234- Elasticsearch- Email / Pageduty- Influxdb / Kafka / Mongodb / Opentsdb / Zabbix- Http / TCP / Websocket Codec Plugins https://www.elastic.co/guide/en/logstash/8.17/codec-plugins.html å°†åŸå§‹æ•°æ®decodeæˆEvent;å°†Event encodeæˆç›®æ ‡æ•°æ®ï¼Œå†…ç½®çš„Codec Plugins: 123- Line / Multiline- JSON / Avro / Cef (ArcSight Common Event Format)- Dots / Rubydebug FileBeatæ¦‚è¿° Beats æ˜¯ä¸€ä¸ªå…è´¹ä¸”å¼€æ”¾çš„å¹³å°ï¼Œé›†åˆäº†å¤šç§å•ä¸€ç”¨é€”çš„æ•°æ®é‡‡é›†å™¨ã€‚å®ƒä»¬ä»æˆç™¾ä¸Šåƒæˆ–æˆåƒä¸Šä¸‡å°æœºå™¨å’Œç³»ç»Ÿå‘ Logstash æˆ– Elasticsearch å‘é€æ•°æ®ã€‚ FileBeat ä¸“é—¨ç”¨äºè½¬å‘å’Œæ”¶é›†æ—¥å¿—æ•°æ®çš„è½»é‡çº§é‡‡é›†å·¥å…·ã€‚å®ƒå¯ä»¥ä½œä¸ºä»£ç†å®‰è£…åœ¨æœåŠ¡å™¨ä¸Šï¼ŒFileBeatç›‘è§†æŒ‡å®šè·¯å¾„çš„æ—¥å¿—æ–‡ä»¶ï¼Œæ”¶é›†æ—¥å¿—æ•°æ®ï¼Œå¹¶å°†æ”¶é›†åˆ°çš„æ—¥å¿—è½¬å‘åˆ°Elasticsearchæˆ–è€…Logstashã€‚ logstash vs FileBeat Logstashæ˜¯åœ¨jvmä¸Šè¿è¡Œçš„ï¼Œèµ„æºæ¶ˆè€—æ¯”è¾ƒå¤§ã€‚è€ŒFileBeatæ˜¯åŸºäºgolangç¼–å†™çš„ï¼ŒåŠŸèƒ½è¾ƒå°‘ä½†èµ„æºæ¶ˆè€—ä¹Ÿæ¯”è¾ƒå°ï¼Œæ›´è½»é‡çº§ã€‚ Logstash å’ŒFilebeatéƒ½å…·æœ‰æ—¥å¿—æ”¶é›†åŠŸèƒ½ï¼ŒFilebeatæ›´è½»é‡ï¼Œå ç”¨èµ„æºæ›´å°‘ Logstash å…·æœ‰FilteråŠŸèƒ½ï¼Œèƒ½è¿‡æ»¤åˆ†ææ—¥å¿— ä¸€èˆ¬ç»“æ„éƒ½æ˜¯Filebeaté‡‡é›†æ—¥å¿—ï¼Œç„¶åå‘é€åˆ°æ¶ˆæ¯é˜Ÿåˆ—ã€Redisã€MQä¸­ï¼Œç„¶åLogstashå»è·å–ï¼Œåˆ©ç”¨FilteråŠŸèƒ½è¿‡æ»¤åˆ†æï¼Œç„¶åå­˜å‚¨åˆ°Elasticsearchä¸­ FileBeatå’ŒLogstashé…åˆï¼Œå®ç°èƒŒå‹æœºåˆ¶ã€‚å½“å°†æ•°æ®å‘é€åˆ°Logstashæˆ– Elasticsearchæ—¶ï¼ŒFilebeatä½¿ç”¨èƒŒå‹æ•æ„Ÿåè®®ï¼Œä»¥åº”å¯¹æ›´å¤šçš„æ•°æ®é‡ã€‚å¦‚æœLogstashæ­£åœ¨å¿™äºå¤„ç†æ•°æ®ï¼Œåˆ™ä¼šå‘Šè¯‰Filebeat å‡æ…¢è¯»å–é€Ÿåº¦ã€‚ä¸€æ—¦æ‹¥å µå¾—åˆ°è§£å†³ï¼ŒFilebeatå°±ä¼šæ¢å¤åˆ°åŸæ¥çš„æ­¥ä¼å¹¶ç»§ç»­ä¼ è¾“æ•°æ®ã€‚ FileBeatä¸‹è½½å’Œå®‰è£… ä¸‹è½½åœ°å€ï¼šhttps://www.elastic.co/cn/downloads/past-releases#filebeat é€‰æ‹©å¯¹åº”çš„ç‰ˆæœ¬ï¼šè¿™é‡Œé€‰æ‹©å½“å‰çš„æœ€æ–°ç‰ˆFileBeat 8.17.3ï¼Œä¹‹åé€‰æ‹©å¯¹åº”çš„æ“ä½œç³»ç»ŸLINUX X86_64 1wget https://artifacts.elastic.co/downloads/beats/filebeat/filebeat-8.17.3-linux-x86_64.tar.gz ä¸‹è½½å®Œæˆåè§£å‹åˆ°/usr/local/filebeatç›®å½•ä¸‹ï¼Œè§£å‹å‘½ä»¤å¦‚ä¸‹ï¼š 12mkdir /usr/local/filebeattar -zxvf filebeat-8.17.3-linux-x86_64.tar.gz -C /usr/local/filebeat ä¿®æ”¹logstashå®‰è£…ç›®å½•çš„ç”¨æˆ·æƒé™ 1chown -R elastic:elastic /usr/local/filebeat åˆ‡æ¢åˆ°elasticç”¨æˆ·ä¸‹æ‰§è¡Œå‘½ä»¤ 1234# åˆ‡æ¢ç”¨æˆ·su - elastic# è¿›å…¥ filebeat å®‰è£…ç›®å½•cd /usr/local/filebeat/filebeat-8.17.3-linux-x86_64/ ç»å…¸çš„ELKæ¶æ„ Filebeatæ—¥å¿—æ”¶é›†ï¼šFilebeatä½œä¸ºè½»é‡çº§çš„æ—¥å¿—æ”¶é›†ä»£ç†ï¼Œéƒ¨ç½²åœ¨å®¢æˆ·ç«¯ä¸Šï¼Œæ¶ˆè€—èµ„æºå°‘ï¼Œèƒ½å¤Ÿé«˜æ•ˆåœ°æ”¶é›†æ—¥å¿—æ•°æ®ã€‚ Logstashæ•°æ®å¤„ç†ï¼šLogstashä½œä¸ºæ•°æ®å¤„ç†ç®¡é“ï¼Œè´Ÿè´£å°†Filebeatæ”¶é›†çš„æ—¥å¿—æ•°æ®è¿›è¡Œè¿‡æ»¤ã€è½¬æ¢ç­‰æ“ä½œï¼Œç„¶åå‘é€åˆ°Elasticsearchè¿›è¡Œå­˜å‚¨ã€‚ Elasticsearchå­˜å‚¨ä¸æœç´¢ï¼šElasticsearchæ˜¯ä¸€ä¸ªåŸºäºLuceneçš„åˆ†å¸ƒå¼æœç´¢å’Œåˆ†æå¼•æ“ï¼Œæä¾›å¼ºå¤§çš„æ•°æ®å­˜å‚¨å’Œæœç´¢èƒ½åŠ›ã€‚ Kibanaå¯è§†åŒ–ï¼šKibanaä¸ºElasticsearchæä¾›Webå¯è§†åŒ–ç•Œé¢ï¼Œå…è®¸ç”¨æˆ·é€šè¿‡å›¾è¡¨ã€ä»ªè¡¨ç›˜ç­‰æ–¹å¼ç›´è§‚åœ°æŸ¥çœ‹å’Œåˆ†ææ—¥å¿—æ•°æ®ã€‚ é€‚ç”¨åœºæ™¯ï¼šç»å…¸çš„ELKæ¶æ„ä¸»è¦é€‚ç”¨äºæ•°æ®é‡è¾ƒå°çš„å¼€å‘ç¯å¢ƒã€‚ç„¶è€Œï¼Œç”±äºç¼ºå°‘æ¶ˆæ¯é˜Ÿåˆ—çš„ç¼“å†²æœºåˆ¶ï¼Œå½“Logstashæˆ–Elasticsearchå‡ºç°æ•…éšœæ—¶ï¼Œå¯èƒ½å­˜åœ¨æ•°æ®ä¸¢å¤±çš„é£é™©ã€‚ ä¸€ä¸ªç»å…¸ELKæ¶æ„ç¤ºä¾‹ FileBeaté‡‡é›†NginxæœåŠ¡å™¨æ—¥å¿—å¹¶å‘é€åˆ°Logstash åˆ›å»ºé…ç½®æ–‡ä»¶filebeat-nginx.ymlï¼Œå°†å…¶ä¿å­˜åˆ°Filebeatå®‰è£…ç›®å½•ä¸‹çš„confç›®å½•ä¸‹ã€‚ 12345678910111213141516171819202122# å› ä¸ºNginxçš„access.logæ—¥å¿—éƒ½æ˜¯ä»¥IPåœ°å€å¼€å¤´çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¿®æ”¹ä¸‹åŒ¹é…å­—æ®µã€‚# ä¸ä»¥ipåœ°å€å¼€å¤´çš„è¡Œè¿½åŠ åˆ°ä¸Šä¸€è¡Œfilebeat.inputs: # è¾“å…¥æºé…ç½®- type: log # æ—¥å¿—ç±»å‹ enabled: true # æ˜¯å¦å¯ç”¨ paths: # é‡‡é›†è·¯å¾„ - /var/log/nginx/access*.* exclude_files: [&quot;.gz$&quot;] # æ’é™¤ä»¥.gz ç»“å°¾çš„æ–‡ä»¶ multiline.pattern: &#x27;^\\\\d&#123;1,3&#125;\\\\.\\\\d&#123;1,3&#125;\\\\.\\\\d&#123;1,3&#125;\\\\.\\\\d&#123;1,3&#125;\\\\s&#x27; # åŒ¹é…ä»¥IPåœ°å€å¼€å¤´ï¼Œå¹¶ç´§è·Ÿä¸€ä¸ªç©ºç™½å­—ç¬¦ multiline.negate: true # ä¸ä»¥ipåœ°å€å¼€å¤´çš„è¡Œè¿½åŠ åˆ°ä¸Šä¸€è¡Œ multiline.match: after # è¿½åŠ åˆ°ä¸Šä¸€è¡Œçš„åé¢ # multiline: å¤šè¡Œæ—¥å¿—é…ç½®ï¼Œè¿™é‡Œå®é™…ä¸Šä¸éœ€è¦é…ç½®å¤šè¡Œè®¾ç½®ï¼Œå› ä¸ºnginxçš„accessæ—¥å¿—éƒ½æ˜¯å•è¡Œæ—¥å¿—ï¼Œè¿™é‡Œåªåšæ¼”ç¤º # pattern: æ­£åˆ™è¡¨è¾¾å¼ # negate: falseï¼ŒåŒ¹é…patternçš„è¡Œåˆå¹¶åˆ°ä¸Šä¸€è¡Œï¼›trueï¼Œä¸åŒ¹é…patternçš„è¡Œåˆå¹¶åˆ°ä¸Šä¸€è¡Œ # match: afterï¼Œåˆå¹¶åˆ°ä¸Šä¸€è¡Œçš„æœ«å°¾ï¼›beforeï¼Œåˆå¹¶åˆ°ä¸Šä¸€è¡Œçš„å¼€å¤´ scan_frequency: 10s # æ¯ 10 ç§’æ‰«æä¸€æ¬¡æ—¥å¿—æ–‡ä»¶ clean_removed: true # åœ¨æ—¥å¿—æ–‡ä»¶è¢«åˆ é™¤åæ˜¯å¦ä»å…¶å†…éƒ¨çŠ¶æ€ä¸­ç§»é™¤è¯¥æ–‡ä»¶çš„è®°å½• clean_inactive: 2h # åœ¨æ—¥å¿—æ–‡ä»¶å¤„äºéæ´»åŠ¨çŠ¶æ€å¤šé•¿æ—¶é—´åå°†å…¶ä»çŠ¶æ€æ•°æ®åº“ä¸­ç§»,è®¾ç½®ä¸ºæ¯” ignore_older + scan_frequency æ›´å¤§çš„å€¼ ignore_older: 1h # å¿½ç•¥é‚£äº›æ¯”å½“å‰æ—¶é—´æ—©äº 1 å°æ—¶çš„æ—¥å¿—æ–‡ä»¶output.logstash: # è¾“å‡ºé…ç½®ï¼Œè¿™é‡Œæ˜¯å‘é€åˆ°Logstash enabled: true # æ˜¯å¦å¯ç”¨ hosts: [&quot;10.250.0.239:5044&quot;] # LogstashæœåŠ¡åœ°å€ ä¸ºFileBeatçš„ç”¨æˆ·åˆ†é…æ—¥å¿—ç›®å½•çš„è¯»å–æƒé™ 12# ä½¿ç”¨ setfaclå‘½ä»¤ä¸ºelasticç”¨æˆ·åˆ†é…æ—¥å¿—ç›®å½•çš„è¯»å–æƒé™sudo setfacl -d -m u:elastic:r-x -R /var/log/nginx/ å¯åŠ¨FileBeat 123./filebeat -e -c conf/filebeat-nginx.yml# åå°å¯åŠ¨nohup ./filebeat -e -c conf/filebeat-nginx.yml &amp; åœ¨å¯åŠ¨filebeatæ—¶å¯èƒ½ä¼šé‡åˆ°å¦‚ä¸‹é”™è¯¯ 1Exiting: error loading config file: config file (&quot;conf/filebeat-nginx.yml&quot;) can only be writable by the owner but the permissions are &quot;-rw-rw-r--&quot; (to fix the permissions use: &#x27;chmod go-w /usr/local/filebeat/filebeat-8.17.3-linux-x86_64/conf/filebeat-nginx.yml&#x27;) å› ä¸ºå®‰å…¨åŸå› ä¸è¦å…¶ä»–ç”¨æˆ·å†™çš„æƒé™ï¼Œå»æ‰å†™çš„æƒé™å°±å¯ä»¥äº† 1chmod go-w conf/filebeat-nginx.yml é…ç½®Logstashæ¥æ”¶FileBeatæ”¶é›†çš„æ•°æ®å¹¶æ‰“å° åˆ›å»ºé…ç½®æ–‡ä»¶logstash-nginx.confï¼Œå°†å…¶ä¿å­˜åˆ°Logstashå®‰è£…ç›®å½•ä¸‹çš„configç›®å½•ä¸‹ã€‚ 1234567891011121314# è¿›å…¥logstashå®‰è£…ç›®å½•# vim config/logstash-nginx.conf# é…ç½®ä»FileBeatæ¥æ”¶æ•°æ®input &#123; # è¾“å…¥æºé…ç½® beats &#123; # ä»FileBeatæ¥æ”¶æ•°æ® port =&gt; 5044 # ç›‘å¬5044ç«¯å£ &#125;&#125;output &#123; # è¾“å‡ºé…ç½® stdout &#123; # æ‰“å°åˆ°æ§åˆ¶å° codec =&gt; rubydebug # æŒ‡å®šç¼–ç å™¨ &#125;&#125; æµ‹è¯•logstashé…ç½®æ˜¯å¦æ­£ç¡® 1bin/logstash -f config/logstash-nginx.conf --config.test_and_exit å¯åŠ¨logstash 12345678910111213141516171819202122232425262728293031323334353637# reload.automaticï¼šä¿®æ”¹é…ç½®æ–‡ä»¶æ—¶è‡ªåŠ¨é‡æ–°åŠ è½½bin/logstash -f config/logstash-nginx.conf --config.reload.automatic# æ­¤æ—¶åœ¨æ§åˆ¶å°ä¼šçœ‹åˆ°å¦‚ä¸‹è¾“å‡ºï¼š&#123; &quot;input&quot; =&gt; &#123; &quot;type&quot; =&gt; &quot;log&quot; &#125;, &quot;@version&quot; =&gt; &quot;1&quot;, &quot;message&quot; =&gt; &quot;1.119.161.30 - elastic [27/Mar/2025:08:52:41 +0000] \\&quot;GET /_cluster/stats HTTP/1.1\\&quot; 200 7445 \\&quot;-\\&quot; \\&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/134.0.0.0 Safari/537.36\\&quot; \\&quot;-\\&quot;&quot;, &quot;log&quot; =&gt; &#123; &quot;file&quot; =&gt; &#123; &quot;path&quot; =&gt; &quot;/var/log/nginx/access.log&quot; &#125;, &quot;offset&quot; =&gt; 42985 &#125;, &quot;tags&quot; =&gt; [ [0] &quot;beats_input_codec_plain_applied&quot; ], &quot;@timestamp&quot; =&gt; 2025-03-27T08:52:42.947Z, &quot;ecs&quot; =&gt; &#123; &quot;version&quot; =&gt; &quot;8.0.0&quot; &#125;, &quot;agent&quot; =&gt; &#123; &quot;id&quot; =&gt; &quot;4dbe185b-900d-4990-b841-c13bf9618fc6&quot;, &quot;name&quot; =&gt; &quot;ip-10-250-0-239.cn-northwest-1.compute.internal&quot;, &quot;ephemeral_id&quot; =&gt; &quot;6bb04808-7da7-4acb-95fd-f3f915651457&quot;, &quot;type&quot; =&gt; &quot;filebeat&quot;, &quot;version&quot; =&gt; &quot;8.17.3&quot; &#125;, &quot;event&quot; =&gt; &#123; &quot;original&quot; =&gt; &quot;1.119.161.30 - elastic [27/Mar/2025:08:52:41 +0000] \\&quot;GET /_cluster/stats HTTP/1.1\\&quot; 200 7445 \\&quot;-\\&quot; \\&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/134.0.0.0 Safari/537.36\\&quot; \\&quot;-\\&quot;&quot; &#125;, &quot;host&quot; =&gt; &#123; &quot;name&quot; =&gt; &quot;ip-10-250-0-239.cn-northwest-1.compute.internal&quot; &#125;&#125; åˆ©ç”¨Logstashè¿‡æ»¤å™¨è§£ææ—¥å¿— ä»æ‰“å°ç»“æœçœ‹åˆ°åŒ…å«äº†å¤§é‡çš„æ— å…³æ•°æ®ï¼Œæ­¤æ—¶å¯ä»¥åˆ©ç”¨Logstashè¿‡æ»¤å™¨è§£ææ—¥å¿—ï¼Œè¿™é‡Œä½¿ç”¨Grokæ’ä»¶ Grokæ˜¯ä¸€ç§å°†éç»“æ„åŒ–æ—¥å¿—è§£æä¸ºç»“æ„åŒ–çš„æ’ä»¶ã€‚è¿™ä¸ªå·¥å…·éå¸¸é€‚åˆç”¨æ¥è§£æç³»ç»Ÿæ—¥å¿—ã€WebæœåŠ¡å™¨æ—¥å¿—ã€MySQLæˆ–è€…æ˜¯ä»»æ„å…¶ä»–çš„æ—¥å¿—æ ¼å¼ã€‚ Grokæ˜¯é€šè¿‡æ¨¡å¼åŒ¹é…çš„æ–¹å¼æ¥è¯†åˆ«æ—¥å¿—ä¸­çš„æ•°æ®,å¯ä»¥æŠŠGrokæ’ä»¶ç®€å•ç†è§£ä¸ºå‡çº§ç‰ˆæœ¬çš„æ­£åˆ™è¡¨è¾¾å¼ã€‚å®ƒæ‹¥æœ‰æ›´å¤šçš„æ¨¡å¼ï¼Œé»˜è®¤Logstashæ‹¥æœ‰120ä¸ªæ¨¡å¼ã€‚å¦‚æœè¿™äº›æ¨¡å¼ä¸æ»¡è¶³æˆ‘ä»¬è§£ææ—¥å¿—çš„éœ€æ±‚ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æ¥è¿›è¡ŒåŒ¹é…ã€‚ GROKæ¨¡å¼å‚è€ƒ grokæ¨¡å¼çš„è¯­æ³•æ˜¯: 1234%&#123;SYNTAX:SEMANTIC&#125;# SYNTAXï¼ˆè¯­æ³•ï¼‰æŒ‡çš„æ˜¯Grokæ¨¡å¼åç§°ï¼ŒSEMANTICï¼ˆè¯­ä¹‰ï¼‰æ˜¯ç»™æ¨¡å¼åŒ¹é…åˆ°çš„æ–‡æœ¬å­—æ®µåã€‚ä¾‹å¦‚ï¼š%&#123;NUMBER:duration&#125; %&#123;IP:client&#125;# durationè¡¨ç¤ºï¼šåŒ¹é…ä¸€ä¸ªæ•°å­—ï¼Œclientè¡¨ç¤ºåŒ¹é…ä¸€ä¸ªIPåœ°å€ã€‚ åŒ¹é…nginxæ—¥å¿— 123456789101112131415161718192021222324252627282930313233# nginx accessæ—¥å¿—æ ¼å¼1.119.161.30 - elastic [27/Mar/2025:03:05:36 +0000] &quot;GET /_cluster/stats HTTP/1.1&quot; 200 7446 &quot;-&quot; &quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/134.0.0.0 Safari/537.36&quot; &quot;-&quot;# grok%&#123;IP:client_ip&#125; - %&#123;USER:remote_user&#125; \\[%&#123;HTTPDATE:timestamp&#125;\\] \\&quot;%&#123;WORD:verb&#125; %&#123;URIPATHPARAM:request&#125; HTTP/%&#123;NUMBER:httpversion&#125;\\&quot; %&#123;INT:http_status&#125; %&#123;INT:body_bytes_sent&#125; \\&quot;%&#123;NOTSPACE:referrer&#125;\\&quot; \\&quot;%&#123;GREEDYDATA:agent&#125;\\&quot; %&#123;QUOTEDSTRING:x_forwarded_for&#125;# è§£é‡Šæ¯ä¸ªéƒ¨åˆ†çš„ä½œç”¨ï¼š# %&#123;IP:client_ip&#125;ï¼šåŒ¹é…å®¢æˆ·ç«¯ IP åœ°å€ã€‚# -ï¼šåŒ¹é…ä¸€ä¸ªç ´æŠ˜å·ï¼ˆ-ï¼‰ï¼Œè¡¨ç¤ºåŒ¿åç”¨æˆ·æˆ–æœªè®¤è¯ç”¨æˆ·ã€‚# %&#123;USER:remote_user&#125;ï¼šåŒ¹é…è¿œç¨‹ç”¨æˆ·åï¼Œ - è¡¨ç¤ºåŒ¿åç”¨æˆ·ã€‚# \\[%&#123;HTTPDATE:timestamp&#125;\\]ï¼šåŒ¹é…è¯·æ±‚çš„æ—¶é—´æˆ³ï¼Œæ ¼å¼ä¸º [27/Mar/2025:03:05:36 +0000]ã€‚# \\&quot;%&#123;WORD:verb&#125; : åŒ¹é…è¯·æ±‚æ–¹æ³• (GET)# %&#123;URIPATHPARAM:request&#125; : åŒ¹é…è¯·æ±‚è·¯å¾„ (/_cluster/stats)# HTTP/%&#123;NUMBER:httpversion&#125;\\\\\\&quot;ï¼šåŒ¹é… HTTP ç‰ˆæœ¬ (HTTP/1.1)ã€‚# %&#123;INT:http_status&#125;ï¼šåŒ¹é… HTTP å“åº”çŠ¶æ€ç  (200)ã€‚# %&#123;INT:body_bytes_sent&#125;ï¼šåŒ¹é…å“åº”ä½“çš„å­—èŠ‚æ•° (7446)ã€‚# \\&quot;%&#123;NOTSPACE:referrer&#125;\\&quot;ï¼šåŒ¹é…å¼•ç”¨é¡µ (Referer) å­—æ®µï¼Œè¿™é‡Œä¸ºç©º (&quot;-&quot;)ã€‚# \\&quot;%&#123;GREEDYDATA:agent&#125;\\&quot;ï¼šåŒ¹é…ç”¨æˆ·ä»£ç† (User-Agent) å­—æ®µã€‚GREEDYDATA ä¼šåŒ¹é…å°½å¯èƒ½å¤šçš„æ•°æ®ï¼Œç›´åˆ°é‡åˆ°ä¸‹ä¸€ä¸ªåˆ†éš”ç¬¦ã€‚# %&#123;QUOTEDSTRING:x_forwarded_for&#125;ï¼šåŒ¹é… X-Forwarded-For å¤´å­—æ®µï¼Œè¿™é‡Œä¸ºç©º (&quot;-&quot;)ã€‚# åŒ¹é…ç»“æœ&#123; &quot;request&quot;: &quot;/_cluster/stats&quot;, &quot;agent&quot;: &quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/134.0.0.0 Safari/537.36&quot;, &quot;body_bytes_sent&quot;: &quot;7446&quot;, &quot;verb&quot;: &quot;GET&quot;, &quot;x_forwarded_for&quot;: &quot;\\&quot;-\\&quot;&quot;, &quot;remote_user&quot;: &quot;elastic&quot;, &quot;referrer&quot;: &quot;-&quot;, &quot;client_ip&quot;: &quot;1.119.161.30&quot;, &quot;httpversion&quot;: &quot;1.1&quot;, &quot;http_status&quot;: &quot;200&quot;, &quot;timestamp&quot;: &quot;27/Mar/2025:03:05:36 +0000&quot;&#125; åŒ¹é…Grokæ¨¡å¼æ˜¯ä¸ªéå¸¸ç¹ççš„è¿‡ç¨‹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨Kibanaæ¥è¿›è¡Œå¯è§†åŒ–çš„Grokè°ƒè¯• groké…ç½® 12345grok &#123; match =&gt; &#123; &quot;message&quot; =&gt; &quot;%&#123;IP:client_ip&#125; - %&#123;USER:remote_user&#125; \\[%&#123;HTTPDATE:timestamp&#125;\\] \\&quot;%&#123;WORD:verb&#125; %&#123;URIPATHPARAM:request&#125; HTTP/%&#123;NUMBER:httpversion&#125;\\&quot; %&#123;INT:http_status&#125; %&#123;INT:body_bytes_sent&#125; \\&quot;%&#123;NOTSPACE:referrer&#125;\\&quot; \\&quot;%&#123;GREEDYDATA:agent&#125;\\&quot; %&#123;QUOTEDSTRING:x_forwarded_for&#125;&quot; &#125;&#125; ä½¿ç”¨mutateæ’ä»¶è¿‡æ»¤æ‰ä¸éœ€è¦çš„å­—æ®µ é™¤äº†nginxæ—¥å¿—æœ¬èº«çš„æ ¼å¼å¤–ï¼Œlogstashè¿˜ä¼šæ‰“å°è®¸å¤šæˆ‘ä»¬ä¸éœ€è¦çš„å­—æ®µï¼Œæ­¤æ—¶å¯ä»¥ä½¿ç”¨mutateæ’ä»¶æ¥è¿‡æ»¤æ‰ä¸éœ€è¦çš„å­—æ®µã€‚ 1234mutate &#123; enable_metric =&gt; &quot;false&quot; # ç¦ç”¨æŒ‡æ ‡ä¸ŠæŠ¥ remove_field =&gt; [&quot;message&quot;, &quot;log&quot;, &quot;tags&quot;, &quot;input&quot;, &quot;agent&quot;, &quot;host&quot;, &quot;ecs&quot;, &quot;@version&quot;] # ç§»é™¤ä¸éœ€è¦çš„å­—æ®µ&#125; ä½¿ç”¨Dateæ’ä»¶å¯¹æ—¶é—´è¿›è¡Œæ ¼å¼è½¬æ¢ 1234date &#123; match =&gt; [&quot;timestamp&quot;,&quot;dd/MMM/yyyy:HH:mm:ss Z&quot;,&quot;yyyy-MM-dd HH:mm:ss&quot;] # æ—¶é—´æ ¼å¼è½¬æ¢ target =&gt; &quot;timestamp&quot; # ç›®æ ‡å­—æ®µ&#125; å®Œæ•´çš„Logstashé…ç½® 1234567891011121314151617181920212223242526272829303132# è¿›å…¥logstashå®‰è£…ç›®å½•# vim config/logstsh-nginx.conf# é…ç½®ä»FileBeatæ¥æ”¶æ•°æ®input &#123; # è¾“å…¥æºé…ç½® beats &#123; # ä»FileBeatæ¥æ”¶æ•°æ® port =&gt; 5044 # ç›‘å¬5044ç«¯å£ &#125;&#125;filter &#123; # è¿‡æ»¤å™¨é…ç½® grok &#123; match =&gt; &#123; &quot;message&quot; =&gt; &quot;%&#123;IP:client_ip&#125; - %&#123;USER:remote_user&#125; \\[%&#123;HTTPDATE:timestamp&#125;\\] \\&quot;%&#123;WORD:verb&#125; %&#123;URIPATHPARAM:request&#125; HTTP/%&#123;NUMBER:httpversion&#125;\\&quot; %&#123;INT:http_status&#125; %&#123;INT:body_bytes_sent&#125; \\&quot;%&#123;NOTSPACE:referrer&#125;\\&quot; \\&quot;%&#123;GREEDYDATA:agent&#125;\\&quot; %&#123;QUOTEDSTRING:x_forwarded_for&#125;&quot; &#125; &#125; mutate &#123; enable_metric =&gt; &quot;false&quot; # ç¦ç”¨æŒ‡æ ‡ä¸ŠæŠ¥ remove_field =&gt; [&quot;message&quot;, &quot;log&quot;, &quot;tags&quot;, &quot;input&quot;, &quot;agent&quot;, &quot;host&quot;, &quot;ecs&quot;, &quot;@version&quot;] # ç§»é™¤ä¸éœ€è¦çš„å­—æ®µ &#125; date &#123; match =&gt; [&quot;timestamp&quot;,&quot;dd/MMM/yyyy:HH:mm:ss Z&quot;,&quot;yyyy-MM-dd HH:mm:ss&quot;] # æ—¶é—´æ ¼å¼è½¬æ¢ target =&gt; &quot;timestamp&quot; # ç›®æ ‡å­—æ®µ &#125;&#125;output &#123; # è¾“å‡ºé…ç½® stdout &#123; # æ‰“å°åˆ°æ§åˆ¶å° codec =&gt; rubydebug # æŒ‡å®šç¼–ç å™¨ &#125;&#125; é‡æ–°å¯åŠ¨logstashåå¾—åˆ°å¦‚ä¸‹ç»“æœï¼š 12345678910111213141516&#123; &quot;event&quot; =&gt; &#123; &quot;original&quot; =&gt; &quot;1.119.161.30 - elastic [27/Mar/2025:09:49:41 +0000] \\&quot;GET /_cluster/stats HTTP/1.1\\&quot; 200 7445 \\&quot;-\\&quot; \\&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/134.0.0.0 Safari/537.36\\&quot; \\&quot;-\\&quot;&quot; &#125;, &quot;client_ip&quot; =&gt; &quot;1.119.161.30&quot;, &quot;request&quot; =&gt; &quot;/_cluster/stats&quot;, &quot;http_status&quot; =&gt; &quot;200&quot;, &quot;@timestamp&quot; =&gt; 2025-03-27T09:49:45.751Z, &quot;body_bytes_sent&quot; =&gt; &quot;7445&quot;, &quot;x_forwarded_for&quot; =&gt; &quot;\\&quot;-\\&quot;&quot;, &quot;timestamp&quot; =&gt; 2025-03-27T09:49:41.000Z, &quot;referrer&quot; =&gt; &quot;-&quot;, &quot;remote_user&quot; =&gt; &quot;elastic&quot;, &quot;httpversion&quot; =&gt; &quot;1.1&quot;, &quot;verb&quot; =&gt; &quot;GET&quot;&#125; å°†ç»“æœè¾“å‡ºåˆ°ES 1234567891011121314# åœ¨è¾“å‡ºé…ç½®ä¸­æ·»åŠ ESè¾“å‡ºé…ç½®output &#123; # è¾“å‡ºé…ç½® stdout &#123; # æ‰“å°åˆ°æ§åˆ¶å° codec =&gt; rubydebug # æŒ‡å®šç¼–ç å™¨ &#125; elasticsearch &#123; # è¾“å‡ºåˆ°ES index =&gt; &quot;nginx_access_log_%&#123;+YYYY-MM&#125;&quot; # ç´¢å¼•å,æŒ‰æœˆåˆ†éš” hosts =&gt; [&quot;https://10.250.0.239:9200&quot;] # ESåœ°å€ user =&gt; &quot;elastic&quot; # ESç”¨æˆ·å password =&gt; &quot;123456&quot; # ESå¯†ç  ssl =&gt; true # æ˜¯å¦å¯ç”¨SSLï¼Œå› ä¸ºè¿™é‡Œæ˜¯httpsè®¿é—®ES ssl_certificate_verification =&gt; false # ç¦ç”¨è¯ä¹¦éªŒè¯ &#125;&#125; å¦‚æœéœ€è¦å¼€å¯è¯ä¹¦æ ¡éªŒï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹æ³•è¿›è¡Œé…ç½® è·å– Elasticsearch çš„ SSL è¯ä¹¦ï¼š 12# ä» Elasticsearch çš„é…ç½®æ–‡ä»¶æˆ–è¯ä¹¦æ–‡ä»¶è·¯å¾„ä¸­è·å–è¯ä¹¦ï¼ˆé€šå¸¸æ˜¯ .pem æˆ– .crt æ–‡ä»¶ï¼‰ã€‚/usr/local/elasticsearch/elasticsearch-8.17.3/config/certs/http_ca.crt å¯¼å…¥è¯ä¹¦åˆ° Java ä¿¡ä»»åº“ï¼šæ³¨æ„è¿™é‡Œè¦å¯¼å…¥åˆ°å¯åŠ¨Logstashçš„JAVAè¿›ç¨‹çš„ä¿¡ä»»åº“ 1234567891011121314151617181920212223242526272829303132333435363738394041424344# logstashçš„jdkè·¯å¾„ï¼Œé»˜è®¤åœ¨logstashçš„å®‰è£…ç›®å½•ä¸‹cd /usr/local/logstash/logstash-8.17.3/jdkbin/keytool -importcert -alias es-cert -keystore /usr/local/logstash/logstash-8.17.3/logstash.keystore -file /usr/local/elasticsearch/elasticsearch-8.17.3/config/certs/http_ca.crt# è¾“å‡ºEnter keystore password: # è¾“å…¥å¯†ç  è¿™é‡Œæ˜¯123456Re-enter new password:Owner: CN=Elasticsearch security auto-configuration HTTP CAIssuer: CN=Elasticsearch security auto-configuration HTTP CASerial number: 89d5c501a2efd5d45a6ee5e08daa16bd605d8c28Valid from: Thu Mar 20 08:53:26 UTC 2025 until: Sun Mar 19 08:53:26 UTC 2028Certificate fingerprints: SHA1: DE:73:0C:EC:46:59:69:83:52:7C:C4:CC:6B:65:EC:B6:31:BE:10:22 SHA256: 3F:14:1C:16:DF:C6:E1:65:89:4B:C1:67:20:84:B2:20:DC:DD:22:FF:E0:21:16:D5:1A:C1:80:03:CF:AA:5A:1DSignature algorithm name: SHA256withRSASubject Public Key Algorithm: 4096-bit RSA keyVersion: 3Extensions:#1: ObjectId: 2.5.29.35 Criticality=falseAuthorityKeyIdentifier [KeyIdentifier [0000: 25 EF BA 81 AE 5E 14 1C 7E FF A1 87 12 F8 D0 2E %....^..........0010: 3A D7 54 5F :.T_]]#2: ObjectId: 2.5.29.19 Criticality=trueBasicConstraints:[CA:truePathLen: no limit]#3: ObjectId: 2.5.29.14 Criticality=falseSubjectKeyIdentifier [KeyIdentifier [0000: 25 EF BA 81 AE 5E 14 1C 7E FF A1 87 12 F8 D0 2E %....^..........0010: 3A D7 54 5F :.T_]]Trust this certificate? [no]: yes # yesç¡®è®¤Certificate was added to keystore é…ç½® Logstash ä½¿ç”¨ä¿¡ä»»åº“ 123456789101112output &#123; elasticsearch &#123; index =&gt; &quot;nginx_access_log_%&#123;+YYYY-MM&#125;&quot; # ç´¢å¼•å,æŒ‰æœˆåˆ†éš” hosts =&gt; [&quot;https://10.250.0.239:9200&quot;] # ESåœ°å€ user =&gt; &quot;elastic&quot; # ESç”¨æˆ·å password =&gt; &quot;123456&quot; # ESå¯†ç  ssl =&gt; true # æ˜¯å¦å¯ç”¨SSLï¼Œå› ä¸ºè¿™é‡Œæ˜¯httpsè®¿é—®ES ssl_certificate_verification =&gt; true # å¯ç”¨è¯ä¹¦æ ¡éªŒ ssl_truststore_path =&gt; &quot;/usr/local/logstash/logstash-8.17.3/logstash.keystore&quot; # æŒ‡å®šä¿¡ä»»åº“è·¯å¾„ ssl_truststore_password =&gt; &quot;123456&quot; # ä¿¡ä»»åº“å¯†ç  &#125;&#125; æ•´åˆæ¶ˆæ¯é˜Ÿåˆ—+Nginxçš„ELKæ¶æ„ æ¶ˆæ¯é˜Ÿåˆ—ï¼šå¼•å…¥æ¶ˆæ¯é˜Ÿåˆ—ä½œä¸ºç¼“å†²æœºåˆ¶ï¼Œç¡®ä¿å³ä½¿åœ¨Logstashæˆ–Elasticsearchå‡ºç°æ•…éšœæ—¶ï¼Œæ—¥å¿—æ•°æ®ä¹Ÿä¸ä¼šä¸¢å¤±ã€‚æ¶ˆæ¯é˜Ÿåˆ—èƒ½å¤Ÿå‡è¡¡ç½‘ç»œä¼ è¾“ï¼Œé™ä½æ•°æ®ä¸¢å¤±çš„å¯èƒ½æ€§ã€‚ Nginxï¼šNginxä½œä¸ºé«˜æ€§èƒ½çš„Webå’Œåå‘ä»£ç†æœåŠ¡å™¨ï¼Œå¯ä»¥è¿›ä¸€æ­¥ä¼˜åŒ–æ•´ä¸ªç³»ç»Ÿçš„æ€§èƒ½å’Œå¯ç”¨æ€§ã€‚å®ƒå¯ä»¥åœ¨è´Ÿè½½å‡è¡¡ã€ç¼“å­˜ç­‰æ–¹é¢å‘æŒ¥ä½œç”¨ï¼Œæå‡ç”¨æˆ·è®¿é—®ä½“éªŒã€‚ æ‰©å±•æ€§ï¼šç”±äºå¼•å…¥äº†æ¶ˆæ¯é˜Ÿåˆ—å’ŒNginxç­‰ç»„ä»¶ï¼Œæ•´ä¸ªæ¶æ„çš„æ‰©å±•æ€§å¾—åˆ°å¢å¼ºã€‚å¯ä»¥æ ¹æ®å®é™…éœ€æ±‚åŠ¨æ€è°ƒæ•´å„ç»„ä»¶çš„èµ„æºåˆ†é…å’Œéƒ¨ç½²è§„æ¨¡ã€‚ é€‚ç”¨åœºæ™¯ï¼šæ•´åˆæ¶ˆæ¯é˜Ÿåˆ—+Nginxçš„æ¶æ„ä¸»è¦é€‚ç”¨äºç”Ÿäº§ç¯å¢ƒï¼Œç‰¹åˆ«æ˜¯éœ€è¦å¤„ç†å¤§æ•°æ®é‡çš„åœºæ™¯ã€‚å®ƒèƒ½å¤Ÿç¡®ä¿æ•°æ®çš„å®‰å…¨æ€§å’Œå®Œæ•´æ€§ï¼ŒåŒæ—¶æä¾›é«˜æ€§èƒ½çš„æ—¥å¿—å¤„ç†å’Œå¯è§†åŒ–åˆ†ææœåŠ¡ã€‚ æ€»ç»“æ¥è¯´å°±æ˜¯ filebeatå°†é‡‡é›†çš„æ—¥å¿—å‘é€åˆ°Redis\\RabbitMQ\\Kafkaç­‰ Logstashå†ä»Redis\\RabbitMQ\\Kafkaä¸­è¯»å–æ—¥å¿—æ•°æ®ï¼Œå¹¶è¿›è¡Œè§£æåå‘é€åˆ°ESä¸­ã€‚ ESé›†ç¾¤ä½¿ç”¨nginxè¿›è¡Œè´Ÿè½½å‡è¡¡ï¼Œä»¥å®ç°é«˜å¯ç”¨å’Œé«˜æ€§èƒ½ã€‚å…·ä½“å®ç°æ–¹æ³•æŸ¥çœ‹ï¼šlinuxä¸‹å®‰è£…Elasticsearché›†ç¾¤ åŸºäºRedisçš„ELKæ¶æ„ç¤ºä¾‹ filebeatå°†é‡‡é›†çš„æ—¥å¿—å‘é€åˆ°Redis åˆ›å»ºé…ç½®æ–‡ä»¶filebeat-nginx-to-redis.ymlï¼Œå°†å…¶ä¿å­˜åˆ°Filebeatå®‰è£…ç›®å½•ä¸‹çš„confç›®å½•ä¸‹ã€‚ 1234567891011121314151617181920212223242526# å› ä¸ºNginxçš„access.logæ—¥å¿—éƒ½æ˜¯ä»¥IPåœ°å€å¼€å¤´çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¿®æ”¹ä¸‹åŒ¹é…å­—æ®µã€‚# ä¸ä»¥ipåœ°å€å¼€å¤´çš„è¡Œè¿½åŠ åˆ°ä¸Šä¸€è¡Œfilebeat.inputs: # è¾“å…¥æºé…ç½®- type: log # æ—¥å¿—ç±»å‹ enabled: true # æ˜¯å¦å¯ç”¨ paths: # é‡‡é›†è·¯å¾„ - /var/log/nginx/access*.* exclude_files: [&quot;.gz$&quot;] # æ’é™¤ä»¥.gz ç»“å°¾çš„æ–‡ä»¶ multiline.pattern: &#x27;^\\\\d&#123;1,3&#125;\\\\.\\\\d&#123;1,3&#125;\\\\.\\\\d&#123;1,3&#125;\\\\.\\\\d&#123;1,3&#125;\\\\s&#x27; # åŒ¹é…ä»¥IPåœ°å€å¼€å¤´ï¼Œå¹¶ç´§è·Ÿä¸€ä¸ªç©ºç™½å­—ç¬¦ multiline.negate: true # ä¸ä»¥ipåœ°å€å¼€å¤´çš„è¡Œè¿½åŠ åˆ°ä¸Šä¸€è¡Œ multiline.match: after # è¿½åŠ åˆ°ä¸Šä¸€è¡Œçš„åé¢ # multiline: å¤šè¡Œæ—¥å¿—é…ç½®ï¼Œè¿™é‡Œå®é™…ä¸Šä¸éœ€è¦é…ç½®å¤šè¡Œè®¾ç½®ï¼Œå› ä¸ºnginxçš„accessæ—¥å¿—éƒ½æ˜¯å•è¡Œæ—¥å¿—ï¼Œè¿™é‡Œåªåšæ¼”ç¤º # pattern: æ­£åˆ™è¡¨è¾¾å¼ # negate: falseï¼ŒåŒ¹é…patternçš„è¡Œåˆå¹¶åˆ°ä¸Šä¸€è¡Œï¼›trueï¼Œä¸åŒ¹é…patternçš„è¡Œåˆå¹¶åˆ°ä¸Šä¸€è¡Œ # match: afterï¼Œåˆå¹¶åˆ°ä¸Šä¸€è¡Œçš„æœ«å°¾ï¼›beforeï¼Œåˆå¹¶åˆ°ä¸Šä¸€è¡Œçš„å¼€å¤´ scan_frequency: 10s # æ¯ 10 ç§’æ‰«æä¸€æ¬¡æ—¥å¿—æ–‡ä»¶ clean_removed: true # åœ¨æ—¥å¿—æ–‡ä»¶è¢«åˆ é™¤åæ˜¯å¦ä»å…¶å†…éƒ¨çŠ¶æ€ä¸­ç§»é™¤è¯¥æ–‡ä»¶çš„è®°å½• clean_inactive: 2h # åœ¨æ—¥å¿—æ–‡ä»¶å¤„äºéæ´»åŠ¨çŠ¶æ€å¤šé•¿æ—¶é—´åå°†å…¶ä»çŠ¶æ€æ•°æ®åº“ä¸­ç§»,è®¾ç½®ä¸ºæ¯” ignore_older + scan_frequency æ›´å¤§çš„å€¼ ignore_older: 1h # å¿½ç•¥é‚£äº›æ¯”å½“å‰æ—¶é—´æ—©äº 1 å°æ—¶çš„æ—¥å¿—æ–‡ä»¶output.redis: # Redisè¾“å‡ºé…ç½® hosts: [&quot;10.250.0.214:6379&quot;] # RedisæœåŠ¡å™¨åœ°å€ password: &quot;123456&quot; # Rediså¯†ç  key: &quot;filebeat_nginx&quot; # Redisçš„keyï¼Œç±»å‹ä¸º list db: 3 # Redisæ•°æ®åº“ timeout: 3 # Redisè¿æ¥è¶…æ—¶æ—¶é—´ï¼Œå•ä½ç§’ å¯åŠ¨Filebeatï¼Œå¹¶æŸ¥çœ‹æ—¥å¿—è¾“å‡ºã€‚ 1./filebeat -e -c conf/filebeat-nginx-to-redis.yml æŸ¥çœ‹Redisä¸­çš„æ•°æ® 1234567891011$ redis-cli -h 10.250.0.214 -p 6379 -a 12345610.250.0.214:6379&gt; select 3OK10.250.0.214:6379[3]&gt; keys filebeat*1) &quot;filebeat_nginx&quot;10.250.0.214:6379[3]&gt; type filebeat_nginxlist10.250.0.214:6379[3]&gt; LLEN filebeat_nginx(integer) 1410.250.0.214:6379[3]&gt; LINDEX filebeat_nginx 1&quot;&#123;\\&quot;@timestamp\\&quot;:\\&quot;2025-03-28T09:15:23.402Z\\&quot;,\\&quot;@metadata\\&quot;:&#123;\\&quot;beat\\&quot;:\\&quot;filebeat\\&quot;,\\&quot;type\\&quot;:\\&quot;_doc\\&quot;,\\&quot;version\\&quot;:\\&quot;8.17.3\\&quot;&#125;,\\&quot;host\\&quot;:&#123;\\&quot;name\\&quot;:\\&quot;ip-10-250-0-239.cn-northwest-1.compute.internal\\&quot;&#125;,\\&quot;agent\\&quot;:&#123;\\&quot;version\\&quot;:\\&quot;8.17.3\\&quot;,\\&quot;ephemeral_id\\&quot;:\\&quot;c0a521fe-690b-46b1-aadc-bbe16ef1db9a\\&quot;,\\&quot;id\\&quot;:\\&quot;4dbe185b-900d-4990-b841-c13bf9618fc6\\&quot;,\\&quot;name\\&quot;:\\&quot;ip-10-250-0-239.cn-northwest-1.compute.internal\\&quot;,\\&quot;type\\&quot;:\\&quot;filebeat\\&quot;&#125;,\\&quot;log\\&quot;:&#123;\\&quot;offset\\&quot;:46745,\\&quot;file\\&quot;:&#123;\\&quot;path\\&quot;:\\&quot;/var/log/nginx/access.log\\&quot;&#125;&#125;,\\&quot;message\\&quot;:\\&quot;1.119.161.30 - elastic [28/Mar/2025:09:15:13 +0000] \\\\\\&quot;GET /_cluster/stats HTTP/1.1\\\\\\&quot; 200 7457 \\\\\\&quot;-\\\\\\&quot; \\\\\\&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/134.0.0.0 Safari/537.36\\\\\\&quot; \\\\\\&quot;-\\\\\\&quot;\\&quot;,\\&quot;input\\&quot;:&#123;\\&quot;type\\&quot;:\\&quot;log\\&quot;&#125;,\\&quot;ecs\\&quot;:&#123;\\&quot;version\\&quot;:\\&quot;8.0.0\\&quot;&#125;&#125;&quot; Logstashä»Redisä¸­è¯»å–æ—¥å¿—å¹¶å†™å…¥Elasticsearch åˆ›å»ºé…ç½®æ–‡ä»¶logstash-nginx-redis-to-es.confï¼Œå°†å…¶ä¿å­˜åˆ°Logstashå®‰è£…ç›®å½•ä¸‹çš„confç›®å½•ä¸‹ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546# è¿›å…¥logstashå®‰è£…ç›®å½•# vim logstash-nginx-redis-to-es.conf# é…ç½®ä» redis æ¥æ”¶æ•°æ®input &#123; # è¾“å…¥æºé…ç½® redis &#123; # Redisè¾“å…¥é…ç½® host =&gt; &#x27;10.250.0.214&#x27; # RedisæœåŠ¡å™¨åœ°å€ port =&gt; &quot;6379&quot; # RedisæœåŠ¡å™¨ç«¯å£ password =&gt; &quot;123456&quot; # Rediså¯†ç  db =&gt; &quot;3&quot; # Redisæ•°æ®åº“ data_type =&gt; &#x27;list&#x27; # æ•°æ®ç±»å‹ä¸ºlist key =&gt; &quot;filebeat_nginx&quot; # Redisçš„key &#125;&#125;filter &#123; # è¿‡æ»¤å™¨é…ç½® grok &#123; match =&gt; &#123; &quot;message&quot; =&gt; &quot;%&#123;IP:client_ip&#125; - %&#123;USER:remote_user&#125; \\[%&#123;HTTPDATE:timestamp&#125;\\] \\&quot;%&#123;WORD:verb&#125; %&#123;URIPATHPARAM:request&#125; HTTP/%&#123;NUMBER:httpversion&#125;\\&quot; %&#123;INT:http_status&#125; %&#123;INT:body_bytes_sent&#125; \\&quot;%&#123;NOTSPACE:referrer&#125;\\&quot; \\&quot;%&#123;GREEDYDATA:agent&#125;\\&quot; %&#123;QUOTEDSTRING:x_forwarded_for&#125;&quot; &#125; &#125; mutate &#123; enable_metric =&gt; &quot;false&quot; # ç¦ç”¨æŒ‡æ ‡ä¸ŠæŠ¥ remove_field =&gt; [&quot;message&quot;, &quot;log&quot;, &quot;tags&quot;, &quot;input&quot;, &quot;agent&quot;, &quot;host&quot;, &quot;ecs&quot;, &quot;@version&quot;] # ç§»é™¤ä¸éœ€è¦çš„å­—æ®µ &#125; date &#123; match =&gt; [&quot;timestamp&quot;,&quot;dd/MMM/yyyy:HH:mm:ss Z&quot;,&quot;yyyy-MM-dd HH:mm:ss&quot;] # æ—¶é—´æ ¼å¼è½¬æ¢ target =&gt; &quot;timestamp&quot; # ç›®æ ‡å­—æ®µ &#125;&#125;# åœ¨è¾“å‡ºé…ç½®ä¸­æ·»åŠ ESè¾“å‡ºé…ç½®output &#123; # è¾“å‡ºé…ç½® stdout &#123; # æ‰“å°åˆ°æ§åˆ¶å° codec =&gt; rubydebug # æŒ‡å®šç¼–ç å™¨ &#125; elasticsearch &#123; # è¾“å‡ºåˆ°ES index =&gt; &quot;redis_nginx_access_log_%&#123;+YYYY-MM&#125;&quot; # ç´¢å¼•å,æŒ‰æœˆåˆ†éš” hosts =&gt; [&quot;https://10.250.0.239:9200&quot;] # ESåœ°å€ user =&gt; &quot;elastic&quot; # ESç”¨æˆ·å password =&gt; &quot;123456&quot; # ESå¯†ç  ssl =&gt; true # æ˜¯å¦å¯ç”¨SSLï¼Œå› ä¸ºè¿™é‡Œæ˜¯httpsè®¿é—®ES ssl_certificate_verification =&gt; false # ç¦ç”¨è¯ä¹¦éªŒè¯ &#125;&#125; æµ‹è¯•logstashé…ç½®æ˜¯å¦æ­£ç¡® 1bin/logstash -f config/logstash-nginx-redis-to-es.conf --config.test_and_exit å¯åŠ¨logstash 12# reload.automaticï¼šä¿®æ”¹é…ç½®æ–‡ä»¶æ—¶è‡ªåŠ¨é‡æ–°åŠ è½½bin/logstash -f config/logstash-nginx-redis-to-es.conf --config.reload.automatic","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç»å¦‚ä½•åœ¨linuxä¸‹å®‰è£…LogStashå’ŒFileBeat é€šè¿‡ç¤ºä¾‹è®²è§£ELKçš„ç»å…¸æ¶æ„å’Œé«˜å¹¶å‘æ¶æ„çš„å®ç°è¿‡ç¨‹ LogStashç‰ˆæœ¬8.17.3ï¼ŒFileBeatç‰ˆæœ¬8.17.3 Elasticsearchç‰ˆæœ¬8.17.3ï¼Œlinuxä¸‹å®‰è£…Elasticsearch Kibanaç‰ˆæœ¬8.17.3ï¼Œlinuxä¸‹å®‰è£…Kibana Elasticsearché›†ç¾¤æ­å»ºï¼Œlinuxä¸‹å®‰è£…Elasticsearché›†ç¾¤","date_published":"2025-03-27T13:30:05.000Z","tags":["æŠ€æœ¯","elastic","kibana","logstash","elasticsearch","kibana","logstash"]},{"id":"https://blog.hanqunfeng.com/2025/03/25/elasticsearch-03-plugins/","url":"https://blog.hanqunfeng.com/2025/03/25/elasticsearch-03-plugins/","title":"linuxä¸‹Elasticsearchæ’ä»¶å®‰è£…","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç»å¦‚ä½•åœ¨linuxä¸ºElasticsearchå®‰è£…æ’ä»¶</p>\n</li>\n<li class=\"lvl-2\">\n<p>Elasticsearchç‰ˆæœ¬8.17.3</p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"å®‰è£…Elasticsearchæ ¸å¿ƒåº“æ’ä»¶\">å®‰è£…Elasticsearchæ ¸å¿ƒåº“æ’ä»¶</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä»¥å®‰è£… <code>analysis-icu</code> è¿™ä¸ªåˆ†è¯æ’ä»¶ä¸ºä¾‹</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># è¿›å…¥Elasticsearchå®‰è£…ç›®å½•ï¼Œæ’ä»¶çš„å®‰è£…è·¯å¾„åœ¨ plugins ç›®å½•ä¸‹</span></span><br><span class=\"line\"><span class=\"comment\"># å®‰è£…æ’ä»¶</span></span><br><span class=\"line\">bin/elasticsearch-plugin install analysis-icu</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å®‰è£…æˆ–å¸è½½æ’ä»¶åï¼Œéœ€è¦é‡å¯ElasticsearchæœåŠ¡</p>\n</li>\n</ul>\n<h2 id=\"å®‰è£…å…¶å®ƒæ¥æºçš„æ’ä»¶\">å®‰è£…å…¶å®ƒæ¥æºçš„æ’ä»¶</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä»¥å®‰è£… <code>analysis-ik</code> è¿™ä¸ªä¸­æ–‡åˆ†è¯æ’ä»¶ä¸ºä¾‹</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä»<a href=\"https://release.infinilabs.com/analysis-ik/stable/\">https://release.infinilabs.com/analysis-ik/stable/</a>æ‰¾åˆ°å¯¹åº”ç‰ˆæœ¬çš„æ’ä»¶è¿æ¥ï¼Œè¿™é‡Œä»¥<code>8.17.3</code>ä¸ºä¾‹</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 1.åŸºäºurlå®‰è£…æ’ä»¶</span></span><br><span class=\"line\">bin/elasticsearch-plugin install https://release.infinilabs.com/analysis-ik/stable/elasticsearch-analysis-ik-8.17.3.zip</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 2.åŸºäºæœ¬åœ°æ–‡ä»¶å®‰è£…æ’ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆå°†æ’ä»¶ä¸‹è½½çš„æœ¬åœ°ç›®å½•</span></span><br><span class=\"line\">wget https://release.infinilabs.com/analysis-ik/stable/elasticsearch-analysis-ik-8.17.3.zip -P /tmp/</span><br><span class=\"line\">bin/elasticsearch-plugin install file:///tmp/elasticsearch-analysis-ik-8.17.3.zip</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 3.å¯ä»¥å°†ä¸‹è½½å¥½çš„åŒ…è§£å‹åˆ°pluginsç›®å½•ä¸‹ï¼Œç„¶åé‡å¯ElasticsearchæœåŠ¡</span></span><br><span class=\"line\"><span class=\"built_in\">mkdir</span> /usr/local/elasticsearch/elasticsearch-8.17.3/plugins/analysis-ik</span><br><span class=\"line\">unzip elasticsearch-analysis-ik-8.17.3.zip -d /usr/local/elasticsearch/elasticsearch-8.17.3/plugins/analysis-ik</span><br></pre></td></tr></table></figure>\n<h2 id=\"æŸ¥çœ‹å’Œå¸è½½æ’ä»¶\">æŸ¥çœ‹å’Œå¸è½½æ’ä»¶</h2>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åˆ—å‡ºæ‰€æœ‰æ’ä»¶</span></span><br><span class=\"line\">bin/elasticsearch-plugin list</span><br><span class=\"line\"><span class=\"comment\"># å¸è½½æ’ä»¶</span></span><br><span class=\"line\">bin/elasticsearch-plugin remove analysis-ik</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># é€šè¿‡curlå‘½ä»¤æŸ¥çœ‹æ’ä»¶ä¿¡æ¯</span></span><br><span class=\"line\">curl -u elastic:123456 -k https://localhost:9200/_cat/plugins?v</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å®‰è£…æˆ–å¸è½½æ’ä»¶åï¼Œéœ€è¦é‡å¯ElasticsearchæœåŠ¡</p>\n</li>\n</ul>\n<h2 id=\"analysis-ik-ä¸­æ–‡åˆ†è¯æ’ä»¶çš„ä½¿ç”¨\"><code>analysis-ik</code> ä¸­æ–‡åˆ†è¯æ’ä»¶çš„ä½¿ç”¨</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æµ‹è¯•åˆ†è¯æ•ˆæœ</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#ESçš„é»˜è®¤åˆ†è¯å™¨æ˜¯standardï¼Œä¼šå•å­—æ‹†åˆ†</span></span><br><span class=\"line\">POST _analyze</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;analyzer&quot;</span>: <span class=\"string\">&quot;standard&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;text&quot;</span>: <span class=\"string\">&quot;ä¸­åäººæ°‘å…±å’Œå›½&quot;</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#analysis-ikçš„ik_smartåˆ†è¯å™¨:ä¼šåšæœ€ç²—ç²’åº¦çš„æ‹†</span></span><br><span class=\"line\">POST _analyze</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;analyzer&quot;</span>: <span class=\"string\">&quot;ik_smart&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;text&quot;</span>: <span class=\"string\">&quot;ä¸­åäººæ°‘å…±å’Œå›½&quot;</span></span><br><span class=\"line\"> &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#analysis-ikçš„ik_max_wordåˆ†è¯å™¨:ä¼šå°†æ–‡æœ¬åšæœ€ç»†ç²’åº¦çš„æ‹†åˆ†</span></span><br><span class=\"line\">POST _analyze</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;analyzer&quot;</span>: <span class=\"string\">&quot;ik_max_word&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;text&quot;</span>: <span class=\"string\">&quot;ä¸­åäººæ°‘å…±å’Œå›½&quot;</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>é…ç½®ç´¢å¼•çš„åˆ†è¯å™¨</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åˆ›å»ºç´¢å¼•ï¼Œå¹¶æŒ‡å®šé»˜è®¤åˆ†è¯å™¨ä¸ºik_max_word</span></span><br><span class=\"line\">PUT /test_index</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;settings&quot;</span> : &#123;</span><br><span class=\"line\">        <span class=\"string\">&quot;index&quot;</span> : &#123;</span><br><span class=\"line\">            <span class=\"string\">&quot;analysis.analyzer.default.type&quot;</span>: <span class=\"string\">&quot;ik_max_word&quot;</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹ç´¢å¼•settingä¿¡æ¯</span></span><br><span class=\"line\">GET /test_index/_settings</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>é…ç½®ç´¢å¼•å­—æ®µçš„åˆ†è¯å™¨</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#åˆ›å»ºç´¢å¼•</span></span><br><span class=\"line\">PUT /index</span><br><span class=\"line\"><span class=\"comment\"># æŒ‡å®šcontentå­—æ®µä½¿ç”¨ikåˆ†è¯å™¨</span></span><br><span class=\"line\">POST /index/_mapping</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">&quot;properties&quot;</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;content&quot;</span>: &#123;</span><br><span class=\"line\">      <span class=\"string\">&quot;type&quot;</span>: <span class=\"string\">&quot;text&quot;</span>,</span><br><span class=\"line\">      <span class=\"string\">&quot;analyzer&quot;</span>: <span class=\"string\">&quot;ik_max_word&quot;</span>,</span><br><span class=\"line\">      <span class=\"string\">&quot;search_analyzer&quot;</span>: <span class=\"string\">&quot;ik_smart&quot;</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#ç´¢å¼•æ–‡æ¡£ï¼Œä¹Ÿå°±æ˜¯æ’å…¥æ–‡æ¡£</span></span><br><span class=\"line\">POST /index/_create/1</span><br><span class=\"line\">&#123;<span class=\"string\">&quot;content&quot;</span>:<span class=\"string\">&quot;ç¾å›½ç•™ç»™ä¼Šæ‹‰å…‹çš„æ˜¯ä¸ªçƒ‚æ‘Šå­å—&quot;</span>&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">POST /index/_create/2</span><br><span class=\"line\">&#123;<span class=\"string\">&quot;content&quot;</span>:<span class=\"string\">&quot;å…¬å®‰éƒ¨ï¼šå„åœ°æ ¡è½¦å°†äº«æœ€é«˜è·¯æƒ&quot;</span>&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">POST /index/_create/3</span><br><span class=\"line\">&#123;<span class=\"string\">&quot;content&quot;</span>:<span class=\"string\">&quot;ä¸­éŸ©æ¸”è­¦å†²çªè°ƒæŸ¥ï¼šéŸ©è­¦å¹³å‡æ¯å¤©æ‰£1è‰˜ä¸­å›½æ¸”èˆ¹&quot;</span>&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">POST /index/_create/4</span><br><span class=\"line\">&#123;<span class=\"string\">&quot;content&quot;</span>:<span class=\"string\">&quot;ä¸­å›½é©»æ´›æ‰çŸ¶é¢†äº‹é¦†é­äºšè£”ç”·å­æªå‡» å«ŒçŠ¯å·²è‡ªé¦–&quot;</span>&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#å¸¦é«˜äº®çš„æŸ¥è¯¢</span></span><br><span class=\"line\">POST /index/_search</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">&quot;query&quot;</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;match&quot;</span>: &#123;</span><br><span class=\"line\">      <span class=\"string\">&quot;content&quot;</span>: <span class=\"string\">&quot;ä¸­å›½&quot;</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"string\">&quot;highlight&quot;</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;pre_tags&quot;</span>: [</span><br><span class=\"line\">      <span class=\"string\">&quot;&lt;tag1&gt;&quot;</span>,</span><br><span class=\"line\">      <span class=\"string\">&quot;&lt;tag2&gt;&quot;</span></span><br><span class=\"line\">    ],</span><br><span class=\"line\">    <span class=\"string\">&quot;post_tags&quot;</span>: [</span><br><span class=\"line\">      <span class=\"string\">&quot;&lt;/tag1&gt;&quot;</span>,</span><br><span class=\"line\">      <span class=\"string\">&quot;&lt;/tag2&gt;&quot;</span></span><br><span class=\"line\">    ],</span><br><span class=\"line\">    <span class=\"string\">&quot;fields&quot;</span>: &#123;</span><br><span class=\"line\">      <span class=\"string\">&quot;content&quot;</span>: &#123;&#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç»å¦‚ä½•åœ¨linuxä¸ºElasticsearchå®‰è£…æ’ä»¶ Elasticsearchç‰ˆæœ¬8.17.3 å®‰è£…Elasticsearchæ ¸å¿ƒåº“æ’ä»¶ ä»¥å®‰è£… analysis-icu è¿™ä¸ªåˆ†è¯æ’ä»¶ä¸ºä¾‹ 123# è¿›å…¥Elasticsearchå®‰è£…ç›®å½•ï¼Œæ’ä»¶çš„å®‰è£…è·¯å¾„åœ¨ plugins ç›®å½•ä¸‹# å®‰è£…æ’ä»¶bin/elasticsearch-plugin install analysis-icu å®‰è£…æˆ–å¸è½½æ’ä»¶åï¼Œéœ€è¦é‡å¯ElasticsearchæœåŠ¡ å®‰è£…å…¶å®ƒæ¥æºçš„æ’ä»¶ ä»¥å®‰è£… analysis-ik è¿™ä¸ªä¸­æ–‡åˆ†è¯æ’ä»¶ä¸ºä¾‹ ä»https://release.infinilabs.com/analysis-ik/stable/æ‰¾åˆ°å¯¹åº”ç‰ˆæœ¬çš„æ’ä»¶è¿æ¥ï¼Œè¿™é‡Œä»¥8.17.3ä¸ºä¾‹ 12345678910# 1.åŸºäºurlå®‰è£…æ’ä»¶bin/elasticsearch-plugin install https://release.infinilabs.com/analysis-ik/stable/elasticsearch-analysis-ik-8.17.3.zip# 2.åŸºäºæœ¬åœ°æ–‡ä»¶å®‰è£…æ’ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆå°†æ’ä»¶ä¸‹è½½çš„æœ¬åœ°ç›®å½•wget https://release.infinilabs.com/analysis-ik/stable/elasticsearch-analysis-ik-8.17.3.zip -P /tmp/bin/elasticsearch-plugin install file:///tmp/elasticsearch-analysis-ik-8.17.3.zip# 3.å¯ä»¥å°†ä¸‹è½½å¥½çš„åŒ…è§£å‹åˆ°pluginsç›®å½•ä¸‹ï¼Œç„¶åé‡å¯ElasticsearchæœåŠ¡mkdir /usr/local/elasticsearch/elasticsearch-8.17.3/plugins/analysis-ikunzip elasticsearch-analysis-ik-8.17.3.zip -d /usr/local/elasticsearch/elasticsearch-8.17.3/plugins/analysis-ik æŸ¥çœ‹å’Œå¸è½½æ’ä»¶ 1234567# åˆ—å‡ºæ‰€æœ‰æ’ä»¶bin/elasticsearch-plugin list# å¸è½½æ’ä»¶bin/elasticsearch-plugin remove analysis-ik# é€šè¿‡curlå‘½ä»¤æŸ¥çœ‹æ’ä»¶ä¿¡æ¯curl -u elastic:123456 -k https://localhost:9200/_cat/plugins?v å®‰è£…æˆ–å¸è½½æ’ä»¶åï¼Œéœ€è¦é‡å¯ElasticsearchæœåŠ¡ analysis-ik ä¸­æ–‡åˆ†è¯æ’ä»¶çš„ä½¿ç”¨ æµ‹è¯•åˆ†è¯æ•ˆæœ 1234567891011121314151617181920#ESçš„é»˜è®¤åˆ†è¯å™¨æ˜¯standardï¼Œä¼šå•å­—æ‹†åˆ†POST _analyze&#123; &quot;analyzer&quot;: &quot;standard&quot;, &quot;text&quot;: &quot;ä¸­åäººæ°‘å…±å’Œå›½&quot;&#125;#analysis-ikçš„ik_smartåˆ†è¯å™¨:ä¼šåšæœ€ç²—ç²’åº¦çš„æ‹†POST _analyze&#123; &quot;analyzer&quot;: &quot;ik_smart&quot;, &quot;text&quot;: &quot;ä¸­åäººæ°‘å…±å’Œå›½&quot; &#125;#analysis-ikçš„ik_max_wordåˆ†è¯å™¨:ä¼šå°†æ–‡æœ¬åšæœ€ç»†ç²’åº¦çš„æ‹†åˆ†POST _analyze&#123; &quot;analyzer&quot;: &quot;ik_max_word&quot;, &quot;text&quot;: &quot;ä¸­åäººæ°‘å…±å’Œå›½&quot;&#125; é…ç½®ç´¢å¼•çš„åˆ†è¯å™¨ 1234567891011# åˆ›å»ºç´¢å¼•ï¼Œå¹¶æŒ‡å®šé»˜è®¤åˆ†è¯å™¨ä¸ºik_max_wordPUT /test_index&#123; &quot;settings&quot; : &#123; &quot;index&quot; : &#123; &quot;analysis.analyzer.default.type&quot;: &quot;ik_max_word&quot; &#125; &#125;&#125;# æŸ¥çœ‹ç´¢å¼•settingä¿¡æ¯GET /test_index/_settings é…ç½®ç´¢å¼•å­—æ®µçš„åˆ†è¯å™¨ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849#åˆ›å»ºç´¢å¼•PUT /index# æŒ‡å®šcontentå­—æ®µä½¿ç”¨ikåˆ†è¯å™¨POST /index/_mapping&#123; &quot;properties&quot;: &#123; &quot;content&quot;: &#123; &quot;type&quot;: &quot;text&quot;, &quot;analyzer&quot;: &quot;ik_max_word&quot;, &quot;search_analyzer&quot;: &quot;ik_smart&quot; &#125; &#125;&#125;#ç´¢å¼•æ–‡æ¡£ï¼Œä¹Ÿå°±æ˜¯æ’å…¥æ–‡æ¡£POST /index/_create/1&#123;&quot;content&quot;:&quot;ç¾å›½ç•™ç»™ä¼Šæ‹‰å…‹çš„æ˜¯ä¸ªçƒ‚æ‘Šå­å—&quot;&#125;POST /index/_create/2&#123;&quot;content&quot;:&quot;å…¬å®‰éƒ¨ï¼šå„åœ°æ ¡è½¦å°†äº«æœ€é«˜è·¯æƒ&quot;&#125;POST /index/_create/3&#123;&quot;content&quot;:&quot;ä¸­éŸ©æ¸”è­¦å†²çªè°ƒæŸ¥ï¼šéŸ©è­¦å¹³å‡æ¯å¤©æ‰£1è‰˜ä¸­å›½æ¸”èˆ¹&quot;&#125;POST /index/_create/4&#123;&quot;content&quot;:&quot;ä¸­å›½é©»æ´›æ‰çŸ¶é¢†äº‹é¦†é­äºšè£”ç”·å­æªå‡» å«ŒçŠ¯å·²è‡ªé¦–&quot;&#125;#å¸¦é«˜äº®çš„æŸ¥è¯¢POST /index/_search&#123; &quot;query&quot;: &#123; &quot;match&quot;: &#123; &quot;content&quot;: &quot;ä¸­å›½&quot; &#125; &#125;, &quot;highlight&quot;: &#123; &quot;pre_tags&quot;: [ &quot;&lt;tag1&gt;&quot;, &quot;&lt;tag2&gt;&quot; ], &quot;post_tags&quot;: [ &quot;&lt;/tag1&gt;&quot;, &quot;&lt;/tag2&gt;&quot; ], &quot;fields&quot;: &#123; &quot;content&quot;: &#123;&#125; &#125; &#125;&#125;","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç»å¦‚ä½•åœ¨linuxä¸ºElasticsearchå®‰è£…æ’ä»¶ Elasticsearchç‰ˆæœ¬8.17.3","date_published":"2025-03-25T13:30:05.000Z","tags":["æŠ€æœ¯","elastic","elasticsearch","elasticsearch"]},{"id":"https://blog.hanqunfeng.com/2025/03/24/elasticsearch-02-install-cluster/","url":"https://blog.hanqunfeng.com/2025/03/24/elasticsearch-02-install-cluster/","title":"linuxä¸‹å®‰è£…Elasticsearché›†ç¾¤","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç»å¦‚ä½•åœ¨linuxä¸‹å®‰è£…Elasticsearché›†ç¾¤(ä¸‰èŠ‚ç‚¹)</p>\n</li>\n<li class=\"lvl-2\">\n<p>Elasticsearchç‰ˆæœ¬8.17.3</p>\n</li>\n<li class=\"lvl-2\">\n<p>å•èŠ‚ç‚¹å®‰è£…å‚è€ƒ<a href=\"/2025/03/20/elasticsearch-01-install/\" title=\"linuxä¸‹å®‰è£…Elasticsearch\">linuxä¸‹å®‰è£…Elasticsearch</a>ï¼Œæœ¬æ–‡åœ¨æ­¤åŸºç¡€ä¸Šå®Œæˆé›†ç¾¤å®‰è£…</p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"é›†ç¾¤å®‰è£…\">é›†ç¾¤å®‰è£…</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¸‰ä¸ªèŠ‚ç‚¹åˆ†åˆ«å®‰ç…§å•èŠ‚ç‚¹çš„å®‰è£…æ–¹å¼å®Œæˆä¸‹è½½ï¼Œç”¨æˆ·é…ç½®ï¼Œç¯å¢ƒå˜é‡é…ç½®ï¼Œç³»ç»Ÿå‚æ•°é…ç½®ï¼Œç­‰ç­‰ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä»»é€‰ä¸€ä¸ªèŠ‚ç‚¹ä½œä¸ºé›†ç¾¤çš„masterèŠ‚ç‚¹ï¼Œæˆ‘ä»¬å‘½åä¸º<code>node-1</code>ï¼Œå…¶å®ƒèŠ‚ç‚¹å‘½åä¸º<code>node-2</code>å’Œ<code>node-3</code></p>\n</li>\n<li class=\"lvl-2\">\n<p>å…ˆé…ç½®<code>node-1</code>èŠ‚ç‚¹çš„é…ç½®æ–‡ä»¶</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># é›†ç¾¤åç§°</span></span><br><span class=\"line\">cluster.name: test-elk</span><br><span class=\"line\"><span class=\"comment\"># èŠ‚ç‚¹åç§°</span></span><br><span class=\"line\">node.name: node-1</span><br><span class=\"line\"><span class=\"comment\"># æ•°æ®å­˜å‚¨è·¯å¾„ï¼Œé»˜è®¤å€¼ $ES_HOME/data</span></span><br><span class=\"line\">path.data: /usr/local/elasticsearch/data</span><br><span class=\"line\"><span class=\"comment\"># æ—¥å¿—å­˜å‚¨è·¯å¾„ï¼Œé»˜è®¤å€¼ $ES_HOME/logs</span></span><br><span class=\"line\">path.logs: /usr/local/elasticsearch/logs</span><br><span class=\"line\"><span class=\"comment\"># é…ç½®ESå¯åŠ¨æ—¶æ˜¯å¦è¿›è¡Œå†…å­˜é”å®šæ£€æŸ¥ï¼Œé»˜è®¤å€¼trueï¼Œæœ¬æœºå†…å­˜æ¯”è¾ƒå°æ—¶è®¾ç½®ä¸ºfalse</span></span><br><span class=\"line\">bootstrap.memory_lock: <span class=\"literal\">false</span></span><br><span class=\"line\"><span class=\"comment\"># å…è®¸é€šè¿‡ä»»ä½•åœ°å€è®¿é—®ï¼Œå¼€å¯è¿œç¨‹è®¿é—®</span></span><br><span class=\"line\">network.host: 0.0.0.0</span><br><span class=\"line\"><span class=\"comment\"># é…ç½®å½“å‰ESèŠ‚ç‚¹å¯¹å¤–æä¾›æœåŠ¡çš„httpç«¯å£ï¼Œé»˜è®¤ 9200</span></span><br><span class=\"line\">http.port: 9200</span><br><span class=\"line\"><span class=\"comment\"># é…ç½®å½“å‰ESèŠ‚ç‚¹å¯¹å¤–æä¾›æœåŠ¡çš„tcpç«¯å£ï¼Œé»˜è®¤ 9300</span></span><br><span class=\"line\">transport.port: 9300</span><br><span class=\"line\"><span class=\"comment\"># é›†ç¾¤å†…çš„ä¸»æœºåˆ—è¡¨ï¼Œå¼€å¯å®‰å…¨è®¤è¯æ—¶æ— éœ€é…ç½®ï¼Œæ³¨æ„è¿™é‡Œä¸è¦è¿›è¡Œé…ç½®</span></span><br><span class=\"line\"><span class=\"comment\"># discovery.seed_hosts: [&quot;127.0.0.1&quot;]</span></span><br><span class=\"line\"><span class=\"comment\"># ç¬¬ä¸€æ¬¡å¯åŠ¨æ—¶éœ€è¦å‚ä¸é€‰ä¸»çš„èŠ‚ç‚¹åç§°ï¼Œè¿™é‡Œåªé…ç½®node-1</span></span><br><span class=\"line\">cluster.initial_master_nodes: [<span class=\"string\">&quot;node-1&quot;</span>]</span><br><span class=\"line\"><span class=\"comment\">#è§£å†³è·¨åŸŸé—®é¢˜</span></span><br><span class=\"line\">http.cors.enabled: <span class=\"literal\">true</span></span><br><span class=\"line\">http.cors.allow-origin: <span class=\"string\">&quot;*&quot;</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>é…ç½®<code>node-2</code>èŠ‚ç‚¹çš„é…ç½®æ–‡ä»¶</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># é›†ç¾¤åç§°</span></span><br><span class=\"line\">cluster.name: test-elk</span><br><span class=\"line\"><span class=\"comment\"># èŠ‚ç‚¹åç§°</span></span><br><span class=\"line\">node.name: node-2</span><br><span class=\"line\"><span class=\"comment\"># æ•°æ®å­˜å‚¨è·¯å¾„ï¼Œé»˜è®¤å€¼ $ES_HOME/data</span></span><br><span class=\"line\">path.data: /usr/local/elasticsearch/data</span><br><span class=\"line\"><span class=\"comment\"># æ—¥å¿—å­˜å‚¨è·¯å¾„ï¼Œé»˜è®¤å€¼ $ES_HOME/logs</span></span><br><span class=\"line\">path.logs: /usr/local/elasticsearch/logs</span><br><span class=\"line\"><span class=\"comment\"># é…ç½®ESå¯åŠ¨æ—¶æ˜¯å¦è¿›è¡Œå†…å­˜é”å®šæ£€æŸ¥ï¼Œé»˜è®¤å€¼trueï¼Œæœ¬æœºå†…å­˜æ¯”è¾ƒå°æ—¶è®¾ç½®ä¸ºfalse</span></span><br><span class=\"line\">bootstrap.memory_lock: <span class=\"literal\">false</span></span><br><span class=\"line\"><span class=\"comment\"># å…è®¸é€šè¿‡ä»»ä½•åœ°å€è®¿é—®ï¼Œå¼€å¯è¿œç¨‹è®¿é—®</span></span><br><span class=\"line\">network.host: 0.0.0.0</span><br><span class=\"line\"><span class=\"comment\"># é…ç½®å½“å‰ESèŠ‚ç‚¹å¯¹å¤–æä¾›æœåŠ¡çš„httpç«¯å£ï¼Œé»˜è®¤ 9200</span></span><br><span class=\"line\">http.port: 9200</span><br><span class=\"line\"><span class=\"comment\"># é…ç½®å½“å‰ESèŠ‚ç‚¹å¯¹å¤–æä¾›æœåŠ¡çš„tcpç«¯å£ï¼Œé»˜è®¤ 9300</span></span><br><span class=\"line\">transport.port: 9300</span><br><span class=\"line\"><span class=\"comment\">#è§£å†³è·¨åŸŸé—®é¢˜</span></span><br><span class=\"line\">http.cors.enabled: <span class=\"literal\">true</span></span><br><span class=\"line\">http.cors.allow-origin: <span class=\"string\">&quot;*&quot;</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>é…ç½®<code>node-3</code>èŠ‚ç‚¹çš„é…ç½®æ–‡ä»¶</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># é›†ç¾¤åç§°</span></span><br><span class=\"line\">cluster.name: test-elk</span><br><span class=\"line\"><span class=\"comment\"># èŠ‚ç‚¹åç§°</span></span><br><span class=\"line\">node.name: node-3</span><br><span class=\"line\"><span class=\"comment\"># æ•°æ®å­˜å‚¨è·¯å¾„ï¼Œé»˜è®¤å€¼ $ES_HOME/data</span></span><br><span class=\"line\">path.data: /usr/local/elasticsearch/data</span><br><span class=\"line\"><span class=\"comment\"># æ—¥å¿—å­˜å‚¨è·¯å¾„ï¼Œé»˜è®¤å€¼ $ES_HOME/logs</span></span><br><span class=\"line\">path.logs: /usr/local/elasticsearch/logs</span><br><span class=\"line\"><span class=\"comment\"># é…ç½®ESå¯åŠ¨æ—¶æ˜¯å¦è¿›è¡Œå†…å­˜é”å®šæ£€æŸ¥ï¼Œé»˜è®¤å€¼trueï¼Œæœ¬æœºå†…å­˜æ¯”è¾ƒå°æ—¶è®¾ç½®ä¸ºfalse</span></span><br><span class=\"line\">bootstrap.memory_lock: <span class=\"literal\">false</span></span><br><span class=\"line\"><span class=\"comment\"># å…è®¸é€šè¿‡ä»»ä½•åœ°å€è®¿é—®ï¼Œå¼€å¯è¿œç¨‹è®¿é—®</span></span><br><span class=\"line\">network.host: 0.0.0.0</span><br><span class=\"line\"><span class=\"comment\"># é…ç½®å½“å‰ESèŠ‚ç‚¹å¯¹å¤–æä¾›æœåŠ¡çš„httpç«¯å£ï¼Œé»˜è®¤ 9200</span></span><br><span class=\"line\">http.port: 9200</span><br><span class=\"line\"><span class=\"comment\"># é…ç½®å½“å‰ESèŠ‚ç‚¹å¯¹å¤–æä¾›æœåŠ¡çš„tcpç«¯å£ï¼Œé»˜è®¤ 9300</span></span><br><span class=\"line\">transport.port: 9300</span><br><span class=\"line\"><span class=\"comment\">#è§£å†³è·¨åŸŸé—®é¢˜</span></span><br><span class=\"line\">http.cors.enabled: <span class=\"literal\">true</span></span><br><span class=\"line\">http.cors.allow-origin: <span class=\"string\">&quot;*&quot;</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¯åŠ¨<code>node-1</code>ï¼Œå¯åŠ¨æˆåŠŸåæˆ‘ä»¬ä¼šåœ¨æ—¥å¿—ä¸­çœ‹åˆ°å¦‚ä¸‹å®‰å…¨è®¤è¯ä¿¡æ¯ä¿¡æ¯ï¼Œè®°å½•å…¶ä¸­çš„åŠ å…¥é›†ç¾¤çš„èŠ‚ç‚¹çš„tokenä¿¡æ¯</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span><br><span class=\"line\"><span class=\"comment\"># è¿™äº›æ—¥å¿—ä¿¡æ¯æä¾›äº† Elasticsearch 8 åœ¨é¦–æ¬¡å¯åŠ¨æ—¶è‡ªåŠ¨é…ç½®çš„å®‰å…¨ç‰¹æ€§ã€ç”Ÿæˆçš„é»˜è®¤å¯†ç ã€è¯ä¹¦æŒ‡çº¹ä»¥åŠå¦‚ä½•é…ç½® Kibana å’Œå…¶ä»–èŠ‚ç‚¹åŠ å…¥é›†ç¾¤çš„è¯¦ç»†è¯´æ˜ã€‚</span></span><br><span class=\"line\">âœ… Elasticsearch security features have been automatically configured!</span><br><span class=\"line\">âœ… Authentication is enabled and cluster connections are encrypted.</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># è¿™æ˜¯ elastic ç”¨æˆ·çš„é»˜è®¤å¯†ç ã€‚ç³»ç»Ÿå»ºè®®ä½ ä½¿ç”¨ bin/elasticsearch-reset-password -u elastic å‘½ä»¤æ¥é‡ç½®æ­¤å¯†ç ã€‚</span></span><br><span class=\"line\">â„¹ï¸  Password <span class=\"keyword\">for</span> the elastic user (reset with `bin/elasticsearch-reset-password -u elastic`):</span><br><span class=\"line\">  BNb=*qz6_M*mXL9uZiSP <span class=\"comment\"># è¿™é‡Œä¼šæ‰“å°å‡ºESè‡ªåŠ¨ç”Ÿæˆçš„å¯†ç </span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># è¿™æ˜¯ HTTP CA è¯ä¹¦çš„ SHA-256 æŒ‡çº¹ã€‚CA è¯ä¹¦ç”¨äºéªŒè¯ HTTPS è¿æ¥çš„èº«ä»½ã€‚</span></span><br><span class=\"line\">â„¹ï¸  HTTP CA certificate SHA-256 fingerprint:</span><br><span class=\"line\">  3f141c16dfc6e165894bc1672084b220dcdd22ffe02116d51ac18003cfaa5a1d</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æä¾›äº†å°† Kibana é…ç½®ä¸ºä½¿ç”¨æ­¤ Elasticsearch é›†ç¾¤çš„æ­¥éª¤ã€‚</span></span><br><span class=\"line\">â„¹ï¸  Configure Kibana to use this cluster:</span><br><span class=\"line\"><span class=\"comment\"># å¯åŠ¨ Kibana å¹¶æŒ‰ç…§ç»ˆç«¯ä¸­æ˜¾ç¤ºçš„é…ç½®é“¾æ¥è¿›è¡Œæ“ä½œã€‚</span></span><br><span class=\"line\">â€¢ Run Kibana and click the configuration <span class=\"built_in\">link</span> <span class=\"keyword\">in</span> the terminal when Kibana starts.</span><br><span class=\"line\"><span class=\"comment\"># å¤åˆ¶æä¾›çš„æ³¨å†Œä»¤ç‰Œï¼Œå¹¶åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ Kibana æ—¶ç²˜è´´æ­¤ä»¤ç‰Œã€‚ä»¤ç‰Œåœ¨æ¥ä¸‹æ¥çš„ 30 åˆ†é’Ÿå†…æœ‰æ•ˆã€‚</span></span><br><span class=\"line\"><span class=\"comment\"># è¡¥å……è¯´æ˜ï¼šç”Ÿæˆæ–°çš„kibanaæ³¨å†Œä»¤ç‰Œï¼šbin/elasticsearch-create-enrollment-token -s kibana</span></span><br><span class=\"line\">â€¢ Copy the following enrollment token and <span class=\"built_in\">paste</span> it into Kibana <span class=\"keyword\">in</span> your browser (valid <span class=\"keyword\">for</span> the next 30 minutes):</span><br><span class=\"line\">  eyJ2ZXIiOiI4LjE0LjAiLCJhZHIiOlsiMTAuMjUwLjAuMjM5OjkyMDAiXSwiZmdyIjoiM2YxNDFjMTZkZmM2ZTE2NTg5NGJjMTY3MjA4NGIyMjBkY2RkMjJmZmUwMjExNmQ1MWFjMTgwMDNjZmFhNWExZCIsImtleSI6ImFSWFBzcFVCTVVmc1d5aUJnbjBtOmRzbVBLQV95UXhDZkJpXzQyWDNEMVEifQ==</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æä¾›äº†å°†æ–°çš„ Elasticsearch èŠ‚ç‚¹åŠ å…¥ç°æœ‰é›†ç¾¤çš„æ­¥éª¤ã€‚</span></span><br><span class=\"line\">â„¹ï¸ Configure other nodes to <span class=\"built_in\">join</span> this cluster:</span><br><span class=\"line\"><span class=\"comment\"># ä½¿ç”¨ bin/elasticsearch --enrollment-token &lt;token&gt; å‘½ä»¤å¯åŠ¨æ–°çš„ Elasticsearch èŠ‚ç‚¹ã€‚ä»¤ç‰Œåœ¨æ¥ä¸‹æ¥çš„ 30 åˆ†é’Ÿå†…æœ‰æ•ˆã€‚</span></span><br><span class=\"line\"><span class=\"comment\"># è¡¥å……è¯´æ˜ï¼šç”Ÿæˆæ–°çš„èŠ‚ç‚¹æ³¨å†Œä»¤ç‰Œï¼šbin/elasticsearch-create-enrollment-token -s node</span></span><br><span class=\"line\">â€¢ Copy the following enrollment token and start new Elasticsearch nodes with `bin/elasticsearch --enrollment-token &lt;token&gt;` (valid <span class=\"keyword\">for</span> the next 30 minutes):</span><br><span class=\"line\">  eyJ2ZXIiOiI4LjE0LjAiLCJhZHIiOlsiMTAuMjUwLjAuMjM5OjkyMDAiXSwiZmdyIjoiM2YxNDFjMTZkZmM2ZTE2NTg5NGJjMTY3MjA4NGIyMjBkY2RkMjJmZmUwMjExNmQ1MWFjMTgwMDNjZmFhNWExZCIsImtleSI6ImF4WFBzcFVCTVVmc1d5aUJnbjFtOkFEallPdnpzUzh1MGJqOFpfVFE4a3cifQ==</span><br><span class=\"line\"><span class=\"comment\"># å¦‚æœä½ åœ¨ Docker ä¸­è¿è¡Œ Elasticsearchï¼Œå¯ä»¥ä½¿ç”¨ docker run -e &quot;ENROLLMENT_TOKEN=&lt;token&gt;&quot; docker.elastic.co/elasticsearch/elasticsearch:8.17.3 å‘½ä»¤å¯åŠ¨æ–°èŠ‚ç‚¹ã€‚</span></span><br><span class=\"line\">  If you<span class=\"string\">&#x27;re running in Docker, copy the enrollment token and run:</span></span><br><span class=\"line\"><span class=\"string\">  `docker run -e &quot;ENROLLMENT_TOKEN=&lt;token&gt;&quot; docker.elastic.co/elasticsearch/elasticsearch:8.17.3`</span></span><br><span class=\"line\"><span class=\"string\">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>tokenä¿¡æ¯æœ‰æ•ˆæ—¶é—´åªæœ‰30åˆ†é’Ÿï¼Œè¶…æ—¶åå¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤é‡æ–°ç”Ÿæˆæ–°çš„token</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># è¿›å…¥node-1èŠ‚ç‚¹çš„ESå®‰è£…ç›®å½•ï¼Œæ­¤å‘½ä»¤ä¼šç”Ÿæˆæ–°çš„èŠ‚ç‚¹æ³¨å†Œä»¤ç‰Œ</span></span><br><span class=\"line\">bin/elasticsearch-create-enrollment-token -s node</span><br><span class=\"line\">eyJ2ZXIiOiI4LjE0LjAiLCJhZHIiOlsiMTAuMjUwLjAuMjM5OjkyMDAiXSwiZmdyIjoiM2YxNDFjMTZkZmM2ZTE2NTg5NGJjMTY3MjA4NGIyMjBkY2RkMjJmZmUwMjExNmQ1MWFjMTgwMDNjZmFhNWExZCIsImtleSI6IlpoRVZ4NVVCeXRPajdLeTBqb3BvOmdHRW44ZW5mU0RDZHA2Yy1uSDF4eGcifQ==</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¯åŠ¨<code>node-2</code>èŠ‚ç‚¹ï¼Œå¯åŠ¨æ—¶è¦å¸¦ä¸Štokenä¿¡æ¯ï¼Œ<code>node-3</code>ä¸æ­¤ä¸€æ ·ã€‚è¿™é‡Œè¦æ³¨æ„ï¼Œåªæœ‰ç¬¬ä¸€æ¬¡åŠ å…¥é›†ç¾¤æ—¶å¯åŠ¨æ‰éœ€è¦å¸¦ä¸Šæ³¨å†Œä»¤ç‰Œï¼Œåç»­å¯åŠ¨ä¸éœ€è¦tokenä¿¡æ¯</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># è¿›å…¥node-2èŠ‚ç‚¹çš„ESå®‰è£…ç›®å½•ï¼Œæ­¤å‘½ä»¤ä¼šå¯åŠ¨ESèŠ‚ç‚¹ï¼Œå¹¶åŠ å…¥åˆ°é›†ç¾¤ä¸­</span></span><br><span class=\"line\"><span class=\"comment\"># bin/elasticsearch --enrollment-token &lt;token&gt;</span></span><br><span class=\"line\">bin/elasticsearch --enrollment-token eyJ2ZXIiOiI4LjE0LjAiLCJhZHIiOlsiMTAuMjUwLjAuMjM5OjkyMDAiXSwiZmdyIjoiM2YxNDFjMTZkZmM2ZTE2NTg5NGJjMTY3MjA4NGIyMjBkY2RkMjJmZmUwMjExNmQ1MWFjMTgwMDNjZmFhNWExZCIsImtleSI6IlpoRVZ4NVVCeXRPajdLeTBqb3BvOmdHRW44ZW5mU0RDZHA2Yy1uSDF4eGcifQ==</span><br></pre></td></tr></table></figure>\n<div class=\"tips\">\n<p><em><strong>åŠ å…¥é›†ç¾¤å¤±è´¥</strong></em></p>\n<ul class=\"lvl-1\">\n<li class=\"lvl-2\">åœ¨æ‰§è¡Œ<code>bin/elasticsearch --enrollment-token &lt;token&gt;</code>æ—¶æœ‰å¯èƒ½ä¼šé‡åˆ°å¦‚ä¸‹å¼‚å¸¸ï¼š</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ERROR: Aborting auto configuration because the node keystore contains password settings already, with <span class=\"built_in\">exit</span> code 78</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-1\">\n<li class=\"lvl-2\">è¿™é€šå¸¸æ„å‘³ç€èŠ‚ç‚¹çš„ <code>keystore</code> å·²ç»åŒ…å«äº†å¯†ç è®¾ç½®ï¼Œå› æ­¤è‡ªåŠ¨é…ç½®è¿‡ç¨‹è¢«ä¸­æ­¢ã€‚</li>\n<li class=\"lvl-2\">äº§ç”Ÿè¿™ç§é”™è¯¯çš„åŸå› å¤§æ¦‚ç‡æ˜¯å½“å‰ESæ˜¯ä»å·²ç»å®‰è£…å¥½çš„æœåŠ¡å™¨ä¸Šæ‹·è´è¿‡æ¥çš„ï¼Œè€Œä¸æ˜¯å…¨æ–°å®‰è£…çš„ï¼Œæ­¤æ—¶æˆ‘ä»¬é™¤äº†éœ€è¦æ¸…ç©º<code>data</code>ç›®å½•å¤–ï¼Œè¿˜éœ€è¦åˆ é™¤ <code>keystore</code> ä¸­çš„å¯†ç </li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹keystoreä¸­çš„å¯†ç </span></span><br><span class=\"line\">$ bin/elasticsearch-keystore list</span><br><span class=\"line\">keystore.seed</span><br><span class=\"line\">xpack.security.http.ssl.keystore.secure_password</span><br><span class=\"line\">xpack.security.transport.ssl.keystore.secure_password</span><br><span class=\"line\">xpack.security.transport.ssl.truststore.secure_password</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åˆ é™¤keystoreä¸­çš„å¯†ç </span></span><br><span class=\"line\">$ bin/elasticsearch-keystore remove xpack.security.http.ssl.keystore.secure_password</span><br><span class=\"line\">$ bin/elasticsearch-keystore remove xpack.security.transport.ssl.keystore.secure_password</span><br><span class=\"line\">$ bin/elasticsearch-keystore remove xpack.security.transport.ssl.truststore.secure_password</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-1\">\n<li class=\"lvl-2\">\n<p>å†æ¬¡æ‰§è¡Œ<code>bin/elasticsearch --enrollment-token &lt;token&gt;</code>å³å¯ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å¦å¤–è¿˜å¯èƒ½é‡åˆ°å¦‚ä¸‹æŠ¥é”™ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ERROR: Aborting enrolling to cluster. Could not communicate with the node on any of the addresses from the enrollment token. All of [10.250.0.239:9200] were attempted., with <span class=\"built_in\">exit</span> code 69</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-1\">\n<li class=\"lvl-2\">è¿™æ˜¯ç”±äºtokenè¿‡æœŸäº†ï¼Œé‡æ–°ç”Ÿæˆæ–°çš„tokenå³å¯</li>\n</ul>\n</div>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¯åŠ¨æˆåŠŸåä¼šåœ¨<code>node-2</code>çš„é…ç½®æ–‡ä»¶ä¸­çœ‹åˆ°å¦‚ä¸‹é…ç½®ä¿¡æ¯</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#----------------------- BEGIN SECURITY AUTO CONFIGURATION -----------------------</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\"># The following settings, TLS certificates, and keys have been automatically</span></span><br><span class=\"line\"><span class=\"comment\"># generated to configure Elasticsearch security features on 24-03-2025 07:45:11</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\"># --------------------------------------------------------------------------------</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Enable security features</span></span><br><span class=\"line\">xpack.security.enabled: <span class=\"literal\">true</span></span><br><span class=\"line\"></span><br><span class=\"line\">xpack.security.enrollment.enabled: <span class=\"literal\">true</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Enable encryption for HTTP API client connections, such as Kibana, Logstash, and Agents</span></span><br><span class=\"line\">xpack.security.http.ssl:</span><br><span class=\"line\">  enabled: <span class=\"literal\">true</span></span><br><span class=\"line\">  keystore.path: certs/http.p12</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Enable encryption and mutual authentication between cluster nodes</span></span><br><span class=\"line\">xpack.security.transport.ssl:</span><br><span class=\"line\">  enabled: <span class=\"literal\">true</span></span><br><span class=\"line\">  verification_mode: certificate</span><br><span class=\"line\">  keystore.path: certs/transport.p12</span><br><span class=\"line\">  truststore.path: certs/transport.p12</span><br><span class=\"line\"><span class=\"comment\"># Discover existing nodes in the cluster</span></span><br><span class=\"line\">discovery.seed_hosts: [<span class=\"string\">&quot;10.250.0.239:9300&quot;</span>] <span class=\"comment\"># è¿™é‡Œæ˜¯node-1èŠ‚ç‚¹çš„IPåœ°å€å’Œç«¯å£å·</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">## è€Œnode-3è¿™é‡Œä¼šæ˜¾ç¤ºå¦‚ä¸‹ä¿¡æ¯ï¼Œä¹Ÿå°±æ˜¯è¶Šæ˜¯åæ¥åŠ å…¥è¿›æ¥çš„ï¼Œè¿™é‡Œå°±ä¼šåŠ ä¸Šä¹‹å‰æ‰€æœ‰èŠ‚ç‚¹çš„IPåœ°å€å’Œç«¯å£å·</span></span><br><span class=\"line\">discovery.seed_hosts: [<span class=\"string\">&quot;10.250.0.239:9300&quot;</span>, <span class=\"string\">&quot;10.250.0.17:9300&quot;</span>] <span class=\"comment\"># è¿™é‡Œæ˜¯node-1å’Œnode-2èŠ‚ç‚¹çš„IPåœ°å€å’Œç«¯å£å·</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#----------------------- END SECURITY AUTO CONFIGURATION -------------------------</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"éªŒè¯é›†ç¾¤çŠ¶æ€\">éªŒè¯é›†ç¾¤çŠ¶æ€</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¯åŠ¨å®Œæˆåï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹é›†ç¾¤çŠ¶æ€ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹é›†ç¾¤çŠ¶æ€</span></span><br><span class=\"line\">$ curl -u elastic:123456 --cacert /usr/local/elasticsearch/elasticsearch-8.17.3/config/certs/http_ca.crt  https://127.0.0.1:9200/_cluster/health?pretty</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">&quot;cluster_name&quot;</span> : <span class=\"string\">&quot;test-elk&quot;</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;status&quot;</span> : <span class=\"string\">&quot;green&quot;</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;timed_out&quot;</span> : <span class=\"literal\">false</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;number_of_nodes&quot;</span> : 3,</span><br><span class=\"line\">  <span class=\"string\">&quot;number_of_data_nodes&quot;</span> : 3,</span><br><span class=\"line\">  <span class=\"string\">&quot;active_primary_shards&quot;</span> : 31,</span><br><span class=\"line\">  <span class=\"string\">&quot;active_shards&quot;</span> : 62,</span><br><span class=\"line\">  <span class=\"string\">&quot;relocating_shards&quot;</span> : 0,</span><br><span class=\"line\">  <span class=\"string\">&quot;initializing_shards&quot;</span> : 0,</span><br><span class=\"line\">  <span class=\"string\">&quot;unassigned_shards&quot;</span> : 0,</span><br><span class=\"line\">  <span class=\"string\">&quot;unassigned_primary_shards&quot;</span> : 0,</span><br><span class=\"line\">  <span class=\"string\">&quot;delayed_unassigned_shards&quot;</span> : 0,</span><br><span class=\"line\">  <span class=\"string\">&quot;number_of_pending_tasks&quot;</span> : 0,</span><br><span class=\"line\">  <span class=\"string\">&quot;number_of_in_flight_fetch&quot;</span> : 0,</span><br><span class=\"line\">  <span class=\"string\">&quot;task_max_waiting_in_queue_millis&quot;</span> : 0,</span><br><span class=\"line\">  <span class=\"string\">&quot;active_shards_percent_as_number&quot;</span> : 100.0</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹èŠ‚ç‚¹ä¿¡æ¯ï¼Œå…¶ä¸­ * è¡¨ç¤ºå½“å‰èŠ‚ç‚¹ä¸ºmasterèŠ‚ç‚¹</span></span><br><span class=\"line\">$ curl -u elastic:123456 --cacert /usr/local/elasticsearch/elasticsearch-8.17.3/config/certs/http_ca.crt  https://127.0.0.1:9200/_cat/nodes?v</span><br><span class=\"line\">ip           heap.percent ram.percent cpu load_1m load_5m load_15m node.role   master name</span><br><span class=\"line\">10.250.0.17             8          63  28    1.03    0.38     0.14 cdfhilmrstw -      node-2</span><br><span class=\"line\">10.250.0.173            9          63  22    0.86    0.37     0.19 cdfhilmrstw -      node-3</span><br><span class=\"line\">10.250.0.239            9          78   6    0.38    0.22     0.16 cdfhilmrstw *      node-1</span><br></pre></td></tr></table></figure>\n<h2 id=\"é‡è¦è¯´æ˜\">é‡è¦è¯´æ˜</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>é›†ç¾¤ä¸€æ—¦åˆ›å»ºå®Œæˆï¼Œåˆ™è‡³å°‘éœ€è¦ä¸¤ä¸ªèŠ‚ç‚¹è¿è¡Œæ‰èƒ½ä¿è¯é›†ç¾¤å¯ç”¨æ€§ï¼Œå¦åˆ™é›†ç¾¤å°†æ— æ³•è¿è¡Œã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å¦‚æœ<code>node-1</code>èŠ‚ç‚¹æŒ‚äº†ï¼Œé›†ç¾¤ä¸­å‰©ä¸‹çš„ä¸¤ä¸ªèŠ‚ç‚¹ä¼šé‡æ–°é€‰æ‹©ä¸€ä¸ªæ–°çš„<code>master</code>èŠ‚ç‚¹ï¼Œä¸ä¼šå½±å“é›†ç¾¤çš„å¯ç”¨æ€§ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä¸€æ—¦å…³é—­<code>node-1</code>ï¼Œåˆ™é‡æ–°å¯åŠ¨<code>node-1</code>èŠ‚ç‚¹å‰è¦ä¿®æ”¹å…¶é…ç½®æ–‡ä»¶ï¼Œå¦åˆ™æ— æ³•å¯åŠ¨æˆåŠŸã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æ³¨é‡Šæ‰è¯¥é…ç½®</span></span><br><span class=\"line\"><span class=\"comment\"># cluster.initial_master_nodes: [&quot;node-1&quot;]</span></span><br><span class=\"line\"><span class=\"comment\"># åŠ å…¥è¯¥é…ç½®ï¼Œå®é™…ä¸Šæœ€å¥½åœ¨é‡å¯æ¯ä¸ªèŠ‚ç‚¹å‰ï¼Œå°†æ¯ä¸ªèŠ‚ç‚¹éƒ½é…ç½®ä¸ºè¿™æ ·</span></span><br><span class=\"line\">discovery.seed_hosts: [<span class=\"string\">&quot;10.250.0.239:9300&quot;</span>, <span class=\"string\">&quot;10.250.0.17:9300&quot;</span>, <span class=\"string\">&quot;10.250.0.173:9300&quot;</span>]</span><br></pre></td></tr></table></figure>\n<h2 id=\"Kibanaå…³è”ESé›†ç¾¤\">Kibanaå…³è”ESé›†ç¾¤</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Kibana å…³è”å•èŠ‚ç‚¹ESå‚è€ƒ <a href=\"/2025/03/21/kibana-01-install/\" title=\"linuxä¸‹å®‰è£…Kibana\">linuxä¸‹å®‰è£…Kibana</a>ï¼Œåœ¨æ­¤åŸºç¡€ä¸Šå¯¹é…ç½®æ–‡ä»¶è¿›è¡Œå¦‚ä¸‹ä¿®æ”¹ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å…³è”é›†ç¾¤çš„èŠ‚ç‚¹åœ°å€ï¼Œå°†é›†ç¾¤å†…æ‰€æœ‰èŠ‚ç‚¹çš„åœ°å€éƒ½é…ç½®åˆ°è¯¥å­—æ®µä¸­</span></span><br><span class=\"line\">elasticsearch.hosts: [<span class=\"string\">&#x27;https://10.250.0.239:9200&#x27;</span>, <span class=\"string\">&#x27;https://10.250.0.173:9200&#x27;</span>, <span class=\"string\">&#x27;https://10.250.0.17:9200&#x27;</span>]</span><br><span class=\"line\"><span class=\"comment\"># å…³è”é›†ç¾¤çš„è¾“å‡ºåœ°å€ï¼Œå°†é›†ç¾¤å†…æ‰€æœ‰èŠ‚ç‚¹çš„åœ°å€éƒ½é…ç½®åˆ°è¯¥å­—æ®µä¸­</span></span><br><span class=\"line\">xpack.fleet.outputs: [&#123;<span class=\"built_in\">id</span>: fleet-default-output, name: default, is_default: <span class=\"literal\">true</span>, is_default_monitoring: <span class=\"literal\">true</span>, <span class=\"built_in\">type</span>: elasticsearch, hosts: [<span class=\"string\">&#x27;https://10.250.0.239:9200&#x27;</span>, <span class=\"string\">&#x27;https://10.250.0.173:9200&#x27;</span>, <span class=\"string\">&#x27;https://10.250.0.17:9200&#x27;</span>], ca_trusted_fingerprint: 3f141c16dfc6e165894bc1672084b220dcdd22ffe02116d51ac18003cfaa5a1d&#125;]</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>é‡å¯Kibana</p>\n</li>\n<li class=\"lvl-2\">\n<p>åªè¦ä¿è¯é›†ç¾¤å†…è‡³å°‘æœ‰ä¸¤ä¸ªESèŠ‚ç‚¹å·¥ä½œæ­£å¸¸ï¼Œå³å¯æ­£å¸¸è®¿é—®Kibana</p>\n</li>\n</ul>\n<h2 id=\"nginxåå‘ä»£ç†ESé›†ç¾¤\">nginxåå‘ä»£ç†ESé›†ç¾¤</h2>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim /etc/nginx/conf.d/es.conf <span class=\"comment\"># æ·»åŠ å¦‚ä¸‹å†…å®¹</span></span><br><span class=\"line\">upstream es &#123;</span><br><span class=\"line\">    server 10.250.0.239:9200;</span><br><span class=\"line\">    server 10.250.0.173:9200;</span><br><span class=\"line\">    server 10.250.0.17:9200;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">server &#123;</span><br><span class=\"line\">        listen       8888;</span><br><span class=\"line\">        server_name  localhost es.domain;</span><br><span class=\"line\"></span><br><span class=\"line\">        location / &#123;</span><br><span class=\"line\">            proxy_pass https://es; <span class=\"comment\">#è¿™ä¸ªåç§°å’Œè¦ä¸Šé¢ upstream es å¯¹åº”ï¼Œæ³¨æ„è¿™é‡Œæ˜¯ https åè®®</span></span><br><span class=\"line\">            proxy_redirect     default;</span><br><span class=\"line\">            proxy_http_version 1.1;</span><br><span class=\"line\"></span><br><span class=\"line\">            proxy_set_header   Host              <span class=\"variable\">$host</span>;</span><br><span class=\"line\">            proxy_set_header   X-Real-IP         <span class=\"variable\">$remote_addr</span>;</span><br><span class=\"line\">            proxy_set_header   X-Forwarded-For   <span class=\"variable\">$proxy_add_x_forwarded_for</span>;</span><br><span class=\"line\">            proxy_set_header   X-Forwarded-Proto <span class=\"variable\">$scheme</span>;</span><br><span class=\"line\">            proxy_max_temp_file_size 0;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">#this is the maximum upload size</span></span><br><span class=\"line\">            client_max_body_size       10m;</span><br><span class=\"line\">            client_body_buffer_size    128k;</span><br><span class=\"line\"></span><br><span class=\"line\">            proxy_connect_timeout      90;</span><br><span class=\"line\">            proxy_send_timeout         90;</span><br><span class=\"line\">            proxy_read_timeout         90;</span><br><span class=\"line\">            proxy_buffering            off;</span><br><span class=\"line\">            proxy_request_buffering    off; <span class=\"comment\"># Required for HTTP CLI commands</span></span><br><span class=\"line\">            proxy_set_header Connection <span class=\"string\">&quot;&quot;</span>; <span class=\"comment\"># Clear for keepalive</span></span><br><span class=\"line\"></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># é‡å¯nginx</span></span><br><span class=\"line\">systemctl restart nginx</span><br><span class=\"line\"><span class=\"comment\"># è®¿é—®ESé›†ç¾¤</span></span><br><span class=\"line\">curl -u elastic:123456 http://127.0.0.1:8888/_cluster/health?pretty</span><br></pre></td></tr></table></figure>","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç»å¦‚ä½•åœ¨linuxä¸‹å®‰è£…Elasticsearché›†ç¾¤(ä¸‰èŠ‚ç‚¹) Elasticsearchç‰ˆæœ¬8.17.3 å•èŠ‚ç‚¹å®‰è£…å‚è€ƒlinuxä¸‹å®‰è£…Elasticsearchï¼Œæœ¬æ–‡åœ¨æ­¤åŸºç¡€ä¸Šå®Œæˆé›†ç¾¤å®‰è£… é›†ç¾¤å®‰è£… ä¸‰ä¸ªèŠ‚ç‚¹åˆ†åˆ«å®‰ç…§å•èŠ‚ç‚¹çš„å®‰è£…æ–¹å¼å®Œæˆä¸‹è½½ï¼Œç”¨æˆ·é…ç½®ï¼Œç¯å¢ƒå˜é‡é…ç½®ï¼Œç³»ç»Ÿå‚æ•°é…ç½®ï¼Œç­‰ç­‰ã€‚ ä»»é€‰ä¸€ä¸ªèŠ‚ç‚¹ä½œä¸ºé›†ç¾¤çš„masterèŠ‚ç‚¹ï¼Œæˆ‘ä»¬å‘½åä¸ºnode-1ï¼Œå…¶å®ƒèŠ‚ç‚¹å‘½åä¸ºnode-2å’Œnode-3 å…ˆé…ç½®node-1èŠ‚ç‚¹çš„é…ç½®æ–‡ä»¶ 1234567891011121314151617181920212223# é›†ç¾¤åç§°cluster.name: test-elk# èŠ‚ç‚¹åç§°node.name: node-1# æ•°æ®å­˜å‚¨è·¯å¾„ï¼Œé»˜è®¤å€¼ $ES_HOME/datapath.data: /usr/local/elasticsearch/data# æ—¥å¿—å­˜å‚¨è·¯å¾„ï¼Œé»˜è®¤å€¼ $ES_HOME/logspath.logs: /usr/local/elasticsearch/logs# é…ç½®ESå¯åŠ¨æ—¶æ˜¯å¦è¿›è¡Œå†…å­˜é”å®šæ£€æŸ¥ï¼Œé»˜è®¤å€¼trueï¼Œæœ¬æœºå†…å­˜æ¯”è¾ƒå°æ—¶è®¾ç½®ä¸ºfalsebootstrap.memory_lock: false# å…è®¸é€šè¿‡ä»»ä½•åœ°å€è®¿é—®ï¼Œå¼€å¯è¿œç¨‹è®¿é—®network.host: 0.0.0.0# é…ç½®å½“å‰ESèŠ‚ç‚¹å¯¹å¤–æä¾›æœåŠ¡çš„httpç«¯å£ï¼Œé»˜è®¤ 9200http.port: 9200# é…ç½®å½“å‰ESèŠ‚ç‚¹å¯¹å¤–æä¾›æœåŠ¡çš„tcpç«¯å£ï¼Œé»˜è®¤ 9300transport.port: 9300# é›†ç¾¤å†…çš„ä¸»æœºåˆ—è¡¨ï¼Œå¼€å¯å®‰å…¨è®¤è¯æ—¶æ— éœ€é…ç½®ï¼Œæ³¨æ„è¿™é‡Œä¸è¦è¿›è¡Œé…ç½®# discovery.seed_hosts: [&quot;127.0.0.1&quot;]# ç¬¬ä¸€æ¬¡å¯åŠ¨æ—¶éœ€è¦å‚ä¸é€‰ä¸»çš„èŠ‚ç‚¹åç§°ï¼Œè¿™é‡Œåªé…ç½®node-1cluster.initial_master_nodes: [&quot;node-1&quot;]#è§£å†³è·¨åŸŸé—®é¢˜http.cors.enabled: truehttp.cors.allow-origin: &quot;*&quot; é…ç½®node-2èŠ‚ç‚¹çš„é…ç½®æ–‡ä»¶ 12345678910111213141516171819# é›†ç¾¤åç§°cluster.name: test-elk# èŠ‚ç‚¹åç§°node.name: node-2# æ•°æ®å­˜å‚¨è·¯å¾„ï¼Œé»˜è®¤å€¼ $ES_HOME/datapath.data: /usr/local/elasticsearch/data# æ—¥å¿—å­˜å‚¨è·¯å¾„ï¼Œé»˜è®¤å€¼ $ES_HOME/logspath.logs: /usr/local/elasticsearch/logs# é…ç½®ESå¯åŠ¨æ—¶æ˜¯å¦è¿›è¡Œå†…å­˜é”å®šæ£€æŸ¥ï¼Œé»˜è®¤å€¼trueï¼Œæœ¬æœºå†…å­˜æ¯”è¾ƒå°æ—¶è®¾ç½®ä¸ºfalsebootstrap.memory_lock: false# å…è®¸é€šè¿‡ä»»ä½•åœ°å€è®¿é—®ï¼Œå¼€å¯è¿œç¨‹è®¿é—®network.host: 0.0.0.0# é…ç½®å½“å‰ESèŠ‚ç‚¹å¯¹å¤–æä¾›æœåŠ¡çš„httpç«¯å£ï¼Œé»˜è®¤ 9200http.port: 9200# é…ç½®å½“å‰ESèŠ‚ç‚¹å¯¹å¤–æä¾›æœåŠ¡çš„tcpç«¯å£ï¼Œé»˜è®¤ 9300transport.port: 9300#è§£å†³è·¨åŸŸé—®é¢˜http.cors.enabled: truehttp.cors.allow-origin: &quot;*&quot; é…ç½®node-3èŠ‚ç‚¹çš„é…ç½®æ–‡ä»¶ 12345678910111213141516171819# é›†ç¾¤åç§°cluster.name: test-elk# èŠ‚ç‚¹åç§°node.name: node-3# æ•°æ®å­˜å‚¨è·¯å¾„ï¼Œé»˜è®¤å€¼ $ES_HOME/datapath.data: /usr/local/elasticsearch/data# æ—¥å¿—å­˜å‚¨è·¯å¾„ï¼Œé»˜è®¤å€¼ $ES_HOME/logspath.logs: /usr/local/elasticsearch/logs# é…ç½®ESå¯åŠ¨æ—¶æ˜¯å¦è¿›è¡Œå†…å­˜é”å®šæ£€æŸ¥ï¼Œé»˜è®¤å€¼trueï¼Œæœ¬æœºå†…å­˜æ¯”è¾ƒå°æ—¶è®¾ç½®ä¸ºfalsebootstrap.memory_lock: false# å…è®¸é€šè¿‡ä»»ä½•åœ°å€è®¿é—®ï¼Œå¼€å¯è¿œç¨‹è®¿é—®network.host: 0.0.0.0# é…ç½®å½“å‰ESèŠ‚ç‚¹å¯¹å¤–æä¾›æœåŠ¡çš„httpç«¯å£ï¼Œé»˜è®¤ 9200http.port: 9200# é…ç½®å½“å‰ESèŠ‚ç‚¹å¯¹å¤–æä¾›æœåŠ¡çš„tcpç«¯å£ï¼Œé»˜è®¤ 9300transport.port: 9300#è§£å†³è·¨åŸŸé—®é¢˜http.cors.enabled: truehttp.cors.allow-origin: &quot;*&quot; å¯åŠ¨node-1ï¼Œå¯åŠ¨æˆåŠŸåæˆ‘ä»¬ä¼šåœ¨æ—¥å¿—ä¸­çœ‹åˆ°å¦‚ä¸‹å®‰å…¨è®¤è¯ä¿¡æ¯ä¿¡æ¯ï¼Œè®°å½•å…¶ä¸­çš„åŠ å…¥é›†ç¾¤çš„èŠ‚ç‚¹çš„tokenä¿¡æ¯ 1234567891011121314151617181920212223242526272829303132â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”# è¿™äº›æ—¥å¿—ä¿¡æ¯æä¾›äº† Elasticsearch 8 åœ¨é¦–æ¬¡å¯åŠ¨æ—¶è‡ªåŠ¨é…ç½®çš„å®‰å…¨ç‰¹æ€§ã€ç”Ÿæˆçš„é»˜è®¤å¯†ç ã€è¯ä¹¦æŒ‡çº¹ä»¥åŠå¦‚ä½•é…ç½® Kibana å’Œå…¶ä»–èŠ‚ç‚¹åŠ å…¥é›†ç¾¤çš„è¯¦ç»†è¯´æ˜ã€‚âœ… Elasticsearch security features have been automatically configured!âœ… Authentication is enabled and cluster connections are encrypted.# è¿™æ˜¯ elastic ç”¨æˆ·çš„é»˜è®¤å¯†ç ã€‚ç³»ç»Ÿå»ºè®®ä½ ä½¿ç”¨ bin/elasticsearch-reset-password -u elastic å‘½ä»¤æ¥é‡ç½®æ­¤å¯†ç ã€‚â„¹ï¸ Password for the elastic user (reset with `bin/elasticsearch-reset-password -u elastic`): BNb=*qz6_M*mXL9uZiSP # è¿™é‡Œä¼šæ‰“å°å‡ºESè‡ªåŠ¨ç”Ÿæˆçš„å¯†ç # è¿™æ˜¯ HTTP CA è¯ä¹¦çš„ SHA-256 æŒ‡çº¹ã€‚CA è¯ä¹¦ç”¨äºéªŒè¯ HTTPS è¿æ¥çš„èº«ä»½ã€‚â„¹ï¸ HTTP CA certificate SHA-256 fingerprint: 3f141c16dfc6e165894bc1672084b220dcdd22ffe02116d51ac18003cfaa5a1d# æä¾›äº†å°† Kibana é…ç½®ä¸ºä½¿ç”¨æ­¤ Elasticsearch é›†ç¾¤çš„æ­¥éª¤ã€‚â„¹ï¸ Configure Kibana to use this cluster:# å¯åŠ¨ Kibana å¹¶æŒ‰ç…§ç»ˆç«¯ä¸­æ˜¾ç¤ºçš„é…ç½®é“¾æ¥è¿›è¡Œæ“ä½œã€‚â€¢ Run Kibana and click the configuration link in the terminal when Kibana starts.# å¤åˆ¶æä¾›çš„æ³¨å†Œä»¤ç‰Œï¼Œå¹¶åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ Kibana æ—¶ç²˜è´´æ­¤ä»¤ç‰Œã€‚ä»¤ç‰Œåœ¨æ¥ä¸‹æ¥çš„ 30 åˆ†é’Ÿå†…æœ‰æ•ˆã€‚# è¡¥å……è¯´æ˜ï¼šç”Ÿæˆæ–°çš„kibanaæ³¨å†Œä»¤ç‰Œï¼šbin/elasticsearch-create-enrollment-token -s kibanaâ€¢ Copy the following enrollment token and paste it into Kibana in your browser (valid for the next 30 minutes): eyJ2ZXIiOiI4LjE0LjAiLCJhZHIiOlsiMTAuMjUwLjAuMjM5OjkyMDAiXSwiZmdyIjoiM2YxNDFjMTZkZmM2ZTE2NTg5NGJjMTY3MjA4NGIyMjBkY2RkMjJmZmUwMjExNmQ1MWFjMTgwMDNjZmFhNWExZCIsImtleSI6ImFSWFBzcFVCTVVmc1d5aUJnbjBtOmRzbVBLQV95UXhDZkJpXzQyWDNEMVEifQ==# æä¾›äº†å°†æ–°çš„ Elasticsearch èŠ‚ç‚¹åŠ å…¥ç°æœ‰é›†ç¾¤çš„æ­¥éª¤ã€‚â„¹ï¸ Configure other nodes to join this cluster:# ä½¿ç”¨ bin/elasticsearch --enrollment-token &lt;token&gt; å‘½ä»¤å¯åŠ¨æ–°çš„ Elasticsearch èŠ‚ç‚¹ã€‚ä»¤ç‰Œåœ¨æ¥ä¸‹æ¥çš„ 30 åˆ†é’Ÿå†…æœ‰æ•ˆã€‚# è¡¥å……è¯´æ˜ï¼šç”Ÿæˆæ–°çš„èŠ‚ç‚¹æ³¨å†Œä»¤ç‰Œï¼šbin/elasticsearch-create-enrollment-token -s nodeâ€¢ Copy the following enrollment token and start new Elasticsearch nodes with `bin/elasticsearch --enrollment-token &lt;token&gt;` (valid for the next 30 minutes): eyJ2ZXIiOiI4LjE0LjAiLCJhZHIiOlsiMTAuMjUwLjAuMjM5OjkyMDAiXSwiZmdyIjoiM2YxNDFjMTZkZmM2ZTE2NTg5NGJjMTY3MjA4NGIyMjBkY2RkMjJmZmUwMjExNmQ1MWFjMTgwMDNjZmFhNWExZCIsImtleSI6ImF4WFBzcFVCTVVmc1d5aUJnbjFtOkFEallPdnpzUzh1MGJqOFpfVFE4a3cifQ==# å¦‚æœä½ åœ¨ Docker ä¸­è¿è¡Œ Elasticsearchï¼Œå¯ä»¥ä½¿ç”¨ docker run -e &quot;ENROLLMENT_TOKEN=&lt;token&gt;&quot; docker.elastic.co/elasticsearch/elasticsearch:8.17.3 å‘½ä»¤å¯åŠ¨æ–°èŠ‚ç‚¹ã€‚ If you&#x27;re running in Docker, copy the enrollment token and run: `docker run -e &quot;ENROLLMENT_TOKEN=&lt;token&gt;&quot; docker.elastic.co/elasticsearch/elasticsearch:8.17.3`â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” tokenä¿¡æ¯æœ‰æ•ˆæ—¶é—´åªæœ‰30åˆ†é’Ÿï¼Œè¶…æ—¶åå¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤é‡æ–°ç”Ÿæˆæ–°çš„token 123# è¿›å…¥node-1èŠ‚ç‚¹çš„ESå®‰è£…ç›®å½•ï¼Œæ­¤å‘½ä»¤ä¼šç”Ÿæˆæ–°çš„èŠ‚ç‚¹æ³¨å†Œä»¤ç‰Œbin/elasticsearch-create-enrollment-token -s nodeeyJ2ZXIiOiI4LjE0LjAiLCJhZHIiOlsiMTAuMjUwLjAuMjM5OjkyMDAiXSwiZmdyIjoiM2YxNDFjMTZkZmM2ZTE2NTg5NGJjMTY3MjA4NGIyMjBkY2RkMjJmZmUwMjExNmQ1MWFjMTgwMDNjZmFhNWExZCIsImtleSI6IlpoRVZ4NVVCeXRPajdLeTBqb3BvOmdHRW44ZW5mU0RDZHA2Yy1uSDF4eGcifQ== å¯åŠ¨node-2èŠ‚ç‚¹ï¼Œå¯åŠ¨æ—¶è¦å¸¦ä¸Štokenä¿¡æ¯ï¼Œnode-3ä¸æ­¤ä¸€æ ·ã€‚è¿™é‡Œè¦æ³¨æ„ï¼Œåªæœ‰ç¬¬ä¸€æ¬¡åŠ å…¥é›†ç¾¤æ—¶å¯åŠ¨æ‰éœ€è¦å¸¦ä¸Šæ³¨å†Œä»¤ç‰Œï¼Œåç»­å¯åŠ¨ä¸éœ€è¦tokenä¿¡æ¯ 123# è¿›å…¥node-2èŠ‚ç‚¹çš„ESå®‰è£…ç›®å½•ï¼Œæ­¤å‘½ä»¤ä¼šå¯åŠ¨ESèŠ‚ç‚¹ï¼Œå¹¶åŠ å…¥åˆ°é›†ç¾¤ä¸­# bin/elasticsearch --enrollment-token &lt;token&gt;bin/elasticsearch --enrollment-token eyJ2ZXIiOiI4LjE0LjAiLCJhZHIiOlsiMTAuMjUwLjAuMjM5OjkyMDAiXSwiZmdyIjoiM2YxNDFjMTZkZmM2ZTE2NTg5NGJjMTY3MjA4NGIyMjBkY2RkMjJmZmUwMjExNmQ1MWFjMTgwMDNjZmFhNWExZCIsImtleSI6IlpoRVZ4NVVCeXRPajdLeTBqb3BvOmdHRW44ZW5mU0RDZHA2Yy1uSDF4eGcifQ== åŠ å…¥é›†ç¾¤å¤±è´¥ åœ¨æ‰§è¡Œbin/elasticsearch --enrollment-token &lt;token&gt;æ—¶æœ‰å¯èƒ½ä¼šé‡åˆ°å¦‚ä¸‹å¼‚å¸¸ï¼š 1ERROR: Aborting auto configuration because the node keystore contains password settings already, with exit code 78 è¿™é€šå¸¸æ„å‘³ç€èŠ‚ç‚¹çš„ keystore å·²ç»åŒ…å«äº†å¯†ç è®¾ç½®ï¼Œå› æ­¤è‡ªåŠ¨é…ç½®è¿‡ç¨‹è¢«ä¸­æ­¢ã€‚ äº§ç”Ÿè¿™ç§é”™è¯¯çš„åŸå› å¤§æ¦‚ç‡æ˜¯å½“å‰ESæ˜¯ä»å·²ç»å®‰è£…å¥½çš„æœåŠ¡å™¨ä¸Šæ‹·è´è¿‡æ¥çš„ï¼Œè€Œä¸æ˜¯å…¨æ–°å®‰è£…çš„ï¼Œæ­¤æ—¶æˆ‘ä»¬é™¤äº†éœ€è¦æ¸…ç©ºdataç›®å½•å¤–ï¼Œè¿˜éœ€è¦åˆ é™¤ keystore ä¸­çš„å¯†ç  1234567891011# æŸ¥çœ‹keystoreä¸­çš„å¯†ç $ bin/elasticsearch-keystore listkeystore.seedxpack.security.http.ssl.keystore.secure_passwordxpack.security.transport.ssl.keystore.secure_passwordxpack.security.transport.ssl.truststore.secure_password# åˆ é™¤keystoreä¸­çš„å¯†ç $ bin/elasticsearch-keystore remove xpack.security.http.ssl.keystore.secure_password$ bin/elasticsearch-keystore remove xpack.security.transport.ssl.keystore.secure_password$ bin/elasticsearch-keystore remove xpack.security.transport.ssl.truststore.secure_password å†æ¬¡æ‰§è¡Œbin/elasticsearch --enrollment-token &lt;token&gt;å³å¯ã€‚ å¦å¤–è¿˜å¯èƒ½é‡åˆ°å¦‚ä¸‹æŠ¥é”™ï¼š 1ERROR: Aborting enrolling to cluster. Could not communicate with the node on any of the addresses from the enrollment token. All of [10.250.0.239:9200] were attempted., with exit code 69 è¿™æ˜¯ç”±äºtokenè¿‡æœŸäº†ï¼Œé‡æ–°ç”Ÿæˆæ–°çš„tokenå³å¯ å¯åŠ¨æˆåŠŸåä¼šåœ¨node-2çš„é…ç½®æ–‡ä»¶ä¸­çœ‹åˆ°å¦‚ä¸‹é…ç½®ä¿¡æ¯ 123456789101112131415161718192021222324252627282930#----------------------- BEGIN SECURITY AUTO CONFIGURATION -----------------------## The following settings, TLS certificates, and keys have been automatically# generated to configure Elasticsearch security features on 24-03-2025 07:45:11## --------------------------------------------------------------------------------# Enable security featuresxpack.security.enabled: truexpack.security.enrollment.enabled: true# Enable encryption for HTTP API client connections, such as Kibana, Logstash, and Agentsxpack.security.http.ssl: enabled: true keystore.path: certs/http.p12# Enable encryption and mutual authentication between cluster nodesxpack.security.transport.ssl: enabled: true verification_mode: certificate keystore.path: certs/transport.p12 truststore.path: certs/transport.p12# Discover existing nodes in the clusterdiscovery.seed_hosts: [&quot;10.250.0.239:9300&quot;] # è¿™é‡Œæ˜¯node-1èŠ‚ç‚¹çš„IPåœ°å€å’Œç«¯å£å·## è€Œnode-3è¿™é‡Œä¼šæ˜¾ç¤ºå¦‚ä¸‹ä¿¡æ¯ï¼Œä¹Ÿå°±æ˜¯è¶Šæ˜¯åæ¥åŠ å…¥è¿›æ¥çš„ï¼Œè¿™é‡Œå°±ä¼šåŠ ä¸Šä¹‹å‰æ‰€æœ‰èŠ‚ç‚¹çš„IPåœ°å€å’Œç«¯å£å·discovery.seed_hosts: [&quot;10.250.0.239:9300&quot;, &quot;10.250.0.17:9300&quot;] # è¿™é‡Œæ˜¯node-1å’Œnode-2èŠ‚ç‚¹çš„IPåœ°å€å’Œç«¯å£å·#----------------------- END SECURITY AUTO CONFIGURATION ------------------------- éªŒè¯é›†ç¾¤çŠ¶æ€ å¯åŠ¨å®Œæˆåï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹é›†ç¾¤çŠ¶æ€ï¼š 1234567891011121314151617181920212223242526# æŸ¥çœ‹é›†ç¾¤çŠ¶æ€$ curl -u elastic:123456 --cacert /usr/local/elasticsearch/elasticsearch-8.17.3/config/certs/http_ca.crt https://127.0.0.1:9200/_cluster/health?pretty&#123; &quot;cluster_name&quot; : &quot;test-elk&quot;, &quot;status&quot; : &quot;green&quot;, &quot;timed_out&quot; : false, &quot;number_of_nodes&quot; : 3, &quot;number_of_data_nodes&quot; : 3, &quot;active_primary_shards&quot; : 31, &quot;active_shards&quot; : 62, &quot;relocating_shards&quot; : 0, &quot;initializing_shards&quot; : 0, &quot;unassigned_shards&quot; : 0, &quot;unassigned_primary_shards&quot; : 0, &quot;delayed_unassigned_shards&quot; : 0, &quot;number_of_pending_tasks&quot; : 0, &quot;number_of_in_flight_fetch&quot; : 0, &quot;task_max_waiting_in_queue_millis&quot; : 0, &quot;active_shards_percent_as_number&quot; : 100.0&#125;# æŸ¥çœ‹èŠ‚ç‚¹ä¿¡æ¯ï¼Œå…¶ä¸­ * è¡¨ç¤ºå½“å‰èŠ‚ç‚¹ä¸ºmasterèŠ‚ç‚¹$ curl -u elastic:123456 --cacert /usr/local/elasticsearch/elasticsearch-8.17.3/config/certs/http_ca.crt https://127.0.0.1:9200/_cat/nodes?vip heap.percent ram.percent cpu load_1m load_5m load_15m node.role master name10.250.0.17 8 63 28 1.03 0.38 0.14 cdfhilmrstw - node-210.250.0.173 9 63 22 0.86 0.37 0.19 cdfhilmrstw - node-310.250.0.239 9 78 6 0.38 0.22 0.16 cdfhilmrstw * node-1 é‡è¦è¯´æ˜ é›†ç¾¤ä¸€æ—¦åˆ›å»ºå®Œæˆï¼Œåˆ™è‡³å°‘éœ€è¦ä¸¤ä¸ªèŠ‚ç‚¹è¿è¡Œæ‰èƒ½ä¿è¯é›†ç¾¤å¯ç”¨æ€§ï¼Œå¦åˆ™é›†ç¾¤å°†æ— æ³•è¿è¡Œã€‚ å¦‚æœnode-1èŠ‚ç‚¹æŒ‚äº†ï¼Œé›†ç¾¤ä¸­å‰©ä¸‹çš„ä¸¤ä¸ªèŠ‚ç‚¹ä¼šé‡æ–°é€‰æ‹©ä¸€ä¸ªæ–°çš„masterèŠ‚ç‚¹ï¼Œä¸ä¼šå½±å“é›†ç¾¤çš„å¯ç”¨æ€§ã€‚ ä¸€æ—¦å…³é—­node-1ï¼Œåˆ™é‡æ–°å¯åŠ¨node-1èŠ‚ç‚¹å‰è¦ä¿®æ”¹å…¶é…ç½®æ–‡ä»¶ï¼Œå¦åˆ™æ— æ³•å¯åŠ¨æˆåŠŸã€‚ 1234# æ³¨é‡Šæ‰è¯¥é…ç½®# cluster.initial_master_nodes: [&quot;node-1&quot;]# åŠ å…¥è¯¥é…ç½®ï¼Œå®é™…ä¸Šæœ€å¥½åœ¨é‡å¯æ¯ä¸ªèŠ‚ç‚¹å‰ï¼Œå°†æ¯ä¸ªèŠ‚ç‚¹éƒ½é…ç½®ä¸ºè¿™æ ·discovery.seed_hosts: [&quot;10.250.0.239:9300&quot;, &quot;10.250.0.17:9300&quot;, &quot;10.250.0.173:9300&quot;] Kibanaå…³è”ESé›†ç¾¤ Kibana å…³è”å•èŠ‚ç‚¹ESå‚è€ƒ linuxä¸‹å®‰è£…Kibanaï¼Œåœ¨æ­¤åŸºç¡€ä¸Šå¯¹é…ç½®æ–‡ä»¶è¿›è¡Œå¦‚ä¸‹ä¿®æ”¹ï¼š 1234# å…³è”é›†ç¾¤çš„èŠ‚ç‚¹åœ°å€ï¼Œå°†é›†ç¾¤å†…æ‰€æœ‰èŠ‚ç‚¹çš„åœ°å€éƒ½é…ç½®åˆ°è¯¥å­—æ®µä¸­elasticsearch.hosts: [&#x27;https://10.250.0.239:9200&#x27;, &#x27;https://10.250.0.173:9200&#x27;, &#x27;https://10.250.0.17:9200&#x27;]# å…³è”é›†ç¾¤çš„è¾“å‡ºåœ°å€ï¼Œå°†é›†ç¾¤å†…æ‰€æœ‰èŠ‚ç‚¹çš„åœ°å€éƒ½é…ç½®åˆ°è¯¥å­—æ®µä¸­xpack.fleet.outputs: [&#123;id: fleet-default-output, name: default, is_default: true, is_default_monitoring: true, type: elasticsearch, hosts: [&#x27;https://10.250.0.239:9200&#x27;, &#x27;https://10.250.0.173:9200&#x27;, &#x27;https://10.250.0.17:9200&#x27;], ca_trusted_fingerprint: 3f141c16dfc6e165894bc1672084b220dcdd22ffe02116d51ac18003cfaa5a1d&#125;] é‡å¯Kibana åªè¦ä¿è¯é›†ç¾¤å†…è‡³å°‘æœ‰ä¸¤ä¸ªESèŠ‚ç‚¹å·¥ä½œæ­£å¸¸ï¼Œå³å¯æ­£å¸¸è®¿é—®Kibana nginxåå‘ä»£ç†ESé›†ç¾¤ 123456789101112131415161718192021222324252627282930313233343536373839vim /etc/nginx/conf.d/es.conf # æ·»åŠ å¦‚ä¸‹å†…å®¹upstream es &#123; server 10.250.0.239:9200; server 10.250.0.173:9200; server 10.250.0.17:9200;&#125;server &#123; listen 8888; server_name localhost es.domain; location / &#123; proxy_pass https://es; #è¿™ä¸ªåç§°å’Œè¦ä¸Šé¢ upstream es å¯¹åº”ï¼Œæ³¨æ„è¿™é‡Œæ˜¯ https åè®® proxy_redirect default; proxy_http_version 1.1; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto $scheme; proxy_max_temp_file_size 0; #this is the maximum upload size client_max_body_size 10m; client_body_buffer_size 128k; proxy_connect_timeout 90; proxy_send_timeout 90; proxy_read_timeout 90; proxy_buffering off; proxy_request_buffering off; # Required for HTTP CLI commands proxy_set_header Connection &quot;&quot;; # Clear for keepalive &#125;&#125;# é‡å¯nginxsystemctl restart nginx# è®¿é—®ESé›†ç¾¤curl -u elastic:123456 http://127.0.0.1:8888/_cluster/health?pretty","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç»å¦‚ä½•åœ¨linuxä¸‹å®‰è£…Elasticsearché›†ç¾¤(ä¸‰èŠ‚ç‚¹) Elasticsearchç‰ˆæœ¬8.17.3 å•èŠ‚ç‚¹å®‰è£…å‚è€ƒlinuxä¸‹å®‰è£…Elasticsearchï¼Œæœ¬æ–‡åœ¨æ­¤åŸºç¡€ä¸Šå®Œæˆé›†ç¾¤å®‰è£…","date_published":"2025-03-24T13:30:05.000Z","tags":["æŠ€æœ¯","elastic","elasticsearch","elasticsearch"]},{"id":"https://blog.hanqunfeng.com/2025/03/21/kibana-01-install/","url":"https://blog.hanqunfeng.com/2025/03/21/kibana-01-install/","title":"linuxä¸‹å®‰è£…Kibana","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç»å¦‚ä½•åœ¨linuxä¸‹å®‰è£…Kibana</p>\n</li>\n<li class=\"lvl-2\">\n<p>Kibanaç‰ˆæœ¬8.17.3</p>\n</li>\n<li class=\"lvl-2\">\n<p>Elasticsearchç‰ˆæœ¬8.17.3ï¼Œ<a href=\"/2025/03/20/elasticsearch-01-install/\" title=\"linuxä¸‹å®‰è£…Elasticsearch\">linuxä¸‹å®‰è£…Elasticsearch</a></p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"ä¸‹è½½\">ä¸‹è½½</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¸‹è½½åœ°å€ï¼š<a href=\"https://www.elastic.co/cn/downloads/past-releases#kibana\">https://www.elastic.co/cn/downloads/past-releases#kibana</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>é€‰æ‹©å¯¹åº”çš„ç‰ˆæœ¬ï¼šè¿™é‡Œé€‰æ‹©å½“å‰çš„æœ€æ–°ç‰ˆ<code>Kibana 8.17.3</code>ï¼Œä¹‹åé€‰æ‹©å¯¹åº”çš„æ“ä½œç³»ç»Ÿ<code>LINUX X86_64</code></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget https://artifacts.elastic.co/downloads/kibana/kibana-8.17.3-linux-x86_64.tar.gz</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¸‹è½½å®Œæˆåè§£å‹åˆ°<code>/usr/local/kibana</code>ç›®å½•ä¸‹ï¼Œè§£å‹å‘½ä»¤å¦‚ä¸‹ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">mkdir</span> /usr/local/kibana</span><br><span class=\"line\">tar -zxvf kibana-8.17.3-linux-x86_64.tar.gz -C /usr/local/kibana</span><br></pre></td></tr></table></figure>\n<h2 id=\"åˆ›å»ºå¯åŠ¨ç”¨æˆ·\">åˆ›å»ºå¯åŠ¨ç”¨æˆ·</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>elasticsearchå’Œkibanaéƒ½ä¸èƒ½ç”¨rootç”¨æˆ·å¯åŠ¨</p>\n</li>\n<li class=\"lvl-2\">\n<p>åˆ›å»ºç”¨æˆ·<code>elastic</code>ï¼Œå¹¶è®¾ç½®å¯†ç ï¼Œè¿™ä¸€æ­¥æˆ‘ä»¬åœ¨å®‰è£…elasticsearchçš„æ—¶å€™å·²ç»é…ç½®è¿‡äº†ï¼Œè¿™é‡Œå°±ä¸å†èµ˜è¿°äº†</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">useradd elastic</span><br><span class=\"line\">passwd elastic</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¿®æ”¹kibanaå®‰è£…ç›®å½•çš„ç”¨æˆ·æƒé™</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">chown</span> -R elastic:elastic /usr/local/kibana</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ‡æ¢åˆ°elasticç”¨æˆ·ä¸‹æ‰§è¡Œå‘½ä»¤</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">su - elastic</span><br></pre></td></tr></table></figure>\n<h2 id=\"å…³è”Kibanaå’ŒElasticsearch\">å…³è”Kibanaå’ŒElasticsearch</h2>\n<h3 id=\"æ–¹æ³•1ï¼šæ³¨å†Œä»¤ç‰ŒTokenå…³è”-å®˜æ–¹æ¨è\">æ–¹æ³•1ï¼šæ³¨å†Œä»¤ç‰ŒTokenå…³è”[å®˜æ–¹æ¨è]</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ³¨æ„æ­¤æ–¹æ³•è¦æ±‚<code>elasticsearch</code>å¿…é¡»å¼€å¯å®‰å…¨è®¤è¯ï¼Œè€Œä¸”<code>xpack.security.http.ssl.enabled</code> å¿…é¡»è®¾ç½®ä¸º true</p>\n</li>\n<li class=\"lvl-2\">\n<p>é…ç½®å¯åŠ¨æ–‡ä»¶ï¼Œè¿›å…¥<code>/usr/local/kibana/kibana-8.17.3/config</code>ç›®å½•ï¼Œæ ¹æ®éœ€è¦ä¿®æ”¹<code>kibana.yml</code>æ–‡ä»¶</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ç«¯å£ï¼Œé»˜è®¤5601</span></span><br><span class=\"line\">server.port: 5601</span><br><span class=\"line\"><span class=\"comment\"># kibanaæœåŠ¡å™¨çš„ipï¼Œ4ä¸ª0è¡¨ç¤ºä»»ä½•ä¸€ä¸ªç½‘å¡éƒ½å¯ä»¥è®¿é—®ï¼Œé»˜è®¤ä¸ºlocalhost</span></span><br><span class=\"line\">server.host: <span class=\"string\">&quot;0.0.0.0&quot;</span></span><br><span class=\"line\"><span class=\"comment\"># ä¸­æ–‡ï¼Œé»˜è®¤ä¸º en</span></span><br><span class=\"line\">i18n.locale: <span class=\"string\">&quot;zh-CN&quot;</span></span><br><span class=\"line\"><span class=\"comment\"># é…ç½®httpsï¼Œé»˜è®¤å€¼ä¸º certificate</span></span><br><span class=\"line\">elasticsearch.ssl.verificationMode: <span class=\"string\">&#x27;certificate&#x27;</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¿˜è®°å¾—æˆ‘ä»¬ç¬¬ä¸€æ¬¡å¯åŠ¨ESæ—¶æ—¥å¿—ä¿¡æ¯ä¸­çš„æœ‰å…³kibanaæ³¨å†Œä»¤ç‰Œçš„ä¿¡æ¯å—ï¼Ÿé‚£ä¸ªä»¤ç‰Œåªæœ‰30åˆ†é’Ÿæœ‰æ•ˆæœŸï¼Œè¿‡æœŸåå¯ä»¥è¿›å…¥elasticsearchå®‰è£…ç›®å½•ï¼Œé‡æ–°åˆ›å»ºkibanaæ³¨å†Œä»¤ç‰Œ</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">bin/elasticsearch-create-enrollment-token -s kibana</span><br><span class=\"line\"><span class=\"comment\"># è¾“å‡ºç»“æœå¦‚ä¸‹</span></span><br><span class=\"line\">eyJ2ZXIiOiI4LjE0LjAiLCJhZHIiOlsiMTAuMjUwLjAuMjM5OjkyMDAiXSwiZmdyIjoiM2YxNDFjMTZkZmM2ZTE2NTg5NGJjMTY3MjA4NGIyMjBkY2RkMjJmZmUwMjExNmQ1MWFjMTgwMDNjZmFhNWExZCIsImtleSI6ImxlTWh1SlVCcVJWQUw4WGFjMk1HOkVHYTYxcWlfVEotQWQ1Y3dQdXcyckEifQ==</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¿›å…¥kibanaå®‰è£…ç›®å½•ï¼Œé€šè¿‡ä¸‹é¢çš„å‘½ä»¤æ³¨å†Œ Kibana</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># bin/kibana-setup --enrollment-token &lt;enrollment-token&gt;</span></span><br><span class=\"line\">bin/kibana-setup --enrollment-token eyJ2ZXIiOiI4LjE0LjAiLCJhZHIiOlsiMTAuMjUwLjAuMjM5OjkyMDAiXSwiZmdyIjoiM2YxNDFjMTZkZmM2ZTE2NTg5NGJjMTY3MjA4NGIyMjBkY2RkMjJmZmUwMjExNmQ1MWFjMTgwMDNjZmFhNWExZCIsImtleSI6ImxlTWh1SlVCcVJWQUw4WGFjMk1HOkVHYTYxcWlfVEotQWQ1Y3dQdXcyckEifQ==</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ³¨å†ŒæˆåŠŸä¼šè¾“å‡º</span></span><br><span class=\"line\">âœ” Kibana configured successfully.</span><br></pre></td></tr></table></figure>\n<div class=\"tips\">\n<ul class=\"lvl-1\">\n<li class=\"lvl-2\">\n<p>å¦‚æœESçš„<code>xpack.security.http.ssl.enabled</code> è®¾ç½®ä¸º falseï¼Œæ³¨å†ŒKibanaæ—¶ä¼šæŠ¥é”™ï¼ŒæŠ¥é”™ä¿¡æ¯å¦‚ä¸‹ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">âœ– Unable to connect to Elasticsearch with the provided enrollment token: Unable to connect to any of the provided hosts.</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-1\">\n<li class=\"lvl-2\">æ³¨å†ŒæˆåŠŸåä¼šåœ¨<code>/usr/local/kibana/kibana-8.17.3/config/kibana.yml</code>æ–‡ä»¶ä¸­æ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># This section was automatically generated during setup.</span></span><br><span class=\"line\"><span class=\"comment\"># ESæœåŠ¡URL</span></span><br><span class=\"line\">elasticsearch.hosts: [<span class=\"string\">&#x27;https://10.250.0.239:9200&#x27;</span>] <span class=\"comment\"># 10.250.0.239æ˜¯æœ¬æœºçš„å†…ç½‘IP</span></span><br><span class=\"line\"><span class=\"comment\"># æŒ‡å®šç”¨äºè®¤è¯çš„æœåŠ¡è´¦æˆ·ä»¤ç‰Œ</span></span><br><span class=\"line\">elasticsearch.serviceAccountToken: AAEAAWVsYXN0aWMva2liYW5hL2Vucm9sbC1wcm9jZXNzLXRva2VuLTE3NDI1NTA5ODU0MTg6Z2lJUERGaG1TR3VNcC1sb0RyMnMydw</span><br><span class=\"line\"><span class=\"comment\"># æŒ‡å®šç”¨æ¥éªŒè¯ Elasticsearch æœåŠ¡å™¨ SSL è¯ä¹¦çš„ CA è¯ä¹¦è·¯å¾„</span></span><br><span class=\"line\">elasticsearch.ssl.certificateAuthorities: [/usr/local/kibana/kibana-8.17.3/data/ca_1742550986498.crt]</span><br><span class=\"line\"><span class=\"comment\"># é…ç½® Fleet çš„è¾“å‡ºç›®æ ‡ã€‚Fleet æ˜¯ Elastic çš„ä¸€ä¸ªç®¡ç†å·¥å…·ï¼Œç”¨äºç®¡ç†å’Œç›‘æ§å¼¹æ€§æ ˆï¼ˆElastic Stackï¼‰ã€‚è¿™ä¸ªé…ç½®å®šä¹‰äº† Fleet é»˜è®¤è¾“å‡ºçš„ç›®æ ‡ï¼Œå³ Elasticsearchã€‚</span></span><br><span class=\"line\">xpack.fleet.outputs: [&#123;<span class=\"built_in\">id</span>: fleet-default-output, name: default, is_default: <span class=\"literal\">true</span>, is_default_monitoring: <span class=\"literal\">true</span>, <span class=\"built_in\">type</span>: elasticsearch, hosts: [<span class=\"string\">&#x27;https://10.250.0.239:9200&#x27;</span>], ca_trusted_fingerprint: 3f141c16dfc6e165894bc1672084b220dcdd22ffe02116d51ac18003cfaa5a1d&#125;]</span><br><span class=\"line\">  <span class=\"comment\"># id: fleet-default-outputï¼šè¾“å‡ºçš„å”¯ä¸€æ ‡è¯†ç¬¦ã€‚</span></span><br><span class=\"line\">  <span class=\"comment\"># name: defaultï¼šè¾“å‡ºçš„åç§°ã€‚</span></span><br><span class=\"line\">  <span class=\"comment\"># is_default: trueï¼šè¡¨ç¤ºè¿™æ˜¯é»˜è®¤è¾“å‡ºã€‚</span></span><br><span class=\"line\">  <span class=\"comment\"># is_default_monitoring: trueï¼šè¡¨ç¤ºè¿™æ˜¯é»˜è®¤çš„ç›‘æ§è¾“å‡ºã€‚</span></span><br><span class=\"line\">  <span class=\"comment\"># type: elasticsearchï¼šè¾“å‡ºç±»å‹æ˜¯ Elasticsearchã€‚</span></span><br><span class=\"line\">  <span class=\"comment\"># hosts: [&#x27;https://10.250.0.239:9200&#x27;]ï¼šè¿æ¥åˆ°çš„ Elasticsearch ä¸»æœºåœ°å€ã€‚</span></span><br><span class=\"line\">  <span class=\"comment\"># ca_trusted_fingerprint: 3f141c16dfc6e165894bc1672084b220dcdd22ffe02116d51ac18003cfaa5a1dï¼šCA è¯ä¹¦çš„ä¿¡ä»»æŒ‡çº¹ï¼Œç”¨äºéªŒè¯ CA è¯ä¹¦çš„èº«ä»½ã€‚</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"æ–¹æ³•2ï¼šç”¨æˆ·åå¯†ç å…³è”\">æ–¹æ³•2ï¼šç”¨æˆ·åå¯†ç å…³è”</h3>\n<ul class=\"lvl-1\">\n<li class=\"lvl-2\">\n<p>åˆ›å»ºkibanaè¿æ¥elasticsearchçš„ç”¨æˆ·å¯†ç ï¼Œä¸èƒ½ç”¨ <code>elastic</code> è¿™ä¸ªç”¨æˆ·ï¼Œå› ä¸ºè¿™ä¸ªæ˜¯è¶…çº§ç”¨æˆ·ï¼Œè¦ä½¿ç”¨ kibana_system ç”¨æˆ·</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># è¿›å…¥elasticsearchå®‰è£…ç›®å½•ï¼Œæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤é‡ç½® kibana_system ç”¨æˆ·çš„å¯†ç </span></span><br><span class=\"line\">bin/elasticsearch-reset-password -u kibana_system -i</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-1\">\n<li class=\"lvl-2\">\n<p>é…ç½®å¯åŠ¨æ–‡ä»¶ï¼Œè¿›å…¥<code>/usr/local/kibana/kibana-8.17.3/config</code>ç›®å½•ï¼Œä¿®æ”¹<code>kibana.yml</code>æ–‡ä»¶</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ç«¯å£ï¼Œé»˜è®¤5601</span></span><br><span class=\"line\">server.port: 5601</span><br><span class=\"line\"><span class=\"comment\"># kibanaæœåŠ¡å™¨çš„ipï¼Œ4ä¸ª0è¡¨ç¤ºä»»ä½•ä¸€ä¸ªç½‘å¡éƒ½å¯ä»¥è®¿é—®</span></span><br><span class=\"line\">server.host: <span class=\"string\">&quot;0.0.0.0&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># elasctisearchå…³è”</span></span><br><span class=\"line\"><span class=\"comment\"># ESæœåŠ¡åœ°å€ï¼Œæ³¨æ„è¿™é‡Œæ˜¯https</span></span><br><span class=\"line\">elasticsearch.hosts: [<span class=\"string\">&quot;https://10.250.0.239:9200&quot;</span>]</span><br><span class=\"line\"><span class=\"comment\"># æŒ‡å®šhttpsè¯ä¹¦è·¯å¾„ï¼Œå¯ä»¥ä»ESçš„è¯ä¹¦ç›®å½•ä¸­è·å–</span></span><br><span class=\"line\">elasticsearch.ssl.certificateAuthorities: [<span class=\"string\">&quot;/usr/local/elasticsearch/elasticsearch-8.17.3/config/certs/http_ca.crt&quot;</span>]</span><br><span class=\"line\"><span class=\"comment\"># ç”¨æˆ·åå¯†ç </span></span><br><span class=\"line\">elasticsearch.username: <span class=\"string\">&quot;kibana_system&quot;</span></span><br><span class=\"line\">elasticsearch.password: <span class=\"string\">&quot;123456&quot;</span></span><br><span class=\"line\"><span class=\"comment\"># ä¸­æ–‡</span></span><br><span class=\"line\">i18n.locale: <span class=\"string\">&quot;zh-CN&quot;</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-1\">\n<li class=\"lvl-2\">\n<p>å¦‚æœESæ²¡æœ‰å¼€å¯å®‰å…¨è®¤è¯ï¼Œåˆ™åªéœ€è¦è¿›è¡Œå¦‚ä¸‹é…ç½®å³å¯ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ç«¯å£ï¼Œé»˜è®¤5601</span></span><br><span class=\"line\">server.port: 5601</span><br><span class=\"line\"><span class=\"comment\"># kibanaæœåŠ¡å™¨çš„ipï¼Œ4ä¸ª0è¡¨ç¤ºä»»ä½•ä¸€ä¸ªç½‘å¡éƒ½å¯ä»¥è®¿é—®</span></span><br><span class=\"line\">server.host: <span class=\"string\">&quot;0.0.0.0&quot;</span></span><br><span class=\"line\"><span class=\"comment\"># ESæœåŠ¡åœ°å€ï¼Œæ³¨æ„è¿™é‡Œæ˜¯http</span></span><br><span class=\"line\">elasticsearch.hosts: [<span class=\"string\">&quot;http://10.250.0.239:9200&quot;</span>]</span><br><span class=\"line\"><span class=\"comment\"># ä¸­æ–‡</span></span><br><span class=\"line\">i18n.locale: <span class=\"string\">&quot;zh-CN&quot;</span></span><br></pre></td></tr></table></figure>\n</div>\n<h2 id=\"å¯åŠ¨KibanaæœåŠ¡\">å¯åŠ¨KibanaæœåŠ¡</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¿›å…¥<code>/usr/local/kibana/kibana-8.17.3</code>ç›®å½•ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤å¯åŠ¨æœåŠ¡</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">./bin/kibana</span><br><span class=\"line\"><span class=\"comment\"># åå°å¯åŠ¨ï¼Œå¹¶å°†æ—¥å¿—å†™å…¥åˆ°logs/kibana.log</span></span><br><span class=\"line\"><span class=\"built_in\">nohup</span> bin/kibana &gt; logs/kibana.log 2&gt;&amp;1 &amp;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è®¿é—®åœ°å€ï¼š<a href=\"http://localhost:5601\">http://localhost:5601</a>ï¼Œè¿™é‡Œæ³¨æ„ç™»å½•ç”¨æˆ·éœ€è¦ä½¿ç”¨ï¼š<code>elastic</code>ï¼Œè€Œä¸æ˜¯<code>kibana_system</code>ã€‚</p>\n</li>\n</ul>\n<h2 id=\"å¯åŠ¨KibanaæœåŠ¡åçš„æ—¥å¿—å‘Šè­¦\">å¯åŠ¨KibanaæœåŠ¡åçš„æ—¥å¿—å‘Šè­¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>KibanaæœåŠ¡å¯åŠ¨åï¼Œä¼šåœ¨<code>/usr/local/kibana/kibana-8.17.3/logs/kibana.log</code>æ–‡ä»¶ä¸­è®°å½•ä¸€äº›é”™è¯¯æ—¥å¿—ï¼Œå¦‚æœå‡ºç°é”™è¯¯ï¼Œå¯ä»¥æŸ¥çœ‹æ—¥å¿—ï¼Œè§£å†³é”™è¯¯ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[WARN ][plugins.fleet] xpack.encryptedSavedObjects.encryptionKey is not configured, private key passphrase is being stored <span class=\"keyword\">in</span> plain text</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¿™ä¸ªè­¦å‘Šä¿¡æ¯è¡¨æ˜ Kibana çš„æŸäº›æ’ä»¶ï¼ˆå¦‚ Fleetï¼‰åœ¨ç¼ºå°‘ <code>xpack.encryptedSavedObjects.encryptionKey</code> é…ç½®çš„æƒ…å†µä¸‹è¿è¡Œï¼Œå¯¼è‡´ç§é’¥å¯†ç å’Œä»£ç†å¸è½½ä»¤ç‰Œä»¥æ˜æ–‡å½¢å¼å­˜å‚¨ã€‚ä¸ºäº†æé«˜å®‰å…¨æ€§ï¼Œå»ºè®®é…ç½®ä¸€ä¸ªåŠ å¯†å¯†é’¥ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ç”ŸæˆåŠ å¯†å¯†é’¥</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ bin/kibana-encryption-keys generate</span><br><span class=\"line\">Kibana is currently running with legacy OpenSSL providers enabled! For details and instructions on how to <span class=\"built_in\">disable</span> see https://www.elastic.co/guide/en/kibana/8.17/production.html#openssl-legacy-provider</span><br><span class=\"line\"><span class=\"comment\">## Kibana Encryption Key Generation Utility</span></span><br><span class=\"line\"></span><br><span class=\"line\">The <span class=\"string\">&#x27;generate&#x27;</span> <span class=\"built_in\">command</span> guides you through the process of setting encryption keys <span class=\"keyword\">for</span>:</span><br><span class=\"line\"></span><br><span class=\"line\">xpack.encryptedSavedObjects.encryptionKey</span><br><span class=\"line\">    Used to encrypt stored objects such as dashboards and visualizations</span><br><span class=\"line\">    https://www.elastic.co/guide/en/kibana/current/xpack-security-secure-saved-objects.html#xpack-security-secure-saved-objects</span><br><span class=\"line\"></span><br><span class=\"line\">xpack.reporting.encryptionKey</span><br><span class=\"line\">    Used to encrypt saved reports</span><br><span class=\"line\">    https://www.elastic.co/guide/en/kibana/current/reporting-settings-kb.html#general-reporting-settings</span><br><span class=\"line\"></span><br><span class=\"line\">xpack.security.encryptionKey</span><br><span class=\"line\">    Used to encrypt session information</span><br><span class=\"line\">    https://www.elastic.co/guide/en/kibana/current/security-settings-kb.html#security-session-and-cookie-settings</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">Already defined settings are ignored and can be regenerated using the --force flag.  Check the documentation links <span class=\"keyword\">for</span> instructions on how to rotate encryption keys.</span><br><span class=\"line\">Definitions should be <span class=\"built_in\">set</span> <span class=\"keyword\">in</span> the kibana.yml used configure Kibana.</span><br><span class=\"line\"></span><br><span class=\"line\">Settings:</span><br><span class=\"line\">xpack.encryptedSavedObjects.encryptionKey: 47967e4b78bd26decb622b78f0ddd324</span><br><span class=\"line\">xpack.reporting.encryptionKey: 78b5f603f3b0e6ad76c13a0f5d00cde0</span><br><span class=\"line\">xpack.security.encryptionKey: 8aa7f4dfbc4e734a2a9f92a2730b36af</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>é…ç½® Kibana ä»¥ä½¿ç”¨åŠ å¯†å¯†é’¥ï¼Œæ·»åŠ åˆ° kibana.yml æ–‡ä»¶ä¸­ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">xpack.encryptedSavedObjects.encryptionKey: 47967e4b78bd26decb622b78f0ddd324</span><br><span class=\"line\">xpack.reporting.encryptionKey: 78b5f603f3b0e6ad76c13a0f5d00cde0</span><br><span class=\"line\">xpack.security.encryptionKey: 8aa7f4dfbc4e734a2a9f92a2730b36af</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>é‡å¯ Kibana æœåŠ¡ ä»¥åº”ç”¨æ›´æ”¹ã€‚</p>\n</li>\n</ul>\n<h2 id=\"Kibana-è‡ªå¯åŠ¨è„šæœ¬\">Kibana è‡ªå¯åŠ¨è„šæœ¬</h2>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åˆ›å»ºæœåŠ¡æ–‡ä»¶</span></span><br><span class=\"line\">$ vim /usr/lib/systemd/system/kibana.service</span><br><span class=\"line\">[Unit]</span><br><span class=\"line\">Description=kibana</span><br><span class=\"line\">Documentation=https://www.elastic.co</span><br><span class=\"line\">After=es.service</span><br><span class=\"line\"></span><br><span class=\"line\">[Service]</span><br><span class=\"line\">Type=simple</span><br><span class=\"line\">PrivateTmp=<span class=\"literal\">true</span></span><br><span class=\"line\"><span class=\"comment\"># æŒ‡å®šESç”¨æˆ·</span></span><br><span class=\"line\">User=elastic</span><br><span class=\"line\">Group=elastic</span><br><span class=\"line\">LimitNOFILE=100000</span><br><span class=\"line\">LimitNPROC=100000</span><br><span class=\"line\">Restart=<span class=\"built_in\">yes</span></span><br><span class=\"line\"><span class=\"comment\"># å¯åŠ¨å‘½ä»¤</span></span><br><span class=\"line\">ExecStart=/usr/local/kibana/kibana-8.17.3/bin/kibana</span><br><span class=\"line\">ExecRestart=/bin/kill -s HUP <span class=\"variable\">$MAINPID</span></span><br><span class=\"line\">ExecStop=/bin/kill -s QUIT <span class=\"variable\">$MAINPID</span></span><br><span class=\"line\"></span><br><span class=\"line\">[Install]</span><br><span class=\"line\">WantedBy=multi-user.target</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># é‡æ–°åŠ è½½</span></span><br><span class=\"line\">$ systemctl daemon-reload</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å¯åŠ¨</span></span><br><span class=\"line\">$ systemctl start kibana</span><br><span class=\"line\"><span class=\"comment\"># åœæ­¢</span></span><br><span class=\"line\">$ systemctl stop kibana</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹çŠ¶æ€</span></span><br><span class=\"line\">$ systemctl status kibana</span><br><span class=\"line\"><span class=\"comment\"># è®¾ç½®å¼€æœºå¯åŠ¨</span></span><br><span class=\"line\">$ systemctl <span class=\"built_in\">enable</span> kibana</span><br></pre></td></tr></table></figure>","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç»å¦‚ä½•åœ¨linuxä¸‹å®‰è£…Kibana Kibanaç‰ˆæœ¬8.17.3 Elasticsearchç‰ˆæœ¬8.17.3ï¼Œlinuxä¸‹å®‰è£…Elasticsearch ä¸‹è½½ ä¸‹è½½åœ°å€ï¼šhttps://www.elastic.co/cn/downloads/past-releases#kibana é€‰æ‹©å¯¹åº”çš„ç‰ˆæœ¬ï¼šè¿™é‡Œé€‰æ‹©å½“å‰çš„æœ€æ–°ç‰ˆKibana 8.17.3ï¼Œä¹‹åé€‰æ‹©å¯¹åº”çš„æ“ä½œç³»ç»ŸLINUX X86_64 1wget https://artifacts.elastic.co/downloads/kibana/kibana-8.17.3-linux-x86_64.tar.gz ä¸‹è½½å®Œæˆåè§£å‹åˆ°/usr/local/kibanaç›®å½•ä¸‹ï¼Œè§£å‹å‘½ä»¤å¦‚ä¸‹ï¼š 12mkdir /usr/local/kibanatar -zxvf kibana-8.17.3-linux-x86_64.tar.gz -C /usr/local/kibana åˆ›å»ºå¯åŠ¨ç”¨æˆ· elasticsearchå’Œkibanaéƒ½ä¸èƒ½ç”¨rootç”¨æˆ·å¯åŠ¨ åˆ›å»ºç”¨æˆ·elasticï¼Œå¹¶è®¾ç½®å¯†ç ï¼Œè¿™ä¸€æ­¥æˆ‘ä»¬åœ¨å®‰è£…elasticsearchçš„æ—¶å€™å·²ç»é…ç½®è¿‡äº†ï¼Œè¿™é‡Œå°±ä¸å†èµ˜è¿°äº† 12useradd elasticpasswd elastic ä¿®æ”¹kibanaå®‰è£…ç›®å½•çš„ç”¨æˆ·æƒé™ 1chown -R elastic:elastic /usr/local/kibana åˆ‡æ¢åˆ°elasticç”¨æˆ·ä¸‹æ‰§è¡Œå‘½ä»¤ 1su - elastic å…³è”Kibanaå’ŒElasticsearch æ–¹æ³•1ï¼šæ³¨å†Œä»¤ç‰ŒTokenå…³è”[å®˜æ–¹æ¨è] æ³¨æ„æ­¤æ–¹æ³•è¦æ±‚elasticsearchå¿…é¡»å¼€å¯å®‰å…¨è®¤è¯ï¼Œè€Œä¸”xpack.security.http.ssl.enabled å¿…é¡»è®¾ç½®ä¸º true é…ç½®å¯åŠ¨æ–‡ä»¶ï¼Œè¿›å…¥/usr/local/kibana/kibana-8.17.3/configç›®å½•ï¼Œæ ¹æ®éœ€è¦ä¿®æ”¹kibana.ymlæ–‡ä»¶ 12345678# ç«¯å£ï¼Œé»˜è®¤5601server.port: 5601# kibanaæœåŠ¡å™¨çš„ipï¼Œ4ä¸ª0è¡¨ç¤ºä»»ä½•ä¸€ä¸ªç½‘å¡éƒ½å¯ä»¥è®¿é—®ï¼Œé»˜è®¤ä¸ºlocalhostserver.host: &quot;0.0.0.0&quot;# ä¸­æ–‡ï¼Œé»˜è®¤ä¸º eni18n.locale: &quot;zh-CN&quot;# é…ç½®httpsï¼Œé»˜è®¤å€¼ä¸º certificateelasticsearch.ssl.verificationMode: &#x27;certificate&#x27; è¿˜è®°å¾—æˆ‘ä»¬ç¬¬ä¸€æ¬¡å¯åŠ¨ESæ—¶æ—¥å¿—ä¿¡æ¯ä¸­çš„æœ‰å…³kibanaæ³¨å†Œä»¤ç‰Œçš„ä¿¡æ¯å—ï¼Ÿé‚£ä¸ªä»¤ç‰Œåªæœ‰30åˆ†é’Ÿæœ‰æ•ˆæœŸï¼Œè¿‡æœŸåå¯ä»¥è¿›å…¥elasticsearchå®‰è£…ç›®å½•ï¼Œé‡æ–°åˆ›å»ºkibanaæ³¨å†Œä»¤ç‰Œ 123bin/elasticsearch-create-enrollment-token -s kibana# è¾“å‡ºç»“æœå¦‚ä¸‹eyJ2ZXIiOiI4LjE0LjAiLCJhZHIiOlsiMTAuMjUwLjAuMjM5OjkyMDAiXSwiZmdyIjoiM2YxNDFjMTZkZmM2ZTE2NTg5NGJjMTY3MjA4NGIyMjBkY2RkMjJmZmUwMjExNmQ1MWFjMTgwMDNjZmFhNWExZCIsImtleSI6ImxlTWh1SlVCcVJWQUw4WGFjMk1HOkVHYTYxcWlfVEotQWQ1Y3dQdXcyckEifQ== è¿›å…¥kibanaå®‰è£…ç›®å½•ï¼Œé€šè¿‡ä¸‹é¢çš„å‘½ä»¤æ³¨å†Œ Kibana 12345# bin/kibana-setup --enrollment-token &lt;enrollment-token&gt;bin/kibana-setup --enrollment-token eyJ2ZXIiOiI4LjE0LjAiLCJhZHIiOlsiMTAuMjUwLjAuMjM5OjkyMDAiXSwiZmdyIjoiM2YxNDFjMTZkZmM2ZTE2NTg5NGJjMTY3MjA4NGIyMjBkY2RkMjJmZmUwMjExNmQ1MWFjMTgwMDNjZmFhNWExZCIsImtleSI6ImxlTWh1SlVCcVJWQUw4WGFjMk1HOkVHYTYxcWlfVEotQWQ1Y3dQdXcyckEifQ==# æ³¨å†ŒæˆåŠŸä¼šè¾“å‡ºâœ” Kibana configured successfully. å¦‚æœESçš„xpack.security.http.ssl.enabled è®¾ç½®ä¸º falseï¼Œæ³¨å†ŒKibanaæ—¶ä¼šæŠ¥é”™ï¼ŒæŠ¥é”™ä¿¡æ¯å¦‚ä¸‹ï¼š 1âœ– Unable to connect to Elasticsearch with the provided enrollment token: Unable to connect to any of the provided hosts. æ³¨å†ŒæˆåŠŸåä¼šåœ¨/usr/local/kibana/kibana-8.17.3/config/kibana.ymlæ–‡ä»¶ä¸­æ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š 12345678910111213141516# This section was automatically generated during setup.# ESæœåŠ¡URLelasticsearch.hosts: [&#x27;https://10.250.0.239:9200&#x27;] # 10.250.0.239æ˜¯æœ¬æœºçš„å†…ç½‘IP# æŒ‡å®šç”¨äºè®¤è¯çš„æœåŠ¡è´¦æˆ·ä»¤ç‰Œelasticsearch.serviceAccountToken: AAEAAWVsYXN0aWMva2liYW5hL2Vucm9sbC1wcm9jZXNzLXRva2VuLTE3NDI1NTA5ODU0MTg6Z2lJUERGaG1TR3VNcC1sb0RyMnMydw# æŒ‡å®šç”¨æ¥éªŒè¯ Elasticsearch æœåŠ¡å™¨ SSL è¯ä¹¦çš„ CA è¯ä¹¦è·¯å¾„elasticsearch.ssl.certificateAuthorities: [/usr/local/kibana/kibana-8.17.3/data/ca_1742550986498.crt]# é…ç½® Fleet çš„è¾“å‡ºç›®æ ‡ã€‚Fleet æ˜¯ Elastic çš„ä¸€ä¸ªç®¡ç†å·¥å…·ï¼Œç”¨äºç®¡ç†å’Œç›‘æ§å¼¹æ€§æ ˆï¼ˆElastic Stackï¼‰ã€‚è¿™ä¸ªé…ç½®å®šä¹‰äº† Fleet é»˜è®¤è¾“å‡ºçš„ç›®æ ‡ï¼Œå³ Elasticsearchã€‚xpack.fleet.outputs: [&#123;id: fleet-default-output, name: default, is_default: true, is_default_monitoring: true, type: elasticsearch, hosts: [&#x27;https://10.250.0.239:9200&#x27;], ca_trusted_fingerprint: 3f141c16dfc6e165894bc1672084b220dcdd22ffe02116d51ac18003cfaa5a1d&#125;] # id: fleet-default-outputï¼šè¾“å‡ºçš„å”¯ä¸€æ ‡è¯†ç¬¦ã€‚ # name: defaultï¼šè¾“å‡ºçš„åç§°ã€‚ # is_default: trueï¼šè¡¨ç¤ºè¿™æ˜¯é»˜è®¤è¾“å‡ºã€‚ # is_default_monitoring: trueï¼šè¡¨ç¤ºè¿™æ˜¯é»˜è®¤çš„ç›‘æ§è¾“å‡ºã€‚ # type: elasticsearchï¼šè¾“å‡ºç±»å‹æ˜¯ Elasticsearchã€‚ # hosts: [&#x27;https://10.250.0.239:9200&#x27;]ï¼šè¿æ¥åˆ°çš„ Elasticsearch ä¸»æœºåœ°å€ã€‚ # ca_trusted_fingerprint: 3f141c16dfc6e165894bc1672084b220dcdd22ffe02116d51ac18003cfaa5a1dï¼šCA è¯ä¹¦çš„ä¿¡ä»»æŒ‡çº¹ï¼Œç”¨äºéªŒè¯ CA è¯ä¹¦çš„èº«ä»½ã€‚ æ–¹æ³•2ï¼šç”¨æˆ·åå¯†ç å…³è” åˆ›å»ºkibanaè¿æ¥elasticsearchçš„ç”¨æˆ·å¯†ç ï¼Œä¸èƒ½ç”¨ elastic è¿™ä¸ªç”¨æˆ·ï¼Œå› ä¸ºè¿™ä¸ªæ˜¯è¶…çº§ç”¨æˆ·ï¼Œè¦ä½¿ç”¨ kibana_system ç”¨æˆ· 12# è¿›å…¥elasticsearchå®‰è£…ç›®å½•ï¼Œæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤é‡ç½® kibana_system ç”¨æˆ·çš„å¯†ç bin/elasticsearch-reset-password -u kibana_system -i é…ç½®å¯åŠ¨æ–‡ä»¶ï¼Œè¿›å…¥/usr/local/kibana/kibana-8.17.3/configç›®å½•ï¼Œä¿®æ”¹kibana.ymlæ–‡ä»¶ 123456789101112131415# ç«¯å£ï¼Œé»˜è®¤5601server.port: 5601# kibanaæœåŠ¡å™¨çš„ipï¼Œ4ä¸ª0è¡¨ç¤ºä»»ä½•ä¸€ä¸ªç½‘å¡éƒ½å¯ä»¥è®¿é—®server.host: &quot;0.0.0.0&quot;# elasctisearchå…³è”# ESæœåŠ¡åœ°å€ï¼Œæ³¨æ„è¿™é‡Œæ˜¯httpselasticsearch.hosts: [&quot;https://10.250.0.239:9200&quot;]# æŒ‡å®šhttpsè¯ä¹¦è·¯å¾„ï¼Œå¯ä»¥ä»ESçš„è¯ä¹¦ç›®å½•ä¸­è·å–elasticsearch.ssl.certificateAuthorities: [&quot;/usr/local/elasticsearch/elasticsearch-8.17.3/config/certs/http_ca.crt&quot;]# ç”¨æˆ·åå¯†ç elasticsearch.username: &quot;kibana_system&quot;elasticsearch.password: &quot;123456&quot;# ä¸­æ–‡i18n.locale: &quot;zh-CN&quot; å¦‚æœESæ²¡æœ‰å¼€å¯å®‰å…¨è®¤è¯ï¼Œåˆ™åªéœ€è¦è¿›è¡Œå¦‚ä¸‹é…ç½®å³å¯ï¼š 12345678# ç«¯å£ï¼Œé»˜è®¤5601server.port: 5601# kibanaæœåŠ¡å™¨çš„ipï¼Œ4ä¸ª0è¡¨ç¤ºä»»ä½•ä¸€ä¸ªç½‘å¡éƒ½å¯ä»¥è®¿é—®server.host: &quot;0.0.0.0&quot;# ESæœåŠ¡åœ°å€ï¼Œæ³¨æ„è¿™é‡Œæ˜¯httpelasticsearch.hosts: [&quot;http://10.250.0.239:9200&quot;]# ä¸­æ–‡i18n.locale: &quot;zh-CN&quot; å¯åŠ¨KibanaæœåŠ¡ è¿›å…¥/usr/local/kibana/kibana-8.17.3ç›®å½•ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤å¯åŠ¨æœåŠ¡ 123./bin/kibana# åå°å¯åŠ¨ï¼Œå¹¶å°†æ—¥å¿—å†™å…¥åˆ°logs/kibana.lognohup bin/kibana &gt; logs/kibana.log 2&gt;&amp;1 &amp; è®¿é—®åœ°å€ï¼šhttp://localhost:5601ï¼Œè¿™é‡Œæ³¨æ„ç™»å½•ç”¨æˆ·éœ€è¦ä½¿ç”¨ï¼šelasticï¼Œè€Œä¸æ˜¯kibana_systemã€‚ å¯åŠ¨KibanaæœåŠ¡åçš„æ—¥å¿—å‘Šè­¦ KibanaæœåŠ¡å¯åŠ¨åï¼Œä¼šåœ¨/usr/local/kibana/kibana-8.17.3/logs/kibana.logæ–‡ä»¶ä¸­è®°å½•ä¸€äº›é”™è¯¯æ—¥å¿—ï¼Œå¦‚æœå‡ºç°é”™è¯¯ï¼Œå¯ä»¥æŸ¥çœ‹æ—¥å¿—ï¼Œè§£å†³é”™è¯¯ã€‚ 1[WARN ][plugins.fleet] xpack.encryptedSavedObjects.encryptionKey is not configured, private key passphrase is being stored in plain text è¿™ä¸ªè­¦å‘Šä¿¡æ¯è¡¨æ˜ Kibana çš„æŸäº›æ’ä»¶ï¼ˆå¦‚ Fleetï¼‰åœ¨ç¼ºå°‘ xpack.encryptedSavedObjects.encryptionKey é…ç½®çš„æƒ…å†µä¸‹è¿è¡Œï¼Œå¯¼è‡´ç§é’¥å¯†ç å’Œä»£ç†å¸è½½ä»¤ç‰Œä»¥æ˜æ–‡å½¢å¼å­˜å‚¨ã€‚ä¸ºäº†æé«˜å®‰å…¨æ€§ï¼Œå»ºè®®é…ç½®ä¸€ä¸ªåŠ å¯†å¯†é’¥ã€‚ ç”ŸæˆåŠ å¯†å¯†é’¥ 1234567891011121314151617181920212223242526$ bin/kibana-encryption-keys generateKibana is currently running with legacy OpenSSL providers enabled! For details and instructions on how to disable see https://www.elastic.co/guide/en/kibana/8.17/production.html#openssl-legacy-provider## Kibana Encryption Key Generation UtilityThe &#x27;generate&#x27; command guides you through the process of setting encryption keys for:xpack.encryptedSavedObjects.encryptionKey Used to encrypt stored objects such as dashboards and visualizations https://www.elastic.co/guide/en/kibana/current/xpack-security-secure-saved-objects.html#xpack-security-secure-saved-objectsxpack.reporting.encryptionKey Used to encrypt saved reports https://www.elastic.co/guide/en/kibana/current/reporting-settings-kb.html#general-reporting-settingsxpack.security.encryptionKey Used to encrypt session information https://www.elastic.co/guide/en/kibana/current/security-settings-kb.html#security-session-and-cookie-settingsAlready defined settings are ignored and can be regenerated using the --force flag. Check the documentation links for instructions on how to rotate encryption keys.Definitions should be set in the kibana.yml used configure Kibana.Settings:xpack.encryptedSavedObjects.encryptionKey: 47967e4b78bd26decb622b78f0ddd324xpack.reporting.encryptionKey: 78b5f603f3b0e6ad76c13a0f5d00cde0xpack.security.encryptionKey: 8aa7f4dfbc4e734a2a9f92a2730b36af é…ç½® Kibana ä»¥ä½¿ç”¨åŠ å¯†å¯†é’¥ï¼Œæ·»åŠ åˆ° kibana.yml æ–‡ä»¶ä¸­ï¼š 123xpack.encryptedSavedObjects.encryptionKey: 47967e4b78bd26decb622b78f0ddd324xpack.reporting.encryptionKey: 78b5f603f3b0e6ad76c13a0f5d00cde0xpack.security.encryptionKey: 8aa7f4dfbc4e734a2a9f92a2730b36af é‡å¯ Kibana æœåŠ¡ ä»¥åº”ç”¨æ›´æ”¹ã€‚ Kibana è‡ªå¯åŠ¨è„šæœ¬ 1234567891011121314151617181920212223242526272829303132333435# åˆ›å»ºæœåŠ¡æ–‡ä»¶$ vim /usr/lib/systemd/system/kibana.service[Unit]Description=kibanaDocumentation=https://www.elastic.coAfter=es.service[Service]Type=simplePrivateTmp=true# æŒ‡å®šESç”¨æˆ·User=elasticGroup=elasticLimitNOFILE=100000LimitNPROC=100000Restart=yes# å¯åŠ¨å‘½ä»¤ExecStart=/usr/local/kibana/kibana-8.17.3/bin/kibanaExecRestart=/bin/kill -s HUP $MAINPIDExecStop=/bin/kill -s QUIT $MAINPID[Install]WantedBy=multi-user.target# é‡æ–°åŠ è½½$ systemctl daemon-reload# å¯åŠ¨$ systemctl start kibana# åœæ­¢$ systemctl stop kibana# æŸ¥çœ‹çŠ¶æ€$ systemctl status kibana# è®¾ç½®å¼€æœºå¯åŠ¨$ systemctl enable kibana","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç»å¦‚ä½•åœ¨linuxä¸‹å®‰è£…Kibana Kibanaç‰ˆæœ¬8.17.3 Elasticsearchç‰ˆæœ¬8.17.3ï¼Œlinuxä¸‹å®‰è£…Elasticsearch","date_published":"2025-03-21T13:30:05.000Z","tags":["æŠ€æœ¯","elastic","kibana","elasticsearch","kibana"]},{"id":"https://blog.hanqunfeng.com/2025/03/20/elasticsearch-01-install/","url":"https://blog.hanqunfeng.com/2025/03/20/elasticsearch-01-install/","title":"linuxä¸‹å®‰è£…Elasticsearch","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç»å¦‚ä½•åœ¨linuxä¸‹å®‰è£…Elasticsearch</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://www.elastic.co/guide/en/elasticsearch/reference/8.17/index.html\">Elasticsearch</a>ç‰ˆæœ¬8.17.3</p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"ä¸‹è½½\">ä¸‹è½½</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¸‹è½½åœ°å€ï¼š<a href=\"https://www.elastic.co/cn/downloads/past-releases#elasticsearch\">https://www.elastic.co/cn/downloads/past-releases#elasticsearch</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>é€‰æ‹©å¯¹åº”çš„ç‰ˆæœ¬ï¼šè¿™é‡Œé€‰æ‹©å½“å‰çš„æœ€æ–°ç‰ˆ<code>Elasticsearch 8.17.3</code>ï¼Œä¹‹åé€‰æ‹©å¯¹åº”çš„æ“ä½œç³»ç»Ÿ<code>LINUX X86_64</code></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-8.17.3-linux-x86_64.tar.gz</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¸‹è½½å®Œæˆåè§£å‹åˆ°<code>/usr/local/elasticsearch</code>ç›®å½•ä¸‹ï¼Œè§£å‹å‘½ä»¤å¦‚ä¸‹ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">mkdir</span> /usr/local/elasticsearch</span><br><span class=\"line\">tar -zxvf elasticsearch-8.17.3-linux-x86_64.tar.gz -C /usr/local/elasticsearch</span><br></pre></td></tr></table></figure>\n<h2 id=\"ElasticSearchç›®å½•ç»“æ„\">ElasticSearchç›®å½•ç»“æ„</h2>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">bin        <span class=\"comment\"># è„šæœ¬æ–‡ä»¶ï¼ŒåŒ…æ‹¬å¯åŠ¨elasticsearchï¼Œå®‰è£…æ’ä»¶ï¼Œè¿è¡Œç»Ÿè®¡æ•°æ®ç­‰</span></span><br><span class=\"line\">config     <span class=\"comment\"># é…ç½®æ–‡ä»¶ç›®å½•ï¼Œå¦‚elasticsearché…ç½®ã€è§’è‰²é…ç½®ã€jvmé…ç½®ã€è¯ä¹¦ç­‰ã€‚</span></span><br><span class=\"line\">data       <span class=\"comment\"># æ•°æ®ç›®å½•ï¼Œé»˜è®¤å€¼ $ES_HOME/dataï¼ŒåŒ…å«èŠ‚ç‚¹ã€åˆ†ç‰‡ã€ç´¢å¼•ã€æ–‡æ¡£çš„æ‰€æœ‰æ•°æ®ï¼Œç”Ÿäº§ç¯å¢ƒå»ºè®®ä¿®æ”¹</span></span><br><span class=\"line\">jdk        <span class=\"comment\"># JDKç›®å½•ï¼Œç”¨äºè¿è¡ŒElasticsearchï¼Œ7.xä»¥åè‡ªå¸¦</span></span><br><span class=\"line\">lib        <span class=\"comment\"># Elasticsearchä¾èµ–çš„JARåŒ…</span></span><br><span class=\"line\">logs       <span class=\"comment\"># æ—¥å¿—ç›®å½•ï¼Œé»˜è®¤å€¼ $ES_HOME/logsï¼Œç”Ÿäº§ç¯å¢ƒå»ºè®®ä¿®æ”¹</span></span><br><span class=\"line\">modules    <span class=\"comment\"># åŒ…å«æ‰€æœ‰çš„Elasticsearchæ¨¡å—ï¼Œå¦‚Clusterã€Discoveryã€Indicesç­‰</span></span><br><span class=\"line\">plugins    <span class=\"comment\"># å·²å®‰è£…æ’ä»¶ç›®å½•</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"åˆ›å»ºå¯åŠ¨ç”¨æˆ·\">åˆ›å»ºå¯åŠ¨ç”¨æˆ·</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>elasticsearchå’Œkibanaéƒ½ä¸èƒ½ç”¨rootç”¨æˆ·å¯åŠ¨</p>\n</li>\n<li class=\"lvl-2\">\n<p>åˆ›å»ºç”¨æˆ·<code>elastic</code>ï¼Œå¹¶è®¾ç½®å¯†ç </p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">useradd elastic</span><br><span class=\"line\">passwd elastic</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¿®æ”¹elasticsearchå®‰è£…ç›®å½•çš„ç”¨æˆ·æƒé™</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">chown</span> -R elastic:elastic /usr/local/elasticsearch</span><br></pre></td></tr></table></figure>\n<h2 id=\"é…ç½®ç¯å¢ƒå˜é‡\">é…ç½®ç¯å¢ƒå˜é‡</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¿›å…¥elasticç”¨æˆ·ä¸»ç›®å½•ï¼Œ/home/elasticç›®å½•ä¸‹ï¼Œè®¾ç½®ç”¨æˆ·çº§åˆ«çš„ç¯å¢ƒå˜é‡</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åˆ‡æ¢åˆ°elasticç”¨æˆ·</span></span><br><span class=\"line\">su - elastic</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>vim .bash_profile</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Elasticsearchå®‰è£…ç›®å½•ï¼Œå®ƒç”¨äºå®šä½Elasticsearchçš„é…ç½®æ–‡ä»¶ã€æ’ä»¶å’Œå…¶ä»–ç›¸å…³èµ„æºã€‚</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> ES_HOME=/usr/local/elasticsearch/elasticsearch-8.17.3</span><br><span class=\"line\"><span class=\"comment\"># Elasticsearchä½¿ç”¨çš„JDKå®‰è£…ç›®å½•ï¼Œåœ¨å¯åŠ¨Elasticsearchæ—¶ï¼Œå®ƒä¼šæ£€æŸ¥ES_JAVA_HOMEç¯å¢ƒå˜é‡å¹¶ä½¿ç”¨å…¶ä¸­çš„Javaè·¯å¾„ã€‚</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> ES_JAVA_HOME=/usr/local/elasticsearch/elasticsearch-8.17.3/jdk/</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ä½¿é…ç½®ç”Ÿæ•ˆ</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">source</span> .bash_profile</span><br></pre></td></tr></table></figure>\n<h2 id=\"é…ç½®JVMå‚æ•°ï¼ˆå¯é€‰ï¼‰\">é…ç½®JVMå‚æ•°ï¼ˆå¯é€‰ï¼‰</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ESæ¯”è¾ƒè€—å†…å­˜ï¼Œå»ºè®®è™šæ‹Ÿæœº4Gæˆ–ä»¥ä¸Šå†…å­˜ï¼Œjvm1gä»¥ä¸Šçš„å†…å­˜åˆ†é…</p>\n</li>\n<li class=\"lvl-2\">\n<p>è¿›å…¥<code>/usr/local/elasticsearch/elasticsearch-8.17.3/config</code>ç›®å½•ï¼Œä¿®æ”¹<code>jvm.options</code>æ–‡ä»¶ï¼Œè°ƒæ•´jvmå †å†…å­˜å¤§å°</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">-Xms4g <span class=\"comment\"># è®¾ç½®æœ€å°å †å†…å­˜ï¼Œé»˜è®¤4gï¼Œä¸èƒ½å°äº1g</span></span><br><span class=\"line\">-Xmx4g <span class=\"comment\"># è®¾ç½®æœ€å¤§å †å†…å­˜ï¼Œé»˜è®¤4gï¼ŒXmxä¸è¦è¶…è¿‡æœºå™¨å†…å­˜çš„50%ï¼Œä¸è¦è¶…è¿‡30g</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"åˆ›å»ºæ•°æ®å’Œæ—¥å¿—å­˜å‚¨ç›®å½•\">åˆ›å»ºæ•°æ®å’Œæ—¥å¿—å­˜å‚¨ç›®å½•</h2>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åˆ‡æ¢åˆ°elasticç”¨æˆ·</span></span><br><span class=\"line\">su - elastic</span><br><span class=\"line\"><span class=\"comment\"># åˆ›å»ºç›®å½•</span></span><br><span class=\"line\"><span class=\"built_in\">mkdir</span> /usr/local/elasticsearch/data /usr/local/elasticsearch/log</span><br></pre></td></tr></table></figure>\n<h2 id=\"é…ç½®å¯åŠ¨æ–‡ä»¶\">é…ç½®å¯åŠ¨æ–‡ä»¶</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¦‚æœæ˜¯æœ¬åœ°å¼€å‘ç¯å¢ƒï¼Œä¹Ÿå¯ä»¥ä¸åšä»»ä½•ä¿®æ”¹ç›´æ¥å¯åŠ¨ï¼Œå› ä¸ºå¤§éƒ¨åˆ†é…ç½®é¡¹éƒ½æœ‰é»˜è®¤å€¼ï¼Œä½†ä¸ºäº†æ›´å¥½çš„æ§åˆ¶ESï¼Œæ¨èæŒ‰å¦‚ä¸‹æ–¹å¼è¿›è¡Œé…ç½®</p>\n</li>\n<li class=\"lvl-2\">\n<p>è¿›å…¥<code>/usr/local/elasticsearch/elasticsearch-8.17.3/config</code>ç›®å½•ï¼Œä¿®æ”¹<code>elasticsearch.yml</code>æ–‡ä»¶</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># é›†ç¾¤åç§°ï¼Œå¤šä¸ªèŠ‚ç‚¹å¦‚æœè¦ç»„æˆåŒä¸€ä¸ªé›†ç¾¤ï¼Œé‚£ä¹ˆé›†ç¾¤åç§°ä¸€å®šè¦é…ç½®æˆç›¸åŒï¼Œé»˜è®¤å€¼elasticsearch</span></span><br><span class=\"line\">cluster.name: test-elk</span><br><span class=\"line\"><span class=\"comment\"># èŠ‚ç‚¹åç§°ï¼Œé»˜è®¤å€¼å½“å‰èŠ‚ç‚¹éƒ¨ç½²æ‰€åœ¨æœºå™¨çš„ä¸»æœºå</span></span><br><span class=\"line\">node.name: node-1</span><br><span class=\"line\"><span class=\"comment\"># æ•°æ®å­˜å‚¨è·¯å¾„ï¼Œé»˜è®¤å€¼ $ES_HOME/data</span></span><br><span class=\"line\">path.data: /usr/local/elasticsearch/data</span><br><span class=\"line\"><span class=\"comment\"># æ—¥å¿—å­˜å‚¨è·¯å¾„ï¼Œé»˜è®¤å€¼ $ES_HOME/logs</span></span><br><span class=\"line\">path.logs: /usr/local/elasticsearch/logs</span><br><span class=\"line\"><span class=\"comment\"># é…ç½®ESå¯åŠ¨æ—¶æ˜¯å¦è¿›è¡Œå†…å­˜é”å®šæ£€æŸ¥ï¼Œé»˜è®¤å€¼trueï¼Œæœ¬æœºå†…å­˜æ¯”è¾ƒå°æ—¶è®¾ç½®ä¸ºfalse</span></span><br><span class=\"line\">bootstrap.memory_lock: <span class=\"literal\">false</span></span><br><span class=\"line\"><span class=\"comment\"># å…è®¸é€šè¿‡ä»»ä½•åœ°å€è®¿é—®ï¼Œå¼€å¯è¿œç¨‹è®¿é—®</span></span><br><span class=\"line\">network.host: 0.0.0.0</span><br><span class=\"line\"><span class=\"comment\"># é…ç½®å½“å‰ESèŠ‚ç‚¹å¯¹å¤–æä¾›æœåŠ¡çš„httpç«¯å£ï¼Œé»˜è®¤ 9200</span></span><br><span class=\"line\">http.port: 9200</span><br><span class=\"line\"><span class=\"comment\"># é…ç½®å½“å‰ESèŠ‚ç‚¹å¯¹å¤–æä¾›æœåŠ¡çš„tcpç«¯å£ï¼Œé»˜è®¤ 9300</span></span><br><span class=\"line\">transport.port: 9300</span><br><span class=\"line\"><span class=\"comment\"># é›†ç¾¤å†…çš„ä¸»æœºåˆ—è¡¨ï¼Œå•èŠ‚ç‚¹å¯åŠ¨æ—¶å¯ä»¥ä¸é…ç½®</span></span><br><span class=\"line\"><span class=\"comment\"># discovery.seed_hosts: [&quot;127.0.0.1&quot;]</span></span><br><span class=\"line\"><span class=\"comment\"># ç¬¬ä¸€æ¬¡å¯åŠ¨æ—¶éœ€è¦å‚ä¸é€‰ä¸»çš„èŠ‚ç‚¹åç§°</span></span><br><span class=\"line\">cluster.initial_master_nodes: [<span class=\"string\">&quot;node-1&quot;</span>]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#è§£å†³è·¨åŸŸé—®é¢˜</span></span><br><span class=\"line\">http.cors.enabled: <span class=\"literal\">true</span></span><br><span class=\"line\">http.cors.allow-origin: <span class=\"string\">&quot;*&quot;</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"å¯åŠ¨ElasticSearchæœåŠ¡\">å¯åŠ¨ElasticSearchæœåŠ¡</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¿›å…¥<code>/usr/local/elasticsearch/elasticsearch-8.17.3</code>ç›®å½•ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤å¯åŠ¨æœåŠ¡</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">./bin/elasticsearch</span><br><span class=\"line\"><span class=\"comment\"># åå°å¯åŠ¨</span></span><br><span class=\"line\">./bin/elasticsearch -d</span><br></pre></td></tr></table></figure>\n<h2 id=\"ESå¯åŠ¨å‰çš„å¼•å¯¼æ£€æŸ¥\">ESå¯åŠ¨å‰çš„å¼•å¯¼æ£€æŸ¥</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ESå¯åŠ¨æ—¶ï¼Œé»˜è®¤ä¼šè¿›è¡Œå¼•å¯¼æ£€æŸ¥ï¼Œæ‰€è°“å¼•å¯¼æ£€æŸ¥å°±æ˜¯åœ¨æœåŠ¡å¯åŠ¨ä¹‹å‰å¯¹ä¸€äº›é‡è¦çš„é…ç½®é¡¹è¿›è¡Œæ£€æŸ¥ï¼Œæ£€æŸ¥å…¶é…ç½®å€¼æ˜¯å¦æ˜¯åˆç†çš„ã€‚å¼•å¯¼æ£€æŸ¥åŒ…æ‹¬å¯¹JVMå¤§å°ã€å†…å­˜é”ã€è™šæ‹Ÿå†…å­˜ã€æœ€å¤§çº¿ç¨‹æ•°ã€é›†ç¾¤å‘ç°ç›¸å…³é…ç½®ç­‰ç›¸å…³çš„æ£€æŸ¥ï¼Œå¦‚æœæŸä¸€é¡¹æˆ–è€…å‡ é¡¹çš„é…ç½®ä¸åˆç†ï¼ŒESä¼šæ‹’ç»å¯åŠ¨æœåŠ¡ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å¦‚æœå¯åŠ¨æœåŠ¡æ—¶ï¼ŒæŠ¥ä»¥ä¸‹é”™è¯¯ï¼Œåˆ™éœ€è¦è§£å†³å¼•å¯¼æ£€æŸ¥ä¸­çš„é—®é¢˜</p>\n</li>\n<li class=\"lvl-2\">\n<p>1.max virtual memory areas vm.max_map_count [65530] is too low, increase to at least [262144];</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-6\">åŸå› ï¼šæœ€å¤§è™šæ‹Ÿå†…å­˜å¤ªå°,è°ƒå¤§ç³»ç»Ÿçš„è™šæ‹Ÿå†…å­˜</li>\n<li class=\"lvl-6\">è§£å†³åŠæ³•ï¼š</li>\n</ul>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># rootç”¨æˆ·ä¸‹è¿è¡Œ</span></span><br><span class=\"line\">vim /etc/sysctl.conf</span><br><span class=\"line\"><span class=\"comment\"># è¿½åŠ ä»¥ä¸‹å†…å®¹ï¼š</span></span><br><span class=\"line\">vm.max_map_count=262144</span><br><span class=\"line\"><span class=\"comment\"># ä¿å­˜é€€å‡ºä¹‹åæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š</span></span><br><span class=\"line\">sysctl -p</span><br></pre></td></tr></table></figure>\n</li>\n<li class=\"lvl-2\">\n<p>2.max file descriptors [4096] for elasticsearch process is too low, increase to at least [65536]</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-6\">åŸå› ï¼šæ–‡ä»¶æè¿°ç¬¦å¤ªå°ï¼Œè°ƒå¤§ç³»ç»Ÿçš„æ–‡ä»¶æè¿°ç¬¦</li>\n<li class=\"lvl-6\">è§£å†³åŠæ³•ï¼š</li>\n</ul>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># rootç”¨æˆ·ä¸‹è¿è¡Œ</span></span><br><span class=\"line\">vim /etc/security/limits.conf</span><br><span class=\"line\"><span class=\"comment\"># æœ«å°¾æ·»åŠ å¦‚ä¸‹é…ç½®ï¼š</span></span><br><span class=\"line\">* soft nofile 65536</span><br><span class=\"line\">* hard nofile 65536</span><br><span class=\"line\">* soft <span class=\"built_in\">nproc</span> 4096</span><br><span class=\"line\">* hard <span class=\"built_in\">nproc</span> 4096</span><br></pre></td></tr></table></figure>\n</li>\n<li class=\"lvl-2\">\n<p>å¦‚æœåªæ˜¯å•èŠ‚ç‚¹çš„å¼€å‘ç¯å¢ƒï¼Œåˆ™å¯ä»¥å…³é—­å¼•å¯¼æ£€æŸ¥ï¼Œç”Ÿæˆç¯å¢ƒä¸å»ºè®®è¿™æ ·åšï¼Œå› ä¸ºå…³é—­å¼•å¯¼æ£€æŸ¥åï¼ŒESæœåŠ¡å°†æ— æ³•ä¿è¯é›†ç¾¤çš„é«˜å¯ç”¨æ€§ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># è¿›å…¥elasticsearchå®‰è£…ç›®å½•</span></span><br><span class=\"line\">vim config/elasticsearch.yml</span><br><span class=\"line\"><span class=\"comment\"># æ·»åŠ å¦‚ä¸‹é…ç½®ï¼š</span></span><br><span class=\"line\"><span class=\"comment\"># æŒ‡å®šèŠ‚ç‚¹ä¸ºå•èŠ‚ç‚¹ï¼Œå¯ä»¥ç»•è¿‡å¼•å¯¼æ£€æŸ¥</span></span><br><span class=\"line\">discovery.type: single-node</span><br></pre></td></tr></table></figure>\n<h2 id=\"æœåŠ¡æ­£å¸¸å¯åŠ¨åä»ç„¶ä¸èƒ½æ­£å¸¸è®¿é—®\">æœåŠ¡æ­£å¸¸å¯åŠ¨åä»ç„¶ä¸èƒ½æ­£å¸¸è®¿é—®</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è®¿é—®æœåŠ¡</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl http://127.0.0.1:9200</span><br><span class=\"line\">curl: (52) Empty reply from server</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æŸ¥çœ‹æ—¥å¿—<code>/usr/local/elasticsearch/elasticsearch-8.17.3/logs/test-elk.log</code>ï¼Œå‘ç°æŠ¥å¦‚ä¸‹è­¦å‘Šï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[WARN ][o.e.h.n.Netty4HttpServerTransport] [node-1] received plaintext http traffic on an https channel, closing connection Netty4HttpChannel&#123;localAddress=/127.0.0.1:9200, remoteAddress=/127.0.0.1:38426&#125;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åŸå› æ˜¯ESåœ¨å¯åŠ¨æœåŠ¡æ—¶é»˜è®¤å¼€å¯äº† <code>X-Pack å®‰å…¨åŠŸèƒ½</code>ï¼ŒæŸ¥çœ‹é…ç½®æ–‡ä»¶<code>/usr/local/elasticsearch/elasticsearch-8.17.3/config/elasticsearch.yml</code>ï¼Œå‘ç°é…ç½®é¡¹<code>xpack.security.xxx</code>ç›¸å…³é…ç½®é¡¹è¢«è‡ªåŠ¨æ·»åŠ äº†ï¼Œå¦‚ä¸‹ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#----------------------- BEGIN SECURITY AUTO CONFIGURATION -----------------------</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\"># The following settings, TLS certificates, and keys have been automatically</span></span><br><span class=\"line\"><span class=\"comment\"># generated to configure Elasticsearch security features on 20-03-2025 08:53:20</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\"># --------------------------------------------------------------------------------</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Enable security features</span></span><br><span class=\"line\"><span class=\"comment\"># å¯ç”¨ Elasticsearch çš„å®‰å…¨ç‰¹æ€§ï¼ŒåŒ…æ‹¬ç”¨æˆ·è®¤è¯ã€è§’è‰²ç®¡ç†ã€åŠ å¯†ç­‰ã€‚</span></span><br><span class=\"line\"><span class=\"comment\"># å¼€å¯äº† X-Pack å®‰å…¨åŠŸèƒ½ï¼Œè¿™æ„å‘³ç€ä½ éœ€è¦è¿›è¡Œç”¨æˆ·è®¤è¯æ‰èƒ½è®¿é—® Elasticsearchã€‚</span></span><br><span class=\"line\"><span class=\"comment\"># å¦‚æœéœ€è¦å…³é—­ X-Pack å®‰å…¨åŠŸèƒ½ï¼Œä½ å¯ä»¥å°† xpack.security.enabled è®¾ç½®ä¸º falseã€‚</span></span><br><span class=\"line\">xpack.security.enabled: <span class=\"literal\">true</span></span><br><span class=\"line\"><span class=\"comment\"># å¯ç”¨å®‰å…¨æ³¨å†ŒåŠŸèƒ½ï¼Œå…è®¸é€šè¿‡äº¤äº’å¼å‘å¯¼æ¥é…ç½®å®‰å…¨è®¾ç½®ã€‚</span></span><br><span class=\"line\"><span class=\"comment\"># è¿™ä½¿å¾—ä½ å¯ä»¥é€šè¿‡ Kibana æˆ–å‘½ä»¤è¡Œå·¥å…·æ¥è‡ªåŠ¨é…ç½® SSL è¯ä¹¦å’Œå…¶ä»–å®‰å…¨è®¾ç½®ã€‚</span></span><br><span class=\"line\">xpack.security.enrollment.enabled: <span class=\"literal\">true</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Enable encryption for HTTP API client connections, such as Kibana, Logstash, and Agents</span></span><br><span class=\"line\"><span class=\"comment\"># å¯ç”¨ HTTP API å®¢æˆ·ç«¯è¿æ¥çš„åŠ å¯†</span></span><br><span class=\"line\"><span class=\"comment\"># Kibanaã€Logstash å’Œå…¶ä»–é€šè¿‡ HTTP API è¿æ¥åˆ° Elasticsearch çš„å®¢æˆ·ç«¯å°†ä½¿ç”¨ HTTPS è¿›è¡Œé€šä¿¡ï¼Œå¢å¼ºå®‰å…¨æ€§ã€‚</span></span><br><span class=\"line\">xpack.security.http.ssl:</span><br><span class=\"line\">  enabled: <span class=\"literal\">true</span> <span class=\"comment\"># å¯ç”¨ HTTP å±‚çš„ SSL åŠ å¯†ï¼Œå³httpsè®¿é—®ï¼Œç¡®ä¿å®¢æˆ·ç«¯ä¸ Elasticsearch ä¹‹é—´çš„é€šä¿¡æ˜¯åŠ å¯†çš„ã€‚è®¾ç½®ä¸ºfalseæ—¶ï¼Œå…³é—­åŠ å¯†ï¼Œå³httpè®¿é—®</span></span><br><span class=\"line\">  keystore.path: certs/http.p12 <span class=\"comment\"># æŒ‡å®šç”¨äº HTTP å±‚åŠ å¯†çš„å¯†é’¥åº“æ–‡ä»¶è·¯å¾„ã€‚è¿™æ˜¯ä¸€ä¸ª PKCS12 æ–‡ä»¶ï¼ŒåŒ…å«ç”¨äºåŠ å¯†å’ŒéªŒè¯çš„å…¬é’¥å’Œç§é’¥ã€‚</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Enable encryption and mutual authentication between cluster nodes</span></span><br><span class=\"line\"><span class=\"comment\"># å¯ç”¨èŠ‚ç‚¹é—´çš„åŠ å¯†å’ŒåŒå‘è®¤è¯</span></span><br><span class=\"line\"><span class=\"comment\"># Elasticsearch é›†ç¾¤ä¸­çš„èŠ‚ç‚¹ä¹‹é—´çš„é€šä¿¡å°†ä½¿ç”¨ SSL åŠ å¯†ï¼Œå¹¶ä¸”æ¯ä¸ªèŠ‚ç‚¹éƒ½ä¼šéªŒè¯å…¶ä»–èŠ‚ç‚¹çš„èº«ä»½ï¼Œä»è€Œå¢å¼ºé›†ç¾¤çš„å®‰å…¨æ€§ã€‚</span></span><br><span class=\"line\"><span class=\"comment\"># æ‰€æœ‰èŠ‚ç‚¹è¦é…ç½®ç›¸åŒçš„è¯ä¹¦</span></span><br><span class=\"line\">xpack.security.transport.ssl:</span><br><span class=\"line\">  enabled: <span class=\"literal\">true</span> <span class=\"comment\"># å¯ç”¨ä¼ è¾“å±‚çš„ SSL åŠ å¯†ï¼Œç¡®ä¿èŠ‚ç‚¹ä¹‹é—´çš„å†…éƒ¨é€šä¿¡æ˜¯åŠ å¯†çš„ã€‚</span></span><br><span class=\"line\">  verification_mode: certificate <span class=\"comment\"># è®¾ç½®éªŒè¯æ¨¡å¼ä¸º certificateï¼Œè¿™æ„å‘³ç€èŠ‚ç‚¹ä¹‹é—´éœ€è¦åŒå‘è®¤è¯ï¼ˆå³æ¯ä¸ªèŠ‚ç‚¹éƒ½éœ€è¦éªŒè¯å¯¹æ–¹çš„èº«ä»½ï¼‰ã€‚</span></span><br><span class=\"line\">  keystore.path: certs/transport.p12 <span class=\"comment\"># æŒ‡å®šç”¨äºä¼ è¾“å±‚åŠ å¯†çš„å¯†é’¥åº“æ–‡ä»¶è·¯å¾„ã€‚è¿™æ˜¯å¦ä¸€ä¸ª PKCS12 æ–‡ä»¶ï¼ŒåŒ…å«ç”¨äºåŠ å¯†å’ŒéªŒè¯çš„å…¬é’¥å’Œç§é’¥ã€‚</span></span><br><span class=\"line\">  truststore.path: certs/transport.p12 <span class=\"comment\"># æŒ‡å®šç”¨äºå­˜å‚¨ä¿¡ä»»è¯ä¹¦çš„ä¿¡ä»»åº“æ–‡ä»¶è·¯å¾„ã€‚è¿™é€šå¸¸ä¸å¯†é’¥åº“ç›¸åŒï¼Œä½†å¯ä»¥ä¸åŒã€‚</span></span><br><span class=\"line\"><span class=\"comment\">#----------------------- END SECURITY AUTO CONFIGURATION -------------------------</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è§£å†³æ–¹æ³•ï¼š</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-6\">1.ä¸æƒ³å¼€å¯å®‰å…¨è®¤è¯ï¼Œå°† <code>xpack.security.enabled</code> è®¾ç½®ä¸º falseï¼Œè¿™æ ·å³ä¾¿ä¸‹é¢çš„é…ç½®éƒ½è®¾ç½®ä¸ºtrueä¹Ÿä¸ä¼šæœ‰æ•ˆã€‚</li>\n<li class=\"lvl-6\">2.ä¸æƒ³httpsè®¿é—®ï¼Œå°† <code>xpack.security.http.ssl.enabled</code> è®¾ç½®ä¸º falseï¼Œä½†è¿™æ ·ä¼šå¯¼è‡´æ— æ³•é€šè¿‡è®¤è¯Tokenæ·»åŠ å…¶å®ƒèŠ‚ç‚¹æˆ–Kibanaã€‚</li>\n<li class=\"lvl-6\">3.ä¸æƒ³èŠ‚ç‚¹é—´é€šä¿¡åŠ å¯†ï¼Œå°† <code>xpack.security.transport.ssl.enabled</code> è®¾ç½®ä¸º false</li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<p>ä¸ºäº†ä¿è¯ESçš„å®‰å…¨ï¼Œæˆ‘è¿™é‡Œå°±å¼€å¯å®‰å…¨è®¤è¯ï¼Œå¹¶ä¸”é€šè¿‡httpsè®¿é—®ESï¼Œä½†æ­¤æ—¶æˆ‘ä»¬è®¿é—®ESçš„APIå°±éœ€è¦å¸¦ä¸Šè®¤è¯ç”¨æˆ·ï¼Œé‚£ä¹ˆç”¨æˆ·åå’Œå¯†ç æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p>\n</li>\n<li class=\"lvl-2\">\n<p>å®é™…ä¸Šåœ¨ESç¬¬ä¸€æ¬¡æ­£å¸¸å¯åŠ¨æ—¶å…¶æ—¥å¿—ä¸­å°±æ‰“å°äº†è‡ªåŠ¨é…ç½®çš„å®‰å…¨ç›¸å…³çš„ä¿¡æ¯æç¤ºï¼Œé‡Œé¢å°±ç»™å‡ºäº†ç™»å½•ç”¨æˆ·å’Œåˆå§‹çš„å¯†ç ï¼Œå¦‚ä¸‹ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span><br><span class=\"line\"><span class=\"comment\"># è¿™äº›æ—¥å¿—ä¿¡æ¯æä¾›äº† Elasticsearch 8 åœ¨é¦–æ¬¡å¯åŠ¨æ—¶è‡ªåŠ¨é…ç½®çš„å®‰å…¨ç‰¹æ€§ã€ç”Ÿæˆçš„é»˜è®¤å¯†ç ã€è¯ä¹¦æŒ‡çº¹ä»¥åŠå¦‚ä½•é…ç½® Kibana å’Œå…¶ä»–èŠ‚ç‚¹åŠ å…¥é›†ç¾¤çš„è¯¦ç»†è¯´æ˜ã€‚</span></span><br><span class=\"line\">âœ… Elasticsearch security features have been automatically configured!</span><br><span class=\"line\">âœ… Authentication is enabled and cluster connections are encrypted.</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># è¿™æ˜¯ elastic ç”¨æˆ·çš„é»˜è®¤å¯†ç ã€‚ç³»ç»Ÿå»ºè®®ä½ ä½¿ç”¨ bin/elasticsearch-reset-password -u elastic å‘½ä»¤æ¥é‡ç½®æ­¤å¯†ç ã€‚</span></span><br><span class=\"line\">â„¹ï¸  Password <span class=\"keyword\">for</span> the elastic user (reset with `bin/elasticsearch-reset-password -u elastic`):</span><br><span class=\"line\">  BNb=*qz6_M*mXL9uZiSP <span class=\"comment\"># è¿™é‡Œä¼šæ‰“å°å‡ºESè‡ªåŠ¨ç”Ÿæˆçš„å¯†ç </span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># è¿™æ˜¯ HTTP CA è¯ä¹¦çš„ SHA-256 æŒ‡çº¹ã€‚CA è¯ä¹¦ç”¨äºéªŒè¯ HTTPS è¿æ¥çš„èº«ä»½ã€‚</span></span><br><span class=\"line\">â„¹ï¸  HTTP CA certificate SHA-256 fingerprint:</span><br><span class=\"line\">  3f141c16dfc6e165894bc1672084b220dcdd22ffe02116d51ac18003cfaa5a1d</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æä¾›äº†å°† Kibana é…ç½®ä¸ºä½¿ç”¨æ­¤ Elasticsearch é›†ç¾¤çš„æ­¥éª¤ã€‚</span></span><br><span class=\"line\">â„¹ï¸  Configure Kibana to use this cluster:</span><br><span class=\"line\"><span class=\"comment\"># å¯åŠ¨ Kibana å¹¶æŒ‰ç…§ç»ˆç«¯ä¸­æ˜¾ç¤ºçš„é…ç½®é“¾æ¥è¿›è¡Œæ“ä½œã€‚</span></span><br><span class=\"line\">â€¢ Run Kibana and click the configuration <span class=\"built_in\">link</span> <span class=\"keyword\">in</span> the terminal when Kibana starts.</span><br><span class=\"line\"><span class=\"comment\"># å¤åˆ¶æä¾›çš„æ³¨å†Œä»¤ç‰Œï¼Œå¹¶åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ Kibana æ—¶ç²˜è´´æ­¤ä»¤ç‰Œã€‚ä»¤ç‰Œåœ¨æ¥ä¸‹æ¥çš„ 30 åˆ†é’Ÿå†…æœ‰æ•ˆã€‚</span></span><br><span class=\"line\"><span class=\"comment\"># è¡¥å……è¯´æ˜ï¼šç”Ÿæˆæ–°çš„kibanaæ³¨å†Œä»¤ç‰Œï¼šbin/elasticsearch-create-enrollment-token -s kibana</span></span><br><span class=\"line\">â€¢ Copy the following enrollment token and <span class=\"built_in\">paste</span> it into Kibana <span class=\"keyword\">in</span> your browser (valid <span class=\"keyword\">for</span> the next 30 minutes):</span><br><span class=\"line\">  eyJ2ZXIiOiI4LjE0LjAiLCJhZHIiOlsiMTAuMjUwLjAuMjM5OjkyMDAiXSwiZmdyIjoiM2YxNDFjMTZkZmM2ZTE2NTg5NGJjMTY3MjA4NGIyMjBkY2RkMjJmZmUwMjExNmQ1MWFjMTgwMDNjZmFhNWExZCIsImtleSI6ImFSWFBzcFVCTVVmc1d5aUJnbjBtOmRzbVBLQV95UXhDZkJpXzQyWDNEMVEifQ==</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æä¾›äº†å°†æ–°çš„ Elasticsearch èŠ‚ç‚¹åŠ å…¥ç°æœ‰é›†ç¾¤çš„æ­¥éª¤ã€‚</span></span><br><span class=\"line\">â„¹ï¸ Configure other nodes to <span class=\"built_in\">join</span> this cluster:</span><br><span class=\"line\"><span class=\"comment\"># ä½¿ç”¨ bin/elasticsearch --enrollment-token &lt;token&gt; å‘½ä»¤å¯åŠ¨æ–°çš„ Elasticsearch èŠ‚ç‚¹ã€‚ä»¤ç‰Œåœ¨æ¥ä¸‹æ¥çš„ 30 åˆ†é’Ÿå†…æœ‰æ•ˆã€‚</span></span><br><span class=\"line\"><span class=\"comment\"># è¡¥å……è¯´æ˜ï¼šç”Ÿæˆæ–°çš„èŠ‚ç‚¹æ³¨å†Œä»¤ç‰Œï¼šbin/elasticsearch-create-enrollment-token -s node</span></span><br><span class=\"line\">â€¢ Copy the following enrollment token and start new Elasticsearch nodes with `bin/elasticsearch --enrollment-token &lt;token&gt;` (valid <span class=\"keyword\">for</span> the next 30 minutes):</span><br><span class=\"line\">  eyJ2ZXIiOiI4LjE0LjAiLCJhZHIiOlsiMTAuMjUwLjAuMjM5OjkyMDAiXSwiZmdyIjoiM2YxNDFjMTZkZmM2ZTE2NTg5NGJjMTY3MjA4NGIyMjBkY2RkMjJmZmUwMjExNmQ1MWFjMTgwMDNjZmFhNWExZCIsImtleSI6ImF4WFBzcFVCTVVmc1d5aUJnbjFtOkFEallPdnpzUzh1MGJqOFpfVFE4a3cifQ==</span><br><span class=\"line\"><span class=\"comment\"># å¦‚æœä½ åœ¨ Docker ä¸­è¿è¡Œ Elasticsearchï¼Œå¯ä»¥ä½¿ç”¨ docker run -e &quot;ENROLLMENT_TOKEN=&lt;token&gt;&quot; docker.elastic.co/elasticsearch/elasticsearch:8.17.3 å‘½ä»¤å¯åŠ¨æ–°èŠ‚ç‚¹ã€‚</span></span><br><span class=\"line\">  If you<span class=\"string\">&#x27;re running in Docker, copy the enrollment token and run:</span></span><br><span class=\"line\"><span class=\"string\">  `docker run -e &quot;ENROLLMENT_TOKEN=&lt;token&gt;&quot; docker.elastic.co/elasticsearch/elasticsearch:8.17.3`</span></span><br><span class=\"line\"><span class=\"string\">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç™»å½•ç”¨æˆ·ä¸º<code>elastic</code>[å…¶è§’è‰²ä¸ºè¶…çº§ç”¨æˆ·]ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ—¥å¿—æŸ¥çœ‹åˆå§‹çš„å¯†ç ï¼Œä¹Ÿå¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤é‡ç½®å¯†ç </p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># é‡ç½®å¯†ç ï¼Œå¯†ç è‡ªåŠ¨ç”Ÿæˆ</span></span><br><span class=\"line\">bin/elasticsearch-reset-password -u elastic</span><br><span class=\"line\"><span class=\"comment\"># é‡ç½®å¯†ç ï¼Œè‡ªå·±è¾“å…¥è¦è®¾ç½®çš„å¯†ç ï¼Œæ¯”å¦‚æˆ‘è¿™é‡Œè¿™æ˜¯ä¸º 123456</span></span><br><span class=\"line\">bin/elasticsearch-reset-password -u elastic -i</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># é€šè¿‡curlé‡ç½®å¯†ç </span></span><br><span class=\"line\">curl -X PUT -u elastic:old_password -k <span class=\"string\">&#x27;https://127.0.0.1:9200/_security/user/elastic/_password&#x27;</span> \\</span><br><span class=\"line\">  -H <span class=\"string\">&#x27;Content-Type: application/json&#x27;</span> \\</span><br><span class=\"line\">  -d <span class=\"string\">&#x27;&#123;</span></span><br><span class=\"line\"><span class=\"string\">      &quot;password&quot;: &quot;new_password&quot;</span></span><br><span class=\"line\"><span class=\"string\">    &#125;&#x27;</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>curl è®¿é—®ESæœåŠ¡</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># -k å¿½ç•¥è¯ä¹¦æ ¡éªŒ</span></span><br><span class=\"line\">curl -u elastic:123456 -k https://127.0.0.1:9200</span><br><span class=\"line\"><span class=\"comment\"># æˆ–è€… å°†è®¤è¯ä¿¡æ¯é€šè¿‡headerä¼ é€’ï¼Œelastic:123456 é€šè¿‡base64åŠ å¯†</span></span><br><span class=\"line\">curl -k https://127.0.0.1:9200 -H <span class=\"string\">&#x27;Authorization: Basic ZWxhc3RpYzoxMjM0NTY=&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"># ä¹Ÿå¯ä»¥é€šè¿‡è¯ä¹¦è®¿é—®httpsæœåŠ¡ï¼Œè¿™ä¸ªè¯ä¹¦å°±æ˜¯ESåœ¨å¼€å¯å®‰å…¨è®¤è¯å¯åŠ¨æ—¶è‡ªåŠ¨ç”Ÿæˆçš„</span></span><br><span class=\"line\">curl -u elastic:123456 --cacert /usr/local/elasticsearch/elasticsearch-8.17.3/config/certs/http_ca.crt  https://127.0.0.1:9200</span><br><span class=\"line\"><span class=\"comment\"># è¾“å‡ºå¦‚ä¸‹ï¼š</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">&quot;name&quot;</span> : <span class=\"string\">&quot;node-1&quot;</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;cluster_name&quot;</span> : <span class=\"string\">&quot;test-elk&quot;</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;cluster_uuid&quot;</span> : <span class=\"string\">&quot;RykjCSPnSCi4Hsi37uziWw&quot;</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;version&quot;</span> : &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;number&quot;</span> : <span class=\"string\">&quot;8.17.3&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;build_flavor&quot;</span> : <span class=\"string\">&quot;default&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;build_type&quot;</span> : <span class=\"string\">&quot;tar&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;build_hash&quot;</span> : <span class=\"string\">&quot;a091390de485bd4b127884f7e565c0cad59b10d2&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;build_date&quot;</span> : <span class=\"string\">&quot;2025-02-28T10:07:26.089129809Z&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;build_snapshot&quot;</span> : <span class=\"literal\">false</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;lucene_version&quot;</span> : <span class=\"string\">&quot;9.12.0&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;minimum_wire_compatibility_version&quot;</span> : <span class=\"string\">&quot;7.17.0&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;minimum_index_compatibility_version&quot;</span> : <span class=\"string\">&quot;7.0.0&quot;</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"string\">&quot;tagline&quot;</span> : <span class=\"string\">&quot;You Know, for Search&quot;</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<div class=\"tips\">\n<p><em><strong>å¼€å‘æ¨¡å¼å’Œç”Ÿäº§æ¨¡å¼</strong></em></p>\n<ul class=\"lvl-1\">\n<li class=\"lvl-2\">å¼€å‘æ¨¡å¼ï¼šå¦‚æœç”¨æˆ·åªæ˜¯å‡ºäºå­¦ä¹ ç›®çš„ï¼Œå¯ä»¥åœ¨é…ç½®æ–‡ä»¶ä¸­æ·»åŠ  <code>discovery.type=single-node</code> ï¼Œè¡¨ç¤ºå•èŠ‚ç‚¹æ¨¡å¼ï¼Œå³å¼€å‘æ¨¡å¼ã€‚æ­¤æ¨¡å¼å¯ä»¥ç»•è¿‡å¼•å¯¼æ£€æŸ¥ã€‚</li>\n<li class=\"lvl-2\">ç”Ÿäº§æ¨¡å¼ï¼šå½“ç”¨æˆ·é…ç½®äº†æœ‰å…³é›†ç¾¤çš„ç›¸å…³é…ç½®é¡¹æ—¶å°±ä¼šè§¦å‘ç”Ÿäº§æ¨¡å¼ï¼Œåœ¨ç”Ÿäº§æ¨¡å¼ä¸‹ï¼ŒæœåŠ¡å¯åŠ¨ä¼šè§¦å‘ESçš„å¼•å¯¼æ£€æŸ¥æˆ–è€…å«å¯åŠ¨æ£€æŸ¥ï¼ˆbootstrap checksï¼‰ï¼Œå¼•å¯¼æ£€æŸ¥ååˆ†ä¸¥æ ¼ï¼Œå³æŸäº›æ£€æŸ¥é¡¹ä¸é€šè¿‡åˆ™ESæœåŠ¡å°†æ— æ³•å¯åŠ¨ã€‚\n<ul class=\"lvl-3\">\n<li class=\"lvl-4\">å¼•å¯¼æ£€æŸ¥ï¼šåœ¨æœåŠ¡å¯åŠ¨ä¹‹å‰å¯¹ä¸€äº›é‡è¦çš„é…ç½®é¡¹è¿›è¡Œæ£€æŸ¥ï¼Œæ£€æŸ¥å…¶é…ç½®å€¼æ˜¯å¦æ˜¯åˆç†çš„ã€‚å¼•å¯¼æ£€æŸ¥åŒ…æ‹¬å¯¹JVMå¤§å°ã€å†…å­˜é”ã€è™šæ‹Ÿå†…å­˜ã€æœ€å¤§çº¿ç¨‹æ•°ã€é›†ç¾¤å‘ç°ç›¸å…³é…ç½®ç­‰ç›¸å…³çš„æ£€æŸ¥ï¼Œå¦‚æœæŸä¸€é¡¹æˆ–è€…å‡ é¡¹çš„é…ç½®ä¸åˆç†ï¼ŒESä¼šæ‹’ç»å¯åŠ¨æœåŠ¡ï¼Œå¹¶ä¸”åœ¨å¼€å‘æ¨¡å¼ä¸‹çš„æŸäº›è­¦å‘Šä¿¡æ¯ä¼šå‡çº§æˆé”™è¯¯ä¿¡æ¯è¾“å‡ºã€‚å¼•å¯¼æ£€æŸ¥ååˆ†ä¸¥æ ¼ï¼Œä¹‹æ‰€ä»¥å®å¯æ‹’ç»æœåŠ¡ä¹Ÿè¦é˜»æ­¢ç”¨æˆ·å¯åŠ¨æœåŠ¡æ˜¯ä¸ºäº†é˜²æ­¢ç”¨æˆ·åœ¨å¯¹ESçš„åŸºæœ¬ä½¿ç”¨ä¸äº†è§£çš„å‰æä¸‹å¯åŠ¨æœåŠ¡è€Œå¯¼è‡´çš„åæœŸæ€§èƒ½é—®é¢˜æ— æ³•è§£å†³æˆ–è€…è§£å†³èµ·æ¥å¾ˆéº»çƒ¦ã€‚å› ä¸ºä¸€æ—¦æœåŠ¡ä»¥æŸç§ä¸åˆç†çš„é…ç½®å¯åŠ¨ï¼Œæ—¶é—´ä¹…äº†ä¹‹åå¯èƒ½ä¼šäº§ç”Ÿè¾ƒå¤§çš„æ€§èƒ½é—®é¢˜ï¼Œä½†æ­¤æ—¶é›†ç¾¤å·²ç»å˜å¾—éš¾ä»¥ç»´æŠ¤å’Œæ‰©å±•ï¼ŒESä¸ºäº†é¿å…è¿™ç§æƒ…å†µè€Œåšå‡ºäº†å¼•å¯¼æ£€æŸ¥çš„è®¾ç½®ï¼Œæœ¬æ¥åœ¨å¼€å‘æ¨¡å¼ä¸‹ä¸ºè­¦å‘Šçš„å¯åŠ¨æ—¥å¿—ä¼šå‡çº§ä¸ºæŠ¥é”™ï¼ˆErrorï¼‰ã€‚è¿™ç§è®¾å®šè™½ç„¶å¢åŠ äº†ç”¨æˆ·çš„ä½¿ç”¨é—¨æ§›ï¼Œä½†æ˜¯é¿å…äº†æ—¥åäº§ç”Ÿæ›´å¤§çš„é—®é¢˜ã€‚</li>\n</ul>\n</li>\n</ul>\n</div>\n<h2 id=\"ESæµè§ˆå™¨æ’ä»¶\">ESæµè§ˆå™¨æ’ä»¶</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><a href=\"https://elasticvue.com/\">Elasticvue</a> : chrome/edge æ’ä»¶ï¼Œç”¨äºåœ¨æµè§ˆå™¨ä¸­æŸ¥çœ‹ESé›†ç¾¤ä¿¡æ¯ï¼ŒåŠŸèƒ½éå¸¸å¼ºå¤§</p>\n</li>\n</ul>\n<h2 id=\"ESè‡ªå¯åŠ¨è„šæœ¬\">ESè‡ªå¯åŠ¨è„šæœ¬</h2>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åˆ›å»ºæœåŠ¡æ–‡ä»¶</span></span><br><span class=\"line\">$ vim /usr/lib/systemd/system/es.service</span><br><span class=\"line\">[Unit]</span><br><span class=\"line\">Description=elasticsearch</span><br><span class=\"line\">Documentation=https://www.elastic.co</span><br><span class=\"line\">After=network.target</span><br><span class=\"line\"></span><br><span class=\"line\">[Service]</span><br><span class=\"line\">Type=simple</span><br><span class=\"line\">PrivateTmp=<span class=\"literal\">true</span></span><br><span class=\"line\"><span class=\"comment\"># æŒ‡å®šESç”¨æˆ·</span></span><br><span class=\"line\">User=elastic</span><br><span class=\"line\">Group=elastic</span><br><span class=\"line\">LimitNOFILE=100000</span><br><span class=\"line\">LimitNPROC=100000</span><br><span class=\"line\">Restart=<span class=\"built_in\">yes</span></span><br><span class=\"line\"><span class=\"comment\"># å¯åŠ¨å‘½ä»¤</span></span><br><span class=\"line\">ExecStart=/usr/local/elasticsearch/elasticsearch-8.17.3/bin/elasticsearch</span><br><span class=\"line\">ExecRestart=/bin/kill -s HUP <span class=\"variable\">$MAINPID</span></span><br><span class=\"line\">ExecStop=/bin/kill -s QUIT <span class=\"variable\">$MAINPID</span></span><br><span class=\"line\"></span><br><span class=\"line\">[Install]</span><br><span class=\"line\">WantedBy=multi-user.target</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># é‡æ–°åŠ è½½</span></span><br><span class=\"line\">$ systemctl daemon-reload</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å¯åŠ¨</span></span><br><span class=\"line\">$ systemctl start es</span><br><span class=\"line\"><span class=\"comment\"># åœæ­¢</span></span><br><span class=\"line\">$ systemctl stop es</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹çŠ¶æ€</span></span><br><span class=\"line\">$ systemctl status es</span><br><span class=\"line\"><span class=\"comment\"># è®¾ç½®å¼€æœºå¯åŠ¨</span></span><br><span class=\"line\">$ systemctl <span class=\"built_in\">enable</span> es</span><br></pre></td></tr></table></figure>\n<h2 id=\"é€šè¿‡ApiKeyè®¿é—®ES\">é€šè¿‡ApiKeyè®¿é—®ES</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å…³äºApiKeyçš„è¯¦ç»†ä»‹ç»ï¼Œå¯ä»¥å‚è€ƒ<a href=\"https://www.elastic.co/guide/en/elasticsearch/reference/current/security-api-create-api-key.html\">å®˜æ–¹æ–‡æ¡£</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>åˆ›å»ºApiKey</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -k <span class=\"string\">&#x27;https://127.0.0.1:9200/_security/api_key?pretty&#x27;</span> \\</span><br><span class=\"line\">-u elastic:123456 \\</span><br><span class=\"line\">--header <span class=\"string\">&#x27;Content-Type: application/json&#x27;</span> \\</span><br><span class=\"line\">--data <span class=\"string\">&#x27;&#123;</span></span><br><span class=\"line\"><span class=\"string\">    &quot;name&quot;: &quot;elastic_api_key&quot;,</span></span><br><span class=\"line\"><span class=\"string\">    &quot;expiration&quot;: &quot;1d&quot;</span></span><br><span class=\"line\"><span class=\"string\">&#125;&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"># è¯·æ±‚å‚æ•°è¯´æ˜ï¼š</span></span><br><span class=\"line\"><span class=\"comment\"># name: ApiKeyçš„åç§°</span></span><br><span class=\"line\"><span class=\"comment\"># expiration: ApiKeyçš„è¿‡æœŸæ—¶é—´ï¼Œè¿™é‡Œè®¾ç½®ä¸ºä¸€å¤©ï¼Œå¦‚æœä¸è®¾ç½®ï¼Œåˆ™æ°¸ä¸è¿‡æœŸ</span></span><br><span class=\"line\"><span class=\"comment\"># è¯·æ±‚å‚æ•°ä¸­è¿˜æœ‰ä¸€ä¸ªé‡è¦çš„å‚æ•° `role_descriptors`ï¼Œå…¶å«ä¹‰æ˜¯ï¼ŒæŒ‡å®šApiKeyæ‰€æ‹¥æœ‰çš„æƒé™ï¼Œå³è§’è‰²ã€‚å¦‚æœä¸è¿›è¡Œè®¾ç½®ï¼Œåˆ™é»˜è®¤ä½¿ç”¨å½“å‰è®¤è¯ç”¨æˆ·çš„çš„è§’è‰²</span></span><br><span class=\"line\"><span class=\"comment\"># metadata: ApiKeyçš„å…ƒæ•°æ®ï¼Œå³è‡ªå®šä¹‰çš„é”®å€¼å¯¹ï¼Œè¿™é‡Œå¯ä»¥ä¸è®¾ç½®</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># è¾“å‡ºï¼š</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">&quot;id&quot;</span>:<span class=\"string\">&quot;70It0ZUBrL2GcOxX0d1L&quot;</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;name&quot;</span>:<span class=\"string\">&quot;elastic_api_key&quot;</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;expiration&quot;</span>:1743057595723,</span><br><span class=\"line\">  <span class=\"string\">&quot;api_key&quot;</span>:<span class=\"string\">&quot;s85lqVkmQISkBlgXCTJmDQ&quot;</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;encoded&quot;</span>:<span class=\"string\">&quot;NzBJdDBaVUJyTDJHY094WDBkMUw6czg1bHFWa21RSVNrQmxnWENUSm1EUQ==&quot;</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\"># è¾“å‡ºå‚æ•°è¯´æ˜ï¼š</span></span><br><span class=\"line\"><span class=\"comment\"># id: ApiKeyçš„id</span></span><br><span class=\"line\"><span class=\"comment\"># name: ApiKeyçš„åç§°</span></span><br><span class=\"line\"><span class=\"comment\"># expiration: ApiKeyçš„è¿‡æœŸæ—¶é—´ï¼Œå•ä½ä¸ºæ¯«ç§’</span></span><br><span class=\"line\"><span class=\"comment\"># api_key: ApiKeyçš„å¯†é’¥</span></span><br><span class=\"line\"><span class=\"comment\"># encoded: å¯¹ `id:api_key` è¿›è¡Œbase64ç¼–ç ï¼Œå³å¯å¾—åˆ° `encoded`</span></span><br><span class=\"line\">    <span class=\"comment\"># echo -n &#x27;70It0ZUBrL2GcOxX0d1L:s85lqVkmQISkBlgXCTJmDQ&#x27; | base64</span></span><br><span class=\"line\">    <span class=\"comment\"># è¾“å‡ºï¼š</span></span><br><span class=\"line\">    <span class=\"comment\"># NzBJdDBaVUJyTDJHY094WDBkMUw6czg1bHFWa21RSVNrQmxnWENUSm1EUQ==</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä½¿ç”¨ApiKeyè®¿é—®ES</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># è¿™é‡Œçš„ApiKeyï¼Œå°±æ˜¯ä¸Šé¢è¾“å‡ºçš„encoded</span></span><br><span class=\"line\">curl -k <span class=\"string\">&#x27;https://127.0.0.1:9200?pretty&#x27;</span> \\</span><br><span class=\"line\">-H <span class=\"string\">&#x27;Authorization: ApiKey NzBJdDBaVUJyTDJHY094WDBkMUw6czg1bHFWa21RSVNrQmxnWENUSm1EUQ==&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"># è¾“å‡º</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">&quot;name&quot;</span> : <span class=\"string\">&quot;node-1&quot;</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;cluster_name&quot;</span> : <span class=\"string\">&quot;test-elk&quot;</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;cluster_uuid&quot;</span> : <span class=\"string\">&quot;RykjCSPnSCi4Hsi37uziWw&quot;</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;version&quot;</span> : &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;number&quot;</span> : <span class=\"string\">&quot;8.17.3&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;build_flavor&quot;</span> : <span class=\"string\">&quot;default&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;build_type&quot;</span> : <span class=\"string\">&quot;tar&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;build_hash&quot;</span> : <span class=\"string\">&quot;a091390de485bd4b127884f7e565c0cad59b10d2&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;build_date&quot;</span> : <span class=\"string\">&quot;2025-02-28T10:07:26.089129809Z&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;build_snapshot&quot;</span> : <span class=\"literal\">false</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;lucene_version&quot;</span> : <span class=\"string\">&quot;9.12.0&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;minimum_wire_compatibility_version&quot;</span> : <span class=\"string\">&quot;7.17.0&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;minimum_index_compatibility_version&quot;</span> : <span class=\"string\">&quot;7.0.0&quot;</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"string\">&quot;tagline&quot;</span> : <span class=\"string\">&quot;You Know, for Search&quot;</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æŸ¥çœ‹ApiKeyä¿¡æ¯ï¼Œå‚è€ƒ<a href=\"https://www.elastic.co/guide/en/elasticsearch/reference/current/security-api-get-api-key.html\">å®˜æ–¹æ–‡æ¡£</a></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/_security/api_key?name=elastic_api_key&amp;pretty&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"># è¯·æ±‚å‚æ•°è¯´æ˜ï¼š</span></span><br><span class=\"line\"><span class=\"comment\"># name: ApiKeyçš„åç§°ï¼Œä¸åŒçš„ApiKeyå¯ä»¥æ‹¥æœ‰ç›¸åŒçš„åç§°ï¼Œä½†idä¸åŒï¼Œæ‰€ä»¥é€šè¿‡nameè¿›è¡ŒæŸ¥è¯¢å¯èƒ½ä¼šè¿”å›å¤šä¸ªç»“æœ</span></span><br><span class=\"line\"><span class=\"comment\"># æˆ–è€… id: ApiKeyçš„idï¼Œå»ºè®®é€šè¿‡idè¿›è¡ŒæŸ¥è¯¢ï¼Œidå”¯ä¸€ï¼Œæ‰€ä»¥é€šè¿‡idè¿›è¡ŒæŸ¥è¯¢åªä¼šè¿”å›ä¸€ä¸ªç»“æœ</span></span><br><span class=\"line\"><span class=\"comment\"># username: æŸ¥è¯¢æŒ‡å®šç”¨æˆ·çš„ApiKey</span></span><br><span class=\"line\"><span class=\"comment\"># owner: æ˜¯å¦åªæŸ¥è¯¢å½“å‰è®¤è¯ç”¨æˆ·åä¸‹çš„ApiKeyï¼Œé»˜è®¤ä¸ºfalseï¼Œä¸ºfalseæ—¶å¿…é¡»è‡³å°‘è®¾ç½®name\\ids\\usernameä¸­çš„ä¸€ä¸ªå‚æ•°</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ä¸åŠ ä»»ä½•å‚æ•°è¿›è¡ŒæŸ¥è¯¢ï¼Œåˆ™è¿”å›æ‰€æœ‰ApiKeyçš„ä¿¡æ¯</span></span><br><span class=\"line\">curl -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/_security/api_key?pretty&#x27;</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ›´æ–°ApiKeyï¼Œå‚è€ƒ<a href=\"https://www.elastic.co/guide/en/elasticsearch/reference/current/security-api-update-api-key.html\">å®˜æ–¹æ–‡æ¡£</a></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -u elastic:123456 -X PUT -k <span class=\"string\">&#x27;https://127.0.0.1:9200/_security/api_key/&#123;ApiKeyId&#125;?pretty&#x27;</span> \\</span><br><span class=\"line\">--header <span class=\"string\">&#x27;Content-Type: application/json&#x27;</span> \\</span><br><span class=\"line\">--data <span class=\"string\">&#x27;&#123;</span></span><br><span class=\"line\"><span class=\"string\">    &quot;expiration&quot;: &quot;1h&quot;,</span></span><br><span class=\"line\"><span class=\"string\">    &quot;role_descriptors&quot;: &#123;</span></span><br><span class=\"line\"><span class=\"string\">        &quot;role-a&quot;: &#123;</span></span><br><span class=\"line\"><span class=\"string\">        &quot;indices&quot;: [</span></span><br><span class=\"line\"><span class=\"string\">            &#123;</span></span><br><span class=\"line\"><span class=\"string\">                &quot;names&quot;: [&quot;*&quot;],</span></span><br><span class=\"line\"><span class=\"string\">                &quot;privileges&quot;: [&quot;write&quot;]</span></span><br><span class=\"line\"><span class=\"string\">            &#125;</span></span><br><span class=\"line\"><span class=\"string\">        ]</span></span><br><span class=\"line\"><span class=\"string\">        &#125;</span></span><br><span class=\"line\"><span class=\"string\">    &#125;,</span></span><br><span class=\"line\"><span class=\"string\">    &quot;metadata&quot;: &#123;</span></span><br><span class=\"line\"><span class=\"string\">        &quot;environment&quot;: &#123;</span></span><br><span class=\"line\"><span class=\"string\">            &quot;level&quot;: 2,</span></span><br><span class=\"line\"><span class=\"string\">            &quot;trusted&quot;: true,</span></span><br><span class=\"line\"><span class=\"string\">            &quot;tags&quot;: [&quot;production&quot;]</span></span><br><span class=\"line\"><span class=\"string\">        &#125;</span></span><br><span class=\"line\"><span class=\"string\">    &#125;</span></span><br><span class=\"line\"><span class=\"string\">&#125;&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å¯ä»¥æ›´æ–°çš„å‚æ•°æœ‰ï¼š</span></span><br><span class=\"line\"><span class=\"comment\"># expiration: ApiKeyçš„è¿‡æœŸæ—¶é—´ï¼Œå¦‚æœå·²ç»è®¾ç½®è¿‡expirationï¼Œæ­¤æ—¶å¸Œæœ›ä½¿å…¶æ°¸ä¸è¿‡æœŸï¼Œåˆ™åªèƒ½å°†å…¶è®¾ç½®ä¸ºä¸€ä¸ªæ¯”è¾ƒå¤§çš„æ—¶é—´ï¼Œæ¯”å¦‚ &quot;expiration&quot;: &quot;100y&quot;</span></span><br><span class=\"line\"><span class=\"comment\"># role_descriptors: ApiKeyæ‰€æ‹¥æœ‰çš„è§’è‰²ï¼ŒåŸå…ˆè®¾ç½®äº†role_descriptorsï¼Œæ›´æ–°æ—¶å¸Œæœ›å…¶ä½¿ç”¨è®¤è¯ç”¨æˆ·çš„è§’è‰²ï¼Œåˆ™æ­¤æ—¶å¯ä»¥å°†å…¶è®¾ç½®ä¸º &quot;role_descriptors&quot;: &#123;&#125;</span></span><br><span class=\"line\"><span class=\"comment\"># metadata: ApiKeyçš„å…ƒæ•°æ®ï¼ŒåŸå…ˆè®¾ç½®äº† metadata ï¼Œæ›´æ–°æ—¶å¸Œæœ›å»é™¤æ‰€æœ‰ metadata ä¿¡æ¯ï¼Œåˆ™æ­¤æ—¶å¯ä»¥å°†å…¶è®¾ç½®ä¸º &quot;metadata&quot;: &#123;&#125;</span></span><br><span class=\"line\"><span class=\"comment\"># æ³¨æ„ï¼šä¸‰ä¸ªå‚æ•°å¯ä»¥åªæ›´æ–°å…¶ä¸­ä»»ä½•ä¸€ä¸ªï¼Œæ›´æ–°å“ªä¸ªå°±åªæ›¿æ¢å“ªä¸ªï¼Œæ²¡æœ‰è¢«æ›´æ–°çš„å‚æ•°ä¸ä¼šå—åˆ°ä¿®æ”¹ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥åŒæ—¶æ›´æ–°å…¨éƒ¨</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç½®ApiKeyæ— æ•ˆï¼Œå‚è€ƒ<a href=\"https://www.elastic.co/guide/en/elasticsearch/reference/current/security-api-invalidate-api-key.html\">å®˜æ–¹æ–‡æ¡£</a>ï¼Œå®˜æ–¹æ²¡æœ‰æä¾›åˆ é™¤ApiKeyçš„æ¥å£ï¼Œåªæœ‰ç½®æ— æ•ˆçš„æ¥å£</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -u elastic:123456 -X DELETE -k <span class=\"string\">&#x27;https://127.0.0.1:9200/_security/api_key?pretty&#x27;</span> \\</span><br><span class=\"line\">--header <span class=\"string\">&#x27;Content-Type: application/json&#x27;</span> \\</span><br><span class=\"line\">--data <span class=\"string\">&#x27;&#123;</span></span><br><span class=\"line\"><span class=\"string\">    &quot;name&quot;: &quot;elastic_api_key&quot;</span></span><br><span class=\"line\"><span class=\"string\">&#125;&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"># è¯·æ±‚å‚æ•°è¯´æ˜ï¼š</span></span><br><span class=\"line\"><span class=\"comment\"># name: ApiKeyçš„åç§°ï¼Œä¼š</span></span><br><span class=\"line\"><span class=\"comment\"># æˆ–è€…ä½¿ç”¨  &quot;ids&quot; : [ &quot;70It0ZUBrL2GcOxX0d1L&quot; ] ï¼Œé€šè¿‡idè¿›è¡Œåˆ é™¤ï¼Œæ­¤æ—¶å¯ä»¥ä¸€æ¬¡åˆ é™¤å¤šä¸ªApiKey</span></span><br><span class=\"line\"><span class=\"comment\"># username: åˆ é™¤æŒ‡å®šç”¨æˆ·çš„ApiKey</span></span><br><span class=\"line\"><span class=\"comment\"># owner: æ˜¯å¦åªåˆ é™¤å½“å‰è®¤è¯ç”¨æˆ·åä¸‹çš„ApiKeyï¼Œé»˜è®¤ä¸ºfalseï¼Œä¸ºfalseæ—¶å¿…é¡»è‡³å°‘è®¾ç½®name\\ids\\usernameä¸­çš„ä¸€ä¸ªå‚æ•°</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># è¾“å‡ºï¼š</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">&quot;invalidated_api_keys&quot;</span>:[</span><br><span class=\"line\">    <span class=\"string\">&quot;70It0ZUBrL2GcOxX0d1L&quot;</span></span><br><span class=\"line\">  ],</span><br><span class=\"line\">  <span class=\"string\">&quot;previously_invalidated_api_keys&quot;</span>:[ ],</span><br><span class=\"line\">  <span class=\"string\">&quot;error_count&quot;</span>:0</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\"># è¾“å‡ºå‚æ•°è¯´æ˜ï¼š</span></span><br><span class=\"line\"><span class=\"comment\"># invalidated_api_keys: è¢«åˆ é™¤çš„ApiKeyçš„idåˆ—è¡¨</span></span><br><span class=\"line\"><span class=\"comment\"># previously_invalidated_api_keys: ä¹‹å‰è¢«åˆ é™¤çš„ApiKeyçš„idåˆ—è¡¨</span></span><br><span class=\"line\"><span class=\"comment\"># error_count: é”™è¯¯æ•°é‡ï¼Œå¦‚æœä¸º0ï¼Œåˆ™è¡¨ç¤ºæˆåŠŸ</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä½¿ç”¨ApiKeyçš„ä¼˜ç¼ºç‚¹</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-6\">ä¼˜ç‚¹</li>\n</ul>\n  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">å®‰å…¨æ€§:</span><br><span class=\"line\">    ç»†ç²’åº¦æ§åˆ¶: API Key å¯ä»¥ä¸ç‰¹å®šçš„è§’è‰²æè¿°ç¬¦å…³è”ï¼Œå…è®¸éå¸¸ç»†åŒ–çš„æƒé™æ§åˆ¶ã€‚è¿™æœ‰åŠ©äºéµå¾ªæœ€å°æƒé™åŸåˆ™ï¼Œåªæˆäºˆå¿…è¦çš„è®¿é—®æƒé™ã€‚</span><br><span class=\"line\">    æ—¶é—´é™åˆ¶: å¯ä»¥ä¸º API Key è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œç¡®ä¿å¯†é’¥ä¸ä¼šæ°¸è¿œæœ‰æ•ˆï¼Œå‡å°‘é•¿æœŸæ³„éœ²çš„é£é™©ã€‚</span><br><span class=\"line\">    å¯æ’¤é”€æ€§: å¦‚æœæ€€ç–‘æŸä¸ª API Key è¢«æ³„éœ²æˆ–ä¸å†éœ€è¦ï¼Œå¯ä»¥éšæ—¶æ’¤é”€è¯¥å¯†é’¥ï¼Œæé«˜å®‰å…¨æ€§ã€‚</span><br><span class=\"line\">æ–¹ä¾¿æ€§:</span><br><span class=\"line\">    æ˜“äºç”Ÿæˆå’Œç®¡ç†: åˆ›å»ºå’Œç®¡ç† API Key çš„è¿‡ç¨‹é€šå¸¸å¾ˆç®€å•ï¼Œå¯ä»¥é€šè¿‡ REST API æˆ– Kibana ç•Œé¢è¿›è¡Œã€‚</span><br><span class=\"line\">    æ— éœ€ç”¨æˆ·äº¤äº’: ä¸€æ—¦ç”Ÿæˆï¼ŒAPI Key å¯ä»¥ç›´æ¥ç”¨äºè‡ªåŠ¨åŒ–è„šæœ¬æˆ–åº”ç”¨ç¨‹åºï¼Œæ— éœ€ç”¨æˆ·æ‰‹åŠ¨ç™»å½•æˆ–æä¾›å‡­æ®ã€‚</span><br><span class=\"line\">å®¡è®¡å’Œç›‘æ§:</span><br><span class=\"line\">    è·Ÿè¸ªä½¿ç”¨æƒ…å†µ: é€šè¿‡æ—¥å¿—è®°å½•å’Œå®¡è®¡åŠŸèƒ½ï¼Œå¯ä»¥è·Ÿè¸ªå“ªä¸ª API Key è¿›è¡Œäº†å“ªäº›æ“ä½œï¼Œä¾¿äºå®‰å…¨å®¡è®¡å’Œé—®é¢˜æ’æŸ¥ã€‚</span><br><span class=\"line\">    æ´»åŠ¨ç›‘æ§: å¯ä»¥ç›‘æ§ API Key çš„æ´»åŠ¨ï¼ŒåŠæ—¶å‘ç°å¼‚å¸¸è¡Œä¸ºï¼Œå¹¶é‡‡å–ç›¸åº”çš„æªæ–½ã€‚</span><br><span class=\"line\">çµæ´»æ€§:</span><br><span class=\"line\">    å¤šç§ç”¨é€”: API Key å¯ä»¥ç”¨äºå„ç§ç”¨é€”ï¼Œå¦‚åº”ç”¨ç¨‹åºé›†æˆã€æ•°æ®å¯¼å…¥å¯¼å‡ºã€ç›‘æ§å·¥å…·ç­‰ã€‚</span><br><span class=\"line\">    å¤šç¯å¢ƒæ”¯æŒ: å¯ä»¥ä¸ºä¸åŒçš„ç¯å¢ƒï¼ˆå¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ï¼‰ç”Ÿæˆç‹¬ç«‹çš„ API Keyï¼Œç¡®ä¿å„ç¯å¢ƒä¹‹é—´çš„éš”ç¦»ã€‚</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-2\">\n<li class=\"lvl-6\">ç¼ºç‚¹</li>\n</ul>\n  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">å®‰å…¨æ€§é£é™©:</span><br><span class=\"line\">    å¯†é’¥å­˜å‚¨: API Key éœ€è¦å®‰å…¨åœ°å­˜å‚¨å’Œä¼ è¾“ï¼Œå¦‚æœå¯†é’¥è¢«æ³„éœ²ï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨å®ƒè¿›è¡Œæœªæˆæƒçš„æ“ä½œã€‚</span><br><span class=\"line\">    é™æ€å‡­è¯: ä¸åŠ¨æ€çš„èº«ä»½éªŒè¯æœºåˆ¶ï¼ˆå¦‚ OAuth ä»¤ç‰Œï¼‰ç›¸æ¯”ï¼ŒAPI Key æ˜¯é™æ€çš„ï¼Œä¸€æ—¦æ³„éœ²å¯èƒ½ä¼šå¯¼è‡´é•¿æœŸçš„å®‰å…¨é£é™©ã€‚</span><br><span class=\"line\">ç®¡ç†å¤æ‚æ€§:</span><br><span class=\"line\">    å¯†é’¥ç®¡ç†: éšç€æ—¶é—´å’Œä½¿ç”¨è§„æ¨¡çš„å¢é•¿ï¼Œç®¡ç†å’Œç»´æŠ¤å¤§é‡ API Key å¯èƒ½ä¼šå˜å¾—å¤æ‚ã€‚éœ€è¦å®šæœŸæ›´æ–°å’Œæ’¤é”€è€æ—§çš„å¯†é’¥ã€‚</span><br><span class=\"line\">    è§’è‰²åˆ†é…: ç»†ç²’åº¦çš„æƒé™æ§åˆ¶è™½ç„¶æä¾›äº†å®‰å…¨æ€§ï¼Œä½†ä¹Ÿå¢åŠ äº†é…ç½®å’Œç®¡ç†çš„å¤æ‚æ€§ã€‚</span><br><span class=\"line\">ç¼ºä¹ç”¨æˆ·ä¸Šä¸‹æ–‡:</span><br><span class=\"line\">    åŒ¿åæ€§: API Key é€šå¸¸æ²¡æœ‰ç”¨æˆ·ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œä¸åƒåŸºäºç”¨æˆ·çš„è®¤è¯æœºåˆ¶ï¼ˆå¦‚ Basic Auth æˆ– OAuthï¼‰ï¼Œè¿™å¯èƒ½ä¸åˆ©äºæŸäº›ä¾èµ–ç”¨æˆ·èº«ä»½çš„åŠŸèƒ½ã€‚</span><br><span class=\"line\">ä¾èµ–å®¢æˆ·ç«¯é…ç½®:</span><br><span class=\"line\">    æ˜“é”™æ€§: å¦‚æœå®¢æˆ·ç«¯é…ç½®ä¸å½“ï¼Œå¦‚é”™è¯¯åœ°å¤„ç†æˆ–æš´éœ² API Keyï¼Œå¯èƒ½ä¼šå¯¼è‡´å®‰å…¨æ¼æ´ã€‚</span><br><span class=\"line\">    æ›´æ–°æŒ‘æˆ˜: æ›´æ–° API Key åï¼Œæ‰€æœ‰ä½¿ç”¨è¯¥å¯†é’¥çš„å®¢æˆ·ç«¯éƒ½éœ€è¦åŒæ­¥æ›´æ–°ï¼Œè¿™åœ¨å¤§è§„æ¨¡ç¯å¢ƒä¸­å¯èƒ½æ˜¯ä¸€ä¸ªæŒ‘æˆ˜ã€‚</span><br></pre></td></tr></table></figure>\n</li>\n<li class=\"lvl-2\">\n<p>ä½•æ—¶ä½¿ç”¨ API Key</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-6\">å½“æ‚¨éœ€è¦ä¸ºè‡ªåŠ¨åŒ–è„šæœ¬ã€ç¬¬ä¸‰æ–¹æœåŠ¡æˆ–åº”ç”¨ç¨‹åºæä¾›è®¿é—®æƒé™æ—¶ã€‚</li>\n<li class=\"lvl-6\">å½“æ‚¨å¸Œæœ›å®ç°ç»†ç²’åº¦çš„æƒé™æ§åˆ¶å¹¶èƒ½å¤Ÿè½»æ¾ç®¡ç†å¯†é’¥çš„ç”Ÿå‘½å‘¨æœŸæ—¶ã€‚</li>\n<li class=\"lvl-6\">å½“ä¸éœ€è¦ç”¨æˆ·ä¸Šä¸‹æ–‡æˆ–å¤æ‚çš„ç”¨æˆ·ä¼šè¯ç®¡ç†æ—¶ã€‚</li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<p>ç¤ºä¾‹</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åˆ›å»ºApiKey</span></span><br><span class=\"line\">curl -X POST -k <span class=\"string\">&#x27;https://127.0.0.1:9200/_security/api_key?pretty&#x27;</span> \\</span><br><span class=\"line\">-u elastic:123456 \\</span><br><span class=\"line\">--header <span class=\"string\">&#x27;Content-Type: application/json&#x27;</span> \\</span><br><span class=\"line\">--data <span class=\"string\">&#x27;&#123;</span></span><br><span class=\"line\"><span class=\"string\">  &quot;name&quot;: &quot;my-api-key&quot;,</span></span><br><span class=\"line\"><span class=\"string\">  &quot;expiration&quot;: &quot;1d&quot;,</span></span><br><span class=\"line\"><span class=\"string\">  &quot;role_descriptors&quot;: &#123;</span></span><br><span class=\"line\"><span class=\"string\">    &quot;role-a&quot;: &#123;</span></span><br><span class=\"line\"><span class=\"string\">      &quot;cluster&quot;: [&quot;all&quot;],</span></span><br><span class=\"line\"><span class=\"string\">      &quot;indices&quot;: [</span></span><br><span class=\"line\"><span class=\"string\">        &#123;</span></span><br><span class=\"line\"><span class=\"string\">          &quot;names&quot;: [&quot;index-a*&quot;],</span></span><br><span class=\"line\"><span class=\"string\">          &quot;privileges&quot;: [&quot;read&quot;]</span></span><br><span class=\"line\"><span class=\"string\">        &#125;</span></span><br><span class=\"line\"><span class=\"string\">      ]</span></span><br><span class=\"line\"><span class=\"string\">    &#125;,</span></span><br><span class=\"line\"><span class=\"string\">    &quot;role-b&quot;: &#123;</span></span><br><span class=\"line\"><span class=\"string\">      &quot;cluster&quot;: [&quot;all&quot;],</span></span><br><span class=\"line\"><span class=\"string\">      &quot;indices&quot;: [</span></span><br><span class=\"line\"><span class=\"string\">        &#123;</span></span><br><span class=\"line\"><span class=\"string\">          &quot;names&quot;: [&quot;index-b*&quot;],</span></span><br><span class=\"line\"><span class=\"string\">          &quot;privileges&quot;: [&quot;all&quot;]</span></span><br><span class=\"line\"><span class=\"string\">        &#125;</span></span><br><span class=\"line\"><span class=\"string\">      ]</span></span><br><span class=\"line\"><span class=\"string\">    &#125;</span></span><br><span class=\"line\"><span class=\"string\">  &#125;,</span></span><br><span class=\"line\"><span class=\"string\">  &quot;metadata&quot;: &#123;</span></span><br><span class=\"line\"><span class=\"string\">    &quot;application&quot;: &quot;my-application&quot;,</span></span><br><span class=\"line\"><span class=\"string\">    &quot;environment&quot;: &#123;</span></span><br><span class=\"line\"><span class=\"string\">       &quot;level&quot;: 1,</span></span><br><span class=\"line\"><span class=\"string\">       &quot;trusted&quot;: true,</span></span><br><span class=\"line\"><span class=\"string\">       &quot;tags&quot;: [&quot;dev&quot;, &quot;staging&quot;]</span></span><br><span class=\"line\"><span class=\"string\">    &#125;</span></span><br><span class=\"line\"><span class=\"string\">  &#125;</span></span><br><span class=\"line\"><span class=\"string\">&#125;&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"># name: ApiKeyçš„åç§°</span></span><br><span class=\"line\"><span class=\"comment\"># expiration: ApiKeyçš„è¿‡æœŸæ—¶é—´ï¼Œæ”¯æŒçš„æ—¶é—´å•ä½ä¸ºï¼šsï¼ˆç§’ï¼‰ï¼Œmï¼ˆåˆ†é’Ÿï¼‰ï¼Œhï¼ˆå°æ—¶ï¼‰ï¼Œdï¼ˆå¤©ï¼‰ï¼Œwï¼ˆå‘¨ï¼‰ï¼ŒMï¼ˆæœˆï¼‰ï¼Œyï¼ˆå¹´ï¼‰</span></span><br><span class=\"line\">    <span class=\"comment\"># expirationä¸èƒ½è®¾ç½®å°äº1åˆ†é’Ÿçš„æ—¶é—´ï¼Œå¦‚æœçœç•¥expirationï¼Œåˆ™è¡¨ç¤ºæ— è¿‡æœŸæ—¶é—´</span></span><br><span class=\"line\"><span class=\"comment\"># role_descriptors: è§’è‰²æè¿°ç¬¦ï¼ŒåŒ…å«å¤šä¸ªè§’è‰²</span></span><br><span class=\"line\">    <span class=\"comment\"># role-a: è§’è‰²æè¿°ç¬¦åç§°ï¼ŒåŒ…å«é›†ç¾¤å’Œç´¢å¼•çš„æƒé™æè¿°</span></span><br><span class=\"line\">        <span class=\"comment\"># cluster: é›†ç¾¤æƒé™</span></span><br><span class=\"line\">            <span class=\"comment\"># all: è¡¨ç¤ºæ‹¥æœ‰å…¨éƒ¨é›†ç¾¤æƒé™</span></span><br><span class=\"line\">            <span class=\"comment\"># manage: å¯ä»¥ç®¡ç†é›†ç¾¤è®¾ç½®ã€æ¨¡æ¿å’ŒèŠ‚ç‚¹ä¸Šçš„åˆ†ç‰‡åˆ†é…ã€‚</span></span><br><span class=\"line\">            <span class=\"comment\"># monitor: å¯ä»¥ç›‘è§†é›†ç¾¤çš„çŠ¶æ€ã€‚</span></span><br><span class=\"line\">            <span class=\"comment\"># manage_security: å¯ä»¥ç®¡ç†å®‰å…¨è®¾ç½®ï¼Œå¦‚ç”¨æˆ·ã€è§’è‰²å’Œè§’è‰²æ˜ å°„ã€‚</span></span><br><span class=\"line\">            <span class=\"comment\"># manage_api_key: ç®¡ç† API Key</span></span><br><span class=\"line\">        <span class=\"comment\"># indices: ç´¢å¼•æƒé™ï¼ŒåŒ…å«nameså’Œprivilegesï¼Œ</span></span><br><span class=\"line\">            <span class=\"comment\"># names: è¡¨ç¤ºç´¢å¼•åç§°ï¼Œindex-a*è¡¨ç¤ºæ‰€æœ‰ä»¥index-aå¼€å¤´çš„ç´¢å¼•ï¼Œallè¡¨ç¤ºæ‰€æœ‰ç´¢å¼•</span></span><br><span class=\"line\">            <span class=\"comment\"># privileges: è¡¨ç¤ºç´¢å¼•æƒé™</span></span><br><span class=\"line\">                <span class=\"comment\"># read: è¡¨ç¤ºæ‹¥æœ‰ç´¢å¼•çš„è¯»å–æƒé™</span></span><br><span class=\"line\">                <span class=\"comment\"># write: è¡¨ç¤ºæ‹¥æœ‰ç´¢å¼•çš„å†™å…¥æƒé™</span></span><br><span class=\"line\">                <span class=\"comment\"># delete: è¡¨ç¤ºæ‹¥æœ‰ç´¢å¼•çš„åˆ é™¤æƒé™</span></span><br><span class=\"line\">                <span class=\"comment\"># index: è¡¨ç¤ºæ‹¥æœ‰ç´¢å¼•çš„ç´¢å¼•æƒé™</span></span><br><span class=\"line\">                <span class=\"comment\"># manage: è¡¨ç¤ºæ‹¥æœ‰ç´¢å¼•çš„è®¾ç½®å’Œæ˜ å°„æƒé™</span></span><br><span class=\"line\">                <span class=\"comment\"># monitor: è¡¨ç¤ºæ‹¥æœ‰ç´¢å¼•çš„ç›‘æ§æƒé™</span></span><br><span class=\"line\">                <span class=\"comment\"># create_index: è¡¨ç¤ºå…è®¸åˆ›å»ºç´¢å¼•</span></span><br><span class=\"line\">                <span class=\"comment\"># crud: ç»„åˆäº† read, index, delete æƒé™</span></span><br><span class=\"line\">                <span class=\"comment\"># all: è¡¨ç¤ºæ‹¥æœ‰å…¨éƒ¨ç´¢å¼•æƒé™</span></span><br><span class=\"line\">            <span class=\"comment\"># allow_restricted_indices: è¡¨ç¤ºæ˜¯å¦å…è®¸å¯¹ restricted indices(å—é™åˆ¶ç´¢å¼•ï¼Œæ¯”å¦‚ä»¥.å¼€å¤´çš„ç´¢å¼•) è¿›è¡Œæ“ä½œï¼Œtrueè¡¨ç¤ºå…è®¸ï¼Œfalseè¡¨ç¤ºä¸å…è®¸</span></span><br><span class=\"line\"><span class=\"comment\"># metadata: å…ƒæ•°æ®</span></span><br><span class=\"line\">    <span class=\"comment\"># application: è¡¨ç¤ºåº”ç”¨ç¨‹åºåç§°</span></span><br><span class=\"line\">    <span class=\"comment\"># environment: è¡¨ç¤ºç¯å¢ƒä¿¡æ¯</span></span><br><span class=\"line\">        <span class=\"comment\"># level: è¡¨ç¤ºç¯å¢ƒçº§åˆ«</span></span><br><span class=\"line\">        <span class=\"comment\"># trusted: è¡¨ç¤ºæ˜¯å¦å—ä¿¡ä»»</span></span><br><span class=\"line\">        <span class=\"comment\"># tags: è¡¨ç¤ºç¯å¢ƒæ ‡ç­¾</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># è¾“å‡ºï¼š</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">&quot;id&quot;</span> : <span class=\"string\">&quot;-kKu0ZUBrL2GcOxX0t1R&quot;</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;name&quot;</span> : <span class=\"string\">&quot;my-api-key&quot;</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;expiration&quot;</span> : 1743066050130,</span><br><span class=\"line\">  <span class=\"string\">&quot;api_key&quot;</span> : <span class=\"string\">&quot;03eNOYg_SCCHdzc0orsRvw&quot;</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;encoded&quot;</span> : <span class=\"string\">&quot;LWtLdTBaVUJyTDJHY094WDB0MVI6MDNlTk9ZZ19TQ0NIZHpjMG9yc1J2dw==&quot;</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹ApiKeyä¿¡æ¯ï¼Œæ ¹æ®idæŸ¥è¯¢åªä¼šè¿”å›ä¸€ä¸ªApiKeyï¼Œæ ¹æ®nameæŸ¥è¯¢ä¼šè¿”å›å¤šä¸ªApiKey</span></span><br><span class=\"line\">curl -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/_security/api_key?id=-kKu0ZUBrL2GcOxX0t1R&amp;pretty&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"># è¾“å‡ºï¼š</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">&quot;api_keys&quot;</span> : [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      <span class=\"string\">&quot;id&quot;</span> : <span class=\"string\">&quot;-kKu0ZUBrL2GcOxX0t1R&quot;</span>,</span><br><span class=\"line\">      <span class=\"string\">&quot;name&quot;</span> : <span class=\"string\">&quot;my-api-key&quot;</span>,</span><br><span class=\"line\">      <span class=\"string\">&quot;type&quot;</span> : <span class=\"string\">&quot;rest&quot;</span>,</span><br><span class=\"line\">      <span class=\"string\">&quot;creation&quot;</span> : 1742979650130,</span><br><span class=\"line\">      <span class=\"string\">&quot;expiration&quot;</span> : 1743066050130,</span><br><span class=\"line\">      <span class=\"string\">&quot;invalidated&quot;</span> : <span class=\"literal\">false</span>,</span><br><span class=\"line\">      <span class=\"string\">&quot;username&quot;</span> : <span class=\"string\">&quot;elastic&quot;</span>,</span><br><span class=\"line\">      <span class=\"string\">&quot;realm&quot;</span> : <span class=\"string\">&quot;reserved&quot;</span>,</span><br><span class=\"line\">      <span class=\"string\">&quot;realm_type&quot;</span> : <span class=\"string\">&quot;reserved&quot;</span>,</span><br><span class=\"line\">      <span class=\"string\">&quot;metadata&quot;</span> : &#123;</span><br><span class=\"line\">        <span class=\"string\">&quot;environment&quot;</span> : &#123;</span><br><span class=\"line\">          <span class=\"string\">&quot;level&quot;</span> : 1,</span><br><span class=\"line\">          <span class=\"string\">&quot;trusted&quot;</span> : <span class=\"literal\">true</span>,</span><br><span class=\"line\">          <span class=\"string\">&quot;tags&quot;</span> : [</span><br><span class=\"line\">            <span class=\"string\">&quot;dev&quot;</span>,</span><br><span class=\"line\">            <span class=\"string\">&quot;staging&quot;</span></span><br><span class=\"line\">          ]</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        <span class=\"string\">&quot;application&quot;</span> : <span class=\"string\">&quot;my-application&quot;</span></span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      <span class=\"string\">&quot;role_descriptors&quot;</span> : &#123;</span><br><span class=\"line\">        <span class=\"string\">&quot;role-a&quot;</span> : &#123;</span><br><span class=\"line\">          <span class=\"string\">&quot;cluster&quot;</span> : [</span><br><span class=\"line\">            <span class=\"string\">&quot;all&quot;</span></span><br><span class=\"line\">          ],</span><br><span class=\"line\">          <span class=\"string\">&quot;indices&quot;</span> : [</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">              <span class=\"string\">&quot;names&quot;</span> : [</span><br><span class=\"line\">                <span class=\"string\">&quot;index-a*&quot;</span></span><br><span class=\"line\">              ],</span><br><span class=\"line\">              <span class=\"string\">&quot;privileges&quot;</span> : [</span><br><span class=\"line\">                <span class=\"string\">&quot;read&quot;</span></span><br><span class=\"line\">              ],</span><br><span class=\"line\">              <span class=\"string\">&quot;allow_restricted_indices&quot;</span> : <span class=\"literal\">false</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">          ],</span><br><span class=\"line\">          <span class=\"string\">&quot;applications&quot;</span> : [ ],</span><br><span class=\"line\">          <span class=\"string\">&quot;run_as&quot;</span> : [ ],</span><br><span class=\"line\">          <span class=\"string\">&quot;metadata&quot;</span> : &#123; &#125;,</span><br><span class=\"line\">          <span class=\"string\">&quot;transient_metadata&quot;</span> : &#123;</span><br><span class=\"line\">            <span class=\"string\">&quot;enabled&quot;</span> : <span class=\"literal\">true</span></span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        <span class=\"string\">&quot;role-b&quot;</span> : &#123;</span><br><span class=\"line\">          <span class=\"string\">&quot;cluster&quot;</span> : [</span><br><span class=\"line\">            <span class=\"string\">&quot;all&quot;</span></span><br><span class=\"line\">          ],</span><br><span class=\"line\">          <span class=\"string\">&quot;indices&quot;</span> : [</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">              <span class=\"string\">&quot;names&quot;</span> : [</span><br><span class=\"line\">                <span class=\"string\">&quot;index-b*&quot;</span></span><br><span class=\"line\">              ],</span><br><span class=\"line\">              <span class=\"string\">&quot;privileges&quot;</span> : [</span><br><span class=\"line\">                <span class=\"string\">&quot;all&quot;</span></span><br><span class=\"line\">              ],</span><br><span class=\"line\">              <span class=\"string\">&quot;allow_restricted_indices&quot;</span> : <span class=\"literal\">false</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">          ],</span><br><span class=\"line\">          <span class=\"string\">&quot;applications&quot;</span> : [ ],</span><br><span class=\"line\">          <span class=\"string\">&quot;run_as&quot;</span> : [ ],</span><br><span class=\"line\">          <span class=\"string\">&quot;metadata&quot;</span> : &#123; &#125;,</span><br><span class=\"line\">          <span class=\"string\">&quot;transient_metadata&quot;</span> : &#123;</span><br><span class=\"line\">            <span class=\"string\">&quot;enabled&quot;</span> : <span class=\"literal\">true</span></span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ›´æ–°ApiKey</span></span><br><span class=\"line\">curl -u elastic:123456 -X PUT -k <span class=\"string\">&#x27;https://127.0.0.1:9200/_security/api_key/-kKu0ZUBrL2GcOxX0t1R?pretty&#x27;</span> \\</span><br><span class=\"line\">--header <span class=\"string\">&#x27;Content-Type: application/json&#x27;</span> \\</span><br><span class=\"line\">--data <span class=\"string\">&#x27;&#123;</span></span><br><span class=\"line\"><span class=\"string\">    &quot;metadata&quot;: &#123;&#125;</span></span><br><span class=\"line\"><span class=\"string\">&#125;&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"># è¾“å‡ºï¼š</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">&quot;updated&quot;</span> : <span class=\"literal\">true</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ç½®ApiKeyæ— æ•ˆ</span></span><br><span class=\"line\">curl -u elastic:123456 -X DELETE -k <span class=\"string\">&#x27;https://127.0.0.1:9200/_security/api_key?pretty&#x27;</span> \\</span><br><span class=\"line\">--header <span class=\"string\">&#x27;Content-Type: application/json&#x27;</span> \\</span><br><span class=\"line\">--data <span class=\"string\">&#x27;&#123;</span></span><br><span class=\"line\"><span class=\"string\">   &quot;ids&quot; : [ &quot;-kKu0ZUBrL2GcOxX0t1R&quot; ]</span></span><br><span class=\"line\"><span class=\"string\">&#125;&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"># è¾“å‡ºï¼š</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">&quot;invalidated_api_keys&quot;</span> : [</span><br><span class=\"line\">    <span class=\"string\">&quot;-kKu0ZUBrL2GcOxX0t1R&quot;</span></span><br><span class=\"line\">  ],</span><br><span class=\"line\">  <span class=\"string\">&quot;previously_invalidated_api_keys&quot;</span> : [ ],</span><br><span class=\"line\">  <span class=\"string\">&quot;error_count&quot;</span> : 0</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç»å¦‚ä½•åœ¨linuxä¸‹å®‰è£…Elasticsearch Elasticsearchç‰ˆæœ¬8.17.3 ä¸‹è½½ ä¸‹è½½åœ°å€ï¼šhttps://www.elastic.co/cn/downloads/past-releases#elasticsearch é€‰æ‹©å¯¹åº”çš„ç‰ˆæœ¬ï¼šè¿™é‡Œé€‰æ‹©å½“å‰çš„æœ€æ–°ç‰ˆElasticsearch 8.17.3ï¼Œä¹‹åé€‰æ‹©å¯¹åº”çš„æ“ä½œç³»ç»ŸLINUX X86_64 1wget https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-8.17.3-linux-x86_64.tar.gz ä¸‹è½½å®Œæˆåè§£å‹åˆ°/usr/local/elasticsearchç›®å½•ä¸‹ï¼Œè§£å‹å‘½ä»¤å¦‚ä¸‹ï¼š 12mkdir /usr/local/elasticsearchtar -zxvf elasticsearch-8.17.3-linux-x86_64.tar.gz -C /usr/local/elasticsearch ElasticSearchç›®å½•ç»“æ„ 12345678bin # è„šæœ¬æ–‡ä»¶ï¼ŒåŒ…æ‹¬å¯åŠ¨elasticsearchï¼Œå®‰è£…æ’ä»¶ï¼Œè¿è¡Œç»Ÿè®¡æ•°æ®ç­‰config # é…ç½®æ–‡ä»¶ç›®å½•ï¼Œå¦‚elasticsearché…ç½®ã€è§’è‰²é…ç½®ã€jvmé…ç½®ã€è¯ä¹¦ç­‰ã€‚data # æ•°æ®ç›®å½•ï¼Œé»˜è®¤å€¼ $ES_HOME/dataï¼ŒåŒ…å«èŠ‚ç‚¹ã€åˆ†ç‰‡ã€ç´¢å¼•ã€æ–‡æ¡£çš„æ‰€æœ‰æ•°æ®ï¼Œç”Ÿäº§ç¯å¢ƒå»ºè®®ä¿®æ”¹jdk # JDKç›®å½•ï¼Œç”¨äºè¿è¡ŒElasticsearchï¼Œ7.xä»¥åè‡ªå¸¦lib # Elasticsearchä¾èµ–çš„JARåŒ…logs # æ—¥å¿—ç›®å½•ï¼Œé»˜è®¤å€¼ $ES_HOME/logsï¼Œç”Ÿäº§ç¯å¢ƒå»ºè®®ä¿®æ”¹modules # åŒ…å«æ‰€æœ‰çš„Elasticsearchæ¨¡å—ï¼Œå¦‚Clusterã€Discoveryã€Indicesç­‰plugins # å·²å®‰è£…æ’ä»¶ç›®å½• åˆ›å»ºå¯åŠ¨ç”¨æˆ· elasticsearchå’Œkibanaéƒ½ä¸èƒ½ç”¨rootç”¨æˆ·å¯åŠ¨ åˆ›å»ºç”¨æˆ·elasticï¼Œå¹¶è®¾ç½®å¯†ç  12useradd elasticpasswd elastic ä¿®æ”¹elasticsearchå®‰è£…ç›®å½•çš„ç”¨æˆ·æƒé™ 1chown -R elastic:elastic /usr/local/elasticsearch é…ç½®ç¯å¢ƒå˜é‡ è¿›å…¥elasticç”¨æˆ·ä¸»ç›®å½•ï¼Œ/home/elasticç›®å½•ä¸‹ï¼Œè®¾ç½®ç”¨æˆ·çº§åˆ«çš„ç¯å¢ƒå˜é‡ 12# åˆ‡æ¢åˆ°elasticç”¨æˆ·su - elastic vim .bash_profile 1234# Elasticsearchå®‰è£…ç›®å½•ï¼Œå®ƒç”¨äºå®šä½Elasticsearchçš„é…ç½®æ–‡ä»¶ã€æ’ä»¶å’Œå…¶ä»–ç›¸å…³èµ„æºã€‚export ES_HOME=/usr/local/elasticsearch/elasticsearch-8.17.3# Elasticsearchä½¿ç”¨çš„JDKå®‰è£…ç›®å½•ï¼Œåœ¨å¯åŠ¨Elasticsearchæ—¶ï¼Œå®ƒä¼šæ£€æŸ¥ES_JAVA_HOMEç¯å¢ƒå˜é‡å¹¶ä½¿ç”¨å…¶ä¸­çš„Javaè·¯å¾„ã€‚export ES_JAVA_HOME=/usr/local/elasticsearch/elasticsearch-8.17.3/jdk/ æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ä½¿é…ç½®ç”Ÿæ•ˆ 1source .bash_profile é…ç½®JVMå‚æ•°ï¼ˆå¯é€‰ï¼‰ ESæ¯”è¾ƒè€—å†…å­˜ï¼Œå»ºè®®è™šæ‹Ÿæœº4Gæˆ–ä»¥ä¸Šå†…å­˜ï¼Œjvm1gä»¥ä¸Šçš„å†…å­˜åˆ†é… è¿›å…¥/usr/local/elasticsearch/elasticsearch-8.17.3/configç›®å½•ï¼Œä¿®æ”¹jvm.optionsæ–‡ä»¶ï¼Œè°ƒæ•´jvmå †å†…å­˜å¤§å° 12-Xms4g # è®¾ç½®æœ€å°å †å†…å­˜ï¼Œé»˜è®¤4gï¼Œä¸èƒ½å°äº1g-Xmx4g # è®¾ç½®æœ€å¤§å †å†…å­˜ï¼Œé»˜è®¤4gï¼ŒXmxä¸è¦è¶…è¿‡æœºå™¨å†…å­˜çš„50%ï¼Œä¸è¦è¶…è¿‡30g åˆ›å»ºæ•°æ®å’Œæ—¥å¿—å­˜å‚¨ç›®å½• 1234# åˆ‡æ¢åˆ°elasticç”¨æˆ·su - elastic# åˆ›å»ºç›®å½•mkdir /usr/local/elasticsearch/data /usr/local/elasticsearch/log é…ç½®å¯åŠ¨æ–‡ä»¶ å¦‚æœæ˜¯æœ¬åœ°å¼€å‘ç¯å¢ƒï¼Œä¹Ÿå¯ä»¥ä¸åšä»»ä½•ä¿®æ”¹ç›´æ¥å¯åŠ¨ï¼Œå› ä¸ºå¤§éƒ¨åˆ†é…ç½®é¡¹éƒ½æœ‰é»˜è®¤å€¼ï¼Œä½†ä¸ºäº†æ›´å¥½çš„æ§åˆ¶ESï¼Œæ¨èæŒ‰å¦‚ä¸‹æ–¹å¼è¿›è¡Œé…ç½® è¿›å…¥/usr/local/elasticsearch/elasticsearch-8.17.3/configç›®å½•ï¼Œä¿®æ”¹elasticsearch.ymlæ–‡ä»¶ 123456789101112131415161718192021222324# é›†ç¾¤åç§°ï¼Œå¤šä¸ªèŠ‚ç‚¹å¦‚æœè¦ç»„æˆåŒä¸€ä¸ªé›†ç¾¤ï¼Œé‚£ä¹ˆé›†ç¾¤åç§°ä¸€å®šè¦é…ç½®æˆç›¸åŒï¼Œé»˜è®¤å€¼elasticsearchcluster.name: test-elk# èŠ‚ç‚¹åç§°ï¼Œé»˜è®¤å€¼å½“å‰èŠ‚ç‚¹éƒ¨ç½²æ‰€åœ¨æœºå™¨çš„ä¸»æœºånode.name: node-1# æ•°æ®å­˜å‚¨è·¯å¾„ï¼Œé»˜è®¤å€¼ $ES_HOME/datapath.data: /usr/local/elasticsearch/data# æ—¥å¿—å­˜å‚¨è·¯å¾„ï¼Œé»˜è®¤å€¼ $ES_HOME/logspath.logs: /usr/local/elasticsearch/logs# é…ç½®ESå¯åŠ¨æ—¶æ˜¯å¦è¿›è¡Œå†…å­˜é”å®šæ£€æŸ¥ï¼Œé»˜è®¤å€¼trueï¼Œæœ¬æœºå†…å­˜æ¯”è¾ƒå°æ—¶è®¾ç½®ä¸ºfalsebootstrap.memory_lock: false# å…è®¸é€šè¿‡ä»»ä½•åœ°å€è®¿é—®ï¼Œå¼€å¯è¿œç¨‹è®¿é—®network.host: 0.0.0.0# é…ç½®å½“å‰ESèŠ‚ç‚¹å¯¹å¤–æä¾›æœåŠ¡çš„httpç«¯å£ï¼Œé»˜è®¤ 9200http.port: 9200# é…ç½®å½“å‰ESèŠ‚ç‚¹å¯¹å¤–æä¾›æœåŠ¡çš„tcpç«¯å£ï¼Œé»˜è®¤ 9300transport.port: 9300# é›†ç¾¤å†…çš„ä¸»æœºåˆ—è¡¨ï¼Œå•èŠ‚ç‚¹å¯åŠ¨æ—¶å¯ä»¥ä¸é…ç½®# discovery.seed_hosts: [&quot;127.0.0.1&quot;]# ç¬¬ä¸€æ¬¡å¯åŠ¨æ—¶éœ€è¦å‚ä¸é€‰ä¸»çš„èŠ‚ç‚¹åç§°cluster.initial_master_nodes: [&quot;node-1&quot;]#è§£å†³è·¨åŸŸé—®é¢˜http.cors.enabled: truehttp.cors.allow-origin: &quot;*&quot; å¯åŠ¨ElasticSearchæœåŠ¡ è¿›å…¥/usr/local/elasticsearch/elasticsearch-8.17.3ç›®å½•ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤å¯åŠ¨æœåŠ¡ 123./bin/elasticsearch# åå°å¯åŠ¨./bin/elasticsearch -d ESå¯åŠ¨å‰çš„å¼•å¯¼æ£€æŸ¥ ESå¯åŠ¨æ—¶ï¼Œé»˜è®¤ä¼šè¿›è¡Œå¼•å¯¼æ£€æŸ¥ï¼Œæ‰€è°“å¼•å¯¼æ£€æŸ¥å°±æ˜¯åœ¨æœåŠ¡å¯åŠ¨ä¹‹å‰å¯¹ä¸€äº›é‡è¦çš„é…ç½®é¡¹è¿›è¡Œæ£€æŸ¥ï¼Œæ£€æŸ¥å…¶é…ç½®å€¼æ˜¯å¦æ˜¯åˆç†çš„ã€‚å¼•å¯¼æ£€æŸ¥åŒ…æ‹¬å¯¹JVMå¤§å°ã€å†…å­˜é”ã€è™šæ‹Ÿå†…å­˜ã€æœ€å¤§çº¿ç¨‹æ•°ã€é›†ç¾¤å‘ç°ç›¸å…³é…ç½®ç­‰ç›¸å…³çš„æ£€æŸ¥ï¼Œå¦‚æœæŸä¸€é¡¹æˆ–è€…å‡ é¡¹çš„é…ç½®ä¸åˆç†ï¼ŒESä¼šæ‹’ç»å¯åŠ¨æœåŠ¡ã€‚ å¦‚æœå¯åŠ¨æœåŠ¡æ—¶ï¼ŒæŠ¥ä»¥ä¸‹é”™è¯¯ï¼Œåˆ™éœ€è¦è§£å†³å¼•å¯¼æ£€æŸ¥ä¸­çš„é—®é¢˜ 1.max virtual memory areas vm.max_map_count [65530] is too low, increase to at least [262144]; åŸå› ï¼šæœ€å¤§è™šæ‹Ÿå†…å­˜å¤ªå°,è°ƒå¤§ç³»ç»Ÿçš„è™šæ‹Ÿå†…å­˜ è§£å†³åŠæ³•ï¼š 123456# rootç”¨æˆ·ä¸‹è¿è¡Œvim /etc/sysctl.conf# è¿½åŠ ä»¥ä¸‹å†…å®¹ï¼švm.max_map_count=262144# ä¿å­˜é€€å‡ºä¹‹åæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼šsysctl -p 2.max file descriptors [4096] for elasticsearch process is too low, increase to at least [65536] åŸå› ï¼šæ–‡ä»¶æè¿°ç¬¦å¤ªå°ï¼Œè°ƒå¤§ç³»ç»Ÿçš„æ–‡ä»¶æè¿°ç¬¦ è§£å†³åŠæ³•ï¼š 1234567# rootç”¨æˆ·ä¸‹è¿è¡Œvim /etc/security/limits.conf# æœ«å°¾æ·»åŠ å¦‚ä¸‹é…ç½®ï¼š* soft nofile 65536* hard nofile 65536* soft nproc 4096* hard nproc 4096 å¦‚æœåªæ˜¯å•èŠ‚ç‚¹çš„å¼€å‘ç¯å¢ƒï¼Œåˆ™å¯ä»¥å…³é—­å¼•å¯¼æ£€æŸ¥ï¼Œç”Ÿæˆç¯å¢ƒä¸å»ºè®®è¿™æ ·åšï¼Œå› ä¸ºå…³é—­å¼•å¯¼æ£€æŸ¥åï¼ŒESæœåŠ¡å°†æ— æ³•ä¿è¯é›†ç¾¤çš„é«˜å¯ç”¨æ€§ã€‚ 12345# è¿›å…¥elasticsearchå®‰è£…ç›®å½•vim config/elasticsearch.yml# æ·»åŠ å¦‚ä¸‹é…ç½®ï¼š# æŒ‡å®šèŠ‚ç‚¹ä¸ºå•èŠ‚ç‚¹ï¼Œå¯ä»¥ç»•è¿‡å¼•å¯¼æ£€æŸ¥discovery.type: single-node æœåŠ¡æ­£å¸¸å¯åŠ¨åä»ç„¶ä¸èƒ½æ­£å¸¸è®¿é—® è®¿é—®æœåŠ¡ 12curl http://127.0.0.1:9200curl: (52) Empty reply from server æŸ¥çœ‹æ—¥å¿—/usr/local/elasticsearch/elasticsearch-8.17.3/logs/test-elk.logï¼Œå‘ç°æŠ¥å¦‚ä¸‹è­¦å‘Šï¼š 1[WARN ][o.e.h.n.Netty4HttpServerTransport] [node-1] received plaintext http traffic on an https channel, closing connection Netty4HttpChannel&#123;localAddress=/127.0.0.1:9200, remoteAddress=/127.0.0.1:38426&#125; åŸå› æ˜¯ESåœ¨å¯åŠ¨æœåŠ¡æ—¶é»˜è®¤å¼€å¯äº† X-Pack å®‰å…¨åŠŸèƒ½ï¼ŒæŸ¥çœ‹é…ç½®æ–‡ä»¶/usr/local/elasticsearch/elasticsearch-8.17.3/config/elasticsearch.ymlï¼Œå‘ç°é…ç½®é¡¹xpack.security.xxxç›¸å…³é…ç½®é¡¹è¢«è‡ªåŠ¨æ·»åŠ äº†ï¼Œå¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930313233#----------------------- BEGIN SECURITY AUTO CONFIGURATION -----------------------## The following settings, TLS certificates, and keys have been automatically# generated to configure Elasticsearch security features on 20-03-2025 08:53:20## --------------------------------------------------------------------------------# Enable security features# å¯ç”¨ Elasticsearch çš„å®‰å…¨ç‰¹æ€§ï¼ŒåŒ…æ‹¬ç”¨æˆ·è®¤è¯ã€è§’è‰²ç®¡ç†ã€åŠ å¯†ç­‰ã€‚# å¼€å¯äº† X-Pack å®‰å…¨åŠŸèƒ½ï¼Œè¿™æ„å‘³ç€ä½ éœ€è¦è¿›è¡Œç”¨æˆ·è®¤è¯æ‰èƒ½è®¿é—® Elasticsearchã€‚# å¦‚æœéœ€è¦å…³é—­ X-Pack å®‰å…¨åŠŸèƒ½ï¼Œä½ å¯ä»¥å°† xpack.security.enabled è®¾ç½®ä¸º falseã€‚xpack.security.enabled: true# å¯ç”¨å®‰å…¨æ³¨å†ŒåŠŸèƒ½ï¼Œå…è®¸é€šè¿‡äº¤äº’å¼å‘å¯¼æ¥é…ç½®å®‰å…¨è®¾ç½®ã€‚# è¿™ä½¿å¾—ä½ å¯ä»¥é€šè¿‡ Kibana æˆ–å‘½ä»¤è¡Œå·¥å…·æ¥è‡ªåŠ¨é…ç½® SSL è¯ä¹¦å’Œå…¶ä»–å®‰å…¨è®¾ç½®ã€‚xpack.security.enrollment.enabled: true# Enable encryption for HTTP API client connections, such as Kibana, Logstash, and Agents# å¯ç”¨ HTTP API å®¢æˆ·ç«¯è¿æ¥çš„åŠ å¯†# Kibanaã€Logstash å’Œå…¶ä»–é€šè¿‡ HTTP API è¿æ¥åˆ° Elasticsearch çš„å®¢æˆ·ç«¯å°†ä½¿ç”¨ HTTPS è¿›è¡Œé€šä¿¡ï¼Œå¢å¼ºå®‰å…¨æ€§ã€‚xpack.security.http.ssl: enabled: true # å¯ç”¨ HTTP å±‚çš„ SSL åŠ å¯†ï¼Œå³httpsè®¿é—®ï¼Œç¡®ä¿å®¢æˆ·ç«¯ä¸ Elasticsearch ä¹‹é—´çš„é€šä¿¡æ˜¯åŠ å¯†çš„ã€‚è®¾ç½®ä¸ºfalseæ—¶ï¼Œå…³é—­åŠ å¯†ï¼Œå³httpè®¿é—® keystore.path: certs/http.p12 # æŒ‡å®šç”¨äº HTTP å±‚åŠ å¯†çš„å¯†é’¥åº“æ–‡ä»¶è·¯å¾„ã€‚è¿™æ˜¯ä¸€ä¸ª PKCS12 æ–‡ä»¶ï¼ŒåŒ…å«ç”¨äºåŠ å¯†å’ŒéªŒè¯çš„å…¬é’¥å’Œç§é’¥ã€‚# Enable encryption and mutual authentication between cluster nodes# å¯ç”¨èŠ‚ç‚¹é—´çš„åŠ å¯†å’ŒåŒå‘è®¤è¯# Elasticsearch é›†ç¾¤ä¸­çš„èŠ‚ç‚¹ä¹‹é—´çš„é€šä¿¡å°†ä½¿ç”¨ SSL åŠ å¯†ï¼Œå¹¶ä¸”æ¯ä¸ªèŠ‚ç‚¹éƒ½ä¼šéªŒè¯å…¶ä»–èŠ‚ç‚¹çš„èº«ä»½ï¼Œä»è€Œå¢å¼ºé›†ç¾¤çš„å®‰å…¨æ€§ã€‚# æ‰€æœ‰èŠ‚ç‚¹è¦é…ç½®ç›¸åŒçš„è¯ä¹¦xpack.security.transport.ssl: enabled: true # å¯ç”¨ä¼ è¾“å±‚çš„ SSL åŠ å¯†ï¼Œç¡®ä¿èŠ‚ç‚¹ä¹‹é—´çš„å†…éƒ¨é€šä¿¡æ˜¯åŠ å¯†çš„ã€‚ verification_mode: certificate # è®¾ç½®éªŒè¯æ¨¡å¼ä¸º certificateï¼Œè¿™æ„å‘³ç€èŠ‚ç‚¹ä¹‹é—´éœ€è¦åŒå‘è®¤è¯ï¼ˆå³æ¯ä¸ªèŠ‚ç‚¹éƒ½éœ€è¦éªŒè¯å¯¹æ–¹çš„èº«ä»½ï¼‰ã€‚ keystore.path: certs/transport.p12 # æŒ‡å®šç”¨äºä¼ è¾“å±‚åŠ å¯†çš„å¯†é’¥åº“æ–‡ä»¶è·¯å¾„ã€‚è¿™æ˜¯å¦ä¸€ä¸ª PKCS12 æ–‡ä»¶ï¼ŒåŒ…å«ç”¨äºåŠ å¯†å’ŒéªŒè¯çš„å…¬é’¥å’Œç§é’¥ã€‚ truststore.path: certs/transport.p12 # æŒ‡å®šç”¨äºå­˜å‚¨ä¿¡ä»»è¯ä¹¦çš„ä¿¡ä»»åº“æ–‡ä»¶è·¯å¾„ã€‚è¿™é€šå¸¸ä¸å¯†é’¥åº“ç›¸åŒï¼Œä½†å¯ä»¥ä¸åŒã€‚#----------------------- END SECURITY AUTO CONFIGURATION ------------------------- è§£å†³æ–¹æ³•ï¼š 1.ä¸æƒ³å¼€å¯å®‰å…¨è®¤è¯ï¼Œå°† xpack.security.enabled è®¾ç½®ä¸º falseï¼Œè¿™æ ·å³ä¾¿ä¸‹é¢çš„é…ç½®éƒ½è®¾ç½®ä¸ºtrueä¹Ÿä¸ä¼šæœ‰æ•ˆã€‚ 2.ä¸æƒ³httpsè®¿é—®ï¼Œå°† xpack.security.http.ssl.enabled è®¾ç½®ä¸º falseï¼Œä½†è¿™æ ·ä¼šå¯¼è‡´æ— æ³•é€šè¿‡è®¤è¯Tokenæ·»åŠ å…¶å®ƒèŠ‚ç‚¹æˆ–Kibanaã€‚ 3.ä¸æƒ³èŠ‚ç‚¹é—´é€šä¿¡åŠ å¯†ï¼Œå°† xpack.security.transport.ssl.enabled è®¾ç½®ä¸º false ä¸ºäº†ä¿è¯ESçš„å®‰å…¨ï¼Œæˆ‘è¿™é‡Œå°±å¼€å¯å®‰å…¨è®¤è¯ï¼Œå¹¶ä¸”é€šè¿‡httpsè®¿é—®ESï¼Œä½†æ­¤æ—¶æˆ‘ä»¬è®¿é—®ESçš„APIå°±éœ€è¦å¸¦ä¸Šè®¤è¯ç”¨æˆ·ï¼Œé‚£ä¹ˆç”¨æˆ·åå’Œå¯†ç æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ å®é™…ä¸Šåœ¨ESç¬¬ä¸€æ¬¡æ­£å¸¸å¯åŠ¨æ—¶å…¶æ—¥å¿—ä¸­å°±æ‰“å°äº†è‡ªåŠ¨é…ç½®çš„å®‰å…¨ç›¸å…³çš„ä¿¡æ¯æç¤ºï¼Œé‡Œé¢å°±ç»™å‡ºäº†ç™»å½•ç”¨æˆ·å’Œåˆå§‹çš„å¯†ç ï¼Œå¦‚ä¸‹ï¼š 1234567891011121314151617181920212223242526272829303132â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”# è¿™äº›æ—¥å¿—ä¿¡æ¯æä¾›äº† Elasticsearch 8 åœ¨é¦–æ¬¡å¯åŠ¨æ—¶è‡ªåŠ¨é…ç½®çš„å®‰å…¨ç‰¹æ€§ã€ç”Ÿæˆçš„é»˜è®¤å¯†ç ã€è¯ä¹¦æŒ‡çº¹ä»¥åŠå¦‚ä½•é…ç½® Kibana å’Œå…¶ä»–èŠ‚ç‚¹åŠ å…¥é›†ç¾¤çš„è¯¦ç»†è¯´æ˜ã€‚âœ… Elasticsearch security features have been automatically configured!âœ… Authentication is enabled and cluster connections are encrypted.# è¿™æ˜¯ elastic ç”¨æˆ·çš„é»˜è®¤å¯†ç ã€‚ç³»ç»Ÿå»ºè®®ä½ ä½¿ç”¨ bin/elasticsearch-reset-password -u elastic å‘½ä»¤æ¥é‡ç½®æ­¤å¯†ç ã€‚â„¹ï¸ Password for the elastic user (reset with `bin/elasticsearch-reset-password -u elastic`): BNb=*qz6_M*mXL9uZiSP # è¿™é‡Œä¼šæ‰“å°å‡ºESè‡ªåŠ¨ç”Ÿæˆçš„å¯†ç # è¿™æ˜¯ HTTP CA è¯ä¹¦çš„ SHA-256 æŒ‡çº¹ã€‚CA è¯ä¹¦ç”¨äºéªŒè¯ HTTPS è¿æ¥çš„èº«ä»½ã€‚â„¹ï¸ HTTP CA certificate SHA-256 fingerprint: 3f141c16dfc6e165894bc1672084b220dcdd22ffe02116d51ac18003cfaa5a1d# æä¾›äº†å°† Kibana é…ç½®ä¸ºä½¿ç”¨æ­¤ Elasticsearch é›†ç¾¤çš„æ­¥éª¤ã€‚â„¹ï¸ Configure Kibana to use this cluster:# å¯åŠ¨ Kibana å¹¶æŒ‰ç…§ç»ˆç«¯ä¸­æ˜¾ç¤ºçš„é…ç½®é“¾æ¥è¿›è¡Œæ“ä½œã€‚â€¢ Run Kibana and click the configuration link in the terminal when Kibana starts.# å¤åˆ¶æä¾›çš„æ³¨å†Œä»¤ç‰Œï¼Œå¹¶åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ Kibana æ—¶ç²˜è´´æ­¤ä»¤ç‰Œã€‚ä»¤ç‰Œåœ¨æ¥ä¸‹æ¥çš„ 30 åˆ†é’Ÿå†…æœ‰æ•ˆã€‚# è¡¥å……è¯´æ˜ï¼šç”Ÿæˆæ–°çš„kibanaæ³¨å†Œä»¤ç‰Œï¼šbin/elasticsearch-create-enrollment-token -s kibanaâ€¢ Copy the following enrollment token and paste it into Kibana in your browser (valid for the next 30 minutes): eyJ2ZXIiOiI4LjE0LjAiLCJhZHIiOlsiMTAuMjUwLjAuMjM5OjkyMDAiXSwiZmdyIjoiM2YxNDFjMTZkZmM2ZTE2NTg5NGJjMTY3MjA4NGIyMjBkY2RkMjJmZmUwMjExNmQ1MWFjMTgwMDNjZmFhNWExZCIsImtleSI6ImFSWFBzcFVCTVVmc1d5aUJnbjBtOmRzbVBLQV95UXhDZkJpXzQyWDNEMVEifQ==# æä¾›äº†å°†æ–°çš„ Elasticsearch èŠ‚ç‚¹åŠ å…¥ç°æœ‰é›†ç¾¤çš„æ­¥éª¤ã€‚â„¹ï¸ Configure other nodes to join this cluster:# ä½¿ç”¨ bin/elasticsearch --enrollment-token &lt;token&gt; å‘½ä»¤å¯åŠ¨æ–°çš„ Elasticsearch èŠ‚ç‚¹ã€‚ä»¤ç‰Œåœ¨æ¥ä¸‹æ¥çš„ 30 åˆ†é’Ÿå†…æœ‰æ•ˆã€‚# è¡¥å……è¯´æ˜ï¼šç”Ÿæˆæ–°çš„èŠ‚ç‚¹æ³¨å†Œä»¤ç‰Œï¼šbin/elasticsearch-create-enrollment-token -s nodeâ€¢ Copy the following enrollment token and start new Elasticsearch nodes with `bin/elasticsearch --enrollment-token &lt;token&gt;` (valid for the next 30 minutes): eyJ2ZXIiOiI4LjE0LjAiLCJhZHIiOlsiMTAuMjUwLjAuMjM5OjkyMDAiXSwiZmdyIjoiM2YxNDFjMTZkZmM2ZTE2NTg5NGJjMTY3MjA4NGIyMjBkY2RkMjJmZmUwMjExNmQ1MWFjMTgwMDNjZmFhNWExZCIsImtleSI6ImF4WFBzcFVCTVVmc1d5aUJnbjFtOkFEallPdnpzUzh1MGJqOFpfVFE4a3cifQ==# å¦‚æœä½ åœ¨ Docker ä¸­è¿è¡Œ Elasticsearchï¼Œå¯ä»¥ä½¿ç”¨ docker run -e &quot;ENROLLMENT_TOKEN=&lt;token&gt;&quot; docker.elastic.co/elasticsearch/elasticsearch:8.17.3 å‘½ä»¤å¯åŠ¨æ–°èŠ‚ç‚¹ã€‚ If you&#x27;re running in Docker, copy the enrollment token and run: `docker run -e &quot;ENROLLMENT_TOKEN=&lt;token&gt;&quot; docker.elastic.co/elasticsearch/elasticsearch:8.17.3`â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” ç™»å½•ç”¨æˆ·ä¸ºelastic[å…¶è§’è‰²ä¸ºè¶…çº§ç”¨æˆ·]ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ—¥å¿—æŸ¥çœ‹åˆå§‹çš„å¯†ç ï¼Œä¹Ÿå¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤é‡ç½®å¯†ç  1234567891011# é‡ç½®å¯†ç ï¼Œå¯†ç è‡ªåŠ¨ç”Ÿæˆbin/elasticsearch-reset-password -u elastic# é‡ç½®å¯†ç ï¼Œè‡ªå·±è¾“å…¥è¦è®¾ç½®çš„å¯†ç ï¼Œæ¯”å¦‚æˆ‘è¿™é‡Œè¿™æ˜¯ä¸º 123456bin/elasticsearch-reset-password -u elastic -i# é€šè¿‡curlé‡ç½®å¯†ç curl -X PUT -u elastic:old_password -k &#x27;https://127.0.0.1:9200/_security/user/elastic/_password&#x27; \\ -H &#x27;Content-Type: application/json&#x27; \\ -d &#x27;&#123; &quot;password&quot;: &quot;new_password&quot; &#125;&#x27; curl è®¿é—®ESæœåŠ¡ 123456789101112131415161718192021222324# -k å¿½ç•¥è¯ä¹¦æ ¡éªŒcurl -u elastic:123456 -k https://127.0.0.1:9200# æˆ–è€… å°†è®¤è¯ä¿¡æ¯é€šè¿‡headerä¼ é€’ï¼Œelastic:123456 é€šè¿‡base64åŠ å¯†curl -k https://127.0.0.1:9200 -H &#x27;Authorization: Basic ZWxhc3RpYzoxMjM0NTY=&#x27;# ä¹Ÿå¯ä»¥é€šè¿‡è¯ä¹¦è®¿é—®httpsæœåŠ¡ï¼Œè¿™ä¸ªè¯ä¹¦å°±æ˜¯ESåœ¨å¼€å¯å®‰å…¨è®¤è¯å¯åŠ¨æ—¶è‡ªåŠ¨ç”Ÿæˆçš„curl -u elastic:123456 --cacert /usr/local/elasticsearch/elasticsearch-8.17.3/config/certs/http_ca.crt https://127.0.0.1:9200# è¾“å‡ºå¦‚ä¸‹ï¼š&#123; &quot;name&quot; : &quot;node-1&quot;, &quot;cluster_name&quot; : &quot;test-elk&quot;, &quot;cluster_uuid&quot; : &quot;RykjCSPnSCi4Hsi37uziWw&quot;, &quot;version&quot; : &#123; &quot;number&quot; : &quot;8.17.3&quot;, &quot;build_flavor&quot; : &quot;default&quot;, &quot;build_type&quot; : &quot;tar&quot;, &quot;build_hash&quot; : &quot;a091390de485bd4b127884f7e565c0cad59b10d2&quot;, &quot;build_date&quot; : &quot;2025-02-28T10:07:26.089129809Z&quot;, &quot;build_snapshot&quot; : false, &quot;lucene_version&quot; : &quot;9.12.0&quot;, &quot;minimum_wire_compatibility_version&quot; : &quot;7.17.0&quot;, &quot;minimum_index_compatibility_version&quot; : &quot;7.0.0&quot; &#125;, &quot;tagline&quot; : &quot;You Know, for Search&quot;&#125; å¼€å‘æ¨¡å¼å’Œç”Ÿäº§æ¨¡å¼ å¼€å‘æ¨¡å¼ï¼šå¦‚æœç”¨æˆ·åªæ˜¯å‡ºäºå­¦ä¹ ç›®çš„ï¼Œå¯ä»¥åœ¨é…ç½®æ–‡ä»¶ä¸­æ·»åŠ  discovery.type=single-node ï¼Œè¡¨ç¤ºå•èŠ‚ç‚¹æ¨¡å¼ï¼Œå³å¼€å‘æ¨¡å¼ã€‚æ­¤æ¨¡å¼å¯ä»¥ç»•è¿‡å¼•å¯¼æ£€æŸ¥ã€‚ ç”Ÿäº§æ¨¡å¼ï¼šå½“ç”¨æˆ·é…ç½®äº†æœ‰å…³é›†ç¾¤çš„ç›¸å…³é…ç½®é¡¹æ—¶å°±ä¼šè§¦å‘ç”Ÿäº§æ¨¡å¼ï¼Œåœ¨ç”Ÿäº§æ¨¡å¼ä¸‹ï¼ŒæœåŠ¡å¯åŠ¨ä¼šè§¦å‘ESçš„å¼•å¯¼æ£€æŸ¥æˆ–è€…å«å¯åŠ¨æ£€æŸ¥ï¼ˆbootstrap checksï¼‰ï¼Œå¼•å¯¼æ£€æŸ¥ååˆ†ä¸¥æ ¼ï¼Œå³æŸäº›æ£€æŸ¥é¡¹ä¸é€šè¿‡åˆ™ESæœåŠ¡å°†æ— æ³•å¯åŠ¨ã€‚ å¼•å¯¼æ£€æŸ¥ï¼šåœ¨æœåŠ¡å¯åŠ¨ä¹‹å‰å¯¹ä¸€äº›é‡è¦çš„é…ç½®é¡¹è¿›è¡Œæ£€æŸ¥ï¼Œæ£€æŸ¥å…¶é…ç½®å€¼æ˜¯å¦æ˜¯åˆç†çš„ã€‚å¼•å¯¼æ£€æŸ¥åŒ…æ‹¬å¯¹JVMå¤§å°ã€å†…å­˜é”ã€è™šæ‹Ÿå†…å­˜ã€æœ€å¤§çº¿ç¨‹æ•°ã€é›†ç¾¤å‘ç°ç›¸å…³é…ç½®ç­‰ç›¸å…³çš„æ£€æŸ¥ï¼Œå¦‚æœæŸä¸€é¡¹æˆ–è€…å‡ é¡¹çš„é…ç½®ä¸åˆç†ï¼ŒESä¼šæ‹’ç»å¯åŠ¨æœåŠ¡ï¼Œå¹¶ä¸”åœ¨å¼€å‘æ¨¡å¼ä¸‹çš„æŸäº›è­¦å‘Šä¿¡æ¯ä¼šå‡çº§æˆé”™è¯¯ä¿¡æ¯è¾“å‡ºã€‚å¼•å¯¼æ£€æŸ¥ååˆ†ä¸¥æ ¼ï¼Œä¹‹æ‰€ä»¥å®å¯æ‹’ç»æœåŠ¡ä¹Ÿè¦é˜»æ­¢ç”¨æˆ·å¯åŠ¨æœåŠ¡æ˜¯ä¸ºäº†é˜²æ­¢ç”¨æˆ·åœ¨å¯¹ESçš„åŸºæœ¬ä½¿ç”¨ä¸äº†è§£çš„å‰æä¸‹å¯åŠ¨æœåŠ¡è€Œå¯¼è‡´çš„åæœŸæ€§èƒ½é—®é¢˜æ— æ³•è§£å†³æˆ–è€…è§£å†³èµ·æ¥å¾ˆéº»çƒ¦ã€‚å› ä¸ºä¸€æ—¦æœåŠ¡ä»¥æŸç§ä¸åˆç†çš„é…ç½®å¯åŠ¨ï¼Œæ—¶é—´ä¹…äº†ä¹‹åå¯èƒ½ä¼šäº§ç”Ÿè¾ƒå¤§çš„æ€§èƒ½é—®é¢˜ï¼Œä½†æ­¤æ—¶é›†ç¾¤å·²ç»å˜å¾—éš¾ä»¥ç»´æŠ¤å’Œæ‰©å±•ï¼ŒESä¸ºäº†é¿å…è¿™ç§æƒ…å†µè€Œåšå‡ºäº†å¼•å¯¼æ£€æŸ¥çš„è®¾ç½®ï¼Œæœ¬æ¥åœ¨å¼€å‘æ¨¡å¼ä¸‹ä¸ºè­¦å‘Šçš„å¯åŠ¨æ—¥å¿—ä¼šå‡çº§ä¸ºæŠ¥é”™ï¼ˆErrorï¼‰ã€‚è¿™ç§è®¾å®šè™½ç„¶å¢åŠ äº†ç”¨æˆ·çš„ä½¿ç”¨é—¨æ§›ï¼Œä½†æ˜¯é¿å…äº†æ—¥åäº§ç”Ÿæ›´å¤§çš„é—®é¢˜ã€‚ ESæµè§ˆå™¨æ’ä»¶ Elasticvue : chrome/edge æ’ä»¶ï¼Œç”¨äºåœ¨æµè§ˆå™¨ä¸­æŸ¥çœ‹ESé›†ç¾¤ä¿¡æ¯ï¼ŒåŠŸèƒ½éå¸¸å¼ºå¤§ ESè‡ªå¯åŠ¨è„šæœ¬ 1234567891011121314151617181920212223242526272829303132333435# åˆ›å»ºæœåŠ¡æ–‡ä»¶$ vim /usr/lib/systemd/system/es.service[Unit]Description=elasticsearchDocumentation=https://www.elastic.coAfter=network.target[Service]Type=simplePrivateTmp=true# æŒ‡å®šESç”¨æˆ·User=elasticGroup=elasticLimitNOFILE=100000LimitNPROC=100000Restart=yes# å¯åŠ¨å‘½ä»¤ExecStart=/usr/local/elasticsearch/elasticsearch-8.17.3/bin/elasticsearchExecRestart=/bin/kill -s HUP $MAINPIDExecStop=/bin/kill -s QUIT $MAINPID[Install]WantedBy=multi-user.target# é‡æ–°åŠ è½½$ systemctl daemon-reload# å¯åŠ¨$ systemctl start es# åœæ­¢$ systemctl stop es# æŸ¥çœ‹çŠ¶æ€$ systemctl status es# è®¾ç½®å¼€æœºå¯åŠ¨$ systemctl enable es é€šè¿‡ApiKeyè®¿é—®ES å…³äºApiKeyçš„è¯¦ç»†ä»‹ç»ï¼Œå¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£ åˆ›å»ºApiKey 123456789101112131415161718192021222324252627282930curl -k &#x27;https://127.0.0.1:9200/_security/api_key?pretty&#x27; \\-u elastic:123456 \\--header &#x27;Content-Type: application/json&#x27; \\--data &#x27;&#123; &quot;name&quot;: &quot;elastic_api_key&quot;, &quot;expiration&quot;: &quot;1d&quot;&#125;&#x27;# è¯·æ±‚å‚æ•°è¯´æ˜ï¼š# name: ApiKeyçš„åç§°# expiration: ApiKeyçš„è¿‡æœŸæ—¶é—´ï¼Œè¿™é‡Œè®¾ç½®ä¸ºä¸€å¤©ï¼Œå¦‚æœä¸è®¾ç½®ï¼Œåˆ™æ°¸ä¸è¿‡æœŸ# è¯·æ±‚å‚æ•°ä¸­è¿˜æœ‰ä¸€ä¸ªé‡è¦çš„å‚æ•° `role_descriptors`ï¼Œå…¶å«ä¹‰æ˜¯ï¼ŒæŒ‡å®šApiKeyæ‰€æ‹¥æœ‰çš„æƒé™ï¼Œå³è§’è‰²ã€‚å¦‚æœä¸è¿›è¡Œè®¾ç½®ï¼Œåˆ™é»˜è®¤ä½¿ç”¨å½“å‰è®¤è¯ç”¨æˆ·çš„çš„è§’è‰²# metadata: ApiKeyçš„å…ƒæ•°æ®ï¼Œå³è‡ªå®šä¹‰çš„é”®å€¼å¯¹ï¼Œè¿™é‡Œå¯ä»¥ä¸è®¾ç½®# è¾“å‡ºï¼š&#123; &quot;id&quot;:&quot;70It0ZUBrL2GcOxX0d1L&quot;, &quot;name&quot;:&quot;elastic_api_key&quot;, &quot;expiration&quot;:1743057595723, &quot;api_key&quot;:&quot;s85lqVkmQISkBlgXCTJmDQ&quot;, &quot;encoded&quot;:&quot;NzBJdDBaVUJyTDJHY094WDBkMUw6czg1bHFWa21RSVNrQmxnWENUSm1EUQ==&quot;&#125;# è¾“å‡ºå‚æ•°è¯´æ˜ï¼š# id: ApiKeyçš„id# name: ApiKeyçš„åç§°# expiration: ApiKeyçš„è¿‡æœŸæ—¶é—´ï¼Œå•ä½ä¸ºæ¯«ç§’# api_key: ApiKeyçš„å¯†é’¥# encoded: å¯¹ `id:api_key` è¿›è¡Œbase64ç¼–ç ï¼Œå³å¯å¾—åˆ° `encoded` # echo -n &#x27;70It0ZUBrL2GcOxX0d1L:s85lqVkmQISkBlgXCTJmDQ&#x27; | base64 # è¾“å‡ºï¼š # NzBJdDBaVUJyTDJHY094WDBkMUw6czg1bHFWa21RSVNrQmxnWENUSm1EUQ== ä½¿ç”¨ApiKeyè®¿é—®ES 123456789101112131415161718192021# è¿™é‡Œçš„ApiKeyï¼Œå°±æ˜¯ä¸Šé¢è¾“å‡ºçš„encodedcurl -k &#x27;https://127.0.0.1:9200?pretty&#x27; \\-H &#x27;Authorization: ApiKey NzBJdDBaVUJyTDJHY094WDBkMUw6czg1bHFWa21RSVNrQmxnWENUSm1EUQ==&#x27;# è¾“å‡º&#123; &quot;name&quot; : &quot;node-1&quot;, &quot;cluster_name&quot; : &quot;test-elk&quot;, &quot;cluster_uuid&quot; : &quot;RykjCSPnSCi4Hsi37uziWw&quot;, &quot;version&quot; : &#123; &quot;number&quot; : &quot;8.17.3&quot;, &quot;build_flavor&quot; : &quot;default&quot;, &quot;build_type&quot; : &quot;tar&quot;, &quot;build_hash&quot; : &quot;a091390de485bd4b127884f7e565c0cad59b10d2&quot;, &quot;build_date&quot; : &quot;2025-02-28T10:07:26.089129809Z&quot;, &quot;build_snapshot&quot; : false, &quot;lucene_version&quot; : &quot;9.12.0&quot;, &quot;minimum_wire_compatibility_version&quot; : &quot;7.17.0&quot;, &quot;minimum_index_compatibility_version&quot; : &quot;7.0.0&quot; &#125;, &quot;tagline&quot; : &quot;You Know, for Search&quot;&#125; æŸ¥çœ‹ApiKeyä¿¡æ¯ï¼Œå‚è€ƒå®˜æ–¹æ–‡æ¡£ 123456789curl -u elastic:123456 -k &#x27;https://127.0.0.1:9200/_security/api_key?name=elastic_api_key&amp;pretty&#x27;# è¯·æ±‚å‚æ•°è¯´æ˜ï¼š# name: ApiKeyçš„åç§°ï¼Œä¸åŒçš„ApiKeyå¯ä»¥æ‹¥æœ‰ç›¸åŒçš„åç§°ï¼Œä½†idä¸åŒï¼Œæ‰€ä»¥é€šè¿‡nameè¿›è¡ŒæŸ¥è¯¢å¯èƒ½ä¼šè¿”å›å¤šä¸ªç»“æœ# æˆ–è€… id: ApiKeyçš„idï¼Œå»ºè®®é€šè¿‡idè¿›è¡ŒæŸ¥è¯¢ï¼Œidå”¯ä¸€ï¼Œæ‰€ä»¥é€šè¿‡idè¿›è¡ŒæŸ¥è¯¢åªä¼šè¿”å›ä¸€ä¸ªç»“æœ# username: æŸ¥è¯¢æŒ‡å®šç”¨æˆ·çš„ApiKey# owner: æ˜¯å¦åªæŸ¥è¯¢å½“å‰è®¤è¯ç”¨æˆ·åä¸‹çš„ApiKeyï¼Œé»˜è®¤ä¸ºfalseï¼Œä¸ºfalseæ—¶å¿…é¡»è‡³å°‘è®¾ç½®name\\ids\\usernameä¸­çš„ä¸€ä¸ªå‚æ•°# ä¸åŠ ä»»ä½•å‚æ•°è¿›è¡ŒæŸ¥è¯¢ï¼Œåˆ™è¿”å›æ‰€æœ‰ApiKeyçš„ä¿¡æ¯curl -u elastic:123456 -k &#x27;https://127.0.0.1:9200/_security/api_key?pretty&#x27; æ›´æ–°ApiKeyï¼Œå‚è€ƒå®˜æ–¹æ–‡æ¡£ 12345678910111213141516171819202122232425262728curl -u elastic:123456 -X PUT -k &#x27;https://127.0.0.1:9200/_security/api_key/&#123;ApiKeyId&#125;?pretty&#x27; \\--header &#x27;Content-Type: application/json&#x27; \\--data &#x27;&#123; &quot;expiration&quot;: &quot;1h&quot;, &quot;role_descriptors&quot;: &#123; &quot;role-a&quot;: &#123; &quot;indices&quot;: [ &#123; &quot;names&quot;: [&quot;*&quot;], &quot;privileges&quot;: [&quot;write&quot;] &#125; ] &#125; &#125;, &quot;metadata&quot;: &#123; &quot;environment&quot;: &#123; &quot;level&quot;: 2, &quot;trusted&quot;: true, &quot;tags&quot;: [&quot;production&quot;] &#125; &#125;&#125;&#x27;# å¯ä»¥æ›´æ–°çš„å‚æ•°æœ‰ï¼š# expiration: ApiKeyçš„è¿‡æœŸæ—¶é—´ï¼Œå¦‚æœå·²ç»è®¾ç½®è¿‡expirationï¼Œæ­¤æ—¶å¸Œæœ›ä½¿å…¶æ°¸ä¸è¿‡æœŸï¼Œåˆ™åªèƒ½å°†å…¶è®¾ç½®ä¸ºä¸€ä¸ªæ¯”è¾ƒå¤§çš„æ—¶é—´ï¼Œæ¯”å¦‚ &quot;expiration&quot;: &quot;100y&quot;# role_descriptors: ApiKeyæ‰€æ‹¥æœ‰çš„è§’è‰²ï¼ŒåŸå…ˆè®¾ç½®äº†role_descriptorsï¼Œæ›´æ–°æ—¶å¸Œæœ›å…¶ä½¿ç”¨è®¤è¯ç”¨æˆ·çš„è§’è‰²ï¼Œåˆ™æ­¤æ—¶å¯ä»¥å°†å…¶è®¾ç½®ä¸º &quot;role_descriptors&quot;: &#123;&#125;# metadata: ApiKeyçš„å…ƒæ•°æ®ï¼ŒåŸå…ˆè®¾ç½®äº† metadata ï¼Œæ›´æ–°æ—¶å¸Œæœ›å»é™¤æ‰€æœ‰ metadata ä¿¡æ¯ï¼Œåˆ™æ­¤æ—¶å¯ä»¥å°†å…¶è®¾ç½®ä¸º &quot;metadata&quot;: &#123;&#125;# æ³¨æ„ï¼šä¸‰ä¸ªå‚æ•°å¯ä»¥åªæ›´æ–°å…¶ä¸­ä»»ä½•ä¸€ä¸ªï¼Œæ›´æ–°å“ªä¸ªå°±åªæ›¿æ¢å“ªä¸ªï¼Œæ²¡æœ‰è¢«æ›´æ–°çš„å‚æ•°ä¸ä¼šå—åˆ°ä¿®æ”¹ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥åŒæ—¶æ›´æ–°å…¨éƒ¨ ç½®ApiKeyæ— æ•ˆï¼Œå‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼Œå®˜æ–¹æ²¡æœ‰æä¾›åˆ é™¤ApiKeyçš„æ¥å£ï¼Œåªæœ‰ç½®æ— æ•ˆçš„æ¥å£ 1234567891011121314151617181920212223curl -u elastic:123456 -X DELETE -k &#x27;https://127.0.0.1:9200/_security/api_key?pretty&#x27; \\--header &#x27;Content-Type: application/json&#x27; \\--data &#x27;&#123; &quot;name&quot;: &quot;elastic_api_key&quot;&#125;&#x27;# è¯·æ±‚å‚æ•°è¯´æ˜ï¼š# name: ApiKeyçš„åç§°ï¼Œä¼š# æˆ–è€…ä½¿ç”¨ &quot;ids&quot; : [ &quot;70It0ZUBrL2GcOxX0d1L&quot; ] ï¼Œé€šè¿‡idè¿›è¡Œåˆ é™¤ï¼Œæ­¤æ—¶å¯ä»¥ä¸€æ¬¡åˆ é™¤å¤šä¸ªApiKey# username: åˆ é™¤æŒ‡å®šç”¨æˆ·çš„ApiKey# owner: æ˜¯å¦åªåˆ é™¤å½“å‰è®¤è¯ç”¨æˆ·åä¸‹çš„ApiKeyï¼Œé»˜è®¤ä¸ºfalseï¼Œä¸ºfalseæ—¶å¿…é¡»è‡³å°‘è®¾ç½®name\\ids\\usernameä¸­çš„ä¸€ä¸ªå‚æ•°# è¾“å‡ºï¼š&#123; &quot;invalidated_api_keys&quot;:[ &quot;70It0ZUBrL2GcOxX0d1L&quot; ], &quot;previously_invalidated_api_keys&quot;:[ ], &quot;error_count&quot;:0&#125;# è¾“å‡ºå‚æ•°è¯´æ˜ï¼š# invalidated_api_keys: è¢«åˆ é™¤çš„ApiKeyçš„idåˆ—è¡¨# previously_invalidated_api_keys: ä¹‹å‰è¢«åˆ é™¤çš„ApiKeyçš„idåˆ—è¡¨# error_count: é”™è¯¯æ•°é‡ï¼Œå¦‚æœä¸º0ï¼Œåˆ™è¡¨ç¤ºæˆåŠŸ ä½¿ç”¨ApiKeyçš„ä¼˜ç¼ºç‚¹ ä¼˜ç‚¹ 12345678910111213å®‰å…¨æ€§: ç»†ç²’åº¦æ§åˆ¶: API Key å¯ä»¥ä¸ç‰¹å®šçš„è§’è‰²æè¿°ç¬¦å…³è”ï¼Œå…è®¸éå¸¸ç»†åŒ–çš„æƒé™æ§åˆ¶ã€‚è¿™æœ‰åŠ©äºéµå¾ªæœ€å°æƒé™åŸåˆ™ï¼Œåªæˆäºˆå¿…è¦çš„è®¿é—®æƒé™ã€‚ æ—¶é—´é™åˆ¶: å¯ä»¥ä¸º API Key è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œç¡®ä¿å¯†é’¥ä¸ä¼šæ°¸è¿œæœ‰æ•ˆï¼Œå‡å°‘é•¿æœŸæ³„éœ²çš„é£é™©ã€‚ å¯æ’¤é”€æ€§: å¦‚æœæ€€ç–‘æŸä¸ª API Key è¢«æ³„éœ²æˆ–ä¸å†éœ€è¦ï¼Œå¯ä»¥éšæ—¶æ’¤é”€è¯¥å¯†é’¥ï¼Œæé«˜å®‰å…¨æ€§ã€‚æ–¹ä¾¿æ€§: æ˜“äºç”Ÿæˆå’Œç®¡ç†: åˆ›å»ºå’Œç®¡ç† API Key çš„è¿‡ç¨‹é€šå¸¸å¾ˆç®€å•ï¼Œå¯ä»¥é€šè¿‡ REST API æˆ– Kibana ç•Œé¢è¿›è¡Œã€‚ æ— éœ€ç”¨æˆ·äº¤äº’: ä¸€æ—¦ç”Ÿæˆï¼ŒAPI Key å¯ä»¥ç›´æ¥ç”¨äºè‡ªåŠ¨åŒ–è„šæœ¬æˆ–åº”ç”¨ç¨‹åºï¼Œæ— éœ€ç”¨æˆ·æ‰‹åŠ¨ç™»å½•æˆ–æä¾›å‡­æ®ã€‚å®¡è®¡å’Œç›‘æ§: è·Ÿè¸ªä½¿ç”¨æƒ…å†µ: é€šè¿‡æ—¥å¿—è®°å½•å’Œå®¡è®¡åŠŸèƒ½ï¼Œå¯ä»¥è·Ÿè¸ªå“ªä¸ª API Key è¿›è¡Œäº†å“ªäº›æ“ä½œï¼Œä¾¿äºå®‰å…¨å®¡è®¡å’Œé—®é¢˜æ’æŸ¥ã€‚ æ´»åŠ¨ç›‘æ§: å¯ä»¥ç›‘æ§ API Key çš„æ´»åŠ¨ï¼ŒåŠæ—¶å‘ç°å¼‚å¸¸è¡Œä¸ºï¼Œå¹¶é‡‡å–ç›¸åº”çš„æªæ–½ã€‚çµæ´»æ€§: å¤šç§ç”¨é€”: API Key å¯ä»¥ç”¨äºå„ç§ç”¨é€”ï¼Œå¦‚åº”ç”¨ç¨‹åºé›†æˆã€æ•°æ®å¯¼å…¥å¯¼å‡ºã€ç›‘æ§å·¥å…·ç­‰ã€‚ å¤šç¯å¢ƒæ”¯æŒ: å¯ä»¥ä¸ºä¸åŒçš„ç¯å¢ƒï¼ˆå¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ï¼‰ç”Ÿæˆç‹¬ç«‹çš„ API Keyï¼Œç¡®ä¿å„ç¯å¢ƒä¹‹é—´çš„éš”ç¦»ã€‚ ç¼ºç‚¹ 1234567891011å®‰å…¨æ€§é£é™©: å¯†é’¥å­˜å‚¨: API Key éœ€è¦å®‰å…¨åœ°å­˜å‚¨å’Œä¼ è¾“ï¼Œå¦‚æœå¯†é’¥è¢«æ³„éœ²ï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨å®ƒè¿›è¡Œæœªæˆæƒçš„æ“ä½œã€‚ é™æ€å‡­è¯: ä¸åŠ¨æ€çš„èº«ä»½éªŒè¯æœºåˆ¶ï¼ˆå¦‚ OAuth ä»¤ç‰Œï¼‰ç›¸æ¯”ï¼ŒAPI Key æ˜¯é™æ€çš„ï¼Œä¸€æ—¦æ³„éœ²å¯èƒ½ä¼šå¯¼è‡´é•¿æœŸçš„å®‰å…¨é£é™©ã€‚ç®¡ç†å¤æ‚æ€§: å¯†é’¥ç®¡ç†: éšç€æ—¶é—´å’Œä½¿ç”¨è§„æ¨¡çš„å¢é•¿ï¼Œç®¡ç†å’Œç»´æŠ¤å¤§é‡ API Key å¯èƒ½ä¼šå˜å¾—å¤æ‚ã€‚éœ€è¦å®šæœŸæ›´æ–°å’Œæ’¤é”€è€æ—§çš„å¯†é’¥ã€‚ è§’è‰²åˆ†é…: ç»†ç²’åº¦çš„æƒé™æ§åˆ¶è™½ç„¶æä¾›äº†å®‰å…¨æ€§ï¼Œä½†ä¹Ÿå¢åŠ äº†é…ç½®å’Œç®¡ç†çš„å¤æ‚æ€§ã€‚ç¼ºä¹ç”¨æˆ·ä¸Šä¸‹æ–‡: åŒ¿åæ€§: API Key é€šå¸¸æ²¡æœ‰ç”¨æˆ·ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œä¸åƒåŸºäºç”¨æˆ·çš„è®¤è¯æœºåˆ¶ï¼ˆå¦‚ Basic Auth æˆ– OAuthï¼‰ï¼Œè¿™å¯èƒ½ä¸åˆ©äºæŸäº›ä¾èµ–ç”¨æˆ·èº«ä»½çš„åŠŸèƒ½ã€‚ä¾èµ–å®¢æˆ·ç«¯é…ç½®: æ˜“é”™æ€§: å¦‚æœå®¢æˆ·ç«¯é…ç½®ä¸å½“ï¼Œå¦‚é”™è¯¯åœ°å¤„ç†æˆ–æš´éœ² API Keyï¼Œå¯èƒ½ä¼šå¯¼è‡´å®‰å…¨æ¼æ´ã€‚ æ›´æ–°æŒ‘æˆ˜: æ›´æ–° API Key åï¼Œæ‰€æœ‰ä½¿ç”¨è¯¥å¯†é’¥çš„å®¢æˆ·ç«¯éƒ½éœ€è¦åŒæ­¥æ›´æ–°ï¼Œè¿™åœ¨å¤§è§„æ¨¡ç¯å¢ƒä¸­å¯èƒ½æ˜¯ä¸€ä¸ªæŒ‘æˆ˜ã€‚ ä½•æ—¶ä½¿ç”¨ API Key å½“æ‚¨éœ€è¦ä¸ºè‡ªåŠ¨åŒ–è„šæœ¬ã€ç¬¬ä¸‰æ–¹æœåŠ¡æˆ–åº”ç”¨ç¨‹åºæä¾›è®¿é—®æƒé™æ—¶ã€‚ å½“æ‚¨å¸Œæœ›å®ç°ç»†ç²’åº¦çš„æƒé™æ§åˆ¶å¹¶èƒ½å¤Ÿè½»æ¾ç®¡ç†å¯†é’¥çš„ç”Ÿå‘½å‘¨æœŸæ—¶ã€‚ å½“ä¸éœ€è¦ç”¨æˆ·ä¸Šä¸‹æ–‡æˆ–å¤æ‚çš„ç”¨æˆ·ä¼šè¯ç®¡ç†æ—¶ã€‚ ç¤ºä¾‹ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177# åˆ›å»ºApiKeycurl -X POST -k &#x27;https://127.0.0.1:9200/_security/api_key?pretty&#x27; \\-u elastic:123456 \\--header &#x27;Content-Type: application/json&#x27; \\--data &#x27;&#123; &quot;name&quot;: &quot;my-api-key&quot;, &quot;expiration&quot;: &quot;1d&quot;, &quot;role_descriptors&quot;: &#123; &quot;role-a&quot;: &#123; &quot;cluster&quot;: [&quot;all&quot;], &quot;indices&quot;: [ &#123; &quot;names&quot;: [&quot;index-a*&quot;], &quot;privileges&quot;: [&quot;read&quot;] &#125; ] &#125;, &quot;role-b&quot;: &#123; &quot;cluster&quot;: [&quot;all&quot;], &quot;indices&quot;: [ &#123; &quot;names&quot;: [&quot;index-b*&quot;], &quot;privileges&quot;: [&quot;all&quot;] &#125; ] &#125; &#125;, &quot;metadata&quot;: &#123; &quot;application&quot;: &quot;my-application&quot;, &quot;environment&quot;: &#123; &quot;level&quot;: 1, &quot;trusted&quot;: true, &quot;tags&quot;: [&quot;dev&quot;, &quot;staging&quot;] &#125; &#125;&#125;&#x27;# name: ApiKeyçš„åç§°# expiration: ApiKeyçš„è¿‡æœŸæ—¶é—´ï¼Œæ”¯æŒçš„æ—¶é—´å•ä½ä¸ºï¼šsï¼ˆç§’ï¼‰ï¼Œmï¼ˆåˆ†é’Ÿï¼‰ï¼Œhï¼ˆå°æ—¶ï¼‰ï¼Œdï¼ˆå¤©ï¼‰ï¼Œwï¼ˆå‘¨ï¼‰ï¼ŒMï¼ˆæœˆï¼‰ï¼Œyï¼ˆå¹´ï¼‰ # expirationä¸èƒ½è®¾ç½®å°äº1åˆ†é’Ÿçš„æ—¶é—´ï¼Œå¦‚æœçœç•¥expirationï¼Œåˆ™è¡¨ç¤ºæ— è¿‡æœŸæ—¶é—´# role_descriptors: è§’è‰²æè¿°ç¬¦ï¼ŒåŒ…å«å¤šä¸ªè§’è‰² # role-a: è§’è‰²æè¿°ç¬¦åç§°ï¼ŒåŒ…å«é›†ç¾¤å’Œç´¢å¼•çš„æƒé™æè¿° # cluster: é›†ç¾¤æƒé™ # all: è¡¨ç¤ºæ‹¥æœ‰å…¨éƒ¨é›†ç¾¤æƒé™ # manage: å¯ä»¥ç®¡ç†é›†ç¾¤è®¾ç½®ã€æ¨¡æ¿å’ŒèŠ‚ç‚¹ä¸Šçš„åˆ†ç‰‡åˆ†é…ã€‚ # monitor: å¯ä»¥ç›‘è§†é›†ç¾¤çš„çŠ¶æ€ã€‚ # manage_security: å¯ä»¥ç®¡ç†å®‰å…¨è®¾ç½®ï¼Œå¦‚ç”¨æˆ·ã€è§’è‰²å’Œè§’è‰²æ˜ å°„ã€‚ # manage_api_key: ç®¡ç† API Key # indices: ç´¢å¼•æƒé™ï¼ŒåŒ…å«nameså’Œprivilegesï¼Œ # names: è¡¨ç¤ºç´¢å¼•åç§°ï¼Œindex-a*è¡¨ç¤ºæ‰€æœ‰ä»¥index-aå¼€å¤´çš„ç´¢å¼•ï¼Œallè¡¨ç¤ºæ‰€æœ‰ç´¢å¼• # privileges: è¡¨ç¤ºç´¢å¼•æƒé™ # read: è¡¨ç¤ºæ‹¥æœ‰ç´¢å¼•çš„è¯»å–æƒé™ # write: è¡¨ç¤ºæ‹¥æœ‰ç´¢å¼•çš„å†™å…¥æƒé™ # delete: è¡¨ç¤ºæ‹¥æœ‰ç´¢å¼•çš„åˆ é™¤æƒé™ # index: è¡¨ç¤ºæ‹¥æœ‰ç´¢å¼•çš„ç´¢å¼•æƒé™ # manage: è¡¨ç¤ºæ‹¥æœ‰ç´¢å¼•çš„è®¾ç½®å’Œæ˜ å°„æƒé™ # monitor: è¡¨ç¤ºæ‹¥æœ‰ç´¢å¼•çš„ç›‘æ§æƒé™ # create_index: è¡¨ç¤ºå…è®¸åˆ›å»ºç´¢å¼• # crud: ç»„åˆäº† read, index, delete æƒé™ # all: è¡¨ç¤ºæ‹¥æœ‰å…¨éƒ¨ç´¢å¼•æƒé™ # allow_restricted_indices: è¡¨ç¤ºæ˜¯å¦å…è®¸å¯¹ restricted indices(å—é™åˆ¶ç´¢å¼•ï¼Œæ¯”å¦‚ä»¥.å¼€å¤´çš„ç´¢å¼•) è¿›è¡Œæ“ä½œï¼Œtrueè¡¨ç¤ºå…è®¸ï¼Œfalseè¡¨ç¤ºä¸å…è®¸# metadata: å…ƒæ•°æ® # application: è¡¨ç¤ºåº”ç”¨ç¨‹åºåç§° # environment: è¡¨ç¤ºç¯å¢ƒä¿¡æ¯ # level: è¡¨ç¤ºç¯å¢ƒçº§åˆ« # trusted: è¡¨ç¤ºæ˜¯å¦å—ä¿¡ä»» # tags: è¡¨ç¤ºç¯å¢ƒæ ‡ç­¾# è¾“å‡ºï¼š&#123; &quot;id&quot; : &quot;-kKu0ZUBrL2GcOxX0t1R&quot;, &quot;name&quot; : &quot;my-api-key&quot;, &quot;expiration&quot; : 1743066050130, &quot;api_key&quot; : &quot;03eNOYg_SCCHdzc0orsRvw&quot;, &quot;encoded&quot; : &quot;LWtLdTBaVUJyTDJHY094WDB0MVI6MDNlTk9ZZ19TQ0NIZHpjMG9yc1J2dw==&quot;&#125;# æŸ¥çœ‹ApiKeyä¿¡æ¯ï¼Œæ ¹æ®idæŸ¥è¯¢åªä¼šè¿”å›ä¸€ä¸ªApiKeyï¼Œæ ¹æ®nameæŸ¥è¯¢ä¼šè¿”å›å¤šä¸ªApiKeycurl -u elastic:123456 -k &#x27;https://127.0.0.1:9200/_security/api_key?id=-kKu0ZUBrL2GcOxX0t1R&amp;pretty&#x27;# è¾“å‡ºï¼š&#123; &quot;api_keys&quot; : [ &#123; &quot;id&quot; : &quot;-kKu0ZUBrL2GcOxX0t1R&quot;, &quot;name&quot; : &quot;my-api-key&quot;, &quot;type&quot; : &quot;rest&quot;, &quot;creation&quot; : 1742979650130, &quot;expiration&quot; : 1743066050130, &quot;invalidated&quot; : false, &quot;username&quot; : &quot;elastic&quot;, &quot;realm&quot; : &quot;reserved&quot;, &quot;realm_type&quot; : &quot;reserved&quot;, &quot;metadata&quot; : &#123; &quot;environment&quot; : &#123; &quot;level&quot; : 1, &quot;trusted&quot; : true, &quot;tags&quot; : [ &quot;dev&quot;, &quot;staging&quot; ] &#125;, &quot;application&quot; : &quot;my-application&quot; &#125;, &quot;role_descriptors&quot; : &#123; &quot;role-a&quot; : &#123; &quot;cluster&quot; : [ &quot;all&quot; ], &quot;indices&quot; : [ &#123; &quot;names&quot; : [ &quot;index-a*&quot; ], &quot;privileges&quot; : [ &quot;read&quot; ], &quot;allow_restricted_indices&quot; : false &#125; ], &quot;applications&quot; : [ ], &quot;run_as&quot; : [ ], &quot;metadata&quot; : &#123; &#125;, &quot;transient_metadata&quot; : &#123; &quot;enabled&quot; : true &#125; &#125;, &quot;role-b&quot; : &#123; &quot;cluster&quot; : [ &quot;all&quot; ], &quot;indices&quot; : [ &#123; &quot;names&quot; : [ &quot;index-b*&quot; ], &quot;privileges&quot; : [ &quot;all&quot; ], &quot;allow_restricted_indices&quot; : false &#125; ], &quot;applications&quot; : [ ], &quot;run_as&quot; : [ ], &quot;metadata&quot; : &#123; &#125;, &quot;transient_metadata&quot; : &#123; &quot;enabled&quot; : true &#125; &#125; &#125; &#125; ]&#125;# æ›´æ–°ApiKeycurl -u elastic:123456 -X PUT -k &#x27;https://127.0.0.1:9200/_security/api_key/-kKu0ZUBrL2GcOxX0t1R?pretty&#x27; \\--header &#x27;Content-Type: application/json&#x27; \\--data &#x27;&#123; &quot;metadata&quot;: &#123;&#125;&#125;&#x27;# è¾“å‡ºï¼š&#123; &quot;updated&quot; : true&#125;# ç½®ApiKeyæ— æ•ˆcurl -u elastic:123456 -X DELETE -k &#x27;https://127.0.0.1:9200/_security/api_key?pretty&#x27; \\--header &#x27;Content-Type: application/json&#x27; \\--data &#x27;&#123; &quot;ids&quot; : [ &quot;-kKu0ZUBrL2GcOxX0t1R&quot; ]&#125;&#x27;# è¾“å‡ºï¼š&#123; &quot;invalidated_api_keys&quot; : [ &quot;-kKu0ZUBrL2GcOxX0t1R&quot; ], &quot;previously_invalidated_api_keys&quot; : [ ], &quot;error_count&quot; : 0&#125;","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç»å¦‚ä½•åœ¨linuxä¸‹å®‰è£…Elasticsearch Elasticsearchç‰ˆæœ¬8.17.3","date_published":"2025-03-20T13:30:05.000Z","tags":["æŠ€æœ¯","elastic","elasticsearch","elasticsearch"]},{"id":"https://blog.hanqunfeng.com/2025/03/13/npm-study/","url":"https://blog.hanqunfeng.com/2025/03/13/npm-study/","title":"npmä½¿ç”¨æ‰‹å†Œ","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç»å¦‚ä½•ä½¿ç”¨npm</p>\n</li>\n<li class=\"lvl-2\">\n<p>npmç‰ˆæœ¬10.5.0</p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"npmç®€ä»‹\">npmç®€ä»‹</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>npmï¼ˆNode Package Managerï¼‰æ˜¯ Node.js çš„åŒ…ç®¡ç†å·¥å…·ï¼Œä¹Ÿæ˜¯ JavaScript ç¼–ç¨‹ç¤¾åŒºä¸­æœ€å¸¸ç”¨çš„ç®¡ç†å’Œåˆ†äº«ä»£ç çš„å·¥å…·ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å®ƒå…è®¸å¼€å‘è€…è½»æ¾åœ°å®‰è£…ã€å…±äº«ã€å’Œç®¡ç†åœ¨é¡¹ç›®ä¸­ä½¿ç”¨çš„ JavaScript åŒ…ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>npm åˆ†ä¸ºä¸¤ä¸ªä¸»è¦éƒ¨åˆ†ï¼šå‘½ä»¤è¡Œå·¥å…·ï¼ˆCLIï¼‰å’Œ npm æ³¨å†Œè¡¨ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å‘½ä»¤è¡Œå·¥å…·ï¼ˆCLIï¼‰ï¼šç”¨äºä¸æ³¨å†Œè¡¨è¿›è¡Œäº¤äº’ï¼Œå®‰è£…å’Œç®¡ç†é¡¹ç›®ä¸­çš„ä¾èµ–ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>npm æ³¨å†Œè¡¨ï¼šä¸€ä¸ªåœ¨çº¿çš„æ•°æ®åº“ï¼Œå­˜å‚¨äº†æ•°ç™¾ä¸‡ä¸ªå¼€æºçš„ Node.js åŒ…ï¼Œå¼€å‘è€…å¯ä»¥åœ¨è‡ªå·±çš„é¡¹ç›®ä¸­ä½¿ç”¨è¿™äº›åŒ…ã€‚</p>\n</li>\n</ul>\n<h2 id=\"npm-çš„å®‰è£…ä¸é…ç½®\">npm çš„å®‰è£…ä¸é…ç½®</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>npm é€šå¸¸ä¸ Node.js ä¸€èµ·å®‰è£…ï¼Œå› æ­¤å®‰è£… Node.js ä¼šè‡ªåŠ¨å®‰è£… npmã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä» <a href=\"https://nodejs.org/zh-cn\">Node.js å®˜ç½‘</a>ä¸‹è½½å¹¶å®‰è£… Node.jsã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>è·Ÿéš<a href=\"https://nodejs.org/zh-cn/download\">Node.js å®˜ç½‘â€“Download</a>çš„æç¤ºå®Œæˆ Node.js çš„å®‰è£…ï¼Œ</p>\n</li>\n<li class=\"lvl-2\">\n<p>ç°åœ¨å®˜æ–¹æ›´æ¨èä½¿ç”¨<a href=\"https://github.com/nvm-sh/nvm\">nvm</a>çš„æ–¹å¼è¿›è¡Œå®‰è£…ï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥é€‰æ‹©å¯¹åº”ç³»ç»Ÿçš„äºŒè¿›åˆ¶åŒ…è¿›è¡Œå®‰è£…ï¼ˆæ­¤ç§æ–¹æ³•è¦å°†nodeçš„binç›®å½•é…ç½®åˆ°PATHç¯å¢ƒå˜é‡ï¼‰ï¼Œnode.jså®‰è£…å®Œæˆåï¼Œnpm ä¹Ÿä¼šä¸€èµ·å®‰è£…ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>æ‰“å¼€å‘½ä»¤è¡Œæˆ–ç»ˆç«¯å·¥å…·ï¼Œè¾“å…¥ä»¥ä¸‹å‘½ä»¤æ¥éªŒè¯æ˜¯å¦æˆåŠŸå®‰è£…</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm -v</span><br><span class=\"line\">node -v</span><br></pre></td></tr></table></figure>\n<h2 id=\"npm-å¸¸ç”¨å‘½ä»¤\">npm å¸¸ç”¨å‘½ä»¤</h2>\n<h3 id=\"npm-initï¼šåˆå§‹åŒ–é¡¹ç›®\">npm initï¼šåˆå§‹åŒ–é¡¹ç›®</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>npm initå‘½ä»¤ç”¨äºåˆå§‹åŒ–ä¸€ä¸ªæ–°çš„ Node.js é¡¹ç›®ï¼Œç”Ÿæˆä¸€ä¸ªpackage.jsonæ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«é¡¹ç›®çš„å…ƒæ•°æ®å’Œé…ç½®ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">mkdir</span> my-project</span><br><span class=\"line\"><span class=\"built_in\">cd</span> my-project</span><br><span class=\"line\">npm init</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ‰§è¡Œè¯¥å‘½ä»¤åï¼Œä¼šæŒ‰ç…§æç¤ºè¾“å…¥ä¸€äº›é¡¹ç›®ç›¸å…³çš„ä¿¡æ¯ï¼Œå¦‚åç§°ã€ç‰ˆæœ¬ã€æè¿°ç­‰ã€‚ä¹Ÿå¯ä»¥ä½¿ç”¨ <code>npm init -y</code> è·³è¿‡æç¤ºï¼Œç”Ÿæˆä¸€ä¸ªé»˜è®¤çš„package.jsonæ–‡ä»¶ã€‚</p>\n</li>\n</ul>\n<h3 id=\"npm-createï¼šåŸºäºæ¨¡æ¿åˆ›å»ºé¡¹ç›®\">npm createï¼šåŸºäºæ¨¡æ¿åˆ›å»ºé¡¹ç›®</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>npm createå‘½ä»¤ç”¨äºåŸºäºæ¨¡æ¿åˆ›å»ºä¸€ä¸ªæ–°çš„ Node.js é¡¹ç›®ï¼Œæ¯”å¦‚æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªåŸºäºVueçš„Webé¡¹ç›®ï¼Œå¯ä»¥æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm create vue@latest</span><br></pre></td></tr></table></figure>\n<h3 id=\"npm-installï¼šå®‰è£…ä¾èµ–åŒ…\">npm installï¼šå®‰è£…ä¾èµ–åŒ…</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>npm installå‘½ä»¤ç”¨äºå®‰è£…é¡¹ç›®ä¸­æ‰€éœ€çš„ä¾èµ–åŒ…ï¼Œæ¯”å¦‚åœ¨package.jsonæ–‡ä»¶ä¸­æŒ‡å®šäº†ä¾èµ–åŒ…ï¼Œå¯ä»¥æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å®‰è£…å®Œæˆåï¼Œä¼šåœ¨node_modulesç›®å½•ä¸‹ç”Ÿæˆä¾èµ–åŒ…ï¼Œå¹¶æ›´æ–°package-lock.jsonæ–‡ä»¶ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å®‰è£…æŒ‡å®šä¾èµ–åŒ…ï¼Œé»˜è®¤å®‰è£…æœ€æ–°ç‰ˆï¼Œè‡ªåŠ¨å°†ä¾èµ–åŒ…æ·»åŠ åˆ° package.json çš„ â€œdependenciesâ€ éƒ¨åˆ†ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install express</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¦‚æœéœ€è¦å®‰è£…ç‰¹å®šçš„ç‰ˆæœ¬ï¼Œå¯ä»¥æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install express@4.17.1</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å®‰è£…å¼€å‘ä¾èµ–åŒ…ï¼Œå®‰è£…å¹¶å†™å…¥package.jsonçš„&quot;devDependencies&quot;ä¸­</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install express -D</span><br><span class=\"line\"><span class=\"comment\"># ç­‰ä»·äº</span></span><br><span class=\"line\">npm install express --save-dev</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å®‰è£…å…¨å±€ä¾èµ–åŒ…</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å…¨å±€å®‰è£…çš„åŒ…ä¼šè¢«å®‰è£…åˆ°å…¨å±€çš„node_modulesç›®å½•ä¸‹ï¼Œä¸ä¼šè¢«å®‰è£…åˆ°é¡¹ç›®ç›®å½•ä¸‹ï¼Œä¹Ÿä¸ä¼šå‡ºç°åœ¨package.jsonä¸­</span></span><br><span class=\"line\">npm install express -g</span><br><span class=\"line\"><span class=\"comment\"># ç­‰ä»·äº</span></span><br><span class=\"line\">npm install express --global</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å…¨å±€node_modulesç›®å½•è·¯å¾„æŸ¥çœ‹</span></span><br><span class=\"line\">npm root -g</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä»æœ¬åœ°å®‰è£…ä¾èµ–åŒ…</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ä»æœ¬åœ°å®‰è£…</span></span><br><span class=\"line\">npm install ./path/to/local_project</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä»è¿œç¨‹Gitä»“åº“å®‰è£…ä¾èµ–åŒ…</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å®‰è£…å…¬å…±é¡¹ç›®ï¼š</span></span><br><span class=\"line\"><span class=\"comment\"># npm install https://github.com/user_name/node_project</span></span><br><span class=\"line\">npm install https://github.com/trentm/json.git</span><br><span class=\"line\"><span class=\"comment\"># ç¼©å†™ï¼Œå¦‚æœæ˜¯gitlabä»“åº“ï¼Œåˆ™éœ€è¦ä½¿ç”¨gitlabå‰ç¼€ï¼Œæ¨èä½¿ç”¨ä¸Šé¢çš„å®Œæ•´è¯­ä¹‰ç‰ˆæœ¬</span></span><br><span class=\"line\">npm install github:trentm/json</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å®‰è£…ç‰¹å®šæäº¤ï¼š</span></span><br><span class=\"line\"><span class=\"comment\"># npm install https://github.com/user_name/node_project#commit</span></span><br><span class=\"line\">npm install https://github.com/trentm/json.git\\#6912b25272312d0f13ad32e98ebc1b4deb6334cc</span><br><span class=\"line\"><span class=\"comment\"># å®‰è£…ç‰¹å®šåˆ†æ”¯ï¼š</span></span><br><span class=\"line\"><span class=\"comment\"># npm install https://github.com/user_name/node_project#branchName</span></span><br><span class=\"line\">npm install https://github.com/trentm/json.git\\#streaming</span><br><span class=\"line\"><span class=\"comment\"># é€šè¿‡æ ‡ç­¾å®‰è£…ï¼š</span></span><br><span class=\"line\"><span class=\"comment\"># npm install https://github.com/user_name/node_project#tag</span></span><br><span class=\"line\">npm install https://github.com/trentm/json.git\\#10.0.0</span><br><span class=\"line\"><span class=\"comment\"># å®‰è£…ç‰¹å®šç‰ˆæœ¬ï¼š</span></span><br><span class=\"line\"><span class=\"comment\"># npm install https://github.com/user_name/node_project#version</span></span><br><span class=\"line\">npm install https://github.com/trentm/json.git\\#10.0.0</span><br><span class=\"line\"><span class=\"comment\"># å®Œæ•´çš„è¯­ä¹‰ç‰ˆæœ¬ï¼š</span></span><br><span class=\"line\">npm install https://github.com/trentm/json.git\\#semver:v10.0.0</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ä½¿ç”¨gitçš„ssh repo link å®‰è£…ç§æœ‰åº“ï¼šåé¢åŒæ ·å¯ä»¥æ¥ commitã€branchNameã€tagã€versionç­‰</span></span><br><span class=\"line\"><span class=\"comment\"># npm install git+ssh://git@github.com:user_name/node_project.git</span></span><br><span class=\"line\">npm install git+ssh://git@github.com/trentm/json.git</span><br></pre></td></tr></table></figure>\n<h3 id=\"npm-updateï¼šæ›´æ–°ä¾èµ–åŒ…\">npm updateï¼šæ›´æ–°ä¾èµ–åŒ…</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>npm updateå‘½ä»¤ç”¨äºæ›´æ–°é¡¹ç›®ä¸­çš„ä¾èµ–åŒ…ï¼Œæ¯”å¦‚è¦æ›´æ–°expressä¾èµ–åŒ…åˆ°æœ€æ–°ç‰ˆæœ¬ï¼Œå¯ä»¥æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æ›´æ–°ç”Ÿäº§ç¯å¢ƒä¾èµ–åŒ…</span></span><br><span class=\"line\">npm update express</span><br><span class=\"line\"><span class=\"comment\"># æ›´æ–°å¼€å‘ç¯å¢ƒä¾èµ–åŒ…</span></span><br><span class=\"line\">npm update express -D</span><br><span class=\"line\"><span class=\"comment\"># å…¨å±€æ›´æ–°</span></span><br><span class=\"line\">npm update express -g</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¿®æ”¹äº†package.jsonæ–‡ä»¶ï¼Œå¹¶å¸Œæœ›æ›´æ–°ä¾èµ–åŒ…ï¼Œå¯ä»¥æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># #ä¸ºäº†é¿å…ä¸å¿…è¦çš„éº»çƒ¦ï¼Œå¯ä»¥å…ˆåˆ é™¤é¡¹ç›®ä¸­çš„node_modulesæ–‡ä»¶å¤¹åœ¨æ‰§è¡Œï¼Œæ­¤æ—¶å’Œ npm install ä¸€æ ·</span></span><br><span class=\"line\">npm update</span><br></pre></td></tr></table></figure>\n<h3 id=\"npm-outdateï¼šæ£€æŸ¥å“ªäº›åŒ…å¯ä»¥å‡çº§\">npm outdateï¼šæ£€æŸ¥å“ªäº›åŒ…å¯ä»¥å‡çº§</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>npm outdateå‘½ä»¤ç”¨äºæ£€æŸ¥å“ªäº›åŒ…å¯ä»¥å‡çº§</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æ£€æŸ¥å½“å‰é¡¹ç›®ä¸‹å“ªäº›åŒ…å¯ä»¥å‡çº§</span></span><br><span class=\"line\">npm outdate</span><br><span class=\"line\"><span class=\"comment\"># æ£€æŸ¥æŒ‡å®šåŒ…</span></span><br><span class=\"line\">npm outdated express</span><br><span class=\"line\"><span class=\"comment\"># æ£€æŸ¥å…¨å±€æ¨¡å—</span></span><br><span class=\"line\">npm outdate -g</span><br><span class=\"line\">npm outdated -g express</span><br></pre></td></tr></table></figure>\n<h3 id=\"npm-upgradeï¼šåˆ¤æ–­package-jsonå“ªäº›åŒ…éœ€è¦å‡çº§\">npm-upgradeï¼šåˆ¤æ–­package.jsonå“ªäº›åŒ…éœ€è¦å‡çº§</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å®‰è£…</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install -g npm-upgrade</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä½¿ç”¨</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åˆ¤æ–­package.jsonå“ªäº›åŒ…éœ€è¦å‡çº§ï¼Œç”¨æˆ·ç¡®è®¤åä¼šè‡ªåŠ¨æ›´æ–°package.jsonæ–‡ä»¶ï¼Œæ­¤æ—¶åªæ˜¯æ›´æ–°æ–‡ä»¶ï¼Œå¹¶æ²¡æœ‰çœŸæ­£å‡çº§</span></span><br><span class=\"line\">npm-upgrade</span><br><span class=\"line\"><span class=\"comment\"># åŸºäºpackage.jsonä¸­çš„é…ç½®è¿›è¡Œå‡çº§ï¼Œå¯ä»¥å…ˆåˆ é™¤node_moduleså†æ‰§è¡Œï¼Œæ­¤æ—¶å’Œ npm install ä¸€æ ·</span></span><br><span class=\"line\">npm update</span><br></pre></td></tr></table></figure>\n<h3 id=\"npm-listï¼šåˆ—å‡ºä¾èµ–åŒ…\">npm listï¼šåˆ—å‡ºä¾èµ–åŒ…</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>npm listå‘½ä»¤ç”¨äºåˆ—å‡ºé¡¹ç›®ä¸­çš„ä¾èµ–åŒ…ï¼Œæ¯”å¦‚è¦åˆ—å‡ºå½“å‰é¡¹ç›®ä¸‹çš„ä¾èµ–åŒ…ï¼Œå¯ä»¥æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æ­¤æ—¶åˆ—å‡ºçš„æ˜¯package.jsonä¸­çš„dependenciesä¾èµ–åŒ…</span></span><br><span class=\"line\">npm list</span><br><span class=\"line\"><span class=\"comment\"># åˆ—å‡ºå¼€å‘ä¾èµ–åŒ…ï¼Œæ­¤æ—¶ä¼šåˆ—å‡ºpackage.jsonä¸­çš„devDependencieså’Œdependenciesä¾èµ–åŒ…</span></span><br><span class=\"line\">npm list -D</span><br><span class=\"line\"><span class=\"comment\"># åˆ—å‡ºæŒ‡å®šåŒ…</span></span><br><span class=\"line\">npm list express</span><br><span class=\"line\"><span class=\"comment\"># åˆ—å‡ºå…¨å±€æ¨¡å—</span></span><br><span class=\"line\">npm list -g</span><br><span class=\"line\">npm list -g express</span><br></pre></td></tr></table></figure>\n<h3 id=\"npm-uninstallï¼šå¸è½½ä¾èµ–åŒ…\">npm uninstallï¼šå¸è½½ä¾èµ–åŒ…</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>npm uninstallå‘½ä»¤ç”¨äºå¸è½½é¡¹ç›®ä¸­çš„ä¾èµ–åŒ…ï¼Œæ¯”å¦‚è¦å¸è½½expressä¾èµ–åŒ…ï¼Œå¯ä»¥æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm uninstall express</span><br><span class=\"line\"><span class=\"comment\"># åˆ é™¤å…¨å±€æ¨¡å—</span></span><br><span class=\"line\">npm uninstall -g express</span><br></pre></td></tr></table></figure>\n<h3 id=\"npm-searchï¼šæœç´¢ä¾èµ–åŒ…\">npm searchï¼šæœç´¢ä¾èµ–åŒ…</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>npm searchå‘½ä»¤ç”¨äºæœç´¢ä¾èµ–åŒ…ï¼Œæ¯”å¦‚è¦æœç´¢expressä¾èµ–åŒ…ï¼Œå¯ä»¥æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm search express</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¯ä»¥ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æœç´¢ä¾èµ–åŒ…ï¼Œæ¯”å¦‚è¦æœç´¢ä»¥expresså¼€å¤´çš„ä¾èµ–åŒ…ï¼Œå¯ä»¥æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm search /^express/</span><br></pre></td></tr></table></figure>\n<h3 id=\"npm-view-npm-infoï¼šæŸ¥çœ‹åŒ…ä¿¡æ¯\">npm view == npm infoï¼šæŸ¥çœ‹åŒ…ä¿¡æ¯</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>npm viewå‘½ä»¤ç”¨äºæŸ¥çœ‹åŒ…çš„ä¿¡æ¯ï¼Œæ¯”å¦‚è¦æŸ¥çœ‹expressä¾èµ–åŒ…çš„ä¿¡æ¯ï¼Œå¯ä»¥æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm view express</span><br><span class=\"line\"><span class=\"comment\"># æˆ–è€…ï¼Œviewä¸infoå‘½ä»¤å¯ä»¥äº’æ¢ä½¿ç”¨</span></span><br><span class=\"line\">npm info express</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>npm viewå‘½ä»¤è¿˜å¯ä»¥æŸ¥çœ‹åŒ…çš„æ‰€æœ‰ç‰ˆæœ¬ä¿¡æ¯ï¼Œæ¯”å¦‚è¦æŸ¥çœ‹expressä¾èµ–åŒ…çš„æ‰€æœ‰ç‰ˆæœ¬ä¿¡æ¯ï¼Œå¯ä»¥æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æ­¤æ—¶æˆ‘ä»¬ä»ç»“æœä¸­é€‰æ‹©ä¸€ä¸ªç‰ˆæœ¬è¿›è¡Œå®‰è£…å³å¯</span></span><br><span class=\"line\">npm view express versions</span><br></pre></td></tr></table></figure>\n<h3 id=\"npm-homeï¼šæ‰“å¼€åŒ…çš„ä¸»é¡µ\">npm homeï¼šæ‰“å¼€åŒ…çš„ä¸»é¡µ</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ‰“å¼€æŸä¸ª npm åŒ…çš„ä¸»é¡µï¼ˆé€šå¸¸æ˜¯ GitHub ä¸»é¡µæˆ– npm é¡µé¢ï¼‰ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm home express</span><br></pre></td></tr></table></figure>\n<h2 id=\"npm-é•œåƒæº\">npm é•œåƒæº</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>npm é»˜è®¤ä½¿ç”¨å®˜æ–¹çš„é•œåƒæºï¼Œä½†æ˜¯å®˜æ–¹çš„é•œåƒæºé€Ÿåº¦å¾ˆæ…¢ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç¬¬ä¸‰æ–¹çš„é•œåƒæºæ¥åŠ é€Ÿä¸‹è½½ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm å®˜æ–¹åŸå§‹é•œåƒç½‘å€æ˜¯ï¼šhttps://registry.npmjs.org/</span><br><span class=\"line\">æ·˜å® NPM é•œåƒï¼šhttp://registry.npmmirror.com</span><br><span class=\"line\">é˜¿é‡Œäº‘ NPM é•œåƒï¼šhttps://npm.aliyun.com</span><br><span class=\"line\">è…¾è®¯äº‘ NPM é•œåƒï¼šhttps://mirrors.cloud.tencent.com/npm/</span><br><span class=\"line\">åä¸ºäº‘ NPM é•œåƒï¼šhttps://mirrors.huaweicloud.com/repository/npm/</span><br><span class=\"line\">ç½‘æ˜“ NPM é•œåƒï¼šhttps://mirrors.163.com/npm/</span><br><span class=\"line\">ä¸­å›½ç§‘å­¦æŠ€æœ¯å¤§å­¦å¼€æºé•œåƒç«™ï¼šhttp://mirrors.ustc.edu.cn/</span><br><span class=\"line\">æ¸…åå¤§å­¦å¼€æºé•œåƒç«™ï¼šhttps://mirrors.tuna.tsinghua.edu.cn/</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤æ¥æŸ¥çœ‹å½“å‰ä½¿ç”¨çš„é•œåƒæºï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm config get registry</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤æ¥è®¾ç½®é•œåƒæºï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm config <span class=\"built_in\">set</span> registry https://registry.npmmirror.com</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤æ¥åˆ é™¤ç”¨æˆ·é…ç½®çš„é•œåƒæºï¼Œåˆ é™¤åæ¢å¤ä¸ºé»˜è®¤é•œåƒæºï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm config delete registry</span><br></pre></td></tr></table></figure>\n<h2 id=\"npm-é…ç½®\">npm é…ç½®</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤æ¥æŸ¥çœ‹npmçš„é…ç½®ä¿¡æ¯ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹å…¨å±€é…ç½®ä¿¡æ¯ï¼Œåªæ˜¾ç¤ºç”¨æˆ·è‡ªå®šä¹‰çš„é…ç½®ä¿¡æ¯</span></span><br><span class=\"line\">npm config list</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹å…¨å±€é…ç½®ä¿¡æ¯ï¼Œæ˜¾ç¤ºæ‰€æœ‰é…ç½®ä¿¡æ¯åŠå…¶é»˜è®¤ç¼ºçœå€¼</span></span><br><span class=\"line\">npm config <span class=\"built_in\">ls</span> -l</span><br><span class=\"line\"><span class=\"comment\"># json æ ¼å¼ æ˜¾ç¤ºå…¨éƒ¨é…ç½®ä¿¡æ¯</span></span><br><span class=\"line\">npm config list --json</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>é»˜è®¤å…¨å±€é…ç½®åœ¨å½“å‰ç”¨æˆ·HOMEç›®å½•ä¸‹çš„.npmrcæ–‡ä»¶ä¸­ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤æ¥æŸ¥çœ‹å…¨å±€é…ç½®ä¿¡æ¯ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cat</span> ~/.npmrc</span><br><span class=\"line\"><span class=\"built_in\">cat</span> ~/.npmrc | grep registry</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»ºä¸€ä¸ª.npmrc æ–‡ä»¶å¯ä»¥ä¸ºè¯¥é¡¹ç›®å•ç‹¬è®¾ç½® npm é…ç½®ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>npm config å…è®¸ä½ æ§åˆ¶ npm çš„è¡Œä¸ºï¼ŒåŒ…æ‹¬ å®‰è£…ç›®å½•ã€ä»£ç†ã€æ—¥å¿—çº§åˆ«ã€ä¾èµ–ç®¡ç† ç­‰ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä½ å¯ä»¥ä½¿ç”¨ <code>npm config get &lt;key&gt;</code> æŸ¥çœ‹å€¼ï¼Œ<code>npm config set &lt;key&gt; &lt;value&gt;</code> è¿›è¡Œä¿®æ”¹ï¼Œ<code>npm config delete &lt;key&gt;</code> åˆ é™¤è®¾ç½®ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>npmå¸¸ç”¨é…ç½®</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>é…ç½®é¡¹</th>\n<th>ä½œç”¨</th>\n<th>é»˜è®¤å€¼</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>prefix</td>\n<td>è®¾ç½® npm å…¨å±€å®‰è£…çš„è·¯å¾„ï¼ˆnpm install -g å½±å“çš„ç›®å½•ï¼‰</td>\n<td>ç¯å¢ƒå˜é‡ NODE_HOME æˆ– /usr/localï¼ˆç³»ç»Ÿï¼‰</td>\n</tr>\n<tr>\n<td>cache</td>\n<td>npm çš„ç¼“å­˜ç›®å½•</td>\n<td>~/.npm</td>\n</tr>\n<tr>\n<td>registry</td>\n<td>æŒ‡å®š npm çš„åŒ…ç®¡ç†ä»“åº“åœ°å€ï¼ˆå¦‚å®˜æ–¹ã€æ·˜å®é•œåƒï¼‰</td>\n<td><a href=\"https://registry.npmjs.org/\">https://registry.npmjs.org/</a></td>\n</tr>\n<tr>\n<td>strict-ssl</td>\n<td>æ˜¯å¦å¼ºåˆ¶ä½¿ç”¨ HTTPS è¿›è¡Œ npm æ“ä½œ</td>\n<td>true</td>\n</tr>\n<tr>\n<td>proxy</td>\n<td>é…ç½® HTTP ä»£ç†</td>\n<td>null</td>\n</tr>\n<tr>\n<td>https-proxy</td>\n<td>é…ç½® HTTPS ä»£ç†</td>\n<td>null</td>\n</tr>\n<tr>\n<td>init-author-name</td>\n<td>è®¾ç½® package.json é»˜è®¤ä½œè€…åç§°</td>\n<td>â€œâ€</td>\n</tr>\n<tr>\n<td>init-author-email</td>\n<td>è®¾ç½® package.json é»˜è®¤ä½œè€…é‚®ç®±</td>\n<td>â€œâ€</td>\n</tr>\n<tr>\n<td>init-author-url</td>\n<td>è®¾ç½® package.json é»˜è®¤ä½œè€…ç½‘ç«™</td>\n<td>â€œâ€</td>\n</tr>\n<tr>\n<td>init-license</td>\n<td>è®¾ç½® package.json é»˜è®¤è®¸å¯è¯</td>\n<td>â€œISCâ€</td>\n</tr>\n<tr>\n<td>init-version</td>\n<td>package.json é»˜è®¤ç‰ˆæœ¬å·</td>\n<td>â€œ1.0.0â€</td>\n</tr>\n<tr>\n<td>save-exact</td>\n<td>true æ—¶ï¼Œå®‰è£…ä¾èµ–æ—¶ä¸ä½¿ç”¨ ^ æˆ– ~ï¼Œç›´æ¥é”å®šç‰ˆæœ¬</td>\n<td>false</td>\n</tr>\n<tr>\n<td>engine-strict</td>\n<td>æ˜¯å¦å¼ºåˆ¶åŒ¹é… package.json çš„ engines å­—æ®µ</td>\n<td>false</td>\n</tr>\n<tr>\n<td>loglevel</td>\n<td>è®¾ç½®æ—¥å¿—è¾“å‡ºçº§åˆ«ï¼ˆsilent, error, warn, notice, info, verbose, sillyï¼‰</td>\n<td>notice</td>\n</tr>\n<tr>\n<td>fund</td>\n<td>æ˜¯å¦æ˜¾ç¤º package çš„èµ„é‡‘æ”¯æŒä¿¡æ¯</td>\n<td>true</td>\n</tr>\n<tr>\n<td>audit</td>\n<td>æ˜¯å¦å¯ç”¨å®‰å…¨å®¡è®¡</td>\n<td>true</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"npm-config-save-exact\">npm config save-exact</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ¨èé…ç½®ä¸º trueï¼Œé¿å…å› ä¸ºç‰ˆæœ¬æ›´æ–°å¯¼è‡´ä¾èµ–åŒ…ç‰ˆæœ¬ä¸åŒ¹é…</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm config <span class=\"built_in\">set</span> save-exact <span class=\"literal\">true</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"npm-config-loglevel\">npm config loglevel</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>loglevel å¯é€‰å€¼</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>çº§åˆ«</th>\n<th>è¯´æ˜</th>\n<th>é€‚ç”¨åœºæ™¯</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>silent</td>\n<td>ä¸è¾“å‡ºä»»ä½•æ—¥å¿—ï¼ˆé™¤éå‘ç”Ÿé”™è¯¯ï¼‰</td>\n<td>é€‚ç”¨äº CI/CD éœ€è¦æœ€å°‘æ—¥å¿—çš„ç¯å¢ƒ</td>\n</tr>\n<tr>\n<td>error</td>\n<td>ä»…æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯</td>\n<td>åªå…³å¿ƒ npm è¿è¡Œæ˜¯å¦å‡ºé”™</td>\n</tr>\n<tr>\n<td>warn</td>\n<td>æ˜¾ç¤ºè­¦å‘Šå’Œé”™è¯¯</td>\n<td>å‘ç°æ½œåœ¨é—®é¢˜ä½†ä¸å½±å“ä½¿ç”¨</td>\n</tr>\n<tr>\n<td>notice (é»˜è®¤)</td>\n<td>æ˜¾ç¤ºå…³é”®ä¿¡æ¯ã€è­¦å‘Šå’Œé”™è¯¯</td>\n<td>npm é»˜è®¤å€¼ï¼Œé€‚åˆå¤§å¤šæ•°åœºæ™¯</td>\n</tr>\n<tr>\n<td>http</td>\n<td>è®°å½• HTTP è¯·æ±‚çš„è¯¦ç»†ä¿¡æ¯</td>\n<td>ç”¨äºè°ƒè¯• npm ä¸‹è½½é€Ÿåº¦é—®é¢˜</td>\n</tr>\n<tr>\n<td>info</td>\n<td>æ˜¾ç¤ºä¸€èˆ¬ä¿¡æ¯ã€ä¾èµ–å®‰è£…æƒ…å†µç­‰</td>\n<td>é€‚ç”¨äºä¸€èˆ¬å¼€å‘è€…è°ƒè¯•</td>\n</tr>\n<tr>\n<td>verbose</td>\n<td>è¯¦ç»†çš„è°ƒè¯•ä¿¡æ¯</td>\n<td>é€‚ç”¨äºæ·±å…¥åˆ†æ npm è¿è¡Œæƒ…å†µ</td>\n</tr>\n<tr>\n<td>silly</td>\n<td>æœ€è¯¦ç»†çš„æ—¥å¿—ï¼ŒåŒ…å«æ‰€æœ‰è°ƒè¯•ä¿¡æ¯</td>\n<td>é€‚ç”¨äº npm å¼€å‘è€…æˆ–æç«¯è°ƒè¯•éœ€æ±‚</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è®¾ç½®æ–¹æ³•</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm config <span class=\"built_in\">set</span> loglevel verbose</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¸´æ—¶ä½¿ç”¨</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm --loglevel verbose install</span><br><span class=\"line\"><span class=\"comment\"># æˆ–è€…</span></span><br><span class=\"line\">npm -<span class=\"built_in\">dd</span> install</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#  æ”¯æŒå¿«æ·æ–¹å¼çš„å€¼ï¼š</span></span><br><span class=\"line\"><span class=\"comment\"># â€¢ -s, --silent: --loglevel silent</span></span><br><span class=\"line\"><span class=\"comment\"># â€¢ -q, --quiet: --loglevel warn</span></span><br><span class=\"line\"><span class=\"comment\"># â€¢ -d: --loglevel info</span></span><br><span class=\"line\"><span class=\"comment\"># â€¢ -dd, --verbose: --loglevel verbose</span></span><br><span class=\"line\"><span class=\"comment\"># â€¢ -ddd: --loglevel silly</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"npm-config-timing\">npm config timing</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>timing æ˜¯ npm çš„ä¸€ä¸ª æ—¥å¿—è¾“å‡ºé…ç½®é¡¹ï¼Œç”¨äºæ§åˆ¶æ˜¯å¦åœ¨å‘½ä»¤æ‰§è¡Œæ—¶æ˜¾ç¤ºè¯¦ç»†çš„æ—¶é—´ä¿¡æ¯ï¼Œé»˜è®¤å€¼ä¸º falseã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å½“ timing è®¾ä¸º true æ—¶ï¼Œnpm ä¼šåœ¨å‘½ä»¤æ‰§è¡Œç»“æŸå æ‰“å°è¯¦ç»†çš„æ—¶é—´ç»Ÿè®¡ä¿¡æ¯ï¼ŒåŒ…æ‹¬ï¼š</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-6\">æ¯ä¸ªå­ä»»åŠ¡çš„æ‰§è¡Œæ—¶é—´ï¼ˆå¦‚è§£æ package.jsonã€è§£æ node_modulesã€ä¸‹è½½ä¾èµ–ç­‰ï¼‰</li>\n<li class=\"lvl-6\">ç½‘ç»œè¯·æ±‚çš„è€—æ—¶</li>\n<li class=\"lvl-6\">ä¾èµ–è§£æå’Œå®‰è£…çš„è€—æ—¶</li>\n<li class=\"lvl-6\">æ•´ä½“æ‰§è¡Œçš„æ—¶é—´å¼€é”€</li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<p>è¿™å¯¹åˆ†æ npm æ€§èƒ½ã€ä¼˜åŒ–ä¾èµ–å®‰è£…é€Ÿåº¦éå¸¸æœ‰ç”¨ï¼Œç‰¹åˆ«æ˜¯åœ¨å¤§é¡¹ç›®æˆ– CI/CD ç¯å¢ƒä¸­ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å¯ç”¨ timing</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm config <span class=\"built_in\">set</span> timing <span class=\"literal\">true</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¸´æ—¶å¯ç”¨</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm --timing install</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>é€‚ç”¨åœºæ™¯</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-6\">åˆ†æ npm å‘½ä»¤æ‰§è¡Œæ—¶é—´ï¼Œä¼˜åŒ–æ„å»ºé€Ÿåº¦</li>\n<li class=\"lvl-6\">CI/CD ç¯å¢ƒä¸­æ’æŸ¥ npm å®‰è£…å˜æ…¢çš„åŸå› </li>\n<li class=\"lvl-6\">æ’æŸ¥ npm ä¾èµ–è§£æã€å®‰è£…æˆ–ä¸‹è½½è¿‡ç¨‹çš„æ€§èƒ½ç“¶é¢ˆ</li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<p>ä¸€èˆ¬æ—¥å¸¸å¼€å‘ï¼šæ—¥å¿—ä¼šå˜é•¿ï¼Œå¯èƒ½å½±å“å¯è¯»æ€§ï¼Œæ‰€ä»¥å†æ²¡æœ‰é‡åˆ°é—®é¢˜æ—¶ä¸å»ºè®®å¼€å¯</p>\n</li>\n</ul>\n<h2 id=\"npmã€pnpmã€yarn-ä¹‹é—´çš„è”ç³»å’ŒåŒºåˆ«\">npmã€pnpmã€yarn ä¹‹é—´çš„è”ç³»å’ŒåŒºåˆ«</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¿™ä¸‰è€…éƒ½æ˜¯ JavaScript ç”Ÿæ€ä¸­çš„åŒ…ç®¡ç†å·¥å…·ï¼Œä¸»è¦ç”¨äºå®‰è£…ã€ç®¡ç†å’Œè¿è¡Œ Node.js é¡¹ç›®çš„ä¾èµ–ã€‚å®ƒä»¬çš„å…³ç³»å¦‚ä¸‹ï¼š</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-6\">npmï¼ˆNode Package Managerï¼‰æ˜¯ Node.js å®˜æ–¹è‡ªå¸¦çš„åŒ…ç®¡ç†å·¥å…·ã€‚</li>\n<li class=\"lvl-6\"><a href=\"https://classic.yarnpkg.com/en/docs\">yarnï¼ˆYet Another Resource Negotiatorï¼‰</a>æ˜¯ Facebook å¼€å‘çš„æ›¿ä»£ npm çš„å·¥å…·ï¼Œæä¾›æ›´å¿«ã€æ›´å®‰å…¨çš„ä¾èµ–ç®¡ç†ã€‚</li>\n<li class=\"lvl-6\"><a href=\"https://pnpm.io/zh/\">pnpmï¼ˆPerformant npmï¼‰</a>æ˜¯ä¸€ä¸ªæ›´é«˜æ•ˆçš„ npm æ›¿ä»£å“ï¼Œä½¿ç”¨ç¡¬é“¾æ¥å’Œå»é‡æœºåˆ¶æ¥å‡å°‘ç£ç›˜å ç”¨å¹¶åŠ å¿«å®‰è£…é€Ÿåº¦ã€‚</li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<p>npmã€pnpmã€yarn çš„ä¸»è¦åŒºåˆ«</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>ç‰¹æ€§</th>\n<th>npm</th>\n<th>yarn</th>\n<th>pnpm</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>é»˜è®¤åŒ…ç®¡ç†æ–¹å¼</td>\n<td>ç›´æ¥å®‰è£…åˆ° node_modules/</td>\n<td>ç›´æ¥å®‰è£…åˆ° node_modules/</td>\n<td>ä½¿ç”¨ ç¡¬é“¾æ¥ + å…±äº«ä¾èµ–ï¼Œå ç”¨æ›´å°‘ç£ç›˜</td>\n</tr>\n<tr>\n<td>å®‰è£…é€Ÿåº¦</td>\n<td>5+ ç‰ˆæœ¬åé€Ÿåº¦è¾ƒå¿«ï¼Œä½†ä¾èµ–è§£æä»æœ‰æ€§èƒ½é—®é¢˜</td>\n<td>é€Ÿåº¦è¾ƒå¿«ï¼Œæ”¯æŒå¹¶è¡Œä¸‹è½½</td>\n<td>æœ€å¿«ï¼Œå»é‡èƒ½åŠ›å¼º</td>\n</tr>\n<tr>\n<td>ç£ç›˜å ç”¨</td>\n<td>è¾ƒå¤§ï¼ˆæ¯ä¸ªé¡¹ç›®éƒ½ä¼šå­˜ä¸€ä»½å®Œæ•´çš„ä¾èµ–ï¼‰</td>\n<td>è¾ƒå¤§ï¼ˆå’Œ npm ç±»ä¼¼ï¼‰</td>\n<td>æœ€å°ï¼ˆå…±äº«å…¨å±€ç¼“å­˜ï¼Œå¤šä¸ªé¡¹ç›®å…±ç”¨ä¾èµ–ï¼‰</td>\n</tr>\n<tr>\n<td>é”æ–‡ä»¶</td>\n<td>package-lock.json</td>\n<td>yarn.lock</td>\n<td>pnpm-lock.yaml</td>\n</tr>\n<tr>\n<td>å¹¶å‘å®‰è£…</td>\n<td>æ”¯æŒï¼ˆnpm 5+ ä¼˜åŒ–ï¼‰</td>\n<td>æ”¯æŒï¼ˆæ›´å¿«ï¼‰</td>\n<td>æ”¯æŒï¼ˆæœ€ä¼˜åŒ–ï¼‰</td>\n</tr>\n<tr>\n<td>å…¨å±€ç¼“å­˜</td>\n<td>æ”¯æŒï¼ˆä½†é¡¹ç›®ä»ä¼šå­˜å‰¯æœ¬ï¼‰</td>\n<td>æ”¯æŒï¼ˆä»ä¼šæ‹·è´åˆ° node_modules/ï¼‰</td>\n<td>å¼ºåˆ¶å¯ç”¨ï¼ˆå¤šä¸ªé¡¹ç›®å…±ç”¨ä¾èµ–ï¼ŒèŠ‚çœç©ºé—´ï¼‰</td>\n</tr>\n<tr>\n<td>monorepoï¼ˆå¤šåŒ…ç®¡ç†ï¼‰</td>\n<td>éœ€è¦æ‰‹åŠ¨é…ç½®</td>\n<td>æ”¯æŒ Workspaces</td>\n<td>åŸç”Ÿæ”¯æŒ Workspacesï¼ˆæœ€å¼ºå¤§ï¼‰</td>\n</tr>\n<tr>\n<td>å‘½ä»¤å…¼å®¹æ€§</td>\n<td>æ ‡å‡†</td>\n<td>å…¼å®¹ npmï¼Œéƒ¨åˆ†ä¸åŒ</td>\n<td>å…¼å®¹ npmï¼Œå¤§éƒ¨åˆ†å‘½ä»¤ç›¸åŒ</td>\n</tr>\n<tr>\n<td>è‡ªåŠ¨ä¿®å¤ package.json</td>\n<td>æ˜¯</td>\n<td>æ˜¯</td>\n<td>æ˜¯</td>\n</tr>\n<tr>\n<td>ç”Ÿæ€å…¼å®¹æ€§</td>\n<td>å®˜æ–¹æ ‡å‡†ï¼Œå…¼å®¹æ€§æœ€å¥½</td>\n<td>å…¼å®¹ npmï¼Œä½†éƒ¨åˆ†ç‰¹æ€§ä¸åŒ</td>\n<td>å…¼å®¹ npmï¼Œä½†é‡‡ç”¨ä¸åŒçš„ä¾èµ–ç®¡ç†æ–¹å¼</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¸¸è§å‘½ä»¤å¯¹æ¯”</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>ä»»åŠ¡</th>\n<th>npm</th>\n<th>yarn</th>\n<th>pnpm</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>åˆå§‹åŒ–é¡¹ç›®</td>\n<td>npm init</td>\n<td>yarn init</td>\n<td>pnpm init</td>\n</tr>\n<tr>\n<td>å®‰è£…ä¾èµ–</td>\n<td>npm install</td>\n<td>yarn install</td>\n<td>pnpm install</td>\n</tr>\n<tr>\n<td>å®‰è£…ç‰¹å®šä¾èµ–</td>\n<td>npm install lodash</td>\n<td>yarn add lodash</td>\n<td>pnpm add lodash</td>\n</tr>\n<tr>\n<td>å®‰è£…å¼€å‘ä¾èµ–</td>\n<td>npm install lodash -D</td>\n<td>yarn add lodash -D</td>\n<td>pnpm add lodash -D</td>\n</tr>\n<tr>\n<td>åˆ é™¤ä¾èµ–</td>\n<td>npm uninstall lodash</td>\n<td>yarn remove lodash</td>\n<td>pnpm remove lodash</td>\n</tr>\n<tr>\n<td>æ›´æ–°ä¾èµ–</td>\n<td>npm update lodash</td>\n<td>yarn upgrade lodash</td>\n<td>pnpm update lodash</td>\n</tr>\n<tr>\n<td>å…¨å±€å®‰è£…</td>\n<td>npm install -g serve</td>\n<td>yarn global add serve</td>\n<td>pnpm add -g serve</td>\n</tr>\n<tr>\n<td>è¿è¡Œè„šæœ¬</td>\n<td>npm run dev</td>\n<td>yarn dev</td>\n<td>pnpm dev</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä»€ä¹ˆæ—¶å€™ä½¿ç”¨ npmã€yarnã€pnpmï¼Ÿ</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-6\">\n<p>âœ… ä½¿ç”¨ pnpmï¼ˆæ¨èï¼‰ï¼š<br>\n1.ä½ å¸Œæœ›å‡å°‘ç£ç›˜å ç”¨ã€åŠ å¿«å®‰è£…é€Ÿåº¦<br>\n2.ä½ æ­£åœ¨å¼€å‘ monorepoï¼ˆå¤šåŒ…ï¼‰é¡¹ç›®<br>\n3.ä½ å¸Œæœ›æ›´é«˜æ•ˆåœ°ç®¡ç†ä¾èµ–</p>\n</li>\n<li class=\"lvl-6\">\n<p>âœ… ä½¿ç”¨ yarnï¼š<br>\n1.ä½ å¸Œæœ›æ›´å¿«çš„å®‰è£…é€Ÿåº¦ï¼Œä½†åˆä¸æƒ³æ”¹å˜ npm ä¼ ç»Ÿç»“æ„<br>\n2.ä½ çš„å›¢é˜Ÿä¹ æƒ¯ä½¿ç”¨ yarn.lock æ–‡ä»¶<br>\n3.ä½ åœ¨ç”¨ React Nativeï¼ˆå®˜æ–¹æ¨è yarnï¼‰</p>\n</li>\n<li class=\"lvl-6\">\n<p>âœ… ä½¿ç”¨ npmï¼ˆé€‚åˆç®€å•é¡¹ç›®ï¼‰ï¼š<br>\n1.ä½ å¸Œæœ›ä½¿ç”¨ Node.js å®˜æ–¹çš„é»˜è®¤å·¥å…·<br>\n2.ä½ ä¸æƒ³å®‰è£…é¢å¤–çš„åŒ…ç®¡ç†å·¥å…·<br>\n3.ä½ åœ¨å¼€å‘å°å‹é¡¹ç›®ï¼Œä¸éœ€è¦ workspaces</p>\n</li>\n</ul>\n</li>\n</ul>\n","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç»å¦‚ä½•ä½¿ç”¨npm npmç‰ˆæœ¬10.5.0 npmç®€ä»‹ npmï¼ˆNode Package Managerï¼‰æ˜¯ Node.js çš„åŒ…ç®¡ç†å·¥å…·ï¼Œä¹Ÿæ˜¯ JavaScript ç¼–ç¨‹ç¤¾åŒºä¸­æœ€å¸¸ç”¨çš„ç®¡ç†å’Œåˆ†äº«ä»£ç çš„å·¥å…·ã€‚ å®ƒå…è®¸å¼€å‘è€…è½»æ¾åœ°å®‰è£…ã€å…±äº«ã€å’Œç®¡ç†åœ¨é¡¹ç›®ä¸­ä½¿ç”¨çš„ JavaScript åŒ…ã€‚ npm åˆ†ä¸ºä¸¤ä¸ªä¸»è¦éƒ¨åˆ†ï¼šå‘½ä»¤è¡Œå·¥å…·ï¼ˆCLIï¼‰å’Œ npm æ³¨å†Œè¡¨ã€‚ å‘½ä»¤è¡Œå·¥å…·ï¼ˆCLIï¼‰ï¼šç”¨äºä¸æ³¨å†Œè¡¨è¿›è¡Œäº¤äº’ï¼Œå®‰è£…å’Œç®¡ç†é¡¹ç›®ä¸­çš„ä¾èµ–ã€‚ npm æ³¨å†Œè¡¨ï¼šä¸€ä¸ªåœ¨çº¿çš„æ•°æ®åº“ï¼Œå­˜å‚¨äº†æ•°ç™¾ä¸‡ä¸ªå¼€æºçš„ Node.js åŒ…ï¼Œå¼€å‘è€…å¯ä»¥åœ¨è‡ªå·±çš„é¡¹ç›®ä¸­ä½¿ç”¨è¿™äº›åŒ…ã€‚ npm çš„å®‰è£…ä¸é…ç½® npm é€šå¸¸ä¸ Node.js ä¸€èµ·å®‰è£…ï¼Œå› æ­¤å®‰è£… Node.js ä¼šè‡ªåŠ¨å®‰è£… npmã€‚ ä» Node.js å®˜ç½‘ä¸‹è½½å¹¶å®‰è£… Node.jsã€‚ è·ŸéšNode.js å®˜ç½‘â€“Downloadçš„æç¤ºå®Œæˆ Node.js çš„å®‰è£…ï¼Œ ç°åœ¨å®˜æ–¹æ›´æ¨èä½¿ç”¨nvmçš„æ–¹å¼è¿›è¡Œå®‰è£…ï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥é€‰æ‹©å¯¹åº”ç³»ç»Ÿçš„äºŒè¿›åˆ¶åŒ…è¿›è¡Œå®‰è£…ï¼ˆæ­¤ç§æ–¹æ³•è¦å°†nodeçš„binç›®å½•é…ç½®åˆ°PATHç¯å¢ƒå˜é‡ï¼‰ï¼Œnode.jså®‰è£…å®Œæˆåï¼Œnpm ä¹Ÿä¼šä¸€èµ·å®‰è£…ã€‚ æ‰“å¼€å‘½ä»¤è¡Œæˆ–ç»ˆç«¯å·¥å…·ï¼Œè¾“å…¥ä»¥ä¸‹å‘½ä»¤æ¥éªŒè¯æ˜¯å¦æˆåŠŸå®‰è£… 12npm -vnode -v npm å¸¸ç”¨å‘½ä»¤ npm initï¼šåˆå§‹åŒ–é¡¹ç›® npm initå‘½ä»¤ç”¨äºåˆå§‹åŒ–ä¸€ä¸ªæ–°çš„ Node.js é¡¹ç›®ï¼Œç”Ÿæˆä¸€ä¸ªpackage.jsonæ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«é¡¹ç›®çš„å…ƒæ•°æ®å’Œé…ç½®ã€‚ 123mkdir my-projectcd my-projectnpm init æ‰§è¡Œè¯¥å‘½ä»¤åï¼Œä¼šæŒ‰ç…§æç¤ºè¾“å…¥ä¸€äº›é¡¹ç›®ç›¸å…³çš„ä¿¡æ¯ï¼Œå¦‚åç§°ã€ç‰ˆæœ¬ã€æè¿°ç­‰ã€‚ä¹Ÿå¯ä»¥ä½¿ç”¨ npm init -y è·³è¿‡æç¤ºï¼Œç”Ÿæˆä¸€ä¸ªé»˜è®¤çš„package.jsonæ–‡ä»¶ã€‚ npm createï¼šåŸºäºæ¨¡æ¿åˆ›å»ºé¡¹ç›® npm createå‘½ä»¤ç”¨äºåŸºäºæ¨¡æ¿åˆ›å»ºä¸€ä¸ªæ–°çš„ Node.js é¡¹ç›®ï¼Œæ¯”å¦‚æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªåŸºäºVueçš„Webé¡¹ç›®ï¼Œå¯ä»¥æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š 1npm create vue@latest npm installï¼šå®‰è£…ä¾èµ–åŒ… npm installå‘½ä»¤ç”¨äºå®‰è£…é¡¹ç›®ä¸­æ‰€éœ€çš„ä¾èµ–åŒ…ï¼Œæ¯”å¦‚åœ¨package.jsonæ–‡ä»¶ä¸­æŒ‡å®šäº†ä¾èµ–åŒ…ï¼Œå¯ä»¥æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š 1npm install å®‰è£…å®Œæˆåï¼Œä¼šåœ¨node_modulesç›®å½•ä¸‹ç”Ÿæˆä¾èµ–åŒ…ï¼Œå¹¶æ›´æ–°package-lock.jsonæ–‡ä»¶ã€‚ å®‰è£…æŒ‡å®šä¾èµ–åŒ…ï¼Œé»˜è®¤å®‰è£…æœ€æ–°ç‰ˆï¼Œè‡ªåŠ¨å°†ä¾èµ–åŒ…æ·»åŠ åˆ° package.json çš„ â€œdependenciesâ€ éƒ¨åˆ†ã€‚ 1npm install express å¦‚æœéœ€è¦å®‰è£…ç‰¹å®šçš„ç‰ˆæœ¬ï¼Œå¯ä»¥æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š 1npm install express@4.17.1 å®‰è£…å¼€å‘ä¾èµ–åŒ…ï¼Œå®‰è£…å¹¶å†™å…¥package.jsonçš„&quot;devDependencies&quot;ä¸­ 123npm install express -D# ç­‰ä»·äºnpm install express --save-dev å®‰è£…å…¨å±€ä¾èµ–åŒ… 1234567# å…¨å±€å®‰è£…çš„åŒ…ä¼šè¢«å®‰è£…åˆ°å…¨å±€çš„node_modulesç›®å½•ä¸‹ï¼Œä¸ä¼šè¢«å®‰è£…åˆ°é¡¹ç›®ç›®å½•ä¸‹ï¼Œä¹Ÿä¸ä¼šå‡ºç°åœ¨package.jsonä¸­npm install express -g# ç­‰ä»·äºnpm install express --global# å…¨å±€node_modulesç›®å½•è·¯å¾„æŸ¥çœ‹npm root -g ä»æœ¬åœ°å®‰è£…ä¾èµ–åŒ… 12# ä»æœ¬åœ°å®‰è£…npm install ./path/to/local_project ä»è¿œç¨‹Gitä»“åº“å®‰è£…ä¾èµ–åŒ… 123456789101112131415161718192021222324# å®‰è£…å…¬å…±é¡¹ç›®ï¼š# npm install https://github.com/user_name/node_projectnpm install https://github.com/trentm/json.git# ç¼©å†™ï¼Œå¦‚æœæ˜¯gitlabä»“åº“ï¼Œåˆ™éœ€è¦ä½¿ç”¨gitlabå‰ç¼€ï¼Œæ¨èä½¿ç”¨ä¸Šé¢çš„å®Œæ•´è¯­ä¹‰ç‰ˆæœ¬npm install github:trentm/json# å®‰è£…ç‰¹å®šæäº¤ï¼š# npm install https://github.com/user_name/node_project#commitnpm install https://github.com/trentm/json.git\\#6912b25272312d0f13ad32e98ebc1b4deb6334cc# å®‰è£…ç‰¹å®šåˆ†æ”¯ï¼š# npm install https://github.com/user_name/node_project#branchNamenpm install https://github.com/trentm/json.git\\#streaming# é€šè¿‡æ ‡ç­¾å®‰è£…ï¼š# npm install https://github.com/user_name/node_project#tagnpm install https://github.com/trentm/json.git\\#10.0.0# å®‰è£…ç‰¹å®šç‰ˆæœ¬ï¼š# npm install https://github.com/user_name/node_project#versionnpm install https://github.com/trentm/json.git\\#10.0.0# å®Œæ•´çš„è¯­ä¹‰ç‰ˆæœ¬ï¼šnpm install https://github.com/trentm/json.git\\#semver:v10.0.0# ä½¿ç”¨gitçš„ssh repo link å®‰è£…ç§æœ‰åº“ï¼šåé¢åŒæ ·å¯ä»¥æ¥ commitã€branchNameã€tagã€versionç­‰# npm install git+ssh://git@github.com:user_name/node_project.gitnpm install git+ssh://git@github.com/trentm/json.git npm updateï¼šæ›´æ–°ä¾èµ–åŒ… npm updateå‘½ä»¤ç”¨äºæ›´æ–°é¡¹ç›®ä¸­çš„ä¾èµ–åŒ…ï¼Œæ¯”å¦‚è¦æ›´æ–°expressä¾èµ–åŒ…åˆ°æœ€æ–°ç‰ˆæœ¬ï¼Œå¯ä»¥æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š 123456# æ›´æ–°ç”Ÿäº§ç¯å¢ƒä¾èµ–åŒ…npm update express# æ›´æ–°å¼€å‘ç¯å¢ƒä¾èµ–åŒ…npm update express -D# å…¨å±€æ›´æ–°npm update express -g ä¿®æ”¹äº†package.jsonæ–‡ä»¶ï¼Œå¹¶å¸Œæœ›æ›´æ–°ä¾èµ–åŒ…ï¼Œå¯ä»¥æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š 12# #ä¸ºäº†é¿å…ä¸å¿…è¦çš„éº»çƒ¦ï¼Œå¯ä»¥å…ˆåˆ é™¤é¡¹ç›®ä¸­çš„node_modulesæ–‡ä»¶å¤¹åœ¨æ‰§è¡Œï¼Œæ­¤æ—¶å’Œ npm install ä¸€æ ·npm update npm outdateï¼šæ£€æŸ¥å“ªäº›åŒ…å¯ä»¥å‡çº§ npm outdateå‘½ä»¤ç”¨äºæ£€æŸ¥å“ªäº›åŒ…å¯ä»¥å‡çº§ 1234567# æ£€æŸ¥å½“å‰é¡¹ç›®ä¸‹å“ªäº›åŒ…å¯ä»¥å‡çº§npm outdate# æ£€æŸ¥æŒ‡å®šåŒ…npm outdated express# æ£€æŸ¥å…¨å±€æ¨¡å—npm outdate -gnpm outdated -g express npm-upgradeï¼šåˆ¤æ–­package.jsonå“ªäº›åŒ…éœ€è¦å‡çº§ å®‰è£… 1npm install -g npm-upgrade ä½¿ç”¨ 1234# åˆ¤æ–­package.jsonå“ªäº›åŒ…éœ€è¦å‡çº§ï¼Œç”¨æˆ·ç¡®è®¤åä¼šè‡ªåŠ¨æ›´æ–°package.jsonæ–‡ä»¶ï¼Œæ­¤æ—¶åªæ˜¯æ›´æ–°æ–‡ä»¶ï¼Œå¹¶æ²¡æœ‰çœŸæ­£å‡çº§npm-upgrade# åŸºäºpackage.jsonä¸­çš„é…ç½®è¿›è¡Œå‡çº§ï¼Œå¯ä»¥å…ˆåˆ é™¤node_moduleså†æ‰§è¡Œï¼Œæ­¤æ—¶å’Œ npm install ä¸€æ ·npm update npm listï¼šåˆ—å‡ºä¾èµ–åŒ… npm listå‘½ä»¤ç”¨äºåˆ—å‡ºé¡¹ç›®ä¸­çš„ä¾èµ–åŒ…ï¼Œæ¯”å¦‚è¦åˆ—å‡ºå½“å‰é¡¹ç›®ä¸‹çš„ä¾èµ–åŒ…ï¼Œå¯ä»¥æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š 123456789# æ­¤æ—¶åˆ—å‡ºçš„æ˜¯package.jsonä¸­çš„dependenciesä¾èµ–åŒ…npm list# åˆ—å‡ºå¼€å‘ä¾èµ–åŒ…ï¼Œæ­¤æ—¶ä¼šåˆ—å‡ºpackage.jsonä¸­çš„devDependencieså’Œdependenciesä¾èµ–åŒ…npm list -D# åˆ—å‡ºæŒ‡å®šåŒ…npm list express# åˆ—å‡ºå…¨å±€æ¨¡å—npm list -gnpm list -g express npm uninstallï¼šå¸è½½ä¾èµ–åŒ… npm uninstallå‘½ä»¤ç”¨äºå¸è½½é¡¹ç›®ä¸­çš„ä¾èµ–åŒ…ï¼Œæ¯”å¦‚è¦å¸è½½expressä¾èµ–åŒ…ï¼Œå¯ä»¥æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š 123npm uninstall express# åˆ é™¤å…¨å±€æ¨¡å—npm uninstall -g express npm searchï¼šæœç´¢ä¾èµ–åŒ… npm searchå‘½ä»¤ç”¨äºæœç´¢ä¾èµ–åŒ…ï¼Œæ¯”å¦‚è¦æœç´¢expressä¾èµ–åŒ…ï¼Œå¯ä»¥æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š 1npm search express å¯ä»¥ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æœç´¢ä¾èµ–åŒ…ï¼Œæ¯”å¦‚è¦æœç´¢ä»¥expresså¼€å¤´çš„ä¾èµ–åŒ…ï¼Œå¯ä»¥æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š 1npm search /^express/ npm view == npm infoï¼šæŸ¥çœ‹åŒ…ä¿¡æ¯ npm viewå‘½ä»¤ç”¨äºæŸ¥çœ‹åŒ…çš„ä¿¡æ¯ï¼Œæ¯”å¦‚è¦æŸ¥çœ‹expressä¾èµ–åŒ…çš„ä¿¡æ¯ï¼Œå¯ä»¥æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š 123npm view express# æˆ–è€…ï¼Œviewä¸infoå‘½ä»¤å¯ä»¥äº’æ¢ä½¿ç”¨npm info express npm viewå‘½ä»¤è¿˜å¯ä»¥æŸ¥çœ‹åŒ…çš„æ‰€æœ‰ç‰ˆæœ¬ä¿¡æ¯ï¼Œæ¯”å¦‚è¦æŸ¥çœ‹expressä¾èµ–åŒ…çš„æ‰€æœ‰ç‰ˆæœ¬ä¿¡æ¯ï¼Œå¯ä»¥æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š 12# æ­¤æ—¶æˆ‘ä»¬ä»ç»“æœä¸­é€‰æ‹©ä¸€ä¸ªç‰ˆæœ¬è¿›è¡Œå®‰è£…å³å¯npm view express versions npm homeï¼šæ‰“å¼€åŒ…çš„ä¸»é¡µ æ‰“å¼€æŸä¸ª npm åŒ…çš„ä¸»é¡µï¼ˆé€šå¸¸æ˜¯ GitHub ä¸»é¡µæˆ– npm é¡µé¢ï¼‰ã€‚ 1npm home express npm é•œåƒæº npm é»˜è®¤ä½¿ç”¨å®˜æ–¹çš„é•œåƒæºï¼Œä½†æ˜¯å®˜æ–¹çš„é•œåƒæºé€Ÿåº¦å¾ˆæ…¢ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç¬¬ä¸‰æ–¹çš„é•œåƒæºæ¥åŠ é€Ÿä¸‹è½½ã€‚ 12345678npm å®˜æ–¹åŸå§‹é•œåƒç½‘å€æ˜¯ï¼šhttps://registry.npmjs.org/æ·˜å® NPM é•œåƒï¼šhttp://registry.npmmirror.comé˜¿é‡Œäº‘ NPM é•œåƒï¼šhttps://npm.aliyun.comè…¾è®¯äº‘ NPM é•œåƒï¼šhttps://mirrors.cloud.tencent.com/npm/åä¸ºäº‘ NPM é•œåƒï¼šhttps://mirrors.huaweicloud.com/repository/npm/ç½‘æ˜“ NPM é•œåƒï¼šhttps://mirrors.163.com/npm/ä¸­å›½ç§‘å­¦æŠ€æœ¯å¤§å­¦å¼€æºé•œåƒç«™ï¼šhttp://mirrors.ustc.edu.cn/æ¸…åå¤§å­¦å¼€æºé•œåƒç«™ï¼šhttps://mirrors.tuna.tsinghua.edu.cn/ å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤æ¥æŸ¥çœ‹å½“å‰ä½¿ç”¨çš„é•œåƒæºï¼š 1npm config get registry å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤æ¥è®¾ç½®é•œåƒæºï¼š 1npm config set registry https://registry.npmmirror.com å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤æ¥åˆ é™¤ç”¨æˆ·é…ç½®çš„é•œåƒæºï¼Œåˆ é™¤åæ¢å¤ä¸ºé»˜è®¤é•œåƒæºï¼š 1npm config delete registry npm é…ç½® å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤æ¥æŸ¥çœ‹npmçš„é…ç½®ä¿¡æ¯ï¼š 123456# æŸ¥çœ‹å…¨å±€é…ç½®ä¿¡æ¯ï¼Œåªæ˜¾ç¤ºç”¨æˆ·è‡ªå®šä¹‰çš„é…ç½®ä¿¡æ¯npm config list# æŸ¥çœ‹å…¨å±€é…ç½®ä¿¡æ¯ï¼Œæ˜¾ç¤ºæ‰€æœ‰é…ç½®ä¿¡æ¯åŠå…¶é»˜è®¤ç¼ºçœå€¼npm config ls -l# json æ ¼å¼ æ˜¾ç¤ºå…¨éƒ¨é…ç½®ä¿¡æ¯npm config list --json é»˜è®¤å…¨å±€é…ç½®åœ¨å½“å‰ç”¨æˆ·HOMEç›®å½•ä¸‹çš„.npmrcæ–‡ä»¶ä¸­ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤æ¥æŸ¥çœ‹å…¨å±€é…ç½®ä¿¡æ¯ï¼š 12cat ~/.npmrccat ~/.npmrc | grep registry åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»ºä¸€ä¸ª.npmrc æ–‡ä»¶å¯ä»¥ä¸ºè¯¥é¡¹ç›®å•ç‹¬è®¾ç½® npm é…ç½®ã€‚ npm config å…è®¸ä½ æ§åˆ¶ npm çš„è¡Œä¸ºï¼ŒåŒ…æ‹¬ å®‰è£…ç›®å½•ã€ä»£ç†ã€æ—¥å¿—çº§åˆ«ã€ä¾èµ–ç®¡ç† ç­‰ã€‚ ä½ å¯ä»¥ä½¿ç”¨ npm config get &lt;key&gt; æŸ¥çœ‹å€¼ï¼Œnpm config set &lt;key&gt; &lt;value&gt; è¿›è¡Œä¿®æ”¹ï¼Œnpm config delete &lt;key&gt; åˆ é™¤è®¾ç½®ã€‚ npmå¸¸ç”¨é…ç½® é…ç½®é¡¹ ä½œç”¨ é»˜è®¤å€¼ prefix è®¾ç½® npm å…¨å±€å®‰è£…çš„è·¯å¾„ï¼ˆnpm install -g å½±å“çš„ç›®å½•ï¼‰ ç¯å¢ƒå˜é‡ NODE_HOME æˆ– /usr/localï¼ˆç³»ç»Ÿï¼‰ cache npm çš„ç¼“å­˜ç›®å½• ~/.npm registry æŒ‡å®š npm çš„åŒ…ç®¡ç†ä»“åº“åœ°å€ï¼ˆå¦‚å®˜æ–¹ã€æ·˜å®é•œåƒï¼‰ https://registry.npmjs.org/ strict-ssl æ˜¯å¦å¼ºåˆ¶ä½¿ç”¨ HTTPS è¿›è¡Œ npm æ“ä½œ true proxy é…ç½® HTTP ä»£ç† null https-proxy é…ç½® HTTPS ä»£ç† null init-author-name è®¾ç½® package.json é»˜è®¤ä½œè€…åç§° â€œâ€ init-author-email è®¾ç½® package.json é»˜è®¤ä½œè€…é‚®ç®± â€œâ€ init-author-url è®¾ç½® package.json é»˜è®¤ä½œè€…ç½‘ç«™ â€œâ€ init-license è®¾ç½® package.json é»˜è®¤è®¸å¯è¯ â€œISCâ€ init-version package.json é»˜è®¤ç‰ˆæœ¬å· â€œ1.0.0â€ save-exact true æ—¶ï¼Œå®‰è£…ä¾èµ–æ—¶ä¸ä½¿ç”¨ ^ æˆ– ~ï¼Œç›´æ¥é”å®šç‰ˆæœ¬ false engine-strict æ˜¯å¦å¼ºåˆ¶åŒ¹é… package.json çš„ engines å­—æ®µ false loglevel è®¾ç½®æ—¥å¿—è¾“å‡ºçº§åˆ«ï¼ˆsilent, error, warn, notice, info, verbose, sillyï¼‰ notice fund æ˜¯å¦æ˜¾ç¤º package çš„èµ„é‡‘æ”¯æŒä¿¡æ¯ true audit æ˜¯å¦å¯ç”¨å®‰å…¨å®¡è®¡ true npm config save-exact æ¨èé…ç½®ä¸º trueï¼Œé¿å…å› ä¸ºç‰ˆæœ¬æ›´æ–°å¯¼è‡´ä¾èµ–åŒ…ç‰ˆæœ¬ä¸åŒ¹é… 1npm config set save-exact true npm config loglevel loglevel å¯é€‰å€¼ çº§åˆ« è¯´æ˜ é€‚ç”¨åœºæ™¯ silent ä¸è¾“å‡ºä»»ä½•æ—¥å¿—ï¼ˆé™¤éå‘ç”Ÿé”™è¯¯ï¼‰ é€‚ç”¨äº CI/CD éœ€è¦æœ€å°‘æ—¥å¿—çš„ç¯å¢ƒ error ä»…æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯ åªå…³å¿ƒ npm è¿è¡Œæ˜¯å¦å‡ºé”™ warn æ˜¾ç¤ºè­¦å‘Šå’Œé”™è¯¯ å‘ç°æ½œåœ¨é—®é¢˜ä½†ä¸å½±å“ä½¿ç”¨ notice (é»˜è®¤) æ˜¾ç¤ºå…³é”®ä¿¡æ¯ã€è­¦å‘Šå’Œé”™è¯¯ npm é»˜è®¤å€¼ï¼Œé€‚åˆå¤§å¤šæ•°åœºæ™¯ http è®°å½• HTTP è¯·æ±‚çš„è¯¦ç»†ä¿¡æ¯ ç”¨äºè°ƒè¯• npm ä¸‹è½½é€Ÿåº¦é—®é¢˜ info æ˜¾ç¤ºä¸€èˆ¬ä¿¡æ¯ã€ä¾èµ–å®‰è£…æƒ…å†µç­‰ é€‚ç”¨äºä¸€èˆ¬å¼€å‘è€…è°ƒè¯• verbose è¯¦ç»†çš„è°ƒè¯•ä¿¡æ¯ é€‚ç”¨äºæ·±å…¥åˆ†æ npm è¿è¡Œæƒ…å†µ silly æœ€è¯¦ç»†çš„æ—¥å¿—ï¼ŒåŒ…å«æ‰€æœ‰è°ƒè¯•ä¿¡æ¯ é€‚ç”¨äº npm å¼€å‘è€…æˆ–æç«¯è°ƒè¯•éœ€æ±‚ è®¾ç½®æ–¹æ³• 1npm config set loglevel verbose ä¸´æ—¶ä½¿ç”¨ 12345678910npm --loglevel verbose install# æˆ–è€…npm -dd install# æ”¯æŒå¿«æ·æ–¹å¼çš„å€¼ï¼š# â€¢ -s, --silent: --loglevel silent# â€¢ -q, --quiet: --loglevel warn# â€¢ -d: --loglevel info# â€¢ -dd, --verbose: --loglevel verbose# â€¢ -ddd: --loglevel silly npm config timing timing æ˜¯ npm çš„ä¸€ä¸ª æ—¥å¿—è¾“å‡ºé…ç½®é¡¹ï¼Œç”¨äºæ§åˆ¶æ˜¯å¦åœ¨å‘½ä»¤æ‰§è¡Œæ—¶æ˜¾ç¤ºè¯¦ç»†çš„æ—¶é—´ä¿¡æ¯ï¼Œé»˜è®¤å€¼ä¸º falseã€‚ å½“ timing è®¾ä¸º true æ—¶ï¼Œnpm ä¼šåœ¨å‘½ä»¤æ‰§è¡Œç»“æŸå æ‰“å°è¯¦ç»†çš„æ—¶é—´ç»Ÿè®¡ä¿¡æ¯ï¼ŒåŒ…æ‹¬ï¼š æ¯ä¸ªå­ä»»åŠ¡çš„æ‰§è¡Œæ—¶é—´ï¼ˆå¦‚è§£æ package.jsonã€è§£æ node_modulesã€ä¸‹è½½ä¾èµ–ç­‰ï¼‰ ç½‘ç»œè¯·æ±‚çš„è€—æ—¶ ä¾èµ–è§£æå’Œå®‰è£…çš„è€—æ—¶ æ•´ä½“æ‰§è¡Œçš„æ—¶é—´å¼€é”€ è¿™å¯¹åˆ†æ npm æ€§èƒ½ã€ä¼˜åŒ–ä¾èµ–å®‰è£…é€Ÿåº¦éå¸¸æœ‰ç”¨ï¼Œç‰¹åˆ«æ˜¯åœ¨å¤§é¡¹ç›®æˆ– CI/CD ç¯å¢ƒä¸­ã€‚ å¯ç”¨ timing 1npm config set timing true ä¸´æ—¶å¯ç”¨ 1npm --timing install é€‚ç”¨åœºæ™¯ åˆ†æ npm å‘½ä»¤æ‰§è¡Œæ—¶é—´ï¼Œä¼˜åŒ–æ„å»ºé€Ÿåº¦ CI/CD ç¯å¢ƒä¸­æ’æŸ¥ npm å®‰è£…å˜æ…¢çš„åŸå›  æ’æŸ¥ npm ä¾èµ–è§£æã€å®‰è£…æˆ–ä¸‹è½½è¿‡ç¨‹çš„æ€§èƒ½ç“¶é¢ˆ ä¸€èˆ¬æ—¥å¸¸å¼€å‘ï¼šæ—¥å¿—ä¼šå˜é•¿ï¼Œå¯èƒ½å½±å“å¯è¯»æ€§ï¼Œæ‰€ä»¥å†æ²¡æœ‰é‡åˆ°é—®é¢˜æ—¶ä¸å»ºè®®å¼€å¯ npmã€pnpmã€yarn ä¹‹é—´çš„è”ç³»å’ŒåŒºåˆ« è¿™ä¸‰è€…éƒ½æ˜¯ JavaScript ç”Ÿæ€ä¸­çš„åŒ…ç®¡ç†å·¥å…·ï¼Œä¸»è¦ç”¨äºå®‰è£…ã€ç®¡ç†å’Œè¿è¡Œ Node.js é¡¹ç›®çš„ä¾èµ–ã€‚å®ƒä»¬çš„å…³ç³»å¦‚ä¸‹ï¼š npmï¼ˆNode Package Managerï¼‰æ˜¯ Node.js å®˜æ–¹è‡ªå¸¦çš„åŒ…ç®¡ç†å·¥å…·ã€‚ yarnï¼ˆYet Another Resource Negotiatorï¼‰æ˜¯ Facebook å¼€å‘çš„æ›¿ä»£ npm çš„å·¥å…·ï¼Œæä¾›æ›´å¿«ã€æ›´å®‰å…¨çš„ä¾èµ–ç®¡ç†ã€‚ pnpmï¼ˆPerformant npmï¼‰æ˜¯ä¸€ä¸ªæ›´é«˜æ•ˆçš„ npm æ›¿ä»£å“ï¼Œä½¿ç”¨ç¡¬é“¾æ¥å’Œå»é‡æœºåˆ¶æ¥å‡å°‘ç£ç›˜å ç”¨å¹¶åŠ å¿«å®‰è£…é€Ÿåº¦ã€‚ npmã€pnpmã€yarn çš„ä¸»è¦åŒºåˆ« ç‰¹æ€§ npm yarn pnpm é»˜è®¤åŒ…ç®¡ç†æ–¹å¼ ç›´æ¥å®‰è£…åˆ° node_modules/ ç›´æ¥å®‰è£…åˆ° node_modules/ ä½¿ç”¨ ç¡¬é“¾æ¥ + å…±äº«ä¾èµ–ï¼Œå ç”¨æ›´å°‘ç£ç›˜ å®‰è£…é€Ÿåº¦ 5+ ç‰ˆæœ¬åé€Ÿåº¦è¾ƒå¿«ï¼Œä½†ä¾èµ–è§£æä»æœ‰æ€§èƒ½é—®é¢˜ é€Ÿåº¦è¾ƒå¿«ï¼Œæ”¯æŒå¹¶è¡Œä¸‹è½½ æœ€å¿«ï¼Œå»é‡èƒ½åŠ›å¼º ç£ç›˜å ç”¨ è¾ƒå¤§ï¼ˆæ¯ä¸ªé¡¹ç›®éƒ½ä¼šå­˜ä¸€ä»½å®Œæ•´çš„ä¾èµ–ï¼‰ è¾ƒå¤§ï¼ˆå’Œ npm ç±»ä¼¼ï¼‰ æœ€å°ï¼ˆå…±äº«å…¨å±€ç¼“å­˜ï¼Œå¤šä¸ªé¡¹ç›®å…±ç”¨ä¾èµ–ï¼‰ é”æ–‡ä»¶ package-lock.json yarn.lock pnpm-lock.yaml å¹¶å‘å®‰è£… æ”¯æŒï¼ˆnpm 5+ ä¼˜åŒ–ï¼‰ æ”¯æŒï¼ˆæ›´å¿«ï¼‰ æ”¯æŒï¼ˆæœ€ä¼˜åŒ–ï¼‰ å…¨å±€ç¼“å­˜ æ”¯æŒï¼ˆä½†é¡¹ç›®ä»ä¼šå­˜å‰¯æœ¬ï¼‰ æ”¯æŒï¼ˆä»ä¼šæ‹·è´åˆ° node_modules/ï¼‰ å¼ºåˆ¶å¯ç”¨ï¼ˆå¤šä¸ªé¡¹ç›®å…±ç”¨ä¾èµ–ï¼ŒèŠ‚çœç©ºé—´ï¼‰ monorepoï¼ˆå¤šåŒ…ç®¡ç†ï¼‰ éœ€è¦æ‰‹åŠ¨é…ç½® æ”¯æŒ Workspaces åŸç”Ÿæ”¯æŒ Workspacesï¼ˆæœ€å¼ºå¤§ï¼‰ å‘½ä»¤å…¼å®¹æ€§ æ ‡å‡† å…¼å®¹ npmï¼Œéƒ¨åˆ†ä¸åŒ å…¼å®¹ npmï¼Œå¤§éƒ¨åˆ†å‘½ä»¤ç›¸åŒ è‡ªåŠ¨ä¿®å¤ package.json æ˜¯ æ˜¯ æ˜¯ ç”Ÿæ€å…¼å®¹æ€§ å®˜æ–¹æ ‡å‡†ï¼Œå…¼å®¹æ€§æœ€å¥½ å…¼å®¹ npmï¼Œä½†éƒ¨åˆ†ç‰¹æ€§ä¸åŒ å…¼å®¹ npmï¼Œä½†é‡‡ç”¨ä¸åŒçš„ä¾èµ–ç®¡ç†æ–¹å¼ å¸¸è§å‘½ä»¤å¯¹æ¯” ä»»åŠ¡ npm yarn pnpm åˆå§‹åŒ–é¡¹ç›® npm init yarn init pnpm init å®‰è£…ä¾èµ– npm install yarn install pnpm install å®‰è£…ç‰¹å®šä¾èµ– npm install lodash yarn add lodash pnpm add lodash å®‰è£…å¼€å‘ä¾èµ– npm install lodash -D yarn add lodash -D pnpm add lodash -D åˆ é™¤ä¾èµ– npm uninstall lodash yarn remove lodash pnpm remove lodash æ›´æ–°ä¾èµ– npm update lodash yarn upgrade lodash pnpm update lodash å…¨å±€å®‰è£… npm install -g serve yarn global add serve pnpm add -g serve è¿è¡Œè„šæœ¬ npm run dev yarn dev pnpm dev ä»€ä¹ˆæ—¶å€™ä½¿ç”¨ npmã€yarnã€pnpmï¼Ÿ âœ… ä½¿ç”¨ pnpmï¼ˆæ¨èï¼‰ï¼š 1.ä½ å¸Œæœ›å‡å°‘ç£ç›˜å ç”¨ã€åŠ å¿«å®‰è£…é€Ÿåº¦ 2.ä½ æ­£åœ¨å¼€å‘ monorepoï¼ˆå¤šåŒ…ï¼‰é¡¹ç›® 3.ä½ å¸Œæœ›æ›´é«˜æ•ˆåœ°ç®¡ç†ä¾èµ– âœ… ä½¿ç”¨ yarnï¼š 1.ä½ å¸Œæœ›æ›´å¿«çš„å®‰è£…é€Ÿåº¦ï¼Œä½†åˆä¸æƒ³æ”¹å˜ npm ä¼ ç»Ÿç»“æ„ 2.ä½ çš„å›¢é˜Ÿä¹ æƒ¯ä½¿ç”¨ yarn.lock æ–‡ä»¶ 3.ä½ åœ¨ç”¨ React Nativeï¼ˆå®˜æ–¹æ¨è yarnï¼‰ âœ… ä½¿ç”¨ npmï¼ˆé€‚åˆç®€å•é¡¹ç›®ï¼‰ï¼š 1.ä½ å¸Œæœ›ä½¿ç”¨ Node.js å®˜æ–¹çš„é»˜è®¤å·¥å…· 2.ä½ ä¸æƒ³å®‰è£…é¢å¤–çš„åŒ…ç®¡ç†å·¥å…· 3.ä½ åœ¨å¼€å‘å°å‹é¡¹ç›®ï¼Œä¸éœ€è¦ workspaces","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç»å¦‚ä½•ä½¿ç”¨npm npmç‰ˆæœ¬10.5.0","date_published":"2025-03-13T13:30:05.000Z","tags":["æŠ€æœ¯","npm","nodejs","npm"]},{"id":"https://blog.hanqunfeng.com/2025/01/02/mermaid/","url":"https://blog.hanqunfeng.com/2025/01/02/mermaid/","title":"Hexo-Next ä¸»é¢˜çš„å›¾å½¢å·¥å…· -- Mermaid","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\n-->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><a href=\"https://mermaid.js.org/intro/\">Mermaid</a> æ˜¯ä¸€ä¸ªæ”¯æŒåœ¨Markdownæ–‡æ¡£ä¸­ç»˜åˆ¶æµç¨‹å›¾ã€ç”˜ç‰¹å›¾ã€åºåˆ—å›¾ç­‰å›¾å½¢çš„å·¥å…·ã€‚å®ƒåŸºäºJavaScriptå®ç°ï¼Œèƒ½å¤Ÿå°†Markdownä¸­çš„å…ƒç´ æ¸²æŸ“æˆHTMLå…ƒç´ ï¼Œä»è€Œåœ¨ç½‘é¡µä¸Šç›´è§‚åœ°å±•ç¤ºå„ç§å›¾è¡¨â€Œ</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://theme-next.js.org/docs/tag-plugins/mermaid\">Nextä¸»é¢˜ä¸­ä½¿ç”¨Mermaidè¯´æ˜</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç»å¦‚ä½•åœ¨ <code>Hexo-Next</code> ä¸»é¢˜ä¸­ä½¿ç”¨ <code>Mermaid</code></p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"é…ç½®å’Œä½¿ç”¨æ–¹æ³•\">é…ç½®å’Œä½¿ç”¨æ–¹æ³•</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>NexT config file ä¸­æ‰¾åˆ°<code>mermaid</code>é…ç½®ï¼Œå¹¶è®¾ç½®ä¸º<code>true</code>ï¼Œ<code>theme</code> å¯ä»¥è®¾ç½®æµ…è‰²å’Œæ·±è‰²èƒŒæ™¯çš„æ ·å¼ï¼Œå…±æœ‰4ä¸ªå¯ç”¨é€‰é¡¹</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">mermaid:</span></span><br><span class=\"line\">  <span class=\"attr\">enable:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">  <span class=\"comment\"># Available themes: default | dark | forest | neutral</span></span><br><span class=\"line\">  <span class=\"attr\">theme:</span></span><br><span class=\"line\">    <span class=\"attr\">light:</span> <span class=\"string\">dark</span></span><br><span class=\"line\">    <span class=\"attr\">dark:</span> <span class=\"string\">dark</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä½¿ç”¨æ–¹æ³•ï¼Œå…¶ä¸­mermaidä¸endmermaidæ˜¯å›ºå®šæ­é…ï¼Œtype ç”¨äºè®¾ç½®å›¾å½¢çš„ç§ç±»ï¼Œå¦‚æµç¨‹å›¾ã€æ—¶åºå›¾ã€ç”˜ç‰¹å›¾ç­‰ï¼Œä¸‹é¢ç¤ºä¾‹ä¸­ä¼šä»‹ç»</p>\n</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;% mermaid type %&#125;</span><br><span class=\"line\">&#123;% endmermaid %&#125;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ‰äº›å°ä¼™ä¼´å–œæ¬¢ä½¿ç”¨ä»£ç å—çš„å½¢å¼ï¼Œä½¿ç”¨æ—¶å»æ‰å‰é¢çš„<code>#</code></p>\n</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#```mermaid</span><br><span class=\"line\">type</span><br><span class=\"line\"></span><br><span class=\"line\">#```</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä½†æ˜¯æ­¤æ—¶éœ€è¦åœ¨ Hexo config file ä¸­æ‰¾åˆ°<code>highlight</code>ï¼Œå¹¶æ·»åŠ å¦‚ä¸‹å†…å®¹ï¼Œæ‰ä¼šä½¿ä»£ç å—çš„å½¢å¼ç”Ÿæ•ˆ</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">highlight:</span></span><br><span class=\"line\">  <span class=\"attr\">exclude_languages:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">mermaid</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"å›¾å½¢ç¤ºä¾‹\">å›¾å½¢ç¤ºä¾‹</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¿™é‡Œåªä»‹ç»å¸¸ç”¨çš„ä¸€äº›å›¾è¡¨ï¼Œæ›´å¤šå›¾è¡¨çš„ä½¿ç”¨æ–¹æ³•å¯ä»¥å‚è€ƒ<a href=\"https://mermaid.js.org/intro/\">Mermaidå¸®åŠ©æ–‡æ¡£</a></p>\n</li>\n</ul>\n<h3 id=\"Flowchart\">Flowchart</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç”¨äºç»˜åˆ¶æµç¨‹å›¾ï¼Œæ”¯æŒæ–¹å‘ï¼ˆä¾‹å¦‚ä»å·¦åˆ°å³ã€ä»ä¸Šåˆ°ä¸‹ï¼‰å’ŒèŠ‚ç‚¹é—´å…³ç³»çš„å®šä¹‰ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://mermaid.js.org/syntax/flowchart.html\">Mermaid Flowchart</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>type ä¸º <code>&quot;graph TD&quot;</code>æˆ–è€…<code>&quot;graph LR&quot;</code>ï¼Œåˆ†åˆ«è¡¨ç¤ºä»ä¸Šåˆ°ä¸‹å’Œä»å·¦åˆ°å³çš„æ–¹å‘</p>\n</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- æµç¨‹å›¾æ–¹å‘:</span><br><span class=\"line\">  - TB - ä»ä¸Šåˆ°ä¸‹</span><br><span class=\"line\">  - TD - è‡ªä¸Šè€Œä¸‹ï¼Œç­‰åŒäºTB</span><br><span class=\"line\">  - BT - ä»ä¸‹åˆ°ä¸Š</span><br><span class=\"line\">  - RL - ä»å³åˆ°å·¦</span><br><span class=\"line\">  - LR - ä»å·¦åˆ°å³</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><code>&quot;graph TD&quot;</code>ï¼šä»ä¸Šåˆ°ä¸‹</p>\n</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;% mermaid graph TD %&#125;</span><br><span class=\"line\">A[Hard] --&gt;|Text| B(Round)</span><br><span class=\"line\">B --&gt; C&#123;Decision&#125;</span><br><span class=\"line\">C --&gt;|One| D[Result 1]</span><br><span class=\"line\">C --&gt;|Two| E[Result 2]</span><br><span class=\"line\">&#123;% endmermaid %&#125;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ•ˆæœ</p>\n</li>\n</ul>\n<pre><code class=\"highlight mermaid\">graph TD\nA[Hard] --&gt;|Text| B(Round)\nB --&gt; C&#123;Decision&#125;\nC --&gt;|One| D[Result 1]\nC --&gt;|Two| E[Result 2]</code></pre>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¯´æ˜</p>\n</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">graph TDï¼Œå®šä¹‰ä¸€ä¸ªä»ä¸Šåˆ°ä¸‹çš„æµç¨‹å›¾ã€‚</span><br><span class=\"line\">TD æ˜¯ Top to Down çš„ç¼©å†™ï¼Œè¡¨ç¤ºæµç¨‹å›¾ä»ä¸Šå‘ä¸‹æ’åˆ—ã€‚</span><br><span class=\"line\"></span><br><span class=\"line\">A[Hard] --&gt;|Text| B(Round)ï¼Œå®šä¹‰äº†ä¸€ä¸ªèŠ‚ç‚¹ Aï¼Œæ˜¾ç¤ºä¸º Hardã€‚</span><br><span class=\"line\">ä¸€ä¸ªå¸¦æ ‡ç­¾çš„ç®­å¤´ --&gt;|Text| æŒ‡å‘èŠ‚ç‚¹ Bï¼Œç®­å¤´ä¸Šçš„æ ‡ç­¾ä¸º Textã€‚</span><br><span class=\"line\">èŠ‚ç‚¹ B è¢«å®šä¹‰ä¸º Roundï¼Œè¿™æ˜¯ä¸€ä¸ªæ¤­åœ†å½¢èŠ‚ç‚¹ã€‚</span><br><span class=\"line\"></span><br><span class=\"line\">B --&gt; C&#123;Decision&#125;ï¼ŒèŠ‚ç‚¹ B æŒ‡å‘èŠ‚ç‚¹ Cã€‚</span><br><span class=\"line\">èŠ‚ç‚¹ C è¢«å®šä¹‰ä¸º Decisionï¼Œè¿™æ˜¯ä¸€ä¸ªå†³ç­–èŠ‚ç‚¹ï¼Œç”¨å¤§æ‹¬å· &#123;&#125; è¡¨ç¤ºã€‚</span><br><span class=\"line\"></span><br><span class=\"line\">C --&gt;|One| D[Result 1]ï¼Œå†³ç­–èŠ‚ç‚¹ C çš„ä¸€ä¸ªåˆ†æ”¯ï¼Œå¸¦æ ‡ç­¾ Oneï¼ŒæŒ‡å‘èŠ‚ç‚¹ Dã€‚</span><br><span class=\"line\">èŠ‚ç‚¹ D æ˜¾ç¤ºä¸º Result 1ï¼Œè¿™æ˜¯ä¸€ä¸ªçŸ©å½¢èŠ‚ç‚¹ã€‚</span><br><span class=\"line\"></span><br><span class=\"line\">C --&gt;|Two| E[Result 2]ï¼Œå†³ç­–èŠ‚ç‚¹ C çš„å¦ä¸€ä¸ªåˆ†æ”¯ï¼Œå¸¦æ ‡ç­¾ Twoï¼ŒæŒ‡å‘èŠ‚ç‚¹ Eã€‚</span><br><span class=\"line\">èŠ‚ç‚¹ E æ˜¾ç¤ºä¸º Result 2ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªçŸ©å½¢èŠ‚ç‚¹ã€‚</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><code>&quot;graph LR&quot;</code>ï¼šä»å·¦åˆ°å³</p>\n</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;% mermaid graph LR %&#125;</span><br><span class=\"line\">A[é•¿æ–¹å½¢] -- é“¾æ¥ --&gt; B((åœ†))</span><br><span class=\"line\">A --&gt; C(åœ†è§’é•¿æ–¹å½¢)</span><br><span class=\"line\">B --&gt; D&#123;è±å½¢&#125;</span><br><span class=\"line\">C --&gt; D</span><br><span class=\"line\">&#123;% endmermaid %&#125;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ•ˆæœ</p>\n</li>\n</ul>\n<pre><code class=\"highlight mermaid\">graph LR\nA[é•¿æ–¹å½¢] -- é“¾æ¥ --&gt; B((åœ†))\nA --&gt; C(åœ†è§’é•¿æ–¹å½¢)\nB --&gt; D&#123;è±å½¢&#125;\nC --&gt; D</code></pre>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¯´æ˜</p>\n</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">graph LRï¼Œå®šä¹‰æµç¨‹å›¾çš„æ–¹å‘æ˜¯ä»å·¦åˆ°å³ï¼ˆLeft to Rightï¼‰ã€‚</span><br><span class=\"line\">èŠ‚ç‚¹å’Œç®­å¤´ä»å·¦å‘å³æ’åˆ—ã€‚</span><br><span class=\"line\"></span><br><span class=\"line\">A[é•¿æ–¹å½¢] -- é“¾æ¥ --&gt; B((åœ†))ï¼Œå®šä¹‰äº†èŠ‚ç‚¹ A å’ŒèŠ‚ç‚¹ Bã€‚</span><br><span class=\"line\">A æ˜¯ä¸€ä¸ªé•¿æ–¹å½¢èŠ‚ç‚¹ï¼Œæ˜¾ç¤ºå†…å®¹ä¸ºâ€œé•¿æ–¹å½¢â€ã€‚</span><br><span class=\"line\">B æ˜¯ä¸€ä¸ªåœ†å½¢èŠ‚ç‚¹ï¼Œå†…å®¹ä¸ºç©ºã€‚</span><br><span class=\"line\">å®ƒä»¬ä¹‹é—´é€šè¿‡ä¸€ä¸ªå¸¦æ ‡ç­¾çš„ç®­å¤´ -- é“¾æ¥ --&gt; è¿æ¥ï¼Œç®­å¤´ä¸Šæ ‡æ³¨äº†â€œé“¾æ¥â€ã€‚</span><br><span class=\"line\"></span><br><span class=\"line\">A --&gt; C(åœ†è§’é•¿æ–¹å½¢)ï¼ŒèŠ‚ç‚¹ A æŒ‡å‘èŠ‚ç‚¹ Cã€‚</span><br><span class=\"line\">C æ˜¯ä¸€ä¸ªåœ†è§’é•¿æ–¹å½¢èŠ‚ç‚¹ï¼Œæ˜¾ç¤ºå†…å®¹ä¸ºâ€œåœ†è§’é•¿æ–¹å½¢â€ã€‚</span><br><span class=\"line\"></span><br><span class=\"line\">B --&gt; D&#123;è±å½¢&#125;ï¼ŒèŠ‚ç‚¹ B æŒ‡å‘èŠ‚ç‚¹ Dã€‚</span><br><span class=\"line\">D æ˜¯ä¸€ä¸ªè±å½¢èŠ‚ç‚¹ï¼Œæ˜¾ç¤ºå†…å®¹ä¸ºâ€œè±å½¢â€ã€‚</span><br><span class=\"line\"></span><br><span class=\"line\">C --&gt; Dï¼ŒèŠ‚ç‚¹ C ä¹ŸæŒ‡å‘èŠ‚ç‚¹ Dï¼Œç®­å¤´ä¸å¸¦æ ‡ç­¾ã€‚</span><br><span class=\"line\"></span><br><span class=\"line\">èŠ‚ç‚¹ç±»å‹å’Œå½¢çŠ¶</span><br><span class=\"line\">é•¿æ–¹å½¢ [] ï¼šå¦‚ A[é•¿æ–¹å½¢]ï¼Œæ˜¯é»˜è®¤çš„çŸ©å½¢èŠ‚ç‚¹ã€‚</span><br><span class=\"line\">åœ†å½¢ (()) ï¼šå¦‚ B((åœ†))ï¼Œç”¨äºè¡¨ç¤ºä¸€ä¸ªåœ†å½¢èŠ‚ç‚¹ã€‚</span><br><span class=\"line\">åœ†è§’é•¿æ–¹å½¢ () ï¼šå¦‚ C(åœ†è§’é•¿æ–¹å½¢)ï¼Œç”¨äºè¡¨ç¤ºåœ†è§’çŸ©å½¢èŠ‚ç‚¹ã€‚</span><br><span class=\"line\">è±å½¢ &#123;&#125; ï¼šå¦‚ D&#123;è±å½¢&#125;ï¼Œç”¨äºè¡¨ç¤ºå†³ç­–ç‚¹æˆ–æ¡ä»¶åˆ†æ”¯ã€‚</span><br></pre></td></tr></table></figure>\n<h3 id=\"Sequence-Diagram\">Sequence Diagram</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç”¨äºç»˜åˆ¶æ—¶åºå›¾ï¼Œæ˜¾ç¤ºå¤šä¸ªå®ä½“ä¹‹é—´çš„äº¤äº’å…³ç³»ï¼ŒåŒ…æ‹¬æ¶ˆæ¯ã€æ—¶é—´ã€çŠ¶æ€å’Œæ•°æ®äº¤æ¢ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://mermaid.js.org/syntax/sequenceDiagram.html\">Mermaid Sequence Diagram</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>type ä¸º <code>&quot;sequenceDiagram&quot;</code></p>\n</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;% mermaid sequenceDiagram %&#125;</span><br><span class=\"line\">Alice-&gt;&gt;John: Hello John, how are you?</span><br><span class=\"line\">loop Healthcheck</span><br><span class=\"line\">    John-&gt;&gt;John: Fight against hypochondria</span><br><span class=\"line\">end</span><br><span class=\"line\">Note right of John: Rational thoughts!</span><br><span class=\"line\">John--&gt;&gt;Alice: Great!</span><br><span class=\"line\">John-&gt;&gt;Bob: How about you?</span><br><span class=\"line\">Bob--&gt;&gt;John: Jolly good!</span><br><span class=\"line\">&#123;% endmermaid %&#125;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ•ˆæœ</p>\n</li>\n</ul>\n<pre><code class=\"highlight mermaid\">sequenceDiagram\nAlice-&gt;&gt;John: Hello John, how are you?\nloop Healthcheck\n    John-&gt;&gt;John: Fight against hypochondria\nend\nNote right of John: Rational thoughts!\nJohn--&gt;&gt;Alice: Great!\nJohn-&gt;&gt;Bob: How about you?\nBob--&gt;&gt;John: Jolly good!</code></pre>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¯´æ˜</p>\n</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">åŸºæœ¬ç»“æ„è¯´æ˜</span><br><span class=\"line\">sequenceDiagram: å®šä¹‰ä¸€ä¸ªåºåˆ—å›¾ï¼Œè¡¨ç¤ºæ¶ˆæ¯å’Œäº‹ä»¶çš„æ—¶é—´é¡ºåºã€‚</span><br><span class=\"line\">å‚ä¸è€…</span><br><span class=\"line\">    Aliceã€John å’Œ Bob æ˜¯å‚ä¸è€…ã€‚</span><br><span class=\"line\">    æ¯ä¸ªå‚ä¸è€…åœ¨å›¾ä¸­ä¼šä»¥å‚ç›´æ’åˆ—çš„å½¢å¼æ˜¾ç¤ºã€‚</span><br><span class=\"line\">æ¶ˆæ¯å’Œç®­å¤´</span><br><span class=\"line\">    -&gt;&gt; è¡¨ç¤ºä¸€ä¸ªæ¶ˆæ¯çš„å‘é€ï¼Œæ–¹å‘ç”±ç®­å¤´å†³å®šã€‚</span><br><span class=\"line\">    æ¶ˆæ¯å†…å®¹å†™åœ¨ç®­å¤´æ—è¾¹ã€‚</span><br><span class=\"line\">å¾ªç¯ï¼ˆloopï¼‰</span><br><span class=\"line\">    ä½¿ç”¨ loop å®šä¹‰ä¸€ä¸ªå¾ªç¯å—ï¼Œå¾ªç¯ä¸­çš„æ¶ˆæ¯ä¼šé‡å¤æ‰§è¡Œï¼Œè¡¨ç¤ºæŸç§æŒç»­è¡Œä¸ºã€‚</span><br><span class=\"line\">å¤‡æ³¨ï¼ˆNoteï¼‰</span><br><span class=\"line\">    Note right of John å®šä¹‰äº†ä¸€æ¡å¤‡æ³¨ï¼Œæ˜¾ç¤ºåœ¨ John çš„å³ä¾§ï¼Œç”¨æ¥è¡¥å……è¯´æ˜ã€‚</span><br><span class=\"line\"></span><br><span class=\"line\">ä»£ç é€æ­¥è§£æ</span><br><span class=\"line\">Alice-&gt;&gt;John: Hello John, how are you?</span><br><span class=\"line\">    è¡¨ç¤º Alice ç»™ John å‘é€ä¸€æ¡æ¶ˆæ¯ï¼šâ€œHello John, how are you?â€</span><br><span class=\"line\">loop Healthcheck</span><br><span class=\"line\">    å®šä¹‰ä¸€ä¸ªå¾ªç¯å—ï¼Œæ ‡é¢˜ä¸ºâ€œHealthcheckâ€ï¼ˆå¥åº·æ£€æŸ¥ï¼‰ã€‚</span><br><span class=\"line\">    å¾ªç¯å†…å®¹æ˜¯ï¼š</span><br><span class=\"line\">        John-&gt;&gt;John: Fight against hypochondria</span><br><span class=\"line\">        è¡¨ç¤º John è‡ªå·±å‘è‡ªå·±å‘é€ä¸€æ¡æ¶ˆæ¯ï¼šâ€œFight against hypochondriaâ€ï¼ˆä¸ç–‘ç—…ç—‡æŠ—äº‰ï¼‰ã€‚</span><br><span class=\"line\">Note right of John: Rational thoughts!</span><br><span class=\"line\">    å®šä¹‰äº†ä¸€æ¡å¤‡æ³¨ï¼Œæ˜¾ç¤ºåœ¨ John çš„å³ä¾§ã€‚</span><br><span class=\"line\">    å¤‡æ³¨å†…å®¹ä¸ºï¼šâ€œRational thoughts!â€ï¼ˆç†æ€§æ€è€ƒï¼ï¼‰ã€‚</span><br><span class=\"line\">John--&gt;&gt;Alice: Great!</span><br><span class=\"line\">    John å›å¤ Alice ä¸€æ¡æ¶ˆæ¯ï¼šâ€œGreat!â€ï¼ˆå¾ˆå¥½ï¼ï¼‰ã€‚</span><br><span class=\"line\">    ä½¿ç”¨ --&gt;&gt; è¡¨ç¤ºå›å¤æ¶ˆæ¯ã€‚</span><br><span class=\"line\">John-&gt;&gt;Bob: How about you?</span><br><span class=\"line\">    John è¯¢é—® Bob ä¸€æ¡æ¶ˆæ¯ï¼šâ€œHow about you?â€ï¼ˆä½ æ€ä¹ˆæ ·ï¼Ÿï¼‰ã€‚</span><br><span class=\"line\">Bob--&gt;&gt;John: Jolly good!</span><br><span class=\"line\">    Bob å›å¤ John ä¸€æ¡æ¶ˆæ¯ï¼šâ€œJolly good!â€ï¼ˆéå¸¸å¥½ï¼ï¼‰ã€‚</span><br></pre></td></tr></table></figure>\n<h3 id=\"Class-Diagram\">Class Diagram</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç”¨äºç»˜åˆ¶ç±»å›¾ï¼Œæ˜¾ç¤ºå¯¹è±¡ä¹‹é—´çš„å…³ç³»ï¼ŒåŒ…æ‹¬ç»§æ‰¿ã€å…³è”ã€ä¾èµ–ç­‰ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://mermaid.js.org/syntax/classDiagram.html\">Mermaid Class Diagram</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>type ä¸º <code>&quot;classDiagram&quot;</code></p>\n</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;% mermaid classDiagram %&#125;</span><br><span class=\"line\">Class01 &lt;|-- AveryLongClass : Cool</span><br><span class=\"line\">&lt;&lt;interface&gt;&gt; Class01</span><br><span class=\"line\">Class09 --&gt; C2 : Where am i?</span><br><span class=\"line\">Class09 --* C3</span><br><span class=\"line\">Class09 --|&gt; Class07</span><br><span class=\"line\">Class07 : equals()</span><br><span class=\"line\">Class07 : Object[] elementData</span><br><span class=\"line\">Class01 : size()</span><br><span class=\"line\">Class01 : int chimp</span><br><span class=\"line\">Class01 : int gorilla</span><br><span class=\"line\">class Class10 &#123;</span><br><span class=\"line\">  &lt;&lt;service&gt;&gt;</span><br><span class=\"line\">  int id</span><br><span class=\"line\">  size()</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">&#123;% endmermaid %&#125;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ•ˆæœ</p>\n</li>\n</ul>\n<pre><code class=\"highlight mermaid\">classDiagram\nClass01 &lt;|-- AveryLongClass : Cool\n&lt;&lt;interface&gt;&gt; Class01\nClass09 --&gt; C2 : Where am i?\nClass09 --* C3\nClass09 --|&gt; Class07\nClass07 : equals()\nClass07 : Object[] elementData\nClass01 : size()\nClass01 : int chimp\nClass01 : int gorilla\nclass Class10 &#123;\n  &lt;&lt;service&gt;&gt;\n  int id\n  size()\n&#125;</code></pre>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¯´æ˜</p>\n</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">åŸºæœ¬ç»“æ„</span><br><span class=\"line\">classDiagram</span><br><span class=\"line\">    å®šä¹‰ä¸€ä¸ªç±»å›¾ï¼Œå±•ç¤ºç±»çš„å±æ€§ã€æ–¹æ³•ä»¥åŠå®ƒä»¬ä¹‹é—´çš„å…³ç³»ã€‚</span><br><span class=\"line\">ç±»å’Œä¿®é¥°ç¬¦</span><br><span class=\"line\">    ä½¿ç”¨ class ClassName å®šä¹‰ä¸€ä¸ªç±»ã€‚</span><br><span class=\"line\">    ç±»çš„å±æ€§å’Œæ–¹æ³•å®šä¹‰åœ¨ class å—å†…ã€‚</span><br><span class=\"line\">    ç‰¹æ®Šä¿®é¥°ç¬¦å¦‚ &lt;&lt;interface&gt;&gt; å’Œ &lt;&lt;service&gt;&gt; ç”¨äºè¯´æ˜ç±»çš„è§’è‰²æˆ–ç±»å‹ã€‚</span><br><span class=\"line\">å…³ç³»ç¬¦å·</span><br><span class=\"line\">    &lt;|-- è¡¨ç¤ºç»§æ‰¿ï¼ˆextendsï¼‰ã€‚</span><br><span class=\"line\">    --|&gt; è¡¨ç¤ºå®ç°ï¼ˆimplementsï¼Œæ¥å£çš„å®ç°ï¼‰ã€‚</span><br><span class=\"line\">    --&gt; è¡¨ç¤ºå…³è”ï¼ˆæ™®é€šå¼•ç”¨ï¼‰ã€‚</span><br><span class=\"line\">    --* è¡¨ç¤ºç»„åˆå…³ç³»ï¼ˆä¸€ä¸ªç±»åŒ…å«å¦ä¸€ä¸ªç±»ï¼‰ã€‚</span><br><span class=\"line\">    : åè·Ÿå…³ç³»çš„è¯´æ˜æˆ–æ³¨é‡Šã€‚</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">ä»£ç é€æ­¥è§£æ</span><br><span class=\"line\">Class01 &lt;|-- AveryLongClass : Cool</span><br><span class=\"line\">    è¡¨ç¤º AveryLongClass ç»§æ‰¿äº† Class01ï¼Œå…³ç³»åç§°ä¸º Coolã€‚</span><br><span class=\"line\">    &lt;|-- è¡¨ç¤ºç»§æ‰¿ï¼ˆçˆ¶ç±»åˆ°å­ç±»ï¼‰ã€‚</span><br><span class=\"line\">&lt;&lt;interface&gt;&gt; Class01</span><br><span class=\"line\">    å°† Class01 æ ‡è®°ä¸ºä¸€ä¸ªæ¥å£ã€‚</span><br><span class=\"line\">Class09 --&gt; C2 : Where am i?</span><br><span class=\"line\">    è¡¨ç¤º Class09 ä¸ C2 æœ‰ä¸€ä¸ªå…³è”å…³ç³»ï¼Œæ³¨é‡Šä¸º â€œWhere am i?â€ã€‚</span><br><span class=\"line\">Class09 --* C3</span><br><span class=\"line\">    è¡¨ç¤º Class09 ä¸ C3 æœ‰ä¸€ä¸ªç»„åˆå…³ç³»ã€‚</span><br><span class=\"line\">    Class09 åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ª C3 çš„å®ä¾‹ã€‚</span><br><span class=\"line\">Class09 --|&gt; Class07</span><br><span class=\"line\">    è¡¨ç¤º Class09 å®ç°äº† Class07ã€‚</span><br><span class=\"line\">    --|&gt; é€šå¸¸ç”¨äºè¡¨ç¤ºæ¥å£å®ç°ã€‚</span><br><span class=\"line\">Class07 : equals()</span><br><span class=\"line\">    è¡¨ç¤º Class07 å®šä¹‰äº†ä¸€ä¸ªæ–¹æ³• equals()ã€‚</span><br><span class=\"line\">Class07 : Object[] elementData</span><br><span class=\"line\">    è¡¨ç¤º Class07 æœ‰ä¸€ä¸ªå±æ€§ elementDataï¼Œç±»å‹æ˜¯ Object[]ï¼ˆæ•°ç»„ï¼‰ã€‚</span><br><span class=\"line\">Class01 : size()</span><br><span class=\"line\">    è¡¨ç¤º Class01 æœ‰ä¸€ä¸ªæ–¹æ³• size()ã€‚</span><br><span class=\"line\">Class01 : int chimp å’Œ Class01 : int gorilla</span><br><span class=\"line\">    è¡¨ç¤º Class01 æœ‰ä¸¤ä¸ªæ•´å‹å±æ€§ï¼šchimp å’Œ gorillaã€‚</span><br><span class=\"line\">class Class10 &#123; ... &#125;</span><br><span class=\"line\">    å®šä¹‰äº†ä¸€ä¸ªåä¸º Class10 çš„ç±»ã€‚</span><br><span class=\"line\">    ç±»ä¸­æœ‰ä¸€ä¸ªä¿®é¥°ç¬¦ &lt;&lt;service&gt;&gt;ï¼Œè¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªæœåŠ¡ç±»ã€‚</span><br><span class=\"line\">    å±æ€§å’Œæ–¹æ³•ï¼š</span><br><span class=\"line\">        int idï¼šæ•´å‹å±æ€§ã€‚</span><br><span class=\"line\">        size()ï¼šæ–¹æ³•ã€‚</span><br></pre></td></tr></table></figure>\n<h3 id=\"State-Diagram\">State Diagram</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç”¨äºç»˜åˆ¶çŠ¶æ€å›¾ï¼Œæ˜¾ç¤ºå¯¹è±¡çš„çŠ¶æ€è½¬ç§»å’Œè¡Œä¸ºã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://mermaid.js.org/syntax/stateDiagram.html\">Mermaid State Diagram</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>type ä¸º <code>&quot;stateDiagram&quot;</code></p>\n</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;% mermaid stateDiagram %&#125;</span><br><span class=\"line\">[*] --&gt; Still</span><br><span class=\"line\">Still --&gt; [*]</span><br><span class=\"line\">Still --&gt; Moving</span><br><span class=\"line\">Moving --&gt; Still</span><br><span class=\"line\">Moving --&gt; Crash</span><br><span class=\"line\">Crash --&gt; [*]</span><br><span class=\"line\">&#123;% endmermaid %&#125;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ•ˆæœ</p>\n</li>\n</ul>\n<pre><code class=\"highlight mermaid\">stateDiagram\n[*] --&gt; Still\nStill --&gt; [*]\nStill --&gt; Moving\nMoving --&gt; Still\nMoving --&gt; Crash\nCrash --&gt; [*]</code></pre>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¯´æ˜</p>\n</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">åŸºæœ¬ç»“æ„</span><br><span class=\"line\">stateDiagram</span><br><span class=\"line\">    å®šä¹‰è¿™æ˜¯ä¸€ä¸ªçŠ¶æ€å›¾ï¼Œç”¨äºè¡¨ç¤ºçŠ¶æ€å’ŒçŠ¶æ€ä¹‹é—´çš„è½¬æ¢ã€‚</span><br><span class=\"line\">[*]</span><br><span class=\"line\">    è¡¨ç¤ºåˆå§‹çŠ¶æ€æˆ–ç»ˆæ­¢çŠ¶æ€ã€‚</span><br><span class=\"line\">    èµ·å§‹çŠ¶æ€é€šå¸¸æœ‰ç®­å¤´æŒ‡å‘ç¬¬ä¸€ä¸ªçŠ¶æ€ã€‚</span><br><span class=\"line\">    ç»ˆæ­¢çŠ¶æ€é€šå¸¸æœ‰ç®­å¤´æŒ‡å‘å®ƒã€‚</span><br><span class=\"line\">çŠ¶æ€</span><br><span class=\"line\">    ç”¨çŠ¶æ€åç§°å®šä¹‰çŠ¶æ€ï¼Œä¾‹å¦‚ Stillã€Movingã€Crashã€‚</span><br><span class=\"line\">ç®­å¤´</span><br><span class=\"line\">    --&gt; è¡¨ç¤ºçŠ¶æ€ä¹‹é—´çš„è½¬æ¢æ–¹å‘ã€‚</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">ä»£ç é€æ­¥è§£æ</span><br><span class=\"line\">[*] --&gt; Still</span><br><span class=\"line\">    ç³»ç»Ÿä»åˆå§‹çŠ¶æ€è¿›å…¥ Still çŠ¶æ€ã€‚</span><br><span class=\"line\">Still --&gt; [*]</span><br><span class=\"line\">    ç³»ç»Ÿä» Still çŠ¶æ€å¯ä»¥ç›´æ¥è¿›å…¥ç»ˆæ­¢çŠ¶æ€ï¼ˆç³»ç»Ÿç»“æŸï¼‰ã€‚</span><br><span class=\"line\">Still --&gt; Moving</span><br><span class=\"line\">    ç³»ç»Ÿä» Still çŠ¶æ€å¯ä»¥è½¬æ¢ä¸º Moving çŠ¶æ€ã€‚</span><br><span class=\"line\">Moving --&gt; Still</span><br><span class=\"line\">    ç³»ç»Ÿä» Moving çŠ¶æ€å¯ä»¥è¿”å›åˆ° Still çŠ¶æ€ã€‚</span><br><span class=\"line\">Moving --&gt; Crash</span><br><span class=\"line\">    ç³»ç»Ÿä» Moving çŠ¶æ€å¯ä»¥è¿›å…¥ Crash çŠ¶æ€ã€‚</span><br><span class=\"line\">Crash --&gt; [*]</span><br><span class=\"line\">    ç³»ç»Ÿä» Crash çŠ¶æ€å¯ä»¥è¿›å…¥ç»ˆæ­¢çŠ¶æ€ï¼ˆè¡¨ç¤ºç³»ç»Ÿå´©æºƒæˆ–ç»ˆæ­¢ï¼‰ã€‚</span><br></pre></td></tr></table></figure>\n<h3 id=\"Entity-Relationship-Diagram\">Entity Relationship Diagram</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç”¨äºç»˜åˆ¶å®ä½“å…³ç³»å›¾ï¼Œæ˜¾ç¤ºå®ä½“ä¹‹é—´çš„å…³ç³»ï¼ŒåŒ…æ‹¬å…³è”ã€ä¾èµ–ç­‰ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://mermaid.js.org/syntax/entityRelationshipDiagram.html\">Mermaid Entity Relationship Diagram</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>type ä¸º <code>&quot;erDiagram&quot;</code></p>\n</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;% mermaid erDiagram %&#125;</span><br><span class=\"line\">CUSTOMER ||--o&#123; ORDER : places</span><br><span class=\"line\">ORDER ||--|&#123; ITEM : contains</span><br><span class=\"line\">CUSTOMER &#125;|..|&#123; DELIVERY-ADDRESS : has</span><br><span class=\"line\">&#123;% endmermaid %&#125;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ•ˆæœ</p>\n</li>\n</ul>\n<pre><code class=\"highlight mermaid\">erDiagram\nCUSTOMER ||--o&#123; ORDER : places\nORDER ||--|&#123; ITEM : contains\nCUSTOMER &#125;|..|&#123; DELIVERY-ADDRESS : has</code></pre>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¯´æ˜</p>\n</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">åŸºæœ¬ç»“æ„</span><br><span class=\"line\">erDiagram</span><br><span class=\"line\">    å®šä¹‰è¿™æ˜¯ä¸€ä¸ªå®ä½“å…³ç³»å›¾ã€‚</span><br><span class=\"line\">    å±•ç¤ºæ•°æ®åº“ä¸­è¡¨ï¼ˆå®ä½“ï¼‰ä¹‹é—´çš„å…³ç³»ã€‚</span><br><span class=\"line\">å®ä½“</span><br><span class=\"line\">    ä¾‹å¦‚ CUSTOMERã€ORDER å’Œ ITEMï¼Œæ¯ä¸ªå®ä½“å¯¹åº”æ•°æ®åº“ä¸­çš„ä¸€ä¸ªè¡¨ã€‚</span><br><span class=\"line\">å…³ç³»</span><br><span class=\"line\">    ||--o&#123; è¡¨ç¤ºä¸€å¯¹å¤šå…³ç³»ï¼ˆ1:Nï¼‰ã€‚</span><br><span class=\"line\">    ||--|&#123; è¡¨ç¤ºä¸€å¯¹å¤šå…³ç³»ï¼ˆ1:Nï¼‰ï¼Œä½†å¼ºè°ƒå®ä½“çš„å”¯ä¸€æ€§ï¼ˆæ¯ä¸ªå­è®°å½•å±äºå”¯ä¸€çš„çˆ¶è®°å½•ï¼‰ã€‚</span><br><span class=\"line\">    &#125;|..|&#123; è¡¨ç¤ºå¤šå¯¹å¤šå…³ç³»ï¼ˆN:Mï¼‰ã€‚</span><br><span class=\"line\">æ³¨é‡Š</span><br><span class=\"line\">    : åçš„æ–‡å­—æ˜¯å…³ç³»çš„æè¿°ï¼Œä¾‹å¦‚ placesã€containsã€hasã€‚</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">ä»£ç é€æ­¥è§£æ</span><br><span class=\"line\">CUSTOMER ||--o&#123; ORDER : places</span><br><span class=\"line\">    è¡¨ç¤ºä¸€ä¸ªå®¢æˆ· (CUSTOMER) å¯ä»¥ä¸‹å¤šä¸ªè®¢å• (ORDER)ã€‚</span><br><span class=\"line\">    ||--o&#123; è¡¨ç¤º ä¸€å¯¹å¤šå…³ç³»ï¼ˆ1:Nï¼‰ï¼Œå³ä¸€ä¸ªå®¢æˆ·å¯¹åº”å¤šä¸ªè®¢å•ã€‚</span><br><span class=\"line\">ORDER ||--|&#123; ITEM : contains</span><br><span class=\"line\">    è¡¨ç¤ºä¸€ä¸ªè®¢å• (ORDER) åŒ…å«å¤šä¸ªå•†å“ (ITEM)ã€‚</span><br><span class=\"line\">    ||--|&#123; è¡¨ç¤º ä¸€å¯¹å¤šå…³ç³»ï¼Œä¸”æ¯ä¸ªå•†å“çš„è®°å½•ä¸æŸä¸ªè®¢å•å”¯ä¸€å¯¹åº”ã€‚</span><br><span class=\"line\">CUSTOMER &#125;|..|&#123; DELIVERY-ADDRESS : has</span><br><span class=\"line\">    è¡¨ç¤ºä¸€ä¸ªå®¢æˆ· (CUSTOMER) å¯ä»¥æœ‰å¤šä¸ªé…é€åœ°å€ (DELIVERY-ADDRESS)ï¼Œè€Œæ¯ä¸ªé…é€åœ°å€ä¹Ÿå¯èƒ½å¯¹åº”å¤šä¸ªå®¢æˆ·ã€‚</span><br><span class=\"line\">    &#125;|..|&#123; è¡¨ç¤º å¤šå¯¹å¤šå…³ç³»ï¼ˆN:Mï¼‰ã€‚</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h3 id=\"Gantt-Chart\">Gantt Chart</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç”¨äºç»˜åˆ¶ç”˜ç‰¹å›¾ï¼Œæ˜¾ç¤ºä»»åŠ¡è®¡åˆ’ã€è¿›åº¦å’Œèµ„æºåˆ†é…ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://mermaid.js.org/syntax/gantt.html\">Mermaid Gantt Chart</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>type ä¸º <code>&quot;gantt&quot;</code></p>\n</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;% mermaid gantt %&#125;</span><br><span class=\"line\">title Project Timeline</span><br><span class=\"line\">dateFormat  YYYY-MM-DD</span><br><span class=\"line\">section Section1</span><br><span class=\"line\">Completed :done,    des1, 2014-01-06,2014-01-08</span><br><span class=\"line\">Active        :active,  des2, 2014-01-07, 3d</span><br><span class=\"line\">Parallel 1   :         des3, after des1, 1d</span><br><span class=\"line\">Parallel 2   :         des4, after des1, 1d</span><br><span class=\"line\">Parallel 3   :         des5, after des3, 1d</span><br><span class=\"line\">Parallel 4   :         des6, after des4, 1d</span><br><span class=\"line\">section Section2</span><br><span class=\"line\">Task 1 :  t1,after des6,5d</span><br><span class=\"line\">Task 2 :  t2,after t1,3d</span><br><span class=\"line\">&#123;% endmermaid %&#125;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ•ˆæœ</p>\n</li>\n</ul>\n<pre><code class=\"highlight mermaid\">gantt\ntitle Project Timeline\ndateFormat  YYYY-MM-DD\nsection Section1\nCompleted :done,    des1, 2014-01-06,2014-01-08\nActive        :active,  des2, 2014-01-07, 3d\nParallel 1   :         des3, after des1, 1d\nParallel 2   :         des4, after des1, 1d\nParallel 3   :         des5, after des3, 1d\nParallel 4   :         des6, after des4, 1d\nsection Section2\nTask 1 :  t1,after des6,5d\nTask 2 :  t2,after t1,3d</code></pre>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¯´æ˜</p>\n</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">åŸºæœ¬ç»“æ„</span><br><span class=\"line\">gantt</span><br><span class=\"line\">    å®šä¹‰ä¸€ä¸ªç”˜ç‰¹å›¾ï¼Œç”¨äºè¡¨ç¤ºä»»åŠ¡çš„æ—¶é—´åˆ†å¸ƒå’Œä¾èµ–å…³ç³»ã€‚</span><br><span class=\"line\">title</span><br><span class=\"line\">    å®šä¹‰ç”˜ç‰¹å›¾çš„æ ‡é¢˜ï¼Œè¿™é‡Œæ˜¯ Project Timelineã€‚</span><br><span class=\"line\">dateFormat</span><br><span class=\"line\">    å®šä¹‰æ—¥æœŸæ ¼å¼ï¼Œè¿™é‡Œæ˜¯ YYYY-MM-DDï¼ˆå¹´-æœˆ-æ—¥ï¼‰ã€‚</span><br><span class=\"line\">section</span><br><span class=\"line\">    å®šä¹‰ä»»åŠ¡çš„åˆ†ç±»ï¼ˆéƒ¨åˆ†ï¼‰ã€‚</span><br><span class=\"line\">    æ¯ä¸ª section ä¸‹åŒ…å«ä¸€ç»„ä»»åŠ¡ï¼Œä»»åŠ¡åœ¨å›¾è¡¨ä¸­åˆ†ç»„æ˜¾ç¤ºã€‚</span><br><span class=\"line\">ä»»åŠ¡æ ¼å¼</span><br><span class=\"line\">    æ¯ä¸ªä»»åŠ¡æŒ‰ä»¥ä¸‹æ ¼å¼å®šä¹‰ï¼š</span><br><span class=\"line\">        ä»»åŠ¡åç§° : çŠ¶æ€, æ ‡è¯†ç¬¦, å¼€å§‹æ—¥æœŸæˆ–ä¾èµ–, æŒç»­æ—¶é—´</span><br><span class=\"line\">    ä»»åŠ¡åç§°ï¼šä»»åŠ¡çš„æè¿°ã€‚</span><br><span class=\"line\">    çŠ¶æ€ï¼šå¯é€‰ï¼Œè¡¨ç¤ºä»»åŠ¡çŠ¶æ€ï¼š</span><br><span class=\"line\">        doneï¼šå·²å®Œæˆã€‚</span><br><span class=\"line\">        activeï¼šæ­£åœ¨è¿›è¡Œã€‚</span><br><span class=\"line\">    æ ‡è¯†ç¬¦ï¼šä»»åŠ¡çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œç”¨äºå®šä¹‰ä¾èµ–å…³ç³»ã€‚</span><br><span class=\"line\">    æ—¶é—´ï¼šå¯ä»¥æ˜¯å¼€å§‹æ—¥æœŸã€ç»“æŸæ—¥æœŸã€æˆ–ä¾èµ–ä»»åŠ¡ã€‚</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">ä»£ç é€æ­¥è§£æ</span><br><span class=\"line\">section Section1</span><br><span class=\"line\">    å®šä¹‰ä¸€ä¸ªåä¸º Section1 çš„éƒ¨åˆ†ï¼ŒåŒ…å«ä¸€ç»„ä»»åŠ¡ã€‚</span><br><span class=\"line\">Completed :done, des1, 2014-01-06,2014-01-08</span><br><span class=\"line\">    ä»»åŠ¡åç§°ï¼šCompletedã€‚</span><br><span class=\"line\">    çŠ¶æ€ï¼šdoneï¼ˆå·²å®Œæˆï¼‰ã€‚</span><br><span class=\"line\">    æ ‡è¯†ç¬¦ï¼šdes1ã€‚</span><br><span class=\"line\">    å¼€å§‹æ—¥æœŸï¼š2014-01-06ã€‚</span><br><span class=\"line\">    ç»“æŸæ—¥æœŸï¼š2014-01-08ã€‚</span><br><span class=\"line\">Active :active, des2, 2014-01-07, 3d</span><br><span class=\"line\">    ä»»åŠ¡åç§°ï¼šActiveã€‚</span><br><span class=\"line\">    çŠ¶æ€ï¼šactiveï¼ˆæ­£åœ¨è¿›è¡Œï¼‰ã€‚</span><br><span class=\"line\">    æ ‡è¯†ç¬¦ï¼šdes2ã€‚</span><br><span class=\"line\">    å¼€å§‹æ—¥æœŸï¼š2014-01-07ã€‚</span><br><span class=\"line\">    æŒç»­æ—¶é—´ï¼š3dï¼ˆ3å¤©ï¼‰ã€‚</span><br><span class=\"line\">Parallel 1 : des3, after des1, 1d</span><br><span class=\"line\">    ä»»åŠ¡åç§°ï¼šParallel 1ã€‚</span><br><span class=\"line\">    æ— çŠ¶æ€ï¼ˆé»˜è®¤å€¼ï¼‰ã€‚</span><br><span class=\"line\">    æ ‡è¯†ç¬¦ï¼šdes3ã€‚</span><br><span class=\"line\">    å¼€å§‹æ—¶é—´ï¼šä¾èµ–ä»»åŠ¡ des1ï¼ˆåœ¨ä»»åŠ¡ Completed åå¼€å§‹ï¼‰ã€‚</span><br><span class=\"line\">    æŒç»­æ—¶é—´ï¼š1dï¼ˆ1å¤©ï¼‰ã€‚</span><br><span class=\"line\">Parallel 2 : des4, after des1, 1d</span><br><span class=\"line\">    ä»»åŠ¡åç§°ï¼šParallel 2ã€‚</span><br><span class=\"line\">    æ— çŠ¶æ€ã€‚</span><br><span class=\"line\">    æ ‡è¯†ç¬¦ï¼šdes4ã€‚</span><br><span class=\"line\">    å¼€å§‹æ—¶é—´ï¼šä¾èµ–ä»»åŠ¡ des1ï¼ˆåœ¨ä»»åŠ¡ Completed åå¼€å§‹ï¼‰ã€‚</span><br><span class=\"line\">    æŒç»­æ—¶é—´ï¼š1dï¼ˆ1å¤©ï¼‰ã€‚</span><br><span class=\"line\">Parallel 3 : des5, after des3, 1d</span><br><span class=\"line\">    ä»»åŠ¡åç§°ï¼šParallel 3ã€‚</span><br><span class=\"line\">    æ— çŠ¶æ€ã€‚</span><br><span class=\"line\">    æ ‡è¯†ç¬¦ï¼šdes5ã€‚</span><br><span class=\"line\">    å¼€å§‹æ—¶é—´ï¼šä¾èµ–ä»»åŠ¡ des3ï¼ˆåœ¨ä»»åŠ¡ Parallel 1 åå¼€å§‹ï¼‰ã€‚</span><br><span class=\"line\">    æŒç»­æ—¶é—´ï¼š1dï¼ˆ1å¤©ï¼‰ã€‚</span><br><span class=\"line\">Parallel 4 : des6, after des4, 1d</span><br><span class=\"line\">    ä»»åŠ¡åç§°ï¼šParallel 4ã€‚</span><br><span class=\"line\">    æ— çŠ¶æ€ã€‚</span><br><span class=\"line\">    æ ‡è¯†ç¬¦ï¼šdes6ã€‚</span><br><span class=\"line\">    å¼€å§‹æ—¶é—´ï¼šä¾èµ–ä»»åŠ¡ des4ï¼ˆåœ¨ä»»åŠ¡ Parallel 2 åå¼€å§‹ï¼‰ã€‚</span><br><span class=\"line\">    æŒç»­æ—¶é—´ï¼š1dï¼ˆ1å¤©ï¼‰ã€‚</span><br><span class=\"line\">section Section2</span><br><span class=\"line\">    å®šä¹‰ç”˜ç‰¹å›¾çš„ç¬¬äºŒéƒ¨åˆ†ï¼Œç”¨äºåˆ†ç»„æ˜¾ç¤ºåç»­ä»»åŠ¡ã€‚</span><br><span class=\"line\">    ä»»åŠ¡å±äºä¸åŒçš„éƒ¨åˆ†ä»¥ä¾¿åˆ†ç±»å’Œåˆ†ç»„ã€‚</span><br><span class=\"line\">Task 1 : t1, after des6, 5d</span><br><span class=\"line\">    ä»»åŠ¡åç§°ï¼šTask 1ã€‚</span><br><span class=\"line\">    æ ‡è¯†ç¬¦ï¼št1ã€‚</span><br><span class=\"line\">    å¼€å§‹æ—¶é—´ï¼šä¾èµ–ä»»åŠ¡ des6ï¼ˆParallel 4ï¼‰å®Œæˆåå¼€å§‹ã€‚</span><br><span class=\"line\">    æŒç»­æ—¶é—´ï¼š5dï¼ˆ5å¤©ï¼‰ã€‚</span><br><span class=\"line\">Task 2 : t2, after t1, 3d</span><br><span class=\"line\">    ä»»åŠ¡åç§°ï¼šTask 2ã€‚</span><br><span class=\"line\">    æ ‡è¯†ç¬¦ï¼št2ã€‚</span><br><span class=\"line\">    å¼€å§‹æ—¶é—´ï¼šä¾èµ–ä»»åŠ¡ t1ï¼ˆTask 1ï¼‰å®Œæˆåå¼€å§‹ã€‚</span><br><span class=\"line\">    æŒç»­æ—¶é—´ï¼š3dï¼ˆ3å¤©ï¼‰ã€‚</span><br></pre></td></tr></table></figure>\n<h3 id=\"Pie-Chart\">Pie Chart</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç”¨äºç»˜åˆ¶é¥¼çŠ¶å›¾ï¼Œæ˜¾ç¤ºæ•°æ®åˆ†å¸ƒæƒ…å†µã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://mermaid.js.org/syntax/pie.html\">Mermaid Pie Chart</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>type ä¸º <code>&quot;pie&quot;</code></p>\n</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;% mermaid pie showData %&#125;</span><br><span class=\"line\">%%&#123;init: &#123;&quot;pie&quot;: &#123;&quot;textPosition&quot;: 0.4&#125;, &quot;themeVariables&quot;: &#123;&quot;pieOuterStrokeWidth&quot;: &quot;5px&quot;,&quot;pie1&quot;: &quot;#ff9999&quot;,&quot;pie2&quot;: &quot;#99ccff&quot;,&quot;pie3&quot;: &quot;#99ff99&quot;&#125;&#125; &#125;%%</span><br><span class=\"line\">title Expenses</span><br><span class=\"line\">&quot;Rent&quot; : 200</span><br><span class=\"line\">&quot;Food&quot; : 200</span><br><span class=\"line\">&quot;Transport&quot; : 400</span><br><span class=\"line\">&#123;% endmermaid %&#125;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ•ˆæœ</p>\n</li>\n</ul>\n<pre><code class=\"highlight mermaid\">%%&#123;init: &#123;&quot;pie&quot;: &#123;&quot;textPosition&quot;: 0.4&#125;, &quot;themeVariables&quot;: &#123;&quot;pieOuterStrokeWidth&quot;: &quot;5px&quot;,&quot;pie1&quot;: &quot;#ff9999&quot;,&quot;pie2&quot;: &quot;#99ccff&quot;,&quot;pie3&quot;: &quot;#99ff99&quot;&#125;&#125; &#125;%%\npie showData\ntitle Expenses\n&quot;Rent&quot; : 200\n&quot;Food&quot; : 200\n&quot;Transport&quot; : 400</code></pre>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¯´æ˜</p>\n</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">åŸºæœ¬ç»“æ„</span><br><span class=\"line\">%%&#123;init: ...&#125;%%ï¼š</span><br><span class=\"line\">    Mermaid.js çš„åˆå§‹åŒ–é…ç½®ï¼Œç”¨äºå…¨å±€è®¾ç½®å›¾è¡¨å±æ€§å’Œæ ·å¼ã€‚</span><br><span class=\"line\">    pie å±æ€§</span><br><span class=\"line\">        textPosition: è®¾ç½®é¥¼å›¾æ•°æ®æ ‡ç­¾çš„ç›¸å¯¹ä½ç½®ã€‚</span><br><span class=\"line\">            å€¼èŒƒå›´ä¸º 0 åˆ° 1ï¼Œè¡¨ç¤ºæ ‡ç­¾è·ç¦»é¥¼å›¾ä¸­å¿ƒçš„æ¯”ä¾‹ã€‚0.4 è¡¨ç¤ºæ ‡ç­¾è·ç¦»ä¸­å¿ƒè¾ƒè¿‘ï¼Œæ¥è¿‘ 40% çš„åŠå¾„ä½ç½®ã€‚</span><br><span class=\"line\">    themeVariables</span><br><span class=\"line\">        pieOuterStrokeWidth: è®¾ç½®é¥¼å›¾å¤–ç¯çš„å®½åº¦ã€‚è®¾ç½®ä¸º 5pxï¼Œè¡¨ç¤ºé¥¼å›¾æœ‰æ˜æ˜¾çš„å¤–è¾¹æ¡†ã€‚</span><br><span class=\"line\">        &quot;pie1&quot;: &quot;#ff9999&quot;,&quot;pie2&quot;: &quot;#99ccff&quot;,&quot;pie3&quot;: &quot;#99ff99&quot;: é…ç½®æ¯ä¸ªåˆ†åŒºçš„é¢œè‰²ã€‚</span><br><span class=\"line\">pie</span><br><span class=\"line\">    å®šä¹‰è¿™æ˜¯ä¸€ä¸ªé¥¼å›¾ã€‚</span><br><span class=\"line\">showData</span><br><span class=\"line\">    æ˜¾ç¤ºæ•°æ®é¡¹çš„æ•°å€¼ã€‚</span><br><span class=\"line\">title Expenses</span><br><span class=\"line\">    è®¾ç½®é¥¼å›¾çš„æ ‡é¢˜ä¸º Expensesï¼ˆè´¹ç”¨ï¼‰ã€‚</span><br><span class=\"line\">æ•°æ®é¡¹</span><br><span class=\"line\">    æ•°æ®é¡¹å®šä¹‰äº†é¥¼å›¾çš„å„ä¸ªéƒ¨åˆ†ï¼š</span><br><span class=\"line\">        &quot;Rent&quot; : 200ï¼Œå æ¯”ï¼š200 / (200 + 200 + 400) = 1/4 = 25%ã€‚</span><br><span class=\"line\">        &quot;Food&quot; : 200ï¼Œå æ¯”ï¼š200 / (200 + 200 + 400) = 1/4 = 25%ã€‚</span><br><span class=\"line\">        &quot;Transport&quot; : 400ï¼Œå æ¯”ï¼š400 / (200 + 200 + 400) = 1/2 = 50%ã€‚</span><br><span class=\"line\">    æ¯ä¸ªæ•°æ®é¡¹åŒ…å«ï¼š</span><br><span class=\"line\">        æ ‡ç­¾ï¼šå¦‚ &quot;Rent&quot;ã€&quot;Food&quot;ã€&quot;Transport&quot;ã€‚</span><br><span class=\"line\">        æ•°å€¼ï¼šå¦‚ 200ã€400ï¼Œè¡¨ç¤ºè¯¥éƒ¨åˆ†çš„æƒé‡æˆ–æ•°å€¼å¤§å°ã€‚</span><br></pre></td></tr></table></figure>\n<h3 id=\"XY-Chart\">XY Chart</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç”¨äºç»˜åˆ¶ XY è½´å›¾(æŸ±çŠ¶å›¾å’ŒæŠ˜çº¿å›¾)ï¼Œæ˜¾ç¤ºæ•°æ®åˆ†å¸ƒå’Œè¶‹åŠ¿ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://mermaid.js.org/syntax/xyChart.html\">Mermaid XY Chart</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>type ä¸º <code>&quot;xychart-beta&quot;</code>ï¼Œç›®å‰ xychart-beta è¿˜å¤„åœ¨æ”¹è¿›é˜¶æ®µ</p>\n</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;% mermaid xychart-beta %&#125;</span><br><span class=\"line\">%%&#123;init: &#123;&quot;xyChart&quot;: &#123;&quot;width&quot;: 900,&quot;height&quot;:600&#125;, &quot;themeVariables&quot;: &#123;&quot;xyChart&quot;:&#123;&quot;titleColor&quot;: &quot;#ff0000&quot;&#125;&#125;&#125; &#125;%%</span><br><span class=\"line\">title &quot;Sales Revenue&quot;</span><br><span class=\"line\">x-axis [jan, feb, mar, apr, may, jun, jul, aug, sep, oct, nov, dec]</span><br><span class=\"line\">y-axis &quot;Revenue (in $)&quot; 4000 --&gt; 11000</span><br><span class=\"line\">bar [5000, 6000, 7500, 8200, 9500, 10500, 11000, 10200, 9200, 8500, 7000, 6000]</span><br><span class=\"line\">line [5000, 6000, 7500, 8200, 9500, 10500, 11000, 10200, 9200, 8500, 7000, 6000]</span><br><span class=\"line\">&#123;% endmermaid %&#125;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ•ˆæœ</p>\n</li>\n</ul>\n<pre><code class=\"highlight mermaid\">---\nconfig:\n    xyChart:\n        width: 900\n        height: 600\n    themeVariables:\n        xyChart:\n            titleColor: &quot;#ff0000&quot;\n---\nxychart-beta\ntitle &quot;Sales Revenue&quot;\nx-axis [jan, feb, mar, apr, may, jun, jul, aug, sep, oct, nov, dec]\ny-axis &quot;Revenue (in $)&quot; 4000 --&gt; 11000\nbar [5000, 6000, 7500, 8200, 9500, 10500, 11000, 10200, 9200, 8500, 7000, 6000]\nline [5000, 6000, 7500, 8200, 9500, 10500, 11000, 10200, 9200, 8500, 7000, 6000]</code></pre>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¯´æ˜</p>\n</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ä»£ç ç»“æ„è§£æ</span><br><span class=\"line\">%%&#123;init: ...&#125;%%ï¼š</span><br><span class=\"line\">    Mermaid.js çš„åˆå§‹åŒ–é…ç½®ï¼Œç”¨äºå…¨å±€è®¾ç½®å›¾è¡¨å±æ€§å’Œæ ·å¼ã€‚</span><br><span class=\"line\">    xyChart.width å’Œ xyChart.height : è®¾ç½®å›¾è¡¨çš„å®½åº¦å’Œé«˜åº¦ã€‚</span><br><span class=\"line\">    themeVariables.xyChart.titleColor: è®¾ç½®æ ‡é¢˜çš„é¢œè‰²ã€‚</span><br><span class=\"line\">title</span><br><span class=\"line\">    è®¾ç½®å›¾è¡¨çš„æ ‡é¢˜ã€‚</span><br><span class=\"line\">åæ ‡è½´å®šä¹‰</span><br><span class=\"line\">    x-axisï¼šXè½´æ ‡ç­¾ä¸ºæœˆä»½ï¼ˆä»1æœˆåˆ°12æœˆï¼‰ã€‚</span><br><span class=\"line\">    y-axisï¼šYè½´èŒƒå›´ä» $4000 åˆ° $11000ï¼Œå•ä½ä¸ºç¾å…ƒã€‚</span><br><span class=\"line\">æ•°æ®</span><br><span class=\"line\">    barï¼šæŸ±çŠ¶å›¾æ•°æ®ï¼Œè¡¨ç¤ºæ¯ä¸ªæœˆçš„é”€å”®æ”¶å…¥ã€‚</span><br><span class=\"line\">    lineï¼šæŠ˜çº¿å›¾æ•°æ®ï¼Œè¡¨ç¤ºæ¯ä¸ªæœˆçš„é”€é‡è¶‹åŠ¿ã€‚</span><br></pre></td></tr></table></figure>\n<h3 id=\"Journey-Diagram\">Journey Diagram</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç”¨äºç»˜åˆ¶æ—…ç¨‹å›¾ï¼Œæ˜¾ç¤ºç”¨æˆ·çš„ä½“éªŒæµç¨‹ï¼ŒåŒ…æ‹¬ç”¨æˆ·è¿›å…¥ç³»ç»Ÿã€æ“ä½œã€é€€å‡ºç³»ç»Ÿç­‰ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://mermaid.js.org/syntax/userJourney.html\">Mermaid Journey Diagram</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>type ä¸º <code>&quot;journey&quot;</code></p>\n</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;% mermaid journey %&#125;</span><br><span class=\"line\">title My working day</span><br><span class=\"line\">section Morning</span><br><span class=\"line\">  wake up : 5 : me</span><br><span class=\"line\">  go to work : 3 : me,you</span><br><span class=\"line\">section Lunch</span><br><span class=\"line\">  have lunch : 5 : me,you</span><br><span class=\"line\">  go to work : 1 : me,you</span><br><span class=\"line\">section Dinner</span><br><span class=\"line\">  finish your meal : 5 : me</span><br><span class=\"line\">section Go home</span><br><span class=\"line\">  go home : 5 : me</span><br><span class=\"line\">&#123;% endmermaid %&#125;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ•ˆæœ</p>\n</li>\n</ul>\n<pre><code class=\"highlight mermaid\">journey\ntitle My working day\nsection Morning\n  wake up : 5 : me\n  go to work : 3 : me,you\nsection Lunch\n  have lunch : 5 : me,you\n  go to work : 1 : me,you\nsection Dinner\n  finish your meal : 5 : me\nsection Go home\n  go home : 5 : me</code></pre>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¯´æ˜</p>\n</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">åŸºæœ¬ç»“æ„</span><br><span class=\"line\">journey</span><br><span class=\"line\">    å®šä¹‰è¿™æ˜¯ä¸€ä¸ªæ—…ç¨‹å›¾ã€‚</span><br><span class=\"line\">title My working day</span><br><span class=\"line\">    è®¾ç½®æ—…ç¨‹å›¾çš„æ ‡é¢˜ä¸º &quot;My working day&quot;ï¼ˆæˆ‘çš„å·¥ä½œæ—¥ï¼‰ã€‚</span><br><span class=\"line\">section</span><br><span class=\"line\">    å®šä¹‰æ—…ç¨‹å›¾çš„åˆ†æ®µï¼Œç”¨äºè¡¨ç¤ºä¸€å¤©ä¸­çš„ä¸åŒé˜¶æ®µï¼Œä¾‹å¦‚ï¼š</span><br><span class=\"line\">        Morningï¼ˆæ—©æ™¨ï¼‰ã€‚</span><br><span class=\"line\">        Lunchï¼ˆåˆé¤æ—¶é—´ï¼‰ã€‚</span><br><span class=\"line\">        Dinnerï¼ˆæ™šé¤ï¼‰ã€‚</span><br><span class=\"line\">        Go homeï¼ˆå›å®¶ï¼‰ã€‚</span><br><span class=\"line\">ä»»åŠ¡æ ¼å¼</span><br><span class=\"line\">    ä»»åŠ¡æè¿° : æ»¡æ„åº¦è¯„åˆ† : å‚ä¸è€…</span><br><span class=\"line\">        ä»»åŠ¡æè¿°ï¼šæè¿°å…·ä½“çš„ä»»åŠ¡æˆ–æ´»åŠ¨ã€‚</span><br><span class=\"line\">        æ»¡æ„åº¦è¯„åˆ†ï¼šä» 1 åˆ° 5ï¼Œè¡¨ç¤ºå¯¹ä»»åŠ¡æˆ–æ´»åŠ¨çš„æ»¡æ„ç¨‹åº¦ã€‚</span><br><span class=\"line\">        å‚ä¸è€…ï¼šå‚ä¸ä»»åŠ¡çš„äººï¼Œå¯ä»¥æ˜¯ meï¼ˆè‡ªå·±ï¼‰ã€youï¼ˆå…¶ä»–äººï¼‰æˆ–ä¸¤è€…ã€‚</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">ä»£ç é€æ­¥è§£æ</span><br><span class=\"line\">section Morning</span><br><span class=\"line\">    wake up : 5 : me</span><br><span class=\"line\">        æ´»åŠ¨ï¼šwake upï¼ˆèµ·åºŠï¼‰ã€‚</span><br><span class=\"line\">        æ»¡æ„åº¦ï¼š5ï¼ˆéå¸¸æ»¡æ„ï¼‰ã€‚</span><br><span class=\"line\">        å‚ä¸è€…ï¼šmeï¼ˆè‡ªå·±ï¼‰ã€‚</span><br><span class=\"line\">    go to work : 3 : me,you</span><br><span class=\"line\">        æ´»åŠ¨ï¼šgo to workï¼ˆå»å·¥ä½œï¼‰ã€‚</span><br><span class=\"line\">        æ»¡æ„åº¦ï¼š3ï¼ˆä¸­ç­‰æ»¡æ„ï¼‰ã€‚</span><br><span class=\"line\">        å‚ä¸è€…ï¼šme å’Œ youï¼ˆè‡ªå·±å’Œå…¶ä»–äººï¼‰ã€‚</span><br><span class=\"line\">section Lunch</span><br><span class=\"line\">    have lunch : 5 : me,you</span><br><span class=\"line\">        æ´»åŠ¨ï¼šhave lunchï¼ˆåƒåˆé¥­ï¼‰ã€‚</span><br><span class=\"line\">        æ»¡æ„åº¦ï¼š5ï¼ˆéå¸¸æ»¡æ„ï¼‰ã€‚</span><br><span class=\"line\">        å‚ä¸è€…ï¼šme å’Œ youï¼ˆè‡ªå·±å’Œå…¶ä»–äººï¼‰ã€‚</span><br><span class=\"line\">    go to work : 1 : me,you</span><br><span class=\"line\">        æ´»åŠ¨ï¼šgo to workï¼ˆåƒå®Œé¥­ç»§ç»­å·¥ä½œï¼‰ã€‚</span><br><span class=\"line\">        æ»¡æ„åº¦ï¼š1ï¼ˆéå¸¸ä¸æ»¡æ„ï¼‰ã€‚</span><br><span class=\"line\">        å‚ä¸è€…ï¼šme å’Œ youã€‚</span><br><span class=\"line\">section Dinner</span><br><span class=\"line\">    finish your meal : 5 : me</span><br><span class=\"line\">        æ´»åŠ¨ï¼šfinish your mealï¼ˆåƒå®Œé¥­ï¼‰ã€‚</span><br><span class=\"line\">        æ»¡æ„åº¦ï¼š5ï¼ˆéå¸¸æ»¡æ„ï¼‰ã€‚</span><br><span class=\"line\">        å‚ä¸è€…ï¼šmeï¼ˆè‡ªå·±ï¼‰ã€‚</span><br><span class=\"line\">section Go home</span><br><span class=\"line\">    go home : 5 : me</span><br><span class=\"line\">        æ´»åŠ¨ï¼šgo homeï¼ˆå›å®¶ï¼‰ã€‚</span><br><span class=\"line\">        æ»¡æ„åº¦ï¼š5ï¼ˆéå¸¸æ»¡æ„ï¼‰ã€‚</span><br><span class=\"line\">        å‚ä¸è€…ï¼šmeï¼ˆè‡ªå·±ï¼‰ã€‚</span><br></pre></td></tr></table></figure>\n<h3 id=\"Requirement-Diagram\">Requirement Diagram</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç”¨äºç»˜åˆ¶éœ€æ±‚å›¾ï¼Œæ˜¾ç¤ºç³»ç»Ÿçš„åŠŸèƒ½éœ€æ±‚å’Œä¾èµ–å…³ç³»ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://mermaid.js.org/syntax/requirementDiagram.html\">Mermaid Requirement Diagram</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>type ä¸º <code>&quot;requirementDiagram&quot;</code></p>\n</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;% mermaid requirementDiagram %&#125;</span><br><span class=\"line\">requirement &quot;æµ‹è¯•éœ€æ±‚&quot; &#123;</span><br><span class=\"line\">    id: 1</span><br><span class=\"line\">    text: &quot;æµ‹è¯•æ–‡æœ¬&quot;</span><br><span class=\"line\">    risk: High</span><br><span class=\"line\">    verifymethod: test</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">requirement &quot;æµ‹è¯•éœ€æ±‚2&quot; &#123;</span><br><span class=\"line\">    id: 2</span><br><span class=\"line\">    text: &quot;æµ‹è¯•æ–‡æœ¬&quot;</span><br><span class=\"line\">    risk: High</span><br><span class=\"line\">    verifymethod: test</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">element &quot;æµ‹è¯•å®ä½“&quot; &#123;</span><br><span class=\"line\">    type: &quot;æ¨¡æ‹Ÿ&quot;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">&quot;æµ‹è¯•å®ä½“&quot; - satisfies -&gt; &quot;æµ‹è¯•éœ€æ±‚&quot;</span><br><span class=\"line\">&quot;æµ‹è¯•å®ä½“&quot; - satisfies -&gt; &quot;æµ‹è¯•éœ€æ±‚2&quot;</span><br><span class=\"line\">&#123;% endmermaid %&#125;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ•ˆæœ</p>\n</li>\n</ul>\n<pre><code class=\"highlight mermaid\">requirementDiagram\nrequirement &quot;æµ‹è¯•éœ€æ±‚&quot; &#123;\n    id: 1\n    text: &quot;æµ‹è¯•æ–‡æœ¬&quot;\n    risk: High\n    verifymethod: test\n&#125;\nrequirement &quot;æµ‹è¯•éœ€æ±‚2&quot; &#123;\n    id: 2\n    text: &quot;æµ‹è¯•æ–‡æœ¬&quot;\n    risk: High\n    verifymethod: test\n&#125;\nelement &quot;æµ‹è¯•å®ä½“&quot; &#123;\n    type: &quot;æ¨¡æ‹Ÿ&quot;\n&#125;\n&quot;æµ‹è¯•å®ä½“&quot; - satisfies -&gt; &quot;æµ‹è¯•éœ€æ±‚&quot;\n&quot;æµ‹è¯•å®ä½“&quot; - satisfies -&gt; &quot;æµ‹è¯•éœ€æ±‚2&quot;</code></pre>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¯´æ˜</p>\n</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">åŸºæœ¬ç»“æ„</span><br><span class=\"line\">requirementDiagram</span><br><span class=\"line\">    å®šä¹‰è¿™æ˜¯ä¸€ä¸ªéœ€æ±‚å›¾ã€‚</span><br><span class=\"line\">requirement</span><br><span class=\"line\">    å®šä¹‰ä¸€ä¸ªéœ€æ±‚èŠ‚ç‚¹ï¼ŒåŒ…å«éœ€æ±‚çš„è¯¦ç»†å±æ€§ï¼Œå¦‚ï¼š</span><br><span class=\"line\">        idï¼šéœ€æ±‚ç¼–å·ã€‚</span><br><span class=\"line\">        textï¼šéœ€æ±‚çš„æè¿°ã€‚</span><br><span class=\"line\">        riskï¼šéœ€æ±‚çš„é£é™©çº§åˆ«ï¼ˆå¦‚ High è¡¨ç¤ºé«˜é£é™©ï¼‰ã€‚</span><br><span class=\"line\">        verifymethodï¼šéªŒè¯éœ€æ±‚çš„æ–¹æ³•ï¼ˆå¦‚ test è¡¨ç¤ºé€šè¿‡æµ‹è¯•éªŒè¯ï¼‰ã€‚</span><br><span class=\"line\">element</span><br><span class=\"line\">    å®šä¹‰ä¸€ä¸ªå…ƒç´ ï¼Œç”¨äºè¡¨ç¤ºç³»ç»Ÿä¸­çš„æŸä¸ªå®ä½“æˆ–å¯¹è±¡ã€‚</span><br><span class=\"line\">    åŒ…å«å±æ€§ï¼Œå¦‚ï¼š</span><br><span class=\"line\">        typeï¼šå®ä½“çš„ç±»å‹ï¼ˆå¦‚ æ¨¡æ‹Ÿ è¡¨ç¤ºæ¨¡æ‹Ÿå®ä½“ï¼‰ã€‚</span><br><span class=\"line\">å…³ç³»å®šä¹‰</span><br><span class=\"line\">    å®šä¹‰äº†ä¸¤ä¸ªå…³ç³»ï¼š</span><br><span class=\"line\">        &quot;æµ‹è¯•å®ä½“&quot; - satisfies -&gt; &quot;æµ‹è¯•éœ€æ±‚&quot;  : æµ‹è¯•å®ä½“ æ»¡è¶³äº† æµ‹è¯•éœ€æ±‚</span><br><span class=\"line\">        &quot;æµ‹è¯•å®ä½“&quot; - satisfies -&gt; &quot;æµ‹è¯•éœ€æ±‚2&quot; : æµ‹è¯•å®ä½“ æ»¡è¶³äº† æµ‹è¯•éœ€æ±‚2</span><br><span class=\"line\">    - satisfies -&gt;ï¼šsatisfies è¡¨ç¤ºæ»¡è¶³å…³ç³»ï¼Œç®­å¤´æ–¹å‘ä»å®ä½“æŒ‡å‘éœ€æ±‚</span><br><span class=\"line\"></span><br><span class=\"line\">ä»£ç é€æ­¥è§£æ</span><br><span class=\"line\">éœ€æ±‚å®šä¹‰</span><br><span class=\"line\">    requirement &quot;æµ‹è¯•éœ€æ±‚&quot;</span><br><span class=\"line\">        å®šä¹‰ç¬¬ä¸€ä¸ªéœ€æ±‚ï¼Œæ˜¾ç¤ºåç§°ä¸º æµ‹è¯•éœ€æ±‚ã€‚</span><br><span class=\"line\">        å±æ€§ï¼š</span><br><span class=\"line\">            id: 1ï¼ˆéœ€æ±‚ç¼–å·ä¸º 1ï¼‰ã€‚</span><br><span class=\"line\">            text: &quot;æµ‹è¯•æ–‡æœ¬&quot;ï¼ˆæè¿°æ–‡æœ¬ä¸º &quot;æµ‹è¯•æ–‡æœ¬&quot;ï¼‰ã€‚</span><br><span class=\"line\">            risk: Highï¼ˆé«˜é£é™©éœ€æ±‚ï¼‰ã€‚</span><br><span class=\"line\">            verifymethod: testï¼ˆéªŒè¯æ–¹æ³•ä¸ºæµ‹è¯•ï¼‰ã€‚</span><br><span class=\"line\">    requirement &quot;æµ‹è¯•éœ€æ±‚2&quot;</span><br><span class=\"line\">        å®šä¹‰ç¬¬äºŒä¸ªéœ€æ±‚ï¼Œæ˜¾ç¤ºåç§°ä¸º æµ‹è¯•éœ€æ±‚2ã€‚</span><br><span class=\"line\">        å±æ€§ï¼š</span><br><span class=\"line\">            id: 2ï¼ˆéœ€æ±‚ç¼–å·ä¸º 2ï¼‰ã€‚</span><br><span class=\"line\">            text: &quot;æµ‹è¯•æ–‡æœ¬&quot;ï¼ˆæè¿°æ–‡æœ¬ä¸ç¬¬ä¸€ä¸ªéœ€æ±‚ç›¸åŒï¼‰ã€‚</span><br><span class=\"line\">            risk: Highï¼ˆé«˜é£é™©éœ€æ±‚ï¼‰ã€‚</span><br><span class=\"line\">            verifymethod: testï¼ˆéªŒè¯æ–¹æ³•ä¸ºæµ‹è¯•ï¼‰ã€‚</span><br><span class=\"line\">å®ä½“å®šä¹‰</span><br><span class=\"line\">    element &quot;æµ‹è¯•å®ä½“&quot;</span><br><span class=\"line\">        å®šä¹‰ä¸€ä¸ªç³»ç»Ÿå®ä½“ï¼Œæ˜¾ç¤ºåç§°ä¸º æµ‹è¯•å®ä½“ã€‚</span><br><span class=\"line\">        å±æ€§ï¼š</span><br><span class=\"line\">            type: &quot;æ¨¡æ‹Ÿ&quot;ï¼ˆå®ä½“ç±»å‹ä¸º &quot;æ¨¡æ‹Ÿ&quot;ï¼‰ã€‚</span><br></pre></td></tr></table></figure>\n<h3 id=\"Gitgraph-Diagram\">Gitgraph Diagram</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç”¨äºç»˜åˆ¶Gitå›¾ï¼Œæ˜¾ç¤ºä»£ç ä»“åº“çš„æäº¤å†å²å’Œåˆ†æ”¯å…³ç³»ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://mermaid.js.org/syntax/gitgraph.html\">Mermaid Gitgraph Diagram</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>type ä¸º <code>&quot;gitgraph&quot;</code></p>\n</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;% mermaid gitGraph %&#125;</span><br><span class=\"line\">commit</span><br><span class=\"line\">commit</span><br><span class=\"line\">commit</span><br><span class=\"line\">branch newbranch</span><br><span class=\"line\">checkout newbranch</span><br><span class=\"line\">commit</span><br><span class=\"line\">commit</span><br><span class=\"line\">checkout main</span><br><span class=\"line\">merge newbranch</span><br><span class=\"line\">&#123;% endmermaid %&#125;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ•ˆæœ</p>\n</li>\n</ul>\n<pre><code class=\"highlight mermaid\">gitGraph\ncommit\ncommit\ncommit\nbranch newbranch\ncheckout newbranch\ncommit\ncommit\ncheckout main\nmerge newbranch</code></pre>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¯´æ˜</p>\n</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">åŸºæœ¬ç»“æ„</span><br><span class=\"line\">gitGraph</span><br><span class=\"line\">    å®šä¹‰è¿™æ˜¯ä¸€ä¸ª Git å›¾ã€‚</span><br><span class=\"line\">commit</span><br><span class=\"line\">    è¡¨ç¤ºä¸€æ¬¡æäº¤æ“ä½œï¼Œæ¯ä¸ª commit èŠ‚ç‚¹ä»£è¡¨ä»£ç ä»“åº“çš„æŸä¸ªæäº¤ç‚¹ã€‚</span><br><span class=\"line\">branch</span><br><span class=\"line\">    åˆ›å»ºä¸€ä¸ªæ–°åˆ†æ”¯ã€‚</span><br><span class=\"line\">    æ ¼å¼ï¼šbranch åˆ†æ”¯åç§°ã€‚</span><br><span class=\"line\">checkout</span><br><span class=\"line\">    åˆ‡æ¢åˆ°æŒ‡å®šåˆ†æ”¯ã€‚</span><br><span class=\"line\">    æ ¼å¼ï¼šcheckout åˆ†æ”¯åç§°ã€‚</span><br><span class=\"line\">merge</span><br><span class=\"line\">    å°†æŒ‡å®šåˆ†æ”¯åˆå¹¶åˆ°å½“å‰åˆ†æ”¯ã€‚</span><br><span class=\"line\">    æ ¼å¼ï¼šmerge åˆ†æ”¯åç§°ã€‚</span><br></pre></td></tr></table></figure>\n<h3 id=\"Mindmap\">Mindmap</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç”¨äºç»˜åˆ¶æ€ç»´å¯¼å›¾ï¼Œæ˜¾ç¤ºä¸»é¢˜å’Œå­ä¸»é¢˜ä¹‹é—´çš„ hierarchical å…³ç³»ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://mermaid.js.org/syntax/mindmap.html\">Mermaid Mindmap</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>type ä¸º <code>&quot;mindmap&quot;</code></p>\n</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;% mermaid mindmap %&#125;</span><br><span class=\"line\">root((mindmap))</span><br><span class=\"line\">    (origins)</span><br><span class=\"line\">        Long history</span><br><span class=\"line\">        ::icon(fa fa-book)</span><br><span class=\"line\">        Popularisation</span><br><span class=\"line\">            British popular psychology author Tony Buzan</span><br><span class=\"line\">    [Research]</span><br><span class=\"line\">        On effectivness&lt;br/&gt;and features</span><br><span class=\"line\">        On Automatic creation</span><br><span class=\"line\">            Uses</span><br><span class=\"line\">                Creative techniques</span><br><span class=\"line\">                Strategic planning</span><br><span class=\"line\">                Argument mapping</span><br><span class=\"line\">    Tools</span><br><span class=\"line\">        Pen and paper</span><br><span class=\"line\">        Mermaid</span><br><span class=\"line\">&#123;% endmermaid %&#125;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ•ˆæœ</p>\n</li>\n</ul>\n<pre><code class=\"highlight mermaid\">mindmap\nroot((mindmap))\n    (origins)\n        Long history\n        ::icon(fa fa-book)\n        Popularisation\n            British popular psychology author Tony Buzan\n    [Research]\n        On effectivness&lt;br/&gt;and features\n        On Automatic creation\n            Uses\n                Creative techniques\n                Strategic planning\n                Argument mapping\n    Tools\n        Pen and paper\n        Mermaid</code></pre>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¯´æ˜</p>\n</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">åŸºæœ¬ç»“æ„</span><br><span class=\"line\">mindmap</span><br><span class=\"line\">    å®šä¹‰è¿™æ˜¯ä¸€ä¸ªæ€ç»´å¯¼å›¾ã€‚</span><br><span class=\"line\">root((mindmap))</span><br><span class=\"line\">    å®šä¹‰æ€ç»´å¯¼å›¾çš„æ ¹èŠ‚ç‚¹ï¼Œæ˜¾ç¤ºä¸ºåœ†å½¢å¹¶æ ‡æ³¨ä¸º &quot;mindmap&quot;ã€‚</span><br><span class=\"line\">å­èŠ‚ç‚¹ä½¿ç”¨ç¼©è¿›è¡¨ç¤ºä»å±å…³ç³»ï¼š</span><br><span class=\"line\">    æ¯ä¸€çº§ç¼©è¿›ä»£è¡¨ä¸€ä¸ªå±‚çº§çš„å­èŠ‚ç‚¹ã€‚</span><br><span class=\"line\">    å­èŠ‚ç‚¹å¯ä»¥ç›´æ¥æ·»åŠ å†…å®¹æˆ–é€šè¿‡ &lt;br/&gt; æ¢è¡Œã€‚</span><br><span class=\"line\">::icon(...)</span><br><span class=\"line\">    ä¸ºèŠ‚ç‚¹æ·»åŠ å›¾æ ‡ã€‚Mermaid.js æ”¯æŒä½¿ç”¨ FontAwesome çš„å›¾æ ‡ã€‚</span><br><span class=\"line\"></span><br><span class=\"line\">èŠ‚ç‚¹å½¢çŠ¶</span><br><span class=\"line\">é•¿æ–¹å½¢ [] ï¼šå¦‚ [é•¿æ–¹å½¢]ï¼Œæ˜¯é»˜è®¤çš„çŸ©å½¢èŠ‚ç‚¹ã€‚è¿™ä¸ªæ˜¯é»˜è®¤çš„èŠ‚ç‚¹ç±»å‹ã€‚</span><br><span class=\"line\">åœ†å½¢ (()) ï¼šå¦‚ ((åœ†))ï¼Œç”¨äºè¡¨ç¤ºä¸€ä¸ªåœ†å½¢èŠ‚ç‚¹ã€‚</span><br><span class=\"line\">åœ†è§’é•¿æ–¹å½¢ () ï¼šå¦‚ (åœ†è§’é•¿æ–¹å½¢)ï¼Œç”¨äºè¡¨ç¤ºåœ†è§’çŸ©å½¢èŠ‚ç‚¹ã€‚</span><br></pre></td></tr></table></figure>\n<h3 id=\"QuadrantChart\">QuadrantChart</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç”¨äºç»˜åˆ¶è±¡é™å›¾ï¼Œæ˜¾ç¤ºä¸åŒç»´åº¦ä¹‹é—´çš„æ¯”è¾ƒå…³ç³»ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://mermaid.js.org/syntax/quadrantChart.html\">Mermaid QuadrantChart</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>type ä¸º <code>&quot;quadrantChart&quot;</code></p>\n</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;% mermaid quadrantChart %&#125;</span><br><span class=\"line\">%%&#123;init: &#123;&quot;quadrantChart&quot;: &#123;&quot;chartHeight&quot;: 600, &quot;chartWidth&quot;: 800, &quot;pointTextPadding&quot;: 10&#125;, &quot;themeVariables&quot;: &#123;&quot;quadrant1Fill&quot;: &quot;#ff0000&quot;, &quot;quadrant2Fill&quot;: &quot;#FFFF00&quot;, &quot;quadrant3Fill&quot;: &quot;#32CD32&quot;, &quot;quadrant4Fill&quot;: &quot;#800080&quot;&#125;&#125;&#125;%%</span><br><span class=\"line\">title Reach and engagement of carpaigns</span><br><span class=\"line\">x-axis Low Reach --&gt; High Reach</span><br><span class=\"line\">y-axis Low Engagement --&gt; High Engagement</span><br><span class=\"line\">quadrant-1 we should expand</span><br><span class=\"line\">quadrant-2 Need to promote</span><br><span class=\"line\">quadrant-3 Re-evaluate</span><br><span class=\"line\">quadrant-4 May be improved</span><br><span class=\"line\">Campaign A: [0.3,0.6]</span><br><span class=\"line\">Campaign B: [0.45,0.23]</span><br><span class=\"line\">Campaign C: [0.57,0.69]</span><br><span class=\"line\">Campaign D: [0.78,0.34]</span><br><span class=\"line\">Campaign E: [0.40,0.34]</span><br><span class=\"line\">Campaign F: [0.35,0.78]</span><br><span class=\"line\">&#123;% endmermaid %&#125;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ•ˆæœ</p>\n</li>\n</ul>\n<pre><code class=\"highlight mermaid\">%%&#123;init: &#123;&quot;quadrantChart&quot;: &#123;&quot;chartHeight&quot;: 600, &quot;chartWidth&quot;: 800, &quot;pointTextPadding&quot;: 10&#125;, &quot;themeVariables&quot;: &#123;&quot;quadrant1Fill&quot;: &quot;#ff0000&quot;, &quot;quadrant2Fill&quot;: &quot;#FFFF00&quot;, &quot;quadrant3Fill&quot;: &quot;#32CD32&quot;, &quot;quadrant4Fill&quot;: &quot;#800080&quot;&#125;&#125;&#125;%%\nquadrantChart\ntitle Reach and engagement of carpaigns\nx-axis Low Reach --&gt; High Reach\ny-axis Low Engagement --&gt; High Engagement\nquadrant-1 we should expand\nquadrant-2 Need to promote\nquadrant-3 Re-evaluate\nquadrant-4 May be improved\nCampaign A: [0.3,0.6]\nCampaign B: [0.45,0.23]\nCampaign C: [0.57,0.69]\nCampaign D: [0.78,0.34]\nCampaign E: [0.40,0.34]\nCampaign F: [0.35,0.78]</code></pre>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¯´æ˜</p>\n</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">åŸºæœ¬ç»“æ„</span><br><span class=\"line\">%%&#123;init: ...&#125;%%</span><br><span class=\"line\">    è¿™æ˜¯ Mermaid.js çš„åˆå§‹åŒ–é…ç½®å—ï¼Œç”¨äºè‡ªå®šä¹‰å›¾è¡¨çš„å…¨å±€å‚æ•°å’Œæ ·å¼ã€‚</span><br><span class=\"line\">    é…ç½®å†…å®¹ï¼Œè¯¦è§ä¸‹æ–‡ï¼š</span><br><span class=\"line\">        quadrantChartï¼šè‡ªå®šä¹‰è±¡é™å›¾çš„ç›¸å…³å‚æ•°ã€‚</span><br><span class=\"line\">        themeVariablesï¼š å›¾è¡¨ä¸»é¢˜é…è‰²ã€‚</span><br><span class=\"line\">quadrantChart</span><br><span class=\"line\">    å®šä¹‰è¿™æ˜¯ä¸€ä¸ªè±¡é™å›¾ã€‚</span><br><span class=\"line\">title</span><br><span class=\"line\">    æ ‡é¢˜</span><br><span class=\"line\"></span><br><span class=\"line\">åæ ‡è½´ï¼Œå®šä¹‰ X è½´å’Œ Y è½´çš„èŒƒå›´å’Œæ–¹å‘ï¼š</span><br><span class=\"line\">x-axis Low Reach --&gt; High Reach</span><br><span class=\"line\">    X è½´ ä» â€œLow Reachâ€ åˆ° â€œHigh Reachâ€ã€‚</span><br><span class=\"line\">y-axis Low Engagement --&gt; High Engagement</span><br><span class=\"line\">    Y è½´ ä» â€œLow Engagementâ€ åˆ° â€œHigh Engagementâ€ã€‚</span><br><span class=\"line\"></span><br><span class=\"line\">è±¡é™å®šä¹‰</span><br><span class=\"line\">quadrant-1 we should expand</span><br><span class=\"line\">    è±¡é™ 1ï¼ˆå³ä¸Šï¼‰ï¼š&quot;we should expand&quot;</span><br><span class=\"line\">quadrant-2 Need to promote</span><br><span class=\"line\">    è±¡é™ 2ï¼ˆå·¦ä¸Šï¼‰ï¼š&quot;Need to promote&quot;</span><br><span class=\"line\">quadrant-3 Re-evaluate</span><br><span class=\"line\">    è±¡é™ 3ï¼ˆå·¦ä¸‹ï¼‰ï¼š&quot;Re-evaluate&quot;</span><br><span class=\"line\">quadrant-4 May be improved</span><br><span class=\"line\">    è±¡é™ 4ï¼ˆå³ä¸‹ï¼‰ï¼š&quot;May be improved&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">æ•°æ®ç‚¹</span><br><span class=\"line\">Campaign A: [0.3,0.6]</span><br><span class=\"line\">Campaign B: [0.45,0.23]</span><br><span class=\"line\">Campaign C: [0.57,0.69]</span><br><span class=\"line\">Campaign D: [0.78,0.34]</span><br><span class=\"line\">Campaign E: [0.40,0.34]</span><br><span class=\"line\">Campaign F: [0.35,0.78]</span><br><span class=\"line\">å®šä¹‰äº† 6 ä¸ªæ´»åŠ¨ï¼ˆCampaignï¼‰çš„æ•°æ®ç‚¹ï¼Œä½¿ç”¨ [name]: [x, y] çš„æ ¼å¼æ¥æ·»åŠ æ•°æ®ç‚¹ï¼Œå…¶ä¸­ [name] æ˜¯æ•°æ®ç‚¹çš„åç§°ï¼Œ[x, y] æ˜¯æ•°æ®ç‚¹åœ¨ x è½´å’Œ y è½´ä¸Šçš„åæ ‡å€¼ï¼Œå¯¹äºç‚¹xå’Œyå€¼ï¼Œæœ€å°å€¼ä¸º0ï¼Œæœ€å¤§å€¼ä¸º1ã€‚</span><br><span class=\"line\">X å€¼ï¼šè¡¨ç¤ºæ´»åŠ¨çš„ Reachï¼ˆè¦†ç›–é¢ï¼‰ã€‚</span><br><span class=\"line\">Y å€¼ï¼šè¡¨ç¤ºæ´»åŠ¨çš„ Engagementï¼ˆå‚ä¸åº¦ï¼‰ã€‚</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆå§‹åŒ–é…ç½®</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-6\">quadrantChartï¼šè‡ªå®šä¹‰è±¡é™å›¾çš„ç›¸å…³å‚æ•°</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>å‚æ•°</th>\n<th>æè¿°</th>\n<th>é»˜è®¤å€¼</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>chartHeight</td>\n<td>å›¾è¡¨çš„é«˜åº¦</td>\n<td>500</td>\n</tr>\n<tr>\n<td>chartWidth</td>\n<td>å›¾è¡¨çš„å®½åº¦</td>\n<td>500</td>\n</tr>\n<tr>\n<td>pointLabelFontSize</td>\n<td>ç‚¹æ–‡æœ¬å­—ä½“å¤§å°</td>\n<td>12</td>\n</tr>\n<tr>\n<td>pointRadius</td>\n<td>è¦ç»˜åˆ¶çš„ç‚¹çš„åŠå¾„</td>\n<td>5</td>\n</tr>\n<tr>\n<td>pointTextPadding</td>\n<td>ç‚¹å’Œä¸‹é¢æ–‡æœ¬ä¹‹é—´çš„å¡«å……</td>\n<td>5</td>\n</tr>\n<tr>\n<td>quadrantExternalBorderStrokeWidth</td>\n<td>è±¡é™å¤–è¾¹æ¡†æè¾¹å®½åº¦</td>\n<td>2</td>\n</tr>\n<tr>\n<td>quadrantInternalBorderStrokeWidth</td>\n<td>è±¡é™å†…çš„è¾¹æ¡†æè¾¹å®½åº¦</td>\n<td>1</td>\n</tr>\n<tr>\n<td>quadrantLabelFontSize</td>\n<td>è±¡é™æ–‡æœ¬å­—ä½“å¤§å°</td>\n<td>16</td>\n</tr>\n<tr>\n<td>quadrantPadding</td>\n<td>æ‰€æœ‰è±¡é™å¤–çš„å¡«å……</td>\n<td>5</td>\n</tr>\n<tr>\n<td>quadrantTextTopPadding</td>\n<td>å½“æ–‡æœ¬ç»˜åˆ¶åœ¨é¡¶éƒ¨æ—¶è±¡é™æ–‡æœ¬é¡¶éƒ¨å¡«å……ï¼ˆé‚£é‡Œæ²¡æœ‰æ•°æ®ç‚¹ï¼‰</td>\n<td>5</td>\n</tr>\n<tr>\n<td>titlePadding</td>\n<td>æ ‡é¢˜çš„é¡¶éƒ¨å’Œåº•éƒ¨å¡«å……</td>\n<td>10</td>\n</tr>\n<tr>\n<td>titleFontSize</td>\n<td>æ ‡é¢˜å­—ä½“å¤§å°</td>\n<td>20</td>\n</tr>\n<tr>\n<td>xAxisLabelPadding</td>\n<td>x è½´æ–‡æœ¬çš„é¡¶éƒ¨å’Œåº•éƒ¨å¡«å……</td>\n<td>5</td>\n</tr>\n<tr>\n<td>xAxisLabelFontSize</td>\n<td>X è½´æ–‡æœ¬å­—ä½“å¤§å°</td>\n<td>16</td>\n</tr>\n<tr>\n<td>xAxisPosition</td>\n<td>x è½´çš„ä½ç½®ï¼ˆé¡¶éƒ¨ã€åº•éƒ¨ï¼‰å¦‚æœæœ‰ç‚¹ï¼Œåˆ™ x è½´å°†å§‹ç»ˆæ¸²æŸ“åœ¨åº•éƒ¨</td>\n<td>â€˜topâ€™</td>\n</tr>\n<tr>\n<td>yAxisLabelPadding</td>\n<td>y è½´æ–‡æœ¬çš„å·¦å³å¡«å……</td>\n<td>5</td>\n</tr>\n<tr>\n<td>yAxisLabelFontSize</td>\n<td>Y è½´æ–‡æœ¬å­—ä½“å¤§å°</td>\n<td>16</td>\n</tr>\n<tr>\n<td>yAxisPosition</td>\n<td>y è½´ä½ç½®ï¼ˆå·¦ã€å³ï¼‰</td>\n<td>â€˜leftâ€™</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-2\">\n<li class=\"lvl-6\">\n<p>themeVariablesï¼š å›¾è¡¨ä¸»é¢˜é…è‰²</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>å‚æ•°</th>\n<th>æè¿°</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>quadrant1Fill</td>\n<td>å³ä¸Šè±¡é™çš„å¡«å……é¢œè‰²</td>\n</tr>\n<tr>\n<td>quadrant2Fill</td>\n<td>å·¦ä¸Šè±¡é™çš„å¡«å……é¢œè‰²</td>\n</tr>\n<tr>\n<td>quadrant3Fill</td>\n<td>å·¦ä¸‹è±¡é™çš„å¡«å……é¢œè‰²</td>\n</tr>\n<tr>\n<td>quadrant4Fill</td>\n<td>å³ä¸‹è±¡é™çš„å¡«å……é¢œè‰²</td>\n</tr>\n<tr>\n<td>quadrant1TextFill</td>\n<td>å³ä¸Šè±¡é™çš„æ–‡æœ¬é¢œè‰²</td>\n</tr>\n<tr>\n<td>quadrant2TextFill</td>\n<td>å·¦ä¸Šè±¡é™çš„æ–‡æœ¬é¢œè‰²</td>\n</tr>\n<tr>\n<td>quadrant3TextFill</td>\n<td>å·¦ä¸‹è±¡é™çš„æ–‡æœ¬é¢œè‰²</td>\n</tr>\n<tr>\n<td>quadrant4TextFill</td>\n<td>å³ä¸‹è±¡é™çš„æ–‡æœ¬é¢œè‰²</td>\n</tr>\n<tr>\n<td>quadrantPointFill</td>\n<td>ç‚¹å¡«å……é¢œè‰²</td>\n</tr>\n<tr>\n<td>quadrantPointTextFill</td>\n<td>ç‚¹æ–‡æœ¬é¢œè‰²</td>\n</tr>\n<tr>\n<td>quadrantXAxisTextFill</td>\n<td>X è½´æ–‡æœ¬é¢œè‰²</td>\n</tr>\n<tr>\n<td>quadrantYAxisTextFill</td>\n<td>Y è½´æ–‡æœ¬é¢œè‰²</td>\n</tr>\n<tr>\n<td>quadrantInternalBorderStrokeFill</td>\n<td>è±¡é™å†…è¾¹æ¡†é¢œè‰²</td>\n</tr>\n<tr>\n<td>quadrantExternalBorderStrokeFill</td>\n<td>è±¡é™å¤–è¾¹æ¡†é¢œè‰²</td>\n</tr>\n<tr>\n<td>quadrantTitleFill</td>\n<td>æ ‡é¢˜é¢œè‰²</td>\n</tr>\n</tbody>\n</table>\n</li>\n</ul>\n","content_text":"æ‘˜è¦ Mermaid æ˜¯ä¸€ä¸ªæ”¯æŒåœ¨Markdownæ–‡æ¡£ä¸­ç»˜åˆ¶æµç¨‹å›¾ã€ç”˜ç‰¹å›¾ã€åºåˆ—å›¾ç­‰å›¾å½¢çš„å·¥å…·ã€‚å®ƒåŸºäºJavaScriptå®ç°ï¼Œèƒ½å¤Ÿå°†Markdownä¸­çš„å…ƒç´ æ¸²æŸ“æˆHTMLå…ƒç´ ï¼Œä»è€Œåœ¨ç½‘é¡µä¸Šç›´è§‚åœ°å±•ç¤ºå„ç§å›¾è¡¨â€Œ Nextä¸»é¢˜ä¸­ä½¿ç”¨Mermaidè¯´æ˜ æœ¬æ–‡ä»‹ç»å¦‚ä½•åœ¨ Hexo-Next ä¸»é¢˜ä¸­ä½¿ç”¨ Mermaid é…ç½®å’Œä½¿ç”¨æ–¹æ³• NexT config file ä¸­æ‰¾åˆ°mermaidé…ç½®ï¼Œå¹¶è®¾ç½®ä¸ºtrueï¼Œtheme å¯ä»¥è®¾ç½®æµ…è‰²å’Œæ·±è‰²èƒŒæ™¯çš„æ ·å¼ï¼Œå…±æœ‰4ä¸ªå¯ç”¨é€‰é¡¹ 123456mermaid: enable: true # Available themes: default | dark | forest | neutral theme: light: dark dark: dark ä½¿ç”¨æ–¹æ³•ï¼Œå…¶ä¸­mermaidä¸endmermaidæ˜¯å›ºå®šæ­é…ï¼Œtype ç”¨äºè®¾ç½®å›¾å½¢çš„ç§ç±»ï¼Œå¦‚æµç¨‹å›¾ã€æ—¶åºå›¾ã€ç”˜ç‰¹å›¾ç­‰ï¼Œä¸‹é¢ç¤ºä¾‹ä¸­ä¼šä»‹ç» 12&#123;% mermaid type %&#125;&#123;% endmermaid %&#125; æœ‰äº›å°ä¼™ä¼´å–œæ¬¢ä½¿ç”¨ä»£ç å—çš„å½¢å¼ï¼Œä½¿ç”¨æ—¶å»æ‰å‰é¢çš„# 1234#```mermaidtype#``` ä½†æ˜¯æ­¤æ—¶éœ€è¦åœ¨ Hexo config file ä¸­æ‰¾åˆ°highlightï¼Œå¹¶æ·»åŠ å¦‚ä¸‹å†…å®¹ï¼Œæ‰ä¼šä½¿ä»£ç å—çš„å½¢å¼ç”Ÿæ•ˆ 123highlight: exclude_languages: - mermaid å›¾å½¢ç¤ºä¾‹ è¿™é‡Œåªä»‹ç»å¸¸ç”¨çš„ä¸€äº›å›¾è¡¨ï¼Œæ›´å¤šå›¾è¡¨çš„ä½¿ç”¨æ–¹æ³•å¯ä»¥å‚è€ƒMermaidå¸®åŠ©æ–‡æ¡£ Flowchart ç”¨äºç»˜åˆ¶æµç¨‹å›¾ï¼Œæ”¯æŒæ–¹å‘ï¼ˆä¾‹å¦‚ä»å·¦åˆ°å³ã€ä»ä¸Šåˆ°ä¸‹ï¼‰å’ŒèŠ‚ç‚¹é—´å…³ç³»çš„å®šä¹‰ã€‚ Mermaid Flowchart type ä¸º &quot;graph TD&quot;æˆ–è€…&quot;graph LR&quot;ï¼Œåˆ†åˆ«è¡¨ç¤ºä»ä¸Šåˆ°ä¸‹å’Œä»å·¦åˆ°å³çš„æ–¹å‘ 123456- æµç¨‹å›¾æ–¹å‘: - TB - ä»ä¸Šåˆ°ä¸‹ - TD - è‡ªä¸Šè€Œä¸‹ï¼Œç­‰åŒäºTB - BT - ä»ä¸‹åˆ°ä¸Š - RL - ä»å³åˆ°å·¦ - LR - ä»å·¦åˆ°å³ &quot;graph TD&quot;ï¼šä»ä¸Šåˆ°ä¸‹ 123456&#123;% mermaid graph TD %&#125;A[Hard] --&gt;|Text| B(Round)B --&gt; C&#123;Decision&#125;C --&gt;|One| D[Result 1]C --&gt;|Two| E[Result 2]&#123;% endmermaid %&#125; æ•ˆæœ graph TD A[Hard] --&gt;|Text| B(Round) B --&gt; C&#123;Decision&#125; C --&gt;|One| D[Result 1] C --&gt;|Two| E[Result 2] è¯´æ˜ 123456789101112131415graph TDï¼Œå®šä¹‰ä¸€ä¸ªä»ä¸Šåˆ°ä¸‹çš„æµç¨‹å›¾ã€‚TD æ˜¯ Top to Down çš„ç¼©å†™ï¼Œè¡¨ç¤ºæµç¨‹å›¾ä»ä¸Šå‘ä¸‹æ’åˆ—ã€‚A[Hard] --&gt;|Text| B(Round)ï¼Œå®šä¹‰äº†ä¸€ä¸ªèŠ‚ç‚¹ Aï¼Œæ˜¾ç¤ºä¸º Hardã€‚ä¸€ä¸ªå¸¦æ ‡ç­¾çš„ç®­å¤´ --&gt;|Text| æŒ‡å‘èŠ‚ç‚¹ Bï¼Œç®­å¤´ä¸Šçš„æ ‡ç­¾ä¸º Textã€‚èŠ‚ç‚¹ B è¢«å®šä¹‰ä¸º Roundï¼Œè¿™æ˜¯ä¸€ä¸ªæ¤­åœ†å½¢èŠ‚ç‚¹ã€‚B --&gt; C&#123;Decision&#125;ï¼ŒèŠ‚ç‚¹ B æŒ‡å‘èŠ‚ç‚¹ Cã€‚èŠ‚ç‚¹ C è¢«å®šä¹‰ä¸º Decisionï¼Œè¿™æ˜¯ä¸€ä¸ªå†³ç­–èŠ‚ç‚¹ï¼Œç”¨å¤§æ‹¬å· &#123;&#125; è¡¨ç¤ºã€‚C --&gt;|One| D[Result 1]ï¼Œå†³ç­–èŠ‚ç‚¹ C çš„ä¸€ä¸ªåˆ†æ”¯ï¼Œå¸¦æ ‡ç­¾ Oneï¼ŒæŒ‡å‘èŠ‚ç‚¹ Dã€‚èŠ‚ç‚¹ D æ˜¾ç¤ºä¸º Result 1ï¼Œè¿™æ˜¯ä¸€ä¸ªçŸ©å½¢èŠ‚ç‚¹ã€‚C --&gt;|Two| E[Result 2]ï¼Œå†³ç­–èŠ‚ç‚¹ C çš„å¦ä¸€ä¸ªåˆ†æ”¯ï¼Œå¸¦æ ‡ç­¾ Twoï¼ŒæŒ‡å‘èŠ‚ç‚¹ Eã€‚èŠ‚ç‚¹ E æ˜¾ç¤ºä¸º Result 2ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªçŸ©å½¢èŠ‚ç‚¹ã€‚ &quot;graph LR&quot;ï¼šä»å·¦åˆ°å³ 123456&#123;% mermaid graph LR %&#125;A[é•¿æ–¹å½¢] -- é“¾æ¥ --&gt; B((åœ†))A --&gt; C(åœ†è§’é•¿æ–¹å½¢)B --&gt; D&#123;è±å½¢&#125;C --&gt; D&#123;% endmermaid %&#125; æ•ˆæœ graph LR A[é•¿æ–¹å½¢] -- é“¾æ¥ --&gt; B((åœ†)) A --&gt; C(åœ†è§’é•¿æ–¹å½¢) B --&gt; D&#123;è±å½¢&#125; C --&gt; D è¯´æ˜ 123456789101112131415161718192021graph LRï¼Œå®šä¹‰æµç¨‹å›¾çš„æ–¹å‘æ˜¯ä»å·¦åˆ°å³ï¼ˆLeft to Rightï¼‰ã€‚èŠ‚ç‚¹å’Œç®­å¤´ä»å·¦å‘å³æ’åˆ—ã€‚A[é•¿æ–¹å½¢] -- é“¾æ¥ --&gt; B((åœ†))ï¼Œå®šä¹‰äº†èŠ‚ç‚¹ A å’ŒèŠ‚ç‚¹ Bã€‚A æ˜¯ä¸€ä¸ªé•¿æ–¹å½¢èŠ‚ç‚¹ï¼Œæ˜¾ç¤ºå†…å®¹ä¸ºâ€œé•¿æ–¹å½¢â€ã€‚B æ˜¯ä¸€ä¸ªåœ†å½¢èŠ‚ç‚¹ï¼Œå†…å®¹ä¸ºç©ºã€‚å®ƒä»¬ä¹‹é—´é€šè¿‡ä¸€ä¸ªå¸¦æ ‡ç­¾çš„ç®­å¤´ -- é“¾æ¥ --&gt; è¿æ¥ï¼Œç®­å¤´ä¸Šæ ‡æ³¨äº†â€œé“¾æ¥â€ã€‚A --&gt; C(åœ†è§’é•¿æ–¹å½¢)ï¼ŒèŠ‚ç‚¹ A æŒ‡å‘èŠ‚ç‚¹ Cã€‚C æ˜¯ä¸€ä¸ªåœ†è§’é•¿æ–¹å½¢èŠ‚ç‚¹ï¼Œæ˜¾ç¤ºå†…å®¹ä¸ºâ€œåœ†è§’é•¿æ–¹å½¢â€ã€‚B --&gt; D&#123;è±å½¢&#125;ï¼ŒèŠ‚ç‚¹ B æŒ‡å‘èŠ‚ç‚¹ Dã€‚D æ˜¯ä¸€ä¸ªè±å½¢èŠ‚ç‚¹ï¼Œæ˜¾ç¤ºå†…å®¹ä¸ºâ€œè±å½¢â€ã€‚C --&gt; Dï¼ŒèŠ‚ç‚¹ C ä¹ŸæŒ‡å‘èŠ‚ç‚¹ Dï¼Œç®­å¤´ä¸å¸¦æ ‡ç­¾ã€‚èŠ‚ç‚¹ç±»å‹å’Œå½¢çŠ¶é•¿æ–¹å½¢ [] ï¼šå¦‚ A[é•¿æ–¹å½¢]ï¼Œæ˜¯é»˜è®¤çš„çŸ©å½¢èŠ‚ç‚¹ã€‚åœ†å½¢ (()) ï¼šå¦‚ B((åœ†))ï¼Œç”¨äºè¡¨ç¤ºä¸€ä¸ªåœ†å½¢èŠ‚ç‚¹ã€‚åœ†è§’é•¿æ–¹å½¢ () ï¼šå¦‚ C(åœ†è§’é•¿æ–¹å½¢)ï¼Œç”¨äºè¡¨ç¤ºåœ†è§’çŸ©å½¢èŠ‚ç‚¹ã€‚è±å½¢ &#123;&#125; ï¼šå¦‚ D&#123;è±å½¢&#125;ï¼Œç”¨äºè¡¨ç¤ºå†³ç­–ç‚¹æˆ–æ¡ä»¶åˆ†æ”¯ã€‚ Sequence Diagram ç”¨äºç»˜åˆ¶æ—¶åºå›¾ï¼Œæ˜¾ç¤ºå¤šä¸ªå®ä½“ä¹‹é—´çš„äº¤äº’å…³ç³»ï¼ŒåŒ…æ‹¬æ¶ˆæ¯ã€æ—¶é—´ã€çŠ¶æ€å’Œæ•°æ®äº¤æ¢ã€‚ Mermaid Sequence Diagram type ä¸º &quot;sequenceDiagram&quot; 12345678910&#123;% mermaid sequenceDiagram %&#125;Alice-&gt;&gt;John: Hello John, how are you?loop Healthcheck John-&gt;&gt;John: Fight against hypochondriaendNote right of John: Rational thoughts!John--&gt;&gt;Alice: Great!John-&gt;&gt;Bob: How about you?Bob--&gt;&gt;John: Jolly good!&#123;% endmermaid %&#125; æ•ˆæœ sequenceDiagram Alice-&gt;&gt;John: Hello John, how are you? loop Healthcheck John-&gt;&gt;John: Fight against hypochondria end Note right of John: Rational thoughts! John--&gt;&gt;Alice: Great! John-&gt;&gt;Bob: How about you? Bob--&gt;&gt;John: Jolly good! è¯´æ˜ 12345678910111213141516171819202122232425262728293031åŸºæœ¬ç»“æ„è¯´æ˜sequenceDiagram: å®šä¹‰ä¸€ä¸ªåºåˆ—å›¾ï¼Œè¡¨ç¤ºæ¶ˆæ¯å’Œäº‹ä»¶çš„æ—¶é—´é¡ºåºã€‚å‚ä¸è€… Aliceã€John å’Œ Bob æ˜¯å‚ä¸è€…ã€‚ æ¯ä¸ªå‚ä¸è€…åœ¨å›¾ä¸­ä¼šä»¥å‚ç›´æ’åˆ—çš„å½¢å¼æ˜¾ç¤ºã€‚æ¶ˆæ¯å’Œç®­å¤´ -&gt;&gt; è¡¨ç¤ºä¸€ä¸ªæ¶ˆæ¯çš„å‘é€ï¼Œæ–¹å‘ç”±ç®­å¤´å†³å®šã€‚ æ¶ˆæ¯å†…å®¹å†™åœ¨ç®­å¤´æ—è¾¹ã€‚å¾ªç¯ï¼ˆloopï¼‰ ä½¿ç”¨ loop å®šä¹‰ä¸€ä¸ªå¾ªç¯å—ï¼Œå¾ªç¯ä¸­çš„æ¶ˆæ¯ä¼šé‡å¤æ‰§è¡Œï¼Œè¡¨ç¤ºæŸç§æŒç»­è¡Œä¸ºã€‚å¤‡æ³¨ï¼ˆNoteï¼‰ Note right of John å®šä¹‰äº†ä¸€æ¡å¤‡æ³¨ï¼Œæ˜¾ç¤ºåœ¨ John çš„å³ä¾§ï¼Œç”¨æ¥è¡¥å……è¯´æ˜ã€‚ä»£ç é€æ­¥è§£æAlice-&gt;&gt;John: Hello John, how are you? è¡¨ç¤º Alice ç»™ John å‘é€ä¸€æ¡æ¶ˆæ¯ï¼šâ€œHello John, how are you?â€loop Healthcheck å®šä¹‰ä¸€ä¸ªå¾ªç¯å—ï¼Œæ ‡é¢˜ä¸ºâ€œHealthcheckâ€ï¼ˆå¥åº·æ£€æŸ¥ï¼‰ã€‚ å¾ªç¯å†…å®¹æ˜¯ï¼š John-&gt;&gt;John: Fight against hypochondria è¡¨ç¤º John è‡ªå·±å‘è‡ªå·±å‘é€ä¸€æ¡æ¶ˆæ¯ï¼šâ€œFight against hypochondriaâ€ï¼ˆä¸ç–‘ç—…ç—‡æŠ—äº‰ï¼‰ã€‚Note right of John: Rational thoughts! å®šä¹‰äº†ä¸€æ¡å¤‡æ³¨ï¼Œæ˜¾ç¤ºåœ¨ John çš„å³ä¾§ã€‚ å¤‡æ³¨å†…å®¹ä¸ºï¼šâ€œRational thoughts!â€ï¼ˆç†æ€§æ€è€ƒï¼ï¼‰ã€‚John--&gt;&gt;Alice: Great! John å›å¤ Alice ä¸€æ¡æ¶ˆæ¯ï¼šâ€œGreat!â€ï¼ˆå¾ˆå¥½ï¼ï¼‰ã€‚ ä½¿ç”¨ --&gt;&gt; è¡¨ç¤ºå›å¤æ¶ˆæ¯ã€‚John-&gt;&gt;Bob: How about you? John è¯¢é—® Bob ä¸€æ¡æ¶ˆæ¯ï¼šâ€œHow about you?â€ï¼ˆä½ æ€ä¹ˆæ ·ï¼Ÿï¼‰ã€‚Bob--&gt;&gt;John: Jolly good! Bob å›å¤ John ä¸€æ¡æ¶ˆæ¯ï¼šâ€œJolly good!â€ï¼ˆéå¸¸å¥½ï¼ï¼‰ã€‚ Class Diagram ç”¨äºç»˜åˆ¶ç±»å›¾ï¼Œæ˜¾ç¤ºå¯¹è±¡ä¹‹é—´çš„å…³ç³»ï¼ŒåŒ…æ‹¬ç»§æ‰¿ã€å…³è”ã€ä¾èµ–ç­‰ã€‚ Mermaid Class Diagram type ä¸º &quot;classDiagram&quot; 1234567891011121314151617&#123;% mermaid classDiagram %&#125;Class01 &lt;|-- AveryLongClass : Cool&lt;&lt;interface&gt;&gt; Class01Class09 --&gt; C2 : Where am i?Class09 --* C3Class09 --|&gt; Class07Class07 : equals()Class07 : Object[] elementDataClass01 : size()Class01 : int chimpClass01 : int gorillaclass Class10 &#123; &lt;&lt;service&gt;&gt; int id size()&#125;&#123;% endmermaid %&#125; æ•ˆæœ classDiagram Class01 &lt;|-- AveryLongClass : Cool &lt;&lt;interface&gt;&gt; Class01 Class09 --&gt; C2 : Where am i? Class09 --* C3 Class09 --|&gt; Class07 Class07 : equals() Class07 : Object[] elementData Class01 : size() Class01 : int chimp Class01 : int gorilla class Class10 &#123; &lt;&lt;service&gt;&gt; int id size() &#125; è¯´æ˜ 12345678910111213141516171819202122232425262728293031323334353637383940414243åŸºæœ¬ç»“æ„classDiagram å®šä¹‰ä¸€ä¸ªç±»å›¾ï¼Œå±•ç¤ºç±»çš„å±æ€§ã€æ–¹æ³•ä»¥åŠå®ƒä»¬ä¹‹é—´çš„å…³ç³»ã€‚ç±»å’Œä¿®é¥°ç¬¦ ä½¿ç”¨ class ClassName å®šä¹‰ä¸€ä¸ªç±»ã€‚ ç±»çš„å±æ€§å’Œæ–¹æ³•å®šä¹‰åœ¨ class å—å†…ã€‚ ç‰¹æ®Šä¿®é¥°ç¬¦å¦‚ &lt;&lt;interface&gt;&gt; å’Œ &lt;&lt;service&gt;&gt; ç”¨äºè¯´æ˜ç±»çš„è§’è‰²æˆ–ç±»å‹ã€‚å…³ç³»ç¬¦å· &lt;|-- è¡¨ç¤ºç»§æ‰¿ï¼ˆextendsï¼‰ã€‚ --|&gt; è¡¨ç¤ºå®ç°ï¼ˆimplementsï¼Œæ¥å£çš„å®ç°ï¼‰ã€‚ --&gt; è¡¨ç¤ºå…³è”ï¼ˆæ™®é€šå¼•ç”¨ï¼‰ã€‚ --* è¡¨ç¤ºç»„åˆå…³ç³»ï¼ˆä¸€ä¸ªç±»åŒ…å«å¦ä¸€ä¸ªç±»ï¼‰ã€‚ : åè·Ÿå…³ç³»çš„è¯´æ˜æˆ–æ³¨é‡Šã€‚ä»£ç é€æ­¥è§£æClass01 &lt;|-- AveryLongClass : Cool è¡¨ç¤º AveryLongClass ç»§æ‰¿äº† Class01ï¼Œå…³ç³»åç§°ä¸º Coolã€‚ &lt;|-- è¡¨ç¤ºç»§æ‰¿ï¼ˆçˆ¶ç±»åˆ°å­ç±»ï¼‰ã€‚&lt;&lt;interface&gt;&gt; Class01 å°† Class01 æ ‡è®°ä¸ºä¸€ä¸ªæ¥å£ã€‚Class09 --&gt; C2 : Where am i? è¡¨ç¤º Class09 ä¸ C2 æœ‰ä¸€ä¸ªå…³è”å…³ç³»ï¼Œæ³¨é‡Šä¸º â€œWhere am i?â€ã€‚Class09 --* C3 è¡¨ç¤º Class09 ä¸ C3 æœ‰ä¸€ä¸ªç»„åˆå…³ç³»ã€‚ Class09 åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ª C3 çš„å®ä¾‹ã€‚Class09 --|&gt; Class07 è¡¨ç¤º Class09 å®ç°äº† Class07ã€‚ --|&gt; é€šå¸¸ç”¨äºè¡¨ç¤ºæ¥å£å®ç°ã€‚Class07 : equals() è¡¨ç¤º Class07 å®šä¹‰äº†ä¸€ä¸ªæ–¹æ³• equals()ã€‚Class07 : Object[] elementData è¡¨ç¤º Class07 æœ‰ä¸€ä¸ªå±æ€§ elementDataï¼Œç±»å‹æ˜¯ Object[]ï¼ˆæ•°ç»„ï¼‰ã€‚Class01 : size() è¡¨ç¤º Class01 æœ‰ä¸€ä¸ªæ–¹æ³• size()ã€‚Class01 : int chimp å’Œ Class01 : int gorilla è¡¨ç¤º Class01 æœ‰ä¸¤ä¸ªæ•´å‹å±æ€§ï¼šchimp å’Œ gorillaã€‚class Class10 &#123; ... &#125; å®šä¹‰äº†ä¸€ä¸ªåä¸º Class10 çš„ç±»ã€‚ ç±»ä¸­æœ‰ä¸€ä¸ªä¿®é¥°ç¬¦ &lt;&lt;service&gt;&gt;ï¼Œè¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªæœåŠ¡ç±»ã€‚ å±æ€§å’Œæ–¹æ³•ï¼š int idï¼šæ•´å‹å±æ€§ã€‚ size()ï¼šæ–¹æ³•ã€‚ State Diagram ç”¨äºç»˜åˆ¶çŠ¶æ€å›¾ï¼Œæ˜¾ç¤ºå¯¹è±¡çš„çŠ¶æ€è½¬ç§»å’Œè¡Œä¸ºã€‚ Mermaid State Diagram type ä¸º &quot;stateDiagram&quot; 12345678&#123;% mermaid stateDiagram %&#125;[*] --&gt; StillStill --&gt; [*]Still --&gt; MovingMoving --&gt; StillMoving --&gt; CrashCrash --&gt; [*]&#123;% endmermaid %&#125; æ•ˆæœ stateDiagram [*] --&gt; Still Still --&gt; [*] Still --&gt; Moving Moving --&gt; Still Moving --&gt; Crash Crash --&gt; [*] è¯´æ˜ 123456789101112131415161718192021222324252627åŸºæœ¬ç»“æ„stateDiagram å®šä¹‰è¿™æ˜¯ä¸€ä¸ªçŠ¶æ€å›¾ï¼Œç”¨äºè¡¨ç¤ºçŠ¶æ€å’ŒçŠ¶æ€ä¹‹é—´çš„è½¬æ¢ã€‚[*] è¡¨ç¤ºåˆå§‹çŠ¶æ€æˆ–ç»ˆæ­¢çŠ¶æ€ã€‚ èµ·å§‹çŠ¶æ€é€šå¸¸æœ‰ç®­å¤´æŒ‡å‘ç¬¬ä¸€ä¸ªçŠ¶æ€ã€‚ ç»ˆæ­¢çŠ¶æ€é€šå¸¸æœ‰ç®­å¤´æŒ‡å‘å®ƒã€‚çŠ¶æ€ ç”¨çŠ¶æ€åç§°å®šä¹‰çŠ¶æ€ï¼Œä¾‹å¦‚ Stillã€Movingã€Crashã€‚ç®­å¤´ --&gt; è¡¨ç¤ºçŠ¶æ€ä¹‹é—´çš„è½¬æ¢æ–¹å‘ã€‚ä»£ç é€æ­¥è§£æ[*] --&gt; Still ç³»ç»Ÿä»åˆå§‹çŠ¶æ€è¿›å…¥ Still çŠ¶æ€ã€‚Still --&gt; [*] ç³»ç»Ÿä» Still çŠ¶æ€å¯ä»¥ç›´æ¥è¿›å…¥ç»ˆæ­¢çŠ¶æ€ï¼ˆç³»ç»Ÿç»“æŸï¼‰ã€‚Still --&gt; Moving ç³»ç»Ÿä» Still çŠ¶æ€å¯ä»¥è½¬æ¢ä¸º Moving çŠ¶æ€ã€‚Moving --&gt; Still ç³»ç»Ÿä» Moving çŠ¶æ€å¯ä»¥è¿”å›åˆ° Still çŠ¶æ€ã€‚Moving --&gt; Crash ç³»ç»Ÿä» Moving çŠ¶æ€å¯ä»¥è¿›å…¥ Crash çŠ¶æ€ã€‚Crash --&gt; [*] ç³»ç»Ÿä» Crash çŠ¶æ€å¯ä»¥è¿›å…¥ç»ˆæ­¢çŠ¶æ€ï¼ˆè¡¨ç¤ºç³»ç»Ÿå´©æºƒæˆ–ç»ˆæ­¢ï¼‰ã€‚ Entity Relationship Diagram ç”¨äºç»˜åˆ¶å®ä½“å…³ç³»å›¾ï¼Œæ˜¾ç¤ºå®ä½“ä¹‹é—´çš„å…³ç³»ï¼ŒåŒ…æ‹¬å…³è”ã€ä¾èµ–ç­‰ã€‚ Mermaid Entity Relationship Diagram type ä¸º &quot;erDiagram&quot; 12345&#123;% mermaid erDiagram %&#125;CUSTOMER ||--o&#123; ORDER : placesORDER ||--|&#123; ITEM : containsCUSTOMER &#125;|..|&#123; DELIVERY-ADDRESS : has&#123;% endmermaid %&#125; æ•ˆæœ erDiagram CUSTOMER ||--o&#123; ORDER : places ORDER ||--|&#123; ITEM : contains CUSTOMER &#125;|..|&#123; DELIVERY-ADDRESS : has è¯´æ˜ 12345678910111213141516171819202122232425åŸºæœ¬ç»“æ„erDiagram å®šä¹‰è¿™æ˜¯ä¸€ä¸ªå®ä½“å…³ç³»å›¾ã€‚ å±•ç¤ºæ•°æ®åº“ä¸­è¡¨ï¼ˆå®ä½“ï¼‰ä¹‹é—´çš„å…³ç³»ã€‚å®ä½“ ä¾‹å¦‚ CUSTOMERã€ORDER å’Œ ITEMï¼Œæ¯ä¸ªå®ä½“å¯¹åº”æ•°æ®åº“ä¸­çš„ä¸€ä¸ªè¡¨ã€‚å…³ç³» ||--o&#123; è¡¨ç¤ºä¸€å¯¹å¤šå…³ç³»ï¼ˆ1:Nï¼‰ã€‚ ||--|&#123; è¡¨ç¤ºä¸€å¯¹å¤šå…³ç³»ï¼ˆ1:Nï¼‰ï¼Œä½†å¼ºè°ƒå®ä½“çš„å”¯ä¸€æ€§ï¼ˆæ¯ä¸ªå­è®°å½•å±äºå”¯ä¸€çš„çˆ¶è®°å½•ï¼‰ã€‚ &#125;|..|&#123; è¡¨ç¤ºå¤šå¯¹å¤šå…³ç³»ï¼ˆN:Mï¼‰ã€‚æ³¨é‡Š : åçš„æ–‡å­—æ˜¯å…³ç³»çš„æè¿°ï¼Œä¾‹å¦‚ placesã€containsã€hasã€‚ä»£ç é€æ­¥è§£æCUSTOMER ||--o&#123; ORDER : places è¡¨ç¤ºä¸€ä¸ªå®¢æˆ· (CUSTOMER) å¯ä»¥ä¸‹å¤šä¸ªè®¢å• (ORDER)ã€‚ ||--o&#123; è¡¨ç¤º ä¸€å¯¹å¤šå…³ç³»ï¼ˆ1:Nï¼‰ï¼Œå³ä¸€ä¸ªå®¢æˆ·å¯¹åº”å¤šä¸ªè®¢å•ã€‚ORDER ||--|&#123; ITEM : contains è¡¨ç¤ºä¸€ä¸ªè®¢å• (ORDER) åŒ…å«å¤šä¸ªå•†å“ (ITEM)ã€‚ ||--|&#123; è¡¨ç¤º ä¸€å¯¹å¤šå…³ç³»ï¼Œä¸”æ¯ä¸ªå•†å“çš„è®°å½•ä¸æŸä¸ªè®¢å•å”¯ä¸€å¯¹åº”ã€‚CUSTOMER &#125;|..|&#123; DELIVERY-ADDRESS : has è¡¨ç¤ºä¸€ä¸ªå®¢æˆ· (CUSTOMER) å¯ä»¥æœ‰å¤šä¸ªé…é€åœ°å€ (DELIVERY-ADDRESS)ï¼Œè€Œæ¯ä¸ªé…é€åœ°å€ä¹Ÿå¯èƒ½å¯¹åº”å¤šä¸ªå®¢æˆ·ã€‚ &#125;|..|&#123; è¡¨ç¤º å¤šå¯¹å¤šå…³ç³»ï¼ˆN:Mï¼‰ã€‚ Gantt Chart ç”¨äºç»˜åˆ¶ç”˜ç‰¹å›¾ï¼Œæ˜¾ç¤ºä»»åŠ¡è®¡åˆ’ã€è¿›åº¦å’Œèµ„æºåˆ†é…ã€‚ Mermaid Gantt Chart type ä¸º &quot;gantt&quot; 1234567891011121314&#123;% mermaid gantt %&#125;title Project TimelinedateFormat YYYY-MM-DDsection Section1Completed :done, des1, 2014-01-06,2014-01-08Active :active, des2, 2014-01-07, 3dParallel 1 : des3, after des1, 1dParallel 2 : des4, after des1, 1dParallel 3 : des5, after des3, 1dParallel 4 : des6, after des4, 1dsection Section2Task 1 : t1,after des6,5dTask 2 : t2,after t1,3d&#123;% endmermaid %&#125; æ•ˆæœ gantt title Project Timeline dateFormat YYYY-MM-DD section Section1 Completed :done, des1, 2014-01-06,2014-01-08 Active :active, des2, 2014-01-07, 3d Parallel 1 : des3, after des1, 1d Parallel 2 : des4, after des1, 1d Parallel 3 : des5, after des3, 1d Parallel 4 : des6, after des4, 1d section Section2 Task 1 : t1,after des6,5d Task 2 : t2,after t1,3d è¯´æ˜ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273åŸºæœ¬ç»“æ„gantt å®šä¹‰ä¸€ä¸ªç”˜ç‰¹å›¾ï¼Œç”¨äºè¡¨ç¤ºä»»åŠ¡çš„æ—¶é—´åˆ†å¸ƒå’Œä¾èµ–å…³ç³»ã€‚title å®šä¹‰ç”˜ç‰¹å›¾çš„æ ‡é¢˜ï¼Œè¿™é‡Œæ˜¯ Project Timelineã€‚dateFormat å®šä¹‰æ—¥æœŸæ ¼å¼ï¼Œè¿™é‡Œæ˜¯ YYYY-MM-DDï¼ˆå¹´-æœˆ-æ—¥ï¼‰ã€‚section å®šä¹‰ä»»åŠ¡çš„åˆ†ç±»ï¼ˆéƒ¨åˆ†ï¼‰ã€‚ æ¯ä¸ª section ä¸‹åŒ…å«ä¸€ç»„ä»»åŠ¡ï¼Œä»»åŠ¡åœ¨å›¾è¡¨ä¸­åˆ†ç»„æ˜¾ç¤ºã€‚ä»»åŠ¡æ ¼å¼ æ¯ä¸ªä»»åŠ¡æŒ‰ä»¥ä¸‹æ ¼å¼å®šä¹‰ï¼š ä»»åŠ¡åç§° : çŠ¶æ€, æ ‡è¯†ç¬¦, å¼€å§‹æ—¥æœŸæˆ–ä¾èµ–, æŒç»­æ—¶é—´ ä»»åŠ¡åç§°ï¼šä»»åŠ¡çš„æè¿°ã€‚ çŠ¶æ€ï¼šå¯é€‰ï¼Œè¡¨ç¤ºä»»åŠ¡çŠ¶æ€ï¼š doneï¼šå·²å®Œæˆã€‚ activeï¼šæ­£åœ¨è¿›è¡Œã€‚ æ ‡è¯†ç¬¦ï¼šä»»åŠ¡çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œç”¨äºå®šä¹‰ä¾èµ–å…³ç³»ã€‚ æ—¶é—´ï¼šå¯ä»¥æ˜¯å¼€å§‹æ—¥æœŸã€ç»“æŸæ—¥æœŸã€æˆ–ä¾èµ–ä»»åŠ¡ã€‚ä»£ç é€æ­¥è§£æsection Section1 å®šä¹‰ä¸€ä¸ªåä¸º Section1 çš„éƒ¨åˆ†ï¼ŒåŒ…å«ä¸€ç»„ä»»åŠ¡ã€‚Completed :done, des1, 2014-01-06,2014-01-08 ä»»åŠ¡åç§°ï¼šCompletedã€‚ çŠ¶æ€ï¼šdoneï¼ˆå·²å®Œæˆï¼‰ã€‚ æ ‡è¯†ç¬¦ï¼šdes1ã€‚ å¼€å§‹æ—¥æœŸï¼š2014-01-06ã€‚ ç»“æŸæ—¥æœŸï¼š2014-01-08ã€‚Active :active, des2, 2014-01-07, 3d ä»»åŠ¡åç§°ï¼šActiveã€‚ çŠ¶æ€ï¼šactiveï¼ˆæ­£åœ¨è¿›è¡Œï¼‰ã€‚ æ ‡è¯†ç¬¦ï¼šdes2ã€‚ å¼€å§‹æ—¥æœŸï¼š2014-01-07ã€‚ æŒç»­æ—¶é—´ï¼š3dï¼ˆ3å¤©ï¼‰ã€‚Parallel 1 : des3, after des1, 1d ä»»åŠ¡åç§°ï¼šParallel 1ã€‚ æ— çŠ¶æ€ï¼ˆé»˜è®¤å€¼ï¼‰ã€‚ æ ‡è¯†ç¬¦ï¼šdes3ã€‚ å¼€å§‹æ—¶é—´ï¼šä¾èµ–ä»»åŠ¡ des1ï¼ˆåœ¨ä»»åŠ¡ Completed åå¼€å§‹ï¼‰ã€‚ æŒç»­æ—¶é—´ï¼š1dï¼ˆ1å¤©ï¼‰ã€‚Parallel 2 : des4, after des1, 1d ä»»åŠ¡åç§°ï¼šParallel 2ã€‚ æ— çŠ¶æ€ã€‚ æ ‡è¯†ç¬¦ï¼šdes4ã€‚ å¼€å§‹æ—¶é—´ï¼šä¾èµ–ä»»åŠ¡ des1ï¼ˆåœ¨ä»»åŠ¡ Completed åå¼€å§‹ï¼‰ã€‚ æŒç»­æ—¶é—´ï¼š1dï¼ˆ1å¤©ï¼‰ã€‚Parallel 3 : des5, after des3, 1d ä»»åŠ¡åç§°ï¼šParallel 3ã€‚ æ— çŠ¶æ€ã€‚ æ ‡è¯†ç¬¦ï¼šdes5ã€‚ å¼€å§‹æ—¶é—´ï¼šä¾èµ–ä»»åŠ¡ des3ï¼ˆåœ¨ä»»åŠ¡ Parallel 1 åå¼€å§‹ï¼‰ã€‚ æŒç»­æ—¶é—´ï¼š1dï¼ˆ1å¤©ï¼‰ã€‚Parallel 4 : des6, after des4, 1d ä»»åŠ¡åç§°ï¼šParallel 4ã€‚ æ— çŠ¶æ€ã€‚ æ ‡è¯†ç¬¦ï¼šdes6ã€‚ å¼€å§‹æ—¶é—´ï¼šä¾èµ–ä»»åŠ¡ des4ï¼ˆåœ¨ä»»åŠ¡ Parallel 2 åå¼€å§‹ï¼‰ã€‚ æŒç»­æ—¶é—´ï¼š1dï¼ˆ1å¤©ï¼‰ã€‚section Section2 å®šä¹‰ç”˜ç‰¹å›¾çš„ç¬¬äºŒéƒ¨åˆ†ï¼Œç”¨äºåˆ†ç»„æ˜¾ç¤ºåç»­ä»»åŠ¡ã€‚ ä»»åŠ¡å±äºä¸åŒçš„éƒ¨åˆ†ä»¥ä¾¿åˆ†ç±»å’Œåˆ†ç»„ã€‚Task 1 : t1, after des6, 5d ä»»åŠ¡åç§°ï¼šTask 1ã€‚ æ ‡è¯†ç¬¦ï¼št1ã€‚ å¼€å§‹æ—¶é—´ï¼šä¾èµ–ä»»åŠ¡ des6ï¼ˆParallel 4ï¼‰å®Œæˆåå¼€å§‹ã€‚ æŒç»­æ—¶é—´ï¼š5dï¼ˆ5å¤©ï¼‰ã€‚Task 2 : t2, after t1, 3d ä»»åŠ¡åç§°ï¼šTask 2ã€‚ æ ‡è¯†ç¬¦ï¼št2ã€‚ å¼€å§‹æ—¶é—´ï¼šä¾èµ–ä»»åŠ¡ t1ï¼ˆTask 1ï¼‰å®Œæˆåå¼€å§‹ã€‚ æŒç»­æ—¶é—´ï¼š3dï¼ˆ3å¤©ï¼‰ã€‚ Pie Chart ç”¨äºç»˜åˆ¶é¥¼çŠ¶å›¾ï¼Œæ˜¾ç¤ºæ•°æ®åˆ†å¸ƒæƒ…å†µã€‚ Mermaid Pie Chart type ä¸º &quot;pie&quot; 1234567&#123;% mermaid pie showData %&#125;%%&#123;init: &#123;&quot;pie&quot;: &#123;&quot;textPosition&quot;: 0.4&#125;, &quot;themeVariables&quot;: &#123;&quot;pieOuterStrokeWidth&quot;: &quot;5px&quot;,&quot;pie1&quot;: &quot;#ff9999&quot;,&quot;pie2&quot;: &quot;#99ccff&quot;,&quot;pie3&quot;: &quot;#99ff99&quot;&#125;&#125; &#125;%%title Expenses&quot;Rent&quot; : 200&quot;Food&quot; : 200&quot;Transport&quot; : 400&#123;% endmermaid %&#125; æ•ˆæœ %%&#123;init: &#123;&quot;pie&quot;: &#123;&quot;textPosition&quot;: 0.4&#125;, &quot;themeVariables&quot;: &#123;&quot;pieOuterStrokeWidth&quot;: &quot;5px&quot;,&quot;pie1&quot;: &quot;#ff9999&quot;,&quot;pie2&quot;: &quot;#99ccff&quot;,&quot;pie3&quot;: &quot;#99ff99&quot;&#125;&#125; &#125;%% pie showData title Expenses &quot;Rent&quot; : 200 &quot;Food&quot; : 200 &quot;Transport&quot; : 400 è¯´æ˜ 1234567891011121314151617181920212223åŸºæœ¬ç»“æ„%%&#123;init: ...&#125;%%ï¼š Mermaid.js çš„åˆå§‹åŒ–é…ç½®ï¼Œç”¨äºå…¨å±€è®¾ç½®å›¾è¡¨å±æ€§å’Œæ ·å¼ã€‚ pie å±æ€§ textPosition: è®¾ç½®é¥¼å›¾æ•°æ®æ ‡ç­¾çš„ç›¸å¯¹ä½ç½®ã€‚ å€¼èŒƒå›´ä¸º 0 åˆ° 1ï¼Œè¡¨ç¤ºæ ‡ç­¾è·ç¦»é¥¼å›¾ä¸­å¿ƒçš„æ¯”ä¾‹ã€‚0.4 è¡¨ç¤ºæ ‡ç­¾è·ç¦»ä¸­å¿ƒè¾ƒè¿‘ï¼Œæ¥è¿‘ 40% çš„åŠå¾„ä½ç½®ã€‚ themeVariables pieOuterStrokeWidth: è®¾ç½®é¥¼å›¾å¤–ç¯çš„å®½åº¦ã€‚è®¾ç½®ä¸º 5pxï¼Œè¡¨ç¤ºé¥¼å›¾æœ‰æ˜æ˜¾çš„å¤–è¾¹æ¡†ã€‚ &quot;pie1&quot;: &quot;#ff9999&quot;,&quot;pie2&quot;: &quot;#99ccff&quot;,&quot;pie3&quot;: &quot;#99ff99&quot;: é…ç½®æ¯ä¸ªåˆ†åŒºçš„é¢œè‰²ã€‚pie å®šä¹‰è¿™æ˜¯ä¸€ä¸ªé¥¼å›¾ã€‚showData æ˜¾ç¤ºæ•°æ®é¡¹çš„æ•°å€¼ã€‚title Expenses è®¾ç½®é¥¼å›¾çš„æ ‡é¢˜ä¸º Expensesï¼ˆè´¹ç”¨ï¼‰ã€‚æ•°æ®é¡¹ æ•°æ®é¡¹å®šä¹‰äº†é¥¼å›¾çš„å„ä¸ªéƒ¨åˆ†ï¼š &quot;Rent&quot; : 200ï¼Œå æ¯”ï¼š200 / (200 + 200 + 400) = 1/4 = 25%ã€‚ &quot;Food&quot; : 200ï¼Œå æ¯”ï¼š200 / (200 + 200 + 400) = 1/4 = 25%ã€‚ &quot;Transport&quot; : 400ï¼Œå æ¯”ï¼š400 / (200 + 200 + 400) = 1/2 = 50%ã€‚ æ¯ä¸ªæ•°æ®é¡¹åŒ…å«ï¼š æ ‡ç­¾ï¼šå¦‚ &quot;Rent&quot;ã€&quot;Food&quot;ã€&quot;Transport&quot;ã€‚ æ•°å€¼ï¼šå¦‚ 200ã€400ï¼Œè¡¨ç¤ºè¯¥éƒ¨åˆ†çš„æƒé‡æˆ–æ•°å€¼å¤§å°ã€‚ XY Chart ç”¨äºç»˜åˆ¶ XY è½´å›¾(æŸ±çŠ¶å›¾å’ŒæŠ˜çº¿å›¾)ï¼Œæ˜¾ç¤ºæ•°æ®åˆ†å¸ƒå’Œè¶‹åŠ¿ã€‚ Mermaid XY Chart type ä¸º &quot;xychart-beta&quot;ï¼Œç›®å‰ xychart-beta è¿˜å¤„åœ¨æ”¹è¿›é˜¶æ®µ 12345678&#123;% mermaid xychart-beta %&#125;%%&#123;init: &#123;&quot;xyChart&quot;: &#123;&quot;width&quot;: 900,&quot;height&quot;:600&#125;, &quot;themeVariables&quot;: &#123;&quot;xyChart&quot;:&#123;&quot;titleColor&quot;: &quot;#ff0000&quot;&#125;&#125;&#125; &#125;%%title &quot;Sales Revenue&quot;x-axis [jan, feb, mar, apr, may, jun, jul, aug, sep, oct, nov, dec]y-axis &quot;Revenue (in $)&quot; 4000 --&gt; 11000bar [5000, 6000, 7500, 8200, 9500, 10500, 11000, 10200, 9200, 8500, 7000, 6000]line [5000, 6000, 7500, 8200, 9500, 10500, 11000, 10200, 9200, 8500, 7000, 6000]&#123;% endmermaid %&#125; æ•ˆæœ --- config: xyChart: width: 900 height: 600 themeVariables: xyChart: titleColor: &quot;#ff0000&quot; --- xychart-beta title &quot;Sales Revenue&quot; x-axis [jan, feb, mar, apr, may, jun, jul, aug, sep, oct, nov, dec] y-axis &quot;Revenue (in $)&quot; 4000 --&gt; 11000 bar [5000, 6000, 7500, 8200, 9500, 10500, 11000, 10200, 9200, 8500, 7000, 6000] line [5000, 6000, 7500, 8200, 9500, 10500, 11000, 10200, 9200, 8500, 7000, 6000] è¯´æ˜ 12345678910111213ä»£ç ç»“æ„è§£æ%%&#123;init: ...&#125;%%ï¼š Mermaid.js çš„åˆå§‹åŒ–é…ç½®ï¼Œç”¨äºå…¨å±€è®¾ç½®å›¾è¡¨å±æ€§å’Œæ ·å¼ã€‚ xyChart.width å’Œ xyChart.height : è®¾ç½®å›¾è¡¨çš„å®½åº¦å’Œé«˜åº¦ã€‚ themeVariables.xyChart.titleColor: è®¾ç½®æ ‡é¢˜çš„é¢œè‰²ã€‚title è®¾ç½®å›¾è¡¨çš„æ ‡é¢˜ã€‚åæ ‡è½´å®šä¹‰ x-axisï¼šXè½´æ ‡ç­¾ä¸ºæœˆä»½ï¼ˆä»1æœˆåˆ°12æœˆï¼‰ã€‚ y-axisï¼šYè½´èŒƒå›´ä» $4000 åˆ° $11000ï¼Œå•ä½ä¸ºç¾å…ƒã€‚æ•°æ® barï¼šæŸ±çŠ¶å›¾æ•°æ®ï¼Œè¡¨ç¤ºæ¯ä¸ªæœˆçš„é”€å”®æ”¶å…¥ã€‚ lineï¼šæŠ˜çº¿å›¾æ•°æ®ï¼Œè¡¨ç¤ºæ¯ä¸ªæœˆçš„é”€é‡è¶‹åŠ¿ã€‚ Journey Diagram ç”¨äºç»˜åˆ¶æ—…ç¨‹å›¾ï¼Œæ˜¾ç¤ºç”¨æˆ·çš„ä½“éªŒæµç¨‹ï¼ŒåŒ…æ‹¬ç”¨æˆ·è¿›å…¥ç³»ç»Ÿã€æ“ä½œã€é€€å‡ºç³»ç»Ÿç­‰ã€‚ Mermaid Journey Diagram type ä¸º &quot;journey&quot; 12345678910111213&#123;% mermaid journey %&#125;title My working daysection Morning wake up : 5 : me go to work : 3 : me,yousection Lunch have lunch : 5 : me,you go to work : 1 : me,yousection Dinner finish your meal : 5 : mesection Go home go home : 5 : me&#123;% endmermaid %&#125; æ•ˆæœ journey title My working day section Morning wake up : 5 : me go to work : 3 : me,you section Lunch have lunch : 5 : me,you go to work : 1 : me,you section Dinner finish your meal : 5 : me section Go home go home : 5 : me è¯´æ˜ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748åŸºæœ¬ç»“æ„journey å®šä¹‰è¿™æ˜¯ä¸€ä¸ªæ—…ç¨‹å›¾ã€‚title My working day è®¾ç½®æ—…ç¨‹å›¾çš„æ ‡é¢˜ä¸º &quot;My working day&quot;ï¼ˆæˆ‘çš„å·¥ä½œæ—¥ï¼‰ã€‚section å®šä¹‰æ—…ç¨‹å›¾çš„åˆ†æ®µï¼Œç”¨äºè¡¨ç¤ºä¸€å¤©ä¸­çš„ä¸åŒé˜¶æ®µï¼Œä¾‹å¦‚ï¼š Morningï¼ˆæ—©æ™¨ï¼‰ã€‚ Lunchï¼ˆåˆé¤æ—¶é—´ï¼‰ã€‚ Dinnerï¼ˆæ™šé¤ï¼‰ã€‚ Go homeï¼ˆå›å®¶ï¼‰ã€‚ä»»åŠ¡æ ¼å¼ ä»»åŠ¡æè¿° : æ»¡æ„åº¦è¯„åˆ† : å‚ä¸è€… ä»»åŠ¡æè¿°ï¼šæè¿°å…·ä½“çš„ä»»åŠ¡æˆ–æ´»åŠ¨ã€‚ æ»¡æ„åº¦è¯„åˆ†ï¼šä» 1 åˆ° 5ï¼Œè¡¨ç¤ºå¯¹ä»»åŠ¡æˆ–æ´»åŠ¨çš„æ»¡æ„ç¨‹åº¦ã€‚ å‚ä¸è€…ï¼šå‚ä¸ä»»åŠ¡çš„äººï¼Œå¯ä»¥æ˜¯ meï¼ˆè‡ªå·±ï¼‰ã€youï¼ˆå…¶ä»–äººï¼‰æˆ–ä¸¤è€…ã€‚ä»£ç é€æ­¥è§£æsection Morning wake up : 5 : me æ´»åŠ¨ï¼šwake upï¼ˆèµ·åºŠï¼‰ã€‚ æ»¡æ„åº¦ï¼š5ï¼ˆéå¸¸æ»¡æ„ï¼‰ã€‚ å‚ä¸è€…ï¼šmeï¼ˆè‡ªå·±ï¼‰ã€‚ go to work : 3 : me,you æ´»åŠ¨ï¼šgo to workï¼ˆå»å·¥ä½œï¼‰ã€‚ æ»¡æ„åº¦ï¼š3ï¼ˆä¸­ç­‰æ»¡æ„ï¼‰ã€‚ å‚ä¸è€…ï¼šme å’Œ youï¼ˆè‡ªå·±å’Œå…¶ä»–äººï¼‰ã€‚section Lunch have lunch : 5 : me,you æ´»åŠ¨ï¼šhave lunchï¼ˆåƒåˆé¥­ï¼‰ã€‚ æ»¡æ„åº¦ï¼š5ï¼ˆéå¸¸æ»¡æ„ï¼‰ã€‚ å‚ä¸è€…ï¼šme å’Œ youï¼ˆè‡ªå·±å’Œå…¶ä»–äººï¼‰ã€‚ go to work : 1 : me,you æ´»åŠ¨ï¼šgo to workï¼ˆåƒå®Œé¥­ç»§ç»­å·¥ä½œï¼‰ã€‚ æ»¡æ„åº¦ï¼š1ï¼ˆéå¸¸ä¸æ»¡æ„ï¼‰ã€‚ å‚ä¸è€…ï¼šme å’Œ youã€‚section Dinner finish your meal : 5 : me æ´»åŠ¨ï¼šfinish your mealï¼ˆåƒå®Œé¥­ï¼‰ã€‚ æ»¡æ„åº¦ï¼š5ï¼ˆéå¸¸æ»¡æ„ï¼‰ã€‚ å‚ä¸è€…ï¼šmeï¼ˆè‡ªå·±ï¼‰ã€‚section Go home go home : 5 : me æ´»åŠ¨ï¼šgo homeï¼ˆå›å®¶ï¼‰ã€‚ æ»¡æ„åº¦ï¼š5ï¼ˆéå¸¸æ»¡æ„ï¼‰ã€‚ å‚ä¸è€…ï¼šmeï¼ˆè‡ªå·±ï¼‰ã€‚ Requirement Diagram ç”¨äºç»˜åˆ¶éœ€æ±‚å›¾ï¼Œæ˜¾ç¤ºç³»ç»Ÿçš„åŠŸèƒ½éœ€æ±‚å’Œä¾èµ–å…³ç³»ã€‚ Mermaid Requirement Diagram type ä¸º &quot;requirementDiagram&quot; 12345678910111213141516171819&#123;% mermaid requirementDiagram %&#125;requirement &quot;æµ‹è¯•éœ€æ±‚&quot; &#123; id: 1 text: &quot;æµ‹è¯•æ–‡æœ¬&quot; risk: High verifymethod: test&#125;requirement &quot;æµ‹è¯•éœ€æ±‚2&quot; &#123; id: 2 text: &quot;æµ‹è¯•æ–‡æœ¬&quot; risk: High verifymethod: test&#125;element &quot;æµ‹è¯•å®ä½“&quot; &#123; type: &quot;æ¨¡æ‹Ÿ&quot;&#125;&quot;æµ‹è¯•å®ä½“&quot; - satisfies -&gt; &quot;æµ‹è¯•éœ€æ±‚&quot;&quot;æµ‹è¯•å®ä½“&quot; - satisfies -&gt; &quot;æµ‹è¯•éœ€æ±‚2&quot;&#123;% endmermaid %&#125; æ•ˆæœ requirementDiagram requirement &quot;æµ‹è¯•éœ€æ±‚&quot; &#123; id: 1 text: &quot;æµ‹è¯•æ–‡æœ¬&quot; risk: High verifymethod: test &#125; requirement &quot;æµ‹è¯•éœ€æ±‚2&quot; &#123; id: 2 text: &quot;æµ‹è¯•æ–‡æœ¬&quot; risk: High verifymethod: test &#125; element &quot;æµ‹è¯•å®ä½“&quot; &#123; type: &quot;æ¨¡æ‹Ÿ&quot; &#125; &quot;æµ‹è¯•å®ä½“&quot; - satisfies -&gt; &quot;æµ‹è¯•éœ€æ±‚&quot; &quot;æµ‹è¯•å®ä½“&quot; - satisfies -&gt; &quot;æµ‹è¯•éœ€æ±‚2&quot; è¯´æ˜ 12345678910111213141516171819202122232425262728293031323334353637383940åŸºæœ¬ç»“æ„requirementDiagram å®šä¹‰è¿™æ˜¯ä¸€ä¸ªéœ€æ±‚å›¾ã€‚requirement å®šä¹‰ä¸€ä¸ªéœ€æ±‚èŠ‚ç‚¹ï¼ŒåŒ…å«éœ€æ±‚çš„è¯¦ç»†å±æ€§ï¼Œå¦‚ï¼š idï¼šéœ€æ±‚ç¼–å·ã€‚ textï¼šéœ€æ±‚çš„æè¿°ã€‚ riskï¼šéœ€æ±‚çš„é£é™©çº§åˆ«ï¼ˆå¦‚ High è¡¨ç¤ºé«˜é£é™©ï¼‰ã€‚ verifymethodï¼šéªŒè¯éœ€æ±‚çš„æ–¹æ³•ï¼ˆå¦‚ test è¡¨ç¤ºé€šè¿‡æµ‹è¯•éªŒè¯ï¼‰ã€‚element å®šä¹‰ä¸€ä¸ªå…ƒç´ ï¼Œç”¨äºè¡¨ç¤ºç³»ç»Ÿä¸­çš„æŸä¸ªå®ä½“æˆ–å¯¹è±¡ã€‚ åŒ…å«å±æ€§ï¼Œå¦‚ï¼š typeï¼šå®ä½“çš„ç±»å‹ï¼ˆå¦‚ æ¨¡æ‹Ÿ è¡¨ç¤ºæ¨¡æ‹Ÿå®ä½“ï¼‰ã€‚å…³ç³»å®šä¹‰ å®šä¹‰äº†ä¸¤ä¸ªå…³ç³»ï¼š &quot;æµ‹è¯•å®ä½“&quot; - satisfies -&gt; &quot;æµ‹è¯•éœ€æ±‚&quot; : æµ‹è¯•å®ä½“ æ»¡è¶³äº† æµ‹è¯•éœ€æ±‚ &quot;æµ‹è¯•å®ä½“&quot; - satisfies -&gt; &quot;æµ‹è¯•éœ€æ±‚2&quot; : æµ‹è¯•å®ä½“ æ»¡è¶³äº† æµ‹è¯•éœ€æ±‚2 - satisfies -&gt;ï¼šsatisfies è¡¨ç¤ºæ»¡è¶³å…³ç³»ï¼Œç®­å¤´æ–¹å‘ä»å®ä½“æŒ‡å‘éœ€æ±‚ä»£ç é€æ­¥è§£æéœ€æ±‚å®šä¹‰ requirement &quot;æµ‹è¯•éœ€æ±‚&quot; å®šä¹‰ç¬¬ä¸€ä¸ªéœ€æ±‚ï¼Œæ˜¾ç¤ºåç§°ä¸º æµ‹è¯•éœ€æ±‚ã€‚ å±æ€§ï¼š id: 1ï¼ˆéœ€æ±‚ç¼–å·ä¸º 1ï¼‰ã€‚ text: &quot;æµ‹è¯•æ–‡æœ¬&quot;ï¼ˆæè¿°æ–‡æœ¬ä¸º &quot;æµ‹è¯•æ–‡æœ¬&quot;ï¼‰ã€‚ risk: Highï¼ˆé«˜é£é™©éœ€æ±‚ï¼‰ã€‚ verifymethod: testï¼ˆéªŒè¯æ–¹æ³•ä¸ºæµ‹è¯•ï¼‰ã€‚ requirement &quot;æµ‹è¯•éœ€æ±‚2&quot; å®šä¹‰ç¬¬äºŒä¸ªéœ€æ±‚ï¼Œæ˜¾ç¤ºåç§°ä¸º æµ‹è¯•éœ€æ±‚2ã€‚ å±æ€§ï¼š id: 2ï¼ˆéœ€æ±‚ç¼–å·ä¸º 2ï¼‰ã€‚ text: &quot;æµ‹è¯•æ–‡æœ¬&quot;ï¼ˆæè¿°æ–‡æœ¬ä¸ç¬¬ä¸€ä¸ªéœ€æ±‚ç›¸åŒï¼‰ã€‚ risk: Highï¼ˆé«˜é£é™©éœ€æ±‚ï¼‰ã€‚ verifymethod: testï¼ˆéªŒè¯æ–¹æ³•ä¸ºæµ‹è¯•ï¼‰ã€‚å®ä½“å®šä¹‰ element &quot;æµ‹è¯•å®ä½“&quot; å®šä¹‰ä¸€ä¸ªç³»ç»Ÿå®ä½“ï¼Œæ˜¾ç¤ºåç§°ä¸º æµ‹è¯•å®ä½“ã€‚ å±æ€§ï¼š type: &quot;æ¨¡æ‹Ÿ&quot;ï¼ˆå®ä½“ç±»å‹ä¸º &quot;æ¨¡æ‹Ÿ&quot;ï¼‰ã€‚ Gitgraph Diagram ç”¨äºç»˜åˆ¶Gitå›¾ï¼Œæ˜¾ç¤ºä»£ç ä»“åº“çš„æäº¤å†å²å’Œåˆ†æ”¯å…³ç³»ã€‚ Mermaid Gitgraph Diagram type ä¸º &quot;gitgraph&quot; 1234567891011&#123;% mermaid gitGraph %&#125;commitcommitcommitbranch newbranchcheckout newbranchcommitcommitcheckout mainmerge newbranch&#123;% endmermaid %&#125; æ•ˆæœ gitGraph commit commit commit branch newbranch checkout newbranch commit commit checkout main merge newbranch è¯´æ˜ 1234567891011121314åŸºæœ¬ç»“æ„gitGraph å®šä¹‰è¿™æ˜¯ä¸€ä¸ª Git å›¾ã€‚commit è¡¨ç¤ºä¸€æ¬¡æäº¤æ“ä½œï¼Œæ¯ä¸ª commit èŠ‚ç‚¹ä»£è¡¨ä»£ç ä»“åº“çš„æŸä¸ªæäº¤ç‚¹ã€‚branch åˆ›å»ºä¸€ä¸ªæ–°åˆ†æ”¯ã€‚ æ ¼å¼ï¼šbranch åˆ†æ”¯åç§°ã€‚checkout åˆ‡æ¢åˆ°æŒ‡å®šåˆ†æ”¯ã€‚ æ ¼å¼ï¼šcheckout åˆ†æ”¯åç§°ã€‚merge å°†æŒ‡å®šåˆ†æ”¯åˆå¹¶åˆ°å½“å‰åˆ†æ”¯ã€‚ æ ¼å¼ï¼šmerge åˆ†æ”¯åç§°ã€‚ Mindmap ç”¨äºç»˜åˆ¶æ€ç»´å¯¼å›¾ï¼Œæ˜¾ç¤ºä¸»é¢˜å’Œå­ä¸»é¢˜ä¹‹é—´çš„ hierarchical å…³ç³»ã€‚ Mermaid Mindmap type ä¸º &quot;mindmap&quot; 123456789101112131415161718&#123;% mermaid mindmap %&#125;root((mindmap)) (origins) Long history ::icon(fa fa-book) Popularisation British popular psychology author Tony Buzan [Research] On effectivness&lt;br/&gt;and features On Automatic creation Uses Creative techniques Strategic planning Argument mapping Tools Pen and paper Mermaid&#123;% endmermaid %&#125; æ•ˆæœ mindmap root((mindmap)) (origins) Long history ::icon(fa fa-book) Popularisation British popular psychology author Tony Buzan [Research] On effectivness&lt;br/&gt;and features On Automatic creation Uses Creative techniques Strategic planning Argument mapping Tools Pen and paper Mermaid è¯´æ˜ 123456789101112131415åŸºæœ¬ç»“æ„mindmap å®šä¹‰è¿™æ˜¯ä¸€ä¸ªæ€ç»´å¯¼å›¾ã€‚root((mindmap)) å®šä¹‰æ€ç»´å¯¼å›¾çš„æ ¹èŠ‚ç‚¹ï¼Œæ˜¾ç¤ºä¸ºåœ†å½¢å¹¶æ ‡æ³¨ä¸º &quot;mindmap&quot;ã€‚å­èŠ‚ç‚¹ä½¿ç”¨ç¼©è¿›è¡¨ç¤ºä»å±å…³ç³»ï¼š æ¯ä¸€çº§ç¼©è¿›ä»£è¡¨ä¸€ä¸ªå±‚çº§çš„å­èŠ‚ç‚¹ã€‚ å­èŠ‚ç‚¹å¯ä»¥ç›´æ¥æ·»åŠ å†…å®¹æˆ–é€šè¿‡ &lt;br/&gt; æ¢è¡Œã€‚::icon(...) ä¸ºèŠ‚ç‚¹æ·»åŠ å›¾æ ‡ã€‚Mermaid.js æ”¯æŒä½¿ç”¨ FontAwesome çš„å›¾æ ‡ã€‚èŠ‚ç‚¹å½¢çŠ¶é•¿æ–¹å½¢ [] ï¼šå¦‚ [é•¿æ–¹å½¢]ï¼Œæ˜¯é»˜è®¤çš„çŸ©å½¢èŠ‚ç‚¹ã€‚è¿™ä¸ªæ˜¯é»˜è®¤çš„èŠ‚ç‚¹ç±»å‹ã€‚åœ†å½¢ (()) ï¼šå¦‚ ((åœ†))ï¼Œç”¨äºè¡¨ç¤ºä¸€ä¸ªåœ†å½¢èŠ‚ç‚¹ã€‚åœ†è§’é•¿æ–¹å½¢ () ï¼šå¦‚ (åœ†è§’é•¿æ–¹å½¢)ï¼Œç”¨äºè¡¨ç¤ºåœ†è§’çŸ©å½¢èŠ‚ç‚¹ã€‚ QuadrantChart ç”¨äºç»˜åˆ¶è±¡é™å›¾ï¼Œæ˜¾ç¤ºä¸åŒç»´åº¦ä¹‹é—´çš„æ¯”è¾ƒå…³ç³»ã€‚ Mermaid QuadrantChart type ä¸º &quot;quadrantChart&quot; 12345678910111213141516&#123;% mermaid quadrantChart %&#125;%%&#123;init: &#123;&quot;quadrantChart&quot;: &#123;&quot;chartHeight&quot;: 600, &quot;chartWidth&quot;: 800, &quot;pointTextPadding&quot;: 10&#125;, &quot;themeVariables&quot;: &#123;&quot;quadrant1Fill&quot;: &quot;#ff0000&quot;, &quot;quadrant2Fill&quot;: &quot;#FFFF00&quot;, &quot;quadrant3Fill&quot;: &quot;#32CD32&quot;, &quot;quadrant4Fill&quot;: &quot;#800080&quot;&#125;&#125;&#125;%%title Reach and engagement of carpaignsx-axis Low Reach --&gt; High Reachy-axis Low Engagement --&gt; High Engagementquadrant-1 we should expandquadrant-2 Need to promotequadrant-3 Re-evaluatequadrant-4 May be improvedCampaign A: [0.3,0.6]Campaign B: [0.45,0.23]Campaign C: [0.57,0.69]Campaign D: [0.78,0.34]Campaign E: [0.40,0.34]Campaign F: [0.35,0.78]&#123;% endmermaid %&#125; æ•ˆæœ %%&#123;init: &#123;&quot;quadrantChart&quot;: &#123;&quot;chartHeight&quot;: 600, &quot;chartWidth&quot;: 800, &quot;pointTextPadding&quot;: 10&#125;, &quot;themeVariables&quot;: &#123;&quot;quadrant1Fill&quot;: &quot;#ff0000&quot;, &quot;quadrant2Fill&quot;: &quot;#FFFF00&quot;, &quot;quadrant3Fill&quot;: &quot;#32CD32&quot;, &quot;quadrant4Fill&quot;: &quot;#800080&quot;&#125;&#125;&#125;%% quadrantChart title Reach and engagement of carpaigns x-axis Low Reach --&gt; High Reach y-axis Low Engagement --&gt; High Engagement quadrant-1 we should expand quadrant-2 Need to promote quadrant-3 Re-evaluate quadrant-4 May be improved Campaign A: [0.3,0.6] Campaign B: [0.45,0.23] Campaign C: [0.57,0.69] Campaign D: [0.78,0.34] Campaign E: [0.40,0.34] Campaign F: [0.35,0.78] è¯´æ˜ 12345678910111213141516171819202122232425262728293031323334353637åŸºæœ¬ç»“æ„%%&#123;init: ...&#125;%% è¿™æ˜¯ Mermaid.js çš„åˆå§‹åŒ–é…ç½®å—ï¼Œç”¨äºè‡ªå®šä¹‰å›¾è¡¨çš„å…¨å±€å‚æ•°å’Œæ ·å¼ã€‚ é…ç½®å†…å®¹ï¼Œè¯¦è§ä¸‹æ–‡ï¼š quadrantChartï¼šè‡ªå®šä¹‰è±¡é™å›¾çš„ç›¸å…³å‚æ•°ã€‚ themeVariablesï¼š å›¾è¡¨ä¸»é¢˜é…è‰²ã€‚quadrantChart å®šä¹‰è¿™æ˜¯ä¸€ä¸ªè±¡é™å›¾ã€‚title æ ‡é¢˜åæ ‡è½´ï¼Œå®šä¹‰ X è½´å’Œ Y è½´çš„èŒƒå›´å’Œæ–¹å‘ï¼šx-axis Low Reach --&gt; High Reach X è½´ ä» â€œLow Reachâ€ åˆ° â€œHigh Reachâ€ã€‚y-axis Low Engagement --&gt; High Engagement Y è½´ ä» â€œLow Engagementâ€ åˆ° â€œHigh Engagementâ€ã€‚è±¡é™å®šä¹‰quadrant-1 we should expand è±¡é™ 1ï¼ˆå³ä¸Šï¼‰ï¼š&quot;we should expand&quot;quadrant-2 Need to promote è±¡é™ 2ï¼ˆå·¦ä¸Šï¼‰ï¼š&quot;Need to promote&quot;quadrant-3 Re-evaluate è±¡é™ 3ï¼ˆå·¦ä¸‹ï¼‰ï¼š&quot;Re-evaluate&quot;quadrant-4 May be improved è±¡é™ 4ï¼ˆå³ä¸‹ï¼‰ï¼š&quot;May be improved&quot;æ•°æ®ç‚¹Campaign A: [0.3,0.6]Campaign B: [0.45,0.23]Campaign C: [0.57,0.69]Campaign D: [0.78,0.34]Campaign E: [0.40,0.34]Campaign F: [0.35,0.78]å®šä¹‰äº† 6 ä¸ªæ´»åŠ¨ï¼ˆCampaignï¼‰çš„æ•°æ®ç‚¹ï¼Œä½¿ç”¨ [name]: [x, y] çš„æ ¼å¼æ¥æ·»åŠ æ•°æ®ç‚¹ï¼Œå…¶ä¸­ [name] æ˜¯æ•°æ®ç‚¹çš„åç§°ï¼Œ[x, y] æ˜¯æ•°æ®ç‚¹åœ¨ x è½´å’Œ y è½´ä¸Šçš„åæ ‡å€¼ï¼Œå¯¹äºç‚¹xå’Œyå€¼ï¼Œæœ€å°å€¼ä¸º0ï¼Œæœ€å¤§å€¼ä¸º1ã€‚X å€¼ï¼šè¡¨ç¤ºæ´»åŠ¨çš„ Reachï¼ˆè¦†ç›–é¢ï¼‰ã€‚Y å€¼ï¼šè¡¨ç¤ºæ´»åŠ¨çš„ Engagementï¼ˆå‚ä¸åº¦ï¼‰ã€‚ åˆå§‹åŒ–é…ç½® quadrantChartï¼šè‡ªå®šä¹‰è±¡é™å›¾çš„ç›¸å…³å‚æ•° å‚æ•° æè¿° é»˜è®¤å€¼ chartHeight å›¾è¡¨çš„é«˜åº¦ 500 chartWidth å›¾è¡¨çš„å®½åº¦ 500 pointLabelFontSize ç‚¹æ–‡æœ¬å­—ä½“å¤§å° 12 pointRadius è¦ç»˜åˆ¶çš„ç‚¹çš„åŠå¾„ 5 pointTextPadding ç‚¹å’Œä¸‹é¢æ–‡æœ¬ä¹‹é—´çš„å¡«å…… 5 quadrantExternalBorderStrokeWidth è±¡é™å¤–è¾¹æ¡†æè¾¹å®½åº¦ 2 quadrantInternalBorderStrokeWidth è±¡é™å†…çš„è¾¹æ¡†æè¾¹å®½åº¦ 1 quadrantLabelFontSize è±¡é™æ–‡æœ¬å­—ä½“å¤§å° 16 quadrantPadding æ‰€æœ‰è±¡é™å¤–çš„å¡«å…… 5 quadrantTextTopPadding å½“æ–‡æœ¬ç»˜åˆ¶åœ¨é¡¶éƒ¨æ—¶è±¡é™æ–‡æœ¬é¡¶éƒ¨å¡«å……ï¼ˆé‚£é‡Œæ²¡æœ‰æ•°æ®ç‚¹ï¼‰ 5 titlePadding æ ‡é¢˜çš„é¡¶éƒ¨å’Œåº•éƒ¨å¡«å…… 10 titleFontSize æ ‡é¢˜å­—ä½“å¤§å° 20 xAxisLabelPadding x è½´æ–‡æœ¬çš„é¡¶éƒ¨å’Œåº•éƒ¨å¡«å…… 5 xAxisLabelFontSize X è½´æ–‡æœ¬å­—ä½“å¤§å° 16 xAxisPosition x è½´çš„ä½ç½®ï¼ˆé¡¶éƒ¨ã€åº•éƒ¨ï¼‰å¦‚æœæœ‰ç‚¹ï¼Œåˆ™ x è½´å°†å§‹ç»ˆæ¸²æŸ“åœ¨åº•éƒ¨ â€˜topâ€™ yAxisLabelPadding y è½´æ–‡æœ¬çš„å·¦å³å¡«å…… 5 yAxisLabelFontSize Y è½´æ–‡æœ¬å­—ä½“å¤§å° 16 yAxisPosition y è½´ä½ç½®ï¼ˆå·¦ã€å³ï¼‰ â€˜leftâ€™ themeVariablesï¼š å›¾è¡¨ä¸»é¢˜é…è‰² å‚æ•° æè¿° quadrant1Fill å³ä¸Šè±¡é™çš„å¡«å……é¢œè‰² quadrant2Fill å·¦ä¸Šè±¡é™çš„å¡«å……é¢œè‰² quadrant3Fill å·¦ä¸‹è±¡é™çš„å¡«å……é¢œè‰² quadrant4Fill å³ä¸‹è±¡é™çš„å¡«å……é¢œè‰² quadrant1TextFill å³ä¸Šè±¡é™çš„æ–‡æœ¬é¢œè‰² quadrant2TextFill å·¦ä¸Šè±¡é™çš„æ–‡æœ¬é¢œè‰² quadrant3TextFill å·¦ä¸‹è±¡é™çš„æ–‡æœ¬é¢œè‰² quadrant4TextFill å³ä¸‹è±¡é™çš„æ–‡æœ¬é¢œè‰² quadrantPointFill ç‚¹å¡«å……é¢œè‰² quadrantPointTextFill ç‚¹æ–‡æœ¬é¢œè‰² quadrantXAxisTextFill X è½´æ–‡æœ¬é¢œè‰² quadrantYAxisTextFill Y è½´æ–‡æœ¬é¢œè‰² quadrantInternalBorderStrokeFill è±¡é™å†…è¾¹æ¡†é¢œè‰² quadrantExternalBorderStrokeFill è±¡é™å¤–è¾¹æ¡†é¢œè‰² quadrantTitleFill æ ‡é¢˜é¢œè‰²","summary":"æ‘˜è¦ Mermaid æ˜¯ä¸€ä¸ªæ”¯æŒåœ¨Markdownæ–‡æ¡£ä¸­ç»˜åˆ¶æµç¨‹å›¾ã€ç”˜ç‰¹å›¾ã€åºåˆ—å›¾ç­‰å›¾å½¢çš„å·¥å…·ã€‚å®ƒåŸºäºJavaScriptå®ç°ï¼Œèƒ½å¤Ÿå°†Markdownä¸­çš„å…ƒç´ æ¸²æŸ“æˆHTMLå…ƒç´ ï¼Œä»è€Œåœ¨ç½‘é¡µä¸Šç›´è§‚åœ°å±•ç¤ºå„ç§å›¾è¡¨â€Œ Nextä¸»é¢˜ä¸­ä½¿ç”¨Mermaidè¯´æ˜ æœ¬æ–‡ä»‹ç»å¦‚ä½•åœ¨ Hexo-Next ä¸»é¢˜ä¸­ä½¿ç”¨ Mermaid","date_published":"2025-01-02T13:55:05.000Z","tags":["Hexo","Hexo"]},{"id":"https://blog.hanqunfeng.com/2024/11/28/brew/","url":"https://blog.hanqunfeng.com/2024/11/28/brew/","title":"MacOSè½¯ä»¶åŒ…ç®¡ç†å™¨--brew","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\n-->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><a href=\"https://brew.sh\">brew</a>æ˜¯ä¸€ä¸ªè½¯ä»¶åŒ…ç®¡ç†å™¨ï¼ŒåŒæ—¶æ”¯æŒMacOSå’ŒLinuxï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿åœ°å®‰è£…å„ç§è½¯ä»¶ï¼Œæ¯”å¦‚<code>git</code>ã€<code>node</code>ã€<code>python</code>ç­‰ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><code>brew</code>è™½ç„¶æ”¯æŒlinuxï¼Œä½†æ˜¯å®é™…ä½¿ç”¨ä¸­å¾ˆå°‘ä¼šä½¿ç”¨brewæ¥ç®¡ç†linuxçš„è½¯ä»¶åŒ…ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç»å¦‚ä½•åœ¨macosä¸‹å®‰è£…brewï¼Œä»¥åŠå¦‚ä½•ä½¿ç”¨brewç®¡ç†å„ç§è½¯ä»¶åŒ…ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡åŸºäº MacOS Intel Ventura 13.7.1ï¼Œbrew ç‰ˆæœ¬ä¸º4.4.8ã€‚</p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"å®‰è£…\">å®‰è£…</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>é¦–å…ˆè¦ç¡®ä¿ç³»ç»Ÿä¸­å®‰è£…äº† <code>git</code> å’Œ <code>curl</code>ï¼Œå¯¹äº macOS ç”¨æˆ·æ¥è¯´ï¼Œè¿™äº›ç³»ç»Ÿéƒ½è‡ªå¸¦äº†ï¼Œå”¯ä¸€éœ€é¢å¤–è¦æ±‚å®‰è£…çš„æ˜¯<code>Command Line Tools (CLT) for Xcode</code>ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æ£€æŸ¥ç³»ç»Ÿä¸­æ˜¯å¦å®‰è£…äº† Command Line Tools (CLT) for Xcode</span></span><br><span class=\"line\">xcode-select --version <span class=\"comment\"># èƒ½å¤Ÿè¾“å‡ºç‰ˆæœ¬å·è¯´æ˜å®‰è£…äº†ï¼Œå¦åˆ™éœ€è¦å®‰è£…ã€‚</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å®‰è£… Command Line Tools (CLT) for Xcode</span></span><br><span class=\"line\">xcode-select --install</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ‰“å°å½“å‰çš„ Command Line Tools (CLT) for Xcode çš„å®‰è£…è·¯å¾„</span></span><br><span class=\"line\">xcode-select -p <span class=\"comment\"># /Library/Developer/CommandLineTools</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"åœ¨MacOSä¸Šå®‰è£…brewçš„æ–¹æ³•\">åœ¨MacOSä¸Šå®‰è£…brewçš„æ–¹æ³•</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><a href=\"https://github.com/Homebrew/install\">å‚è€ƒèµ„æ–™</a></p>\n</li>\n</ul>\n<h4 id=\"æ–¹æ³•ä¸€ï¼šä½¿ç”¨è„šæœ¬å®‰è£…\">æ–¹æ³•ä¸€ï¼šä½¿ç”¨è„šæœ¬å®‰è£…</h4>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/bin/bash -c <span class=\"string\">&quot;<span class=\"subst\">$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)</span>&quot;</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å®‰è£…æ—¶å¯ä»¥æŒ‡å®šé•œåƒä¸‹è½½æºï¼Œé»˜è®¤æ˜¯<a href=\"https://github.com/Homebrew/brew.git\">Homebrewçš„GitHubä¸‹è½½æº</a>ï¼Œä¹Ÿå¯ä»¥é€‰æ‹©å›½å†…çš„é•œåƒæºï¼Œæ¯”å¦‚ä½¿ç”¨<a href=\"https://mirrors.tuna.tsinghua.edu.cn/help/homebrew/\">æ¸…åå¤§å­¦çš„Homebrew</a>é•œåƒæº</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æ§åˆ¶äº† Homebrew åœ¨å®‰è£…è½¯ä»¶åŒ…æ—¶æ˜¯å¦ä» Homebrew çš„ API æœåŠ¡å™¨è·å–ä¿¡æ¯ï¼Œbrew4.0åæ˜¯é»˜è®¤è¡Œä¸ºï¼Œæ— éœ€è®¾ç½®</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> HOMEBREW_INSTALL_FROM_API=1</span><br><span class=\"line\"><span class=\"comment\"># è®¾ç½®brewä»“åº“ä¸Šæ¸¸</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> HOMEBREW_BREW_GIT_REMOTE=<span class=\"string\">&quot;https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/brew.git&quot;</span></span><br><span class=\"line\"><span class=\"comment\"># è®¾ç½®homebrewæ ¸å¿ƒä¸Šæ¸¸</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> HOMEBREW_CORE_GIT_REMOTE=<span class=\"string\">&quot;https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/homebrew-core.git&quot;</span></span><br><span class=\"line\">/bin/bash -c <span class=\"string\">&quot;<span class=\"subst\">$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)</span>&quot;</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"æ–¹æ³•äºŒï¼šä½¿ç”¨PKGæ–‡ä»¶å®‰è£…\">æ–¹æ³•äºŒï¼šä½¿ç”¨PKGæ–‡ä»¶å®‰è£…</h4>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä»<a href=\"https://github.com/Homebrew/brew\">Homebrewçš„github</a>ä¸Šä¸‹è½½æœ€æ–°ç‰ˆçš„<a href=\"https://github.com/Homebrew/brew/releases/latest\">Homebrew-x.x.x.pkg</a></p>\n</li>\n</ul>\n<h4 id=\"æ–¹æ³•ä¸‰ï¼šå›½å†…æ— æ³•è®¿é—®githubåœ°å€æ—¶å¯ä»¥ä½¿ç”¨å›½å†…é•œåƒæº\">æ–¹æ³•ä¸‰ï¼šå›½å†…æ— æ³•è®¿é—®githubåœ°å€æ—¶å¯ä»¥ä½¿ç”¨å›½å†…é•œåƒæº</h4>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¿™é‡Œä¾æ—§ä»¥æ¸…åå¤§å­¦çš„Homebrewé•œåƒæºä¸ºä¾‹</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">export</span> HOMEBREW_BREW_GIT_REMOTE=<span class=\"string\">&quot;https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/brew.git&quot;</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> HOMEBREW_CORE_GIT_REMOTE=<span class=\"string\">&quot;https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/homebrew-core.git&quot;</span></span><br><span class=\"line\"><span class=\"comment\"># ä»é•œåƒä¸‹è½½å®‰è£…è„šæœ¬å¹¶å®‰è£… Homebrew / Linuxbrew</span></span><br><span class=\"line\">git <span class=\"built_in\">clone</span> --depth=1 https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/install.git brew-install</span><br><span class=\"line\">/bin/bash brew-install/install.sh</span><br><span class=\"line\"><span class=\"built_in\">rm</span> -rf brew-install</span><br></pre></td></tr></table></figure>\n<h4 id=\"éªŒè¯æ˜¯å¦å®‰è£…æˆåŠŸ\">éªŒè¯æ˜¯å¦å®‰è£…æˆåŠŸ</h4>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><code>brew</code> å‘½ä»¤æœ¬èº«åŠé€šè¿‡brewå®‰è£…çš„æ‰€æœ‰å‘½ä»¤éƒ½ä¼šè¢«è½¯é“¾æ¥åˆ°<code>/usr/local/bin/</code>ä¸‹ï¼Œæ‰€ä»¥éœ€è¦å°†è¯¥è·¯å¾„åŠ å…¥ç³»ç»Ÿç¯å¢ƒPATHä¸­</p>\n</li>\n<li class=\"lvl-2\">\n<p>é‡å¯ç»ˆç«¯ï¼Œç„¶åæ‰§è¡Œ<code>brew -v</code>å‘½ä»¤æŸ¥çœ‹brewçš„ç‰ˆæœ¬ï¼Œå¦‚æœå®‰è£…æˆåŠŸï¼Œä¼šè¾“å‡ºç±»ä¼¼å¦‚ä¸‹å†…å®¹</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ brew -v</span><br><span class=\"line\">Homebrew 4.4.8-40-g13c3def</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Homebrewæœ¬èº«çš„å®‰è£…ä½ç½®å¯ä»¥é€šè¿‡<code>brew --repo</code>æŸ¥çœ‹ï¼Œé»˜è®¤ä¸º<code>/usr/local/Homebrew</code></p>\n</li>\n<li class=\"lvl-2\">\n<p>é€šè¿‡brewå®‰è£…çš„è½¯ä»¶åŒ…é»˜è®¤ä¼šè¢«å®‰è£…åˆ°<code>/usr/local/Cellar/</code>ä¸‹ï¼Œæ¯”å¦‚<code>git</code>å®‰è£…åä¼šåœ¨<code>/usr/local/Cellar/git/</code>ç›®å½•ä¸‹ï¼Œå¯ä»¥é€šè¿‡<code>brew info git</code>æŸ¥çœ‹å®‰è£…ä¿¡æ¯ï¼ŒåŒ…æ‹¬ä¾èµ–åº“ç­‰ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æ˜¾ç¤º Homebrew å®‰è£…è·¯å¾„ï¼ŒmacOS ARM: /opt/homebrewï¼ŒmacOS Intel: /usr/local</span></span><br><span class=\"line\">$ brew --prefix</span><br><span class=\"line\">/usr/local</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ˜¾ç¤º Homebrew æœ¬åœ°çš„ Git ä»“åº“</span></span><br><span class=\"line\">$ brew --repo</span><br><span class=\"line\">/usr/local/Homebrew</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ˜¾ç¤º Homebrew Cellar è·¯å¾„ï¼Œå‘½ä»¤è¡Œå·¥å…·çš„å®‰è£…è·¯å¾„</span></span><br><span class=\"line\">$ brew --cellar</span><br><span class=\"line\">/usr/local/Cellar</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ˜¾ç¤º Homebrew Caskroom è·¯å¾„ï¼ŒGUIå·¥å…·çš„å®‰è£…è·¯å¾„</span></span><br><span class=\"line\">$ brew --caskroom</span><br><span class=\"line\">/usr/local/Caskroom</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ç¼“å­˜è·¯å¾„ï¼Œä¸‹è½½å®‰è£…åŒ…çš„ç¼“å­˜è·¯å¾„ï¼Œé€šè¿‡ brew cleanup æ¸…ç†</span></span><br><span class=\"line\">$ brew --cache</span><br><span class=\"line\">~/Library/Caches/Homebrew</span><br></pre></td></tr></table></figure>\n<h4 id=\"é…ç½®å‘½ä»¤è¡¥å…¨\">é…ç½®å‘½ä»¤è¡¥å…¨</h4>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å‚è€ƒå®˜ç½‘<a href=\"https://docs.brew.sh/Shell-Completion\">Homebrew Documentationâ€“brew Shell Completion</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>æˆ‘è¿™é‡Œä½¿ç”¨çš„æ˜¯<code>zsh</code>ï¼Œåœ¨<code>~/.zshrc</code>ä¸­åŠ å…¥å¦‚ä¸‹å†…å®¹å¹¶é‡å¯ç»ˆç«¯å³å¯ç”Ÿæ•ˆ</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">autoload</span> -Uz compinit</span><br><span class=\"line\">compinit</span><br></pre></td></tr></table></figure>\n<h4 id=\"å¸è½½brew\">å¸è½½brew</h4>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/bin/bash -c <span class=\"string\">&quot;<span class=\"subst\">$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/uninstall.sh)</span>&quot;</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"å¸¸ç”¨å‘½ä»¤\">å¸¸ç”¨å‘½ä»¤</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><code>brew</code>æ”¯æŒå®‰è£…<code>å‘½ä»¤è¡Œå·¥å…·(formula)</code>å’Œ<code>GUIå·¥å…·(cask)</code></p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-5\"><code>brew install xxx</code> å®‰è£…å‘½ä»¤è¡Œå·¥å…·ï¼Œè¿™ä¸ªæœ€ä¸ºå¸¸ç”¨ï¼Œæ¯”å¦‚ <code>brew install fd</code></li>\n<li class=\"lvl-5\"><code>brew install --cask xxx</code> å®‰è£…GUIå·¥å…·ï¼Œä¸€èˆ¬å¾ˆå°‘ä½¿ç”¨brewå®‰è£…GUIå·¥å…·ï¼Œæ¯”å¦‚ <code>brew install --cask firefox</code></li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<p>brewçš„å‘½ä»¤å’Œå‚æ•°éå¸¸å¤šï¼Œä½†æ—¥å¸¸ä½¿ç”¨åªéœ€è¦è®°ä½å¸¸ç”¨çš„å‡ ä¸ªå°±å¤Ÿäº†ï¼Œè¯¦ç»†çš„å‘½ä»¤åˆ—è¡¨å¯ä»¥å‚è€ƒ<a href=\"https://docs.brew.sh/Manpage\">Homebrew Documentation</a></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹brewæ”¯æŒå“ªäº›å‘½ä»¤</span></span><br><span class=\"line\">brew commands</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹å‘½ä»¤çš„å¸®åŠ©ä¿¡æ¯ï¼Œæ¯”å¦‚</span></span><br><span class=\"line\">brew install --<span class=\"built_in\">help</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"ä¸€äº›å¸¸ç”¨çš„å‘½ä»¤\">ä¸€äº›å¸¸ç”¨çš„å‘½ä»¤</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">brew update <span class=\"comment\"># æ›´æ–°brewåˆ°æœ€æ–°ç‰ˆæœ¬</span></span><br><span class=\"line\">brew --version <span class=\"comment\"># æŸ¥çœ‹brewçš„ç‰ˆæœ¬ï¼Œå¯ä»¥ç®€å†™ä¸º brew -v</span></span><br><span class=\"line\">brew config <span class=\"comment\"># æŸ¥çœ‹brewçš„é…ç½®ä¿¡æ¯ï¼Œè¿™ä¸ªå‘½ä»¤å¾ˆæœ‰ç”¨ï¼Œå¯ä»¥æŸ¥çœ‹åˆ°ä¸brewç›¸å…³çš„ç¯å¢ƒå˜é‡çš„å€¼</span></span><br><span class=\"line\">brew home <span class=\"comment\"># æµè§ˆå™¨æ‰“å¼€brewå®˜ç½‘</span></span><br><span class=\"line\">brew home xxx <span class=\"comment\"># æµè§ˆå™¨æ‰“å¼€xxxå®˜ç½‘ å¦‚ï¼šæ‰“å¼€fdå‘½ä»¤çš„å®˜ç½‘ brew home fd ,å…·ä½“çš„åç§°å¯ä»¥é€šè¿‡brew listæŸ¥çœ‹</span></span><br><span class=\"line\">brew cleanup <span class=\"comment\"># æ¸…ç†ç¼“å­˜åŠæ—¥å¿—æ–‡ä»¶ï¼Œå»ºè®®å®šæœŸæ¸…ç†ï¼Œå½“è¿è¡Œbrewæ—¶ä¼šè‡ªåŠ¨æ¸…ç†ï¼ˆ2.0ä»¥åçš„ç‰ˆæœ¬ï¼‰</span></span><br><span class=\"line\">brew cleanup -n <span class=\"comment\"># æ˜¾ç¤ºå°†è¦æ¸…ç†çš„ç¼“å­˜åŠæ—¥å¿—æ–‡ä»¶ï¼ŒåªæŸ¥çœ‹ä¸åˆ é™¤</span></span><br><span class=\"line\">brew doctor <span class=\"comment\"># æ£€æŸ¥æ˜¯å¦æœ‰ä¾èµ–é—®é¢˜ï¼Œæ¯”å¦‚æ²¡æœ‰å®‰è£…ä¾èµ–åº“ï¼Œæˆ–è€…ä¾èµ–åº“ç‰ˆæœ¬è¿‡ä½ï¼Œå½“è¿è¡ŒbrewæŠ¥é”™æ—¶å¯ä»¥é€šè¿‡è¯¥å‘½ä»¤è¿›è¡Œæ£€æŸ¥å¹¶æ ¹æ®æç¤ºè¿›è¡Œä¿®æ”¹</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æŸ¥çœ‹å·²å®‰è£…çš„åŒ…</p>\n</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹</span></span><br><span class=\"line\">brew list <span class=\"comment\"># æŸ¥çœ‹å·²å®‰è£…çš„åŒ…</span></span><br><span class=\"line\">brew list --versions <span class=\"comment\"># æŸ¥çœ‹å·²å®‰è£…çš„åŒ…åŠç‰ˆæœ¬</span></span><br><span class=\"line\">brew info xxx <span class=\"comment\"># æŸ¥çœ‹xxxçš„å®‰è£…ä¿¡æ¯</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å®‰è£…ã€å¸è½½</p>\n</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æŸ¥æ‰¾ã€å®‰è£…ã€å¸è½½</span></span><br><span class=\"line\">brew search xxx <span class=\"comment\"># æŸ¥æ‰¾è½¯ä»¶åŒ…ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ https://formulae.brew.sh ç½‘é¡µè¿›è¡Œæœç´¢</span></span><br><span class=\"line\">brew install xxx <span class=\"comment\"># å®‰è£…è½¯ä»¶åŒ…ï¼Œæ­¤å‘½ä»¤ç›¸å½“äºåŠ ä¸Šäº† --formula ï¼Œå®‰è£…æ—¶ä¼šè‡ªåŠ¨ä¸‹è½½ä¾èµ–åº“ï¼Œæ¯”å¦‚å®‰è£…`nginx`æ—¶ï¼Œä¼šè‡ªåŠ¨ä¸‹è½½`openssl@3`å’Œ`pcre2`ç­‰</span></span><br><span class=\"line\">brew install --cask xxx <span class=\"comment\"># å®‰è£…GUIå·¥å…·ï¼Œæ¯”å¦‚`firefox`</span></span><br><span class=\"line\">brew uninstall xxx <span class=\"comment\"># å¸è½½è½¯ä»¶åŒ…ï¼Œæ­¤å‘½ä»¤ç›¸å½“äºåŠ ä¸Šäº† --formula ï¼Œåªä¼šå¸è½½å½“å‰åŒ…ï¼Œä¸ä¼šå¸è½½ä¾èµ–åº“ï¼Œè¿™æ ·å°±æœ‰å¯èƒ½å­˜åœ¨å¾ˆå¤šå†—ä½™åŒ…</span></span><br><span class=\"line\">brew uninstall --cask xxx <span class=\"comment\"># å¸è½½GUIå·¥å…·</span></span><br><span class=\"line\">brew autoremove <span class=\"comment\"># åˆ é™¤æ‰€æœ‰ä»…ä½œä¸ºå¦ä¸€ä¸ªè½¯ä»¶åŒ…çš„ä¾èµ–é¡¹å®‰è£…å¹¶ä¸”ç°åœ¨ä¸å†éœ€è¦çš„åŒ…</span></span><br><span class=\"line\">brew autoremove --dry-run <span class=\"comment\"># --dry-run ä»…æŸ¥çœ‹å“ªäº›åŒ…å¯ä»¥åˆ é™¤ï¼Œå¹¶ä¸ä¼šçœŸçš„åˆ é™¤</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å‡çº§</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å‡çº§</span></span><br><span class=\"line\">brew outdated <span class=\"comment\"># æŸ¥çœ‹éœ€è¦å‡çº§çš„åŒ…</span></span><br><span class=\"line\">brew upgrade xxx <span class=\"comment\"># å‡çº§xxxåˆ°æœ€æ–°ç‰ˆ</span></span><br><span class=\"line\">brew upgrade <span class=\"comment\"># æ›´æ–°å…¨éƒ¨å‘½ä»¤åˆ°æœ€æ–°ç‰ˆ</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¾èµ–å…³ç³»</p>\n</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ä¾èµ–å…³ç³»</span></span><br><span class=\"line\">brew deps --tree xxx <span class=\"comment\"># æ ‘å½¢æ˜¾ç¤ºåŒ…çš„ä¾èµ–æ ‘</span></span><br><span class=\"line\">brew deps --installed --tree <span class=\"comment\"># æ ‘å½¢æ˜¾ç¤ºæ‰€æœ‰å®‰è£…åŒ…çš„ä¾èµ–å…³ç³»</span></span><br><span class=\"line\">brew deps --installed xxx <span class=\"comment\"># æ˜¾ç¤ºå½“å‰å®‰è£…åŒ…çš„ä¾èµ–å…³ç³»ï¼Œçºµå‘å±•ç¤º</span></span><br><span class=\"line\">brew deps --installed --for-each xxx <span class=\"comment\"># æ˜¾ç¤ºå½“å‰å®‰è£…åŒ…çš„ä¾èµ–å…³ç³»ï¼Œæ¨ªå‘å±•ç¤º</span></span><br><span class=\"line\">brew uses --installed xxx <span class=\"comment\"># æŸ¥çœ‹å·²ç»å®‰è£…çš„å“ªäº›å·¥å…·ä¾èµ–å½“å‰åŒ…</span></span><br><span class=\"line\">brew leaves <span class=\"comment\"># æŸ¥çœ‹é¡¶çº§å®‰è£…åŒ…ï¼Œå³ä½ é€šè¿‡brewç›´æ¥å®‰è£…çš„åŒ…ï¼Œè€Œä¸æ˜¯é€šè¿‡å®‰è£…å…¶ä»–è½¯ä»¶åŒ…é—´æ¥å®‰è£…çš„</span></span><br><span class=\"line\">brew leaves | xargs brew deps --installed --for-each --formula <span class=\"comment\"># æŸ¥çœ‹é¡¶çº§åŒ…ï¼Œå¹¶åˆ—å‡ºæ¯ä¸ªé¡¶çº§åŒ…çš„å·²å®‰è£…ä¾èµ–</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä»“åº“ç®¡ç†ï¼Œå‚è€ƒèµ„æ–™<a href=\"https://docs.brew.sh/Taps\">Homebrew Documentationâ€“Taps</a></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ä»“åº“ç®¡ç†</span></span><br><span class=\"line\">brew tap <span class=\"comment\"># æŸ¥çœ‹æ‰€æœ‰å·²å®‰è£…çš„ä»“åº“ï¼Œtapå®‰è£…è·¯å¾„ /usr/local/Homebrew/Library/Taps/</span></span><br><span class=\"line\">brew tap user/repo <span class=\"comment\"># æ·»åŠ ä¸€ä¸ªä»“åº“ï¼Œä»gitthubä¸‹è½½</span></span><br><span class=\"line\">brew tap repo_url <span class=\"comment\"># æ·»åŠ ä¸€ä¸ªä»“åº“ï¼Œä»ç»™å®šçš„ä»“åº“åœ°å€ä¸‹è½½</span></span><br><span class=\"line\">brew untap user/repo <span class=\"comment\"># åˆ é™¤ä¸€ä¸ªä»“åº“</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ä»ç¬¬ä¸‰æ–¹ä»“åº“å®‰è£…å·¥å…·ï¼Œæ­¤æ—¶ä¼šè‡ªåŠ¨å°† homebrew-ffmpeg/ffmpeg è¿™ä¸ªä»“åº“æ·»åŠ åˆ°æœ¬åœ°</span></span><br><span class=\"line\">brew install homebrew-ffmpeg/ffmpeg/ffmpeg</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ›´æ–°ä»“åº“ï¼Œæ— è®ºæ˜¯brewè‡ªå·±çš„ä»“åº“è¿˜æ˜¯ç¬¬ä¸‰æ–¹ä»“åº“ï¼Œéƒ½ä¼šè‡ªåŠ¨æ›´æ–°</span></span><br><span class=\"line\">brew update</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><code>brew services</code>: brewçš„æœåŠ¡ç®¡ç†å·¥å…·ï¼Œå¯ä»¥æ–¹ä¾¿çš„ç®¡ç†é€šè¿‡brewå®‰è£…çš„æœåŠ¡ï¼ŒåŒ…æ‹¬å¯åŠ¨ã€åœæ­¢ã€é‡å¯æœåŠ¡ï¼Œç­‰ç­‰ï¼Œæ¯”å¦‚<code>nginxã€redisã€mysql</code>ç­‰ï¼Œå…·ä½“å‘½ä»¤å¯ä»¥å‚è€ƒ<a href=\"https://docs.brew.sh/Manpage#services-subcommand\">Homebrew Documentation</a></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ç¬¬ä¸€æ¬¡æ‰§è¡Œ services ç›¸å…³çš„å‘½ä»¤æ—¶ä¼šè‡ªåŠ¨ä¸‹è½½ homebrew/servicesï¼Œä¹Ÿå¯ä»¥ é€šè¿‡ brew tap homebrew/services æå‰ä¸‹è½½</span></span><br><span class=\"line\">brew services list <span class=\"comment\"># æŸ¥çœ‹å·²å®‰è£…çš„æ‰€æœ‰æœåŠ¡</span></span><br><span class=\"line\">brew services start nginx <span class=\"comment\"># å¯åŠ¨æœåŠ¡ï¼Œå¹¶æ³¨å†Œåˆ°ç³»ç»Ÿå¯åŠ¨æœåŠ¡åˆ—è¡¨ï¼Œå³åˆ›å»ºç³»ç»Ÿè‡ªå¯åŠ¨æ–‡ä»¶ï¼š ~/Library/LaunchAgents/homebrew.mxcl.nginx.plist</span></span><br><span class=\"line\">brew services stop nginx <span class=\"comment\"># åœæ­¢æœåŠ¡ï¼Œå¹¶ä»ç³»ç»Ÿå¯åŠ¨æœåŠ¡åˆ—è¡¨ä¸­ç§»é™¤ï¼Œå³åˆ é™¤ç³»ç»Ÿè‡ªå¯åŠ¨æ–‡ä»¶</span></span><br><span class=\"line\">brew services <span class=\"built_in\">kill</span> nginx <span class=\"comment\"># ç«‹å³æ€æ­»æœåŠ¡ï¼Œä½†ä¸ä»ç³»ç»Ÿå¯åŠ¨æœåŠ¡åˆ—è¡¨ä¸­ç§»é™¤</span></span><br><span class=\"line\">brew services restart nginx <span class=\"comment\"># é‡å¯æœåŠ¡</span></span><br><span class=\"line\">brew services info nginx <span class=\"comment\"># æŸ¥çœ‹æœåŠ¡çš„çŠ¶æ€å’Œè¿›ç¨‹IP</span></span><br><span class=\"line\">brew services run nginx <span class=\"comment\"># è¿è¡ŒæœåŠ¡ï¼Œä½†ä¸ä¼šä¿å­˜åˆ°æœåŠ¡åˆ—è¡¨ä¸­</span></span><br><span class=\"line\">brew services cleanup <span class=\"comment\"># æ¸…ç†æ— æ•ˆçš„æœåŠ¡ï¼Œå³å·²å¸è½½åº”ç”¨çš„æ— ç”¨çš„é…ç½®</span></span><br><span class=\"line\">brew services --<span class=\"built_in\">help</span> <span class=\"comment\"># æŸ¥çœ‹å¸®åŠ©</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"é…ç½®å›½å†…é•œåƒæº\">é…ç½®å›½å†…é•œåƒæº</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¸Šé¢å®‰è£…éƒ¨åˆ†ä»‹ç»äº†å¦‚ä½•åœ¨å®‰è£…brewæ—¶å°±æŒ‡å®šé•œåƒæºï¼Œä½†æœ‰äº›æ—¶å€™å› ä¸ºæˆ‘ä»¬åœ¨å®‰è£…æ—¶å¿˜è®°é…ç½®ï¼Œæˆ–è€…åŸæ¥çš„é•œåƒæºå·²ç»å¤±æ•ˆéœ€è¦é‡æ–°é…ç½®ï¼Œæ­¤æ—¶å¯ä»¥æŒ‰ç…§ä¸‹é¢çš„æ–¹æ³•è¿›è¡Œé…ç½®ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>æ­¤å¤„ä»¥é…ç½®<a href=\"https://mirrors.tuna.tsinghua.edu.cn/help/homebrew/\">æ¸…åé•œåƒæº</a>ä¸ºä¾‹ï¼Œé˜¿é‡Œé•œåƒæºè¯·å‚è€ƒ<a href=\"https://developer.aliyun.com/mirror/homebrew/\">é˜¿é‡Œçš„å®˜ç½‘æ–‡æ¡£â€“Homebrewé•œåƒ</a>ï¼Œç§‘å¤§æºå‚è€ƒ<a href=\"https://mirrors.ustc.edu.cn/help/brew.git.html\">Homebrew</a></p>\n</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">## ä¸´æ—¶æ›¿æ¢</span></span><br><span class=\"line\"><span class=\"comment\"># é…ç½®brewå›½å†…é•œåƒæº</span></span><br><span class=\"line\">$ <span class=\"built_in\">export</span> HOMEBREW_BREW_GIT_REMOTE=<span class=\"string\">&quot;https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/brew.git&quot;</span></span><br><span class=\"line\"><span class=\"comment\"># é…ç½®brew-coreå›½å†…é•œåƒæº</span></span><br><span class=\"line\">$ <span class=\"built_in\">export</span> HOMEBREW_CORE_GIT_REMOTE=<span class=\"string\">&quot;https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/homebrew-core.git&quot;</span></span><br><span class=\"line\"><span class=\"comment\"># é…ç½®brew-bottleå›½å†…é•œåƒæº</span></span><br><span class=\"line\">$ <span class=\"built_in\">export</span> HOMEBREW_API_DOMAIN=<span class=\"string\">&quot;https://mirrors.tuna.tsinghua.edu.cn/homebrew-bottles/api&quot;</span></span><br><span class=\"line\">$ <span class=\"built_in\">export</span> HOMEBREW_BOTTLE_DOMAIN=<span class=\"string\">&quot;https://mirrors.tuna.tsinghua.edu.cn/homebrew-bottles&quot;</span></span><br><span class=\"line\"><span class=\"comment\"># æ›´æ–°é…ç½®</span></span><br><span class=\"line\">$ brew update</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">## é…ç½®æ°¸ä¹…ç”Ÿæ•ˆï¼Œzshç”¨æˆ·</span></span><br><span class=\"line\"><span class=\"comment\"># é…ç½®brewå›½å†…é•œåƒæº</span></span><br><span class=\"line\">$ <span class=\"built_in\">echo</span> <span class=\"string\">&#x27;export HOMEBREW_BREW_GIT_REMOTE=&quot;https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/brew.git&quot;&#x27;</span> &gt;&gt; ~/.zshrc</span><br><span class=\"line\"><span class=\"comment\"># é…ç½®brew-coreå›½å†…é•œåƒæº</span></span><br><span class=\"line\">$ <span class=\"built_in\">echo</span> <span class=\"string\">&#x27;export HOMEBREW_CORE_GIT_REMOTE=&quot;https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/homebrew-core.git&quot;&#x27;</span> &gt;&gt; ~/.zshrc</span><br><span class=\"line\"><span class=\"comment\"># é…ç½®brew-bottleå›½å†…é•œåƒæº</span></span><br><span class=\"line\">$ <span class=\"built_in\">echo</span> <span class=\"string\">&#x27;export HOMEBREW_API_DOMAIN=&quot;https://mirrors.tuna.tsinghua.edu.cn/homebrew-bottles/api&quot;&#x27;</span> &gt;&gt; ~/.zshrc</span><br><span class=\"line\">$ <span class=\"built_in\">echo</span> <span class=\"string\">&#x27;export HOMEBREW_BOTTLE_DOMAIN=&quot;https://mirrors.tuna.tsinghua.edu.cn/homebrew-bottles&quot;&#x27;</span> &gt;&gt; ~/.zshrc</span><br><span class=\"line\">$ <span class=\"built_in\">source</span> ~/.zshrc</span><br><span class=\"line\"><span class=\"comment\"># æ›´æ–°é…ç½®</span></span><br><span class=\"line\">$ brew update</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ­¤æ—¶æŸ¥çœ‹brewé…ç½®ä¿¡æ¯ï¼Œå¯ä»¥çœ‹åˆ°å·²ç»ç”Ÿæ•ˆäº†</span></span><br><span class=\"line\">$ brew config</span><br><span class=\"line\">HOMEBREW_VERSION: 4.4.8-38-g6089077</span><br><span class=\"line\">ORIGIN: https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/brew.git</span><br><span class=\"line\">HEAD: 60890774e0a70fe93f94973b080068cf7b0d1c93</span><br><span class=\"line\">Last commit: 9 hours ago</span><br><span class=\"line\">Branch: master</span><br><span class=\"line\">Core tap origin: https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/homebrew-core.git</span><br><span class=\"line\">Core tap HEAD: 787d1587bfa92794f7d141063a31773064ef9107</span><br><span class=\"line\">Core tap last commit: 11 minutes ago</span><br><span class=\"line\">Core tap JSON: 29 Nov 09:56 UTC</span><br><span class=\"line\">Core cask tap HEAD: 4c34bd8c418e13160fc79f1ca9312555d2edc254</span><br><span class=\"line\">Core cask tap last commit: 19 minutes ago</span><br><span class=\"line\">Core cask tap JSON: 29 Nov 09:56 UTC</span><br><span class=\"line\">HOMEBREW_PREFIX: /usr/local</span><br><span class=\"line\">HOMEBREW_API_DOMAIN: https://mirrors.tuna.tsinghua.edu.cn/homebrew-bottles/api</span><br><span class=\"line\">HOMEBREW_BOTTLE_DOMAIN: https://mirrors.tuna.tsinghua.edu.cn/homebrew-bottles</span><br><span class=\"line\">HOMEBREW_BREW_GIT_REMOTE: https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/brew.git</span><br><span class=\"line\">HOMEBREW_CASK_OPTS: []</span><br><span class=\"line\">HOMEBREW_CORE_GIT_REMOTE: https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/homebrew-core.git</span><br><span class=\"line\">HOMEBREW_GITHUB_API_TOKEN: <span class=\"built_in\">set</span></span><br><span class=\"line\">HOMEBREW_MAKE_JOBS: 12</span><br><span class=\"line\">HOMEBREW_SORBET_RUNTIME: <span class=\"built_in\">set</span></span><br><span class=\"line\">Homebrew Ruby: 3.3.6 =&gt; /usr/local/Homebrew/Library/Homebrew/vendor/portable-ruby/3.3.6/bin/ruby</span><br><span class=\"line\">CPU: dodeca-core 64-bit kabylake</span><br><span class=\"line\">Clang: 15.0.0 build 1500</span><br><span class=\"line\">Git: 2.43.0 =&gt; /usr/local/bin/git</span><br><span class=\"line\">Curl: 8.7.1 =&gt; /usr/bin/curl</span><br><span class=\"line\">macOS: 13.7.1-x86_64</span><br><span class=\"line\">CLT: 15.0.0.0.1.1694021235</span><br><span class=\"line\">Xcode: N/A</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># é€šè¿‡brewå‡çº§fdï¼Œå¯ä»¥çœ‹åˆ°ä½¿ç”¨äº†æ¸…åæº</span></span><br><span class=\"line\">$ brew upgrade fd</span><br><span class=\"line\">==&gt; Upgrading 1 outdated package:</span><br><span class=\"line\">fd 8.2.1 -&gt; 10.2.0</span><br><span class=\"line\">==&gt; Fetching fd</span><br><span class=\"line\">==&gt; Downloading https://mirrors.tuna.tsinghua.edu.cn/homebrew-bottles/fd-10.2.0.ventura.bottle.tar.gz</span><br><span class=\"line\"><span class=\"comment\">################################################################################################################################################################################### 100.0%</span></span><br><span class=\"line\">==&gt; Verifying attestation <span class=\"keyword\">for</span> fd</span><br><span class=\"line\">==&gt; Upgrading fd</span><br><span class=\"line\">  8.2.1 -&gt; 10.2.0</span><br><span class=\"line\">==&gt; Pouring fd-10.2.0.ventura.bottle.tar.gz</span><br><span class=\"line\">==&gt; Caveats</span><br><span class=\"line\">zsh completions have been installed to:</span><br><span class=\"line\">  /usr/local/share/zsh/site-functions</span><br><span class=\"line\">==&gt; Summary</span><br><span class=\"line\">ğŸº  /usr/local/Cellar/fd/10.2.0: 14 files, 2.9MB</span><br><span class=\"line\">==&gt; Running `brew cleanup fd`...</span><br><span class=\"line\">Disable this behaviour by setting HOMEBREW_NO_INSTALL_CLEANUP.</span><br><span class=\"line\">Hide these hints with HOMEBREW_NO_ENV_HINTS (see `man brew`).</span><br><span class=\"line\">Removing: /usr/local/Cellar/fd/8.2.1... (13 files, 2.4MB)</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ¢å¤ä¸ºé»˜è®¤çš„GitHubé•œåƒæº</p>\n</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ <span class=\"built_in\">unset</span> HOMEBREW_BREW_GIT_REMOTE</span><br><span class=\"line\">$ <span class=\"built_in\">unset</span> HOMEBREW_CORE_GIT_REMOTE</span><br><span class=\"line\">$ <span class=\"built_in\">unset</span> HOMEBREW_API_DOMAIN</span><br><span class=\"line\">$ <span class=\"built_in\">unset</span> HOMEBREW_BOTTLE_DOMAIN</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å¦‚æœæ‚¨ä¹‹å‰æ°¸ä¹…é…ç½®äº† HOMEBREW ç¯å¢ƒå˜é‡ï¼Œè¿˜éœ€è¦åœ¨å¯¹åº”çš„ ~/.bash_profile æˆ–è€… ~/.zshrc é…ç½®æ–‡ä»¶ä¸­ï¼Œå°†å¯¹åº”çš„ HOMEBREW ç¯å¢ƒå˜é‡é…ç½®è¡Œåˆ é™¤</span></span><br><span class=\"line\">$ <span class=\"built_in\">source</span> ~/.zshrc</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ›´æ–°brew</span></span><br><span class=\"line\">$ git -C <span class=\"string\">&quot;<span class=\"subst\">$(brew --repo)</span>&quot;</span> remote set-url origin https://github.com/Homebrew/brew</span><br><span class=\"line\"><span class=\"comment\"># æ›´æ–°brew-coreï¼Œbrew4.0åä¸ä¼šå†ä¸‹è½½brew-coreï¼Œæ‰€ä»¥å¯ä»¥å¿½ç•¥</span></span><br><span class=\"line\"><span class=\"comment\"># ä¸è¿‡ä»ä½ç‰ˆæœ¬å‡çº§ä¸Šæ¥çš„è¿˜ä¼šæœ‰è¿™ä¸ªä»“åº“ï¼Œå¯ä»¥é€šè¿‡ brew tap æŸ¥çœ‹æ˜¯å¦å­˜åœ¨ï¼Œå®é™…ä¸Šæ”¹ä¸æ”¹éƒ½ä¸ä¼šæœ‰å½±å“ï¼Œçœ‹ç€ä¸èˆ’æœå°±ä¿®æ”¹å§</span></span><br><span class=\"line\">$ git -C <span class=\"string\">&quot;<span class=\"subst\">$(brew --repo homebrew/core)</span>&quot;</span> remote set-url origin https://github.com/Homebrew/homebrew-core</span><br><span class=\"line\">$ brew update</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹brewé…ç½®ä¿¡æ¯</span></span><br><span class=\"line\">$ brew config</span><br><span class=\"line\">HOMEBREW_VERSION: 4.4.8-38-g6089077</span><br><span class=\"line\">ORIGIN: https://github.com/Homebrew/brew</span><br><span class=\"line\">HEAD: 60890774e0a70fe93f94973b080068cf7b0d1c93</span><br><span class=\"line\">Last commit: 9 hours ago</span><br><span class=\"line\">Branch: master</span><br><span class=\"line\">Core tap HEAD: 787d1587bfa92794f7d141063a31773064ef9107</span><br><span class=\"line\">Core tap last commit: 13 minutes ago</span><br><span class=\"line\">Core tap JSON: 29 Nov 10:09 UTC</span><br><span class=\"line\">Core cask tap HEAD: 871fe2e8b93aac896a1808571ff11f8b89e6d90e</span><br><span class=\"line\">Core cask tap last commit: 48 seconds ago</span><br><span class=\"line\">Core cask tap JSON: 29 Nov 10:09 UTC</span><br><span class=\"line\">HOMEBREW_PREFIX: /usr/local</span><br><span class=\"line\">HOMEBREW_CASK_OPTS: []</span><br><span class=\"line\">HOMEBREW_GITHUB_API_TOKEN: <span class=\"built_in\">set</span></span><br><span class=\"line\">HOMEBREW_MAKE_JOBS: 12</span><br><span class=\"line\">HOMEBREW_SORBET_RUNTIME: <span class=\"built_in\">set</span></span><br><span class=\"line\">Homebrew Ruby: 3.3.6 =&gt; /usr/local/Homebrew/Library/Homebrew/vendor/portable-ruby/3.3.6/bin/ruby</span><br><span class=\"line\">CPU: dodeca-core 64-bit kabylake</span><br><span class=\"line\">Clang: 15.0.0 build 1500</span><br><span class=\"line\">Git: 2.43.0 =&gt; /usr/local/bin/git</span><br><span class=\"line\">Curl: 8.7.1 =&gt; /usr/bin/curl</span><br><span class=\"line\">macOS: 13.7.1-x86_64</span><br><span class=\"line\">CLT: 15.0.0.0.1.1694021235</span><br><span class=\"line\">Xcode: N/A</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># é€šè¿‡brewå‡çº§telnetï¼Œå¯ä»¥çœ‹åˆ°ä½¿ç”¨äº†GitHubæº</span></span><br><span class=\"line\">$ brew upgrade telnet</span><br><span class=\"line\">==&gt; Upgrading 1 outdated package:</span><br><span class=\"line\">telnet 294 -&gt; 303.141.1</span><br><span class=\"line\">==&gt; Downloading https://ghcr.io/v2/homebrew/core/telnet/manifests/303.141.1</span><br><span class=\"line\"><span class=\"comment\">################################################################################################################################################################################### 100.0%</span></span><br><span class=\"line\">==&gt; Fetching telnet</span><br><span class=\"line\">==&gt; Downloading https://ghcr.io/v2/homebrew/core/telnet/blobs/sha256:1be6b7b6a17a311fb3a2f1bffe7dae52284f3239b8af03f651c4fac11362f702</span><br><span class=\"line\"><span class=\"comment\">################################################################################################################################################################################### 100.0%</span></span><br><span class=\"line\">==&gt; Verifying attestation <span class=\"keyword\">for</span> telnet</span><br><span class=\"line\">==&gt; Upgrading telnet</span><br><span class=\"line\">  294 -&gt; 303.141.1</span><br><span class=\"line\">==&gt; Pouring telnet--303.141.1.ventura.bottle.tar.gz</span><br><span class=\"line\">ğŸº  /usr/local/Cellar/telnet/303.141.1: 5 files, 207.5KB</span><br><span class=\"line\">==&gt; Running `brew cleanup telnet`...</span><br><span class=\"line\">Disable this behaviour by setting HOMEBREW_NO_INSTALL_CLEANUP.</span><br><span class=\"line\">Hide these hints with HOMEBREW_NO_ENV_HINTS (see `man brew`).</span><br><span class=\"line\">Removing: /usr/local/Cellar/telnet/294... (4 files, 208.2KB)</span><br></pre></td></tr></table></figure>\n<h2 id=\"é‡è¦çš„è¯´æ˜\">é‡è¦çš„è¯´æ˜</h2>\n<h3 id=\"ç¯å¢ƒå˜é‡\">ç¯å¢ƒå˜é‡</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>brewå®‰è£…çš„è½¯ä»¶åŒ…ä¼šè¢«è½¯è¿æ¥åˆ°<code>/usr/local/bin/</code>ä¸‹ï¼Œæ‰€ä»¥éœ€è¦å°†è¯¥è·¯å¾„åŠ å…¥ç³»ç»Ÿç¯å¢ƒPATHä¸­</p>\n</li>\n<li class=\"lvl-2\">\n<p>è¿™é‡Œè¦æ³¨æ„ä¸€ç‚¹ï¼Œå¦‚æœè¯¥è·¯å¾„åœ¨PATHä¸­å£°æ˜çš„æ¯”è¾ƒé å‰ï¼Œå°±å¯èƒ½ä¼šè¢«ä¼˜å…ˆä½¿ç”¨ï¼Œæ¯”å¦‚æˆ‘ä»¬å·²ç»æ‰‹å·¥åœ¨ç³»ç»Ÿä¸­å®‰è£…äº†<code>python</code>çš„æŸä¸ªç‰ˆæœ¬ï¼Œä½†é€šè¿‡brewå®‰è£…æŸäº›è½¯ä»¶åŒ…æ—¶å› ä¸ºå…¶ä¾èµ–pythonï¼Œå°±ä¼šé€šè¿‡brewåŒæ—¶å®‰è£…å¯¹åº”çš„pythonç‰ˆæœ¬ï¼Œæ­¤æ—¶æˆ‘ä»¬åœ¨ä½¿ç”¨pythonå‘½ä»¤æ—¶ï¼Œå°±ä¼šä¼˜å…ˆä½¿ç”¨è¿™ä¸ª</p>\n</li>\n<li class=\"lvl-2\">\n<p>æœ‰ä¸¤ç§æ–¹æ³•å¯ä»¥è§£å†³ï¼Œ1æ˜¯é€šè¿‡<code>brew unlink python</code>æ¥è§£é™¤é“¾æ¥ï¼Œæ­¤æ—¶å¹¶ä¸æ˜¯åˆ é™¤ï¼Œè€Œåªæ˜¯è§£é™¤äº†è½¯é“¾ï¼Œä¸ä¼šå½±å“ä¾èµ–å®ƒçš„å·¥å…·çš„ä½¿ç”¨ï¼Œå¦‚æœéœ€è¦æ¢å¤é“¾æ¥ï¼Œå¯ä»¥é€šè¿‡<code>brew link python</code>æ¥æ¢å¤é“¾æ¥ï¼›2æ˜¯å°†æˆ‘ä»¬çš„ç³»ç»Ÿä¸­è‡ªå·±å®‰è£…çš„ä¸€äº›å·¥å…·çš„è·¯å¾„å£°æ˜åœ¨<code>/usr/local/bin/</code>ä¹‹å‰ï¼Œè¿™æ ·å°±ä¸ä¼šæœ‰å½±å“äº†ã€‚</p>\n</li>\n</ul>\n<h3 id=\"Homebrew-4-0-å¸¦æ¥çš„æ–°å˜åŒ–\">Homebrew 4.0 å¸¦æ¥çš„æ–°å˜åŒ–</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Homebrew 4.0 è¿›è¡Œäº†ä¸€é¡¹æœ€å¤§çš„æ”¹åŠ¨ï¼Œç»„ç»‡æ–¹å¼ä»Gitä»“åº“ç®¡ç†æ”¹ä¸º<a href=\"https://formulae.brew.sh/api/formula.jws.json\">JSONæ–‡ä»¶</a>ä¸‹è½½ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>JSONæ–‡ä»¶ä¼šä»<a href=\"https://formulae.brew.sh\">formulae.brew.sh</a>ä¸‹è½½ï¼Œè€Œä¸å†ä½¿ç”¨<code>homebrew/core</code>ã€<code>homebrew/cask</code>ä¸¤ä¸ªä»“åº“ï¼Œæ‰€ä»¥å‡çº§åˆ°4.0åï¼Œæœ¬åœ°çš„<code>homebrew/core</code>ã€<code>homebrew/cask</code> ä»“åº“éƒ½å¯ä»¥åˆ é™¤ä»¥é‡Šæ”¾ç£ç›˜ç©ºé—´ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹æœ¬åœ°ä»“åº“</span></span><br><span class=\"line\">$ brew tap</span><br><span class=\"line\">homebrew/cask <span class=\"comment\"># cask ä»“åº“ï¼ŒGUIçš„å·¥å…·ä¼šä»æ­¤ä¸‹è½½ï¼Œbrew4.0åä¸å†ä½¿ç”¨</span></span><br><span class=\"line\">homebrew/core <span class=\"comment\"># core ä»“åº“ï¼Œå³ formula ä»“åº“ï¼Œå‘½ä»¤è¡Œå·¥å…·ä¼šä»æ­¤ä¸‹è½½ï¼Œbrew4.0åä¸å†ä½¿ç”¨</span></span><br><span class=\"line\">homebrew/services <span class=\"comment\"># services ä»“åº“ï¼Œservices å·¥å…·æœ¬èº«ä¼šä»æ­¤ä¸‹è½½ï¼Œbrew4.0åä¾æ—§ä½¿ç”¨</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åˆ é™¤æœ¬åœ°ä»“åº“</span></span><br><span class=\"line\">$ brew untap homebrew/core</span><br><span class=\"line\">$ brew untap homebrew/cask</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ­¤æ—¶å†æ¬¡æ‰§è¡Œ brew outdated ç­‰å‘½ä»¤æ—¶ï¼Œä¼šçœ‹åˆ°jsonæ–‡ä»¶è¢«ä¸‹è½½äº†ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œè¯¥jsonæ–‡ä»¶é—´éš”24å°æ—¶æ›´æ–°ä¸€æ¬¡</span></span><br><span class=\"line\">$ brew outdated</span><br><span class=\"line\">==&gt; Downloading https://formulae.brew.sh/api/formula.jws.json</span><br><span class=\"line\"><span class=\"comment\">##################################################################################### 100.0%</span></span><br><span class=\"line\">==&gt; Downloading https://formulae.brew.sh/api/cask.jws.json</span><br><span class=\"line\"><span class=\"comment\">##################################################################################### 100.0%</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¦‚æœè¿˜æƒ³ä½¿ç”¨æ—§çš„ä»“åº“æ¨¡å¼ï¼Œåªè¦é…ç½®ä¸‹ç¯å¢ƒå˜é‡</p>\n</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&#x27;export HOMEBREW_NO_INSTALL_FROM_API=1&#x27;</span> &gt;&gt; ~/.zshrc</span><br></pre></td></tr></table></figure>\n<h3 id=\"ä»é•œåƒæºçš„åˆ‡æ¢æ¥ç†è§£brewä¸‹è½½å®‰è£…åŒ…çš„è¿‡ç¨‹\">ä»é•œåƒæºçš„åˆ‡æ¢æ¥ç†è§£brewä¸‹è½½å®‰è£…åŒ…çš„è¿‡ç¨‹</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å‰é¢æˆ‘ä»¬ä»‹ç»è¿‡ï¼Œåˆ‡æ¢é•œåƒæºæ—¶è¦è®¾ç½®4ä¸ªç¯å¢ƒå˜é‡ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆè¦è®¾ç½®è¿™å‡ ä¸ªå˜é‡å‘¢ï¼Ÿå®ƒä»¬çš„ä½œç”¨æ˜¯ä»€ä¹ˆå‘¢ï¼Œä¸‹é¢æˆ‘å°±ä¸€ä¸ªä¸€ä¸ªè¯´æ˜ï¼š</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">\n<p>HOMEBREW_BREW_GIT_REMOTE</p>\n<ul class=\"lvl-4\">\n<li class=\"lvl-6\">è®¾ç½®brewä»“åº“ï¼Œç”¨äºæ›´æ–°brewå‘½ä»¤æœ¬èº«ï¼Œè¿™ä¸ªæ¯”è¾ƒå®¹æ˜“ç†è§£</li>\n</ul>\n</li>\n<li class=\"lvl-4\">\n<p>HOMEBREW_CORE_GIT_REMOTE</p>\n<ul class=\"lvl-4\">\n<li class=\"lvl-6\">è®¾ç½®coreä»“åº“ï¼Œç”¨äºæ›´æ–°formulaçš„å®‰è£…è„šæœ¬</li>\n<li class=\"lvl-6\">å½“é€šè¿‡<code>brew info xxx</code>æŸ¥çœ‹å®‰è£…åŒ…ä¿¡æ¯æ—¶ï¼Œå¯ä»¥çœ‹åˆ°<code>From</code>ä¿¡æ¯ï¼Œè¿™ä¸ªå°±æ˜¯å‘½ä»¤çš„å®‰è£…è„šæœ¬ï¼Œæ¯”å¦‚ä¸‹é¢çš„<code>fd.rb</code></li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ brew info fd</span><br><span class=\"line\">==&gt; fd: stable 10.2.0 (bottled), HEAD</span><br><span class=\"line\">Simple, fast and user-friendly alternative to find</span><br><span class=\"line\">https://github.com/sharkdp/fd</span><br><span class=\"line\">Conflicts with:</span><br><span class=\"line\">  fdclone (because both install `fd` binaries)</span><br><span class=\"line\">Installed</span><br><span class=\"line\">/usr/local/Cellar/fd/10.2.0 (14 files, 2.9MB) *</span><br><span class=\"line\">  Poured from bottle using the formulae.brew.sh API on 2024-11-29 at 18:02:16</span><br><span class=\"line\">From: https://github.com/Homebrew/homebrew-core/blob/HEAD/Formula/f/fd.rb</span><br><span class=\"line\">License: Apache-2.0 OR MIT</span><br><span class=\"line\">==&gt; Dependencies</span><br><span class=\"line\">Build: rust âœ˜</span><br><span class=\"line\">==&gt; Options</span><br><span class=\"line\">--HEAD</span><br><span class=\"line\">  Install HEAD version</span><br><span class=\"line\">==&gt; Caveats</span><br><span class=\"line\">zsh completions have been installed to:</span><br><span class=\"line\">  /usr/local/share/zsh/site-functions</span><br><span class=\"line\">==&gt; Analytics</span><br><span class=\"line\">install: 6,327 (30 days), 24,518 (90 days), 116,476 (365 days)</span><br><span class=\"line\">install-on-request: 6,326 (30 days), 24,515 (90 days), 116,363 (365 days)</span><br><span class=\"line\">build-error: 0 (30 days)</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-4\">\n<li class=\"lvl-6\">è¿™ä¸ªå®‰è£…è„šæœ¬ä¸­åŒ…å«<code>bottle do</code>éƒ¨åˆ†ï¼Œå…¶ä½œç”¨æ˜¯å½“å®‰è£…è„šæœ¬æ—¶ï¼Œä¼˜å…ˆä»è¯¥éƒ¨åˆ†è·å–å¯¹åº”çš„æ“ä½œç³»ç»Ÿçš„äºŒè¿›åˆ¶é¢„ç¼–è¯‘åŒ…çš„sha256æ ¡éªŒå€¼ï¼Œå¦‚æœä»å¯¹åº”çš„äºŒè¿›åˆ¶æºä¸­æ‰¾åˆ°ï¼Œåˆ™ç›´æ¥ä»äºŒè¿›åˆ¶é¢„ç¼–è¯‘åŒ…çš„åœ°å€è¿›è¡Œä¸‹è½½ï¼Œè¯¥é¢„ç¼–è¯‘ä¸‹è½½åœ°å€ç”±<code>HOMEBREW_BOTTLE_DOMAIN</code>æŒ‡å®šï¼Œé»˜è®¤ä»å®˜æ–¹æºä¸‹è½½ã€‚</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">class Fd &lt; Formula</span><br><span class=\"line\">  desc <span class=\"string\">&quot;Simple, fast and user-friendly alternative to find&quot;</span></span><br><span class=\"line\">  homepage <span class=\"string\">&quot;https://github.com/sharkdp/fd&quot;</span></span><br><span class=\"line\">  url <span class=\"string\">&quot;https://github.com/sharkdp/fd/archive/refs/tags/v10.2.0.tar.gz&quot;</span></span><br><span class=\"line\">  sha256 <span class=\"string\">&quot;73329fe24c53f0ca47cd0939256ca5c4644742cb7c14cf4114c8c9871336d342&quot;</span></span><br><span class=\"line\">  license any_of: [<span class=\"string\">&quot;Apache-2.0&quot;</span>, <span class=\"string\">&quot;MIT&quot;</span>]</span><br><span class=\"line\">  <span class=\"built_in\">head</span> <span class=\"string\">&quot;https://github.com/sharkdp/fd.git&quot;</span>, branch: <span class=\"string\">&quot;master&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">  bottle <span class=\"keyword\">do</span></span><br><span class=\"line\">    sha256 cellar: :any_skip_relocation, arm64_sequoia:  <span class=\"string\">&quot;9d17cfb029fbdc6ed31c732108f7aa746d3082dd4783ed35471ef79340615509&quot;</span></span><br><span class=\"line\">    sha256 cellar: :any_skip_relocation, arm64_sonoma:   <span class=\"string\">&quot;82d5c2ffc2e2d0d8643a7c3f620c81ed49d7b23920aa23b6a7f4c50be69abc0b&quot;</span></span><br><span class=\"line\">    sha256 cellar: :any_skip_relocation, arm64_ventura:  <span class=\"string\">&quot;354412ababb7d6c52abd9153ff96f133391406ce292b2122c76b96c2ab714f87&quot;</span></span><br><span class=\"line\">    sha256 cellar: :any_skip_relocation, arm64_monterey: <span class=\"string\">&quot;0b41f292041767fd1c3c5b92daaa6c823fb07c1d7cd11b0427a415f08463f035&quot;</span></span><br><span class=\"line\">    sha256 cellar: :any_skip_relocation, sonoma:         <span class=\"string\">&quot;4fa0fb4b3f512e45d35c569953efc7c59ebd8976caac9b2c1b1394b7e29157a0&quot;</span></span><br><span class=\"line\">    sha256 cellar: :any_skip_relocation, ventura:        <span class=\"string\">&quot;b1406e5414252b1e1b90cfad188454eb31058256ed6246baed48c4e1cfe593a1&quot;</span></span><br><span class=\"line\">    sha256 cellar: :any_skip_relocation, monterey:       <span class=\"string\">&quot;0ac060bf7d1529aa1f65e634f64b98b906df533d71f2185c883165c01f59ad53&quot;</span></span><br><span class=\"line\">    sha256 cellar: :any_skip_relocation, x86_64_linux:   <span class=\"string\">&quot;2464fb21cc981166ffa9783fa14a09265790af4d89ce3a763421ddaf29119541&quot;</span></span><br><span class=\"line\">  end</span><br><span class=\"line\"></span><br><span class=\"line\">  depends_on <span class=\"string\">&quot;rust&quot;</span> =&gt; :build</span><br><span class=\"line\"></span><br><span class=\"line\">  conflicts_with <span class=\"string\">&quot;fdclone&quot;</span>, because: <span class=\"string\">&quot;both install `fd` binaries&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">  def install</span><br><span class=\"line\">    system <span class=\"string\">&quot;cargo&quot;</span>, <span class=\"string\">&quot;install&quot;</span>, *std_cargo_args</span><br><span class=\"line\">    man1.install <span class=\"string\">&quot;doc/fd.1&quot;</span></span><br><span class=\"line\">    generate_completions_from_executable(bin/<span class=\"string\">&quot;fd&quot;</span>, <span class=\"string\">&quot;--gen-completions&quot;</span>, shells: [:bash, :fish])</span><br><span class=\"line\">    zsh_completion.install <span class=\"string\">&quot;contrib/completion/_fd&quot;</span></span><br><span class=\"line\">    <span class=\"comment\"># Bash completions are not compatible with Bash 3 so don&#x27;t use v1 directory.</span></span><br><span class=\"line\">    <span class=\"comment\"># bash: complete: nosort: invalid option name</span></span><br><span class=\"line\">    <span class=\"comment\"># Issue ref: https://github.com/clap-rs/clap/issues/5190</span></span><br><span class=\"line\">    (share/<span class=\"string\">&quot;bash-completion/completions&quot;</span>).install bash_completion.children</span><br><span class=\"line\">  end</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"built_in\">test</span> <span class=\"keyword\">do</span></span><br><span class=\"line\">    <span class=\"built_in\">touch</span> <span class=\"string\">&quot;foo_file&quot;</span></span><br><span class=\"line\">    <span class=\"built_in\">touch</span> <span class=\"string\">&quot;test_file&quot;</span></span><br><span class=\"line\">    assert_equal <span class=\"string\">&quot;test_file&quot;</span>, shell_output(<span class=\"string\">&quot;#&#123;bin&#125;/fd test&quot;</span>).chomp</span><br><span class=\"line\">  end</span><br><span class=\"line\">end</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-4\">\n<li class=\"lvl-6\">æ³¨æ„ï¼Œbrew4.0åä¸å†ä½¿ç”¨ä»è¯¥gitä»“åº“ä¸­è·å–å®‰è£…è„šæœ¬ï¼Œå› ä¸ºformulaçš„å®‰è£…æºä»£ç å·²ç»å…¨éƒ¨å­˜å‚¨åœ¨jsonæ–‡ä»¶ä¸­(è§<code>HOMEBREW_API_DOMAIN</code>è¯´æ˜)ï¼Œä¸å†éœ€è¦é€šè¿‡Gitä»“åº“ä¸‹è½½</li>\n<li class=\"lvl-6\">åˆ‡æ¢é•œåƒæºæ—¶ï¼Œbrew4.0åä¸éœ€è¦è®¾ç½®è¯¥ç¯å¢ƒå˜é‡</li>\n</ul>\n</li>\n<li class=\"lvl-4\">\n<p>HOMEBREW_API_DOMAIN</p>\n<ul class=\"lvl-4\">\n<li class=\"lvl-6\">è®¾ç½®<code>formula\\cask</code>çš„å®‰è£…è„šæœ¬ä¸‹è½½æºï¼Œé»˜è®¤<a href=\"https://formulae.brew.sh\">https://formulae.brew.sh</a></li>\n<li class=\"lvl-6\">brew4.0åä¸å†ä»gitä»“åº“è·å–å®‰è£…è„šæœ¬ï¼Œè€Œæ˜¯ä»è¿™ä¸ªjsonæ–‡ä»¶ä¸­ä¸€æ¬¡æ€§è·å–æ‰€æœ‰å·¥å…·çš„å®‰è£…è„šæœ¬ï¼Œé»˜è®¤24å°æ—¶æ›´æ–°ä¸€æ¬¡</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">å®˜æ–¹æºï¼š</span><br><span class=\"line\">  formulaæºï¼šhttps://formulae.brew.sh/api/formula.jws.json</span><br><span class=\"line\">  caskæºï¼šhttps://formulae.brew.sh/api/cask.jws.json</span><br><span class=\"line\"></span><br><span class=\"line\">æ¸…åæºï¼š</span><br><span class=\"line\">  formulaæºï¼šhttps://mirrors.tuna.tsinghua.edu.cn/homebrew-bottles/api/formula.jws.json</span><br><span class=\"line\">  caskæºï¼šhttps://mirrors.tuna.tsinghua.edu.cn/homebrew-bottles/api/cask.jws.json</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-4\">\n<li class=\"lvl-6\">å¦‚æœè¿˜æƒ³ä½¿ç”¨æ—§çš„ä»“åº“æ¨¡å¼ï¼Œåªè¦é…ç½®ä¸‹ç¯å¢ƒå˜é‡ï¼Œè¿™æ ·å³ä½¿ä½ å‡çº§åå·²ç»åˆ é™¤äº†å¯¹åº”çš„ä»“åº“ï¼Œå®ƒä¹Ÿä¼šåœ¨ç¬¬ä¸€æ¬¡ä½¿ç”¨åˆ°æ—¶è‡ªåŠ¨ä¸‹è½½</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å®˜æ–¹ä¹Ÿæåˆ°ï¼Œéå¼€å‘äººå‘˜æ²¡å¿…è¦è¿™æ ·åš</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&#x27;export HOMEBREW_NO_INSTALL_FROM_API=1&#x27;</span> &gt;&gt; ~/.zshrc</span><br></pre></td></tr></table></figure>\n</li>\n<li class=\"lvl-4\">\n<p>HOMEBREW_BOTTLE_DOMAIN</p>\n<ul class=\"lvl-4\">\n<li class=\"lvl-6\">æŒ‡å®šé¢„ç¼–è¯‘äºŒè¿›åˆ¶åŒ…ï¼ˆä¹Ÿç§°ä¸º bottlesï¼‰çš„ä¸‹è½½åœ°å€ï¼ŒHomebrew ä½¿ç”¨è¿™äº› bottles æ¥åŠ é€Ÿè½¯ä»¶å®‰è£…è¿‡ç¨‹ï¼Œé¿å…åœ¨æ¯ä¸ªç”¨æˆ·çš„è®¡ç®—æœºä¸Šéƒ½é‡æ–°ä»æºä»£ç æ„å»ºè½¯ä»¶ã€‚</li>\n<li class=\"lvl-6\">å½“æˆ‘ä»¬é€šè¿‡<code>brew install xxx</code>å®‰è£…è½¯ä»¶æ—¶ï¼Œbrewä¼šå…ˆä»è¯¥formulaçš„å®‰è£…è„šæœ¬ï¼ˆ4.0ä»¥å‰ä»HOMEBREW_CORE_GIT_REMOTEæŒ‡å®šçš„gitä»“åº“è·å–ï¼Œ4.0ä»¥åä»HOMEBREW_API_DOMAINæŒ‡å®šçš„jsonæ–‡ä»¶ä¸­è·å–ï¼‰ä¸­è·å–è¯¥è½¯ä»¶çš„å®‰è£…ä¿¡æ¯ï¼Œç„¶åæ ¹æ®å®‰è£…ä¿¡æ¯ä»bottleä¸­ä¸‹è½½å¯¹åº”çš„é¢„ç¼–è¯‘äºŒè¿›åˆ¶åŒ…ï¼Œå†å°†å…¶å®‰è£…åˆ°æœ¬åœ°ã€‚</li>\n<li class=\"lvl-6\">ä¸‹è½½åçš„äºŒè¿›åˆ¶åŒ…ä¼šè¢«ä¿å­˜åˆ°ç¼“å­˜ç›®å½•ä¸­(<code>brew --cache</code>)ï¼Œå®‰è£…åçš„è½¯ä»¶åŒ…å­˜å‚¨åˆ°Cellarç›®å½•ä¸­(<code>brew --cellar</code>)</li>\n</ul>\n</li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<p>é€šè¿‡ä¸Šé¢çš„åˆ†æï¼Œæˆ‘ä»¬å¯ä»¥å¾—å‡ºç»“è®ºï¼Œåˆ‡æ¢é•œåƒæºæ—¶ï¼Œå®é™…ä¸Šåªéœ€è¦è®¾ç½®3ä¸ªå˜é‡å°±å¤Ÿäº†</p>\n</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">HOMEBREW_BREW_GIT_REMOTE</span><br><span class=\"line\">HOMEBREW_API_DOMAIN</span><br><span class=\"line\">HOMEBREW_BOTTLE_DOMAIN</span><br></pre></td></tr></table></figure>\n","content_text":"æ‘˜è¦ brewæ˜¯ä¸€ä¸ªè½¯ä»¶åŒ…ç®¡ç†å™¨ï¼ŒåŒæ—¶æ”¯æŒMacOSå’ŒLinuxï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿åœ°å®‰è£…å„ç§è½¯ä»¶ï¼Œæ¯”å¦‚gitã€nodeã€pythonç­‰ã€‚ brewè™½ç„¶æ”¯æŒlinuxï¼Œä½†æ˜¯å®é™…ä½¿ç”¨ä¸­å¾ˆå°‘ä¼šä½¿ç”¨brewæ¥ç®¡ç†linuxçš„è½¯ä»¶åŒ…ã€‚ æœ¬æ–‡ä»‹ç»å¦‚ä½•åœ¨macosä¸‹å®‰è£…brewï¼Œä»¥åŠå¦‚ä½•ä½¿ç”¨brewç®¡ç†å„ç§è½¯ä»¶åŒ…ã€‚ æœ¬æ–‡åŸºäº MacOS Intel Ventura 13.7.1ï¼Œbrew ç‰ˆæœ¬ä¸º4.4.8ã€‚ å®‰è£… é¦–å…ˆè¦ç¡®ä¿ç³»ç»Ÿä¸­å®‰è£…äº† git å’Œ curlï¼Œå¯¹äº macOS ç”¨æˆ·æ¥è¯´ï¼Œè¿™äº›ç³»ç»Ÿéƒ½è‡ªå¸¦äº†ï¼Œå”¯ä¸€éœ€é¢å¤–è¦æ±‚å®‰è£…çš„æ˜¯Command Line Tools (CLT) for Xcodeã€‚ 12345678# æ£€æŸ¥ç³»ç»Ÿä¸­æ˜¯å¦å®‰è£…äº† Command Line Tools (CLT) for Xcodexcode-select --version # èƒ½å¤Ÿè¾“å‡ºç‰ˆæœ¬å·è¯´æ˜å®‰è£…äº†ï¼Œå¦åˆ™éœ€è¦å®‰è£…ã€‚# å®‰è£… Command Line Tools (CLT) for Xcodexcode-select --install# æ‰“å°å½“å‰çš„ Command Line Tools (CLT) for Xcode çš„å®‰è£…è·¯å¾„xcode-select -p # /Library/Developer/CommandLineTools åœ¨MacOSä¸Šå®‰è£…brewçš„æ–¹æ³• å‚è€ƒèµ„æ–™ æ–¹æ³•ä¸€ï¼šä½¿ç”¨è„šæœ¬å®‰è£… 1/bin/bash -c &quot;$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)&quot; å®‰è£…æ—¶å¯ä»¥æŒ‡å®šé•œåƒä¸‹è½½æºï¼Œé»˜è®¤æ˜¯Homebrewçš„GitHubä¸‹è½½æºï¼Œä¹Ÿå¯ä»¥é€‰æ‹©å›½å†…çš„é•œåƒæºï¼Œæ¯”å¦‚ä½¿ç”¨æ¸…åå¤§å­¦çš„Homebrewé•œåƒæº 1234567# æ§åˆ¶äº† Homebrew åœ¨å®‰è£…è½¯ä»¶åŒ…æ—¶æ˜¯å¦ä» Homebrew çš„ API æœåŠ¡å™¨è·å–ä¿¡æ¯ï¼Œbrew4.0åæ˜¯é»˜è®¤è¡Œä¸ºï¼Œæ— éœ€è®¾ç½®export HOMEBREW_INSTALL_FROM_API=1# è®¾ç½®brewä»“åº“ä¸Šæ¸¸export HOMEBREW_BREW_GIT_REMOTE=&quot;https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/brew.git&quot;# è®¾ç½®homebrewæ ¸å¿ƒä¸Šæ¸¸export HOMEBREW_CORE_GIT_REMOTE=&quot;https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/homebrew-core.git&quot;/bin/bash -c &quot;$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)&quot; æ–¹æ³•äºŒï¼šä½¿ç”¨PKGæ–‡ä»¶å®‰è£… ä»Homebrewçš„githubä¸Šä¸‹è½½æœ€æ–°ç‰ˆçš„Homebrew-x.x.x.pkg æ–¹æ³•ä¸‰ï¼šå›½å†…æ— æ³•è®¿é—®githubåœ°å€æ—¶å¯ä»¥ä½¿ç”¨å›½å†…é•œåƒæº è¿™é‡Œä¾æ—§ä»¥æ¸…åå¤§å­¦çš„Homebrewé•œåƒæºä¸ºä¾‹ 123456export HOMEBREW_BREW_GIT_REMOTE=&quot;https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/brew.git&quot;export HOMEBREW_CORE_GIT_REMOTE=&quot;https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/homebrew-core.git&quot;# ä»é•œåƒä¸‹è½½å®‰è£…è„šæœ¬å¹¶å®‰è£… Homebrew / Linuxbrewgit clone --depth=1 https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/install.git brew-install/bin/bash brew-install/install.shrm -rf brew-install éªŒè¯æ˜¯å¦å®‰è£…æˆåŠŸ brew å‘½ä»¤æœ¬èº«åŠé€šè¿‡brewå®‰è£…çš„æ‰€æœ‰å‘½ä»¤éƒ½ä¼šè¢«è½¯é“¾æ¥åˆ°/usr/local/bin/ä¸‹ï¼Œæ‰€ä»¥éœ€è¦å°†è¯¥è·¯å¾„åŠ å…¥ç³»ç»Ÿç¯å¢ƒPATHä¸­ é‡å¯ç»ˆç«¯ï¼Œç„¶åæ‰§è¡Œbrew -vå‘½ä»¤æŸ¥çœ‹brewçš„ç‰ˆæœ¬ï¼Œå¦‚æœå®‰è£…æˆåŠŸï¼Œä¼šè¾“å‡ºç±»ä¼¼å¦‚ä¸‹å†…å®¹ 12$ brew -vHomebrew 4.4.8-40-g13c3def Homebrewæœ¬èº«çš„å®‰è£…ä½ç½®å¯ä»¥é€šè¿‡brew --repoæŸ¥çœ‹ï¼Œé»˜è®¤ä¸º/usr/local/Homebrew é€šè¿‡brewå®‰è£…çš„è½¯ä»¶åŒ…é»˜è®¤ä¼šè¢«å®‰è£…åˆ°/usr/local/Cellar/ä¸‹ï¼Œæ¯”å¦‚gitå®‰è£…åä¼šåœ¨/usr/local/Cellar/git/ç›®å½•ä¸‹ï¼Œå¯ä»¥é€šè¿‡brew info gitæŸ¥çœ‹å®‰è£…ä¿¡æ¯ï¼ŒåŒ…æ‹¬ä¾èµ–åº“ç­‰ã€‚ 12345678910111213141516171819# æ˜¾ç¤º Homebrew å®‰è£…è·¯å¾„ï¼ŒmacOS ARM: /opt/homebrewï¼ŒmacOS Intel: /usr/local$ brew --prefix/usr/local# æ˜¾ç¤º Homebrew æœ¬åœ°çš„ Git ä»“åº“$ brew --repo/usr/local/Homebrew# æ˜¾ç¤º Homebrew Cellar è·¯å¾„ï¼Œå‘½ä»¤è¡Œå·¥å…·çš„å®‰è£…è·¯å¾„$ brew --cellar/usr/local/Cellar# æ˜¾ç¤º Homebrew Caskroom è·¯å¾„ï¼ŒGUIå·¥å…·çš„å®‰è£…è·¯å¾„$ brew --caskroom/usr/local/Caskroom# ç¼“å­˜è·¯å¾„ï¼Œä¸‹è½½å®‰è£…åŒ…çš„ç¼“å­˜è·¯å¾„ï¼Œé€šè¿‡ brew cleanup æ¸…ç†$ brew --cache~/Library/Caches/Homebrew é…ç½®å‘½ä»¤è¡¥å…¨ å‚è€ƒå®˜ç½‘Homebrew Documentationâ€“brew Shell Completion æˆ‘è¿™é‡Œä½¿ç”¨çš„æ˜¯zshï¼Œåœ¨~/.zshrcä¸­åŠ å…¥å¦‚ä¸‹å†…å®¹å¹¶é‡å¯ç»ˆç«¯å³å¯ç”Ÿæ•ˆ 12autoload -Uz compinitcompinit å¸è½½brew 1/bin/bash -c &quot;$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/uninstall.sh)&quot; å¸¸ç”¨å‘½ä»¤ brewæ”¯æŒå®‰è£…å‘½ä»¤è¡Œå·¥å…·(formula)å’ŒGUIå·¥å…·(cask) brew install xxx å®‰è£…å‘½ä»¤è¡Œå·¥å…·ï¼Œè¿™ä¸ªæœ€ä¸ºå¸¸ç”¨ï¼Œæ¯”å¦‚ brew install fd brew install --cask xxx å®‰è£…GUIå·¥å…·ï¼Œä¸€èˆ¬å¾ˆå°‘ä½¿ç”¨brewå®‰è£…GUIå·¥å…·ï¼Œæ¯”å¦‚ brew install --cask firefox brewçš„å‘½ä»¤å’Œå‚æ•°éå¸¸å¤šï¼Œä½†æ—¥å¸¸ä½¿ç”¨åªéœ€è¦è®°ä½å¸¸ç”¨çš„å‡ ä¸ªå°±å¤Ÿäº†ï¼Œè¯¦ç»†çš„å‘½ä»¤åˆ—è¡¨å¯ä»¥å‚è€ƒHomebrew Documentation 1234# æŸ¥çœ‹brewæ”¯æŒå“ªäº›å‘½ä»¤brew commands# æŸ¥çœ‹å‘½ä»¤çš„å¸®åŠ©ä¿¡æ¯ï¼Œæ¯”å¦‚brew install --help ä¸€äº›å¸¸ç”¨çš„å‘½ä»¤ 12345678brew update # æ›´æ–°brewåˆ°æœ€æ–°ç‰ˆæœ¬brew --version # æŸ¥çœ‹brewçš„ç‰ˆæœ¬ï¼Œå¯ä»¥ç®€å†™ä¸º brew -vbrew config # æŸ¥çœ‹brewçš„é…ç½®ä¿¡æ¯ï¼Œè¿™ä¸ªå‘½ä»¤å¾ˆæœ‰ç”¨ï¼Œå¯ä»¥æŸ¥çœ‹åˆ°ä¸brewç›¸å…³çš„ç¯å¢ƒå˜é‡çš„å€¼brew home # æµè§ˆå™¨æ‰“å¼€brewå®˜ç½‘brew home xxx # æµè§ˆå™¨æ‰“å¼€xxxå®˜ç½‘ å¦‚ï¼šæ‰“å¼€fdå‘½ä»¤çš„å®˜ç½‘ brew home fd ,å…·ä½“çš„åç§°å¯ä»¥é€šè¿‡brew listæŸ¥çœ‹brew cleanup # æ¸…ç†ç¼“å­˜åŠæ—¥å¿—æ–‡ä»¶ï¼Œå»ºè®®å®šæœŸæ¸…ç†ï¼Œå½“è¿è¡Œbrewæ—¶ä¼šè‡ªåŠ¨æ¸…ç†ï¼ˆ2.0ä»¥åçš„ç‰ˆæœ¬ï¼‰brew cleanup -n # æ˜¾ç¤ºå°†è¦æ¸…ç†çš„ç¼“å­˜åŠæ—¥å¿—æ–‡ä»¶ï¼ŒåªæŸ¥çœ‹ä¸åˆ é™¤brew doctor # æ£€æŸ¥æ˜¯å¦æœ‰ä¾èµ–é—®é¢˜ï¼Œæ¯”å¦‚æ²¡æœ‰å®‰è£…ä¾èµ–åº“ï¼Œæˆ–è€…ä¾èµ–åº“ç‰ˆæœ¬è¿‡ä½ï¼Œå½“è¿è¡ŒbrewæŠ¥é”™æ—¶å¯ä»¥é€šè¿‡è¯¥å‘½ä»¤è¿›è¡Œæ£€æŸ¥å¹¶æ ¹æ®æç¤ºè¿›è¡Œä¿®æ”¹ æŸ¥çœ‹å·²å®‰è£…çš„åŒ… 1234# æŸ¥çœ‹brew list # æŸ¥çœ‹å·²å®‰è£…çš„åŒ…brew list --versions # æŸ¥çœ‹å·²å®‰è£…çš„åŒ…åŠç‰ˆæœ¬brew info xxx # æŸ¥çœ‹xxxçš„å®‰è£…ä¿¡æ¯ å®‰è£…ã€å¸è½½ 12345678# æŸ¥æ‰¾ã€å®‰è£…ã€å¸è½½brew search xxx # æŸ¥æ‰¾è½¯ä»¶åŒ…ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ https://formulae.brew.sh ç½‘é¡µè¿›è¡Œæœç´¢brew install xxx # å®‰è£…è½¯ä»¶åŒ…ï¼Œæ­¤å‘½ä»¤ç›¸å½“äºåŠ ä¸Šäº† --formula ï¼Œå®‰è£…æ—¶ä¼šè‡ªåŠ¨ä¸‹è½½ä¾èµ–åº“ï¼Œæ¯”å¦‚å®‰è£…`nginx`æ—¶ï¼Œä¼šè‡ªåŠ¨ä¸‹è½½`openssl@3`å’Œ`pcre2`ç­‰brew install --cask xxx # å®‰è£…GUIå·¥å…·ï¼Œæ¯”å¦‚`firefox`brew uninstall xxx # å¸è½½è½¯ä»¶åŒ…ï¼Œæ­¤å‘½ä»¤ç›¸å½“äºåŠ ä¸Šäº† --formula ï¼Œåªä¼šå¸è½½å½“å‰åŒ…ï¼Œä¸ä¼šå¸è½½ä¾èµ–åº“ï¼Œè¿™æ ·å°±æœ‰å¯èƒ½å­˜åœ¨å¾ˆå¤šå†—ä½™åŒ…brew uninstall --cask xxx # å¸è½½GUIå·¥å…·brew autoremove # åˆ é™¤æ‰€æœ‰ä»…ä½œä¸ºå¦ä¸€ä¸ªè½¯ä»¶åŒ…çš„ä¾èµ–é¡¹å®‰è£…å¹¶ä¸”ç°åœ¨ä¸å†éœ€è¦çš„åŒ…brew autoremove --dry-run # --dry-run ä»…æŸ¥çœ‹å“ªäº›åŒ…å¯ä»¥åˆ é™¤ï¼Œå¹¶ä¸ä¼šçœŸçš„åˆ é™¤ å‡çº§ 1234# å‡çº§brew outdated # æŸ¥çœ‹éœ€è¦å‡çº§çš„åŒ…brew upgrade xxx # å‡çº§xxxåˆ°æœ€æ–°ç‰ˆbrew upgrade # æ›´æ–°å…¨éƒ¨å‘½ä»¤åˆ°æœ€æ–°ç‰ˆ ä¾èµ–å…³ç³» 12345678# ä¾èµ–å…³ç³»brew deps --tree xxx # æ ‘å½¢æ˜¾ç¤ºåŒ…çš„ä¾èµ–æ ‘brew deps --installed --tree # æ ‘å½¢æ˜¾ç¤ºæ‰€æœ‰å®‰è£…åŒ…çš„ä¾èµ–å…³ç³»brew deps --installed xxx # æ˜¾ç¤ºå½“å‰å®‰è£…åŒ…çš„ä¾èµ–å…³ç³»ï¼Œçºµå‘å±•ç¤ºbrew deps --installed --for-each xxx # æ˜¾ç¤ºå½“å‰å®‰è£…åŒ…çš„ä¾èµ–å…³ç³»ï¼Œæ¨ªå‘å±•ç¤ºbrew uses --installed xxx # æŸ¥çœ‹å·²ç»å®‰è£…çš„å“ªäº›å·¥å…·ä¾èµ–å½“å‰åŒ…brew leaves # æŸ¥çœ‹é¡¶çº§å®‰è£…åŒ…ï¼Œå³ä½ é€šè¿‡brewç›´æ¥å®‰è£…çš„åŒ…ï¼Œè€Œä¸æ˜¯é€šè¿‡å®‰è£…å…¶ä»–è½¯ä»¶åŒ…é—´æ¥å®‰è£…çš„brew leaves | xargs brew deps --installed --for-each --formula # æŸ¥çœ‹é¡¶çº§åŒ…ï¼Œå¹¶åˆ—å‡ºæ¯ä¸ªé¡¶çº§åŒ…çš„å·²å®‰è£…ä¾èµ– ä»“åº“ç®¡ç†ï¼Œå‚è€ƒèµ„æ–™Homebrew Documentationâ€“Taps 1234567891011# ä»“åº“ç®¡ç†brew tap # æŸ¥çœ‹æ‰€æœ‰å·²å®‰è£…çš„ä»“åº“ï¼Œtapå®‰è£…è·¯å¾„ /usr/local/Homebrew/Library/Taps/brew tap user/repo # æ·»åŠ ä¸€ä¸ªä»“åº“ï¼Œä»gitthubä¸‹è½½brew tap repo_url # æ·»åŠ ä¸€ä¸ªä»“åº“ï¼Œä»ç»™å®šçš„ä»“åº“åœ°å€ä¸‹è½½brew untap user/repo # åˆ é™¤ä¸€ä¸ªä»“åº“# ä»ç¬¬ä¸‰æ–¹ä»“åº“å®‰è£…å·¥å…·ï¼Œæ­¤æ—¶ä¼šè‡ªåŠ¨å°† homebrew-ffmpeg/ffmpeg è¿™ä¸ªä»“åº“æ·»åŠ åˆ°æœ¬åœ°brew install homebrew-ffmpeg/ffmpeg/ffmpeg# æ›´æ–°ä»“åº“ï¼Œæ— è®ºæ˜¯brewè‡ªå·±çš„ä»“åº“è¿˜æ˜¯ç¬¬ä¸‰æ–¹ä»“åº“ï¼Œéƒ½ä¼šè‡ªåŠ¨æ›´æ–°brew update brew services: brewçš„æœåŠ¡ç®¡ç†å·¥å…·ï¼Œå¯ä»¥æ–¹ä¾¿çš„ç®¡ç†é€šè¿‡brewå®‰è£…çš„æœåŠ¡ï¼ŒåŒ…æ‹¬å¯åŠ¨ã€åœæ­¢ã€é‡å¯æœåŠ¡ï¼Œç­‰ç­‰ï¼Œæ¯”å¦‚nginxã€redisã€mysqlç­‰ï¼Œå…·ä½“å‘½ä»¤å¯ä»¥å‚è€ƒHomebrew Documentation 12345678910# ç¬¬ä¸€æ¬¡æ‰§è¡Œ services ç›¸å…³çš„å‘½ä»¤æ—¶ä¼šè‡ªåŠ¨ä¸‹è½½ homebrew/servicesï¼Œä¹Ÿå¯ä»¥ é€šè¿‡ brew tap homebrew/services æå‰ä¸‹è½½brew services list # æŸ¥çœ‹å·²å®‰è£…çš„æ‰€æœ‰æœåŠ¡brew services start nginx # å¯åŠ¨æœåŠ¡ï¼Œå¹¶æ³¨å†Œåˆ°ç³»ç»Ÿå¯åŠ¨æœåŠ¡åˆ—è¡¨ï¼Œå³åˆ›å»ºç³»ç»Ÿè‡ªå¯åŠ¨æ–‡ä»¶ï¼š ~/Library/LaunchAgents/homebrew.mxcl.nginx.plistbrew services stop nginx # åœæ­¢æœåŠ¡ï¼Œå¹¶ä»ç³»ç»Ÿå¯åŠ¨æœåŠ¡åˆ—è¡¨ä¸­ç§»é™¤ï¼Œå³åˆ é™¤ç³»ç»Ÿè‡ªå¯åŠ¨æ–‡ä»¶brew services kill nginx # ç«‹å³æ€æ­»æœåŠ¡ï¼Œä½†ä¸ä»ç³»ç»Ÿå¯åŠ¨æœåŠ¡åˆ—è¡¨ä¸­ç§»é™¤brew services restart nginx # é‡å¯æœåŠ¡brew services info nginx # æŸ¥çœ‹æœåŠ¡çš„çŠ¶æ€å’Œè¿›ç¨‹IPbrew services run nginx # è¿è¡ŒæœåŠ¡ï¼Œä½†ä¸ä¼šä¿å­˜åˆ°æœåŠ¡åˆ—è¡¨ä¸­brew services cleanup # æ¸…ç†æ— æ•ˆçš„æœåŠ¡ï¼Œå³å·²å¸è½½åº”ç”¨çš„æ— ç”¨çš„é…ç½®brew services --help # æŸ¥çœ‹å¸®åŠ© é…ç½®å›½å†…é•œåƒæº ä¸Šé¢å®‰è£…éƒ¨åˆ†ä»‹ç»äº†å¦‚ä½•åœ¨å®‰è£…brewæ—¶å°±æŒ‡å®šé•œåƒæºï¼Œä½†æœ‰äº›æ—¶å€™å› ä¸ºæˆ‘ä»¬åœ¨å®‰è£…æ—¶å¿˜è®°é…ç½®ï¼Œæˆ–è€…åŸæ¥çš„é•œåƒæºå·²ç»å¤±æ•ˆéœ€è¦é‡æ–°é…ç½®ï¼Œæ­¤æ—¶å¯ä»¥æŒ‰ç…§ä¸‹é¢çš„æ–¹æ³•è¿›è¡Œé…ç½®ã€‚ æ­¤å¤„ä»¥é…ç½®æ¸…åé•œåƒæºä¸ºä¾‹ï¼Œé˜¿é‡Œé•œåƒæºè¯·å‚è€ƒé˜¿é‡Œçš„å®˜ç½‘æ–‡æ¡£â€“Homebrewé•œåƒï¼Œç§‘å¤§æºå‚è€ƒHomebrew 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475## ä¸´æ—¶æ›¿æ¢# é…ç½®brewå›½å†…é•œåƒæº$ export HOMEBREW_BREW_GIT_REMOTE=&quot;https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/brew.git&quot;# é…ç½®brew-coreå›½å†…é•œåƒæº$ export HOMEBREW_CORE_GIT_REMOTE=&quot;https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/homebrew-core.git&quot;# é…ç½®brew-bottleå›½å†…é•œåƒæº$ export HOMEBREW_API_DOMAIN=&quot;https://mirrors.tuna.tsinghua.edu.cn/homebrew-bottles/api&quot;$ export HOMEBREW_BOTTLE_DOMAIN=&quot;https://mirrors.tuna.tsinghua.edu.cn/homebrew-bottles&quot;# æ›´æ–°é…ç½®$ brew update## é…ç½®æ°¸ä¹…ç”Ÿæ•ˆï¼Œzshç”¨æˆ·# é…ç½®brewå›½å†…é•œåƒæº$ echo &#x27;export HOMEBREW_BREW_GIT_REMOTE=&quot;https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/brew.git&quot;&#x27; &gt;&gt; ~/.zshrc# é…ç½®brew-coreå›½å†…é•œåƒæº$ echo &#x27;export HOMEBREW_CORE_GIT_REMOTE=&quot;https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/homebrew-core.git&quot;&#x27; &gt;&gt; ~/.zshrc# é…ç½®brew-bottleå›½å†…é•œåƒæº$ echo &#x27;export HOMEBREW_API_DOMAIN=&quot;https://mirrors.tuna.tsinghua.edu.cn/homebrew-bottles/api&quot;&#x27; &gt;&gt; ~/.zshrc$ echo &#x27;export HOMEBREW_BOTTLE_DOMAIN=&quot;https://mirrors.tuna.tsinghua.edu.cn/homebrew-bottles&quot;&#x27; &gt;&gt; ~/.zshrc$ source ~/.zshrc# æ›´æ–°é…ç½®$ brew update# æ­¤æ—¶æŸ¥çœ‹brewé…ç½®ä¿¡æ¯ï¼Œå¯ä»¥çœ‹åˆ°å·²ç»ç”Ÿæ•ˆäº†$ brew configHOMEBREW_VERSION: 4.4.8-38-g6089077ORIGIN: https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/brew.gitHEAD: 60890774e0a70fe93f94973b080068cf7b0d1c93Last commit: 9 hours agoBranch: masterCore tap origin: https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/homebrew-core.gitCore tap HEAD: 787d1587bfa92794f7d141063a31773064ef9107Core tap last commit: 11 minutes agoCore tap JSON: 29 Nov 09:56 UTCCore cask tap HEAD: 4c34bd8c418e13160fc79f1ca9312555d2edc254Core cask tap last commit: 19 minutes agoCore cask tap JSON: 29 Nov 09:56 UTCHOMEBREW_PREFIX: /usr/localHOMEBREW_API_DOMAIN: https://mirrors.tuna.tsinghua.edu.cn/homebrew-bottles/apiHOMEBREW_BOTTLE_DOMAIN: https://mirrors.tuna.tsinghua.edu.cn/homebrew-bottlesHOMEBREW_BREW_GIT_REMOTE: https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/brew.gitHOMEBREW_CASK_OPTS: []HOMEBREW_CORE_GIT_REMOTE: https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/homebrew-core.gitHOMEBREW_GITHUB_API_TOKEN: setHOMEBREW_MAKE_JOBS: 12HOMEBREW_SORBET_RUNTIME: setHomebrew Ruby: 3.3.6 =&gt; /usr/local/Homebrew/Library/Homebrew/vendor/portable-ruby/3.3.6/bin/rubyCPU: dodeca-core 64-bit kabylakeClang: 15.0.0 build 1500Git: 2.43.0 =&gt; /usr/local/bin/gitCurl: 8.7.1 =&gt; /usr/bin/curlmacOS: 13.7.1-x86_64CLT: 15.0.0.0.1.1694021235Xcode: N/A# é€šè¿‡brewå‡çº§fdï¼Œå¯ä»¥çœ‹åˆ°ä½¿ç”¨äº†æ¸…åæº$ brew upgrade fd==&gt; Upgrading 1 outdated package:fd 8.2.1 -&gt; 10.2.0==&gt; Fetching fd==&gt; Downloading https://mirrors.tuna.tsinghua.edu.cn/homebrew-bottles/fd-10.2.0.ventura.bottle.tar.gz################################################################################################################################################################################### 100.0%==&gt; Verifying attestation for fd==&gt; Upgrading fd 8.2.1 -&gt; 10.2.0==&gt; Pouring fd-10.2.0.ventura.bottle.tar.gz==&gt; Caveatszsh completions have been installed to: /usr/local/share/zsh/site-functions==&gt; SummaryğŸº /usr/local/Cellar/fd/10.2.0: 14 files, 2.9MB==&gt; Running `brew cleanup fd`...Disable this behaviour by setting HOMEBREW_NO_INSTALL_CLEANUP.Hide these hints with HOMEBREW_NO_ENV_HINTS (see `man brew`).Removing: /usr/local/Cellar/fd/8.2.1... (13 files, 2.4MB) æ¢å¤ä¸ºé»˜è®¤çš„GitHubé•œåƒæº 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960$ unset HOMEBREW_BREW_GIT_REMOTE$ unset HOMEBREW_CORE_GIT_REMOTE$ unset HOMEBREW_API_DOMAIN$ unset HOMEBREW_BOTTLE_DOMAIN# å¦‚æœæ‚¨ä¹‹å‰æ°¸ä¹…é…ç½®äº† HOMEBREW ç¯å¢ƒå˜é‡ï¼Œè¿˜éœ€è¦åœ¨å¯¹åº”çš„ ~/.bash_profile æˆ–è€… ~/.zshrc é…ç½®æ–‡ä»¶ä¸­ï¼Œå°†å¯¹åº”çš„ HOMEBREW ç¯å¢ƒå˜é‡é…ç½®è¡Œåˆ é™¤$ source ~/.zshrc# æ›´æ–°brew$ git -C &quot;$(brew --repo)&quot; remote set-url origin https://github.com/Homebrew/brew# æ›´æ–°brew-coreï¼Œbrew4.0åä¸ä¼šå†ä¸‹è½½brew-coreï¼Œæ‰€ä»¥å¯ä»¥å¿½ç•¥# ä¸è¿‡ä»ä½ç‰ˆæœ¬å‡çº§ä¸Šæ¥çš„è¿˜ä¼šæœ‰è¿™ä¸ªä»“åº“ï¼Œå¯ä»¥é€šè¿‡ brew tap æŸ¥çœ‹æ˜¯å¦å­˜åœ¨ï¼Œå®é™…ä¸Šæ”¹ä¸æ”¹éƒ½ä¸ä¼šæœ‰å½±å“ï¼Œçœ‹ç€ä¸èˆ’æœå°±ä¿®æ”¹å§$ git -C &quot;$(brew --repo homebrew/core)&quot; remote set-url origin https://github.com/Homebrew/homebrew-core$ brew update# æŸ¥çœ‹brewé…ç½®ä¿¡æ¯$ brew configHOMEBREW_VERSION: 4.4.8-38-g6089077ORIGIN: https://github.com/Homebrew/brewHEAD: 60890774e0a70fe93f94973b080068cf7b0d1c93Last commit: 9 hours agoBranch: masterCore tap HEAD: 787d1587bfa92794f7d141063a31773064ef9107Core tap last commit: 13 minutes agoCore tap JSON: 29 Nov 10:09 UTCCore cask tap HEAD: 871fe2e8b93aac896a1808571ff11f8b89e6d90eCore cask tap last commit: 48 seconds agoCore cask tap JSON: 29 Nov 10:09 UTCHOMEBREW_PREFIX: /usr/localHOMEBREW_CASK_OPTS: []HOMEBREW_GITHUB_API_TOKEN: setHOMEBREW_MAKE_JOBS: 12HOMEBREW_SORBET_RUNTIME: setHomebrew Ruby: 3.3.6 =&gt; /usr/local/Homebrew/Library/Homebrew/vendor/portable-ruby/3.3.6/bin/rubyCPU: dodeca-core 64-bit kabylakeClang: 15.0.0 build 1500Git: 2.43.0 =&gt; /usr/local/bin/gitCurl: 8.7.1 =&gt; /usr/bin/curlmacOS: 13.7.1-x86_64CLT: 15.0.0.0.1.1694021235Xcode: N/A# é€šè¿‡brewå‡çº§telnetï¼Œå¯ä»¥çœ‹åˆ°ä½¿ç”¨äº†GitHubæº$ brew upgrade telnet==&gt; Upgrading 1 outdated package:telnet 294 -&gt; 303.141.1==&gt; Downloading https://ghcr.io/v2/homebrew/core/telnet/manifests/303.141.1################################################################################################################################################################################### 100.0%==&gt; Fetching telnet==&gt; Downloading https://ghcr.io/v2/homebrew/core/telnet/blobs/sha256:1be6b7b6a17a311fb3a2f1bffe7dae52284f3239b8af03f651c4fac11362f702################################################################################################################################################################################### 100.0%==&gt; Verifying attestation for telnet==&gt; Upgrading telnet 294 -&gt; 303.141.1==&gt; Pouring telnet--303.141.1.ventura.bottle.tar.gzğŸº /usr/local/Cellar/telnet/303.141.1: 5 files, 207.5KB==&gt; Running `brew cleanup telnet`...Disable this behaviour by setting HOMEBREW_NO_INSTALL_CLEANUP.Hide these hints with HOMEBREW_NO_ENV_HINTS (see `man brew`).Removing: /usr/local/Cellar/telnet/294... (4 files, 208.2KB) é‡è¦çš„è¯´æ˜ ç¯å¢ƒå˜é‡ brewå®‰è£…çš„è½¯ä»¶åŒ…ä¼šè¢«è½¯è¿æ¥åˆ°/usr/local/bin/ä¸‹ï¼Œæ‰€ä»¥éœ€è¦å°†è¯¥è·¯å¾„åŠ å…¥ç³»ç»Ÿç¯å¢ƒPATHä¸­ è¿™é‡Œè¦æ³¨æ„ä¸€ç‚¹ï¼Œå¦‚æœè¯¥è·¯å¾„åœ¨PATHä¸­å£°æ˜çš„æ¯”è¾ƒé å‰ï¼Œå°±å¯èƒ½ä¼šè¢«ä¼˜å…ˆä½¿ç”¨ï¼Œæ¯”å¦‚æˆ‘ä»¬å·²ç»æ‰‹å·¥åœ¨ç³»ç»Ÿä¸­å®‰è£…äº†pythonçš„æŸä¸ªç‰ˆæœ¬ï¼Œä½†é€šè¿‡brewå®‰è£…æŸäº›è½¯ä»¶åŒ…æ—¶å› ä¸ºå…¶ä¾èµ–pythonï¼Œå°±ä¼šé€šè¿‡brewåŒæ—¶å®‰è£…å¯¹åº”çš„pythonç‰ˆæœ¬ï¼Œæ­¤æ—¶æˆ‘ä»¬åœ¨ä½¿ç”¨pythonå‘½ä»¤æ—¶ï¼Œå°±ä¼šä¼˜å…ˆä½¿ç”¨è¿™ä¸ª æœ‰ä¸¤ç§æ–¹æ³•å¯ä»¥è§£å†³ï¼Œ1æ˜¯é€šè¿‡brew unlink pythonæ¥è§£é™¤é“¾æ¥ï¼Œæ­¤æ—¶å¹¶ä¸æ˜¯åˆ é™¤ï¼Œè€Œåªæ˜¯è§£é™¤äº†è½¯é“¾ï¼Œä¸ä¼šå½±å“ä¾èµ–å®ƒçš„å·¥å…·çš„ä½¿ç”¨ï¼Œå¦‚æœéœ€è¦æ¢å¤é“¾æ¥ï¼Œå¯ä»¥é€šè¿‡brew link pythonæ¥æ¢å¤é“¾æ¥ï¼›2æ˜¯å°†æˆ‘ä»¬çš„ç³»ç»Ÿä¸­è‡ªå·±å®‰è£…çš„ä¸€äº›å·¥å…·çš„è·¯å¾„å£°æ˜åœ¨/usr/local/bin/ä¹‹å‰ï¼Œè¿™æ ·å°±ä¸ä¼šæœ‰å½±å“äº†ã€‚ Homebrew 4.0 å¸¦æ¥çš„æ–°å˜åŒ– Homebrew 4.0 è¿›è¡Œäº†ä¸€é¡¹æœ€å¤§çš„æ”¹åŠ¨ï¼Œç»„ç»‡æ–¹å¼ä»Gitä»“åº“ç®¡ç†æ”¹ä¸ºJSONæ–‡ä»¶ä¸‹è½½ã€‚ JSONæ–‡ä»¶ä¼šä»formulae.brew.shä¸‹è½½ï¼Œè€Œä¸å†ä½¿ç”¨homebrew/coreã€homebrew/caskä¸¤ä¸ªä»“åº“ï¼Œæ‰€ä»¥å‡çº§åˆ°4.0åï¼Œæœ¬åœ°çš„homebrew/coreã€homebrew/cask ä»“åº“éƒ½å¯ä»¥åˆ é™¤ä»¥é‡Šæ”¾ç£ç›˜ç©ºé—´ã€‚ 12345678910111213141516# æŸ¥çœ‹æœ¬åœ°ä»“åº“$ brew taphomebrew/cask # cask ä»“åº“ï¼ŒGUIçš„å·¥å…·ä¼šä»æ­¤ä¸‹è½½ï¼Œbrew4.0åä¸å†ä½¿ç”¨homebrew/core # core ä»“åº“ï¼Œå³ formula ä»“åº“ï¼Œå‘½ä»¤è¡Œå·¥å…·ä¼šä»æ­¤ä¸‹è½½ï¼Œbrew4.0åä¸å†ä½¿ç”¨homebrew/services # services ä»“åº“ï¼Œservices å·¥å…·æœ¬èº«ä¼šä»æ­¤ä¸‹è½½ï¼Œbrew4.0åä¾æ—§ä½¿ç”¨# åˆ é™¤æœ¬åœ°ä»“åº“$ brew untap homebrew/core$ brew untap homebrew/cask# æ­¤æ—¶å†æ¬¡æ‰§è¡Œ brew outdated ç­‰å‘½ä»¤æ—¶ï¼Œä¼šçœ‹åˆ°jsonæ–‡ä»¶è¢«ä¸‹è½½äº†ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œè¯¥jsonæ–‡ä»¶é—´éš”24å°æ—¶æ›´æ–°ä¸€æ¬¡$ brew outdated==&gt; Downloading https://formulae.brew.sh/api/formula.jws.json##################################################################################### 100.0%==&gt; Downloading https://formulae.brew.sh/api/cask.jws.json##################################################################################### 100.0% å¦‚æœè¿˜æƒ³ä½¿ç”¨æ—§çš„ä»“åº“æ¨¡å¼ï¼Œåªè¦é…ç½®ä¸‹ç¯å¢ƒå˜é‡ 1echo &#x27;export HOMEBREW_NO_INSTALL_FROM_API=1&#x27; &gt;&gt; ~/.zshrc ä»é•œåƒæºçš„åˆ‡æ¢æ¥ç†è§£brewä¸‹è½½å®‰è£…åŒ…çš„è¿‡ç¨‹ å‰é¢æˆ‘ä»¬ä»‹ç»è¿‡ï¼Œåˆ‡æ¢é•œåƒæºæ—¶è¦è®¾ç½®4ä¸ªç¯å¢ƒå˜é‡ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆè¦è®¾ç½®è¿™å‡ ä¸ªå˜é‡å‘¢ï¼Ÿå®ƒä»¬çš„ä½œç”¨æ˜¯ä»€ä¹ˆå‘¢ï¼Œä¸‹é¢æˆ‘å°±ä¸€ä¸ªä¸€ä¸ªè¯´æ˜ï¼š HOMEBREW_BREW_GIT_REMOTE è®¾ç½®brewä»“åº“ï¼Œç”¨äºæ›´æ–°brewå‘½ä»¤æœ¬èº«ï¼Œè¿™ä¸ªæ¯”è¾ƒå®¹æ˜“ç†è§£ HOMEBREW_CORE_GIT_REMOTE è®¾ç½®coreä»“åº“ï¼Œç”¨äºæ›´æ–°formulaçš„å®‰è£…è„šæœ¬ å½“é€šè¿‡brew info xxxæŸ¥çœ‹å®‰è£…åŒ…ä¿¡æ¯æ—¶ï¼Œå¯ä»¥çœ‹åˆ°Fromä¿¡æ¯ï¼Œè¿™ä¸ªå°±æ˜¯å‘½ä»¤çš„å®‰è£…è„šæœ¬ï¼Œæ¯”å¦‚ä¸‹é¢çš„fd.rb 1234567891011121314151617181920212223$ brew info fd==&gt; fd: stable 10.2.0 (bottled), HEADSimple, fast and user-friendly alternative to findhttps://github.com/sharkdp/fdConflicts with: fdclone (because both install `fd` binaries)Installed/usr/local/Cellar/fd/10.2.0 (14 files, 2.9MB) * Poured from bottle using the formulae.brew.sh API on 2024-11-29 at 18:02:16From: https://github.com/Homebrew/homebrew-core/blob/HEAD/Formula/f/fd.rbLicense: Apache-2.0 OR MIT==&gt; DependenciesBuild: rust âœ˜==&gt; Options--HEAD Install HEAD version==&gt; Caveatszsh completions have been installed to: /usr/local/share/zsh/site-functions==&gt; Analyticsinstall: 6,327 (30 days), 24,518 (90 days), 116,476 (365 days)install-on-request: 6,326 (30 days), 24,515 (90 days), 116,363 (365 days)build-error: 0 (30 days) è¿™ä¸ªå®‰è£…è„šæœ¬ä¸­åŒ…å«bottle doéƒ¨åˆ†ï¼Œå…¶ä½œç”¨æ˜¯å½“å®‰è£…è„šæœ¬æ—¶ï¼Œä¼˜å…ˆä»è¯¥éƒ¨åˆ†è·å–å¯¹åº”çš„æ“ä½œç³»ç»Ÿçš„äºŒè¿›åˆ¶é¢„ç¼–è¯‘åŒ…çš„sha256æ ¡éªŒå€¼ï¼Œå¦‚æœä»å¯¹åº”çš„äºŒè¿›åˆ¶æºä¸­æ‰¾åˆ°ï¼Œåˆ™ç›´æ¥ä»äºŒè¿›åˆ¶é¢„ç¼–è¯‘åŒ…çš„åœ°å€è¿›è¡Œä¸‹è½½ï¼Œè¯¥é¢„ç¼–è¯‘ä¸‹è½½åœ°å€ç”±HOMEBREW_BOTTLE_DOMAINæŒ‡å®šï¼Œé»˜è®¤ä»å®˜æ–¹æºä¸‹è½½ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940class Fd &lt; Formula desc &quot;Simple, fast and user-friendly alternative to find&quot; homepage &quot;https://github.com/sharkdp/fd&quot; url &quot;https://github.com/sharkdp/fd/archive/refs/tags/v10.2.0.tar.gz&quot; sha256 &quot;73329fe24c53f0ca47cd0939256ca5c4644742cb7c14cf4114c8c9871336d342&quot; license any_of: [&quot;Apache-2.0&quot;, &quot;MIT&quot;] head &quot;https://github.com/sharkdp/fd.git&quot;, branch: &quot;master&quot; bottle do sha256 cellar: :any_skip_relocation, arm64_sequoia: &quot;9d17cfb029fbdc6ed31c732108f7aa746d3082dd4783ed35471ef79340615509&quot; sha256 cellar: :any_skip_relocation, arm64_sonoma: &quot;82d5c2ffc2e2d0d8643a7c3f620c81ed49d7b23920aa23b6a7f4c50be69abc0b&quot; sha256 cellar: :any_skip_relocation, arm64_ventura: &quot;354412ababb7d6c52abd9153ff96f133391406ce292b2122c76b96c2ab714f87&quot; sha256 cellar: :any_skip_relocation, arm64_monterey: &quot;0b41f292041767fd1c3c5b92daaa6c823fb07c1d7cd11b0427a415f08463f035&quot; sha256 cellar: :any_skip_relocation, sonoma: &quot;4fa0fb4b3f512e45d35c569953efc7c59ebd8976caac9b2c1b1394b7e29157a0&quot; sha256 cellar: :any_skip_relocation, ventura: &quot;b1406e5414252b1e1b90cfad188454eb31058256ed6246baed48c4e1cfe593a1&quot; sha256 cellar: :any_skip_relocation, monterey: &quot;0ac060bf7d1529aa1f65e634f64b98b906df533d71f2185c883165c01f59ad53&quot; sha256 cellar: :any_skip_relocation, x86_64_linux: &quot;2464fb21cc981166ffa9783fa14a09265790af4d89ce3a763421ddaf29119541&quot; end depends_on &quot;rust&quot; =&gt; :build conflicts_with &quot;fdclone&quot;, because: &quot;both install `fd` binaries&quot; def install system &quot;cargo&quot;, &quot;install&quot;, *std_cargo_args man1.install &quot;doc/fd.1&quot; generate_completions_from_executable(bin/&quot;fd&quot;, &quot;--gen-completions&quot;, shells: [:bash, :fish]) zsh_completion.install &quot;contrib/completion/_fd&quot; # Bash completions are not compatible with Bash 3 so don&#x27;t use v1 directory. # bash: complete: nosort: invalid option name # Issue ref: https://github.com/clap-rs/clap/issues/5190 (share/&quot;bash-completion/completions&quot;).install bash_completion.children end test do touch &quot;foo_file&quot; touch &quot;test_file&quot; assert_equal &quot;test_file&quot;, shell_output(&quot;#&#123;bin&#125;/fd test&quot;).chomp endend æ³¨æ„ï¼Œbrew4.0åä¸å†ä½¿ç”¨ä»è¯¥gitä»“åº“ä¸­è·å–å®‰è£…è„šæœ¬ï¼Œå› ä¸ºformulaçš„å®‰è£…æºä»£ç å·²ç»å…¨éƒ¨å­˜å‚¨åœ¨jsonæ–‡ä»¶ä¸­(è§HOMEBREW_API_DOMAINè¯´æ˜)ï¼Œä¸å†éœ€è¦é€šè¿‡Gitä»“åº“ä¸‹è½½ åˆ‡æ¢é•œåƒæºæ—¶ï¼Œbrew4.0åä¸éœ€è¦è®¾ç½®è¯¥ç¯å¢ƒå˜é‡ HOMEBREW_API_DOMAIN è®¾ç½®formula\\caskçš„å®‰è£…è„šæœ¬ä¸‹è½½æºï¼Œé»˜è®¤https://formulae.brew.sh brew4.0åä¸å†ä»gitä»“åº“è·å–å®‰è£…è„šæœ¬ï¼Œè€Œæ˜¯ä»è¿™ä¸ªjsonæ–‡ä»¶ä¸­ä¸€æ¬¡æ€§è·å–æ‰€æœ‰å·¥å…·çš„å®‰è£…è„šæœ¬ï¼Œé»˜è®¤24å°æ—¶æ›´æ–°ä¸€æ¬¡ 1234567å®˜æ–¹æºï¼š formulaæºï¼šhttps://formulae.brew.sh/api/formula.jws.json caskæºï¼šhttps://formulae.brew.sh/api/cask.jws.jsonæ¸…åæºï¼š formulaæºï¼šhttps://mirrors.tuna.tsinghua.edu.cn/homebrew-bottles/api/formula.jws.json caskæºï¼šhttps://mirrors.tuna.tsinghua.edu.cn/homebrew-bottles/api/cask.jws.json å¦‚æœè¿˜æƒ³ä½¿ç”¨æ—§çš„ä»“åº“æ¨¡å¼ï¼Œåªè¦é…ç½®ä¸‹ç¯å¢ƒå˜é‡ï¼Œè¿™æ ·å³ä½¿ä½ å‡çº§åå·²ç»åˆ é™¤äº†å¯¹åº”çš„ä»“åº“ï¼Œå®ƒä¹Ÿä¼šåœ¨ç¬¬ä¸€æ¬¡ä½¿ç”¨åˆ°æ—¶è‡ªåŠ¨ä¸‹è½½ 12# å®˜æ–¹ä¹Ÿæåˆ°ï¼Œéå¼€å‘äººå‘˜æ²¡å¿…è¦è¿™æ ·åšecho &#x27;export HOMEBREW_NO_INSTALL_FROM_API=1&#x27; &gt;&gt; ~/.zshrc HOMEBREW_BOTTLE_DOMAIN æŒ‡å®šé¢„ç¼–è¯‘äºŒè¿›åˆ¶åŒ…ï¼ˆä¹Ÿç§°ä¸º bottlesï¼‰çš„ä¸‹è½½åœ°å€ï¼ŒHomebrew ä½¿ç”¨è¿™äº› bottles æ¥åŠ é€Ÿè½¯ä»¶å®‰è£…è¿‡ç¨‹ï¼Œé¿å…åœ¨æ¯ä¸ªç”¨æˆ·çš„è®¡ç®—æœºä¸Šéƒ½é‡æ–°ä»æºä»£ç æ„å»ºè½¯ä»¶ã€‚ å½“æˆ‘ä»¬é€šè¿‡brew install xxxå®‰è£…è½¯ä»¶æ—¶ï¼Œbrewä¼šå…ˆä»è¯¥formulaçš„å®‰è£…è„šæœ¬ï¼ˆ4.0ä»¥å‰ä»HOMEBREW_CORE_GIT_REMOTEæŒ‡å®šçš„gitä»“åº“è·å–ï¼Œ4.0ä»¥åä»HOMEBREW_API_DOMAINæŒ‡å®šçš„jsonæ–‡ä»¶ä¸­è·å–ï¼‰ä¸­è·å–è¯¥è½¯ä»¶çš„å®‰è£…ä¿¡æ¯ï¼Œç„¶åæ ¹æ®å®‰è£…ä¿¡æ¯ä»bottleä¸­ä¸‹è½½å¯¹åº”çš„é¢„ç¼–è¯‘äºŒè¿›åˆ¶åŒ…ï¼Œå†å°†å…¶å®‰è£…åˆ°æœ¬åœ°ã€‚ ä¸‹è½½åçš„äºŒè¿›åˆ¶åŒ…ä¼šè¢«ä¿å­˜åˆ°ç¼“å­˜ç›®å½•ä¸­(brew --cache)ï¼Œå®‰è£…åçš„è½¯ä»¶åŒ…å­˜å‚¨åˆ°Cellarç›®å½•ä¸­(brew --cellar) é€šè¿‡ä¸Šé¢çš„åˆ†æï¼Œæˆ‘ä»¬å¯ä»¥å¾—å‡ºç»“è®ºï¼Œåˆ‡æ¢é•œåƒæºæ—¶ï¼Œå®é™…ä¸Šåªéœ€è¦è®¾ç½®3ä¸ªå˜é‡å°±å¤Ÿäº† 123HOMEBREW_BREW_GIT_REMOTEHOMEBREW_API_DOMAINHOMEBREW_BOTTLE_DOMAIN","summary":"æ‘˜è¦ brewæ˜¯ä¸€ä¸ªè½¯ä»¶åŒ…ç®¡ç†å™¨ï¼ŒåŒæ—¶æ”¯æŒMacOSå’ŒLinuxï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿åœ°å®‰è£…å„ç§è½¯ä»¶ï¼Œæ¯”å¦‚gitã€nodeã€pythonç­‰ã€‚ brewè™½ç„¶æ”¯æŒlinuxï¼Œä½†æ˜¯å®é™…ä½¿ç”¨ä¸­å¾ˆå°‘ä¼šä½¿ç”¨brewæ¥ç®¡ç†linuxçš„è½¯ä»¶åŒ…ã€‚ æœ¬æ–‡ä»‹ç»å¦‚ä½•åœ¨macosä¸‹å®‰è£…brewï¼Œä»¥åŠå¦‚ä½•ä½¿ç”¨brewç®¡ç†å„ç§è½¯ä»¶åŒ…ã€‚ æœ¬æ–‡åŸºäº MacOS Intel Ventura 13.7.1ï¼Œbrew ç‰ˆæœ¬ä¸º4.4.8ã€‚","date_published":"2024-11-28T13:55:05.000Z","tags":["macos","macos","brew"]},{"id":"https://blog.hanqunfeng.com/2024/11/22/python_poetry/","url":"https://blog.hanqunfeng.com/2024/11/22/python_poetry/","title":"Poetry--è½»é‡çº§çš„pythonåŒ…ç®¡ç†å™¨","content_html":"<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\"><a href=\"https://python-poetry.org/docs/\">Poetry</a>æ˜¯ä¸€ä¸ªè½»é‡çº§çš„pythonåŒ…ç®¡ç†å™¨ï¼Œå…¶ç›®æ ‡æ˜¯å¸®åŠ©å¼€å‘è€…å¿«é€Ÿã€è½»æ¾åœ°æ„å»ºã€å‘å¸ƒå’Œåˆ†äº«pythonåŒ…ã€‚è¯´å®ƒè½»é‡ï¼Œæ˜¯ä¸ <a href=\"https://docs.conda.io/projects/conda/en/stable/\">conda</a> ç›¸æ¯” poetry æ›´è½»é‡ï¼ŒåŒæ—¶ä¸ <code>venv + pip</code> <a href=\"/2018/04/28/python_virtualenv/\" title=\"Python--virtualenv\">Python--virtualenv</a> çš„æ–¹å¼ç›¸æ¯”å…·æœ‰å¦‚ä¸‹ä¼˜ç‚¹ï¼š\n<ul class=\"lvl-2\">\n<li class=\"lvl-6\">ä½¿ç”¨ç¼“å­˜æœºåˆ¶ï¼Œé¿å…é‡å¤ä¸‹è½½ä¾èµ–åŒ…</li>\n<li class=\"lvl-6\">åŒ…ç®¡ç†ä¸Šæ›´åŠ ç²¾ç¡®ï¼Œåˆ é™¤ä¸éœ€è¦çš„åŒ…æ—¶ä¼šåŒæ—¶åˆ é™¤ä¸å…¶å…³è”çš„ä¸”æ²¡æœ‰è¢«ä½¿ç”¨çš„é‚£äº›ä¾èµ–åŒ…ï¼Œé¿å…æ— ç”¨çš„ä¾èµ–åŒ…é€ æˆæ‰“åŒ…ä½“ç§¯è¿‡å¤§</li>\n<li class=\"lvl-6\">æ‰“åŒ…å’Œå‘å¸ƒæ›´åŠ ç®€å•ï¼Œåªéœ€è¦ä¸€ä¸ªå‘½ä»¤å°±å¯ä»¥æ‰“åŒ…å’Œå‘å¸ƒ</li>\n</ul>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"å®‰è£…\">å®‰è£…</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å‚è€ƒå®˜æ–¹æ–‡æ¡£<a href=\"https://python-poetry.org/docs/#installation\">Installation</a></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å®˜æ–¹æ¨èä½¿ç”¨pipxå®‰è£…ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨ pip</span></span><br><span class=\"line\">$ pipx install poetry</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹æ˜¯å¦å®‰è£…æˆåŠŸ</span></span><br><span class=\"line\">$ poetry --version</span><br><span class=\"line\">Poetry (version 1.8.4)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ·»åŠ å‘½ä»¤è‡ªåŠ¨è¡¥å…¨</span></span><br><span class=\"line\">$ <span class=\"built_in\">mkdir</span>  ~/.zfunc</span><br><span class=\"line\">$ poetry completions zsh &gt; ~/.zfunc/_poetry</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åœ¨ ~/.zshrc ä¸­æ·»åŠ ä»¥ä¸‹é…ç½®ï¼ˆæˆ‘æ˜¯ç”¨çš„æ˜¯zshï¼Œå…¶ä»–shellå¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼‰</span></span><br><span class=\"line\">fpath+=~/.zfunc</span><br><span class=\"line\"><span class=\"built_in\">autoload</span> -Uz compinit &amp;&amp; compinit</span><br></pre></td></tr></table></figure>\n<div class=\"tips\">\n<p><em><strong>pipxç®€ä»‹</strong></em></p>\n<ul class=\"lvl-1\">\n<li class=\"lvl-2\">\n<p><a href=\"https://github.com/pypa/pipx\">pipx</a> æ˜¯ä¸€ä¸ª Python åŒ…ç®¡ç†å·¥å…·ï¼Œä½¿ç”¨pipxå®‰è£…å·¥å…·åŒ…æ—¶ï¼Œæ¯ä¸ªå·¥å…·éƒ½ä¼šè¢«å®‰è£…åœ¨ä¸€ä¸ªç‹¬ç«‹çš„è™šæ‹Ÿç¯å¢ƒä¸­ï¼Œé¿å…ä¸åŒå·¥å…·ä¹‹é—´çš„ä¾èµ–å†²çªã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>åœºæ™¯ï¼šä¸¤ä¸ªå·¥å…·ä¾èµ–ä¸åŒç‰ˆæœ¬çš„åŒä¸€ä¸ªåº“<br>\nå‡è®¾æˆ‘ä»¬æœ‰ä¸¤ä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼š</p>\n<p>å·¥å…·A ä¾èµ–äº requests åº“çš„ç‰ˆæœ¬ 2.27.1ã€‚<br>\nå·¥å…·B ä¾èµ–äº requests åº“çš„ç‰ˆæœ¬ 2.31.0ã€‚</p>\n<p>å¦‚æœä½¿ç”¨ pip å®‰è£…<br>\nå·¥å…·ä¼šè¢«å®‰è£…åˆ°å…¨å±€ç¯å¢ƒï¼Œå…±äº«ç›¸åŒçš„ä¾èµ–ç‰ˆæœ¬ï¼š</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pip install toolA  <span class=\"comment\"># å®‰è£…æ—¶ä¼šå®‰è£… requests 2.27.1</span></span><br><span class=\"line\">pip install toolB  <span class=\"comment\"># å®‰è£…æ—¶ä¼šå°† requests å‡çº§åˆ° 2.31.0</span></span><br></pre></td></tr></table></figure>\n<p>ç»“æœï¼š<br>\nå½“ä½ è¿è¡Œå·¥å…·Aæ—¶ï¼Œå®ƒå¯èƒ½ä¼šæŠ¥é”™ï¼Œå› ä¸ºå®ƒä¾èµ–çš„ requests 2.27.1 å·²è¢« requests 2.31.0 æ›¿æ¢ã€‚<br>\nå…¨å±€ç¯å¢ƒä¸­çš„æ‰€æœ‰å·¥å…·éƒ½å…±äº«ä¸€ä¸ª requestsï¼Œç‰ˆæœ¬å†²çªä¸å¯é¿å…ã€‚</p>\n<p>å¦‚æœä½¿ç”¨ pipx å®‰è£…<br>\næ¯ä¸ªå·¥å…·ä¼šè¢«å®‰è£…åˆ°ç‹¬ç«‹çš„è™šæ‹Ÿç¯å¢ƒä¸­ï¼Œå„è‡ªçš„ä¾èµ–äº’ä¸å½±å“ï¼š</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pipx install toolA  <span class=\"comment\"># åœ¨è™šæ‹Ÿç¯å¢ƒAä¸­å®‰è£… toolA å’Œ requests 2.27.1</span></span><br><span class=\"line\">pipx install toolB  <span class=\"comment\"># åœ¨è™šæ‹Ÿç¯å¢ƒBä¸­å®‰è£… toolB å’Œ requests 2.31.0</span></span><br></pre></td></tr></table></figure>\n<p>ç»“æœï¼š<br>\nè™šæ‹Ÿç¯å¢ƒA åªåŒ…å« toolA å’Œå®ƒçš„ä¾èµ– requests 2.27.1ã€‚<br>\nè™šæ‹Ÿç¯å¢ƒB åªåŒ…å« toolB å’Œå®ƒçš„ä¾èµ– requests 2.31.0ã€‚<br>\nå·¥å…·ä¹‹é—´å®Œå…¨éš”ç¦»ï¼Œä¸ä¼šå› ä¸ºä¾èµ–ç‰ˆæœ¬å†²çªè€Œå¯¼è‡´é—®é¢˜ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>æ‰€ä»¥ï¼Œå½“éœ€è¦å®‰è£…å…¨å±€å‘½ä»¤è¡Œå·¥å…·æ—¶ï¼Œä½¿ç”¨pipxæ˜¯ä¸ªå¾ˆå¥½çš„é€‰æ‹©</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://github.com/pypa/pipx\">pipx</a> çš„å®‰è£…</p>\n</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å®‰è£…pipx</span></span><br><span class=\"line\">pip install pipx</span><br><span class=\"line\"><span class=\"comment\"># é…ç½®ç¯å¢ƒå˜é‡ï¼Œè¿è¡Œè¯¥å‘½ä»¤ä¼šå°†</span></span><br><span class=\"line\">pipx ensurepath</span><br><span class=\"line\"><span class=\"comment\"># è¿è¡Œä¸Šé¢çš„å‘½ä»¤ä¼šå°†å¦‚ä¸‹å†…å®¹åŠ å…¥ä½ çš„shellé…ç½®æ–‡ä»¶ä¸­ï¼Œæˆ‘çš„æ˜¯ .zshrc æ–‡ä»¶ï¼Œå®é™…ä¸Šä½ ä¹Ÿå¯ä»¥æ‰‹å·¥æ·»åŠ è¯¥é…ç½®ï¼Œå°†$HOME/.local/binæ”¾åˆ°å‰é¢æ›´å¥½ä¸€äº›ã€‚</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> PATH=<span class=\"string\">&quot;<span class=\"variable\">$PATH</span>:<span class=\"variable\">$HOME</span>/.local/bin&quot;</span></span><br><span class=\"line\"><span class=\"comment\"># æ³¨æ„æ·»åŠ å®Œæˆåè¦é‡å¯shell</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ·»åŠ pipxè‡ªåŠ¨ä»£ç è¡¥å…¨</span></span><br><span class=\"line\"><span class=\"comment\"># è¿è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œå¹¶æ ¹æ®æç¤ºå®Œæˆ</span></span><br><span class=\"line\">pipx completions</span><br><span class=\"line\"><span class=\"comment\"># æˆ‘çš„æ˜¯zshï¼Œæ‰€ä»¥åœ¨ .zshrcä¸­æ·»åŠ å¦‚ä¸‹å†…å®¹</span></span><br><span class=\"line\"><span class=\"built_in\">autoload</span> -Uz compinit &amp;&amp; compinit <span class=\"comment\"># å¦‚æœæ²¡æœ‰æ·»åŠ è¿‡å°±éœ€è¦å…ˆæ·»åŠ è¿™ä¸ª</span></span><br><span class=\"line\"><span class=\"built_in\">eval</span> <span class=\"string\">&quot;<span class=\"subst\">$(register-python-argcomplete pipx)</span>&quot;</span> <span class=\"comment\"># æ·»åŠ è‡ªåŠ¨ä»£ç è¡¥å…¨</span></span><br><span class=\"line\"><span class=\"comment\"># æ³¨æ„æ·»åŠ å®Œæˆåè¦é‡å¯shell</span></span><br></pre></td></tr></table></figure>\n</div>\n<h2 id=\"æŸ¥çœ‹æ‰€æœ‰å‘½ä»¤\">æŸ¥çœ‹æ‰€æœ‰å‘½ä»¤</h2>\n<blockquote>\n<p>æˆ‘å·²ç»å°†å…¶ç¿»è¯‘ä¸ºä¸­æ–‡</p>\n</blockquote>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ poetry list</span><br><span class=\"line\">Poetry (ç‰ˆæœ¬ 1.8.4)</span><br><span class=\"line\"></span><br><span class=\"line\">ç”¨æ³•ï¼š</span><br><span class=\"line\">  <span class=\"built_in\">command</span> [é€‰é¡¹] [å‚æ•°]</span><br><span class=\"line\"></span><br><span class=\"line\">é€‰é¡¹ï¼š</span><br><span class=\"line\">  -h, --<span class=\"built_in\">help</span>                 æ˜¾ç¤ºç»™å®šå‘½ä»¤çš„å¸®åŠ©ã€‚å¦‚æœæ²¡æœ‰æŒ‡å®šå‘½ä»¤ï¼Œåˆ™æ˜¾ç¤ºåˆ—è¡¨å‘½ä»¤çš„å¸®åŠ©ã€‚</span><br><span class=\"line\">  -q, --quiet                ä¸è¾“å‡ºä»»ä½•æ¶ˆæ¯ã€‚</span><br><span class=\"line\">  -V, --version              æ˜¾ç¤ºæ­¤åº”ç”¨ç¨‹åºç‰ˆæœ¬ã€‚</span><br><span class=\"line\">      --ansi                å¼ºåˆ¶è¾“å‡ºANSIæ ¼å¼ã€‚</span><br><span class=\"line\">      --no-ansi             ç¦ç”¨ANSIè¾“å‡ºã€‚</span><br><span class=\"line\">  -n, --no-interaction       ä¸è¦æé—®ä»»ä½•äº¤äº’æ€§é—®é¢˜ã€‚</span><br><span class=\"line\">      --no-plugins           ç¦ç”¨æ’ä»¶ã€‚</span><br><span class=\"line\">      --no-cache            ç¦ç”¨æºç¼“å­˜ã€‚</span><br><span class=\"line\">  -C, --directory=ç›®å½•      Poetryå‘½ä»¤çš„å·¥ä½œç›®å½•ï¼ˆé»˜è®¤ä¸ºå½“å‰å·¥ä½œç›®å½•ï¼‰ã€‚</span><br><span class=\"line\">  -v|vv|vvv, --verbose       å¢åŠ æ¶ˆæ¯çš„å†—é•¿åº¦ï¼š1 è¡¨ç¤ºæ­£å¸¸è¾“å‡ºï¼Œ2 è¡¨ç¤ºæ›´è¯¦ç»†çš„è¾“å‡ºï¼Œ3 è¡¨ç¤ºè°ƒè¯•ã€‚</span><br><span class=\"line\"></span><br><span class=\"line\">å¯ç”¨å‘½ä»¤ï¼š</span><br><span class=\"line\">  about              æ˜¾ç¤ºå…³äºPoetryçš„ä¿¡æ¯ã€‚</span><br><span class=\"line\">  add                å°†æ–°ä¾èµ–é¡¹æ·»åŠ åˆ°pyproject.tomlå¹¶å®‰è£…å®ƒã€‚</span><br><span class=\"line\">  build              é»˜è®¤æ„å»ºä¸€ä¸ªåŒ…ï¼Œåˆ†åˆ«æ˜¯tarballå’Œwheelã€‚</span><br><span class=\"line\">  check              éªŒè¯pyproject.tomlæ–‡ä»¶çš„å†…å®¹åŠå…¶ä¸poetry.lockæ–‡ä»¶çš„ä¸€è‡´æ€§ã€‚</span><br><span class=\"line\">  config             ç®¡ç†é…ç½®è®¾ç½®ã€‚</span><br><span class=\"line\">  <span class=\"built_in\">export</span>             å°†é”æ–‡ä»¶å¯¼å‡ºåˆ°å…¶ä»–æ ¼å¼ã€‚</span><br><span class=\"line\">  <span class=\"built_in\">help</span>               æ˜¾ç¤ºç‰¹å®šå‘½ä»¤çš„å¸®åŠ©ã€‚</span><br><span class=\"line\">  init               åœ¨å½“å‰ç›®å½•åˆ›å»ºä¸€ä¸ªåŸºç¡€çš„pyproject.tomlæ–‡ä»¶ã€‚</span><br><span class=\"line\">  install            å®‰è£…é¡¹ç›®ä¾èµ–é¡¹ã€‚</span><br><span class=\"line\">  list               åˆ—å‡ºå‘½ä»¤ã€‚</span><br><span class=\"line\">  lock              é”å®šé¡¹ç›®ä¾èµ–é¡¹ã€‚</span><br><span class=\"line\">  new               åœ¨&lt;path&gt;å¤„åˆ›å»ºä¸€ä¸ªæ–°çš„Pythoné¡¹ç›®ã€‚</span><br><span class=\"line\">  publish           å°†åŒ…å‘å¸ƒåˆ°è¿œç¨‹ä»“åº“ã€‚</span><br><span class=\"line\">  remove            ä»é¡¹ç›®ä¾èµ–é¡¹ä¸­ç§»é™¤åŒ…ã€‚</span><br><span class=\"line\">  run                åœ¨é€‚å½“çš„ç¯å¢ƒä¸­è¿è¡Œå‘½ä»¤ã€‚</span><br><span class=\"line\">  search            åœ¨è¿œç¨‹ä»“åº“ä¸­æœç´¢åŒ…ã€‚</span><br><span class=\"line\">  shell            åœ¨è™šæ‹Ÿç¯å¢ƒä¸­å¯åŠ¨shellã€‚</span><br><span class=\"line\">  show              æ˜¾ç¤ºæœ‰å…³åŒ…çš„ä¿¡æ¯ã€‚</span><br><span class=\"line\">  update            æ ¹æ®pyproject.tomlæ–‡ä»¶æ›´æ–°ä¾èµ–é¡¹ã€‚</span><br><span class=\"line\">  version           æ˜¾ç¤ºé¡¹ç›®çš„ç‰ˆæœ¬æˆ–åœ¨æä¾›æœ‰æ•ˆç‰ˆæœ¬è§„åˆ™æ—¶æ›´æ–°å®ƒã€‚</span><br><span class=\"line\"></span><br><span class=\"line\">ç¼“å­˜</span><br><span class=\"line\">  cache clear        æŒ‰åç§°æ¸…é™¤Poetryç¼“å­˜ã€‚</span><br><span class=\"line\">  cache list         åˆ—å‡ºPoetryçš„ç¼“å­˜åˆ—è¡¨ã€‚</span><br><span class=\"line\"></span><br><span class=\"line\">è°ƒè¯•</span><br><span class=\"line\">  debug info        æ˜¾ç¤ºè°ƒè¯•ä¿¡æ¯ã€‚</span><br><span class=\"line\">  debug resolve    è°ƒè¯•ä¾èµ–é¡¹è§£æã€‚</span><br><span class=\"line\"></span><br><span class=\"line\">ç¯å¢ƒ</span><br><span class=\"line\">  <span class=\"built_in\">env</span> info         æ˜¾ç¤ºå½“å‰ç¯å¢ƒçš„ä¿¡æ¯ã€‚</span><br><span class=\"line\">  <span class=\"built_in\">env</span> list          åˆ—å‡ºä¸å½“å‰é¡¹ç›®å…³è”çš„æ‰€æœ‰è™šæ‹Ÿç¯å¢ƒã€‚</span><br><span class=\"line\">  <span class=\"built_in\">env</span> remove        ç§»é™¤ä¸é¡¹ç›®å…³è”çš„è™šæ‹Ÿç¯å¢ƒã€‚</span><br><span class=\"line\">  <span class=\"built_in\">env</span> use           æ¿€æ´»æˆ–åˆ›å»ºå½“å‰é¡¹ç›®çš„æ–°çš„è™šæ‹Ÿç¯å¢ƒã€‚</span><br><span class=\"line\"></span><br><span class=\"line\">è‡ªèº«</span><br><span class=\"line\">  self add          å‘Poetryçš„è¿è¡Œæ—¶ç¯å¢ƒæ·»åŠ å…¶ä»–åŒ…ã€‚</span><br><span class=\"line\">  self install      å®‰è£…æ­¤Poetryå®‰è£…æ‰€éœ€çš„é”å®šåŒ…ï¼ˆåŒ…æ‹¬æ’ä»¶ï¼‰ã€‚</span><br><span class=\"line\">  self lock         é”å®šPoetryå®‰è£…çš„ç³»ç»Ÿè¦æ±‚ã€‚</span><br><span class=\"line\">  self remove       ä»Poetryçš„è¿è¡Œæ—¶ç¯å¢ƒä¸­ç§»é™¤å…¶ä»–åŒ…ã€‚</span><br><span class=\"line\">  self show         æ˜¾ç¤ºPoetryè¿è¡Œæ—¶ç¯å¢ƒä¸­çš„åŒ…ã€‚</span><br><span class=\"line\">  self show plugins æ˜¾ç¤ºå½“å‰å·²å®‰è£…æ’ä»¶çš„ä¿¡æ¯ã€‚</span><br><span class=\"line\">  self update       æ›´æ–°Poetryåˆ°æœ€æ–°ç‰ˆæœ¬ã€‚</span><br><span class=\"line\"></span><br><span class=\"line\">æº</span><br><span class=\"line\">  <span class=\"built_in\">source</span> add         ä¸ºé¡¹ç›®æ·»åŠ æºé…ç½®ã€‚</span><br><span class=\"line\">  <span class=\"built_in\">source</span> remove      ç§»é™¤ä¸ºé¡¹ç›®é…ç½®çš„æºã€‚</span><br><span class=\"line\">  <span class=\"built_in\">source</span> show        æ˜¾ç¤ºä¸ºé¡¹ç›®é…ç½®çš„æºä¿¡æ¯ã€‚</span><br></pre></td></tr></table></figure>\n<h2 id=\"å¸¸ç”¨å‘½ä»¤\">å¸¸ç”¨å‘½ä»¤</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¿™é‡Œåªå¯¹æ—¥å¸¸å¼€å‘ä¸­æ¯”è¾ƒå¸¸ç”¨çš„å‘½ä»¤è¿›è¡Œç®€è¦è¯´æ˜ï¼Œè¯¦ç»†ä»‹ç»å¯ä»¥å‚è€ƒ<a href=\"https://python-poetry.org/docs/\">å®˜æ–¹æ–‡æ¡£</a></p>\n</li>\n</ul>\n<h3 id=\"new-åˆ›å»ºé¡¹ç›®\">new : åˆ›å»ºé¡¹ç›®</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æŒ‰ç…§é»˜è®¤è§„åˆ™åˆ›å»ºä¸€ä¸ªåŸºäº poetry çš„é¡¹ç›®</span></span><br><span class=\"line\">$ poetry new my-project</span><br><span class=\"line\">Created package my_project <span class=\"keyword\">in</span> my-project</span><br><span class=\"line\">$ <span class=\"built_in\">cd</span> my-project</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹ç”Ÿæˆçš„ç›®å½•ç»“æ„</span></span><br><span class=\"line\">$ exa -T</span><br><span class=\"line\">.</span><br><span class=\"line\">â”œâ”€â”€ my_project</span><br><span class=\"line\">â”‚  â””â”€â”€ __init__.py</span><br><span class=\"line\">â”œâ”€â”€ pyproject.toml</span><br><span class=\"line\">â”œâ”€â”€ README.md</span><br><span class=\"line\">â””â”€â”€ tests</span><br><span class=\"line\">   â””â”€â”€ __init__.py</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹ pyproject.toml å†…å®¹ï¼Œè¯¥æ–‡ä»¶ä¸ºé¡¹ç›®çš„é…ç½®çš„é…ç½®æ–‡ä»¶</span></span><br><span class=\"line\">$ more pyproject.toml</span><br><span class=\"line\">[tool.poetry]</span><br><span class=\"line\">name = <span class=\"string\">&quot;my-project&quot;</span></span><br><span class=\"line\">version = <span class=\"string\">&quot;0.1.0&quot;</span></span><br><span class=\"line\">description = <span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\">authors = [<span class=\"string\">&quot;hanqunfeng &lt;hanqf2008@163.com&gt;&quot;</span>]</span><br><span class=\"line\">readme = <span class=\"string\">&quot;README.md&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">[tool.poetry.dependencies]</span><br><span class=\"line\">python = <span class=\"string\">&quot;^3.11&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">[build-system]</span><br><span class=\"line\">requires = [<span class=\"string\">&quot;poetry-core&quot;</span>]</span><br><span class=\"line\">build-backend = <span class=\"string\">&quot;poetry.core.masonry.api&quot;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"init-åˆå§‹åŒ–ä¸€ä¸ªå·²æœ‰çš„é¡¹ç›®ç›®å½•\">init : åˆå§‹åŒ–ä¸€ä¸ªå·²æœ‰çš„é¡¹ç›®ç›®å½•</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å‡è®¾æˆ‘ä»¬å·²ç»æœ‰ä¸ªé¡¹ç›®ç›®å½•ï¼Œç›®å½•åç§°ä¸º poetryDemo</span></span><br><span class=\"line\">$ <span class=\"built_in\">cd</span> poetryDemo</span><br><span class=\"line\"><span class=\"comment\"># åˆå§‹åŒ– poetryDemo ï¼Œåœ¨å½“å‰ç›®å½•ä¸‹åˆ›å»º pyproject.toml æ–‡ä»¶ï¼Œæ³¨æ„è¯¥æ“ä½œåªä¼šåˆ›å»ºè¯¥æ–‡ä»¶ï¼ŒåŒ…ç›®å½•ä»¥åŠreadmeæ–‡ä»¶éƒ½æ²¡æœ‰ï¼Œéœ€è¦æ‰‹å·¥åˆ›å»º</span></span><br><span class=\"line\">$ poetry init</span><br><span class=\"line\">This <span class=\"built_in\">command</span> will guide you through creating your pyproject.toml config.</span><br><span class=\"line\"></span><br><span class=\"line\">Package name [poetrydemo]:  <span class=\"comment\"># åŒ…åç§°</span></span><br><span class=\"line\">Version [0.1.0]:  <span class=\"comment\"># ç‰ˆæœ¬å·</span></span><br><span class=\"line\">Description []:   <span class=\"comment\"># æè¿°ä¿¡æ¯</span></span><br><span class=\"line\">Author [hanqunfeng &lt;hanqf2008@163.com&gt;, n to skip]:  <span class=\"comment\"># ä½œè€…</span></span><br><span class=\"line\">License []:  <span class=\"comment\"># License</span></span><br><span class=\"line\">Compatible Python versions [^3.11]:  <span class=\"comment\"># python ç‰ˆæœ¬</span></span><br><span class=\"line\"></span><br><span class=\"line\">Would you like to define your main dependencies interactively? (<span class=\"built_in\">yes</span>/no) [<span class=\"built_in\">yes</span>] <span class=\"comment\"># æ‚¨æƒ³ä»¥äº¤äº’æ–¹å¼å®šä¹‰æ‚¨çš„ä¸»ç¯å¢ƒä¾èµ–å…³ç³»å—ï¼Ÿé»˜è®¤yes</span></span><br><span class=\"line\">You can specify a package <span class=\"keyword\">in</span> the following forms:  <span class=\"comment\"># æ‚¨å¯ä»¥æŒ‰ä»¥ä¸‹å½¢å¼æŒ‡å®šåŒ…ï¼š</span></span><br><span class=\"line\">  - A single name (requests): this will search <span class=\"keyword\">for</span> matches on PyPI <span class=\"comment\"># å•ä¸ªåç§°ï¼ˆrequestsï¼‰ï¼šè¿™å°†åœ¨å®˜æ–¹ä»“åº“PyPIä¸Šæœç´¢åŒ¹é…é¡¹ï¼Œå¦‚æœæŒ‡å®šäº†å…¶å®ƒé•œåƒæºå°±ä¼šä»æŒ‡å®šçš„æºä¸‹è½½</span></span><br><span class=\"line\">  - A name and a constraint (requests@^2.23.0) <span class=\"comment\"># åç§°å’Œç‰ˆæœ¬çº¦æŸ</span></span><br><span class=\"line\">  - A git url (git+https://github.com/python-poetry/poetry.git) <span class=\"comment\"># gitåœ°å€</span></span><br><span class=\"line\">  - A git url with a revision (git+https://github.com/python-poetry/poetry.git#develop) <span class=\"comment\"># gitåœ°å€ï¼ŒæŒ‡å®šæŸä¸ªåˆ†æ”¯</span></span><br><span class=\"line\">  - A file path (../my-package/my-package.whl) <span class=\"comment\"># æ–‡ä»¶è·¯å¾„</span></span><br><span class=\"line\">  - A directory (../my-package/) <span class=\"comment\"># ç›®å½•è·¯å¾„</span></span><br><span class=\"line\">  - A url (https://example.com/packages/my-package-0.1.0.tar.gz) <span class=\"comment\"># ä¸€ä¸ªå®‰è£…åŒ…çš„åœ°å€</span></span><br><span class=\"line\"></span><br><span class=\"line\">Package to add or search <span class=\"keyword\">for</span> (leave blank to skip): <span class=\"comment\"># æ·»åŠ ä¸»ç¯å¢ƒä¾èµ–ï¼ŒæŒ‰ä¸Šé¢çš„æ ¼å¼è¦æ±‚å¡«å†™</span></span><br><span class=\"line\"></span><br><span class=\"line\">Would you like to define your development dependencies interactively? (<span class=\"built_in\">yes</span>/no) [<span class=\"built_in\">yes</span>] <span class=\"comment\"># æ‚¨æƒ³ä»¥äº¤äº’æ–¹å¼å®šä¹‰æ‚¨çš„å¼€å‘ä¾èµ–å…³ç³»å—ï¼Ÿé»˜è®¤yes</span></span><br><span class=\"line\">Package to add or search <span class=\"keyword\">for</span> (leave blank to skip): <span class=\"comment\"># æ·»åŠ å¼€å‘ç¯å¢ƒä¾èµ–ï¼ŒæŒ‰ä¸Šé¢çš„æ ¼å¼è¦æ±‚å¡«å†™</span></span><br><span class=\"line\"></span><br><span class=\"line\">Generated file</span><br><span class=\"line\"><span class=\"comment\"># è¦ç”Ÿæˆçš„ pyproject.toml å†…å®¹</span></span><br><span class=\"line\">[tool.poetry]</span><br><span class=\"line\">name = <span class=\"string\">&quot;poetrydemo&quot;</span>  <span class=\"comment\"># åŒ…åç§°</span></span><br><span class=\"line\">version = <span class=\"string\">&quot;0.1.0&quot;</span>    <span class=\"comment\"># ç‰ˆæœ¬</span></span><br><span class=\"line\">description = <span class=\"string\">&quot;&quot;</span>     <span class=\"comment\"># æè¿°ä¿¡æ¯</span></span><br><span class=\"line\">authors = [<span class=\"string\">&quot;hanqunfeng &lt;hanqf2008@163.com&gt;&quot;</span>] <span class=\"comment\"># ä½œè€…ä¿¡æ¯</span></span><br><span class=\"line\">readme = <span class=\"string\">&quot;README.md&quot;</span> <span class=\"comment\"># è¯´æ˜æ–‡ä»¶</span></span><br><span class=\"line\"></span><br><span class=\"line\">[tool.poetry.dependencies] <span class=\"comment\"># ä¸»ç¯å¢ƒä¾èµ–</span></span><br><span class=\"line\">python = <span class=\"string\">&quot;^3.11&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">[build-system]</span><br><span class=\"line\">requires = [<span class=\"string\">&quot;poetry-core&quot;</span>]</span><br><span class=\"line\">build-backend = <span class=\"string\">&quot;poetry.core.masonry.api&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">Do you confirm generation? (<span class=\"built_in\">yes</span>/no) [<span class=\"built_in\">yes</span>] <span class=\"comment\"># ç¡®è®¤æ˜¯å¦æŒ‰ç…§ä¸Šé¢çš„å†…å®¹åˆ›å»º pyproject.toml æ–‡ä»¶ï¼Œé»˜è®¤yes</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¸Šé¢çš„æ–¹å¼åœ¨åˆå§‹åŒ–æ—¶ä¼šè¯¢é—®ä½ ç›¸å…³çš„ä¿¡æ¯ï¼Œå¦‚æœä½ å¸Œæœ›éƒ½ç”¨é»˜è®¤å€¼çš„è¯ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">poetry init -n</span><br></pre></td></tr></table></figure>\n<h3 id=\"config-poetryçš„å…¨å±€é…ç½®\">config : poetryçš„å…¨å±€é…ç½®</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æŸ¥çœ‹å…¨å±€é…ç½®</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ poetry config --list</span><br><span class=\"line\">cache-dir = <span class=\"string\">&quot;/Users/hanqf/Library/Caches/pypoetry&quot;</span>  <span class=\"comment\"># ç¼“å­˜ç›®å½•,ç”¨äºå­˜å‚¨é¡¹ç›®ä¾èµ–å’Œè™šæ‹Ÿç¯å¢ƒç­‰ç¼“å­˜ä¿¡æ¯ã€‚</span></span><br><span class=\"line\">experimental.system-git-client = <span class=\"literal\">false</span>              <span class=\"comment\"># æ˜¯å¦ä½¿ç”¨ç³»ç»Ÿè‡ªå¸¦çš„gitå®¢æˆ·ç«¯,falseè¡¨ç¤ºä½¿ç”¨Poetryå†…ç½®çš„gitå®¢æˆ·ç«¯</span></span><br><span class=\"line\">installer.max-workers = null                        <span class=\"comment\"># å®‰è£…ä¾èµ–æ—¶çš„æœ€å¤§çº¿ç¨‹æ•°,nullè¡¨ç¤ºä½¿ç”¨é»˜è®¤çº¿ç¨‹æ•°ï¼Œå¯ä»¥è®¾ç½®ä¸ºcpuæ ¸æ•°+4</span></span><br><span class=\"line\">installer.modern-installation = <span class=\"literal\">true</span>                <span class=\"comment\"># æ˜¯å¦ä½¿ç”¨Poetryçš„ç°ä»£å®‰è£…æ–¹æ¡ˆ,trueè¡¨ç¤ºä½¿ç”¨</span></span><br><span class=\"line\">installer.no-binary = null                          <span class=\"comment\"># æ˜¯å¦ä¸ä½¿ç”¨é¢„ç¼–è¯‘çš„äºŒè¿›åˆ¶åŒ…,nullè¡¨ç¤ºä¸é™åˆ¶</span></span><br><span class=\"line\">installer.parallel = <span class=\"literal\">true</span>                           <span class=\"comment\"># æ˜¯å¦å¹¶è¡Œå®‰è£…ä¾èµ–,trueè¡¨ç¤ºå¹¶è¡Œå®‰è£…</span></span><br><span class=\"line\">keyring.enabled = <span class=\"literal\">true</span>                              <span class=\"comment\"># æ˜¯å¦å¯ç”¨å¯†é’¥ç¯ï¼ˆkeyringï¼‰ä»¥ä¿å­˜è®¤è¯ä¿¡æ¯ã€‚true è¡¨ç¤ºå¯ç”¨ã€‚</span></span><br><span class=\"line\">solver.lazy-wheel = <span class=\"literal\">true</span>                            <span class=\"comment\"># æ˜¯å¦å»¶è¿Ÿè§£æ wheel åŒ…ã€‚true è¡¨ç¤ºå»¶è¿Ÿè§£æã€‚</span></span><br><span class=\"line\">virtualenvs.create = <span class=\"literal\">true</span>                           <span class=\"comment\"># æ˜¯å¦è‡ªåŠ¨åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ,trueè¡¨ç¤ºåˆ›å»º</span></span><br><span class=\"line\">virtualenvs.in-project = null                       <span class=\"comment\"># æ˜¯å¦åœ¨é¡¹ç›®å†…åˆ›å»ºè™šæ‹Ÿç¯å¢ƒï¼Œnull è¡¨ç¤ºä½¿ç”¨é»˜è®¤å€¼ï¼ˆé€šå¸¸ä¸º falseï¼‰ï¼Œå³ä¸åœ¨é¡¹ç›®ä¸­åˆ›å»ºã€‚trueè¡¨ç¤ºåœ¨é¡¹ç›®ä¸­åˆ›å»º</span></span><br><span class=\"line\">virtualenvs.options.always-copy = <span class=\"literal\">false</span>             <span class=\"comment\"># å¦‚æœè®¾ç½®ä¸º trueï¼ŒPoetry ä¼šå§‹ç»ˆå¤åˆ¶æ–‡ä»¶åˆ°è™šæ‹Ÿç¯å¢ƒä¸­ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ç¬¦å·é“¾æ¥ï¼ˆsymlinksï¼‰ã€‚è¿™å¯ä»¥é¿å…æŸäº›ç³»ç»Ÿä¸Šçš„æƒé™é—®é¢˜ï¼Œä½†ä¼šå¢åŠ è™šæ‹Ÿç¯å¢ƒçš„å­˜å‚¨éœ€æ±‚ã€‚</span></span><br><span class=\"line\">virtualenvs.options.no-pip = <span class=\"literal\">false</span>                  <span class=\"comment\"># å¦‚æœè®¾ç½®ä¸º trueï¼ŒPoetry åœ¨åˆ›å»ºè™šæ‹Ÿç¯å¢ƒæ—¶ä¸ä¼šå®‰è£… pipã€‚å¦‚æœä½ çš„é¡¹ç›®ä¸éœ€è¦ç›´æ¥ä½¿ç”¨ pipï¼Œå¹¶ä¸”ä½ å¸Œæœ›é€šè¿‡ Poetry ç®¡ç†æ‰€æœ‰çš„ä¾èµ–é¡¹ï¼Œå¯ä»¥å°† no-pip è®¾ç½®ä¸º trueï¼Œä»¥å‡å°‘è™šæ‹Ÿç¯å¢ƒä¸­çš„ä¸å¿…è¦çš„ä¾èµ–é¡¹ã€‚</span></span><br><span class=\"line\">virtualenvs.options.no-setuptools = <span class=\"literal\">false</span>           <span class=\"comment\"># å¦‚æœè®¾ç½®ä¸º trueï¼ŒPoetry åœ¨åˆ›å»ºè™šæ‹Ÿç¯å¢ƒæ—¶ä¸ä¼šå®‰è£… setuptoolsã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒPoetry ä¼šå®‰è£… pip å’Œ setuptoolsï¼Œä»¥ä¾¿ä½ å¯ä»¥ä½¿ç”¨è¿™äº›å·¥å…·æ¥ç®¡ç†ä¾èµ–é¡¹ã€‚</span></span><br><span class=\"line\">virtualenvs.options.system-site-packages = <span class=\"literal\">false</span>    <span class=\"comment\"># é»˜è®¤å€¼falseï¼Œæ­¤æ—¶ Poetry åˆ›å»ºçš„è™šæ‹Ÿç¯å¢ƒå°†ä¸ä¼šåŒ…å«å…¨å±€ Python å®‰è£…çš„ site-packages ç›®å½•ä¸­çš„åŒ…ã€‚è¿™æœ‰åŠ©äºç¡®ä¿é¡¹ç›®ä¾èµ–é¡¹çš„éš”ç¦»æ€§ï¼Œé¿å…ä¸ç³»ç»Ÿä¸­çš„å…¶ä»–åŒ…å‘ç”Ÿå†²çªã€‚</span></span><br><span class=\"line\">virtualenvs.path = <span class=\"string\">&quot;&#123;cache-dir&#125;/virtualenvs&quot;</span>  <span class=\"comment\"># /Users/hanqf/Library/Caches/pypoetry/virtualenvs # è™šæ‹Ÿç¯å¢ƒå­˜æ”¾çš„è·¯å¾„ï¼Œå¦‚æœvirtualenvs.in-projectè®¾ç½®ä¸ºtrueï¼Œå°±åªä¼šåœ¨é¡¹ç›®ä¸­åˆ›å»º</span></span><br><span class=\"line\">virtualenvs.prefer-active-python = <span class=\"literal\">false</span>            <span class=\"comment\"># æ˜¯å¦ä¼˜å…ˆä½¿ç”¨ç³»ç»Ÿæ¿€æ´»çš„Pythonè§£é‡Šå™¨</span></span><br><span class=\"line\">virtualenvs.prompt = <span class=\"string\">&quot;&#123;project_name&#125;-py&#123;python_version&#125;&quot;</span>  <span class=\"comment\"># è™šæ‹Ÿç¯å¢ƒçš„å‘½ä»¤æç¤ºæ ¼å¼</span></span><br><span class=\"line\">warnings.export = <span class=\"literal\">true</span>                              <span class=\"comment\"># æ˜¯å¦åœ¨å¯¼å‡ºæ—¶æ˜¾ç¤ºè­¦å‘Šä¿¡æ¯ã€‚true è¡¨ç¤ºæ˜¾ç¤º</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¿®æ”¹å…¨å±€é…ç½®</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ä¿®æ”¹å…¨å±€é…ç½®ï¼Œæ­¤åä¼šåœ¨é¡¹ç›®ç›®å½•ä¸‹åˆ›å»º .venv ç›®å½•å­˜æ”¾è™šæ‹Ÿç¯å¢ƒ</span></span><br><span class=\"line\">$ poetry config virtualenvs.in-project <span class=\"literal\">true</span></span><br><span class=\"line\"><span class=\"comment\"># è¿›å…¥è™šæ‹Ÿç¯å¢ƒï¼Œå¦‚æœè™šæ‹Ÿç¯å¢ƒå°šæœªåˆ›å»ºä¼šè‡ªåŠ¨åˆ›å»º</span></span><br><span class=\"line\">$ poetry shell</span><br><span class=\"line\"><span class=\"comment\"># é€€å‡ºè™šæ‹Ÿç¯å¢ƒ</span></span><br><span class=\"line\">$ <span class=\"built_in\">exit</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åªå¯¹å½“å‰é¡¹ç›®æœ‰æ•ˆï¼Œæ­¤æ—¶ä¼šåœ¨å½“å‰é¡¹ç›®ç›®å½•ä¸‹åˆ›å»º poetry.toml æ¥ä¿å­˜è¿™äº›é…ç½®ä¿¡æ¯</span></span><br><span class=\"line\">$ poetry config virtualenvs.in-project <span class=\"literal\">true</span> --<span class=\"built_in\">local</span></span><br><span class=\"line\">$ poetry config virtualenvs.options.system-site-packages <span class=\"literal\">true</span> --<span class=\"built_in\">local</span></span><br><span class=\"line\">$ more poetry.toml</span><br><span class=\"line\">[virtualenvs]</span><br><span class=\"line\">in-project = <span class=\"literal\">true</span></span><br><span class=\"line\">[virtualenvs.options]</span><br><span class=\"line\">system-site-packages = <span class=\"literal\">true</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># è¿™é‡Œè¦æ³¨æ„ virtualenvs ä¸‹çš„å±æ€§å¿…é¡»åœ¨åˆ›å»ºè™šæ‹Ÿç¯å¢ƒå‰è®¾ç½®æ‰ä¼šæœ‰æ•ˆ</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"env-è™šæ‹Ÿç¯å¢ƒç®¡ç†\">env : è™šæ‹Ÿç¯å¢ƒç®¡ç†</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Poetry ä¼šåœ¨ä½ ç¬¬ä¸€æ¬¡è¿è¡ŒæŸäº›å‘½ä»¤ï¼ˆå¦‚ <code>poetry shell</code> æˆ–è€… <code>poetry add somepackage</code>ï¼‰æ—¶è‡ªåŠ¨åˆ›å»ºè™šæ‹Ÿç¯å¢ƒã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä¸è¿‡è¿™ç§æ—¶å€™éƒ½æ˜¯ä½¿ç”¨ç³»ç»Ÿé»˜è®¤çš„pythonæ¥åˆ›å»ºè™šæ‹Ÿç¯å¢ƒï¼Œå¦‚æœç³»ç»Ÿä¸­å®‰è£…äº†å¤šä¸ªpythonï¼Œåˆ™å¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹å¼è®¾ç½®è™šæ‹Ÿç¯å¢ƒè¦ä½¿ç”¨å“ªä¸ªpythonç‰ˆæœ¬</p>\n</li>\n<li class=\"lvl-2\">\n<p>åˆ›å»º/åˆ‡æ¢è™šæ‹Ÿç¯å¢ƒ</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æŒ‡å®špythonçš„ç‰ˆæœ¬ï¼Œè¿™ä¼šä»pythonçš„é»˜è®¤å®‰è£…è·¯å¾„ä¸‹æŸ¥æ‰¾å¯¹åº”çš„ç‰ˆæœ¬</span></span><br><span class=\"line\"><span class=\"comment\"># æ¯”å¦‚macOsä¼šä»è¯¥è·¯å¾„ä¸‹æŸ¥æ‰¾ï¼š/Library/Frameworks/Python.framework/Versions</span></span><br><span class=\"line\">$ poetry <span class=\"built_in\">env</span> use 3.11</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å¦‚æœå¯ä»¥ç›´æ¥åœ¨å‘½ä»¤è¡Œä½¿ç”¨pythonå‘½ä»¤,æ¯”å¦‚ï¼špython3.12 -Vï¼Œåˆ™å¯ä»¥ä½¿ç”¨å¦‚ä¸‹æ–¹å¼åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ</span></span><br><span class=\"line\">$ poetry <span class=\"built_in\">env</span> use python3.12</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å¦‚æœpythonå®‰è£…åˆ°äº†å…¶å®ƒè·¯å¾„ï¼Œå¯ä»¥æŒ‡å®špythonå®‰è£…è·¯å¾„</span></span><br><span class=\"line\">$ poetry <span class=\"built_in\">env</span> use /pythonDir/3.13/bin/python3</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æŸ¥çœ‹å½“å‰é¡¹ç›®çš„è™šæ‹Ÿç¯å¢ƒä¿¡æ¯</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åˆ›å»ºä¸€ä¸ªåŸºäº python3.13 çš„è™šæ‹Ÿç¯å¢ƒ</span></span><br><span class=\"line\">$ poetry <span class=\"built_in\">env</span> use python3.13</span><br><span class=\"line\">Creating virtualenv poetrydemo-fyqYbfje-py3.13 <span class=\"keyword\">in</span> /Users/hanqf/Library/Caches/pypoetry/virtualenvs</span><br><span class=\"line\">Using virtualenv: /Users/hanqf/Library/Caches/pypoetry/virtualenvs/poetrydemo-fyqYbfje-py3.13</span><br><span class=\"line\"><span class=\"comment\"># å†åˆ›å»ºä¸€ä¸ªåŸºäº python3.11 çš„è™šæ‹Ÿç¯å¢ƒï¼Œæœ€åè¢«useçš„å¤„äºé»˜è®¤æ¿€æ´»çŠ¶æ€</span></span><br><span class=\"line\">$ poetry <span class=\"built_in\">env</span> use python3.11</span><br><span class=\"line\">Creating virtualenv poetrydemo-fyqYbfje-py3.11 <span class=\"keyword\">in</span> /Users/hanqf/Library/Caches/pypoetry/virtualenvs</span><br><span class=\"line\">Using virtualenv: /Users/hanqf/Library/Caches/pypoetry/virtualenvs/poetrydemo-fyqYbfje-py3.11</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹å½“å‰é¡¹ç›®æœ‰å¤šå°‘ä¸ªè™šæ‹Ÿç¯å¢ƒ</span></span><br><span class=\"line\">$ poetry <span class=\"built_in\">env</span> list</span><br><span class=\"line\">poetrydemo-fyqYbfje-py3.11 (Activated) <span class=\"comment\"># poetrydemo-fyqYbfje-py3.11 è¡¨ç¤ºè™šæ‹Ÿç¯å¢ƒåç§°ï¼ŒActivatedè¡¨ç¤ºå½“å‰è™šæ‹Ÿç¯å¢ƒå·²ç»è¢«æ¿€æ´»</span></span><br><span class=\"line\">poetrydemo-fyqYbfje-py3.13</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹è™šæ‹ŸåŒ–ç¯å¢ƒè·¯å¾„</span></span><br><span class=\"line\">$ poetry <span class=\"built_in\">env</span> list  --full-path</span><br><span class=\"line\">/Users/hanqf/Library/Caches/pypoetry/virtualenvs/poetrydemo-fyqYbfje-py3.11 (Activated)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹å½“å‰æ¿€æ´»çš„è™šæ‹Ÿç¯å¢ƒä¿¡æ¯</span></span><br><span class=\"line\">$ poetry <span class=\"built_in\">env</span> info</span><br><span class=\"line\"></span><br><span class=\"line\">Virtualenv</span><br><span class=\"line\">Python:         3.11.3</span><br><span class=\"line\">Implementation: CPython</span><br><span class=\"line\">Path:           /Users/hanqf/Library/Caches/pypoetry/virtualenvs/poetrydemo-fyqYbfje-py3.11</span><br><span class=\"line\">Executable:     /Users/hanqf/Library/Caches/pypoetry/virtualenvs/poetrydemo-fyqYbfje-py3.11/bin/python</span><br><span class=\"line\">Valid:          True</span><br><span class=\"line\"></span><br><span class=\"line\">Base</span><br><span class=\"line\">Platform:   darwin</span><br><span class=\"line\">OS:         posix</span><br><span class=\"line\">Python:     3.11.3</span><br><span class=\"line\">Path:       /Library/Frameworks/Python.framework/Versions/3.11</span><br><span class=\"line\">Executable: /Library/Frameworks/Python.framework/Versions/3.11/bin/python3.11</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åˆ é™¤è™šæ‹Ÿç¯å¢ƒ</span></span><br><span class=\"line\">$ poetry <span class=\"built_in\">env</span> remove python3.13</span><br><span class=\"line\">Deleted virtualenv: /Users/hanqf/Library/Caches/pypoetry/virtualenvs/poetrydemo-fyqYbfje-py3.13</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åˆ é™¤å…¨éƒ¨è™šæ‹Ÿç¯å¢ƒ</span></span><br><span class=\"line\">$ poetry <span class=\"built_in\">env</span> remove --all</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ³¨æ„ï¼Œå½“<code>virtualenvs.in-project</code>è¢«è®¾ç½®ä¸º<code>true</code>æ—¶ï¼Œå³åªåœ¨é¡¹ç›®ç›®å½•ä¸‹åˆ›å»ºè™šæ‹Ÿç¯å¢ƒæ—¶ï¼Œåªä¼šä¿ç•™ä¸€ä¸ªç¯å¢ƒï¼Œå³<code>.venv</code></p>\n</li>\n<li class=\"lvl-2\">\n<p>åˆ‡æ¢åˆ°æ–°çš„è™šæ‹Ÿç¯å¢ƒæ—¶ä¼šå…¨æ–°åˆ›å»ºä¸€ä¸ªæ–°çš„ç¯å¢ƒï¼ŒåŸå…ˆçš„ç¯å¢ƒä¼šè¢«åˆ é™¤ï¼Œæ‰€ä»¥è¦ä½¿ç”¨<code>poetry install</code>å‘½ä»¤é‡æ–°å®‰è£…ä¾èµ–</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">$ poetry <span class=\"built_in\">env</span> use python3.11</span><br><span class=\"line\">Recreating virtualenv poetrydemo <span class=\"keyword\">in</span> /Users/hanqf/Desktop/pythonDir/poetryDir/poetryDemo/.venv</span><br><span class=\"line\">Using virtualenv: /Users/hanqf/Desktop/pythonDir/poetryDir/poetryDemo/.venv</span><br><span class=\"line\"></span><br><span class=\"line\">$ poetry <span class=\"built_in\">env</span> list <span class=\"comment\"># è™½ç„¶å¯ä»¥é€šè¿‡ poetry env use çš„æ–¹å¼æ¥åˆ›å»ºæ–°çš„è™šæ‹Ÿç¯å¢ƒï¼Œä½†å®é™…ä¸Šåªä¼šæœ‰ä¸€ä¸ªç¯å¢ƒè¢«ä¿ç•™ï¼Œæ‰€ä»¥è¿™é‡Œåªä¼šæ˜¾ç¤ºä¸€ä¸ª</span></span><br><span class=\"line\">.venv (Activated) <span class=\"comment\"># .venv è¡¨ç¤ºè™šæ‹Ÿç¯å¢ƒåç§°ï¼ŒActivatedè¡¨ç¤ºå½“å‰è™šæ‹Ÿç¯å¢ƒå·²ç»è¢«æ¿€æ´»</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹è™šæ‹Ÿç¯å¢ƒä¿¡æ¯</span></span><br><span class=\"line\">$ poetry <span class=\"built_in\">env</span> info</span><br><span class=\"line\"></span><br><span class=\"line\">Virtualenv</span><br><span class=\"line\">Python:         3.11.3</span><br><span class=\"line\">Implementation: CPython</span><br><span class=\"line\">Path:           /Users/hanqf/Desktop/pythonDir/poetryDir/poetryDemo/.venv</span><br><span class=\"line\">Executable:     /Users/hanqf/Desktop/pythonDir/poetryDir/poetryDemo/.venv/bin/python</span><br><span class=\"line\">Valid:          True</span><br><span class=\"line\"></span><br><span class=\"line\">Base</span><br><span class=\"line\">Platform:   darwin</span><br><span class=\"line\">OS:         posix</span><br><span class=\"line\">Python:     3.11.3</span><br><span class=\"line\">Path:       /Library/Frameworks/Python.framework/Versions/3.11</span><br><span class=\"line\">Executable: /Library/Frameworks/Python.framework/Versions/3.11/bin/python3.11</span><br></pre></td></tr></table></figure>\n<h3 id=\"ä¾èµ–åŒ…ç®¡ç†\">ä¾èµ–åŒ…ç®¡ç†</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>add : å®‰è£…ä¾èµ–åŒ…</p>\n</li>\n</ul>\n<blockquote>\n<p>è¿™ä¸ªå‘½ä»¤ä¼šä¿®æ”¹ pyproject.toml æ–‡ä»¶ï¼Œåœ¨ [tool.poetry.dependencies] éƒ¨åˆ†æ·»åŠ æ–°çš„ä¾èµ–é¡¹ã€‚è¿˜ä¼šè‡ªåŠ¨æ›´æ–° poetry.lock æ–‡ä»¶ï¼Œé”å®šä¾èµ–çš„ç¡®åˆ‡ç‰ˆæœ¬ã€‚</p>\n</blockquote>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å®‰è£…ä¾èµ–ï¼Œå®‰è£…åä¼šå°†ä¾èµ–ä¿¡æ¯å†™å…¥ pyproject.toml ä¸­</span></span><br><span class=\"line\"><span class=\"comment\"># ä¸æŒ‡å®šç‰ˆæœ¬åˆ™å®‰è£…æœ€æ–°ç‰ˆ</span></span><br><span class=\"line\">$ poetry add fastapi</span><br><span class=\"line\">Using version ^0.115.5 <span class=\"keyword\">for</span> fastapi</span><br><span class=\"line\"></span><br><span class=\"line\">Updating dependencies</span><br><span class=\"line\">Resolving dependencies... (1.3s)</span><br><span class=\"line\"></span><br><span class=\"line\">Package operations: 9 installs, 0 updates, 0 removals</span><br><span class=\"line\"></span><br><span class=\"line\">  - Installing idna (3.10)</span><br><span class=\"line\">  - Installing sniffio (1.3.1)</span><br><span class=\"line\">  - Installing typing-extensions (4.12.2)</span><br><span class=\"line\">  - Installing annotated-types (0.7.0)</span><br><span class=\"line\">  - Installing anyio (4.6.2.post1)</span><br><span class=\"line\">  - Installing pydantic-core (2.23.4)</span><br><span class=\"line\">  - Installing pydantic (2.9.2)</span><br><span class=\"line\">  - Installing starlette (0.41.3)</span><br><span class=\"line\">  - Installing fastapi (0.115.5)</span><br><span class=\"line\"></span><br><span class=\"line\">Writing lock file</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŒ‡å®šç‰ˆæœ¬å·å®‰è£…ä¾èµ–</span></span><br><span class=\"line\">poetry add package_name@^1.2.3</span><br><span class=\"line\">    <span class=\"comment\"># è§„åˆ™è¯´æ˜</span></span><br><span class=\"line\">    ^1.2.3 è¡¨ç¤ºå…¼å®¹ 1.2.3 åŠæ›´é«˜çš„å°ç‰ˆæœ¬ï¼Œä½†ä¸åŒ…æ‹¬ 2.0.0ã€‚    å¦‚ï¼špoetry add requests@^2.28.0</span><br><span class=\"line\">    ~1.2.3ï¼šå…è®¸å‡çº§åˆ° 1.2.xï¼Œä½†ä¸åŒ…æ‹¬ 1.3.0ã€‚               å¦‚ï¼špoetry add requests@~2.28.0</span><br><span class=\"line\">    1.2.3ï¼šå›ºå®šä¸º 1.2.3ã€‚                                   å¦‚ï¼špoetry add requests@2.28.0</span><br><span class=\"line\">    &gt;=1.2.3ï¼šå…è®¸ä½¿ç”¨ 1.2.3 åŠä»¥ä¸Šç‰ˆæœ¬ã€‚æ³¨æ„zshä¸‹è¦åŠ ä¸ŠåŒå¼•å·ï¼Œå¦‚ï¼špoetry add <span class=\"string\">&quot;requests@&gt;=2.28.0&quot;</span></span><br><span class=\"line\">    &lt;2.0.0ï¼šå…è®¸ä½¿ç”¨å°äº 2.0.0 çš„ç‰ˆæœ¬ã€‚ æ³¨æ„zshä¸‹è¦åŠ ä¸ŠåŒå¼•å·ï¼Œå¦‚ï¼špoetry add <span class=\"string\">&quot;requests@&lt;3.0.0&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å®‰è£…åˆ°æŒ‡å®šçš„åˆ†ç»„ï¼Œé»˜è®¤éƒ½æ˜¯å®‰è£…åˆ°ä¸»ç¯å¢ƒä¸­çš„ï¼Œpoetry buildé»˜è®¤åªä¼šæ‰“åŒ…ä¸»ç¯å¢ƒçš„ä¾èµ–</span></span><br><span class=\"line\">poetry add flask <span class=\"comment\"># å®‰è£…åˆ°ä¸»ç¯å¢ƒä¸­</span></span><br><span class=\"line\">poetry add flask --group=<span class=\"built_in\">test</span> <span class=\"comment\">#æ·»åŠ åˆ†ç»„å test</span></span><br><span class=\"line\">poetry add flask --dev  <span class=\"comment\">#ç›¸å½“äº--group=dev</span></span><br><span class=\"line\"><span class=\"comment\"># åˆ†åˆ«æ‰§è¡Œä¸Šé¢3ä¸ªå®‰è£…å‘½ä»¤åï¼Œè¾“å‡º pyproject.toml çš„å†…å®¹å¦‚ä¸‹</span></span><br><span class=\"line\">[tool.poetry]</span><br><span class=\"line\">name = <span class=\"string\">&quot;poetrydemo&quot;</span></span><br><span class=\"line\">version = <span class=\"string\">&quot;0.1.0&quot;</span></span><br><span class=\"line\">description = <span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\">authors = [<span class=\"string\">&quot;hanqunfeng &lt;hanqf2008@163.com&gt;&quot;</span>]</span><br><span class=\"line\">readme = <span class=\"string\">&quot;README.md&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">[tool.poetry.dependencies] <span class=\"comment\"># ä¸»ç¯å¢ƒ</span></span><br><span class=\"line\">python = <span class=\"string\">&quot;^3.11&quot;</span></span><br><span class=\"line\">flask = <span class=\"string\">&quot;^3.1.0&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">[tool.poetry.group.test.dependencies] <span class=\"comment\"># teståˆ†ç»„ä¾èµ–</span></span><br><span class=\"line\">flask = <span class=\"string\">&quot;^3.1.0&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">[tool.poetry.group.dev.dependencies] <span class=\"comment\"># devåˆ†ç»„ä¾èµ–</span></span><br><span class=\"line\">flask = <span class=\"string\">&quot;^3.1.0&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">[build-system]</span><br><span class=\"line\">requires = [<span class=\"string\">&quot;poetry-core&quot;</span>]</span><br><span class=\"line\">build-backend = <span class=\"string\">&quot;poetry.core.masonry.api&quot;</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>show : æŸ¥çœ‹ä¾èµ–åŒ…</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹å½“å‰é¡¹ç›®éƒ½éœ€è¦å“ªäº›ä¾èµ–ï¼Œè¿™äº›ä¾èµ–ä¸ä¸€å®šéƒ½å®‰è£…äº†ï¼Œå®ƒåªæ˜¯è§£æ pyproject.toml ä¸­çš„å£°æ˜æ¥è§£æä¾èµ–æ ‘</span></span><br><span class=\"line\">$ poetry show</span><br><span class=\"line\">annotated-types   0.7.0       Reusable constraint types to use with typing.Annotated</span><br><span class=\"line\">anyio             4.6.2.post1 High level compatibility layer <span class=\"keyword\">for</span> multiple asynchronous ...</span><br><span class=\"line\">fastapi           0.115.5     FastAPI framework, high performance, easy to learn, fast ...</span><br><span class=\"line\">idna              3.10        Internationalized Domain Names <span class=\"keyword\">in</span> Applications (IDNA)</span><br><span class=\"line\">pydantic          2.9.2       Data validation using Python <span class=\"built_in\">type</span> hints</span><br><span class=\"line\">pydantic-core     2.23.4      Core functionality <span class=\"keyword\">for</span> Pydantic validation and serialization</span><br><span class=\"line\">sniffio           1.3.1       Sniff out <span class=\"built_in\">which</span> async library your code is running under</span><br><span class=\"line\">starlette         0.41.3      The little ASGI library that shines.</span><br><span class=\"line\">typing-extensions 4.12.2      Backported and Experimental Type Hints <span class=\"keyword\">for</span> Python 3.8+</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åªæŸ¥çœ‹é¡¶çº§ä¾èµ–ï¼Œå³åªæŸ¥çœ‹åœ¨ pyproject.toml ä¸­å£°æ˜çš„ä¾èµ–</span></span><br><span class=\"line\">$ poetry show --top-level</span><br><span class=\"line\">fastapi           0.115.5     FastAPI framework, high performance, easy to learn, fast ...</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>remove : åˆ é™¤ä¾èµ–åŒ…</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åˆ é™¤ä¾èµ–ï¼Œæ­¤æ—¶ä¼šå°†å½“å‰åŒ…åŠå…¶æ‰€æœ‰ä¾èµ–ä¸€å—åˆ é™¤</span></span><br><span class=\"line\">$ poetry remove fastapi</span><br><span class=\"line\">Updating dependencies</span><br><span class=\"line\">Resolving dependencies... (0.1s)</span><br><span class=\"line\"></span><br><span class=\"line\">Package operations: 0 installs, 0 updates, 9 removals</span><br><span class=\"line\"></span><br><span class=\"line\">  - Removing annotated-types (0.7.0)</span><br><span class=\"line\">  - Removing anyio (4.6.2.post1)</span><br><span class=\"line\">  - Removing fastapi (0.115.5)</span><br><span class=\"line\">  - Removing idna (3.10)</span><br><span class=\"line\">  - Removing pydantic (2.9.2)</span><br><span class=\"line\">  - Removing pydantic-core (2.23.4)</span><br><span class=\"line\">  - Removing sniffio (1.3.1)</span><br><span class=\"line\">  - Removing starlette (0.41.3)</span><br><span class=\"line\">  - Removing typing-extensions (4.12.2)</span><br><span class=\"line\"></span><br><span class=\"line\">Writing lock file</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>search : æœç´¢è¿œç¨‹ä»“åº“</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æœç´¢è¿œç¨‹ä»“åº“</span></span><br><span class=\"line\">$ poetry search fastapi</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>install å’Œ update : å®‰è£…å’Œæ›´æ–°ä¾èµ–åŒ…<br>\n<em><strong>åœ¨ Poetry ä¸­ï¼Œinstall å’Œ update æ˜¯ä¸¤ä¸ªå¸¸ç”¨çš„å‘½ä»¤ï¼Œä½†å®ƒä»¬çš„ä½œç”¨å’Œä½¿ç”¨åœºæ™¯ä¸åŒ</strong></em></p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-7\">\n<p><code>poetry install</code> çš„ä½œç”¨æ˜¯æ ¹æ®ç°æœ‰çš„ poetry.lock æ–‡ä»¶æ¥å®‰è£…ä¾èµ–ï¼Œç¡®ä¿å®‰è£…çš„ä¾èµ–ç‰ˆæœ¬ä¸é”æ–‡ä»¶ä¸­è®°å½•çš„ç‰ˆæœ¬å®Œå…¨ä¸€è‡´ã€‚<br>\næ ¸å¿ƒç‰¹ç‚¹ï¼š</p>\n<ul class=\"lvl-4\">\n<li class=\"lvl-10\">å®‰è£…é”å®šçš„ç‰ˆæœ¬ï¼šå®ƒåªä¼šå®‰è£… poetry.lock æ–‡ä»¶ä¸­æŒ‡å®šçš„ç‰ˆæœ¬ï¼Œå³ä½¿ pyproject.toml æ–‡ä»¶ä¸­å®šä¹‰çš„ç‰ˆæœ¬èŒƒå›´å·²ç»æœ‰æ›´æ–°ç‰ˆæœ¬ã€‚</li>\n<li class=\"lvl-10\">é‡ç°ä¾èµ–ç¯å¢ƒï¼šé€‚ç”¨äºå›¢é˜Ÿåä½œæˆ–éƒ¨ç½²ç¯å¢ƒï¼Œç¡®ä¿æ‰€æœ‰äººæˆ–æœºå™¨å®‰è£…çš„ä¾èµ–ç‰ˆæœ¬å®Œå…¨ç›¸åŒã€‚</li>\n<li class=\"lvl-10\">é”æ–‡ä»¶å­˜åœ¨æ—¶æ›´é«˜æ•ˆï¼šå¦‚æœ poetry.lock æ–‡ä»¶å­˜åœ¨ï¼Œpoetry install ä¸ä¼šé‡æ–°è§£æä¾èµ–æ ‘ã€‚</li>\n<li class=\"lvl-10\">é¦–æ¬¡è¿è¡Œæ—¶ç”Ÿæˆé”æ–‡ä»¶ï¼šå¦‚æœæ²¡æœ‰ poetry.lock æ–‡ä»¶ï¼Œpoetry install ä¼šè§£æä¾èµ–å¹¶ç”Ÿæˆé”æ–‡ä»¶ã€‚<br>\nä½¿ç”¨åœºæ™¯ï¼š</li>\n<li class=\"lvl-10\">æ–°å…‹éš†çš„é¡¹ç›®ï¼Œéœ€è¦å®‰è£…ä¾èµ–ç¯å¢ƒã€‚</li>\n<li class=\"lvl-10\">éƒ¨ç½²ç”Ÿäº§ç¯å¢ƒï¼Œç¡®ä¿ä¾èµ–ç‰ˆæœ¬çš„ç¨³å®šæ€§ã€‚</li>\n<li class=\"lvl-10\">é‡æ–°å®‰è£…ä¹‹å‰å·²å®šä¹‰çš„ä¾èµ–ï¼ˆä¾‹å¦‚æ¸…ç©ºäº†è™šæ‹Ÿç¯å¢ƒï¼‰ã€‚</li>\n</ul>\n</li>\n<li class=\"lvl-6\">\n<p><code>poetry update</code> çš„ä½œç”¨æ˜¯æ ¹æ® pyproject.toml æ–‡ä»¶ä¸­å®šä¹‰çš„ä¾èµ–èŒƒå›´é‡æ–°è§£æä¾èµ–æ ‘ï¼Œå¹¶æ›´æ–° poetry.lock æ–‡ä»¶ä¸ºæœ€æ–°çš„ç‰ˆæœ¬ã€‚<br>\næ ¸å¿ƒç‰¹ç‚¹ï¼š</p>\n<ul class=\"lvl-4\">\n<li class=\"lvl-10\">æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬ï¼šå®ƒä¼šå°è¯•å®‰è£…ä¾èµ–èŒƒå›´å†…çš„æœ€æ–°ç‰ˆæœ¬ï¼Œå¹¶æ›´æ–° poetry.lock æ–‡ä»¶ã€‚</li>\n<li class=\"lvl-10\">è§£ææ–°çš„ä¾èµ–æ ‘ï¼šå³ä½¿ poetry.lock æ–‡ä»¶å­˜åœ¨ï¼Œpoetry update ä¹Ÿä¼šå¿½ç•¥å®ƒå¹¶é‡æ–°è§£æä¾èµ–ã€‚</li>\n<li class=\"lvl-10\">æ›´æ”¹é”æ–‡ä»¶ï¼šå®ƒä¼šè¦†ç›–ç°æœ‰çš„ poetry.lock æ–‡ä»¶ï¼Œå› æ­¤å›¢é˜Ÿå…¶ä»–æˆå‘˜éœ€è¦é‡æ–°è¿è¡Œ poetry install ä»¥åŒæ­¥ã€‚<br>\nä½¿ç”¨åœºæ™¯ï¼š</li>\n<li class=\"lvl-10\">æ›´æ–°ä¾èµ–åˆ°æœ€æ–°ç‰ˆæœ¬ï¼ˆåœ¨ä¾èµ–èŒƒå›´å†…ï¼‰ã€‚</li>\n<li class=\"lvl-10\">å½“æ·»åŠ æ–°ä¾èµ–åï¼Œæƒ³è¦å®‰è£…å¹¶æ›´æ–°é”æ–‡ä»¶ã€‚</li>\n<li class=\"lvl-10\">ä¿®å¤å¯èƒ½çš„ç‰ˆæœ¬å†²çªæˆ–ä¸å…¼å®¹é—®é¢˜ã€‚</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"lock-é”å®šä¾èµ–åŒ…\">lock : é”å®šä¾èµ–åŒ…</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><code>poetry lock</code> æ˜¯ Poetryï¼ˆä¸€ä¸ª Python åŒ…ç®¡ç†å·¥å…·ï¼‰ä¸­çš„ä¸€ä¸ªå‘½ä»¤ï¼Œç”¨äºé”å®šé¡¹ç›®çš„ä¾èµ–å…³ç³»ã€‚ä½¿ç”¨è¿™ä¸ªå‘½ä»¤å¯ä»¥åˆ›å»ºæˆ–æ›´æ–° <code>poetry.lock</code> æ–‡ä»¶ï¼Œç¡®ä¿ä½ çš„é¡¹ç›®ä¸­æ‰€ä½¿ç”¨çš„æ¯ä¸ªåŒ…çš„ç‰ˆæœ¬éƒ½è¢«æ˜ç¡®è®°å½•ä¸‹æ¥ã€‚è¿™æ ·åšå¯¹äºé¡¹ç›®çš„å¯å¤ç°æ€§å’Œç¨³å®šæ€§è‡³å…³é‡è¦ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å®é™…ä¸Šï¼Œå½“è¿è¡Œ <code>poetry install</code> ã€ <code>poetry update</code> æˆ–è€… <code>poetry add</code> ç­‰å‘½ä»¤æ—¶ï¼Œ poetry éƒ½ä¼šæ ¹æ®<br>\n<code>pyproject.toml</code> æ–‡ä»¶ä¸­çš„ä¾èµ–èŒƒå›´ï¼Œè§£æä¾èµ–æ ‘ï¼Œå¹¶åœ¨é¡¹ç›®ç›®å½•ä¸‹åˆ›å»ºæˆ–æ›´æ–° <code>poetry.lock</code> æ–‡ä»¶ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å½“æˆ‘ä»¬æ‰‹å·¥ä¿®æ”¹äº† <code>pyproject.toml</code> æ–‡ä»¶ä¸­çš„ä¾èµ–èŒƒå›´ï¼Œæ­¤æ—¶åˆä¸æƒ³ç«‹åˆ»æ›´æ–°ä¾èµ–ï¼Œè€Œæ˜¯å¸Œæœ›åœ¨æŸä¸ªæ—¶æœºå†æ›´æ–°ï¼Œæ­¤æ—¶å°±å¯ä»¥ä½¿ç”¨ <code>poetry lock</code> å‘½ä»¤ï¼Œå…ˆé”å®šè¿™äº›ä¾èµ–ï¼Œä¹‹åå†é€šè¿‡ <code>poetry install</code> å‘½ä»¤å®‰è£…ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å¯ä»¥ä½¿ç”¨ <code>poetry check</code> å‘½ä»¤æ£€æŸ¥ <code>pyproject.toml</code> æ–‡ä»¶ ä¸ <code>poetry.lock</code> æ–‡ä»¶çš„ä¸€è‡´æ€§ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æ¯”å¦‚æˆ‘æ‰‹å·¥åˆ é™¤äº† `pyproject.toml` æ–‡ä»¶ä¸­çš„æŸä¸ªä¾èµ–</span></span><br><span class=\"line\"><span class=\"comment\"># æ­¤æ—¶è¿è¡Œ check æ£€æŸ¥ä¸€è‡´æ€§ä¼šæŠ¥é”™</span></span><br><span class=\"line\">$ poetry check</span><br><span class=\"line\">Error: pyproject.toml changed significantly since poetry.lock was last generated. Run `poetry lock [--no-update]` to fix the lock file.</span><br><span class=\"line\"><span class=\"comment\"># é”å®šä¾èµ–</span></span><br><span class=\"line\">$ poetry lock</span><br><span class=\"line\">Updating dependencies</span><br><span class=\"line\">Resolving dependencies... (0.1s)</span><br><span class=\"line\"></span><br><span class=\"line\">Writing lock file</span><br><span class=\"line\"><span class=\"comment\"># æ£€æŸ¥ä¸€è‡´æ€§é€šè¿‡</span></span><br><span class=\"line\">$ poetry check</span><br><span class=\"line\">All <span class=\"built_in\">set</span>!</span><br></pre></td></tr></table></figure>\n<div class=\"tips\">\n<p><em><strong>å°è´´å£«</strong></em></p>\n<ul class=\"lvl-1\">\n<li class=\"lvl-2\">æ³¨æ„ï¼Œæ­¤æ—¶é€šè¿‡ <code>poetry show</code> æŸ¥çœ‹ä¸åˆ°é‚£ä¸ªæ‰‹å·¥åˆ é™¤çš„ä¾èµ–åŒ…ï¼Œä½†å®é™…ä¸Šä¾èµ–ä¾æ—§åœ¨äºè™šæ‹Ÿç¯å¢ƒä¸­</li>\n<li class=\"lvl-2\">æ‰€ä»¥å°½é‡é¿å…æ‰‹å·¥åˆ é™¤ä¾èµ–ï¼Œè€Œæ˜¯é€šè¿‡ <code>poetry remove</code> å‘½ä»¤æ¥åˆ é™¤ä¾èµ–</li>\n</ul>\n</div>\n<h3 id=\"source-é•œåƒæºç®¡ç†\">source : é•œåƒæºç®¡ç†</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>é»˜è®¤æƒ…å†µä¸‹éƒ½æ˜¯ä»Pypiçš„å®˜æ–¹ä»“åº“ä¸‹è½½ï¼Œå›½å†…ä¸€èˆ¬éœ€è¦æŒ‡å®šé•œåƒæºæ¥åŠ é€Ÿä¸‹è½½</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æ·»åŠ é•œåƒæºï¼Œé»˜è®¤å°±æ˜¯ä¸»è¦æºï¼Œæ³¨æ„è¯¥æ–¹å¼åªå¯¹å½“å‰é¡¹ç›®æœ‰æ•ˆ</span></span><br><span class=\"line\"><span class=\"comment\"># å‘½ä»¤æ ¼å¼ï¼špoetry source add [é€‰é¡¹] [--] &lt;name&gt; [&lt;url&gt;]ï¼Œnameï¼šæºä»“åº“çš„åç§°ï¼Œurlï¼šæºä»“åº“çš„ URL</span></span><br><span class=\"line\">$ poetry <span class=\"built_in\">source</span> add tsinghua https://pypi.tuna.tsinghua.edu.cn/simple</span><br><span class=\"line\">Adding <span class=\"built_in\">source</span> with name tsinghua.</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># --priority=PRIORITYè®¾ç½®æ­¤æºçš„ä¼˜å…ˆçº§ã€‚å¯ä»¥æ˜¯ä»¥ä¸‹å€¼ä¹‹ä¸€ï¼šdefaultï¼ˆé»˜è®¤ï¼‰ã€primaryï¼ˆä¸»è¦ï¼‰ã€supplementalï¼ˆå¤‡ç”¨ï¼‰ã€explicitï¼ˆæ˜¾å¼æºï¼Œåªæœ‰å½“åŒ…æ˜ç¡®å£°æ˜ä½¿ç”¨è¯¥æºæ—¶æ‰ä¼šè¢«ä½¿ç”¨ï¼‰ã€‚é»˜è®¤ä¸º primaryã€‚</span></span><br><span class=\"line\">$ poetry <span class=\"built_in\">source</span> add  --priority=supplemental aliyun http://mirrors.aliyun.com/pypi/simple/</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹é•œåƒæºä¿¡æ¯</span></span><br><span class=\"line\">$ poetry <span class=\"built_in\">source</span> show</span><br><span class=\"line\"> name      : tsinghua</span><br><span class=\"line\"> url       : https://pypi.tuna.tsinghua.edu.cn/simple</span><br><span class=\"line\"> priority  : primary</span><br><span class=\"line\"></span><br><span class=\"line\"> name      : aliyun</span><br><span class=\"line\"> url       : http://mirrors.aliyun.com/pypi/simple/</span><br><span class=\"line\"> priority  : supplemental</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ­¤æ—¶æŸ¥çœ‹ pyproject.toml æ–‡ä»¶å¯ä»¥çœ‹åˆ°é•œåƒæºä¿¡æ¯</span></span><br><span class=\"line\">[[tool.poetry.source]]</span><br><span class=\"line\">name = <span class=\"string\">&quot;tsinghua&quot;</span></span><br><span class=\"line\">url = <span class=\"string\">&quot;https://pypi.tuna.tsinghua.edu.cn/simple&quot;</span></span><br><span class=\"line\">priority = <span class=\"string\">&quot;primary&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">[[tool.poetry.source]]</span><br><span class=\"line\">name = <span class=\"string\">&quot;aliyun&quot;</span></span><br><span class=\"line\">url = <span class=\"string\">&quot;http://mirrors.aliyun.com/pypi/simple/&quot;</span></span><br><span class=\"line\">priority = <span class=\"string\">&quot;supplemental&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åˆ é™¤é•œåƒæº</span></span><br><span class=\"line\">$ poetry <span class=\"built_in\">source</span> remove aliyun <span class=\"comment\"># æŒ‡å®šé•œåƒæºåç§°</span></span><br><span class=\"line\">Removing <span class=\"built_in\">source</span> with name aliyun.</span><br></pre></td></tr></table></figure>\n<h3 id=\"è¿è¡Œ\">è¿è¡Œ</h3>\n<p>è¿™é‡Œä»¥ä¸€ä¸ªå°ç¤ºä¾‹æ¥è¯´æ˜è¿™ä¸ªåŠŸèƒ½</p>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ›å»ºä¸€ä¸ªæ–°çš„é¡¹ç›®</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ poetry new poetryDemo</span><br><span class=\"line\">Created package poetrydemo <span class=\"keyword\">in</span> poetryDemo</span><br><span class=\"line\"><span class=\"comment\"># è¿›å…¥é¡¹ç›®ç›®å½•</span></span><br><span class=\"line\">$ <span class=\"built_in\">cd</span> poetryDemo</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹ç”Ÿæˆçš„æ–‡ä»¶</span></span><br><span class=\"line\">$ ll</span><br><span class=\"line\">total 8</span><br><span class=\"line\">drwxr-xr-x  6 hanqf  staff  192 11 21 17:32 .</span><br><span class=\"line\">drwxr-xr-x  4 hanqf  staff  128 11 21 17:32 ..</span><br><span class=\"line\">-rw-r--r--  1 hanqf  staff    0 11 21 17:32 README.md</span><br><span class=\"line\">drwxr-xr-x  3 hanqf  staff   96 11 21 17:32 poetrydemo</span><br><span class=\"line\">-rw-r--r--  1 hanqf  staff  266 11 21 17:32 pyproject.toml</span><br><span class=\"line\">drwxr-xr-x  3 hanqf  staff   96 11 21 17:32 tests</span><br><span class=\"line\"><span class=\"comment\"># è¿›å…¥åŒ…ç›®å½•</span></span><br><span class=\"line\">$ <span class=\"built_in\">cd</span> poetrydemo</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹åŒ…ç›®å½•ä¸‹çš„æ–‡ä»¶</span></span><br><span class=\"line\">$ ll</span><br><span class=\"line\">total 0</span><br><span class=\"line\">drwxr-xr-x  3 hanqf  staff   96 11 21 17:32 .</span><br><span class=\"line\">drwxr-xr-x  6 hanqf  staff  192 11 21 17:32 ..</span><br><span class=\"line\">-rw-r--r--  1 hanqf  staff    0 11 21 17:32 __init__.py</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åœ¨åŒ…ç›®å½•ä¸‹åˆ›å»º array_util.pyï¼Œå†…å®¹å¦‚ä¸‹</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">import numpy as np</span><br><span class=\"line\"></span><br><span class=\"line\">def generate_random_array(shape, distribution=<span class=\"string\">&quot;uniform&quot;</span>, params=None, seed=None):</span><br><span class=\"line\">    <span class=\"string\">&quot;&quot;</span><span class=\"string\">&quot;</span></span><br><span class=\"line\"><span class=\"string\">    ç”Ÿæˆéšæœºæ•°ç»„çš„å·¥å…·æ–¹æ³•ã€‚</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">    :param shape: tupleï¼ŒæŒ‡å®šæ•°ç»„çš„å½¢çŠ¶ï¼Œä¾‹å¦‚ (3, 4) è¡¨ç¤º 3 è¡Œ 4 åˆ—ã€‚</span></span><br><span class=\"line\"><span class=\"string\">    :param distribution: strï¼ŒæŒ‡å®šéšæœºæ•°åˆ†å¸ƒç±»å‹ï¼Œå¯é€‰å€¼ï¼š</span></span><br><span class=\"line\"><span class=\"string\">        - &quot;</span>uniform<span class=\"string\">&quot;ï¼šå‡åŒ€åˆ†å¸ƒï¼ˆé»˜è®¤ï¼‰ã€‚</span></span><br><span class=\"line\"><span class=\"string\">        - &quot;</span>normal<span class=\"string\">&quot;ï¼šæ­£æ€åˆ†å¸ƒã€‚</span></span><br><span class=\"line\"><span class=\"string\">        - &quot;</span><span class=\"built_in\">integer</span><span class=\"string\">&quot;ï¼šéšæœºæ•´æ•°ã€‚</span></span><br><span class=\"line\"><span class=\"string\">    :param params: dictï¼Œåˆ†å¸ƒçš„å‚æ•°é…ç½®ï¼š</span></span><br><span class=\"line\"><span class=\"string\">        - å‡åŒ€åˆ†å¸ƒï¼š&#123;&quot;</span>low<span class=\"string\">&quot;: æœ€å°å€¼, &quot;</span>high<span class=\"string\">&quot;: æœ€å¤§å€¼&#125;ï¼Œé»˜è®¤ low=0, high=1ã€‚</span></span><br><span class=\"line\"><span class=\"string\">        - æ­£æ€åˆ†å¸ƒï¼š&#123;&quot;</span>mean<span class=\"string\">&quot;: å‡å€¼, &quot;</span>std<span class=\"string\">&quot;: æ ‡å‡†å·®&#125;ï¼Œé»˜è®¤ mean=0, std=1ã€‚</span></span><br><span class=\"line\"><span class=\"string\">        - éšæœºæ•´æ•°ï¼š&#123;&quot;</span>low<span class=\"string\">&quot;: æœ€å°å€¼, &quot;</span>high<span class=\"string\">&quot;: æœ€å¤§å€¼, &quot;</span>dtype<span class=\"string\">&quot;: ç±»å‹&#125;ï¼Œé»˜è®¤ low=0, high=10ã€‚</span></span><br><span class=\"line\"><span class=\"string\">    :param seed: intï¼Œéšæœºæ•°ç§å­ï¼ˆå¯é€‰ï¼‰ï¼Œç”¨äºç»“æœå¯å¤ç°ã€‚</span></span><br><span class=\"line\"><span class=\"string\">    :return: np.ndarrayï¼Œç”Ÿæˆçš„éšæœºæ•°ç»„ã€‚</span></span><br><span class=\"line\"><span class=\"string\">    &quot;</span><span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> seed is not None:</span><br><span class=\"line\">        np.random.seed(seed)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> params is None:</span><br><span class=\"line\">        params = &#123;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> distribution == <span class=\"string\">&quot;uniform&quot;</span>:</span><br><span class=\"line\">        low = params.get(<span class=\"string\">&quot;low&quot;</span>, 0)</span><br><span class=\"line\">        high = params.get(<span class=\"string\">&quot;high&quot;</span>, 1)</span><br><span class=\"line\">        <span class=\"built_in\">return</span> np.random.uniform(low, high, size=shape)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">elif</span> distribution == <span class=\"string\">&quot;normal&quot;</span>:</span><br><span class=\"line\">        mean = params.get(<span class=\"string\">&quot;mean&quot;</span>, 0)</span><br><span class=\"line\">        std = params.get(<span class=\"string\">&quot;std&quot;</span>, 1)</span><br><span class=\"line\">        <span class=\"built_in\">return</span> np.random.normal(mean, std, size=shape)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">elif</span> distribution == <span class=\"string\">&quot;integer&quot;</span>:</span><br><span class=\"line\">        low = params.get(<span class=\"string\">&quot;low&quot;</span>, 0)</span><br><span class=\"line\">        high = params.get(<span class=\"string\">&quot;high&quot;</span>, 10)</span><br><span class=\"line\">        dtype = params.get(<span class=\"string\">&quot;dtype&quot;</span>, int)</span><br><span class=\"line\">        <span class=\"built_in\">return</span> np.random.randint(low, high, size=shape, dtype=dtype)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">else</span>:</span><br><span class=\"line\">        raise ValueError(<span class=\"string\">&quot;ä¸æ”¯æŒçš„åˆ†å¸ƒç±»å‹ï¼å¯é€‰å€¼ä¸º &#x27;uniform&#x27;, &#x27;normal&#x27;, &#x27;integer&#x27;ã€‚&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ç¤ºä¾‹ç”¨æ³•</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">&quot;__main__&quot;</span>:</span><br><span class=\"line\">    array_uniform = generate_random_array((<span class=\"number\">3</span>, <span class=\"number\">4</span>), distribution=&quot;uniform&quot;, params=&#123;&quot;low&quot;: <span class=\"number\">1</span>, &quot;high&quot;: <span class=\"number\">10</span>&#125;)</span><br><span class=\"line\">    array_normal = generate_random_array((<span class=\"number\">2</span>, <span class=\"number\">3</span>), distribution=&quot;normal&quot;, params=&#123;&quot;mean&quot;: <span class=\"number\">0</span>, &quot;std&quot;: <span class=\"number\">1</span>&#125;, seed=<span class=\"number\">42</span>)</span><br><span class=\"line\">    array_integer = generate_random_array((<span class=\"number\">4</span>, <span class=\"number\">5</span>), distribution=&quot;integer&quot;, params=&#123;&quot;low&quot;: <span class=\"number\">0</span>, &quot;high&quot;: <span class=\"number\">20</span>&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">    print(&quot;å‡åŒ€åˆ†å¸ƒéšæœºæ•°ç»„ï¼š\\n&quot;, array_uniform)</span><br><span class=\"line\">    print(&quot;æ­£æ€åˆ†å¸ƒéšæœºæ•°ç»„ï¼š\\n&quot;, array_normal)</span><br><span class=\"line\">    print(&quot;éšæœºæ•´æ•°æ•°ç»„ï¼š\\n&quot;, array_integer)</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å®‰è£…ä¾èµ–</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ poetry add numpy</span><br><span class=\"line\">Using version ^2.1.3 <span class=\"keyword\">for</span> numpy</span><br><span class=\"line\"></span><br><span class=\"line\">Updating dependencies</span><br><span class=\"line\">Resolving dependencies... (1.1s)</span><br><span class=\"line\"></span><br><span class=\"line\">Package operations: 1 install, 0 updates, 0 removals</span><br><span class=\"line\"></span><br><span class=\"line\">  - Installing numpy (2.1.3)</span><br><span class=\"line\"></span><br><span class=\"line\">Writing lock file</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¿è¡Œï¼Œä¸¤ç§æ–¹æ³•</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-6\"><code>poetry run</code></li>\n</ul>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ poetry run python array_util.py</span><br><span class=\"line\">å‡åŒ€åˆ†å¸ƒéšæœºæ•°ç»„ï¼š</span><br><span class=\"line\">[[7.44623063 1.89415788 4.81008329 4.25556572]</span><br><span class=\"line\">[3.31925154 6.44037063 5.3216543  7.54950573]</span><br><span class=\"line\">[3.97160747 5.04800698 3.28299934 3.42841887]]</span><br><span class=\"line\">æ­£æ€åˆ†å¸ƒéšæœºæ•°ç»„ï¼š</span><br><span class=\"line\">[[ 0.49671415 -0.1382643   0.64768854]</span><br><span class=\"line\">[ 1.52302986 -0.23415337 -0.23413696]]</span><br><span class=\"line\">éšæœºæ•´æ•°æ•°ç»„ï¼š</span><br><span class=\"line\">[[10 10  3  7  2]</span><br><span class=\"line\">[ 1 11  5  1  0]</span><br><span class=\"line\">[11 11 16  9 15]</span><br><span class=\"line\">[14 14 18 11 19]]</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-2\">\n<li class=\"lvl-6\"><code>poetry shell</code> : æ­¤æ—¶ä¼šå¼€å¯ä¸€ä¸ªæ–°çš„shellï¼Œå¹¶å¼€å¯è™šæ‹Ÿç¯å¢ƒ</li>\n</ul>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å¼€å¯è™šæ‹Ÿç¯å¢ƒ</span></span><br><span class=\"line\">$ poetry shell</span><br><span class=\"line\">Spawning shell within /Users/hanqf/Library/Caches/pypoetry/virtualenvs/poetrydemo-fyqYbfje-py3.11</span><br><span class=\"line\">Restored session: 2024å¹´11æœˆ21æ—¥ æ˜ŸæœŸå›› 15æ—¶31åˆ†52ç§’ CST</span><br><span class=\"line\">âœ  poetrydemo <span class=\"built_in\">emulate</span> bash -c <span class=\"string\">&#x27;. /Users/hanqf/Library/Caches/pypoetry/virtualenvs/poetrydemo-fyqYbfje-py3.11/bin/activate&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"># åœ¨è™šæ‹Ÿç¯å¢ƒä¸‹è¿è¡Œ</span></span><br><span class=\"line\">$ python array_util.py</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<h3 id=\"æ‰“åŒ…å’Œå‘å¸ƒ\">æ‰“åŒ…å’Œå‘å¸ƒ</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ¥ç€ä¸Šé¢çš„é¡¹ç›®</p>\n</li>\n<li class=\"lvl-2\">\n<p>æ‰“åŒ…</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ä¼šåœ¨é¡¹ç›®ç›®å½•ä¸‹åˆ›å»º dist ç›®å½•ï¼Œå¹¶å°†æ‰“å¥½çš„åŒ…å­˜æ”¾äºæ­¤</span></span><br><span class=\"line\">$ poetry build</span><br><span class=\"line\">Building poetrydemo (0.1.0)</span><br><span class=\"line\">  - Building sdist</span><br><span class=\"line\">  - Built poetrydemo-0.1.0.tar.gz</span><br><span class=\"line\">  - Building wheel</span><br><span class=\"line\">  - Built poetrydemo-0.1.0-py3-none-any.whl</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹ç”Ÿæˆçš„æ‰“åŒ…æ–‡ä»¶</span></span><br><span class=\"line\">$ exa -1 dist</span><br><span class=\"line\">hqf_poetrydemo-0.1.0-py3-none-any.whl</span><br><span class=\"line\">hqf_poetrydemo-0.1.0.tar.gz</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å‘å¸ƒ</p>\n</li>\n<li class=\"lvl-2\">\n<p>é¦–å…ˆè¦å…ˆåœ¨<a href=\"https://pypi.org/\">PyPI</a>ä¸Šæ³¨å†Œä¸ªå¸å·ï¼Œéœ€è¦å¼€å¯â€œåŒè¦ç´ èº«ä»½éªŒè¯ ï¼ˆ2FAï¼‰â€ï¼Œå¦åˆ™ä¸èƒ½è·å–å‘å¸ƒæ—¶çš„APIä»¤ç‰Œã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>è·å–APIä»¤ç‰Œ<br>\n<img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/iShot_2024-11-21_18.00.50.png\" alt=\"\"></p>\n</li>\n<li class=\"lvl-2\">\n<p>å‘å¸ƒï¼Œä¸è¿‡è¿™æ¬¡å‘å¸ƒæç¤ºåŒ…åå·²ç»å­˜åœ¨äº†</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å‘å¸ƒæ—¶æç¤ºåŒ…åå·²ç»å­˜åœ¨äº†</span></span><br><span class=\"line\">$ poetry publish -u __token__  -p pypi-AgEIcHlwaS5vcmcCJDU0Y2Q5NjhkLWYyYTEtN</span><br><span class=\"line\">Publishing poetrydemo (0.1.0) to PyPI</span><br><span class=\"line\"> - Uploading poetrydemo-0.1.0-py3-none-any.whl FAILED</span><br><span class=\"line\"></span><br><span class=\"line\">HTTP Error 400: The name <span class=\"string\">&#x27;poetrydemo&#x27;</span> is too similar to an existing project. See https://pypi.org/help/#project-name <span class=\"keyword\">for</span> more information. | b<span class=\"string\">&quot;&lt;html&gt;\\n &lt;head&gt;\\n  &lt;title&gt;400 The name &#x27;poetrydemo&#x27; is too similar to an existing project. See https://pypi.org/help/#project-name for more information.\\n \\n &lt;body&gt;\\n  &lt;h1&gt;400 The name &#x27;poetrydemo&#x27; is too similar to an existing project. See https://pypi.org/help/#project-name for more information.\\n  The server could not comply with the request since it is either malformed or otherwise incorrect.&lt;br/&gt;&lt;br/&gt;\\nThe name &amp;#x27;poetrydemo&amp;#x27; is too similar to an existing project. See https://pypi.org/help/#project-name for more information.\\n\\n\\n \\n&quot;</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å…ˆä¿®æ”¹åŒ…åï¼Œç›´æ¥ç¼–è¾‘ pyproject.toml å³å¯ï¼Œå°†nameå±æ€§ä¿®æ”¹ä¸ºâ€œhqf_poetrydemoâ€ï¼Œç„¶åå°†åŒ…ç›®å½•çš„åç§°ä¹Ÿä¿®æ”¹ä¸ºè¿™ä¸ª<code>mv poetrydemo hqf_poetrydemo</code>ï¼Œå¹¶åˆ é™¤distç›®å½•ï¼Œä¹‹åé‡æ–°æ‰“åŒ…<code>poetry build</code>ï¼Œå†æ¬¡å‘å¸ƒ</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ vim pyproject.toml <span class=\"comment\"># å°†nameå±æ€§ä¿®æ”¹ä¸ºâ€œhqf_poetrydemoâ€</span></span><br><span class=\"line\">$ <span class=\"built_in\">mv</span> poetrydemo hqf_poetrydemo <span class=\"comment\"># å°†åŒ…ç›®å½•çš„åç§°ä¹Ÿä¿®æ”¹ä¸ºè¿™ä¸ª</span></span><br><span class=\"line\">$ <span class=\"built_in\">rm</span> -rf dist <span class=\"comment\"># åˆ é™¤distç›®å½•</span></span><br><span class=\"line\">$ poetry build    <span class=\"comment\"># é‡æ–°æ‰“åŒ…</span></span><br><span class=\"line\">Creating virtualenv hqf-poetrydemo-fyqYbfje-py3.11 <span class=\"keyword\">in</span> /Users/hanqf/Library/Caches/pypoetry/virtualenvs</span><br><span class=\"line\">Building hqf_poetrydemo (0.1.0)</span><br><span class=\"line\">  - Building sdist</span><br><span class=\"line\">  - Built hqf_poetrydemo-0.1.0.tar.gz</span><br><span class=\"line\">  - Building wheel</span><br><span class=\"line\">  - Built hqf_poetrydemo-0.1.0-py3-none-any.whl</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å†æ¬¡å‘å¸ƒ</span></span><br><span class=\"line\">$ poetry publish -u __token__  -p pypi-AgEIcHlwaS5vcmcCJDU0Y2Q5NjhkLWYyYTEtN</span><br><span class=\"line\"></span><br><span class=\"line\">Publishing hqf_poetrydemo (0.1.0) to PyPI</span><br><span class=\"line\"> - Uploading hqf_poetrydemo-0.1.0-py3-none-any.whl 100%</span><br><span class=\"line\"> - Uploading hqf_poetrydemo-0.1.0.tar.gz 100%</span><br></pre></td></tr></table></figure>\n<p><img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/iShot_2024-11-21_18.13.21.png\" alt=\"\"></p>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¹‹åå°±å¯ä»¥åœ¨å…¶å®ƒé¡¹ç›®ä¸­å®‰è£…è¿™ä¸ªåŒ…äº†</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># pip install</span></span><br><span class=\"line\">$ pip install hqf_poetrydemo</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># poetry add</span></span><br><span class=\"line\">$ poetry add hqf_poetrydemo</span><br><span class=\"line\">Using version ^0.1.0 <span class=\"keyword\">for</span> hqf-poetrydemo</span><br><span class=\"line\"></span><br><span class=\"line\">Updating dependencies</span><br><span class=\"line\">Resolving dependencies... (0.5s)</span><br><span class=\"line\"></span><br><span class=\"line\">Package operations: 2 installs, 0 updates, 0 removals</span><br><span class=\"line\"></span><br><span class=\"line\">  - Installing numpy (2.1.3)</span><br><span class=\"line\">  - Installing hqf-poetrydemo (0.1.0)</span><br><span class=\"line\"></span><br><span class=\"line\">Writing lock file</span><br></pre></td></tr></table></figure>\n<h3 id=\"self-update-å‡çº§-poetry-ç‰ˆæœ¬\"><code>self update</code> : å‡çº§ poetry ç‰ˆæœ¬</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>self ç›¸å…³å‘½ä»¤ä¸»è¦ç”¨äº poetry è‡ªèº«å®‰è£…æ’ä»¶ä½¿ç”¨</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä¼°è®¡æ’ä»¶åŠŸèƒ½ç›®å‰è¿˜ä¸æˆç†Ÿï¼Œå®˜ç½‘ä¹Ÿæ²¡æœ‰è¿›è¡Œè¯¦ç»†çš„è¯´æ˜ï¼Œå¹¶ä¸” windows ä¸‹æ— æ³•ä½¿ç”¨ï¼Œæ‰€ä»¥è¿™é‡Œä¸è®¨è®ºã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><code>self</code>å‘½ä»¤ä¸‹ç›®å‰åªéœ€è¦è®°ä½ä¸€ä¸ªå‘½ä»¤ï¼š <code>self update</code> : å‡çº§ poetry ç‰ˆæœ¬</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ poetry self update</span><br></pre></td></tr></table></figure>\n<h3 id=\"debug-resolve-æŸ¥çœ‹åŒ…çš„ä¾èµ–å…³ç³»\"><code>debug resolve</code> : æŸ¥çœ‹åŒ…çš„ä¾èµ–å…³ç³»</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åªæŸ¥çœ‹ï¼Œä¸å®‰è£…</span></span><br><span class=\"line\">$ poetry debug resolve requests</span><br><span class=\"line\">Resolving dependencies... (0.4s)</span><br><span class=\"line\"></span><br><span class=\"line\">Resolution results:</span><br><span class=\"line\"></span><br><span class=\"line\">certifi            2024.8.30</span><br><span class=\"line\">charset-normalizer 3.4.0</span><br><span class=\"line\">idna               3.10</span><br><span class=\"line\">urllib3            2.2.3</span><br><span class=\"line\">requests           2.32.3</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹æŒ‡å®šç‰ˆæœ¬çš„ä¾èµ–å…³ç³»</span></span><br><span class=\"line\">$ poetry debug resolve requests@2.32.3</span><br></pre></td></tr></table></figure>\n<h3 id=\"cache-ç¼“å­˜ç®¡ç†\">cache : ç¼“å­˜ç®¡ç†</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>poetryä¸€ä¸ªå¾ˆé‡è¦çš„åŠŸèƒ½å°±æ˜¯ç¼“å­˜å®‰è£…åŒ…ï¼Œå¯ä»¥ <code>å‡å°‘</code> ç›¸åŒçš„å®‰è£…åŒ…è¢«é‡å¤ä¸‹è½½ã€‚ä¸ºä»€ä¹ˆæ˜¯å‡å°‘è€Œä¸æ˜¯é¿å…å‘¢ï¼Ÿå› ä¸ºä¸åŒçš„é•œåƒæºçš„åŒ…æ˜¯åˆ†åˆ«ç¼“å­˜çš„ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>é€šè¿‡ <code>poetry config --list </code> å¯ä»¥çœ‹åˆ° <code>cache-dir</code> çš„åœ°å€ï¼Œè¿™é‡Œå°±æ˜¯ç¼“å­˜ä¸‹è½½åŒ…çš„ç›®å½•ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„ä½¿ç”¨åœºæ™¯</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-6\">è§£å†³ä¾èµ–å®‰è£…é—®é¢˜ï¼š<br>\nå¦‚æœä½ åœ¨å®‰è£…æˆ–æ›´æ–°ä¾èµ–æ—¶é‡åˆ°é—®é¢˜ï¼ˆä¾‹å¦‚ï¼ŒæŸä¸ªåŒ…æ— æ³•æ­£ç¡®å®‰è£…æˆ–ç‰ˆæœ¬ä¸å¯¹ï¼‰ï¼Œæ¸…ç©ºç¼“å­˜å¯ä»¥å¸®åŠ©ä½ ç¡®ä¿ Poetry é‡æ–°ä¸‹è½½æ‰€æœ‰å¿…è¦çš„æ–‡ä»¶ï¼Œä»è€Œè§£å†³é—®é¢˜ã€‚</li>\n<li class=\"lvl-6\">æ¸…ç†ç£ç›˜ç©ºé—´ï¼š<br>\nå¦‚æœä½ çš„é¡¹ç›®å¾ˆå¤šæˆ–è€…ç»å¸¸ä¿®æ”¹ä¾èµ–é¡¹ï¼Œç¼“å­˜å¯èƒ½ä¼šå˜å¾—éå¸¸å¤§ã€‚ä½¿ç”¨ poetry cache clear å¯ä»¥å¸®åŠ©é‡Šæ”¾ç£ç›˜ç©ºé—´ï¼Œç‰¹åˆ«æ˜¯å½“ä½ ä¸ç»å¸¸ä½¿ç”¨æŸäº›åŒ…æ—¶ã€‚</li>\n<li class=\"lvl-6\">æµ‹è¯•æœ€æ–°ç‰ˆæœ¬çš„ä¾èµ–ï¼š<br>\nå¦‚æœä½ æƒ³æµ‹è¯•æŸä¸ªåŒ…çš„æ–°ç‰ˆæœ¬æ˜¯å¦è§£å†³äº†æŸä¸ªé—®é¢˜ï¼Œæˆ–è€…æƒ³ç¡®ä¿ä½ ä½¿ç”¨çš„ç¡®å®æ˜¯æœ€æ–°çš„ç‰ˆæœ¬ï¼Œæ¸…é™¤ç¼“å­˜å¯ä»¥å¼ºåˆ¶ Poetry ä»è¿œç¨‹ä»“åº“é‡æ–°ä¸‹è½½æœ€æ–°çš„åŒ…ã€‚</li>\n<li class=\"lvl-6\">ç¯å¢ƒå˜åŒ–ï¼š<br>\nå¦‚æœä½ çš„å¼€å‘æˆ–ç”Ÿäº§ç¯å¢ƒå‘ç”Ÿäº†å˜åŒ–ï¼ˆä¾‹å¦‚ï¼Œåˆ‡æ¢äº†æ“ä½œç³»ç»Ÿã€æ›´æ–°äº† Python ç‰ˆæœ¬ç­‰ï¼‰ï¼Œæ¸…é™¤ç¼“å­˜å¯ä»¥å¸®åŠ©ä½ ç¡®ä¿ä¾èµ–é¡¹åœ¨æ–°ç¯å¢ƒä¸­æ­£ç¡®å®‰è£…ã€‚</li>\n<li class=\"lvl-6\">è°ƒè¯•ä¾èµ–é—®é¢˜ï¼š<br>\nåœ¨è°ƒè¯•ä¾èµ–é¡¹é—®é¢˜æ—¶ï¼Œæœ‰æ—¶å€™æ¸…é™¤ç¼“å­˜å¯ä»¥å¸®åŠ©ä½ ç¡®å®šé—®é¢˜æ˜¯å¦ä¸ç¼“å­˜ä¸­çš„æ—§ç‰ˆæœ¬æœ‰å…³ã€‚</li>\n<li class=\"lvl-6\">CI/CD ç¯å¢ƒçš„ä¸€è‡´æ€§ï¼š<br>\nåœ¨æŒç»­é›†æˆæˆ–æŒç»­éƒ¨ç½² (CI/CD) ç¯å¢ƒä¸­ï¼Œä¸ºäº†ç¡®ä¿æ¯æ¬¡æ„å»ºéƒ½åŸºäºæœ€æ–°çš„ä¾èµ–ï¼Œæœ‰æ—¶ä¼šåœ¨æ„å»ºè„šæœ¬ä¸­åŒ…å«æ¸…é™¤ç¼“å­˜çš„æ­¥éª¤ã€‚</li>\n</ul>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹ç¼“å­˜åˆ—è¡¨ï¼Œè¿™é‡Œä¼šæŒ‰é•œåƒæºè¿›è¡Œåˆ†ç»„</span></span><br><span class=\"line\">$ poetry cache list</span><br><span class=\"line\">PyPI</span><br><span class=\"line\">_default_cache</span><br><span class=\"line\">tsinghua</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ¸…é™¤æŒ‡å®šæºçš„å…¨éƒ¨ç¼“å­˜</span></span><br><span class=\"line\">$ poetry cache clear pypi --all</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ¸…é™¤æŒ‡å®šæºä¸‹æŸä¸ªåŒ…çš„ç¼“å­˜</span></span><br><span class=\"line\">$ poetry cache clear pypi:requests:2.24.0</span><br></pre></td></tr></table></figure>\n","content_text":"æ‘˜è¦ Poetryæ˜¯ä¸€ä¸ªè½»é‡çº§çš„pythonåŒ…ç®¡ç†å™¨ï¼Œå…¶ç›®æ ‡æ˜¯å¸®åŠ©å¼€å‘è€…å¿«é€Ÿã€è½»æ¾åœ°æ„å»ºã€å‘å¸ƒå’Œåˆ†äº«pythonåŒ…ã€‚è¯´å®ƒè½»é‡ï¼Œæ˜¯ä¸ conda ç›¸æ¯” poetry æ›´è½»é‡ï¼ŒåŒæ—¶ä¸ venv + pip Python--virtualenv çš„æ–¹å¼ç›¸æ¯”å…·æœ‰å¦‚ä¸‹ä¼˜ç‚¹ï¼š ä½¿ç”¨ç¼“å­˜æœºåˆ¶ï¼Œé¿å…é‡å¤ä¸‹è½½ä¾èµ–åŒ… åŒ…ç®¡ç†ä¸Šæ›´åŠ ç²¾ç¡®ï¼Œåˆ é™¤ä¸éœ€è¦çš„åŒ…æ—¶ä¼šåŒæ—¶åˆ é™¤ä¸å…¶å…³è”çš„ä¸”æ²¡æœ‰è¢«ä½¿ç”¨çš„é‚£äº›ä¾èµ–åŒ…ï¼Œé¿å…æ— ç”¨çš„ä¾èµ–åŒ…é€ æˆæ‰“åŒ…ä½“ç§¯è¿‡å¤§ æ‰“åŒ…å’Œå‘å¸ƒæ›´åŠ ç®€å•ï¼Œåªéœ€è¦ä¸€ä¸ªå‘½ä»¤å°±å¯ä»¥æ‰“åŒ…å’Œå‘å¸ƒ å®‰è£… å‚è€ƒå®˜æ–¹æ–‡æ¡£Installation 1234567891011121314# å®˜æ–¹æ¨èä½¿ç”¨pipxå®‰è£…ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨ pip$ pipx install poetry# æŸ¥çœ‹æ˜¯å¦å®‰è£…æˆåŠŸ$ poetry --versionPoetry (version 1.8.4)# æ·»åŠ å‘½ä»¤è‡ªåŠ¨è¡¥å…¨$ mkdir ~/.zfunc$ poetry completions zsh &gt; ~/.zfunc/_poetry# åœ¨ ~/.zshrc ä¸­æ·»åŠ ä»¥ä¸‹é…ç½®ï¼ˆæˆ‘æ˜¯ç”¨çš„æ˜¯zshï¼Œå…¶ä»–shellå¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼‰fpath+=~/.zfuncautoload -Uz compinit &amp;&amp; compinit pipxç®€ä»‹ pipx æ˜¯ä¸€ä¸ª Python åŒ…ç®¡ç†å·¥å…·ï¼Œä½¿ç”¨pipxå®‰è£…å·¥å…·åŒ…æ—¶ï¼Œæ¯ä¸ªå·¥å…·éƒ½ä¼šè¢«å®‰è£…åœ¨ä¸€ä¸ªç‹¬ç«‹çš„è™šæ‹Ÿç¯å¢ƒä¸­ï¼Œé¿å…ä¸åŒå·¥å…·ä¹‹é—´çš„ä¾èµ–å†²çªã€‚ åœºæ™¯ï¼šä¸¤ä¸ªå·¥å…·ä¾èµ–ä¸åŒç‰ˆæœ¬çš„åŒä¸€ä¸ªåº“ å‡è®¾æˆ‘ä»¬æœ‰ä¸¤ä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼š å·¥å…·A ä¾èµ–äº requests åº“çš„ç‰ˆæœ¬ 2.27.1ã€‚ å·¥å…·B ä¾èµ–äº requests åº“çš„ç‰ˆæœ¬ 2.31.0ã€‚ å¦‚æœä½¿ç”¨ pip å®‰è£… å·¥å…·ä¼šè¢«å®‰è£…åˆ°å…¨å±€ç¯å¢ƒï¼Œå…±äº«ç›¸åŒçš„ä¾èµ–ç‰ˆæœ¬ï¼š 12pip install toolA # å®‰è£…æ—¶ä¼šå®‰è£… requests 2.27.1pip install toolB # å®‰è£…æ—¶ä¼šå°† requests å‡çº§åˆ° 2.31.0 ç»“æœï¼š å½“ä½ è¿è¡Œå·¥å…·Aæ—¶ï¼Œå®ƒå¯èƒ½ä¼šæŠ¥é”™ï¼Œå› ä¸ºå®ƒä¾èµ–çš„ requests 2.27.1 å·²è¢« requests 2.31.0 æ›¿æ¢ã€‚ å…¨å±€ç¯å¢ƒä¸­çš„æ‰€æœ‰å·¥å…·éƒ½å…±äº«ä¸€ä¸ª requestsï¼Œç‰ˆæœ¬å†²çªä¸å¯é¿å…ã€‚ å¦‚æœä½¿ç”¨ pipx å®‰è£… æ¯ä¸ªå·¥å…·ä¼šè¢«å®‰è£…åˆ°ç‹¬ç«‹çš„è™šæ‹Ÿç¯å¢ƒä¸­ï¼Œå„è‡ªçš„ä¾èµ–äº’ä¸å½±å“ï¼š 12pipx install toolA # åœ¨è™šæ‹Ÿç¯å¢ƒAä¸­å®‰è£… toolA å’Œ requests 2.27.1pipx install toolB # åœ¨è™šæ‹Ÿç¯å¢ƒBä¸­å®‰è£… toolB å’Œ requests 2.31.0 ç»“æœï¼š è™šæ‹Ÿç¯å¢ƒA åªåŒ…å« toolA å’Œå®ƒçš„ä¾èµ– requests 2.27.1ã€‚ è™šæ‹Ÿç¯å¢ƒB åªåŒ…å« toolB å’Œå®ƒçš„ä¾èµ– requests 2.31.0ã€‚ å·¥å…·ä¹‹é—´å®Œå…¨éš”ç¦»ï¼Œä¸ä¼šå› ä¸ºä¾èµ–ç‰ˆæœ¬å†²çªè€Œå¯¼è‡´é—®é¢˜ã€‚ æ‰€ä»¥ï¼Œå½“éœ€è¦å®‰è£…å…¨å±€å‘½ä»¤è¡Œå·¥å…·æ—¶ï¼Œä½¿ç”¨pipxæ˜¯ä¸ªå¾ˆå¥½çš„é€‰æ‹© pipx çš„å®‰è£… 123456789101112131415# å®‰è£…pipxpip install pipx# é…ç½®ç¯å¢ƒå˜é‡ï¼Œè¿è¡Œè¯¥å‘½ä»¤ä¼šå°†pipx ensurepath# è¿è¡Œä¸Šé¢çš„å‘½ä»¤ä¼šå°†å¦‚ä¸‹å†…å®¹åŠ å…¥ä½ çš„shellé…ç½®æ–‡ä»¶ä¸­ï¼Œæˆ‘çš„æ˜¯ .zshrc æ–‡ä»¶ï¼Œå®é™…ä¸Šä½ ä¹Ÿå¯ä»¥æ‰‹å·¥æ·»åŠ è¯¥é…ç½®ï¼Œå°†$HOME/.local/binæ”¾åˆ°å‰é¢æ›´å¥½ä¸€äº›ã€‚export PATH=&quot;$PATH:$HOME/.local/bin&quot;# æ³¨æ„æ·»åŠ å®Œæˆåè¦é‡å¯shell# æ·»åŠ pipxè‡ªåŠ¨ä»£ç è¡¥å…¨# è¿è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œå¹¶æ ¹æ®æç¤ºå®Œæˆpipx completions# æˆ‘çš„æ˜¯zshï¼Œæ‰€ä»¥åœ¨ .zshrcä¸­æ·»åŠ å¦‚ä¸‹å†…å®¹autoload -Uz compinit &amp;&amp; compinit # å¦‚æœæ²¡æœ‰æ·»åŠ è¿‡å°±éœ€è¦å…ˆæ·»åŠ è¿™ä¸ªeval &quot;$(register-python-argcomplete pipx)&quot; # æ·»åŠ è‡ªåŠ¨ä»£ç è¡¥å…¨# æ³¨æ„æ·»åŠ å®Œæˆåè¦é‡å¯shell æŸ¥çœ‹æ‰€æœ‰å‘½ä»¤ æˆ‘å·²ç»å°†å…¶ç¿»è¯‘ä¸ºä¸­æ–‡ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667$ poetry listPoetry (ç‰ˆæœ¬ 1.8.4)ç”¨æ³•ï¼š command [é€‰é¡¹] [å‚æ•°]é€‰é¡¹ï¼š -h, --help æ˜¾ç¤ºç»™å®šå‘½ä»¤çš„å¸®åŠ©ã€‚å¦‚æœæ²¡æœ‰æŒ‡å®šå‘½ä»¤ï¼Œåˆ™æ˜¾ç¤ºåˆ—è¡¨å‘½ä»¤çš„å¸®åŠ©ã€‚ -q, --quiet ä¸è¾“å‡ºä»»ä½•æ¶ˆæ¯ã€‚ -V, --version æ˜¾ç¤ºæ­¤åº”ç”¨ç¨‹åºç‰ˆæœ¬ã€‚ --ansi å¼ºåˆ¶è¾“å‡ºANSIæ ¼å¼ã€‚ --no-ansi ç¦ç”¨ANSIè¾“å‡ºã€‚ -n, --no-interaction ä¸è¦æé—®ä»»ä½•äº¤äº’æ€§é—®é¢˜ã€‚ --no-plugins ç¦ç”¨æ’ä»¶ã€‚ --no-cache ç¦ç”¨æºç¼“å­˜ã€‚ -C, --directory=ç›®å½• Poetryå‘½ä»¤çš„å·¥ä½œç›®å½•ï¼ˆé»˜è®¤ä¸ºå½“å‰å·¥ä½œç›®å½•ï¼‰ã€‚ -v|vv|vvv, --verbose å¢åŠ æ¶ˆæ¯çš„å†—é•¿åº¦ï¼š1 è¡¨ç¤ºæ­£å¸¸è¾“å‡ºï¼Œ2 è¡¨ç¤ºæ›´è¯¦ç»†çš„è¾“å‡ºï¼Œ3 è¡¨ç¤ºè°ƒè¯•ã€‚å¯ç”¨å‘½ä»¤ï¼š about æ˜¾ç¤ºå…³äºPoetryçš„ä¿¡æ¯ã€‚ add å°†æ–°ä¾èµ–é¡¹æ·»åŠ åˆ°pyproject.tomlå¹¶å®‰è£…å®ƒã€‚ build é»˜è®¤æ„å»ºä¸€ä¸ªåŒ…ï¼Œåˆ†åˆ«æ˜¯tarballå’Œwheelã€‚ check éªŒè¯pyproject.tomlæ–‡ä»¶çš„å†…å®¹åŠå…¶ä¸poetry.lockæ–‡ä»¶çš„ä¸€è‡´æ€§ã€‚ config ç®¡ç†é…ç½®è®¾ç½®ã€‚ export å°†é”æ–‡ä»¶å¯¼å‡ºåˆ°å…¶ä»–æ ¼å¼ã€‚ help æ˜¾ç¤ºç‰¹å®šå‘½ä»¤çš„å¸®åŠ©ã€‚ init åœ¨å½“å‰ç›®å½•åˆ›å»ºä¸€ä¸ªåŸºç¡€çš„pyproject.tomlæ–‡ä»¶ã€‚ install å®‰è£…é¡¹ç›®ä¾èµ–é¡¹ã€‚ list åˆ—å‡ºå‘½ä»¤ã€‚ lock é”å®šé¡¹ç›®ä¾èµ–é¡¹ã€‚ new åœ¨&lt;path&gt;å¤„åˆ›å»ºä¸€ä¸ªæ–°çš„Pythoné¡¹ç›®ã€‚ publish å°†åŒ…å‘å¸ƒåˆ°è¿œç¨‹ä»“åº“ã€‚ remove ä»é¡¹ç›®ä¾èµ–é¡¹ä¸­ç§»é™¤åŒ…ã€‚ run åœ¨é€‚å½“çš„ç¯å¢ƒä¸­è¿è¡Œå‘½ä»¤ã€‚ search åœ¨è¿œç¨‹ä»“åº“ä¸­æœç´¢åŒ…ã€‚ shell åœ¨è™šæ‹Ÿç¯å¢ƒä¸­å¯åŠ¨shellã€‚ show æ˜¾ç¤ºæœ‰å…³åŒ…çš„ä¿¡æ¯ã€‚ update æ ¹æ®pyproject.tomlæ–‡ä»¶æ›´æ–°ä¾èµ–é¡¹ã€‚ version æ˜¾ç¤ºé¡¹ç›®çš„ç‰ˆæœ¬æˆ–åœ¨æä¾›æœ‰æ•ˆç‰ˆæœ¬è§„åˆ™æ—¶æ›´æ–°å®ƒã€‚ç¼“å­˜ cache clear æŒ‰åç§°æ¸…é™¤Poetryç¼“å­˜ã€‚ cache list åˆ—å‡ºPoetryçš„ç¼“å­˜åˆ—è¡¨ã€‚è°ƒè¯• debug info æ˜¾ç¤ºè°ƒè¯•ä¿¡æ¯ã€‚ debug resolve è°ƒè¯•ä¾èµ–é¡¹è§£æã€‚ç¯å¢ƒ env info æ˜¾ç¤ºå½“å‰ç¯å¢ƒçš„ä¿¡æ¯ã€‚ env list åˆ—å‡ºä¸å½“å‰é¡¹ç›®å…³è”çš„æ‰€æœ‰è™šæ‹Ÿç¯å¢ƒã€‚ env remove ç§»é™¤ä¸é¡¹ç›®å…³è”çš„è™šæ‹Ÿç¯å¢ƒã€‚ env use æ¿€æ´»æˆ–åˆ›å»ºå½“å‰é¡¹ç›®çš„æ–°çš„è™šæ‹Ÿç¯å¢ƒã€‚è‡ªèº« self add å‘Poetryçš„è¿è¡Œæ—¶ç¯å¢ƒæ·»åŠ å…¶ä»–åŒ…ã€‚ self install å®‰è£…æ­¤Poetryå®‰è£…æ‰€éœ€çš„é”å®šåŒ…ï¼ˆåŒ…æ‹¬æ’ä»¶ï¼‰ã€‚ self lock é”å®šPoetryå®‰è£…çš„ç³»ç»Ÿè¦æ±‚ã€‚ self remove ä»Poetryçš„è¿è¡Œæ—¶ç¯å¢ƒä¸­ç§»é™¤å…¶ä»–åŒ…ã€‚ self show æ˜¾ç¤ºPoetryè¿è¡Œæ—¶ç¯å¢ƒä¸­çš„åŒ…ã€‚ self show plugins æ˜¾ç¤ºå½“å‰å·²å®‰è£…æ’ä»¶çš„ä¿¡æ¯ã€‚ self update æ›´æ–°Poetryåˆ°æœ€æ–°ç‰ˆæœ¬ã€‚æº source add ä¸ºé¡¹ç›®æ·»åŠ æºé…ç½®ã€‚ source remove ç§»é™¤ä¸ºé¡¹ç›®é…ç½®çš„æºã€‚ source show æ˜¾ç¤ºä¸ºé¡¹ç›®é…ç½®çš„æºä¿¡æ¯ã€‚ å¸¸ç”¨å‘½ä»¤ è¿™é‡Œåªå¯¹æ—¥å¸¸å¼€å‘ä¸­æ¯”è¾ƒå¸¸ç”¨çš„å‘½ä»¤è¿›è¡Œç®€è¦è¯´æ˜ï¼Œè¯¦ç»†ä»‹ç»å¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£ new : åˆ›å»ºé¡¹ç›® 12345678910111213141516171819202122232425262728293031# æŒ‰ç…§é»˜è®¤è§„åˆ™åˆ›å»ºä¸€ä¸ªåŸºäº poetry çš„é¡¹ç›®$ poetry new my-projectCreated package my_project in my-project$ cd my-project# æŸ¥çœ‹ç”Ÿæˆçš„ç›®å½•ç»“æ„$ exa -T.â”œâ”€â”€ my_projectâ”‚ â””â”€â”€ __init__.pyâ”œâ”€â”€ pyproject.tomlâ”œâ”€â”€ README.mdâ””â”€â”€ tests â””â”€â”€ __init__.py# æŸ¥çœ‹ pyproject.toml å†…å®¹ï¼Œè¯¥æ–‡ä»¶ä¸ºé¡¹ç›®çš„é…ç½®çš„é…ç½®æ–‡ä»¶$ more pyproject.toml[tool.poetry]name = &quot;my-project&quot;version = &quot;0.1.0&quot;description = &quot;&quot;authors = [&quot;hanqunfeng &lt;hanqf2008@163.com&gt;&quot;]readme = &quot;README.md&quot;[tool.poetry.dependencies]python = &quot;^3.11&quot;[build-system]requires = [&quot;poetry-core&quot;]build-backend = &quot;poetry.core.masonry.api&quot; init : åˆå§‹åŒ–ä¸€ä¸ªå·²æœ‰çš„é¡¹ç›®ç›®å½• 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647# å‡è®¾æˆ‘ä»¬å·²ç»æœ‰ä¸ªé¡¹ç›®ç›®å½•ï¼Œç›®å½•åç§°ä¸º poetryDemo$ cd poetryDemo# åˆå§‹åŒ– poetryDemo ï¼Œåœ¨å½“å‰ç›®å½•ä¸‹åˆ›å»º pyproject.toml æ–‡ä»¶ï¼Œæ³¨æ„è¯¥æ“ä½œåªä¼šåˆ›å»ºè¯¥æ–‡ä»¶ï¼ŒåŒ…ç›®å½•ä»¥åŠreadmeæ–‡ä»¶éƒ½æ²¡æœ‰ï¼Œéœ€è¦æ‰‹å·¥åˆ›å»º$ poetry initThis command will guide you through creating your pyproject.toml config.Package name [poetrydemo]: # åŒ…åç§°Version [0.1.0]: # ç‰ˆæœ¬å·Description []: # æè¿°ä¿¡æ¯Author [hanqunfeng &lt;hanqf2008@163.com&gt;, n to skip]: # ä½œè€…License []: # LicenseCompatible Python versions [^3.11]: # python ç‰ˆæœ¬Would you like to define your main dependencies interactively? (yes/no) [yes] # æ‚¨æƒ³ä»¥äº¤äº’æ–¹å¼å®šä¹‰æ‚¨çš„ä¸»ç¯å¢ƒä¾èµ–å…³ç³»å—ï¼Ÿé»˜è®¤yesYou can specify a package in the following forms: # æ‚¨å¯ä»¥æŒ‰ä»¥ä¸‹å½¢å¼æŒ‡å®šåŒ…ï¼š - A single name (requests): this will search for matches on PyPI # å•ä¸ªåç§°ï¼ˆrequestsï¼‰ï¼šè¿™å°†åœ¨å®˜æ–¹ä»“åº“PyPIä¸Šæœç´¢åŒ¹é…é¡¹ï¼Œå¦‚æœæŒ‡å®šäº†å…¶å®ƒé•œåƒæºå°±ä¼šä»æŒ‡å®šçš„æºä¸‹è½½ - A name and a constraint (requests@^2.23.0) # åç§°å’Œç‰ˆæœ¬çº¦æŸ - A git url (git+https://github.com/python-poetry/poetry.git) # gitåœ°å€ - A git url with a revision (git+https://github.com/python-poetry/poetry.git#develop) # gitåœ°å€ï¼ŒæŒ‡å®šæŸä¸ªåˆ†æ”¯ - A file path (../my-package/my-package.whl) # æ–‡ä»¶è·¯å¾„ - A directory (../my-package/) # ç›®å½•è·¯å¾„ - A url (https://example.com/packages/my-package-0.1.0.tar.gz) # ä¸€ä¸ªå®‰è£…åŒ…çš„åœ°å€Package to add or search for (leave blank to skip): # æ·»åŠ ä¸»ç¯å¢ƒä¾èµ–ï¼ŒæŒ‰ä¸Šé¢çš„æ ¼å¼è¦æ±‚å¡«å†™Would you like to define your development dependencies interactively? (yes/no) [yes] # æ‚¨æƒ³ä»¥äº¤äº’æ–¹å¼å®šä¹‰æ‚¨çš„å¼€å‘ä¾èµ–å…³ç³»å—ï¼Ÿé»˜è®¤yesPackage to add or search for (leave blank to skip): # æ·»åŠ å¼€å‘ç¯å¢ƒä¾èµ–ï¼ŒæŒ‰ä¸Šé¢çš„æ ¼å¼è¦æ±‚å¡«å†™Generated file# è¦ç”Ÿæˆçš„ pyproject.toml å†…å®¹[tool.poetry]name = &quot;poetrydemo&quot; # åŒ…åç§°version = &quot;0.1.0&quot; # ç‰ˆæœ¬description = &quot;&quot; # æè¿°ä¿¡æ¯authors = [&quot;hanqunfeng &lt;hanqf2008@163.com&gt;&quot;] # ä½œè€…ä¿¡æ¯readme = &quot;README.md&quot; # è¯´æ˜æ–‡ä»¶[tool.poetry.dependencies] # ä¸»ç¯å¢ƒä¾èµ–python = &quot;^3.11&quot;[build-system]requires = [&quot;poetry-core&quot;]build-backend = &quot;poetry.core.masonry.api&quot;Do you confirm generation? (yes/no) [yes] # ç¡®è®¤æ˜¯å¦æŒ‰ç…§ä¸Šé¢çš„å†…å®¹åˆ›å»º pyproject.toml æ–‡ä»¶ï¼Œé»˜è®¤yes ä¸Šé¢çš„æ–¹å¼åœ¨åˆå§‹åŒ–æ—¶ä¼šè¯¢é—®ä½ ç›¸å…³çš„ä¿¡æ¯ï¼Œå¦‚æœä½ å¸Œæœ›éƒ½ç”¨é»˜è®¤å€¼çš„è¯ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ 1poetry init -n config : poetryçš„å…¨å±€é…ç½® æŸ¥çœ‹å…¨å±€é…ç½® 12345678910111213141516171819$ poetry config --listcache-dir = &quot;/Users/hanqf/Library/Caches/pypoetry&quot; # ç¼“å­˜ç›®å½•,ç”¨äºå­˜å‚¨é¡¹ç›®ä¾èµ–å’Œè™šæ‹Ÿç¯å¢ƒç­‰ç¼“å­˜ä¿¡æ¯ã€‚experimental.system-git-client = false # æ˜¯å¦ä½¿ç”¨ç³»ç»Ÿè‡ªå¸¦çš„gitå®¢æˆ·ç«¯,falseè¡¨ç¤ºä½¿ç”¨Poetryå†…ç½®çš„gitå®¢æˆ·ç«¯installer.max-workers = null # å®‰è£…ä¾èµ–æ—¶çš„æœ€å¤§çº¿ç¨‹æ•°,nullè¡¨ç¤ºä½¿ç”¨é»˜è®¤çº¿ç¨‹æ•°ï¼Œå¯ä»¥è®¾ç½®ä¸ºcpuæ ¸æ•°+4installer.modern-installation = true # æ˜¯å¦ä½¿ç”¨Poetryçš„ç°ä»£å®‰è£…æ–¹æ¡ˆ,trueè¡¨ç¤ºä½¿ç”¨installer.no-binary = null # æ˜¯å¦ä¸ä½¿ç”¨é¢„ç¼–è¯‘çš„äºŒè¿›åˆ¶åŒ…,nullè¡¨ç¤ºä¸é™åˆ¶installer.parallel = true # æ˜¯å¦å¹¶è¡Œå®‰è£…ä¾èµ–,trueè¡¨ç¤ºå¹¶è¡Œå®‰è£…keyring.enabled = true # æ˜¯å¦å¯ç”¨å¯†é’¥ç¯ï¼ˆkeyringï¼‰ä»¥ä¿å­˜è®¤è¯ä¿¡æ¯ã€‚true è¡¨ç¤ºå¯ç”¨ã€‚solver.lazy-wheel = true # æ˜¯å¦å»¶è¿Ÿè§£æ wheel åŒ…ã€‚true è¡¨ç¤ºå»¶è¿Ÿè§£æã€‚virtualenvs.create = true # æ˜¯å¦è‡ªåŠ¨åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ,trueè¡¨ç¤ºåˆ›å»ºvirtualenvs.in-project = null # æ˜¯å¦åœ¨é¡¹ç›®å†…åˆ›å»ºè™šæ‹Ÿç¯å¢ƒï¼Œnull è¡¨ç¤ºä½¿ç”¨é»˜è®¤å€¼ï¼ˆé€šå¸¸ä¸º falseï¼‰ï¼Œå³ä¸åœ¨é¡¹ç›®ä¸­åˆ›å»ºã€‚trueè¡¨ç¤ºåœ¨é¡¹ç›®ä¸­åˆ›å»ºvirtualenvs.options.always-copy = false # å¦‚æœè®¾ç½®ä¸º trueï¼ŒPoetry ä¼šå§‹ç»ˆå¤åˆ¶æ–‡ä»¶åˆ°è™šæ‹Ÿç¯å¢ƒä¸­ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ç¬¦å·é“¾æ¥ï¼ˆsymlinksï¼‰ã€‚è¿™å¯ä»¥é¿å…æŸäº›ç³»ç»Ÿä¸Šçš„æƒé™é—®é¢˜ï¼Œä½†ä¼šå¢åŠ è™šæ‹Ÿç¯å¢ƒçš„å­˜å‚¨éœ€æ±‚ã€‚virtualenvs.options.no-pip = false # å¦‚æœè®¾ç½®ä¸º trueï¼ŒPoetry åœ¨åˆ›å»ºè™šæ‹Ÿç¯å¢ƒæ—¶ä¸ä¼šå®‰è£… pipã€‚å¦‚æœä½ çš„é¡¹ç›®ä¸éœ€è¦ç›´æ¥ä½¿ç”¨ pipï¼Œå¹¶ä¸”ä½ å¸Œæœ›é€šè¿‡ Poetry ç®¡ç†æ‰€æœ‰çš„ä¾èµ–é¡¹ï¼Œå¯ä»¥å°† no-pip è®¾ç½®ä¸º trueï¼Œä»¥å‡å°‘è™šæ‹Ÿç¯å¢ƒä¸­çš„ä¸å¿…è¦çš„ä¾èµ–é¡¹ã€‚virtualenvs.options.no-setuptools = false # å¦‚æœè®¾ç½®ä¸º trueï¼ŒPoetry åœ¨åˆ›å»ºè™šæ‹Ÿç¯å¢ƒæ—¶ä¸ä¼šå®‰è£… setuptoolsã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒPoetry ä¼šå®‰è£… pip å’Œ setuptoolsï¼Œä»¥ä¾¿ä½ å¯ä»¥ä½¿ç”¨è¿™äº›å·¥å…·æ¥ç®¡ç†ä¾èµ–é¡¹ã€‚virtualenvs.options.system-site-packages = false # é»˜è®¤å€¼falseï¼Œæ­¤æ—¶ Poetry åˆ›å»ºçš„è™šæ‹Ÿç¯å¢ƒå°†ä¸ä¼šåŒ…å«å…¨å±€ Python å®‰è£…çš„ site-packages ç›®å½•ä¸­çš„åŒ…ã€‚è¿™æœ‰åŠ©äºç¡®ä¿é¡¹ç›®ä¾èµ–é¡¹çš„éš”ç¦»æ€§ï¼Œé¿å…ä¸ç³»ç»Ÿä¸­çš„å…¶ä»–åŒ…å‘ç”Ÿå†²çªã€‚virtualenvs.path = &quot;&#123;cache-dir&#125;/virtualenvs&quot; # /Users/hanqf/Library/Caches/pypoetry/virtualenvs # è™šæ‹Ÿç¯å¢ƒå­˜æ”¾çš„è·¯å¾„ï¼Œå¦‚æœvirtualenvs.in-projectè®¾ç½®ä¸ºtrueï¼Œå°±åªä¼šåœ¨é¡¹ç›®ä¸­åˆ›å»ºvirtualenvs.prefer-active-python = false # æ˜¯å¦ä¼˜å…ˆä½¿ç”¨ç³»ç»Ÿæ¿€æ´»çš„Pythonè§£é‡Šå™¨virtualenvs.prompt = &quot;&#123;project_name&#125;-py&#123;python_version&#125;&quot; # è™šæ‹Ÿç¯å¢ƒçš„å‘½ä»¤æç¤ºæ ¼å¼warnings.export = true # æ˜¯å¦åœ¨å¯¼å‡ºæ—¶æ˜¾ç¤ºè­¦å‘Šä¿¡æ¯ã€‚true è¡¨ç¤ºæ˜¾ç¤º ä¿®æ”¹å…¨å±€é…ç½® 1234567891011121314151617# ä¿®æ”¹å…¨å±€é…ç½®ï¼Œæ­¤åä¼šåœ¨é¡¹ç›®ç›®å½•ä¸‹åˆ›å»º .venv ç›®å½•å­˜æ”¾è™šæ‹Ÿç¯å¢ƒ$ poetry config virtualenvs.in-project true# è¿›å…¥è™šæ‹Ÿç¯å¢ƒï¼Œå¦‚æœè™šæ‹Ÿç¯å¢ƒå°šæœªåˆ›å»ºä¼šè‡ªåŠ¨åˆ›å»º$ poetry shell# é€€å‡ºè™šæ‹Ÿç¯å¢ƒ$ exit# åªå¯¹å½“å‰é¡¹ç›®æœ‰æ•ˆï¼Œæ­¤æ—¶ä¼šåœ¨å½“å‰é¡¹ç›®ç›®å½•ä¸‹åˆ›å»º poetry.toml æ¥ä¿å­˜è¿™äº›é…ç½®ä¿¡æ¯$ poetry config virtualenvs.in-project true --local$ poetry config virtualenvs.options.system-site-packages true --local$ more poetry.toml[virtualenvs]in-project = true[virtualenvs.options]system-site-packages = true# è¿™é‡Œè¦æ³¨æ„ virtualenvs ä¸‹çš„å±æ€§å¿…é¡»åœ¨åˆ›å»ºè™šæ‹Ÿç¯å¢ƒå‰è®¾ç½®æ‰ä¼šæœ‰æ•ˆ env : è™šæ‹Ÿç¯å¢ƒç®¡ç† Poetry ä¼šåœ¨ä½ ç¬¬ä¸€æ¬¡è¿è¡ŒæŸäº›å‘½ä»¤ï¼ˆå¦‚ poetry shell æˆ–è€… poetry add somepackageï¼‰æ—¶è‡ªåŠ¨åˆ›å»ºè™šæ‹Ÿç¯å¢ƒã€‚ ä¸è¿‡è¿™ç§æ—¶å€™éƒ½æ˜¯ä½¿ç”¨ç³»ç»Ÿé»˜è®¤çš„pythonæ¥åˆ›å»ºè™šæ‹Ÿç¯å¢ƒï¼Œå¦‚æœç³»ç»Ÿä¸­å®‰è£…äº†å¤šä¸ªpythonï¼Œåˆ™å¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹å¼è®¾ç½®è™šæ‹Ÿç¯å¢ƒè¦ä½¿ç”¨å“ªä¸ªpythonç‰ˆæœ¬ åˆ›å»º/åˆ‡æ¢è™šæ‹Ÿç¯å¢ƒ 123456789# æŒ‡å®špythonçš„ç‰ˆæœ¬ï¼Œè¿™ä¼šä»pythonçš„é»˜è®¤å®‰è£…è·¯å¾„ä¸‹æŸ¥æ‰¾å¯¹åº”çš„ç‰ˆæœ¬# æ¯”å¦‚macOsä¼šä»è¯¥è·¯å¾„ä¸‹æŸ¥æ‰¾ï¼š/Library/Frameworks/Python.framework/Versions$ poetry env use 3.11# å¦‚æœå¯ä»¥ç›´æ¥åœ¨å‘½ä»¤è¡Œä½¿ç”¨pythonå‘½ä»¤,æ¯”å¦‚ï¼špython3.12 -Vï¼Œåˆ™å¯ä»¥ä½¿ç”¨å¦‚ä¸‹æ–¹å¼åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ$ poetry env use python3.12# å¦‚æœpythonå®‰è£…åˆ°äº†å…¶å®ƒè·¯å¾„ï¼Œå¯ä»¥æŒ‡å®špythonå®‰è£…è·¯å¾„$ poetry env use /pythonDir/3.13/bin/python3 æŸ¥çœ‹å½“å‰é¡¹ç›®çš„è™šæ‹Ÿç¯å¢ƒä¿¡æ¯ 12345678910111213141516171819202122232425262728293031323334353637383940# åˆ›å»ºä¸€ä¸ªåŸºäº python3.13 çš„è™šæ‹Ÿç¯å¢ƒ$ poetry env use python3.13Creating virtualenv poetrydemo-fyqYbfje-py3.13 in /Users/hanqf/Library/Caches/pypoetry/virtualenvsUsing virtualenv: /Users/hanqf/Library/Caches/pypoetry/virtualenvs/poetrydemo-fyqYbfje-py3.13# å†åˆ›å»ºä¸€ä¸ªåŸºäº python3.11 çš„è™šæ‹Ÿç¯å¢ƒï¼Œæœ€åè¢«useçš„å¤„äºé»˜è®¤æ¿€æ´»çŠ¶æ€$ poetry env use python3.11Creating virtualenv poetrydemo-fyqYbfje-py3.11 in /Users/hanqf/Library/Caches/pypoetry/virtualenvsUsing virtualenv: /Users/hanqf/Library/Caches/pypoetry/virtualenvs/poetrydemo-fyqYbfje-py3.11# æŸ¥çœ‹å½“å‰é¡¹ç›®æœ‰å¤šå°‘ä¸ªè™šæ‹Ÿç¯å¢ƒ$ poetry env listpoetrydemo-fyqYbfje-py3.11 (Activated) # poetrydemo-fyqYbfje-py3.11 è¡¨ç¤ºè™šæ‹Ÿç¯å¢ƒåç§°ï¼ŒActivatedè¡¨ç¤ºå½“å‰è™šæ‹Ÿç¯å¢ƒå·²ç»è¢«æ¿€æ´»poetrydemo-fyqYbfje-py3.13# æŸ¥çœ‹è™šæ‹ŸåŒ–ç¯å¢ƒè·¯å¾„$ poetry env list --full-path/Users/hanqf/Library/Caches/pypoetry/virtualenvs/poetrydemo-fyqYbfje-py3.11 (Activated)# æŸ¥çœ‹å½“å‰æ¿€æ´»çš„è™šæ‹Ÿç¯å¢ƒä¿¡æ¯$ poetry env infoVirtualenvPython: 3.11.3Implementation: CPythonPath: /Users/hanqf/Library/Caches/pypoetry/virtualenvs/poetrydemo-fyqYbfje-py3.11Executable: /Users/hanqf/Library/Caches/pypoetry/virtualenvs/poetrydemo-fyqYbfje-py3.11/bin/pythonValid: TrueBasePlatform: darwinOS: posixPython: 3.11.3Path: /Library/Frameworks/Python.framework/Versions/3.11Executable: /Library/Frameworks/Python.framework/Versions/3.11/bin/python3.11# åˆ é™¤è™šæ‹Ÿç¯å¢ƒ$ poetry env remove python3.13Deleted virtualenv: /Users/hanqf/Library/Caches/pypoetry/virtualenvs/poetrydemo-fyqYbfje-py3.13# åˆ é™¤å…¨éƒ¨è™šæ‹Ÿç¯å¢ƒ$ poetry env remove --all æ³¨æ„ï¼Œå½“virtualenvs.in-projectè¢«è®¾ç½®ä¸ºtrueæ—¶ï¼Œå³åªåœ¨é¡¹ç›®ç›®å½•ä¸‹åˆ›å»ºè™šæ‹Ÿç¯å¢ƒæ—¶ï¼Œåªä¼šä¿ç•™ä¸€ä¸ªç¯å¢ƒï¼Œå³.venv åˆ‡æ¢åˆ°æ–°çš„è™šæ‹Ÿç¯å¢ƒæ—¶ä¼šå…¨æ–°åˆ›å»ºä¸€ä¸ªæ–°çš„ç¯å¢ƒï¼ŒåŸå…ˆçš„ç¯å¢ƒä¼šè¢«åˆ é™¤ï¼Œæ‰€ä»¥è¦ä½¿ç”¨poetry installå‘½ä»¤é‡æ–°å®‰è£…ä¾èµ– 123456789101112131415161718192021222324$ poetry env use python3.11Recreating virtualenv poetrydemo in /Users/hanqf/Desktop/pythonDir/poetryDir/poetryDemo/.venvUsing virtualenv: /Users/hanqf/Desktop/pythonDir/poetryDir/poetryDemo/.venv$ poetry env list # è™½ç„¶å¯ä»¥é€šè¿‡ poetry env use çš„æ–¹å¼æ¥åˆ›å»ºæ–°çš„è™šæ‹Ÿç¯å¢ƒï¼Œä½†å®é™…ä¸Šåªä¼šæœ‰ä¸€ä¸ªç¯å¢ƒè¢«ä¿ç•™ï¼Œæ‰€ä»¥è¿™é‡Œåªä¼šæ˜¾ç¤ºä¸€ä¸ª.venv (Activated) # .venv è¡¨ç¤ºè™šæ‹Ÿç¯å¢ƒåç§°ï¼ŒActivatedè¡¨ç¤ºå½“å‰è™šæ‹Ÿç¯å¢ƒå·²ç»è¢«æ¿€æ´»# æŸ¥çœ‹è™šæ‹Ÿç¯å¢ƒä¿¡æ¯$ poetry env infoVirtualenvPython: 3.11.3Implementation: CPythonPath: /Users/hanqf/Desktop/pythonDir/poetryDir/poetryDemo/.venvExecutable: /Users/hanqf/Desktop/pythonDir/poetryDir/poetryDemo/.venv/bin/pythonValid: TrueBasePlatform: darwinOS: posixPython: 3.11.3Path: /Library/Frameworks/Python.framework/Versions/3.11Executable: /Library/Frameworks/Python.framework/Versions/3.11/bin/python3.11 ä¾èµ–åŒ…ç®¡ç† add : å®‰è£…ä¾èµ–åŒ… è¿™ä¸ªå‘½ä»¤ä¼šä¿®æ”¹ pyproject.toml æ–‡ä»¶ï¼Œåœ¨ [tool.poetry.dependencies] éƒ¨åˆ†æ·»åŠ æ–°çš„ä¾èµ–é¡¹ã€‚è¿˜ä¼šè‡ªåŠ¨æ›´æ–° poetry.lock æ–‡ä»¶ï¼Œé”å®šä¾èµ–çš„ç¡®åˆ‡ç‰ˆæœ¬ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556# å®‰è£…ä¾èµ–ï¼Œå®‰è£…åä¼šå°†ä¾èµ–ä¿¡æ¯å†™å…¥ pyproject.toml ä¸­# ä¸æŒ‡å®šç‰ˆæœ¬åˆ™å®‰è£…æœ€æ–°ç‰ˆ$ poetry add fastapiUsing version ^0.115.5 for fastapiUpdating dependenciesResolving dependencies... (1.3s)Package operations: 9 installs, 0 updates, 0 removals - Installing idna (3.10) - Installing sniffio (1.3.1) - Installing typing-extensions (4.12.2) - Installing annotated-types (0.7.0) - Installing anyio (4.6.2.post1) - Installing pydantic-core (2.23.4) - Installing pydantic (2.9.2) - Installing starlette (0.41.3) - Installing fastapi (0.115.5)Writing lock file# æŒ‡å®šç‰ˆæœ¬å·å®‰è£…ä¾èµ–poetry add package_name@^1.2.3 # è§„åˆ™è¯´æ˜ ^1.2.3 è¡¨ç¤ºå…¼å®¹ 1.2.3 åŠæ›´é«˜çš„å°ç‰ˆæœ¬ï¼Œä½†ä¸åŒ…æ‹¬ 2.0.0ã€‚ å¦‚ï¼špoetry add requests@^2.28.0 ~1.2.3ï¼šå…è®¸å‡çº§åˆ° 1.2.xï¼Œä½†ä¸åŒ…æ‹¬ 1.3.0ã€‚ å¦‚ï¼špoetry add requests@~2.28.0 1.2.3ï¼šå›ºå®šä¸º 1.2.3ã€‚ å¦‚ï¼špoetry add requests@2.28.0 &gt;=1.2.3ï¼šå…è®¸ä½¿ç”¨ 1.2.3 åŠä»¥ä¸Šç‰ˆæœ¬ã€‚æ³¨æ„zshä¸‹è¦åŠ ä¸ŠåŒå¼•å·ï¼Œå¦‚ï¼špoetry add &quot;requests@&gt;=2.28.0&quot; &lt;2.0.0ï¼šå…è®¸ä½¿ç”¨å°äº 2.0.0 çš„ç‰ˆæœ¬ã€‚ æ³¨æ„zshä¸‹è¦åŠ ä¸ŠåŒå¼•å·ï¼Œå¦‚ï¼špoetry add &quot;requests@&lt;3.0.0&quot;# å®‰è£…åˆ°æŒ‡å®šçš„åˆ†ç»„ï¼Œé»˜è®¤éƒ½æ˜¯å®‰è£…åˆ°ä¸»ç¯å¢ƒä¸­çš„ï¼Œpoetry buildé»˜è®¤åªä¼šæ‰“åŒ…ä¸»ç¯å¢ƒçš„ä¾èµ–poetry add flask # å®‰è£…åˆ°ä¸»ç¯å¢ƒä¸­poetry add flask --group=test #æ·»åŠ åˆ†ç»„å testpoetry add flask --dev #ç›¸å½“äº--group=dev# åˆ†åˆ«æ‰§è¡Œä¸Šé¢3ä¸ªå®‰è£…å‘½ä»¤åï¼Œè¾“å‡º pyproject.toml çš„å†…å®¹å¦‚ä¸‹[tool.poetry]name = &quot;poetrydemo&quot;version = &quot;0.1.0&quot;description = &quot;&quot;authors = [&quot;hanqunfeng &lt;hanqf2008@163.com&gt;&quot;]readme = &quot;README.md&quot;[tool.poetry.dependencies] # ä¸»ç¯å¢ƒpython = &quot;^3.11&quot;flask = &quot;^3.1.0&quot;[tool.poetry.group.test.dependencies] # teståˆ†ç»„ä¾èµ–flask = &quot;^3.1.0&quot;[tool.poetry.group.dev.dependencies] # devåˆ†ç»„ä¾èµ–flask = &quot;^3.1.0&quot;[build-system]requires = [&quot;poetry-core&quot;]build-backend = &quot;poetry.core.masonry.api&quot; show : æŸ¥çœ‹ä¾èµ–åŒ… 123456789101112131415# æŸ¥çœ‹å½“å‰é¡¹ç›®éƒ½éœ€è¦å“ªäº›ä¾èµ–ï¼Œè¿™äº›ä¾èµ–ä¸ä¸€å®šéƒ½å®‰è£…äº†ï¼Œå®ƒåªæ˜¯è§£æ pyproject.toml ä¸­çš„å£°æ˜æ¥è§£æä¾èµ–æ ‘$ poetry showannotated-types 0.7.0 Reusable constraint types to use with typing.Annotatedanyio 4.6.2.post1 High level compatibility layer for multiple asynchronous ...fastapi 0.115.5 FastAPI framework, high performance, easy to learn, fast ...idna 3.10 Internationalized Domain Names in Applications (IDNA)pydantic 2.9.2 Data validation using Python type hintspydantic-core 2.23.4 Core functionality for Pydantic validation and serializationsniffio 1.3.1 Sniff out which async library your code is running understarlette 0.41.3 The little ASGI library that shines.typing-extensions 4.12.2 Backported and Experimental Type Hints for Python 3.8+# åªæŸ¥çœ‹é¡¶çº§ä¾èµ–ï¼Œå³åªæŸ¥çœ‹åœ¨ pyproject.toml ä¸­å£°æ˜çš„ä¾èµ–$ poetry show --top-levelfastapi 0.115.5 FastAPI framework, high performance, easy to learn, fast ... remove : åˆ é™¤ä¾èµ–åŒ… 123456789101112131415161718# åˆ é™¤ä¾èµ–ï¼Œæ­¤æ—¶ä¼šå°†å½“å‰åŒ…åŠå…¶æ‰€æœ‰ä¾èµ–ä¸€å—åˆ é™¤$ poetry remove fastapiUpdating dependenciesResolving dependencies... (0.1s)Package operations: 0 installs, 0 updates, 9 removals - Removing annotated-types (0.7.0) - Removing anyio (4.6.2.post1) - Removing fastapi (0.115.5) - Removing idna (3.10) - Removing pydantic (2.9.2) - Removing pydantic-core (2.23.4) - Removing sniffio (1.3.1) - Removing starlette (0.41.3) - Removing typing-extensions (4.12.2)Writing lock file search : æœç´¢è¿œç¨‹ä»“åº“ 12# æœç´¢è¿œç¨‹ä»“åº“$ poetry search fastapi install å’Œ update : å®‰è£…å’Œæ›´æ–°ä¾èµ–åŒ… åœ¨ Poetry ä¸­ï¼Œinstall å’Œ update æ˜¯ä¸¤ä¸ªå¸¸ç”¨çš„å‘½ä»¤ï¼Œä½†å®ƒä»¬çš„ä½œç”¨å’Œä½¿ç”¨åœºæ™¯ä¸åŒ poetry install çš„ä½œç”¨æ˜¯æ ¹æ®ç°æœ‰çš„ poetry.lock æ–‡ä»¶æ¥å®‰è£…ä¾èµ–ï¼Œç¡®ä¿å®‰è£…çš„ä¾èµ–ç‰ˆæœ¬ä¸é”æ–‡ä»¶ä¸­è®°å½•çš„ç‰ˆæœ¬å®Œå…¨ä¸€è‡´ã€‚ æ ¸å¿ƒç‰¹ç‚¹ï¼š å®‰è£…é”å®šçš„ç‰ˆæœ¬ï¼šå®ƒåªä¼šå®‰è£… poetry.lock æ–‡ä»¶ä¸­æŒ‡å®šçš„ç‰ˆæœ¬ï¼Œå³ä½¿ pyproject.toml æ–‡ä»¶ä¸­å®šä¹‰çš„ç‰ˆæœ¬èŒƒå›´å·²ç»æœ‰æ›´æ–°ç‰ˆæœ¬ã€‚ é‡ç°ä¾èµ–ç¯å¢ƒï¼šé€‚ç”¨äºå›¢é˜Ÿåä½œæˆ–éƒ¨ç½²ç¯å¢ƒï¼Œç¡®ä¿æ‰€æœ‰äººæˆ–æœºå™¨å®‰è£…çš„ä¾èµ–ç‰ˆæœ¬å®Œå…¨ç›¸åŒã€‚ é”æ–‡ä»¶å­˜åœ¨æ—¶æ›´é«˜æ•ˆï¼šå¦‚æœ poetry.lock æ–‡ä»¶å­˜åœ¨ï¼Œpoetry install ä¸ä¼šé‡æ–°è§£æä¾èµ–æ ‘ã€‚ é¦–æ¬¡è¿è¡Œæ—¶ç”Ÿæˆé”æ–‡ä»¶ï¼šå¦‚æœæ²¡æœ‰ poetry.lock æ–‡ä»¶ï¼Œpoetry install ä¼šè§£æä¾èµ–å¹¶ç”Ÿæˆé”æ–‡ä»¶ã€‚ ä½¿ç”¨åœºæ™¯ï¼š æ–°å…‹éš†çš„é¡¹ç›®ï¼Œéœ€è¦å®‰è£…ä¾èµ–ç¯å¢ƒã€‚ éƒ¨ç½²ç”Ÿäº§ç¯å¢ƒï¼Œç¡®ä¿ä¾èµ–ç‰ˆæœ¬çš„ç¨³å®šæ€§ã€‚ é‡æ–°å®‰è£…ä¹‹å‰å·²å®šä¹‰çš„ä¾èµ–ï¼ˆä¾‹å¦‚æ¸…ç©ºäº†è™šæ‹Ÿç¯å¢ƒï¼‰ã€‚ poetry update çš„ä½œç”¨æ˜¯æ ¹æ® pyproject.toml æ–‡ä»¶ä¸­å®šä¹‰çš„ä¾èµ–èŒƒå›´é‡æ–°è§£æä¾èµ–æ ‘ï¼Œå¹¶æ›´æ–° poetry.lock æ–‡ä»¶ä¸ºæœ€æ–°çš„ç‰ˆæœ¬ã€‚ æ ¸å¿ƒç‰¹ç‚¹ï¼š æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬ï¼šå®ƒä¼šå°è¯•å®‰è£…ä¾èµ–èŒƒå›´å†…çš„æœ€æ–°ç‰ˆæœ¬ï¼Œå¹¶æ›´æ–° poetry.lock æ–‡ä»¶ã€‚ è§£ææ–°çš„ä¾èµ–æ ‘ï¼šå³ä½¿ poetry.lock æ–‡ä»¶å­˜åœ¨ï¼Œpoetry update ä¹Ÿä¼šå¿½ç•¥å®ƒå¹¶é‡æ–°è§£æä¾èµ–ã€‚ æ›´æ”¹é”æ–‡ä»¶ï¼šå®ƒä¼šè¦†ç›–ç°æœ‰çš„ poetry.lock æ–‡ä»¶ï¼Œå› æ­¤å›¢é˜Ÿå…¶ä»–æˆå‘˜éœ€è¦é‡æ–°è¿è¡Œ poetry install ä»¥åŒæ­¥ã€‚ ä½¿ç”¨åœºæ™¯ï¼š æ›´æ–°ä¾èµ–åˆ°æœ€æ–°ç‰ˆæœ¬ï¼ˆåœ¨ä¾èµ–èŒƒå›´å†…ï¼‰ã€‚ å½“æ·»åŠ æ–°ä¾èµ–åï¼Œæƒ³è¦å®‰è£…å¹¶æ›´æ–°é”æ–‡ä»¶ã€‚ ä¿®å¤å¯èƒ½çš„ç‰ˆæœ¬å†²çªæˆ–ä¸å…¼å®¹é—®é¢˜ã€‚ lock : é”å®šä¾èµ–åŒ… poetry lock æ˜¯ Poetryï¼ˆä¸€ä¸ª Python åŒ…ç®¡ç†å·¥å…·ï¼‰ä¸­çš„ä¸€ä¸ªå‘½ä»¤ï¼Œç”¨äºé”å®šé¡¹ç›®çš„ä¾èµ–å…³ç³»ã€‚ä½¿ç”¨è¿™ä¸ªå‘½ä»¤å¯ä»¥åˆ›å»ºæˆ–æ›´æ–° poetry.lock æ–‡ä»¶ï¼Œç¡®ä¿ä½ çš„é¡¹ç›®ä¸­æ‰€ä½¿ç”¨çš„æ¯ä¸ªåŒ…çš„ç‰ˆæœ¬éƒ½è¢«æ˜ç¡®è®°å½•ä¸‹æ¥ã€‚è¿™æ ·åšå¯¹äºé¡¹ç›®çš„å¯å¤ç°æ€§å’Œç¨³å®šæ€§è‡³å…³é‡è¦ã€‚ å®é™…ä¸Šï¼Œå½“è¿è¡Œ poetry install ã€ poetry update æˆ–è€… poetry add ç­‰å‘½ä»¤æ—¶ï¼Œ poetry éƒ½ä¼šæ ¹æ® pyproject.toml æ–‡ä»¶ä¸­çš„ä¾èµ–èŒƒå›´ï¼Œè§£æä¾èµ–æ ‘ï¼Œå¹¶åœ¨é¡¹ç›®ç›®å½•ä¸‹åˆ›å»ºæˆ–æ›´æ–° poetry.lock æ–‡ä»¶ã€‚ å½“æˆ‘ä»¬æ‰‹å·¥ä¿®æ”¹äº† pyproject.toml æ–‡ä»¶ä¸­çš„ä¾èµ–èŒƒå›´ï¼Œæ­¤æ—¶åˆä¸æƒ³ç«‹åˆ»æ›´æ–°ä¾èµ–ï¼Œè€Œæ˜¯å¸Œæœ›åœ¨æŸä¸ªæ—¶æœºå†æ›´æ–°ï¼Œæ­¤æ—¶å°±å¯ä»¥ä½¿ç”¨ poetry lock å‘½ä»¤ï¼Œå…ˆé”å®šè¿™äº›ä¾èµ–ï¼Œä¹‹åå†é€šè¿‡ poetry install å‘½ä»¤å®‰è£…ã€‚ å¯ä»¥ä½¿ç”¨ poetry check å‘½ä»¤æ£€æŸ¥ pyproject.toml æ–‡ä»¶ ä¸ poetry.lock æ–‡ä»¶çš„ä¸€è‡´æ€§ã€‚ 12345678910111213# æ¯”å¦‚æˆ‘æ‰‹å·¥åˆ é™¤äº† `pyproject.toml` æ–‡ä»¶ä¸­çš„æŸä¸ªä¾èµ–# æ­¤æ—¶è¿è¡Œ check æ£€æŸ¥ä¸€è‡´æ€§ä¼šæŠ¥é”™$ poetry checkError: pyproject.toml changed significantly since poetry.lock was last generated. Run `poetry lock [--no-update]` to fix the lock file.# é”å®šä¾èµ–$ poetry lockUpdating dependenciesResolving dependencies... (0.1s)Writing lock file# æ£€æŸ¥ä¸€è‡´æ€§é€šè¿‡$ poetry checkAll set! å°è´´å£« æ³¨æ„ï¼Œæ­¤æ—¶é€šè¿‡ poetry show æŸ¥çœ‹ä¸åˆ°é‚£ä¸ªæ‰‹å·¥åˆ é™¤çš„ä¾èµ–åŒ…ï¼Œä½†å®é™…ä¸Šä¾èµ–ä¾æ—§åœ¨äºè™šæ‹Ÿç¯å¢ƒä¸­ æ‰€ä»¥å°½é‡é¿å…æ‰‹å·¥åˆ é™¤ä¾èµ–ï¼Œè€Œæ˜¯é€šè¿‡ poetry remove å‘½ä»¤æ¥åˆ é™¤ä¾èµ– source : é•œåƒæºç®¡ç† é»˜è®¤æƒ…å†µä¸‹éƒ½æ˜¯ä»Pypiçš„å®˜æ–¹ä»“åº“ä¸‹è½½ï¼Œå›½å†…ä¸€èˆ¬éœ€è¦æŒ‡å®šé•œåƒæºæ¥åŠ é€Ÿä¸‹è½½ 123456789101112131415161718192021222324252627282930313233# æ·»åŠ é•œåƒæºï¼Œé»˜è®¤å°±æ˜¯ä¸»è¦æºï¼Œæ³¨æ„è¯¥æ–¹å¼åªå¯¹å½“å‰é¡¹ç›®æœ‰æ•ˆ# å‘½ä»¤æ ¼å¼ï¼špoetry source add [é€‰é¡¹] [--] &lt;name&gt; [&lt;url&gt;]ï¼Œnameï¼šæºä»“åº“çš„åç§°ï¼Œurlï¼šæºä»“åº“çš„ URL$ poetry source add tsinghua https://pypi.tuna.tsinghua.edu.cn/simpleAdding source with name tsinghua.# --priority=PRIORITYè®¾ç½®æ­¤æºçš„ä¼˜å…ˆçº§ã€‚å¯ä»¥æ˜¯ä»¥ä¸‹å€¼ä¹‹ä¸€ï¼šdefaultï¼ˆé»˜è®¤ï¼‰ã€primaryï¼ˆä¸»è¦ï¼‰ã€supplementalï¼ˆå¤‡ç”¨ï¼‰ã€explicitï¼ˆæ˜¾å¼æºï¼Œåªæœ‰å½“åŒ…æ˜ç¡®å£°æ˜ä½¿ç”¨è¯¥æºæ—¶æ‰ä¼šè¢«ä½¿ç”¨ï¼‰ã€‚é»˜è®¤ä¸º primaryã€‚$ poetry source add --priority=supplemental aliyun http://mirrors.aliyun.com/pypi/simple/# æŸ¥çœ‹é•œåƒæºä¿¡æ¯$ poetry source show name : tsinghua url : https://pypi.tuna.tsinghua.edu.cn/simple priority : primary name : aliyun url : http://mirrors.aliyun.com/pypi/simple/ priority : supplemental# æ­¤æ—¶æŸ¥çœ‹ pyproject.toml æ–‡ä»¶å¯ä»¥çœ‹åˆ°é•œåƒæºä¿¡æ¯[[tool.poetry.source]]name = &quot;tsinghua&quot;url = &quot;https://pypi.tuna.tsinghua.edu.cn/simple&quot;priority = &quot;primary&quot;[[tool.poetry.source]]name = &quot;aliyun&quot;url = &quot;http://mirrors.aliyun.com/pypi/simple/&quot;priority = &quot;supplemental&quot;# åˆ é™¤é•œåƒæº$ poetry source remove aliyun # æŒ‡å®šé•œåƒæºåç§°Removing source with name aliyun. è¿è¡Œ è¿™é‡Œä»¥ä¸€ä¸ªå°ç¤ºä¾‹æ¥è¯´æ˜è¿™ä¸ªåŠŸèƒ½ åˆ›å»ºä¸€ä¸ªæ–°çš„é¡¹ç›® 123456789101112131415161718192021$ poetry new poetryDemoCreated package poetrydemo in poetryDemo# è¿›å…¥é¡¹ç›®ç›®å½•$ cd poetryDemo# æŸ¥çœ‹ç”Ÿæˆçš„æ–‡ä»¶$ lltotal 8drwxr-xr-x 6 hanqf staff 192 11 21 17:32 .drwxr-xr-x 4 hanqf staff 128 11 21 17:32 ..-rw-r--r-- 1 hanqf staff 0 11 21 17:32 README.mddrwxr-xr-x 3 hanqf staff 96 11 21 17:32 poetrydemo-rw-r--r-- 1 hanqf staff 266 11 21 17:32 pyproject.tomldrwxr-xr-x 3 hanqf staff 96 11 21 17:32 tests# è¿›å…¥åŒ…ç›®å½•$ cd poetrydemo# æŸ¥çœ‹åŒ…ç›®å½•ä¸‹çš„æ–‡ä»¶$ lltotal 0drwxr-xr-x 3 hanqf staff 96 11 21 17:32 .drwxr-xr-x 6 hanqf staff 192 11 21 17:32 ..-rw-r--r-- 1 hanqf staff 0 11 21 17:32 __init__.py åœ¨åŒ…ç›®å½•ä¸‹åˆ›å»º array_util.pyï¼Œå†…å®¹å¦‚ä¸‹ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152import numpy as npdef generate_random_array(shape, distribution=&quot;uniform&quot;, params=None, seed=None): &quot;&quot;&quot; ç”Ÿæˆéšæœºæ•°ç»„çš„å·¥å…·æ–¹æ³•ã€‚ :param shape: tupleï¼ŒæŒ‡å®šæ•°ç»„çš„å½¢çŠ¶ï¼Œä¾‹å¦‚ (3, 4) è¡¨ç¤º 3 è¡Œ 4 åˆ—ã€‚ :param distribution: strï¼ŒæŒ‡å®šéšæœºæ•°åˆ†å¸ƒç±»å‹ï¼Œå¯é€‰å€¼ï¼š - &quot;uniform&quot;ï¼šå‡åŒ€åˆ†å¸ƒï¼ˆé»˜è®¤ï¼‰ã€‚ - &quot;normal&quot;ï¼šæ­£æ€åˆ†å¸ƒã€‚ - &quot;integer&quot;ï¼šéšæœºæ•´æ•°ã€‚ :param params: dictï¼Œåˆ†å¸ƒçš„å‚æ•°é…ç½®ï¼š - å‡åŒ€åˆ†å¸ƒï¼š&#123;&quot;low&quot;: æœ€å°å€¼, &quot;high&quot;: æœ€å¤§å€¼&#125;ï¼Œé»˜è®¤ low=0, high=1ã€‚ - æ­£æ€åˆ†å¸ƒï¼š&#123;&quot;mean&quot;: å‡å€¼, &quot;std&quot;: æ ‡å‡†å·®&#125;ï¼Œé»˜è®¤ mean=0, std=1ã€‚ - éšæœºæ•´æ•°ï¼š&#123;&quot;low&quot;: æœ€å°å€¼, &quot;high&quot;: æœ€å¤§å€¼, &quot;dtype&quot;: ç±»å‹&#125;ï¼Œé»˜è®¤ low=0, high=10ã€‚ :param seed: intï¼Œéšæœºæ•°ç§å­ï¼ˆå¯é€‰ï¼‰ï¼Œç”¨äºç»“æœå¯å¤ç°ã€‚ :return: np.ndarrayï¼Œç”Ÿæˆçš„éšæœºæ•°ç»„ã€‚ &quot;&quot;&quot; if seed is not None: np.random.seed(seed) if params is None: params = &#123;&#125; if distribution == &quot;uniform&quot;: low = params.get(&quot;low&quot;, 0) high = params.get(&quot;high&quot;, 1) return np.random.uniform(low, high, size=shape) elif distribution == &quot;normal&quot;: mean = params.get(&quot;mean&quot;, 0) std = params.get(&quot;std&quot;, 1) return np.random.normal(mean, std, size=shape) elif distribution == &quot;integer&quot;: low = params.get(&quot;low&quot;, 0) high = params.get(&quot;high&quot;, 10) dtype = params.get(&quot;dtype&quot;, int) return np.random.randint(low, high, size=shape, dtype=dtype) else: raise ValueError(&quot;ä¸æ”¯æŒçš„åˆ†å¸ƒç±»å‹ï¼å¯é€‰å€¼ä¸º &#x27;uniform&#x27;, &#x27;normal&#x27;, &#x27;integer&#x27;ã€‚&quot;)# ç¤ºä¾‹ç”¨æ³•if __name__ == &quot;__main__&quot;: array_uniform = generate_random_array((3, 4), distribution=&quot;uniform&quot;, params=&#123;&quot;low&quot;: 1, &quot;high&quot;: 10&#125;) array_normal = generate_random_array((2, 3), distribution=&quot;normal&quot;, params=&#123;&quot;mean&quot;: 0, &quot;std&quot;: 1&#125;, seed=42) array_integer = generate_random_array((4, 5), distribution=&quot;integer&quot;, params=&#123;&quot;low&quot;: 0, &quot;high&quot;: 20&#125;) print(&quot;å‡åŒ€åˆ†å¸ƒéšæœºæ•°ç»„ï¼š\\n&quot;, array_uniform) print(&quot;æ­£æ€åˆ†å¸ƒéšæœºæ•°ç»„ï¼š\\n&quot;, array_normal) print(&quot;éšæœºæ•´æ•°æ•°ç»„ï¼š\\n&quot;, array_integer) å®‰è£…ä¾èµ– 1234567891011$ poetry add numpyUsing version ^2.1.3 for numpyUpdating dependenciesResolving dependencies... (1.1s)Package operations: 1 install, 0 updates, 0 removals - Installing numpy (2.1.3)Writing lock file è¿è¡Œï¼Œä¸¤ç§æ–¹æ³• poetry run 12345678910111213$ poetry run python array_util.pyå‡åŒ€åˆ†å¸ƒéšæœºæ•°ç»„ï¼š[[7.44623063 1.89415788 4.81008329 4.25556572][3.31925154 6.44037063 5.3216543 7.54950573][3.97160747 5.04800698 3.28299934 3.42841887]]æ­£æ€åˆ†å¸ƒéšæœºæ•°ç»„ï¼š[[ 0.49671415 -0.1382643 0.64768854][ 1.52302986 -0.23415337 -0.23413696]]éšæœºæ•´æ•°æ•°ç»„ï¼š[[10 10 3 7 2][ 1 11 5 1 0][11 11 16 9 15][14 14 18 11 19]] poetry shell : æ­¤æ—¶ä¼šå¼€å¯ä¸€ä¸ªæ–°çš„shellï¼Œå¹¶å¼€å¯è™šæ‹Ÿç¯å¢ƒ 1234567# å¼€å¯è™šæ‹Ÿç¯å¢ƒ$ poetry shellSpawning shell within /Users/hanqf/Library/Caches/pypoetry/virtualenvs/poetrydemo-fyqYbfje-py3.11Restored session: 2024å¹´11æœˆ21æ—¥ æ˜ŸæœŸå›› 15æ—¶31åˆ†52ç§’ CSTâœ poetrydemo emulate bash -c &#x27;. /Users/hanqf/Library/Caches/pypoetry/virtualenvs/poetrydemo-fyqYbfje-py3.11/bin/activate&#x27;# åœ¨è™šæ‹Ÿç¯å¢ƒä¸‹è¿è¡Œ$ python array_util.py æ‰“åŒ…å’Œå‘å¸ƒ æ¥ç€ä¸Šé¢çš„é¡¹ç›® æ‰“åŒ… 123456789101112# ä¼šåœ¨é¡¹ç›®ç›®å½•ä¸‹åˆ›å»º dist ç›®å½•ï¼Œå¹¶å°†æ‰“å¥½çš„åŒ…å­˜æ”¾äºæ­¤$ poetry buildBuilding poetrydemo (0.1.0) - Building sdist - Built poetrydemo-0.1.0.tar.gz - Building wheel - Built poetrydemo-0.1.0-py3-none-any.whl# æŸ¥çœ‹ç”Ÿæˆçš„æ‰“åŒ…æ–‡ä»¶$ exa -1 disthqf_poetrydemo-0.1.0-py3-none-any.whlhqf_poetrydemo-0.1.0.tar.gz å‘å¸ƒ é¦–å…ˆè¦å…ˆåœ¨PyPIä¸Šæ³¨å†Œä¸ªå¸å·ï¼Œéœ€è¦å¼€å¯â€œåŒè¦ç´ èº«ä»½éªŒè¯ ï¼ˆ2FAï¼‰â€ï¼Œå¦åˆ™ä¸èƒ½è·å–å‘å¸ƒæ—¶çš„APIä»¤ç‰Œã€‚ è·å–APIä»¤ç‰Œ å‘å¸ƒï¼Œä¸è¿‡è¿™æ¬¡å‘å¸ƒæç¤ºåŒ…åå·²ç»å­˜åœ¨äº† 123456# å‘å¸ƒæ—¶æç¤ºåŒ…åå·²ç»å­˜åœ¨äº†$ poetry publish -u __token__ -p pypi-AgEIcHlwaS5vcmcCJDU0Y2Q5NjhkLWYyYTEtNPublishing poetrydemo (0.1.0) to PyPI - Uploading poetrydemo-0.1.0-py3-none-any.whl FAILEDHTTP Error 400: The name &#x27;poetrydemo&#x27; is too similar to an existing project. See https://pypi.org/help/#project-name for more information. | b&quot;&lt;html&gt;\\n &lt;head&gt;\\n &lt;title&gt;400 The name &#x27;poetrydemo&#x27; is too similar to an existing project. See https://pypi.org/help/#project-name for more information.\\n \\n &lt;body&gt;\\n &lt;h1&gt;400 The name &#x27;poetrydemo&#x27; is too similar to an existing project. See https://pypi.org/help/#project-name for more information.\\n The server could not comply with the request since it is either malformed or otherwise incorrect.&lt;br/&gt;&lt;br/&gt;\\nThe name &amp;#x27;poetrydemo&amp;#x27; is too similar to an existing project. See https://pypi.org/help/#project-name for more information.\\n\\n\\n \\n&quot; å…ˆä¿®æ”¹åŒ…åï¼Œç›´æ¥ç¼–è¾‘ pyproject.toml å³å¯ï¼Œå°†nameå±æ€§ä¿®æ”¹ä¸ºâ€œhqf_poetrydemoâ€ï¼Œç„¶åå°†åŒ…ç›®å½•çš„åç§°ä¹Ÿä¿®æ”¹ä¸ºè¿™ä¸ªmv poetrydemo hqf_poetrydemoï¼Œå¹¶åˆ é™¤distç›®å½•ï¼Œä¹‹åé‡æ–°æ‰“åŒ…poetry buildï¼Œå†æ¬¡å‘å¸ƒ 1234567891011121314151617$ vim pyproject.toml # å°†nameå±æ€§ä¿®æ”¹ä¸ºâ€œhqf_poetrydemoâ€$ mv poetrydemo hqf_poetrydemo # å°†åŒ…ç›®å½•çš„åç§°ä¹Ÿä¿®æ”¹ä¸ºè¿™ä¸ª$ rm -rf dist # åˆ é™¤distç›®å½•$ poetry build # é‡æ–°æ‰“åŒ…Creating virtualenv hqf-poetrydemo-fyqYbfje-py3.11 in /Users/hanqf/Library/Caches/pypoetry/virtualenvsBuilding hqf_poetrydemo (0.1.0) - Building sdist - Built hqf_poetrydemo-0.1.0.tar.gz - Building wheel - Built hqf_poetrydemo-0.1.0-py3-none-any.whl# å†æ¬¡å‘å¸ƒ$ poetry publish -u __token__ -p pypi-AgEIcHlwaS5vcmcCJDU0Y2Q5NjhkLWYyYTEtNPublishing hqf_poetrydemo (0.1.0) to PyPI - Uploading hqf_poetrydemo-0.1.0-py3-none-any.whl 100% - Uploading hqf_poetrydemo-0.1.0.tar.gz 100% ä¹‹åå°±å¯ä»¥åœ¨å…¶å®ƒé¡¹ç›®ä¸­å®‰è£…è¿™ä¸ªåŒ…äº† 12345678910111213141516# pip install$ pip install hqf_poetrydemo# poetry add$ poetry add hqf_poetrydemoUsing version ^0.1.0 for hqf-poetrydemoUpdating dependenciesResolving dependencies... (0.5s)Package operations: 2 installs, 0 updates, 0 removals - Installing numpy (2.1.3) - Installing hqf-poetrydemo (0.1.0)Writing lock file self update : å‡çº§ poetry ç‰ˆæœ¬ self ç›¸å…³å‘½ä»¤ä¸»è¦ç”¨äº poetry è‡ªèº«å®‰è£…æ’ä»¶ä½¿ç”¨ ä¼°è®¡æ’ä»¶åŠŸèƒ½ç›®å‰è¿˜ä¸æˆç†Ÿï¼Œå®˜ç½‘ä¹Ÿæ²¡æœ‰è¿›è¡Œè¯¦ç»†çš„è¯´æ˜ï¼Œå¹¶ä¸” windows ä¸‹æ— æ³•ä½¿ç”¨ï¼Œæ‰€ä»¥è¿™é‡Œä¸è®¨è®ºã€‚ selfå‘½ä»¤ä¸‹ç›®å‰åªéœ€è¦è®°ä½ä¸€ä¸ªå‘½ä»¤ï¼š self update : å‡çº§ poetry ç‰ˆæœ¬ 1$ poetry self update debug resolve : æŸ¥çœ‹åŒ…çš„ä¾èµ–å…³ç³» 1234567891011121314# åªæŸ¥çœ‹ï¼Œä¸å®‰è£…$ poetry debug resolve requestsResolving dependencies... (0.4s)Resolution results:certifi 2024.8.30charset-normalizer 3.4.0idna 3.10urllib3 2.2.3requests 2.32.3# æŸ¥çœ‹æŒ‡å®šç‰ˆæœ¬çš„ä¾èµ–å…³ç³»$ poetry debug resolve requests@2.32.3 cache : ç¼“å­˜ç®¡ç† poetryä¸€ä¸ªå¾ˆé‡è¦çš„åŠŸèƒ½å°±æ˜¯ç¼“å­˜å®‰è£…åŒ…ï¼Œå¯ä»¥ å‡å°‘ ç›¸åŒçš„å®‰è£…åŒ…è¢«é‡å¤ä¸‹è½½ã€‚ä¸ºä»€ä¹ˆæ˜¯å‡å°‘è€Œä¸æ˜¯é¿å…å‘¢ï¼Ÿå› ä¸ºä¸åŒçš„é•œåƒæºçš„åŒ…æ˜¯åˆ†åˆ«ç¼“å­˜çš„ã€‚ é€šè¿‡ poetry config --list å¯ä»¥çœ‹åˆ° cache-dir çš„åœ°å€ï¼Œè¿™é‡Œå°±æ˜¯ç¼“å­˜ä¸‹è½½åŒ…çš„ç›®å½•ã€‚ ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„ä½¿ç”¨åœºæ™¯ è§£å†³ä¾èµ–å®‰è£…é—®é¢˜ï¼š å¦‚æœä½ åœ¨å®‰è£…æˆ–æ›´æ–°ä¾èµ–æ—¶é‡åˆ°é—®é¢˜ï¼ˆä¾‹å¦‚ï¼ŒæŸä¸ªåŒ…æ— æ³•æ­£ç¡®å®‰è£…æˆ–ç‰ˆæœ¬ä¸å¯¹ï¼‰ï¼Œæ¸…ç©ºç¼“å­˜å¯ä»¥å¸®åŠ©ä½ ç¡®ä¿ Poetry é‡æ–°ä¸‹è½½æ‰€æœ‰å¿…è¦çš„æ–‡ä»¶ï¼Œä»è€Œè§£å†³é—®é¢˜ã€‚ æ¸…ç†ç£ç›˜ç©ºé—´ï¼š å¦‚æœä½ çš„é¡¹ç›®å¾ˆå¤šæˆ–è€…ç»å¸¸ä¿®æ”¹ä¾èµ–é¡¹ï¼Œç¼“å­˜å¯èƒ½ä¼šå˜å¾—éå¸¸å¤§ã€‚ä½¿ç”¨ poetry cache clear å¯ä»¥å¸®åŠ©é‡Šæ”¾ç£ç›˜ç©ºé—´ï¼Œç‰¹åˆ«æ˜¯å½“ä½ ä¸ç»å¸¸ä½¿ç”¨æŸäº›åŒ…æ—¶ã€‚ æµ‹è¯•æœ€æ–°ç‰ˆæœ¬çš„ä¾èµ–ï¼š å¦‚æœä½ æƒ³æµ‹è¯•æŸä¸ªåŒ…çš„æ–°ç‰ˆæœ¬æ˜¯å¦è§£å†³äº†æŸä¸ªé—®é¢˜ï¼Œæˆ–è€…æƒ³ç¡®ä¿ä½ ä½¿ç”¨çš„ç¡®å®æ˜¯æœ€æ–°çš„ç‰ˆæœ¬ï¼Œæ¸…é™¤ç¼“å­˜å¯ä»¥å¼ºåˆ¶ Poetry ä»è¿œç¨‹ä»“åº“é‡æ–°ä¸‹è½½æœ€æ–°çš„åŒ…ã€‚ ç¯å¢ƒå˜åŒ–ï¼š å¦‚æœä½ çš„å¼€å‘æˆ–ç”Ÿäº§ç¯å¢ƒå‘ç”Ÿäº†å˜åŒ–ï¼ˆä¾‹å¦‚ï¼Œåˆ‡æ¢äº†æ“ä½œç³»ç»Ÿã€æ›´æ–°äº† Python ç‰ˆæœ¬ç­‰ï¼‰ï¼Œæ¸…é™¤ç¼“å­˜å¯ä»¥å¸®åŠ©ä½ ç¡®ä¿ä¾èµ–é¡¹åœ¨æ–°ç¯å¢ƒä¸­æ­£ç¡®å®‰è£…ã€‚ è°ƒè¯•ä¾èµ–é—®é¢˜ï¼š åœ¨è°ƒè¯•ä¾èµ–é¡¹é—®é¢˜æ—¶ï¼Œæœ‰æ—¶å€™æ¸…é™¤ç¼“å­˜å¯ä»¥å¸®åŠ©ä½ ç¡®å®šé—®é¢˜æ˜¯å¦ä¸ç¼“å­˜ä¸­çš„æ—§ç‰ˆæœ¬æœ‰å…³ã€‚ CI/CD ç¯å¢ƒçš„ä¸€è‡´æ€§ï¼š åœ¨æŒç»­é›†æˆæˆ–æŒç»­éƒ¨ç½² (CI/CD) ç¯å¢ƒä¸­ï¼Œä¸ºäº†ç¡®ä¿æ¯æ¬¡æ„å»ºéƒ½åŸºäºæœ€æ–°çš„ä¾èµ–ï¼Œæœ‰æ—¶ä¼šåœ¨æ„å»ºè„šæœ¬ä¸­åŒ…å«æ¸…é™¤ç¼“å­˜çš„æ­¥éª¤ã€‚ 1234567891011# æŸ¥çœ‹ç¼“å­˜åˆ—è¡¨ï¼Œè¿™é‡Œä¼šæŒ‰é•œåƒæºè¿›è¡Œåˆ†ç»„$ poetry cache listPyPI_default_cachetsinghua# æ¸…é™¤æŒ‡å®šæºçš„å…¨éƒ¨ç¼“å­˜$ poetry cache clear pypi --all# æ¸…é™¤æŒ‡å®šæºä¸‹æŸä¸ªåŒ…çš„ç¼“å­˜$ poetry cache clear pypi:requests:2.24.0","summary":"æ‘˜è¦ Poetryæ˜¯ä¸€ä¸ªè½»é‡çº§çš„pythonåŒ…ç®¡ç†å™¨ï¼Œå…¶ç›®æ ‡æ˜¯å¸®åŠ©å¼€å‘è€…å¿«é€Ÿã€è½»æ¾åœ°æ„å»ºã€å‘å¸ƒå’Œåˆ†äº«pythonåŒ…ã€‚è¯´å®ƒè½»é‡ï¼Œæ˜¯ä¸ conda ç›¸æ¯” poetry æ›´è½»é‡ï¼ŒåŒæ—¶ä¸ venv + pip Python--virtualenv çš„æ–¹å¼ç›¸æ¯”å…·æœ‰å¦‚ä¸‹ä¼˜ç‚¹ï¼š ä½¿ç”¨ç¼“å­˜æœºåˆ¶ï¼Œé¿å…é‡å¤ä¸‹è½½ä¾èµ–åŒ… åŒ…ç®¡ç†ä¸Šæ›´åŠ ç²¾ç¡®ï¼Œåˆ é™¤ä¸éœ€è¦çš„åŒ…æ—¶ä¼šåŒæ—¶åˆ é™¤ä¸å…¶å…³è”çš„ä¸”æ²¡æœ‰è¢«ä½¿ç”¨çš„é‚£äº›ä¾èµ–åŒ…ï¼Œé¿å…æ— ç”¨çš„ä¾èµ–åŒ…é€ æˆæ‰“åŒ…ä½“ç§¯è¿‡å¤§ æ‰“åŒ…å’Œå‘å¸ƒæ›´åŠ ç®€å•ï¼Œåªéœ€è¦ä¸€ä¸ªå‘½ä»¤å°±å¯ä»¥æ‰“åŒ…å’Œå‘å¸ƒ","date_published":"2024-11-22T15:33:15.000Z","tags":["æŠ€æœ¯","Python"]},{"id":"https://blog.hanqunfeng.com/2024/11/18/python_pip/","url":"https://blog.hanqunfeng.com/2024/11/18/python_pip/","title":"pip--CERTIFICATE_VERIFY_FAILED","content_html":"<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">æµ‹è¯•ç¯å¢ƒï¼šmacOS 13.7.1ï¼ŒPython 3.11.3</li>\n<li class=\"lvl-2\">ä»Šå¤©å°†<code>pip</code>å‡çº§(<code>pip install --upgrade pip</code>)åˆ°<code>24.3.1</code>ç‰ˆæœ¬åï¼Œé€šè¿‡<code>pip install</code>å‘½ä»¤å®‰è£…ä¾èµ–æ—¶ä¼šæŠ¥é”™ï¼Œæ¯”å¦‚ï¼š</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ pip install certifi</span><br><span class=\"line\">Could not fetch URL https://pypi.org/simple/certifi/: There was a problem confirming the ssl certificate: HTTPSConnectionPool(host=<span class=\"string\">&#x27;pypi.org&#x27;</span>, port=443): Max retries exceeded with url: /simple/certifi/ (Caused by SSLError(SSLCertVerificationError(1, <span class=\"string\">&#x27;[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1002)&#x27;</span>))) - skipping</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">å¾ˆå¥‡æ€ªï¼Œä»<code>pip</code>è‡ªå·±çš„ç½‘ç«™ä¸Šä¸‹è½½ä¾èµ–éƒ½ä¼šå‡ºç°è¯ä¹¦æ— æ³•éªŒè¯çš„é”™è¯¯ã€‚æµ‹è¯•äº†ä¸€ä¸‹ï¼Œè¯¥é—®é¢˜åªåœ¨macOSä¸Šé‡åˆ°ï¼Œå…¶ä»–å¹³å°æ²¡æœ‰é‡åˆ°è¿‡ã€‚</li>\n<li class=\"lvl-2\">å…ˆè¯´ç»“è®ºï¼Œæ¨èä½¿ç”¨ç¬¬äº”ç§æ–¹æ³•ã€‚</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"è§£å†³æ–¹æ³•\">è§£å†³æ–¹æ³•</h2>\n<h3 id=\"1-trusted-host-å¿½ç•¥è¯ä¹¦éªŒè¯\">1. <code>--trusted-host</code>: å¿½ç•¥è¯ä¹¦éªŒè¯</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æŒ‡å®šä¿¡ä»»çš„è¯ä¹¦åŸŸåï¼Œä»è€Œä¸è¿›è¡ŒéªŒè¯è¯ä¹¦ï¼Œå¯ä»¥æŒ‡å®šå¤šä¸ª</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pip install certifi --trusted-host pypi.org --trusted-host files.pythonhosted.org</span><br></pre></td></tr></table></figure>\n<h3 id=\"2-cert-æŒ‡å®šè¯ä¹¦æ–‡ä»¶\">2. <code>--cert</code>: æŒ‡å®šè¯ä¹¦æ–‡ä»¶</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ­¤æ—¶éœ€è¦å…ˆä¸‹è½½è¯ä¹¦æ–‡ä»¶ï¼Œç”¨Chromeæµè§ˆå™¨æ‰“å¼€<a href=\"https://pypi.org\">https://pypi.org</a>ï¼ŒæŒ‰å¦‚ä¸‹æ­¥éª¤å¯¼å‡ºè¯ä¹¦æ–‡ä»¶<br>\n<img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/tMocyD.png\" alt=\"\" width=\"300\" height=\"300\"><br>\n<img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/uS4W2W.png\" alt=\"\" width=\"300\" height=\"300\"><br>\n<img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/OiZf9R.png\" alt=\"\" width=\"400\" height=\"500\"><br>\n<img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/JHw2ML.png\" alt=\"\" width=\"400\" height=\"300\"></p>\n</li>\n<li class=\"lvl-2\">\n<p>ç„¶åå†æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤è¿›è¡Œå®‰è£…</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pip install certifi --cert ~/Downloads/GlobalSign.pem</span><br></pre></td></tr></table></figure>\n<h3 id=\"3-pip-conf-é…ç½®å…¨å±€è¯ä¹¦æ–‡ä»¶\">3. <code>pip.conf</code>: é…ç½®å…¨å±€è¯ä¹¦æ–‡ä»¶</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¿˜æ˜¯éœ€è¦å…ˆä¸‹è½½è¯ä¹¦æ–‡ä»¶ï¼Œå‚è€ƒä¸Šé¢æ–¹æ³•</p>\n</li>\n<li class=\"lvl-2\">\n<p><code>pip</code> çš„é…ç½®æ–‡ä»¶ä½ç½®å› æ“ä½œç³»ç»Ÿè€Œå¼‚ã€‚å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤æ‰¾åˆ°é…ç½®æ–‡ä»¶è·¯å¾„ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æˆ‘ä½¿ç”¨çš„æ˜¯ macOS</span></span><br><span class=\"line\">$ pip config -v list</span><br><span class=\"line\">For variant <span class=\"string\">&#x27;global&#x27;</span>, will try loading <span class=\"string\">&#x27;/Library/Application Support/pip/pip.conf&#x27;</span></span><br><span class=\"line\">For variant <span class=\"string\">&#x27;user&#x27;</span>, will try loading <span class=\"string\">&#x27;/Users/hanqf/.pip/pip.conf&#x27;</span></span><br><span class=\"line\">For variant <span class=\"string\">&#x27;user&#x27;</span>, will try loading <span class=\"string\">&#x27;/Users/hanqf/.config/pip/pip.conf&#x27;</span></span><br><span class=\"line\">For variant <span class=\"string\">&#x27;site&#x27;</span>, will try loading <span class=\"string\">&#x27;/Library/Frameworks/Python.framework/Versions/3.11/pip.conf&#x27;</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><code>pip</code>ä¼šä»ä¸Šé¢çš„è·¯å¾„ä¸­æŸ¥æ‰¾é…ç½®ä¿¡æ¯ï¼Œæˆ‘è¿™é‡Œé€‰æ‹©ç¬¬äºŒä¸ªï¼Œå¦‚æœä¸å­˜åœ¨å°±åˆ›å»º<code>~/.pip/pip.conf</code>æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight ini\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"section\">[global]</span></span><br><span class=\"line\"><span class=\"attr\">cert</span> = ~/Downloads/GlobalSign.pem</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>é…ç½®å¥½åå¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹é…ç½®ä¿¡æ¯</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ pip config list</span><br><span class=\"line\">global.cert=<span class=\"string\">&#x27;~/.pip/GlobalSign.pem&#x27;</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç„¶åå†æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤è¿›è¡Œå®‰è£…</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pip install certifi</span><br></pre></td></tr></table></figure>\n<h3 id=\"4-å°†è¯ä¹¦æ·»åŠ åˆ°ç³»ç»Ÿä¿¡ä»»çš„è¯ä¹¦å­˜å‚¨\">4.å°†è¯ä¹¦æ·»åŠ åˆ°ç³»ç»Ÿä¿¡ä»»çš„è¯ä¹¦å­˜å‚¨</h3>\n<h4 id=\"å¯¹äº-macOSï¼š\">å¯¹äº macOSï¼š</h4>\n<div class=\"danger\">\n<p><em><strong>æˆ‘è®¾ç½®åä¾æ—§æŠ¥é”™ï¼Œæš‚ä¸æ¸…æ¥šåŸå› </strong></em></p>\n</div>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ‰“å¼€ <code>é’¥åŒ™ä¸²è®¿é—®</code> åº”ç”¨ç¨‹åºï¼Œå¹¶é€‰æ‹© <code>ç³»ç»Ÿé’¥åŒ™ä¸²</code> ä¸­çš„ <code>ç³»ç»Ÿ</code> (ä»ç½‘ä¸ŠæŸ¥è¯¢è¯´æ˜¯è¦åŠ å…¥<code>ç³»ç»Ÿæ ¹è¯ä¹¦</code>ï¼Œä½†æ˜¯æˆ‘æ²¡æœ‰åŠ å…¥æˆåŠŸ)</p>\n</li>\n<li class=\"lvl-2\">\n<p><code>æ–‡ä»¶</code> ã€‹<code>å¯¼å…¥é¡¹ç›®</code> ã€‹ <code>é€‰æ‹©è¯ä¹¦æ–‡ä»¶</code></p>\n</li>\n<li class=\"lvl-2\">\n<p>ä¼šæç¤ºä½ è¾“å…¥å¯†ç ï¼Œå¦‚æœè¯ä¹¦ä¸å—ä¿¡ä»»ï¼Œå¯ä»¥å°†è¯ä¹¦è®¾ç½®ä¸ºä¸ºå§‹ç»ˆä¿¡ä»»è¯¥è¯ä¹¦ (åŒå‡»è¯ä¹¦ ã€‹ ä¿¡ä»» ã€‹ ä½¿ç”¨æ­¤è¯ä¹¦æ—¶ ã€‹è®¾ç½®ä¸º<code>å§‹ç»ˆä¿¡ä»»</code>)ã€‚</p>\n</li>\n</ul>\n<h3 id=\"5-ä½¿ç”¨-Python-å®˜æ–¹æ¨èçš„è¯ä¹¦ä¿®å¤å·¥å…·-ï¼ˆæ¨èï¼‰\">5.ä½¿ç”¨ Python å®˜æ–¹æ¨èçš„è¯ä¹¦ä¿®å¤å·¥å…· ï¼ˆæ¨èï¼‰</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¿™ä¸ªæ–¹æ³•æœ€ç®€å•</p>\n</li>\n<li class=\"lvl-2\">\n<p>è¿è¡Œè¿™ä¸ªè„šæœ¬å‰éœ€è¦å…ˆå®‰è£… <code>certifi</code>ï¼Œå…¶ä¸»è¦ç”¨äºæä¾›æƒå¨çš„CAæ ¹è¯ä¹¦åˆ—è¡¨</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ pip install certifi --trusted-host pypi.org --trusted-host files.pythonhosted.org</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¿è¡Œè¯ä¹¦å®‰è£…è„šæœ¬ï¼ˆé€‚ç”¨äº macOS å†…ç½®çš„ Pythonï¼‰</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># é¦–æ¬¡è¿è¡Œä¾æ—§ä¼šæŠ¥é”™ï¼Œä½†å®é™…ä¸Šå·²ç»è¿›è¡Œäº†ä¿®å¤ï¼Œä¸»è¦å°±æ˜¯æœ€å4æ­¥è¿›è¡Œçš„æ“ä½œ</span></span><br><span class=\"line\"><span class=\"comment\"># æ³¨æ„æ›¿æ¢ä½ è‡ªå·±çš„Pythonç‰ˆæœ¬å·</span></span><br><span class=\"line\">$ /Applications/Python\\ 3.11/Install\\ Certificates.<span class=\"built_in\">command</span></span><br><span class=\"line\"></span><br><span class=\"line\"> -- pip install --upgrade certifi</span><br><span class=\"line\">Requirement already satisfied: certifi <span class=\"keyword\">in</span> /Library/Frameworks/Python.framework/Versions/3.11/lib/python3.11/site-packages (2024.8.30)</span><br><span class=\"line\">WARNING: Retrying (Retry(total=4, connect=None, <span class=\"built_in\">read</span>=None, redirect=None, status=None)) after connection broken by <span class=\"string\">&#x27;SSLError(SSLCertVerificationError(1, &#x27;</span>[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get <span class=\"built_in\">local</span> issuer certificate (_ssl.c:1002)<span class=\"string\">&#x27;))&#x27;</span>: /simple/certifi/</span><br><span class=\"line\">WARNING: Retrying (Retry(total=3, connect=None, <span class=\"built_in\">read</span>=None, redirect=None, status=None)) after connection broken by <span class=\"string\">&#x27;SSLError(SSLCertVerificationError(1, &#x27;</span>[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get <span class=\"built_in\">local</span> issuer certificate (_ssl.c:1002)<span class=\"string\">&#x27;))&#x27;</span>: /simple/certifi/</span><br><span class=\"line\">WARNING: Retrying (Retry(total=2, connect=None, <span class=\"built_in\">read</span>=None, redirect=None, status=None)) after connection broken by <span class=\"string\">&#x27;SSLError(SSLCertVerificationError(1, &#x27;</span>[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get <span class=\"built_in\">local</span> issuer certificate (_ssl.c:1002)<span class=\"string\">&#x27;))&#x27;</span>: /simple/certifi/</span><br><span class=\"line\">WARNING: Retrying (Retry(total=1, connect=None, <span class=\"built_in\">read</span>=None, redirect=None, status=None)) after connection broken by <span class=\"string\">&#x27;SSLError(SSLCertVerificationError(1, &#x27;</span>[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get <span class=\"built_in\">local</span> issuer certificate (_ssl.c:1002)<span class=\"string\">&#x27;))&#x27;</span>: /simple/certifi/</span><br><span class=\"line\">WARNING: Retrying (Retry(total=0, connect=None, <span class=\"built_in\">read</span>=None, redirect=None, status=None)) after connection broken by <span class=\"string\">&#x27;SSLError(SSLCertVerificationError(1, &#x27;</span>[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get <span class=\"built_in\">local</span> issuer certificate (_ssl.c:1002)<span class=\"string\">&#x27;))&#x27;</span>: /simple/certifi/</span><br><span class=\"line\">Could not fetch URL https://pypi.org/simple/certifi/: There was a problem confirming the ssl certificate: HTTPSConnectionPool(host=<span class=\"string\">&#x27;pypi.org&#x27;</span>, port=443): Max retries exceeded with url: /simple/certifi/ (Caused by SSLError(SSLCertVerificationError(1, <span class=\"string\">&#x27;[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1002)&#x27;</span>))) - skipping</span><br><span class=\"line\"> -- removing any existing file or <span class=\"built_in\">link</span></span><br><span class=\"line\"> -- creating symlink to certifi certificate bundle</span><br><span class=\"line\"> -- setting permissions</span><br><span class=\"line\"> -- update complete</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¹‹åå†è¿è¡Œ<code>pip install</code>å‘½ä»¤ï¼Œå°±ä¸ä¼šæŠ¥é”™äº†</p>\n</li>\n</ul>\n<h3 id=\"6-ä½¿ç”¨å…¶å®ƒé•œåƒæº\">6.ä½¿ç”¨å…¶å®ƒé•œåƒæº</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¯¥é—®é¢˜æ˜¯å› ä¸ºPypiè½¯ä»¶ä»“åº“å®˜ç½‘çš„è¯ä¹¦æ–‡ä»¶å­˜åœ¨é—®é¢˜å¯¼è‡´çš„ï¼Œåªè¦æˆ‘ä»¬ä¸ä»å®˜ç½‘ä¸‹è½½å°±ä¸ä¼šæœ‰é—®é¢˜ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>åœ¨å›½å†…ä¸ºäº†åŠ é€Ÿä¸‹è½½æˆ‘ä»¬ä¸€èˆ¬ä¼šä½¿ç”¨å›½å†…çš„é•œåƒæºï¼Œä¾‹å¦‚<a href=\"https://developer.aliyun.com/mirror/pypi\">é˜¿é‡Œäº‘çš„Pypié•œåƒæº</a>æˆ–è€…<a href=\"https://mirrors.tuna.tsinghua.edu.cn/help/pypi/\">æ¸…åå¤§å­¦çš„Pypié•œåƒæº</a>ï¼Œå…·ä½“ä½¿ç”¨æ–¹æ³•å‚è€ƒå„è‡ªçš„å®˜ç½‘è¯´æ˜å³å¯ã€‚</p>\n</li>\n</ul>\n","content_text":"æ‘˜è¦ æµ‹è¯•ç¯å¢ƒï¼šmacOS 13.7.1ï¼ŒPython 3.11.3 ä»Šå¤©å°†pipå‡çº§(pip install --upgrade pip)åˆ°24.3.1ç‰ˆæœ¬åï¼Œé€šè¿‡pip installå‘½ä»¤å®‰è£…ä¾èµ–æ—¶ä¼šæŠ¥é”™ï¼Œæ¯”å¦‚ï¼š 12$ pip install certifiCould not fetch URL https://pypi.org/simple/certifi/: There was a problem confirming the ssl certificate: HTTPSConnectionPool(host=&#x27;pypi.org&#x27;, port=443): Max retries exceeded with url: /simple/certifi/ (Caused by SSLError(SSLCertVerificationError(1, &#x27;[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1002)&#x27;))) - skipping å¾ˆå¥‡æ€ªï¼Œä»pipè‡ªå·±çš„ç½‘ç«™ä¸Šä¸‹è½½ä¾èµ–éƒ½ä¼šå‡ºç°è¯ä¹¦æ— æ³•éªŒè¯çš„é”™è¯¯ã€‚æµ‹è¯•äº†ä¸€ä¸‹ï¼Œè¯¥é—®é¢˜åªåœ¨macOSä¸Šé‡åˆ°ï¼Œå…¶ä»–å¹³å°æ²¡æœ‰é‡åˆ°è¿‡ã€‚ å…ˆè¯´ç»“è®ºï¼Œæ¨èä½¿ç”¨ç¬¬äº”ç§æ–¹æ³•ã€‚ è§£å†³æ–¹æ³• 1. --trusted-host: å¿½ç•¥è¯ä¹¦éªŒè¯ æŒ‡å®šä¿¡ä»»çš„è¯ä¹¦åŸŸåï¼Œä»è€Œä¸è¿›è¡ŒéªŒè¯è¯ä¹¦ï¼Œå¯ä»¥æŒ‡å®šå¤šä¸ª 1pip install certifi --trusted-host pypi.org --trusted-host files.pythonhosted.org 2. --cert: æŒ‡å®šè¯ä¹¦æ–‡ä»¶ æ­¤æ—¶éœ€è¦å…ˆä¸‹è½½è¯ä¹¦æ–‡ä»¶ï¼Œç”¨Chromeæµè§ˆå™¨æ‰“å¼€https://pypi.orgï¼ŒæŒ‰å¦‚ä¸‹æ­¥éª¤å¯¼å‡ºè¯ä¹¦æ–‡ä»¶ ç„¶åå†æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤è¿›è¡Œå®‰è£… 1pip install certifi --cert ~/Downloads/GlobalSign.pem 3. pip.conf: é…ç½®å…¨å±€è¯ä¹¦æ–‡ä»¶ è¿˜æ˜¯éœ€è¦å…ˆä¸‹è½½è¯ä¹¦æ–‡ä»¶ï¼Œå‚è€ƒä¸Šé¢æ–¹æ³• pip çš„é…ç½®æ–‡ä»¶ä½ç½®å› æ“ä½œç³»ç»Ÿè€Œå¼‚ã€‚å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤æ‰¾åˆ°é…ç½®æ–‡ä»¶è·¯å¾„ï¼š 123456# æˆ‘ä½¿ç”¨çš„æ˜¯ macOS$ pip config -v listFor variant &#x27;global&#x27;, will try loading &#x27;/Library/Application Support/pip/pip.conf&#x27;For variant &#x27;user&#x27;, will try loading &#x27;/Users/hanqf/.pip/pip.conf&#x27;For variant &#x27;user&#x27;, will try loading &#x27;/Users/hanqf/.config/pip/pip.conf&#x27;For variant &#x27;site&#x27;, will try loading &#x27;/Library/Frameworks/Python.framework/Versions/3.11/pip.conf&#x27; pipä¼šä»ä¸Šé¢çš„è·¯å¾„ä¸­æŸ¥æ‰¾é…ç½®ä¿¡æ¯ï¼Œæˆ‘è¿™é‡Œé€‰æ‹©ç¬¬äºŒä¸ªï¼Œå¦‚æœä¸å­˜åœ¨å°±åˆ›å»º~/.pip/pip.confæ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š 12[global]cert = ~/Downloads/GlobalSign.pem é…ç½®å¥½åå¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹é…ç½®ä¿¡æ¯ 12$ pip config listglobal.cert=&#x27;~/.pip/GlobalSign.pem&#x27; ç„¶åå†æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤è¿›è¡Œå®‰è£… 1pip install certifi 4.å°†è¯ä¹¦æ·»åŠ åˆ°ç³»ç»Ÿä¿¡ä»»çš„è¯ä¹¦å­˜å‚¨ å¯¹äº macOSï¼š æˆ‘è®¾ç½®åä¾æ—§æŠ¥é”™ï¼Œæš‚ä¸æ¸…æ¥šåŸå›  æ‰“å¼€ é’¥åŒ™ä¸²è®¿é—® åº”ç”¨ç¨‹åºï¼Œå¹¶é€‰æ‹© ç³»ç»Ÿé’¥åŒ™ä¸² ä¸­çš„ ç³»ç»Ÿ (ä»ç½‘ä¸ŠæŸ¥è¯¢è¯´æ˜¯è¦åŠ å…¥ç³»ç»Ÿæ ¹è¯ä¹¦ï¼Œä½†æ˜¯æˆ‘æ²¡æœ‰åŠ å…¥æˆåŠŸ) æ–‡ä»¶ ã€‹å¯¼å…¥é¡¹ç›® ã€‹ é€‰æ‹©è¯ä¹¦æ–‡ä»¶ ä¼šæç¤ºä½ è¾“å…¥å¯†ç ï¼Œå¦‚æœè¯ä¹¦ä¸å—ä¿¡ä»»ï¼Œå¯ä»¥å°†è¯ä¹¦è®¾ç½®ä¸ºä¸ºå§‹ç»ˆä¿¡ä»»è¯¥è¯ä¹¦ (åŒå‡»è¯ä¹¦ ã€‹ ä¿¡ä»» ã€‹ ä½¿ç”¨æ­¤è¯ä¹¦æ—¶ ã€‹è®¾ç½®ä¸ºå§‹ç»ˆä¿¡ä»»)ã€‚ 5.ä½¿ç”¨ Python å®˜æ–¹æ¨èçš„è¯ä¹¦ä¿®å¤å·¥å…· ï¼ˆæ¨èï¼‰ è¿™ä¸ªæ–¹æ³•æœ€ç®€å• è¿è¡Œè¿™ä¸ªè„šæœ¬å‰éœ€è¦å…ˆå®‰è£… certifiï¼Œå…¶ä¸»è¦ç”¨äºæä¾›æƒå¨çš„CAæ ¹è¯ä¹¦åˆ—è¡¨ 1$ pip install certifi --trusted-host pypi.org --trusted-host files.pythonhosted.org è¿è¡Œè¯ä¹¦å®‰è£…è„šæœ¬ï¼ˆé€‚ç”¨äº macOS å†…ç½®çš„ Pythonï¼‰ 12345678910111213141516# é¦–æ¬¡è¿è¡Œä¾æ—§ä¼šæŠ¥é”™ï¼Œä½†å®é™…ä¸Šå·²ç»è¿›è¡Œäº†ä¿®å¤ï¼Œä¸»è¦å°±æ˜¯æœ€å4æ­¥è¿›è¡Œçš„æ“ä½œ# æ³¨æ„æ›¿æ¢ä½ è‡ªå·±çš„Pythonç‰ˆæœ¬å·$ /Applications/Python\\ 3.11/Install\\ Certificates.command -- pip install --upgrade certifiRequirement already satisfied: certifi in /Library/Frameworks/Python.framework/Versions/3.11/lib/python3.11/site-packages (2024.8.30)WARNING: Retrying (Retry(total=4, connect=None, read=None, redirect=None, status=None)) after connection broken by &#x27;SSLError(SSLCertVerificationError(1, &#x27;[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1002)&#x27;))&#x27;: /simple/certifi/WARNING: Retrying (Retry(total=3, connect=None, read=None, redirect=None, status=None)) after connection broken by &#x27;SSLError(SSLCertVerificationError(1, &#x27;[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1002)&#x27;))&#x27;: /simple/certifi/WARNING: Retrying (Retry(total=2, connect=None, read=None, redirect=None, status=None)) after connection broken by &#x27;SSLError(SSLCertVerificationError(1, &#x27;[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1002)&#x27;))&#x27;: /simple/certifi/WARNING: Retrying (Retry(total=1, connect=None, read=None, redirect=None, status=None)) after connection broken by &#x27;SSLError(SSLCertVerificationError(1, &#x27;[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1002)&#x27;))&#x27;: /simple/certifi/WARNING: Retrying (Retry(total=0, connect=None, read=None, redirect=None, status=None)) after connection broken by &#x27;SSLError(SSLCertVerificationError(1, &#x27;[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1002)&#x27;))&#x27;: /simple/certifi/Could not fetch URL https://pypi.org/simple/certifi/: There was a problem confirming the ssl certificate: HTTPSConnectionPool(host=&#x27;pypi.org&#x27;, port=443): Max retries exceeded with url: /simple/certifi/ (Caused by SSLError(SSLCertVerificationError(1, &#x27;[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1002)&#x27;))) - skipping -- removing any existing file or link -- creating symlink to certifi certificate bundle -- setting permissions -- update complete ä¹‹åå†è¿è¡Œpip installå‘½ä»¤ï¼Œå°±ä¸ä¼šæŠ¥é”™äº† 6.ä½¿ç”¨å…¶å®ƒé•œåƒæº è¯¥é—®é¢˜æ˜¯å› ä¸ºPypiè½¯ä»¶ä»“åº“å®˜ç½‘çš„è¯ä¹¦æ–‡ä»¶å­˜åœ¨é—®é¢˜å¯¼è‡´çš„ï¼Œåªè¦æˆ‘ä»¬ä¸ä»å®˜ç½‘ä¸‹è½½å°±ä¸ä¼šæœ‰é—®é¢˜ã€‚ åœ¨å›½å†…ä¸ºäº†åŠ é€Ÿä¸‹è½½æˆ‘ä»¬ä¸€èˆ¬ä¼šä½¿ç”¨å›½å†…çš„é•œåƒæºï¼Œä¾‹å¦‚é˜¿é‡Œäº‘çš„Pypié•œåƒæºæˆ–è€…æ¸…åå¤§å­¦çš„Pypié•œåƒæºï¼Œå…·ä½“ä½¿ç”¨æ–¹æ³•å‚è€ƒå„è‡ªçš„å®˜ç½‘è¯´æ˜å³å¯ã€‚","summary":"æ‘˜è¦ æµ‹è¯•ç¯å¢ƒï¼šmacOS 13.7.1ï¼ŒPython 3.11.3 ä»Šå¤©å°†pipå‡çº§(pip install --upgrade pip)åˆ°24.3.1ç‰ˆæœ¬åï¼Œé€šè¿‡pip installå‘½ä»¤å®‰è£…ä¾èµ–æ—¶ä¼šæŠ¥é”™ï¼Œæ¯”å¦‚ï¼š 12$ pip install certifiCould not fetch URL https://pypi.org/simple/certifi/: There was a problem confirming the ssl certificate: HTTPSConnectionPool(host=&#x27;pypi.org&#x27;, port=443): Max retries exceeded with url: /simple/certifi/ (Caused by SSLError(SSLCertVerificationError(1, &#x27;[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1002)&#x27;))) - skipping å¾ˆå¥‡æ€ªï¼Œä»pipè‡ªå·±çš„ç½‘ç«™ä¸Šä¸‹è½½ä¾èµ–éƒ½ä¼šå‡ºç°è¯ä¹¦æ— æ³•éªŒè¯çš„é”™è¯¯ã€‚æµ‹è¯•äº†ä¸€ä¸‹ï¼Œè¯¥é—®é¢˜åªåœ¨macOSä¸Šé‡åˆ°ï¼Œå…¶ä»–å¹³å°æ²¡æœ‰é‡åˆ°è¿‡ã€‚ å…ˆè¯´ç»“è®ºï¼Œæ¨èä½¿ç”¨ç¬¬äº”ç§æ–¹æ³•ã€‚","date_published":"2024-11-18T15:33:15.000Z","tags":["æŠ€æœ¯","Python"]},{"id":"https://blog.hanqunfeng.com/2024/11/12/mathjax-demo/","url":"https://blog.hanqunfeng.com/2024/11/12/mathjax-demo/","title":"Hexo NexT -- æ•°å­¦å…¬å¼","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\n-->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Hexoæ˜¯åŸºäºmarkdownçš„ï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨LaTexè¯­æ³•æ¥ç¼–å†™æ•°å­¦å…¬å¼ï¼Œåªä¸è¿‡éœ€è¦å®‰è£…ç›¸åº”çš„å…¬å¼æ¸²æŸ“æ’ä»¶æ¥å®ç°ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>Nextä¸»é¢˜ æ”¯æŒçš„å…¬å¼æ’ä»¶ä¸º<code>MathJax</code>å’Œ<code>KaTeX</code>ï¼Œå®ƒä»¬éƒ½æ”¯æŒLaTexè¯­æ³•ï¼Œå‚è€ƒ: <a href=\"https://theme-next.js.org/docs/third-party-services/math-equations\">https://theme-next.js.org/docs/third-party-services/math-equations</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä½¿ç”¨çš„æ˜¯<a href=\"https://katex.org/docs/supported\">Katex</a>ï¼ŒåŸå› æ˜¯æˆ‘å·²ç»ä½¿ç”¨äº†<a href=\"https://github.com/hexojs/hexo-renderer-markdown-it\">hexo-renderer-markdown-it</a>æ¸²æŸ“å™¨ï¼Œå…¶ä¸ mathjax çš„ <a href=\"https://github.com/hexojs/hexo-renderer-pandoc\">hexo-renderer-pandoc</a>æ¸²æŸ“å™¨ä¸èƒ½å¹¶å­˜ï¼Œæ‰€ä»¥åªèƒ½é€‰<code>Katex</code>äº†ã€‚</p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"å®‰è£…\">å®‰è£…</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¯¦ç»†çš„å®‰è£…æ–¹æ³•è¯·å‚è€ƒ:<a href=\"https://theme-next.js.org/docs/third-party-services/math-equations\">Math Equations</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>å› ä¸ºå·²ç»ä½¿ç”¨äº†<a href=\"https://github.com/hexojs/hexo-renderer-markdown-it\">hexo-renderer-markdown-it</a>æ¸²æŸ“å™¨ï¼Œæ‰€ä»¥è¿™é‡Œå°±æ²¡æœ‰ä½¿ç”¨<a href=\"https://github.com/CHENXCHEN/hexo-renderer-markdown-it-plus\">hexo-renderer-markdown-it-plus</a>æ¸²æŸ“å™¨ï¼Œå…¶å®ä¸¤è€…ä¹Ÿæ²¡æœ‰å¤ªå¤§çš„åŒºåˆ«ï¼Œåªä¸è¿‡åè€…é»˜è®¤å°±åŠ è½½äº†ä¸€äº›æ’ä»¶ï¼Œè€Œå‰è€…éœ€è¦è‡ªå·±å®‰è£…æ’ä»¶å¹¶é…ç½®æ‰å¯ä»¥ä½¿ç”¨ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä½†æ˜¯æµ‹è¯•æ—¶å‘ç°ï¼ŒæŒ‰ç…§å®˜ç½‘çš„é…ç½®<code>hexo-renderer-markdown-it</code> + <code>markdown-it-katex</code> çš„æ–¹å¼å¹¶ä¸èƒ½å¾ˆå¥½çš„è¿›è¡Œå…¬å¼çš„æ¸²æŸ“ï¼Œæ‰€ä»¥è¿™é‡Œå‚è€ƒäº† <code>hexo-renderer-markdown-it-plus</code> æ¸²æŸ“å™¨ï¼Œå°†å…¶æ›´æ¢ä¸º<a href=\"https://github.com/iktakahiro/markdown-it-katex#readme\">@iktakahiro/markdown-it-katex</a>ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install @iktakahiro/markdown-it-katex --save</span><br></pre></td></tr></table></figure>\n<p>åœ¨<code>_config.yml</code>é…ç½®ä¸Šè¯¥æ’ä»¶</p>\n<figure class=\"highlight yml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># config of hexo-renderer-markdown-it</span></span><br><span class=\"line\"><span class=\"attr\">markdown:</span></span><br><span class=\"line\">  <span class=\"attr\">render:</span></span><br><span class=\"line\">    <span class=\"attr\">html:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">    <span class=\"attr\">xhtmlOut:</span> <span class=\"literal\">false</span></span><br><span class=\"line\">    <span class=\"attr\">breaks:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">    <span class=\"attr\">linkify:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">    <span class=\"attr\">typographer:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">    <span class=\"attr\">quotes:</span> <span class=\"string\">&#x27;â€œâ€â€˜â€™&#x27;</span></span><br><span class=\"line\">  <span class=\"attr\">plugins:</span></span><br><span class=\"line\">    <span class=\"comment\"># katexå…¬å¼</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">&quot;@iktakahiro/markdown-it-katex&quot;</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"å®‰è£…åé‡åˆ°çš„é—®é¢˜\">å®‰è£…åé‡åˆ°çš„é—®é¢˜</h2>\n<h3 id=\"1-å®‰è£…åå‘ç°é€šè¿‡hexoç¼–è¯‘æ—¶ä¼šæŠ¥ç±»ä¼¼å¦‚ä¸‹è­¦å‘Š\">1.å®‰è£…åå‘ç°é€šè¿‡hexoç¼–è¯‘æ—¶ä¼šæŠ¥ç±»ä¼¼å¦‚ä¸‹è­¦å‘Š</h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">LaTeX-incompatible input and strict mode is set to &#x27;warn&#x27;: Unicode text character &quot;å³&quot; used in math mode [unicodeTextInMathMode]</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åŸå› æ˜¯<code>@iktakahiro/markdown-it-katex</code>æ’ä»¶é»˜è®¤å¼€å¯çš„æ˜¯ä¸¥æ ¼æ¨¡å¼ï¼Œä¸èƒ½åœ¨<code>$$...$$</code>æˆ–<code>$...$</code>ä¸­åŒ…å«ä¸­æ–‡ï¼Œè™½ç„¶æˆ‘è®¾ç½®çš„æ˜¯<code>math -- every_page: false</code>ï¼Œä½†å…¶åœ¨ç¼–è¯‘é˜¶æ®µä¾æ—§ä¼šæ£€æŸ¥æ‰€æœ‰çš„é¡µé¢ï¼Œä¸è¿‡æŠ¥è¿™ä¸ªè­¦å‘Šå¹¶ä¸ä¼šæœ‰ä»€ä¹ˆå½±å“ï¼Œæ‰€ä»¥å¯ä»¥å¿½ç•¥ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å¦‚æœä¸å¸Œæœ›çœ‹åˆ°è¿™ä¸ªè­¦å‘Šï¼Œå¯ä»¥ä¸º <code>@iktakahiro/markdown-it-katex</code> æ·»åŠ æ¨¡å¼çš„æ§åˆ¶è¡Œä¸º</p>\n</li>\n</ul>\n<figure class=\"highlight yml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># config of hexo-renderer-markdown-it</span></span><br><span class=\"line\"><span class=\"attr\">markdown:</span></span><br><span class=\"line\">  <span class=\"attr\">render:</span></span><br><span class=\"line\">    <span class=\"attr\">html:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">    <span class=\"attr\">xhtmlOut:</span> <span class=\"literal\">false</span></span><br><span class=\"line\">    <span class=\"attr\">breaks:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">    <span class=\"attr\">linkify:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">    <span class=\"attr\">typographer:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">    <span class=\"attr\">quotes:</span> <span class=\"string\">&#x27;â€œâ€â€˜â€™&#x27;</span></span><br><span class=\"line\">  <span class=\"attr\">plugins:</span></span><br><span class=\"line\">    <span class=\"comment\"># katexå…¬å¼</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">&quot;@iktakahiro/markdown-it-katex&quot;</span></span><br><span class=\"line\">      <span class=\"attr\">options:</span></span><br><span class=\"line\">         <span class=\"attr\">strict:</span> <span class=\"string\">error</span> <span class=\"comment\"># é»˜è®¤ä¸ºwarnï¼Œè¿™é‡Œè®¾ç½®ä¸ºerrorï¼Œåªæœ‰å½“è§£æå™¨é‡åˆ°ä¸æ”¯æŒçš„å…¬å¼æ—¶æ‰æŠ¥é”™ï¼Œä¹Ÿå¯ä»¥è®¾ç½®ä¸º falseï¼Œè¡¨ç¤ºä¸æ£€æŸ¥</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"ä¸æ”¯æŒKatexçš„Auto-render-Extension\">ä¸æ”¯æŒ<code>Katex</code>çš„<code>Auto-render Extension</code></h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>é€šè¿‡æŸ¥çœ‹<code>Katex</code>å®˜ç½‘å¯ä»¥çŸ¥é“ï¼Œå¼€å¯<a href=\"https://katex.org/docs/autorender\">Auto-render Extension</a>åï¼Œ<code>Katex</code>å¯ä»¥æ¸²æŸ“æ›´å¤šçš„å…¬å¼è¯­æ³•ï¼Œä½†è¦æ³¨æ„è¿™å¹¶ä¸æ˜¯<code>LaTex</code>çš„æ ‡å‡†è¯­æ³•</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä½†æ˜¯<code>@iktakahiro/markdown-it-katex</code>ä¸­å¹¶æ²¡æœ‰ç›¸åº”çš„é…ç½®ï¼Œä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œç®€å•çš„æ–¹æ³•å°±æ˜¯å°†æ‰€éœ€è¦çš„èµ„æºæ·»åŠ åˆ°é¡µé¢ä¸­ï¼Œæ¯”å¦‚æˆ‘åœ¨<code>source\\_data\\post-body-start.njk</code>ä¸­æ·»åŠ äº†å¦‚ä¸‹å†…å®¹</p>\n</li>\n</ul>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;%- if page.mathjax %&#125;</span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">link</span> <span class=\"attr\">rel</span>=<span class=\"string\">&quot;stylesheet&quot;</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css&quot;</span> <span class=\"attr\">integrity</span>=<span class=\"string\">&quot;sha384-nB0miv6/jRmo5UMMR1wu3Gz6NLsoTkbqJghGIsx//Rlm+ZU03BU6SQNC66uf4l5+&quot;</span> <span class=\"attr\">crossorigin</span>=<span class=\"string\">&quot;anonymous&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">defer</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js&quot;</span> <span class=\"attr\">integrity</span>=<span class=\"string\">&quot;sha384-7zkQWkzuo3B5mTepMUcHkMB5jZaolc2xDwL6VFqjFALcbeS9Ggm/Yr2r3Dy4lfFg&quot;</span> <span class=\"attr\">crossorigin</span>=<span class=\"string\">&quot;anonymous&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">defer</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js&quot;</span> <span class=\"attr\">integrity</span>=<span class=\"string\">&quot;sha384-43gviWU0YVjaDtb/GhzOouOXtZMP/7XUzwPTstBeZFe/+rCMvRwr4yROQP43s0Xk&quot;</span> <span class=\"attr\">crossorigin</span>=<span class=\"string\">&quot;anonymous&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"variable language_\">document</span>.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&quot;DOMContentLoaded&quot;</span>, <span class=\"keyword\">function</span>(<span class=\"params\"></span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">        <span class=\"title function_\">renderMathInElement</span>(<span class=\"variable language_\">document</span>.<span class=\"property\">body</span>, &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">          <span class=\"comment\">// customised options</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">          <span class=\"comment\">// â€¢ auto-render specific keys, e.g.:</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">          <span class=\"attr\">delimiters</span>: [</span></span><br><span class=\"line\"><span class=\"language-javascript\">            &#123;<span class=\"attr\">left</span>: <span class=\"string\">&quot;$$&quot;</span>, <span class=\"attr\">right</span>: <span class=\"string\">&quot;$$&quot;</span>, <span class=\"attr\">display</span>: <span class=\"literal\">true</span>&#125;,</span></span><br><span class=\"line\"><span class=\"language-javascript\">            &#123;<span class=\"attr\">left</span>: <span class=\"string\">&quot;\\\\(&quot;</span>, <span class=\"attr\">right</span>: <span class=\"string\">&quot;\\\\)&quot;</span>, <span class=\"attr\">display</span>: <span class=\"literal\">false</span>&#125;,</span></span><br><span class=\"line\"><span class=\"language-javascript\">            &#123;<span class=\"attr\">left</span>: <span class=\"string\">&quot;\\\\begin&#123;equation&#125;&quot;</span>, <span class=\"attr\">right</span>: <span class=\"string\">&quot;\\\\end&#123;equation&#125;&quot;</span>, <span class=\"attr\">display</span>: <span class=\"literal\">true</span>&#125;,</span></span><br><span class=\"line\"><span class=\"language-javascript\">            &#123;<span class=\"attr\">left</span>: <span class=\"string\">&quot;\\\\begin&#123;align&#125;&quot;</span>, <span class=\"attr\">right</span>: <span class=\"string\">&quot;\\\\end&#123;align&#125;&quot;</span>, <span class=\"attr\">display</span>: <span class=\"literal\">true</span>&#125;,</span></span><br><span class=\"line\"><span class=\"language-javascript\">            &#123;<span class=\"attr\">left</span>: <span class=\"string\">&quot;\\\\begin&#123;alignat&#125;&quot;</span>, <span class=\"attr\">right</span>: <span class=\"string\">&quot;\\\\end&#123;alignat&#125;&quot;</span>, <span class=\"attr\">display</span>: <span class=\"literal\">true</span>&#125;,</span></span><br><span class=\"line\"><span class=\"language-javascript\">            &#123;<span class=\"attr\">left</span>: <span class=\"string\">&quot;\\\\begin&#123;gather&#125;&quot;</span>, <span class=\"attr\">right</span>: <span class=\"string\">&quot;\\\\end&#123;gather&#125;&quot;</span>, <span class=\"attr\">display</span>: <span class=\"literal\">true</span>&#125;,</span></span><br><span class=\"line\"><span class=\"language-javascript\">            &#123;<span class=\"attr\">left</span>: <span class=\"string\">&quot;\\\\begin&#123;CD&#125;&quot;</span>, <span class=\"attr\">right</span>: <span class=\"string\">&quot;\\\\end&#123;CD&#125;&quot;</span>, <span class=\"attr\">display</span>: <span class=\"literal\">true</span>&#125;,</span></span><br><span class=\"line\"><span class=\"language-javascript\">            &#123;<span class=\"attr\">left</span>: <span class=\"string\">&quot;\\\\[&quot;</span>, <span class=\"attr\">right</span>: <span class=\"string\">&quot;\\\\]&quot;</span>, <span class=\"attr\">display</span>: <span class=\"literal\">true</span>&#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\">            ],</span></span><br><span class=\"line\"><span class=\"language-javascript\">          <span class=\"comment\">// â€¢ rendering keys, e.g.:</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">          throwOnError : <span class=\"literal\">false</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">        &#125;);</span></span><br><span class=\"line\"><span class=\"language-javascript\">    &#125;);</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\">&#123;%- endif %&#125;</span><br></pre></td></tr></table></figure>\n<div class=\"tips\">\n<p><em><strong>å°è´´å£«</strong></em><br>\nå¯ä»¥é€šè¿‡nextæ¨¡æ¿çš„<code>_config.yml</code>ä¸­çš„<code>custom_file_path</code>é…ç½®é¡¹æ¥è‡ªå®šä¹‰æ¸²æŸ“é¡µé¢çš„æŸä¸ªéƒ¨åˆ†ï¼Œè¿™æ ·å¯¹åº”çš„æ¯ä¸ªé¡µé¢éƒ½ä¼šåŠ ä¸Šè¯¥æ¨¡æ¿å†…å®¹</p>\n<figure class=\"highlight yml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">custom_file_path:</span></span><br><span class=\"line\">  <span class=\"attr\">postBodyStart:</span> <span class=\"string\">source/_data/post-body-start.njk</span></span><br></pre></td></tr></table></figure>\n</div>\n<hr>\n<div class=\"warning\">\n<ul class=\"lvl-1\">\n<li class=\"lvl-2\">\n<p>ä½¿ç”¨<code>hexo-renderer-markdown-it-plus</code>æ¸²æŸ“å™¨æ—¶ï¼Œå¦‚æœä¿®æ”¹äº†é¡µé¢çš„å†…å®¹ï¼Œæ­¤æ—¶åˆ·æ–°é¡µé¢ï¼Œä¼šå‘ç°é¡µé¢ä¸­çš„å…¬å¼ä¸èƒ½è¢«æ¸²æŸ“äº†ï¼Œåªèƒ½é‡æ–°å¯åŠ¨hexoæœåŠ¡ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä½†æ˜¯ä½¿ç”¨<code>hexo-renderer-markdown-it</code>æ¸²æŸ“å™¨æ—¶ï¼Œåˆ·æ–°é¡µé¢åå…¬å¼å°±å¯ä»¥è¢«æ¸²æŸ“äº†ã€‚</p>\n</li>\n</ul>\n</div>\n<hr>\n<h2 id=\"ä½¿ç”¨\">ä½¿ç”¨</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ¯ä¸ªé¡µé¢çš„<code>front-matter</code>ä¸­è¦æ·»åŠ <code>mathjax: true</code>ï¼Œè¿™æ ·åœ¨é¡µé¢ä¸­å°±å¯ä»¥ä½¿ç”¨å…¬å¼äº†ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><code>Katex</code>å…¬å¼çš„æ¸²æŸ“æ–¹å¼æ”¯æŒ<code>$...$</code>å’Œ<code>$$...$$</code>ä¸¤ç§æ–¹å¼</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-5\"><code>$...$</code>ä¸ºè¡Œçº§å…¬å¼</li>\n</ul>\n <figure class=\"highlight latex\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">$</span>sin(<span class=\"keyword\">\\omega</span> t)=<span class=\"keyword\">\\frac</span>&#123;1&#125;&#123;2j&#125;(e<span class=\"built_in\">^</span>&#123;j<span class=\"keyword\">\\omega</span> t&#125;-e<span class=\"built_in\">^</span>&#123;-j<span class=\"keyword\">\\omega</span> t&#125;)<span class=\"built_in\">$</span></span><br></pre></td></tr></table></figure>\n<p><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>s</mi><mi>i</mi><mi>n</mi><mo stretchy=\"false\">(</mo><mi>Ï‰</mi><mi>t</mi><mo stretchy=\"false\">)</mo><mo>=</mo><mfrac><mn>1</mn><mrow><mn>2</mn><mi>j</mi></mrow></mfrac><mo stretchy=\"false\">(</mo><msup><mi>e</mi><mrow><mi>j</mi><mi>Ï‰</mi><mi>t</mi></mrow></msup><mo>âˆ’</mo><msup><mi>e</mi><mrow><mo>âˆ’</mo><mi>j</mi><mi>Ï‰</mi><mi>t</mi></mrow></msup><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">sin(\\omega t)=\\frac{1}{2j}(e^{j\\omega t}-e^{-j\\omega t})</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">s</span><span class=\"mord mathnormal\">i</span><span class=\"mord mathnormal\">n</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">Ï‰</span><span class=\"mord mathnormal\">t</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.326216em;vertical-align:-0.481108em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.845108em;\"><span style=\"top:-2.6550000000000002em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">2</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j</span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.394em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.481108em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\">e</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.824664em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">Ï‰</span><span class=\"mord mathnormal mtight\">t</span></span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">âˆ’</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.0746639999999998em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">e</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.824664em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">âˆ’</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">Ï‰</span><span class=\"mord mathnormal mtight\">t</span></span></span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span></span></p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-5\"><code>$$...$$</code>ä¸ºå—çº§å…¬å¼ï¼Œç‹¬å ä¸€è¡Œä¸”å±…ä¸­å±•ç¤º</li>\n</ul>\n <figure class=\"highlight latex\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">$</span><span class=\"built_in\">$</span></span><br><span class=\"line\">sin(<span class=\"keyword\">\\omega</span> t)=<span class=\"keyword\">\\frac</span>&#123;1&#125;&#123;2j&#125;(e<span class=\"built_in\">^</span>&#123;j<span class=\"keyword\">\\omega</span> t&#125;-e<span class=\"built_in\">^</span>&#123;-j<span class=\"keyword\">\\omega</span> t&#125;)</span><br><span class=\"line\"><span class=\"built_in\">$</span><span class=\"built_in\">$</span></span><br></pre></td></tr></table></figure>\n<p class='katex-block'><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>s</mi><mi>i</mi><mi>n</mi><mo stretchy=\"false\">(</mo><mi>Ï‰</mi><mi>t</mi><mo stretchy=\"false\">)</mo><mo>=</mo><mfrac><mn>1</mn><mrow><mn>2</mn><mi>j</mi></mrow></mfrac><mo stretchy=\"false\">(</mo><msup><mi>e</mi><mrow><mi>j</mi><mi>Ï‰</mi><mi>t</mi></mrow></msup><mo>âˆ’</mo><msup><mi>e</mi><mrow><mo>âˆ’</mo><mi>j</mi><mi>Ï‰</mi><mi>t</mi></mrow></msup><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">sin(\\omega t)=\\frac{1}{2j}(e^{j\\omega t}-e^{-j\\omega t})\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">s</span><span class=\"mord mathnormal\">i</span><span class=\"mord mathnormal\">n</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">Ï‰</span><span class=\"mord mathnormal\">t</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:2.20188em;vertical-align:-0.8804400000000001em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.32144em;\"><span style=\"top:-2.314em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">2</span><span class=\"mord mathnormal\" style=\"margin-right:0.05724em;\">j</span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">1</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8804400000000001em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\">e</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.874664em;\"><span style=\"top:-3.1130000000000004em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">Ï‰</span><span class=\"mord mathnormal mtight\">t</span></span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">âˆ’</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.124664em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">e</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.874664em;\"><span style=\"top:-3.1130000000000004em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">âˆ’</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">Ï‰</span><span class=\"mord mathnormal mtight\">t</span></span></span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span></span></span></p>\n</li>\n<li class=\"lvl-2\">\n<p><code>$$...$$</code>å’Œ<code>$...$</code>ä¸­ä¸èƒ½å‡ºç°Unicodeå­—ç¬¦ï¼Œå¦åˆ™ä¼šæŠ¥é”™ï¼Œå³ä¸æ”¯æŒä¸­æ–‡ï¼Œå¦‚æœéœ€è¦æ˜¾ç¤ºä¸­æ–‡ï¼Œåˆ™éœ€è¦ä½¿ç”¨<code>\\text&#123;ä¸­æ–‡&#125;</code></p>\n</li>\n<li class=\"lvl-2\">\n<p>å—çº§å…¬å¼ï¼Œåœ¨å¼€å¤´çš„<code>$$</code>ä¹‹å‰å’Œç»“å°¾çš„<code>$$</code>ä¹‹åï¼Œä¸å¾—æœ‰ä»»ä½•å­—ç¬¦ï¼ˆç©ºæ ¼é™¤å¤–ï¼‰</p>\n</li>\n<li class=\"lvl-2\">\n<p>è¡Œçº§å…¬å¼ï¼Œåœ¨å¼€å¤´çš„<code>$</code>ä¹‹åå’Œç»“å°¾çš„<code>$</code>ä¹‹å‰ï¼Œä¸å¾—æœ‰ç©ºæ ¼</p>\n</li>\n</ul>\n<h2 id=\"ç¤ºä¾‹\">ç¤ºä¾‹</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä½¿ç”¨æ–¹å¼å¯ä»¥å‚è€ƒ <a href=\"https://katex.org/docs/supported\">KaTeXå…¬å¼ç¬¦å·</a> ä»¥åŠ <a href=\"https://zh.wikipedia.org/wiki/Help:%E6%95%B0%E5%AD%A6%E5%85%AC%E5%BC%8F\">ç»´åŸºç™¾ç§‘ï¼šLaTeXå…¬å¼æ‰‹å†Œ</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>ä¸è¿‡è®°ä½è¿™äº›å…¬å¼ç¬¦å·è¿˜æ˜¯æ¯”è¾ƒå›°éš¾çš„ï¼Œè¿™é‡Œæ¨èä¸¤ä¸ªå·¥å…·</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-5\"><a href=\"https://webdemo.myscript.com/views/math/index.html\">MyScript</a>: æ‰‹å†™è½¬LaTeXå…¬å¼ï¼Œç›´æ¥å°†ä½ éœ€è¦çš„æ•°å­¦å…¬å¼ç”»å‡ºæ¥ï¼Œå®ƒä¼šè‡ªåŠ¨å°†å…¶è½¬æ¢ä¸ºLaTeXå…¬å¼ï¼Œç„¶åå¤åˆ¶å³å¯</li>\n<li class=\"lvl-5\"><a href=\"https://www.latexlive.com/home\">LaTeXå…¬å¼ç¼–è¾‘å™¨</a>: æä¾›å…¬å¼æ¨¡æ¿ã€å›¾ç‰‡è¯†åˆ«(æœ‰æ¬¡æ•°é™åˆ¶)ç­‰åŠŸèƒ½ï¼Œå¹¶ä¸”æ”¯æŒè¾“å‡ºå„ç§æ ¼å¼ã€‚</li>\n<li class=\"lvl-5\"><a href=\"https://simpletex.cn/ai/latex_ocr\">Simpletex</a>: æ”¯æŒLaTexå…¬å¼å›¾ç‰‡è¯†åˆ«å’Œæ‰‹å†™è½¬å…¬å¼ï¼Œä¸”æ— æ¬¡æ•°é™åˆ¶ï¼Œä½†æ˜¯éœ€è¦æ³¨å†Œè´¦å·ã€‚åŒæ—¶ä¹Ÿæä¾›äº†å®¢æˆ·ç«¯ç‰ˆæœ¬ã€‚</li>\n</ul>\n</li>\n</ul>\n<hr>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¿™é‡Œéšä¾¿ç»™å‡ ä¸ªç¤ºä¾‹ï¼Œä»¥ä¸‹æ˜¯<code>LaTeX</code>çš„æ ‡å‡†è¯­æ³•</p>\n</li>\n</ul>\n<hr>\n<figure class=\"highlight latex\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">$</span><span class=\"built_in\">$</span></span><br><span class=\"line\"><span class=\"keyword\">\\left</span>(<span class=\"keyword\">\\beta</span> m c<span class=\"built_in\">^</span>2 + c <span class=\"keyword\">\\left</span>(<span class=\"keyword\">\\sum</span><span class=\"built_in\">_</span>&#123;n=1&#125;<span class=\"built_in\">^</span>3<span class=\"keyword\">\\alpha</span><span class=\"built_in\">_</span>n p<span class=\"built_in\">_</span>n<span class=\"keyword\">\\right</span>)<span class=\"keyword\">\\right</span>) <span class=\"keyword\">\\psi</span>(x,t)</span><br><span class=\"line\">= i<span class=\"keyword\">\\hbar</span> <span class=\"keyword\">\\frac</span>&#123;<span class=\"keyword\">\\partial</span> <span class=\"keyword\">\\psi</span>(x,t)&#125;&#123;<span class=\"keyword\">\\partial</span> t&#125;</span><br><span class=\"line\"><span class=\"built_in\">$</span><span class=\"built_in\">$</span></span><br></pre></td></tr></table></figure>\n<p class='katex-block'><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mrow><mo fence=\"true\">(</mo><mi>Î²</mi><mi>m</mi><msup><mi>c</mi><mn>2</mn></msup><mo>+</mo><mi>c</mi><mrow><mo fence=\"true\">(</mo><munderover><mo>âˆ‘</mo><mrow><mi>n</mi><mo>=</mo><mn>1</mn></mrow><mn>3</mn></munderover><msub><mi>Î±</mi><mi>n</mi></msub><msub><mi>p</mi><mi>n</mi></msub><mo fence=\"true\">)</mo></mrow><mo fence=\"true\">)</mo></mrow><mi>Ïˆ</mi><mo stretchy=\"false\">(</mo><mi>x</mi><mo separator=\"true\">,</mo><mi>t</mi><mo stretchy=\"false\">)</mo><mo>=</mo><mi>i</mi><mi mathvariant=\"normal\">â„</mi><mfrac><mrow><mi mathvariant=\"normal\">âˆ‚</mi><mi>Ïˆ</mi><mo stretchy=\"false\">(</mo><mi>x</mi><mo separator=\"true\">,</mo><mi>t</mi><mo stretchy=\"false\">)</mo></mrow><mrow><mi mathvariant=\"normal\">âˆ‚</mi><mi>t</mi></mrow></mfrac></mrow><annotation encoding=\"application/x-tex\">\\left(\\beta m c^2 + c \\left(\\sum_{n=1}^3\\alpha_n p_n\\right)\\right) \\psi(x,t)\n= i\\hbar \\frac{\\partial \\psi(x,t)}{\\partial t}\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:3.068226em;vertical-align:-1.267113em;\"></span><span class=\"minner\"><span class=\"mopen delimcenter\" style=\"top:0em;\"><span class=\"delimsizing size4\">(</span></span><span class=\"mord mathnormal\" style=\"margin-right:0.05278em;\">Î²</span><span class=\"mord mathnormal\">m</span><span class=\"mord\"><span class=\"mord mathnormal\">c</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8641079999999999em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord mathnormal\">c</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"minner\"><span class=\"mopen delimcenter\" style=\"top:0em;\"><span class=\"delimsizing size4\">(</span></span><span class=\"mop op-limits\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.8011130000000004em;\"><span style=\"top:-1.882887em;margin-left:0em;\"><span class=\"pstrut\" style=\"height:3.05em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">n</span><span class=\"mrel mtight\">=</span><span class=\"mord mtight\">1</span></span></span></span><span style=\"top:-3.050005em;\"><span class=\"pstrut\" style=\"height:3.05em;\"></span><span><span class=\"mop op-symbol large-op\">âˆ‘</span></span></span><span style=\"top:-4.3000050000000005em;margin-left:0em;\"><span class=\"pstrut\" style=\"height:3.05em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">3</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.267113em;\"><span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.0037em;\">Î±</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.0037em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">n</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord mathnormal\">p</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">n</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose delimcenter\" style=\"top:0em;\"><span class=\"delimsizing size4\">)</span></span></span><span class=\"mclose delimcenter\" style=\"top:0em;\"><span class=\"delimsizing size4\">)</span></span></span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">Ïˆ</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathnormal\">t</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:2.113em;vertical-align:-0.686em;\"></span><span class=\"mord mathnormal\">i</span><span class=\"mord\">â„</span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.427em;\"><span style=\"top:-2.314em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\" style=\"margin-right:0.05556em;\">âˆ‚</span><span class=\"mord mathnormal\">t</span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\" style=\"margin-right:0.05556em;\">âˆ‚</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">Ïˆ</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathnormal\">t</span><span class=\"mclose\">)</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.686em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span></span></span></p>\n<hr>\n<figure class=\"highlight latex\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Aha! <span class=\"built_in\">$</span>E = mc<span class=\"built_in\">^</span>&#123;2&#125;<span class=\"built_in\">$</span>.</span><br></pre></td></tr></table></figure>\n<p>Aha! <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>E</mi><mo>=</mo><mi>m</mi><msup><mi>c</mi><mn>2</mn></msup></mrow><annotation encoding=\"application/x-tex\">E = mc^{2}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">E</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">m</span><span class=\"mord\"><span class=\"mord mathnormal\">c</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span></span></span></span></span>.</p>\n<hr>\n<figure class=\"highlight latex\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">$</span><span class=\"built_in\">$</span></span><br><span class=\"line\"><span class=\"keyword\">\\left</span>(<span class=\"keyword\">\\LARGE</span>&#123;AB&#125;<span class=\"keyword\">\\right</span>)</span><br><span class=\"line\"><span class=\"built_in\">$</span><span class=\"built_in\">$</span></span><br></pre></td></tr></table></figure>\n<p class='katex-block'><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mo fence=\"true\">(</mo><mstyle mathsize=\"1.728em\"><mrow><mi>A</mi><mi>B</mi></mrow></mstyle><mo fence=\"true\">)</mo></mrow><annotation encoding=\"application/x-tex\">\\left(\\LARGE{AB}\\right)\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.83081424em;vertical-align:-0.65002em;\"></span><span class=\"minner\"><span class=\"mopen delimcenter\" style=\"top:0em;\"><span class=\"delimsizing size2\">(</span></span><span class=\"mord sizing reset-size6 size9\"><span class=\"mord mathnormal\">A</span><span class=\"mord mathnormal\" style=\"margin-right:0.05017em;\">B</span></span><span class=\"mclose delimcenter\" style=\"top:0em;\"><span class=\"delimsizing size2\">)</span></span></span></span></span></span></span></p>\n<hr>\n<figure class=\"highlight latex\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">$</span><span class=\"built_in\">$</span></span><br><span class=\"line\"><span class=\"keyword\">\\begin</span>&#123;matrix&#125;</span><br><span class=\"line\">   a <span class=\"built_in\">&amp;</span> b <span class=\"keyword\">\\\\</span></span><br><span class=\"line\">   c <span class=\"built_in\">&amp;</span> d</span><br><span class=\"line\"><span class=\"keyword\">\\end</span>&#123;matrix&#125;</span><br><span class=\"line\"><span class=\"built_in\">$</span><span class=\"built_in\">$</span></span><br></pre></td></tr></table></figure>\n<p class='katex-block'><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mtable rowspacing=\"0.15999999999999992em\" columnspacing=\"1em\"><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mi>a</mi></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mi>b</mi></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mi>c</mi></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mi>d</mi></mstyle></mtd></mtr></mtable><annotation encoding=\"application/x-tex\">\\begin{matrix}\n   a &amp; b \\\\\n   c &amp; d\n\\end{matrix}\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:2.4000000000000004em;vertical-align:-0.9500000000000004em;\"></span><span class=\"mord\"><span class=\"mtable\"><span class=\"col-align-c\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.45em;\"><span style=\"top:-3.61em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span></span></span><span style=\"top:-2.4099999999999997em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">c</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.9500000000000004em;\"><span></span></span></span></span></span><span class=\"arraycolsep\" style=\"width:0.5em;\"></span><span class=\"arraycolsep\" style=\"width:0.5em;\"></span><span class=\"col-align-c\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.45em;\"><span style=\"top:-3.61em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">b</span></span></span><span style=\"top:-2.4099999999999997em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">d</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.9500000000000004em;\"><span></span></span></span></span></span></span></span></span></span></span></span></p>\n<hr>\n<figure class=\"highlight latex\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">$</span><span class=\"built_in\">$</span></span><br><span class=\"line\"><span class=\"keyword\">\\def</span><span class=\"keyword\">\\arraystretch</span>&#123;1.5&#125;</span><br><span class=\"line\">   <span class=\"keyword\">\\begin</span>&#123;array&#125;&#123;c:c:c&#125;</span><br><span class=\"line\">   a <span class=\"built_in\">&amp;</span> b <span class=\"built_in\">&amp;</span> c <span class=\"keyword\">\\\\</span> <span class=\"keyword\">\\hline</span></span><br><span class=\"line\">   d <span class=\"built_in\">&amp;</span> e <span class=\"built_in\">&amp;</span> f <span class=\"keyword\">\\\\</span></span><br><span class=\"line\">   <span class=\"keyword\">\\hdashline</span></span><br><span class=\"line\">   g <span class=\"built_in\">&amp;</span> h <span class=\"built_in\">&amp;</span> i</span><br><span class=\"line\"><span class=\"keyword\">\\end</span>&#123;array&#125;</span><br><span class=\"line\"><span class=\"built_in\">$</span><span class=\"built_in\">$</span></span><br></pre></td></tr></table></figure>\n<p class='katex-block'><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mtable rowspacing=\"0.6599999999999999em\" columnalign=\"center center center\" columnlines=\"dashed dashed\" columnspacing=\"1em\" rowlines=\"solid dashed\"><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mi>a</mi></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mi>b</mi></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mi>c</mi></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mi>d</mi></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mi>e</mi></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mi>f</mi></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mi>g</mi></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mi>h</mi></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mi>i</mi></mstyle></mtd></mtr></mtable><annotation encoding=\"application/x-tex\">\\def\\arraystretch{1.5}\n   \\begin{array}{c:c:c}\n   a &amp; b &amp; c \\\\ \\hline\n   d &amp; e &amp; f \\\\\n   \\hdashline\n   g &amp; h &amp; i\n\\end{array}\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:5.4em;vertical-align:-2.45em;\"></span><span class=\"mord\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:2.95em;\"><span style=\"top:-4.95em;\"><span class=\"pstrut\" style=\"height:4.95em;\"></span><span class=\"mtable\"><span class=\"arraycolsep\" style=\"width:0.5em;\"></span><span class=\"col-align-c\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:2.95em;\"><span style=\"top:-4.95em;\"><span class=\"pstrut\" style=\"height:3.26em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span></span></span><span style=\"top:-3.15em;\"><span class=\"pstrut\" style=\"height:3.26em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">d</span></span></span><span style=\"top:-1.3499999999999996em;\"><span class=\"pstrut\" style=\"height:3.26em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:2.45em;\"><span></span></span></span></span></span><span class=\"arraycolsep\" style=\"width:0.5em;\"></span><span class=\"vertical-separator\" style=\"height:5.4em;border-right-width:0.04em;border-right-style:dashed;margin:0 -0.02em;vertical-align:-2.45em;\"></span><span class=\"arraycolsep\" style=\"width:0.5em;\"></span><span class=\"col-align-c\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:2.95em;\"><span style=\"top:-4.95em;\"><span class=\"pstrut\" style=\"height:3.26em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">b</span></span></span><span style=\"top:-3.15em;\"><span class=\"pstrut\" style=\"height:3.26em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">e</span></span></span><span style=\"top:-1.3499999999999996em;\"><span class=\"pstrut\" style=\"height:3.26em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">h</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:2.45em;\"><span></span></span></span></span></span><span class=\"arraycolsep\" style=\"width:0.5em;\"></span><span class=\"vertical-separator\" style=\"height:5.4em;border-right-width:0.04em;border-right-style:dashed;margin:0 -0.02em;vertical-align:-2.45em;\"></span><span class=\"arraycolsep\" style=\"width:0.5em;\"></span><span class=\"col-align-c\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:2.95em;\"><span style=\"top:-4.95em;\"><span class=\"pstrut\" style=\"height:3.26em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">c</span></span></span><span style=\"top:-3.15em;\"><span class=\"pstrut\" style=\"height:3.26em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span></span></span><span style=\"top:-1.3499999999999996em;\"><span class=\"pstrut\" style=\"height:3.26em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">i</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:2.45em;\"><span></span></span></span></span></span><span class=\"arraycolsep\" style=\"width:0.5em;\"></span></span></span><span style=\"top:-4.300000000000001em;\"><span class=\"pstrut\" style=\"height:4.95em;\"></span><span class=\"hdashline\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-6.1000000000000005em;\"><span class=\"pstrut\" style=\"height:4.95em;\"></span><span class=\"hline\" style=\"border-bottom-width:0.04em;\"></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:2.45em;\"><span></span></span></span></span></span></span></span></span></span></p>\n<hr>\n<figure class=\"highlight latex\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">$</span><span class=\"keyword\">\\tilde</span>&#123;a&#125;<span class=\"built_in\">$</span>  <span class=\"built_in\">&amp;</span>nbsp;<span class=\"built_in\">&amp;</span>nbsp; <span class=\"built_in\">&amp;</span>nbsp; <span class=\"built_in\">&amp;</span>nbsp; <span class=\"built_in\">&amp;</span>nbsp; <span class=\"built_in\">$</span><span class=\"keyword\">\\underrightarrow</span>&#123;AB&#125;<span class=\"built_in\">$</span></span><br></pre></td></tr></table></figure>\n<p><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mover accent=\"true\"><mi>a</mi><mo>~</mo></mover></mrow><annotation encoding=\"application/x-tex\">\\tilde{a}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6678599999999999em;vertical-align:0em;\"></span><span class=\"mord accent\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.6678599999999999em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span></span></span><span style=\"top:-3.35em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"accent-body\" style=\"left:-0.25em;\"><span class=\"mord\">~</span></span></span></span></span></span></span></span></span></span>  Â Â  Â  Â  Â  <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><munder accentunder=\"true\"><mrow><mi>A</mi><mi>B</mi></mrow><mo stretchy=\"true\">â†’</mo></munder></mrow><annotation encoding=\"application/x-tex\">\\underrightarrow{AB}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.20533em;vertical-align:-0.522em;\"></span><span class=\"mord accentunder\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.68333em;\"><span class=\"svg-align\" style=\"top:-2.4779999999999998em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"hide-tail\" style=\"height:0.522em;min-width:0.888em;\"><svg width='400em' height='0.522em' viewBox='0 0 400000 522' preserveAspectRatio='xMaxYMin slice'><path d='M0 241v40h399891c-47.3 35.3-84 78-110 128\n-16.7 32-27.7 63.7-33 95 0 1.3-.2 2.7-.5 4-.3 1.3-.5 2.3-.5 3 0 7.3 6.7 11 20\n 11 8 0 13.2-.8 15.5-2.5 2.3-1.7 4.2-5.5 5.5-11.5 2-13.3 5.7-27 11-41 14.7-44.7\n 39-84.5 73-119.5s73.7-60.2 119-75.5c6-2 9-5.7 9-11s-3-9-9-11c-45.3-15.3-85\n-40.5-119-75.5s-58.3-74.8-73-119.5c-4.7-14-8.3-27.3-11-40-1.3-6.7-3.2-10.8-5.5\n-12.5-2.3-1.7-7.5-2.5-15.5-2.5-14 0-21 3.7-21 11 0 2 2 10.3 6 25 20.7 83.3 67\n 151.7 139 205zm0 0v40h399900v-40z'/></svg></span></span><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">A</span><span class=\"mord mathnormal\" style=\"margin-right:0.05017em;\">B</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.522em;\"><span></span></span></span></span></span></span></span></span></p>\n<hr>\n<figure class=\"highlight latex\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">$</span><span class=\"built_in\">$</span></span><br><span class=\"line\"><span class=\"keyword\">\\tilde</span>&#123;a&#125; <span class=\"keyword\">\\underrightarrow</span>&#123;AB&#125;<span class=\"keyword\">\\begin</span>&#123;array&#125;&#123;l&#125;</span><br><span class=\"line\">  a<span class=\"keyword\">\\mathop</span>&#123;x&#125;<span class=\"keyword\">\\nolimits</span><span class=\"built_in\">^</span>&#123;2&#125;+bx+c=0 <span class=\"keyword\">\\\\</span></span><br><span class=\"line\">  <span class=\"keyword\">\\Delta</span> =<span class=\"keyword\">\\mathop</span>&#123;b&#125;<span class=\"keyword\">\\nolimits</span><span class=\"built_in\">^</span>&#123;2&#125;-4ac <span class=\"keyword\">\\\\</span></span><br><span class=\"line\">  <span class=\"keyword\">\\left</span><span class=\"keyword\">\\&#123;</span><span class=\"keyword\">\\begin</span>&#123;matrix&#125;</span><br><span class=\"line\">  <span class=\"keyword\">\\Delta</span> <span class=\"keyword\">\\gt</span> 0<span class=\"keyword\">\\text</span>&#123;æ–¹ç¨‹æœ‰ä¸¤ä¸ªä¸ç›¸ç­‰çš„å®æ ¹&#125; <span class=\"keyword\">\\\\</span></span><br><span class=\"line\">  <span class=\"keyword\">\\Delta</span> = 0<span class=\"keyword\">\\text</span>&#123;æ–¹ç¨‹æœ‰ä¸¤ä¸ªç›¸ç­‰çš„å®æ ¹&#125; <span class=\"keyword\">\\\\</span></span><br><span class=\"line\">  <span class=\"keyword\">\\Delta</span> <span class=\"keyword\">\\lt</span> 0<span class=\"keyword\">\\text</span>&#123;æ–¹ç¨‹æ— å®æ ¹&#125;</span><br><span class=\"line\"><span class=\"keyword\">\\end</span>&#123;matrix&#125;<span class=\"keyword\">\\right</span>.</span><br><span class=\"line\"><span class=\"keyword\">\\end</span>&#123;array&#125;</span><br><span class=\"line\"><span class=\"built_in\">$</span><span class=\"built_in\">$</span></span><br></pre></td></tr></table></figure>\n<p class='katex-block'><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mover accent=\"true\"><mi>a</mi><mo>~</mo></mover><munder accentunder=\"true\"><mrow><mi>A</mi><mi>B</mi></mrow><mo stretchy=\"true\">â†’</mo></munder><mtable rowspacing=\"0.15999999999999992em\" columnalign=\"left\" columnspacing=\"1em\"><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mrow><mi>a</mi><msup><mo><mi>x</mi></mo><mn>2</mn></msup><mo>+</mo><mi>b</mi><mi>x</mi><mo>+</mo><mi>c</mi><mo>=</mo><mn>0</mn></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mrow><mi mathvariant=\"normal\">Î”</mi><mo>=</mo><msup><mo><mi>b</mi></mo><mn>2</mn></msup><mo>âˆ’</mo><mn>4</mn><mi>a</mi><mi>c</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mrow><mo fence=\"true\">{</mo><mtable rowspacing=\"0.15999999999999992em\" columnspacing=\"1em\"><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mrow><mi mathvariant=\"normal\">Î”</mi><mo>&gt;</mo><mn>0</mn><mtext>Â æ–¹ç¨‹æœ‰ä¸¤ä¸ªä¸ç›¸ç­‰çš„å®æ ¹</mtext></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mrow><mi mathvariant=\"normal\">Î”</mi><mo>=</mo><mn>0</mn><mtext>Â æ–¹ç¨‹æœ‰ä¸¤ä¸ªç›¸ç­‰çš„å®æ ¹</mtext></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mrow><mi mathvariant=\"normal\">Î”</mi><mo>&lt;</mo><mn>0</mn><mtext>Â æ–¹ç¨‹æ— å®æ ¹</mtext></mrow></mstyle></mtd></mtr></mtable></mrow></mstyle></mtd></mtr></mtable></mrow><annotation encoding=\"application/x-tex\">\\tilde{a} \\underrightarrow{AB}\\begin{array}{l}\n  a\\mathop{x}\\nolimits^{2}+bx+c=0 \\\\\n  \\Delta =\\mathop{b}\\nolimits^{2}-4ac \\\\\n  \\left\\{\\begin{matrix}\n  \\Delta \\gt 0\\text{ æ–¹ç¨‹æœ‰ä¸¤ä¸ªä¸ç›¸ç­‰çš„å®æ ¹} \\\\\n  \\Delta = 0\\text{ æ–¹ç¨‹æœ‰ä¸¤ä¸ªç›¸ç­‰çš„å®æ ¹} \\\\\n  \\Delta \\lt 0\\text{ æ–¹ç¨‹æ— å®æ ¹}\n\\end{matrix}\\right.\n\\end{array}\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:6.0584880000000005em;vertical-align:-2.7792439999999994em;\"></span><span class=\"mord accent\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.6678599999999999em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span></span></span><span style=\"top:-3.35em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"accent-body\" style=\"left:-0.25em;\"><span class=\"mord\">~</span></span></span></span></span></span></span><span class=\"mord accentunder\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.68333em;\"><span class=\"svg-align\" style=\"top:-2.4779999999999998em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"hide-tail\" style=\"height:0.522em;min-width:0.888em;\"><svg width='400em' height='0.522em' viewBox='0 0 400000 522' preserveAspectRatio='xMaxYMin slice'><path d='M0 241v40h399891c-47.3 35.3-84 78-110 128\n-16.7 32-27.7 63.7-33 95 0 1.3-.2 2.7-.5 4-.3 1.3-.5 2.3-.5 3 0 7.3 6.7 11 20\n 11 8 0 13.2-.8 15.5-2.5 2.3-1.7 4.2-5.5 5.5-11.5 2-13.3 5.7-27 11-41 14.7-44.7\n 39-84.5 73-119.5s73.7-60.2 119-75.5c6-2 9-5.7 9-11s-3-9-9-11c-45.3-15.3-85\n-40.5-119-75.5s-58.3-74.8-73-119.5c-4.7-14-8.3-27.3-11-40-1.3-6.7-3.2-10.8-5.5\n-12.5-2.3-1.7-7.5-2.5-15.5-2.5-14 0-21 3.7-21 11 0 2 2 10.3 6 25 20.7 83.3 67\n 151.7 139 205zm0 0v40h399900v-40z'/></svg></span></span><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">A</span><span class=\"mord mathnormal\" style=\"margin-right:0.05017em;\">B</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.522em;\"><span></span></span></span></span></span><span class=\"mord\"><span class=\"mtable\"><span class=\"arraycolsep\" style=\"width:0.5em;\"></span><span class=\"col-align-l\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:3.2792440000000007em;\"><span style=\"top:-6.489264000000001em;\"><span class=\"pstrut\" style=\"height:4.05002em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mop\"><span class=\"mop mathnormal\" style=\"position:relative;top:-0.03472em;\">x</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\">+</span><span class=\"mord mathnormal\">b</span><span class=\"mord mathnormal\">x</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord mathnormal\">c</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mord\">0</span></span></span><span style=\"top:-5.230816em;\"><span class=\"pstrut\" style=\"height:4.05002em;\"></span><span class=\"mord\"><span class=\"mord\">Î”</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mop\"><span class=\"mop mathnormal\" style=\"position:relative;top:0.09721999999999997em;\">b</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8984479999999999em;\"><span style=\"top:-3.1473400000000002em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\">âˆ’</span><span class=\"mord\">4</span><span class=\"mord mathnormal\">a</span><span class=\"mord mathnormal\">c</span></span></span><span style=\"top:-2.8207960000000005em;\"><span class=\"pstrut\" style=\"height:4.05002em;\"></span><span class=\"mord\"><span class=\"minner\"><span class=\"mopen\"><span class=\"delimsizing mult\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:2.05002em;\"><span style=\"top:-2.49999em;\"><span class=\"pstrut\" style=\"height:3.15em;\"></span><span class=\"delimsizinginner delim-size4\"><span>â©</span></span></span><span style=\"top:-2.20499em;\"><span class=\"pstrut\" style=\"height:3.15em;\"></span><span class=\"delimsizinginner delim-size4\"><span>âª</span></span></span><span style=\"top:-3.15001em;\"><span class=\"pstrut\" style=\"height:3.15em;\"></span><span class=\"delimsizinginner delim-size4\"><span>â¨</span></span></span><span style=\"top:-4.00501em;\"><span class=\"pstrut\" style=\"height:3.15em;\"></span><span class=\"delimsizinginner delim-size4\"><span>âª</span></span></span><span style=\"top:-4.30002em;\"><span class=\"pstrut\" style=\"height:3.15em;\"></span><span class=\"delimsizinginner delim-size4\"><span>â§</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.55002em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mtable\"><span class=\"col-align-c\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:2.05em;\"><span style=\"top:-4.21em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">Î”</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">&gt;</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mord\">0</span><span class=\"mord text\"><span class=\"mord\">Â </span><span class=\"mord cjk_fallback\">æ–¹ç¨‹æœ‰ä¸¤ä¸ªä¸ç›¸ç­‰çš„å®æ ¹</span></span></span></span><span style=\"top:-3.0099999999999993em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">Î”</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mord\">0</span><span class=\"mord text\"><span class=\"mord\">Â </span><span class=\"mord cjk_fallback\">æ–¹ç¨‹æœ‰ä¸¤ä¸ªç›¸ç­‰çš„å®æ ¹</span></span></span></span><span style=\"top:-1.8099999999999994em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">Î”</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">&lt;</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mord\">0</span><span class=\"mord text\"><span class=\"mord\">Â </span><span class=\"mord cjk_fallback\">æ–¹ç¨‹æ— å®æ ¹</span></span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.5500000000000007em;\"><span></span></span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:2.7792439999999994em;\"><span></span></span></span></span></span><span class=\"arraycolsep\" style=\"width:0.5em;\"></span></span></span></span></span></span></span></p>\n<hr>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä»¥ä¸‹ä¸ºå¼€å¯<code>Auto-render Extension</code>åæ”¯æŒçš„å…¬å¼è¯­æ³•ï¼Œå¹¶ä¸æ˜¯<code>LaTex</code>çš„æ ‡å‡†è¯­æ³•</p>\n</li>\n</ul>\n<hr>\n<figure class=\"highlight latex\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">$</span><span class=\"built_in\">$</span></span><br><span class=\"line\"><span class=\"keyword\">\\begin</span>&#123;equation&#125;</span><br><span class=\"line\"><span class=\"keyword\">\\begin</span>&#123;split&#125;   a <span class=\"built_in\">&amp;</span>=b+c<span class=\"keyword\">\\\\</span></span><br><span class=\"line\">      <span class=\"built_in\">&amp;</span>=e+f</span><br><span class=\"line\"><span class=\"keyword\">\\end</span>&#123;split&#125;</span><br><span class=\"line\"><span class=\"keyword\">\\end</span>&#123;equation&#125;</span><br><span class=\"line\"><span class=\"built_in\">$</span><span class=\"built_in\">$</span></span><br></pre></td></tr></table></figure>\n<p class='katex-block katex-error' title='ParseError: KaTeX parse error: No such environment: equation at position 7: \\begin{Ì²eÌ²qÌ²uÌ²aÌ²tÌ²iÌ²oÌ²nÌ²}Ì²\n\\begin{split} â€¦'>\\begin{equation}\n\\begin{split}   a &amp;=b+c\\\\\n      &amp;=e+f\n\\end{split}\n\\end{equation}\n</p>\n<hr>\n<figure class=\"highlight latex\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">$</span><span class=\"built_in\">$</span></span><br><span class=\"line\"><span class=\"keyword\">\\begin</span>&#123;align&#125;</span><br><span class=\"line\">   a<span class=\"built_in\">&amp;</span>=b+c <span class=\"keyword\">\\\\</span></span><br><span class=\"line\">   d+e<span class=\"built_in\">&amp;</span>=f</span><br><span class=\"line\"><span class=\"keyword\">\\end</span>&#123;align&#125;</span><br><span class=\"line\"><span class=\"built_in\">$</span><span class=\"built_in\">$</span></span><br></pre></td></tr></table></figure>\n<p class='katex-block katex-error' title='ParseError: KaTeX parse error: No such environment: align at position 7: \\begin{Ì²aÌ²lÌ²iÌ²gÌ²nÌ²}Ì²\n   a&amp;=b+c \\\\\n â€¦'>\\begin{align}\n   a&amp;=b+c \\\\\n   d+e&amp;=f\n\\end{align}\n</p>\n<hr>\n<figure class=\"highlight latex\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">$</span><span class=\"built_in\">$</span></span><br><span class=\"line\"><span class=\"keyword\">\\begin</span>&#123;CD&#125;</span><br><span class=\"line\">   A @&gt;a&gt;&gt; B <span class=\"keyword\">\\\\</span></span><br><span class=\"line\">@VbVV @AAcA <span class=\"keyword\">\\\\</span></span><br><span class=\"line\">   C @= D</span><br><span class=\"line\"><span class=\"keyword\">\\end</span>&#123;CD&#125;</span><br><span class=\"line\"><span class=\"built_in\">$</span><span class=\"built_in\">$</span></span><br></pre></td></tr></table></figure>\n<p class='katex-block katex-error' title='ParseError: KaTeX parse error: No such environment: CD at position 7: \\begin{Ì²CÌ²DÌ²}Ì²\n   A @&gt;a&gt;&gt; B \\â€¦'>\\begin{CD}\n   A @&gt;a&gt;&gt; B \\\\\n@VbVV @AAcA \\\\\n   C @= D\n\\end{CD}\n</p>\n","content_text":"æ‘˜è¦ Hexoæ˜¯åŸºäºmarkdownçš„ï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨LaTexè¯­æ³•æ¥ç¼–å†™æ•°å­¦å…¬å¼ï¼Œåªä¸è¿‡éœ€è¦å®‰è£…ç›¸åº”çš„å…¬å¼æ¸²æŸ“æ’ä»¶æ¥å®ç°ã€‚ Nextä¸»é¢˜ æ”¯æŒçš„å…¬å¼æ’ä»¶ä¸ºMathJaxå’ŒKaTeXï¼Œå®ƒä»¬éƒ½æ”¯æŒLaTexè¯­æ³•ï¼Œå‚è€ƒ: https://theme-next.js.org/docs/third-party-services/math-equations æœ¬æ–‡ä½¿ç”¨çš„æ˜¯Katexï¼ŒåŸå› æ˜¯æˆ‘å·²ç»ä½¿ç”¨äº†hexo-renderer-markdown-itæ¸²æŸ“å™¨ï¼Œå…¶ä¸ mathjax çš„ hexo-renderer-pandocæ¸²æŸ“å™¨ä¸èƒ½å¹¶å­˜ï¼Œæ‰€ä»¥åªèƒ½é€‰Katexäº†ã€‚ å®‰è£… è¯¦ç»†çš„å®‰è£…æ–¹æ³•è¯·å‚è€ƒ:Math Equations å› ä¸ºå·²ç»ä½¿ç”¨äº†hexo-renderer-markdown-itæ¸²æŸ“å™¨ï¼Œæ‰€ä»¥è¿™é‡Œå°±æ²¡æœ‰ä½¿ç”¨hexo-renderer-markdown-it-plusæ¸²æŸ“å™¨ï¼Œå…¶å®ä¸¤è€…ä¹Ÿæ²¡æœ‰å¤ªå¤§çš„åŒºåˆ«ï¼Œåªä¸è¿‡åè€…é»˜è®¤å°±åŠ è½½äº†ä¸€äº›æ’ä»¶ï¼Œè€Œå‰è€…éœ€è¦è‡ªå·±å®‰è£…æ’ä»¶å¹¶é…ç½®æ‰å¯ä»¥ä½¿ç”¨ã€‚ ä½†æ˜¯æµ‹è¯•æ—¶å‘ç°ï¼ŒæŒ‰ç…§å®˜ç½‘çš„é…ç½®hexo-renderer-markdown-it + markdown-it-katex çš„æ–¹å¼å¹¶ä¸èƒ½å¾ˆå¥½çš„è¿›è¡Œå…¬å¼çš„æ¸²æŸ“ï¼Œæ‰€ä»¥è¿™é‡Œå‚è€ƒäº† hexo-renderer-markdown-it-plus æ¸²æŸ“å™¨ï¼Œå°†å…¶æ›´æ¢ä¸º@iktakahiro/markdown-it-katexã€‚ 1npm install @iktakahiro/markdown-it-katex --save åœ¨_config.ymlé…ç½®ä¸Šè¯¥æ’ä»¶ 123456789101112# config of hexo-renderer-markdown-itmarkdown: render: html: true xhtmlOut: false breaks: true linkify: true typographer: true quotes: &#x27;â€œâ€â€˜â€™&#x27; plugins: # katexå…¬å¼ - &quot;@iktakahiro/markdown-it-katex&quot; å®‰è£…åé‡åˆ°çš„é—®é¢˜ 1.å®‰è£…åå‘ç°é€šè¿‡hexoç¼–è¯‘æ—¶ä¼šæŠ¥ç±»ä¼¼å¦‚ä¸‹è­¦å‘Š 1LaTeX-incompatible input and strict mode is set to &#x27;warn&#x27;: Unicode text character &quot;å³&quot; used in math mode [unicodeTextInMathMode] åŸå› æ˜¯@iktakahiro/markdown-it-katexæ’ä»¶é»˜è®¤å¼€å¯çš„æ˜¯ä¸¥æ ¼æ¨¡å¼ï¼Œä¸èƒ½åœ¨$$...$$æˆ–$...$ä¸­åŒ…å«ä¸­æ–‡ï¼Œè™½ç„¶æˆ‘è®¾ç½®çš„æ˜¯math -- every_page: falseï¼Œä½†å…¶åœ¨ç¼–è¯‘é˜¶æ®µä¾æ—§ä¼šæ£€æŸ¥æ‰€æœ‰çš„é¡µé¢ï¼Œä¸è¿‡æŠ¥è¿™ä¸ªè­¦å‘Šå¹¶ä¸ä¼šæœ‰ä»€ä¹ˆå½±å“ï¼Œæ‰€ä»¥å¯ä»¥å¿½ç•¥ã€‚ å¦‚æœä¸å¸Œæœ›çœ‹åˆ°è¿™ä¸ªè­¦å‘Šï¼Œå¯ä»¥ä¸º @iktakahiro/markdown-it-katex æ·»åŠ æ¨¡å¼çš„æ§åˆ¶è¡Œä¸º 1234567891011121314# config of hexo-renderer-markdown-itmarkdown: render: html: true xhtmlOut: false breaks: true linkify: true typographer: true quotes: &#x27;â€œâ€â€˜â€™&#x27; plugins: # katexå…¬å¼ - name: &quot;@iktakahiro/markdown-it-katex&quot; options: strict: error # é»˜è®¤ä¸ºwarnï¼Œè¿™é‡Œè®¾ç½®ä¸ºerrorï¼Œåªæœ‰å½“è§£æå™¨é‡åˆ°ä¸æ”¯æŒçš„å…¬å¼æ—¶æ‰æŠ¥é”™ï¼Œä¹Ÿå¯ä»¥è®¾ç½®ä¸º falseï¼Œè¡¨ç¤ºä¸æ£€æŸ¥ ä¸æ”¯æŒKatexçš„Auto-render Extension é€šè¿‡æŸ¥çœ‹Katexå®˜ç½‘å¯ä»¥çŸ¥é“ï¼Œå¼€å¯Auto-render Extensionåï¼ŒKatexå¯ä»¥æ¸²æŸ“æ›´å¤šçš„å…¬å¼è¯­æ³•ï¼Œä½†è¦æ³¨æ„è¿™å¹¶ä¸æ˜¯LaTexçš„æ ‡å‡†è¯­æ³• ä½†æ˜¯@iktakahiro/markdown-it-katexä¸­å¹¶æ²¡æœ‰ç›¸åº”çš„é…ç½®ï¼Œä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œç®€å•çš„æ–¹æ³•å°±æ˜¯å°†æ‰€éœ€è¦çš„èµ„æºæ·»åŠ åˆ°é¡µé¢ä¸­ï¼Œæ¯”å¦‚æˆ‘åœ¨source\\_data\\post-body-start.njkä¸­æ·»åŠ äº†å¦‚ä¸‹å†…å®¹ 1234567891011121314151617181920212223242526&#123;%- if page.mathjax %&#125;&lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css&quot; integrity=&quot;sha384-nB0miv6/jRmo5UMMR1wu3Gz6NLsoTkbqJghGIsx//Rlm+ZU03BU6SQNC66uf4l5+&quot; crossorigin=&quot;anonymous&quot;&gt;&lt;script defer src=&quot;https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js&quot; integrity=&quot;sha384-7zkQWkzuo3B5mTepMUcHkMB5jZaolc2xDwL6VFqjFALcbeS9Ggm/Yr2r3Dy4lfFg&quot; crossorigin=&quot;anonymous&quot;&gt;&lt;/script&gt;&lt;script defer src=&quot;https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js&quot; integrity=&quot;sha384-43gviWU0YVjaDtb/GhzOouOXtZMP/7XUzwPTstBeZFe/+rCMvRwr4yROQP43s0Xk&quot; crossorigin=&quot;anonymous&quot;&gt;&lt;/script&gt;&lt;script&gt; document.addEventListener(&quot;DOMContentLoaded&quot;, function() &#123; renderMathInElement(document.body, &#123; // customised options // â€¢ auto-render specific keys, e.g.: delimiters: [ &#123;left: &quot;$$&quot;, right: &quot;$$&quot;, display: true&#125;, &#123;left: &quot;\\\\(&quot;, right: &quot;\\\\)&quot;, display: false&#125;, &#123;left: &quot;\\\\begin&#123;equation&#125;&quot;, right: &quot;\\\\end&#123;equation&#125;&quot;, display: true&#125;, &#123;left: &quot;\\\\begin&#123;align&#125;&quot;, right: &quot;\\\\end&#123;align&#125;&quot;, display: true&#125;, &#123;left: &quot;\\\\begin&#123;alignat&#125;&quot;, right: &quot;\\\\end&#123;alignat&#125;&quot;, display: true&#125;, &#123;left: &quot;\\\\begin&#123;gather&#125;&quot;, right: &quot;\\\\end&#123;gather&#125;&quot;, display: true&#125;, &#123;left: &quot;\\\\begin&#123;CD&#125;&quot;, right: &quot;\\\\end&#123;CD&#125;&quot;, display: true&#125;, &#123;left: &quot;\\\\[&quot;, right: &quot;\\\\]&quot;, display: true&#125; ], // â€¢ rendering keys, e.g.: throwOnError : false &#125;); &#125;);&lt;/script&gt;&#123;%- endif %&#125; å°è´´å£« å¯ä»¥é€šè¿‡nextæ¨¡æ¿çš„_config.ymlä¸­çš„custom_file_pathé…ç½®é¡¹æ¥è‡ªå®šä¹‰æ¸²æŸ“é¡µé¢çš„æŸä¸ªéƒ¨åˆ†ï¼Œè¿™æ ·å¯¹åº”çš„æ¯ä¸ªé¡µé¢éƒ½ä¼šåŠ ä¸Šè¯¥æ¨¡æ¿å†…å®¹ 12custom_file_path: postBodyStart: source/_data/post-body-start.njk ä½¿ç”¨hexo-renderer-markdown-it-plusæ¸²æŸ“å™¨æ—¶ï¼Œå¦‚æœä¿®æ”¹äº†é¡µé¢çš„å†…å®¹ï¼Œæ­¤æ—¶åˆ·æ–°é¡µé¢ï¼Œä¼šå‘ç°é¡µé¢ä¸­çš„å…¬å¼ä¸èƒ½è¢«æ¸²æŸ“äº†ï¼Œåªèƒ½é‡æ–°å¯åŠ¨hexoæœåŠ¡ã€‚ ä½†æ˜¯ä½¿ç”¨hexo-renderer-markdown-itæ¸²æŸ“å™¨æ—¶ï¼Œåˆ·æ–°é¡µé¢åå…¬å¼å°±å¯ä»¥è¢«æ¸²æŸ“äº†ã€‚ ä½¿ç”¨ æ¯ä¸ªé¡µé¢çš„front-matterä¸­è¦æ·»åŠ mathjax: trueï¼Œè¿™æ ·åœ¨é¡µé¢ä¸­å°±å¯ä»¥ä½¿ç”¨å…¬å¼äº†ã€‚ Katexå…¬å¼çš„æ¸²æŸ“æ–¹å¼æ”¯æŒ$...$å’Œ$$...$$ä¸¤ç§æ–¹å¼ $...$ä¸ºè¡Œçº§å…¬å¼ 1$sin(\\omega t)=\\frac&#123;1&#125;&#123;2j&#125;(e^&#123;j\\omega t&#125;-e^&#123;-j\\omega t&#125;)$ sin(Ï‰t)=12j(ejÏ‰tâˆ’eâˆ’jÏ‰t)sin(\\omega t)=\\frac{1}{2j}(e^{j\\omega t}-e^{-j\\omega t})sin(Ï‰t)=2j1â€‹(ejÏ‰tâˆ’eâˆ’jÏ‰t) $$...$$ä¸ºå—çº§å…¬å¼ï¼Œç‹¬å ä¸€è¡Œä¸”å±…ä¸­å±•ç¤º 123$$sin(\\omega t)=\\frac&#123;1&#125;&#123;2j&#125;(e^&#123;j\\omega t&#125;-e^&#123;-j\\omega t&#125;)$$ sin(Ï‰t)=12j(ejÏ‰tâˆ’eâˆ’jÏ‰t)sin(\\omega t)=\\frac{1}{2j}(e^{j\\omega t}-e^{-j\\omega t}) sin(Ï‰t)=2j1â€‹(ejÏ‰tâˆ’eâˆ’jÏ‰t) $$...$$å’Œ$...$ä¸­ä¸èƒ½å‡ºç°Unicodeå­—ç¬¦ï¼Œå¦åˆ™ä¼šæŠ¥é”™ï¼Œå³ä¸æ”¯æŒä¸­æ–‡ï¼Œå¦‚æœéœ€è¦æ˜¾ç¤ºä¸­æ–‡ï¼Œåˆ™éœ€è¦ä½¿ç”¨\\text&#123;ä¸­æ–‡&#125; å—çº§å…¬å¼ï¼Œåœ¨å¼€å¤´çš„$$ä¹‹å‰å’Œç»“å°¾çš„$$ä¹‹åï¼Œä¸å¾—æœ‰ä»»ä½•å­—ç¬¦ï¼ˆç©ºæ ¼é™¤å¤–ï¼‰ è¡Œçº§å…¬å¼ï¼Œåœ¨å¼€å¤´çš„$ä¹‹åå’Œç»“å°¾çš„$ä¹‹å‰ï¼Œä¸å¾—æœ‰ç©ºæ ¼ ç¤ºä¾‹ ä½¿ç”¨æ–¹å¼å¯ä»¥å‚è€ƒ KaTeXå…¬å¼ç¬¦å· ä»¥åŠ ç»´åŸºç™¾ç§‘ï¼šLaTeXå…¬å¼æ‰‹å†Œ ä¸è¿‡è®°ä½è¿™äº›å…¬å¼ç¬¦å·è¿˜æ˜¯æ¯”è¾ƒå›°éš¾çš„ï¼Œè¿™é‡Œæ¨èä¸¤ä¸ªå·¥å…· MyScript: æ‰‹å†™è½¬LaTeXå…¬å¼ï¼Œç›´æ¥å°†ä½ éœ€è¦çš„æ•°å­¦å…¬å¼ç”»å‡ºæ¥ï¼Œå®ƒä¼šè‡ªåŠ¨å°†å…¶è½¬æ¢ä¸ºLaTeXå…¬å¼ï¼Œç„¶åå¤åˆ¶å³å¯ LaTeXå…¬å¼ç¼–è¾‘å™¨: æä¾›å…¬å¼æ¨¡æ¿ã€å›¾ç‰‡è¯†åˆ«(æœ‰æ¬¡æ•°é™åˆ¶)ç­‰åŠŸèƒ½ï¼Œå¹¶ä¸”æ”¯æŒè¾“å‡ºå„ç§æ ¼å¼ã€‚ Simpletex: æ”¯æŒLaTexå…¬å¼å›¾ç‰‡è¯†åˆ«å’Œæ‰‹å†™è½¬å…¬å¼ï¼Œä¸”æ— æ¬¡æ•°é™åˆ¶ï¼Œä½†æ˜¯éœ€è¦æ³¨å†Œè´¦å·ã€‚åŒæ—¶ä¹Ÿæä¾›äº†å®¢æˆ·ç«¯ç‰ˆæœ¬ã€‚ è¿™é‡Œéšä¾¿ç»™å‡ ä¸ªç¤ºä¾‹ï¼Œä»¥ä¸‹æ˜¯LaTeXçš„æ ‡å‡†è¯­æ³• 1234$$\\left(\\beta m c^2 + c \\left(\\sum_&#123;n=1&#125;^3\\alpha_n p_n\\right)\\right) \\psi(x,t)= i\\hbar \\frac&#123;\\partial \\psi(x,t)&#125;&#123;\\partial t&#125;$$ (Î²mc2+c(âˆ‘n=13Î±npn))Ïˆ(x,t)=iâ„âˆ‚Ïˆ(x,t)âˆ‚t\\left(\\beta m c^2 + c \\left(\\sum_{n=1}^3\\alpha_n p_n\\right)\\right) \\psi(x,t) = i\\hbar \\frac{\\partial \\psi(x,t)}{\\partial t} (Î²mc2+c(n=1âˆ‘3â€‹Î±nâ€‹pnâ€‹))Ïˆ(x,t)=iâ„âˆ‚tâˆ‚Ïˆ(x,t)â€‹ 1Aha! $E = mc^&#123;2&#125;$. Aha! E=mc2E = mc^{2}E=mc2. 123$$\\left(\\LARGE&#123;AB&#125;\\right)$$ (AB)\\left(\\LARGE{AB}\\right) (AB) 123456$$\\begin&#123;matrix&#125; a &amp; b \\\\ c &amp; d\\end&#123;matrix&#125;$$ abcd\\begin{matrix} a &amp; b \\\\ c &amp; d \\end{matrix} acâ€‹bdâ€‹ 123456789$$\\def\\arraystretch&#123;1.5&#125; \\begin&#123;array&#125;&#123;c:c:c&#125; a &amp; b &amp; c \\\\ \\hline d &amp; e &amp; f \\\\ \\hdashline g &amp; h &amp; i\\end&#123;array&#125;$$ abcdefghi\\def\\arraystretch{1.5} \\begin{array}{c:c:c} a &amp; b &amp; c \\\\ \\hline d &amp; e &amp; f \\\\ \\hdashline g &amp; h &amp; i \\end{array} adgâ€‹behâ€‹cfiâ€‹â€‹ 1$\\tilde&#123;a&#125;$ &amp;nbsp;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; $\\underrightarrow&#123;AB&#125;$ a~\\tilde{a}a~ ABâ†’\\underrightarrow{AB}ABâ€‹ 1234567891011$$\\tilde&#123;a&#125; \\underrightarrow&#123;AB&#125;\\begin&#123;array&#125;&#123;l&#125; a\\mathop&#123;x&#125;\\nolimits^&#123;2&#125;+bx+c=0 \\\\ \\Delta =\\mathop&#123;b&#125;\\nolimits^&#123;2&#125;-4ac \\\\ \\left\\&#123;\\begin&#123;matrix&#125; \\Delta \\gt 0\\text&#123;æ–¹ç¨‹æœ‰ä¸¤ä¸ªä¸ç›¸ç­‰çš„å®æ ¹&#125; \\\\ \\Delta = 0\\text&#123;æ–¹ç¨‹æœ‰ä¸¤ä¸ªç›¸ç­‰çš„å®æ ¹&#125; \\\\ \\Delta \\lt 0\\text&#123;æ–¹ç¨‹æ— å®æ ¹&#125;\\end&#123;matrix&#125;\\right.\\end&#123;array&#125;$$ a~ABâ†’ax2+bx+c=0Î”=b2âˆ’4ac{Î”&gt;0 æ–¹ç¨‹æœ‰ä¸¤ä¸ªä¸ç›¸ç­‰çš„å®æ ¹Î”=0 æ–¹ç¨‹æœ‰ä¸¤ä¸ªç›¸ç­‰çš„å®æ ¹Î”&lt;0 æ–¹ç¨‹æ— å®æ ¹\\tilde{a} \\underrightarrow{AB}\\begin{array}{l} a\\mathop{x}\\nolimits^{2}+bx+c=0 \\\\ \\Delta =\\mathop{b}\\nolimits^{2}-4ac \\\\ \\left\\{\\begin{matrix} \\Delta \\gt 0\\text{ æ–¹ç¨‹æœ‰ä¸¤ä¸ªä¸ç›¸ç­‰çš„å®æ ¹} \\\\ \\Delta = 0\\text{ æ–¹ç¨‹æœ‰ä¸¤ä¸ªç›¸ç­‰çš„å®æ ¹} \\\\ \\Delta \\lt 0\\text{ æ–¹ç¨‹æ— å®æ ¹} \\end{matrix}\\right. \\end{array} a~ABâ€‹ax2+bx+c=0Î”=b2âˆ’4acâ©âªâ¨âªâ§â€‹Î”&gt;0 æ–¹ç¨‹æœ‰ä¸¤ä¸ªä¸ç›¸ç­‰çš„å®æ ¹Î”=0 æ–¹ç¨‹æœ‰ä¸¤ä¸ªç›¸ç­‰çš„å®æ ¹Î”&lt;0 æ–¹ç¨‹æ— å®æ ¹â€‹â€‹ ä»¥ä¸‹ä¸ºå¼€å¯Auto-render Extensionåæ”¯æŒçš„å…¬å¼è¯­æ³•ï¼Œå¹¶ä¸æ˜¯LaTexçš„æ ‡å‡†è¯­æ³• 1234567$$\\begin&#123;equation&#125;\\begin&#123;split&#125; a &amp;=b+c\\\\ &amp;=e+f\\end&#123;split&#125;\\end&#123;equation&#125;$$ \\begin{equation} \\begin{split} a &amp;=b+c\\\\ &amp;=e+f \\end{split} \\end{equation} 123456$$\\begin&#123;align&#125; a&amp;=b+c \\\\ d+e&amp;=f\\end&#123;align&#125;$$ \\begin{align} a&amp;=b+c \\\\ d+e&amp;=f \\end{align} 1234567$$\\begin&#123;CD&#125; A @&gt;a&gt;&gt; B \\\\@VbVV @AAcA \\\\ C @= D\\end&#123;CD&#125;$$ \\begin{CD} A @&gt;a&gt;&gt; B \\\\ @VbVV @AAcA \\\\ C @= D \\end{CD}","summary":"æ‘˜è¦ Hexoæ˜¯åŸºäºmarkdownçš„ï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨LaTexè¯­æ³•æ¥ç¼–å†™æ•°å­¦å…¬å¼ï¼Œåªä¸è¿‡éœ€è¦å®‰è£…ç›¸åº”çš„å…¬å¼æ¸²æŸ“æ’ä»¶æ¥å®ç°ã€‚ Nextä¸»é¢˜ æ”¯æŒçš„å…¬å¼æ’ä»¶ä¸ºMathJaxå’ŒKaTeXï¼Œå®ƒä»¬éƒ½æ”¯æŒLaTexè¯­æ³•ï¼Œå‚è€ƒ: https://theme-next.js.org/docs/third-party-services/math-equations æœ¬æ–‡ä½¿ç”¨çš„æ˜¯Katexï¼ŒåŸå› æ˜¯æˆ‘å·²ç»ä½¿ç”¨äº†hexo-renderer-markdown-itæ¸²æŸ“å™¨ï¼Œå…¶ä¸ mathjax çš„ hexo-renderer-pandocæ¸²æŸ“å™¨ä¸èƒ½å¹¶å­˜ï¼Œæ‰€ä»¥åªèƒ½é€‰Katexäº†ã€‚","date_published":"2024-11-12T13:55:05.000Z","tags":["Hexo","Hexo"]},{"id":"https://blog.hanqunfeng.com/2024/09/05/linux-zabbix_vfs_fs_inode/","url":"https://blog.hanqunfeng.com/2024/09/05/linux-zabbix_vfs_fs_inode/","title":"zabbixç›‘æ§å‘Šè­¦--vfs.fs.inodeä¸è¶³5%çš„è§£å†³è¿‡ç¨‹","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è§£å†³Linuxç´¢å¼•èŠ‚ç‚¹(inode)ç”¨æ»¡å¯¼è‡´æ•…éšœçš„æ–¹æ³•</p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"zabbixå‘Šè­¦\">zabbixå‘Šè­¦</h2>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vfs.fs.inode[/,pfree]):5 %</span><br></pre></td></tr></table></figure>\n<h2 id=\"è§£å†³è¿‡ç¨‹\">è§£å†³è¿‡ç¨‹</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç™»å½•linuxç³»ç»ŸåæŸ¥çœ‹inodeä½¿ç”¨æƒ…å†µå’Œç£ç›˜ä½¿ç”¨æƒ…å†µ</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># inode ä¸è¶³äº†</span></span><br><span class=\"line\"><span class=\"built_in\">df</span> -hi</span><br><span class=\"line\">æ–‡ä»¶ç³»ç»Ÿ\t      Inode  å·²ç”¨(I)  å¯ç”¨(I) å·²ç”¨(I)%% æŒ‚è½½ç‚¹</span><br><span class=\"line\">/dev/xvda1              1.9M    1.8M     96K   96% /</span><br><span class=\"line\">tmpfs                   251K       1    251K    1% /dev/shm</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># disk å……è¶³</span></span><br><span class=\"line\"><span class=\"built_in\">df</span> -hT</span><br><span class=\"line\">æ–‡ä»¶ç³»ç»Ÿ    ç±»å‹      å®¹é‡  å·²ç”¨  å¯ç”¨ å·²ç”¨%% æŒ‚è½½ç‚¹</span><br><span class=\"line\">/dev/xvda1    ext4     30G   18G   12G  61% /</span><br><span class=\"line\">tmpfs        tmpfs   1003M     0 1003M   0% /dev/shm</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ ¹æ®ä¸Šé¢çš„æŸ¥è¯¢ç»“æœåˆæ­¥åˆ¤æ–­æ˜¯ç³»ç»Ÿäº§ç”Ÿäº†å¤§é‡çš„ä¸´æ—¶æ–‡ä»¶å¯¼è‡´inodeç”¨å°½äº†</p>\n</li>\n<li class=\"lvl-2\">\n<p>æ’æŸ¥åˆ°åº•å“ªä¸ªç›®å½•ä¸‹çš„æ–‡ä»¶æ•°è¿‡å¤š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># é€šè¿‡ä¸‹é¢çš„å‘½ä»¤ç»Ÿè®¡æ–‡ä»¶æ•°é‡å‰ååï¼Œè¿™é‡Œå‘ç°æ˜¯/varç›®å½•ä¸­æ–‡ä»¶å¼‚å¸¸çš„å¤š</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> /*; <span class=\"keyword\">do</span> <span class=\"built_in\">echo</span> <span class=\"string\">&quot;<span class=\"subst\">$(find $i |wc -l)</span>:<span class=\"variable\">$i</span>&quot;</span>; <span class=\"keyword\">done</span> | <span class=\"built_in\">sort</span> -nr | <span class=\"built_in\">head</span> -n 10</span><br><span class=\"line\">1815728:/var</span><br><span class=\"line\">52498:/usr</span><br><span class=\"line\">18804:/proc</span><br><span class=\"line\">7333:/sys</span><br><span class=\"line\">1834:/lib</span><br><span class=\"line\">1447:/opt</span><br><span class=\"line\">1047:/etc</span><br><span class=\"line\">457:/dev</span><br><span class=\"line\">411:/lib64</span><br><span class=\"line\">245:/sbin</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ¥ç€æŸ¥çœ‹/varä¸­çš„æ–‡ä»¶æ•°é‡</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> /var/*; <span class=\"keyword\">do</span> <span class=\"built_in\">echo</span> <span class=\"string\">&quot;<span class=\"subst\">$(find $i |wc -l)</span>:<span class=\"variable\">$i</span>&quot;</span>; <span class=\"keyword\">done</span> | <span class=\"built_in\">sort</span> -nr | <span class=\"built_in\">head</span> -n 10</span><br><span class=\"line\">1813442:/var/spool</span><br><span class=\"line\">2033:/var/lib</span><br><span class=\"line\">85:/var/cache</span><br><span class=\"line\">82:/var/log</span><br><span class=\"line\">39:/var/run</span><br><span class=\"line\">24:/var/lock</span><br><span class=\"line\">7:/var/db</span><br><span class=\"line\">3:/var/yp</span><br><span class=\"line\">2:/var/empty</span><br><span class=\"line\">2:/var/account</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ¥ç€æŸ¥çœ‹/var/spoolä¸­çš„æ–‡ä»¶æ•°é‡ï¼Œè¿™é‡ŒåŸºæœ¬å®šä½åˆ°æ˜¯/var/spool/clientmqueueç›®å½•</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> /var/spool/*; <span class=\"keyword\">do</span> <span class=\"built_in\">echo</span> <span class=\"string\">&quot;<span class=\"subst\">$(find $i |wc -l)</span>:<span class=\"variable\">$i</span>&quot;</span>; <span class=\"keyword\">done</span> | <span class=\"built_in\">sort</span> -nr | <span class=\"built_in\">head</span> -n 10</span><br><span class=\"line\">1812413:/var/spool/clientmqueue</span><br><span class=\"line\">7:/var/spool/mail</span><br><span class=\"line\">4:/var/spool/anacron</span><br><span class=\"line\">3:/var/spool/at</span><br><span class=\"line\">2:/var/spool/cron</span><br><span class=\"line\">1:/var/spool/mqueue</span><br><span class=\"line\">1:/var/spool/lpd</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç™¾åº¦ä¸€ä¸‹<code>/var/spool/clientmqueue</code>ç›®å½•çš„ä½œç”¨</p>\n</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">â€ŒLinuxæ–‡ä»¶ç›®å½• /var/spool/clientmqueue/ ä¸‹çš„æ–‡ä»¶ä¸»è¦æ˜¯ç”±cronä»»åŠ¡äº§ç”Ÿçš„è¾“å‡ºæ–‡ä»¶ã€‚â€Œ å½“cronä»»åŠ¡ä¸­æœ‰è¾“å‡ºå†…å®¹æ—¶ï¼Œå¦‚æœæœåŠ¡å™¨ä¸Šæ²¡æœ‰é…ç½®sendmailæœåŠ¡ï¼Œè¿™äº›è¾“å‡ºå†…å®¹å°±ä¼šè¢«ä¿å­˜åˆ° /var/spool/clientmqueue/ ç›®å½•å†…ã€‚è¿™æ˜¯å› ä¸ºcronä»»åŠ¡ä¸­çš„å‘½ä»¤å¦‚æœæœ‰è¾“å‡ºï¼ˆæ¯”å¦‚é”™è¯¯ä¿¡æ¯æˆ–è€…æ­£å¸¸çš„è¾“å‡ºä¿¡æ¯ï¼‰ï¼Œé»˜è®¤ä¼šé€šè¿‡sendmailå‘é€ï¼Œä½†å¦‚æœæœåŠ¡å™¨ä¸Šæ²¡æœ‰é…ç½®sendmailæœåŠ¡ï¼Œè¿™äº›è¾“å‡ºå†…å®¹å°±ä¼šè¢«ä¿å­˜åˆ° /var/spool/clientmqueue/ ç›®å½•ä¸­ã€‚å› æ­¤ï¼Œè¿™ä¸ªç›®å½•ä¸‹ä¸»è¦åŒ…å«çš„æ˜¯ç”±cronä»»åŠ¡äº§ç”Ÿçš„è¾“å‡ºæ–‡ä»¶ï¼Œè¿™äº›æ–‡ä»¶è®°å½•äº†cronä»»åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­çš„è¾“å‡ºä¿¡æ¯ã€‚</span><br><span class=\"line\"></span><br><span class=\"line\">å¦‚æœéœ€è¦å¤„ç†è¿™äº›æ–‡ä»¶ï¼Œå¯ä»¥é€šè¿‡ä¿®æ”¹crontabé…ç½®æ¥å®ç°ã€‚å…·ä½“æ¥è¯´ï¼Œå¯ä»¥åœ¨æ¯ä¸ªcronä»»åŠ¡å‘½ä»¤çš„æœ«å°¾æ·»åŠ é‡å®šå‘æ“ä½œï¼Œå°†è¾“å‡ºå†…å®¹æŠ›å¼ƒï¼Œä¾‹å¦‚ä½¿ç”¨å‘½ä»¤ &gt;/dev/null 2&gt;&amp;1ã€‚è¿™æ ·ï¼Œæ— è®ºæ ‡å‡†è¾“å‡ºè¿˜æ˜¯é”™è¯¯è¾“å‡ºéƒ½ä¼šè¢«é‡å®šå‘åˆ° /dev/nullï¼Œå³è¢«æŠ›å¼ƒï¼Œä»è€Œé¿å…åœ¨ /var/spool/clientmqueue/ ç›®å½•ä¸‹äº§ç”Ÿä¸å¿…è¦çš„æ–‡ä»¶ã€‚</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¸Šé¢çš„è§£é‡Šè¯´æ˜<code>/var/spool/clientmqueue</code>ç›®å½•ä¸‹çš„æ–‡ä»¶å¯ä»¥è¢«åˆ é™¤ï¼Œæ‰€ä»¥ç›´æ¥åˆ äº†å°±å¯ä»¥è§£å†³è¯¥é—®é¢˜äº†</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æ–‡ä»¶æ•°é‡è¿‡å¤šï¼Œä¸èƒ½è¿™ä¹ˆåˆ é™¤</span></span><br><span class=\"line\"><span class=\"comment\"># rm -rf /var/spool/clientmqueue/*</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ­£ç¡®æ–¹æ³•</span></span><br><span class=\"line\">find /var/spool/clientmqueue -name <span class=\"string\">&quot;*&quot;</span> -<span class=\"built_in\">type</span> f | xargs <span class=\"built_in\">rm</span> -rf</span><br></pre></td></tr></table></figure>\n<h2 id=\"è¯¦è§£inode\">è¯¦è§£inode</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>inodeæ˜¯æ–‡ä»¶ç³»ç»Ÿå†…ä¸€ä¸ªé‡è¦çš„æ•°æ®ç»“æ„ï¼Œå®ƒç”¨æ¥æè¿°ä¸€ä¸ªæ–‡ä»¶ï¼ŒåŒ…æ‹¬æ–‡ä»¶åã€æ–‡ä»¶ç±»å‹ã€æƒé™ã€æ‰€æœ‰è€…ã€åˆ›å»ºæ—¶é—´ã€ä¿®æ”¹æ—¶é—´ç­‰ã€‚åœ¨Linuxç³»ç»Ÿä¸­ï¼Œæ¯ä¸ªæ–‡ä»¶éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„inodeå·ï¼Œè¿™ä¸ªinodeå·æ˜¯åˆ†é…ç»™è¯¥æ–‡ä»¶çš„ï¼Œå¹¶ä¸”ä¸èƒ½è¢«æ”¹å˜ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹å½“å‰ç›®å½•çš„inodeå·</span></span><br><span class=\"line\"><span class=\"built_in\">ls</span> -li</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ“ä½œç³»ç»Ÿæ‰“å¼€æ–‡ä»¶æ—¶ä¼šæŒ‰å¦‚ä¸‹æ­¥éª¤æ‰§è¡Œï¼š</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-6\">æŸ¥æ‰¾æ–‡ä»¶åç§°å¯¹åº”çš„inodeå·</li>\n<li class=\"lvl-6\">æ ¹æ®inodeå·è·å–inodeä¿¡æ¯</li>\n<li class=\"lvl-6\">æ ¹æ®inodeä¿¡æ¯æ‰¾åˆ°æ–‡ä»¶å¯¹åº”çš„æ•°æ®å—ï¼Œè¯»å‡ºæ•°æ®</li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<p>inodeçš„å¤§å°æ˜¯æœ‰é™åˆ¶çš„ï¼Œé€šå¸¸å–å†³äºæ–‡ä»¶ç³»ç»Ÿå’Œæ“ä½œç³»ç»Ÿã€‚åœ¨å¤§å¤šæ•°Linuxæ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œinodeå¤§å°é€šå¸¸æ˜¯128å­—èŠ‚æˆ–256å­—èŠ‚ã€‚è¿™æ˜¯ç”±æ–‡ä»¶ç³»ç»Ÿåœ¨æ ¼å¼åŒ–æ—¶å†³å®šçš„ï¼Œå¹¶ä¸”æ ¼å¼åŒ–åä¸èƒ½æ›´æ”¹ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹inodeå¤§å°</span></span><br><span class=\"line\">dumpe2fs /dev/xvda1 | grep <span class=\"string\">&quot;Inode size&quot;</span></span><br><span class=\"line\">dumpe2fs 1.43.5 (04-Aug-2017)</span><br><span class=\"line\">Inode size:\t          256</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æŸ¥çœ‹æ–‡ä»¶ç³»ç»Ÿçš„inodeæ€»æ•°</p>\n</li>\n</ul>\n<blockquote>\n<p>ä¸€ä¸ªinodeåªå¯¹åº”ä¸€ä¸ªå®é™…æ–‡ä»¶ï¼Œæ‰€ä»¥inodesæœ€å¤§æ•°é‡å°±æ˜¯æ–‡ä»¶çš„æœ€å¤§æ•°é‡ã€‚</p>\n</blockquote>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹æ‰€æœ‰æŒ‚è½½ç£ç›˜</span></span><br><span class=\"line\"><span class=\"built_in\">df</span> -i</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹æŒ‡å®šç£ç›˜</span></span><br><span class=\"line\"><span class=\"built_in\">df</span> -i /dev/xvda1</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¸åŒçš„æ–‡ä»¶ç³»ç»Ÿé»˜è®¤çš„inodeæ•°é‡ä¸åŒï¼Œä»¥<code>1G</code>ç£ç›˜ç©ºé—´ä¸ºä¾‹ï¼Œ<code>ext4</code>æ–‡ä»¶ç³»ç»Ÿé»˜è®¤ä¸º<code>65536</code>ï¼Œ<code>xfs</code>æ–‡ä»¶ç³»ç»Ÿé»˜è®¤ä¸º<code>52ä¸‡</code>(æ¯2kè®¾ç½®ä¸€ä¸ªinode)ï¼Œå¹¶ä¸”<code>xfs</code>ä¼šåŠ¨æ€æ‰©å®¹inodeæ•°é‡ã€‚</p>\n</li>\n</ul>\n","content_text":"æ‘˜è¦ è§£å†³Linuxç´¢å¼•èŠ‚ç‚¹(inode)ç”¨æ»¡å¯¼è‡´æ•…éšœçš„æ–¹æ³• zabbixå‘Šè­¦ 1vfs.fs.inode[/,pfree]):5 % è§£å†³è¿‡ç¨‹ ç™»å½•linuxç³»ç»ŸåæŸ¥çœ‹inodeä½¿ç”¨æƒ…å†µå’Œç£ç›˜ä½¿ç”¨æƒ…å†µ 1234567891011# inode ä¸è¶³äº†df -hiæ–‡ä»¶ç³»ç»Ÿ Inode å·²ç”¨(I) å¯ç”¨(I) å·²ç”¨(I)%% æŒ‚è½½ç‚¹/dev/xvda1 1.9M 1.8M 96K 96% /tmpfs 251K 1 251K 1% /dev/shm# disk å……è¶³df -hTæ–‡ä»¶ç³»ç»Ÿ ç±»å‹ å®¹é‡ å·²ç”¨ å¯ç”¨ å·²ç”¨%% æŒ‚è½½ç‚¹/dev/xvda1 ext4 30G 18G 12G 61% /tmpfs tmpfs 1003M 0 1003M 0% /dev/shm æ ¹æ®ä¸Šé¢çš„æŸ¥è¯¢ç»“æœåˆæ­¥åˆ¤æ–­æ˜¯ç³»ç»Ÿäº§ç”Ÿäº†å¤§é‡çš„ä¸´æ—¶æ–‡ä»¶å¯¼è‡´inodeç”¨å°½äº† æ’æŸ¥åˆ°åº•å“ªä¸ªç›®å½•ä¸‹çš„æ–‡ä»¶æ•°è¿‡å¤š 1234567891011121314151617181920212223242526272829303132333435# é€šè¿‡ä¸‹é¢çš„å‘½ä»¤ç»Ÿè®¡æ–‡ä»¶æ•°é‡å‰ååï¼Œè¿™é‡Œå‘ç°æ˜¯/varç›®å½•ä¸­æ–‡ä»¶å¼‚å¸¸çš„å¤šfor i in /*; do echo &quot;$(find $i |wc -l):$i&quot;; done | sort -nr | head -n 101815728:/var52498:/usr18804:/proc7333:/sys1834:/lib1447:/opt1047:/etc457:/dev411:/lib64245:/sbin# æ¥ç€æŸ¥çœ‹/varä¸­çš„æ–‡ä»¶æ•°é‡for i in /var/*; do echo &quot;$(find $i |wc -l):$i&quot;; done | sort -nr | head -n 101813442:/var/spool2033:/var/lib85:/var/cache82:/var/log39:/var/run24:/var/lock7:/var/db3:/var/yp2:/var/empty2:/var/account# æ¥ç€æŸ¥çœ‹/var/spoolä¸­çš„æ–‡ä»¶æ•°é‡ï¼Œè¿™é‡ŒåŸºæœ¬å®šä½åˆ°æ˜¯/var/spool/clientmqueueç›®å½•for i in /var/spool/*; do echo &quot;$(find $i |wc -l):$i&quot;; done | sort -nr | head -n 101812413:/var/spool/clientmqueue7:/var/spool/mail4:/var/spool/anacron3:/var/spool/at2:/var/spool/cron1:/var/spool/mqueue1:/var/spool/lpd ç™¾åº¦ä¸€ä¸‹/var/spool/clientmqueueç›®å½•çš„ä½œç”¨ 123â€ŒLinuxæ–‡ä»¶ç›®å½• /var/spool/clientmqueue/ ä¸‹çš„æ–‡ä»¶ä¸»è¦æ˜¯ç”±cronä»»åŠ¡äº§ç”Ÿçš„è¾“å‡ºæ–‡ä»¶ã€‚â€Œ å½“cronä»»åŠ¡ä¸­æœ‰è¾“å‡ºå†…å®¹æ—¶ï¼Œå¦‚æœæœåŠ¡å™¨ä¸Šæ²¡æœ‰é…ç½®sendmailæœåŠ¡ï¼Œè¿™äº›è¾“å‡ºå†…å®¹å°±ä¼šè¢«ä¿å­˜åˆ° /var/spool/clientmqueue/ ç›®å½•å†…ã€‚è¿™æ˜¯å› ä¸ºcronä»»åŠ¡ä¸­çš„å‘½ä»¤å¦‚æœæœ‰è¾“å‡ºï¼ˆæ¯”å¦‚é”™è¯¯ä¿¡æ¯æˆ–è€…æ­£å¸¸çš„è¾“å‡ºä¿¡æ¯ï¼‰ï¼Œé»˜è®¤ä¼šé€šè¿‡sendmailå‘é€ï¼Œä½†å¦‚æœæœåŠ¡å™¨ä¸Šæ²¡æœ‰é…ç½®sendmailæœåŠ¡ï¼Œè¿™äº›è¾“å‡ºå†…å®¹å°±ä¼šè¢«ä¿å­˜åˆ° /var/spool/clientmqueue/ ç›®å½•ä¸­ã€‚å› æ­¤ï¼Œè¿™ä¸ªç›®å½•ä¸‹ä¸»è¦åŒ…å«çš„æ˜¯ç”±cronä»»åŠ¡äº§ç”Ÿçš„è¾“å‡ºæ–‡ä»¶ï¼Œè¿™äº›æ–‡ä»¶è®°å½•äº†cronä»»åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­çš„è¾“å‡ºä¿¡æ¯ã€‚å¦‚æœéœ€è¦å¤„ç†è¿™äº›æ–‡ä»¶ï¼Œå¯ä»¥é€šè¿‡ä¿®æ”¹crontabé…ç½®æ¥å®ç°ã€‚å…·ä½“æ¥è¯´ï¼Œå¯ä»¥åœ¨æ¯ä¸ªcronä»»åŠ¡å‘½ä»¤çš„æœ«å°¾æ·»åŠ é‡å®šå‘æ“ä½œï¼Œå°†è¾“å‡ºå†…å®¹æŠ›å¼ƒï¼Œä¾‹å¦‚ä½¿ç”¨å‘½ä»¤ &gt;/dev/null 2&gt;&amp;1ã€‚è¿™æ ·ï¼Œæ— è®ºæ ‡å‡†è¾“å‡ºè¿˜æ˜¯é”™è¯¯è¾“å‡ºéƒ½ä¼šè¢«é‡å®šå‘åˆ° /dev/nullï¼Œå³è¢«æŠ›å¼ƒï¼Œä»è€Œé¿å…åœ¨ /var/spool/clientmqueue/ ç›®å½•ä¸‹äº§ç”Ÿä¸å¿…è¦çš„æ–‡ä»¶ã€‚ ä¸Šé¢çš„è§£é‡Šè¯´æ˜/var/spool/clientmqueueç›®å½•ä¸‹çš„æ–‡ä»¶å¯ä»¥è¢«åˆ é™¤ï¼Œæ‰€ä»¥ç›´æ¥åˆ äº†å°±å¯ä»¥è§£å†³è¯¥é—®é¢˜äº† 12345# æ–‡ä»¶æ•°é‡è¿‡å¤šï¼Œä¸èƒ½è¿™ä¹ˆåˆ é™¤# rm -rf /var/spool/clientmqueue/*# æ­£ç¡®æ–¹æ³•find /var/spool/clientmqueue -name &quot;*&quot; -type f | xargs rm -rf è¯¦è§£inode inodeæ˜¯æ–‡ä»¶ç³»ç»Ÿå†…ä¸€ä¸ªé‡è¦çš„æ•°æ®ç»“æ„ï¼Œå®ƒç”¨æ¥æè¿°ä¸€ä¸ªæ–‡ä»¶ï¼ŒåŒ…æ‹¬æ–‡ä»¶åã€æ–‡ä»¶ç±»å‹ã€æƒé™ã€æ‰€æœ‰è€…ã€åˆ›å»ºæ—¶é—´ã€ä¿®æ”¹æ—¶é—´ç­‰ã€‚åœ¨Linuxç³»ç»Ÿä¸­ï¼Œæ¯ä¸ªæ–‡ä»¶éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„inodeå·ï¼Œè¿™ä¸ªinodeå·æ˜¯åˆ†é…ç»™è¯¥æ–‡ä»¶çš„ï¼Œå¹¶ä¸”ä¸èƒ½è¢«æ”¹å˜ã€‚ 12# æŸ¥çœ‹å½“å‰ç›®å½•çš„inodeå·ls -li æ“ä½œç³»ç»Ÿæ‰“å¼€æ–‡ä»¶æ—¶ä¼šæŒ‰å¦‚ä¸‹æ­¥éª¤æ‰§è¡Œï¼š æŸ¥æ‰¾æ–‡ä»¶åç§°å¯¹åº”çš„inodeå· æ ¹æ®inodeå·è·å–inodeä¿¡æ¯ æ ¹æ®inodeä¿¡æ¯æ‰¾åˆ°æ–‡ä»¶å¯¹åº”çš„æ•°æ®å—ï¼Œè¯»å‡ºæ•°æ® inodeçš„å¤§å°æ˜¯æœ‰é™åˆ¶çš„ï¼Œé€šå¸¸å–å†³äºæ–‡ä»¶ç³»ç»Ÿå’Œæ“ä½œç³»ç»Ÿã€‚åœ¨å¤§å¤šæ•°Linuxæ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œinodeå¤§å°é€šå¸¸æ˜¯128å­—èŠ‚æˆ–256å­—èŠ‚ã€‚è¿™æ˜¯ç”±æ–‡ä»¶ç³»ç»Ÿåœ¨æ ¼å¼åŒ–æ—¶å†³å®šçš„ï¼Œå¹¶ä¸”æ ¼å¼åŒ–åä¸èƒ½æ›´æ”¹ã€‚ 1234# æŸ¥çœ‹inodeå¤§å°dumpe2fs /dev/xvda1 | grep &quot;Inode size&quot;dumpe2fs 1.43.5 (04-Aug-2017)Inode size: 256 æŸ¥çœ‹æ–‡ä»¶ç³»ç»Ÿçš„inodeæ€»æ•° ä¸€ä¸ªinodeåªå¯¹åº”ä¸€ä¸ªå®é™…æ–‡ä»¶ï¼Œæ‰€ä»¥inodesæœ€å¤§æ•°é‡å°±æ˜¯æ–‡ä»¶çš„æœ€å¤§æ•°é‡ã€‚ 12345# æŸ¥çœ‹æ‰€æœ‰æŒ‚è½½ç£ç›˜df -i# æŸ¥çœ‹æŒ‡å®šç£ç›˜df -i /dev/xvda1 ä¸åŒçš„æ–‡ä»¶ç³»ç»Ÿé»˜è®¤çš„inodeæ•°é‡ä¸åŒï¼Œä»¥1Gç£ç›˜ç©ºé—´ä¸ºä¾‹ï¼Œext4æ–‡ä»¶ç³»ç»Ÿé»˜è®¤ä¸º65536ï¼Œxfsæ–‡ä»¶ç³»ç»Ÿé»˜è®¤ä¸º52ä¸‡(æ¯2kè®¾ç½®ä¸€ä¸ªinode)ï¼Œå¹¶ä¸”xfsä¼šåŠ¨æ€æ‰©å®¹inodeæ•°é‡ã€‚","summary":"æ‘˜è¦ è§£å†³Linuxç´¢å¼•èŠ‚ç‚¹(inode)ç”¨æ»¡å¯¼è‡´æ•…éšœçš„æ–¹æ³•","date_published":"2024-09-05T14:30:05.000Z","tags":["æŠ€æœ¯","linux","zabbix","linux","zabbix"]},{"id":"https://blog.hanqunfeng.com/2024/08/02/gradle-depoly-maven-center-repository-new/","url":"https://blog.hanqunfeng.com/2024/08/02/gradle-depoly-maven-center-repository-new/","title":"å‘å¸ƒJaråˆ°Mavenä¸­å¤®ä»“åº“--Gradleç‰ˆ(æœ€æ–°æ–¹å¼)","content_html":"<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\"><a href=\"https://oss.sonatype.org\">https://oss.sonatype.org</a>å·²ç»ä¸å†æ”¯æŒæ–°ç”¨æˆ·æ³¨å†Œï¼Œæ–°çš„æ³¨å†Œåœ°å€ä¸º<a href=\"https://central.sonatype.com\">https://central.sonatype.com</a></li>\n<li class=\"lvl-2\">é€šè¿‡æœ¬æ–‡ï¼Œä½ å°†çŸ¥é“å¦‚ä½•å°†Gradleæ„å»ºçš„é¡¹ç›®å‘å¸ƒåˆ°Mavenä¸­å¤®ä»“åº“</li>\n<li class=\"lvl-2\">Mavenæ„å»ºæ–¹å¼è¯·çœ‹ <a href=\"/2024/08/01/mvn-depoly-maven-center-repository-new/\" title=\"å‘å¸ƒJaråˆ°Mavenä¸­å¤®ä»“åº“--Mavenç‰ˆ(æœ€æ–°æ–¹å¼)\">å‘å¸ƒJaråˆ°Mavenä¸­å¤®ä»“åº“--Mavenç‰ˆ(æœ€æ–°æ–¹å¼)</a> ã€‚</li>\n<li class=\"lvl-2\">å‰ä¸‰ä¸ªæ­¥éª¤ä¸ <a href=\"/2024/08/01/mvn-depoly-maven-center-repository-new/\" title=\"å‘å¸ƒJaråˆ°Mavenä¸­å¤®ä»“åº“--Mavenç‰ˆ(æœ€æ–°æ–¹å¼)\">å‘å¸ƒJaråˆ°Mavenä¸­å¤®ä»“åº“--Mavenç‰ˆ(æœ€æ–°æ–¹å¼)</a> ç›¸åŒï¼Œä¸åœ¨èµ˜è¿°ã€‚</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"ä¸€ã€å°†é¡¹ç›®æ¨é€åˆ°è¿œç¨‹ä»“åº“ï¼Œå¦‚-Githubæˆ–è€…Gitee\">ä¸€ã€å°†é¡¹ç›®æ¨é€åˆ°è¿œç¨‹ä»“åº“ï¼Œå¦‚ <code>Github</code>æˆ–è€…<code>Gitee</code></h2>\n<h2 id=\"äºŒã€æ³¨å†Œ-Sonatype-è´¦æˆ·\">äºŒã€æ³¨å†Œ <code>Sonatype</code> è´¦æˆ·</h2>\n<h2 id=\"ä¸‰ã€ç™»å½•-Sonatype-åˆ›å»ºNamespace\">ä¸‰ã€ç™»å½• Sonatype åˆ›å»º<code>Namespace</code></h2>\n<p>å‰ä¸‰ä¸ªæ­¥éª¤ä¸ <a href=\"/2024/08/01/mvn-depoly-maven-center-repository-new/\" title=\"å‘å¸ƒJaråˆ°Mavenä¸­å¤®ä»“åº“--Mavenç‰ˆ(æœ€æ–°æ–¹å¼)\">å‘å¸ƒJaråˆ°Mavenä¸­å¤®ä»“åº“--Mavenç‰ˆ(æœ€æ–°æ–¹å¼)</a> ç›¸åŒï¼Œä¸åœ¨èµ˜è¿°ã€‚</p>\n<h2 id=\"å››ã€å‘å¸ƒ\">å››ã€å‘å¸ƒ</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç­¾å<br>\næˆ‘æ˜¯macç”µè„‘ï¼Œäºæ˜¯ç­¾åå·¥å…·ä½¿ç”¨çš„æ˜¯<a href=\"https://gpgtools.org\">https://gpgtools.org</a>ï¼Œgradleç­¾åæ—¶éœ€è¦ä½¿ç”¨åˆ°<code>.gpg</code>è¯ä¹¦æ–‡ä»¶ï¼Œè¿™ä¸ªå·¥å…·ä¸æ”¯æŒç›´æ¥å¯¼å‡º<code>.gpg</code>ï¼Œå…¶å¯¼å‡ºçš„è¯ä¹¦æ–‡ä»¶æ˜¯<code>.asc</code>æ ¼å¼çš„ï¼Œ<code>asc</code>å…¶å®å°±æ˜¯<code>å­—ç¬¦ä¸²</code>ï¼Œå¯ä»¥ç”¨è®°äº‹æœ¬æ‰“å¼€æŸ¥çœ‹ã€‚</p>\n<p>ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤å¯¼å‡º<code>.gpg</code>æ ¼å¼çš„è¯ä¹¦ï¼š</p>\n  <figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åˆ—å‡ºå½“å‰å…¨éƒ¨è¯ä¹¦</span></span><br><span class=\"line\">gpg -k</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å¯¼å‡ºç§é’¥ï¼Œqunfeng_han@126.comæ˜¯åˆ›å»ºè¯ä¹¦æ—¶ä½¿ç”¨çš„é‚®ç®±ï¼Œä¼šè¦æ±‚ä½ è¾“å…¥åˆ›å»ºè¯ä¹¦æ—¶çš„å¯†ç </span></span><br><span class=\"line\">gpg --output private.pgp --armor --export-secret-key qunfeng_han@126.com</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å¯¼å‡ºå…¬é’¥</span></span><br><span class=\"line\">gpg --output public.pgp --armor --<span class=\"built_in\">export</span> qunfeng_han@126.com</span><br></pre></td></tr></table></figure>\n</li>\n<li class=\"lvl-2\">\n<p>build.gradle<br>\nå®˜æ–¹æ²¡æœ‰å‡ºgradleå‘å¸ƒæ’ä»¶ï¼Œä½†æ˜¯<a href=\"https://central.sonatype.org/publish/publish-portal-gradle/\">å®˜ç½‘</a>æ¨èä½¿ç”¨ç¬¬ä¸‰æ–¹çš„<a href=\"https://jreleaser.org/guide/latest/examples/maven/maven-central.html#_gradle\">jreleaser</a>æ’ä»¶ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight gradle\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">plugins &#123;</span><br><span class=\"line\"><span class=\"comment\">//    id &#x27;io.spring.dependency-management&#x27; version &#x27;1.0.10.RELEASE&#x27;</span></span><br><span class=\"line\">    id <span class=\"string\">&#x27;io.spring.dependency-management&#x27;</span> version <span class=\"string\">&#x27;1.1.6&#x27;</span></span><br><span class=\"line\">    <span class=\"comment\">//æ­¤å¤„å¿…é¡»æ˜¯java-libraryï¼Œå¦‚æœæ˜¯javaåˆ™apiæ–¹æ³•ä¸å¯ç”¨ï¼Œapiå¯ä»¥ç†è§£ä¸ºå°±æ˜¯compileï¼Œæ”¯æŒä¼ é€’ä¾èµ–</span></span><br><span class=\"line\">    id <span class=\"string\">&#x27;java-library&#x27;</span></span><br><span class=\"line\">    <span class=\"comment\">//å‘å¸ƒæ’ä»¶</span></span><br><span class=\"line\">    id <span class=\"string\">&#x27;maven-publish&#x27;</span></span><br><span class=\"line\">    <span class=\"comment\">//è‡ªåŠ¨å‘å¸ƒåˆ°mavenä¸­å¤®ä»“åº“æ’ä»¶</span></span><br><span class=\"line\">    <span class=\"comment\">//https://jreleaser.org/guide/latest/examples/maven/maven-central.html#_gradle</span></span><br><span class=\"line\">    id <span class=\"string\">&#x27;org.jreleaser&#x27;</span> version <span class=\"string\">&#x27;1.13.1&#x27;</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">group</span> = <span class=\"string\">&#x27;io.github.hanqunfeng&#x27;</span></span><br><span class=\"line\"><span class=\"comment\">//version = &#x27;1.0.0-SNAPSHOT&#x27;</span></span><br><span class=\"line\">version = <span class=\"string\">&#x27;1.0.1&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">sourceCompatibility</span> = <span class=\"string\">&#x27;1.8&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">java &#123;</span><br><span class=\"line\">    withJavadocJar()</span><br><span class=\"line\">    withSourcesJar()</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">repositories</span> &#123;</span><br><span class=\"line\">    maven &#123; url <span class=\"string\">&#x27;https://maven.aliyun.com/repository/public/&#x27;</span> &#125;</span><br><span class=\"line\">    mavenLocal()</span><br><span class=\"line\">    mavenCentral()</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">dependencyManagement &#123;</span><br><span class=\"line\">    imports &#123; mavenBom(<span class=\"string\">&quot;software.amazon.awssdk:bom:2.23.10&quot;</span>) &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">dependencies</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">//lombok</span></span><br><span class=\"line\">    compileOnly <span class=\"string\">&#x27;org.projectlombok:lombok:1.18.32&#x27;</span></span><br><span class=\"line\">    annotationProcessor <span class=\"string\">&#x27;org.projectlombok:lombok:1.18.32&#x27;</span></span><br><span class=\"line\">    api <span class=\"string\">&#x27;software.amazon.awssdk:s3&#x27;</span></span><br><span class=\"line\">    api <span class=\"string\">&#x27;software.amazon.awssdk:apache-client&#x27;</span></span><br><span class=\"line\">    api <span class=\"string\">&#x27;software.amazon.awssdk:s3-transfer-manager&#x27;</span></span><br><span class=\"line\">    api <span class=\"string\">&#x27;software.amazon.awssdk:aws-crt-client&#x27;</span></span><br><span class=\"line\">    api <span class=\"string\">&#x27;org.springframework:spring-core:5.3.29&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// javaç¼–è¯‘çš„æ—¶å€™ç¼ºçœçŠ¶æ€ä¸‹ä¼šå› ä¸ºä¸­æ–‡å­—ç¬¦è€Œå¤±è´¥</span></span><br><span class=\"line\">[compileJava, compileTestJava]*.<span class=\"keyword\">options</span>*.encoding = <span class=\"string\">&#x27;UTF-8&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * å‘å¸ƒæ’ä»¶</span></span><br><span class=\"line\"><span class=\"comment\"> * å‚è€ƒï¼šhttps://docs.gradle.org/6.6.1/userguide/publishing_maven.html#publishing_maven:resolved_dependencies</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * å‘å¸ƒä¸ºbomï¼Œå‚è€ƒï¼šhttps://zhuanlan.zhihu.com/p/195678201</span></span><br><span class=\"line\"><span class=\"comment\"> * æ³¨æ„ï¼šjava-platformä¸èƒ½ä¸javaå’Œjava-libraryåŒæ—¶å­˜åœ¨</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\">publishing &#123;</span><br><span class=\"line\">    publications &#123;</span><br><span class=\"line\">        maven(MavenPublication) &#123;</span><br><span class=\"line\">            groupId = <span class=\"keyword\">project</span>.<span class=\"keyword\">group</span></span><br><span class=\"line\">            artifactId = <span class=\"keyword\">project</span>.name</span><br><span class=\"line\">            version = <span class=\"keyword\">project</span>.version</span><br><span class=\"line\">            <span class=\"comment\">//å¦‚æœä¸å®šä¹‰ï¼Œåˆ™ä¼šæŒ‰ç…§ä»¥ä¸Šé»˜è®¤å€¼æ‰§è¡Œ</span></span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">from</span> components.java</span><br><span class=\"line\"></span><br><span class=\"line\">            pom &#123;</span><br><span class=\"line\">                name = <span class=\"string\">&#x27;aws-s3-v2-tools-gradle&#x27;</span></span><br><span class=\"line\">                <span class=\"keyword\">description</span> = <span class=\"string\">&#x27;AWS S3 Tools.&#x27;</span></span><br><span class=\"line\">                url = <span class=\"string\">&#x27;https://blog.hanqunfeng.com&#x27;</span></span><br><span class=\"line\">                licenses &#123;</span><br><span class=\"line\">                    license &#123;</span><br><span class=\"line\">                        name = <span class=\"string\">&#x27;The Apache License, Version 2.0&#x27;</span></span><br><span class=\"line\">                        url = <span class=\"string\">&#x27;http://www.apache.org/licenses/LICENSE-2.0.txt&#x27;</span></span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                developers &#123;</span><br><span class=\"line\">                    developer &#123;</span><br><span class=\"line\">                        id = <span class=\"string\">&#x27;hanqf&#x27;</span></span><br><span class=\"line\">                        name = <span class=\"string\">&#x27;han qunfeng&#x27;</span></span><br><span class=\"line\">                        email = <span class=\"string\">&#x27;qunfeng_han@126.com&#x27;</span></span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                scm &#123;</span><br><span class=\"line\">                    connection = <span class=\"string\">&#x27;scm:git:https://github.com/hanqunfeng/aws-s3-v2-tools-gradle.git&#x27;</span></span><br><span class=\"line\">                    developerConnection = <span class=\"string\">&#x27;scm:git:https://github.com:hanqunfeng/aws-s3-v2-tools-gradle.git&#x27;</span></span><br><span class=\"line\">                    url = <span class=\"string\">&#x27;https://github.com/hanqunfeng/aws-s3-v2-tools-gradle&#x27;</span></span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            versionMapping &#123;</span><br><span class=\"line\">                usage(<span class=\"string\">&#x27;java-api&#x27;</span>) &#123;</span><br><span class=\"line\">                    fromResolutionOf(<span class=\"string\">&#x27;runtimeClasspath&#x27;</span>)</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                usage(<span class=\"string\">&#x27;java-runtime&#x27;</span>) &#123;</span><br><span class=\"line\">                    fromResolutionResult()</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">repositories</span> &#123;</span><br><span class=\"line\">        maven &#123;</span><br><span class=\"line\">            url = layout.buildDirectory.dir(<span class=\"string\">&#x27;staging-deploy&#x27;</span>)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">tasks.withType(JavaCompile) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">options</span>.encoding = <span class=\"string\">&#x27;UTF-8&#x27;</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//javadocï¼Œå¦‚æœç”¨jdk11ï¼Œé»˜è®¤å°±æ”¯æŒä¸­æ–‡</span></span><br><span class=\"line\"><span class=\"comment\">//æŸ¥çœ‹å¯ä»¥é…ç½®çš„å±æ€§ï¼šhttps://docs.gradle.org/current/javadoc/org/gradle/external/javadoc/StandardJavadocDocletOptions.html</span></span><br><span class=\"line\">tasks.withType(Javadoc) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">options</span>.version = <span class=\"keyword\">true</span></span><br><span class=\"line\">    <span class=\"keyword\">options</span>.author = <span class=\"keyword\">true</span></span><br><span class=\"line\">    <span class=\"keyword\">options</span>.encoding = <span class=\"string\">&quot;UTF-8&quot;</span></span><br><span class=\"line\">    <span class=\"keyword\">options</span>.charSet = <span class=\"string\">&quot;UTF-8&quot;</span>  <span class=\"comment\">//è§£å†³ä¸­æ–‡ä¹±ç </span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">javadoc &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (JavaVersion.current().isJava9Compatible()) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">options</span>.addBooleanOption(<span class=\"string\">&#x27;html5&#x27;</span>, <span class=\"keyword\">true</span>)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (JavaVersion.current().isJava8Compatible()) &#123;</span><br><span class=\"line\">        tasks.withType(Javadoc) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// disable the crazy super-strict doclint tool in Java 8</span></span><br><span class=\"line\">            <span class=\"comment\">// noinspection SpellCheckingInspection</span></span><br><span class=\"line\">            <span class=\"keyword\">options</span>.addStringOption(<span class=\"string\">&#x27;Xdoclint:none&#x27;</span>, <span class=\"string\">&#x27;-quiet&#x27;</span>)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// jreleaseré…ç½®æ–‡ä»¶ï¼š~/.jreleaser/config.toml</span></span><br><span class=\"line\"><span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">JRELEASER_MAVENCENTRAL_USERNAME = &quot;&lt;your-publisher-portal-username&gt;&quot;</span></span><br><span class=\"line\"><span class=\"comment\">JRELEASER_MAVENCENTRAL_PASSWORD = &quot;&lt;your-publisher-portal-password&gt;&quot;</span></span><br><span class=\"line\"><span class=\"comment\">JRELEASER_NEXUS2_USERNAME = &quot;&lt;your-sonatype-account-username&gt;&quot;</span></span><br><span class=\"line\"><span class=\"comment\">JRELEASER_NEXUS2_PASSWORD = &quot;&lt;your-sonatype-account-password&gt;&quot;</span></span><br><span class=\"line\"><span class=\"comment\">JRELEASER_GPG_PASSPHRASE = &quot;&lt;your-pgp-passphrase&gt;&quot;</span></span><br><span class=\"line\"><span class=\"comment\">JRELEASER_GITHUB_TOKEN = &quot;&lt;your-github-token&quot;</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\">jreleaser &#123;</span><br><span class=\"line\">    signing &#123;</span><br><span class=\"line\">        active = <span class=\"string\">&#x27;ALWAYS&#x27;</span></span><br><span class=\"line\">        armored = <span class=\"keyword\">true</span></span><br><span class=\"line\">        mode = <span class=\"string\">&#x27;FILE&#x27;</span></span><br><span class=\"line\">        publicKey = <span class=\"string\">&#x27;/Users/hanqf/develop_soft/gpg_key/hanqf/public.pgp&#x27;</span></span><br><span class=\"line\">        secretKey = <span class=\"string\">&#x27;/Users/hanqf/develop_soft/gpg_key/hanqf/private.pgp&#x27;</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    deploy &#123;</span><br><span class=\"line\">        maven &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">/* Portal Publisher API */</span></span><br><span class=\"line\">            mavenCentral &#123;</span><br><span class=\"line\">                sonatype &#123;</span><br><span class=\"line\">                    active = <span class=\"string\">&#x27;ALWAYS&#x27;</span></span><br><span class=\"line\">                    url = <span class=\"string\">&#x27;https://central.sonatype.com/api/v1/publisher&#x27;</span></span><br><span class=\"line\">                    stagingRepository(<span class=\"string\">&#x27;build/staging-deploy&#x27;</span>)</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>~/.jreleaser/config.toml ï¼šé…ç½®ç›¸å…³è®¤è¯ä¿¡æ¯</p>\n</li>\n</ul>\n<figure class=\"highlight properties\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># https://central.sonatype.com çš„è®¤è¯ä¿¡æ¯</span></span><br><span class=\"line\"><span class=\"attr\">JRELEASER_MAVENCENTRAL_USERNAME</span> = <span class=\"string\">&quot;&lt;your-publisher-portal-username&gt;&quot;</span></span><br><span class=\"line\"><span class=\"attr\">JRELEASER_MAVENCENTRAL_PASSWORD</span> = <span class=\"string\">&quot;&lt;your-publisher-portal-password&gt;&quot;</span></span><br><span class=\"line\"><span class=\"comment\"># https://oss.sonatype.org çš„è®¤è¯ä¿¡æ¯ï¼Œè¿™é‡Œæ²¡æœ‰ç”¨åˆ°ï¼Œå¯ä»¥ä¸è¿›è¡Œé…ç½®</span></span><br><span class=\"line\"><span class=\"attr\">JRELEASER_NEXUS2_USERNAME</span> = <span class=\"string\">&quot;&lt;your-sonatype-account-username&gt;&quot;</span></span><br><span class=\"line\"><span class=\"attr\">JRELEASER_NEXUS2_PASSWORD</span> = <span class=\"string\">&quot;&lt;your-sonatype-account-password&gt;&quot;</span></span><br><span class=\"line\"><span class=\"comment\"># åˆ›å»º pgp å¯†é’¥æ—¶çš„å¯†ç </span></span><br><span class=\"line\"><span class=\"attr\">JRELEASER_GPG_PASSPHRASE</span> = <span class=\"string\">&quot;&lt;your-pgp-passphrase&gt;&quot;</span></span><br><span class=\"line\"><span class=\"comment\"># github token</span></span><br><span class=\"line\"><span class=\"attr\">JRELEASER_GITHUB_TOKEN</span> = <span class=\"string\">&quot;&lt;your-github-token&quot;</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ‰§è¡Œå‘½ä»¤</p>\n</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">./gradlew jreleaserConfig <span class=\"comment\"># éªŒè¯é…ç½®æ–‡ä»¶æ˜¯å¦æ­£ç¡®</span></span><br><span class=\"line\">./gradlew clean publish <span class=\"comment\"># å‘å¸ƒåˆ°æœ¬åœ° build/staging-deploy</span></span><br><span class=\"line\">./gradlew jreleaserFullRelease <span class=\"comment\"># å‘å¸ƒåˆ°è¿œç¨‹Mavenä¸­å¤®ä»“åº“</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ›´æ–°éƒ¨ç½²<br>\nä¸ <a href=\"/2024/08/01/mvn-depoly-maven-center-repository-new/\" title=\"å‘å¸ƒJaråˆ°Mavenä¸­å¤®ä»“åº“--Mavenç‰ˆ(æœ€æ–°æ–¹å¼)\">å‘å¸ƒJaråˆ°Mavenä¸­å¤®ä»“åº“--Mavenç‰ˆ(æœ€æ–°æ–¹å¼)</a> ä¸­çš„æè¿°ç±»ä¼¼ï¼Œåªéœ€è¦ä¿®æ”¹<code>build.gradle</code>ä¸­å¯¹åº”çš„ç‰ˆæœ¬å·åé‡æ–°æ‰§è¡Œä¸Šé¢çš„å‘å¸ƒå‘½ä»¤å³å¯ï¼Œå‘å¸ƒçš„jaråŒ…å¯ä»¥åœ¨<a href=\"https://central.sonatype.com\">https://central.sonatype.com</a>ä¸­æ£€ç´¢ã€‚</p>\n</li>\n</ul>\n","content_text":"æ‘˜è¦ https://oss.sonatype.orgå·²ç»ä¸å†æ”¯æŒæ–°ç”¨æˆ·æ³¨å†Œï¼Œæ–°çš„æ³¨å†Œåœ°å€ä¸ºhttps://central.sonatype.com é€šè¿‡æœ¬æ–‡ï¼Œä½ å°†çŸ¥é“å¦‚ä½•å°†Gradleæ„å»ºçš„é¡¹ç›®å‘å¸ƒåˆ°Mavenä¸­å¤®ä»“åº“ Mavenæ„å»ºæ–¹å¼è¯·çœ‹ å‘å¸ƒJaråˆ°Mavenä¸­å¤®ä»“åº“--Mavenç‰ˆ(æœ€æ–°æ–¹å¼) ã€‚ å‰ä¸‰ä¸ªæ­¥éª¤ä¸ å‘å¸ƒJaråˆ°Mavenä¸­å¤®ä»“åº“--Mavenç‰ˆ(æœ€æ–°æ–¹å¼) ç›¸åŒï¼Œä¸åœ¨èµ˜è¿°ã€‚ ä¸€ã€å°†é¡¹ç›®æ¨é€åˆ°è¿œç¨‹ä»“åº“ï¼Œå¦‚ Githubæˆ–è€…Gitee äºŒã€æ³¨å†Œ Sonatype è´¦æˆ· ä¸‰ã€ç™»å½• Sonatype åˆ›å»ºNamespace å‰ä¸‰ä¸ªæ­¥éª¤ä¸ å‘å¸ƒJaråˆ°Mavenä¸­å¤®ä»“åº“--Mavenç‰ˆ(æœ€æ–°æ–¹å¼) ç›¸åŒï¼Œä¸åœ¨èµ˜è¿°ã€‚ å››ã€å‘å¸ƒ ç­¾å æˆ‘æ˜¯macç”µè„‘ï¼Œäºæ˜¯ç­¾åå·¥å…·ä½¿ç”¨çš„æ˜¯https://gpgtools.orgï¼Œgradleç­¾åæ—¶éœ€è¦ä½¿ç”¨åˆ°.gpgè¯ä¹¦æ–‡ä»¶ï¼Œè¿™ä¸ªå·¥å…·ä¸æ”¯æŒç›´æ¥å¯¼å‡º.gpgï¼Œå…¶å¯¼å‡ºçš„è¯ä¹¦æ–‡ä»¶æ˜¯.ascæ ¼å¼çš„ï¼Œascå…¶å®å°±æ˜¯å­—ç¬¦ä¸²ï¼Œå¯ä»¥ç”¨è®°äº‹æœ¬æ‰“å¼€æŸ¥çœ‹ã€‚ ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤å¯¼å‡º.gpgæ ¼å¼çš„è¯ä¹¦ï¼š 12345678# åˆ—å‡ºå½“å‰å…¨éƒ¨è¯ä¹¦gpg -k# å¯¼å‡ºç§é’¥ï¼Œqunfeng_han@126.comæ˜¯åˆ›å»ºè¯ä¹¦æ—¶ä½¿ç”¨çš„é‚®ç®±ï¼Œä¼šè¦æ±‚ä½ è¾“å…¥åˆ›å»ºè¯ä¹¦æ—¶çš„å¯†ç gpg --output private.pgp --armor --export-secret-key qunfeng_han@126.com# å¯¼å‡ºå…¬é’¥gpg --output public.pgp --armor --export qunfeng_han@126.com build.gradle å®˜æ–¹æ²¡æœ‰å‡ºgradleå‘å¸ƒæ’ä»¶ï¼Œä½†æ˜¯å®˜ç½‘æ¨èä½¿ç”¨ç¬¬ä¸‰æ–¹çš„jreleaseræ’ä»¶ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170plugins &#123;// id &#x27;io.spring.dependency-management&#x27; version &#x27;1.0.10.RELEASE&#x27; id &#x27;io.spring.dependency-management&#x27; version &#x27;1.1.6&#x27; //æ­¤å¤„å¿…é¡»æ˜¯java-libraryï¼Œå¦‚æœæ˜¯javaåˆ™apiæ–¹æ³•ä¸å¯ç”¨ï¼Œapiå¯ä»¥ç†è§£ä¸ºå°±æ˜¯compileï¼Œæ”¯æŒä¼ é€’ä¾èµ– id &#x27;java-library&#x27; //å‘å¸ƒæ’ä»¶ id &#x27;maven-publish&#x27; //è‡ªåŠ¨å‘å¸ƒåˆ°mavenä¸­å¤®ä»“åº“æ’ä»¶ //https://jreleaser.org/guide/latest/examples/maven/maven-central.html#_gradle id &#x27;org.jreleaser&#x27; version &#x27;1.13.1&#x27;&#125;group = &#x27;io.github.hanqunfeng&#x27;//version = &#x27;1.0.0-SNAPSHOT&#x27;version = &#x27;1.0.1&#x27;sourceCompatibility = &#x27;1.8&#x27;java &#123; withJavadocJar() withSourcesJar()&#125;repositories &#123; maven &#123; url &#x27;https://maven.aliyun.com/repository/public/&#x27; &#125; mavenLocal() mavenCentral()&#125;dependencyManagement &#123; imports &#123; mavenBom(&quot;software.amazon.awssdk:bom:2.23.10&quot;) &#125;&#125;dependencies &#123; //lombok compileOnly &#x27;org.projectlombok:lombok:1.18.32&#x27; annotationProcessor &#x27;org.projectlombok:lombok:1.18.32&#x27; api &#x27;software.amazon.awssdk:s3&#x27; api &#x27;software.amazon.awssdk:apache-client&#x27; api &#x27;software.amazon.awssdk:s3-transfer-manager&#x27; api &#x27;software.amazon.awssdk:aws-crt-client&#x27; api &#x27;org.springframework:spring-core:5.3.29&#x27;&#125;// javaç¼–è¯‘çš„æ—¶å€™ç¼ºçœçŠ¶æ€ä¸‹ä¼šå› ä¸ºä¸­æ–‡å­—ç¬¦è€Œå¤±è´¥[compileJava, compileTestJava]*.options*.encoding = &#x27;UTF-8&#x27;/** * å‘å¸ƒæ’ä»¶ * å‚è€ƒï¼šhttps://docs.gradle.org/6.6.1/userguide/publishing_maven.html#publishing_maven:resolved_dependencies * * å‘å¸ƒä¸ºbomï¼Œå‚è€ƒï¼šhttps://zhuanlan.zhihu.com/p/195678201 * æ³¨æ„ï¼šjava-platformä¸èƒ½ä¸javaå’Œjava-libraryåŒæ—¶å­˜åœ¨ */publishing &#123; publications &#123; maven(MavenPublication) &#123; groupId = project.group artifactId = project.name version = project.version //å¦‚æœä¸å®šä¹‰ï¼Œåˆ™ä¼šæŒ‰ç…§ä»¥ä¸Šé»˜è®¤å€¼æ‰§è¡Œ from components.java pom &#123; name = &#x27;aws-s3-v2-tools-gradle&#x27; description = &#x27;AWS S3 Tools.&#x27; url = &#x27;https://blog.hanqunfeng.com&#x27; licenses &#123; license &#123; name = &#x27;The Apache License, Version 2.0&#x27; url = &#x27;http://www.apache.org/licenses/LICENSE-2.0.txt&#x27; &#125; &#125; developers &#123; developer &#123; id = &#x27;hanqf&#x27; name = &#x27;han qunfeng&#x27; email = &#x27;qunfeng_han@126.com&#x27; &#125; &#125; scm &#123; connection = &#x27;scm:git:https://github.com/hanqunfeng/aws-s3-v2-tools-gradle.git&#x27; developerConnection = &#x27;scm:git:https://github.com:hanqunfeng/aws-s3-v2-tools-gradle.git&#x27; url = &#x27;https://github.com/hanqunfeng/aws-s3-v2-tools-gradle&#x27; &#125; &#125; versionMapping &#123; usage(&#x27;java-api&#x27;) &#123; fromResolutionOf(&#x27;runtimeClasspath&#x27;) &#125; usage(&#x27;java-runtime&#x27;) &#123; fromResolutionResult() &#125; &#125; &#125; &#125; repositories &#123; maven &#123; url = layout.buildDirectory.dir(&#x27;staging-deploy&#x27;) &#125; &#125;&#125;tasks.withType(JavaCompile) &#123; options.encoding = &#x27;UTF-8&#x27;&#125;//javadocï¼Œå¦‚æœç”¨jdk11ï¼Œé»˜è®¤å°±æ”¯æŒä¸­æ–‡//æŸ¥çœ‹å¯ä»¥é…ç½®çš„å±æ€§ï¼šhttps://docs.gradle.org/current/javadoc/org/gradle/external/javadoc/StandardJavadocDocletOptions.htmltasks.withType(Javadoc) &#123; options.version = true options.author = true options.encoding = &quot;UTF-8&quot; options.charSet = &quot;UTF-8&quot; //è§£å†³ä¸­æ–‡ä¹±ç &#125;javadoc &#123; if (JavaVersion.current().isJava9Compatible()) &#123; options.addBooleanOption(&#x27;html5&#x27;, true) &#125; if (JavaVersion.current().isJava8Compatible()) &#123; tasks.withType(Javadoc) &#123; // disable the crazy super-strict doclint tool in Java 8 // noinspection SpellCheckingInspection options.addStringOption(&#x27;Xdoclint:none&#x27;, &#x27;-quiet&#x27;) &#125; &#125;&#125;// jreleaseré…ç½®æ–‡ä»¶ï¼š~/.jreleaser/config.toml/*JRELEASER_MAVENCENTRAL_USERNAME = &quot;&lt;your-publisher-portal-username&gt;&quot;JRELEASER_MAVENCENTRAL_PASSWORD = &quot;&lt;your-publisher-portal-password&gt;&quot;JRELEASER_NEXUS2_USERNAME = &quot;&lt;your-sonatype-account-username&gt;&quot;JRELEASER_NEXUS2_PASSWORD = &quot;&lt;your-sonatype-account-password&gt;&quot;JRELEASER_GPG_PASSPHRASE = &quot;&lt;your-pgp-passphrase&gt;&quot;JRELEASER_GITHUB_TOKEN = &quot;&lt;your-github-token&quot; */jreleaser &#123; signing &#123; active = &#x27;ALWAYS&#x27; armored = true mode = &#x27;FILE&#x27; publicKey = &#x27;/Users/hanqf/develop_soft/gpg_key/hanqf/public.pgp&#x27; secretKey = &#x27;/Users/hanqf/develop_soft/gpg_key/hanqf/private.pgp&#x27; &#125; deploy &#123; maven &#123; /* Portal Publisher API */ mavenCentral &#123; sonatype &#123; active = &#x27;ALWAYS&#x27; url = &#x27;https://central.sonatype.com/api/v1/publisher&#x27; stagingRepository(&#x27;build/staging-deploy&#x27;) &#125; &#125; &#125; &#125;&#125; ~/.jreleaser/config.toml ï¼šé…ç½®ç›¸å…³è®¤è¯ä¿¡æ¯ 12345678910# https://central.sonatype.com çš„è®¤è¯ä¿¡æ¯JRELEASER_MAVENCENTRAL_USERNAME = &quot;&lt;your-publisher-portal-username&gt;&quot;JRELEASER_MAVENCENTRAL_PASSWORD = &quot;&lt;your-publisher-portal-password&gt;&quot;# https://oss.sonatype.org çš„è®¤è¯ä¿¡æ¯ï¼Œè¿™é‡Œæ²¡æœ‰ç”¨åˆ°ï¼Œå¯ä»¥ä¸è¿›è¡Œé…ç½®JRELEASER_NEXUS2_USERNAME = &quot;&lt;your-sonatype-account-username&gt;&quot;JRELEASER_NEXUS2_PASSWORD = &quot;&lt;your-sonatype-account-password&gt;&quot;# åˆ›å»º pgp å¯†é’¥æ—¶çš„å¯†ç JRELEASER_GPG_PASSPHRASE = &quot;&lt;your-pgp-passphrase&gt;&quot;# github tokenJRELEASER_GITHUB_TOKEN = &quot;&lt;your-github-token&quot; æ‰§è¡Œå‘½ä»¤ 123./gradlew jreleaserConfig # éªŒè¯é…ç½®æ–‡ä»¶æ˜¯å¦æ­£ç¡®./gradlew clean publish # å‘å¸ƒåˆ°æœ¬åœ° build/staging-deploy./gradlew jreleaserFullRelease # å‘å¸ƒåˆ°è¿œç¨‹Mavenä¸­å¤®ä»“åº“ æ›´æ–°éƒ¨ç½² ä¸ å‘å¸ƒJaråˆ°Mavenä¸­å¤®ä»“åº“--Mavenç‰ˆ(æœ€æ–°æ–¹å¼) ä¸­çš„æè¿°ç±»ä¼¼ï¼Œåªéœ€è¦ä¿®æ”¹build.gradleä¸­å¯¹åº”çš„ç‰ˆæœ¬å·åé‡æ–°æ‰§è¡Œä¸Šé¢çš„å‘å¸ƒå‘½ä»¤å³å¯ï¼Œå‘å¸ƒçš„jaråŒ…å¯ä»¥åœ¨https://central.sonatype.comä¸­æ£€ç´¢ã€‚","summary":"æ‘˜è¦ https://oss.sonatype.orgå·²ç»ä¸å†æ”¯æŒæ–°ç”¨æˆ·æ³¨å†Œï¼Œæ–°çš„æ³¨å†Œåœ°å€ä¸ºhttps://central.sonatype.com é€šè¿‡æœ¬æ–‡ï¼Œä½ å°†çŸ¥é“å¦‚ä½•å°†Gradleæ„å»ºçš„é¡¹ç›®å‘å¸ƒåˆ°Mavenä¸­å¤®ä»“åº“ Mavenæ„å»ºæ–¹å¼è¯·çœ‹ å‘å¸ƒJaråˆ°Mavenä¸­å¤®ä»“åº“--Mavenç‰ˆ(æœ€æ–°æ–¹å¼) ã€‚ å‰ä¸‰ä¸ªæ­¥éª¤ä¸ å‘å¸ƒJaråˆ°Mavenä¸­å¤®ä»“åº“--Mavenç‰ˆ(æœ€æ–°æ–¹å¼) ç›¸åŒï¼Œä¸åœ¨èµ˜è¿°ã€‚","date_published":"2024-08-02T13:30:05.000Z","tags":["æŠ€æœ¯","maven","gradle"]},{"id":"https://blog.hanqunfeng.com/2024/08/01/mvn-depoly-maven-center-repository-new/","url":"https://blog.hanqunfeng.com/2024/08/01/mvn-depoly-maven-center-repository-new/","title":"å‘å¸ƒJaråˆ°Mavenä¸­å¤®ä»“åº“--Mavenç‰ˆ(æœ€æ–°æ–¹å¼)","content_html":"<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\"><a href=\"https://oss.sonatype.org\">https://oss.sonatype.org</a>å·²ç»ä¸å†æ”¯æŒæ–°ç”¨æˆ·æ³¨å†Œï¼Œæ–°çš„æ³¨å†Œåœ°å€ä¸º<a href=\"https://central.sonatype.com\">https://central.sonatype.com</a></li>\n<li class=\"lvl-2\">é€šè¿‡æœ¬æ–‡ï¼Œä½ å°†çŸ¥é“å¦‚ä½•å°†Mavenæ„å»ºçš„é¡¹ç›®å‘å¸ƒåˆ°Mavenä¸­å¤®ä»“åº“</li>\n<li class=\"lvl-2\">Gradleæ„å»ºæ–¹å¼è¯·çœ‹ <a href=\"/2024/08/02/gradle-depoly-maven-center-repository-new/\" title=\"å‘å¸ƒJaråˆ°Mavenä¸­å¤®ä»“åº“--Gradleç‰ˆ(æœ€æ–°æ–¹å¼)\">å‘å¸ƒJaråˆ°Mavenä¸­å¤®ä»“åº“--Gradleç‰ˆ(æœ€æ–°æ–¹å¼)</a> ã€‚</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"ä¸€ã€å°†é¡¹ç›®æ¨é€åˆ°è¿œç¨‹ä»“åº“ï¼Œå¦‚-Githubæˆ–è€…Gitee\">ä¸€ã€å°†é¡¹ç›®æ¨é€åˆ°è¿œç¨‹ä»“åº“ï¼Œå¦‚ <code>Github</code>æˆ–è€…<code>Gitee</code></h2>\n<h2 id=\"äºŒã€æ³¨å†Œ-Sonatype-è´¦æˆ·\">äºŒã€æ³¨å†Œ <code>Sonatype</code> è´¦æˆ·</h2>\n<p>è¿›å…¥ <a href=\"https://central.sonatype.com\">https://central.sonatype.com</a> æ³¨å†Œä¸€ä¸ªè´¦å·ï¼Œé‚®ç®±è¦çœŸå®ã€‚</p>\n<h2 id=\"ä¸‰ã€ç™»å½•-Sonatype-åˆ›å»ºNamespace\">ä¸‰ã€ç™»å½• Sonatype åˆ›å»º<code>Namespace</code></h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¿›å…¥ Namespace æ¨¡å—ï¼Œç„¶åç‚¹å‡» Add Namespace æŒ‰é’®ï¼ŒNamespace å…·æœ‰å”¯ä¸€æ€§</p>\n</li>\n<li class=\"lvl-2\">\n<p>å‘å¸ƒå‰ä¸€å®šè¦åˆ›å»º<code>Namespace</code>ï¼Œå®é™…ä¸Šå°±æ˜¯é¡¹ç›®çš„<code>Group Id</code>ï¼Œå› ä¸ºè¦è¿›è¡ŒéªŒè¯ï¼Œæ‰€ä»¥è¿™é‡Œä¸èƒ½éšä¾¿å¡«å†™ï¼Œä½ å¯ä»¥é…ç½®ä¸ºä½ æ‹¥æœ‰çš„åŸŸåï¼Œæ¯”å¦‚æˆ‘çš„åŸŸåæ˜¯<code>hanqunfeng.com</code>ï¼Œè¿™é‡Œå°±å¡«å†™<code>com.hanqunfeng</code>ã€‚åŸŸåçš„éªŒè¯æ–¹æ³•æ˜¯é…ç½®DNS TXTè®°å½•ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å¦‚æœä½ æ²¡æœ‰åŸŸåï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨Githubçš„åŸŸåï¼Œæ¯”å¦‚æˆ‘çš„Githubç”¨æˆ·åæ˜¯<code>hanqunfeng</code>ï¼Œåˆ™è¿™é‡Œå¯ä»¥é…ç½®ä¸º<code>io.github.hanqunfeng</code>ã€‚Githubçš„éªŒè¯æ–¹å¼æ˜¯æ ¹æ®ç»™å®šä¸ªåç§°åˆ›å»ºä¸€ä¸ªpublic repositoryã€‚</p>\n</li>\n</ul>\n<h2 id=\"å››ã€å‘å¸ƒ\">å››ã€å‘å¸ƒ</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>1.å‡†å¤‡ç­¾å</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-6\">å¯ä»¥ä½¿ç”¨å·¥å…·åˆ›å»ºå¯†é’¥å¯¹<br>\néœ€è¦ä¸‹è½½ä¸€ä¸ªç­¾åå·¥å…·ï¼Œæˆ‘æ˜¯macç”µè„‘ï¼Œä¸‹è½½çš„æ˜¯<a href=\"https://gpgtools.org\">https://gpgtools.org</a>ã€‚<br>\nå®‰è£…åç‚¹å‡»æ–°å»ºï¼ŒæŒ‰ç…§æç¤ºåˆ›å»ºä¸€ä¸ªå¯†é’¥å¯¹å³å¯ï¼Œæ³¨æ„é«˜çº§é€‰é¡¹é‡Œæœ‰ä¸ªè¿‡æœŸæ—¶é—´ï¼Œé»˜è®¤æ˜¯<code>3å¹´</code>ã€‚åˆ›å»ºå¥½åä¼šä¸»åŠ¨æç¤ºä½ æ˜¯å¦å°†å…¬é’¥å‘å¸ƒåˆ°<code>key server</code>ï¼Œç‚¹å‡»<code>Upload Public key</code>å³å¯ã€‚ä¹Ÿå¯ä»¥åœ¨åˆ›å»ºåçš„è¯ä¹¦åˆ—è¡¨é¡µé¢é‚®ä»¶é€‰æ‹©<code>è¯ä¹¦</code>â€“&gt;<code>Send Public Key To Key Server</code>ã€‚</li>\n</ul>\n<p>å¯¼å‡ºè¯ä¹¦æ—¶ï¼Œå‹¾é€‰å¯†ç å¹¶è®¾ç½®å¯†ç å°±æ˜¯ç§é’¥å’Œå…¬é’¥è¯ä¹¦ï¼Œä¸å‹¾é€‰å¯†ç å°±æ˜¯å…¬é’¥ï¼Œçœ‹ç”Ÿæˆæ–‡ä»¶çš„åç§°å°±å¯ä»¥ï¼Œå…¬å¼€å°±æ˜¯å…¬é’¥ï¼Œç§å¯†å°±æ˜¯ç§é’¥ï¼Œæ ¼å¼éƒ½æ˜¯<code>asc</code>ï¼Œå…¶å®å°±æ˜¯<code>å­—ç¬¦ä¸²</code>ï¼Œå¯ä»¥ç”¨è®°äº‹æœ¬æ‰“å¼€æŸ¥çœ‹ã€‚</p>\n<p>å¦‚æœwindowsç³»ç»Ÿï¼Œå¯ä»¥ä¸‹è½½<a href=\"https://www.gpg4win.org/\">https://www.gpg4win.org/</a> ï¼Œä½¿ç”¨æ–¹å¼å·®ä¸å¤šï¼Œæœ€åç‚¹å‡»â€œå°†å…¬é’¥ä¸Šä¼ çš„ç›®å½•æœåŠ¡â€ã€‚</p>\n<p>å…¬é’¥å‘å¸ƒåˆ°<code>key server</code>åè¦ç¨å¾®ç­‰ä¸€ä¼šï¼Œå¤§çº¦<code>10åˆ†é’Ÿ</code>å§ï¼Œå› ä¸º<code>key server</code>æœ‰å¤šä¸ªï¼ŒåŒæ­¥éœ€è¦ä¸€äº›æ—¶é—´ã€‚<br>\nè®°ä½ä½ åˆ›å»ºå¯†é’¥å¯¹æ—¶çš„å¯†ç ï¼Œå‘å¸ƒé¡¹ç›®æ—¶è¦ä½¿ç”¨ã€‚</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-6\">\n<p>ä¹Ÿå¯ä»¥ä½¿ç”¨å‘½ä»¤è¡Œåˆ›å»ºå¯†é’¥å¯¹ï¼Œç‰ˆæœ¬<code>[gpg (GnuPG/MacGPG2) 2.2.24]</code></p>\n  <figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åˆ›å»ºå¯†é’¥å¯¹ï¼ŒæŒ‰æç¤ºè¾“å…¥ç”¨æˆ·åç§°å’Œé‚®ç®±åœ°å€</span></span><br><span class=\"line\">gpg --generate-key</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åˆ—å‡ºå¯†é’¥ï¼Œhanqunfengå°±æ˜¯åˆ›å»ºå¯†é’¥å¯¹æ˜¯çš„ç”¨æˆ·åï¼Œæ­¤å¤„ä¹Ÿå¯ä»¥ä½¿ç”¨é‚®ç®±</span></span><br><span class=\"line\"><span class=\"comment\"># ç»“æœä¸­ç¬¬äºŒè¡Œä¸€é•¿ä¸²çš„å8ä½å°±æ˜¯keyIdï¼Œæ¯”å¦‚ï¼š30FF8D58ï¼Œgradleæ„å»ºæ—¶ä¼šç”¨åˆ°</span></span><br><span class=\"line\">gpg --list-keys hanqunfeng</span><br><span class=\"line\"><span class=\"comment\"># ä¹Ÿå¯ä»¥ç›´æ¥é€šè¿‡idæŸ¥è¯¢</span></span><br><span class=\"line\">gpg --list-keys 30FF8D58</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ä¸Šä¼ å…¬é’¥åˆ°server keyï¼Œé»˜è®¤ä¸Šä¼ åˆ°hkps://keys.openpgp.orgï¼Œä½†æ˜¯æç¤ºä¸Šä¼ å¤±è´¥</span></span><br><span class=\"line\"><span class=\"comment\"># çœ‹åˆ°ç½‘ä¸Šçš„ç¤ºä¾‹å¯ä»¥é€šè¿‡--keyserveræŒ‡å®šä¸Šä¼ çš„æœåŠ¡å™¨åœ°å€ï¼Œä½†æ˜¯æˆ‘è¿™ä¸ªç‰ˆæœ¬[gpg (GnuPG/MacGPG2) 2.2.24]æ²¡æœ‰è¿™ä¸ªå‚æ•°</span></span><br><span class=\"line\"><span class=\"comment\"># ä½¿ç”¨ https://gpgtools.org ä¸Šä¼ å…¬é’¥å°±ä¼šæˆåŠŸ</span></span><br><span class=\"line\">gpg --send-keys 30FF8D58</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹æŒ‡çº¹</span></span><br><span class=\"line\">gpg --fingerprint 30FF8D58</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åˆ é™¤ç§é’¥ï¼Œè¿™é‡Œä¹Ÿå¯ä»¥ä½¿ç”¨ç”¨æˆ·åç§°æˆ–è€…é‚®ç®±ï¼Œå¦‚æœå”¯ä¸€çš„è¯</span></span><br><span class=\"line\">gpg --delete-secret-keys 30FF8D58</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åˆ é™¤å…¬é’¥</span></span><br><span class=\"line\">gpg --delete-keys 30FF8D58</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<p>2.settings.xml<br>\né…ç½® <code>maven</code> çš„ <code>settings.xml</code> æ–‡ä»¶ï¼Œè®¾ç½®ä¸€ä¸ª <code>server</code>ï¼Œé‡Œé¢æ·»åŠ  <code>User Token</code>ã€‚</p>\n</li>\n</ul>\n<blockquote>\n<p>ç™»å½•<a href=\"https://central.sonatype.com\">https://central.sonatype.com</a>åç‚¹å‡»å³ä¸Šè§’çš„ç”¨æˆ·åç§°â€“&gt; View Account --&gt; Generate User Token</p>\n</blockquote>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">settings</span>&gt;</span></span><br><span class=\"line\">    [...]</span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">servers</span>&gt;</span></span><br><span class=\"line\">       [...]</span><br><span class=\"line\">       <span class=\"tag\">&lt;<span class=\"name\">server</span>&gt;</span></span><br><span class=\"line\">          <span class=\"tag\">&lt;<span class=\"name\">id</span>&gt;</span>maven-central<span class=\"tag\">&lt;/<span class=\"name\">id</span>&gt;</span></span><br><span class=\"line\">          <span class=\"tag\">&lt;<span class=\"name\">username</span>&gt;</span>username<span class=\"tag\">&lt;/<span class=\"name\">username</span>&gt;</span></span><br><span class=\"line\">          <span class=\"tag\">&lt;<span class=\"name\">password</span>&gt;</span>token<span class=\"tag\">&lt;/<span class=\"name\">password</span>&gt;</span></span><br><span class=\"line\">       <span class=\"tag\">&lt;/<span class=\"name\">server</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">servers</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">settings</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>3.pom.xmlï¼Œé‡ç‚¹æ˜¯åé¢å‡ ä¸ªplugin<br>\nè¿™é‡Œé‡ç‚¹è¯´ä¸€ä¸‹<code>central-publishing-maven-plugin</code>è¿™ä¸ªæ’ä»¶ï¼Œè¯¥æ’ä»¶ä¼šå°†jaråŒ…æ¨é€åˆ°<code>Maven Central</code>ä»“åº“ï¼Œå¦‚æœæ’ä»¶æ²¡æœ‰é…ç½®å‚æ•°<code>autoPublish</code>ä¸º<code>true</code>ï¼Œåˆ™ä½†æ­¤æ—¶å‘å¸ƒçš„jarä¼šå¤„äº<code>VALIDATED</code>çŠ¶æ€ï¼Œéœ€è¦ç™»å½•<a href=\"https://central.sonatype.com\">https://central.sonatype.com</a>ååˆ‡æ¢åˆ°Deploymentï¼Œæ‰¾åˆ°æˆ‘ä»¬åˆšåˆšä¸Šä¼ çš„åŒ…åï¼Œç„¶åç‚¹å‡»å³ä¾§çš„<code>Publish</code>æŒ‰é’®ï¼Œå¦‚æœä¸€åˆ‡é¡ºåˆ©ï¼Œå¤§äº10åˆ†é’Ÿåå…¶çŠ¶æ€å˜ä¸º<code>PUBLISHED</code>ï¼Œè¡¨ç¤ºå‘å¸ƒæˆåŠŸã€‚å¦‚æœå‘å¸ƒå¤±è´¥ï¼Œå…¶çŠ¶æ€ä¼šå˜æ›´ä¸º<code>FAILED</code>ï¼Œå¯ä»¥åœ¨<code>Component Summary</code>ä¸­æŸ¥çœ‹å¤±è´¥åŸå› ï¼Œé‡æ–°å‘å¸ƒå³å¯ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">project</span> <span class=\"attr\">xmlns</span>=<span class=\"string\">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class=\"attr\">xmlns:xsi</span>=<span class=\"string\">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">         <span class=\"attr\">xsi:schemaLocation</span>=<span class=\"string\">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">modelVersion</span>&gt;</span>4.0.0<span class=\"tag\">&lt;/<span class=\"name\">modelVersion</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>io.github.hanqunfeng<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>aws-s3-v2-tools<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.0.1<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">packaging</span>&gt;</span>jar<span class=\"tag\">&lt;/<span class=\"name\">packaging</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">name</span>&gt;</span>aws-s3-v2-tools<span class=\"tag\">&lt;/<span class=\"name\">name</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">description</span>&gt;</span></span><br><span class=\"line\">        AWS S3 Tools.</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">description</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">url</span>&gt;</span>https://blog.hanqunfeng.com<span class=\"tag\">&lt;/<span class=\"name\">url</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">licenses</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">license</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">name</span>&gt;</span>The Apache License, Version 2.0<span class=\"tag\">&lt;/<span class=\"name\">name</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">url</span>&gt;</span>http://www.apache.org/licenses/LICENSE-2.0.txt<span class=\"tag\">&lt;/<span class=\"name\">url</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">license</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">licenses</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">developers</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">developer</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">id</span>&gt;</span>hanqf<span class=\"tag\">&lt;/<span class=\"name\">id</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">name</span>&gt;</span>hanqunfeng<span class=\"tag\">&lt;/<span class=\"name\">name</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">email</span>&gt;</span>qunfeng_han@126.com<span class=\"tag\">&lt;/<span class=\"name\">email</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">developer</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">developers</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">scm</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">connection</span>&gt;</span>scm:git:https://github.com/hanqunfeng/aws-s3-v2-tools.git</span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">connection</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">developerConnection</span>&gt;</span></span><br><span class=\"line\">            scm:git:https://github.com:hanqunfeng/aws-s3-v2-tools.git</span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">developerConnection</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">url</span>&gt;</span>https://github.com/hanqunfeng/aws-s3-v2-tools<span class=\"tag\">&lt;/<span class=\"name\">url</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">scm</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">properties</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">java.version</span>&gt;</span>1.8<span class=\"tag\">&lt;/<span class=\"name\">java.version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">maven.compiler.source</span>&gt;</span>8<span class=\"tag\">&lt;/<span class=\"name\">maven.compiler.source</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">maven.compiler.target</span>&gt;</span>8<span class=\"tag\">&lt;/<span class=\"name\">maven.compiler.target</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class=\"tag\">&lt;/<span class=\"name\">project.build.sourceEncoding</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">properties</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">dependencyManagement</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependencies</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>software.amazon.awssdk<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>bom<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.23.10<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">type</span>&gt;</span>pom<span class=\"tag\">&lt;/<span class=\"name\">type</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>import<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependencies</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">dependencyManagement</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">dependencies</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>software.amazon.awssdk<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>s3<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">&lt;!-- ä¸ºé¿å…Potential Conflictsï¼Œä½ åº”è¯¥å°†commons-logging.jarä»classpathä¸­åˆ é™¤ã€‚ä½ å¯ä»¥å°è¯•ä»é¡¹ç›®ä¾èµ–ä¸­æ’é™¤commons-loggingï¼Œè¿™æ ·ä½ çš„åº”ç”¨ç¨‹åºå°±ä¼šè¢«å¼ºåˆ¶ä½¿ç”¨Spring JCLè€Œä¸æ˜¯Commons Loggingã€‚ --&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">&lt;!-- é—®é¢˜ï¼šStandard Commons Logging discovery in action with spring-jcl: please remove commons-logging.jar from classpath in order to avoid potential conflicts --&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>software.amazon.awssdk<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>apache-client<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">exclusions</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">exclusion</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>commons-logging<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>commons-logging<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;/<span class=\"name\">exclusion</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">exclusions</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>software.amazon.awssdk<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>s3-transfer-manager<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>software.amazon.awssdk<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>aws-crt-client<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.projectlombok<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>lombok<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">optional</span>&gt;</span>true<span class=\"tag\">&lt;/<span class=\"name\">optional</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.18.32<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-core<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>5.3.29<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">dependencies</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">build</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">plugins</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.maven.plugins<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>maven-compiler-plugin<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>3.8.1<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">configuration</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">source</span>&gt;</span>$&#123;java.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">source</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">target</span>&gt;</span>$&#123;java.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">target</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;/<span class=\"name\">configuration</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.maven.plugins<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>maven-source-plugin<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>3.2.1<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">executions</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">execution</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;<span class=\"name\">id</span>&gt;</span>attach-source<span class=\"tag\">&lt;/<span class=\"name\">id</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;<span class=\"name\">phase</span>&gt;</span>verify<span class=\"tag\">&lt;/<span class=\"name\">phase</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;<span class=\"name\">goals</span>&gt;</span></span><br><span class=\"line\">                            <span class=\"comment\">&lt;!--ç”Ÿæˆæºä»£ç çš„jar --&gt;</span></span><br><span class=\"line\">                            <span class=\"tag\">&lt;<span class=\"name\">goal</span>&gt;</span>jar<span class=\"tag\">&lt;/<span class=\"name\">goal</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;/<span class=\"name\">goals</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;/<span class=\"name\">execution</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;/<span class=\"name\">executions</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.maven.plugins<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>maven-javadoc-plugin<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>3.2.0<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">executions</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">execution</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;<span class=\"name\">id</span>&gt;</span>attach-javadoc<span class=\"tag\">&lt;/<span class=\"name\">id</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;<span class=\"name\">phase</span>&gt;</span>verify<span class=\"tag\">&lt;/<span class=\"name\">phase</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;<span class=\"name\">goals</span>&gt;</span></span><br><span class=\"line\">                            <span class=\"comment\">&lt;!--ç”Ÿæˆjavadocçš„jar --&gt;</span></span><br><span class=\"line\">                            <span class=\"tag\">&lt;<span class=\"name\">goal</span>&gt;</span>jar<span class=\"tag\">&lt;/<span class=\"name\">goal</span>&gt;</span></span><br><span class=\"line\">                            <span class=\"comment\">&lt;!--ç”Ÿæˆjavadocçš„html --&gt;</span></span><br><span class=\"line\">                            <span class=\"tag\">&lt;<span class=\"name\">goal</span>&gt;</span>javadoc<span class=\"tag\">&lt;/<span class=\"name\">goal</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;/<span class=\"name\">goals</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;<span class=\"name\">configuration</span>&gt;</span></span><br><span class=\"line\">                            <span class=\"comment\">&lt;!--ä¸æ˜¾ç¤ºjavadocè­¦å‘Š--&gt;</span></span><br><span class=\"line\">                            <span class=\"tag\">&lt;<span class=\"name\">additionalOptions</span>&gt;</span>-Xdoclint:none<span class=\"tag\">&lt;/<span class=\"name\">additionalOptions</span>&gt;</span></span><br><span class=\"line\">                            <span class=\"tag\">&lt;<span class=\"name\">additionalJOption</span>&gt;</span>-Xdoclint:none<span class=\"tag\">&lt;/<span class=\"name\">additionalJOption</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;/<span class=\"name\">configuration</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;/<span class=\"name\">execution</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;/<span class=\"name\">executions</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">&lt;!-- gpg plugin,ç”¨äºç­¾åè®¤è¯ --&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.maven.plugins<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>maven-gpg-plugin<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.6<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">executions</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">execution</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;<span class=\"name\">id</span>&gt;</span>sign-artifacts<span class=\"tag\">&lt;/<span class=\"name\">id</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;<span class=\"name\">phase</span>&gt;</span>verify<span class=\"tag\">&lt;/<span class=\"name\">phase</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;<span class=\"name\">goals</span>&gt;</span></span><br><span class=\"line\">                            <span class=\"tag\">&lt;<span class=\"name\">goal</span>&gt;</span>sign<span class=\"tag\">&lt;/<span class=\"name\">goal</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;/<span class=\"name\">goals</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;/<span class=\"name\">execution</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;/<span class=\"name\">executions</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">&lt;!-- å‘å¸ƒåˆ°ç§æœæ—¶éœ€è¦æ³¨é‡Šæ‰ä¸‹é¢ä¸¤ä¸ªæ’ä»¶ --&gt;</span></span><br><span class=\"line\">            <span class=\"comment\">&lt;!--staging puglin,ç”¨äºè‡ªåŠ¨æ‰§è¡Œå‘å¸ƒé˜¶æ®µ(å…æ‰‹åŠ¨)--&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.sonatype.central<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>central-publishing-maven-plugin<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>0.5.0<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">extensions</span>&gt;</span>true<span class=\"tag\">&lt;/<span class=\"name\">extensions</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">configuration</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"comment\">&lt;!-- è¿™é‡Œçš„publishingServerIdæ˜¯åœ¨settings.xmlä¸­é…ç½®çš„serverè®¤è¯ä¿¡æ¯ --&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">publishingServerId</span>&gt;</span>maven-central<span class=\"tag\">&lt;/<span class=\"name\">publishingServerId</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"comment\">&lt;!-- è¿™é‡Œçš„autoPublishæ˜¯è‡ªåŠ¨å‘å¸ƒï¼Œè€Œä¸æ˜¯æ‰‹åŠ¨å‘å¸ƒ --&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">autoPublish</span>&gt;</span>true<span class=\"tag\">&lt;/<span class=\"name\">autoPublish</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"comment\">&lt;!-- è¿™é‡Œçš„waitUntilé…ç½®ä¸ºpublishedæ˜¯ç­‰å¾…å‘å¸ƒå®Œæˆï¼Œå› ä¸ºå‘å¸ƒå®Œæˆçš„æ—¶é—´æ¯”è¾ƒé•¿ï¼Œæ‰€ä»¥å¯ä»¥ä¸åŠ è¿™ä¸ªå‚æ•° --&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">waitUntil</span>&gt;</span>published<span class=\"tag\">&lt;/<span class=\"name\">waitUntil</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"comment\">&lt;!-- è¿™é‡Œçš„deploymentNameæ˜¯å‘å¸ƒåˆ°ä¸­å¤®ä»“åº“çš„åç§° --&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">deploymentName</span>&gt;</span>$&#123;project.groupId&#125;:$&#123;project.artifactId&#125;:$&#123;project.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">deploymentName</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;/<span class=\"name\">configuration</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">            <span class=\"comment\">&lt;!-- release plugin,ç”¨äºå‘å¸ƒåˆ°releaseä»“åº“éƒ¨ç½²æ’ä»¶ --&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.maven.plugins<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>maven-release-plugin<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.5.3<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">plugins</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">build</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">distributionManagement</span>&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">&lt;!--        &lt;repository&gt;--&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">&lt;!--            &lt;id&gt;maven-releases&lt;/id&gt;--&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">&lt;!--            &lt;name&gt;Nexus Release Repository&lt;/name&gt;--&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">&lt;!--            &lt;url&gt;http://nexus.cxzh.ltd:8081/repository/maven-releases/&lt;/url&gt;--&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">&lt;!--        &lt;/repository&gt;--&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">&lt;!--        &lt;snapshotRepository&gt;--&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">&lt;!--            &lt;id&gt;maven-snapshots&lt;/id&gt;--&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">&lt;!--            &lt;name&gt;Nexus Snapshot Repository&lt;/name&gt;--&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">&lt;!--            &lt;url&gt;http://nexus.cxzh.ltd:8081/repository/maven-snapshots/&lt;/url&gt;--&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">&lt;!--        &lt;/snapshotRepository&gt;--&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">distributionManagement</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">project</span>&gt;</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>4.æ‰§è¡Œå‘½ä»¤</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mvn clean package <span class=\"comment\"># å®Œæˆæ‰“åŒ…å’Œæµ‹è¯•</span></span><br><span class=\"line\">mvn clean verify  <span class=\"comment\"># å®Œæˆæºç æ‰“åŒ…å’Œjavadocæ‰“åŒ…ï¼ŒåŒæ—¶å®Œæˆç­¾å</span></span><br><span class=\"line\">mvn clean deploy  <span class=\"comment\"># å®Œæˆæœ¬åœ°éƒ¨ç½²å’Œmavenä¸­å¤®ä»“åº“éƒ¨ç½²</span></span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>4.1 æ‰§è¡Œè¿‡ç¨‹ä¸­ä¼šæç¤ºä½ è¾“å…¥åˆ›å»ºå¯†é’¥å¯¹æ—¶çš„å¯†ç ï¼Œå¦‚æœä¸æƒ³äººå·¥å‚ä¸ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å¦‚ä¸‹æ–¹å¼ï¼ˆå‚è€ƒï¼š<a href=\"http://maven.apache.org/plugins/maven-gpg-plugin/usage.html%EF%BC%89\">http://maven.apache.org/plugins/maven-gpg-plugin/usage.htmlï¼‰</a></p>\n</blockquote>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>a.åœ¨æ‰§è¡Œå‘½ä»¤æ—¶æŒ‡å®šå¯†ç ï¼š</p>\n  <figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mvn clean deploy -Dgpg.passphrase=thephrase</span><br></pre></td></tr></table></figure>\n</li>\n<li class=\"lvl-2\">\n<p>b.setting.xmlä¸­åˆ›å»ºä¸€ä¸ªserver</p>\n  <figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">settings</span>&gt;</span></span><br><span class=\"line\">[...]</span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">servers</span>&gt;</span></span><br><span class=\"line\">    [...]</span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">server</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">id</span>&gt;</span>gpg.passphrase<span class=\"tag\">&lt;/<span class=\"name\">id</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">passphrase</span>&gt;</span>clear or encrypted text<span class=\"tag\">&lt;/<span class=\"name\">passphrase</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">server</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">servers</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">settings</span>&gt;</span></span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>6.æ›´æ–°éƒ¨ç½²<br>\nä¿®æ”¹<code>pom.xml</code>ä¸­çš„ç‰ˆæœ¬å·ï¼Œé‡æ–°æ‰§è¡Œ<code>mvn clean deploy</code>å³å¯ã€‚å‘å¸ƒçš„jaråŒ…å¯ä»¥åœ¨<a href=\"https://central.sonatype.com\">https://central.sonatype.com</a>ä¸­æ£€ç´¢ã€‚</p>\n</li>\n</ul>\n","content_text":"æ‘˜è¦ https://oss.sonatype.orgå·²ç»ä¸å†æ”¯æŒæ–°ç”¨æˆ·æ³¨å†Œï¼Œæ–°çš„æ³¨å†Œåœ°å€ä¸ºhttps://central.sonatype.com é€šè¿‡æœ¬æ–‡ï¼Œä½ å°†çŸ¥é“å¦‚ä½•å°†Mavenæ„å»ºçš„é¡¹ç›®å‘å¸ƒåˆ°Mavenä¸­å¤®ä»“åº“ Gradleæ„å»ºæ–¹å¼è¯·çœ‹ å‘å¸ƒJaråˆ°Mavenä¸­å¤®ä»“åº“--Gradleç‰ˆ(æœ€æ–°æ–¹å¼) ã€‚ ä¸€ã€å°†é¡¹ç›®æ¨é€åˆ°è¿œç¨‹ä»“åº“ï¼Œå¦‚ Githubæˆ–è€…Gitee äºŒã€æ³¨å†Œ Sonatype è´¦æˆ· è¿›å…¥ https://central.sonatype.com æ³¨å†Œä¸€ä¸ªè´¦å·ï¼Œé‚®ç®±è¦çœŸå®ã€‚ ä¸‰ã€ç™»å½• Sonatype åˆ›å»ºNamespace è¿›å…¥ Namespace æ¨¡å—ï¼Œç„¶åç‚¹å‡» Add Namespace æŒ‰é’®ï¼ŒNamespace å…·æœ‰å”¯ä¸€æ€§ å‘å¸ƒå‰ä¸€å®šè¦åˆ›å»ºNamespaceï¼Œå®é™…ä¸Šå°±æ˜¯é¡¹ç›®çš„Group Idï¼Œå› ä¸ºè¦è¿›è¡ŒéªŒè¯ï¼Œæ‰€ä»¥è¿™é‡Œä¸èƒ½éšä¾¿å¡«å†™ï¼Œä½ å¯ä»¥é…ç½®ä¸ºä½ æ‹¥æœ‰çš„åŸŸåï¼Œæ¯”å¦‚æˆ‘çš„åŸŸåæ˜¯hanqunfeng.comï¼Œè¿™é‡Œå°±å¡«å†™com.hanqunfengã€‚åŸŸåçš„éªŒè¯æ–¹æ³•æ˜¯é…ç½®DNS TXTè®°å½•ã€‚ å¦‚æœä½ æ²¡æœ‰åŸŸåï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨Githubçš„åŸŸåï¼Œæ¯”å¦‚æˆ‘çš„Githubç”¨æˆ·åæ˜¯hanqunfengï¼Œåˆ™è¿™é‡Œå¯ä»¥é…ç½®ä¸ºio.github.hanqunfengã€‚Githubçš„éªŒè¯æ–¹å¼æ˜¯æ ¹æ®ç»™å®šä¸ªåç§°åˆ›å»ºä¸€ä¸ªpublic repositoryã€‚ å››ã€å‘å¸ƒ 1.å‡†å¤‡ç­¾å å¯ä»¥ä½¿ç”¨å·¥å…·åˆ›å»ºå¯†é’¥å¯¹ éœ€è¦ä¸‹è½½ä¸€ä¸ªç­¾åå·¥å…·ï¼Œæˆ‘æ˜¯macç”µè„‘ï¼Œä¸‹è½½çš„æ˜¯https://gpgtools.orgã€‚ å®‰è£…åç‚¹å‡»æ–°å»ºï¼ŒæŒ‰ç…§æç¤ºåˆ›å»ºä¸€ä¸ªå¯†é’¥å¯¹å³å¯ï¼Œæ³¨æ„é«˜çº§é€‰é¡¹é‡Œæœ‰ä¸ªè¿‡æœŸæ—¶é—´ï¼Œé»˜è®¤æ˜¯3å¹´ã€‚åˆ›å»ºå¥½åä¼šä¸»åŠ¨æç¤ºä½ æ˜¯å¦å°†å…¬é’¥å‘å¸ƒåˆ°key serverï¼Œç‚¹å‡»Upload Public keyå³å¯ã€‚ä¹Ÿå¯ä»¥åœ¨åˆ›å»ºåçš„è¯ä¹¦åˆ—è¡¨é¡µé¢é‚®ä»¶é€‰æ‹©è¯ä¹¦â€“&gt;Send Public Key To Key Serverã€‚ å¯¼å‡ºè¯ä¹¦æ—¶ï¼Œå‹¾é€‰å¯†ç å¹¶è®¾ç½®å¯†ç å°±æ˜¯ç§é’¥å’Œå…¬é’¥è¯ä¹¦ï¼Œä¸å‹¾é€‰å¯†ç å°±æ˜¯å…¬é’¥ï¼Œçœ‹ç”Ÿæˆæ–‡ä»¶çš„åç§°å°±å¯ä»¥ï¼Œå…¬å¼€å°±æ˜¯å…¬é’¥ï¼Œç§å¯†å°±æ˜¯ç§é’¥ï¼Œæ ¼å¼éƒ½æ˜¯ascï¼Œå…¶å®å°±æ˜¯å­—ç¬¦ä¸²ï¼Œå¯ä»¥ç”¨è®°äº‹æœ¬æ‰“å¼€æŸ¥çœ‹ã€‚ å¦‚æœwindowsç³»ç»Ÿï¼Œå¯ä»¥ä¸‹è½½https://www.gpg4win.org/ ï¼Œä½¿ç”¨æ–¹å¼å·®ä¸å¤šï¼Œæœ€åç‚¹å‡»â€œå°†å…¬é’¥ä¸Šä¼ çš„ç›®å½•æœåŠ¡â€ã€‚ å…¬é’¥å‘å¸ƒåˆ°key serveråè¦ç¨å¾®ç­‰ä¸€ä¼šï¼Œå¤§çº¦10åˆ†é’Ÿå§ï¼Œå› ä¸ºkey serveræœ‰å¤šä¸ªï¼ŒåŒæ­¥éœ€è¦ä¸€äº›æ—¶é—´ã€‚ è®°ä½ä½ åˆ›å»ºå¯†é’¥å¯¹æ—¶çš„å¯†ç ï¼Œå‘å¸ƒé¡¹ç›®æ—¶è¦ä½¿ç”¨ã€‚ ä¹Ÿå¯ä»¥ä½¿ç”¨å‘½ä»¤è¡Œåˆ›å»ºå¯†é’¥å¯¹ï¼Œç‰ˆæœ¬[gpg (GnuPG/MacGPG2) 2.2.24] 12345678910111213141516171819202122# åˆ›å»ºå¯†é’¥å¯¹ï¼ŒæŒ‰æç¤ºè¾“å…¥ç”¨æˆ·åç§°å’Œé‚®ç®±åœ°å€gpg --generate-key# åˆ—å‡ºå¯†é’¥ï¼Œhanqunfengå°±æ˜¯åˆ›å»ºå¯†é’¥å¯¹æ˜¯çš„ç”¨æˆ·åï¼Œæ­¤å¤„ä¹Ÿå¯ä»¥ä½¿ç”¨é‚®ç®±# ç»“æœä¸­ç¬¬äºŒè¡Œä¸€é•¿ä¸²çš„å8ä½å°±æ˜¯keyIdï¼Œæ¯”å¦‚ï¼š30FF8D58ï¼Œgradleæ„å»ºæ—¶ä¼šç”¨åˆ°gpg --list-keys hanqunfeng# ä¹Ÿå¯ä»¥ç›´æ¥é€šè¿‡idæŸ¥è¯¢gpg --list-keys 30FF8D58# ä¸Šä¼ å…¬é’¥åˆ°server keyï¼Œé»˜è®¤ä¸Šä¼ åˆ°hkps://keys.openpgp.orgï¼Œä½†æ˜¯æç¤ºä¸Šä¼ å¤±è´¥# çœ‹åˆ°ç½‘ä¸Šçš„ç¤ºä¾‹å¯ä»¥é€šè¿‡--keyserveræŒ‡å®šä¸Šä¼ çš„æœåŠ¡å™¨åœ°å€ï¼Œä½†æ˜¯æˆ‘è¿™ä¸ªç‰ˆæœ¬[gpg (GnuPG/MacGPG2) 2.2.24]æ²¡æœ‰è¿™ä¸ªå‚æ•°# ä½¿ç”¨ https://gpgtools.org ä¸Šä¼ å…¬é’¥å°±ä¼šæˆåŠŸgpg --send-keys 30FF8D58# æŸ¥çœ‹æŒ‡çº¹gpg --fingerprint 30FF8D58# åˆ é™¤ç§é’¥ï¼Œè¿™é‡Œä¹Ÿå¯ä»¥ä½¿ç”¨ç”¨æˆ·åç§°æˆ–è€…é‚®ç®±ï¼Œå¦‚æœå”¯ä¸€çš„è¯gpg --delete-secret-keys 30FF8D58# åˆ é™¤å…¬é’¥gpg --delete-keys 30FF8D58 2.settings.xml é…ç½® maven çš„ settings.xml æ–‡ä»¶ï¼Œè®¾ç½®ä¸€ä¸ª serverï¼Œé‡Œé¢æ·»åŠ  User Tokenã€‚ ç™»å½•https://central.sonatype.comåç‚¹å‡»å³ä¸Šè§’çš„ç”¨æˆ·åç§°â€“&gt; View Account --&gt; Generate User Token 1234567891011&lt;settings&gt; [...] &lt;servers&gt; [...] &lt;server&gt; &lt;id&gt;maven-central&lt;/id&gt; &lt;username&gt;username&lt;/username&gt; &lt;password&gt;token&lt;/password&gt; &lt;/server&gt; &lt;/servers&gt;&lt;/settings&gt; 3.pom.xmlï¼Œé‡ç‚¹æ˜¯åé¢å‡ ä¸ªplugin è¿™é‡Œé‡ç‚¹è¯´ä¸€ä¸‹central-publishing-maven-pluginè¿™ä¸ªæ’ä»¶ï¼Œè¯¥æ’ä»¶ä¼šå°†jaråŒ…æ¨é€åˆ°Maven Centralä»“åº“ï¼Œå¦‚æœæ’ä»¶æ²¡æœ‰é…ç½®å‚æ•°autoPublishä¸ºtrueï¼Œåˆ™ä½†æ­¤æ—¶å‘å¸ƒçš„jarä¼šå¤„äºVALIDATEDçŠ¶æ€ï¼Œéœ€è¦ç™»å½•https://central.sonatype.comååˆ‡æ¢åˆ°Deploymentï¼Œæ‰¾åˆ°æˆ‘ä»¬åˆšåˆšä¸Šä¼ çš„åŒ…åï¼Œç„¶åç‚¹å‡»å³ä¾§çš„PublishæŒ‰é’®ï¼Œå¦‚æœä¸€åˆ‡é¡ºåˆ©ï¼Œå¤§äº10åˆ†é’Ÿåå…¶çŠ¶æ€å˜ä¸ºPUBLISHEDï¼Œè¡¨ç¤ºå‘å¸ƒæˆåŠŸã€‚å¦‚æœå‘å¸ƒå¤±è´¥ï¼Œå…¶çŠ¶æ€ä¼šå˜æ›´ä¸ºFAILEDï¼Œå¯ä»¥åœ¨Component Summaryä¸­æŸ¥çœ‹å¤±è´¥åŸå› ï¼Œé‡æ–°å‘å¸ƒå³å¯ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;groupId&gt;io.github.hanqunfeng&lt;/groupId&gt; &lt;artifactId&gt;aws-s3-v2-tools&lt;/artifactId&gt; &lt;version&gt;1.0.1&lt;/version&gt; &lt;packaging&gt;jar&lt;/packaging&gt; &lt;name&gt;aws-s3-v2-tools&lt;/name&gt; &lt;description&gt; AWS S3 Tools. &lt;/description&gt; &lt;url&gt;https://blog.hanqunfeng.com&lt;/url&gt; &lt;licenses&gt; &lt;license&gt; &lt;name&gt;The Apache License, Version 2.0&lt;/name&gt; &lt;url&gt;http://www.apache.org/licenses/LICENSE-2.0.txt&lt;/url&gt; &lt;/license&gt; &lt;/licenses&gt; &lt;developers&gt; &lt;developer&gt; &lt;id&gt;hanqf&lt;/id&gt; &lt;name&gt;hanqunfeng&lt;/name&gt; &lt;email&gt;qunfeng_han@126.com&lt;/email&gt; &lt;/developer&gt; &lt;/developers&gt; &lt;scm&gt; &lt;connection&gt;scm:git:https://github.com/hanqunfeng/aws-s3-v2-tools.git &lt;/connection&gt; &lt;developerConnection&gt; scm:git:https://github.com:hanqunfeng/aws-s3-v2-tools.git &lt;/developerConnection&gt; &lt;url&gt;https://github.com/hanqunfeng/aws-s3-v2-tools&lt;/url&gt; &lt;/scm&gt; &lt;properties&gt; &lt;java.version&gt;1.8&lt;/java.version&gt; &lt;maven.compiler.source&gt;8&lt;/maven.compiler.source&gt; &lt;maven.compiler.target&gt;8&lt;/maven.compiler.target&gt; &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt; &lt;/properties&gt; &lt;dependencyManagement&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;software.amazon.awssdk&lt;/groupId&gt; &lt;artifactId&gt;bom&lt;/artifactId&gt; &lt;version&gt;2.23.10&lt;/version&gt; &lt;type&gt;pom&lt;/type&gt; &lt;scope&gt;import&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/dependencyManagement&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;software.amazon.awssdk&lt;/groupId&gt; &lt;artifactId&gt;s3&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!-- ä¸ºé¿å…Potential Conflictsï¼Œä½ åº”è¯¥å°†commons-logging.jarä»classpathä¸­åˆ é™¤ã€‚ä½ å¯ä»¥å°è¯•ä»é¡¹ç›®ä¾èµ–ä¸­æ’é™¤commons-loggingï¼Œè¿™æ ·ä½ çš„åº”ç”¨ç¨‹åºå°±ä¼šè¢«å¼ºåˆ¶ä½¿ç”¨Spring JCLè€Œä¸æ˜¯Commons Loggingã€‚ --&gt; &lt;!-- é—®é¢˜ï¼šStandard Commons Logging discovery in action with spring-jcl: please remove commons-logging.jar from classpath in order to avoid potential conflicts --&gt; &lt;dependency&gt; &lt;groupId&gt;software.amazon.awssdk&lt;/groupId&gt; &lt;artifactId&gt;apache-client&lt;/artifactId&gt; &lt;exclusions&gt; &lt;exclusion&gt; &lt;groupId&gt;commons-logging&lt;/groupId&gt; &lt;artifactId&gt;commons-logging&lt;/artifactId&gt; &lt;/exclusion&gt; &lt;/exclusions&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;software.amazon.awssdk&lt;/groupId&gt; &lt;artifactId&gt;s3-transfer-manager&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;software.amazon.awssdk&lt;/groupId&gt; &lt;artifactId&gt;aws-crt-client&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;version&gt;1.18.32&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework&lt;/groupId&gt; &lt;artifactId&gt;spring-core&lt;/artifactId&gt; &lt;version&gt;5.3.29&lt;/version&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;build&gt; &lt;plugins&gt; &lt;plugin&gt; &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt; &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt; &lt;version&gt;3.8.1&lt;/version&gt; &lt;configuration&gt; &lt;source&gt;$&#123;java.version&#125;&lt;/source&gt; &lt;target&gt;$&#123;java.version&#125;&lt;/target&gt; &lt;/configuration&gt; &lt;/plugin&gt; &lt;plugin&gt; &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt; &lt;artifactId&gt;maven-source-plugin&lt;/artifactId&gt; &lt;version&gt;3.2.1&lt;/version&gt; &lt;executions&gt; &lt;execution&gt; &lt;id&gt;attach-source&lt;/id&gt; &lt;phase&gt;verify&lt;/phase&gt; &lt;goals&gt; &lt;!--ç”Ÿæˆæºä»£ç çš„jar --&gt; &lt;goal&gt;jar&lt;/goal&gt; &lt;/goals&gt; &lt;/execution&gt; &lt;/executions&gt; &lt;/plugin&gt; &lt;plugin&gt; &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt; &lt;artifactId&gt;maven-javadoc-plugin&lt;/artifactId&gt; &lt;version&gt;3.2.0&lt;/version&gt; &lt;executions&gt; &lt;execution&gt; &lt;id&gt;attach-javadoc&lt;/id&gt; &lt;phase&gt;verify&lt;/phase&gt; &lt;goals&gt; &lt;!--ç”Ÿæˆjavadocçš„jar --&gt; &lt;goal&gt;jar&lt;/goal&gt; &lt;!--ç”Ÿæˆjavadocçš„html --&gt; &lt;goal&gt;javadoc&lt;/goal&gt; &lt;/goals&gt; &lt;configuration&gt; &lt;!--ä¸æ˜¾ç¤ºjavadocè­¦å‘Š--&gt; &lt;additionalOptions&gt;-Xdoclint:none&lt;/additionalOptions&gt; &lt;additionalJOption&gt;-Xdoclint:none&lt;/additionalJOption&gt; &lt;/configuration&gt; &lt;/execution&gt; &lt;/executions&gt; &lt;/plugin&gt; &lt;!-- gpg plugin,ç”¨äºç­¾åè®¤è¯ --&gt; &lt;plugin&gt; &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt; &lt;artifactId&gt;maven-gpg-plugin&lt;/artifactId&gt; &lt;version&gt;1.6&lt;/version&gt; &lt;executions&gt; &lt;execution&gt; &lt;id&gt;sign-artifacts&lt;/id&gt; &lt;phase&gt;verify&lt;/phase&gt; &lt;goals&gt; &lt;goal&gt;sign&lt;/goal&gt; &lt;/goals&gt; &lt;/execution&gt; &lt;/executions&gt; &lt;/plugin&gt; &lt;!-- å‘å¸ƒåˆ°ç§æœæ—¶éœ€è¦æ³¨é‡Šæ‰ä¸‹é¢ä¸¤ä¸ªæ’ä»¶ --&gt; &lt;!--staging puglin,ç”¨äºè‡ªåŠ¨æ‰§è¡Œå‘å¸ƒé˜¶æ®µ(å…æ‰‹åŠ¨)--&gt; &lt;plugin&gt; &lt;groupId&gt;org.sonatype.central&lt;/groupId&gt; &lt;artifactId&gt;central-publishing-maven-plugin&lt;/artifactId&gt; &lt;version&gt;0.5.0&lt;/version&gt; &lt;extensions&gt;true&lt;/extensions&gt; &lt;configuration&gt; &lt;!-- è¿™é‡Œçš„publishingServerIdæ˜¯åœ¨settings.xmlä¸­é…ç½®çš„serverè®¤è¯ä¿¡æ¯ --&gt; &lt;publishingServerId&gt;maven-central&lt;/publishingServerId&gt; &lt;!-- è¿™é‡Œçš„autoPublishæ˜¯è‡ªåŠ¨å‘å¸ƒï¼Œè€Œä¸æ˜¯æ‰‹åŠ¨å‘å¸ƒ --&gt; &lt;autoPublish&gt;true&lt;/autoPublish&gt; &lt;!-- è¿™é‡Œçš„waitUntilé…ç½®ä¸ºpublishedæ˜¯ç­‰å¾…å‘å¸ƒå®Œæˆï¼Œå› ä¸ºå‘å¸ƒå®Œæˆçš„æ—¶é—´æ¯”è¾ƒé•¿ï¼Œæ‰€ä»¥å¯ä»¥ä¸åŠ è¿™ä¸ªå‚æ•° --&gt; &lt;waitUntil&gt;published&lt;/waitUntil&gt; &lt;!-- è¿™é‡Œçš„deploymentNameæ˜¯å‘å¸ƒåˆ°ä¸­å¤®ä»“åº“çš„åç§° --&gt; &lt;deploymentName&gt;$&#123;project.groupId&#125;:$&#123;project.artifactId&#125;:$&#123;project.version&#125;&lt;/deploymentName&gt; &lt;/configuration&gt; &lt;/plugin&gt; &lt;!-- release plugin,ç”¨äºå‘å¸ƒåˆ°releaseä»“åº“éƒ¨ç½²æ’ä»¶ --&gt; &lt;plugin&gt; &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt; &lt;artifactId&gt;maven-release-plugin&lt;/artifactId&gt; &lt;version&gt;2.5.3&lt;/version&gt; &lt;/plugin&gt; &lt;/plugins&gt; &lt;/build&gt; &lt;distributionManagement&gt; &lt;!-- &lt;repository&gt;--&gt; &lt;!-- &lt;id&gt;maven-releases&lt;/id&gt;--&gt; &lt;!-- &lt;name&gt;Nexus Release Repository&lt;/name&gt;--&gt; &lt;!-- &lt;url&gt;http://nexus.cxzh.ltd:8081/repository/maven-releases/&lt;/url&gt;--&gt; &lt;!-- &lt;/repository&gt;--&gt; &lt;!-- &lt;snapshotRepository&gt;--&gt; &lt;!-- &lt;id&gt;maven-snapshots&lt;/id&gt;--&gt; &lt;!-- &lt;name&gt;Nexus Snapshot Repository&lt;/name&gt;--&gt; &lt;!-- &lt;url&gt;http://nexus.cxzh.ltd:8081/repository/maven-snapshots/&lt;/url&gt;--&gt; &lt;!-- &lt;/snapshotRepository&gt;--&gt; &lt;/distributionManagement&gt;&lt;/project&gt; 4.æ‰§è¡Œå‘½ä»¤ 123mvn clean package # å®Œæˆæ‰“åŒ…å’Œæµ‹è¯•mvn clean verify # å®Œæˆæºç æ‰“åŒ…å’Œjavadocæ‰“åŒ…ï¼ŒåŒæ—¶å®Œæˆç­¾åmvn clean deploy # å®Œæˆæœ¬åœ°éƒ¨ç½²å’Œmavenä¸­å¤®ä»“åº“éƒ¨ç½² 4.1 æ‰§è¡Œè¿‡ç¨‹ä¸­ä¼šæç¤ºä½ è¾“å…¥åˆ›å»ºå¯†é’¥å¯¹æ—¶çš„å¯†ç ï¼Œå¦‚æœä¸æƒ³äººå·¥å‚ä¸ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å¦‚ä¸‹æ–¹å¼ï¼ˆå‚è€ƒï¼šhttp://maven.apache.org/plugins/maven-gpg-plugin/usage.htmlï¼‰ a.åœ¨æ‰§è¡Œå‘½ä»¤æ—¶æŒ‡å®šå¯†ç ï¼š 1mvn clean deploy -Dgpg.passphrase=thephrase b.setting.xmlä¸­åˆ›å»ºä¸€ä¸ªserver 12345678910&lt;settings&gt;[...]&lt;servers&gt; [...] &lt;server&gt; &lt;id&gt;gpg.passphrase&lt;/id&gt; &lt;passphrase&gt;clear or encrypted text&lt;/passphrase&gt; &lt;/server&gt;&lt;/servers&gt;&lt;/settings&gt; 6.æ›´æ–°éƒ¨ç½² ä¿®æ”¹pom.xmlä¸­çš„ç‰ˆæœ¬å·ï¼Œé‡æ–°æ‰§è¡Œmvn clean deployå³å¯ã€‚å‘å¸ƒçš„jaråŒ…å¯ä»¥åœ¨https://central.sonatype.comä¸­æ£€ç´¢ã€‚","summary":"æ‘˜è¦ https://oss.sonatype.orgå·²ç»ä¸å†æ”¯æŒæ–°ç”¨æˆ·æ³¨å†Œï¼Œæ–°çš„æ³¨å†Œåœ°å€ä¸ºhttps://central.sonatype.com é€šè¿‡æœ¬æ–‡ï¼Œä½ å°†çŸ¥é“å¦‚ä½•å°†Mavenæ„å»ºçš„é¡¹ç›®å‘å¸ƒåˆ°Mavenä¸­å¤®ä»“åº“ Gradleæ„å»ºæ–¹å¼è¯·çœ‹ å‘å¸ƒJaråˆ°Mavenä¸­å¤®ä»“åº“--Gradleç‰ˆ(æœ€æ–°æ–¹å¼) ã€‚","date_published":"2024-08-01T13:30:05.000Z","tags":["æŠ€æœ¯","maven","maven"]},{"id":"https://blog.hanqunfeng.com/2024/05/08/mysql8-upgrade/","url":"https://blog.hanqunfeng.com/2024/05/08/mysql8-upgrade/","title":"MySql--ä»Mysql5.7å‡çº§åˆ°Mysql8","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>MySqlçŸ¥è¯†ç‚¹ä»‹ç»:ä»Mysql5.7å‡çº§åˆ°Mysql8</p>\n</li>\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡åŸºäº<code>mysql-8.0.30</code>ï¼Œ<a href=\"https://dev.mysql.com/doc/refman/8.0/en/\">https://dev.mysql.com/doc/refman/8.0/en/</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>2024-04-30ï¼Œ<a href=\"https://dev.mysql.com/doc/relnotes/mysql/8.4/en/news-8-4-0.html\">mysql-8.4.0 LTS</a>ç‰ˆæœ¬å‘å¸ƒï¼Œæœ¬æ–‡åœ¨å°†mysqlä»5.7.44å‡çº§åˆ°8.0.30çš„åŸºç¡€ä¸Šï¼Œå‡çº§åˆ°8.4.0 LTSç‰ˆæœ¬ã€‚<a href=\"https://dev.mysql.com/doc/refman/8.4/en/\">mysql-8.4.0 LTSå®˜æ–¹æ–‡æ¡£</a></p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"ä»Mysql5-7å‡çº§åˆ°Mysql8\">ä»Mysql5.7å‡çº§åˆ°Mysql8</h2>\n<p><em><strong>å‡çº§å‰ï¼Œè¯·å…ˆå¤‡ä»½æ•°æ®åº“ï¼Œé˜²æ­¢å‡çº§å¤±è´¥</strong></em></p>\n<h3 id=\"mysqlsh\">mysqlsh</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åœ¨mysql8ä»¥å‰ï¼Œå‡çº§mysqlè¿˜æ˜¯æ¯”è¾ƒéº»çƒ¦çš„ï¼Œé™¤äº†è¦å¤„ç†ä¸å…¼å®¹çš„å‚æ•°å’Œè¯­æ³•å¤–ï¼Œè€Œä¸”ä¸æ”¯æŒè·¨ç‰ˆæœ¬çš„å‡çº§ï¼Œæ¯”å¦‚5.5å¿…é¡»å…ˆå‡çº§åˆ°5.6ï¼Œç„¶åå†å‡çº§åˆ°5.7ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><code>mysqlsh</code>æ˜¯mysqlå®˜æ–¹æä¾›çš„ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼Œæ˜¯MySQLçš„é«˜çº§å®¢æˆ·ç«¯å’Œä»£ç ç¼–è¾‘å™¨ã€‚å…¶ä¸ä»…å¯ä»¥åƒä½¿ç”¨<code>mysql</code>å‘½ä»¤ä¸€æ ·æ‰§è¡Œsqlï¼Œè€Œä¸”è¿˜æ”¯æŒjsè„šæœ¬ã€pythonè„šæœ¬ï¼Œç­‰ç­‰ï¼Œå…·ä½“å¯ä»¥æŸ¥çœ‹<a href=\"https://dev.mysql.com/doc/mysql-shell/8.0/en/mysql-shell-commands.html\">å®˜ç½‘</a>ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><code>mysqlsh</code>çš„ä¼—å¤šåŠŸèƒ½ä¹‹ä¸€å°±æ˜¯å¯ä»¥æ£€æµ‹å½“å‰ç‰ˆæœ¬æ˜¯å¦å¯ä»¥å‡çº§åˆ°ä¸å½“å‰<code>mysqlsh</code>ç›¸åŒçš„ç‰ˆæœ¬ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å¦‚æœä½ å½“å‰çš„ç‰ˆæœ¬æ˜¯5.6ï¼Œä½ ç”šè‡³éƒ½ä¸éœ€è¦å…ˆå°†æ•°æ®åº“å‡çº§åˆ°5.7å°±å¯ä»¥ç›´æ¥å‡çº§åˆ°8.0ï¼Œå› ä¸ºmysql8.0æ”¯æŒmysql5.5åˆ°mysql8.0çš„å‡çº§ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://dev.mysql.com/doc/mysql-shell/8.0/en/\">mysqlshå®˜æ–¹æ–‡æ¡£</a></p>\n</li>\n</ul>\n<h4 id=\"å®‰è£…mysqlsh\">å®‰è£…mysqlsh</h4>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><a href=\"https://dev.mysql.com/downloads/shell/\">å®˜ç½‘ä¸‹è½½åœ°å€</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>é€‰æ‹©éœ€è¦çš„ç‰ˆæœ¬è¿›è¡Œä¸‹è½½ï¼Œæˆ‘è¿™é‡Œé€‰æ‹©ä¸‹è½½çš„ç‰ˆæœ¬æ˜¯<a href=\"https://downloads.mysql.com/archives/get/p/43/file/mysql-shell-8.0.30-linux-glibc2.12-x86-64bit.tar.gz\">linuxçš„8.0.30ç‰ˆæœ¬</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>ä¸‹è½½åè§£å‹å³å¯</p>\n</li>\n</ul>\n<h4 id=\"æ£€æŸ¥æ˜¯å¦å¯ä»¥å‡çº§\">æ£€æŸ¥æ˜¯å¦å¯ä»¥å‡çº§</h4>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><a href=\"https://dev.mysql.com/doc/mysql-shell/8.0/en/mysql-shell-utilities-upgrade.html\">å®˜ç½‘è¯´æ˜</a></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># mysqlsh8.4ä»¥å‰å¯ä»¥ä½¿ç”¨å¦‚ä¸‹æ–¹æ³•ï¼Œå› ä¸ºå…¶é»˜è®¤å°±æ˜¯æ‰§è¡Œjsä»£ç </span></span><br><span class=\"line\">./mysqlsh username:password@host -e <span class=\"string\">&quot;util.checkForServerUpgrade()&quot;</span></span><br><span class=\"line\"><span class=\"comment\"># mysqlsh8.4åé»˜è®¤æ‰§è¡Œçš„æ˜¯sqlä»£ç ï¼Œæ‰€ä»¥è¦å…ˆç™»å½•ï¼Œåˆ‡æ¢åˆ°jsç¯å¢ƒåå†è¿è¡Œä¸Šé¢çš„ä»£ç </span></span><br><span class=\"line\"><span class=\"comment\"># ç™»å½•</span></span><br><span class=\"line\">./mysqlsh username:password@host</span><br><span class=\"line\"> MySQL  localhost  SQL  &gt; \\js</span><br><span class=\"line\">Switching to JavaScript mode...</span><br><span class=\"line\"> MySQL  localhost  JS  &gt; util.checkForServerUpgrade()</span><br><span class=\"line\"> â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦</span><br><span class=\"line\"> <span class=\"comment\"># é€€å‡º</span></span><br><span class=\"line\"> MySQL  localhost  JS &gt; \\q</span><br><span class=\"line\">Bye!</span><br></pre></td></tr></table></figure>\n<h4 id=\"æ£€æŸ¥è¾“å‡ºä¿¡æ¯è¯´æ˜\">æ£€æŸ¥è¾“å‡ºä¿¡æ¯è¯´æ˜</h4>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">WARNING: Using a password on the <span class=\"built_in\">command</span> line interface can be insecure.</span><br><span class=\"line\">The MySQL server at</span><br><span class=\"line\">localhost:3306, version</span><br><span class=\"line\">5.7.44-<span class=\"built_in\">log</span> - Please upgrade to 8.0 or opt-in to the paid RDS Extended Support</span><br><span class=\"line\">service before 5.7 reaches end of standard support on 29 February, 2024:</span><br><span class=\"line\">https://a.co/hQqiIn0, will now be checked <span class=\"keyword\">for</span> compatibility issues <span class=\"keyword\">for</span> upgrade</span><br><span class=\"line\">to MySQL 8.0.30...</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ—§æ—¶é—´ç±»å‹çš„ä½¿ç”¨</span></span><br><span class=\"line\">1) Usage of old temporal <span class=\"built_in\">type</span></span><br><span class=\"line\">  No issues found</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ä½¿ç”¨ä¸æ–°ä¿ç•™å…³é”®å­—å†²çªçš„æ•°æ®åº“å¯¹è±¡åç§°</span></span><br><span class=\"line\">2) Usage of db objects with names conflicting with new reserved keywords</span><br><span class=\"line\">  No issues found</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ä½¿ç”¨utf8mb3å­—ç¬¦é›†</span></span><br><span class=\"line\">3) Usage of utf8mb3 charset</span><br><span class=\"line\">  Warning: The following objects use the utf8mb3 character <span class=\"built_in\">set</span>. It is</span><br><span class=\"line\">    recommended to convert them to use utf8mb4 instead, <span class=\"keyword\">for</span> improved Unicode</span><br><span class=\"line\">    support.</span><br><span class=\"line\">  More information:</span><br><span class=\"line\">    https://dev.mysql.com/doc/refman/8.0/en/charset-unicode-utf8mb3.html</span><br><span class=\"line\"></span><br><span class=\"line\">  mydb - schema<span class=\"string\">&#x27;s default character set: utf8</span></span><br><span class=\"line\"><span class=\"string\">  mysql - schema&#x27;</span>s default character <span class=\"built_in\">set</span>: utf8</span><br><span class=\"line\">  mydb.tbl_info_i.a_product - column<span class=\"string\">&#x27;s default character set: utf8</span></span><br><span class=\"line\"><span class=\"string\">  mydb.tbl_info_i.a_country - column&#x27;</span>s default character <span class=\"built_in\">set</span>: utf8</span><br><span class=\"line\">  mydb.tbl_info_i.a_version - column<span class=\"string\">&#x27;s default character set: utf8</span></span><br><span class=\"line\"><span class=\"string\">  mydb.tbl_info_i.a_placement - column&#x27;</span>s default character <span class=\"built_in\">set</span>: utf8</span><br><span class=\"line\">â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># MySQLæ¨¡å¼ä¸­çš„è¡¨åä¸8.0ä¸­çš„æ–°è¡¨å†²çª</span></span><br><span class=\"line\">4) Table names <span class=\"keyword\">in</span> the mysql schema conflicting with new tables <span class=\"keyword\">in</span> 8.0</span><br><span class=\"line\">  No issues found</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ä½¿ç”¨éæœ¬æœºåˆ†åŒºå¼•æ“çš„åˆ†åŒºè¡¨</span></span><br><span class=\"line\">5) Partitioned tables using engines with non native partitioning</span><br><span class=\"line\">  No issues found</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å¤–é”®çº¦æŸåç§°è¶…è¿‡64ä¸ªå­—ç¬¦</span></span><br><span class=\"line\">6) Foreign key constraint names longer than 64 characters</span><br><span class=\"line\">  No issues found</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ä½¿ç”¨è¿‡æ—¶çš„MAXDB sql_modeæ ‡å¿—</span></span><br><span class=\"line\">7) Usage of obsolete MAXDB sql_mode flag</span><br><span class=\"line\">  No issues found</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ä½¿ç”¨è¿‡æ—¶çš„sql_modeæ ‡å¿—</span></span><br><span class=\"line\">8) Usage of obsolete sql_mode flags</span><br><span class=\"line\">  No issues found</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ENUM/SETåˆ—å®šä¹‰åŒ…å«è¶…è¿‡255ä¸ªå­—ç¬¦çš„å…ƒç´ </span></span><br><span class=\"line\">9) ENUM/SET column definitions containing elements longer than 255 characters</span><br><span class=\"line\">  No issues found</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åœ¨å…±äº«è¡¨ç©ºé—´ä¸­ä½¿ç”¨åˆ†åŒºè¡¨</span></span><br><span class=\"line\">10) Usage of partitioned tables <span class=\"keyword\">in</span> shared tablespaces</span><br><span class=\"line\">  No issues found</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># è¡¨ç©ºé—´æ•°æ®æ–‡ä»¶è·¯å¾„ä¸­çš„å¾ªç¯ç›®å½•å¼•ç”¨</span></span><br><span class=\"line\">11) Circular directory references <span class=\"keyword\">in</span> tablespace data file paths</span><br><span class=\"line\">  No issues found</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ä½¿ç”¨å·²åˆ é™¤çš„å‡½æ•°</span></span><br><span class=\"line\">12) Usage of removed <span class=\"built_in\">functions</span></span><br><span class=\"line\">  No issues found</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ä½¿ç”¨å·²åˆ é™¤çš„GROUP BY ASC/DESCè¯­æ³•</span></span><br><span class=\"line\">13) Usage of removed GROUP BY ASC/DESC syntax</span><br><span class=\"line\">  No issues found</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å·²åˆ é™¤çš„ç”¨äºé”™è¯¯æ—¥å¿—è®°å½•åˆ°ç³»ç»Ÿæ—¥å¿—é…ç½®çš„ç³»ç»Ÿå˜é‡</span></span><br><span class=\"line\">14) Removed system variables <span class=\"keyword\">for</span> error logging to the system <span class=\"built_in\">log</span> configuration</span><br><span class=\"line\">  To run this check requires full path to MySQL server configuration file to be specified at <span class=\"string\">&#x27;configPath&#x27;</span> key of options dictionary</span><br><span class=\"line\">  More information:</span><br><span class=\"line\">    https://dev.mysql.com/doc/relnotes/mysql/8.0/en/news-8-0-13.html#mysqld-8-0-13-logging</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å·²åˆ é™¤çš„ç³»ç»Ÿå˜é‡</span></span><br><span class=\"line\">15) Removed system variables</span><br><span class=\"line\">  To run this check requires full path to MySQL server configuration file to be specified at <span class=\"string\">&#x27;configPath&#x27;</span> key of options dictionary</span><br><span class=\"line\">  More information:</span><br><span class=\"line\">    https://dev.mysql.com/doc/refman/8.0/en/added-deprecated-removed.html#optvars-removed</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å…·æœ‰æ–°é»˜è®¤å€¼çš„ç³»ç»Ÿå˜é‡</span></span><br><span class=\"line\">16) System variables with new default values</span><br><span class=\"line\">  To run this check requires full path to MySQL server configuration file to be specified at <span class=\"string\">&#x27;configPath&#x27;</span> key of options dictionary</span><br><span class=\"line\">  More information:</span><br><span class=\"line\">    https://mysqlserverteam.com/new-defaults-in-mysql-8-0/</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># é›¶æ—¥æœŸã€æ—¥æœŸæ—¶é—´å’Œæ—¶é—´æˆ³å€¼</span></span><br><span class=\"line\">17) Zero Date, Datetime, and Timestamp values</span><br><span class=\"line\">  Warning: By default zero <span class=\"built_in\">date</span>/datetime/timestamp values are no longer allowed</span><br><span class=\"line\">    <span class=\"keyword\">in</span> MySQL, as of 5.7.8 NO_ZERO_IN_DATE and NO_ZERO_DATE are included <span class=\"keyword\">in</span></span><br><span class=\"line\">    SQL_MODE by default. These modes should be used with strict mode as they will</span><br><span class=\"line\">    be merged with strict mode <span class=\"keyword\">in</span> a future release. If you <span class=\"keyword\">do</span> not include these</span><br><span class=\"line\">    modes <span class=\"keyword\">in</span> your SQL_MODE setting, you are able to insert</span><br><span class=\"line\">    <span class=\"built_in\">date</span>/datetime/timestamp values that contain zeros. It is strongly advised to</span><br><span class=\"line\">    replace zero values with valid ones, as they may not work correctly <span class=\"keyword\">in</span> the</span><br><span class=\"line\">    future.</span><br><span class=\"line\">  More information:</span><br><span class=\"line\">    https://lefred.be/content/mysql-8-0-and-wrong-dates/</span><br><span class=\"line\"></span><br><span class=\"line\">  global.sql_mode - does not contain either NO_ZERO_DATE or NO_ZERO_IN_DATE</span><br><span class=\"line\">    <span class=\"built_in\">which</span> allows insertion of zero dates</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ç”±æ–‡ä»¶åˆ é™¤æˆ–æŸåå¯¼è‡´çš„æ¨¡å¼ä¸ä¸€è‡´</span></span><br><span class=\"line\">18) Schema inconsistencies resulting from file removal or corruption</span><br><span class=\"line\">  No issues found</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># è¢«InnoDBè¯†åˆ«ä½†å±äºä¸åŒå¼•æ“çš„è¡¨</span></span><br><span class=\"line\">19) Tables recognized by InnoDB that belong to a different engine</span><br><span class=\"line\">  No issues found</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># &#x27;check table x for upgrade&#x27;å‘½ä»¤æŠ¥å‘Šçš„é—®é¢˜</span></span><br><span class=\"line\">20) Issues reported by <span class=\"string\">&#x27;check table x for upgrade&#x27;</span> <span class=\"built_in\">command</span></span><br><span class=\"line\">  No issues found</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ–°çš„é»˜è®¤è®¤è¯æ’ä»¶è€ƒè™‘</span></span><br><span class=\"line\">21) New default authentication plugin considerations</span><br><span class=\"line\">  Warning: The new default authentication plugin <span class=\"string\">&#x27;caching_sha2_password&#x27;</span> offers</span><br><span class=\"line\">    more secure password hashing than previously used <span class=\"string\">&#x27;mysql_native_password&#x27;</span></span><br><span class=\"line\">    (and consequent improved client connection authentication). However, it also</span><br><span class=\"line\">    has compatibility implications that may affect existing MySQL installations.</span><br><span class=\"line\">    If your MySQL installation must serve pre-8.0 clients and you encounter</span><br><span class=\"line\">    compatibility issues after upgrading, the simplest way to address those</span><br><span class=\"line\">    issues is to reconfigure the server to revert to the previous default</span><br><span class=\"line\">    authentication plugin (mysql_native_password). For example, use these lines</span><br><span class=\"line\">    <span class=\"keyword\">in</span> the server option file:</span><br><span class=\"line\"></span><br><span class=\"line\">    [mysqld]</span><br><span class=\"line\">    default_authentication_plugin=mysql_native_password</span><br><span class=\"line\"></span><br><span class=\"line\">    However, the setting should be viewed as temporary, not as a long term or</span><br><span class=\"line\">    permanent solution, because it causes new accounts created with the setting</span><br><span class=\"line\">    <span class=\"keyword\">in</span> effect to forego the improved authentication security.</span><br><span class=\"line\">    If you are using replication please take time to understand how the</span><br><span class=\"line\">    authentication plugin changes may impact you.</span><br><span class=\"line\">  More information:</span><br><span class=\"line\">    https://dev.mysql.com/doc/refman/8.0/en/upgrading-from-previous-series.html#upgrade-caching-sha2-password-compatibility-issues</span><br><span class=\"line\">    https://dev.mysql.com/doc/refman/8.0/en/upgrading-from-previous-series.html#upgrade-caching-sha2-password-replication</span><br><span class=\"line\"></span><br><span class=\"line\">Errors:   0</span><br><span class=\"line\">Warnings: 98</span><br><span class=\"line\">Notices:  0</span><br><span class=\"line\"></span><br><span class=\"line\">NOTE: No fatal errors were found that would prevent an upgrade, but some potential issues were detected. Please ensure that the reported issues are not significant before upgrading.</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¯ä»¥çœ‹åˆ°ï¼Œå…¶æ£€æŸ¥çš„æ•°æ®åº“ç‰ˆæœ¬æ˜¯5.7.44ï¼Œå…¶æ£€æŸ¥æ˜¯å¦å¯ä»¥å‡çº§åˆ°8.0.30</p>\n</li>\n<li class=\"lvl-2\">\n<p>æ£€æµ‹é¡¹å…±æœ‰21ä¸ªï¼Œå…¶ä¸­è­¦å‘Šæœ‰98ä¸ªï¼Œé”™è¯¯æœ‰0ä¸ªï¼Œæ³¨æ„ï¼Œå¦‚æœæœ‰é”™è¯¯ï¼Œåˆ™ä¸èƒ½ç›´æ¥å‡çº§ï¼Œéœ€è¦è§£å†³é”™è¯¯é—®é¢˜ï¼Œå¦åˆ™å‡çº§ä¼šå¤±è´¥ã€‚è‡³äºè­¦å‘Šæš‚æ—¶å¯ä»¥ä¸å¤„ç†ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>è­¦å‘Šé›†ä¸­ä½“ç°åœ¨å­—ç¬¦é›†ä¸Šï¼Œ5.7.44çš„å­—ç¬¦é›†æ˜¯utf8(å®é™…å°±æ˜¯utf8mb3)ï¼Œè€Œmysql8ä»¥åçš„é»˜è®¤å­—ç¬¦é›†æ˜¯utf8mb4ï¼Œè¿™ä¸ªè­¦å‘Šä¸å½±å“å‡çº§ï¼Œå¯ä»¥å¿½ç•¥ã€‚å¦‚æœéœ€è¦ä¿®æ”¹å­—ç¬¦é›†åˆ°utf8mb4ï¼Œéœ€è¦æ³¨æ„åŸæ¥çš„å­—æ®µå­—ç¬¦ä¸²é•¿åº¦æ˜¯å¦ç¬¦åˆè¦æ±‚ï¼Œå› ä¸ºutf8mb4æ˜¯4å­—èŠ‚ï¼Œè€Œutf8mb3æ˜¯3å­—èŠ‚ã€‚å¦å¤–å¦‚æœä½¿ç”¨äº†å­˜å‚¨è¿‡ç¨‹ä¹Ÿè¦æ³¨æ„å‚æ•°çš„é•¿åº¦æ˜¯å¦ç¬¦åˆè¦æ±‚ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>è¿™é‡Œè¯´ä¸€ä¸‹<code>default_authentication_plugin</code>ï¼Œmysql8.0.13å¼€å§‹ï¼Œé»˜è®¤çš„è®¤è¯æ’ä»¶æ˜¯<code>caching_sha2_password</code>ï¼Œè€Œä¹‹å‰æ˜¯<code>mysql_native_password</code>ï¼Œè¿™ä¸ªè­¦å‘Šè™½ç„¶å¯ä»¥å¿½ç•¥ï¼Œä½†æ˜¯å‡çº§åå»ºè®®å°½å¿«å°†è®¤è¯æ’ä»¶ä¿®æ”¹ä¸º<code>caching_sha2_password</code>ï¼Œå› ä¸º<code>mysql_native_password</code>çš„è®¤è¯æ–¹å¼å­˜åœ¨å®‰å…¨æ¼æ´ï¼Œå¯ä»¥å‚è€ƒ<a href=\"https://dev.mysql.com/doc/refman/8.0/en/upgrading-from-previous-series.html#upgrade-caching-sha2-password-compatibility-issues\">å®˜æ–¹æ–‡æ¡£</a>ã€‚å¦å¤–ï¼Œä»mysql8.4.0å¼€å§‹ï¼Œä¸å†æ”¯æŒ<code>default_authentication_plugin</code>ï¼Œè‹¥è¦ä½¿å…¶æ”¯æŒ<code>mysql_native_password</code>æ’ä»¶ï¼Œ8.4.0å¼€å§‹ä¸ºæˆ‘ä»¬å¢åŠ äº†ä¸€ä¸ªæ–°çš„é…ç½®é¡¹<code>mysql-native-password</code>ï¼Œåœ¨[mysqld]ä¸­é…ç½®<code>mysql-native-password=ON</code>å³å¯å¼€å¯æ”¯æŒï¼Œé»˜è®¤ä¸º<code>OFF</code>ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å¦å¤–è¿˜è¦æ³¨æ„<code>å…³é”®è¯</code>å’Œ<code>ä¿ç•™è¯</code>çš„é—®é¢˜ï¼Œmysql8.0ä»¥åï¼Œåˆå¢åŠ äº†å¾ˆå¤šä¸ª<code>å…³é”®è¯</code>å’Œ<code>ä¿ç•™è¯</code>ï¼Œå¦‚æœæ£€æŸ¥åˆ°åˆ™éœ€è¦ä¿®æ”¹ä¸€ä¸‹ï¼Œä¸ç„¶å‡çº§ä¼šå¤±è´¥ã€‚å³ä¾¿è¡¨å’Œå­—æ®µé‡Œæ²¡æœ‰ä½¿ç”¨è¿™äº›ä¿ç•™å­—ï¼Œä¹Ÿè¦æ£€æŸ¥ä¸€ä¸‹ä¸šåŠ¡ä»£ç ä¸­æ˜¯å¦æœ‰ä½¿ç”¨ã€‚å…³äº<code>å…³é”®è¯</code>å’Œ<code>ä¿ç•™è¯</code>å¯ä»¥æŸ¥çœ‹å®˜ç½‘<a href=\"https://dev.mysql.com/doc/refman/8.0/en/keywords.html\">Keywords and Reserved Words</a>ï¼Œç›¸æ¯”äºMySQL 5.7ï¼Œå¢åŠ äº†å¤§çº¦130ä¸ªï¼ŒåŒæ—¶ä¹Ÿå‡å°‘äº†6ä¸ªã€‚</p>\n<blockquote>\n<p>è¿™é‡Œå»ºè®®è®¾ç½®è¡¨åç§°å’Œå­—æ®µåç§°æ—¶ï¼Œå¯ä»¥ä¸ºå…¶è®¾ç½®å‰ç¼€ï¼Œæ¯”å¦‚ï¼šè¡¨åç§°ä¸ºï¼št_userã€å­—æ®µåç§°ä¸ºï¼šf_user_id</p>\n</blockquote>\n</li>\n<li class=\"lvl-2\">\n<p>è¿˜æœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„ï¼ŒMysql8ä¿®æ”¹äº†å¾ˆå¤šå‚æ•°çš„é»˜è®¤å€¼ï¼Œå…·ä½“å¯ä»¥æŸ¥çœ‹<a href=\"https://dev.mysql.com/blog-archive/new-defaults-in-mysql-8-0/\">å®˜æ–¹ç½‘ç«™çš„è¯´æ˜</a>ï¼Œå¦‚æœä½ ä¸å¸Œæœ›ä½¿ç”¨é»˜è®¤å€¼ï¼Œåˆ™éœ€è¦å°†å…¶é…ç½®åˆ°é…ç½®æ–‡ä»¶ä¸­ï¼Œè¿™é‡Œå¼ºè°ƒä¸€ä¸‹ï¼Œé‡ç‚¹å…³æ³¨ <code>character_set_server</code> å’Œ <code>collation_server</code> è¿™ä¸¤ä¸ªå‚æ•°ã€‚æ‰€æœ‰çš„å‚æ•°é…ç½®å‚è€ƒ<a href=\"https://dev.mysql.com/doc/refman/8.0/en/programs.html\">å®˜æ–¹æ–‡æ¡£</a></p>\n</li>\n</ul>\n<div class=\"tips\">\n<p><em><strong>å…³äºå­—ç¬¦é›†è¿˜æƒ³å¤šè¯´ä¸¤å¥</strong></em></p>\n<ul class=\"lvl-1\">\n<li class=\"lvl-2\">mysql8çš„<code>character_set_server</code>é»˜è®¤æ˜¯<code>utf8mb4</code>ï¼Œ<code>collation_server</code>é»˜è®¤æ˜¯<code>utf8mb4_0900_ai_ci</code></li>\n<li class=\"lvl-2\">å¦‚æœåˆ›å»ºæ•°æ®åº“æˆ–è€…è¡¨çš„æ—¶å€™æ²¡æœ‰æŒ‡å®šå­—ç¬¦é›†ï¼Œåˆ™é»˜è®¤ä½¿ç”¨<code>character_set_server</code>å’Œ<code>collation_server</code>çš„é»˜è®¤å€¼</li>\n<li class=\"lvl-2\">æ­¤æ—¶æ–°åˆ›å»ºçš„è¡¨å°±æœ‰å¯èƒ½ä¸æ—§è¡¨å­—ç¬¦é›†ä¸ä¸€è‡´ï¼Œå…³è”æŸ¥è¯¢æ—¶å°±æœ‰å¯èƒ½å¯¼è‡´é”™è¯¯æˆ–å› ä¸ºéœ€è¦è¿›è¡Œå­—ç¬¦é›†è½¬æ¢å¯¼è‡´æŸ¥è¯¢æ€§èƒ½ä¸‹é™ã€‚</li>\n<li class=\"lvl-2\">æœ€å¥½çš„æ–¹å¼æ˜¯åˆ›å»ºæ•°æ®åº“æˆ–è¡¨æ—¶æ˜ç¡®æŒ‡å®šå­—ç¬¦é›†ï¼Œæˆ–è€…åœ¨<code>my.cnf</code>é…ç½®æ–‡ä»¶ä¸­é…ç½®<code>character_set_server</code>å’Œ<code>collation_server</code>çš„å€¼ã€‚</li>\n</ul>\n</div>\n<h3 id=\"å‡çº§æ•°æ®åº“çš„è¿‡ç¨‹\">å‡çº§æ•°æ®åº“çš„è¿‡ç¨‹</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å› ä¸ºæˆ‘ä»¬è¦å‡çº§åˆ°mysql8.0.30ï¼Œæ‰€ä»¥éœ€è¦å…ˆä¸‹è½½å¹¶å®‰è£…mysql8.0.30</p>\n</li>\n<li class=\"lvl-2\">\n<p>å…³é—­mysql5.7çš„æ•°æ®åº“</p>\n</li>\n<li class=\"lvl-2\">\n<p>å¤‡ä»½æ•°æ®ç›®å½•(ä¸€å®šè¦åšå¥½å¤‡ä»½ï¼Œå‡çº§åä¸èƒ½é™çº§çš„)</p>\n</li>\n<li class=\"lvl-2\">\n<p>æ ¹æ®æ£€æŸ¥æç¤ºä¿®æ”¹<code>my.cnf</code>é…ç½®æ–‡ä»¶ä¸­çš„é…ç½®(ä¸»è¦æ˜¯ä¸å…¼å®¹çš„é…ç½®ï¼Œå¦‚æœæ£€æŸ¥æç¤ºæ²¡æœ‰åˆ™ä¸éœ€è¦ä¿®æ”¹)</p>\n</li>\n<li class=\"lvl-2\">\n<p>éå¸¸é‡è¦çš„ä¸€æ­¥ï¼Œå°±æ˜¯ä¿®æ”¹<code>my.cnf</code>é…ç½®æ–‡ä»¶ä¸­çš„<code>basedir</code>ï¼Œå°†å…¶æŒ‡å‘mysql8.0.30çš„å®‰è£…ç›®å½•</p>\n</li>\n<li class=\"lvl-2\">\n<p>ç›´æ¥ä½¿ç”¨mysql8.0.30çš„å‘½ä»¤å¯åŠ¨æ•°æ®åº“ï¼Œå¯åŠ¨è¿‡ç¨‹ä¸­å°±ä¼šå®Œæˆæ•°æ®åº“çš„å‡çº§ï¼Œå¯ä»¥é€šè¿‡mysqlçš„æ—¥å¿—æ–‡ä»¶(log-error)æŸ¥çœ‹å‡çº§æƒ…å†µ</p>\n</li>\n<li class=\"lvl-2\">\n<p>å‡çº§å®Œæˆåå°½å¿«ä½¿ç”¨æ–°çš„å¯†ç è®¤è¯æ’ä»¶ä¿®æ”¹å¯†ç ï¼Œæ³¨æ„è¦ä¿®æ”¹æ‰€æœ‰ç”¨æˆ·çš„å¯†ç ï¼ŒåŒ…æ‹¬rootç”¨æˆ·</p>\n</li>\n</ul>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mysql<span class=\"operator\">&gt;</span> <span class=\"keyword\">ALTER</span> <span class=\"keyword\">USER</span> <span class=\"string\">&#x27;root&#x27;</span>@<span class=\"string\">&#x27;localhost&#x27;</span> IDENTIFIED <span class=\"keyword\">WITH</span> caching_sha2_password <span class=\"keyword\">BY</span> <span class=\"string\">&#x27;123456&#x27;</span>;</span><br></pre></td></tr></table></figure>\n<div class=\"tips\">\n<p><em><strong>å°è´´å£«</strong></em></p>\n<ul class=\"lvl-1\">\n<li class=\"lvl-2\">mysql8.4.0ç›¸æ¯”äºä¹‹å‰çš„ç‰ˆæœ¬å˜åŒ–æ¯”è¾ƒå¤§ï¼Œå…·ä½“å¯ä»¥æŸ¥çœ‹<a href=\"https://dev.mysql.com/doc/refman/8.4/en/mysql-nutshell.html\">å®˜ç½‘æ–‡æ¡£</a></li>\n<li class=\"lvl-2\">mysql5.7ä¸è¦ç›´æ¥å‡çº§åˆ°8.4.0åŠä»¥åçš„ç‰ˆæœ¬ï¼Œå¯ä»¥å…ˆå‡çº§åˆ°8.0.30ï¼Œç„¶åå†å‡çº§åˆ°8.4.0</li>\n<li class=\"lvl-2\">å‡çº§åˆ°8.4.0å‰ä¾æ—§è¦å…ˆä½¿ç”¨<code>mysqlsh</code>æ£€æŸ¥æ˜¯å¦å¯ä»¥å‡çº§ï¼Œæ³¨æ„è¦ä¸‹è½½å¯¹åº”çš„<code>mysqlsh</code>ç‰ˆæœ¬</li>\n<li class=\"lvl-2\">å‡çº§å‰è¦å…ˆæ£€æŸ¥æ˜¯å¦æ‰€æœ‰ç”¨æˆ·çš„å¯†ç æ’ä»¶éƒ½æ˜¯<code>caching_sha2_password</code>ï¼Œå¦‚æœæ²¡æœ‰åˆ™éœ€è¦ä¿®æ”¹</li>\n<li class=\"lvl-2\">å‡çº§å‰è¦å…ˆæ£€æŸ¥<code>my.cnf</code>ä¸­æ˜¯å¦é…ç½®äº†default_authentication_pluginï¼Œå¦‚æœæœ‰åˆ™åˆ é™¤ï¼Œå¦‚æœå¿…é¡»è¦é…ç½®<code>mysql_native_password</code>è®¤è¯æ’ä»¶ï¼Œåˆ™éœ€è¦é…ç½®<code>mysql-native-password=ON</code></li>\n<li class=\"lvl-2\">ä¿®æ”¹<code>my.cnf</code>ä¸­çš„<code>basedir</code>ä½¿å…¶æŒ‡å‘8.4.0çš„å®‰è£…ç›®å½•</li>\n<li class=\"lvl-2\">ä½¿ç”¨8.4.0çš„å‘½ä»¤å¯åŠ¨mysqlï¼Œæ£€æŸ¥æ—¥å¿—æ˜¯å¦æœ‰é”™è¯¯ã€‚</li>\n</ul>\n</div>\n<h2 id=\"mysql5-7-44å‡çº§åˆ°8-0-30ï¼Œå†å‡çº§åˆ°8-4-0çš„å®Œæ•´è¿‡ç¨‹\">mysql5.7.44å‡çº§åˆ°8.0.30ï¼Œå†å‡çº§åˆ°8.4.0çš„å®Œæ•´è¿‡ç¨‹</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å‡†å¤‡å¥½å„ä¸ªç‰ˆæœ¬çš„mysqlå’Œmysqlsh</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ç›®å½•ç»“æ„</span></span><br><span class=\"line\">mysql5 <span class=\"comment\"># 5.7.44å®‰è£…ç›®å½•</span></span><br><span class=\"line\">mysql8.0.30 <span class=\"comment\"># 8.0.30å®‰è£…ç›®å½•</span></span><br><span class=\"line\">mysql8.4.0 <span class=\"comment\"># 8.4.0å®‰è£…ç›®å½•</span></span><br><span class=\"line\">mysqlsh8.0.30 <span class=\"comment\"># 8.0.30çš„mysqlshå®‰è£…ç›®å½•</span></span><br><span class=\"line\">mysqlsh8.4.0 <span class=\"comment\"># 8.4.0çš„mysqlshå®‰è£…ç›®å½•</span></span><br><span class=\"line\">datas/mysql <span class=\"comment\"># å­˜æ”¾æ•°æ®ç›®å½•</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><code>mysql5/my.cnf</code>é…ç½®</p>\n</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[mysql]</span><br><span class=\"line\">default-character-set=utf8mb4</span><br><span class=\"line\">local_infile=ON</span><br><span class=\"line\"></span><br><span class=\"line\">[client]</span><br><span class=\"line\">default-character-set=utf8mb4</span><br><span class=\"line\">port       = 3306</span><br><span class=\"line\">socket     = /tmp/mysql.sock</span><br><span class=\"line\"></span><br><span class=\"line\">[mysqld]</span><br><span class=\"line\">skip-name-resolve</span><br><span class=\"line\">secure_file_priv=&quot;&quot;</span><br><span class=\"line\">local_infile=ON</span><br><span class=\"line\"></span><br><span class=\"line\">default_authentication_plugin=mysql_native_password</span><br><span class=\"line\"></span><br><span class=\"line\">port       = 3306</span><br><span class=\"line\">server-id  = 1001</span><br><span class=\"line\">user       = mysql</span><br><span class=\"line\">socket     = /tmp/mysql.sock</span><br><span class=\"line\">basedir    = /usr/local/soft/mysql5</span><br><span class=\"line\">datadir    = /usr/local/soft/datas/mysql</span><br><span class=\"line\"></span><br><span class=\"line\">log-bin    = mysql-bin</span><br><span class=\"line\">binlog-format = ROW</span><br><span class=\"line\"></span><br><span class=\"line\">expire-logs-days=10</span><br><span class=\"line\"></span><br><span class=\"line\">sync-binlog=0</span><br><span class=\"line\">innodb_data_home_dir      =./</span><br><span class=\"line\">innodb_log_group_home_dir =./</span><br><span class=\"line\">log-error =mysql.log</span><br><span class=\"line\">pid-file  =mysql.pid</span><br><span class=\"line\">character-set-server=utf8mb4</span><br><span class=\"line\">lower_case_table_names=1</span><br><span class=\"line\">autocommit =1</span><br><span class=\"line\">slow_query_log=1</span><br><span class=\"line\">slow_query_log_file=db_slow.log</span><br><span class=\"line\">long_query_time=5</span><br><span class=\"line\">log_output=FILE</span><br><span class=\"line\">log_queries_not_using_indexes=1</span><br><span class=\"line\">skip-external-locking</span><br><span class=\"line\">key_buffer_size = 256M</span><br><span class=\"line\">max_allowed_packet = 64M</span><br><span class=\"line\">table_open_cache = 1024</span><br><span class=\"line\">sort_buffer_size = 4M</span><br><span class=\"line\">net_buffer_length = 8K</span><br><span class=\"line\">read_buffer_size = 4M</span><br><span class=\"line\">read_rnd_buffer_size = 512K</span><br><span class=\"line\">myisam_sort_buffer_size = 64M</span><br><span class=\"line\">thread_cache_size = 64</span><br><span class=\"line\">tmp_table_size = 128M</span><br><span class=\"line\">explicit_defaults_for_timestamp = true</span><br><span class=\"line\">max_connections = 500</span><br><span class=\"line\">max_connect_errors = 100</span><br><span class=\"line\">open_files_limit = 65535</span><br><span class=\"line\">default_storage_engine = InnoDB</span><br><span class=\"line\">innodb_data_file_path = ibdata1:10M:autoextend</span><br></pre></td></tr></table></figure>\n<h3 id=\"5-7-44å‡çº§åˆ°8-0-30\">5.7.44å‡çº§åˆ°8.0.30</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å‡çº§æ£€æŸ¥</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å‡çº§æ£€æŸ¥</span></span><br><span class=\"line\">./mysqlsh8.0.30/bin/mysqlsh --uri root:123456@localhost  -e <span class=\"string\">&quot;util.checkForServerUpgrade()&quot;</span></span><br><span class=\"line\"><span class=\"comment\"># è¾“å‡º</span></span><br><span class=\"line\">WARNING: Using a password on the <span class=\"built_in\">command</span> line interface can be insecure.</span><br><span class=\"line\">The MySQL server at /tmp%2Fmysql.sock, version 5.7.44-<span class=\"built_in\">log</span> - MySQL Community</span><br><span class=\"line\">Server (GPL), will now be checked <span class=\"keyword\">for</span> compatibility issues <span class=\"keyword\">for</span> upgrade to MySQL</span><br><span class=\"line\">8.0.30...</span><br><span class=\"line\"></span><br><span class=\"line\">1) Usage of old temporal <span class=\"built_in\">type</span></span><br><span class=\"line\">  No issues found</span><br><span class=\"line\"></span><br><span class=\"line\">2) Usage of db objects with names conflicting with new reserved keywords</span><br><span class=\"line\">  No issues found</span><br><span class=\"line\"></span><br><span class=\"line\">3) Usage of utf8mb3 charset</span><br><span class=\"line\">  Warning: The following objects use the utf8mb3 character <span class=\"built_in\">set</span>. It is</span><br><span class=\"line\">    recommended to convert them to use utf8mb4 instead, <span class=\"keyword\">for</span> improved Unicode</span><br><span class=\"line\">    support.</span><br><span class=\"line\">  More information:</span><br><span class=\"line\">    https://dev.mysql.com/doc/refman/8.0/en/charset-unicode-utf8mb3.html</span><br><span class=\"line\"></span><br><span class=\"line\">  mydb - schema<span class=\"string\">&#x27;s default character set: utf8</span></span><br><span class=\"line\"><span class=\"string\">  mysql - schema&#x27;</span>s default character <span class=\"built_in\">set</span>: utf8</span><br><span class=\"line\">  mydb.tbl_info_i.a_product - column<span class=\"string\">&#x27;s default character set: utf8</span></span><br><span class=\"line\"><span class=\"string\">  mydb.tbl_info_i.a_country - column&#x27;</span>s default character <span class=\"built_in\">set</span>: utf8</span><br><span class=\"line\">  mydb.tbl_info_i.a_version - column<span class=\"string\">&#x27;s default character set: utf8</span></span><br><span class=\"line\"><span class=\"string\">  mydb.tbl_info_i.a_placement - column&#x27;</span>s default character <span class=\"built_in\">set</span>: utf8</span><br><span class=\"line\"> â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">4) Table names <span class=\"keyword\">in</span> the mysql schema conflicting with new tables <span class=\"keyword\">in</span> 8.0</span><br><span class=\"line\">  No issues found</span><br><span class=\"line\"></span><br><span class=\"line\">5) Partitioned tables using engines with non native partitioning</span><br><span class=\"line\">  No issues found</span><br><span class=\"line\"></span><br><span class=\"line\">6) Foreign key constraint names longer than 64 characters</span><br><span class=\"line\">  No issues found</span><br><span class=\"line\"></span><br><span class=\"line\">7) Usage of obsolete MAXDB sql_mode flag</span><br><span class=\"line\">  No issues found</span><br><span class=\"line\"></span><br><span class=\"line\">8) Usage of obsolete sql_mode flags</span><br><span class=\"line\">  Notice: The following DB objects have obsolete options persisted <span class=\"keyword\">for</span></span><br><span class=\"line\">    sql_mode, <span class=\"built_in\">which</span> will be cleared during upgrade to 8.0.</span><br><span class=\"line\">  More information:</span><br><span class=\"line\">    https://dev.mysql.com/doc/refman/8.0/en/mysql-nutshell.html#mysql-nutshell-removals</span><br><span class=\"line\"></span><br><span class=\"line\">  global system variable sql_mode - defined using obsolete NO_AUTO_CREATE_USER</span><br><span class=\"line\">    option</span><br><span class=\"line\"></span><br><span class=\"line\">9) ENUM/SET column definitions containing elements longer than 255 characters</span><br><span class=\"line\">  No issues found</span><br><span class=\"line\"></span><br><span class=\"line\">10) Usage of partitioned tables <span class=\"keyword\">in</span> shared tablespaces</span><br><span class=\"line\">  No issues found</span><br><span class=\"line\"></span><br><span class=\"line\">11) Circular directory references <span class=\"keyword\">in</span> tablespace data file paths</span><br><span class=\"line\">  No issues found</span><br><span class=\"line\"></span><br><span class=\"line\">12) Usage of removed <span class=\"built_in\">functions</span></span><br><span class=\"line\">  No issues found</span><br><span class=\"line\"></span><br><span class=\"line\">13) Usage of removed GROUP BY ASC/DESC syntax</span><br><span class=\"line\">  No issues found</span><br><span class=\"line\"></span><br><span class=\"line\">14) Removed system variables <span class=\"keyword\">for</span> error logging to the system <span class=\"built_in\">log</span> configuration</span><br><span class=\"line\">  To run this check requires full path to MySQL server configuration file to be specified at <span class=\"string\">&#x27;configPath&#x27;</span> key of options dictionary</span><br><span class=\"line\">  More information:</span><br><span class=\"line\">    https://dev.mysql.com/doc/relnotes/mysql/8.0/en/news-8-0-13.html#mysqld-8-0-13-logging</span><br><span class=\"line\"></span><br><span class=\"line\">15) Removed system variables</span><br><span class=\"line\">  To run this check requires full path to MySQL server configuration file to be specified at <span class=\"string\">&#x27;configPath&#x27;</span> key of options dictionary</span><br><span class=\"line\">  More information:</span><br><span class=\"line\">    https://dev.mysql.com/doc/refman/8.0/en/added-deprecated-removed.html#optvars-removed</span><br><span class=\"line\"></span><br><span class=\"line\">16) System variables with new default values</span><br><span class=\"line\">  To run this check requires full path to MySQL server configuration file to be specified at <span class=\"string\">&#x27;configPath&#x27;</span> key of options dictionary</span><br><span class=\"line\">  More information:</span><br><span class=\"line\">    https://mysqlserverteam.com/new-defaults-in-mysql-8-0/</span><br><span class=\"line\"></span><br><span class=\"line\">17) Zero Date, Datetime, and Timestamp values</span><br><span class=\"line\">  No issues found</span><br><span class=\"line\"></span><br><span class=\"line\">18) Schema inconsistencies resulting from file removal or corruption</span><br><span class=\"line\">  No issues found</span><br><span class=\"line\"></span><br><span class=\"line\">19) Tables recognized by InnoDB that belong to a different engine</span><br><span class=\"line\">  No issues found</span><br><span class=\"line\"></span><br><span class=\"line\">20) Issues reported by <span class=\"string\">&#x27;check table x for upgrade&#x27;</span> <span class=\"built_in\">command</span></span><br><span class=\"line\">  No issues found</span><br><span class=\"line\"></span><br><span class=\"line\">21) New default authentication plugin considerations</span><br><span class=\"line\">  Warning: The new default authentication plugin <span class=\"string\">&#x27;caching_sha2_password&#x27;</span> offers</span><br><span class=\"line\">    more secure password hashing than previously used <span class=\"string\">&#x27;mysql_native_password&#x27;</span></span><br><span class=\"line\">    (and consequent improved client connection authentication). However, it also</span><br><span class=\"line\">    has compatibility implications that may affect existing MySQL installations.</span><br><span class=\"line\">    If your MySQL installation must serve pre-8.0 clients and you encounter</span><br><span class=\"line\">    compatibility issues after upgrading, the simplest way to address those</span><br><span class=\"line\">    issues is to reconfigure the server to revert to the previous default</span><br><span class=\"line\">    authentication plugin (mysql_native_password). For example, use these lines</span><br><span class=\"line\">    <span class=\"keyword\">in</span> the server option file:</span><br><span class=\"line\"></span><br><span class=\"line\">    [mysqld]</span><br><span class=\"line\">    default_authentication_plugin=mysql_native_password</span><br><span class=\"line\"></span><br><span class=\"line\">    However, the setting should be viewed as temporary, not as a long term or</span><br><span class=\"line\">    permanent solution, because it causes new accounts created with the setting</span><br><span class=\"line\">    <span class=\"keyword\">in</span> effect to forego the improved authentication security.</span><br><span class=\"line\">    If you are using replication please take time to understand how the</span><br><span class=\"line\">    authentication plugin changes may impact you.</span><br><span class=\"line\">  More information:</span><br><span class=\"line\">    https://dev.mysql.com/doc/refman/8.0/en/upgrading-from-previous-series.html#upgrade-caching-sha2-password-compatibility-issues</span><br><span class=\"line\">    https://dev.mysql.com/doc/refman/8.0/en/upgrading-from-previous-series.html#upgrade-caching-sha2-password-replication</span><br><span class=\"line\"></span><br><span class=\"line\">Errors:   0</span><br><span class=\"line\">Warnings: 98</span><br><span class=\"line\">Notices:  1</span><br><span class=\"line\"></span><br><span class=\"line\">NOTE: No fatal errors were found that would prevent an upgrade, but some potential issues were detected. Please ensure that the reported issues are not significant before upgrading.</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>çœ‹åˆ°æ²¡æœ‰errorï¼Œå¼€å§‹å‡çº§</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å…³é—­æ•°æ®åº“</span></span><br><span class=\"line\">./mysql5/bin/mysqladmin --defaults-file=./mysql5/my.cnf -uroot -p123456 shutdown</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å¤åˆ¶mysqlé…ç½®æ–‡ä»¶</span></span><br><span class=\"line\"><span class=\"built_in\">cp</span> ./mysql5/my.cnf ./mysql8.0.30/my.cnf</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ä¿®æ”¹æ–°çš„é…ç½®æ–‡ä»¶ä¸­çš„basedirï¼Œä½¿å…¶æŒ‡å‘8.0.30çš„å®‰è£…è·¯å¾„</span></span><br><span class=\"line\">basedir    = /usr/local/soft/mysql8.0.30</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ä½¿ç”¨8.0.30å¯åŠ¨</span></span><br><span class=\"line\">./mysql8.0.30/bin/mysqld_safe --defaults-file=./mysql8.0.30/my.cnf &amp;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æŸ¥çœ‹å¯åŠ¨æ—¥å¿—ï¼Œæ²¡æœ‰é”™è¯¯è¯´æ˜å‡çº§æˆåŠŸ</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">2024-05-09T06:48:50.524705Z 0 [Warning] [MY-011068] [Server] The syntax <span class=\"string\">&#x27;expire-logs-days&#x27;</span> is deprecated and will be removed <span class=\"keyword\">in</span> a future release. Please use binlog_expire_logs_seconds instead.</span><br><span class=\"line\">2024-05-09T06:48:50.524819Z 0 [Warning] [MY-010097] [Server] Insecure configuration <span class=\"keyword\">for</span> --secure-file-priv: Current value does not restrict location of generated files. Consider setting it to a valid, non-empty path.</span><br><span class=\"line\">2024-05-09T06:48:50.524917Z 0 [Warning] [MY-010918] [Server] <span class=\"string\">&#x27;default_authentication_plugin&#x27;</span> is deprecated and will be removed <span class=\"keyword\">in</span> a future release. Please use authentication_policy instead.</span><br><span class=\"line\">2024-05-09T06:48:50.524983Z 0 [System] [MY-010116] [Server] /usr/local/soft/mysql8.0.30/bin/mysqld (mysqld 8.0.30) starting as process 26696</span><br><span class=\"line\">2024-05-09T06:48:50.563366Z 1 [System] [MY-011012] [Server] Starting upgrade of data directory.</span><br><span class=\"line\">2024-05-09T06:48:50.563414Z 1 [System] [MY-013576] [InnoDB] InnoDB initialization has started.</span><br><span class=\"line\">2024-05-09T06:48:51.260298Z 1 [System] [MY-013577] [InnoDB] InnoDB initialization has ended.</span><br><span class=\"line\">2024-05-09T06:48:53.614398Z 2 [System] [MY-011003] [Server] Finished populating Data Dictionary tables with data.</span><br><span class=\"line\">2024-05-09T06:48:55.055320Z 5 [System] [MY-013381] [Server] Server upgrade from <span class=\"string\">&#x27;50700&#x27;</span> to <span class=\"string\">&#x27;80030&#x27;</span> started.</span><br><span class=\"line\">2024-05-09T06:49:02.063990Z 5 [System] [MY-013381] [Server] Server upgrade from <span class=\"string\">&#x27;50700&#x27;</span> to <span class=\"string\">&#x27;80030&#x27;</span> completed.</span><br><span class=\"line\">2024-05-09T06:49:02.237992Z 0 [Warning] [MY-010068] [Server] CA certificate ca.pem is self signed.</span><br><span class=\"line\">2024-05-09T06:49:02.238048Z 0 [System] [MY-013602] [Server] Channel mysql_main configured to support TLS. Encrypted connections are now supported <span class=\"keyword\">for</span> this channel.</span><br><span class=\"line\">2024-05-09T06:49:02.267583Z 0 [System] [MY-011323] [Server] X Plugin ready <span class=\"keyword\">for</span> connections. Bind-address: <span class=\"string\">&#x27;::&#x27;</span> port: 33060, socket: /tmp/mysqlx.sock</span><br><span class=\"line\">2024-05-09T06:49:02.267648Z 0 [System] [MY-010931] [Server] /usr/local/soft/mysql8.0.30/bin/mysqld: ready <span class=\"keyword\">for</span> connections. Version: <span class=\"string\">&#x27;8.0.30&#x27;</span>  socket: <span class=\"string\">&#x27;/tmp/mysql.sock&#x27;</span>  port: 3306  MySQL Community Server - GPL.</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>æ ¹æ®æ—¥å¿—æç¤ºæˆ‘ä»¬åº”è¯¥ä¿®æ”¹ä¸¤ä¸ªé…ç½®å‚æ•°ï¼Œæœªæ¥å°†ä¸å¯ç”¨äº†ï¼Œä¸è¿‡è¿™é‡Œæš‚ä¸”å…ˆä¸å»ç®¡å®ƒï¼Œç­‰æ£€æŸ¥é€šä¸è¿‡äº†å†è¿›è¡Œå¤„ç†å°±å¯ä»¥ã€‚</p>\n</blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1.The syntax &#x27;expire-logs-days&#x27; is deprecated and will be removed in a future release. Please use binlog_expire_logs_seconds instead.</span><br><span class=\"line\">2.&#x27;default_authentication_plugin&#x27; is deprecated and will be removed in a future release. Please use authentication_policy instead.</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¿®æ”¹å¯†ç æ’ä»¶ï¼Œè¿™ä¸ªæ­¥éª¤å¾ˆé‡è¦</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ç™»å½•</span></span><br><span class=\"line\">./mysql8.0.30/bin/mysql -uroot -p123456</span><br><span class=\"line\"><span class=\"comment\"># å‡çº§å®Œæˆåä½¿ç”¨æ–°çš„å¯†ç è®¤è¯æ’ä»¶ä¿®æ”¹å¯†ç ï¼Œ8.4ä¸å†æ¨èmysql_native_passwordè®¤è¯æ’ï¼Œæ‰€ä»¥å‡çº§åˆ°8.4ä»¥å‰ä¸€å®šè¦å…ˆä¿®æ”¹å¯†ç æ’ä»¶ï¼Œå¦‚æœå¿˜è®°äº†ä¹Ÿæ²¡å…³ç³»ï¼Œæ–‡æœ«æœ‰é‡ç½®å¯†ç çš„æ–¹æ³•</span></span><br><span class=\"line\">mysql&gt; ALTER USER <span class=\"string\">&#x27;root&#x27;</span>@<span class=\"string\">&#x27;localhost&#x27;</span> IDENTIFIED WITH caching_sha2_password BY <span class=\"string\">&#x27;123456&#x27;</span>;</span><br></pre></td></tr></table></figure>\n<h3 id=\"8-0-30å‡çº§åˆ°8-4-0\">8.0.30å‡çº§åˆ°8.4.0</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åŒæ ·å…ˆç”¨8.4.0çš„mysqlshæ£€æŸ¥ä¸€ä¸‹</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å‡çº§æ£€æŸ¥</span></span><br><span class=\"line\">./mysqlsh8.4.0/bin/mysqlsh --uri root:123456@localhost</span><br><span class=\"line\"><span class=\"comment\"># è¾“å‡º</span></span><br><span class=\"line\">MySQL Shell 8.4.0</span><br><span class=\"line\"></span><br><span class=\"line\">Copyright (c) 2016, 2024, Oracle and/or its affiliates.</span><br><span class=\"line\">Oracle is a registered trademark of Oracle Corporation and/or its affiliates.</span><br><span class=\"line\">Other names may be trademarks of their respective owners.</span><br><span class=\"line\"></span><br><span class=\"line\">Type <span class=\"string\">&#x27;\\help&#x27;</span> or <span class=\"string\">&#x27;\\?&#x27;</span> <span class=\"keyword\">for</span> <span class=\"built_in\">help</span>; <span class=\"string\">&#x27;\\quit&#x27;</span> to <span class=\"built_in\">exit</span>.</span><br><span class=\"line\">WARNING: Using a password on the <span class=\"built_in\">command</span> line interface can be insecure.</span><br><span class=\"line\">Creating a Classic session to <span class=\"string\">&#x27;root@/tmp%2Fmysql.sock&#x27;</span></span><br><span class=\"line\">Fetching global names <span class=\"keyword\">for</span> auto-completion... Press ^C to stop.</span><br><span class=\"line\">Your MySQL connection <span class=\"built_in\">id</span> is 15</span><br><span class=\"line\">Server version: 8.0.30 MySQL Community Server - GPL</span><br><span class=\"line\">No default schema selected; <span class=\"built_in\">type</span> \\use &lt;schema&gt; to <span class=\"built_in\">set</span> one.</span><br><span class=\"line\"> MySQL  localhost  SQL &gt; \\js</span><br><span class=\"line\">Switching to JavaScript mode...</span><br><span class=\"line\"> MySQL  localhost  JS &gt; util.checkForServerUpgrade()</span><br><span class=\"line\">The MySQL server at /tmp%2Fmysql.sock, version 8.0.30 - MySQL Community Server</span><br><span class=\"line\">- GPL, will now be checked <span class=\"keyword\">for</span> compatibility issues <span class=\"keyword\">for</span> upgrade to MySQL 8.4.0.</span><br><span class=\"line\">To check <span class=\"keyword\">for</span> a different target server version, use the targetVersion option.</span><br><span class=\"line\"></span><br><span class=\"line\">WARNING: Upgrading MySQL Server from version 8.0.30 to 8.4.0 is not supported.</span><br><span class=\"line\">Please consider running the check using the following option: targetVersion=8.0</span><br><span class=\"line\"></span><br><span class=\"line\">1) Usage of db objects with names conflicting with new reserved keywords</span><br><span class=\"line\">(reservedKeywords)</span><br><span class=\"line\">  No issues found</span><br><span class=\"line\"></span><br><span class=\"line\">2) Removed system variables (removedSysVars)</span><br><span class=\"line\">  Error: Following system variables that were detected as being used will be</span><br><span class=\"line\">    removed. Please update your system to not rely on them before the upgrade.</span><br><span class=\"line\">  More information:</span><br><span class=\"line\">    https://dev.mysql.com/doc/refman/8.0/en/added-deprecated-removed.html#optvars-removed</span><br><span class=\"line\"></span><br><span class=\"line\">  expire_logs_days - Error: The system variable <span class=\"string\">&#x27;expire_logs_days&#x27;</span> is <span class=\"built_in\">set</span> to 10</span><br><span class=\"line\">    (EXPLICIT) and will be removed.</span><br><span class=\"line\"></span><br><span class=\"line\">3) System variables with new default values (sysVarsNewDefaults)</span><br><span class=\"line\">  Warning: Following system variables that are not defined <span class=\"keyword\">in</span> your</span><br><span class=\"line\">    configuration file will have new default values. Please review <span class=\"keyword\">if</span> you rely on</span><br><span class=\"line\">    their current values and <span class=\"keyword\">if</span> so define them before performing upgrade.</span><br><span class=\"line\">  More information:</span><br><span class=\"line\">    https://dev.mysql.com/blog-archive/new-defaults-in-mysql-8-0/</span><br><span class=\"line\"></span><br><span class=\"line\">  binlog_transaction_dependency_tracking - default value will change from</span><br><span class=\"line\">    COMMIT_ORDER to WRITESET.</span><br><span class=\"line\">  group_replication_consistency - default value will change from EVENTUAL to</span><br><span class=\"line\">    BEFORE_ON_PRIMARY_FAILOVER.</span><br><span class=\"line\">  group_replication_exit_state_action - default value will change from</span><br><span class=\"line\">    READ_ONLY to OFFLINE_MODE.</span><br><span class=\"line\">  innodb_adaptive_hash_index - default value will change from ON to OFF.</span><br><span class=\"line\">  innodb_buffer_pool_in_core_file - default value will change from ON to OFF.</span><br><span class=\"line\">  innodb_buffer_pool_instances - default value will change from 8 (or 1 <span class=\"keyword\">if</span></span><br><span class=\"line\">    innodb_buffer_pool_size &lt; 1GB) to MAX(1, <span class=\"comment\">#vcpu/4).</span></span><br><span class=\"line\">  innodb_change_buffering - default value will change from all to none.</span><br><span class=\"line\">  innodb_doublewrite_files - default value will change from</span><br><span class=\"line\">    innodb_buffer_pool_instances * 2 to 2.</span><br><span class=\"line\">  innodb_doublewrite_pages - default value will change from</span><br><span class=\"line\">    innodb_write_io_threads to 128.</span><br><span class=\"line\">  innodb_flush_method - default value will change from fsynch (unix) or</span><br><span class=\"line\">    unbuffered (windows) to O_DIRECT.</span><br><span class=\"line\">  innodb_io_capacity - default value will change from 200 to 10000.</span><br><span class=\"line\">  innodb_io_capacity_max - default value will change from 200 to 2 x</span><br><span class=\"line\">    innodb_io_capacity.</span><br><span class=\"line\">  innodb_log_buffer_size - default value will change from 16777216 (16MB) to</span><br><span class=\"line\">    67108864 (64MB).</span><br><span class=\"line\">  innodb_log_writer_threads - default value will change from ON to OFF ( <span class=\"keyword\">if</span></span><br><span class=\"line\">    <span class=\"comment\">#vcpu &lt;= 32 ).</span></span><br><span class=\"line\">  innodb_numa_interleave - default value will change from OFF to ON.</span><br><span class=\"line\">  innodb_page_cleaners - default value will change from 4 to</span><br><span class=\"line\">    innodb_buffer_pool_instances.</span><br><span class=\"line\">  innodb_parallel_read_threads - default value will change from 4 to</span><br><span class=\"line\">    MAX(#vcpu/8, 4).</span><br><span class=\"line\">  innodb_purge_threads - default value will change from 4 to 1 ( <span class=\"keyword\">if</span> <span class=\"comment\">#vcpu &lt;= 16</span></span><br><span class=\"line\">    ).</span><br><span class=\"line\">  innodb_read_io_threads - default value will change from 4 to MAX(#vcpu/2, 4).</span><br><span class=\"line\">  innodb_redo_log_capacity - default value will change from 104857600 (100MB)</span><br><span class=\"line\">    to MIN ( <span class=\"comment\">#vcpu/2, 16 )GB.</span></span><br><span class=\"line\"></span><br><span class=\"line\">4) Issues reported by <span class=\"string\">&#x27;check table x for upgrade&#x27;</span> <span class=\"built_in\">command</span> (checkTableCommand)</span><br><span class=\"line\">  No issues found</span><br><span class=\"line\"></span><br><span class=\"line\">5) Check <span class=\"keyword\">for</span> deprecated usage of single dollar signs <span class=\"keyword\">in</span> object names</span><br><span class=\"line\">(dollarSignName)</span><br><span class=\"line\">  No issues found</span><br><span class=\"line\"></span><br><span class=\"line\">6) Check <span class=\"keyword\">for</span> deprecated or invalid user authentication methods.</span><br><span class=\"line\">(authMethodUsage)</span><br><span class=\"line\">  Warning: The following <span class=\"built_in\">users</span> are using the <span class=\"string\">&#x27;mysql_native_password&#x27;</span></span><br><span class=\"line\">  authentication method <span class=\"built_in\">which</span> is deprecated as of MySQL 8.0.0 and will be</span><br><span class=\"line\">  removed <span class=\"keyword\">in</span> a future release.</span><br><span class=\"line\">  Consider switching the <span class=\"built_in\">users</span> to a different authentication method (i.e.</span><br><span class=\"line\">  caching_sha2_password).</span><br><span class=\"line\"></span><br><span class=\"line\">  - mydb@%</span><br><span class=\"line\">  - mysql.session@localhost</span><br><span class=\"line\">  - mysql.sys@localhost</span><br><span class=\"line\">  - root@localhost</span><br><span class=\"line\"></span><br><span class=\"line\">  More information:</span><br><span class=\"line\">    https://dev.mysql.com/doc/refman/8.0/en/caching-sha2-pluggable-authentication.html</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">7) Check <span class=\"keyword\">for</span> deprecated or removed plugin usage. (pluginUsage)</span><br><span class=\"line\">  No issues found</span><br><span class=\"line\"></span><br><span class=\"line\">8) Check <span class=\"keyword\">for</span> deprecated or invalid default authentication methods <span class=\"keyword\">in</span> system</span><br><span class=\"line\">variables. (deprecatedDefaultAuth)</span><br><span class=\"line\">  The following variables have problems with their <span class=\"built_in\">set</span> authentication method:</span><br><span class=\"line\"></span><br><span class=\"line\">  Error: default_authentication_plugin - mysql_native_password authentication</span><br><span class=\"line\">    method was removed and it must be corrected before upgrading to 8.4.0 release.</span><br><span class=\"line\"></span><br><span class=\"line\">9) Check <span class=\"keyword\">for</span> deprecated or invalid authentication methods <span class=\"keyword\">in</span> use by MySQL</span><br><span class=\"line\">Router internal accounts. (deprecatedRouterAuthMethod)</span><br><span class=\"line\">  No issues found</span><br><span class=\"line\"></span><br><span class=\"line\">10) Checks <span class=\"keyword\">for</span> errors <span class=\"keyword\">in</span> column definitions (columnDefinition)</span><br><span class=\"line\">  No issues found</span><br><span class=\"line\"></span><br><span class=\"line\">11) Check <span class=\"keyword\">for</span> allowed values <span class=\"keyword\">in</span> System Variables. (sysvarAllowedValues)</span><br><span class=\"line\">  No issues found</span><br><span class=\"line\"></span><br><span class=\"line\">12) Checks <span class=\"keyword\">for</span> user privileges that will be removed (invalidPrivileges)</span><br><span class=\"line\">  Verifies <span class=\"keyword\">for</span> <span class=\"built_in\">users</span> containing grants to be removed, since privileges are</span><br><span class=\"line\">    removed as part of the upgrade, raises a NOTICE to inform the user about</span><br><span class=\"line\">    <span class=\"built_in\">users</span> that will be losing invalid privileges</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"string\">&#x27;mysql.session&#x27;</span>@<span class=\"string\">&#x27;localhost&#x27;</span> - The user <span class=\"string\">&#x27;mysql.session&#x27;</span>@<span class=\"string\">&#x27;localhost&#x27;</span> has the</span><br><span class=\"line\">    following privileges that will be removed as part of the upgrade process:</span><br><span class=\"line\">    SET_USER_ID</span><br><span class=\"line\">  <span class=\"string\">&#x27;root&#x27;</span>@<span class=\"string\">&#x27;localhost&#x27;</span> - The user <span class=\"string\">&#x27;root&#x27;</span>@<span class=\"string\">&#x27;localhost&#x27;</span> has the following privileges</span><br><span class=\"line\">    that will be removed as part of the upgrade process: SET_USER_ID</span><br><span class=\"line\"></span><br><span class=\"line\">13) Checks <span class=\"keyword\">for</span> partitions by key using columns with prefix key indexes</span><br><span class=\"line\">(partitionsWithPrefixKeys)</span><br><span class=\"line\">  No issues found</span><br><span class=\"line\"></span><br><span class=\"line\">Errors:   2</span><br><span class=\"line\">Warnings: 24</span><br><span class=\"line\">Notices:  2</span><br><span class=\"line\"></span><br><span class=\"line\">ERROR: 2 errors were found. Please correct these issues before upgrading to avoid compatibility issues.</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>çœ‹åˆ°äº†ä¸¤å¤„é”™è¯¯ï¼Œå°±æ˜¯æˆ‘ä»¬ä¸Šé¢è¯´çš„é‚£ä¸¤ä¸ªå‚æ•°éœ€è¦ä¿®æ”¹ï¼Œä¿®æ”¹<code>./mysql8.0.30/my.cnf</code></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># binlogæ—¥å¿—è¿‡æœŸæ—¶é—´ï¼Œå•ä½ç§’ï¼Œè¿‡æœŸçš„binlogæ—¥å¿—ä¼šè¢«åˆ é™¤ï¼Œä¿è¯ç£ç›˜ç©ºé—´ï¼Œè¿™é‡Œè®¾ç½®ä¸º10å¤©ï¼Œmysql8ä»¥å‰çš„ç‰ˆæœ¬è¿™ä¸ªå‚æ•°æ˜¯expire-logs-daysï¼Œå•ä½æ˜¯å¤©</span></span><br><span class=\"line\">binlog_expire_logs_seconds =864000</span><br><span class=\"line\"><span class=\"comment\">#expire-logs-days=10</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#default_authentication_plugin=mysql_native_password</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¿®æ”¹åè¦é‡å¯æ•°æ®åº“</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å…³é—­æ•°æ®åº“</span></span><br><span class=\"line\"> ./mysql8.0.30/bin/mysqladmin --defaults-file=./mysql8.0.30/my.cnf -uroot -p123456 shutdown</span><br><span class=\"line\"></span><br><span class=\"line\"> <span class=\"comment\"># ä½¿ç”¨8.0.30å¯åŠ¨</span></span><br><span class=\"line\"> ./mysql8.0.30/bin/mysqld_safe --defaults-file=./mysql8.0.30/my.cnf &amp;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å†æ¬¡è¿›ç¨‹å‡çº§æ£€æŸ¥</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å‡çº§æ£€æŸ¥</span></span><br><span class=\"line\">./mysqlsh8.4.0/bin/mysqlsh --uri root:123456@localhost</span><br><span class=\"line\"><span class=\"comment\"># è¾“å‡º</span></span><br><span class=\"line\">MySQL Shell 8.4.0</span><br><span class=\"line\"></span><br><span class=\"line\">Copyright (c) 2016, 2024, Oracle and/or its affiliates.</span><br><span class=\"line\">Oracle is a registered trademark of Oracle Corporation and/or its affiliates.</span><br><span class=\"line\">Other names may be trademarks of their respective owners.</span><br><span class=\"line\"></span><br><span class=\"line\">Type <span class=\"string\">&#x27;\\help&#x27;</span> or <span class=\"string\">&#x27;\\?&#x27;</span> <span class=\"keyword\">for</span> <span class=\"built_in\">help</span>; <span class=\"string\">&#x27;\\quit&#x27;</span> to <span class=\"built_in\">exit</span>.</span><br><span class=\"line\">WARNING: Using a password on the <span class=\"built_in\">command</span> line interface can be insecure.</span><br><span class=\"line\">Creating a Classic session to <span class=\"string\">&#x27;root@/tmp%2Fmysql.sock&#x27;</span></span><br><span class=\"line\">Fetching global names <span class=\"keyword\">for</span> auto-completion... Press ^C to stop.</span><br><span class=\"line\">Your MySQL connection <span class=\"built_in\">id</span> is 8</span><br><span class=\"line\">Server version: 8.0.30 MySQL Community Server - GPL</span><br><span class=\"line\">No default schema selected; <span class=\"built_in\">type</span> \\use &lt;schema&gt; to <span class=\"built_in\">set</span> one.</span><br><span class=\"line\"> MySQL  localhost  SQL &gt; \\js</span><br><span class=\"line\">Switching to JavaScript mode...</span><br><span class=\"line\"> MySQL  localhost  JS &gt; util.checkForServerUpgrade()</span><br><span class=\"line\">The MySQL server at /tmp%2Fmysql.sock, version 8.0.30 - MySQL Community Server</span><br><span class=\"line\">- GPL, will now be checked <span class=\"keyword\">for</span> compatibility issues <span class=\"keyword\">for</span> upgrade to MySQL 8.4.0.</span><br><span class=\"line\">To check <span class=\"keyword\">for</span> a different target server version, use the targetVersion option.</span><br><span class=\"line\"></span><br><span class=\"line\">WARNING: Upgrading MySQL Server from version 8.0.30 to 8.4.0 is not supported.</span><br><span class=\"line\">Please consider running the check using the following option: targetVersion=8.0</span><br><span class=\"line\"></span><br><span class=\"line\">1) Usage of db objects with names conflicting with new reserved keywords</span><br><span class=\"line\">(reservedKeywords)</span><br><span class=\"line\">  No issues found</span><br><span class=\"line\"></span><br><span class=\"line\">2) Removed system variables (removedSysVars)</span><br><span class=\"line\">  No issues found</span><br><span class=\"line\"></span><br><span class=\"line\">3) System variables with new default values (sysVarsNewDefaults)</span><br><span class=\"line\">  Warning: Following system variables that are not defined <span class=\"keyword\">in</span> your</span><br><span class=\"line\">    configuration file will have new default values. Please review <span class=\"keyword\">if</span> you rely on</span><br><span class=\"line\">    their current values and <span class=\"keyword\">if</span> so define them before performing upgrade.</span><br><span class=\"line\">  More information:</span><br><span class=\"line\">    https://dev.mysql.com/blog-archive/new-defaults-in-mysql-8-0/</span><br><span class=\"line\"></span><br><span class=\"line\">  binlog_transaction_dependency_tracking - default value will change from</span><br><span class=\"line\">    COMMIT_ORDER to WRITESET.</span><br><span class=\"line\">  group_replication_consistency - default value will change from EVENTUAL to</span><br><span class=\"line\">    BEFORE_ON_PRIMARY_FAILOVER.</span><br><span class=\"line\">  group_replication_exit_state_action - default value will change from</span><br><span class=\"line\">    READ_ONLY to OFFLINE_MODE.</span><br><span class=\"line\">  innodb_adaptive_hash_index - default value will change from ON to OFF.</span><br><span class=\"line\">  innodb_buffer_pool_in_core_file - default value will change from ON to OFF.</span><br><span class=\"line\">  innodb_buffer_pool_instances - default value will change from 8 (or 1 <span class=\"keyword\">if</span></span><br><span class=\"line\">    innodb_buffer_pool_size &lt; 1GB) to MAX(1, <span class=\"comment\">#vcpu/4).</span></span><br><span class=\"line\">  innodb_change_buffering - default value will change from all to none.</span><br><span class=\"line\">  innodb_doublewrite_files - default value will change from</span><br><span class=\"line\">    innodb_buffer_pool_instances * 2 to 2.</span><br><span class=\"line\">  innodb_doublewrite_pages - default value will change from</span><br><span class=\"line\">    innodb_write_io_threads to 128.</span><br><span class=\"line\">  innodb_flush_method - default value will change from fsynch (unix) or</span><br><span class=\"line\">    unbuffered (windows) to O_DIRECT.</span><br><span class=\"line\">  innodb_io_capacity - default value will change from 200 to 10000.</span><br><span class=\"line\">  innodb_io_capacity_max - default value will change from 200 to 2 x</span><br><span class=\"line\">    innodb_io_capacity.</span><br><span class=\"line\">  innodb_log_buffer_size - default value will change from 16777216 (16MB) to</span><br><span class=\"line\">    67108864 (64MB).</span><br><span class=\"line\">  innodb_log_writer_threads - default value will change from ON to OFF ( <span class=\"keyword\">if</span></span><br><span class=\"line\">    <span class=\"comment\">#vcpu &lt;= 32 ).</span></span><br><span class=\"line\">  innodb_numa_interleave - default value will change from OFF to ON.</span><br><span class=\"line\">  innodb_page_cleaners - default value will change from 4 to</span><br><span class=\"line\">    innodb_buffer_pool_instances.</span><br><span class=\"line\">  innodb_parallel_read_threads - default value will change from 4 to</span><br><span class=\"line\">    MAX(#vcpu/8, 4).</span><br><span class=\"line\">  innodb_purge_threads - default value will change from 4 to 1 ( <span class=\"keyword\">if</span> <span class=\"comment\">#vcpu &lt;= 16</span></span><br><span class=\"line\">    ).</span><br><span class=\"line\">  innodb_read_io_threads - default value will change from 4 to MAX(#vcpu/2, 4).</span><br><span class=\"line\">  innodb_redo_log_capacity - default value will change from 104857600 (100MB)</span><br><span class=\"line\">    to MIN ( <span class=\"comment\">#vcpu/2, 16 )GB.</span></span><br><span class=\"line\"></span><br><span class=\"line\">4) Issues reported by <span class=\"string\">&#x27;check table x for upgrade&#x27;</span> <span class=\"built_in\">command</span> (checkTableCommand)</span><br><span class=\"line\">  No issues found</span><br><span class=\"line\"></span><br><span class=\"line\">5) Check <span class=\"keyword\">for</span> deprecated usage of single dollar signs <span class=\"keyword\">in</span> object names</span><br><span class=\"line\">(dollarSignName)</span><br><span class=\"line\">  No issues found</span><br><span class=\"line\"></span><br><span class=\"line\">6) Check <span class=\"keyword\">for</span> deprecated or invalid user authentication methods.</span><br><span class=\"line\">(authMethodUsage)</span><br><span class=\"line\">  Warning: The following <span class=\"built_in\">users</span> are using the <span class=\"string\">&#x27;mysql_native_password&#x27;</span></span><br><span class=\"line\">  authentication method <span class=\"built_in\">which</span> is deprecated as of MySQL 8.0.0 and will be</span><br><span class=\"line\">  removed <span class=\"keyword\">in</span> a future release.</span><br><span class=\"line\">  Consider switching the <span class=\"built_in\">users</span> to a different authentication method (i.e.</span><br><span class=\"line\">  caching_sha2_password).</span><br><span class=\"line\"></span><br><span class=\"line\">  - mydb@%</span><br><span class=\"line\">  - mysql.session@localhost</span><br><span class=\"line\">  - mysql.sys@localhost</span><br><span class=\"line\">  - root@localhost</span><br><span class=\"line\"></span><br><span class=\"line\">  More information:</span><br><span class=\"line\">    https://dev.mysql.com/doc/refman/8.0/en/caching-sha2-pluggable-authentication.html</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">7) Check <span class=\"keyword\">for</span> deprecated or removed plugin usage. (pluginUsage)</span><br><span class=\"line\">  No issues found</span><br><span class=\"line\"></span><br><span class=\"line\">8) Check <span class=\"keyword\">for</span> deprecated or invalid default authentication methods <span class=\"keyword\">in</span> system</span><br><span class=\"line\">variables. (deprecatedDefaultAuth)</span><br><span class=\"line\">  No issues found</span><br><span class=\"line\"></span><br><span class=\"line\">9) Check <span class=\"keyword\">for</span> deprecated or invalid authentication methods <span class=\"keyword\">in</span> use by MySQL</span><br><span class=\"line\">Router internal accounts. (deprecatedRouterAuthMethod)</span><br><span class=\"line\">  No issues found</span><br><span class=\"line\"></span><br><span class=\"line\">10) Checks <span class=\"keyword\">for</span> errors <span class=\"keyword\">in</span> column definitions (columnDefinition)</span><br><span class=\"line\">  No issues found</span><br><span class=\"line\"></span><br><span class=\"line\">11) Check <span class=\"keyword\">for</span> allowed values <span class=\"keyword\">in</span> System Variables. (sysvarAllowedValues)</span><br><span class=\"line\">  No issues found</span><br><span class=\"line\"></span><br><span class=\"line\">12) Checks <span class=\"keyword\">for</span> user privileges that will be removed (invalidPrivileges)</span><br><span class=\"line\">  Verifies <span class=\"keyword\">for</span> <span class=\"built_in\">users</span> containing grants to be removed, since privileges are</span><br><span class=\"line\">    removed as part of the upgrade, raises a NOTICE to inform the user about</span><br><span class=\"line\">    <span class=\"built_in\">users</span> that will be losing invalid privileges</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"string\">&#x27;mysql.session&#x27;</span>@<span class=\"string\">&#x27;localhost&#x27;</span> - The user <span class=\"string\">&#x27;mysql.session&#x27;</span>@<span class=\"string\">&#x27;localhost&#x27;</span> has the</span><br><span class=\"line\">    following privileges that will be removed as part of the upgrade process:</span><br><span class=\"line\">    SET_USER_ID</span><br><span class=\"line\">  <span class=\"string\">&#x27;root&#x27;</span>@<span class=\"string\">&#x27;localhost&#x27;</span> - The user <span class=\"string\">&#x27;root&#x27;</span>@<span class=\"string\">&#x27;localhost&#x27;</span> has the following privileges</span><br><span class=\"line\">    that will be removed as part of the upgrade process: SET_USER_ID</span><br><span class=\"line\"></span><br><span class=\"line\">13) Checks <span class=\"keyword\">for</span> partitions by key using columns with prefix key indexes</span><br><span class=\"line\">(partitionsWithPrefixKeys)</span><br><span class=\"line\">  No issues found</span><br><span class=\"line\"></span><br><span class=\"line\">Errors:   0</span><br><span class=\"line\">Warnings: 24</span><br><span class=\"line\">Notices:  2</span><br><span class=\"line\"></span><br><span class=\"line\">NOTE: No fatal errors were found that would prevent an upgrade, but some potential issues were detected. Please ensure that the reported issues are not significant before upgrading.</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ­¤æ—¶çœ‹åˆ°é€šè¿‡æ£€æŸ¥ï¼Œå…³é—­æ•°æ®åº“ç›´æ¥å‡çº§å§</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å…³é—­æ•°æ®åº“</span></span><br><span class=\"line\">./mysql8.0.30/bin/mysqladmin --defaults-file=./mysql8.0.30/my.cnf -uroot -p123456 shutdown</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å¤åˆ¶mysqlé…ç½®æ–‡ä»¶</span></span><br><span class=\"line\"><span class=\"built_in\">cp</span> ./mysql8.0.30/my.cnf ./mysql8.4.0/my.cnf</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ä¿®æ”¹æ–°çš„é…ç½®æ–‡ä»¶ä¸­çš„basedirï¼Œä½¿å…¶æŒ‡å‘8.4.0çš„å®‰è£…è·¯å¾„</span></span><br><span class=\"line\">basedir    = /usr/local/soft/mysql8.4.0</span><br><span class=\"line\"></span><br><span class=\"line\"> <span class=\"comment\"># ä½¿ç”¨8.4.0å¯åŠ¨</span></span><br><span class=\"line\">./mysql8.4.0/bin/mysqld_safe --defaults-file=./mysql8.4.0/my.cnf &amp;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æŸ¥çœ‹æ—¥å¿—ï¼Œä¾æ—§æ˜¯æ²¡æœ‰é”™è¯¯ï¼Œå‡çº§å¾ˆé¡ºåˆ©</p>\n</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">2024-05-09T07:21:55.325669Z 0 [System] [MY-015015] [Server] MySQL Server - start.</span><br><span class=\"line\">2024-05-09T07:21:55.740435Z 0 [Warning] [MY-011070] [Server] &#x27;binlog_format&#x27; is deprecated and will be removed in a future release.</span><br><span class=\"line\">2024-05-09T07:21:55.740549Z 0 [Warning] [MY-010097] [Server] Insecure configuration for --secure-file-priv: Current value does not restrict location of generated files. Consider setting it to a valid, non-empty path.</span><br><span class=\"line\">2024-05-09T07:21:55.740629Z 0 [System] [MY-010116] [Server] /usr/local/soft/mysql-8.4.0-linux-glibc2.17-x86_64/bin/mysqld (mysqld 8.4.0) starting as process 28414</span><br><span class=\"line\">2024-05-09T07:21:55.796983Z 1 [System] [MY-013576] [InnoDB] InnoDB initialization has started.</span><br><span class=\"line\">2024-05-09T07:21:56.421873Z 1 [System] [MY-013577] [InnoDB] InnoDB initialization has ended.</span><br><span class=\"line\">2024-05-09T07:21:56.442008Z 1 [System] [MY-011090] [Server] Data dictionary upgrading from version &#x27;80023&#x27; to &#x27;80300&#x27;.</span><br><span class=\"line\">2024-05-09T07:21:57.106002Z 1 [System] [MY-013413] [Server] Data dictionary upgrade from version &#x27;80023&#x27; to &#x27;80300&#x27; completed.</span><br><span class=\"line\">2024-05-09T07:22:00.128935Z 4 [System] [MY-013381] [Server] Server upgrade from &#x27;80030&#x27; to &#x27;80400&#x27; started.</span><br><span class=\"line\">2024-05-09T07:22:06.850838Z 4 [System] [MY-013381] [Server] Server upgrade from &#x27;80030&#x27; to &#x27;80400&#x27; completed.</span><br><span class=\"line\">2024-05-09T07:22:07.063386Z 0 [Warning] [MY-010068] [Server] CA certificate ca.pem is self signed.</span><br><span class=\"line\">2024-05-09T07:22:07.063456Z 0 [System] [MY-013602] [Server] Channel mysql_main configured to support TLS. Encrypted connections are now supported for this channel.</span><br><span class=\"line\">2024-05-09T07:22:07.085760Z 0 [System] [MY-010931] [Server] /usr/local/soft/mysql-8.4.0-linux-glibc2.17-x86_64/bin/mysqld: ready for connections. Version: &#x27;8.4.0&#x27;  socket: &#x27;/tmp/mysql.sock&#x27;  port: 3306  MySQL Community Server - GPL.</span><br><span class=\"line\">2024-05-09T07:22:07.340333Z 0 [System] [MY-011323] [Server] X Plugin ready for connections. Bind-address: &#x27;::&#x27; port: 33060, socket: /tmp/mysqlx.sock</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>ä»æ—¥å¿—çœ‹åˆ°â€™binlog_formatâ€™ä¹Ÿè¦ä¸æ”¯æŒäº†ï¼Œä¸è¿‡å…ˆä¸ç”¨ç®¡ï¼Œç­‰åˆ°ä¸æ”¯æŒäº†å†å¤„ç†å§ã€‚</p>\n</blockquote>\n<h2 id=\"å¦‚æœå‡çº§åˆ°8-4ä¹‹å‰å¿˜è®°ä¿®æ”¹å¯†ç æ’ä»¶äº†ï¼Œåˆ™å‡çº§ä¹‹åå°±ä¸èƒ½æ­£å¸¸ç™»å½•äº†ï¼Œæ­¤æ—¶æ€ä¹ˆåŠå‘¢ï¼Ÿ\">å¦‚æœå‡çº§åˆ°8.4ä¹‹å‰å¿˜è®°ä¿®æ”¹å¯†ç æ’ä»¶äº†ï¼Œåˆ™å‡çº§ä¹‹åå°±ä¸èƒ½æ­£å¸¸ç™»å½•äº†ï¼Œæ­¤æ—¶æ€ä¹ˆåŠå‘¢ï¼Ÿ</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å‡çº§åˆ°8.4ä¹‹å‰å¿˜è®°ä¿®æ”¹å¯†ç æ’ä»¶äº†ï¼Œåˆ™å‡çº§ä¹‹åç™»å½•æ•°æ®åº“ä¼šæŠ¥å‘Šå¦‚ä¸‹é”™è¯¯</p>\n</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ERROR 1524 (HY000): Plugin &#x27;mysql_native_password&#x27; is not loaded</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è§£å†³æ–¹æ¡ˆ<br>\nåœ¨mysqlçš„é…ç½®æ–‡ä»¶ä¸­å¢åŠ <code>mysql-native-password=ON</code>ï¼Œç„¶åé‡å¯æ•°æ®åº“å³å¯ï¼Œä½†è¿˜æ˜¯å»ºè®®å°½å¿«ä¿®æ”¹ç”¨æˆ·çš„è®¤è¯æ’ä»¶ä¸º<code>caching_sha2_password</code>å§ï¼Œæ¯•ç«Ÿè¿™ä¸ªè®¤è¯æ–¹å¼å­˜åœ¨å®‰å…¨æ¼æ´ã€‚</p>\n</li>\n</ul>\n<div class=\"tips\">\n<p><em><strong>å°è´´å£«</strong></em><br>\nç¬”è€…ä¹‹å‰æ²¡æœ‰æ³¨æ„åˆ°8.4.0æ–°å¢çš„<code>mysql-native-password=ON</code>è¿™ä¸ªé…ç½®ï¼Œæ‰€ä»¥é‡‡ç”¨äº†å¦‚ä¸‹é‡ç½®å¯†ç çš„æ–¹å¼è¿›è¡Œæ’ä»¶ä¿®æ”¹ï¼Œç•™ä¸ªçºªå¿µå§ã€‚</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># killæ‰mysqlæœåŠ¡</span></span><br><span class=\"line\">killall mysqld</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ— æƒé™æ¨¡å¼å¯åŠ¨</span></span><br><span class=\"line\">./mysql8.4.0/bin/mysqld_safe --defaults-file=./mysql8.4.0/my.cnf --skip-grant-tables &amp;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ç™»å½•ï¼Œæ­¤æ—¶ä¸éœ€è¦å¯†ç </span></span><br><span class=\"line\">./mysql8.4.0/bin/mysql -uroot</span><br><span class=\"line\"></span><br><span class=\"line\">mysql&gt; USE mysql;</span><br><span class=\"line\"><span class=\"comment\"># ä¿®æ”¹å¯†ç æ’ä»¶ä¸º caching_sha2_password</span></span><br><span class=\"line\">mysql&gt; UPDATE user SET plugin=<span class=\"string\">&#x27;caching_sha2_password&#x27;</span> WHERE User=<span class=\"string\">&#x27;root&#x27;</span>;</span><br><span class=\"line\"><span class=\"comment\"># å°†å¯†ç è®¾ç½®ä¸ºç©º</span></span><br><span class=\"line\">mysql&gt; UPDATE user SET authentication_string=null WHERE User=<span class=\"string\">&#x27;root&#x27;</span>;</span><br><span class=\"line\"><span class=\"comment\"># åˆ·æ–°æƒé™ï¼š</span></span><br><span class=\"line\">mysql&gt; FLUSH PRIVILEGES;</span><br><span class=\"line\"><span class=\"comment\"># é€€å‡ºMySQL</span></span><br><span class=\"line\">mysql&gt; <span class=\"built_in\">exit</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å…³é—­æ•°æ®åº“ï¼Œæ­¤æ—¶ä¸éœ€è¦å¯†ç å³å¯å…³é—­</span></span><br><span class=\"line\">./mysql8.4.0/bin/mysqladmin --defaults-file=./mysql8.4.0/my.cnf -uroot -p shutdown</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># é‡å¯å¯åŠ¨mysqlæœåŠ¡</span></span><br><span class=\"line\">./mysql8.4.0/bin/mysqld_safe --defaults-file=./mysql8.4.0/my.cnf &amp;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ç™»å½•ï¼Œæ­¤æ—¶ä¾æ—§ä¸éœ€è¦å¯†ç </span></span><br><span class=\"line\">./mysql8.4.0/bin/mysql -uroot</span><br><span class=\"line\"><span class=\"comment\"># è®¾ç½®å¯†ç </span></span><br><span class=\"line\">mysql&gt; ALTER USER <span class=\"string\">&#x27;root&#x27;</span>@<span class=\"string\">&#x27;localhost&#x27;</span> IDENTIFIED BY <span class=\"string\">&#x27;123456&#x27;</span>;</span><br><span class=\"line\"><span class=\"comment\"># åˆ·æ–°æƒé™ï¼š</span></span><br><span class=\"line\">mysql&gt; FLUSH PRIVILEGES;</span><br><span class=\"line\"><span class=\"comment\"># é€€å‡ºMySQL</span></span><br><span class=\"line\">mysql&gt; <span class=\"built_in\">exit</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ç™»å½•ï¼Œæ­¤æ—¶ä½¿ç”¨å¯†ç å°±å¯ä»¥æ­£å¸¸ç™»å½•äº†</span></span><br><span class=\"line\">./mysql8.4.0/bin/mysql -uroot -p123456</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ä¹‹åå†ä¿®æ”¹å…¶ä»–ç”¨æˆ·çš„å¯†ç å³å¯ï¼Œæ¯”å¦‚</span></span><br><span class=\"line\">mysql&gt; ALTER USER <span class=\"string\">&#x27;other&#x27;</span>@<span class=\"string\">&#x27;%&#x27;</span> IDENTIFIED WITH caching_sha2_password BY <span class=\"string\">&#x27;otherpass&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹ä¿®æ”¹åçš„userä¿¡æ¯</span></span><br><span class=\"line\">mysql&gt; use mysql;</span><br><span class=\"line\">mysql&gt; <span class=\"keyword\">select</span> user,host,plugin from user;</span><br></pre></td></tr></table></figure>\n</div>\n","content_text":"æ‘˜è¦ MySqlçŸ¥è¯†ç‚¹ä»‹ç»:ä»Mysql5.7å‡çº§åˆ°Mysql8 æœ¬æ–‡åŸºäºmysql-8.0.30ï¼Œhttps://dev.mysql.com/doc/refman/8.0/en/ 2024-04-30ï¼Œmysql-8.4.0 LTSç‰ˆæœ¬å‘å¸ƒï¼Œæœ¬æ–‡åœ¨å°†mysqlä»5.7.44å‡çº§åˆ°8.0.30çš„åŸºç¡€ä¸Šï¼Œå‡çº§åˆ°8.4.0 LTSç‰ˆæœ¬ã€‚mysql-8.4.0 LTSå®˜æ–¹æ–‡æ¡£ ä»Mysql5.7å‡çº§åˆ°Mysql8 å‡çº§å‰ï¼Œè¯·å…ˆå¤‡ä»½æ•°æ®åº“ï¼Œé˜²æ­¢å‡çº§å¤±è´¥ mysqlsh åœ¨mysql8ä»¥å‰ï¼Œå‡çº§mysqlè¿˜æ˜¯æ¯”è¾ƒéº»çƒ¦çš„ï¼Œé™¤äº†è¦å¤„ç†ä¸å…¼å®¹çš„å‚æ•°å’Œè¯­æ³•å¤–ï¼Œè€Œä¸”ä¸æ”¯æŒè·¨ç‰ˆæœ¬çš„å‡çº§ï¼Œæ¯”å¦‚5.5å¿…é¡»å…ˆå‡çº§åˆ°5.6ï¼Œç„¶åå†å‡çº§åˆ°5.7ã€‚ mysqlshæ˜¯mysqlå®˜æ–¹æä¾›çš„ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼Œæ˜¯MySQLçš„é«˜çº§å®¢æˆ·ç«¯å’Œä»£ç ç¼–è¾‘å™¨ã€‚å…¶ä¸ä»…å¯ä»¥åƒä½¿ç”¨mysqlå‘½ä»¤ä¸€æ ·æ‰§è¡Œsqlï¼Œè€Œä¸”è¿˜æ”¯æŒjsè„šæœ¬ã€pythonè„šæœ¬ï¼Œç­‰ç­‰ï¼Œå…·ä½“å¯ä»¥æŸ¥çœ‹å®˜ç½‘ã€‚ mysqlshçš„ä¼—å¤šåŠŸèƒ½ä¹‹ä¸€å°±æ˜¯å¯ä»¥æ£€æµ‹å½“å‰ç‰ˆæœ¬æ˜¯å¦å¯ä»¥å‡çº§åˆ°ä¸å½“å‰mysqlshç›¸åŒçš„ç‰ˆæœ¬ã€‚ å¦‚æœä½ å½“å‰çš„ç‰ˆæœ¬æ˜¯5.6ï¼Œä½ ç”šè‡³éƒ½ä¸éœ€è¦å…ˆå°†æ•°æ®åº“å‡çº§åˆ°5.7å°±å¯ä»¥ç›´æ¥å‡çº§åˆ°8.0ï¼Œå› ä¸ºmysql8.0æ”¯æŒmysql5.5åˆ°mysql8.0çš„å‡çº§ã€‚ mysqlshå®˜æ–¹æ–‡æ¡£ å®‰è£…mysqlsh å®˜ç½‘ä¸‹è½½åœ°å€ é€‰æ‹©éœ€è¦çš„ç‰ˆæœ¬è¿›è¡Œä¸‹è½½ï¼Œæˆ‘è¿™é‡Œé€‰æ‹©ä¸‹è½½çš„ç‰ˆæœ¬æ˜¯linuxçš„8.0.30ç‰ˆæœ¬ ä¸‹è½½åè§£å‹å³å¯ æ£€æŸ¥æ˜¯å¦å¯ä»¥å‡çº§ å®˜ç½‘è¯´æ˜ 123456789101112# mysqlsh8.4ä»¥å‰å¯ä»¥ä½¿ç”¨å¦‚ä¸‹æ–¹æ³•ï¼Œå› ä¸ºå…¶é»˜è®¤å°±æ˜¯æ‰§è¡Œjsä»£ç ./mysqlsh username:password@host -e &quot;util.checkForServerUpgrade()&quot;# mysqlsh8.4åé»˜è®¤æ‰§è¡Œçš„æ˜¯sqlä»£ç ï¼Œæ‰€ä»¥è¦å…ˆç™»å½•ï¼Œåˆ‡æ¢åˆ°jsç¯å¢ƒåå†è¿è¡Œä¸Šé¢çš„ä»£ç # ç™»å½•./mysqlsh username:password@host MySQL localhost SQL &gt; \\jsSwitching to JavaScript mode... MySQL localhost JS &gt; util.checkForServerUpgrade() â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦ # é€€å‡º MySQL localhost JS &gt; \\qBye! æ£€æŸ¥è¾“å‡ºä¿¡æ¯è¯´æ˜ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148WARNING: Using a password on the command line interface can be insecure.The MySQL server atlocalhost:3306, version5.7.44-log - Please upgrade to 8.0 or opt-in to the paid RDS Extended Supportservice before 5.7 reaches end of standard support on 29 February, 2024:https://a.co/hQqiIn0, will now be checked for compatibility issues for upgradeto MySQL 8.0.30...# æ—§æ—¶é—´ç±»å‹çš„ä½¿ç”¨1) Usage of old temporal type No issues found# ä½¿ç”¨ä¸æ–°ä¿ç•™å…³é”®å­—å†²çªçš„æ•°æ®åº“å¯¹è±¡åç§°2) Usage of db objects with names conflicting with new reserved keywords No issues found# ä½¿ç”¨utf8mb3å­—ç¬¦é›†3) Usage of utf8mb3 charset Warning: The following objects use the utf8mb3 character set. It is recommended to convert them to use utf8mb4 instead, for improved Unicode support. More information: https://dev.mysql.com/doc/refman/8.0/en/charset-unicode-utf8mb3.html mydb - schema&#x27;s default character set: utf8 mysql - schema&#x27;s default character set: utf8 mydb.tbl_info_i.a_product - column&#x27;s default character set: utf8 mydb.tbl_info_i.a_country - column&#x27;s default character set: utf8 mydb.tbl_info_i.a_version - column&#x27;s default character set: utf8 mydb.tbl_info_i.a_placement - column&#x27;s default character set: utf8â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦# MySQLæ¨¡å¼ä¸­çš„è¡¨åä¸8.0ä¸­çš„æ–°è¡¨å†²çª4) Table names in the mysql schema conflicting with new tables in 8.0 No issues found# ä½¿ç”¨éæœ¬æœºåˆ†åŒºå¼•æ“çš„åˆ†åŒºè¡¨5) Partitioned tables using engines with non native partitioning No issues found# å¤–é”®çº¦æŸåç§°è¶…è¿‡64ä¸ªå­—ç¬¦6) Foreign key constraint names longer than 64 characters No issues found# ä½¿ç”¨è¿‡æ—¶çš„MAXDB sql_modeæ ‡å¿—7) Usage of obsolete MAXDB sql_mode flag No issues found# ä½¿ç”¨è¿‡æ—¶çš„sql_modeæ ‡å¿—8) Usage of obsolete sql_mode flags No issues found# ENUM/SETåˆ—å®šä¹‰åŒ…å«è¶…è¿‡255ä¸ªå­—ç¬¦çš„å…ƒç´ 9) ENUM/SET column definitions containing elements longer than 255 characters No issues found# åœ¨å…±äº«è¡¨ç©ºé—´ä¸­ä½¿ç”¨åˆ†åŒºè¡¨10) Usage of partitioned tables in shared tablespaces No issues found# è¡¨ç©ºé—´æ•°æ®æ–‡ä»¶è·¯å¾„ä¸­çš„å¾ªç¯ç›®å½•å¼•ç”¨11) Circular directory references in tablespace data file paths No issues found# ä½¿ç”¨å·²åˆ é™¤çš„å‡½æ•°12) Usage of removed functions No issues found# ä½¿ç”¨å·²åˆ é™¤çš„GROUP BY ASC/DESCè¯­æ³•13) Usage of removed GROUP BY ASC/DESC syntax No issues found# å·²åˆ é™¤çš„ç”¨äºé”™è¯¯æ—¥å¿—è®°å½•åˆ°ç³»ç»Ÿæ—¥å¿—é…ç½®çš„ç³»ç»Ÿå˜é‡14) Removed system variables for error logging to the system log configuration To run this check requires full path to MySQL server configuration file to be specified at &#x27;configPath&#x27; key of options dictionary More information: https://dev.mysql.com/doc/relnotes/mysql/8.0/en/news-8-0-13.html#mysqld-8-0-13-logging# å·²åˆ é™¤çš„ç³»ç»Ÿå˜é‡15) Removed system variables To run this check requires full path to MySQL server configuration file to be specified at &#x27;configPath&#x27; key of options dictionary More information: https://dev.mysql.com/doc/refman/8.0/en/added-deprecated-removed.html#optvars-removed# å…·æœ‰æ–°é»˜è®¤å€¼çš„ç³»ç»Ÿå˜é‡16) System variables with new default values To run this check requires full path to MySQL server configuration file to be specified at &#x27;configPath&#x27; key of options dictionary More information: https://mysqlserverteam.com/new-defaults-in-mysql-8-0/# é›¶æ—¥æœŸã€æ—¥æœŸæ—¶é—´å’Œæ—¶é—´æˆ³å€¼17) Zero Date, Datetime, and Timestamp values Warning: By default zero date/datetime/timestamp values are no longer allowed in MySQL, as of 5.7.8 NO_ZERO_IN_DATE and NO_ZERO_DATE are included in SQL_MODE by default. These modes should be used with strict mode as they will be merged with strict mode in a future release. If you do not include these modes in your SQL_MODE setting, you are able to insert date/datetime/timestamp values that contain zeros. It is strongly advised to replace zero values with valid ones, as they may not work correctly in the future. More information: https://lefred.be/content/mysql-8-0-and-wrong-dates/ global.sql_mode - does not contain either NO_ZERO_DATE or NO_ZERO_IN_DATE which allows insertion of zero dates# ç”±æ–‡ä»¶åˆ é™¤æˆ–æŸåå¯¼è‡´çš„æ¨¡å¼ä¸ä¸€è‡´18) Schema inconsistencies resulting from file removal or corruption No issues found# è¢«InnoDBè¯†åˆ«ä½†å±äºä¸åŒå¼•æ“çš„è¡¨19) Tables recognized by InnoDB that belong to a different engine No issues found# &#x27;check table x for upgrade&#x27;å‘½ä»¤æŠ¥å‘Šçš„é—®é¢˜20) Issues reported by &#x27;check table x for upgrade&#x27; command No issues found# æ–°çš„é»˜è®¤è®¤è¯æ’ä»¶è€ƒè™‘21) New default authentication plugin considerations Warning: The new default authentication plugin &#x27;caching_sha2_password&#x27; offers more secure password hashing than previously used &#x27;mysql_native_password&#x27; (and consequent improved client connection authentication). However, it also has compatibility implications that may affect existing MySQL installations. If your MySQL installation must serve pre-8.0 clients and you encounter compatibility issues after upgrading, the simplest way to address those issues is to reconfigure the server to revert to the previous default authentication plugin (mysql_native_password). For example, use these lines in the server option file: [mysqld] default_authentication_plugin=mysql_native_password However, the setting should be viewed as temporary, not as a long term or permanent solution, because it causes new accounts created with the setting in effect to forego the improved authentication security. If you are using replication please take time to understand how the authentication plugin changes may impact you. More information: https://dev.mysql.com/doc/refman/8.0/en/upgrading-from-previous-series.html#upgrade-caching-sha2-password-compatibility-issues https://dev.mysql.com/doc/refman/8.0/en/upgrading-from-previous-series.html#upgrade-caching-sha2-password-replicationErrors: 0Warnings: 98Notices: 0NOTE: No fatal errors were found that would prevent an upgrade, but some potential issues were detected. Please ensure that the reported issues are not significant before upgrading. å¯ä»¥çœ‹åˆ°ï¼Œå…¶æ£€æŸ¥çš„æ•°æ®åº“ç‰ˆæœ¬æ˜¯5.7.44ï¼Œå…¶æ£€æŸ¥æ˜¯å¦å¯ä»¥å‡çº§åˆ°8.0.30 æ£€æµ‹é¡¹å…±æœ‰21ä¸ªï¼Œå…¶ä¸­è­¦å‘Šæœ‰98ä¸ªï¼Œé”™è¯¯æœ‰0ä¸ªï¼Œæ³¨æ„ï¼Œå¦‚æœæœ‰é”™è¯¯ï¼Œåˆ™ä¸èƒ½ç›´æ¥å‡çº§ï¼Œéœ€è¦è§£å†³é”™è¯¯é—®é¢˜ï¼Œå¦åˆ™å‡çº§ä¼šå¤±è´¥ã€‚è‡³äºè­¦å‘Šæš‚æ—¶å¯ä»¥ä¸å¤„ç†ã€‚ è­¦å‘Šé›†ä¸­ä½“ç°åœ¨å­—ç¬¦é›†ä¸Šï¼Œ5.7.44çš„å­—ç¬¦é›†æ˜¯utf8(å®é™…å°±æ˜¯utf8mb3)ï¼Œè€Œmysql8ä»¥åçš„é»˜è®¤å­—ç¬¦é›†æ˜¯utf8mb4ï¼Œè¿™ä¸ªè­¦å‘Šä¸å½±å“å‡çº§ï¼Œå¯ä»¥å¿½ç•¥ã€‚å¦‚æœéœ€è¦ä¿®æ”¹å­—ç¬¦é›†åˆ°utf8mb4ï¼Œéœ€è¦æ³¨æ„åŸæ¥çš„å­—æ®µå­—ç¬¦ä¸²é•¿åº¦æ˜¯å¦ç¬¦åˆè¦æ±‚ï¼Œå› ä¸ºutf8mb4æ˜¯4å­—èŠ‚ï¼Œè€Œutf8mb3æ˜¯3å­—èŠ‚ã€‚å¦å¤–å¦‚æœä½¿ç”¨äº†å­˜å‚¨è¿‡ç¨‹ä¹Ÿè¦æ³¨æ„å‚æ•°çš„é•¿åº¦æ˜¯å¦ç¬¦åˆè¦æ±‚ã€‚ è¿™é‡Œè¯´ä¸€ä¸‹default_authentication_pluginï¼Œmysql8.0.13å¼€å§‹ï¼Œé»˜è®¤çš„è®¤è¯æ’ä»¶æ˜¯caching_sha2_passwordï¼Œè€Œä¹‹å‰æ˜¯mysql_native_passwordï¼Œè¿™ä¸ªè­¦å‘Šè™½ç„¶å¯ä»¥å¿½ç•¥ï¼Œä½†æ˜¯å‡çº§åå»ºè®®å°½å¿«å°†è®¤è¯æ’ä»¶ä¿®æ”¹ä¸ºcaching_sha2_passwordï¼Œå› ä¸ºmysql_native_passwordçš„è®¤è¯æ–¹å¼å­˜åœ¨å®‰å…¨æ¼æ´ï¼Œå¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£ã€‚å¦å¤–ï¼Œä»mysql8.4.0å¼€å§‹ï¼Œä¸å†æ”¯æŒdefault_authentication_pluginï¼Œè‹¥è¦ä½¿å…¶æ”¯æŒmysql_native_passwordæ’ä»¶ï¼Œ8.4.0å¼€å§‹ä¸ºæˆ‘ä»¬å¢åŠ äº†ä¸€ä¸ªæ–°çš„é…ç½®é¡¹mysql-native-passwordï¼Œåœ¨[mysqld]ä¸­é…ç½®mysql-native-password=ONå³å¯å¼€å¯æ”¯æŒï¼Œé»˜è®¤ä¸ºOFFã€‚ å¦å¤–è¿˜è¦æ³¨æ„å…³é”®è¯å’Œä¿ç•™è¯çš„é—®é¢˜ï¼Œmysql8.0ä»¥åï¼Œåˆå¢åŠ äº†å¾ˆå¤šä¸ªå…³é”®è¯å’Œä¿ç•™è¯ï¼Œå¦‚æœæ£€æŸ¥åˆ°åˆ™éœ€è¦ä¿®æ”¹ä¸€ä¸‹ï¼Œä¸ç„¶å‡çº§ä¼šå¤±è´¥ã€‚å³ä¾¿è¡¨å’Œå­—æ®µé‡Œæ²¡æœ‰ä½¿ç”¨è¿™äº›ä¿ç•™å­—ï¼Œä¹Ÿè¦æ£€æŸ¥ä¸€ä¸‹ä¸šåŠ¡ä»£ç ä¸­æ˜¯å¦æœ‰ä½¿ç”¨ã€‚å…³äºå…³é”®è¯å’Œä¿ç•™è¯å¯ä»¥æŸ¥çœ‹å®˜ç½‘Keywords and Reserved Wordsï¼Œç›¸æ¯”äºMySQL 5.7ï¼Œå¢åŠ äº†å¤§çº¦130ä¸ªï¼ŒåŒæ—¶ä¹Ÿå‡å°‘äº†6ä¸ªã€‚ è¿™é‡Œå»ºè®®è®¾ç½®è¡¨åç§°å’Œå­—æ®µåç§°æ—¶ï¼Œå¯ä»¥ä¸ºå…¶è®¾ç½®å‰ç¼€ï¼Œæ¯”å¦‚ï¼šè¡¨åç§°ä¸ºï¼št_userã€å­—æ®µåç§°ä¸ºï¼šf_user_id è¿˜æœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„ï¼ŒMysql8ä¿®æ”¹äº†å¾ˆå¤šå‚æ•°çš„é»˜è®¤å€¼ï¼Œå…·ä½“å¯ä»¥æŸ¥çœ‹å®˜æ–¹ç½‘ç«™çš„è¯´æ˜ï¼Œå¦‚æœä½ ä¸å¸Œæœ›ä½¿ç”¨é»˜è®¤å€¼ï¼Œåˆ™éœ€è¦å°†å…¶é…ç½®åˆ°é…ç½®æ–‡ä»¶ä¸­ï¼Œè¿™é‡Œå¼ºè°ƒä¸€ä¸‹ï¼Œé‡ç‚¹å…³æ³¨ character_set_server å’Œ collation_server è¿™ä¸¤ä¸ªå‚æ•°ã€‚æ‰€æœ‰çš„å‚æ•°é…ç½®å‚è€ƒå®˜æ–¹æ–‡æ¡£ å…³äºå­—ç¬¦é›†è¿˜æƒ³å¤šè¯´ä¸¤å¥ mysql8çš„character_set_serveré»˜è®¤æ˜¯utf8mb4ï¼Œcollation_serveré»˜è®¤æ˜¯utf8mb4_0900_ai_ci å¦‚æœåˆ›å»ºæ•°æ®åº“æˆ–è€…è¡¨çš„æ—¶å€™æ²¡æœ‰æŒ‡å®šå­—ç¬¦é›†ï¼Œåˆ™é»˜è®¤ä½¿ç”¨character_set_serverå’Œcollation_serverçš„é»˜è®¤å€¼ æ­¤æ—¶æ–°åˆ›å»ºçš„è¡¨å°±æœ‰å¯èƒ½ä¸æ—§è¡¨å­—ç¬¦é›†ä¸ä¸€è‡´ï¼Œå…³è”æŸ¥è¯¢æ—¶å°±æœ‰å¯èƒ½å¯¼è‡´é”™è¯¯æˆ–å› ä¸ºéœ€è¦è¿›è¡Œå­—ç¬¦é›†è½¬æ¢å¯¼è‡´æŸ¥è¯¢æ€§èƒ½ä¸‹é™ã€‚ æœ€å¥½çš„æ–¹å¼æ˜¯åˆ›å»ºæ•°æ®åº“æˆ–è¡¨æ—¶æ˜ç¡®æŒ‡å®šå­—ç¬¦é›†ï¼Œæˆ–è€…åœ¨my.cnfé…ç½®æ–‡ä»¶ä¸­é…ç½®character_set_serverå’Œcollation_serverçš„å€¼ã€‚ å‡çº§æ•°æ®åº“çš„è¿‡ç¨‹ å› ä¸ºæˆ‘ä»¬è¦å‡çº§åˆ°mysql8.0.30ï¼Œæ‰€ä»¥éœ€è¦å…ˆä¸‹è½½å¹¶å®‰è£…mysql8.0.30 å…³é—­mysql5.7çš„æ•°æ®åº“ å¤‡ä»½æ•°æ®ç›®å½•(ä¸€å®šè¦åšå¥½å¤‡ä»½ï¼Œå‡çº§åä¸èƒ½é™çº§çš„) æ ¹æ®æ£€æŸ¥æç¤ºä¿®æ”¹my.cnfé…ç½®æ–‡ä»¶ä¸­çš„é…ç½®(ä¸»è¦æ˜¯ä¸å…¼å®¹çš„é…ç½®ï¼Œå¦‚æœæ£€æŸ¥æç¤ºæ²¡æœ‰åˆ™ä¸éœ€è¦ä¿®æ”¹) éå¸¸é‡è¦çš„ä¸€æ­¥ï¼Œå°±æ˜¯ä¿®æ”¹my.cnfé…ç½®æ–‡ä»¶ä¸­çš„basedirï¼Œå°†å…¶æŒ‡å‘mysql8.0.30çš„å®‰è£…ç›®å½• ç›´æ¥ä½¿ç”¨mysql8.0.30çš„å‘½ä»¤å¯åŠ¨æ•°æ®åº“ï¼Œå¯åŠ¨è¿‡ç¨‹ä¸­å°±ä¼šå®Œæˆæ•°æ®åº“çš„å‡çº§ï¼Œå¯ä»¥é€šè¿‡mysqlçš„æ—¥å¿—æ–‡ä»¶(log-error)æŸ¥çœ‹å‡çº§æƒ…å†µ å‡çº§å®Œæˆåå°½å¿«ä½¿ç”¨æ–°çš„å¯†ç è®¤è¯æ’ä»¶ä¿®æ”¹å¯†ç ï¼Œæ³¨æ„è¦ä¿®æ”¹æ‰€æœ‰ç”¨æˆ·çš„å¯†ç ï¼ŒåŒ…æ‹¬rootç”¨æˆ· 1mysql&gt; ALTER USER &#x27;root&#x27;@&#x27;localhost&#x27; IDENTIFIED WITH caching_sha2_password BY &#x27;123456&#x27;; å°è´´å£« mysql8.4.0ç›¸æ¯”äºä¹‹å‰çš„ç‰ˆæœ¬å˜åŒ–æ¯”è¾ƒå¤§ï¼Œå…·ä½“å¯ä»¥æŸ¥çœ‹å®˜ç½‘æ–‡æ¡£ mysql5.7ä¸è¦ç›´æ¥å‡çº§åˆ°8.4.0åŠä»¥åçš„ç‰ˆæœ¬ï¼Œå¯ä»¥å…ˆå‡çº§åˆ°8.0.30ï¼Œç„¶åå†å‡çº§åˆ°8.4.0 å‡çº§åˆ°8.4.0å‰ä¾æ—§è¦å…ˆä½¿ç”¨mysqlshæ£€æŸ¥æ˜¯å¦å¯ä»¥å‡çº§ï¼Œæ³¨æ„è¦ä¸‹è½½å¯¹åº”çš„mysqlshç‰ˆæœ¬ å‡çº§å‰è¦å…ˆæ£€æŸ¥æ˜¯å¦æ‰€æœ‰ç”¨æˆ·çš„å¯†ç æ’ä»¶éƒ½æ˜¯caching_sha2_passwordï¼Œå¦‚æœæ²¡æœ‰åˆ™éœ€è¦ä¿®æ”¹ å‡çº§å‰è¦å…ˆæ£€æŸ¥my.cnfä¸­æ˜¯å¦é…ç½®äº†default_authentication_pluginï¼Œå¦‚æœæœ‰åˆ™åˆ é™¤ï¼Œå¦‚æœå¿…é¡»è¦é…ç½®mysql_native_passwordè®¤è¯æ’ä»¶ï¼Œåˆ™éœ€è¦é…ç½®mysql-native-password=ON ä¿®æ”¹my.cnfä¸­çš„basedirä½¿å…¶æŒ‡å‘8.4.0çš„å®‰è£…ç›®å½• ä½¿ç”¨8.4.0çš„å‘½ä»¤å¯åŠ¨mysqlï¼Œæ£€æŸ¥æ—¥å¿—æ˜¯å¦æœ‰é”™è¯¯ã€‚ mysql5.7.44å‡çº§åˆ°8.0.30ï¼Œå†å‡çº§åˆ°8.4.0çš„å®Œæ•´è¿‡ç¨‹ å‡†å¤‡å¥½å„ä¸ªç‰ˆæœ¬çš„mysqlå’Œmysqlsh 1234567# ç›®å½•ç»“æ„mysql5 # 5.7.44å®‰è£…ç›®å½•mysql8.0.30 # 8.0.30å®‰è£…ç›®å½•mysql8.4.0 # 8.4.0å®‰è£…ç›®å½•mysqlsh8.0.30 # 8.0.30çš„mysqlshå®‰è£…ç›®å½•mysqlsh8.4.0 # 8.4.0çš„mysqlshå®‰è£…ç›®å½•datas/mysql # å­˜æ”¾æ•°æ®ç›®å½• mysql5/my.cnfé…ç½® 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758[mysql]default-character-set=utf8mb4local_infile=ON[client]default-character-set=utf8mb4port = 3306socket = /tmp/mysql.sock[mysqld]skip-name-resolvesecure_file_priv=&quot;&quot;local_infile=ONdefault_authentication_plugin=mysql_native_passwordport = 3306server-id = 1001user = mysqlsocket = /tmp/mysql.sockbasedir = /usr/local/soft/mysql5datadir = /usr/local/soft/datas/mysqllog-bin = mysql-binbinlog-format = ROWexpire-logs-days=10sync-binlog=0innodb_data_home_dir =./innodb_log_group_home_dir =./log-error =mysql.logpid-file =mysql.pidcharacter-set-server=utf8mb4lower_case_table_names=1autocommit =1slow_query_log=1slow_query_log_file=db_slow.loglong_query_time=5log_output=FILElog_queries_not_using_indexes=1skip-external-lockingkey_buffer_size = 256Mmax_allowed_packet = 64Mtable_open_cache = 1024sort_buffer_size = 4Mnet_buffer_length = 8Kread_buffer_size = 4Mread_rnd_buffer_size = 512Kmyisam_sort_buffer_size = 64Mthread_cache_size = 64tmp_table_size = 128Mexplicit_defaults_for_timestamp = truemax_connections = 500max_connect_errors = 100open_files_limit = 65535default_storage_engine = InnoDBinnodb_data_file_path = ibdata1:10M:autoextend 5.7.44å‡çº§åˆ°8.0.30 å‡çº§æ£€æŸ¥ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122# å‡çº§æ£€æŸ¥./mysqlsh8.0.30/bin/mysqlsh --uri root:123456@localhost -e &quot;util.checkForServerUpgrade()&quot;# è¾“å‡ºWARNING: Using a password on the command line interface can be insecure.The MySQL server at /tmp%2Fmysql.sock, version 5.7.44-log - MySQL CommunityServer (GPL), will now be checked for compatibility issues for upgrade to MySQL8.0.30...1) Usage of old temporal type No issues found2) Usage of db objects with names conflicting with new reserved keywords No issues found3) Usage of utf8mb3 charset Warning: The following objects use the utf8mb3 character set. It is recommended to convert them to use utf8mb4 instead, for improved Unicode support. More information: https://dev.mysql.com/doc/refman/8.0/en/charset-unicode-utf8mb3.html mydb - schema&#x27;s default character set: utf8 mysql - schema&#x27;s default character set: utf8 mydb.tbl_info_i.a_product - column&#x27;s default character set: utf8 mydb.tbl_info_i.a_country - column&#x27;s default character set: utf8 mydb.tbl_info_i.a_version - column&#x27;s default character set: utf8 mydb.tbl_info_i.a_placement - column&#x27;s default character set: utf8 â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦4) Table names in the mysql schema conflicting with new tables in 8.0 No issues found5) Partitioned tables using engines with non native partitioning No issues found6) Foreign key constraint names longer than 64 characters No issues found7) Usage of obsolete MAXDB sql_mode flag No issues found8) Usage of obsolete sql_mode flags Notice: The following DB objects have obsolete options persisted for sql_mode, which will be cleared during upgrade to 8.0. More information: https://dev.mysql.com/doc/refman/8.0/en/mysql-nutshell.html#mysql-nutshell-removals global system variable sql_mode - defined using obsolete NO_AUTO_CREATE_USER option9) ENUM/SET column definitions containing elements longer than 255 characters No issues found10) Usage of partitioned tables in shared tablespaces No issues found11) Circular directory references in tablespace data file paths No issues found12) Usage of removed functions No issues found13) Usage of removed GROUP BY ASC/DESC syntax No issues found14) Removed system variables for error logging to the system log configuration To run this check requires full path to MySQL server configuration file to be specified at &#x27;configPath&#x27; key of options dictionary More information: https://dev.mysql.com/doc/relnotes/mysql/8.0/en/news-8-0-13.html#mysqld-8-0-13-logging15) Removed system variables To run this check requires full path to MySQL server configuration file to be specified at &#x27;configPath&#x27; key of options dictionary More information: https://dev.mysql.com/doc/refman/8.0/en/added-deprecated-removed.html#optvars-removed16) System variables with new default values To run this check requires full path to MySQL server configuration file to be specified at &#x27;configPath&#x27; key of options dictionary More information: https://mysqlserverteam.com/new-defaults-in-mysql-8-0/17) Zero Date, Datetime, and Timestamp values No issues found18) Schema inconsistencies resulting from file removal or corruption No issues found19) Tables recognized by InnoDB that belong to a different engine No issues found20) Issues reported by &#x27;check table x for upgrade&#x27; command No issues found21) New default authentication plugin considerations Warning: The new default authentication plugin &#x27;caching_sha2_password&#x27; offers more secure password hashing than previously used &#x27;mysql_native_password&#x27; (and consequent improved client connection authentication). However, it also has compatibility implications that may affect existing MySQL installations. If your MySQL installation must serve pre-8.0 clients and you encounter compatibility issues after upgrading, the simplest way to address those issues is to reconfigure the server to revert to the previous default authentication plugin (mysql_native_password). For example, use these lines in the server option file: [mysqld] default_authentication_plugin=mysql_native_password However, the setting should be viewed as temporary, not as a long term or permanent solution, because it causes new accounts created with the setting in effect to forego the improved authentication security. If you are using replication please take time to understand how the authentication plugin changes may impact you. More information: https://dev.mysql.com/doc/refman/8.0/en/upgrading-from-previous-series.html#upgrade-caching-sha2-password-compatibility-issues https://dev.mysql.com/doc/refman/8.0/en/upgrading-from-previous-series.html#upgrade-caching-sha2-password-replicationErrors: 0Warnings: 98Notices: 1NOTE: No fatal errors were found that would prevent an upgrade, but some potential issues were detected. Please ensure that the reported issues are not significant before upgrading. çœ‹åˆ°æ²¡æœ‰errorï¼Œå¼€å§‹å‡çº§ 1234567891011# å…³é—­æ•°æ®åº“./mysql5/bin/mysqladmin --defaults-file=./mysql5/my.cnf -uroot -p123456 shutdown# å¤åˆ¶mysqlé…ç½®æ–‡ä»¶cp ./mysql5/my.cnf ./mysql8.0.30/my.cnf# ä¿®æ”¹æ–°çš„é…ç½®æ–‡ä»¶ä¸­çš„basedirï¼Œä½¿å…¶æŒ‡å‘8.0.30çš„å®‰è£…è·¯å¾„basedir = /usr/local/soft/mysql8.0.30# ä½¿ç”¨8.0.30å¯åŠ¨./mysql8.0.30/bin/mysqld_safe --defaults-file=./mysql8.0.30/my.cnf &amp; æŸ¥çœ‹å¯åŠ¨æ—¥å¿—ï¼Œæ²¡æœ‰é”™è¯¯è¯´æ˜å‡çº§æˆåŠŸ 12345678910111213142024-05-09T06:48:50.524705Z 0 [Warning] [MY-011068] [Server] The syntax &#x27;expire-logs-days&#x27; is deprecated and will be removed in a future release. Please use binlog_expire_logs_seconds instead.2024-05-09T06:48:50.524819Z 0 [Warning] [MY-010097] [Server] Insecure configuration for --secure-file-priv: Current value does not restrict location of generated files. Consider setting it to a valid, non-empty path.2024-05-09T06:48:50.524917Z 0 [Warning] [MY-010918] [Server] &#x27;default_authentication_plugin&#x27; is deprecated and will be removed in a future release. Please use authentication_policy instead.2024-05-09T06:48:50.524983Z 0 [System] [MY-010116] [Server] /usr/local/soft/mysql8.0.30/bin/mysqld (mysqld 8.0.30) starting as process 266962024-05-09T06:48:50.563366Z 1 [System] [MY-011012] [Server] Starting upgrade of data directory.2024-05-09T06:48:50.563414Z 1 [System] [MY-013576] [InnoDB] InnoDB initialization has started.2024-05-09T06:48:51.260298Z 1 [System] [MY-013577] [InnoDB] InnoDB initialization has ended.2024-05-09T06:48:53.614398Z 2 [System] [MY-011003] [Server] Finished populating Data Dictionary tables with data.2024-05-09T06:48:55.055320Z 5 [System] [MY-013381] [Server] Server upgrade from &#x27;50700&#x27; to &#x27;80030&#x27; started.2024-05-09T06:49:02.063990Z 5 [System] [MY-013381] [Server] Server upgrade from &#x27;50700&#x27; to &#x27;80030&#x27; completed.2024-05-09T06:49:02.237992Z 0 [Warning] [MY-010068] [Server] CA certificate ca.pem is self signed.2024-05-09T06:49:02.238048Z 0 [System] [MY-013602] [Server] Channel mysql_main configured to support TLS. Encrypted connections are now supported for this channel.2024-05-09T06:49:02.267583Z 0 [System] [MY-011323] [Server] X Plugin ready for connections. Bind-address: &#x27;::&#x27; port: 33060, socket: /tmp/mysqlx.sock2024-05-09T06:49:02.267648Z 0 [System] [MY-010931] [Server] /usr/local/soft/mysql8.0.30/bin/mysqld: ready for connections. Version: &#x27;8.0.30&#x27; socket: &#x27;/tmp/mysql.sock&#x27; port: 3306 MySQL Community Server - GPL. æ ¹æ®æ—¥å¿—æç¤ºæˆ‘ä»¬åº”è¯¥ä¿®æ”¹ä¸¤ä¸ªé…ç½®å‚æ•°ï¼Œæœªæ¥å°†ä¸å¯ç”¨äº†ï¼Œä¸è¿‡è¿™é‡Œæš‚ä¸”å…ˆä¸å»ç®¡å®ƒï¼Œç­‰æ£€æŸ¥é€šä¸è¿‡äº†å†è¿›è¡Œå¤„ç†å°±å¯ä»¥ã€‚ 121.The syntax &#x27;expire-logs-days&#x27; is deprecated and will be removed in a future release. Please use binlog_expire_logs_seconds instead.2.&#x27;default_authentication_plugin&#x27; is deprecated and will be removed in a future release. Please use authentication_policy instead. ä¿®æ”¹å¯†ç æ’ä»¶ï¼Œè¿™ä¸ªæ­¥éª¤å¾ˆé‡è¦ 1234# ç™»å½•./mysql8.0.30/bin/mysql -uroot -p123456# å‡çº§å®Œæˆåä½¿ç”¨æ–°çš„å¯†ç è®¤è¯æ’ä»¶ä¿®æ”¹å¯†ç ï¼Œ8.4ä¸å†æ¨èmysql_native_passwordè®¤è¯æ’ï¼Œæ‰€ä»¥å‡çº§åˆ°8.4ä»¥å‰ä¸€å®šè¦å…ˆä¿®æ”¹å¯†ç æ’ä»¶ï¼Œå¦‚æœå¿˜è®°äº†ä¹Ÿæ²¡å…³ç³»ï¼Œæ–‡æœ«æœ‰é‡ç½®å¯†ç çš„æ–¹æ³•mysql&gt; ALTER USER &#x27;root&#x27;@&#x27;localhost&#x27; IDENTIFIED WITH caching_sha2_password BY &#x27;123456&#x27;; 8.0.30å‡çº§åˆ°8.4.0 åŒæ ·å…ˆç”¨8.4.0çš„mysqlshæ£€æŸ¥ä¸€ä¸‹ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145# å‡çº§æ£€æŸ¥./mysqlsh8.4.0/bin/mysqlsh --uri root:123456@localhost# è¾“å‡ºMySQL Shell 8.4.0Copyright (c) 2016, 2024, Oracle and/or its affiliates.Oracle is a registered trademark of Oracle Corporation and/or its affiliates.Other names may be trademarks of their respective owners.Type &#x27;\\help&#x27; or &#x27;\\?&#x27; for help; &#x27;\\quit&#x27; to exit.WARNING: Using a password on the command line interface can be insecure.Creating a Classic session to &#x27;root@/tmp%2Fmysql.sock&#x27;Fetching global names for auto-completion... Press ^C to stop.Your MySQL connection id is 15Server version: 8.0.30 MySQL Community Server - GPLNo default schema selected; type \\use &lt;schema&gt; to set one. MySQL localhost SQL &gt; \\jsSwitching to JavaScript mode... MySQL localhost JS &gt; util.checkForServerUpgrade()The MySQL server at /tmp%2Fmysql.sock, version 8.0.30 - MySQL Community Server- GPL, will now be checked for compatibility issues for upgrade to MySQL 8.4.0.To check for a different target server version, use the targetVersion option.WARNING: Upgrading MySQL Server from version 8.0.30 to 8.4.0 is not supported.Please consider running the check using the following option: targetVersion=8.01) Usage of db objects with names conflicting with new reserved keywords(reservedKeywords) No issues found2) Removed system variables (removedSysVars) Error: Following system variables that were detected as being used will be removed. Please update your system to not rely on them before the upgrade. More information: https://dev.mysql.com/doc/refman/8.0/en/added-deprecated-removed.html#optvars-removed expire_logs_days - Error: The system variable &#x27;expire_logs_days&#x27; is set to 10 (EXPLICIT) and will be removed.3) System variables with new default values (sysVarsNewDefaults) Warning: Following system variables that are not defined in your configuration file will have new default values. Please review if you rely on their current values and if so define them before performing upgrade. More information: https://dev.mysql.com/blog-archive/new-defaults-in-mysql-8-0/ binlog_transaction_dependency_tracking - default value will change from COMMIT_ORDER to WRITESET. group_replication_consistency - default value will change from EVENTUAL to BEFORE_ON_PRIMARY_FAILOVER. group_replication_exit_state_action - default value will change from READ_ONLY to OFFLINE_MODE. innodb_adaptive_hash_index - default value will change from ON to OFF. innodb_buffer_pool_in_core_file - default value will change from ON to OFF. innodb_buffer_pool_instances - default value will change from 8 (or 1 if innodb_buffer_pool_size &lt; 1GB) to MAX(1, #vcpu/4). innodb_change_buffering - default value will change from all to none. innodb_doublewrite_files - default value will change from innodb_buffer_pool_instances * 2 to 2. innodb_doublewrite_pages - default value will change from innodb_write_io_threads to 128. innodb_flush_method - default value will change from fsynch (unix) or unbuffered (windows) to O_DIRECT. innodb_io_capacity - default value will change from 200 to 10000. innodb_io_capacity_max - default value will change from 200 to 2 x innodb_io_capacity. innodb_log_buffer_size - default value will change from 16777216 (16MB) to 67108864 (64MB). innodb_log_writer_threads - default value will change from ON to OFF ( if #vcpu &lt;= 32 ). innodb_numa_interleave - default value will change from OFF to ON. innodb_page_cleaners - default value will change from 4 to innodb_buffer_pool_instances. innodb_parallel_read_threads - default value will change from 4 to MAX(#vcpu/8, 4). innodb_purge_threads - default value will change from 4 to 1 ( if #vcpu &lt;= 16 ). innodb_read_io_threads - default value will change from 4 to MAX(#vcpu/2, 4). innodb_redo_log_capacity - default value will change from 104857600 (100MB) to MIN ( #vcpu/2, 16 )GB.4) Issues reported by &#x27;check table x for upgrade&#x27; command (checkTableCommand) No issues found5) Check for deprecated usage of single dollar signs in object names(dollarSignName) No issues found6) Check for deprecated or invalid user authentication methods.(authMethodUsage) Warning: The following users are using the &#x27;mysql_native_password&#x27; authentication method which is deprecated as of MySQL 8.0.0 and will be removed in a future release. Consider switching the users to a different authentication method (i.e. caching_sha2_password). - mydb@% - mysql.session@localhost - mysql.sys@localhost - root@localhost More information: https://dev.mysql.com/doc/refman/8.0/en/caching-sha2-pluggable-authentication.html7) Check for deprecated or removed plugin usage. (pluginUsage) No issues found8) Check for deprecated or invalid default authentication methods in systemvariables. (deprecatedDefaultAuth) The following variables have problems with their set authentication method: Error: default_authentication_plugin - mysql_native_password authentication method was removed and it must be corrected before upgrading to 8.4.0 release.9) Check for deprecated or invalid authentication methods in use by MySQLRouter internal accounts. (deprecatedRouterAuthMethod) No issues found10) Checks for errors in column definitions (columnDefinition) No issues found11) Check for allowed values in System Variables. (sysvarAllowedValues) No issues found12) Checks for user privileges that will be removed (invalidPrivileges) Verifies for users containing grants to be removed, since privileges are removed as part of the upgrade, raises a NOTICE to inform the user about users that will be losing invalid privileges &#x27;mysql.session&#x27;@&#x27;localhost&#x27; - The user &#x27;mysql.session&#x27;@&#x27;localhost&#x27; has the following privileges that will be removed as part of the upgrade process: SET_USER_ID &#x27;root&#x27;@&#x27;localhost&#x27; - The user &#x27;root&#x27;@&#x27;localhost&#x27; has the following privileges that will be removed as part of the upgrade process: SET_USER_ID13) Checks for partitions by key using columns with prefix key indexes(partitionsWithPrefixKeys) No issues foundErrors: 2Warnings: 24Notices: 2ERROR: 2 errors were found. Please correct these issues before upgrading to avoid compatibility issues. çœ‹åˆ°äº†ä¸¤å¤„é”™è¯¯ï¼Œå°±æ˜¯æˆ‘ä»¬ä¸Šé¢è¯´çš„é‚£ä¸¤ä¸ªå‚æ•°éœ€è¦ä¿®æ”¹ï¼Œä¿®æ”¹./mysql8.0.30/my.cnf 12345# binlogæ—¥å¿—è¿‡æœŸæ—¶é—´ï¼Œå•ä½ç§’ï¼Œè¿‡æœŸçš„binlogæ—¥å¿—ä¼šè¢«åˆ é™¤ï¼Œä¿è¯ç£ç›˜ç©ºé—´ï¼Œè¿™é‡Œè®¾ç½®ä¸º10å¤©ï¼Œmysql8ä»¥å‰çš„ç‰ˆæœ¬è¿™ä¸ªå‚æ•°æ˜¯expire-logs-daysï¼Œå•ä½æ˜¯å¤©binlog_expire_logs_seconds =864000#expire-logs-days=10#default_authentication_plugin=mysql_native_password ä¿®æ”¹åè¦é‡å¯æ•°æ®åº“ 12345# å…³é—­æ•°æ®åº“ ./mysql8.0.30/bin/mysqladmin --defaults-file=./mysql8.0.30/my.cnf -uroot -p123456 shutdown # ä½¿ç”¨8.0.30å¯åŠ¨ ./mysql8.0.30/bin/mysqld_safe --defaults-file=./mysql8.0.30/my.cnf &amp; å†æ¬¡è¿›ç¨‹å‡çº§æ£€æŸ¥ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136# å‡çº§æ£€æŸ¥./mysqlsh8.4.0/bin/mysqlsh --uri root:123456@localhost# è¾“å‡ºMySQL Shell 8.4.0Copyright (c) 2016, 2024, Oracle and/or its affiliates.Oracle is a registered trademark of Oracle Corporation and/or its affiliates.Other names may be trademarks of their respective owners.Type &#x27;\\help&#x27; or &#x27;\\?&#x27; for help; &#x27;\\quit&#x27; to exit.WARNING: Using a password on the command line interface can be insecure.Creating a Classic session to &#x27;root@/tmp%2Fmysql.sock&#x27;Fetching global names for auto-completion... Press ^C to stop.Your MySQL connection id is 8Server version: 8.0.30 MySQL Community Server - GPLNo default schema selected; type \\use &lt;schema&gt; to set one. MySQL localhost SQL &gt; \\jsSwitching to JavaScript mode... MySQL localhost JS &gt; util.checkForServerUpgrade()The MySQL server at /tmp%2Fmysql.sock, version 8.0.30 - MySQL Community Server- GPL, will now be checked for compatibility issues for upgrade to MySQL 8.4.0.To check for a different target server version, use the targetVersion option.WARNING: Upgrading MySQL Server from version 8.0.30 to 8.4.0 is not supported.Please consider running the check using the following option: targetVersion=8.01) Usage of db objects with names conflicting with new reserved keywords(reservedKeywords) No issues found2) Removed system variables (removedSysVars) No issues found3) System variables with new default values (sysVarsNewDefaults) Warning: Following system variables that are not defined in your configuration file will have new default values. Please review if you rely on their current values and if so define them before performing upgrade. More information: https://dev.mysql.com/blog-archive/new-defaults-in-mysql-8-0/ binlog_transaction_dependency_tracking - default value will change from COMMIT_ORDER to WRITESET. group_replication_consistency - default value will change from EVENTUAL to BEFORE_ON_PRIMARY_FAILOVER. group_replication_exit_state_action - default value will change from READ_ONLY to OFFLINE_MODE. innodb_adaptive_hash_index - default value will change from ON to OFF. innodb_buffer_pool_in_core_file - default value will change from ON to OFF. innodb_buffer_pool_instances - default value will change from 8 (or 1 if innodb_buffer_pool_size &lt; 1GB) to MAX(1, #vcpu/4). innodb_change_buffering - default value will change from all to none. innodb_doublewrite_files - default value will change from innodb_buffer_pool_instances * 2 to 2. innodb_doublewrite_pages - default value will change from innodb_write_io_threads to 128. innodb_flush_method - default value will change from fsynch (unix) or unbuffered (windows) to O_DIRECT. innodb_io_capacity - default value will change from 200 to 10000. innodb_io_capacity_max - default value will change from 200 to 2 x innodb_io_capacity. innodb_log_buffer_size - default value will change from 16777216 (16MB) to 67108864 (64MB). innodb_log_writer_threads - default value will change from ON to OFF ( if #vcpu &lt;= 32 ). innodb_numa_interleave - default value will change from OFF to ON. innodb_page_cleaners - default value will change from 4 to innodb_buffer_pool_instances. innodb_parallel_read_threads - default value will change from 4 to MAX(#vcpu/8, 4). innodb_purge_threads - default value will change from 4 to 1 ( if #vcpu &lt;= 16 ). innodb_read_io_threads - default value will change from 4 to MAX(#vcpu/2, 4). innodb_redo_log_capacity - default value will change from 104857600 (100MB) to MIN ( #vcpu/2, 16 )GB.4) Issues reported by &#x27;check table x for upgrade&#x27; command (checkTableCommand) No issues found5) Check for deprecated usage of single dollar signs in object names(dollarSignName) No issues found6) Check for deprecated or invalid user authentication methods.(authMethodUsage) Warning: The following users are using the &#x27;mysql_native_password&#x27; authentication method which is deprecated as of MySQL 8.0.0 and will be removed in a future release. Consider switching the users to a different authentication method (i.e. caching_sha2_password). - mydb@% - mysql.session@localhost - mysql.sys@localhost - root@localhost More information: https://dev.mysql.com/doc/refman/8.0/en/caching-sha2-pluggable-authentication.html7) Check for deprecated or removed plugin usage. (pluginUsage) No issues found8) Check for deprecated or invalid default authentication methods in systemvariables. (deprecatedDefaultAuth) No issues found9) Check for deprecated or invalid authentication methods in use by MySQLRouter internal accounts. (deprecatedRouterAuthMethod) No issues found10) Checks for errors in column definitions (columnDefinition) No issues found11) Check for allowed values in System Variables. (sysvarAllowedValues) No issues found12) Checks for user privileges that will be removed (invalidPrivileges) Verifies for users containing grants to be removed, since privileges are removed as part of the upgrade, raises a NOTICE to inform the user about users that will be losing invalid privileges &#x27;mysql.session&#x27;@&#x27;localhost&#x27; - The user &#x27;mysql.session&#x27;@&#x27;localhost&#x27; has the following privileges that will be removed as part of the upgrade process: SET_USER_ID &#x27;root&#x27;@&#x27;localhost&#x27; - The user &#x27;root&#x27;@&#x27;localhost&#x27; has the following privileges that will be removed as part of the upgrade process: SET_USER_ID13) Checks for partitions by key using columns with prefix key indexes(partitionsWithPrefixKeys) No issues foundErrors: 0Warnings: 24Notices: 2NOTE: No fatal errors were found that would prevent an upgrade, but some potential issues were detected. Please ensure that the reported issues are not significant before upgrading. æ­¤æ—¶çœ‹åˆ°é€šè¿‡æ£€æŸ¥ï¼Œå…³é—­æ•°æ®åº“ç›´æ¥å‡çº§å§ 1234567891011# å…³é—­æ•°æ®åº“./mysql8.0.30/bin/mysqladmin --defaults-file=./mysql8.0.30/my.cnf -uroot -p123456 shutdown# å¤åˆ¶mysqlé…ç½®æ–‡ä»¶cp ./mysql8.0.30/my.cnf ./mysql8.4.0/my.cnf# ä¿®æ”¹æ–°çš„é…ç½®æ–‡ä»¶ä¸­çš„basedirï¼Œä½¿å…¶æŒ‡å‘8.4.0çš„å®‰è£…è·¯å¾„basedir = /usr/local/soft/mysql8.4.0 # ä½¿ç”¨8.4.0å¯åŠ¨./mysql8.4.0/bin/mysqld_safe --defaults-file=./mysql8.4.0/my.cnf &amp; æŸ¥çœ‹æ—¥å¿—ï¼Œä¾æ—§æ˜¯æ²¡æœ‰é”™è¯¯ï¼Œå‡çº§å¾ˆé¡ºåˆ© 12345678910111213142024-05-09T07:21:55.325669Z 0 [System] [MY-015015] [Server] MySQL Server - start.2024-05-09T07:21:55.740435Z 0 [Warning] [MY-011070] [Server] &#x27;binlog_format&#x27; is deprecated and will be removed in a future release.2024-05-09T07:21:55.740549Z 0 [Warning] [MY-010097] [Server] Insecure configuration for --secure-file-priv: Current value does not restrict location of generated files. Consider setting it to a valid, non-empty path.2024-05-09T07:21:55.740629Z 0 [System] [MY-010116] [Server] /usr/local/soft/mysql-8.4.0-linux-glibc2.17-x86_64/bin/mysqld (mysqld 8.4.0) starting as process 284142024-05-09T07:21:55.796983Z 1 [System] [MY-013576] [InnoDB] InnoDB initialization has started.2024-05-09T07:21:56.421873Z 1 [System] [MY-013577] [InnoDB] InnoDB initialization has ended.2024-05-09T07:21:56.442008Z 1 [System] [MY-011090] [Server] Data dictionary upgrading from version &#x27;80023&#x27; to &#x27;80300&#x27;.2024-05-09T07:21:57.106002Z 1 [System] [MY-013413] [Server] Data dictionary upgrade from version &#x27;80023&#x27; to &#x27;80300&#x27; completed.2024-05-09T07:22:00.128935Z 4 [System] [MY-013381] [Server] Server upgrade from &#x27;80030&#x27; to &#x27;80400&#x27; started.2024-05-09T07:22:06.850838Z 4 [System] [MY-013381] [Server] Server upgrade from &#x27;80030&#x27; to &#x27;80400&#x27; completed.2024-05-09T07:22:07.063386Z 0 [Warning] [MY-010068] [Server] CA certificate ca.pem is self signed.2024-05-09T07:22:07.063456Z 0 [System] [MY-013602] [Server] Channel mysql_main configured to support TLS. Encrypted connections are now supported for this channel.2024-05-09T07:22:07.085760Z 0 [System] [MY-010931] [Server] /usr/local/soft/mysql-8.4.0-linux-glibc2.17-x86_64/bin/mysqld: ready for connections. Version: &#x27;8.4.0&#x27; socket: &#x27;/tmp/mysql.sock&#x27; port: 3306 MySQL Community Server - GPL.2024-05-09T07:22:07.340333Z 0 [System] [MY-011323] [Server] X Plugin ready for connections. Bind-address: &#x27;::&#x27; port: 33060, socket: /tmp/mysqlx.sock ä»æ—¥å¿—çœ‹åˆ°â€™binlog_formatâ€™ä¹Ÿè¦ä¸æ”¯æŒäº†ï¼Œä¸è¿‡å…ˆä¸ç”¨ç®¡ï¼Œç­‰åˆ°ä¸æ”¯æŒäº†å†å¤„ç†å§ã€‚ å¦‚æœå‡çº§åˆ°8.4ä¹‹å‰å¿˜è®°ä¿®æ”¹å¯†ç æ’ä»¶äº†ï¼Œåˆ™å‡çº§ä¹‹åå°±ä¸èƒ½æ­£å¸¸ç™»å½•äº†ï¼Œæ­¤æ—¶æ€ä¹ˆåŠå‘¢ï¼Ÿ å‡çº§åˆ°8.4ä¹‹å‰å¿˜è®°ä¿®æ”¹å¯†ç æ’ä»¶äº†ï¼Œåˆ™å‡çº§ä¹‹åç™»å½•æ•°æ®åº“ä¼šæŠ¥å‘Šå¦‚ä¸‹é”™è¯¯ 1ERROR 1524 (HY000): Plugin &#x27;mysql_native_password&#x27; is not loaded è§£å†³æ–¹æ¡ˆ åœ¨mysqlçš„é…ç½®æ–‡ä»¶ä¸­å¢åŠ mysql-native-password=ONï¼Œç„¶åé‡å¯æ•°æ®åº“å³å¯ï¼Œä½†è¿˜æ˜¯å»ºè®®å°½å¿«ä¿®æ”¹ç”¨æˆ·çš„è®¤è¯æ’ä»¶ä¸ºcaching_sha2_passwordå§ï¼Œæ¯•ç«Ÿè¿™ä¸ªè®¤è¯æ–¹å¼å­˜åœ¨å®‰å…¨æ¼æ´ã€‚ å°è´´å£« ç¬”è€…ä¹‹å‰æ²¡æœ‰æ³¨æ„åˆ°8.4.0æ–°å¢çš„mysql-native-password=ONè¿™ä¸ªé…ç½®ï¼Œæ‰€ä»¥é‡‡ç”¨äº†å¦‚ä¸‹é‡ç½®å¯†ç çš„æ–¹å¼è¿›è¡Œæ’ä»¶ä¿®æ”¹ï¼Œç•™ä¸ªçºªå¿µå§ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243# killæ‰mysqlæœåŠ¡killall mysqld# æ— æƒé™æ¨¡å¼å¯åŠ¨./mysql8.4.0/bin/mysqld_safe --defaults-file=./mysql8.4.0/my.cnf --skip-grant-tables &amp;# ç™»å½•ï¼Œæ­¤æ—¶ä¸éœ€è¦å¯†ç ./mysql8.4.0/bin/mysql -urootmysql&gt; USE mysql;# ä¿®æ”¹å¯†ç æ’ä»¶ä¸º caching_sha2_passwordmysql&gt; UPDATE user SET plugin=&#x27;caching_sha2_password&#x27; WHERE User=&#x27;root&#x27;;# å°†å¯†ç è®¾ç½®ä¸ºç©ºmysql&gt; UPDATE user SET authentication_string=null WHERE User=&#x27;root&#x27;;# åˆ·æ–°æƒé™ï¼šmysql&gt; FLUSH PRIVILEGES;# é€€å‡ºMySQLmysql&gt; exit;# å…³é—­æ•°æ®åº“ï¼Œæ­¤æ—¶ä¸éœ€è¦å¯†ç å³å¯å…³é—­./mysql8.4.0/bin/mysqladmin --defaults-file=./mysql8.4.0/my.cnf -uroot -p shutdown# é‡å¯å¯åŠ¨mysqlæœåŠ¡./mysql8.4.0/bin/mysqld_safe --defaults-file=./mysql8.4.0/my.cnf &amp;# ç™»å½•ï¼Œæ­¤æ—¶ä¾æ—§ä¸éœ€è¦å¯†ç ./mysql8.4.0/bin/mysql -uroot# è®¾ç½®å¯†ç mysql&gt; ALTER USER &#x27;root&#x27;@&#x27;localhost&#x27; IDENTIFIED BY &#x27;123456&#x27;;# åˆ·æ–°æƒé™ï¼šmysql&gt; FLUSH PRIVILEGES;# é€€å‡ºMySQLmysql&gt; exit;# ç™»å½•ï¼Œæ­¤æ—¶ä½¿ç”¨å¯†ç å°±å¯ä»¥æ­£å¸¸ç™»å½•äº†./mysql8.4.0/bin/mysql -uroot -p123456# ä¹‹åå†ä¿®æ”¹å…¶ä»–ç”¨æˆ·çš„å¯†ç å³å¯ï¼Œæ¯”å¦‚mysql&gt; ALTER USER &#x27;other&#x27;@&#x27;%&#x27; IDENTIFIED WITH caching_sha2_password BY &#x27;otherpass&#x27;;# æŸ¥çœ‹ä¿®æ”¹åçš„userä¿¡æ¯mysql&gt; use mysql;mysql&gt; select user,host,plugin from user;","summary":"æ‘˜è¦ MySqlçŸ¥è¯†ç‚¹ä»‹ç»:ä»Mysql5.7å‡çº§åˆ°Mysql8 æœ¬æ–‡åŸºäºmysql-8.0.30ï¼Œhttps://dev.mysql.com/doc/refman/8.0/en/ 2024-04-30ï¼Œmysql-8.4.0 LTSç‰ˆæœ¬å‘å¸ƒï¼Œæœ¬æ–‡åœ¨å°†mysqlä»5.7.44å‡çº§åˆ°8.0.30çš„åŸºç¡€ä¸Šï¼Œå‡çº§åˆ°8.4.0 LTSç‰ˆæœ¬ã€‚mysql-8.4.0 LTSå®˜æ–¹æ–‡æ¡£","date_published":"2024-05-08T13:35:05.000Z","tags":["æŠ€æœ¯","mysql","mysql"]},{"id":"https://blog.hanqunfeng.com/2024/04/08/mongodb7-pool-springboot/","url":"https://blog.hanqunfeng.com/2024/04/08/mongodb7-pool-springboot/","title":"MongoDB7.0--SpringBooté…ç½®mongodbè¿æ¥æ± ","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç»å¦‚ä½•ä½¿ç”¨SpringBooté…ç½®MongoDB7.0çš„è¿æ¥æ± </p>\n</li>\n<li class=\"lvl-2\">\n<p>SpringBootç‰ˆæœ¬3.2.4ï¼ŒMongoDBç‰ˆæœ¬7.0.6</p>\n</li>\n<li class=\"lvl-2\">\n<p>å…³äºspringbootä¸mongodbçš„é›†æˆå¯ä»¥å‚è€ƒï¼š<a href=\"/2024/03/05/mongodb7-springboot/\" title=\"MongoDB7.0--SpringBootå•é›†åˆæ“ä½œ\">MongoDB7.0--SpringBootå•é›†åˆæ“ä½œ</a>ï¼Œæœ¬æ–‡åªè®¨è®ºè¿æ¥æ± ç›¸å…³å†…å®¹ã€‚</p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"spring-boot-çš„-MongoDB-è¿æ¥æ± \">spring-boot çš„ MongoDB è¿æ¥æ± </h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å½“æˆ‘ä»¬åœ¨springbootçš„é…ç½®æ–‡ä»¶ä¸­é…ç½®mongodbçš„ç›¸å…³å±æ€§æ—¶ï¼Œå¹¶æ²¡æœ‰å‘ç°å’Œè¿æ¥æ± ç›¸å…³çš„å±æ€§ï¼ŒæŸ¥çœ‹<code>MongoProperties</code>ä¸­çš„å±æ€§ä¹Ÿå¯ä»¥è¯å®è¿™ä¸€ç‚¹ï¼Œè¿™å°±å¾ˆå¥‡æ€ªï¼ŒæŒ‰ç†è¯´springbootåº”è¯¥ä¸ä¼šè¿™ä¹ˆå¼±é¸¡ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>äºæ˜¯æˆ‘æ‰“ç®—çœ‹çœ‹springbootçš„æºç ï¼Œçœ‹çœ‹springbootä¸ºæˆ‘ä»¬è‡ªåŠ¨åˆ›å»ºçš„<code>MongoClient</code>åˆ°åº•æœ‰æ²¡æœ‰è¿æ¥æ± çš„é…ç½®ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>æˆ‘ä»¬å°±ä»mongodbçš„è‡ªåŠ¨é…ç½®ç±»<code>MongoAutoConfiguration</code>å¼€å§‹ï¼Œè¯¥ç±»ä¸­å®šä¹‰äº†<code>PropertiesMongoConnectionDetails</code>å’Œ<code>MongoClient</code></p>\n</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//è¿™ä¸ªç±»ä¸»è¦ç”¨äºConnectionStringå¯¹è±¡çš„å°è£…ï¼Œåé¢ä¼šè®²åˆ°</span></span><br><span class=\"line\"><span class=\"meta\">@Bean</span></span><br><span class=\"line\"><span class=\"meta\">@ConditionalOnMissingBean(&#123;MongoConnectionDetails.class&#125;)</span></span><br><span class=\"line\">PropertiesMongoConnectionDetails <span class=\"title function_\">mongoConnectionDetails</span><span class=\"params\">(MongoProperties properties)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">PropertiesMongoConnectionDetails</span>(properties);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Bean</span></span><br><span class=\"line\"><span class=\"meta\">@ConditionalOnMissingBean(&#123;MongoClient.class&#125;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> MongoClient <span class=\"title function_\">mongo</span><span class=\"params\">(ObjectProvider&lt;MongoClientSettingsBuilderCustomizer&gt; builderCustomizers, MongoClientSettings settings)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> (MongoClient)(<span class=\"keyword\">new</span> <span class=\"title class_\">MongoClientFactory</span>(builderCustomizers.orderedStream().toList())).createMongoClient(settings);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¯ä»¥çœ‹åˆ°ï¼Œåˆ›å»º<code>MongoClient</code>çš„beanæ—¶ï¼Œä¾èµ–ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ˜¯<code>ObjectProvider&lt;MongoClientSettingsBuilderCustomizer&gt;</code>ï¼Œä¸€ä¸ªæ˜¯<code>MongoClientSettings</code>ï¼Œå‰è€…ä¼šå°†springä¸Šä¸‹æ–‡ä¸­æ‰€æœ‰ç±»å‹ä¸º<code>MongoClientSettingsBuilderCustomizer</code>çš„beanå°è£…åˆ°è¯¥å¯¹è±¡ä¸­(springbooté»˜è®¤åªæä¾›äº†ä¸€ä¸ª<code>StandardMongoClientSettingsBuilderCustomizer</code>)</p>\n</li>\n<li class=\"lvl-2\">\n<p><code>MongoAutoConfiguration</code>ç¼ºçœä¸ºæˆ‘ä»¬æä¾›äº†<code>MongoClientSettings</code>å’Œ<code>StandardMongoClientSettingsBuilderCustomizer</code>ï¼Œè¿™ä¸¤ä¸ªç±»éƒ½å¾ˆé‡è¦ï¼Œè¿æ¥æ± å‚æ•°å°±å’Œå®ƒä»¬æœ‰å…³</p>\n</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Bean</span></span><br><span class=\"line\">MongoClientSettings <span class=\"title function_\">mongoClientSettings</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> MongoClientSettings.builder().build();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// éœ€è¦çš„å‚æ•°connectionDetailsåˆšå¥½æ˜¯ä¸Šé¢çš„PropertiesMongoConnectionDetails</span></span><br><span class=\"line\"><span class=\"meta\">@Bean</span></span><br><span class=\"line\">StandardMongoClientSettingsBuilderCustomizer <span class=\"title function_\">standardMongoSettingsCustomizer</span><span class=\"params\">(MongoProperties properties, MongoConnectionDetails connectionDetails, ObjectProvider&lt;SslBundles&gt; sslBundles)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">StandardMongoClientSettingsBuilderCustomizer</span>(connectionDetails.getConnectionString(), properties.getUuidRepresentation(), properties.getSsl(), (SslBundles)sslBundles.getIfAvailable());</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æˆ‘ä»¬å…ˆçœ‹<code>MongoClientSettings</code>ï¼Œå…¶ä¸­å°±å®šä¹‰ä¸€ä¸ªè¿æ¥æ± çš„é…ç½®å¯¹è±¡<code>ConnectionPoolSettings</code>ï¼Œè€Œ<code>ConnectionPoolSettings</code>å…¶å†…éƒ¨å°±å®šä¹‰äº†è¿æ¥æ± çš„é…ç½®å±æ€§ï¼Œ<code>MongoClientSettings</code>é€šè¿‡<code>ConnectionPoolSettings</code>çš„æ„é€ å™¨åˆ›å»ºå‡ºäº†<code>ConnectionPoolSettings</code>å¯¹è±¡ï¼Œå…¶ç¼ºçœå€¼å¦‚ä¸‹ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"type\">int</span> <span class=\"variable\">maxSize</span> <span class=\"operator\">=</span> <span class=\"number\">100</span>;</span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"type\">int</span> minSize;</span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"type\">long</span> <span class=\"variable\">maxWaitTimeMS</span> <span class=\"operator\">=</span> <span class=\"number\">1000</span> * <span class=\"number\">60</span> * <span class=\"number\">2</span>;</span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"type\">long</span> maxConnectionLifeTimeMS;</span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"type\">long</span> maxConnectionIdleTimeMS;</span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"type\">int</span> <span class=\"variable\">maxConnecting</span> <span class=\"operator\">=</span> <span class=\"number\">2</span>;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æˆ‘ä»¬çœ‹å¦ä¸€ä¸ªå’Œåˆ›å»º<code>MongoClient</code>ç›¸å…³çš„beanï¼Œè¿™ä¸ª<code>StandardMongoClientSettingsBuilderCustomizer</code>ï¼Œåˆ›å»ºè¿™ä¸ªbeanæ—¶éœ€è¦ä¸€ä¸ª<code>MongoConnectionDetails</code>å¯¹è±¡ï¼Œå¹¶è°ƒç”¨å…¶<code>getConnectionString</code>æ–¹æ³•ï¼Œè¿™ä¸ªå¯¹è±¡<code>MongoAutoConfiguration</code>ä¹Ÿä¸ºæˆ‘ä»¬æä¾›äº†(ä¸Šé¢å¯ä»¥çœ‹åˆ°)</p>\n</li>\n<li class=\"lvl-2\">\n<p>æŸ¥çœ‹<code>PropertiesMongoConnectionDetails</code>çš„æºç ï¼Œå‘ç°<code>connectionDetails.getConnectionString()</code>çš„åŠŸèƒ½å°±æ˜¯å°†<code>MongoProperties</code>çš„å±æ€§å°è£…ä¸º<code>uri</code>å¹¶ä¼ é€’ç»™<code>ConnectionString</code>çš„æ„é€ å™¨åˆ›å»ºå¯¹è±¡</p>\n</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> ConnectionString <span class=\"title function_\">getConnectionString</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"built_in\">this</span>.properties.getUri() != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ConnectionString</span>(<span class=\"built_in\">this</span>.properties.getUri());</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">StringBuilder</span> <span class=\"variable\">builder</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">StringBuilder</span>(<span class=\"string\">&quot;mongodb://&quot;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"built_in\">this</span>.properties.getUsername() != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">            builder.append(<span class=\"built_in\">this</span>.encode(<span class=\"built_in\">this</span>.properties.getUsername()));</span><br><span class=\"line\">            builder.append(<span class=\"string\">&quot;:&quot;</span>);</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (<span class=\"built_in\">this</span>.properties.getPassword() != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                builder.append(<span class=\"built_in\">this</span>.encode(<span class=\"built_in\">this</span>.properties.getPassword()));</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            builder.append(<span class=\"string\">&quot;@&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        builder.append(<span class=\"built_in\">this</span>.properties.getHost() != <span class=\"literal\">null</span> ? <span class=\"built_in\">this</span>.properties.getHost() : <span class=\"string\">&quot;localhost&quot;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"built_in\">this</span>.properties.getPort() != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">            builder.append(<span class=\"string\">&quot;:&quot;</span>);</span><br><span class=\"line\">            builder.append(<span class=\"built_in\">this</span>.properties.getPort());</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"built_in\">this</span>.properties.getAdditionalHosts() != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">            builder.append(<span class=\"string\">&quot;,&quot;</span>);</span><br><span class=\"line\">            builder.append(String.join(<span class=\"string\">&quot;,&quot;</span>, <span class=\"built_in\">this</span>.properties.getAdditionalHosts()));</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        builder.append(<span class=\"string\">&quot;/&quot;</span>);</span><br><span class=\"line\">        builder.append(<span class=\"built_in\">this</span>.properties.getMongoClientDatabase());</span><br><span class=\"line\">        List&lt;String&gt; options = <span class=\"built_in\">this</span>.getOptions();</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!options.isEmpty()) &#123;</span><br><span class=\"line\">            builder.append(<span class=\"string\">&quot;?&quot;</span>);</span><br><span class=\"line\">            builder.append(String.join(<span class=\"string\">&quot;&amp;&quot;</span>, options));</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">// å°†MongoPropertiesè½¬æ¢ä¸ºuriæ ¼å¼åè°ƒç”¨æ„é€ å™¨åˆ›å»ºConnectionString</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ConnectionString</span>(builder.toString());</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¿™ä¸ª<code>ConnectionString</code>å¯¹è±¡çš„åˆå§‹åŒ–è¿‡ç¨‹å°±å¾ˆæœ‰æ„æ€äº†ï¼Œå…¶ä¼šå¯¹è¿™ä¸ª<code>uri</code>è¿›è¡Œè§£æï¼Œè§£æè¿‡ç¨‹ä¸­ä¼šè°ƒç”¨<code>parseOptions(connectionStringQueryParameters)</code>æ–¹æ³•ï¼Œå…¶ä¼šå°†<code>uri</code>ä¸­çš„å‚æ•°è½¬æ¢ä¸º<code>Map</code>ï¼Œä¹‹åè°ƒç”¨<code>translateOptions(combinedOptionsMaps)</code>æ–¹æ³•éå†è¿™ä¸ªmapï¼Œè€Œåœ¨éå†çš„è¿‡ç¨‹ä¸­å°±ä¼šå®Œæˆå¯¹<code>ConnectionString</code>å¯¹è±¡çš„è¿æ¥æ± ç›¸å…³å±æ€§çš„åˆå§‹åŒ–</p>\n</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title function_\">translateOptions</span><span class=\"params\">(<span class=\"keyword\">final</span> Map&lt;String, List&lt;String&gt;&gt; optionsMap)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">boolean</span> <span class=\"variable\">tlsInsecureSet</span> <span class=\"operator\">=</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">        <span class=\"type\">boolean</span> <span class=\"variable\">tlsAllowInvalidHostnamesSet</span> <span class=\"operator\">=</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">final</span> String key : GENERAL_OPTIONS_KEYS) &#123;</span><br><span class=\"line\">            <span class=\"type\">String</span> <span class=\"variable\">value</span> <span class=\"operator\">=</span> getLastValue(optionsMap, key);</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (value == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">continue</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">switch</span> (key) &#123;</span><br><span class=\"line\">                <span class=\"comment\">// è¿æ¥æ± ç›¸å…³å±æ€§ï¼Œæ³¨æ„è¿™é‡Œçš„å±æ€§åç§°ï¼Œåé¢æˆ‘ä»¬é…ç½®è¿æ¥æ± æ—¶ä¼šç”¨åˆ°</span></span><br><span class=\"line\">                <span class=\"keyword\">case</span> <span class=\"string\">&quot;maxpoolsize&quot;</span>:</span><br><span class=\"line\">                    maxConnectionPoolSize = parseInteger(value, <span class=\"string\">&quot;maxpoolsize&quot;</span>);</span><br><span class=\"line\">                    <span class=\"keyword\">break</span>;</span><br><span class=\"line\">                <span class=\"keyword\">case</span> <span class=\"string\">&quot;minpoolsize&quot;</span>:</span><br><span class=\"line\">                    minConnectionPoolSize = parseInteger(value, <span class=\"string\">&quot;minpoolsize&quot;</span>);</span><br><span class=\"line\">                    <span class=\"keyword\">break</span>;</span><br><span class=\"line\">                <span class=\"keyword\">case</span> <span class=\"string\">&quot;maxidletimems&quot;</span>:</span><br><span class=\"line\">                    maxConnectionIdleTime = parseInteger(value, <span class=\"string\">&quot;maxidletimems&quot;</span>);</span><br><span class=\"line\">                    <span class=\"keyword\">break</span>;</span><br><span class=\"line\">                <span class=\"keyword\">case</span> <span class=\"string\">&quot;maxlifetimems&quot;</span>:</span><br><span class=\"line\">                    maxConnectionLifeTime = parseInteger(value, <span class=\"string\">&quot;maxlifetimems&quot;</span>);</span><br><span class=\"line\">                    <span class=\"keyword\">break</span>;</span><br><span class=\"line\">                <span class=\"keyword\">case</span> <span class=\"string\">&quot;maxconnecting&quot;</span>:</span><br><span class=\"line\">                    maxConnecting = parseInteger(value, <span class=\"string\">&quot;maxConnecting&quot;</span>);</span><br><span class=\"line\">                    <span class=\"keyword\">break</span>;</span><br><span class=\"line\">                <span class=\"keyword\">case</span> <span class=\"string\">&quot;waitqueuetimeoutms&quot;</span>:</span><br><span class=\"line\">                    maxWaitTime = parseInteger(value, <span class=\"string\">&quot;waitqueuetimeoutms&quot;</span>);</span><br><span class=\"line\">                    <span class=\"keyword\">break</span>;</span><br><span class=\"line\">                <span class=\"keyword\">case</span> <span class=\"string\">&quot;connecttimeoutms&quot;</span>:</span><br><span class=\"line\">                    connectTimeout = parseInteger(value, <span class=\"string\">&quot;connecttimeoutms&quot;</span>);</span><br><span class=\"line\">                    <span class=\"keyword\">break</span>;</span><br><span class=\"line\">           â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å…¶å®æ­¤æ—¶æˆ‘ä»¬å°±å·²ç»çŸ¥é“åº”è¯¥å¦‚ä½•é…ç½®è¿æ¥æ± å‚æ•°äº†ï¼Œå°±æ˜¯å°†è¿æ¥æ± ç›¸å…³çš„å‚æ•°è¿½åŠ åˆ°<code>uri</code>çš„å‚æ•°éƒ¨åˆ†ï¼Œä½†æ˜¯å‰é¢æˆ‘ä»¬æåˆ°è´Ÿè´£è¿æ¥æ± çš„ç±»æ˜¯<code>ConnectionPoolSettings</code>ï¼Œé‚£ä¹ˆ<code>ConnectionString</code>å¯¹è±¡ä¸­çš„è¿æ¥æ± å±æ€§æ˜¯å¦‚ä½•è¢«ä¼ é€’ç»™<code>ConnectionPoolSettings</code>çš„å‘¢ï¼Œæˆ‘ä»¬æ¥ç€å¾€ä¸‹çœ‹ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å‚æ•°å‡†å¤‡å¥½åå°±å¼€å§‹åˆ›å»º<code>MongoClient</code>äº†ï¼Œå…¶ä¼šè°ƒç”¨<code>MongoClientFactory</code>çš„<code>createMongoClient</code>æ–¹æ³•ï¼Œå…¶ä¼šå¯¹<code>MongoClientSettings</code>å¯¹è±¡åšè¿›ä¸€æ­¥çš„å°è£…ï¼Œå¹¶æœ€ç»ˆåŸºäºå°è£…åçš„<code>MongoClientSettings</code>å¯¹è±¡åˆ›å»ºå‡º<code>MongoClient</code>å¯¹è±¡</p>\n</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> T <span class=\"title function_\">createMongoClient</span><span class=\"params\">(MongoClientSettings settings)</span> &#123;</span><br><span class=\"line\">    <span class=\"type\">Builder</span> <span class=\"variable\">targetSettings</span> <span class=\"operator\">=</span> MongoClientSettings.builder(settings);</span><br><span class=\"line\">    customize(targetSettings);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>.clientCreator.apply(targetSettings.build(), driverInformation());</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title function_\">customize</span><span class=\"params\">(Builder builder)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (MongoClientSettingsBuilderCustomizer customizer : <span class=\"built_in\">this</span>.builderCustomizers) &#123;</span><br><span class=\"line\">        customizer.customize(builder);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è€Œåœ¨è¿›ä¸€æ­¥å°è£…<code>MongoClientSettings</code>å¯¹è±¡æ—¶ï¼Œä¼šè°ƒç”¨ç³»ç»Ÿä¸­æ‰€æœ‰è¢«springç®¡ç†çš„<code>MongoClientSettingsBuilderCustomizer</code>,å®é™…ä¸Šä¹Ÿå°±æ˜¯<code>StandardMongoClientSettingsBuilderCustomizer</code>çš„<code>customize</code>æ–¹æ³•ï¼Œå…¶åˆä¼šè°ƒç”¨<code>MongoClientSettings.builder()</code>çš„<code>applyConnectionSettings</code>æ–¹æ³•ï¼Œè€Œåœ¨è¯¥æ–¹æ³•ä¸­è°ƒç”¨<code>connectionPoolSettingsBuilder.applyConnectionString(connectionString);</code>å°±å®Œæˆäº†å°†<code>ConnectionString</code>å¯¹è±¡ä¸­çš„è¿æ¥æ± å±æ€§ä¼ é€’ç»™<code>ConnectionPoolSettings</code>å¯¹è±¡çš„è¿‡ç¨‹ï¼Œå½“ç„¶ï¼Œå¦‚æœå±æ€§æ²¡æœ‰è·å–åˆ°å°±ä¼šä½¿ç”¨é»˜è®¤å€¼ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åŸºäºéœ€è¦é…ç½®ç›¸å…³çš„å±æ€§ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> Builder <span class=\"title function_\">applyConnectionString</span><span class=\"params\">(<span class=\"keyword\">final</span> ConnectionString connectionString)</span> &#123;</span><br><span class=\"line\">    <span class=\"type\">Integer</span> <span class=\"variable\">maxConnectionPoolSize</span> <span class=\"operator\">=</span> connectionString.getMaxConnectionPoolSize();</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (maxConnectionPoolSize != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">        maxSize(maxConnectionPoolSize);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"type\">Integer</span> <span class=\"variable\">minConnectionPoolSize</span> <span class=\"operator\">=</span> connectionString.getMinConnectionPoolSize();</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (minConnectionPoolSize != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">        minSize(minConnectionPoolSize);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"type\">Integer</span> <span class=\"variable\">maxWaitTime</span> <span class=\"operator\">=</span> connectionString.getMaxWaitTime();</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (maxWaitTime != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">        maxWaitTime(maxWaitTime, MILLISECONDS);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"type\">Integer</span> <span class=\"variable\">maxConnectionIdleTime</span> <span class=\"operator\">=</span> connectionString.getMaxConnectionIdleTime();</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (maxConnectionIdleTime != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">        maxConnectionIdleTime(maxConnectionIdleTime, MILLISECONDS);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"type\">Integer</span> <span class=\"variable\">maxConnectionLifeTime</span> <span class=\"operator\">=</span> connectionString.getMaxConnectionLifeTime();</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (maxConnectionLifeTime != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">        maxConnectionLifeTime(maxConnectionLifeTime, MILLISECONDS);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"type\">Integer</span> <span class=\"variable\">maxConnecting</span> <span class=\"operator\">=</span> connectionString.getMaxConnecting();</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (maxConnecting != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">        maxConnecting(maxConnecting);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¤§ä½“è¿‡ç¨‹å°±æ˜¯è¿™æ ·ï¼Œå¾ˆç»•ï¼Œç®€å•ç‚¹è¯´å°±æ˜¯springbootå·²ç»ä¸ºæˆ‘ä»¬æä¾›äº†mongodbçš„è¿æ¥æ± ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åŸºäºéœ€è¦ï¼Œåœ¨é…ç½®<code>mongodb-uri</code>æ—¶ï¼Œå¢åŠ ç›¸å…³çš„è¿æ¥æ± å‚æ•°ï¼Œspringbootå°±ä¼šæŒ‰ç…§æˆ‘ä»¬é…ç½®çš„å‚æ•°ä¸ºæˆ‘ä»¬åˆ›å»ºè¿æ¥æ± ï¼Œå¹¶è‡ªåŠ¨ç®¡ç†è¿æ¥æ± ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight yml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">spring:</span></span><br><span class=\"line\">  <span class=\"attr\">data:</span></span><br><span class=\"line\">    <span class=\"attr\">mongodb:</span></span><br><span class=\"line\">      <span class=\"attr\">uri:</span> <span class=\"string\">mongodb://user:password@127.0.0.1:27040,127.0.0.1:27041,127.0.0.1:27042/mytest?authSource=admin&amp;readPreference=primaryPreferred&amp;maxpoolsize=100&amp;minpoolsize=10&amp;maxidletimems=0&amp;maxlifetimems=0&amp;maxconnecting=5&amp;waitqueuetimeoutms=60000</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å‚æ•°è¯´æ˜</p>\n</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">maxpoolsize: 100 # æ± ä¸­å…è®¸çš„æœ€å¤§è¿æ¥æ•°ã€‚ä¸€æ—¦æ± è€—å°½ï¼Œä»»ä½•éœ€è¦è¿æ¥çš„æ“ä½œéƒ½å°†åœ¨é˜»å¡é˜Ÿåˆ—ä¸­ç­‰å¾…ç›´åˆ°è·å–åˆ°è¿æ¥ï¼Œ é»˜è®¤: 100</span><br><span class=\"line\">minpoolsize: 10 # æ± ä¸­å…è®¸çš„æœ€å°è¿æ¥æ•°ã€‚è¿™äº›è¿æ¥åœ¨ç©ºé—²æ—¶å°†ä¿ç•™åœ¨æ± ä¸­ï¼Œå¹¶ä¸”æ± å°†ç¡®ä¿å®ƒè‡³å°‘åŒ…å«è¿™ä¸ªæœ€å°æ•°é‡ é»˜è®¤: 0</span><br><span class=\"line\">maxidletimems: 0 # æ± è¿æ¥çš„æœ€å¤§ç©ºé—²æ—¶é—´ã€‚é›¶å€¼è¡¨ç¤ºå¯¹ç©ºé—²æ—¶é—´æ²¡æœ‰é™åˆ¶ã€‚è¶…è¿‡å…¶ç©ºé—²æ—¶é—´çš„æ± è¿æ¥å°†è¢«å…³é—­å¹¶åœ¨å¿…è¦æ—¶ç”±æ–°è¿æ¥æ›¿æ¢ã€‚å•ä½ä¸ºæ¯«ç§’</span><br><span class=\"line\">maxlifetimems: 0 # æ± è¿æ¥å¯ä»¥å­˜æ´»çš„æœ€é•¿æ—¶é—´ã€‚é›¶å€¼è¡¨ç¤ºå¯¿å‘½æ²¡æœ‰é™åˆ¶ã€‚è¶…è¿‡å…¶ç”Ÿå‘½å‘¨æœŸçš„æ± è¿æ¥å°†è¢«å…³é—­å¹¶åœ¨å¿…è¦æ—¶ç”±æ–°è¿æ¥æ›¿æ¢ã€‚å•ä½ä¸ºæ¯«ç§’</span><br><span class=\"line\">maxconnecting: 5 # åŒä¸€æ—¶åˆ»å…è®¸çš„æœ€å¤§å¹¶è¡Œè¿æ¥æ•°ã€‚é»˜è®¤å€¼æ˜¯: 2ã€‚</span><br><span class=\"line\">waitqueuetimeoutms: 60000 # é˜»å¡é˜Ÿåˆ—ä¸­è¯·æ±‚çš„æœ€å¤§ç­‰å¾…æ—¶é—´ï¼Œè¶…è¿‡è¿™ä¸ªæ—¶é—´çš„è¯·æ±‚å°†è¢«æ‹’ç»ã€‚å•ä½ä¸ºæ¯«ç§’ï¼Œé»˜è®¤ä¸º: 120s</span><br></pre></td></tr></table></figure>\n<h2 id=\"å¦‚ä½•æŸ¥çœ‹è¿æ¥æ± æ˜¯å¦ç”Ÿæ•ˆäº†ï¼Ÿ\">å¦‚ä½•æŸ¥çœ‹è¿æ¥æ± æ˜¯å¦ç”Ÿæ•ˆäº†ï¼Ÿ</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¾ˆç®€å•ï¼Œæˆ‘ä»¬åªéœ€è¦æ³¨å…¥<code>MongoClient</code>å¹¶æŸ¥çœ‹å…¶<code>settings</code>å±æ€§ï¼Œå°±å¯ä»¥çœ‹åˆ°è¿æ¥æ± çš„é…ç½®ä¿¡æ¯äº†`</p>\n</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Autowired</span></span><br><span class=\"line\">MongoClient mongoClient;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// æ‰“å°è¿æ¥æ± é…ç½®ä¿¡æ¯</span></span><br><span class=\"line\">System.out.println(((MongoClientImpl) mongoClient).getSettings().getConnectionPoolSettings());</span><br><span class=\"line\"><span class=\"comment\">// è¾“å‡ºç»“æœ</span></span><br><span class=\"line\">ConnectionPoolSettings&#123;maxSize=<span class=\"number\">100</span>, minSize=<span class=\"number\">10</span>, maxWaitTimeMS=<span class=\"number\">60000</span>, maxConnectionLifeTimeMS=<span class=\"number\">0</span>, maxConnectionIdleTimeMS=<span class=\"number\">0</span>, maintenanceInitialDelayMS=<span class=\"number\">0</span>, maintenanceFrequencyMS=<span class=\"number\">60000</span>, connectionPoolListeners=[], maxConnecting=<span class=\"number\">5</span>&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"åè®°\">åè®°</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>springbootä¸ºä»€ä¹ˆæ²¡æœ‰å°†mongodbçš„è¿æ¥æ± å±æ€§ä¹Ÿå°è£…åˆ°<code>MongoProperties</code>ä¸­å‘¢ï¼Œä¹Ÿè®¸æ˜¯å› ä¸ºå’Œmongodbç›¸å…³çš„é“¾æ¥å‚æ•°å¤ªå¤šäº†å§ï¼Œè€Œä¸”æˆ‘ä»¬åœ¨é…ç½®mongodbæ—¶ï¼Œä¸€èˆ¬éƒ½ä¼šä½¿ç”¨<code>mongodb-uri</code>çš„æ–¹å¼ï¼Œæ‰€ä»¥springbootå°±ç›´æ¥å°†è¿æ¥æ± å‚æ•°æ”¾åˆ°<code>mongodb-uri</code>ä¸­ï¼Œè¿™æ ·é…ç½®èµ·æ¥å°±æ¯”è¾ƒæ–¹ä¾¿äº†ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å¦å¤–æˆ‘ä»¬å‘ç°ï¼Œåœ¨<code>MongoClientSettings</code>ä¸­é™¤äº†è¿æ¥æ± çš„é…ç½®ï¼Œè¿˜æœ‰å¾ˆå¤šé…ç½®é¡¹ä¹Ÿæ˜¯åŸºäº<code>mongodb-uri</code>çš„ï¼Œæˆ‘ä»¬å¯ä»¥åŸºäºéœ€è¦è¿›è¡Œé…ç½®ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">final</span> ReadPreference readPreference;</span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">final</span> WriteConcern writeConcern;</span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"type\">boolean</span> retryWrites;</span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"type\">boolean</span> retryReads;</span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">final</span> ReadConcern readConcern;</span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">final</span> MongoCredential credential;</span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">final</span> TransportSettings transportSettings;</span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">final</span> LoggerSettings loggerSettings;</span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">final</span> ClusterSettings clusterSettings;</span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">final</span> SocketSettings socketSettings;</span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">final</span> SocketSettings heartbeatSocketSettings;</span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">final</span> ConnectionPoolSettings connectionPoolSettings;</span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">final</span> ServerSettings serverSettings;</span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">final</span> SslSettings sslSettings;</span><br></pre></td></tr></table></figure>\n","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç»å¦‚ä½•ä½¿ç”¨SpringBooté…ç½®MongoDB7.0çš„è¿æ¥æ±  SpringBootç‰ˆæœ¬3.2.4ï¼ŒMongoDBç‰ˆæœ¬7.0.6 å…³äºspringbootä¸mongodbçš„é›†æˆå¯ä»¥å‚è€ƒï¼šMongoDB7.0--SpringBootå•é›†åˆæ“ä½œï¼Œæœ¬æ–‡åªè®¨è®ºè¿æ¥æ± ç›¸å…³å†…å®¹ã€‚ spring-boot çš„ MongoDB è¿æ¥æ±  å½“æˆ‘ä»¬åœ¨springbootçš„é…ç½®æ–‡ä»¶ä¸­é…ç½®mongodbçš„ç›¸å…³å±æ€§æ—¶ï¼Œå¹¶æ²¡æœ‰å‘ç°å’Œè¿æ¥æ± ç›¸å…³çš„å±æ€§ï¼ŒæŸ¥çœ‹MongoPropertiesä¸­çš„å±æ€§ä¹Ÿå¯ä»¥è¯å®è¿™ä¸€ç‚¹ï¼Œè¿™å°±å¾ˆå¥‡æ€ªï¼ŒæŒ‰ç†è¯´springbootåº”è¯¥ä¸ä¼šè¿™ä¹ˆå¼±é¸¡ã€‚ äºæ˜¯æˆ‘æ‰“ç®—çœ‹çœ‹springbootçš„æºç ï¼Œçœ‹çœ‹springbootä¸ºæˆ‘ä»¬è‡ªåŠ¨åˆ›å»ºçš„MongoClientåˆ°åº•æœ‰æ²¡æœ‰è¿æ¥æ± çš„é…ç½®ã€‚ æˆ‘ä»¬å°±ä»mongodbçš„è‡ªåŠ¨é…ç½®ç±»MongoAutoConfigurationå¼€å§‹ï¼Œè¯¥ç±»ä¸­å®šä¹‰äº†PropertiesMongoConnectionDetailså’ŒMongoClient 123456789101112//è¿™ä¸ªç±»ä¸»è¦ç”¨äºConnectionStringå¯¹è±¡çš„å°è£…ï¼Œåé¢ä¼šè®²åˆ°@Bean@ConditionalOnMissingBean(&#123;MongoConnectionDetails.class&#125;)PropertiesMongoConnectionDetails mongoConnectionDetails(MongoProperties properties) &#123; return new PropertiesMongoConnectionDetails(properties);&#125;@Bean@ConditionalOnMissingBean(&#123;MongoClient.class&#125;)public MongoClient mongo(ObjectProvider&lt;MongoClientSettingsBuilderCustomizer&gt; builderCustomizers, MongoClientSettings settings) &#123; return (MongoClient)(new MongoClientFactory(builderCustomizers.orderedStream().toList())).createMongoClient(settings);&#125; å¯ä»¥çœ‹åˆ°ï¼Œåˆ›å»ºMongoClientçš„beanæ—¶ï¼Œä¾èµ–ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ˜¯ObjectProvider&lt;MongoClientSettingsBuilderCustomizer&gt;ï¼Œä¸€ä¸ªæ˜¯MongoClientSettingsï¼Œå‰è€…ä¼šå°†springä¸Šä¸‹æ–‡ä¸­æ‰€æœ‰ç±»å‹ä¸ºMongoClientSettingsBuilderCustomizerçš„beanå°è£…åˆ°è¯¥å¯¹è±¡ä¸­(springbooté»˜è®¤åªæä¾›äº†ä¸€ä¸ªStandardMongoClientSettingsBuilderCustomizer) MongoAutoConfigurationç¼ºçœä¸ºæˆ‘ä»¬æä¾›äº†MongoClientSettingså’ŒStandardMongoClientSettingsBuilderCustomizerï¼Œè¿™ä¸¤ä¸ªç±»éƒ½å¾ˆé‡è¦ï¼Œè¿æ¥æ± å‚æ•°å°±å’Œå®ƒä»¬æœ‰å…³ 123456789@BeanMongoClientSettings mongoClientSettings() &#123; return MongoClientSettings.builder().build();&#125;// éœ€è¦çš„å‚æ•°connectionDetailsåˆšå¥½æ˜¯ä¸Šé¢çš„PropertiesMongoConnectionDetails@BeanStandardMongoClientSettingsBuilderCustomizer standardMongoSettingsCustomizer(MongoProperties properties, MongoConnectionDetails connectionDetails, ObjectProvider&lt;SslBundles&gt; sslBundles) &#123; return new StandardMongoClientSettingsBuilderCustomizer(connectionDetails.getConnectionString(), properties.getUuidRepresentation(), properties.getSsl(), (SslBundles)sslBundles.getIfAvailable());&#125; æˆ‘ä»¬å…ˆçœ‹MongoClientSettingsï¼Œå…¶ä¸­å°±å®šä¹‰ä¸€ä¸ªè¿æ¥æ± çš„é…ç½®å¯¹è±¡ConnectionPoolSettingsï¼Œè€ŒConnectionPoolSettingså…¶å†…éƒ¨å°±å®šä¹‰äº†è¿æ¥æ± çš„é…ç½®å±æ€§ï¼ŒMongoClientSettingsé€šè¿‡ConnectionPoolSettingsçš„æ„é€ å™¨åˆ›å»ºå‡ºäº†ConnectionPoolSettingså¯¹è±¡ï¼Œå…¶ç¼ºçœå€¼å¦‚ä¸‹ï¼š 123456private int maxSize = 100;private int minSize;private long maxWaitTimeMS = 1000 * 60 * 2;private long maxConnectionLifeTimeMS;private long maxConnectionIdleTimeMS;private int maxConnecting = 2; æˆ‘ä»¬çœ‹å¦ä¸€ä¸ªå’Œåˆ›å»ºMongoClientç›¸å…³çš„beanï¼Œè¿™ä¸ªStandardMongoClientSettingsBuilderCustomizerï¼Œåˆ›å»ºè¿™ä¸ªbeanæ—¶éœ€è¦ä¸€ä¸ªMongoConnectionDetailså¯¹è±¡ï¼Œå¹¶è°ƒç”¨å…¶getConnectionStringæ–¹æ³•ï¼Œè¿™ä¸ªå¯¹è±¡MongoAutoConfigurationä¹Ÿä¸ºæˆ‘ä»¬æä¾›äº†(ä¸Šé¢å¯ä»¥çœ‹åˆ°) æŸ¥çœ‹PropertiesMongoConnectionDetailsçš„æºç ï¼Œå‘ç°connectionDetails.getConnectionString()çš„åŠŸèƒ½å°±æ˜¯å°†MongoPropertiesçš„å±æ€§å°è£…ä¸ºuriå¹¶ä¼ é€’ç»™ConnectionStringçš„æ„é€ å™¨åˆ›å»ºå¯¹è±¡ 12345678910111213141516171819202122232425262728293031323334353637public ConnectionString getConnectionString() &#123; if (this.properties.getUri() != null) &#123; return new ConnectionString(this.properties.getUri()); &#125; else &#123; StringBuilder builder = new StringBuilder(&quot;mongodb://&quot;); if (this.properties.getUsername() != null) &#123; builder.append(this.encode(this.properties.getUsername())); builder.append(&quot;:&quot;); if (this.properties.getPassword() != null) &#123; builder.append(this.encode(this.properties.getPassword())); &#125; builder.append(&quot;@&quot;); &#125; builder.append(this.properties.getHost() != null ? this.properties.getHost() : &quot;localhost&quot;); if (this.properties.getPort() != null) &#123; builder.append(&quot;:&quot;); builder.append(this.properties.getPort()); &#125; if (this.properties.getAdditionalHosts() != null) &#123; builder.append(&quot;,&quot;); builder.append(String.join(&quot;,&quot;, this.properties.getAdditionalHosts())); &#125; builder.append(&quot;/&quot;); builder.append(this.properties.getMongoClientDatabase()); List&lt;String&gt; options = this.getOptions(); if (!options.isEmpty()) &#123; builder.append(&quot;?&quot;); builder.append(String.join(&quot;&amp;&quot;, options)); &#125; // å°†MongoPropertiesè½¬æ¢ä¸ºuriæ ¼å¼åè°ƒç”¨æ„é€ å™¨åˆ›å»ºConnectionString return new ConnectionString(builder.toString()); &#125;&#125; è¿™ä¸ªConnectionStringå¯¹è±¡çš„åˆå§‹åŒ–è¿‡ç¨‹å°±å¾ˆæœ‰æ„æ€äº†ï¼Œå…¶ä¼šå¯¹è¿™ä¸ªuriè¿›è¡Œè§£æï¼Œè§£æè¿‡ç¨‹ä¸­ä¼šè°ƒç”¨parseOptions(connectionStringQueryParameters)æ–¹æ³•ï¼Œå…¶ä¼šå°†uriä¸­çš„å‚æ•°è½¬æ¢ä¸ºMapï¼Œä¹‹åè°ƒç”¨translateOptions(combinedOptionsMaps)æ–¹æ³•éå†è¿™ä¸ªmapï¼Œè€Œåœ¨éå†çš„è¿‡ç¨‹ä¸­å°±ä¼šå®Œæˆå¯¹ConnectionStringå¯¹è±¡çš„è¿æ¥æ± ç›¸å…³å±æ€§çš„åˆå§‹åŒ– 123456789101112131415161718192021222324252627282930313233private void translateOptions(final Map&lt;String, List&lt;String&gt;&gt; optionsMap) &#123; boolean tlsInsecureSet = false; boolean tlsAllowInvalidHostnamesSet = false; for (final String key : GENERAL_OPTIONS_KEYS) &#123; String value = getLastValue(optionsMap, key); if (value == null) &#123; continue; &#125; switch (key) &#123; // è¿æ¥æ± ç›¸å…³å±æ€§ï¼Œæ³¨æ„è¿™é‡Œçš„å±æ€§åç§°ï¼Œåé¢æˆ‘ä»¬é…ç½®è¿æ¥æ± æ—¶ä¼šç”¨åˆ° case &quot;maxpoolsize&quot;: maxConnectionPoolSize = parseInteger(value, &quot;maxpoolsize&quot;); break; case &quot;minpoolsize&quot;: minConnectionPoolSize = parseInteger(value, &quot;minpoolsize&quot;); break; case &quot;maxidletimems&quot;: maxConnectionIdleTime = parseInteger(value, &quot;maxidletimems&quot;); break; case &quot;maxlifetimems&quot;: maxConnectionLifeTime = parseInteger(value, &quot;maxlifetimems&quot;); break; case &quot;maxconnecting&quot;: maxConnecting = parseInteger(value, &quot;maxConnecting&quot;); break; case &quot;waitqueuetimeoutms&quot;: maxWaitTime = parseInteger(value, &quot;waitqueuetimeoutms&quot;); break; case &quot;connecttimeoutms&quot;: connectTimeout = parseInteger(value, &quot;connecttimeoutms&quot;); break; â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦ å…¶å®æ­¤æ—¶æˆ‘ä»¬å°±å·²ç»çŸ¥é“åº”è¯¥å¦‚ä½•é…ç½®è¿æ¥æ± å‚æ•°äº†ï¼Œå°±æ˜¯å°†è¿æ¥æ± ç›¸å…³çš„å‚æ•°è¿½åŠ åˆ°uriçš„å‚æ•°éƒ¨åˆ†ï¼Œä½†æ˜¯å‰é¢æˆ‘ä»¬æåˆ°è´Ÿè´£è¿æ¥æ± çš„ç±»æ˜¯ConnectionPoolSettingsï¼Œé‚£ä¹ˆConnectionStringå¯¹è±¡ä¸­çš„è¿æ¥æ± å±æ€§æ˜¯å¦‚ä½•è¢«ä¼ é€’ç»™ConnectionPoolSettingsçš„å‘¢ï¼Œæˆ‘ä»¬æ¥ç€å¾€ä¸‹çœ‹ã€‚ å‚æ•°å‡†å¤‡å¥½åå°±å¼€å§‹åˆ›å»ºMongoClientäº†ï¼Œå…¶ä¼šè°ƒç”¨MongoClientFactoryçš„createMongoClientæ–¹æ³•ï¼Œå…¶ä¼šå¯¹MongoClientSettingså¯¹è±¡åšè¿›ä¸€æ­¥çš„å°è£…ï¼Œå¹¶æœ€ç»ˆåŸºäºå°è£…åçš„MongoClientSettingså¯¹è±¡åˆ›å»ºå‡ºMongoClientå¯¹è±¡ 12345678910public T createMongoClient(MongoClientSettings settings) &#123; Builder targetSettings = MongoClientSettings.builder(settings); customize(targetSettings); return this.clientCreator.apply(targetSettings.build(), driverInformation());&#125;private void customize(Builder builder) &#123; for (MongoClientSettingsBuilderCustomizer customizer : this.builderCustomizers) &#123; customizer.customize(builder); &#125;&#125; è€Œåœ¨è¿›ä¸€æ­¥å°è£…MongoClientSettingså¯¹è±¡æ—¶ï¼Œä¼šè°ƒç”¨ç³»ç»Ÿä¸­æ‰€æœ‰è¢«springç®¡ç†çš„MongoClientSettingsBuilderCustomizer,å®é™…ä¸Šä¹Ÿå°±æ˜¯StandardMongoClientSettingsBuilderCustomizerçš„customizeæ–¹æ³•ï¼Œå…¶åˆä¼šè°ƒç”¨MongoClientSettings.builder()çš„applyConnectionSettingsæ–¹æ³•ï¼Œè€Œåœ¨è¯¥æ–¹æ³•ä¸­è°ƒç”¨connectionPoolSettingsBuilder.applyConnectionString(connectionString);å°±å®Œæˆäº†å°†ConnectionStringå¯¹è±¡ä¸­çš„è¿æ¥æ± å±æ€§ä¼ é€’ç»™ConnectionPoolSettingså¯¹è±¡çš„è¿‡ç¨‹ï¼Œå½“ç„¶ï¼Œå¦‚æœå±æ€§æ²¡æœ‰è·å–åˆ°å°±ä¼šä½¿ç”¨é»˜è®¤å€¼ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åŸºäºéœ€è¦é…ç½®ç›¸å…³çš„å±æ€§ã€‚ 123456789101112131415161718192021222324252627282930313233public Builder applyConnectionString(final ConnectionString connectionString) &#123; Integer maxConnectionPoolSize = connectionString.getMaxConnectionPoolSize(); if (maxConnectionPoolSize != null) &#123; maxSize(maxConnectionPoolSize); &#125; Integer minConnectionPoolSize = connectionString.getMinConnectionPoolSize(); if (minConnectionPoolSize != null) &#123; minSize(minConnectionPoolSize); &#125; Integer maxWaitTime = connectionString.getMaxWaitTime(); if (maxWaitTime != null) &#123; maxWaitTime(maxWaitTime, MILLISECONDS); &#125; Integer maxConnectionIdleTime = connectionString.getMaxConnectionIdleTime(); if (maxConnectionIdleTime != null) &#123; maxConnectionIdleTime(maxConnectionIdleTime, MILLISECONDS); &#125; Integer maxConnectionLifeTime = connectionString.getMaxConnectionLifeTime(); if (maxConnectionLifeTime != null) &#123; maxConnectionLifeTime(maxConnectionLifeTime, MILLISECONDS); &#125; Integer maxConnecting = connectionString.getMaxConnecting(); if (maxConnecting != null) &#123; maxConnecting(maxConnecting); &#125; return this;&#125; å¤§ä½“è¿‡ç¨‹å°±æ˜¯è¿™æ ·ï¼Œå¾ˆç»•ï¼Œç®€å•ç‚¹è¯´å°±æ˜¯springbootå·²ç»ä¸ºæˆ‘ä»¬æä¾›äº†mongodbçš„è¿æ¥æ± ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åŸºäºéœ€è¦ï¼Œåœ¨é…ç½®mongodb-uriæ—¶ï¼Œå¢åŠ ç›¸å…³çš„è¿æ¥æ± å‚æ•°ï¼Œspringbootå°±ä¼šæŒ‰ç…§æˆ‘ä»¬é…ç½®çš„å‚æ•°ä¸ºæˆ‘ä»¬åˆ›å»ºè¿æ¥æ± ï¼Œå¹¶è‡ªåŠ¨ç®¡ç†è¿æ¥æ± ã€‚ 12345spring: data: mongodb: uri: mongodb://user:password@127.0.0.1:27040,127.0.0.1:27041,127.0.0.1:27042/mytest?authSource=admin&amp;readPreference=primaryPreferred&amp;maxpoolsize=100&amp;minpoolsize=10&amp;maxidletimems=0&amp;maxlifetimems=0&amp;maxconnecting=5&amp;waitqueuetimeoutms=60000 å‚æ•°è¯´æ˜ 123456maxpoolsize: 100 # æ± ä¸­å…è®¸çš„æœ€å¤§è¿æ¥æ•°ã€‚ä¸€æ—¦æ± è€—å°½ï¼Œä»»ä½•éœ€è¦è¿æ¥çš„æ“ä½œéƒ½å°†åœ¨é˜»å¡é˜Ÿåˆ—ä¸­ç­‰å¾…ç›´åˆ°è·å–åˆ°è¿æ¥ï¼Œ é»˜è®¤: 100minpoolsize: 10 # æ± ä¸­å…è®¸çš„æœ€å°è¿æ¥æ•°ã€‚è¿™äº›è¿æ¥åœ¨ç©ºé—²æ—¶å°†ä¿ç•™åœ¨æ± ä¸­ï¼Œå¹¶ä¸”æ± å°†ç¡®ä¿å®ƒè‡³å°‘åŒ…å«è¿™ä¸ªæœ€å°æ•°é‡ é»˜è®¤: 0maxidletimems: 0 # æ± è¿æ¥çš„æœ€å¤§ç©ºé—²æ—¶é—´ã€‚é›¶å€¼è¡¨ç¤ºå¯¹ç©ºé—²æ—¶é—´æ²¡æœ‰é™åˆ¶ã€‚è¶…è¿‡å…¶ç©ºé—²æ—¶é—´çš„æ± è¿æ¥å°†è¢«å…³é—­å¹¶åœ¨å¿…è¦æ—¶ç”±æ–°è¿æ¥æ›¿æ¢ã€‚å•ä½ä¸ºæ¯«ç§’maxlifetimems: 0 # æ± è¿æ¥å¯ä»¥å­˜æ´»çš„æœ€é•¿æ—¶é—´ã€‚é›¶å€¼è¡¨ç¤ºå¯¿å‘½æ²¡æœ‰é™åˆ¶ã€‚è¶…è¿‡å…¶ç”Ÿå‘½å‘¨æœŸçš„æ± è¿æ¥å°†è¢«å…³é—­å¹¶åœ¨å¿…è¦æ—¶ç”±æ–°è¿æ¥æ›¿æ¢ã€‚å•ä½ä¸ºæ¯«ç§’maxconnecting: 5 # åŒä¸€æ—¶åˆ»å…è®¸çš„æœ€å¤§å¹¶è¡Œè¿æ¥æ•°ã€‚é»˜è®¤å€¼æ˜¯: 2ã€‚waitqueuetimeoutms: 60000 # é˜»å¡é˜Ÿåˆ—ä¸­è¯·æ±‚çš„æœ€å¤§ç­‰å¾…æ—¶é—´ï¼Œè¶…è¿‡è¿™ä¸ªæ—¶é—´çš„è¯·æ±‚å°†è¢«æ‹’ç»ã€‚å•ä½ä¸ºæ¯«ç§’ï¼Œé»˜è®¤ä¸º: 120s å¦‚ä½•æŸ¥çœ‹è¿æ¥æ± æ˜¯å¦ç”Ÿæ•ˆäº†ï¼Ÿ å¾ˆç®€å•ï¼Œæˆ‘ä»¬åªéœ€è¦æ³¨å…¥MongoClientå¹¶æŸ¥çœ‹å…¶settingså±æ€§ï¼Œå°±å¯ä»¥çœ‹åˆ°è¿æ¥æ± çš„é…ç½®ä¿¡æ¯äº†` 1234567@AutowiredMongoClient mongoClient;// æ‰“å°è¿æ¥æ± é…ç½®ä¿¡æ¯System.out.println(((MongoClientImpl) mongoClient).getSettings().getConnectionPoolSettings());// è¾“å‡ºç»“æœConnectionPoolSettings&#123;maxSize=100, minSize=10, maxWaitTimeMS=60000, maxConnectionLifeTimeMS=0, maxConnectionIdleTimeMS=0, maintenanceInitialDelayMS=0, maintenanceFrequencyMS=60000, connectionPoolListeners=[], maxConnecting=5&#125; åè®° springbootä¸ºä»€ä¹ˆæ²¡æœ‰å°†mongodbçš„è¿æ¥æ± å±æ€§ä¹Ÿå°è£…åˆ°MongoPropertiesä¸­å‘¢ï¼Œä¹Ÿè®¸æ˜¯å› ä¸ºå’Œmongodbç›¸å…³çš„é“¾æ¥å‚æ•°å¤ªå¤šäº†å§ï¼Œè€Œä¸”æˆ‘ä»¬åœ¨é…ç½®mongodbæ—¶ï¼Œä¸€èˆ¬éƒ½ä¼šä½¿ç”¨mongodb-uriçš„æ–¹å¼ï¼Œæ‰€ä»¥springbootå°±ç›´æ¥å°†è¿æ¥æ± å‚æ•°æ”¾åˆ°mongodb-uriä¸­ï¼Œè¿™æ ·é…ç½®èµ·æ¥å°±æ¯”è¾ƒæ–¹ä¾¿äº†ã€‚ å¦å¤–æˆ‘ä»¬å‘ç°ï¼Œåœ¨MongoClientSettingsä¸­é™¤äº†è¿æ¥æ± çš„é…ç½®ï¼Œè¿˜æœ‰å¾ˆå¤šé…ç½®é¡¹ä¹Ÿæ˜¯åŸºäºmongodb-uriçš„ï¼Œæˆ‘ä»¬å¯ä»¥åŸºäºéœ€è¦è¿›è¡Œé…ç½®ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š 1234567891011121314private final ReadPreference readPreference;private final WriteConcern writeConcern;private final boolean retryWrites;private final boolean retryReads;private final ReadConcern readConcern;private final MongoCredential credential;private final TransportSettings transportSettings;private final LoggerSettings loggerSettings;private final ClusterSettings clusterSettings;private final SocketSettings socketSettings;private final SocketSettings heartbeatSocketSettings;private final ConnectionPoolSettings connectionPoolSettings;private final ServerSettings serverSettings;private final SslSettings sslSettings;","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç»å¦‚ä½•ä½¿ç”¨SpringBooté…ç½®MongoDB7.0çš„è¿æ¥æ±  SpringBootç‰ˆæœ¬3.2.4ï¼ŒMongoDBç‰ˆæœ¬7.0.6 å…³äºspringbootä¸mongodbçš„é›†æˆå¯ä»¥å‚è€ƒï¼šMongoDB7.0--SpringBootå•é›†åˆæ“ä½œï¼Œæœ¬æ–‡åªè®¨è®ºè¿æ¥æ± ç›¸å…³å†…å®¹ã€‚","date_published":"2024-04-08T13:30:05.000Z","tags":["æŠ€æœ¯","linux","mongodb","mongodb"]},{"id":"https://blog.hanqunfeng.com/2024/04/07/mongodb7-others/","url":"https://blog.hanqunfeng.com/2024/04/07/mongodb7-others/","title":"MongoDB7.0ä¸€äº›æœ‰ç”¨çš„åŠŸèƒ½","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç»MongoDB7.0çš„ä¸€äº›æœ‰ç”¨çš„åŠŸèƒ½ï¼Œæ¯”å¦‚è¿è¡Œjsï¼ŒæŸ¥çœ‹æ…¢æŸ¥è¯¢æ—¥å¿—ç­‰ç­‰</p>\n</li>\n<li class=\"lvl-2\">\n<p>MongoDB<a href=\"https://www.mongodb.com/docs/v7.0/\">å®˜æ–¹æ–‡æ¡£</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡åŸºäº<code>CentOS8(x86_64)</code></p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"è¿è¡Œjs\">è¿è¡Œjs</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¿è¡Œjsæ–‡ä»¶</p>\n</li>\n</ul>\n<blockquote>\n<p>insertMany.js</p>\n</blockquote>\n  <figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> tags = [<span class=\"string\">&#x27;nosql&#x27;</span>, <span class=\"string\">&#x27;mongodb&#x27;</span>, <span class=\"string\">&#x27;document&#x27;</span>, <span class=\"string\">&#x27;developer&#x27;</span>, <span class=\"string\">&#x27;popular&#x27;</span>]</span><br><span class=\"line\"><span class=\"keyword\">var</span> types = [<span class=\"string\">&#x27;technology&#x27;</span>, <span class=\"string\">&#x27;sociality&#x27;</span>, <span class=\"string\">&#x27;travel&#x27;</span>, <span class=\"string\">&#x27;novel&#x27;</span>, <span class=\"string\">&#x27;literature&#x27;</span>]</span><br><span class=\"line\"><span class=\"keyword\">var</span> books = []</span><br><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">50</span>; i++) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> typeIdx = <span class=\"title class_\">Math</span>.<span class=\"title function_\">floor</span>(<span class=\"title class_\">Math</span>.<span class=\"title function_\">random</span>() * types.<span class=\"property\">length</span>)</span><br><span class=\"line\">  <span class=\"keyword\">var</span> tagIdx = <span class=\"title class_\">Math</span>.<span class=\"title function_\">floor</span>(<span class=\"title class_\">Math</span>.<span class=\"title function_\">random</span>() * tags.<span class=\"property\">length</span>)</span><br><span class=\"line\">  <span class=\"keyword\">var</span> favCount = <span class=\"title class_\">Math</span>.<span class=\"title function_\">floor</span>(<span class=\"title class_\">Math</span>.<span class=\"title function_\">random</span>() * <span class=\"number\">100</span>)</span><br><span class=\"line\">  <span class=\"keyword\">var</span> book = &#123;</span><br><span class=\"line\">    <span class=\"attr\">title</span>: <span class=\"string\">&#x27;book-&#x27;</span> + i,</span><br><span class=\"line\">    <span class=\"attr\">type</span>: types[typeIdx],</span><br><span class=\"line\">    <span class=\"attr\">tag</span>: tags[tagIdx],</span><br><span class=\"line\">    <span class=\"attr\">favCount</span>: favCount,</span><br><span class=\"line\">    <span class=\"attr\">author</span>: <span class=\"string\">&#x27;xxx&#x27;</span> + i</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  books.<span class=\"title function_\">push</span>(book)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">db.<span class=\"property\">books</span>.<span class=\"title function_\">insertMany</span>(books)</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># -f è¿è¡Œjsæ–‡ä»¶</span></span><br><span class=\"line\">mongosh <span class=\"string\">&quot;mongodb://user:password@10.1.2.26:27017,10.1.2.142:27017,10.1.2.41:27017/test?authSource=admin&amp;replicaSet=rs0&quot;</span> -f insertMany.js</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¿è¡Œjsè¯­å¥</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ---eval è¿è¡Œjsè¯­å¥</span></span><br><span class=\"line\">mongosh <span class=\"string\">&quot;mongodb://user:password@10.1.2.26:27017,10.1.2.142:27017,10.1.2.41:27017/test?authSource=admin&amp;replicaSet=rs0&quot;</span> --<span class=\"built_in\">eval</span> <span class=\"string\">&quot;db.books.find().limit(2)&quot;</span></span><br><span class=\"line\">[</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    _id: ObjectId(<span class=\"string\">&#x27;660d0b05a8a6c09b0b1852b7&#x27;</span>),</span><br><span class=\"line\">    title: <span class=\"string\">&#x27;book-0&#x27;</span>,</span><br><span class=\"line\">    <span class=\"built_in\">type</span>: <span class=\"string\">&#x27;novel&#x27;</span>,</span><br><span class=\"line\">    tag: <span class=\"string\">&#x27;document&#x27;</span>,</span><br><span class=\"line\">    favCount: 58,</span><br><span class=\"line\">    author: <span class=\"string\">&#x27;xxx0&#x27;</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    _id: ObjectId(<span class=\"string\">&#x27;660d0b05a8a6c09b0b1852b8&#x27;</span>),</span><br><span class=\"line\">    title: <span class=\"string\">&#x27;book-1&#x27;</span>,</span><br><span class=\"line\">    <span class=\"built_in\">type</span>: <span class=\"string\">&#x27;novel&#x27;</span>,</span><br><span class=\"line\">    tag: <span class=\"string\">&#x27;popular&#x27;</span>,</span><br><span class=\"line\">    favCount: 10,</span><br><span class=\"line\">    author: <span class=\"string\">&#x27;xxx1&#x27;</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">]</span><br></pre></td></tr></table></figure>\n<h2 id=\"Profileræ¨¡å—\">Profileræ¨¡å—</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Profileræ¨¡å—å¯ä»¥ç”¨æ¥è®°å½•ã€åˆ†æMongoDBçš„è¯¦ç»†æ“ä½œæ—¥å¿—ï¼Œé»˜è®¤æƒ…å†µä¸‹è¯¥åŠŸèƒ½æ˜¯å…³é—­çš„ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>Profileræ¨¡å—å¼€å¯å¯¹äºæ¯ä¸ªä¸šåŠ¡åº“æ¥è¯´æ˜¯ç‹¬ç«‹çš„ï¼Œå¯¹æŸä¸ªä¸šåŠ¡åº“å¼€å¯Profileræ¨¡å—ä¹‹åï¼Œç¬¦åˆæ¡ä»¶çš„æ…¢æ“ä½œæ—¥å¿—ä¼šè¢«å†™å…¥è¯¥åº“çš„<code>system.profile</code>é›†åˆä¸­ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>Profileræ¨¡å—çš„è°ƒè¯•çº§åˆ«æœ‰ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">0ï¼šå…³é—­Profileræ¨¡å—ï¼›</span><br><span class=\"line\">1ï¼šéƒ¨åˆ†å¼€å¯ï¼Œä»…ç¬¦åˆæ¡ä»¶ï¼ˆæ—¶é•¿å¤§äºslowmsï¼‰çš„æ“ä½œæ—¥å¿—ä¼šè¢«è®°å½•ï¼›</span><br><span class=\"line\">2ï¼šæ—¥å¿—å…¨å¼€ï¼Œæ‰€æœ‰çš„æ“ä½œæ—¥å¿—éƒ½è¢«è®°å½•ï¼›</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è®¾ç½®Profileræ¨¡å—çš„è°ƒè¯•çº§åˆ«ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># è®¾ç½®Profileræ¨¡å—çš„è°ƒè¯•çº§åˆ«ä¸º2</span></span><br><span class=\"line\">&gt; db.setProfilingLevel(2)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹å½“çš„è°ƒè¯•çº§åˆ«ä¿¡æ¯</span></span><br><span class=\"line\">&gt; db.<span class=\"function\"><span class=\"title\">getProfilingStatus</span></span>()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  was: 2,  <span class=\"comment\"># å½“å‰çš„è°ƒè¯•çº§åˆ«</span></span><br><span class=\"line\">  slowms: 100, <span class=\"comment\"># æ…¢æŸ¥è¯¢çš„é˜ˆå€¼ï¼Œå•ä½æ˜¯æ¯«ç§’ï¼›</span></span><br><span class=\"line\">  sampleRate: 1.0, <span class=\"comment\"># æ—¥å¿—éšæœºé‡‡æ ·ç‡ï¼Œ1.0åˆ™è¡¨ç¤ºæ»¡è¶³æ¡ä»¶çš„å…¨éƒ¨è¾“å‡ºã€‚</span></span><br><span class=\"line\">  ok: 1,   <span class=\"comment\"># çŠ¶æ€</span></span><br><span class=\"line\">  <span class=\"string\">&#x27;$clusterTime&#x27;</span>: &#123; <span class=\"comment\"># æ—¶é—´æˆ³</span></span><br><span class=\"line\">    clusterTime: Timestamp(&#123; t: 1712471779, i: 1 &#125;), <span class=\"comment\"># æ—¶é—´æˆ³</span></span><br><span class=\"line\">    signature: &#123; <span class=\"comment\"># ç­¾å</span></span><br><span class=\"line\">      <span class=\"built_in\">hash</span>: Binary.createFromBase64(<span class=\"string\">&#x27;GGCAjzJrW8arhfJX0Cn0VpvC5MA=&#x27;</span>, 0), <span class=\"comment\"># ç­¾å</span></span><br><span class=\"line\">      keyId: Long(<span class=\"string\">&#x27;7346062378896719877&#x27;</span>)  <span class=\"comment\"># ç­¾å</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  operationTime: Timestamp(&#123; t: 1712471779, i: 1 &#125;) <span class=\"comment\"># æ“ä½œæ—¶é—´</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åªè®°å½•æ—¶é•¿è¶…è¿‡500msçš„æ“ä½œ</span></span><br><span class=\"line\">&gt; db.setProfilingLevel(1,500)</span><br><span class=\"line\"><span class=\"comment\"># åŒæ—¶åŠ ä¸Šé‡‡æ ·ç‡</span></span><br><span class=\"line\">&gt; db.setProfilingLevel(1,&#123;slowms:500,sampleRate:0.5&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å…³é—­Profileræ¨¡å—</span></span><br><span class=\"line\">&gt; db.setProfilingLevel(2)</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æŸ¥çœ‹æ—¥å¿—</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹æ“ä½œæ—¥å¿—</span></span><br><span class=\"line\">&gt; db.system.profile.find().<span class=\"built_in\">limit</span>(5).<span class=\"built_in\">sort</span>(&#123;ts:-1&#125;).pretty()</span><br><span class=\"line\">[</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    op: <span class=\"string\">&#x27;query&#x27;</span>, <span class=\"comment\"># æ“ä½œç±»å‹,æ¯”å¦‚æŸ¥è¯¢,æ›´æ–°,åˆ é™¤ç­‰</span></span><br><span class=\"line\">    ns: <span class=\"string\">&#x27;admin.system.profile&#x27;</span>, <span class=\"comment\"># æ“ä½œçš„é›†åˆ</span></span><br><span class=\"line\">    <span class=\"built_in\">command</span>: &#123; <span class=\"comment\"># æ“ä½œçš„å‘½ä»¤</span></span><br><span class=\"line\">      find: <span class=\"string\">&#x27;system.profile&#x27;</span>, <span class=\"comment\"># æ“ä½œçš„é›†åˆ</span></span><br><span class=\"line\">      filter: &#123;&#125;, <span class=\"comment\"># æŸ¥è¯¢æ¡ä»¶</span></span><br><span class=\"line\">      lsid: &#123; <span class=\"built_in\">id</span>: UUID(<span class=\"string\">&#x27;2285d6a5-b2df-4b46-b9d2-5e556b0a7c7d&#x27;</span>) &#125;, <span class=\"comment\"># ä¼šè¯id</span></span><br><span class=\"line\">      <span class=\"string\">&#x27;$clusterTime&#x27;</span>: &#123; <span class=\"comment\"># æ—¶é—´æˆ³</span></span><br><span class=\"line\">        clusterTime: Timestamp(&#123; t: 1712471018, i: 1 &#125;),</span><br><span class=\"line\">        signature: &#123;</span><br><span class=\"line\">          <span class=\"built_in\">hash</span>: Binary.createFromBase64(<span class=\"string\">&#x27;8YEsN+XUWO6EkoHEegKkG49eWPA=&#x27;</span>, 0),</span><br><span class=\"line\">          keyId: Long(<span class=\"string\">&#x27;7346062378896719877&#x27;</span>)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      <span class=\"string\">&#x27;$db&#x27;</span>: <span class=\"string\">&#x27;admin&#x27;</span>, <span class=\"comment\"># æ•°æ®åº“</span></span><br><span class=\"line\">      <span class=\"string\">&#x27;$readPreference&#x27;</span>: &#123; mode: <span class=\"string\">&#x27;primaryPreferred&#x27;</span> &#125; <span class=\"comment\"># è¯»åå¥½</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    keysExamined: 0, <span class=\"comment\"># æ‰«æç´¢å¼•æ¡ç›®æ•°ï¼Œå¦‚æœæ¯”nreturnedå¤§å‡ºå¾ˆå¤šï¼Œåˆ™è¯´æ˜æŸ¥è¯¢æ•ˆç‡ä¸é«˜ã€‚</span></span><br><span class=\"line\">    docsExamined: 3, <span class=\"comment\"># æ‰«ææ–‡æ¡£æ¡ç›®æ•°ï¼Œå¦‚æœæ¯”nreturnedå¤§å‡ºå¾ˆå¤šï¼Œåˆ™è¯´æ˜æŸ¥è¯¢æ•ˆç‡ä¸é«˜ã€‚</span></span><br><span class=\"line\">    nBatches: 1, <span class=\"comment\"># æ‰¹å¤„ç†æ•°é‡</span></span><br><span class=\"line\">    cursorExhausted: <span class=\"literal\">true</span>, <span class=\"comment\"># æ˜¯å¦æ¸¸æ ‡å·²è€—å°½</span></span><br><span class=\"line\">    numYield: 0, <span class=\"comment\"># æ“ä½œæ•°ï¼Œå¤§äº0è¡¨ç¤ºç­‰å¾…é”æˆ–è€…æ˜¯ç£ç›˜I/Oæ“ä½œ</span></span><br><span class=\"line\">    nreturned: 3, <span class=\"comment\"># è¿”å›çš„æ–‡æ¡£æ•°é‡</span></span><br><span class=\"line\">    queryHash: <span class=\"string\">&#x27;8880B5AF&#x27;</span>, <span class=\"comment\"># æŸ¥è¯¢å“ˆå¸Œå€¼</span></span><br><span class=\"line\">    planCacheKey: <span class=\"string\">&#x27;8880B5AF&#x27;</span>,</span><br><span class=\"line\">    queryFramework: <span class=\"string\">&#x27;classic&#x27;</span>,</span><br><span class=\"line\">    locks: &#123;       <span class=\"comment\"># é”å ç”¨çš„æƒ…å†µã€‚</span></span><br><span class=\"line\">      FeatureCompatibilityVersion: &#123; acquireCount: &#123; r: Long(<span class=\"string\">&#x27;1&#x27;</span>) &#125; &#125;,</span><br><span class=\"line\">      Global: &#123; acquireCount: &#123; r: Long(<span class=\"string\">&#x27;1&#x27;</span>) &#125; &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    flowControl: &#123;&#125;,</span><br><span class=\"line\">    readConcern: &#123; level: <span class=\"string\">&#x27;local&#x27;</span>, provenance: <span class=\"string\">&#x27;implicitDefault&#x27;</span> &#125;, <span class=\"comment\"># è¯»å…³æ³¨</span></span><br><span class=\"line\">    responseLength: 3414, <span class=\"comment\"># å“åº”æ•°æ®å¤§å°ï¼ˆå­—èŠ‚æ•°ï¼‰ï¼Œä¸€æ¬¡æ€§æŸ¥è¯¢å¤ªå¤šçš„æ•°æ®ä¼šå½±å“æ€§èƒ½ï¼Œå¯ä»¥ä½¿ç”¨limitã€batchSizeè¿›è¡Œä¸€äº›é™åˆ¶ã€‚</span></span><br><span class=\"line\">    protocol: <span class=\"string\">&#x27;op_msg&#x27;</span>, <span class=\"comment\"># åè®®ç±»å‹ï¼Œop_msgæ˜¯mongodb 4.0+çš„åè®®ï¼Œop_queryæ˜¯mongodb 3.2åŠä»¥å‰ç‰ˆæœ¬çš„åè®®ã€‚</span></span><br><span class=\"line\">    millis: 0, <span class=\"comment\"># å‘½ä»¤æ‰§è¡Œçš„æ—¶é•¿ï¼Œå•ä½æ˜¯æ¯«ç§’ã€‚</span></span><br><span class=\"line\">    planSummary: <span class=\"string\">&#x27;COLLSCAN&#x27;</span>, <span class=\"comment\"># æŸ¥è¯¢è®¡åˆ’çš„æ¦‚è¦ï¼Œå¦‚IXSCANè¡¨ç¤ºä½¿ç”¨äº†ç´¢å¼•æ‰«æã€‚</span></span><br><span class=\"line\">    planningTimeMicros: 79,</span><br><span class=\"line\">    execStats: &#123;  <span class=\"comment\"># æ‰§è¡Œè¿‡ç¨‹ç»Ÿè®¡ä¿¡æ¯ã€‚</span></span><br><span class=\"line\">      stage: <span class=\"string\">&#x27;COLLSCAN&#x27;</span>,</span><br><span class=\"line\">      nReturned: 3,</span><br><span class=\"line\">      executionTimeMillisEstimate: 0,</span><br><span class=\"line\">      works: 4,</span><br><span class=\"line\">      advanced: 3,</span><br><span class=\"line\">      needTime: 0,</span><br><span class=\"line\">      needYield: 0,</span><br><span class=\"line\">      saveState: 0,</span><br><span class=\"line\">      restoreState: 0,</span><br><span class=\"line\">      isEOF: 1,</span><br><span class=\"line\">      direction: <span class=\"string\">&#x27;forward&#x27;</span>,</span><br><span class=\"line\">      docsExamined: 3</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    ts: ISODate(<span class=\"string\">&#x27;2024-04-07T06:23:56.054Z&#x27;</span>), <span class=\"comment\"># å‘½ä»¤æ‰§è¡Œçš„æ—¶é—´ç‚¹ã€‚</span></span><br><span class=\"line\">    client: <span class=\"string\">&#x27;127.0.0.1&#x27;</span>, <span class=\"comment\"># å®¢æˆ·ç«¯åœ°å€ã€‚</span></span><br><span class=\"line\">    appName: <span class=\"string\">&#x27;mongosh 2.1.5&#x27;</span>, <span class=\"comment\"># å®¢æˆ·ç«¯åç§°ã€‚</span></span><br><span class=\"line\">    allUsers: [ &#123; user: <span class=\"string\">&#x27;user&#x27;</span>, db: <span class=\"string\">&#x27;admin&#x27;</span> &#125; ], <span class=\"comment\"># æ‰€æœ‰ç”¨æˆ·ä¿¡æ¯ã€‚</span></span><br><span class=\"line\">    user: <span class=\"string\">&#x27;user@admin&#x27;</span> <span class=\"comment\"># å½“å‰ç”¨æˆ·ä¿¡æ¯ã€‚</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦</span><br><span class=\"line\">]</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹æ‰§è¡Œæ—¶é•¿æœ€å¤§çš„10æ¡æ“ä½œè®°å½•</span></span><br><span class=\"line\">&gt; db.system.profile.find().<span class=\"built_in\">limit</span>(10).<span class=\"built_in\">sort</span>(&#123;millis:-1&#125;).pretty()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹æŸä¸ªé›†åˆä¸­çš„updateæ“ä½œæ—¥å¿—</span></span><br><span class=\"line\">&gt; db.system.profile.find(&#123;op:<span class=\"string\">&quot;update&quot;</span>,ns:<span class=\"string\">&quot;shop.user&quot;</span>&#125;)</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><code>system.profile</code>æ˜¯ä¸€ä¸ª1MBçš„å›ºå®šå¤§å°çš„é›†åˆï¼Œéšç€è®°å½•æ—¥å¿—çš„å¢å¤šï¼Œä¸€äº›æ—§çš„è®°å½•ä¼šè¢«æ»šåŠ¨åˆ é™¤ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>Profileræ¨¡å—çš„è®¾ç½®æ˜¯å†…å­˜çº§çš„ï¼Œé‡å¯æœåŠ¡å™¨åä¼šè‡ªåŠ¨æ¢å¤é»˜è®¤çŠ¶æ€ã€‚</p>\n</li>\n</ul>\n<h2 id=\"db-currentOp\">db.currentOp()</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Profileræ¨¡å—æ‰€è®°å½•çš„æ—¥å¿—éƒ½æ˜¯å·²ç»å‘ç”Ÿçš„äº‹æƒ…ï¼Œ<code>db.currentOp()</code>å‘½ä»¤åˆ™ä¸æ­¤ç›¸åï¼Œå®ƒå¯ä»¥ç”¨æ¥æŸ¥çœ‹æ•°æ®åº“å½“å‰æ­£åœ¨æ‰§è¡Œçš„ä¸€äº›æ“ä½œã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>db.currentOp()è¯»å–çš„æ˜¯å½“å‰æ•°æ®åº“çš„å‘½ä»¤å¿«ç…§ï¼Œè¯¥å‘½ä»¤å¯ä»¥è¿”å›è®¸å¤šæœ‰ç”¨çš„ä¿¡æ¯ï¼Œæ¯”å¦‚ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">æ“ä½œçš„è¿è¡Œæ—¶é•¿ï¼Œå¿«é€Ÿå‘ç°è€—æ—¶æ¼«é•¿çš„ä½æ•ˆæ‰«ææ“ä½œã€‚</span><br><span class=\"line\">æ‰§è¡Œè®¡åˆ’ä¿¡æ¯ï¼Œç”¨äºåˆ¤æ–­æ˜¯å¦å‘½ä¸­äº†ç´¢å¼•ï¼Œæˆ–è€…å­˜åœ¨é”å†²çªçš„æƒ…å†µã€‚</span><br><span class=\"line\">æ“ä½œIDã€æ—¶é—´ã€å®¢æˆ·ç«¯ç­‰ä¿¡æ¯ï¼Œæ–¹ä¾¿å®šä½å‡ºäº§ç”Ÿæ…¢æ“ä½œçš„æºå¤´</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt; db.<span class=\"function\"><span class=\"title\">currentOp</span></span>()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">inprog: [ <span class=\"comment\"># å½“å‰æ­£åœ¨æ‰§è¡Œçš„æ“ä½œ</span></span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">      <span class=\"built_in\">type</span>: <span class=\"string\">&#x27;op&#x27;</span>, <span class=\"comment\"># æ“ä½œç±»å‹ï¼Œå¯ä»¥æ˜¯opã€idleSessionã€idleCursorçš„ä¸€ç§ï¼Œä¸€èˆ¬çš„æ“ä½œä¿¡æ¯ä»¥opè¡¨ç¤ºã€‚å…¶ä¸ºMongoDB 4.2ç‰ˆæœ¬æ–°å¢åŠŸèƒ½</span></span><br><span class=\"line\">      host: <span class=\"string\">&#x27;localhost:27041&#x27;</span>, <span class=\"comment\"># æ“ä½œæ‰€åœ¨çš„ä¸»æœº</span></span><br><span class=\"line\">      desc: <span class=\"string\">&#x27;conn474&#x27;</span>, <span class=\"comment\"># æ“ä½œçš„æè¿°ä¿¡æ¯</span></span><br><span class=\"line\">      connectionId: 474, <span class=\"comment\"># æ“ä½œçš„è¿æ¥ID</span></span><br><span class=\"line\">      client: <span class=\"string\">&#x27;127.0.0.1:58103&#x27;</span>, <span class=\"comment\"># æ“ä½œçš„å®¢æˆ·ç«¯ä¿¡æ¯</span></span><br><span class=\"line\">      appName: <span class=\"string\">&#x27;mongosh 2.1.5&#x27;</span>, <span class=\"comment\"># æ“ä½œçš„å®¢æˆ·ç«¯åº”ç”¨ä¿¡æ¯</span></span><br><span class=\"line\">      clientMetadata: &#123; <span class=\"comment\"># å…³äºå®¢æˆ·ç«¯çš„é™„åŠ ä¿¡æ¯ï¼Œå¯ä»¥åŒ…å«é©±åŠ¨çš„ç‰ˆæœ¬ã€‚</span></span><br><span class=\"line\">        application: &#123; name: <span class=\"string\">&#x27;mongosh 2.1.5&#x27;</span> &#125;,</span><br><span class=\"line\">        driver: &#123; name: <span class=\"string\">&#x27;nodejs|mongosh&#x27;</span>, version: <span class=\"string\">&#x27;6.3.0|2.1.5&#x27;</span> &#125;,</span><br><span class=\"line\">        platform: <span class=\"string\">&#x27;Node.js v20.11.1, LE&#x27;</span>,</span><br><span class=\"line\">        os: &#123;</span><br><span class=\"line\">          name: <span class=\"string\">&#x27;darwin&#x27;</span>,</span><br><span class=\"line\">          architecture: <span class=\"string\">&#x27;x64&#x27;</span>,</span><br><span class=\"line\">          version: <span class=\"string\">&#x27;22.6.0&#x27;</span>,</span><br><span class=\"line\">          <span class=\"built_in\">type</span>: <span class=\"string\">&#x27;Darwin&#x27;</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      active: <span class=\"literal\">true</span>, <span class=\"comment\"># æ“ä½œæ˜¯å¦æ´»è·ƒã€‚å¦‚æœæ˜¯ç©ºé—²çŠ¶æ€åˆ™ä¸ºfalse</span></span><br><span class=\"line\">      currentOpTime: <span class=\"string\">&#x27;2024-04-07T14:54:02.994+08:00&#x27;</span>, <span class=\"comment\"># æ“ä½œçš„å¼€å§‹æ—¶é—´ã€‚MongoDB 3.6ç‰ˆæœ¬æ–°å¢åŠŸèƒ½</span></span><br><span class=\"line\">      threaded: <span class=\"literal\">true</span>,</span><br><span class=\"line\">      opid: 236247, <span class=\"comment\"># opidï¼šå½“å‰æ“ä½œåœ¨æ•°æ®åº“è¿›ç¨‹ä¸­çš„å”¯ä¸€ç¼–å·,å¦‚æœå·²ç»å‘ç°è¯¥æ“ä½œæ­£åœ¨å¯¼è‡´æ•°æ®åº“ç³»ç»Ÿå“åº”ç¼“æ…¢ï¼Œåˆ™å¯ä»¥è€ƒè™‘å°†å…¶â€œæ€â€æ­» : db.killOp(236247)</span></span><br><span class=\"line\">      secs_running: Long(<span class=\"string\">&#x27;3&#x27;</span>), <span class=\"comment\"># æ“ä½œæŒç»­æ—¶é—´,å•ä½ï¼šç§’</span></span><br><span class=\"line\">      microsecs_running: Long(<span class=\"string\">&#x27;3362378&#x27;</span>), <span class=\"comment\"># æ“ä½œæŒç»­æ—¶é—´ï¼Œå•ä½ï¼šå¾®ç§’</span></span><br><span class=\"line\">      op: <span class=\"string\">&#x27;command&#x27;</span>, <span class=\"comment\"># æ ‡è¯†æ“ä½œç±»å‹çš„å­—ç¬¦ä¸²ï¼Œå¦‚ command, insert, query, update, delete, getMore, killCursors</span></span><br><span class=\"line\">      ns: <span class=\"string\">&#x27;admin.$cmd&#x27;</span>, <span class=\"comment\"># æ“ä½œçš„å‘½åç©ºé—´ï¼Œæ ¼å¼ä¸º db.collection</span></span><br><span class=\"line\">      redacted: <span class=\"literal\">false</span>, <span class=\"comment\"># æ˜¯å¦å·²è„±æ•</span></span><br><span class=\"line\">      <span class=\"built_in\">command</span>: &#123; <span class=\"comment\"># æ“ä½œå‘½ä»¤å‚æ•°</span></span><br><span class=\"line\">        hello: 1,</span><br><span class=\"line\">        maxAwaitTimeMS: 10000,</span><br><span class=\"line\">        topologyVersion: &#123;</span><br><span class=\"line\">          processId: ObjectId(<span class=\"string\">&#x27;6611f8cd59f7cfaa5c8cd7e4&#x27;</span>),</span><br><span class=\"line\">          counter: Long(<span class=\"string\">&#x27;18&#x27;</span>)</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        <span class=\"string\">&#x27;$clusterTime&#x27;</span>: &#123;</span><br><span class=\"line\">          clusterTime: Timestamp(&#123; t: 1712470998, i: 1 &#125;),</span><br><span class=\"line\">          signature: &#123;</span><br><span class=\"line\">            <span class=\"built_in\">hash</span>: Binary.createFromBase64(<span class=\"string\">&#x27;gvgo03Wqi1AuOVqnrlhzKIK2NAU=&#x27;</span>, 0),</span><br><span class=\"line\">            keyId: Long(<span class=\"string\">&#x27;7346062378896719877&#x27;</span>)</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        <span class=\"string\">&#x27;$db&#x27;</span>: <span class=\"string\">&#x27;admin&#x27;</span></span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      numYields: 0,</span><br><span class=\"line\">      locks: &#123;&#125;, <span class=\"comment\"># å½“å‰æ“ä½œæŒæœ‰é”çš„ç±»å‹å’Œæ¨¡å¼ã€‚</span></span><br><span class=\"line\">      waitingForLock: <span class=\"literal\">false</span>, <span class=\"comment\"># æ˜¯å¦åœ¨ç­‰å¾…é”</span></span><br><span class=\"line\">      lockStats: &#123;&#125;, <span class=\"comment\"># å½“å‰æ“ä½œæŒæœ‰é”çš„ç»Ÿè®¡ã€‚</span></span><br><span class=\"line\">      waitingForFlowControl: <span class=\"literal\">false</span>,</span><br><span class=\"line\">      flowControlStats: &#123;&#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦</span><br><span class=\"line\">]</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹ç­‰å¾…é”çš„å¢åŠ ã€åˆ é™¤ã€ä¿®æ”¹ã€æŸ¥è¯¢æ“ä½œ</span></span><br><span class=\"line\">&gt; db.currentOp(&#123;</span><br><span class=\"line\"> waitingForLock:<span class=\"literal\">true</span>,</span><br><span class=\"line\"> <span class=\"variable\">$or</span>:[</span><br><span class=\"line\">  &#123;op:&#123;<span class=\"variable\">$in</span>:[<span class=\"string\">&quot;insert&quot;</span>,<span class=\"string\">&quot;update&quot;</span>,<span class=\"string\">&quot;remove&quot;</span>]&#125;&#125;,</span><br><span class=\"line\">  &#123;<span class=\"string\">&quot;query.findandmodify&quot;</span>:&#123;<span class=\"variable\">$exists</span>:<span class=\"literal\">true</span>&#125;&#125;</span><br><span class=\"line\">  ]</span><br><span class=\"line\"> &#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹æ‰§è¡Œæ—¶é—´è¶…è¿‡1sçš„æ“ä½œ</span></span><br><span class=\"line\">&gt; db.currentOp(&#123;</span><br><span class=\"line\">   secs_running:&#123;<span class=\"variable\">$gt</span>:1&#125;</span><br><span class=\"line\"> &#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹testæ•°æ®åº“ä¸­çš„æ“ä½œ</span></span><br><span class=\"line\">&gt; db.currentOp(&#123;</span><br><span class=\"line\">   ns:/test/</span><br><span class=\"line\"> &#125;)</span><br></pre></td></tr></table></figure>","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç»MongoDB7.0çš„ä¸€äº›æœ‰ç”¨çš„åŠŸèƒ½ï¼Œæ¯”å¦‚è¿è¡Œjsï¼ŒæŸ¥çœ‹æ…¢æŸ¥è¯¢æ—¥å¿—ç­‰ç­‰ MongoDBå®˜æ–¹æ–‡æ¡£ æœ¬æ–‡åŸºäºCentOS8(x86_64) è¿è¡Œjs è¿è¡Œjsæ–‡ä»¶ insertMany.js 1234567891011121314151617var tags = [&#x27;nosql&#x27;, &#x27;mongodb&#x27;, &#x27;document&#x27;, &#x27;developer&#x27;, &#x27;popular&#x27;]var types = [&#x27;technology&#x27;, &#x27;sociality&#x27;, &#x27;travel&#x27;, &#x27;novel&#x27;, &#x27;literature&#x27;]var books = []for (var i = 0; i &lt; 50; i++) &#123; var typeIdx = Math.floor(Math.random() * types.length) var tagIdx = Math.floor(Math.random() * tags.length) var favCount = Math.floor(Math.random() * 100) var book = &#123; title: &#x27;book-&#x27; + i, type: types[typeIdx], tag: tags[tagIdx], favCount: favCount, author: &#x27;xxx&#x27; + i &#125; books.push(book)&#125;db.books.insertMany(books) 12# -f è¿è¡Œjsæ–‡ä»¶mongosh &quot;mongodb://user:password@10.1.2.26:27017,10.1.2.142:27017,10.1.2.41:27017/test?authSource=admin&amp;replicaSet=rs0&quot; -f insertMany.js è¿è¡Œjsè¯­å¥ 1234567891011121314151617181920# ---eval è¿è¡Œjsè¯­å¥mongosh &quot;mongodb://user:password@10.1.2.26:27017,10.1.2.142:27017,10.1.2.41:27017/test?authSource=admin&amp;replicaSet=rs0&quot; --eval &quot;db.books.find().limit(2)&quot;[ &#123; _id: ObjectId(&#x27;660d0b05a8a6c09b0b1852b7&#x27;), title: &#x27;book-0&#x27;, type: &#x27;novel&#x27;, tag: &#x27;document&#x27;, favCount: 58, author: &#x27;xxx0&#x27; &#125;, &#123; _id: ObjectId(&#x27;660d0b05a8a6c09b0b1852b8&#x27;), title: &#x27;book-1&#x27;, type: &#x27;novel&#x27;, tag: &#x27;popular&#x27;, favCount: 10, author: &#x27;xxx1&#x27; &#125;] Profileræ¨¡å— Profileræ¨¡å—å¯ä»¥ç”¨æ¥è®°å½•ã€åˆ†æMongoDBçš„è¯¦ç»†æ“ä½œæ—¥å¿—ï¼Œé»˜è®¤æƒ…å†µä¸‹è¯¥åŠŸèƒ½æ˜¯å…³é—­çš„ã€‚ Profileræ¨¡å—å¼€å¯å¯¹äºæ¯ä¸ªä¸šåŠ¡åº“æ¥è¯´æ˜¯ç‹¬ç«‹çš„ï¼Œå¯¹æŸä¸ªä¸šåŠ¡åº“å¼€å¯Profileræ¨¡å—ä¹‹åï¼Œç¬¦åˆæ¡ä»¶çš„æ…¢æ“ä½œæ—¥å¿—ä¼šè¢«å†™å…¥è¯¥åº“çš„system.profileé›†åˆä¸­ã€‚ Profileræ¨¡å—çš„è°ƒè¯•çº§åˆ«æœ‰ï¼š 1230ï¼šå…³é—­Profileræ¨¡å—ï¼›1ï¼šéƒ¨åˆ†å¼€å¯ï¼Œä»…ç¬¦åˆæ¡ä»¶ï¼ˆæ—¶é•¿å¤§äºslowmsï¼‰çš„æ“ä½œæ—¥å¿—ä¼šè¢«è®°å½•ï¼›2ï¼šæ—¥å¿—å…¨å¼€ï¼Œæ‰€æœ‰çš„æ“ä½œæ—¥å¿—éƒ½è¢«è®°å½•ï¼› è®¾ç½®Profileræ¨¡å—çš„è°ƒè¯•çº§åˆ«ï¼š 123456789101112131415161718192021222324252627# è®¾ç½®Profileræ¨¡å—çš„è°ƒè¯•çº§åˆ«ä¸º2&gt; db.setProfilingLevel(2)# æŸ¥çœ‹å½“çš„è°ƒè¯•çº§åˆ«ä¿¡æ¯&gt; db.getProfilingStatus()&#123; was: 2, # å½“å‰çš„è°ƒè¯•çº§åˆ« slowms: 100, # æ…¢æŸ¥è¯¢çš„é˜ˆå€¼ï¼Œå•ä½æ˜¯æ¯«ç§’ï¼› sampleRate: 1.0, # æ—¥å¿—éšæœºé‡‡æ ·ç‡ï¼Œ1.0åˆ™è¡¨ç¤ºæ»¡è¶³æ¡ä»¶çš„å…¨éƒ¨è¾“å‡ºã€‚ ok: 1, # çŠ¶æ€ &#x27;$clusterTime&#x27;: &#123; # æ—¶é—´æˆ³ clusterTime: Timestamp(&#123; t: 1712471779, i: 1 &#125;), # æ—¶é—´æˆ³ signature: &#123; # ç­¾å hash: Binary.createFromBase64(&#x27;GGCAjzJrW8arhfJX0Cn0VpvC5MA=&#x27;, 0), # ç­¾å keyId: Long(&#x27;7346062378896719877&#x27;) # ç­¾å &#125; &#125;, operationTime: Timestamp(&#123; t: 1712471779, i: 1 &#125;) # æ“ä½œæ—¶é—´&#125;# åªè®°å½•æ—¶é•¿è¶…è¿‡500msçš„æ“ä½œ&gt; db.setProfilingLevel(1,500)# åŒæ—¶åŠ ä¸Šé‡‡æ ·ç‡&gt; db.setProfilingLevel(1,&#123;slowms:500,sampleRate:0.5&#125;)# å…³é—­Profileræ¨¡å—&gt; db.setProfilingLevel(2) æŸ¥çœ‹æ—¥å¿— 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869# æŸ¥çœ‹æ“ä½œæ—¥å¿—&gt; db.system.profile.find().limit(5).sort(&#123;ts:-1&#125;).pretty()[ &#123; op: &#x27;query&#x27;, # æ“ä½œç±»å‹,æ¯”å¦‚æŸ¥è¯¢,æ›´æ–°,åˆ é™¤ç­‰ ns: &#x27;admin.system.profile&#x27;, # æ“ä½œçš„é›†åˆ command: &#123; # æ“ä½œçš„å‘½ä»¤ find: &#x27;system.profile&#x27;, # æ“ä½œçš„é›†åˆ filter: &#123;&#125;, # æŸ¥è¯¢æ¡ä»¶ lsid: &#123; id: UUID(&#x27;2285d6a5-b2df-4b46-b9d2-5e556b0a7c7d&#x27;) &#125;, # ä¼šè¯id &#x27;$clusterTime&#x27;: &#123; # æ—¶é—´æˆ³ clusterTime: Timestamp(&#123; t: 1712471018, i: 1 &#125;), signature: &#123; hash: Binary.createFromBase64(&#x27;8YEsN+XUWO6EkoHEegKkG49eWPA=&#x27;, 0), keyId: Long(&#x27;7346062378896719877&#x27;) &#125; &#125;, &#x27;$db&#x27;: &#x27;admin&#x27;, # æ•°æ®åº“ &#x27;$readPreference&#x27;: &#123; mode: &#x27;primaryPreferred&#x27; &#125; # è¯»åå¥½ &#125;, keysExamined: 0, # æ‰«æç´¢å¼•æ¡ç›®æ•°ï¼Œå¦‚æœæ¯”nreturnedå¤§å‡ºå¾ˆå¤šï¼Œåˆ™è¯´æ˜æŸ¥è¯¢æ•ˆç‡ä¸é«˜ã€‚ docsExamined: 3, # æ‰«ææ–‡æ¡£æ¡ç›®æ•°ï¼Œå¦‚æœæ¯”nreturnedå¤§å‡ºå¾ˆå¤šï¼Œåˆ™è¯´æ˜æŸ¥è¯¢æ•ˆç‡ä¸é«˜ã€‚ nBatches: 1, # æ‰¹å¤„ç†æ•°é‡ cursorExhausted: true, # æ˜¯å¦æ¸¸æ ‡å·²è€—å°½ numYield: 0, # æ“ä½œæ•°ï¼Œå¤§äº0è¡¨ç¤ºç­‰å¾…é”æˆ–è€…æ˜¯ç£ç›˜I/Oæ“ä½œ nreturned: 3, # è¿”å›çš„æ–‡æ¡£æ•°é‡ queryHash: &#x27;8880B5AF&#x27;, # æŸ¥è¯¢å“ˆå¸Œå€¼ planCacheKey: &#x27;8880B5AF&#x27;, queryFramework: &#x27;classic&#x27;, locks: &#123; # é”å ç”¨çš„æƒ…å†µã€‚ FeatureCompatibilityVersion: &#123; acquireCount: &#123; r: Long(&#x27;1&#x27;) &#125; &#125;, Global: &#123; acquireCount: &#123; r: Long(&#x27;1&#x27;) &#125; &#125; &#125;, flowControl: &#123;&#125;, readConcern: &#123; level: &#x27;local&#x27;, provenance: &#x27;implicitDefault&#x27; &#125;, # è¯»å…³æ³¨ responseLength: 3414, # å“åº”æ•°æ®å¤§å°ï¼ˆå­—èŠ‚æ•°ï¼‰ï¼Œä¸€æ¬¡æ€§æŸ¥è¯¢å¤ªå¤šçš„æ•°æ®ä¼šå½±å“æ€§èƒ½ï¼Œå¯ä»¥ä½¿ç”¨limitã€batchSizeè¿›è¡Œä¸€äº›é™åˆ¶ã€‚ protocol: &#x27;op_msg&#x27;, # åè®®ç±»å‹ï¼Œop_msgæ˜¯mongodb 4.0+çš„åè®®ï¼Œop_queryæ˜¯mongodb 3.2åŠä»¥å‰ç‰ˆæœ¬çš„åè®®ã€‚ millis: 0, # å‘½ä»¤æ‰§è¡Œçš„æ—¶é•¿ï¼Œå•ä½æ˜¯æ¯«ç§’ã€‚ planSummary: &#x27;COLLSCAN&#x27;, # æŸ¥è¯¢è®¡åˆ’çš„æ¦‚è¦ï¼Œå¦‚IXSCANè¡¨ç¤ºä½¿ç”¨äº†ç´¢å¼•æ‰«æã€‚ planningTimeMicros: 79, execStats: &#123; # æ‰§è¡Œè¿‡ç¨‹ç»Ÿè®¡ä¿¡æ¯ã€‚ stage: &#x27;COLLSCAN&#x27;, nReturned: 3, executionTimeMillisEstimate: 0, works: 4, advanced: 3, needTime: 0, needYield: 0, saveState: 0, restoreState: 0, isEOF: 1, direction: &#x27;forward&#x27;, docsExamined: 3 &#125;, ts: ISODate(&#x27;2024-04-07T06:23:56.054Z&#x27;), # å‘½ä»¤æ‰§è¡Œçš„æ—¶é—´ç‚¹ã€‚ client: &#x27;127.0.0.1&#x27;, # å®¢æˆ·ç«¯åœ°å€ã€‚ appName: &#x27;mongosh 2.1.5&#x27;, # å®¢æˆ·ç«¯åç§°ã€‚ allUsers: [ &#123; user: &#x27;user&#x27;, db: &#x27;admin&#x27; &#125; ], # æ‰€æœ‰ç”¨æˆ·ä¿¡æ¯ã€‚ user: &#x27;user@admin&#x27; # å½“å‰ç”¨æˆ·ä¿¡æ¯ã€‚ &#125;â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦]# æŸ¥çœ‹æ‰§è¡Œæ—¶é•¿æœ€å¤§çš„10æ¡æ“ä½œè®°å½•&gt; db.system.profile.find().limit(10).sort(&#123;millis:-1&#125;).pretty()# æŸ¥çœ‹æŸä¸ªé›†åˆä¸­çš„updateæ“ä½œæ—¥å¿—&gt; db.system.profile.find(&#123;op:&quot;update&quot;,ns:&quot;shop.user&quot;&#125;) system.profileæ˜¯ä¸€ä¸ª1MBçš„å›ºå®šå¤§å°çš„é›†åˆï¼Œéšç€è®°å½•æ—¥å¿—çš„å¢å¤šï¼Œä¸€äº›æ—§çš„è®°å½•ä¼šè¢«æ»šåŠ¨åˆ é™¤ã€‚ Profileræ¨¡å—çš„è®¾ç½®æ˜¯å†…å­˜çº§çš„ï¼Œé‡å¯æœåŠ¡å™¨åä¼šè‡ªåŠ¨æ¢å¤é»˜è®¤çŠ¶æ€ã€‚ db.currentOp() Profileræ¨¡å—æ‰€è®°å½•çš„æ—¥å¿—éƒ½æ˜¯å·²ç»å‘ç”Ÿçš„äº‹æƒ…ï¼Œdb.currentOp()å‘½ä»¤åˆ™ä¸æ­¤ç›¸åï¼Œå®ƒå¯ä»¥ç”¨æ¥æŸ¥çœ‹æ•°æ®åº“å½“å‰æ­£åœ¨æ‰§è¡Œçš„ä¸€äº›æ“ä½œã€‚ db.currentOp()è¯»å–çš„æ˜¯å½“å‰æ•°æ®åº“çš„å‘½ä»¤å¿«ç…§ï¼Œè¯¥å‘½ä»¤å¯ä»¥è¿”å›è®¸å¤šæœ‰ç”¨çš„ä¿¡æ¯ï¼Œæ¯”å¦‚ï¼š 123æ“ä½œçš„è¿è¡Œæ—¶é•¿ï¼Œå¿«é€Ÿå‘ç°è€—æ—¶æ¼«é•¿çš„ä½æ•ˆæ‰«ææ“ä½œã€‚æ‰§è¡Œè®¡åˆ’ä¿¡æ¯ï¼Œç”¨äºåˆ¤æ–­æ˜¯å¦å‘½ä¸­äº†ç´¢å¼•ï¼Œæˆ–è€…å­˜åœ¨é”å†²çªçš„æƒ…å†µã€‚æ“ä½œIDã€æ—¶é—´ã€å®¢æˆ·ç«¯ç­‰ä¿¡æ¯ï¼Œæ–¹ä¾¿å®šä½å‡ºäº§ç”Ÿæ…¢æ“ä½œçš„æºå¤´ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677&gt; db.currentOp()&#123;inprog: [ # å½“å‰æ­£åœ¨æ‰§è¡Œçš„æ“ä½œ &#123; type: &#x27;op&#x27;, # æ“ä½œç±»å‹ï¼Œå¯ä»¥æ˜¯opã€idleSessionã€idleCursorçš„ä¸€ç§ï¼Œä¸€èˆ¬çš„æ“ä½œä¿¡æ¯ä»¥opè¡¨ç¤ºã€‚å…¶ä¸ºMongoDB 4.2ç‰ˆæœ¬æ–°å¢åŠŸèƒ½ host: &#x27;localhost:27041&#x27;, # æ“ä½œæ‰€åœ¨çš„ä¸»æœº desc: &#x27;conn474&#x27;, # æ“ä½œçš„æè¿°ä¿¡æ¯ connectionId: 474, # æ“ä½œçš„è¿æ¥ID client: &#x27;127.0.0.1:58103&#x27;, # æ“ä½œçš„å®¢æˆ·ç«¯ä¿¡æ¯ appName: &#x27;mongosh 2.1.5&#x27;, # æ“ä½œçš„å®¢æˆ·ç«¯åº”ç”¨ä¿¡æ¯ clientMetadata: &#123; # å…³äºå®¢æˆ·ç«¯çš„é™„åŠ ä¿¡æ¯ï¼Œå¯ä»¥åŒ…å«é©±åŠ¨çš„ç‰ˆæœ¬ã€‚ application: &#123; name: &#x27;mongosh 2.1.5&#x27; &#125;, driver: &#123; name: &#x27;nodejs|mongosh&#x27;, version: &#x27;6.3.0|2.1.5&#x27; &#125;, platform: &#x27;Node.js v20.11.1, LE&#x27;, os: &#123; name: &#x27;darwin&#x27;, architecture: &#x27;x64&#x27;, version: &#x27;22.6.0&#x27;, type: &#x27;Darwin&#x27; &#125; &#125;, active: true, # æ“ä½œæ˜¯å¦æ´»è·ƒã€‚å¦‚æœæ˜¯ç©ºé—²çŠ¶æ€åˆ™ä¸ºfalse currentOpTime: &#x27;2024-04-07T14:54:02.994+08:00&#x27;, # æ“ä½œçš„å¼€å§‹æ—¶é—´ã€‚MongoDB 3.6ç‰ˆæœ¬æ–°å¢åŠŸèƒ½ threaded: true, opid: 236247, # opidï¼šå½“å‰æ“ä½œåœ¨æ•°æ®åº“è¿›ç¨‹ä¸­çš„å”¯ä¸€ç¼–å·,å¦‚æœå·²ç»å‘ç°è¯¥æ“ä½œæ­£åœ¨å¯¼è‡´æ•°æ®åº“ç³»ç»Ÿå“åº”ç¼“æ…¢ï¼Œåˆ™å¯ä»¥è€ƒè™‘å°†å…¶â€œæ€â€æ­» : db.killOp(236247) secs_running: Long(&#x27;3&#x27;), # æ“ä½œæŒç»­æ—¶é—´,å•ä½ï¼šç§’ microsecs_running: Long(&#x27;3362378&#x27;), # æ“ä½œæŒç»­æ—¶é—´ï¼Œå•ä½ï¼šå¾®ç§’ op: &#x27;command&#x27;, # æ ‡è¯†æ“ä½œç±»å‹çš„å­—ç¬¦ä¸²ï¼Œå¦‚ command, insert, query, update, delete, getMore, killCursors ns: &#x27;admin.$cmd&#x27;, # æ“ä½œçš„å‘½åç©ºé—´ï¼Œæ ¼å¼ä¸º db.collection redacted: false, # æ˜¯å¦å·²è„±æ• command: &#123; # æ“ä½œå‘½ä»¤å‚æ•° hello: 1, maxAwaitTimeMS: 10000, topologyVersion: &#123; processId: ObjectId(&#x27;6611f8cd59f7cfaa5c8cd7e4&#x27;), counter: Long(&#x27;18&#x27;) &#125;, &#x27;$clusterTime&#x27;: &#123; clusterTime: Timestamp(&#123; t: 1712470998, i: 1 &#125;), signature: &#123; hash: Binary.createFromBase64(&#x27;gvgo03Wqi1AuOVqnrlhzKIK2NAU=&#x27;, 0), keyId: Long(&#x27;7346062378896719877&#x27;) &#125; &#125;, &#x27;$db&#x27;: &#x27;admin&#x27; &#125;, numYields: 0, locks: &#123;&#125;, # å½“å‰æ“ä½œæŒæœ‰é”çš„ç±»å‹å’Œæ¨¡å¼ã€‚ waitingForLock: false, # æ˜¯å¦åœ¨ç­‰å¾…é” lockStats: &#123;&#125;, # å½“å‰æ“ä½œæŒæœ‰é”çš„ç»Ÿè®¡ã€‚ waitingForFlowControl: false, flowControlStats: &#123;&#125; &#125;â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦]&#125;# æŸ¥çœ‹ç­‰å¾…é”çš„å¢åŠ ã€åˆ é™¤ã€ä¿®æ”¹ã€æŸ¥è¯¢æ“ä½œ&gt; db.currentOp(&#123; waitingForLock:true, $or:[ &#123;op:&#123;$in:[&quot;insert&quot;,&quot;update&quot;,&quot;remove&quot;]&#125;&#125;, &#123;&quot;query.findandmodify&quot;:&#123;$exists:true&#125;&#125; ] &#125;)# æŸ¥çœ‹æ‰§è¡Œæ—¶é—´è¶…è¿‡1sçš„æ“ä½œ&gt; db.currentOp(&#123; secs_running:&#123;$gt:1&#125; &#125;)# æŸ¥çœ‹testæ•°æ®åº“ä¸­çš„æ“ä½œ&gt; db.currentOp(&#123; ns:/test/ &#125;)","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç»MongoDB7.0çš„ä¸€äº›æœ‰ç”¨çš„åŠŸèƒ½ï¼Œæ¯”å¦‚è¿è¡Œjsï¼ŒæŸ¥çœ‹æ…¢æŸ¥è¯¢æ—¥å¿—ç­‰ç­‰ MongoDBå®˜æ–¹æ–‡æ¡£ æœ¬æ–‡åŸºäºCentOS8(x86_64)","date_published":"2024-04-07T13:30:05.000Z","tags":["æŠ€æœ¯","linux","mongodb","mongodb"]},{"id":"https://blog.hanqunfeng.com/2024/04/03/mongodb7-tools/","url":"https://blog.hanqunfeng.com/2024/04/03/mongodb7-tools/","title":"MongoDB Command Line Database Tools","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç»Linuxä¸‹MongoDB Command Line Database Toolsçš„å®‰è£…ä¸ä½¿ç”¨</p>\n</li>\n<li class=\"lvl-2\">\n<p>MongoDB Command Line Database Tools<a href=\"https://www.mongodb.com/docs/database-tools/\">å®˜æ–¹æ–‡æ¡£</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡åŸºäº<code>CentOS8(x86_64)</code></p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"MongoDB-Database-Tools\">MongoDB Database Tools</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>MongoDB Database Toolsæ˜¯MongoDBå®˜æ–¹æä¾›çš„æ•°æ®åº“ç®¡ç†å·¥å…·ï¼Œå¯ä»¥ç”¨äºç®¡ç†MongoDBæ•°æ®åº“ï¼ŒåŒ…æ‹¬MongoDBçš„å¤‡ä»½ã€æ¢å¤ã€ç›‘æ§ç­‰åŠŸèƒ½ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://www.mongodb.com/try/download/database-tools\">MongoDB Database Toolsçš„ä¸‹è½½åœ°å€</a></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ä¸‹è½½å®‰è£…åŒ…</span></span><br><span class=\"line\">wget https://fastdl.mongodb.org/tools/db/mongodb-database-tools-rhel80-x86_64-100.9.4.tgz</span><br><span class=\"line\"><span class=\"comment\"># è§£å‹å®‰è£…åŒ…</span></span><br><span class=\"line\">tar -xvzf mongodb-database-tools-rhel80-x86_64-100.9.4.tgz</span><br><span class=\"line\"><span class=\"comment\"># åˆ›å»ºè½¯è¿æ¥</span></span><br><span class=\"line\"><span class=\"built_in\">ln</span> -s mongodb-database-tools-rhel80-x86_64-100.9.4 /mongodb/tools</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åœ¨/etc/profileæ–‡ä»¶ä¸­é…ç½®PATHç¯å¢ƒå˜é‡</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> PATH=/mongodb/tools/bin:<span class=\"variable\">$PATH</span></span><br><span class=\"line\"><span class=\"comment\"># ä½¿é…ç½®ç”Ÿæ•ˆ</span></span><br><span class=\"line\"><span class=\"built_in\">source</span> /etc/profile</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>MongoDB Database Toolså¸¸ç”¨å‘½ä»¤ï¼Œè¯¦ç»†çš„ä½¿ç”¨æ–¹æ³•è¯·æŸ¥çœ‹<a href=\"https://www.mongodb.com/docs/database-tools/\">å®˜æ–¹æ–‡æ¡£</a></p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>æ–‡ä»¶åç§°</th>\n<th>ä½œç”¨</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>mongostat</td>\n<td>æ•°æ®åº“æ€§èƒ½ç›‘æ§å·¥å…·</td>\n</tr>\n<tr>\n<td>mongotop</td>\n<td>çƒ­ç‚¹è¡¨ç›‘æ§å·¥å…·</td>\n</tr>\n<tr>\n<td>mongodump</td>\n<td>æ•°æ®åº“é€»è¾‘å¤‡ä»½å·¥å…·</td>\n</tr>\n<tr>\n<td>mongorestore</td>\n<td>æ•°æ®åº“é€»è¾‘æ¢å¤å·¥å…·</td>\n</tr>\n<tr>\n<td>mongoexport</td>\n<td>æ•°æ®å¯¼å‡ºå·¥å…·</td>\n</tr>\n<tr>\n<td>mongoimport</td>\n<td>æ•°æ®å¯¼å…¥å·¥å…·</td>\n</tr>\n<tr>\n<td>bsondump</td>\n<td>BSONæ ¼å¼è½¬æ¢å·¥å…·</td>\n</tr>\n<tr>\n<td>mongofiles</td>\n<td>GridFSæ–‡ä»¶å·¥å…·</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"mongoexport-å¯¼å‡ºæ•°æ®\">mongoexport: å¯¼å‡ºæ•°æ®</h2>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å¯¼å‡ºcsvæ ¼å¼çš„æ•°æ®</span></span><br><span class=\"line\">mongoexport <span class=\"string\">&quot;mongodb://user:password@10.1.2.26:27017,10.1.2.142:27017,10.1.2.41:27017/?authSource=admin&amp;replicaSet=rs0&quot;</span> -d <span class=\"built_in\">test</span> -c books -f _id,title,<span class=\"built_in\">type</span>,tag --<span class=\"built_in\">type</span>=csv -o books.csv</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å¯¼å‡ºjsonæ ¼å¼çš„æ•°æ®</span></span><br><span class=\"line\">mongoexport <span class=\"string\">&quot;mongodb://user:password@10.1.2.26:27017,10.1.2.142:27017,10.1.2.41:27017/?authSource=admin&amp;replicaSet=rs0&quot;</span> -d <span class=\"built_in\">test</span> -c books -f _id,title,<span class=\"built_in\">type</span>,tag --<span class=\"built_in\">type</span>=json -o books.json</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å‚æ•°è¯´æ˜</span></span><br><span class=\"line\">-d æŒ‡å®šæ•°æ®åº“</span><br><span class=\"line\">-c æŒ‡å®šé›†åˆ</span><br><span class=\"line\">-f æŒ‡å®šå¯¼å‡ºå­—æ®µï¼Œcsvæ ¼å¼éœ€è¦æŒ‡å®šå­—æ®µï¼Œjsonæ ¼å¼å¯ä»¥ä¸æŒ‡å®šå­—æ®µï¼Œé»˜è®¤å¯¼å‡ºå…¨éƒ¨</span><br><span class=\"line\">--<span class=\"built_in\">type</span>=csv/json æŒ‡å®šå¯¼å‡ºæ ¼å¼</span><br><span class=\"line\">-o æŒ‡å®šå¯¼å‡ºæ–‡ä»¶</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å¯¼å‡ºæ—¶å¯ä»¥å¢åŠ è¿‡æ»¤æ¡ä»¶</span></span><br><span class=\"line\">mongoexport <span class=\"string\">&quot;mongodb://user:password@10.1.2.26:27017,10.1.2.142:27017,10.1.2.41:27017?authSource=admin&amp;replicaSet=rs0&quot;</span> -d mydb -c user --<span class=\"built_in\">type</span>=json -o user.json  --<span class=\"built_in\">limit</span>=10 --skip=2 --<span class=\"built_in\">sort</span>=<span class=\"string\">&#x27;&#123;&quot;name&quot;:1&#125;&#x27;</span> --query=<span class=\"string\">&#x27;&#123;&quot;age&quot;:&#123;&quot;$gt&quot;:25&#125;,&quot;name&quot;:&quot;zhangsan&quot;&#125;&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å‚æ•°è¯´æ˜</span></span><br><span class=\"line\">--<span class=\"built_in\">limit</span>=10 æŒ‡å®šå¯¼å‡ºæ¡æ•°</span><br><span class=\"line\">--skip=2 æŒ‡å®šè·³è¿‡æ¡æ•°</span><br><span class=\"line\">--<span class=\"built_in\">sort</span>=<span class=\"string\">&#x27;&#123;&quot;name&quot;:1&#125;&#x27;</span> æŒ‡å®šæ’åºå­—æ®µ</span><br><span class=\"line\">--query=<span class=\"string\">&#x27;&#123;&quot;age&quot;:&#123;&quot;$gt&quot;:25&#125;,&quot;name&quot;:&quot;zhangsan&quot;&#125;&#x27;</span> æŒ‡å®šæŸ¥è¯¢æ¡ä»¶ï¼Œæ³¨æ„è¿™é‡Œçš„æŸ¥è¯¢æ¡ä»¶æ˜¯jsonæ ¼å¼ï¼Œå­—æ®µåéœ€è¦ä½¿ç”¨åŒå¼•å·åŒ…è£¹</span><br></pre></td></tr></table></figure>\n<h2 id=\"mongoimport-å¯¼å…¥æ•°æ®\">mongoimport: å¯¼å…¥æ•°æ®</h2>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å¯¼å…¥csvæ ¼å¼çš„æ•°æ®</span></span><br><span class=\"line\"><span class=\"comment\"># æ³¨æ„æ­¤æ—¶å¯¼å…¥çš„csvæ–‡ä»¶ä¸­ç¬¬ä¸€è¡Œå¦‚æœæ˜¯å­—æ®µåï¼Œéœ€è¦å…ˆåˆ é™¤ç¬¬ä¸€è¡Œå†å¯¼å…¥ï¼Œè¿™é‡Œä½¿ç”¨äº† -f æŒ‡å®šå­—æ®µï¼Œæ¥å’Œå¯¼å…¥çš„csvæ–‡ä»¶çš„åˆ—ä¸€ä¸€å¯¹åº”</span></span><br><span class=\"line\">mongoimport <span class=\"string\">&quot;mongodb://user:password@10.1.2.26:27017,10.1.2.142:27017,10.1.2.41:27017/?authSource=admin&amp;replicaSet=rs0&quot;</span> -d <span class=\"built_in\">test</span> -c books_new -f _id,title,<span class=\"built_in\">type</span>,tag --<span class=\"built_in\">type</span>=csv --file books.csv</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ³¨æ„æ­¤æ—¶å¯¼å…¥çš„csvæ–‡ä»¶ä¸­ç¬¬ä¸€è¡Œå¦‚æœæ˜¯å­—æ®µåï¼Œéœ€è¦å…ˆåˆ é™¤ç¬¬ä¸€è¡Œå†å¯¼å…¥ï¼Œè¿™é‡Œä½¿ç”¨äº† -f æŒ‡å®šå­—æ®µï¼Œæ¥å’Œå¯¼å…¥çš„csvæ–‡ä»¶çš„åˆ—ä¸€ä¸€å¯¹åº”</span></span><br><span class=\"line\">mongoimport <span class=\"string\">&quot;mongodb://user:password@10.1.2.26:27017,10.1.2.142:27017,10.1.2.41:27017/?authSource=admin&amp;replicaSet=rs0&quot;</span> -d <span class=\"built_in\">test</span> -c books_new --headerline --<span class=\"built_in\">type</span>=csv --file books.csv</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å¯¼å…¥jsonæ ¼å¼çš„æ•°æ®</span></span><br><span class=\"line\">mongoimport <span class=\"string\">&quot;mongodb://user:password@10.1.2.26:27017,10.1.2.142:27017,10.1.2.41:27017/?authSource=admin&amp;replicaSet=rs0&quot;</span> -d <span class=\"built_in\">test</span> -c books_new --<span class=\"built_in\">type</span>=json --file books.json</span><br><span class=\"line\"></span><br><span class=\"line\">-d æŒ‡å®šæ•°æ®åº“</span><br><span class=\"line\">-c æŒ‡å®šé›†åˆ</span><br><span class=\"line\">-f æŒ‡å®šå¯¼å…¥å­—æ®µï¼Œcsvæ ¼å¼éœ€è¦æŒ‡å®šå­—æ®µ</span><br><span class=\"line\">--headerline æŒ‡å®šç¬¬ä¸€è¡Œæ˜¯å­—æ®µå</span><br><span class=\"line\">--<span class=\"built_in\">type</span>=csv/json æŒ‡å®šå¯¼å…¥æ ¼å¼</span><br><span class=\"line\">--file æŒ‡å®šå¯¼å…¥æ–‡ä»¶</span><br><span class=\"line\">--mode æŒ‡å®šå¯¼å…¥æ–¹å¼ï¼Œé»˜è®¤æ˜¯insertï¼Œè¿˜å¯ä»¥æ˜¯upsertï¼Œmergeï¼Œdelete</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>modeè¯´æ˜</p>\n</blockquote>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>insert: é»˜è®¤å€¼ï¼Œå¦‚æœæ•°æ®ä¸å­˜åœ¨ï¼Œåˆ™æ’å…¥ï¼Œå¦‚æœå­˜åœ¨ï¼Œåˆ™æŠ¥é”™</p>\n</li>\n<li class=\"lvl-2\">\n<p>upsert: å¦‚æœæ•°æ®ä¸å­˜åœ¨ï¼Œåˆ™æ’å…¥ï¼Œå¦‚æœå­˜åœ¨ï¼Œåˆ™æ›´æ–°</p>\n</li>\n<li class=\"lvl-2\">\n<p>merge: å¦‚æœæ•°æ®ä¸å­˜åœ¨ï¼Œåˆ™æ’å…¥ï¼Œå¦‚æœå­˜åœ¨ï¼Œåˆ™åˆå¹¶åæ›´æ–°</p>\n</li>\n<li class=\"lvl-2\">\n<p>delete: å¦‚æœæ•°æ®ä¸å­˜åœ¨ï¼Œä¹Ÿä¸æ‰§è¡Œæ’å…¥ï¼Œå¦‚æœå­˜åœ¨ï¼Œåˆ™åˆ é™¤</p>\n</li>\n</ul>\n<h2 id=\"mongostat-æ•°æ®åº“æ€§èƒ½ç›‘æ§\">mongostat: æ•°æ®åº“æ€§èƒ½ç›‘æ§</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>mongostatå‘½ä»¤ç”¨äºå®æ—¶ç›‘æ§MongoDBæ•°æ®åº“çš„æ€§èƒ½ï¼ŒåŒ…æ‹¬è¿æ¥æ•°ã€æ–‡æ¡£æ•°ã€ç´¢å¼•æ•°ã€å†…å­˜ä½¿ç”¨æƒ…å†µç­‰ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ç›‘æ§20æ¬¡ï¼Œé—´éš”1ç§’</span></span><br><span class=\"line\">mongostat <span class=\"string\">&quot;mongodb://user:password@10.1.2.26:27017,10.1.2.142:27017,10.1.2.41:27017/?authSource=admin&amp;replicaSet=rs0&quot;</span> -n20 1</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å‚æ•°è¯´æ˜</span></span><br><span class=\"line\">-n æŒ‡å®šç›‘æ§æ¬¡æ•°</span><br><span class=\"line\">1 æŒ‡å®šç›‘æ§é—´éš”æ—¶é—´ï¼Œå•ä½ä¸ºç§’</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ç›‘æ§å®æ—¶æ•°æ®</span></span><br><span class=\"line\">host               insert query update delete getmore <span class=\"built_in\">command</span> dirty  used flushes vsize  res qrw arw net_in net_out conn <span class=\"built_in\">set</span> repl                time</span><br><span class=\"line\">10.1.2.142:27017    *0    *0     *0     *0       0     4|0     0.4%  5.0%       0 2.95G 151M 0|0 0|0  1.13k   75.2k   24 rs0  SLV Apr  3 08:37:49.405</span><br><span class=\"line\">10.1.2.26:27017     *0    *0     *0     *0       0     2|0     0.2%  3.8%       0 2.87G 138M 0|0 0|0   710b   74.3k   14 rs0  SEC Apr  3 08:37:49.385</span><br><span class=\"line\">10.1.2.41:27017     *0    *0     *0     *0       0     5|0     0.0% 17.7%       0 2.96G 184M 0|0 0|0  1.45k   75.5k   16 rs0  SEC Apr  3 08:37:49.426</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>æŒ‡æ ‡è¯´æ˜</p>\n</blockquote>\n<table>\n<thead>\n<tr>\n<th>æŒ‡æ ‡å</th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>inserts</code></td>\n<td>æ¯ç§’æ’å…¥æ•°</td>\n</tr>\n<tr>\n<td><code>query</code></td>\n<td>æ¯ç§’æŸ¥è¯¢æ•°</td>\n</tr>\n<tr>\n<td><code>update</code></td>\n<td>æ¯ç§’æ›´æ–°æ•°</td>\n</tr>\n<tr>\n<td><code>delete</code></td>\n<td>æ¯ç§’åˆ é™¤æ•°</td>\n</tr>\n<tr>\n<td><code>getmore</code></td>\n<td>æ¯ç§’getmoreæ•°</td>\n</tr>\n<tr>\n<td><code>command</code></td>\n<td>æ¯ç§’å‘½ä»¤æ•°ï¼Œæ¶µç›–äº†å†…éƒ¨çš„ä¸€äº›æ“ä½œ</td>\n</tr>\n<tr>\n<td><code>%dirty</code></td>\n<td>WiredTigerç¼“å­˜ä¸­è„æ•°æ®ç™¾åˆ†æ¯”</td>\n</tr>\n<tr>\n<td><code>%used</code></td>\n<td>WiredTiger æ­£åœ¨ä½¿ç”¨çš„ç¼“å­˜ç™¾åˆ†æ¯”</td>\n</tr>\n<tr>\n<td><code>flushes</code></td>\n<td>WiredTigeræ‰§è¡ŒCheckPointçš„æ¬¡æ•°</td>\n</tr>\n<tr>\n<td><code>vsize</code></td>\n<td>è™šæ‹Ÿå†…å­˜ä½¿ç”¨é‡</td>\n</tr>\n<tr>\n<td><code>res</code></td>\n<td>ç‰©ç†å†…å­˜ä½¿ç”¨é‡</td>\n</tr>\n<tr>\n<td><code>qrw</code></td>\n<td>å®¢æˆ·ç«¯è¯»å†™ç­‰å¾…é˜Ÿåˆ—æ•°é‡ï¼Œé«˜å¹¶å‘æ—¶ï¼Œä¸€èˆ¬é˜Ÿåˆ—å€¼ä¼šå‡é«˜</td>\n</tr>\n<tr>\n<td><code>arw</code></td>\n<td>å®¢æˆ·ç«¯è¯»å†™æ´»è·ƒä¸ªæ•°</td>\n</tr>\n<tr>\n<td><code>netIn</code></td>\n<td>ç½‘ç»œæ¥æ”¶æ•°æ®é‡</td>\n</tr>\n<tr>\n<td><code>netOut</code></td>\n<td>ç½‘ç»œå‘é€æ•°æ®é‡</td>\n</tr>\n<tr>\n<td><code>conn</code></td>\n<td>å½“å‰è¿æ¥æ•°</td>\n</tr>\n<tr>\n<td><code>set</code></td>\n<td>æ‰€å±å¤åˆ¶é›†åç§°</td>\n</tr>\n<tr>\n<td><code>repl</code></td>\n<td>å¤åˆ¶èŠ‚ç‚¹çŠ¶æ€ï¼Œå¦‚PRI(ä¸»èŠ‚ç‚¹,æˆ‘è¿™é‡Œä¸»èŠ‚ç‚¹æ˜¾ç¤ºä¸ºSLV),SEC(ä»èŠ‚ç‚¹),ARB(ä»²è£èŠ‚ç‚¹),REC(èŠ‚ç‚¹æ­£åœ¨æ¢å¤),UNK(æœªçŸ¥çŠ¶æ€),RTR(mongos)</td>\n</tr>\n<tr>\n<td><code>time</code></td>\n<td>æ—¶é—´æˆ³</td>\n</tr>\n</tbody>\n</table>\n<blockquote>\n<p>éœ€è¦é‡ç‚¹å…³æ³¨çš„æŒ‡æ ‡<br>\n1.æ’å…¥ã€åˆ é™¤ã€ä¿®æ”¹ã€æŸ¥è¯¢çš„é€Ÿç‡æ˜¯å¦äº§ç”Ÿè¾ƒå¤§æ³¢åŠ¨ï¼Œæ˜¯å¦è¶…å‡ºé¢„æœŸã€‚<br>\n2.qrwã€arwï¼šé˜Ÿåˆ—æ˜¯å¦è¾ƒé«˜ï¼Œè‹¥é•¿æ—¶é—´å¤§äº0åˆ™è¯´æ˜æ­¤æ—¶è¯»å†™é€Ÿåº¦è¾ƒæ…¢ã€‚<br>\n3.connï¼šè¿æ¥æ•°æ˜¯å¦å¤ªå¤šã€‚<br>\n4.dirtyï¼šç™¾åˆ†æ¯”æ˜¯å¦è¾ƒé«˜ï¼Œè‹¥æŒç»­é«˜äº10%åˆ™è¯´æ˜ç£ç›˜I/Oå­˜åœ¨ç“¶é¢ˆã€‚<br>\n5.netInã€netOutï¼šæ˜¯å¦è¶…è¿‡ç½‘ç»œå¸¦å®½é˜ˆå€¼ã€‚<br>\n6.replï¼šçŠ¶æ€æ˜¯å¦å¼‚å¸¸ï¼Œå¦‚PRIã€SECã€RTRä¸ºæ­£å¸¸ï¼Œè‹¥å‡ºç°RECç­‰å¼‚å¸¸å€¼åˆ™éœ€è¦ä¿®å¤ã€‚</p>\n</blockquote>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æŒ‡å®šç›‘æ§æŒ‡æ ‡ -o</span></span><br><span class=\"line\">mongostat <span class=\"string\">&quot;mongodb://user:password@10.1.2.26:27017,10.1.2.142:27017,10.1.2.41:27017/?authSource=admin&amp;replicaSet=rs0&quot;</span> -n1 1 -o=<span class=\"string\">&#x27;host,insert,query,update,delete,qrw,arw,conn,dirty,repl,version&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\">            host insert query update delete qrw arw conn dirty repl version</span><br><span class=\"line\">10.1.2.142:27017     *0    *0     *0     *0 0|0 0|0   24  0.4%  SLV   7.0.7</span><br><span class=\"line\"> 10.1.2.26:27017     *0    *0     *0     *0 0|0 0|0   14  0.2%  SEC   7.0.7</span><br><span class=\"line\"> 10.1.2.41:27017     *0    *0     *0     *0 0|0 0|0   16  0.4%  SEC   7.0.7</span><br></pre></td></tr></table></figure>\n<h2 id=\"mongotop-æŸ¥çœ‹æ•°æ®åº“æ€§èƒ½\">mongotop: æŸ¥çœ‹æ•°æ®åº“æ€§èƒ½</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>mongotopå‘½ä»¤å¯ç”¨äºæŸ¥çœ‹æ•°æ®åº“çš„çƒ­ç‚¹è¡¨ï¼Œé€šè¿‡è§‚å¯Ÿmongotopçš„è¾“å‡ºï¼Œå¯ä»¥åˆ¤å®šæ˜¯å“ªäº›é›†åˆå ç”¨äº†å¤§éƒ¨åˆ†è¯»å†™æ—¶é—´ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ç›‘æ§20æ¬¡ï¼Œé—´éš”1ç§’</span></span><br><span class=\"line\">mongotop <span class=\"string\">&quot;mongodb://user:password@10.1.2.26:27017,10.1.2.142:27017,10.1.2.41:27017/?authSource=admin&amp;replicaSet=rs0&quot;</span> -n 20 1</span><br><span class=\"line\"></span><br><span class=\"line\">                             ns    total    <span class=\"built_in\">read</span>    write    2024-04-03T09:16:53Z</span><br><span class=\"line\">                 admin.atlascli      0ms     0ms      0ms</span><br><span class=\"line\">              admin.system.keys      0ms     0ms      0ms</span><br><span class=\"line\">             admin.system.users      0ms     0ms      0ms</span><br><span class=\"line\">           admin.system.version      0ms     0ms      0ms</span><br><span class=\"line\">config.external_validation_keys      0ms     0ms      0ms</span><br><span class=\"line\">        config.image_collection      0ms     0ms      0ms</span><br><span class=\"line\">          config.queryAnalyzers      0ms     0ms      0ms</span><br><span class=\"line\">                config.settings      0ms     0ms      0ms</span><br><span class=\"line\">    config.shardMergeRecipients      0ms     0ms      0ms</span><br><span class=\"line\">        config.shardSplitDonors      0ms     0ms      0ms</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># è¾“å‡ºè¯´æ˜</span></span><br><span class=\"line\">ns é›†åˆåç§°</span><br><span class=\"line\">total èŠ±è´¹åœ¨è¯¥é›†åˆä¸Šçš„æ—¶é•¿</span><br><span class=\"line\"><span class=\"built_in\">read</span> èŠ±è´¹åœ¨è¯¥é›†åˆä¸Šçš„è¯»æ“ä½œæ—¶é•¿</span><br><span class=\"line\">write èŠ±è´¹åœ¨è¯¥é›†åˆä¸Šçš„å†™æ“ä½œæ—¶é•¿</span><br></pre></td></tr></table></figure>\n<h2 id=\"mongodump-å¤‡ä»½æ•°æ®åº“\">mongodump: å¤‡ä»½æ•°æ®åº“</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>mongodumpå‘½ä»¤ç”¨äºå¤‡ä»½æ•°æ®åº“</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å¤‡ä»½æ‰€æœ‰åº“ï¼Œé»˜è®¤è¾“å‡ºåˆ°dumpæ–‡ä»¶å¤¹ä¸‹</span></span><br><span class=\"line\">mongodump <span class=\"string\">&quot;mongodb://user:password@10.1.2.26:27017,10.1.2.142:27017,10.1.2.41:27017/?authSource=admin&amp;replicaSet=rs0&quot;</span> --gzip</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å¤‡ä»½æŒ‡å®šåº“ï¼Œé»˜è®¤è¾“å‡ºåˆ°dumpæ–‡ä»¶å¤¹ä¸‹</span></span><br><span class=\"line\">mongodump <span class=\"string\">&quot;mongodb://user:password@10.1.2.26:27017,10.1.2.142:27017,10.1.2.41:27017/?authSource=admin&amp;replicaSet=rs0&quot;</span> -d <span class=\"built_in\">test</span> --gzip</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å¤‡ä»½æŒ‡å®šé›†åˆ</span></span><br><span class=\"line\">mongodump <span class=\"string\">&quot;mongodb://user:password@10.1.2.26:27017,10.1.2.142:27017,10.1.2.41:27017/?authSource=admin&amp;replicaSet=rs0&quot;</span> -d <span class=\"built_in\">test</span> -c books --gzip -o ./books</span><br><span class=\"line\">2024-04-03T09:36:18.980+0000\twriting test.books to books/test/books.bson.gz</span><br><span class=\"line\">2024-04-03T09:36:18.983+0000\t<span class=\"keyword\">done</span> dumping test.books (50 documents)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å‚æ•°è¯´æ˜</span></span><br><span class=\"line\">-d æŒ‡å®šæ•°æ®åº“ï¼Œä¸æŒ‡å®šåˆ™å¯¼å‡ºå…¨éƒ¨æ•°æ®åº“</span><br><span class=\"line\">-c æŒ‡å®šé›†åˆï¼Œä¸æŒ‡å®šåˆ™å¯¼å‡ºå…¨éƒ¨é›†åˆ</span><br><span class=\"line\">--gzip æŒ‡å®šå‹ç¼©æ ¼å¼ï¼Œå¯¼å‡ºçš„æ–‡ä»¶ä¼šè¢«å‹ç¼©ä¸º.gzæ ¼å¼</span><br><span class=\"line\">-o æŒ‡å®šå¤‡ä»½ç›®å½•ï¼Œä¸æŒ‡å®šåˆ™é»˜è®¤ä¸ºå½“å‰ç›®å½•ä¸‹çš„dumpæ–‡ä»¶å¤¹</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ç±»ä¼¼äº mongoexport ,å¤‡ä»½æ•°æ®æ—¶åŒæ ·æ”¯æŒè¿‡æ»¤æ¡ä»¶</span></span><br><span class=\"line\">mongodump <span class=\"string\">&quot;mongodb://user:password@10.1.2.26:27017,10.1.2.142:27017,10.1.2.41:27017/?authSource=admin&amp;replicaSet=rs0&quot;</span> -d <span class=\"built_in\">test</span> -c books --gzip -o ./books --query=<span class=\"string\">&#x27;&#123;&quot;name&quot;:&quot;hello&quot;&#125;&#x27;</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"mongorestore-æ¢å¤æ•°æ®åº“\">mongorestore: æ¢å¤æ•°æ®åº“</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>mongorestoreå‘½ä»¤ç”¨äºæ¢å¤æ•°æ®åº“</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æ¢å¤åˆ°ç›¸åŒæ•°æ®åº“çš„ç›¸åŒé›†åˆ,æ­¤æ—¶ä¼šå°†dumpç›®å½•ä¸‹çš„æ‰€æœ‰æ•°æ®åº“è¿›è¡Œæ¢å¤</span></span><br><span class=\"line\">mongorestore <span class=\"string\">&quot;mongodb://user:password@10.1.2.26:27017,10.1.2.142:27017,10.1.2.41:27017/?authSource=admin&amp;replicaSet=rs0&quot;</span> --gzip ./dump</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åªæ¢å¤æŒ‡å®šçš„åº“ä¸‹çš„æ‰€æœ‰é›†åˆ</span></span><br><span class=\"line\">mongorestore <span class=\"string\">&quot;mongodb://user:password@10.1.2.26:27017,10.1.2.142:27017,10.1.2.41:27017/?authSource=admin&amp;replicaSet=rs0&quot;</span> --nsInclude=<span class=\"string\">&quot;test.*&quot;</span> --gzip ./dump</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åªæ¢å¤æŒ‡å®šçš„é›†åˆ</span></span><br><span class=\"line\">mongorestore <span class=\"string\">&quot;mongodb://user:password@10.1.2.26:27017,10.1.2.142:27017,10.1.2.41:27017/?authSource=admin&amp;replicaSet=rs0&quot;</span> --nsInclude=<span class=\"string\">&quot;test.books&quot;</span> --gzip ./dump</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å‚æ•°è¯´æ˜</span></span><br><span class=\"line\">--nsInclude=test.books æŒ‡å®šè¦æ¢å¤çš„é›†åˆ</span><br><span class=\"line\">--gzip æŒ‡å®šå‹ç¼©æ ¼å¼</span><br></pre></td></tr></table></figure>\n<h2 id=\"bsondump-æŸ¥çœ‹BSONæ–‡ä»¶å†…å®¹\">bsondump: æŸ¥çœ‹BSONæ–‡ä»¶å†…å®¹</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>bsondumpå‘½ä»¤ç”¨äºæŸ¥çœ‹BSONæ–‡ä»¶å†…å®¹ï¼Œå¯ä»¥å°†bsonæ ¼å¼çš„æ•°æ®è½¬æ¢ä¸ºjsonæ ¼å¼ï¼Œæ–¹ä¾¿æŸ¥çœ‹ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>æˆ‘ä»¬ä½¿ç”¨mongodumpå¯¼å‡ºçš„æ•°æ®æ ¼å¼ä¸ºbsonæ ¼å¼ï¼Œå¯ä»¥ä½¿ç”¨bsondumpå‘½ä»¤å°†å…¶è½¬æ¢ä¸ºjsonæ ¼å¼ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å¦‚æœå¯¼å‡ºçš„æ˜¯å‹ç¼©æ ¼å¼éœ€è¦å…ˆè§£å‹ç¼©</span></span><br><span class=\"line\">gunzip emp.bson.gz</span><br><span class=\"line\"><span class=\"comment\"># å°†bsonæ–‡ä»¶è½¬æ¢ä¸ºjsonæ–‡ä»¶</span></span><br><span class=\"line\">bsondump emp.bson &gt; emp.json</span><br></pre></td></tr></table></figure>\n<h2 id=\"mongofiles-æ–‡ä»¶å­˜å‚¨\">mongofiles: æ–‡ä»¶å­˜å‚¨</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>mongofileså‘½ä»¤ç”¨äºæ–‡ä»¶å­˜å‚¨ï¼Œå¯ä»¥å°†æ–‡ä»¶å­˜å‚¨åˆ°MongoDBä¸­ï¼Œç„¶åé€šè¿‡mongofileså‘½ä»¤è¿›è¡ŒæŸ¥çœ‹å’Œåˆ é™¤ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä¸è¿‡ç°åœ¨æ–‡ä»¶å­˜å‚¨åŸºæœ¬éƒ½ä¼šä½¿ç”¨S3ï¼Œå¾ˆå°‘ä½¿ç”¨mongodbäº†ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ä¸Šä¼ </span></span><br><span class=\"line\">mongofiles <span class=\"string\">&quot;mongodb://user:password@10.1.2.26:27017,10.1.2.142:27017,10.1.2.41:27017/?authSource=admin&amp;replicaSet=rs0&quot;</span> -d mydb put shellä»å…¥é—¨åˆ°ç²¾é€š.docx</span><br><span class=\"line\"><span class=\"comment\"># ä¸Šä¼ åä¼šåœ¨æŒ‡å®šçš„æ•°æ®åº“ä¸­åˆ›å»ºä¸¤ä¸ªé›†åˆï¼šfs.files å’Œ fs.chunks</span></span><br><span class=\"line\"></span><br><span class=\"line\">&gt; db.fs.files.find()</span><br><span class=\"line\">[</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    _id: ObjectId(<span class=\"string\">&#x27;66120f0135b8419b3a1ca510&#x27;</span>), <span class=\"comment\"># æ–‡æ¡£IDï¼Œå”¯ä¸€æ ‡è¯†</span></span><br><span class=\"line\">    length: Long(<span class=\"string\">&#x27;486680&#x27;</span>),                    <span class=\"comment\"># æ–‡ä»¶å¤§å°</span></span><br><span class=\"line\">    chunkSize: 261120,                         <span class=\"comment\"># æ¯ä¸ªåˆ†ç‰‡çš„å¤§å°</span></span><br><span class=\"line\">    uploadDate: ISODate(<span class=\"string\">&#x27;2024-04-07T03:12:01.965Z&#x27;</span>), <span class=\"comment\"># ä¸Šä¼ æ—¶é—´</span></span><br><span class=\"line\">    filename: <span class=\"string\">&#x27;shellä»å…¥é—¨åˆ°ç²¾é€š.docx&#x27;</span>,          <span class=\"comment\"># æ–‡ä»¶å</span></span><br><span class=\"line\">    metadata: &#123;&#125;                               <span class=\"comment\"># å…ƒæ•°æ®</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">]</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&gt; db.fs.chunks.find()</span><br><span class=\"line\">[</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    _id: ObjectId(<span class=\"string\">&#x27;66120f0135b8419b3a1ca512&#x27;</span>),     <span class=\"comment\"># åˆ†ç‰‡ID</span></span><br><span class=\"line\">    files_id: ObjectId(<span class=\"string\">&#x27;66120f0135b8419b3a1ca510&#x27;</span>), <span class=\"comment\"># æ–‡æ¡£IDï¼Œå¯¹åº”fs.filesé›†åˆä¸­çš„_id</span></span><br><span class=\"line\">    n: 1,                                         <span class=\"comment\"># åˆ†ç‰‡åºå·</span></span><br><span class=\"line\">    data: &lt;Binary&gt;                                <span class=\"comment\"># åˆ†ç‰‡æ•°æ®</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹</span></span><br><span class=\"line\">mongofiles <span class=\"string\">&quot;mongodb://user:password@10.1.2.26:27017,10.1.2.142:27017,10.1.2.41:27017/?authSource=admin&amp;replicaSet=rs0&quot;</span> -d mydb list</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æœç´¢</span></span><br><span class=\"line\">mongofiles <span class=\"string\">&quot;mongodb://user:password@10.1.2.26:27017,10.1.2.142:27017,10.1.2.41:27017/?authSource=admin&amp;replicaSet=rs0&quot;</span> -d mydb search shell</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ä¸‹è½½</span></span><br><span class=\"line\">mongofiles <span class=\"string\">&quot;mongodb://user:password@10.1.2.26:27017,10.1.2.142:27017,10.1.2.41:27017/?authSource=admin&amp;replicaSet=rs0&quot;</span> -d mydb get shellä»å…¥é—¨åˆ°ç²¾é€š.docx</span><br><span class=\"line\"><span class=\"comment\"># æ ¹æ®idè·å–æ–‡ä»¶</span></span><br><span class=\"line\">mongofiles <span class=\"string\">&quot;mongodb://user:password@10.1.2.26:27017,10.1.2.142:27017,10.1.2.41:27017/?authSource=admin&amp;replicaSet=rs0&quot;</span> -d mydb get_id <span class=\"string\">&#x27;&#123;&quot;$oid&quot;: &quot;66120f0135b8419b3a1ca510&quot;&#125;&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åˆ é™¤</span></span><br><span class=\"line\">mongofiles <span class=\"string\">&quot;mongodb://user:password@10.1.2.26:27017,10.1.2.142:27017,10.1.2.41:27017/?authSource=admin&amp;replicaSet=rs0&quot;</span> -d mydb delete shellä»å…¥é—¨åˆ°ç²¾é€š.docx</span><br><span class=\"line\"><span class=\"comment\"># æ ¹æ®idåˆ é™¤æ–‡ä»¶</span></span><br><span class=\"line\">mongofiles <span class=\"string\">&quot;mongodb://user:password@10.1.2.26:27017,10.1.2.142:27017,10.1.2.41:27017/?authSource=admin&amp;replicaSet=rs0&quot;</span> -d mydb delete_id <span class=\"string\">&#x27;&#123;&quot;$oid&quot;: &quot;66120f0135b8419b3a1ca510&quot;&#125;&#x27;</span></span><br></pre></td></tr></table></figure>","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç»Linuxä¸‹MongoDB Command Line Database Toolsçš„å®‰è£…ä¸ä½¿ç”¨ MongoDB Command Line Database Toolså®˜æ–¹æ–‡æ¡£ æœ¬æ–‡åŸºäºCentOS8(x86_64) MongoDB Database Tools MongoDB Database Toolsæ˜¯MongoDBå®˜æ–¹æä¾›çš„æ•°æ®åº“ç®¡ç†å·¥å…·ï¼Œå¯ä»¥ç”¨äºç®¡ç†MongoDBæ•°æ®åº“ï¼ŒåŒ…æ‹¬MongoDBçš„å¤‡ä»½ã€æ¢å¤ã€ç›‘æ§ç­‰åŠŸèƒ½ã€‚ MongoDB Database Toolsçš„ä¸‹è½½åœ°å€ 1234567891011# ä¸‹è½½å®‰è£…åŒ…wget https://fastdl.mongodb.org/tools/db/mongodb-database-tools-rhel80-x86_64-100.9.4.tgz# è§£å‹å®‰è£…åŒ…tar -xvzf mongodb-database-tools-rhel80-x86_64-100.9.4.tgz# åˆ›å»ºè½¯è¿æ¥ln -s mongodb-database-tools-rhel80-x86_64-100.9.4 /mongodb/tools# åœ¨/etc/profileæ–‡ä»¶ä¸­é…ç½®PATHç¯å¢ƒå˜é‡export PATH=/mongodb/tools/bin:$PATH# ä½¿é…ç½®ç”Ÿæ•ˆsource /etc/profile MongoDB Database Toolså¸¸ç”¨å‘½ä»¤ï¼Œè¯¦ç»†çš„ä½¿ç”¨æ–¹æ³•è¯·æŸ¥çœ‹å®˜æ–¹æ–‡æ¡£ æ–‡ä»¶åç§° ä½œç”¨ mongostat æ•°æ®åº“æ€§èƒ½ç›‘æ§å·¥å…· mongotop çƒ­ç‚¹è¡¨ç›‘æ§å·¥å…· mongodump æ•°æ®åº“é€»è¾‘å¤‡ä»½å·¥å…· mongorestore æ•°æ®åº“é€»è¾‘æ¢å¤å·¥å…· mongoexport æ•°æ®å¯¼å‡ºå·¥å…· mongoimport æ•°æ®å¯¼å…¥å·¥å…· bsondump BSONæ ¼å¼è½¬æ¢å·¥å…· mongofiles GridFSæ–‡ä»¶å·¥å…· mongoexport: å¯¼å‡ºæ•°æ® 123456789101112131415161718192021# å¯¼å‡ºcsvæ ¼å¼çš„æ•°æ®mongoexport &quot;mongodb://user:password@10.1.2.26:27017,10.1.2.142:27017,10.1.2.41:27017/?authSource=admin&amp;replicaSet=rs0&quot; -d test -c books -f _id,title,type,tag --type=csv -o books.csv# å¯¼å‡ºjsonæ ¼å¼çš„æ•°æ®mongoexport &quot;mongodb://user:password@10.1.2.26:27017,10.1.2.142:27017,10.1.2.41:27017/?authSource=admin&amp;replicaSet=rs0&quot; -d test -c books -f _id,title,type,tag --type=json -o books.json# å‚æ•°è¯´æ˜-d æŒ‡å®šæ•°æ®åº“-c æŒ‡å®šé›†åˆ-f æŒ‡å®šå¯¼å‡ºå­—æ®µï¼Œcsvæ ¼å¼éœ€è¦æŒ‡å®šå­—æ®µï¼Œjsonæ ¼å¼å¯ä»¥ä¸æŒ‡å®šå­—æ®µï¼Œé»˜è®¤å¯¼å‡ºå…¨éƒ¨--type=csv/json æŒ‡å®šå¯¼å‡ºæ ¼å¼-o æŒ‡å®šå¯¼å‡ºæ–‡ä»¶# å¯¼å‡ºæ—¶å¯ä»¥å¢åŠ è¿‡æ»¤æ¡ä»¶mongoexport &quot;mongodb://user:password@10.1.2.26:27017,10.1.2.142:27017,10.1.2.41:27017?authSource=admin&amp;replicaSet=rs0&quot; -d mydb -c user --type=json -o user.json --limit=10 --skip=2 --sort=&#x27;&#123;&quot;name&quot;:1&#125;&#x27; --query=&#x27;&#123;&quot;age&quot;:&#123;&quot;$gt&quot;:25&#125;,&quot;name&quot;:&quot;zhangsan&quot;&#125;&#x27;# å‚æ•°è¯´æ˜--limit=10 æŒ‡å®šå¯¼å‡ºæ¡æ•°--skip=2 æŒ‡å®šè·³è¿‡æ¡æ•°--sort=&#x27;&#123;&quot;name&quot;:1&#125;&#x27; æŒ‡å®šæ’åºå­—æ®µ--query=&#x27;&#123;&quot;age&quot;:&#123;&quot;$gt&quot;:25&#125;,&quot;name&quot;:&quot;zhangsan&quot;&#125;&#x27; æŒ‡å®šæŸ¥è¯¢æ¡ä»¶ï¼Œæ³¨æ„è¿™é‡Œçš„æŸ¥è¯¢æ¡ä»¶æ˜¯jsonæ ¼å¼ï¼Œå­—æ®µåéœ€è¦ä½¿ç”¨åŒå¼•å·åŒ…è£¹ mongoimport: å¯¼å…¥æ•°æ® 1234567891011121314151617# å¯¼å…¥csvæ ¼å¼çš„æ•°æ®# æ³¨æ„æ­¤æ—¶å¯¼å…¥çš„csvæ–‡ä»¶ä¸­ç¬¬ä¸€è¡Œå¦‚æœæ˜¯å­—æ®µåï¼Œéœ€è¦å…ˆåˆ é™¤ç¬¬ä¸€è¡Œå†å¯¼å…¥ï¼Œè¿™é‡Œä½¿ç”¨äº† -f æŒ‡å®šå­—æ®µï¼Œæ¥å’Œå¯¼å…¥çš„csvæ–‡ä»¶çš„åˆ—ä¸€ä¸€å¯¹åº”mongoimport &quot;mongodb://user:password@10.1.2.26:27017,10.1.2.142:27017,10.1.2.41:27017/?authSource=admin&amp;replicaSet=rs0&quot; -d test -c books_new -f _id,title,type,tag --type=csv --file books.csv# æ³¨æ„æ­¤æ—¶å¯¼å…¥çš„csvæ–‡ä»¶ä¸­ç¬¬ä¸€è¡Œå¦‚æœæ˜¯å­—æ®µåï¼Œéœ€è¦å…ˆåˆ é™¤ç¬¬ä¸€è¡Œå†å¯¼å…¥ï¼Œè¿™é‡Œä½¿ç”¨äº† -f æŒ‡å®šå­—æ®µï¼Œæ¥å’Œå¯¼å…¥çš„csvæ–‡ä»¶çš„åˆ—ä¸€ä¸€å¯¹åº”mongoimport &quot;mongodb://user:password@10.1.2.26:27017,10.1.2.142:27017,10.1.2.41:27017/?authSource=admin&amp;replicaSet=rs0&quot; -d test -c books_new --headerline --type=csv --file books.csv# å¯¼å…¥jsonæ ¼å¼çš„æ•°æ®mongoimport &quot;mongodb://user:password@10.1.2.26:27017,10.1.2.142:27017,10.1.2.41:27017/?authSource=admin&amp;replicaSet=rs0&quot; -d test -c books_new --type=json --file books.json-d æŒ‡å®šæ•°æ®åº“-c æŒ‡å®šé›†åˆ-f æŒ‡å®šå¯¼å…¥å­—æ®µï¼Œcsvæ ¼å¼éœ€è¦æŒ‡å®šå­—æ®µ--headerline æŒ‡å®šç¬¬ä¸€è¡Œæ˜¯å­—æ®µå--type=csv/json æŒ‡å®šå¯¼å…¥æ ¼å¼--file æŒ‡å®šå¯¼å…¥æ–‡ä»¶--mode æŒ‡å®šå¯¼å…¥æ–¹å¼ï¼Œé»˜è®¤æ˜¯insertï¼Œè¿˜å¯ä»¥æ˜¯upsertï¼Œmergeï¼Œdelete modeè¯´æ˜ insert: é»˜è®¤å€¼ï¼Œå¦‚æœæ•°æ®ä¸å­˜åœ¨ï¼Œåˆ™æ’å…¥ï¼Œå¦‚æœå­˜åœ¨ï¼Œåˆ™æŠ¥é”™ upsert: å¦‚æœæ•°æ®ä¸å­˜åœ¨ï¼Œåˆ™æ’å…¥ï¼Œå¦‚æœå­˜åœ¨ï¼Œåˆ™æ›´æ–° merge: å¦‚æœæ•°æ®ä¸å­˜åœ¨ï¼Œåˆ™æ’å…¥ï¼Œå¦‚æœå­˜åœ¨ï¼Œåˆ™åˆå¹¶åæ›´æ–° delete: å¦‚æœæ•°æ®ä¸å­˜åœ¨ï¼Œä¹Ÿä¸æ‰§è¡Œæ’å…¥ï¼Œå¦‚æœå­˜åœ¨ï¼Œåˆ™åˆ é™¤ mongostat: æ•°æ®åº“æ€§èƒ½ç›‘æ§ mongostatå‘½ä»¤ç”¨äºå®æ—¶ç›‘æ§MongoDBæ•°æ®åº“çš„æ€§èƒ½ï¼ŒåŒ…æ‹¬è¿æ¥æ•°ã€æ–‡æ¡£æ•°ã€ç´¢å¼•æ•°ã€å†…å­˜ä½¿ç”¨æƒ…å†µç­‰ã€‚ 123456789101112# ç›‘æ§20æ¬¡ï¼Œé—´éš”1ç§’mongostat &quot;mongodb://user:password@10.1.2.26:27017,10.1.2.142:27017,10.1.2.41:27017/?authSource=admin&amp;replicaSet=rs0&quot; -n20 1# å‚æ•°è¯´æ˜-n æŒ‡å®šç›‘æ§æ¬¡æ•°1 æŒ‡å®šç›‘æ§é—´éš”æ—¶é—´ï¼Œå•ä½ä¸ºç§’# ç›‘æ§å®æ—¶æ•°æ®host insert query update delete getmore command dirty used flushes vsize res qrw arw net_in net_out conn set repl time10.1.2.142:27017 *0 *0 *0 *0 0 4|0 0.4% 5.0% 0 2.95G 151M 0|0 0|0 1.13k 75.2k 24 rs0 SLV Apr 3 08:37:49.40510.1.2.26:27017 *0 *0 *0 *0 0 2|0 0.2% 3.8% 0 2.87G 138M 0|0 0|0 710b 74.3k 14 rs0 SEC Apr 3 08:37:49.38510.1.2.41:27017 *0 *0 *0 *0 0 5|0 0.0% 17.7% 0 2.96G 184M 0|0 0|0 1.45k 75.5k 16 rs0 SEC Apr 3 08:37:49.426 æŒ‡æ ‡è¯´æ˜ æŒ‡æ ‡å è¯´æ˜ inserts æ¯ç§’æ’å…¥æ•° query æ¯ç§’æŸ¥è¯¢æ•° update æ¯ç§’æ›´æ–°æ•° delete æ¯ç§’åˆ é™¤æ•° getmore æ¯ç§’getmoreæ•° command æ¯ç§’å‘½ä»¤æ•°ï¼Œæ¶µç›–äº†å†…éƒ¨çš„ä¸€äº›æ“ä½œ %dirty WiredTigerç¼“å­˜ä¸­è„æ•°æ®ç™¾åˆ†æ¯” %used WiredTiger æ­£åœ¨ä½¿ç”¨çš„ç¼“å­˜ç™¾åˆ†æ¯” flushes WiredTigeræ‰§è¡ŒCheckPointçš„æ¬¡æ•° vsize è™šæ‹Ÿå†…å­˜ä½¿ç”¨é‡ res ç‰©ç†å†…å­˜ä½¿ç”¨é‡ qrw å®¢æˆ·ç«¯è¯»å†™ç­‰å¾…é˜Ÿåˆ—æ•°é‡ï¼Œé«˜å¹¶å‘æ—¶ï¼Œä¸€èˆ¬é˜Ÿåˆ—å€¼ä¼šå‡é«˜ arw å®¢æˆ·ç«¯è¯»å†™æ´»è·ƒä¸ªæ•° netIn ç½‘ç»œæ¥æ”¶æ•°æ®é‡ netOut ç½‘ç»œå‘é€æ•°æ®é‡ conn å½“å‰è¿æ¥æ•° set æ‰€å±å¤åˆ¶é›†åç§° repl å¤åˆ¶èŠ‚ç‚¹çŠ¶æ€ï¼Œå¦‚PRI(ä¸»èŠ‚ç‚¹,æˆ‘è¿™é‡Œä¸»èŠ‚ç‚¹æ˜¾ç¤ºä¸ºSLV),SEC(ä»èŠ‚ç‚¹),ARB(ä»²è£èŠ‚ç‚¹),REC(èŠ‚ç‚¹æ­£åœ¨æ¢å¤),UNK(æœªçŸ¥çŠ¶æ€),RTR(mongos) time æ—¶é—´æˆ³ éœ€è¦é‡ç‚¹å…³æ³¨çš„æŒ‡æ ‡ 1.æ’å…¥ã€åˆ é™¤ã€ä¿®æ”¹ã€æŸ¥è¯¢çš„é€Ÿç‡æ˜¯å¦äº§ç”Ÿè¾ƒå¤§æ³¢åŠ¨ï¼Œæ˜¯å¦è¶…å‡ºé¢„æœŸã€‚ 2.qrwã€arwï¼šé˜Ÿåˆ—æ˜¯å¦è¾ƒé«˜ï¼Œè‹¥é•¿æ—¶é—´å¤§äº0åˆ™è¯´æ˜æ­¤æ—¶è¯»å†™é€Ÿåº¦è¾ƒæ…¢ã€‚ 3.connï¼šè¿æ¥æ•°æ˜¯å¦å¤ªå¤šã€‚ 4.dirtyï¼šç™¾åˆ†æ¯”æ˜¯å¦è¾ƒé«˜ï¼Œè‹¥æŒç»­é«˜äº10%åˆ™è¯´æ˜ç£ç›˜I/Oå­˜åœ¨ç“¶é¢ˆã€‚ 5.netInã€netOutï¼šæ˜¯å¦è¶…è¿‡ç½‘ç»œå¸¦å®½é˜ˆå€¼ã€‚ 6.replï¼šçŠ¶æ€æ˜¯å¦å¼‚å¸¸ï¼Œå¦‚PRIã€SECã€RTRä¸ºæ­£å¸¸ï¼Œè‹¥å‡ºç°RECç­‰å¼‚å¸¸å€¼åˆ™éœ€è¦ä¿®å¤ã€‚ 1234567# æŒ‡å®šç›‘æ§æŒ‡æ ‡ -omongostat &quot;mongodb://user:password@10.1.2.26:27017,10.1.2.142:27017,10.1.2.41:27017/?authSource=admin&amp;replicaSet=rs0&quot; -n1 1 -o=&#x27;host,insert,query,update,delete,qrw,arw,conn,dirty,repl,version&#x27; host insert query update delete qrw arw conn dirty repl version10.1.2.142:27017 *0 *0 *0 *0 0|0 0|0 24 0.4% SLV 7.0.7 10.1.2.26:27017 *0 *0 *0 *0 0|0 0|0 14 0.2% SEC 7.0.7 10.1.2.41:27017 *0 *0 *0 *0 0|0 0|0 16 0.4% SEC 7.0.7 mongotop: æŸ¥çœ‹æ•°æ®åº“æ€§èƒ½ mongotopå‘½ä»¤å¯ç”¨äºæŸ¥çœ‹æ•°æ®åº“çš„çƒ­ç‚¹è¡¨ï¼Œé€šè¿‡è§‚å¯Ÿmongotopçš„è¾“å‡ºï¼Œå¯ä»¥åˆ¤å®šæ˜¯å“ªäº›é›†åˆå ç”¨äº†å¤§éƒ¨åˆ†è¯»å†™æ—¶é—´ã€‚ 1234567891011121314151617181920# ç›‘æ§20æ¬¡ï¼Œé—´éš”1ç§’mongotop &quot;mongodb://user:password@10.1.2.26:27017,10.1.2.142:27017,10.1.2.41:27017/?authSource=admin&amp;replicaSet=rs0&quot; -n 20 1 ns total read write 2024-04-03T09:16:53Z admin.atlascli 0ms 0ms 0ms admin.system.keys 0ms 0ms 0ms admin.system.users 0ms 0ms 0ms admin.system.version 0ms 0ms 0msconfig.external_validation_keys 0ms 0ms 0ms config.image_collection 0ms 0ms 0ms config.queryAnalyzers 0ms 0ms 0ms config.settings 0ms 0ms 0ms config.shardMergeRecipients 0ms 0ms 0ms config.shardSplitDonors 0ms 0ms 0ms# è¾“å‡ºè¯´æ˜ns é›†åˆåç§°total èŠ±è´¹åœ¨è¯¥é›†åˆä¸Šçš„æ—¶é•¿read èŠ±è´¹åœ¨è¯¥é›†åˆä¸Šçš„è¯»æ“ä½œæ—¶é•¿write èŠ±è´¹åœ¨è¯¥é›†åˆä¸Šçš„å†™æ“ä½œæ—¶é•¿ mongodump: å¤‡ä»½æ•°æ®åº“ mongodumpå‘½ä»¤ç”¨äºå¤‡ä»½æ•°æ®åº“ 12345678910111213141516171819# å¤‡ä»½æ‰€æœ‰åº“ï¼Œé»˜è®¤è¾“å‡ºåˆ°dumpæ–‡ä»¶å¤¹ä¸‹mongodump &quot;mongodb://user:password@10.1.2.26:27017,10.1.2.142:27017,10.1.2.41:27017/?authSource=admin&amp;replicaSet=rs0&quot; --gzip# å¤‡ä»½æŒ‡å®šåº“ï¼Œé»˜è®¤è¾“å‡ºåˆ°dumpæ–‡ä»¶å¤¹ä¸‹mongodump &quot;mongodb://user:password@10.1.2.26:27017,10.1.2.142:27017,10.1.2.41:27017/?authSource=admin&amp;replicaSet=rs0&quot; -d test --gzip# å¤‡ä»½æŒ‡å®šé›†åˆmongodump &quot;mongodb://user:password@10.1.2.26:27017,10.1.2.142:27017,10.1.2.41:27017/?authSource=admin&amp;replicaSet=rs0&quot; -d test -c books --gzip -o ./books2024-04-03T09:36:18.980+0000 writing test.books to books/test/books.bson.gz2024-04-03T09:36:18.983+0000 done dumping test.books (50 documents)# å‚æ•°è¯´æ˜-d æŒ‡å®šæ•°æ®åº“ï¼Œä¸æŒ‡å®šåˆ™å¯¼å‡ºå…¨éƒ¨æ•°æ®åº“-c æŒ‡å®šé›†åˆï¼Œä¸æŒ‡å®šåˆ™å¯¼å‡ºå…¨éƒ¨é›†åˆ--gzip æŒ‡å®šå‹ç¼©æ ¼å¼ï¼Œå¯¼å‡ºçš„æ–‡ä»¶ä¼šè¢«å‹ç¼©ä¸º.gzæ ¼å¼-o æŒ‡å®šå¤‡ä»½ç›®å½•ï¼Œä¸æŒ‡å®šåˆ™é»˜è®¤ä¸ºå½“å‰ç›®å½•ä¸‹çš„dumpæ–‡ä»¶å¤¹# ç±»ä¼¼äº mongoexport ,å¤‡ä»½æ•°æ®æ—¶åŒæ ·æ”¯æŒè¿‡æ»¤æ¡ä»¶mongodump &quot;mongodb://user:password@10.1.2.26:27017,10.1.2.142:27017,10.1.2.41:27017/?authSource=admin&amp;replicaSet=rs0&quot; -d test -c books --gzip -o ./books --query=&#x27;&#123;&quot;name&quot;:&quot;hello&quot;&#125;&#x27; mongorestore: æ¢å¤æ•°æ®åº“ mongorestoreå‘½ä»¤ç”¨äºæ¢å¤æ•°æ®åº“ 12345678910111213# æ¢å¤åˆ°ç›¸åŒæ•°æ®åº“çš„ç›¸åŒé›†åˆ,æ­¤æ—¶ä¼šå°†dumpç›®å½•ä¸‹çš„æ‰€æœ‰æ•°æ®åº“è¿›è¡Œæ¢å¤mongorestore &quot;mongodb://user:password@10.1.2.26:27017,10.1.2.142:27017,10.1.2.41:27017/?authSource=admin&amp;replicaSet=rs0&quot; --gzip ./dump# åªæ¢å¤æŒ‡å®šçš„åº“ä¸‹çš„æ‰€æœ‰é›†åˆmongorestore &quot;mongodb://user:password@10.1.2.26:27017,10.1.2.142:27017,10.1.2.41:27017/?authSource=admin&amp;replicaSet=rs0&quot; --nsInclude=&quot;test.*&quot; --gzip ./dump# åªæ¢å¤æŒ‡å®šçš„é›†åˆmongorestore &quot;mongodb://user:password@10.1.2.26:27017,10.1.2.142:27017,10.1.2.41:27017/?authSource=admin&amp;replicaSet=rs0&quot; --nsInclude=&quot;test.books&quot; --gzip ./dump# å‚æ•°è¯´æ˜--nsInclude=test.books æŒ‡å®šè¦æ¢å¤çš„é›†åˆ--gzip æŒ‡å®šå‹ç¼©æ ¼å¼ bsondump: æŸ¥çœ‹BSONæ–‡ä»¶å†…å®¹ bsondumpå‘½ä»¤ç”¨äºæŸ¥çœ‹BSONæ–‡ä»¶å†…å®¹ï¼Œå¯ä»¥å°†bsonæ ¼å¼çš„æ•°æ®è½¬æ¢ä¸ºjsonæ ¼å¼ï¼Œæ–¹ä¾¿æŸ¥çœ‹ã€‚ æˆ‘ä»¬ä½¿ç”¨mongodumpå¯¼å‡ºçš„æ•°æ®æ ¼å¼ä¸ºbsonæ ¼å¼ï¼Œå¯ä»¥ä½¿ç”¨bsondumpå‘½ä»¤å°†å…¶è½¬æ¢ä¸ºjsonæ ¼å¼ã€‚ 1234# å¦‚æœå¯¼å‡ºçš„æ˜¯å‹ç¼©æ ¼å¼éœ€è¦å…ˆè§£å‹ç¼©gunzip emp.bson.gz# å°†bsonæ–‡ä»¶è½¬æ¢ä¸ºjsonæ–‡ä»¶bsondump emp.bson &gt; emp.json mongofiles: æ–‡ä»¶å­˜å‚¨ mongofileså‘½ä»¤ç”¨äºæ–‡ä»¶å­˜å‚¨ï¼Œå¯ä»¥å°†æ–‡ä»¶å­˜å‚¨åˆ°MongoDBä¸­ï¼Œç„¶åé€šè¿‡mongofileså‘½ä»¤è¿›è¡ŒæŸ¥çœ‹å’Œåˆ é™¤ã€‚ ä¸è¿‡ç°åœ¨æ–‡ä»¶å­˜å‚¨åŸºæœ¬éƒ½ä¼šä½¿ç”¨S3ï¼Œå¾ˆå°‘ä½¿ç”¨mongodbäº†ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142# ä¸Šä¼ mongofiles &quot;mongodb://user:password@10.1.2.26:27017,10.1.2.142:27017,10.1.2.41:27017/?authSource=admin&amp;replicaSet=rs0&quot; -d mydb put shellä»å…¥é—¨åˆ°ç²¾é€š.docx# ä¸Šä¼ åä¼šåœ¨æŒ‡å®šçš„æ•°æ®åº“ä¸­åˆ›å»ºä¸¤ä¸ªé›†åˆï¼šfs.files å’Œ fs.chunks&gt; db.fs.files.find()[ &#123; _id: ObjectId(&#x27;66120f0135b8419b3a1ca510&#x27;), # æ–‡æ¡£IDï¼Œå”¯ä¸€æ ‡è¯† length: Long(&#x27;486680&#x27;), # æ–‡ä»¶å¤§å° chunkSize: 261120, # æ¯ä¸ªåˆ†ç‰‡çš„å¤§å° uploadDate: ISODate(&#x27;2024-04-07T03:12:01.965Z&#x27;), # ä¸Šä¼ æ—¶é—´ filename: &#x27;shellä»å…¥é—¨åˆ°ç²¾é€š.docx&#x27;, # æ–‡ä»¶å metadata: &#123;&#125; # å…ƒæ•°æ® &#125;]&gt; db.fs.chunks.find()[ &#123; _id: ObjectId(&#x27;66120f0135b8419b3a1ca512&#x27;), # åˆ†ç‰‡ID files_id: ObjectId(&#x27;66120f0135b8419b3a1ca510&#x27;), # æ–‡æ¡£IDï¼Œå¯¹åº”fs.filesé›†åˆä¸­çš„_id n: 1, # åˆ†ç‰‡åºå· data: &lt;Binary&gt; # åˆ†ç‰‡æ•°æ® &#125;]# æŸ¥çœ‹mongofiles &quot;mongodb://user:password@10.1.2.26:27017,10.1.2.142:27017,10.1.2.41:27017/?authSource=admin&amp;replicaSet=rs0&quot; -d mydb list# æœç´¢mongofiles &quot;mongodb://user:password@10.1.2.26:27017,10.1.2.142:27017,10.1.2.41:27017/?authSource=admin&amp;replicaSet=rs0&quot; -d mydb search shell# ä¸‹è½½mongofiles &quot;mongodb://user:password@10.1.2.26:27017,10.1.2.142:27017,10.1.2.41:27017/?authSource=admin&amp;replicaSet=rs0&quot; -d mydb get shellä»å…¥é—¨åˆ°ç²¾é€š.docx# æ ¹æ®idè·å–æ–‡ä»¶mongofiles &quot;mongodb://user:password@10.1.2.26:27017,10.1.2.142:27017,10.1.2.41:27017/?authSource=admin&amp;replicaSet=rs0&quot; -d mydb get_id &#x27;&#123;&quot;$oid&quot;: &quot;66120f0135b8419b3a1ca510&quot;&#125;&#x27;# åˆ é™¤mongofiles &quot;mongodb://user:password@10.1.2.26:27017,10.1.2.142:27017,10.1.2.41:27017/?authSource=admin&amp;replicaSet=rs0&quot; -d mydb delete shellä»å…¥é—¨åˆ°ç²¾é€š.docx# æ ¹æ®idåˆ é™¤æ–‡ä»¶mongofiles &quot;mongodb://user:password@10.1.2.26:27017,10.1.2.142:27017,10.1.2.41:27017/?authSource=admin&amp;replicaSet=rs0&quot; -d mydb delete_id &#x27;&#123;&quot;$oid&quot;: &quot;66120f0135b8419b3a1ca510&quot;&#125;&#x27;","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç»Linuxä¸‹MongoDB Command Line Database Toolsçš„å®‰è£…ä¸ä½¿ç”¨ MongoDB Command Line Database Toolså®˜æ–¹æ–‡æ¡£ æœ¬æ–‡åŸºäºCentOS8(x86_64)","date_published":"2024-04-03T13:30:05.000Z","tags":["æŠ€æœ¯","linux","mongodb","mongodb"]}]}