{"version":"https://jsonfeed.org/version/1","name":"é£˜é€¸å³°çš„åšå®¢","home_page_url":"https://blog.hanqunfeng.com","feed_url":"https://blog.hanqunfeng.com/feed.json","author":{"name":"é£˜é€¸å³°"},"items":[{"id":"https://blog.hanqunfeng.com/2025/06/05/docker-remote-connection/","url":"https://blog.hanqunfeng.com/2025/06/05/docker-remote-connection/","title":"Docker ä¹‹ è¿œç¨‹è¿æ¥","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç»å¦‚ä½•è¿œç¨‹è¿æ¥Docker</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://docs.docker.com\">Dockerå®˜æ–¹æ–‡æ¡£</a></p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"è¿œç¨‹è¿æ¥Dockeræœ‰å¦‚ä¸‹ä¸‰ç§æ–¹å¼\">è¿œç¨‹è¿æ¥Dockeræœ‰å¦‚ä¸‹ä¸‰ç§æ–¹å¼</h2>\n<h3 id=\"æ–¹å¼ä¸€ï¼šå¼€å¯-TCPï¼ˆä¸å¸¦-TLSï¼Œä»…ç”¨äºå†…ç½‘è°ƒè¯•ï¼‰\">æ–¹å¼ä¸€ï¼šå¼€å¯ TCPï¼ˆä¸å¸¦ TLSï¼Œä»…ç”¨äºå†…ç½‘è°ƒè¯•ï¼‰</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¼€å¯æ–¹å¼</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-6\">ç¼–è¾‘ <code>/etc/docker/daemon.json</code>ï¼ŒåŠ ä¸Šï¼š</li>\n</ul>\n  <figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;hosts&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">[</span><span class=\"string\">&quot;unix:///var/run/docker.sock&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;tcp://0.0.0.0:2375&quot;</span><span class=\"punctuation\">]</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-2\">\n<li class=\"lvl-6\">ç¦ç”¨ <code>-H fd://</code>ï¼ˆsystemd ä¸ daemon.json å†²çªçš„æ ¹æºï¼‰</li>\n</ul>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">sudo</span> <span class=\"built_in\">mkdir</span> -p /etc/systemd/system/docker.service.d</span><br><span class=\"line\"><span class=\"built_in\">sudo</span> vi /etc/systemd/system/docker.service.d/override.conf</span><br><span class=\"line\"><span class=\"comment\"># å¡«å…¥</span></span><br><span class=\"line\">[Service]</span><br><span class=\"line\">ExecStart=</span><br><span class=\"line\">ExecStart=/usr/bin/dockerd</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-2\">\n<li class=\"lvl-6\">é‡å¯ docker daemon</li>\n</ul>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">sudo</span> systemctl daemon-reload</span><br><span class=\"line\"><span class=\"built_in\">sudo</span> systemctl restart docker</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-2\">\n<li class=\"lvl-6\">åœ¨å®¢æˆ·ç«¯æµ‹è¯•è¿æ¥</li>\n</ul>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker -H tcp://è¿œç¨‹IP:2375 ps</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-2\">\n<li class=\"lvl-6\">åŠ å…¥ç¯å¢ƒå˜é‡åå°±ä¸éœ€è¦æ¯æ¬¡éƒ½åŠ ä¸Š -H å‚æ•°äº†</li>\n</ul>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># zsh å°±æ¢æˆ ~/.zshrc</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;export DOCKER_HOST=tcp://è¿œç¨‹IP:2376&quot;</span>  &gt;&gt; ~/.bashrc</span><br><span class=\"line\"><span class=\"built_in\">source</span> ~/.bashrc</span><br><span class=\"line\"><span class=\"comment\"># æµ‹è¯•</span></span><br><span class=\"line\">docker ps</span><br></pre></td></tr></table></figure>\n</li>\n<li class=\"lvl-2\">\n<p>â—ä¸è¦å¼€å¯æ— è®¤è¯çš„ tcp://0.0.0.0:2375 åœ¨å…¬ç½‘ï¼Œè¿™æ˜¯è£¸å¥”çš„å®‰å…¨é£é™©ï¼Œä»»ä½•äººéƒ½èƒ½æ§åˆ¶ä½ çš„ Dockerã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>âœ… æ¨èæ–¹å¼æ˜¯ï¼š</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-6\">ä½¿ç”¨ tcp://0.0.0.0:2376 + --tlsverify</li>\n<li class=\"lvl-6\">æˆ–é€šè¿‡ ssh:// éš§é“è®¿é—® Docker</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"æ–¹å¼äºŒï¼šå¼€å¯-TCP-TLS-å®‰å…¨è®¿é—®ï¼ˆæ¨èç”¨äºå…¬ç½‘ï¼‰\">æ–¹å¼äºŒï¼šå¼€å¯ TCP + TLS å®‰å…¨è®¿é—®ï¼ˆæ¨èç”¨äºå…¬ç½‘ï¼‰</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ›å»º TLS è¯ä¹¦ï¼Œé€šè¿‡ä¸€ä¸ªè„šæœ¬å®ç°ï¼Œè„šæœ¬åç§° <code>generate-docker-certs.sh</code></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#!/bin/bash</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">set</span> -e</span><br><span class=\"line\"></span><br><span class=\"line\">SERVER_IP=166.189.9.114  <span class=\"comment\"># ğŸš¨ ä¿®æ”¹ä¸ºä½ çš„ Docker æœåŠ¡å™¨ IP æˆ–åŸŸå</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;[+] åˆ›å»º CA...&quot;</span></span><br><span class=\"line\">openssl genrsa -out ca-key.pem 4096</span><br><span class=\"line\">openssl req -new -x509 -days 365 \\</span><br><span class=\"line\">  -key ca-key.pem -subj <span class=\"string\">&quot;/CN=docker-ca&quot;</span> -out ca.pem</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;[+] åˆ›å»ºæœåŠ¡å™¨ç§é’¥...&quot;</span></span><br><span class=\"line\">openssl genrsa -out server-key.pem 4096</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;[+] åˆ›å»º OpenSSL é…ç½®æ–‡ä»¶...&quot;</span></span><br><span class=\"line\"><span class=\"built_in\">cat</span> &gt; extfile.cnf &lt;&lt;<span class=\"string\">EOF</span></span><br><span class=\"line\"><span class=\"string\">[req]</span></span><br><span class=\"line\"><span class=\"string\">distinguished_name = req_distinguished_name</span></span><br><span class=\"line\"><span class=\"string\">x509_extensions = v3_req</span></span><br><span class=\"line\"><span class=\"string\">prompt = no</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">[req_distinguished_name]</span></span><br><span class=\"line\"><span class=\"string\">CN = $&#123;SERVER_IP&#125;</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">[v3_req]</span></span><br><span class=\"line\"><span class=\"string\">keyUsage = keyEncipherment, dataEncipherment</span></span><br><span class=\"line\"><span class=\"string\">extendedKeyUsage = serverAuth</span></span><br><span class=\"line\"><span class=\"string\">subjectAltName = @alt_names</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">[alt_names]</span></span><br><span class=\"line\"><span class=\"string\">IP.1 = $&#123;SERVER_IP&#125;</span></span><br><span class=\"line\"><span class=\"string\">EOF</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;[+] åˆ›å»ºæœåŠ¡å™¨è¯ä¹¦ç­¾åè¯·æ±‚ (CSR)...&quot;</span></span><br><span class=\"line\">openssl req -new -key server-key.pem \\</span><br><span class=\"line\">  -out server.csr -config extfile.cnf</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;[+] ç­¾å‘æœåŠ¡å™¨è¯ä¹¦...&quot;</span></span><br><span class=\"line\">openssl x509 -req -days 365 -<span class=\"keyword\">in</span> server.csr \\</span><br><span class=\"line\">  -CA ca.pem -CAkey ca-key.pem -CAcreateserial \\</span><br><span class=\"line\">  -out server-cert.pem -extensions v3_req -extfile extfile.cnf</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;[+] åˆ›å»ºå®¢æˆ·ç«¯ç§é’¥...&quot;</span></span><br><span class=\"line\">openssl genrsa -out key.pem 4096</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;[+] åˆ›å»ºå®¢æˆ·ç«¯ CSR...&quot;</span></span><br><span class=\"line\">openssl req -new -key key.pem -subj <span class=\"string\">&quot;/CN=client&quot;</span> -out client.csr</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;[+] ç­¾å‘å®¢æˆ·ç«¯è¯ä¹¦...&quot;</span></span><br><span class=\"line\"><span class=\"built_in\">cat</span> &gt; client-ext.cnf &lt;&lt;<span class=\"string\">EOF</span></span><br><span class=\"line\"><span class=\"string\">extendedKeyUsage = clientAuth</span></span><br><span class=\"line\"><span class=\"string\">EOF</span></span><br><span class=\"line\"></span><br><span class=\"line\">openssl x509 -req -days 365 -<span class=\"keyword\">in</span> client.csr \\</span><br><span class=\"line\">  -CA ca.pem -CAkey ca-key.pem -CAcreateserial \\</span><br><span class=\"line\">  -out cert.pem -extfile client-ext.cnf</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;[âœ“] æ‰€æœ‰è¯ä¹¦ç”Ÿæˆå®Œæˆï¼&quot;</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot; æœåŠ¡å™¨è¯ä¹¦: server-cert.pem, server-key.pem&quot;</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot; å®¢æˆ·ç«¯è¯ä¹¦: cert.pem, key.pem&quot;</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot; CAæ ¹è¯ä¹¦:   ca.pem&quot;</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ‰§è¡Œè„šæœ¬</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">chmod</span> +x generate-docker-certs.sh</span><br><span class=\"line\">./generate-docker-certs.sh</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å°†ä»¥ä¸‹è¯ä¹¦æ–‡ä»¶éƒ¨ç½²åˆ°dockeræœåŠ¡ç«¯</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æœåŠ¡ç«¯ï¼šserver-cert.pem, server-key.pem, ca.pem</span></span><br><span class=\"line\"><span class=\"built_in\">cp</span> server-cert.pem /etc/docker/server-cert.pem</span><br><span class=\"line\"><span class=\"built_in\">cp</span> server-key.pem /etc/docker/server-key.pem</span><br><span class=\"line\"><span class=\"built_in\">cp</span> ca.pem /etc/docker/ca.pem</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å°†ä»¥ä¸‹è¯ä¹¦æ–‡ä»¶éƒ¨ç½²åˆ°dockerå®¢æˆ·ç«¯</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cert.pem, key.pem, ca.pem</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç¼–è¾‘ /etc/docker/daemon.json</p>\n</li>\n</ul>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;hosts&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">[</span><span class=\"string\">&quot;unix:///var/run/docker.sock&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;tcp://0.0.0.0:2376&quot;</span><span class=\"punctuation\">]</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;tlsverify&quot;</span><span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">true</span></span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;tlscacert&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;/etc/docker/ca.pem&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;tlscert&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;/etc/docker/server-cert.pem&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;tlskey&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;/etc/docker/server-key.pem&quot;</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç¦ç”¨ <code>-H fd://</code>ï¼ˆsystemd ä¸ daemon.json å†²çªçš„æ ¹æºï¼‰</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">sudo</span> <span class=\"built_in\">mkdir</span> -p /etc/systemd/system/docker.service.d</span><br><span class=\"line\"><span class=\"built_in\">sudo</span> vi /etc/systemd/system/docker.service.d/override.conf</span><br><span class=\"line\"><span class=\"comment\"># å¡«å…¥</span></span><br><span class=\"line\">[Service]</span><br><span class=\"line\">ExecStart=</span><br><span class=\"line\">ExecStart=/usr/bin/dockerd</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>é‡å¯ docker daemon</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">sudo</span> systemctl daemon-reload</span><br><span class=\"line\"><span class=\"built_in\">sudo</span> systemctl restart docker</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åœ¨å®¢æˆ·ç«¯æµ‹è¯•è¿æ¥</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker \\</span><br><span class=\"line\">  --tlsverify \\</span><br><span class=\"line\">  --tlscacert=ca.pem \\</span><br><span class=\"line\">  --tlscert=cert.pem \\</span><br><span class=\"line\">  --tlskey=key.pem \\</span><br><span class=\"line\">  -H tcp://166.189.9.114:2376 \\</span><br><span class=\"line\">  ps</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åŠ å…¥ç¯å¢ƒå˜é‡åå°±ä¸éœ€è¦æ¯æ¬¡éƒ½åŠ ä¸Š -H å‚æ•° å’Œè¯ä¹¦å‚æ•°äº†</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cat</span> &lt;&lt;<span class=\"string\">EOT &gt;&gt; ~/.bashrc</span></span><br><span class=\"line\"><span class=\"string\"># è¿œç¨‹Docker IPå’Œç«¯å£</span></span><br><span class=\"line\"><span class=\"string\">export DOCKER_HOST=tcp://166.189.9.114:2376</span></span><br><span class=\"line\"><span class=\"string\"># ç”¨äºé€šè¿‡ TLSï¼ˆSSLï¼‰å®‰å…¨è¿æ¥è¿œç¨‹ Docker å®ˆæŠ¤è¿›ç¨‹ï¼Œç±»ä¼¼äº docker --tlsverify</span></span><br><span class=\"line\"><span class=\"string\">export DOCKER_TLS_VERIFY=1</span></span><br><span class=\"line\"><span class=\"string\"># è¿™ä¸ªç›®å½•ä¸‹è¦æœ‰è¿™äº›è¯ä¹¦æ–‡ä»¶ï¼šca.pem, cert.pem, key.pem</span></span><br><span class=\"line\"><span class=\"string\">export DOCKER_CERT_PATH=/path/to/certs</span></span><br><span class=\"line\"><span class=\"string\">EOT</span></span><br><span class=\"line\"><span class=\"built_in\">source</span> ~/.bashrc</span><br><span class=\"line\"><span class=\"comment\"># æµ‹è¯•</span></span><br><span class=\"line\">docker ps</span><br></pre></td></tr></table></figure>\n<h3 id=\"æ–¹å¼ä¸‰ï¼šssh-éš§é“è®¿é—®ï¼ˆæ¨èï¼‰\">æ–¹å¼ä¸‰ï¼šssh:// éš§é“è®¿é—®ï¼ˆæ¨èï¼‰</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åŸºäºå¯†ç æˆ–å…å¯†è®¤è¯</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker -H ssh://user@host ps</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åŸºäºå¯†é’¥æ–‡ä»¶</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-6\">åœ¨ ~/.ssh/config ä¸­æŒ‡å®šå…·ä½“çš„å¯†é’¥æ–‡ä»¶</li>\n</ul>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Host mydocker</span><br><span class=\"line\">HostName 161.189.9.146</span><br><span class=\"line\">User centos</span><br><span class=\"line\">Port 22</span><br><span class=\"line\">IdentityFile ~/.ssh/my_docker_key</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-2\">\n<li class=\"lvl-6\">æµ‹è¯•</li>\n</ul>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker -H ssh://mydocker ps</span><br></pre></td></tr></table></figure>\n</li>\n<li class=\"lvl-2\">\n<p>æ·»åŠ ç¯å¢ƒå˜é‡é¿å…æ¯æ¬¡éƒ½åŠ ä¸Š -H å‚æ•°</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">## åŸºäºå¯†ç æˆ–å…å¯†è®¤è¯</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;export DOCKER_HOST=ssh://user@host&quot;</span> &gt;&gt; ~/.bashrc</span><br><span class=\"line\"><span class=\"comment\">## æˆ–è€…åŸºäºå¯†ç çš„æ–¹å¼</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;export DOCKER_HOST=ssh://mydocker&quot;</span> &gt;&gt; ~/.bashrc</span><br><span class=\"line\"><span class=\"built_in\">source</span> ~/.bashrc</span><br><span class=\"line\">docker ps</span><br></pre></td></tr></table></figure>\n<h2 id=\"ä¸‰ç§è¿œç¨‹è¿æ¥-Docker-çš„æ–¹å¼åŠå…¶ä¼˜ç¼ºç‚¹æ€»ç»“\">ä¸‰ç§è¿œç¨‹è¿æ¥ Docker çš„æ–¹å¼åŠå…¶ä¼˜ç¼ºç‚¹æ€»ç»“</h2>\n<table>\n<thead>\n<tr>\n<th>è¿æ¥æ–¹å¼</th>\n<th>ä¼˜ç‚¹</th>\n<th>ç¼ºç‚¹</th>\n<th>é€‚ç”¨åœºæ™¯</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>1. SSH æ–¹å¼ (<code>ssh://</code>)</strong></td>\n<td>- é…ç½®ç®€å•ï¼Œæ— éœ€é¢å¤–å¼€å¯ Docker TCP ç«¯å£å’Œ TLS<br>- å®‰å…¨æ€§é«˜ï¼ŒåŸºäº SSH åŠ å¯†å’Œè®¤è¯<br>- æ”¯æŒå¯†ç å’Œå¯†é’¥ç™»å½•<br>- ä¸ç”¨å¼€æ”¾é¢å¤–ç«¯å£ï¼Œé˜²ç«å¢™å‹å¥½<br>- æ˜“äºç”¨ SSH ä»£ç†å’Œå¯†é’¥ç®¡ç†</td>\n<td>- éœ€è¦è¿œç¨‹ç”¨æˆ·æœ‰ Docker æƒé™ï¼ˆå¦‚å±äº <code>docker</code> ç»„ï¼‰<br>- è¿æ¥é€Ÿåº¦å¯èƒ½å— SSH è¿æ¥å½±å“<br>- éœ€è¦åœ¨æœ¬åœ°å®‰è£…å¹¶é…ç½® SSH</td>\n<td>å¼€å‘ç¯å¢ƒã€å†…ç½‘ç®¡ç†ã€å°è§„æ¨¡è¿œç¨‹æ“ä½œ</td>\n</tr>\n<tr>\n<td><strong>2. TCP + TLS æ–¹å¼</strong></td>\n<td>- æ ‡å‡†çš„è¿œç¨‹ Docker API è®¿é—®<br>- æ”¯æŒè¯ä¹¦è®¤è¯ï¼Œå®‰å…¨æ€§é«˜<br>- å¯ä»¥é…ç½®å¤šä¸ªå®¢æˆ·ç«¯å’Œæƒé™æ§åˆ¶<br>- é€‚åˆè‡ªåŠ¨åŒ–è„šæœ¬ã€CI/CD è®¿é—®</td>\n<td>- é…ç½®è¾ƒå¤æ‚ï¼Œéœ€è¦ç”Ÿæˆå’Œç®¡ç† CAã€æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯è¯ä¹¦<br>- éœ€è¦å¼€æ”¾ TCP ç«¯å£ï¼ˆå¦‚ 2376ï¼‰ï¼Œå¢åŠ å®‰å…¨é£é™©<br>- è¯ä¹¦é…ç½®é”™è¯¯å®¹æ˜“å¯¼è‡´è¿æ¥å¤±è´¥</td>\n<td>ç”Ÿäº§ç¯å¢ƒã€è‡ªåŠ¨åŒ–é›†æˆã€éœ€è¦é«˜å®‰å…¨è®¤è¯</td>\n</tr>\n<tr>\n<td><strong>3. TCP æ˜æ–‡è®¿é—®ï¼ˆæ—  TLSï¼‰</strong></td>\n<td>- é…ç½®æœ€ç®€å•ï¼Œåªéœ€ç›‘å¬ TCP ç«¯å£<br>- æ–¹ä¾¿å¿«é€Ÿæµ‹è¯•å’Œè°ƒè¯•</td>\n<td>- æåº¦ä¸å®‰å…¨ï¼Œæ•°æ®æ˜æ–‡ä¼ è¾“<br>- ä»»ä½•äººéƒ½å¯è®¿é—® Docker APIï¼Œææ˜“è¢«æ”»å‡»<br>- ç”Ÿäº§ç¯å¢ƒä¸¥é‡ä¸å»ºè®®ä½¿ç”¨</td>\n<td>ä»…é™å±€åŸŸç½‘å†…æµ‹è¯•æˆ–æç®€ç¯å¢ƒ</td>\n</tr>\n</tbody>\n</table>\n","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç»å¦‚ä½•è¿œç¨‹è¿æ¥Docker Dockerå®˜æ–¹æ–‡æ¡£ è¿œç¨‹è¿æ¥Dockeræœ‰å¦‚ä¸‹ä¸‰ç§æ–¹å¼ æ–¹å¼ä¸€ï¼šå¼€å¯ TCPï¼ˆä¸å¸¦ TLSï¼Œä»…ç”¨äºå†…ç½‘è°ƒè¯•ï¼‰ å¼€å¯æ–¹å¼ ç¼–è¾‘ /etc/docker/daemon.jsonï¼ŒåŠ ä¸Šï¼š 123&#123; &quot;hosts&quot;: [&quot;unix:///var/run/docker.sock&quot;, &quot;tcp://0.0.0.0:2375&quot;]&#125; ç¦ç”¨ -H fd://ï¼ˆsystemd ä¸ daemon.json å†²çªçš„æ ¹æºï¼‰ 123456sudo mkdir -p /etc/systemd/system/docker.service.dsudo vi /etc/systemd/system/docker.service.d/override.conf# å¡«å…¥[Service]ExecStart=ExecStart=/usr/bin/dockerd é‡å¯ docker daemon 12sudo systemctl daemon-reloadsudo systemctl restart docker åœ¨å®¢æˆ·ç«¯æµ‹è¯•è¿æ¥ 1docker -H tcp://è¿œç¨‹IP:2375 ps åŠ å…¥ç¯å¢ƒå˜é‡åå°±ä¸éœ€è¦æ¯æ¬¡éƒ½åŠ ä¸Š -H å‚æ•°äº† 12345# zsh å°±æ¢æˆ ~/.zshrcecho &quot;export DOCKER_HOST=tcp://è¿œç¨‹IP:2376&quot; &gt;&gt; ~/.bashrcsource ~/.bashrc# æµ‹è¯•docker ps â—ä¸è¦å¼€å¯æ— è®¤è¯çš„ tcp://0.0.0.0:2375 åœ¨å…¬ç½‘ï¼Œè¿™æ˜¯è£¸å¥”çš„å®‰å…¨é£é™©ï¼Œä»»ä½•äººéƒ½èƒ½æ§åˆ¶ä½ çš„ Dockerã€‚ âœ… æ¨èæ–¹å¼æ˜¯ï¼š ä½¿ç”¨ tcp://0.0.0.0:2376 + --tlsverify æˆ–é€šè¿‡ ssh:// éš§é“è®¿é—® Docker æ–¹å¼äºŒï¼šå¼€å¯ TCP + TLS å®‰å…¨è®¿é—®ï¼ˆæ¨èç”¨äºå…¬ç½‘ï¼‰ åˆ›å»º TLS è¯ä¹¦ï¼Œé€šè¿‡ä¸€ä¸ªè„šæœ¬å®ç°ï¼Œè„šæœ¬åç§° generate-docker-certs.sh 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162#!/bin/bashset -eSERVER_IP=166.189.9.114 # ğŸš¨ ä¿®æ”¹ä¸ºä½ çš„ Docker æœåŠ¡å™¨ IP æˆ–åŸŸåecho &quot;[+] åˆ›å»º CA...&quot;openssl genrsa -out ca-key.pem 4096openssl req -new -x509 -days 365 \\ -key ca-key.pem -subj &quot;/CN=docker-ca&quot; -out ca.pemecho &quot;[+] åˆ›å»ºæœåŠ¡å™¨ç§é’¥...&quot;openssl genrsa -out server-key.pem 4096echo &quot;[+] åˆ›å»º OpenSSL é…ç½®æ–‡ä»¶...&quot;cat &gt; extfile.cnf &lt;&lt;EOF[req]distinguished_name = req_distinguished_namex509_extensions = v3_reqprompt = no[req_distinguished_name]CN = $&#123;SERVER_IP&#125;[v3_req]keyUsage = keyEncipherment, dataEnciphermentextendedKeyUsage = serverAuthsubjectAltName = @alt_names[alt_names]IP.1 = $&#123;SERVER_IP&#125;EOFecho &quot;[+] åˆ›å»ºæœåŠ¡å™¨è¯ä¹¦ç­¾åè¯·æ±‚ (CSR)...&quot;openssl req -new -key server-key.pem \\ -out server.csr -config extfile.cnfecho &quot;[+] ç­¾å‘æœåŠ¡å™¨è¯ä¹¦...&quot;openssl x509 -req -days 365 -in server.csr \\ -CA ca.pem -CAkey ca-key.pem -CAcreateserial \\ -out server-cert.pem -extensions v3_req -extfile extfile.cnfecho &quot;[+] åˆ›å»ºå®¢æˆ·ç«¯ç§é’¥...&quot;openssl genrsa -out key.pem 4096echo &quot;[+] åˆ›å»ºå®¢æˆ·ç«¯ CSR...&quot;openssl req -new -key key.pem -subj &quot;/CN=client&quot; -out client.csrecho &quot;[+] ç­¾å‘å®¢æˆ·ç«¯è¯ä¹¦...&quot;cat &gt; client-ext.cnf &lt;&lt;EOFextendedKeyUsage = clientAuthEOFopenssl x509 -req -days 365 -in client.csr \\ -CA ca.pem -CAkey ca-key.pem -CAcreateserial \\ -out cert.pem -extfile client-ext.cnfecho &quot;[âœ“] æ‰€æœ‰è¯ä¹¦ç”Ÿæˆå®Œæˆï¼&quot;echoecho &quot; æœåŠ¡å™¨è¯ä¹¦: server-cert.pem, server-key.pem&quot;echo &quot; å®¢æˆ·ç«¯è¯ä¹¦: cert.pem, key.pem&quot;echo &quot; CAæ ¹è¯ä¹¦: ca.pem&quot; æ‰§è¡Œè„šæœ¬ 12chmod +x generate-docker-certs.sh./generate-docker-certs.sh å°†ä»¥ä¸‹è¯ä¹¦æ–‡ä»¶éƒ¨ç½²åˆ°dockeræœåŠ¡ç«¯ 1234# æœåŠ¡ç«¯ï¼šserver-cert.pem, server-key.pem, ca.pemcp server-cert.pem /etc/docker/server-cert.pemcp server-key.pem /etc/docker/server-key.pemcp ca.pem /etc/docker/ca.pem å°†ä»¥ä¸‹è¯ä¹¦æ–‡ä»¶éƒ¨ç½²åˆ°dockerå®¢æˆ·ç«¯ 1cert.pem, key.pem, ca.pem ç¼–è¾‘ /etc/docker/daemon.json 1234567&#123; &quot;hosts&quot;: [&quot;unix:///var/run/docker.sock&quot;, &quot;tcp://0.0.0.0:2376&quot;], &quot;tlsverify&quot;: true, &quot;tlscacert&quot;: &quot;/etc/docker/ca.pem&quot;, &quot;tlscert&quot;: &quot;/etc/docker/server-cert.pem&quot;, &quot;tlskey&quot;: &quot;/etc/docker/server-key.pem&quot;&#125; ç¦ç”¨ -H fd://ï¼ˆsystemd ä¸ daemon.json å†²çªçš„æ ¹æºï¼‰ 123456sudo mkdir -p /etc/systemd/system/docker.service.dsudo vi /etc/systemd/system/docker.service.d/override.conf# å¡«å…¥[Service]ExecStart=ExecStart=/usr/bin/dockerd é‡å¯ docker daemon 12sudo systemctl daemon-reloadsudo systemctl restart docker åœ¨å®¢æˆ·ç«¯æµ‹è¯•è¿æ¥ 1234567docker \\ --tlsverify \\ --tlscacert=ca.pem \\ --tlscert=cert.pem \\ --tlskey=key.pem \\ -H tcp://166.189.9.114:2376 \\ ps åŠ å…¥ç¯å¢ƒå˜é‡åå°±ä¸éœ€è¦æ¯æ¬¡éƒ½åŠ ä¸Š -H å‚æ•° å’Œè¯ä¹¦å‚æ•°äº† 1234567891011cat &lt;&lt;EOT &gt;&gt; ~/.bashrc# è¿œç¨‹Docker IPå’Œç«¯å£export DOCKER_HOST=tcp://166.189.9.114:2376# ç”¨äºé€šè¿‡ TLSï¼ˆSSLï¼‰å®‰å…¨è¿æ¥è¿œç¨‹ Docker å®ˆæŠ¤è¿›ç¨‹ï¼Œç±»ä¼¼äº docker --tlsverifyexport DOCKER_TLS_VERIFY=1# è¿™ä¸ªç›®å½•ä¸‹è¦æœ‰è¿™äº›è¯ä¹¦æ–‡ä»¶ï¼šca.pem, cert.pem, key.pemexport DOCKER_CERT_PATH=/path/to/certsEOTsource ~/.bashrc# æµ‹è¯•docker ps æ–¹å¼ä¸‰ï¼šssh:// éš§é“è®¿é—®ï¼ˆæ¨èï¼‰ åŸºäºå¯†ç æˆ–å…å¯†è®¤è¯ 1docker -H ssh://user@host ps åŸºäºå¯†é’¥æ–‡ä»¶ åœ¨ ~/.ssh/config ä¸­æŒ‡å®šå…·ä½“çš„å¯†é’¥æ–‡ä»¶ 12345Host mydockerHostName 161.189.9.146User centosPort 22IdentityFile ~/.ssh/my_docker_key æµ‹è¯• 1docker -H ssh://mydocker ps æ·»åŠ ç¯å¢ƒå˜é‡é¿å…æ¯æ¬¡éƒ½åŠ ä¸Š -H å‚æ•° 123456## åŸºäºå¯†ç æˆ–å…å¯†è®¤è¯echo &quot;export DOCKER_HOST=ssh://user@host&quot; &gt;&gt; ~/.bashrc## æˆ–è€…åŸºäºå¯†ç çš„æ–¹å¼echo &quot;export DOCKER_HOST=ssh://mydocker&quot; &gt;&gt; ~/.bashrcsource ~/.bashrcdocker ps ä¸‰ç§è¿œç¨‹è¿æ¥ Docker çš„æ–¹å¼åŠå…¶ä¼˜ç¼ºç‚¹æ€»ç»“ è¿æ¥æ–¹å¼ ä¼˜ç‚¹ ç¼ºç‚¹ é€‚ç”¨åœºæ™¯ 1. SSH æ–¹å¼ (ssh://) - é…ç½®ç®€å•ï¼Œæ— éœ€é¢å¤–å¼€å¯ Docker TCP ç«¯å£å’Œ TLS- å®‰å…¨æ€§é«˜ï¼ŒåŸºäº SSH åŠ å¯†å’Œè®¤è¯- æ”¯æŒå¯†ç å’Œå¯†é’¥ç™»å½•- ä¸ç”¨å¼€æ”¾é¢å¤–ç«¯å£ï¼Œé˜²ç«å¢™å‹å¥½- æ˜“äºç”¨ SSH ä»£ç†å’Œå¯†é’¥ç®¡ç† - éœ€è¦è¿œç¨‹ç”¨æˆ·æœ‰ Docker æƒé™ï¼ˆå¦‚å±äº docker ç»„ï¼‰- è¿æ¥é€Ÿåº¦å¯èƒ½å— SSH è¿æ¥å½±å“- éœ€è¦åœ¨æœ¬åœ°å®‰è£…å¹¶é…ç½® SSH å¼€å‘ç¯å¢ƒã€å†…ç½‘ç®¡ç†ã€å°è§„æ¨¡è¿œç¨‹æ“ä½œ 2. TCP + TLS æ–¹å¼ - æ ‡å‡†çš„è¿œç¨‹ Docker API è®¿é—®- æ”¯æŒè¯ä¹¦è®¤è¯ï¼Œå®‰å…¨æ€§é«˜- å¯ä»¥é…ç½®å¤šä¸ªå®¢æˆ·ç«¯å’Œæƒé™æ§åˆ¶- é€‚åˆè‡ªåŠ¨åŒ–è„šæœ¬ã€CI/CD è®¿é—® - é…ç½®è¾ƒå¤æ‚ï¼Œéœ€è¦ç”Ÿæˆå’Œç®¡ç† CAã€æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯è¯ä¹¦- éœ€è¦å¼€æ”¾ TCP ç«¯å£ï¼ˆå¦‚ 2376ï¼‰ï¼Œå¢åŠ å®‰å…¨é£é™©- è¯ä¹¦é…ç½®é”™è¯¯å®¹æ˜“å¯¼è‡´è¿æ¥å¤±è´¥ ç”Ÿäº§ç¯å¢ƒã€è‡ªåŠ¨åŒ–é›†æˆã€éœ€è¦é«˜å®‰å…¨è®¤è¯ 3. TCP æ˜æ–‡è®¿é—®ï¼ˆæ—  TLSï¼‰ - é…ç½®æœ€ç®€å•ï¼Œåªéœ€ç›‘å¬ TCP ç«¯å£- æ–¹ä¾¿å¿«é€Ÿæµ‹è¯•å’Œè°ƒè¯• - æåº¦ä¸å®‰å…¨ï¼Œæ•°æ®æ˜æ–‡ä¼ è¾“- ä»»ä½•äººéƒ½å¯è®¿é—® Docker APIï¼Œææ˜“è¢«æ”»å‡»- ç”Ÿäº§ç¯å¢ƒä¸¥é‡ä¸å»ºè®®ä½¿ç”¨ ä»…é™å±€åŸŸç½‘å†…æµ‹è¯•æˆ–æç®€ç¯å¢ƒ","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç»å¦‚ä½•è¿œç¨‹è¿æ¥Docker Dockerå®˜æ–¹æ–‡æ¡£","date_published":"2025-06-05T13:30:05.000Z","tags":["æŠ€æœ¯","docker","docker"]},{"id":"https://blog.hanqunfeng.com/2025/06/04/docker-compose/","url":"https://blog.hanqunfeng.com/2025/06/04/docker-compose/","title":"Docker å‘½ä»¤ ä¹‹ docker compose","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç» Docker å‘½ä»¤ ä¸­ <code>docker compose</code> çš„ä½¿ç”¨æ–¹æ³•</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://docs.docker.com\">Dockerå®˜æ–¹æ–‡æ¡£</a></p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://docs.docker.com/compose/\">docker compose</a></p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://docs.docker.com/reference/compose-file/\">Compose file reference</a></p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"docker-compose-æ˜¯ä»€ä¹ˆï¼Ÿ\"><code>docker compose</code> æ˜¯ä»€ä¹ˆï¼Ÿ</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Docker Composeæ˜¯ä¸€ä¸ªç”¨äºå®šä¹‰å’Œè¿è¡Œå¤šå®¹å™¨åº”ç”¨ç¨‹åºçš„å·¥å…·ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>Composeç®€åŒ–äº†å¯¹æ•´ä¸ªåº”ç”¨ç¨‹åºå †æ ˆçš„æ§åˆ¶ï¼Œä¾¿äºåœ¨å•ä¸ªYAMLé…ç½®æ–‡ä»¶ä¸­ç®¡ç†æœåŠ¡ã€ç½‘ç»œå’Œå·ã€‚ç„¶åï¼Œé€šè¿‡ä¸€ä¸ªå‘½ä»¤ï¼Œæ‚¨ä»é…ç½®æ–‡ä»¶ä¸­åˆ›å»ºå¹¶å¯åŠ¨æ‰€æœ‰æœåŠ¡ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>Docker Compose çš„ä¼˜åŠ¿ï¼š</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>ä¼˜ç‚¹</th>\n<th>æè¿°</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>ç®€åŒ–æ§åˆ¶</td>\n<td>Docker Compose å…è®¸åœ¨å•ä¸ª YAML æ–‡ä»¶ä¸­å®šä¹‰å’Œç®¡ç†å¤šå®¹å™¨åº”ç”¨ç¨‹åºï¼Œç®€åŒ–äº†æœåŠ¡ç¼–æ’ä¸åè°ƒï¼Œä½¿ç¯å¢ƒç®¡ç†å’Œå¤åˆ¶æ›´å®¹æ˜“ã€‚</td>\n</tr>\n<tr>\n<td>é«˜æ•ˆçš„åä½œ</td>\n<td>é…ç½®æ–‡ä»¶æ˜“äºå…±äº«ï¼Œä¿ƒè¿›å¼€å‘äººå‘˜ã€è¿è¥å›¢é˜Ÿå’Œå…¶ä»–åˆ©ç›Šç›¸å…³è€…ä¹‹é—´çš„åä½œï¼Œä»è€Œæå‡å·¥ä½œæµç¨‹æ•ˆç‡å’Œé—®é¢˜è§£å†³é€Ÿåº¦ã€‚</td>\n</tr>\n<tr>\n<td>å¿«é€Ÿåº”ç”¨ç¨‹åºå¼€å‘</td>\n<td>Compose åˆ©ç”¨ç¼“å­˜é‡å¤ä½¿ç”¨æœªæ›´æ”¹æœåŠ¡çš„å®¹å™¨ï¼ŒåŠ å¿«ç¯å¢ƒå˜æ›´é€Ÿåº¦ï¼Œæé«˜å¼€å‘æ•ˆç‡ã€‚</td>\n</tr>\n<tr>\n<td>è·¨ç¯å¢ƒçš„å¯ç§»æ¤æ€§</td>\n<td>æ”¯æŒåœ¨ Compose æ–‡ä»¶ä¸­ä½¿ç”¨å˜é‡ï¼Œä½¿é…ç½®èƒ½æ ¹æ®ä¸åŒç¯å¢ƒæˆ–ç”¨æˆ·è¿›è¡Œè‡ªå®šä¹‰ï¼Œå¢å¼ºäº†å¯ç§»æ¤æ€§ã€‚</td>\n</tr>\n<tr>\n<td>å¹¿æ³›çš„ç¤¾åŒºå’Œæ”¯æŒ</td>\n<td>æ‹¥æœ‰æ´»è·ƒçš„ç¤¾åŒºï¼Œæä¾›ä¸°å¯Œçš„èµ„æºã€æ•™ç¨‹å’ŒæŠ€æœ¯æ”¯æŒï¼Œæœ‰åŠ©äºæŒç»­æ”¹è¿›ä¸é«˜æ•ˆæ’éšœã€‚</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"docker-compose-å®‰è£…\"><code>docker compose</code> å®‰è£…</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åŒdockerä¸€èµ·å®‰è£…</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å®‰è£…dockeråŒæ—¶å®‰è£…docker composeï¼Œè¿™é‡Œ docker-compose-plugin å°±æ˜¯docker compose</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> dnf install docker-ce-3:26.1.3-1.el8 docker-ce-cli-3:26.1.3-1.el8 containerd.io docker-buildx-plugin docker-compose-plugin -y</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å•ç‹¬å®‰è£…</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># è‹¥å®‰è£…dockeræ—¶æ²¡æœ‰å®‰è£… docker-compose-plugin ï¼Œåˆ™éœ€è¦å•ç‹¬å®‰è£…</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> dnf install docker-compose-plugin -y</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æŸ¥çœ‹ç‰ˆæœ¬</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker compose version</span><br></pre></td></tr></table></figure>\n<div class=\"tips\">\n<p><em><strong>ç›´æ¥ä¸‹è½½docker-composeçš„å‘½ä»¤æ–‡ä»¶</strong></em></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Install Docker Composeï¼Œæ³¨æ„é€šè¿‡è¿™ç§æ–¹å¼å®‰è£…çš„composeçš„ä½¿ç”¨æ–¹å¼ä¸º `docker-compose`ï¼Œè€Œéæ ‡å‡†çš„ `docker compose`</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> curl -L <span class=\"string\">&quot;https://github.com/docker/compose/releases/latest/download/docker-compose-<span class=\"subst\">$(uname -s)</span>-<span class=\"subst\">$(uname -m)</span>&quot;</span> -o /usr/local/bin/docker-compose</span><br><span class=\"line\"><span class=\"comment\"># Make the docker-compose command available</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> <span class=\"built_in\">chmod</span> +x /usr/local/bin/docker-compose</span><br><span class=\"line\"><span class=\"comment\"># Check Docker Compose version</span></span><br><span class=\"line\">docker-compose version</span><br></pre></td></tr></table></figure>\n</div>\n<h2 id=\"docker-compose-å‘½ä»¤\"><code>docker compose</code> å‘½ä»¤</h2>\n<table>\n<thead>\n<tr>\n<th>å‘½ä»¤</th>\n<th>ä¸­æ–‡è¯´æ˜</th>\n<th>ç¤ºä¾‹</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>attach</td>\n<td>è¿æ¥åˆ°æœåŠ¡çš„è¿è¡Œä¸­å®¹å™¨çš„æ ‡å‡†è¾“å…¥ã€è¾“å‡ºå’Œé”™è¯¯æµ</td>\n<td><code>docker compose attach web</code></td>\n</tr>\n<tr>\n<td>build</td>\n<td>æ„å»ºæˆ–é‡æ–°æ„å»ºæœåŠ¡</td>\n<td><code>docker compose build</code></td>\n</tr>\n<tr>\n<td>config</td>\n<td>è§£æå¹¶æ ‡å‡†åŒ– Compose æ–‡ä»¶</td>\n<td><code>docker compose config</code></td>\n</tr>\n<tr>\n<td>cp</td>\n<td>åœ¨æœåŠ¡å®¹å™¨ä¸æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿä¹‹é—´å¤åˆ¶æ–‡ä»¶/æ–‡ä»¶å¤¹</td>\n<td><code>docker compose cp web:/app/file.txt ./file.txt</code></td>\n</tr>\n<tr>\n<td>create</td>\n<td>ä¸ºæœåŠ¡åˆ›å»ºå®¹å™¨ï¼Œä½†ä¸å¯åŠ¨</td>\n<td><code>docker compose create</code></td>\n</tr>\n<tr>\n<td>down</td>\n<td>åœæ­¢å¹¶ç§»é™¤å®¹å™¨ã€ç½‘ç»œç­‰èµ„æº</td>\n<td><code>docker compose down</code></td>\n</tr>\n<tr>\n<td>events</td>\n<td>å®æ—¶æ¥æ”¶å®¹å™¨äº‹ä»¶</td>\n<td><code>docker compose events</code></td>\n</tr>\n<tr>\n<td>exec</td>\n<td>åœ¨è¿è¡Œä¸­çš„å®¹å™¨ä¸­æ‰§è¡Œå‘½ä»¤</td>\n<td><code>docker compose exec web ls /app</code></td>\n</tr>\n<tr>\n<td>images</td>\n<td>åˆ—å‡ºå·²åˆ›å»ºå®¹å™¨æ‰€ä½¿ç”¨çš„é•œåƒ</td>\n<td><code>docker compose images</code></td>\n</tr>\n<tr>\n<td>kill</td>\n<td>å¼ºåˆ¶åœæ­¢æœåŠ¡å®¹å™¨</td>\n<td><code>docker compose kill</code></td>\n</tr>\n<tr>\n<td>logs</td>\n<td>æŸ¥çœ‹æœåŠ¡å®¹å™¨çš„æ—¥å¿—è¾“å‡º</td>\n<td><code>docker compose logs</code></td>\n</tr>\n<tr>\n<td>ls</td>\n<td>åˆ—å‡ºå½“å‰è¿è¡Œçš„ Compose é¡¹ç›®</td>\n<td><code>docker compose ls</code></td>\n</tr>\n<tr>\n<td>pause</td>\n<td>æš‚åœæœåŠ¡å®¹å™¨</td>\n<td><code>docker compose pause</code></td>\n</tr>\n<tr>\n<td>port</td>\n<td>æ˜¾ç¤ºæŸç«¯å£æ˜ å°„çš„å…¬ç½‘åœ°å€</td>\n<td><code>docker compose port web 80</code></td>\n</tr>\n<tr>\n<td>ps</td>\n<td>åˆ—å‡ºæœåŠ¡çš„å®¹å™¨</td>\n<td><code>docker compose ps</code></td>\n</tr>\n<tr>\n<td>pull</td>\n<td>æ‹‰å–æœåŠ¡ä½¿ç”¨çš„é•œåƒ</td>\n<td><code>docker compose pull</code></td>\n</tr>\n<tr>\n<td>push</td>\n<td>æ¨é€æœåŠ¡é•œåƒåˆ°ä»“åº“</td>\n<td><code>docker compose push</code></td>\n</tr>\n<tr>\n<td>restart</td>\n<td>é‡å¯æœåŠ¡å®¹å™¨</td>\n<td><code>docker compose restart</code></td>\n</tr>\n<tr>\n<td>rm</td>\n<td>ç§»é™¤å·²åœæ­¢çš„æœåŠ¡å®¹å™¨</td>\n<td><code>docker compose rm</code></td>\n</tr>\n<tr>\n<td>run</td>\n<td>åœ¨æœåŠ¡ä¸Šè¿è¡Œä¸€æ¬¡æ€§å‘½ä»¤</td>\n<td><code>docker compose run web echo Hello</code></td>\n</tr>\n<tr>\n<td>scale</td>\n<td>æ‰©å±•æœåŠ¡å®ä¾‹æ•°é‡</td>\n<td><code>docker compose up --scale web=3</code></td>\n</tr>\n<tr>\n<td>start</td>\n<td>å¯åŠ¨å·²å­˜åœ¨ä½†å·²åœæ­¢çš„æœåŠ¡å®¹å™¨</td>\n<td><code>docker compose start</code></td>\n</tr>\n<tr>\n<td>stats</td>\n<td>å®æ—¶æ˜¾ç¤ºå®¹å™¨èµ„æºä½¿ç”¨æƒ…å†µ</td>\n<td><code>docker compose stats</code></td>\n</tr>\n<tr>\n<td>stop</td>\n<td>åœæ­¢è¿è¡Œä¸­çš„æœåŠ¡å®¹å™¨</td>\n<td><code>docker compose stop</code></td>\n</tr>\n<tr>\n<td>top</td>\n<td>æ˜¾ç¤ºå®¹å™¨å†…çš„è¿è¡Œè¿›ç¨‹</td>\n<td><code>docker compose top</code></td>\n</tr>\n<tr>\n<td>unpause</td>\n<td>å–æ¶ˆæš‚åœæœåŠ¡å®¹å™¨</td>\n<td><code>docker compose unpause</code></td>\n</tr>\n<tr>\n<td>up</td>\n<td>åˆ›å»ºå¹¶å¯åŠ¨æœåŠ¡å®¹å™¨</td>\n<td><code>docker compose up</code></td>\n</tr>\n<tr>\n<td>version</td>\n<td>æ˜¾ç¤º Docker Compose ç‰ˆæœ¬ä¿¡æ¯</td>\n<td><code>docker compose version</code></td>\n</tr>\n<tr>\n<td>wait</td>\n<td>é˜»å¡ç›´åˆ°ç¬¬ä¸€ä¸ªæœåŠ¡å®¹å™¨åœæ­¢</td>\n<td><code>docker compose wait</code></td>\n</tr>\n<tr>\n<td>watch</td>\n<td>ç›‘å¬æœåŠ¡æ„å»ºä¸Šä¸‹æ–‡å˜æ›´å¹¶é‡æ–°æ„å»º/åˆ·æ–°å®¹å™¨</td>\n<td><code>docker compose watch</code></td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"docker-compose-å¸¸ç”¨å‘½ä»¤\"><code>docker compose</code> å¸¸ç”¨å‘½ä»¤</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¯åŠ¨ä¸å…³é—­</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å¯åŠ¨å¹¶è¿è¡Œï¼Œé»˜è®¤ä½¿ç”¨å½“å‰ç›®å½•çš„ docker-compose.yml æ–‡ä»¶</span></span><br><span class=\"line\">docker compose up</span><br><span class=\"line\"><span class=\"comment\"># åå°è¿è¡Œ</span></span><br><span class=\"line\">docker compose up -d</span><br><span class=\"line\"><span class=\"comment\"># æŒ‡å®šcomposeæ–‡ä»¶</span></span><br><span class=\"line\">docker compose -f docker-compose.yml up -d</span><br><span class=\"line\"><span class=\"comment\"># å¯åŠ¨æ—¶é‡å»ºæœåŠ¡ï¼Œå½“ä¿®æ”¹äº† compose æ–‡ä»¶æ—¶</span></span><br><span class=\"line\">docker compose up --build</span><br><span class=\"line\"><span class=\"comment\"># åœæ­¢service</span></span><br><span class=\"line\">docker compose stop</span><br><span class=\"line\"><span class=\"comment\"># å¼ºåˆ¶åœæ­¢serviceï¼Œå½“ stop å‘½ä»¤æ— æ³•åœæ­¢æ—¶</span></span><br><span class=\"line\">docker compose <span class=\"built_in\">kill</span></span><br><span class=\"line\"><span class=\"comment\"># é‡å¯service</span></span><br><span class=\"line\">docker compose restart</span><br><span class=\"line\"><span class=\"comment\"># åˆ é™¤serviceï¼Œ-s å‚æ•°è¡¨ç¤ºåˆ é™¤å‰å…ˆåœæ­¢å®¹å™¨</span></span><br><span class=\"line\">docker compose <span class=\"built_in\">rm</span> -s</span><br><span class=\"line\"><span class=\"comment\"># åœæ­¢å¹¶åˆ é™¤serviceï¼ŒåŒæ—¶åˆ é™¤ç½‘ç»œï¼Œä½†ä¸ä¼šåˆ é™¤å·</span></span><br><span class=\"line\">docker compose down</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç›‘æ§</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åˆ—å‡ºå½“å‰è¿è¡Œçš„ Compose é¡¹ç›®</span></span><br><span class=\"line\">docker compose <span class=\"built_in\">ls</span></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹serviceçŠ¶æ€ï¼Œ-a æ˜¾ç¤ºæ‰€æœ‰service</span></span><br><span class=\"line\">docker compose ps -a</span><br><span class=\"line\"><span class=\"comment\"># è§£æå¹¶æ ‡å‡†åŒ– compose æ–‡ä»¶ï¼Œè¿™ä¸ªå‘½ä»¤å¯ä»¥æ£€æŸ¥ docker-compose.yml æ–‡ä»¶è¯­æ³•æ˜¯å¦æ­£ç¡®</span></span><br><span class=\"line\">docker compose config</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹ä½¿ç”¨çš„é•œåƒ</span></span><br><span class=\"line\">docker compose images</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹è¿›ç¨‹</span></span><br><span class=\"line\">docker compose top</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹serviceèµ„æºä½¿ç”¨æƒ…å†µ</span></span><br><span class=\"line\">docker compose stats</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹serviceæ—¥å¿—ï¼Œ-f è¡¨ç¤ºæŒç»­è·Ÿè¸ª</span></span><br><span class=\"line\">docker compose logs -f</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹æŒ‡å®šserviceçš„æ—¥å¿—</span></span><br><span class=\"line\">docker compose logs -f service_name</span><br><span class=\"line\"><span class=\"comment\"># è¿›å…¥æŒ‡å®šçš„serviceå®¹å™¨</span></span><br><span class=\"line\">docker compose <span class=\"built_in\">exec</span> service_name bash</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å‡çº§é•œåƒ</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å…ˆåœæ­¢æ‰€æœ‰service</span></span><br><span class=\"line\">docker compose down</span><br><span class=\"line\"><span class=\"comment\"># æ‹‰å–æœ€æ–°é•œåƒ</span></span><br><span class=\"line\">docker compose pull</span><br><span class=\"line\"><span class=\"comment\"># å¯åŠ¨service</span></span><br><span class=\"line\">docker compose up -d --build</span><br></pre></td></tr></table></figure>\n<h2 id=\"docker-compose-yml-çš„è¯­æ³•\"><code>docker-compose.yml</code> çš„è¯­æ³•</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¸¸ç”¨æŒ‡ä»¤</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">version: <span class=\"string\">&quot;3.8&quot;</span> <span class=\"comment\"># å®šä¹‰ç‰ˆæœ¬ï¼Œè¡¨ç¤ºå½“å‰ä½¿ç”¨çš„ docker compose è¯­æ³•çš„ç‰ˆæœ¬ï¼Œå·²è¿‡æ—¶ ï¼Œæ–°ç‰ˆ Docker ä¼šä½¿ç”¨æœ€æ–°çš„ Compose Specification è‡ªåŠ¨è§£æ</span></span><br><span class=\"line\">name: <span class=\"string\">&quot;project_name&quot;</span> <span class=\"comment\">#  é¡¹ç›®åï¼Œé»˜è®¤ docker-compose.yml æ–‡ä»¶æ‰€åœ¨çš„ç›®å½•åï¼Œä¸æ¨èè®¾ç½®</span></span><br><span class=\"line\">services: <span class=\"comment\"># æœåŠ¡åˆ—è¡¨</span></span><br><span class=\"line\">  servicename: <span class=\"comment\"># æœåŠ¡åå­—ï¼Œåªèƒ½åŒ…å«å°å†™å­—æ¯ã€æ•°å­—ã€ä¸‹åˆ’çº¿ã€ä¸­åˆ’çº¿ï¼Œå¿…é¡»ä»¥å­—æ¯æˆ–æ•°å­—å¼€å¤´</span></span><br><span class=\"line\">    build: <span class=\"comment\"># åŸºäºDockerfileæ„å»ºç›®å½•ï¼Œå¦‚æœåŒæ—¶è®¾ç½®äº† image é€‰é¡¹ï¼Œåˆ™imageæŒ‡å®šçš„å°±æ˜¯æ„å»ºåçš„é•œåƒåç§°</span></span><br><span class=\"line\">    image: <span class=\"comment\"># é•œåƒçš„åå­—ï¼Œé»˜è®¤ä»è¿œç¨‹ä»“åº“æ‹‰å–ï¼Œå¦‚æœé…ç½®äº† build é€‰é¡¹ï¼Œåˆ™imageæŒ‡å®šçš„å°±æ˜¯æ„å»ºåçš„é•œåƒåç§°</span></span><br><span class=\"line\">    <span class=\"built_in\">command</span>: <span class=\"comment\"># å¯é€‰ï¼Œå¦‚æœè®¾ç½®ï¼Œåˆ™ä¼šè¦†ç›–é»˜è®¤é•œåƒé‡Œçš„ CMD å‘½ä»¤</span></span><br><span class=\"line\">    environment: <span class=\"comment\"># å¯é€‰ï¼Œç­‰ä»·äº docker container run é‡Œçš„ --env é€‰é¡¹è®¾ç½®ç¯å¢ƒå˜é‡</span></span><br><span class=\"line\">    volumes: <span class=\"comment\"># å¯é€‰ï¼Œç­‰ä»·äº docker container run é‡Œçš„ -v é€‰é¡¹ ç»‘å®šæ•°æ®å·</span></span><br><span class=\"line\">    networks: <span class=\"comment\"># å¯é€‰ï¼Œç­‰ä»·äº docker container run é‡Œçš„ --network é€‰é¡¹æŒ‡å®šç½‘ç»œ</span></span><br><span class=\"line\">    ports: <span class=\"comment\"># å¯é€‰ï¼Œç­‰ä»·äº docker container run é‡Œçš„ -p é€‰é¡¹æŒ‡å®šç«¯å£æ˜ å°„</span></span><br><span class=\"line\">    expose: <span class=\"comment\"># å¯é€‰ï¼ŒæŒ‡å®šå®¹å™¨æš´éœ²çš„ç«¯å£</span></span><br><span class=\"line\">    depends_on: <span class=\"comment\"># æœåŠ¡ä¾èµ–çš„å…¶å®ƒæœåŠ¡</span></span><br><span class=\"line\">    env_file: <span class=\"comment\"># ç¯å¢ƒå˜é‡æ–‡ä»¶ï¼Œç”Ÿäº§ç¯å¢ƒæ›´æ¨èè¿™ç§æ–¹å¼</span></span><br><span class=\"line\">  servicename2:</span><br><span class=\"line\">    image:</span><br><span class=\"line\">    <span class=\"built_in\">command</span>:</span><br><span class=\"line\">    networks:</span><br><span class=\"line\">    ports:</span><br><span class=\"line\">  servicename3:</span><br><span class=\"line\">    <span class=\"comment\">#...</span></span><br><span class=\"line\"></span><br><span class=\"line\">volumes: <span class=\"comment\"># å¯é€‰ï¼Œç­‰ä»·äº docker volume create</span></span><br><span class=\"line\">networks: <span class=\"comment\"># å¯é€‰ï¼Œç­‰ä»·äº docker network create</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"volumes\">volumes</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å·æ˜¯ç”±å®¹å™¨å¼•æ“å®ç°çš„æŒä¹…æ•°æ®å­˜å‚¨ã€‚Compose ä¸ºæœåŠ¡æä¾›äº†ä¸€ç§ä¸­ç«‹çš„æŒ‚è½½å·çš„æ–¹å¼ï¼Œå¹¶é€šè¿‡é…ç½®å‚æ•°å°†å·åˆ†é…ç»™åŸºç¡€æ¶æ„ã€‚é¡¶çº§volumeså£°æ˜å…è®¸æ‚¨é…ç½®å¯åœ¨å¤šä¸ªæœåŠ¡ä¹‹é—´é‡å¤ä½¿ç”¨çš„å‘½åå·ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">services:</span></span><br><span class=\"line\">  <span class=\"attr\">backend:</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">example/database</span></span><br><span class=\"line\">    <span class=\"attr\">volumes:</span> <span class=\"comment\"># æŒ‚è½½å·æ˜ å°„</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">db-data:/etc/data</span> <span class=\"comment\"># æŒ‚è½½åˆ°å®¹å™¨çš„/etc/dataç›®å½•</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"attr\">backup:</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">backup-service</span></span><br><span class=\"line\">    <span class=\"attr\">volumes:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">db-data:/var/lib/backup/data</span> <span class=\"comment\"># ä¸€ä¸ªå·å¯ä»¥è¢«å¤šä¸ªæœåŠ¡ä½¿ç”¨</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">volumes:</span> <span class=\"comment\"># å­˜å‚¨å·é…ç½®</span></span><br><span class=\"line\">  <span class=\"attr\">db-data:</span>  <span class=\"comment\"># åˆ›å»ºä¸€ä¸ªåä¸ºdb-dataçš„å·ï¼Œå®é™…çš„ç½‘ç»œåç§°æ˜¯ å®¹å™¨ç»„åç§°_è¿™é‡Œçš„åç§°</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"volumes-çš„å±æ€§\">volumes çš„å±æ€§</h4>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>driver: å·ç±»å‹ï¼Œé»˜è®¤ä¸ºlocalï¼ŒæŒ‡å®šåº”ä½¿ç”¨å“ªä¸ªå·é©±åŠ¨ç¨‹åºã€‚å¦‚æœè¯¥é©±åŠ¨ç¨‹åºä¸å¯ç”¨ï¼ŒCompose å°†è¿”å›é”™è¯¯å¹¶ä¸”ä¸ä¼šéƒ¨ç½²è¯¥åº”ç”¨ç¨‹åºã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">volumes:</span></span><br><span class=\"line\">  <span class=\"attr\">db-data:</span> <span class=\"comment\"># å£°æ˜ä¸€ä¸ªåä¸ºdb-dataçš„å·</span></span><br><span class=\"line\">    <span class=\"attr\">driver:</span> <span class=\"string\">local</span> <span class=\"comment\"># æŒ‡å®šå·ç±»å‹ï¼Œè¿™ä¸ªæ˜¯é»˜è®¤å€¼ï¼Œå¯ä»¥ä¸é…ç½®</span></span><br><span class=\"line\">  <span class=\"attr\">db-data2:</span> <span class=\"comment\"># å£°æ˜ä¸€ä¸ªåä¸ºdb-data2çš„å·ï¼Œè¿™æ˜¯æœ€ç®€å•çš„ volumes é…ç½®</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>driver_opts: å·ç±»å‹å‚æ•°ï¼ŒæŒ‡å®šè¦ä¼ é€’ç»™æ­¤å·é©±åŠ¨ç¨‹åºçš„é€‰é¡¹åˆ—è¡¨ï¼ˆä»¥é”®å€¼å¯¹çš„å½¢å¼ï¼‰ã€‚è¿™äº›é€‰é¡¹ä¸é©±åŠ¨ç¨‹åºç›¸å…³ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">volumes:</span></span><br><span class=\"line\">  <span class=\"attr\">db-data:</span></span><br><span class=\"line\">    <span class=\"attr\">driver_opts:</span> <span class=\"comment\"># å·ç±»å‹å‚æ•°ï¼ŒæŒ‡å®šè¦ä¼ é€’ç»™æ­¤å·é©±åŠ¨ç¨‹åºçš„é€‰é¡¹åˆ—è¡¨ï¼ˆä»¥é”®å€¼å¯¹çš„å½¢å¼ï¼‰</span></span><br><span class=\"line\">      <span class=\"attr\">type:</span> <span class=\"string\">&quot;nfs&quot;</span> <span class=\"comment\"># å·ç±»å‹ï¼ŒæŒ‡å®šåº”ä½¿ç”¨å“ªä¸ªå·é©±åŠ¨ç¨‹åºï¼Œè¿™é‡Œæ˜¯nfs</span></span><br><span class=\"line\">      <span class=\"attr\">o:</span> <span class=\"string\">&quot;addr=10.40.0.199,nolock,soft,rw&quot;</span> <span class=\"comment\"># nfså‚æ•°ï¼Œaddrä¸ºnfsæœåŠ¡å™¨åœ°å€ï¼Œnolockä¸ºä¸é”å®šæ–‡ä»¶ï¼Œsoftä¸ºè½¯é“¾æ¥ï¼Œrwä¸ºè¯»å†™æƒé™</span></span><br><span class=\"line\">      <span class=\"attr\">device:</span> <span class=\"string\">&quot;:/docker/example&quot;</span> <span class=\"comment\"># nfsæŒ‚è½½è·¯å¾„</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>external: å·æ˜¯å¦ä¸ºå¤–éƒ¨å·ï¼Œé»˜è®¤ä¸ºfalse</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">volumes:</span></span><br><span class=\"line\">  <span class=\"attr\">db-data:</span></span><br><span class=\"line\">    <span class=\"attr\">external:</span> <span class=\"literal\">true</span> <span class=\"comment\"># true è¡¨ç¤ºä¸ä¼šåˆ›å»ºï¼Œè€Œæ˜¯ä½¿ç”¨å·²å­˜åœ¨çš„ï¼Œå³ä¼šå»volumesä¸­æŸ¥æ‰¾(docker volume ls) å®¹å™¨ç»„åç§°_da-data ï¼Œé»˜è®¤ä¸ºfalse</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>name: å·çš„åç§°ï¼Œé»˜è®¤ä¸º å®¹å™¨ç»„åç§°_å£°æ˜çš„åç§°</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">volumes:</span></span><br><span class=\"line\">  <span class=\"attr\">db-data:</span></span><br><span class=\"line\">    <span class=\"attr\">name:</span> <span class=\"string\">db-data</span> <span class=\"comment\"># åˆ›å»ºä¸€ä¸ªåä¸ºdb-dataçš„å·ï¼Œå®é™…çš„å·åç§°å°±æ˜¯ db-dataï¼Œä¸ä¼šå†åŠ ä¸Šå®¹å™¨ç»„åç§°å‰ç¼€</span></span><br><span class=\"line\">    <span class=\"attr\">external:</span> <span class=\"literal\">true</span> <span class=\"comment\"># name å±æ€§ç»å¸¸ä¸  external: true ä¸€èµ·ä½¿ç”¨</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>labels: ç”¨äºå‘å·æ·»åŠ å…ƒæ•°æ®ï¼Œå¯ä»¥æ·»åŠ ä»»æ„çš„é”®å€¼å¯¹</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">volumes:</span></span><br><span class=\"line\">  <span class=\"attr\">db-data:</span></span><br><span class=\"line\">    <span class=\"attr\">labels:</span></span><br><span class=\"line\">      <span class=\"attr\">com.example.description:</span> <span class=\"string\">&quot;Database volume&quot;</span></span><br><span class=\"line\">      <span class=\"attr\">com.example.department:</span> <span class=\"string\">&quot;IT/Ops&quot;</span></span><br><span class=\"line\">      <span class=\"attr\">com.example.label-with-empty-value:</span> <span class=\"string\">&quot;&quot;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"networks\">networks</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç½‘ç»œä½¿æœåŠ¡èƒ½å¤Ÿç›¸äº’é€šä¿¡ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒCompose ä¼šä¸ºæ‚¨çš„åº”ç”¨è®¾ç½®å•ä¸ªç½‘ç»œã€‚æœåŠ¡çš„æ¯ä¸ªå®¹å™¨éƒ½ä¼šåŠ å…¥é»˜è®¤ç½‘ç»œï¼Œå¹¶ä¸”è¯¥ç½‘ç»œä¸Šçš„å…¶ä»–å®¹å™¨éƒ½å¯ä»¥è®¿é—®ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡æœåŠ¡åç§°å‘ç°ã€‚é¡¶çº§networkså…ƒç´ å…è®¸æ‚¨é…ç½®å¯åœ¨å¤šä¸ªæœåŠ¡ä¹‹é—´é‡å¤ä½¿ç”¨çš„å‘½åç½‘ç»œã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">services:</span></span><br><span class=\"line\">  <span class=\"attr\">frontend:</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">example/webapp</span></span><br><span class=\"line\">    <span class=\"attr\">networks:</span>  <span class=\"comment\">#  ç½‘ç»œæ˜ å°„</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">front-tier</span> <span class=\"comment\">#  åŠ å…¥front-tierç½‘ç»œ</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">back-tier</span></span><br><span class=\"line\">  <span class=\"attr\">db:</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">postgres</span></span><br><span class=\"line\">    <span class=\"attr\">networks:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">backend</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">networks:</span>    <span class=\"comment\"># ç½‘ç»œé…ç½®</span></span><br><span class=\"line\">  <span class=\"attr\">front-tier:</span> <span class=\"comment\"># åˆ›å»ºä¸€ä¸ªåä¸ºfront-tierçš„ç½‘ç»œï¼Œå®é™…çš„ç½‘ç»œåç§°æ˜¯ å®¹å™¨ç»„åç§°_front-tier</span></span><br><span class=\"line\">  <span class=\"attr\">back-tier:</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¦‚æœ Compose æ–‡ä»¶æœªæ˜¾å¼å£°æ˜ç½‘ç»œï¼ŒCompose å°†ä½¿ç”¨éšå¼defaultç½‘ç»œã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">services:</span></span><br><span class=\"line\">  <span class=\"attr\">some-service:</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">foo</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># è¿™ä¸ªä¾‹å­å®é™…ä¸Šç­‰åŒäºï¼š</span></span><br><span class=\"line\"><span class=\"attr\">services:</span></span><br><span class=\"line\">  <span class=\"attr\">some-service:</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">foo</span></span><br><span class=\"line\">    <span class=\"attr\">networks:</span></span><br><span class=\"line\">      <span class=\"attr\">default:</span> &#123;&#125;</span><br><span class=\"line\"><span class=\"attr\">networks:</span></span><br><span class=\"line\">  <span class=\"attr\">default:</span> &#123;&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"networks-çš„å±æ€§\">networks çš„å±æ€§</h4>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>driver: ç½‘ç»œç±»å‹ï¼Œé»˜è®¤ä¸ºbridge</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">networks:</span></span><br><span class=\"line\">  <span class=\"attr\">gitea:</span></span><br><span class=\"line\">    <span class=\"attr\">driver:</span> <span class=\"string\">bridge</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>driver_opts: ç½‘ç»œç±»å‹å‚æ•°ï¼ŒæŒ‡å®šè¦ä¼ é€’ç»™æ­¤ç½‘ç»œé©±åŠ¨ç¨‹åºçš„é€‰é¡¹åˆ—è¡¨ï¼ˆä»¥é”®å€¼å¯¹çš„å½¢å¼ï¼‰ã€‚è¿™äº›é€‰é¡¹ä¸é©±åŠ¨ç¨‹åºç›¸å…³ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">networks:</span></span><br><span class=\"line\">  <span class=\"attr\">frontend:</span></span><br><span class=\"line\">    <span class=\"attr\">driver:</span> <span class=\"string\">bridge</span></span><br><span class=\"line\">    <span class=\"attr\">driver_opts:</span></span><br><span class=\"line\">      <span class=\"attr\">com.docker.network.bridge.host_binding_ipv4:</span> <span class=\"string\">&quot;127.0.0.1&quot;</span> <span class=\"comment\"># è®¾ç½®å®¹å™¨ç«¯å£ç»‘å®šåˆ°ä¸»æœºçš„å“ªä¸ª IPï¼ˆå¦‚ &quot;127.0.0.1&quot;ï¼Œç»‘å®šåˆ°æœ¬åœ°ï¼‰</span></span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>driver_opts å¸¸è§é…ç½®é¡¹ï¼ˆé’ˆå¯¹ bridge ç½‘ç»œé©±åŠ¨ï¼‰</p>\n</blockquote>\n<table>\n<thead>\n<tr>\n<th>é€‰é¡¹é”®åï¼ˆ<code>driver_opts</code>ï¼‰</th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>com.docker.network.bridge.name</code></td>\n<td>æŒ‡å®šæ¡¥æ¥ç½‘ç»œçš„åç§°ï¼ˆé»˜è®¤æ˜¯éšæœºç”Ÿæˆï¼Œå¦‚ <code>br-xxxxx</code>ï¼‰</td>\n</tr>\n<tr>\n<td><code>com.docker.network.bridge.enable_icc</code></td>\n<td>æ˜¯å¦å…è®¸å®¹å™¨ä¹‹é—´çš„é€šä¿¡ï¼ˆ<code>true</code> æˆ– <code>false</code>ï¼‰</td>\n</tr>\n<tr>\n<td><code>com.docker.network.bridge.enable_ip_masquerade</code></td>\n<td>æ˜¯å¦å¯ç”¨ IP å‡å†’ï¼ˆNATï¼Œé€šå¸¸ç”¨äºå¤–ç½‘è®¿é—®ï¼‰</td>\n</tr>\n<tr>\n<td><code>com.docker.network.bridge.host_binding_ipv4</code></td>\n<td>è®¾ç½®å®¹å™¨ç«¯å£ç»‘å®šåˆ°ä¸»æœºçš„å“ªä¸ª IPï¼ˆå¦‚ <code>&quot;127.0.0.1&quot;</code>ï¼Œç»‘å®šåˆ°æœ¬åœ°ï¼‰</td>\n</tr>\n<tr>\n<td><code>com.docker.network.bridge.default_bridge</code></td>\n<td>æ˜¯å¦å°†è¯¥ç½‘ç»œè®¾ç½®ä¸ºé»˜è®¤ bridge ç½‘ç»œï¼ˆ<code>true</code> æˆ– <code>false</code>ï¼‰</td>\n</tr>\n<tr>\n<td><code>com.docker.network.driver.mtu</code></td>\n<td>è®¾ç½®ç½‘ç»œçš„æœ€å¤§ä¼ è¾“å•å…ƒï¼ˆMTUï¼Œä¾‹å¦‚ <code>&quot;1500&quot;</code>ï¼‰</td>\n</tr>\n<tr>\n<td><code>com.docker.network.bridge.allow_non_default_bridge</code></td>\n<td>æ˜¯å¦å…è®¸å®¹å™¨åŠ å…¥éé»˜è®¤çš„ bridge ç½‘ç»œï¼ˆè¾ƒå°‘ä½¿ç”¨ï¼‰</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>attachable: å¦‚æœä¸ºtrueï¼Œåˆ™å…è®¸å°†å…¶å®ƒç‹¬ç«‹å®¹å™¨ä¹ŸåŠ å…¥åˆ°æ­¤ç½‘ç»œã€‚é»˜è®¤å€¼ä¸ºfalseã€‚å¦‚æœç‹¬ç«‹å®¹å™¨è¿æ¥åˆ°æ­¤ç½‘ç»œï¼Œå®ƒå¯ä»¥ä¸åŒæ ·è¿æ¥åˆ°æ­¤ç½‘ç»œçš„æœåŠ¡å’Œå…¶ä»–ç‹¬ç«‹å®¹å™¨è¿›è¡Œé€šä¿¡ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">networks:</span></span><br><span class=\"line\">  <span class=\"attr\">gitea:</span></span><br><span class=\"line\">    <span class=\"attr\">attachable:</span> <span class=\"literal\">true</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>external: true è¡¨ç¤ºä¸ä¼šåˆ›å»ºæ–°çš„ç½‘ç»œï¼Œå›å»networksä¸­æŸ¥æ‰¾ï¼ˆdocker network lsï¼‰ï¼Œé»˜è®¤ä¸ºfalse</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">networks:</span></span><br><span class=\"line\">  <span class=\"attr\">gitea:</span></span><br><span class=\"line\">    <span class=\"attr\">external:</span> <span class=\"literal\">true</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>name: ç½‘ç»œåç§°ï¼Œä¸ä¼šå†åŠ ä¸Šå®¹å™¨ç»„åç§°å‰ç¼€</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">networks:</span></span><br><span class=\"line\">  <span class=\"attr\">gitea:</span></span><br><span class=\"line\">    <span class=\"attr\">name:</span> <span class=\"string\">gitea</span></span><br><span class=\"line\">    <span class=\"attr\">external:</span> <span class=\"literal\">true</span> <span class=\"comment\"># name å±æ€§ç»å¸¸ä¸  external: true ä¸€èµ·ä½¿ç”¨</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>labels: ç”¨äºå‘ç½‘ç»œæ·»åŠ å…ƒæ•°æ®ï¼Œå¯ä»¥æ·»åŠ ä»»æ„çš„é”®å€¼å¯¹</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">networks:</span></span><br><span class=\"line\">  <span class=\"attr\">mynet1:</span></span><br><span class=\"line\">    <span class=\"attr\">labels:</span></span><br><span class=\"line\">      <span class=\"attr\">com.example.description:</span> <span class=\"string\">&quot;Financial transaction network&quot;</span></span><br><span class=\"line\">      <span class=\"attr\">com.example.department:</span> <span class=\"string\">&quot;Finance&quot;</span></span><br><span class=\"line\">      <span class=\"attr\">com.example.label-with-empty-value:</span> <span class=\"string\">&quot;&quot;</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>internal: é»˜è®¤æƒ…å†µä¸‹ï¼ŒCompose æä¾›ç½‘ç»œçš„å¤–éƒ¨è¿æ¥ã€‚internalå½“è®¾ç½®ä¸º æ—¶trueï¼Œå¯è®©æ‚¨åˆ›å»ºä¸å¤–éƒ¨éš”ç¦»çš„ç½‘ç»œã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">networks:</span></span><br><span class=\"line\">  <span class=\"attr\">gitea:</span></span><br><span class=\"line\">    <span class=\"attr\">internal:</span> <span class=\"literal\">true</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"services\">services</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœåŠ¡æ˜¯åº”ç”¨ç¨‹åºä¸­è®¡ç®—èµ„æºçš„æŠ½è±¡å®šä¹‰ï¼Œå¯ä»¥ç‹¬ç«‹äºå…¶ä»–ç»„ä»¶è¿›è¡Œæ‰©å±•æˆ–æ›¿æ¢ã€‚æœåŠ¡ç”±ä¸€ç»„å®¹å™¨æ”¯æŒï¼Œç”±å¹³å°æ ¹æ®å¤åˆ¶è¦æ±‚å’Œå¸ƒå±€çº¦æŸè¿è¡Œã€‚ç”±äºæœåŠ¡ç”±å®¹å™¨æ”¯æŒï¼Œå› æ­¤å®ƒä»¬ç”± Docker é•œåƒå’Œä¸€ç»„è¿è¡Œæ—¶å‚æ•°å®šä¹‰ã€‚æœåŠ¡ä¸­çš„æ‰€æœ‰å®¹å™¨éƒ½ä½¿ç”¨è¿™äº›å‚æ•°ä»¥ç›¸åŒçš„æ–¹å¼åˆ›å»ºã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>service åŒ…å«çš„å±æ€§éå¸¸å¤šï¼Œå…·ä½“è¯·å‚è€ƒ<a href=\"https://docs.docker.com/reference/compose-file/services/\">servicesé¡¶çº§å…ƒç´ </a>ï¼Œè¿™é‡Œåªä»‹ç»æ¯”è¾ƒå¸¸ç”¨çš„å±æ€§ï¼Œä»¥<code>gitea</code>çš„<code>docker-compose.yml</code>ä¸ºä¾‹</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># version: &#x27;3.8&#x27; # é…ç½®æ–‡ä»¶ç‰ˆæœ¬ï¼Œå·²è¿‡æ—¶ï¼Œé…ç½®ä¸Šä¼šå‘Šè­¦ä½†ä¸ä¼šæŠ¥é”™</span></span><br><span class=\"line\"><span class=\"comment\"># name: gitea # å®¹å™¨ç»„åç§°ï¼Œé»˜è®¤ä½¿ç”¨æ‰€åœ¨ç›®å½•çš„åç§°ï¼Œä¸æ¨èä½¿ç”¨</span></span><br><span class=\"line\"><span class=\"attr\">networks:</span> <span class=\"comment\"># ç½‘ç»œé…ç½®</span></span><br><span class=\"line\">  <span class=\"attr\">gitea:</span> <span class=\"comment\"># åˆ›å»ºä¸€ä¸ªåä¸ºgiteaçš„ç½‘ç»œï¼Œå®é™…çš„ç½‘ç»œåç§°æ˜¯ gitea_giteaï¼Œå³ å®¹å™¨ç»„åç§°_è¿™é‡Œçš„åç§°</span></span><br><span class=\"line\">    <span class=\"attr\">external:</span> <span class=\"literal\">false</span> <span class=\"comment\"># å¦‚æœä¸ºtrueï¼Œåˆ™è¡¨ç¤ºæ­¤ç½‘ç»œä¸ä¼šç”±composeåˆ›å»ºï¼Œè€Œæ˜¯ä½¿ç”¨å·²æœ‰çš„ç½‘ç»œï¼Œé»˜è®¤ä¸ºfalse</span></span><br><span class=\"line\">    <span class=\"attr\">driver:</span> <span class=\"string\">bridge</span>  <span class=\"comment\"># ç½‘ç»œç±»å‹ï¼Œé»˜è®¤ä¸ºbridge</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">volumes:</span> <span class=\"comment\"># å­˜å‚¨å·é…ç½®</span></span><br><span class=\"line\">  <span class=\"attr\">gitea:</span> <span class=\"comment\"># åˆ›å»ºä¸€ä¸ªåä¸ºgiteaçš„å­˜å‚¨å·ï¼Œå®é™…çš„å·åç§°æ˜¯ gitea_giteaï¼Œå³ å®¹å™¨ç»„åç§°_è¿™é‡Œçš„åç§°</span></span><br><span class=\"line\">    <span class=\"attr\">driver:</span> <span class=\"string\">local</span> <span class=\"comment\"># å­˜å‚¨å·ç±»å‹ï¼Œé»˜è®¤ä¸ºlocal</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">services:</span> <span class=\"comment\"># æœåŠ¡é…ç½®ï¼Œè¿™é‡Œå¯ä»¥å®šä¹‰ä¸€ç»„å®¹å™¨</span></span><br><span class=\"line\">  <span class=\"attr\">server:</span> <span class=\"comment\"># å®šä¹‰ä¸€ä¸ªåä¸ºserverçš„æœåŠ¡ï¼Œæ³¨æ„è¿™ä¸ªä¸æ˜¯å®¹å™¨åç§°</span></span><br><span class=\"line\">    <span class=\"comment\"># build: . # æ„å»ºé•œåƒï¼Œä½¿ç”¨å½“å‰ç›®å½•ä¸‹çš„Dockerfile</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">gitea/gitea:latest</span> <span class=\"comment\"># é•œåƒåç§°</span></span><br><span class=\"line\">    <span class=\"comment\"># container_name: gitea #  å®¹å™¨åç§°ï¼Œé»˜è®¤ä¸º â€œå®¹å™¨ç»„åç§°-æœåŠ¡åç§°-ç´¢å¼•â€ï¼Œä¸æ¨èé…ç½®ï¼Œå› ä¸º æ°´å¹³æ‰©å±•(--scale) æ—¶,å®¹å™¨åç§°ä¸èƒ½é‡å¤</span></span><br><span class=\"line\">    <span class=\"attr\">environment:</span> <span class=\"comment\"># å®šä¹‰ç¯å¢ƒå˜é‡</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">USER_UID=1000</span> <span class=\"comment\"># key=value</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">USER_GID=1000</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">DB_TYPE=mysql</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">DB_HOST=db:3306</span> <span class=\"comment\"># è¿™é‡Œé…ç½®çš„ db å°±æ˜¯ ä¸‹é¢çš„æœåŠ¡åç§°ï¼Œç›¸åŒ network ä¸‹çš„æœåŠ¡åç§°ï¼Œdocker composeä¼šè‡ªåŠ¨è§£æä¸ºå®¹å™¨çš„ipåœ°å€</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">DB_NAME=gitea</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">DB_USER=gitea</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">DB_PASSWD=gitea</span></span><br><span class=\"line\">    <span class=\"comment\"># env_file: .gitea.env # ä» .gitea.env æ–‡ä»¶è¯»å–ç¯å¢ƒå˜é‡ï¼Œç”Ÿäº§ç¯å¢ƒæ›´æ¨è</span></span><br><span class=\"line\">    <span class=\"attr\">restart:</span> <span class=\"string\">always</span> <span class=\"comment\"># å®¹å™¨å¯åŠ¨æ—¶ï¼Œè‡ªåŠ¨é‡å¯</span></span><br><span class=\"line\">    <span class=\"attr\">networks:</span> <span class=\"comment\"># ç½‘ç»œå…³è”</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">gitea</span> <span class=\"comment\"># ç½‘ç»œåç§°ï¼Œå°±æ˜¯ä¸Šé¢åˆ›å»ºçš„giteaç½‘ç»œ</span></span><br><span class=\"line\">    <span class=\"attr\">volumes:</span> <span class=\"comment\">#  æ•°æ®å·å…³è”</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">gitea:/data</span> <span class=\"comment\"># volumeæ˜ å°„ï¼Œæ•°æ®å·åç§°:/å®¹å™¨è·¯å¾„</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">/etc/timezone:/etc/timezone:ro</span> <span class=\"comment\"># è·¯å¾„æ˜ å°„ï¼Œå®¿ä¸»æœºè·¯å¾„:/å®¹å™¨è·¯å¾„:è¯»å†™æƒé™</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">/etc/localtime:/etc/localtime:ro</span></span><br><span class=\"line\">    <span class=\"attr\">ports:</span> <span class=\"comment\"># ç«¯å£æ˜ å°„</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">&quot;3000:3000&quot;</span> <span class=\"comment\"># å®¿ä¸»æœºç«¯å£:å®¹å™¨ç«¯å£</span></span><br><span class=\"line\">    <span class=\"attr\">depends_on:</span> <span class=\"comment\"># å¯åŠ¨ä¾èµ–ï¼Œå°±æ˜¯ä¾èµ–çš„æœåŠ¡å¯åŠ¨åæ‰èƒ½å¯åŠ¨æœ¬æœåŠ¡</span></span><br><span class=\"line\">      <span class=\"attr\">db:</span> <span class=\"comment\"># å¯åŠ¨dbæœåŠ¡</span></span><br><span class=\"line\">        <span class=\"attr\">condition:</span> <span class=\"string\">service_healthy</span> <span class=\"comment\"># æœåŠ¡é€šè¿‡å¥åº·æ£€æŸ¥ï¼Œä¹Ÿå¯ä»¥é…ç½®ä¸º service_startedï¼šæœåŠ¡å¯åŠ¨ï¼Œè¿™ä¸ªæ˜¯é»˜è®¤å€¼</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"attr\">db:</span> <span class=\"comment\"># æ•°æ®åº“æœåŠ¡</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">mysql:8</span> <span class=\"comment\"># é•œåƒ</span></span><br><span class=\"line\">    <span class=\"attr\">environment:</span> <span class=\"comment\"># ç¯å¢ƒå˜é‡</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">MYSQL_ROOT_PASSWORD=gitea</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">MYSQL_USER=gitea</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">MYSQL_PASSWORD=gitea</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">MYSQL_DATABASE=gitea</span></span><br><span class=\"line\">    <span class=\"attr\">restart:</span> <span class=\"string\">always</span> <span class=\"comment\"># å¯åŠ¨ç­–ç•¥</span></span><br><span class=\"line\">    <span class=\"attr\">networks:</span> <span class=\"comment\"># ç½‘ç»œæ˜ å°„</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">gitea</span> <span class=\"comment\"># æ˜ å°„åˆ°giteaç½‘ç»œ</span></span><br><span class=\"line\">    <span class=\"attr\">volumes:</span> <span class=\"comment\"># å·æ˜ å°„</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">./mysql:/var/lib/mysql</span> <span class=\"comment\"># å®¿ä¸»æœºè·¯å¾„:/å®¹å™¨è·¯å¾„ï¼Œè¿™é‡Œå®¿ä¸»æœºæ”¯æŒç›¸å¯¹è·¯å¾„</span></span><br><span class=\"line\">    <span class=\"attr\">healthcheck:</span> <span class=\"comment\"># å¥åº·æ£€æŸ¥</span></span><br><span class=\"line\">      <span class=\"attr\">test:</span> [<span class=\"string\">&quot;CMD-SHELL&quot;</span>, <span class=\"string\">&quot;mysql -u root -pgitea&quot;</span>, <span class=\"string\">&quot;-e &#x27;SELECT 1;&#x27;&quot;</span>] <span class=\"comment\"># æ‰§è¡Œå‘½ä»¤ï¼Œå¦‚æœè¿”å›0ï¼Œåˆ™å¥åº·æ£€æŸ¥é€šè¿‡ï¼Œè¿™é‡Œä¸æ”¯æŒä¸Šé¢çš„ç¯å¢ƒå˜é‡ï¼Œteståªæ”¯æŒ  CMD-SHELL å’Œ CMD</span></span><br><span class=\"line\">      <span class=\"attr\">interval:</span> <span class=\"string\">10s</span> <span class=\"comment\"># å¥åº·æ£€æŸ¥é—´éš”</span></span><br><span class=\"line\">      <span class=\"attr\">timeout:</span> <span class=\"string\">5s</span> <span class=\"comment\"># å¥åº·æ£€æŸ¥è¶…æ—¶æ—¶é—´</span></span><br><span class=\"line\">      <span class=\"attr\">retries:</span> <span class=\"number\">3</span> <span class=\"comment\"># å¥åº·æ£€æŸ¥é‡è¯•æ¬¡æ•°</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><code>build</code>: æ„å»ºé•œåƒ</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">services:</span></span><br><span class=\"line\">  <span class=\"attr\">server:</span></span><br><span class=\"line\">    <span class=\"attr\">build:</span> <span class=\"string\">.</span> <span class=\"comment\"># Dockerfileçš„ç›®å½•ï¼Œâ€œ.â€ è¡¨ç¤ºä½¿ç”¨å½“å‰ç›®å½•ä¸‹çš„Dockerfile</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">example/webapp</span> <span class=\"comment\"># é•œåƒåç§°ï¼Œå¦‚æœæœ‰buildï¼Œåˆ™è¯¥åç§°å°±æ˜¯buildåçš„é•œåƒåç§°ï¼Œå¦‚æœæ²¡æœ‰buildï¼Œåˆ™å°±ä¼šä»è¿œç¨‹ä»“åº“æ‹‰å–</span></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">services:</span></span><br><span class=\"line\">  <span class=\"attr\">server:</span></span><br><span class=\"line\">    <span class=\"attr\">build:</span></span><br><span class=\"line\">      <span class=\"attr\">context:</span> <span class=\"string\">./webapp</span> <span class=\"comment\"># Dockerfileçš„ç›®å½•ï¼Œé»˜è®¤æ˜¯å½“å‰ç›®å½•</span></span><br><span class=\"line\">      <span class=\"attr\">dockerfile:</span> <span class=\"string\">Dockerfile</span> <span class=\"comment\"># æ„å»ºé•œåƒçš„Dockerfileåç§°ï¼Œé»˜è®¤æ˜¯Dockerfile</span></span><br><span class=\"line\">      <span class=\"attr\">platforms:</span> <span class=\"comment\"># æ„å»ºé•œåƒçš„æ¶æ„</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"string\">linux/amd64</span> <span class=\"comment\"># æ„å»ºé•œåƒçš„æ¶æ„ï¼Œé»˜è®¤æ˜¯å½“å‰æ¶æ„</span></span><br><span class=\"line\">      <span class=\"attr\">args:</span> <span class=\"comment\"># æ„å»ºé•œåƒçš„å‚æ•°</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"string\">FOO=bar</span></span><br><span class=\"line\">      <span class=\"attr\">labels:</span> <span class=\"comment\"># æ„å»ºé•œåƒçš„æ ‡ç­¾</span></span><br><span class=\"line\">        <span class=\"attr\">com.example.description:</span> <span class=\"string\">&quot;Accounting webapp&quot;</span></span><br><span class=\"line\">        <span class=\"attr\">com.example.department:</span> <span class=\"string\">&quot;Finance&quot;</span></span><br><span class=\"line\">        <span class=\"attr\">com.example.label-with-empty-value:</span> <span class=\"string\">&quot;&quot;</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><code>command</code>: è¦†ç›–å®¹å™¨æ˜ åƒå£°æ˜çš„é»˜è®¤å‘½ä»¤</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">services:</span></span><br><span class=\"line\">  <span class=\"attr\">server:</span></span><br><span class=\"line\">    <span class=\"attr\">command:</span> [<span class=\"string\">&quot;python&quot;</span>, <span class=\"string\">&quot;app.py&quot;</span>]</span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">example/webapp</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><code>entrypoint</code>: å£°æ˜æœåŠ¡å®¹å™¨çš„é»˜è®¤å…¥å£ç‚¹ï¼Œè¿™è¦†ç›–äº†æœåŠ¡Dockerfileä¸­çš„ENTRYPOINTæŒ‡ä»¤ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">services:</span></span><br><span class=\"line\">  <span class=\"attr\">server:</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">example/webapp</span></span><br><span class=\"line\">    <span class=\"attr\">entrypoint:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">php</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">-d</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">zend_extension=/usr/local/lib/php/extensions/no-debug-non-zts-20100525/xdebug.so</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">-d</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">memory_limit=-1</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">vendor/bin/phpunit</span></span><br><span class=\"line\">      <span class=\"comment\"># å¦‚æœå€¼ä¸ºnullï¼Œåˆ™ä½¿ç”¨å›¾åƒçš„é»˜è®¤å…¥å£ç‚¹ã€‚ entrypoint: null</span></span><br><span class=\"line\">      <span class=\"comment\"># å¦‚æœå€¼æ˜¯ []ï¼ˆç©ºåˆ—è¡¨ï¼‰æˆ– &#x27;&#x27;ï¼ˆç©ºå­—ç¬¦ä¸²ï¼‰ï¼Œå›¾åƒå£°æ˜çš„é»˜è®¤å…¥å£ç‚¹è¢«å¿½ç•¥ï¼Œæˆ–è€…æ¢å¥è¯è¯´ï¼Œè¢«è¦†ç›–ä¸ºç©ºã€‚ entrypoint: []</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><code>depends_on</code>: æœåŠ¡å¯åŠ¨ä¾èµ–ï¼Œå°±æ˜¯ä¾èµ–çš„æœåŠ¡å¯åŠ¨åæ‰èƒ½å¯åŠ¨æœ¬æœåŠ¡</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">services:</span></span><br><span class=\"line\">  <span class=\"attr\">web:</span></span><br><span class=\"line\">    <span class=\"attr\">build:</span> <span class=\"string\">.</span></span><br><span class=\"line\">    <span class=\"attr\">depends_on:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">db</span> <span class=\"comment\"># çŸ­è¯­æ³•</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">redis</span></span><br><span class=\"line\">  <span class=\"attr\">redis:</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">redis</span></span><br><span class=\"line\">  <span class=\"attr\">db:</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">postgres</span></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">services:</span></span><br><span class=\"line\">  <span class=\"attr\">web:</span></span><br><span class=\"line\">    <span class=\"attr\">build:</span> <span class=\"string\">.</span></span><br><span class=\"line\">    <span class=\"attr\">depends_on:</span></span><br><span class=\"line\">      <span class=\"attr\">db:</span>  <span class=\"comment\"># é•¿è¯­æ³•</span></span><br><span class=\"line\">        <span class=\"attr\">condition:</span> <span class=\"string\">service_healthy</span> <span class=\"comment\"># æ»¡è¶³çš„æ¡ä»¶</span></span><br><span class=\"line\">        <span class=\"attr\">restart:</span> <span class=\"literal\">true</span>      <span class=\"comment\"># å½“è®¾ç½®ä¸ºtrueï¼ŒComposeåœ¨æ›´æ–°ä¾èµ–æœåŠ¡åé‡æ–°å¯åŠ¨æ­¤æœåŠ¡ã€‚</span></span><br><span class=\"line\">      <span class=\"attr\">redis:</span></span><br><span class=\"line\">        <span class=\"attr\">condition:</span> <span class=\"string\">service_started</span></span><br><span class=\"line\">  <span class=\"attr\">redis:</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">redis</span></span><br><span class=\"line\">  <span class=\"attr\">db:</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">postgres</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">## conditionï¼šè®¾ç½®ä¾èµ–æ€§è¢«è§†ä¸ºæ»¡è¶³çš„æ¡ä»¶</span></span><br><span class=\"line\"><span class=\"comment\">#   service_startedï¼šç›¸å½“äºä¹‹å‰æè¿°çš„ç®€çŸ­è¯­æ³•</span></span><br><span class=\"line\"><span class=\"comment\">#   service_healthyï¼šæŒ‡å®šåœ¨å¯åŠ¨ä¾èµ–æœåŠ¡ä¹‹å‰ï¼Œä¾èµ–é¢„æœŸä¸ºâ€œå¥åº·â€ï¼ˆå¦‚healthcheckæ‰€ç¤ºï¼‰ã€‚</span></span><br><span class=\"line\"><span class=\"comment\">#   service_completed_successfullyï¼šæŒ‡å®šåœ¨å¯åŠ¨ä¾èµ–æœåŠ¡ä¹‹å‰ï¼Œä¾èµ–é¡¹é¢„è®¡å°†è¿è¡Œåˆ°æˆåŠŸå®Œæˆã€‚</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><code>environment</code>: å®šä¹‰ç¯å¢ƒå˜é‡</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">services:</span></span><br><span class=\"line\">  <span class=\"attr\">server:</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">example/webapp</span></span><br><span class=\"line\">    <span class=\"attr\">environment:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">FOO=bar</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">BAZ=qux</span></span><br><span class=\"line\"><span class=\"comment\"># æˆ–è€…</span></span><br><span class=\"line\"><span class=\"attr\">services:</span></span><br><span class=\"line\">  <span class=\"attr\">server:</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">example/webapp</span></span><br><span class=\"line\">    <span class=\"attr\">environment:</span></span><br><span class=\"line\">      <span class=\"attr\">FOO:</span> <span class=\"string\">bar</span></span><br><span class=\"line\">      <span class=\"attr\">BAZ:</span> <span class=\"string\">qux</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><code>env_file</code>: ç”¨äºæŒ‡å®šä¸€ä¸ªæˆ–å¤šä¸ªåŒ…å«è¦ä¼ é€’åˆ°å®¹å™¨çš„ç¯å¢ƒå˜é‡çš„æ–‡ä»¶ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">services:</span></span><br><span class=\"line\">  <span class=\"attr\">server:</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">example/webapp</span></span><br><span class=\"line\">    <span class=\"attr\">env_file:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">./a.env</span> <span class=\"comment\"># åˆ—è¡¨ä¸­çš„æ–‡ä»¶æ˜¯ä»ä¸Šåˆ°ä¸‹å¤„ç†çš„ã€‚å¯¹äºä¸¤ä¸ªç¯å¢ƒæ–‡ä»¶ä¸­æŒ‡å®šçš„ç›¸åŒå˜é‡ï¼Œåˆ—è¡¨ä¸­æœ€åä¸€ä¸ªæ–‡ä»¶çš„å€¼æ˜¯æœ‰æ•ˆçš„ã€‚</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">./b.env</span></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">services:</span></span><br><span class=\"line\">  <span class=\"attr\">server:</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">example/webapp</span></span><br><span class=\"line\">    <span class=\"attr\">env_file:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">path:</span> <span class=\"string\">./default.env</span></span><br><span class=\"line\">        <span class=\"attr\">required:</span> <span class=\"literal\">true</span> <span class=\"comment\"># default</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">path:</span> <span class=\"string\">./override.env</span></span><br><span class=\"line\">        <span class=\"attr\">required:</span> <span class=\"literal\">false</span> <span class=\"comment\"># å½“requiredè®¾ç½®ä¸ºfalseä¸”.envæ–‡ä»¶ç¼ºå¤±æ—¶ï¼ŒComposeä¼šå¿½ç•¥</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><code>restart</code>: å®šä¹‰å¹³å°åœ¨å®¹å™¨ç»ˆæ­¢æ—¶é€‚ç”¨çš„ç­–ç•¥</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">services:</span></span><br><span class=\"line\">  <span class=\"attr\">server:</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">example/webapp</span></span><br><span class=\"line\">    <span class=\"attr\">restart:</span> <span class=\"string\">&quot;no&quot;</span>            <span class=\"comment\"># é»˜è®¤é‡å¯ç­–ç•¥ã€‚åœ¨ä»»ä½•æƒ…å†µä¸‹ï¼Œå®ƒéƒ½ä¸ä¼šé‡æ–°å¯åŠ¨å®¹å™¨ã€‚</span></span><br><span class=\"line\">    <span class=\"comment\"># restart: always        # ç­–ç•¥æ€»æ˜¯é‡æ–°å¯åŠ¨å®¹å™¨ï¼Œç›´åˆ°å®ƒè¢«ç§»é™¤ã€‚</span></span><br><span class=\"line\">    <span class=\"comment\"># restart: on-failure    # å¦‚æœé€€å‡ºä»£ç è¡¨æ˜é”™è¯¯ï¼Œç­–ç•¥å°†é‡æ–°å¯åŠ¨å®¹å™¨ã€‚</span></span><br><span class=\"line\">    <span class=\"comment\"># restart: on-failure:3  # å¦‚æœé€€å‡ºä»£ç è¡¨æ˜é”™è¯¯ï¼Œç­–ç•¥å°†é‡æ–°å¯åŠ¨å®¹å™¨ã€‚ä½†ä»…å°è¯•é‡å¯3æ¬¡ã€‚</span></span><br><span class=\"line\">    <span class=\"comment\"># restart: unless-stopped # æ— è®ºé€€å‡ºä»£ç å¦‚ä½•ï¼Œç­–ç•¥éƒ½ä¼šé‡æ–°å¯åŠ¨å®¹å™¨ï¼Œä½†å½“æœåŠ¡åœæ­¢æˆ–åˆ é™¤æ—¶ï¼Œç­–ç•¥ä¼šåœæ­¢é‡æ–°å¯åŠ¨ã€‚</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><code>healthcheck</code>: å¥åº·æ£€æŸ¥ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">services:</span></span><br><span class=\"line\">  <span class=\"attr\">server:</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">example/webapp</span></span><br><span class=\"line\">    <span class=\"attr\">healthcheck:</span>  <span class=\"comment\"># å¥åº·æ£€æŸ¥</span></span><br><span class=\"line\">      <span class=\"attr\">test:</span> [<span class=\"string\">&quot;CMD&quot;</span>, <span class=\"string\">&quot;curl&quot;</span>, <span class=\"string\">&quot;-f&quot;</span>, <span class=\"string\">&quot;http://localhost&quot;</span>] <span class=\"comment\"># ç›‘æ§æ£€æŸ¥æ—¶æ‰§è¡Œçš„å‘½ä»¤</span></span><br><span class=\"line\">      <span class=\"attr\">interval:</span> <span class=\"string\">1m30s</span> <span class=\"comment\"># å¥åº·æ£€æŸ¥çš„é—´éš”ï¼Œé»˜è®¤å€¼ä¸º 30s</span></span><br><span class=\"line\">      <span class=\"attr\">timeout:</span> <span class=\"string\">10s</span>    <span class=\"comment\">#  å¥åº·æ£€æŸ¥çš„è¶…æ—¶æ—¶é—´ï¼Œé»˜è®¤å€¼ä¸º 30s</span></span><br><span class=\"line\">      <span class=\"attr\">retries:</span> <span class=\"number\">3</span>      <span class=\"comment\"># å¥åº·æ£€æŸ¥çš„å°è¯•æ¬¡æ•°ï¼Œé»˜è®¤å€¼ä¸º 3</span></span><br><span class=\"line\">      <span class=\"attr\">start_period:</span> <span class=\"string\">40s</span> <span class=\"comment\"># å¯åŠ¨å®½é™æœŸï¼šåœ¨æ­¤æœŸé—´ï¼Œå¤±è´¥ä¸ä¼šè®¡å…¥é‡è¯•æ¬¡æ•°ï¼ˆä»…ç”¨äºåˆ¤æ–­æœåŠ¡æ˜¯å¦å¯åŠ¨å®Œæ¯•ï¼‰</span></span><br><span class=\"line\">      <span class=\"attr\">start_interval:</span> <span class=\"string\">5s</span> <span class=\"comment\"># å¯åŠ¨å®½é™æœŸå†…æ£€æŸ¥çš„é¢‘ç‡ï¼Œæœ¬ç¤ºä¾‹ä¸ºåœ¨å‰ 40 ç§’å†…æ¯ 5 ç§’æ£€æŸ¥ä¸€æ¬¡</span></span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>testå®šä¹‰Composeè¿è¡Œçš„å‘½ä»¤æ¥æ£€æŸ¥å®¹å™¨è¿è¡ŒçŠ¶å†µã€‚å®ƒå¯ä»¥æ˜¯å­—ç¬¦ä¸²ï¼Œä¹Ÿå¯ä»¥æ˜¯åˆ—è¡¨ã€‚å¦‚æœæ˜¯åˆ—è¡¨ï¼Œç¬¬ä¸€ä¸ªé¡¹ç›®å¿…é¡»æ˜¯NONEã€CMDæˆ–CMD-SHELLã€‚å¦‚æœå®ƒæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå®ƒç­‰åŒäºæŒ‡å®šCMD-SHELLåè·Ÿè¯¥å­—ç¬¦ä¸²ã€‚</p>\n</blockquote>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">test:</span> [<span class=\"string\">&quot;CMD&quot;</span>, <span class=\"string\">&quot;curl&quot;</span>, <span class=\"string\">&quot;-f&quot;</span>, <span class=\"string\">&quot;http://localhost&quot;</span>]</span><br><span class=\"line\"><span class=\"comment\"># ä½¿ç”¨CMD-SHELLè¿è¡Œé…ç½®ä¸ºå­—ç¬¦ä¸²çš„å‘½ä»¤ï¼Œä½¿ç”¨å®¹å™¨çš„é»˜è®¤å¤–å£³ï¼ˆLinuxçš„/bin/shï¼‰ã€‚ä»¥ä¸‹ä¸¤ç§å½¢å¼æ˜¯ç­‰ä»·çš„</span></span><br><span class=\"line\"><span class=\"attr\">test:</span> [<span class=\"string\">&quot;CMD-SHELL&quot;</span>, <span class=\"string\">&quot;curl -f http://localhost || exit 1&quot;</span>]</span><br><span class=\"line\"><span class=\"attr\">test:</span> <span class=\"string\">curl</span> <span class=\"string\">-f</span> <span class=\"string\">https://localhost</span> <span class=\"string\">||</span> <span class=\"string\">exit</span> <span class=\"number\">1</span></span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>test ä¸­çš„ CMD å’Œ CMD-SHELL æ˜¯ä¸¤ç§ä¸åŒçš„æ‰§è¡Œæ–¹å¼ï¼Œå®ƒä»¬çš„ä¸»è¦åŒºåˆ«åœ¨äºï¼š</p>\n</blockquote>\n<table>\n<thead>\n<tr>\n<th>é¡¹ç›®</th>\n<th><code>CMD</code></th>\n<th><code>CMD-SHELL</code></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>âœ… <strong>ç”¨é€”</strong></td>\n<td>ç›´æ¥æ‰§è¡Œå‘½ä»¤ï¼ˆä¸é€šè¿‡ shellï¼‰</td>\n<td>é€šè¿‡ shellï¼ˆå¦‚ <code>/bin/sh -c</code>ï¼‰æ‰§è¡Œå‘½ä»¤</td>\n</tr>\n<tr>\n<td>ğŸ§¾ <strong>å†™æ³•æ ¼å¼</strong></td>\n<td><code>[&quot;CMD&quot;, &quot;executable&quot;, &quot;arg1&quot;, &quot;arg2&quot;]</code></td>\n<td><code>[&quot;CMD-SHELL&quot;, &quot;command string&quot;]</code></td>\n</tr>\n<tr>\n<td>ğŸ”§ <strong>æ˜¯å¦ä½¿ç”¨ shell</strong></td>\n<td>å¦</td>\n<td>æ˜¯</td>\n</tr>\n<tr>\n<td>ğŸ§  <strong>æ˜¯å¦æ”¯æŒ shell è¯­æ³•</strong></td>\n<td>âŒ å¦<br>ï¼ˆä¸èƒ½ä½¿ç”¨ <code>&amp;&amp;</code>ã€ <code>||</code>ã€<code>\\$VAR</code> ç­‰ï¼‰</td>\n<td>âœ… æ˜¯<br>ï¼ˆæ”¯æŒç®¡é“ã€é‡å®šå‘ã€å˜é‡ã€å‘½ä»¤ç»„åˆï¼‰</td>\n</tr>\n<tr>\n<td>ğŸ›¡ï¸ <strong>å®‰å…¨æ€§/å¯ç§»æ¤æ€§</strong></td>\n<td>âœ… æ›´å®‰å…¨ï¼Œæ‰§è¡Œæ›´æ˜ç¡®</td>\n<td>âš  ä¾èµ–å®¹å™¨ä¸­å­˜åœ¨ shellï¼ˆå¦‚ <code>/bin/sh</code>ï¼‰</td>\n</tr>\n<tr>\n<td>âš™ï¸ <strong>æ‰§è¡Œæ•ˆç‡</strong></td>\n<td>âœ… ç¨å¿«ï¼Œå› æ— éœ€ shell è§£æ</td>\n<td>âš  ç¨æ…¢ï¼Œéœ€é€šè¿‡ shell å¯åŠ¨</td>\n</tr>\n<tr>\n<td>ğŸ“¦ <strong>æ¨èä½¿ç”¨åœºæ™¯</strong></td>\n<td>- ç®€å•å¥åº·æ£€æŸ¥å‘½ä»¤<br>- å®‰å…¨ç¯å¢ƒ<br>- ç²¾ç®€é•œåƒ</td>\n<td>- éœ€è¦ä½¿ç”¨é€»è¾‘æ§åˆ¶ï¼ˆ<code>||</code>, <code>&amp;&amp;</code>ï¼‰<br>- å¤æ‚æ£€æŸ¥é€»è¾‘</td>\n</tr>\n<tr>\n<td>ğŸ“Œ <strong>ç¤ºä¾‹</strong></td>\n<td><code>[&quot;CMD&quot;, &quot;curl&quot;, &quot;-f&quot;, &quot;http://localhost&quot;]</code></td>\n<td><code>[&quot;CMD-SHELL&quot;, &quot;curl -f http\\://localhost || exit 1&quot;]</code></td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><code>volumes</code>: æŒ‚è½½æ•°æ®å·ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># é•¿è¯­æ³•æ ¼å¼</span></span><br><span class=\"line\"><span class=\"attr\">services:</span></span><br><span class=\"line\">  <span class=\"attr\">backend:</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">example/backend</span></span><br><span class=\"line\">    <span class=\"attr\">volumes:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">type:</span> <span class=\"string\">volume</span>   <span class=\"comment\"># å®‰è£…ç±»å‹ã€‚å¯ä»¥æ˜¯æ˜¯volumeã€bindã€tmpfsã€imageã€npipeã€cluster</span></span><br><span class=\"line\">        <span class=\"attr\">source:</span> <span class=\"string\">db-data</span> <span class=\"comment\"># æŒ‚è½½çš„æºã€ç»‘å®šæŒ‚è½½çš„ä¸»æœºä¸Šçš„è·¯å¾„ã€æ˜ åƒæŒ‚è½½çš„Dockeræ˜ åƒå¼•ç”¨æˆ–é¡¶å±‚volumesé”®ä¸­å®šä¹‰çš„å·åç§°ã€‚ä¸é€‚ç”¨äºtmpfsæ”¯æ¶ã€‚</span></span><br><span class=\"line\">        <span class=\"attr\">target:</span> <span class=\"string\">/data</span> <span class=\"comment\"># å®¹å™¨ä¸­è£…è½½å·çš„è·¯å¾„ã€‚</span></span><br><span class=\"line\">        <span class=\"attr\">volume:</span>  <span class=\"comment\"># é…ç½®å…¶ä»–å·é€‰é¡¹</span></span><br><span class=\"line\">          <span class=\"attr\">nocopy:</span> <span class=\"literal\">true</span> <span class=\"comment\"># åœ¨åˆ›å»ºå·æ—¶ç¦ç”¨ä»å®¹å™¨å¤åˆ¶æ•°æ®çš„æ ‡å¿—ï¼Œé»˜è®¤å€¼ä¸ºfalseã€‚</span></span><br><span class=\"line\">          <span class=\"attr\">subpath:</span> <span class=\"string\">sub</span> <span class=\"comment\"># æŒ‚è½½å·çš„å­ç›®å½•ã€‚å³ db-data/sub</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">type:</span> <span class=\"string\">bind</span> <span class=\"comment\"># bind è¡¨ç¤ºæŒ‚è½½ä¸»æœºä¸Šçš„è·¯å¾„</span></span><br><span class=\"line\">        <span class=\"attr\">source:</span> <span class=\"string\">/var/run/postgres/postgres.sock</span></span><br><span class=\"line\">        <span class=\"attr\">target:</span> <span class=\"string\">/var/run/postgres/postgres.sock</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">volumes:</span> <span class=\"comment\"># å£°æ˜æ•°æ®å·</span></span><br><span class=\"line\">  <span class=\"attr\">db-data:</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">######################################################################################</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># çŸ­è¯­æ³•æ ¼å¼</span></span><br><span class=\"line\"><span class=\"attr\">services:</span></span><br><span class=\"line\">  <span class=\"attr\">backend:</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">example/backend</span></span><br><span class=\"line\">    <span class=\"attr\">volumes:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">db-data:/data</span> <span class=\"comment\"># è¿™ç§è¯­æ³•ä¸æ”¯æŒ subpath å’Œ nocopy</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">/var/run/postgres/postgres.sock:/var/run/postgres/postgres.sock</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">volumes:</span></span><br><span class=\"line\">  <span class=\"attr\">db-data:</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><code>networks</code>: é…ç½®ç½‘ç»œã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">services:</span></span><br><span class=\"line\">  <span class=\"attr\">some-service:</span></span><br><span class=\"line\">    <span class=\"attr\">networks:</span>  <span class=\"comment\"># é…ç½®ç½‘ç»œ</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">some-network</span> <span class=\"comment\"># å…³è”ç½‘ç»œ</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">other-network</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">networks:</span> <span class=\"comment\"># å£°æ˜ç½‘ç»œ</span></span><br><span class=\"line\">  <span class=\"attr\">some-network:</span></span><br><span class=\"line\">  <span class=\"attr\">other-network:</span></span><br></pre></td></tr></table></figure>","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» Docker å‘½ä»¤ ä¸­ docker compose çš„ä½¿ç”¨æ–¹æ³• Dockerå®˜æ–¹æ–‡æ¡£ docker compose Compose file reference docker compose æ˜¯ä»€ä¹ˆï¼Ÿ Docker Composeæ˜¯ä¸€ä¸ªç”¨äºå®šä¹‰å’Œè¿è¡Œå¤šå®¹å™¨åº”ç”¨ç¨‹åºçš„å·¥å…·ã€‚ Composeç®€åŒ–äº†å¯¹æ•´ä¸ªåº”ç”¨ç¨‹åºå †æ ˆçš„æ§åˆ¶ï¼Œä¾¿äºåœ¨å•ä¸ªYAMLé…ç½®æ–‡ä»¶ä¸­ç®¡ç†æœåŠ¡ã€ç½‘ç»œå’Œå·ã€‚ç„¶åï¼Œé€šè¿‡ä¸€ä¸ªå‘½ä»¤ï¼Œæ‚¨ä»é…ç½®æ–‡ä»¶ä¸­åˆ›å»ºå¹¶å¯åŠ¨æ‰€æœ‰æœåŠ¡ã€‚ Docker Compose çš„ä¼˜åŠ¿ï¼š ä¼˜ç‚¹ æè¿° ç®€åŒ–æ§åˆ¶ Docker Compose å…è®¸åœ¨å•ä¸ª YAML æ–‡ä»¶ä¸­å®šä¹‰å’Œç®¡ç†å¤šå®¹å™¨åº”ç”¨ç¨‹åºï¼Œç®€åŒ–äº†æœåŠ¡ç¼–æ’ä¸åè°ƒï¼Œä½¿ç¯å¢ƒç®¡ç†å’Œå¤åˆ¶æ›´å®¹æ˜“ã€‚ é«˜æ•ˆçš„åä½œ é…ç½®æ–‡ä»¶æ˜“äºå…±äº«ï¼Œä¿ƒè¿›å¼€å‘äººå‘˜ã€è¿è¥å›¢é˜Ÿå’Œå…¶ä»–åˆ©ç›Šç›¸å…³è€…ä¹‹é—´çš„åä½œï¼Œä»è€Œæå‡å·¥ä½œæµç¨‹æ•ˆç‡å’Œé—®é¢˜è§£å†³é€Ÿåº¦ã€‚ å¿«é€Ÿåº”ç”¨ç¨‹åºå¼€å‘ Compose åˆ©ç”¨ç¼“å­˜é‡å¤ä½¿ç”¨æœªæ›´æ”¹æœåŠ¡çš„å®¹å™¨ï¼ŒåŠ å¿«ç¯å¢ƒå˜æ›´é€Ÿåº¦ï¼Œæé«˜å¼€å‘æ•ˆç‡ã€‚ è·¨ç¯å¢ƒçš„å¯ç§»æ¤æ€§ æ”¯æŒåœ¨ Compose æ–‡ä»¶ä¸­ä½¿ç”¨å˜é‡ï¼Œä½¿é…ç½®èƒ½æ ¹æ®ä¸åŒç¯å¢ƒæˆ–ç”¨æˆ·è¿›è¡Œè‡ªå®šä¹‰ï¼Œå¢å¼ºäº†å¯ç§»æ¤æ€§ã€‚ å¹¿æ³›çš„ç¤¾åŒºå’Œæ”¯æŒ æ‹¥æœ‰æ´»è·ƒçš„ç¤¾åŒºï¼Œæä¾›ä¸°å¯Œçš„èµ„æºã€æ•™ç¨‹å’ŒæŠ€æœ¯æ”¯æŒï¼Œæœ‰åŠ©äºæŒç»­æ”¹è¿›ä¸é«˜æ•ˆæ’éšœã€‚ docker compose å®‰è£… åŒdockerä¸€èµ·å®‰è£… 12# å®‰è£…dockeråŒæ—¶å®‰è£…docker composeï¼Œè¿™é‡Œ docker-compose-plugin å°±æ˜¯docker composesudo dnf install docker-ce-3:26.1.3-1.el8 docker-ce-cli-3:26.1.3-1.el8 containerd.io docker-buildx-plugin docker-compose-plugin -y å•ç‹¬å®‰è£… 12# è‹¥å®‰è£…dockeræ—¶æ²¡æœ‰å®‰è£… docker-compose-plugin ï¼Œåˆ™éœ€è¦å•ç‹¬å®‰è£…sudo dnf install docker-compose-plugin -y æŸ¥çœ‹ç‰ˆæœ¬ 1docker compose version ç›´æ¥ä¸‹è½½docker-composeçš„å‘½ä»¤æ–‡ä»¶ 123456# Install Docker Composeï¼Œæ³¨æ„é€šè¿‡è¿™ç§æ–¹å¼å®‰è£…çš„composeçš„ä½¿ç”¨æ–¹å¼ä¸º `docker-compose`ï¼Œè€Œéæ ‡å‡†çš„ `docker compose`sudo curl -L &quot;https://github.com/docker/compose/releases/latest/download/docker-compose-$(uname -s)-$(uname -m)&quot; -o /usr/local/bin/docker-compose# Make the docker-compose command availablesudo chmod +x /usr/local/bin/docker-compose# Check Docker Compose versiondocker-compose version docker compose å‘½ä»¤ å‘½ä»¤ ä¸­æ–‡è¯´æ˜ ç¤ºä¾‹ attach è¿æ¥åˆ°æœåŠ¡çš„è¿è¡Œä¸­å®¹å™¨çš„æ ‡å‡†è¾“å…¥ã€è¾“å‡ºå’Œé”™è¯¯æµ docker compose attach web build æ„å»ºæˆ–é‡æ–°æ„å»ºæœåŠ¡ docker compose build config è§£æå¹¶æ ‡å‡†åŒ– Compose æ–‡ä»¶ docker compose config cp åœ¨æœåŠ¡å®¹å™¨ä¸æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿä¹‹é—´å¤åˆ¶æ–‡ä»¶/æ–‡ä»¶å¤¹ docker compose cp web:/app/file.txt ./file.txt create ä¸ºæœåŠ¡åˆ›å»ºå®¹å™¨ï¼Œä½†ä¸å¯åŠ¨ docker compose create down åœæ­¢å¹¶ç§»é™¤å®¹å™¨ã€ç½‘ç»œç­‰èµ„æº docker compose down events å®æ—¶æ¥æ”¶å®¹å™¨äº‹ä»¶ docker compose events exec åœ¨è¿è¡Œä¸­çš„å®¹å™¨ä¸­æ‰§è¡Œå‘½ä»¤ docker compose exec web ls /app images åˆ—å‡ºå·²åˆ›å»ºå®¹å™¨æ‰€ä½¿ç”¨çš„é•œåƒ docker compose images kill å¼ºåˆ¶åœæ­¢æœåŠ¡å®¹å™¨ docker compose kill logs æŸ¥çœ‹æœåŠ¡å®¹å™¨çš„æ—¥å¿—è¾“å‡º docker compose logs ls åˆ—å‡ºå½“å‰è¿è¡Œçš„ Compose é¡¹ç›® docker compose ls pause æš‚åœæœåŠ¡å®¹å™¨ docker compose pause port æ˜¾ç¤ºæŸç«¯å£æ˜ å°„çš„å…¬ç½‘åœ°å€ docker compose port web 80 ps åˆ—å‡ºæœåŠ¡çš„å®¹å™¨ docker compose ps pull æ‹‰å–æœåŠ¡ä½¿ç”¨çš„é•œåƒ docker compose pull push æ¨é€æœåŠ¡é•œåƒåˆ°ä»“åº“ docker compose push restart é‡å¯æœåŠ¡å®¹å™¨ docker compose restart rm ç§»é™¤å·²åœæ­¢çš„æœåŠ¡å®¹å™¨ docker compose rm run åœ¨æœåŠ¡ä¸Šè¿è¡Œä¸€æ¬¡æ€§å‘½ä»¤ docker compose run web echo Hello scale æ‰©å±•æœåŠ¡å®ä¾‹æ•°é‡ docker compose up --scale web=3 start å¯åŠ¨å·²å­˜åœ¨ä½†å·²åœæ­¢çš„æœåŠ¡å®¹å™¨ docker compose start stats å®æ—¶æ˜¾ç¤ºå®¹å™¨èµ„æºä½¿ç”¨æƒ…å†µ docker compose stats stop åœæ­¢è¿è¡Œä¸­çš„æœåŠ¡å®¹å™¨ docker compose stop top æ˜¾ç¤ºå®¹å™¨å†…çš„è¿è¡Œè¿›ç¨‹ docker compose top unpause å–æ¶ˆæš‚åœæœåŠ¡å®¹å™¨ docker compose unpause up åˆ›å»ºå¹¶å¯åŠ¨æœåŠ¡å®¹å™¨ docker compose up version æ˜¾ç¤º Docker Compose ç‰ˆæœ¬ä¿¡æ¯ docker compose version wait é˜»å¡ç›´åˆ°ç¬¬ä¸€ä¸ªæœåŠ¡å®¹å™¨åœæ­¢ docker compose wait watch ç›‘å¬æœåŠ¡æ„å»ºä¸Šä¸‹æ–‡å˜æ›´å¹¶é‡æ–°æ„å»º/åˆ·æ–°å®¹å™¨ docker compose watch docker compose å¸¸ç”¨å‘½ä»¤ å¯åŠ¨ä¸å…³é—­ 123456789101112131415161718# å¯åŠ¨å¹¶è¿è¡Œï¼Œé»˜è®¤ä½¿ç”¨å½“å‰ç›®å½•çš„ docker-compose.yml æ–‡ä»¶docker compose up# åå°è¿è¡Œdocker compose up -d# æŒ‡å®šcomposeæ–‡ä»¶docker compose -f docker-compose.yml up -d# å¯åŠ¨æ—¶é‡å»ºæœåŠ¡ï¼Œå½“ä¿®æ”¹äº† compose æ–‡ä»¶æ—¶docker compose up --build# åœæ­¢servicedocker compose stop# å¼ºåˆ¶åœæ­¢serviceï¼Œå½“ stop å‘½ä»¤æ— æ³•åœæ­¢æ—¶docker compose kill# é‡å¯servicedocker compose restart# åˆ é™¤serviceï¼Œ-s å‚æ•°è¡¨ç¤ºåˆ é™¤å‰å…ˆåœæ­¢å®¹å™¨docker compose rm -s# åœæ­¢å¹¶åˆ é™¤serviceï¼ŒåŒæ—¶åˆ é™¤ç½‘ç»œï¼Œä½†ä¸ä¼šåˆ é™¤å·docker compose down ç›‘æ§ 123456789101112131415161718# åˆ—å‡ºå½“å‰è¿è¡Œçš„ Compose é¡¹ç›®docker compose ls# æŸ¥çœ‹serviceçŠ¶æ€ï¼Œ-a æ˜¾ç¤ºæ‰€æœ‰servicedocker compose ps -a# è§£æå¹¶æ ‡å‡†åŒ– compose æ–‡ä»¶ï¼Œè¿™ä¸ªå‘½ä»¤å¯ä»¥æ£€æŸ¥ docker-compose.yml æ–‡ä»¶è¯­æ³•æ˜¯å¦æ­£ç¡®docker compose config# æŸ¥çœ‹ä½¿ç”¨çš„é•œåƒdocker compose images# æŸ¥çœ‹è¿›ç¨‹docker compose top# æŸ¥çœ‹serviceèµ„æºä½¿ç”¨æƒ…å†µdocker compose stats# æŸ¥çœ‹serviceæ—¥å¿—ï¼Œ-f è¡¨ç¤ºæŒç»­è·Ÿè¸ªdocker compose logs -f# æŸ¥çœ‹æŒ‡å®šserviceçš„æ—¥å¿—docker compose logs -f service_name# è¿›å…¥æŒ‡å®šçš„serviceå®¹å™¨docker compose exec service_name bash å‡çº§é•œåƒ 123456# å…ˆåœæ­¢æ‰€æœ‰servicedocker compose down# æ‹‰å–æœ€æ–°é•œåƒdocker compose pull# å¯åŠ¨servicedocker compose up -d --build docker-compose.yml çš„è¯­æ³• å¸¸ç”¨æŒ‡ä»¤ 123456789101112131415161718192021222324version: &quot;3.8&quot; # å®šä¹‰ç‰ˆæœ¬ï¼Œè¡¨ç¤ºå½“å‰ä½¿ç”¨çš„ docker compose è¯­æ³•çš„ç‰ˆæœ¬ï¼Œå·²è¿‡æ—¶ ï¼Œæ–°ç‰ˆ Docker ä¼šä½¿ç”¨æœ€æ–°çš„ Compose Specification è‡ªåŠ¨è§£æname: &quot;project_name&quot; # é¡¹ç›®åï¼Œé»˜è®¤ docker-compose.yml æ–‡ä»¶æ‰€åœ¨çš„ç›®å½•åï¼Œä¸æ¨èè®¾ç½®services: # æœåŠ¡åˆ—è¡¨ servicename: # æœåŠ¡åå­—ï¼Œåªèƒ½åŒ…å«å°å†™å­—æ¯ã€æ•°å­—ã€ä¸‹åˆ’çº¿ã€ä¸­åˆ’çº¿ï¼Œå¿…é¡»ä»¥å­—æ¯æˆ–æ•°å­—å¼€å¤´ build: # åŸºäºDockerfileæ„å»ºç›®å½•ï¼Œå¦‚æœåŒæ—¶è®¾ç½®äº† image é€‰é¡¹ï¼Œåˆ™imageæŒ‡å®šçš„å°±æ˜¯æ„å»ºåçš„é•œåƒåç§° image: # é•œåƒçš„åå­—ï¼Œé»˜è®¤ä»è¿œç¨‹ä»“åº“æ‹‰å–ï¼Œå¦‚æœé…ç½®äº† build é€‰é¡¹ï¼Œåˆ™imageæŒ‡å®šçš„å°±æ˜¯æ„å»ºåçš„é•œåƒåç§° command: # å¯é€‰ï¼Œå¦‚æœè®¾ç½®ï¼Œåˆ™ä¼šè¦†ç›–é»˜è®¤é•œåƒé‡Œçš„ CMD å‘½ä»¤ environment: # å¯é€‰ï¼Œç­‰ä»·äº docker container run é‡Œçš„ --env é€‰é¡¹è®¾ç½®ç¯å¢ƒå˜é‡ volumes: # å¯é€‰ï¼Œç­‰ä»·äº docker container run é‡Œçš„ -v é€‰é¡¹ ç»‘å®šæ•°æ®å· networks: # å¯é€‰ï¼Œç­‰ä»·äº docker container run é‡Œçš„ --network é€‰é¡¹æŒ‡å®šç½‘ç»œ ports: # å¯é€‰ï¼Œç­‰ä»·äº docker container run é‡Œçš„ -p é€‰é¡¹æŒ‡å®šç«¯å£æ˜ å°„ expose: # å¯é€‰ï¼ŒæŒ‡å®šå®¹å™¨æš´éœ²çš„ç«¯å£ depends_on: # æœåŠ¡ä¾èµ–çš„å…¶å®ƒæœåŠ¡ env_file: # ç¯å¢ƒå˜é‡æ–‡ä»¶ï¼Œç”Ÿäº§ç¯å¢ƒæ›´æ¨èè¿™ç§æ–¹å¼ servicename2: image: command: networks: ports: servicename3: #...volumes: # å¯é€‰ï¼Œç­‰ä»·äº docker volume createnetworks: # å¯é€‰ï¼Œç­‰ä»·äº docker network create volumes å·æ˜¯ç”±å®¹å™¨å¼•æ“å®ç°çš„æŒä¹…æ•°æ®å­˜å‚¨ã€‚Compose ä¸ºæœåŠ¡æä¾›äº†ä¸€ç§ä¸­ç«‹çš„æŒ‚è½½å·çš„æ–¹å¼ï¼Œå¹¶é€šè¿‡é…ç½®å‚æ•°å°†å·åˆ†é…ç»™åŸºç¡€æ¶æ„ã€‚é¡¶çº§volumeså£°æ˜å…è®¸æ‚¨é…ç½®å¯åœ¨å¤šä¸ªæœåŠ¡ä¹‹é—´é‡å¤ä½¿ç”¨çš„å‘½åå·ã€‚ 12345678910111213services: backend: image: example/database volumes: # æŒ‚è½½å·æ˜ å°„ - db-data:/etc/data # æŒ‚è½½åˆ°å®¹å™¨çš„/etc/dataç›®å½• backup: image: backup-service volumes: - db-data:/var/lib/backup/data # ä¸€ä¸ªå·å¯ä»¥è¢«å¤šä¸ªæœåŠ¡ä½¿ç”¨volumes: # å­˜å‚¨å·é…ç½® db-data: # åˆ›å»ºä¸€ä¸ªåä¸ºdb-dataçš„å·ï¼Œå®é™…çš„ç½‘ç»œåç§°æ˜¯ å®¹å™¨ç»„åç§°_è¿™é‡Œçš„åç§° volumes çš„å±æ€§ driver: å·ç±»å‹ï¼Œé»˜è®¤ä¸ºlocalï¼ŒæŒ‡å®šåº”ä½¿ç”¨å“ªä¸ªå·é©±åŠ¨ç¨‹åºã€‚å¦‚æœè¯¥é©±åŠ¨ç¨‹åºä¸å¯ç”¨ï¼ŒCompose å°†è¿”å›é”™è¯¯å¹¶ä¸”ä¸ä¼šéƒ¨ç½²è¯¥åº”ç”¨ç¨‹åºã€‚ 1234volumes: db-data: # å£°æ˜ä¸€ä¸ªåä¸ºdb-dataçš„å· driver: local # æŒ‡å®šå·ç±»å‹ï¼Œè¿™ä¸ªæ˜¯é»˜è®¤å€¼ï¼Œå¯ä»¥ä¸é…ç½® db-data2: # å£°æ˜ä¸€ä¸ªåä¸ºdb-data2çš„å·ï¼Œè¿™æ˜¯æœ€ç®€å•çš„ volumes é…ç½® driver_opts: å·ç±»å‹å‚æ•°ï¼ŒæŒ‡å®šè¦ä¼ é€’ç»™æ­¤å·é©±åŠ¨ç¨‹åºçš„é€‰é¡¹åˆ—è¡¨ï¼ˆä»¥é”®å€¼å¯¹çš„å½¢å¼ï¼‰ã€‚è¿™äº›é€‰é¡¹ä¸é©±åŠ¨ç¨‹åºç›¸å…³ã€‚ 123456volumes: db-data: driver_opts: # å·ç±»å‹å‚æ•°ï¼ŒæŒ‡å®šè¦ä¼ é€’ç»™æ­¤å·é©±åŠ¨ç¨‹åºçš„é€‰é¡¹åˆ—è¡¨ï¼ˆä»¥é”®å€¼å¯¹çš„å½¢å¼ï¼‰ type: &quot;nfs&quot; # å·ç±»å‹ï¼ŒæŒ‡å®šåº”ä½¿ç”¨å“ªä¸ªå·é©±åŠ¨ç¨‹åºï¼Œè¿™é‡Œæ˜¯nfs o: &quot;addr=10.40.0.199,nolock,soft,rw&quot; # nfså‚æ•°ï¼Œaddrä¸ºnfsæœåŠ¡å™¨åœ°å€ï¼Œnolockä¸ºä¸é”å®šæ–‡ä»¶ï¼Œsoftä¸ºè½¯é“¾æ¥ï¼Œrwä¸ºè¯»å†™æƒé™ device: &quot;:/docker/example&quot; # nfsæŒ‚è½½è·¯å¾„ external: å·æ˜¯å¦ä¸ºå¤–éƒ¨å·ï¼Œé»˜è®¤ä¸ºfalse 123volumes: db-data: external: true # true è¡¨ç¤ºä¸ä¼šåˆ›å»ºï¼Œè€Œæ˜¯ä½¿ç”¨å·²å­˜åœ¨çš„ï¼Œå³ä¼šå»volumesä¸­æŸ¥æ‰¾(docker volume ls) å®¹å™¨ç»„åç§°_da-data ï¼Œé»˜è®¤ä¸ºfalse name: å·çš„åç§°ï¼Œé»˜è®¤ä¸º å®¹å™¨ç»„åç§°_å£°æ˜çš„åç§° 1234volumes: db-data: name: db-data # åˆ›å»ºä¸€ä¸ªåä¸ºdb-dataçš„å·ï¼Œå®é™…çš„å·åç§°å°±æ˜¯ db-dataï¼Œä¸ä¼šå†åŠ ä¸Šå®¹å™¨ç»„åç§°å‰ç¼€ external: true # name å±æ€§ç»å¸¸ä¸ external: true ä¸€èµ·ä½¿ç”¨ labels: ç”¨äºå‘å·æ·»åŠ å…ƒæ•°æ®ï¼Œå¯ä»¥æ·»åŠ ä»»æ„çš„é”®å€¼å¯¹ 123456volumes: db-data: labels: com.example.description: &quot;Database volume&quot; com.example.department: &quot;IT/Ops&quot; com.example.label-with-empty-value: &quot;&quot; networks ç½‘ç»œä½¿æœåŠ¡èƒ½å¤Ÿç›¸äº’é€šä¿¡ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒCompose ä¼šä¸ºæ‚¨çš„åº”ç”¨è®¾ç½®å•ä¸ªç½‘ç»œã€‚æœåŠ¡çš„æ¯ä¸ªå®¹å™¨éƒ½ä¼šåŠ å…¥é»˜è®¤ç½‘ç»œï¼Œå¹¶ä¸”è¯¥ç½‘ç»œä¸Šçš„å…¶ä»–å®¹å™¨éƒ½å¯ä»¥è®¿é—®ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡æœåŠ¡åç§°å‘ç°ã€‚é¡¶çº§networkså…ƒç´ å…è®¸æ‚¨é…ç½®å¯åœ¨å¤šä¸ªæœåŠ¡ä¹‹é—´é‡å¤ä½¿ç”¨çš„å‘½åç½‘ç»œã€‚ 1234567891011121314services: frontend: image: example/webapp networks: # ç½‘ç»œæ˜ å°„ - front-tier # åŠ å…¥front-tierç½‘ç»œ - back-tier db: image: postgres networks: - backendnetworks: # ç½‘ç»œé…ç½® front-tier: # åˆ›å»ºä¸€ä¸ªåä¸ºfront-tierçš„ç½‘ç»œï¼Œå®é™…çš„ç½‘ç»œåç§°æ˜¯ å®¹å™¨ç»„åç§°_front-tier back-tier: å¦‚æœ Compose æ–‡ä»¶æœªæ˜¾å¼å£°æ˜ç½‘ç»œï¼ŒCompose å°†ä½¿ç”¨éšå¼defaultç½‘ç»œã€‚ 123456789101112services: some-service: image: foo# è¿™ä¸ªä¾‹å­å®é™…ä¸Šç­‰åŒäºï¼šservices: some-service: image: foo networks: default: &#123;&#125;networks: default: &#123;&#125; networks çš„å±æ€§ driver: ç½‘ç»œç±»å‹ï¼Œé»˜è®¤ä¸ºbridge 123networks: gitea: driver: bridge driver_opts: ç½‘ç»œç±»å‹å‚æ•°ï¼ŒæŒ‡å®šè¦ä¼ é€’ç»™æ­¤ç½‘ç»œé©±åŠ¨ç¨‹åºçš„é€‰é¡¹åˆ—è¡¨ï¼ˆä»¥é”®å€¼å¯¹çš„å½¢å¼ï¼‰ã€‚è¿™äº›é€‰é¡¹ä¸é©±åŠ¨ç¨‹åºç›¸å…³ã€‚ 12345networks: frontend: driver: bridge driver_opts: com.docker.network.bridge.host_binding_ipv4: &quot;127.0.0.1&quot; # è®¾ç½®å®¹å™¨ç«¯å£ç»‘å®šåˆ°ä¸»æœºçš„å“ªä¸ª IPï¼ˆå¦‚ &quot;127.0.0.1&quot;ï¼Œç»‘å®šåˆ°æœ¬åœ°ï¼‰ driver_opts å¸¸è§é…ç½®é¡¹ï¼ˆé’ˆå¯¹ bridge ç½‘ç»œé©±åŠ¨ï¼‰ é€‰é¡¹é”®åï¼ˆdriver_optsï¼‰ è¯´æ˜ com.docker.network.bridge.name æŒ‡å®šæ¡¥æ¥ç½‘ç»œçš„åç§°ï¼ˆé»˜è®¤æ˜¯éšæœºç”Ÿæˆï¼Œå¦‚ br-xxxxxï¼‰ com.docker.network.bridge.enable_icc æ˜¯å¦å…è®¸å®¹å™¨ä¹‹é—´çš„é€šä¿¡ï¼ˆtrue æˆ– falseï¼‰ com.docker.network.bridge.enable_ip_masquerade æ˜¯å¦å¯ç”¨ IP å‡å†’ï¼ˆNATï¼Œé€šå¸¸ç”¨äºå¤–ç½‘è®¿é—®ï¼‰ com.docker.network.bridge.host_binding_ipv4 è®¾ç½®å®¹å™¨ç«¯å£ç»‘å®šåˆ°ä¸»æœºçš„å“ªä¸ª IPï¼ˆå¦‚ &quot;127.0.0.1&quot;ï¼Œç»‘å®šåˆ°æœ¬åœ°ï¼‰ com.docker.network.bridge.default_bridge æ˜¯å¦å°†è¯¥ç½‘ç»œè®¾ç½®ä¸ºé»˜è®¤ bridge ç½‘ç»œï¼ˆtrue æˆ– falseï¼‰ com.docker.network.driver.mtu è®¾ç½®ç½‘ç»œçš„æœ€å¤§ä¼ è¾“å•å…ƒï¼ˆMTUï¼Œä¾‹å¦‚ &quot;1500&quot;ï¼‰ com.docker.network.bridge.allow_non_default_bridge æ˜¯å¦å…è®¸å®¹å™¨åŠ å…¥éé»˜è®¤çš„ bridge ç½‘ç»œï¼ˆè¾ƒå°‘ä½¿ç”¨ï¼‰ attachable: å¦‚æœä¸ºtrueï¼Œåˆ™å…è®¸å°†å…¶å®ƒç‹¬ç«‹å®¹å™¨ä¹ŸåŠ å…¥åˆ°æ­¤ç½‘ç»œã€‚é»˜è®¤å€¼ä¸ºfalseã€‚å¦‚æœç‹¬ç«‹å®¹å™¨è¿æ¥åˆ°æ­¤ç½‘ç»œï¼Œå®ƒå¯ä»¥ä¸åŒæ ·è¿æ¥åˆ°æ­¤ç½‘ç»œçš„æœåŠ¡å’Œå…¶ä»–ç‹¬ç«‹å®¹å™¨è¿›è¡Œé€šä¿¡ã€‚ 123networks: gitea: attachable: true external: true è¡¨ç¤ºä¸ä¼šåˆ›å»ºæ–°çš„ç½‘ç»œï¼Œå›å»networksä¸­æŸ¥æ‰¾ï¼ˆdocker network lsï¼‰ï¼Œé»˜è®¤ä¸ºfalse 123networks: gitea: external: true name: ç½‘ç»œåç§°ï¼Œä¸ä¼šå†åŠ ä¸Šå®¹å™¨ç»„åç§°å‰ç¼€ 1234networks: gitea: name: gitea external: true # name å±æ€§ç»å¸¸ä¸ external: true ä¸€èµ·ä½¿ç”¨ labels: ç”¨äºå‘ç½‘ç»œæ·»åŠ å…ƒæ•°æ®ï¼Œå¯ä»¥æ·»åŠ ä»»æ„çš„é”®å€¼å¯¹ 123456networks: mynet1: labels: com.example.description: &quot;Financial transaction network&quot; com.example.department: &quot;Finance&quot; com.example.label-with-empty-value: &quot;&quot; internal: é»˜è®¤æƒ…å†µä¸‹ï¼ŒCompose æä¾›ç½‘ç»œçš„å¤–éƒ¨è¿æ¥ã€‚internalå½“è®¾ç½®ä¸º æ—¶trueï¼Œå¯è®©æ‚¨åˆ›å»ºä¸å¤–éƒ¨éš”ç¦»çš„ç½‘ç»œã€‚ 123networks: gitea: internal: true services æœåŠ¡æ˜¯åº”ç”¨ç¨‹åºä¸­è®¡ç®—èµ„æºçš„æŠ½è±¡å®šä¹‰ï¼Œå¯ä»¥ç‹¬ç«‹äºå…¶ä»–ç»„ä»¶è¿›è¡Œæ‰©å±•æˆ–æ›¿æ¢ã€‚æœåŠ¡ç”±ä¸€ç»„å®¹å™¨æ”¯æŒï¼Œç”±å¹³å°æ ¹æ®å¤åˆ¶è¦æ±‚å’Œå¸ƒå±€çº¦æŸè¿è¡Œã€‚ç”±äºæœåŠ¡ç”±å®¹å™¨æ”¯æŒï¼Œå› æ­¤å®ƒä»¬ç”± Docker é•œåƒå’Œä¸€ç»„è¿è¡Œæ—¶å‚æ•°å®šä¹‰ã€‚æœåŠ¡ä¸­çš„æ‰€æœ‰å®¹å™¨éƒ½ä½¿ç”¨è¿™äº›å‚æ•°ä»¥ç›¸åŒçš„æ–¹å¼åˆ›å»ºã€‚ service åŒ…å«çš„å±æ€§éå¸¸å¤šï¼Œå…·ä½“è¯·å‚è€ƒservicesé¡¶çº§å…ƒç´ ï¼Œè¿™é‡Œåªä»‹ç»æ¯”è¾ƒå¸¸ç”¨çš„å±æ€§ï¼Œä»¥giteaçš„docker-compose.ymlä¸ºä¾‹ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455# version: &#x27;3.8&#x27; # é…ç½®æ–‡ä»¶ç‰ˆæœ¬ï¼Œå·²è¿‡æ—¶ï¼Œé…ç½®ä¸Šä¼šå‘Šè­¦ä½†ä¸ä¼šæŠ¥é”™# name: gitea # å®¹å™¨ç»„åç§°ï¼Œé»˜è®¤ä½¿ç”¨æ‰€åœ¨ç›®å½•çš„åç§°ï¼Œä¸æ¨èä½¿ç”¨networks: # ç½‘ç»œé…ç½® gitea: # åˆ›å»ºä¸€ä¸ªåä¸ºgiteaçš„ç½‘ç»œï¼Œå®é™…çš„ç½‘ç»œåç§°æ˜¯ gitea_giteaï¼Œå³ å®¹å™¨ç»„åç§°_è¿™é‡Œçš„åç§° external: false # å¦‚æœä¸ºtrueï¼Œåˆ™è¡¨ç¤ºæ­¤ç½‘ç»œä¸ä¼šç”±composeåˆ›å»ºï¼Œè€Œæ˜¯ä½¿ç”¨å·²æœ‰çš„ç½‘ç»œï¼Œé»˜è®¤ä¸ºfalse driver: bridge # ç½‘ç»œç±»å‹ï¼Œé»˜è®¤ä¸ºbridgevolumes: # å­˜å‚¨å·é…ç½® gitea: # åˆ›å»ºä¸€ä¸ªåä¸ºgiteaçš„å­˜å‚¨å·ï¼Œå®é™…çš„å·åç§°æ˜¯ gitea_giteaï¼Œå³ å®¹å™¨ç»„åç§°_è¿™é‡Œçš„åç§° driver: local # å­˜å‚¨å·ç±»å‹ï¼Œé»˜è®¤ä¸ºlocalservices: # æœåŠ¡é…ç½®ï¼Œè¿™é‡Œå¯ä»¥å®šä¹‰ä¸€ç»„å®¹å™¨ server: # å®šä¹‰ä¸€ä¸ªåä¸ºserverçš„æœåŠ¡ï¼Œæ³¨æ„è¿™ä¸ªä¸æ˜¯å®¹å™¨åç§° # build: . # æ„å»ºé•œåƒï¼Œä½¿ç”¨å½“å‰ç›®å½•ä¸‹çš„Dockerfile image: gitea/gitea:latest # é•œåƒåç§° # container_name: gitea # å®¹å™¨åç§°ï¼Œé»˜è®¤ä¸º â€œå®¹å™¨ç»„åç§°-æœåŠ¡åç§°-ç´¢å¼•â€ï¼Œä¸æ¨èé…ç½®ï¼Œå› ä¸º æ°´å¹³æ‰©å±•(--scale) æ—¶,å®¹å™¨åç§°ä¸èƒ½é‡å¤ environment: # å®šä¹‰ç¯å¢ƒå˜é‡ - USER_UID=1000 # key=value - USER_GID=1000 - DB_TYPE=mysql - DB_HOST=db:3306 # è¿™é‡Œé…ç½®çš„ db å°±æ˜¯ ä¸‹é¢çš„æœåŠ¡åç§°ï¼Œç›¸åŒ network ä¸‹çš„æœåŠ¡åç§°ï¼Œdocker composeä¼šè‡ªåŠ¨è§£æä¸ºå®¹å™¨çš„ipåœ°å€ - DB_NAME=gitea - DB_USER=gitea - DB_PASSWD=gitea # env_file: .gitea.env # ä» .gitea.env æ–‡ä»¶è¯»å–ç¯å¢ƒå˜é‡ï¼Œç”Ÿäº§ç¯å¢ƒæ›´æ¨è restart: always # å®¹å™¨å¯åŠ¨æ—¶ï¼Œè‡ªåŠ¨é‡å¯ networks: # ç½‘ç»œå…³è” - gitea # ç½‘ç»œåç§°ï¼Œå°±æ˜¯ä¸Šé¢åˆ›å»ºçš„giteaç½‘ç»œ volumes: # æ•°æ®å·å…³è” - gitea:/data # volumeæ˜ å°„ï¼Œæ•°æ®å·åç§°:/å®¹å™¨è·¯å¾„ - /etc/timezone:/etc/timezone:ro # è·¯å¾„æ˜ å°„ï¼Œå®¿ä¸»æœºè·¯å¾„:/å®¹å™¨è·¯å¾„:è¯»å†™æƒé™ - /etc/localtime:/etc/localtime:ro ports: # ç«¯å£æ˜ å°„ - &quot;3000:3000&quot; # å®¿ä¸»æœºç«¯å£:å®¹å™¨ç«¯å£ depends_on: # å¯åŠ¨ä¾èµ–ï¼Œå°±æ˜¯ä¾èµ–çš„æœåŠ¡å¯åŠ¨åæ‰èƒ½å¯åŠ¨æœ¬æœåŠ¡ db: # å¯åŠ¨dbæœåŠ¡ condition: service_healthy # æœåŠ¡é€šè¿‡å¥åº·æ£€æŸ¥ï¼Œä¹Ÿå¯ä»¥é…ç½®ä¸º service_startedï¼šæœåŠ¡å¯åŠ¨ï¼Œè¿™ä¸ªæ˜¯é»˜è®¤å€¼ db: # æ•°æ®åº“æœåŠ¡ image: mysql:8 # é•œåƒ environment: # ç¯å¢ƒå˜é‡ - MYSQL_ROOT_PASSWORD=gitea - MYSQL_USER=gitea - MYSQL_PASSWORD=gitea - MYSQL_DATABASE=gitea restart: always # å¯åŠ¨ç­–ç•¥ networks: # ç½‘ç»œæ˜ å°„ - gitea # æ˜ å°„åˆ°giteaç½‘ç»œ volumes: # å·æ˜ å°„ - ./mysql:/var/lib/mysql # å®¿ä¸»æœºè·¯å¾„:/å®¹å™¨è·¯å¾„ï¼Œè¿™é‡Œå®¿ä¸»æœºæ”¯æŒç›¸å¯¹è·¯å¾„ healthcheck: # å¥åº·æ£€æŸ¥ test: [&quot;CMD-SHELL&quot;, &quot;mysql -u root -pgitea&quot;, &quot;-e &#x27;SELECT 1;&#x27;&quot;] # æ‰§è¡Œå‘½ä»¤ï¼Œå¦‚æœè¿”å›0ï¼Œåˆ™å¥åº·æ£€æŸ¥é€šè¿‡ï¼Œè¿™é‡Œä¸æ”¯æŒä¸Šé¢çš„ç¯å¢ƒå˜é‡ï¼Œteståªæ”¯æŒ CMD-SHELL å’Œ CMD interval: 10s # å¥åº·æ£€æŸ¥é—´éš” timeout: 5s # å¥åº·æ£€æŸ¥è¶…æ—¶æ—¶é—´ retries: 3 # å¥åº·æ£€æŸ¥é‡è¯•æ¬¡æ•° build: æ„å»ºé•œåƒ 1234services: server: build: . # Dockerfileçš„ç›®å½•ï¼Œâ€œ.â€ è¡¨ç¤ºä½¿ç”¨å½“å‰ç›®å½•ä¸‹çš„Dockerfile image: example/webapp # é•œåƒåç§°ï¼Œå¦‚æœæœ‰buildï¼Œåˆ™è¯¥åç§°å°±æ˜¯buildåçš„é•œåƒåç§°ï¼Œå¦‚æœæ²¡æœ‰buildï¼Œåˆ™å°±ä¼šä»è¿œç¨‹ä»“åº“æ‹‰å– 12345678910111213services: server: build: context: ./webapp # Dockerfileçš„ç›®å½•ï¼Œé»˜è®¤æ˜¯å½“å‰ç›®å½• dockerfile: Dockerfile # æ„å»ºé•œåƒçš„Dockerfileåç§°ï¼Œé»˜è®¤æ˜¯Dockerfile platforms: # æ„å»ºé•œåƒçš„æ¶æ„ - linux/amd64 # æ„å»ºé•œåƒçš„æ¶æ„ï¼Œé»˜è®¤æ˜¯å½“å‰æ¶æ„ args: # æ„å»ºé•œåƒçš„å‚æ•° - FOO=bar labels: # æ„å»ºé•œåƒçš„æ ‡ç­¾ com.example.description: &quot;Accounting webapp&quot; com.example.department: &quot;Finance&quot; com.example.label-with-empty-value: &quot;&quot; command: è¦†ç›–å®¹å™¨æ˜ åƒå£°æ˜çš„é»˜è®¤å‘½ä»¤ 1234services: server: command: [&quot;python&quot;, &quot;app.py&quot;] image: example/webapp entrypoint: å£°æ˜æœåŠ¡å®¹å™¨çš„é»˜è®¤å…¥å£ç‚¹ï¼Œè¿™è¦†ç›–äº†æœåŠ¡Dockerfileä¸­çš„ENTRYPOINTæŒ‡ä»¤ã€‚ 123456789101112services: server: image: example/webapp entrypoint: - php - -d - zend_extension=/usr/local/lib/php/extensions/no-debug-non-zts-20100525/xdebug.so - -d - memory_limit=-1 - vendor/bin/phpunit # å¦‚æœå€¼ä¸ºnullï¼Œåˆ™ä½¿ç”¨å›¾åƒçš„é»˜è®¤å…¥å£ç‚¹ã€‚ entrypoint: null # å¦‚æœå€¼æ˜¯ []ï¼ˆç©ºåˆ—è¡¨ï¼‰æˆ– &#x27;&#x27;ï¼ˆç©ºå­—ç¬¦ä¸²ï¼‰ï¼Œå›¾åƒå£°æ˜çš„é»˜è®¤å…¥å£ç‚¹è¢«å¿½ç•¥ï¼Œæˆ–è€…æ¢å¥è¯è¯´ï¼Œè¢«è¦†ç›–ä¸ºç©ºã€‚ entrypoint: [] depends_on: æœåŠ¡å¯åŠ¨ä¾èµ–ï¼Œå°±æ˜¯ä¾èµ–çš„æœåŠ¡å¯åŠ¨åæ‰èƒ½å¯åŠ¨æœ¬æœåŠ¡ 12345678910services: web: build: . depends_on: - db # çŸ­è¯­æ³• - redis redis: image: redis db: image: postgres 12345678910111213141516171819services: web: build: . depends_on: db: # é•¿è¯­æ³• condition: service_healthy # æ»¡è¶³çš„æ¡ä»¶ restart: true # å½“è®¾ç½®ä¸ºtrueï¼ŒComposeåœ¨æ›´æ–°ä¾èµ–æœåŠ¡åé‡æ–°å¯åŠ¨æ­¤æœåŠ¡ã€‚ redis: condition: service_started redis: image: redis db: image: postgres## conditionï¼šè®¾ç½®ä¾èµ–æ€§è¢«è§†ä¸ºæ»¡è¶³çš„æ¡ä»¶# service_startedï¼šç›¸å½“äºä¹‹å‰æè¿°çš„ç®€çŸ­è¯­æ³•# service_healthyï¼šæŒ‡å®šåœ¨å¯åŠ¨ä¾èµ–æœåŠ¡ä¹‹å‰ï¼Œä¾èµ–é¢„æœŸä¸ºâ€œå¥åº·â€ï¼ˆå¦‚healthcheckæ‰€ç¤ºï¼‰ã€‚# service_completed_successfullyï¼šæŒ‡å®šåœ¨å¯åŠ¨ä¾èµ–æœåŠ¡ä¹‹å‰ï¼Œä¾èµ–é¡¹é¢„è®¡å°†è¿è¡Œåˆ°æˆåŠŸå®Œæˆã€‚ environment: å®šä¹‰ç¯å¢ƒå˜é‡ 12345678910111213services: server: image: example/webapp environment: - FOO=bar - BAZ=qux# æˆ–è€…services: server: image: example/webapp environment: FOO: bar BAZ: qux env_file: ç”¨äºæŒ‡å®šä¸€ä¸ªæˆ–å¤šä¸ªåŒ…å«è¦ä¼ é€’åˆ°å®¹å™¨çš„ç¯å¢ƒå˜é‡çš„æ–‡ä»¶ã€‚ 123456services: server: image: example/webapp env_file: - ./a.env # åˆ—è¡¨ä¸­çš„æ–‡ä»¶æ˜¯ä»ä¸Šåˆ°ä¸‹å¤„ç†çš„ã€‚å¯¹äºä¸¤ä¸ªç¯å¢ƒæ–‡ä»¶ä¸­æŒ‡å®šçš„ç›¸åŒå˜é‡ï¼Œåˆ—è¡¨ä¸­æœ€åä¸€ä¸ªæ–‡ä»¶çš„å€¼æ˜¯æœ‰æ•ˆçš„ã€‚ - ./b.env 12345678services: server: image: example/webapp env_file: - path: ./default.env required: true # default - path: ./override.env required: false # å½“requiredè®¾ç½®ä¸ºfalseä¸”.envæ–‡ä»¶ç¼ºå¤±æ—¶ï¼ŒComposeä¼šå¿½ç•¥ restart: å®šä¹‰å¹³å°åœ¨å®¹å™¨ç»ˆæ­¢æ—¶é€‚ç”¨çš„ç­–ç•¥ 12345678services: server: image: example/webapp restart: &quot;no&quot; # é»˜è®¤é‡å¯ç­–ç•¥ã€‚åœ¨ä»»ä½•æƒ…å†µä¸‹ï¼Œå®ƒéƒ½ä¸ä¼šé‡æ–°å¯åŠ¨å®¹å™¨ã€‚ # restart: always # ç­–ç•¥æ€»æ˜¯é‡æ–°å¯åŠ¨å®¹å™¨ï¼Œç›´åˆ°å®ƒè¢«ç§»é™¤ã€‚ # restart: on-failure # å¦‚æœé€€å‡ºä»£ç è¡¨æ˜é”™è¯¯ï¼Œç­–ç•¥å°†é‡æ–°å¯åŠ¨å®¹å™¨ã€‚ # restart: on-failure:3 # å¦‚æœé€€å‡ºä»£ç è¡¨æ˜é”™è¯¯ï¼Œç­–ç•¥å°†é‡æ–°å¯åŠ¨å®¹å™¨ã€‚ä½†ä»…å°è¯•é‡å¯3æ¬¡ã€‚ # restart: unless-stopped # æ— è®ºé€€å‡ºä»£ç å¦‚ä½•ï¼Œç­–ç•¥éƒ½ä¼šé‡æ–°å¯åŠ¨å®¹å™¨ï¼Œä½†å½“æœåŠ¡åœæ­¢æˆ–åˆ é™¤æ—¶ï¼Œç­–ç•¥ä¼šåœæ­¢é‡æ–°å¯åŠ¨ã€‚ healthcheck: å¥åº·æ£€æŸ¥ã€‚ 12345678910services: server: image: example/webapp healthcheck: # å¥åº·æ£€æŸ¥ test: [&quot;CMD&quot;, &quot;curl&quot;, &quot;-f&quot;, &quot;http://localhost&quot;] # ç›‘æ§æ£€æŸ¥æ—¶æ‰§è¡Œçš„å‘½ä»¤ interval: 1m30s # å¥åº·æ£€æŸ¥çš„é—´éš”ï¼Œé»˜è®¤å€¼ä¸º 30s timeout: 10s # å¥åº·æ£€æŸ¥çš„è¶…æ—¶æ—¶é—´ï¼Œé»˜è®¤å€¼ä¸º 30s retries: 3 # å¥åº·æ£€æŸ¥çš„å°è¯•æ¬¡æ•°ï¼Œé»˜è®¤å€¼ä¸º 3 start_period: 40s # å¯åŠ¨å®½é™æœŸï¼šåœ¨æ­¤æœŸé—´ï¼Œå¤±è´¥ä¸ä¼šè®¡å…¥é‡è¯•æ¬¡æ•°ï¼ˆä»…ç”¨äºåˆ¤æ–­æœåŠ¡æ˜¯å¦å¯åŠ¨å®Œæ¯•ï¼‰ start_interval: 5s # å¯åŠ¨å®½é™æœŸå†…æ£€æŸ¥çš„é¢‘ç‡ï¼Œæœ¬ç¤ºä¾‹ä¸ºåœ¨å‰ 40 ç§’å†…æ¯ 5 ç§’æ£€æŸ¥ä¸€æ¬¡ testå®šä¹‰Composeè¿è¡Œçš„å‘½ä»¤æ¥æ£€æŸ¥å®¹å™¨è¿è¡ŒçŠ¶å†µã€‚å®ƒå¯ä»¥æ˜¯å­—ç¬¦ä¸²ï¼Œä¹Ÿå¯ä»¥æ˜¯åˆ—è¡¨ã€‚å¦‚æœæ˜¯åˆ—è¡¨ï¼Œç¬¬ä¸€ä¸ªé¡¹ç›®å¿…é¡»æ˜¯NONEã€CMDæˆ–CMD-SHELLã€‚å¦‚æœå®ƒæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå®ƒç­‰åŒäºæŒ‡å®šCMD-SHELLåè·Ÿè¯¥å­—ç¬¦ä¸²ã€‚ 1234test: [&quot;CMD&quot;, &quot;curl&quot;, &quot;-f&quot;, &quot;http://localhost&quot;]# ä½¿ç”¨CMD-SHELLè¿è¡Œé…ç½®ä¸ºå­—ç¬¦ä¸²çš„å‘½ä»¤ï¼Œä½¿ç”¨å®¹å™¨çš„é»˜è®¤å¤–å£³ï¼ˆLinuxçš„/bin/shï¼‰ã€‚ä»¥ä¸‹ä¸¤ç§å½¢å¼æ˜¯ç­‰ä»·çš„test: [&quot;CMD-SHELL&quot;, &quot;curl -f http://localhost || exit 1&quot;]test: curl -f https://localhost || exit 1 test ä¸­çš„ CMD å’Œ CMD-SHELL æ˜¯ä¸¤ç§ä¸åŒçš„æ‰§è¡Œæ–¹å¼ï¼Œå®ƒä»¬çš„ä¸»è¦åŒºåˆ«åœ¨äºï¼š é¡¹ç›® CMD CMD-SHELL âœ… ç”¨é€” ç›´æ¥æ‰§è¡Œå‘½ä»¤ï¼ˆä¸é€šè¿‡ shellï¼‰ é€šè¿‡ shellï¼ˆå¦‚ /bin/sh -cï¼‰æ‰§è¡Œå‘½ä»¤ ğŸ§¾ å†™æ³•æ ¼å¼ [&quot;CMD&quot;, &quot;executable&quot;, &quot;arg1&quot;, &quot;arg2&quot;] [&quot;CMD-SHELL&quot;, &quot;command string&quot;] ğŸ”§ æ˜¯å¦ä½¿ç”¨ shell å¦ æ˜¯ ğŸ§  æ˜¯å¦æ”¯æŒ shell è¯­æ³• âŒ å¦ï¼ˆä¸èƒ½ä½¿ç”¨ &amp;&amp;ã€ ||ã€\\$VAR ç­‰ï¼‰ âœ… æ˜¯ï¼ˆæ”¯æŒç®¡é“ã€é‡å®šå‘ã€å˜é‡ã€å‘½ä»¤ç»„åˆï¼‰ ğŸ›¡ï¸ å®‰å…¨æ€§/å¯ç§»æ¤æ€§ âœ… æ›´å®‰å…¨ï¼Œæ‰§è¡Œæ›´æ˜ç¡® âš  ä¾èµ–å®¹å™¨ä¸­å­˜åœ¨ shellï¼ˆå¦‚ /bin/shï¼‰ âš™ï¸ æ‰§è¡Œæ•ˆç‡ âœ… ç¨å¿«ï¼Œå› æ— éœ€ shell è§£æ âš  ç¨æ…¢ï¼Œéœ€é€šè¿‡ shell å¯åŠ¨ ğŸ“¦ æ¨èä½¿ç”¨åœºæ™¯ - ç®€å•å¥åº·æ£€æŸ¥å‘½ä»¤- å®‰å…¨ç¯å¢ƒ- ç²¾ç®€é•œåƒ - éœ€è¦ä½¿ç”¨é€»è¾‘æ§åˆ¶ï¼ˆ||, &amp;&amp;ï¼‰- å¤æ‚æ£€æŸ¥é€»è¾‘ ğŸ“Œ ç¤ºä¾‹ [&quot;CMD&quot;, &quot;curl&quot;, &quot;-f&quot;, &quot;http://localhost&quot;] [&quot;CMD-SHELL&quot;, &quot;curl -f http\\://localhost || exit 1&quot;] volumes: æŒ‚è½½æ•°æ®å·ã€‚ 123456789101112131415161718192021222324252627282930# é•¿è¯­æ³•æ ¼å¼services: backend: image: example/backend volumes: - type: volume # å®‰è£…ç±»å‹ã€‚å¯ä»¥æ˜¯æ˜¯volumeã€bindã€tmpfsã€imageã€npipeã€cluster source: db-data # æŒ‚è½½çš„æºã€ç»‘å®šæŒ‚è½½çš„ä¸»æœºä¸Šçš„è·¯å¾„ã€æ˜ åƒæŒ‚è½½çš„Dockeræ˜ åƒå¼•ç”¨æˆ–é¡¶å±‚volumesé”®ä¸­å®šä¹‰çš„å·åç§°ã€‚ä¸é€‚ç”¨äºtmpfsæ”¯æ¶ã€‚ target: /data # å®¹å™¨ä¸­è£…è½½å·çš„è·¯å¾„ã€‚ volume: # é…ç½®å…¶ä»–å·é€‰é¡¹ nocopy: true # åœ¨åˆ›å»ºå·æ—¶ç¦ç”¨ä»å®¹å™¨å¤åˆ¶æ•°æ®çš„æ ‡å¿—ï¼Œé»˜è®¤å€¼ä¸ºfalseã€‚ subpath: sub # æŒ‚è½½å·çš„å­ç›®å½•ã€‚å³ db-data/sub - type: bind # bind è¡¨ç¤ºæŒ‚è½½ä¸»æœºä¸Šçš„è·¯å¾„ source: /var/run/postgres/postgres.sock target: /var/run/postgres/postgres.sockvolumes: # å£°æ˜æ•°æ®å· db-data:####################################################################################### çŸ­è¯­æ³•æ ¼å¼services: backend: image: example/backend volumes: - db-data:/data # è¿™ç§è¯­æ³•ä¸æ”¯æŒ subpath å’Œ nocopy - /var/run/postgres/postgres.sock:/var/run/postgres/postgres.sockvolumes: db-data: networks: é…ç½®ç½‘ç»œã€‚ 123456789services: some-service: networks: # é…ç½®ç½‘ç»œ - some-network # å…³è”ç½‘ç»œ - other-networknetworks: # å£°æ˜ç½‘ç»œ some-network: other-network:","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» Docker å‘½ä»¤ ä¸­ docker compose çš„ä½¿ç”¨æ–¹æ³• Dockerå®˜æ–¹æ–‡æ¡£ docker compose Compose file reference","date_published":"2025-06-04T13:30:05.000Z","tags":["æŠ€æœ¯","docker","docker"]},{"id":"https://blog.hanqunfeng.com/2025/05/28/docker-command-network/","url":"https://blog.hanqunfeng.com/2025/05/28/docker-command-network/","title":"Docker å‘½ä»¤ ä¹‹ ç½‘ç»œ(Network)","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç» Docker å‘½ä»¤ ä¸­ ç½‘ç»œç®¡ç† ç›¸å…³å‘½ä»¤</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://docs.docker.com\">Dockerå®˜æ–¹æ–‡æ¡£</a></p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"ä»€ä¹ˆæ˜¯Network-ç½‘ç»œ\">ä»€ä¹ˆæ˜¯Network(ç½‘ç»œ)?</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åœ¨ Docker ä¸­ï¼Œ<strong>ç½‘ç»œï¼ˆNetworkï¼‰</strong> æ˜¯å®¹å™¨ä¹‹é—´é€šä¿¡ã€å®¹å™¨ä¸å¤–éƒ¨é€šä¿¡çš„é‡è¦æœºåˆ¶ã€‚Docker æä¾›äº†ä¸€å¥—çµæ´»çš„ç½‘ç»œæ¨¡å‹ï¼Œä½¿å¾—ä½ å¯ä»¥è‡ªç”±é…ç½®å®¹å™¨çš„ç½‘ç»œç¯å¢ƒä»¥é€‚é…ä¸åŒåœºæ™¯ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å®‰è£…dockeræ—¶ï¼Œä¼šè‡ªåŠ¨åœ¨å®¿ä¸»æœºä¸Šå®‰è£…ä¸€ä¸ª <code>docker0</code> ç½‘ç»œè®¾å¤‡ï¼Œå®ƒæ˜¯ä¸€ä¸ªç½‘æ¡¥è®¾å¤‡ï¼Œç”¨äº Docker å„å®¹å™¨åŠå®¿ä¸»æœºçš„ç½‘ç»œé€šä¿¡ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹å®¿ä¸»æœºç½‘å¡ä¿¡æ¯ï¼Œå¯ä»¥æ‰¾åˆ°docker0</span></span><br><span class=\"line\">$ ip addr</span><br><span class=\"line\"><span class=\"comment\"># è¾“å‡º</span></span><br><span class=\"line\">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class=\"line\">    <span class=\"built_in\">link</span>/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class=\"line\">    inet 127.0.0.1/8 scope host lo</span><br><span class=\"line\">       valid_lft forever preferred_lft forever</span><br><span class=\"line\">    inet6 ::1/128 scope host</span><br><span class=\"line\">       valid_lft forever preferred_lft forever</span><br><span class=\"line\">2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 9001 qdisc mq state UP group default qlen 1000</span><br><span class=\"line\">    <span class=\"built_in\">link</span>/ether 0a:6b:88:11:66:39 brd ff:ff:ff:ff:ff:ff</span><br><span class=\"line\">    inet 10.250.0.205/24 brd 10.250.0.255 scope global dynamic noprefixroute eth0</span><br><span class=\"line\">       valid_lft 3076sec preferred_lft 3076sec</span><br><span class=\"line\">    inet6 fe80::86b:88ff:fe11:6639/64 scope <span class=\"built_in\">link</span></span><br><span class=\"line\">       valid_lft forever preferred_lft forever</span><br><span class=\"line\">3: docker0: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc noqueue state DOWN group default</span><br><span class=\"line\">    <span class=\"built_in\">link</span>/ether 02:42:d6:d5:09:b1 brd ff:ff:ff:ff:ff:ff</span><br><span class=\"line\">    inet 172.17.0.1/16 brd 172.17.255.255 scope global docker0</span><br><span class=\"line\">       valid_lft forever preferred_lft forever</span><br><span class=\"line\">    inet6 fe80::42:d6ff:fed5:9b1/64 scope <span class=\"built_in\">link</span></span><br><span class=\"line\">       valid_lft forever preferred_lft forever</span><br><span class=\"line\"><span class=\"comment\">## è¯´æ˜</span></span><br><span class=\"line\">eth0 å®¿ä¸»æœºçš„ipåœ°å€æ˜¯ 10.250.0.205</span><br><span class=\"line\">docker0 æœ¬èº«çš„ipåœ°å€æ˜¯ 172.17.0.1</span><br><span class=\"line\">docker0 çš„å­ç½‘æ©ç æ˜¯ 255.255.0.0</span><br><span class=\"line\">docker0 çš„å¹¿æ’­åœ°å€æ˜¯ 172.17.255.255</span><br><span class=\"line\">docker0 å¯ä»¥ä¸ºå®¹å™¨åˆ†é…çš„ipåœ°å€èŒƒå›´æ˜¯ 172.17.0.2-172.17.255.254ï¼Œæ€»è®¡65534ä¸ªipåœ°å€</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ—¢ç„¶docker0æ˜¯ä¸€ä¸ªç½‘æ¡¥è®¾å¤‡ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤æ¥æŸ¥çœ‹ç½‘æ¡¥çš„è¯¦ç»†ä¿¡æ¯ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ brctl show</span><br><span class=\"line\"><span class=\"comment\">## è¾“å‡ºç»“æœ</span></span><br><span class=\"line\">brctl show</span><br><span class=\"line\">bridge name\t    bridge <span class=\"built_in\">id</span>\t\t      STP enabled\t    interfaces</span><br><span class=\"line\">docker0\t\t    8000.0242d6d509b1\t        no</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¯åŠ¨dockeræœåŠ¡åï¼Œdockerå°±ä¸ºæˆ‘ä»¬è‡ªåŠ¨åˆ›å»ºäº†ä¸‰ä¸ªç½‘ç»œï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ docker network <span class=\"built_in\">ls</span></span><br><span class=\"line\">NETWORK ID     NAME      DRIVER    SCOPE</span><br><span class=\"line\">4182e112bf34   bridge    bridge    <span class=\"built_in\">local</span></span><br><span class=\"line\">958daf8a8a0d   host      host      <span class=\"built_in\">local</span></span><br><span class=\"line\">4674a17c6617   none      null      <span class=\"built_in\">local</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¿™é‡Œ<code>NAME</code>ä¸º<code>bridge</code>çš„ç½‘ç»œå°±æ˜¯ä¸<code>docker0</code>è®¾å¤‡ç›¸å¯¹åº”çš„ç½‘ç»œï¼Œå…¶ä¹Ÿæ˜¯docker<code>é»˜è®¤</code>çš„ç½‘ç»œï¼Œå¦‚æœåˆ›å»ºçš„å®¹å™¨æ²¡æœ‰æŒ‡å®šç½‘ç»œï¼Œé‚£ä¹ˆå®¹å™¨å°±ä¼šåŠ å…¥è¿™ä¸ª <code>bridge</code> ç½‘ç»œã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#  å¯åŠ¨ä¸€ä¸ªå®¹å™¨ï¼Œæ²¡æœ‰æŒ‡å®šç½‘ç»œ</span></span><br><span class=\"line\">docker run -itd --name ap1 alpine</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ­¤æ—¶åœ¨å®¿ä¸»æœºä¸ŠæŸ¥çœ‹ç½‘å¡ä¿¡æ¯ï¼Œä¼šçœ‹åˆ°å¤šå‡ºä¸€ä¸ªè®¾å¤‡</span></span><br><span class=\"line\">ip addr</span><br><span class=\"line\"><span class=\"comment\">## è¾“å‡ºç»“æœ</span></span><br><span class=\"line\">10: vethc0e0cc3@if9: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master docker0 state UP group default</span><br><span class=\"line\">    <span class=\"built_in\">link</span>/ether c6:0d:02:c8:<span class=\"built_in\">df</span>:a4 brd ff:ff:ff:ff:ff:ff link-netnsid 0</span><br><span class=\"line\">    inet6 fe80::c40d:2ff:fec8:dfa4/64 scope <span class=\"built_in\">link</span></span><br><span class=\"line\">       valid_lft forever preferred_lft forever</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹å®¹å™¨çš„ç½‘å¡ä¿¡æ¯</span></span><br><span class=\"line\">docker <span class=\"built_in\">exec</span> -it ap1 ip addr</span><br><span class=\"line\"><span class=\"comment\">## è¾“å‡ºç»“æœ</span></span><br><span class=\"line\">9: eth0@if10: &lt;BROADCAST,MULTICAST,UP,LOWER_UP,M-DOWN&gt; mtu 1500 qdisc noqueue state UP</span><br><span class=\"line\">    <span class=\"built_in\">link</span>/ether 02:42:ac:11:00:02 brd ff:ff:ff:ff:ff:ff</span><br><span class=\"line\">    inet 172.17.0.2/16 brd 172.17.255.255 scope global eth0</span><br><span class=\"line\">       valid_lft forever preferred_lft forever</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">## æ­¤æ—¶èªæ˜çš„ä½ å·²ç»å‘ç°äº†ï¼šå®¿ä¸»æœºçš„ç½‘å¡ä¸å®¹å™¨çš„ç½‘å¡æ˜¯æˆå¯¹å‡ºç°çš„ï¼Œå¹¶ä¸”åŸºäºåºå·è¿›è¡Œå…³è”</span></span><br><span class=\"line\">å®¿ä¸»æœº: 10 : veth c0e0cc3 @ <span class=\"keyword\">if</span> 9  <span class=\"comment\"># åºå· 10 ä¸ å®¹å™¨åç¼€çš„ 10 åŒ¹é…ï¼Œveth æ˜¯è™šæ‹Ÿç½‘å¡ï¼Œc0e0cc3 æ˜¯éšæœºå­—ç¬¦ä¸²ï¼Œif æ˜¯ interface</span></span><br><span class=\"line\">å®¹å™¨:    9 : eth0         @ <span class=\"keyword\">if</span> 10 <span class=\"comment\"># åºå· 9 ä¸å®¿ä¸»æœºçš„åç¼€ 9 åŒ¹é…ï¼Œeth0 æ˜¯å®¹å™¨çš„ç½‘å¡ï¼Œif æ˜¯ interface</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ­¤æ—¶æŸ¥çœ‹å®¿ä¸»æœºçš„ç½‘æ¡¥ä¿¡æ¯</span></span><br><span class=\"line\">brctl show</span><br><span class=\"line\"><span class=\"comment\">## è¾“å‡ºç»“æœï¼Œå¯ä»¥åœ¨ interfaces ä¸­çœ‹åˆ° vethc0e0cc3ï¼Œè¯´æ˜ vethc0e0cc3 å·²ç»åŠ å…¥åˆ°ç½‘æ¡¥ä¸­</span></span><br><span class=\"line\">bridge name\t  bridge <span class=\"built_in\">id</span>\t\t      STP enabled\t  interfaces</span><br><span class=\"line\">docker0\t\t   8000.0242d6d509b1\t      no\t\t  vethc0e0cc3</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹ç½‘ç»œä¸­çš„å®¹å™¨ä¿¡æ¯ï¼Œè¿™é‡Œ jq æ˜¯ json æ ¼å¼åŒ–ï¼Œå¯ä»¥é€šè¿‡ dnf install jq -y å®‰è£…</span></span><br><span class=\"line\">docker network inspect bridge --format <span class=\"string\">&#x27;&#123;&#123;json .Containers&#125;&#125;&#x27;</span> | jq</span><br><span class=\"line\"><span class=\"comment\">## è¾“å‡ºç»“æœ</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">&quot;c2436a1d750cc3de3a6f8ab8a693af25b3371aa8f7f168d5561538dcd4a8ff2d&quot;</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;Name&quot;</span>: <span class=\"string\">&quot;ap1&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;EndpointID&quot;</span>: <span class=\"string\">&quot;75469fddbbdeb8b7a328c1a1c3cc7070bb1a3e102f5fb97cc332dcbc22829af5&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;MacAddress&quot;</span>: <span class=\"string\">&quot;02:42:ac:11:00:02&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;IPv4Address&quot;</span>: <span class=\"string\">&quot;172.17.0.2/16&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;IPv6Address&quot;</span>: <span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># è·å–å®¹å™¨çš„ IP åœ°å€</span></span><br><span class=\"line\">docker <span class=\"built_in\">exec</span> ap1 hostname -i</span><br><span class=\"line\"><span class=\"comment\">## è¾“å‡ºç»“æœ</span></span><br><span class=\"line\">172.17.0.2</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ç›¸åŒç½‘ç»œè®¾å¤‡ä¸‹çš„å®¹å™¨å¯ä»¥é€šè¿‡ IP åœ°å€é€šä¿¡</span></span><br><span class=\"line\"><span class=\"comment\"># æˆ‘ä»¬å†åˆ›å»ºä¸€ä¸ªå®¹å™¨ï¼Œå¹¶æŸ¥çœ‹èƒ½å¦æ­£å¸¸é€šä¿¡</span></span><br><span class=\"line\">docker run -itd --name ap2 alpine</span><br><span class=\"line\">docker <span class=\"built_in\">exec</span> -it ap2 ping 172.17.0.2</span><br><span class=\"line\"><span class=\"comment\">## è¾“å‡ºç»“æœï¼Œè¯´æ˜å¯ä»¥é€šè¿‡IPåœ°å€é€šä¿¡</span></span><br><span class=\"line\">PING 172.17.0.2 (172.17.0.2): 56 data bytes</span><br><span class=\"line\">64 bytes from 172.17.0.2: <span class=\"built_in\">seq</span>=0 ttl=64 time=0.137 ms</span><br><span class=\"line\">64 bytes from 172.17.0.2: <span class=\"built_in\">seq</span>=1 ttl=64 time=0.084 ms</span><br><span class=\"line\">64 bytes from 172.17.0.2: <span class=\"built_in\">seq</span>=2 ttl=64 time=0.081 ms</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹ç½‘ç»œä¸­çš„å®¹å™¨</span></span><br><span class=\"line\">docker network inspect bridge --format <span class=\"string\">&#x27;&#123;&#123;json .Containers&#125;&#125;&#x27;</span> | jq</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">&quot;9d3ed5be1916b14ec9befe3649c08cc9de247c595de248600f8ef8d0fc16c5cb&quot;</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;Name&quot;</span>: <span class=\"string\">&quot;ap2&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;EndpointID&quot;</span>: <span class=\"string\">&quot;35615a7ec10842401ad8c40187c792555b5089551a8eca39ddff6734aeba549e&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;MacAddress&quot;</span>: <span class=\"string\">&quot;02:42:ac:11:00:03&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;IPv4Address&quot;</span>: <span class=\"string\">&quot;172.17.0.3/16&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;IPv6Address&quot;</span>: <span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"string\">&quot;c2436a1d750cc3de3a6f8ab8a693af25b3371aa8f7f168d5561538dcd4a8ff2d&quot;</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;Name&quot;</span>: <span class=\"string\">&quot;ap1&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;EndpointID&quot;</span>: <span class=\"string\">&quot;75469fddbbdeb8b7a328c1a1c3cc7070bb1a3e102f5fb97cc332dcbc22829af5&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;MacAddress&quot;</span>: <span class=\"string\">&quot;02:42:ac:11:00:02&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;IPv4Address&quot;</span>: <span class=\"string\">&quot;172.17.0.2/16&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;IPv6Address&quot;</span>: <span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æµ‹è¯•æ˜¯å¦å¯ä»¥é€šè¿‡å®¹å™¨åç§°è®¿é—®</span></span><br><span class=\"line\">docker <span class=\"built_in\">exec</span> -it ap2 ping ap1</span><br><span class=\"line\"><span class=\"comment\">## è¾“å‡ºï¼Œä¸å¯ä»¥é€šè¿‡å®¹å™¨åç§°è®¿é—®</span></span><br><span class=\"line\">ping: bad address <span class=\"string\">&#x27;ap1&#x27;</span></span><br><span class=\"line\"><span class=\"comment\">## å¦‚æœå¸Œæœ›é€šè¿‡å®¹å™¨åç§°è®¿é—®ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ docker network create åˆ›å»ºä¸€ä¸ªæ–°çš„ç½‘ç»œ</span></span><br></pre></td></tr></table></figure>\n<div class=\"tips\">\n<p><em><strong>å¦‚æœæ²¡æœ‰å®‰è£… brctlï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹å¼å®‰è£…</strong></em></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># centos7:</span></span><br><span class=\"line\">yum install bridge-utils -y</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># centos8: ä¸æ”¯æŒyumæºå®‰è£…ï¼Œéœ€è¦æ‰‹åŠ¨ç¼–è¯‘å®‰è£…</span></span><br><span class=\"line\"><span class=\"comment\"># ä¸‹è½½æºç å®‰è£…ï¼Œç›®å‰æœ€æ–°ç‰ˆæœ¬ä¸º1.7.1</span></span><br><span class=\"line\">wget https://mirrors.edge.kernel.org/pub/linux/utils/net/bridge-utils/bridge-utils-1.7.1.tar.gz</span><br><span class=\"line\">tar -zxvf bridge-utils-1.7.1.tar.gz</span><br><span class=\"line\"><span class=\"built_in\">cd</span> bridge-utils-1.7.1</span><br><span class=\"line\"><span class=\"comment\"># éœ€è¦å…ˆå®‰è£…ç¼–è¯‘æ‰€éœ€çš„å·¥å…·å’Œä¾èµ–</span></span><br><span class=\"line\">dnf install autoconf automake libtool make -y</span><br><span class=\"line\"><span class=\"comment\"># å› ä¸ºæºç ç›®å½•ä¸­æ²¡æœ‰ configure æ–‡ä»¶ï¼ˆä½†æœ‰ configure.acï¼‰ï¼Œæ‰€ä»¥éœ€è¦å…ˆè¿è¡Œå¦‚ä¸‹å‘½ä»¤ç”Ÿæˆ configure æ–‡ä»¶</span></span><br><span class=\"line\">autoreconf -i</span><br><span class=\"line\"><span class=\"comment\"># é…ç½®</span></span><br><span class=\"line\">./configure</span><br><span class=\"line\"><span class=\"comment\"># ç¼–è¯‘ ä¸” å®‰è£…</span></span><br><span class=\"line\">make &amp;&amp; make install</span><br><span class=\"line\"><span class=\"comment\"># æ·»åŠ åˆ°ç¯å¢ƒå˜é‡</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;export PATH=<span class=\"variable\">$PATH</span>:/usr/local/sbin&quot;</span> &gt;&gt; ~/.bashrc</span><br><span class=\"line\"><span class=\"built_in\">source</span> ~/.bashrc</span><br><span class=\"line\">brctl --version</span><br><span class=\"line\"><span class=\"comment\">## è¾“å‡ºç»“æœ</span></span><br><span class=\"line\">bridge-utils, 1.7</span><br></pre></td></tr></table></figure>\n</div>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Docker é»˜è®¤çš„ bridge ç½‘ç»œå’Œ Linux å†…æ ¸ä¸­çš„ docker0 ç½‘æ¡¥æ˜¯ä¸€ä¸€å¯¹åº”çš„å…³ç³»ã€‚bridge æ˜¯ Docker å¯¹ç½‘ç»œçš„å‘½åï¼Œè€Œ docker0 æ˜¯å†…æ ¸ä¸­ç½‘æ¡¥çš„åå­—ã€‚<br>\n<img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/uPic/wjWiNA.png\" alt=\"\"></p>\n</li>\n<li class=\"lvl-2\">\n<p>docker0è´Ÿè´£ç»™è¿æ¥å…¶ä¸Šçš„å®¹å™¨åˆ†é…ipåœ°å€ï¼Œå¹¶ä¸”æ˜¯æ¯ä¸ªå®¹å™¨çš„é»˜è®¤ç½‘å…³ã€‚å½“å®¹å™¨éœ€è¦è®¿é—®å¤–ç½‘æ—¶ï¼Œä¼šé€šè¿‡docker0è½¬åˆ°å®¿ä¸»æœºçš„eth0ä¸Šï¼Œæ‰€ä»¥åªè¦å®¿ä¸»æœºå¯ä»¥è®¿é—®å¤–ç½‘ï¼Œé‚£ä¹ˆå®¹å™¨ä¹Ÿå¯ä»¥è®¿é—®å¤–ç½‘ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹å®¿ä¸»æœºçš„è·¯ç”±è¡¨</span></span><br><span class=\"line\">$ route -n</span><br><span class=\"line\">Kernel IP routing table</span><br><span class=\"line\">Destination     Gateway         Genmask         Flags Metric Ref    Use Iface</span><br><span class=\"line\">0.0.0.0         10.250.0.1      0.0.0.0         UG    100    0        0 eth0</span><br><span class=\"line\">10.250.0.0      0.0.0.0         255.255.255.0   U     100    0        0 eth0</span><br><span class=\"line\">172.17.0.0      0.0.0.0         255.255.0.0     U     0      0        0 docker0</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹ap1å®¹å™¨çš„è·¯ç”±è¡¨</span></span><br><span class=\"line\">$ docker <span class=\"built_in\">exec</span> -it ap1 route -n</span><br><span class=\"line\">Kernel IP routing table</span><br><span class=\"line\">Destination     Gateway         Genmask         Flags Metric Ref    Use Iface</span><br><span class=\"line\">0.0.0.0         172.17.0.1      0.0.0.0         UG    0      0        0 eth0</span><br><span class=\"line\">172.17.0.0      0.0.0.0         255.255.0.0     U     0      0        0 eth0</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Docker Container çš„ bridge æ¡¥æ¥æ¨¡å¼å¯ä»¥å‚è€ƒä¸‹å›¾<br>\n<img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/uPic/32fupw.png\" alt=\"\"></p>\n</li>\n</ul>\n<h2 id=\"docker-network-ç›¸å…³å‘½ä»¤\"><code>docker network</code> ç›¸å…³å‘½ä»¤</h2>\n<table>\n<thead>\n<tr>\n<th>å‘½ä»¤</th>\n<th>åŠŸèƒ½è¯´æ˜</th>\n<th>ç¤ºä¾‹</th>\n<th>ç¤ºä¾‹è¾“å‡ºï¼ˆç®€ç•¥ï¼‰</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>docker network ls</code></td>\n<td>åˆ—å‡ºæ‰€æœ‰ Docker ç½‘ç»œ</td>\n<td><code>docker network ls</code></td>\n<td><code>bridge</code>, <code>host</code>, <code>none</code> ç­‰ç½‘ç»œåç§°</td>\n</tr>\n<tr>\n<td><code>docker network inspect &lt;ç½‘ç»œå&gt;</code></td>\n<td>æŸ¥çœ‹æŒ‡å®šç½‘ç»œçš„è¯¦ç»†ä¿¡æ¯ï¼ˆå¦‚ IP èŒƒå›´ã€è¿æ¥å®¹å™¨ç­‰ï¼‰</td>\n<td><code>docker network inspect bridge</code></td>\n<td>æ˜¾ç¤º JSONï¼Œå«å­ç½‘ã€ç½‘å…³ã€å®¹å™¨ç­‰ä¿¡æ¯</td>\n</tr>\n<tr>\n<td><code>docker network create &lt;ç½‘ç»œå&gt;</code></td>\n<td>åˆ›å»ºè‡ªå®šä¹‰ç½‘ç»œï¼ˆé»˜è®¤æ¡¥æ¥ï¼‰</td>\n<td><code>docker network create my-net</code></td>\n<td><code>my-net</code> ç½‘ç»œ ID</td>\n</tr>\n<tr>\n<td><code>docker network rm &lt;ç½‘ç»œå&gt;</code></td>\n<td>åˆ é™¤ç½‘ç»œï¼ˆä¸èƒ½æœ‰å®¹å™¨è¿æ¥ï¼‰</td>\n<td><code>docker network rm my-net</code></td>\n<td>æˆåŠŸåˆ é™¤æ— æç¤ºï¼Œå¤±è´¥ä¼šæœ‰é”™è¯¯ä¿¡æ¯</td>\n</tr>\n<tr>\n<td><code>docker network connect &lt;ç½‘ç»œå&gt; &lt;å®¹å™¨å&gt;</code></td>\n<td>å°†ä¸€ä¸ªå®¹å™¨è¿æ¥åˆ°æŒ‡å®šç½‘ç»œ</td>\n<td><code>docker network connect my-net my-container</code></td>\n<td>æ— è¾“å‡ºï¼Œå®¹å™¨è¿æ¥æˆåŠŸ</td>\n</tr>\n<tr>\n<td><code>docker network disconnect &lt;ç½‘ç»œå&gt; &lt;å®¹å™¨å&gt;</code></td>\n<td>å°†å®¹å™¨ä»ç½‘ç»œä¸­æ–­å¼€è¿æ¥</td>\n<td><code>docker network disconnect my-net my-container</code></td>\n<td>æ— è¾“å‡ºï¼Œæ–­å¼€æˆåŠŸ</td>\n</tr>\n<tr>\n<td><code>docker network prune</code></td>\n<td>åˆ é™¤æ‰€æœ‰æœªä½¿ç”¨çš„ç½‘ç»œï¼ˆæ…ç”¨ï¼‰</td>\n<td><code>docker network prune</code></td>\n<td>ä¼šæç¤ºæ˜¯å¦ç¡®è®¤ï¼Œæ¸…ç†æœªä½¿ç”¨ç½‘ç»œ</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"docker-network-create-åˆ›å»ºç½‘ç»œ\"><code>docker network create</code> : åˆ›å»ºç½‘ç»œ</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¯­æ³•</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker network create [OPTIONS] NETWORK_NAME</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¸¸ç”¨å‚æ•°è¯´æ˜è¡¨</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>å‚æ•°</th>\n<th>è¯´æ˜</th>\n<th>ç¤ºä¾‹</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>--driver</code> æˆ– <code>-d</code></td>\n<td>æŒ‡å®šç½‘ç»œé©±åŠ¨ç±»å‹ï¼Œå¦‚ <code>bridge</code>, <code>overlay</code>, <code>macvlan</code>, <code>host</code>, <code>none</code></td>\n<td><code>--driver bridge</code></td>\n</tr>\n<tr>\n<td><code>--subnet</code></td>\n<td>æŒ‡å®šå­ç½‘åœ°å€èŒƒå›´ï¼ˆCIDRï¼‰</td>\n<td><code>--subnet 192.168.100.0/24</code></td>\n</tr>\n<tr>\n<td><code>--gateway</code></td>\n<td>æŒ‡å®šç½‘å…³ IP åœ°å€</td>\n<td><code>--gateway 192.168.100.1</code></td>\n</tr>\n<tr>\n<td><code>--ip-range</code></td>\n<td>æŒ‡å®šå¯åˆ†é…çš„ IP èŒƒå›´</td>\n<td><code>--ip-range 192.168.100.0/25</code></td>\n</tr>\n<tr>\n<td><code>--aux-address</code></td>\n<td>ä¿ç•™æŸäº› IP åœ°å€ä¸è¢«åˆ†é…</td>\n<td><code>--aux-address=&quot;reserved=192.168.100.254&quot;</code></td>\n</tr>\n<tr>\n<td><code>--internal</code></td>\n<td>åˆ›å»ºä¸€ä¸ªå†…éƒ¨ç½‘ç»œï¼ˆä¸èƒ½è®¿é—®å¤–éƒ¨ï¼‰</td>\n<td><code>--internal</code></td>\n</tr>\n<tr>\n<td><code>--attachable</code></td>\n<td>åˆ›å»ºå¯ä¾›å•ç‹¬å®¹å™¨è¿æ¥çš„ç½‘ç»œï¼ˆSwarm ä¸­ï¼‰</td>\n<td><code>--attachable</code></td>\n</tr>\n<tr>\n<td><code>--label</code></td>\n<td>æ·»åŠ æ ‡ç­¾</td>\n<td><code>--label env=dev</code></td>\n</tr>\n<tr>\n<td><code>--opt</code></td>\n<td>æä¾›è‡ªå®šä¹‰é©±åŠ¨é€‰é¡¹</td>\n<td><code>--opt encrypted=true</code></td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><code>--driver</code> æˆ– <code>-d</code> : å¸¸è§çš„ Docker ç½‘ç»œé©±åŠ¨ç±»å‹</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>ç±»å‹</th>\n<th>å«ä¹‰</th>\n<th>æ˜¯å¦æ”¯æŒç«¯å£æ˜ å°„</th>\n<th>ç‰¹ç‚¹ä¸åº”ç”¨åœºæ™¯</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>bridge</code>ï¼ˆé»˜è®¤ï¼‰</td>\n<td>é»˜è®¤çš„æ¡¥æ¥ç½‘ç»œï¼Œå®¹å™¨é€šè¿‡è™šæ‹Ÿç½‘æ¡¥è¿æ¥ï¼Œå…±äº«å®¿ä¸»æœºçš„ç½‘ç»œæ¥å£ã€‚</td>\n<td>âœ… æ˜¯</td>\n<td>é»˜è®¤æ¨¡å¼ï¼Œé€‚ç”¨äºå•ä¸»æœºéƒ¨ç½²ã€å¤šä¸ªå®¹å™¨éœ€è¦äº’é€šçš„åœºæ™¯ã€‚å¯æ˜ å°„ç«¯å£å¯¹å¤–è®¿é—®ã€‚</td>\n</tr>\n<tr>\n<td><code>host</code></td>\n<td>å®¹å™¨ä¸å®¿ä¸»æœºå…±ç”¨ç½‘ç»œå‘½åç©ºé—´ï¼Œå®¹å™¨ç›´æ¥ä½¿ç”¨å®¿ä¸»æœºçš„ IP å’Œç«¯å£ã€‚</td>\n<td>âŒ å¦</td>\n<td>æ— ç½‘ç»œéš”ç¦»ï¼Œæ€§èƒ½é«˜ï¼Œé€‚ç”¨äºé«˜æ€§èƒ½ã€ä½å»¶è¿Ÿåœºæ™¯ï¼ˆå¦‚æ¸¸æˆæœåŠ¡å™¨ï¼‰ã€‚</td>\n</tr>\n<tr>\n<td><code>none</code></td>\n<td>å®¹å™¨æ²¡æœ‰ç½‘ç»œæ¥å£ï¼Œå®Œå…¨éš”ç¦»ã€‚</td>\n<td>âŒ å¦</td>\n<td>ç”¨äºå®‰å…¨æ€§æˆ–æµ‹è¯•ç½‘ç»œä¸å¯è¾¾åœºæ™¯ã€‚</td>\n</tr>\n<tr>\n<td><code>macvlan</code></td>\n<td>ä¸ºå®¹å™¨åˆ†é…ç‹¬ç«‹ MAC å’Œ IPï¼Œå®¹å™¨åƒç‰©ç†ä¸»æœºä¸€æ ·å‡ºç°åœ¨å±€åŸŸç½‘ä¸­ã€‚</td>\n<td>âœ… æ˜¯ï¼ˆå°‘è§ï¼‰</td>\n<td>é€‚ç”¨äºå®¹å™¨å¿…é¡»ç›´æ¥æš´éœ²åœ¨ç‰©ç†ç½‘ç»œä¸­çš„åœºæ™¯ï¼ˆå¦‚ DHCP æœåŠ¡ã€ARP å¹¿æ’­ï¼‰ã€‚</td>\n</tr>\n<tr>\n<td><code>ipvlan</code>ï¼ˆé«˜çº§ï¼‰</td>\n<td>ç±»ä¼¼ macvlanï¼Œä½†ä¸ä½¿ç”¨è™šæ‹Ÿ MAC åœ°å€ã€‚</td>\n<td>âœ… æ˜¯ï¼ˆå°‘è§ï¼‰</td>\n<td>é«˜çº§ç½‘ç»œæ–¹æ¡ˆï¼Œé€‚ç”¨äºå¯¹ç½‘ç»œæ‹“æ‰‘ç²¾ç»†æ§åˆ¶çš„åœºæ™¯ã€‚</td>\n</tr>\n<tr>\n<td><code>overlay</code></td>\n<td>ç”¨äºå¤šä¸»æœºä¹‹é—´å®¹å™¨é€šä¿¡ï¼Œéœ€è¦ Docker Swarm æ”¯æŒã€‚</td>\n<td>âœ… æ˜¯ï¼ˆSwarmï¼‰</td>\n<td>è·¨ä¸»æœºéƒ¨ç½²æœåŠ¡çš„å¿…è¦æ‰‹æ®µï¼Œé€‚åˆå®¹å™¨ç¼–æ’å¹³å°ï¼ˆå¦‚ Swarmã€Kubernetesï¼‰ã€‚</td>\n</tr>\n</tbody>\n</table>\n<blockquote>\n<p>å‰é¢æˆ‘ä»¬è¯´è¿‡ï¼ŒDockerä¼šè‡ªåŠ¨åˆ›å»ºä¸‰ä¸ªç½‘ç»œï¼Œå³ï¼šbridgeã€hostã€noneã€‚å¯¹äºå•å°å®¿ä¸»æœºçš„åœºæ™¯ï¼Œç»å¤§å¤šæ•°æƒ…å†µä¸‹æˆ‘ä»¬éƒ½åªä¼šä½¿ç”¨bridgeç½‘ç»œã€‚</p>\n</blockquote>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç¤ºä¾‹</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åˆ›å»ºä¸€ä¸ªåä¸ºmy-networkçš„ç½‘ç»œ</span></span><br><span class=\"line\">$ docker network create my-network</span><br><span class=\"line\"><span class=\"comment\"># ç­‰åŒäºï¼Œå› ä¸ºé»˜è®¤çš„ç½‘ç»œé©±åŠ¨ä¸ºbridge</span></span><br><span class=\"line\">$ docker network create --driver bridge my-network</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹ç½‘ç»œï¼Œå¯ä»¥çœ‹åˆ°æ–°å»ºçš„ç½‘ç»œçš„é©±åŠ¨ä¸ºbridge</span></span><br><span class=\"line\">$ docker network <span class=\"built_in\">ls</span> -f name=my-network</span><br><span class=\"line\">NETWORK ID     NAME         DRIVER    SCOPE</span><br><span class=\"line\">c2dbe1686790   my-network   bridge    <span class=\"built_in\">local</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹å®¿ä¸»æœºçš„ç½‘æ¡¥ä¿¡æ¯</span></span><br><span class=\"line\">$ brctl show</span><br><span class=\"line\"><span class=\"comment\">## è¾“å‡ºï¼Œå¯ä»¥çœ‹åˆ°æ­¤æ—¶æœ‰ä¸€ä¸ªç½‘æ¡¥è®¾å¤‡ br-c2dbe1686790ï¼Œbr: bridgeï¼Œc2dbe1686790ï¼šnetwork id</span></span><br><span class=\"line\">bridge name\t      bridge <span class=\"built_in\">id</span>\t\t          STP enabled\t    interfaces</span><br><span class=\"line\">br-c2dbe1686790\t      8000.02425be81fae\t          no</span><br><span class=\"line\">docker0\t\t      8000.0242d6d509b1\t          no\t\t    vethc0e0cc3</span><br><span class=\"line\">\t\t\t\t\t\t\t            vethf4b7577</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹å®¿ä¸»æœºçš„ç½‘å¡</span></span><br><span class=\"line\">$ ip addr</span><br><span class=\"line\"><span class=\"comment\">## è¾“å‡ºï¼Œbr-c2dbe1686790 ç½‘å¡åç§°ï¼Œå…¶IPç½‘æ®µä¸º 172.18.0.1/16</span></span><br><span class=\"line\">13: br-c2dbe1686790: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc noqueue state DOWN group default</span><br><span class=\"line\">    <span class=\"built_in\">link</span>/ether 02:42:5b:e8:1f:ae brd ff:ff:ff:ff:ff:ff</span><br><span class=\"line\">    inet 172.18.0.1/16 brd 172.18.255.255 scope global br-c2dbe1686790</span><br><span class=\"line\">       valid_lft forever preferred_lft forever</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å¯åŠ¨ä¸¤ä¸ªå®¹å™¨å¹¶æ·»åŠ åˆ°my-networkç½‘ç»œä¸­</span></span><br><span class=\"line\">$ docker run -itd --network my-network --name a1 alpine</span><br><span class=\"line\">$ docker run -itd --network my-network --name a2 alpine</span><br><span class=\"line\"></span><br><span class=\"line\">$ ip addr</span><br><span class=\"line\"><span class=\"comment\">## è¾“å‡º,å¯ä»¥çœ‹åˆ°ä¸¤ä¸ªå®¹å™¨éƒ½æ·»åŠ åˆ°äº†my-networkç½‘ç»œä¸­</span></span><br><span class=\"line\">bridge name\t      bridge <span class=\"built_in\">id</span>\t\t        STP enabled\t    interfaces</span><br><span class=\"line\">br-c2dbe1686790\t\t8000.02425be81fae\t    no\t\t    veth094946c</span><br><span class=\"line\">\t\t\t\t\t\t\t            vetha2ba68a</span><br><span class=\"line\">docker0\t\t        8000.0242d6d509b1\t    no\t\t    vethc0e0cc3</span><br><span class=\"line\">\t\t\t\t\t\t\t            vethf4b7577</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æµ‹è¯•è¿é€šæ€§ï¼Œå¯ä»¥çœ‹åˆ° a1å¯ä»¥pingé€š a2ï¼Œåè¿‡æ¥ a2ä¹Ÿå¯ä»¥pingé€š a1</span></span><br><span class=\"line\">$ docker <span class=\"built_in\">exec</span> -it a1 ping a2</span><br><span class=\"line\">PING a2 (172.18.0.4): 56 data bytes</span><br><span class=\"line\">64 bytes from 172.18.0.4: <span class=\"built_in\">seq</span>=0 ttl=64 time=2.127 ms</span><br><span class=\"line\">64 bytes from 172.18.0.4: <span class=\"built_in\">seq</span>=1 ttl=64 time=0.119 ms</span><br><span class=\"line\"></span><br><span class=\"line\">$ docker ps</span><br><span class=\"line\">CONTAINER ID   IMAGE     COMMAND     CREATED         STATUS         PORTS     NAMES</span><br><span class=\"line\">e0fb0614591e   alpine    <span class=\"string\">&quot;/bin/sh&quot;</span>   4 minutes ago   Up 4 minutes             a2</span><br><span class=\"line\">fc6e9477d2b7   alpine    <span class=\"string\">&quot;/bin/sh&quot;</span>   4 minutes ago   Up 4 minutes             a1</span><br><span class=\"line\">9d3ed5be1916   alpine    <span class=\"string\">&quot;/bin/sh&quot;</span>   4 hours ago     Up 4 hours               ap2</span><br><span class=\"line\">c2436a1d750c   alpine    <span class=\"string\">&quot;/bin/sh&quot;</span>   4 hours ago     Up 4 hours               ap1</span><br><span class=\"line\"><span class=\"comment\"># ä¸åŒç½‘ç»œä¸­çš„å®¹å™¨ä¹‹é—´ä¸èƒ½ç›¸äº’pingé€š</span></span><br><span class=\"line\"><span class=\"comment\">## é€šè¿‡å®¹å™¨åç§°æ— æ³•pingé€š</span></span><br><span class=\"line\">$ docker <span class=\"built_in\">exec</span> -it a1 ping ap1</span><br><span class=\"line\">ping: bad address <span class=\"string\">&#x27;ap1&#x27;</span></span><br><span class=\"line\"><span class=\"comment\">## é€šè¿‡ap1å®¹å™¨IPä¹Ÿæ— æ³•pingé€šï¼Œè¿™å°±å®ç°äº†ä¸åŒç½‘ç»œä¸­çš„ç½‘ç»œéš”ç¦»</span></span><br><span class=\"line\">$ docker <span class=\"built_in\">exec</span> -it a1 ping 172.17.0.2</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¦‚æœåˆ›å»ºç½‘ç»œæ—¶æ²¡æœ‰æŒ‡å®šå­ç½‘ï¼Œåˆ™ä»<code>docker0</code>çš„<code>172.17.0.0/16</code>å¾€åæ’ï¼Œæ¯”å¦‚æˆ‘ä»¬ä¸Šé¢åˆ›å»ºçš„<code>my-network</code>ï¼Œå…¶å­ç½‘å°±æ˜¯<code>172.18.0.0/16</code>ï¼Œå¦‚ä¸‹å‘½ä»¤åˆ›å»ºä¸€ä¸ªbridgeç½‘ç»œï¼Œå¹¶æŒ‡å®šå­ç½‘ã€ç½‘å…³ç­‰ä¿¡æ¯</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ docker network create \\</span><br><span class=\"line\">  --driver bridge \\</span><br><span class=\"line\">  --subnet 192.168.50.0/24 \\</span><br><span class=\"line\">  --gateway 192.168.50.1 \\</span><br><span class=\"line\">  my-custom-net</span><br></pre></td></tr></table></figure>\n<h4 id=\"bridge-æ€»ç»“\"><code>bridge</code> æ€»ç»“</h4>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>é»˜è®¤åˆ›å»ºçš„ <code>docker0</code> ç½‘ç»œï¼Œæ˜¯ä¸€ä¸ªæ¡¥æ¥ç½‘ç»œï¼Œåœ¨ docker network ä¸­çš„åç§°ä¸º <code>bridge</code>ï¼Œè¯¥ç½‘ç»œä¸‹çš„å®¹å™¨å¯ä»¥é€šè¿‡IPåœ°å€ç›¸äº’è®¿é—®ï¼Œä½†ä¸èƒ½é€šè¿‡å®¹å™¨åç§°è®¿é—®</p>\n</li>\n<li class=\"lvl-2\">\n<p>é€šè¿‡<code>docker network create &lt;ç½‘ç»œåç§°&gt;</code>åˆ›å»ºçš„ç½‘ç»œä¹Ÿæ˜¯ä¸€ä¸ªæ¡¥æ¥ç½‘ç»œï¼Œåœ¨è¿™ä¸ªç½‘ç»œä¸‹ï¼Œå®¹å™¨å¯ä»¥é€šè¿‡IPåœ°å€ç›¸äº’è®¿é—®ï¼Œä¹Ÿèƒ½é€šè¿‡å®¹å™¨åç§°è®¿é—®ã€‚</p>\n</li>\n</ul>\n<h3 id=\"docker-network-ls-åˆ—å‡ºæ‰€æœ‰ç½‘ç»œ\"><code>docker network ls</code> : åˆ—å‡ºæ‰€æœ‰ç½‘ç»œ</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åˆ—å‡ºæ‰€æœ‰ç½‘ç»œ</span></span><br><span class=\"line\">$ docker network <span class=\"built_in\">ls</span></span><br><span class=\"line\"><span class=\"comment\"># è¾“å‡ºæŒ‡å®šçš„ä¿¡æ¯</span></span><br><span class=\"line\">$ docker network <span class=\"built_in\">ls</span> --format <span class=\"string\">&quot;table &#123;&#123;.ID&#125;&#125;\\t&#123;&#123;.Name&#125;&#125;\\t&#123;&#123;.Scope&#125;&#125;&quot;</span></span><br><span class=\"line\"><span class=\"comment\"># è¾“å‡ºjsonæ ¼å¼</span></span><br><span class=\"line\">$ docker network <span class=\"built_in\">ls</span> --format <span class=\"string\">&quot;json&quot;</span></span><br><span class=\"line\"><span class=\"comment\"># è¿‡æ»¤</span></span><br><span class=\"line\">$ docker network <span class=\"built_in\">ls</span> -f <span class=\"string\">&quot;driver=bridge&quot;</span></span><br><span class=\"line\"><span class=\"comment\"># ä¸æˆªæ–­è¾“å‡º</span></span><br><span class=\"line\">$ docker network <span class=\"built_in\">ls</span> --no-trunc</span><br><span class=\"line\"><span class=\"comment\"># åªæ˜¾ç¤ºnetwork id</span></span><br><span class=\"line\">$ docker network <span class=\"built_in\">ls</span> -q</span><br></pre></td></tr></table></figure>\n<h3 id=\"docker-network-inspect-æŸ¥çœ‹ç½‘ç»œè¯¦æƒ…\"><code>docker network inspect</code> : æŸ¥çœ‹ç½‘ç»œè¯¦æƒ…</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹åç§°ä¸ºbridgeç½‘ç»œè¯¦æƒ…</span></span><br><span class=\"line\">$ docker network inspect bridge</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹å½“å‰ç½‘ç»œä¸‹æœ‰å“ªäº›å®¹å™¨</span></span><br><span class=\"line\">$ docker network inspect bridge --format <span class=\"string\">&quot;&#123;&#123;.Containers&#125;&#125;&quot;</span></span><br><span class=\"line\"><span class=\"comment\"># è¾“å‡ºjsonæ ¼å¼</span></span><br><span class=\"line\">$ docker network inspect bridge --format <span class=\"string\">&quot;json&quot;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"docker-network-prune-æ¸…ç†æ²¡ç”¨çš„ç½‘ç»œ\"><code>docker network prune</code> : æ¸…ç†æ²¡ç”¨çš„ç½‘ç»œ</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åˆ é™¤æ‰€æœ‰æœªä½¿ç”¨çš„ç½‘ç»œ</span></span><br><span class=\"line\">$ docker network prune</span><br><span class=\"line\"><span class=\"comment\"># åˆ é™¤æ‰€æœ‰æœªä½¿ç”¨çš„ç½‘ç»œï¼Œæ— éœ€ç¡®è®¤</span></span><br><span class=\"line\">$ docker network prune -f</span><br><span class=\"line\"><span class=\"comment\"># æ¸…ç†24å°æ—¶å†…æœªä½¿ç”¨çš„ç½‘ç»œ</span></span><br><span class=\"line\">$ docker network prune --filter <span class=\"string\">&quot;until=24h&quot;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"docker-network-rm-åˆ é™¤ç½‘ç»œ\"><code>docker network rm</code> : åˆ é™¤ç½‘ç»œ</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åˆ é™¤æŒ‡å®šçš„ç½‘ç»œ</span></span><br><span class=\"line\">$ docker network <span class=\"built_in\">rm</span> &lt;network-name&gt;</span><br><span class=\"line\"><span class=\"comment\"># åˆ é™¤æ‰€æœ‰ç½‘ç»œ</span></span><br><span class=\"line\">$ docker network <span class=\"built_in\">rm</span> $(docker network <span class=\"built_in\">ls</span> -q)</span><br><span class=\"line\"><span class=\"comment\"># åˆ é™¤æ‰€æœ‰bridgeç½‘ç»œï¼Œè¿™é‡Œè¦æ³¨æ„ï¼Œdockeré»˜è®¤åˆ›å»ºçš„3ä¸ªç½‘ç»œæ˜¯åˆ é™¤ä¸æ‰çš„</span></span><br><span class=\"line\">$ docker network <span class=\"built_in\">rm</span> $(docker network <span class=\"built_in\">ls</span> -q -f driver=bridge)</span><br></pre></td></tr></table></figure>\n<h3 id=\"docker-network-connect-å°†å®¹å™¨è¿æ¥åˆ°ç½‘ç»œ\"><code>docker network connect</code> : å°†å®¹å™¨è¿æ¥åˆ°ç½‘ç»œ</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å°†å®¹å™¨è¿æ¥åˆ°ç½‘ç»œï¼Œå¦‚æœå®¹å™¨å¯åŠ¨æ—¶å¿˜è®°è¿æ¥ç½‘ç»œï¼Œè¿™é‡Œå¯ä»¥æ‰‹åŠ¨æ·»åŠ </span></span><br><span class=\"line\">$ docker network connect &lt;network-name&gt; &lt;container-name&gt;</span><br></pre></td></tr></table></figure>\n<h3 id=\"docker-network-disconnect-å°†å®¹å™¨ä»ç½‘ç»œæ–­å¼€\"><code>docker network disconnect</code> : å°†å®¹å™¨ä»ç½‘ç»œæ–­å¼€</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ docker network disconnect &lt;network-name&gt; &lt;container-name&gt;</span><br></pre></td></tr></table></figure>\n<h2 id=\"æœ¬æ–‡æ€»ç»“\">æœ¬æ–‡æ€»ç»“</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å®¹å™¨ä¸ç½‘ç»œæ˜¯å¤šå¯¹å¤šçš„å…³ç³»ï¼Œå³ä¸€ä¸ªç½‘ç»œå¯ä»¥æœ‰å¤šä¸ªå®¹å™¨ï¼Œä¸€ä¸ªå®¹å™¨ä¹Ÿå¯ä»¥è¿æ¥åˆ°å¤šä¸ªç½‘ç»œã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>docker0 æ˜¯ docker é»˜è®¤åˆ›å»ºçš„ç½‘ç»œï¼Œä¸æŒ‡å®šç½‘ç»œçš„æƒ…å†µä¸‹æ‰€æœ‰å®¹å™¨éƒ½è¿æ¥åˆ° docker0 ç½‘ç»œã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>docker0 æ˜¯ bridge ç½‘ç»œï¼Œè¯¥ç½‘ç»œä¸­çš„å®¹å™¨ä¹‹é—´å¯ä»¥é€šè¿‡ IP äº’ç›¸è®¿é—®ï¼Œä½†ä¸èƒ½é€šè¿‡å®¹å™¨åç§°è®¿é—®ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>è‡ªå»ºçš„ bridge ç½‘ç»œä¸­çš„å®¹å™¨å¯ä»¥é€šè¿‡å®¹å™¨åç§°ï¼ˆæˆ–å®¹å™¨IDï¼Œä½†ä¸å¸¸ç”¨ï¼‰è®¿é—®ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä¸åŒçš„ bridge ç½‘ç»œä¸­çš„å®¹å™¨ä¸èƒ½äº’ç›¸è®¿é—®ã€‚</p>\n</li>\n</ul>\n<h2 id=\"link-vs-network\"><code>--link</code> vs <code>--network</code></h2>\n<table>\n<thead>\n<tr>\n<th>é¡¹ç›®</th>\n<th><code>--link</code></th>\n<th><code>--network</code></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>åŠŸèƒ½</td>\n<td>å°†ä¸€ä¸ªå®¹å™¨é“¾æ¥åˆ°å¦ä¸€ä¸ªå®¹å™¨ï¼Œå¹¶è®¾ç½®ç¯å¢ƒå˜é‡å’Œä¸»æœºåæ˜ å°„</td>\n<td>å°†å®¹å™¨åŠ å…¥åˆ°ä¸€ä¸ªè‡ªå®šä¹‰ç½‘ç»œä¸­ï¼Œå®ç°çµæ´»ã€éš”ç¦»çš„ç½‘ç»œé€šä¿¡</td>\n</tr>\n<tr>\n<td>æ˜¯å¦æ¨è</td>\n<td>âŒ ä¸æ¨èï¼ˆå·²åºŸå¼ƒï¼‰</td>\n<td>âœ… æ¨èä½¿ç”¨</td>\n</tr>\n<tr>\n<td>ç½‘ç»œéš”ç¦»</td>\n<td>åŸºäºé»˜è®¤ <code>bridge</code> ç½‘ç»œï¼Œéš”ç¦»æ€§å·®</td>\n<td>å¯ä»¥åˆ›å»ºè‡ªå®šä¹‰ç½‘ç»œï¼ˆbridgeã€overlay ç­‰ï¼‰ï¼Œéš”ç¦»æ€§å¼º</td>\n</tr>\n<tr>\n<td>å¯æ‰©å±•æ€§</td>\n<td>åªé€‚ç”¨äºå·²è¿è¡Œçš„å®¹å™¨ï¼Œè¿æ¥å›ºå®š</td>\n<td>æ”¯æŒå¤šä¸ªå®¹å™¨ï¼Œçµæ´»ç»„åˆå’ŒåŠ¨æ€æ‰©å±•</td>\n</tr>\n<tr>\n<td>DNS æ”¯æŒ</td>\n<td>ä»…è®¾ç½®ç¯å¢ƒå˜é‡ï¼Œä¸æ”¯æŒè‡ªåŠ¨ DNS</td>\n<td>è‡ªå®šä¹‰ç½‘ç»œä¸­æ”¯æŒå®¹å™¨åç§°ä½œä¸º DNS åç§°</td>\n</tr>\n<tr>\n<td>ç”Ÿå‘½å‘¨æœŸ</td>\n<td>ä¸€æ–¹å®¹å™¨å…³é—­ï¼Œå¦ä¸€æ–¹ä»ä¿å­˜è¿‡æ—¶é“¾æ¥</td>\n<td>ç½‘ç»œå­˜åœ¨å³å¯ï¼Œå®¹å™¨ç”Ÿå‘½å‘¨æœŸä¸äº’ç›¸å½±å“</td>\n</tr>\n<tr>\n<td>å®‰å…¨æ€§</td>\n<td>æ‰€æœ‰å®¹å™¨å…±äº« bridgeï¼Œå®¹æ˜“ç›¸äº’è®¿é—®</td>\n<td>è‡ªå®šä¹‰ç½‘ç»œé—´é»˜è®¤éš”ç¦»ï¼Œå®‰å…¨æ€§æ›´å¥½</td>\n</tr>\n</tbody>\n</table>\n","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» Docker å‘½ä»¤ ä¸­ ç½‘ç»œç®¡ç† ç›¸å…³å‘½ä»¤ Dockerå®˜æ–¹æ–‡æ¡£ ä»€ä¹ˆæ˜¯Network(ç½‘ç»œ)? åœ¨ Docker ä¸­ï¼Œç½‘ç»œï¼ˆNetworkï¼‰ æ˜¯å®¹å™¨ä¹‹é—´é€šä¿¡ã€å®¹å™¨ä¸å¤–éƒ¨é€šä¿¡çš„é‡è¦æœºåˆ¶ã€‚Docker æä¾›äº†ä¸€å¥—çµæ´»çš„ç½‘ç»œæ¨¡å‹ï¼Œä½¿å¾—ä½ å¯ä»¥è‡ªç”±é…ç½®å®¹å™¨çš„ç½‘ç»œç¯å¢ƒä»¥é€‚é…ä¸åŒåœºæ™¯ã€‚ å®‰è£…dockeræ—¶ï¼Œä¼šè‡ªåŠ¨åœ¨å®¿ä¸»æœºä¸Šå®‰è£…ä¸€ä¸ª docker0 ç½‘ç»œè®¾å¤‡ï¼Œå®ƒæ˜¯ä¸€ä¸ªç½‘æ¡¥è®¾å¤‡ï¼Œç”¨äº Docker å„å®¹å™¨åŠå®¿ä¸»æœºçš„ç½‘ç»œé€šä¿¡ã€‚ 123456789101112131415161718192021222324252627# æŸ¥çœ‹å®¿ä¸»æœºç½‘å¡ä¿¡æ¯ï¼Œå¯ä»¥æ‰¾åˆ°docker0$ ip addr# è¾“å‡º1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000 link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 inet 127.0.0.1/8 scope host lo valid_lft forever preferred_lft forever inet6 ::1/128 scope host valid_lft forever preferred_lft forever2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 9001 qdisc mq state UP group default qlen 1000 link/ether 0a:6b:88:11:66:39 brd ff:ff:ff:ff:ff:ff inet 10.250.0.205/24 brd 10.250.0.255 scope global dynamic noprefixroute eth0 valid_lft 3076sec preferred_lft 3076sec inet6 fe80::86b:88ff:fe11:6639/64 scope link valid_lft forever preferred_lft forever3: docker0: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc noqueue state DOWN group default link/ether 02:42:d6:d5:09:b1 brd ff:ff:ff:ff:ff:ff inet 172.17.0.1/16 brd 172.17.255.255 scope global docker0 valid_lft forever preferred_lft forever inet6 fe80::42:d6ff:fed5:9b1/64 scope link valid_lft forever preferred_lft forever## è¯´æ˜eth0 å®¿ä¸»æœºçš„ipåœ°å€æ˜¯ 10.250.0.205docker0 æœ¬èº«çš„ipåœ°å€æ˜¯ 172.17.0.1docker0 çš„å­ç½‘æ©ç æ˜¯ 255.255.0.0docker0 çš„å¹¿æ’­åœ°å€æ˜¯ 172.17.255.255docker0 å¯ä»¥ä¸ºå®¹å™¨åˆ†é…çš„ipåœ°å€èŒƒå›´æ˜¯ 172.17.0.2-172.17.255.254ï¼Œæ€»è®¡65534ä¸ªipåœ°å€ æ—¢ç„¶docker0æ˜¯ä¸€ä¸ªç½‘æ¡¥è®¾å¤‡ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤æ¥æŸ¥çœ‹ç½‘æ¡¥çš„è¯¦ç»†ä¿¡æ¯ï¼š 12345$ brctl show## è¾“å‡ºç»“æœbrctl showbridge name bridge id STP enabled interfacesdocker0 8000.0242d6d509b1 no å¯åŠ¨dockeræœåŠ¡åï¼Œdockerå°±ä¸ºæˆ‘ä»¬è‡ªåŠ¨åˆ›å»ºäº†ä¸‰ä¸ªç½‘ç»œï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹ 12345$ docker network lsNETWORK ID NAME DRIVER SCOPE4182e112bf34 bridge bridge local958daf8a8a0d host host local4674a17c6617 none null local è¿™é‡ŒNAMEä¸ºbridgeçš„ç½‘ç»œå°±æ˜¯ä¸docker0è®¾å¤‡ç›¸å¯¹åº”çš„ç½‘ç»œï¼Œå…¶ä¹Ÿæ˜¯dockeré»˜è®¤çš„ç½‘ç»œï¼Œå¦‚æœåˆ›å»ºçš„å®¹å™¨æ²¡æœ‰æŒ‡å®šç½‘ç»œï¼Œé‚£ä¹ˆå®¹å™¨å°±ä¼šåŠ å…¥è¿™ä¸ª bridge ç½‘ç»œã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081# å¯åŠ¨ä¸€ä¸ªå®¹å™¨ï¼Œæ²¡æœ‰æŒ‡å®šç½‘ç»œdocker run -itd --name ap1 alpine# æ­¤æ—¶åœ¨å®¿ä¸»æœºä¸ŠæŸ¥çœ‹ç½‘å¡ä¿¡æ¯ï¼Œä¼šçœ‹åˆ°å¤šå‡ºä¸€ä¸ªè®¾å¤‡ip addr## è¾“å‡ºç»“æœ10: vethc0e0cc3@if9: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master docker0 state UP group default link/ether c6:0d:02:c8:df:a4 brd ff:ff:ff:ff:ff:ff link-netnsid 0 inet6 fe80::c40d:2ff:fec8:dfa4/64 scope link valid_lft forever preferred_lft forever# æŸ¥çœ‹å®¹å™¨çš„ç½‘å¡ä¿¡æ¯docker exec -it ap1 ip addr## è¾“å‡ºç»“æœ9: eth0@if10: &lt;BROADCAST,MULTICAST,UP,LOWER_UP,M-DOWN&gt; mtu 1500 qdisc noqueue state UP link/ether 02:42:ac:11:00:02 brd ff:ff:ff:ff:ff:ff inet 172.17.0.2/16 brd 172.17.255.255 scope global eth0 valid_lft forever preferred_lft forever## æ­¤æ—¶èªæ˜çš„ä½ å·²ç»å‘ç°äº†ï¼šå®¿ä¸»æœºçš„ç½‘å¡ä¸å®¹å™¨çš„ç½‘å¡æ˜¯æˆå¯¹å‡ºç°çš„ï¼Œå¹¶ä¸”åŸºäºåºå·è¿›è¡Œå…³è”å®¿ä¸»æœº: 10 : veth c0e0cc3 @ if 9 # åºå· 10 ä¸ å®¹å™¨åç¼€çš„ 10 åŒ¹é…ï¼Œveth æ˜¯è™šæ‹Ÿç½‘å¡ï¼Œc0e0cc3 æ˜¯éšæœºå­—ç¬¦ä¸²ï¼Œif æ˜¯ interfaceå®¹å™¨: 9 : eth0 @ if 10 # åºå· 9 ä¸å®¿ä¸»æœºçš„åç¼€ 9 åŒ¹é…ï¼Œeth0 æ˜¯å®¹å™¨çš„ç½‘å¡ï¼Œif æ˜¯ interface# æ­¤æ—¶æŸ¥çœ‹å®¿ä¸»æœºçš„ç½‘æ¡¥ä¿¡æ¯brctl show## è¾“å‡ºç»“æœï¼Œå¯ä»¥åœ¨ interfaces ä¸­çœ‹åˆ° vethc0e0cc3ï¼Œè¯´æ˜ vethc0e0cc3 å·²ç»åŠ å…¥åˆ°ç½‘æ¡¥ä¸­bridge name bridge id STP enabled interfacesdocker0 8000.0242d6d509b1 no vethc0e0cc3# æŸ¥çœ‹ç½‘ç»œä¸­çš„å®¹å™¨ä¿¡æ¯ï¼Œè¿™é‡Œ jq æ˜¯ json æ ¼å¼åŒ–ï¼Œå¯ä»¥é€šè¿‡ dnf install jq -y å®‰è£…docker network inspect bridge --format &#x27;&#123;&#123;json .Containers&#125;&#125;&#x27; | jq## è¾“å‡ºç»“æœ&#123; &quot;c2436a1d750cc3de3a6f8ab8a693af25b3371aa8f7f168d5561538dcd4a8ff2d&quot;: &#123; &quot;Name&quot;: &quot;ap1&quot;, &quot;EndpointID&quot;: &quot;75469fddbbdeb8b7a328c1a1c3cc7070bb1a3e102f5fb97cc332dcbc22829af5&quot;, &quot;MacAddress&quot;: &quot;02:42:ac:11:00:02&quot;, &quot;IPv4Address&quot;: &quot;172.17.0.2/16&quot;, &quot;IPv6Address&quot;: &quot;&quot; &#125;&#125;# è·å–å®¹å™¨çš„ IP åœ°å€docker exec ap1 hostname -i## è¾“å‡ºç»“æœ172.17.0.2# ç›¸åŒç½‘ç»œè®¾å¤‡ä¸‹çš„å®¹å™¨å¯ä»¥é€šè¿‡ IP åœ°å€é€šä¿¡# æˆ‘ä»¬å†åˆ›å»ºä¸€ä¸ªå®¹å™¨ï¼Œå¹¶æŸ¥çœ‹èƒ½å¦æ­£å¸¸é€šä¿¡docker run -itd --name ap2 alpinedocker exec -it ap2 ping 172.17.0.2## è¾“å‡ºç»“æœï¼Œè¯´æ˜å¯ä»¥é€šè¿‡IPåœ°å€é€šä¿¡PING 172.17.0.2 (172.17.0.2): 56 data bytes64 bytes from 172.17.0.2: seq=0 ttl=64 time=0.137 ms64 bytes from 172.17.0.2: seq=1 ttl=64 time=0.084 ms64 bytes from 172.17.0.2: seq=2 ttl=64 time=0.081 ms# æŸ¥çœ‹ç½‘ç»œä¸­çš„å®¹å™¨docker network inspect bridge --format &#x27;&#123;&#123;json .Containers&#125;&#125;&#x27; | jq&#123; &quot;9d3ed5be1916b14ec9befe3649c08cc9de247c595de248600f8ef8d0fc16c5cb&quot;: &#123; &quot;Name&quot;: &quot;ap2&quot;, &quot;EndpointID&quot;: &quot;35615a7ec10842401ad8c40187c792555b5089551a8eca39ddff6734aeba549e&quot;, &quot;MacAddress&quot;: &quot;02:42:ac:11:00:03&quot;, &quot;IPv4Address&quot;: &quot;172.17.0.3/16&quot;, &quot;IPv6Address&quot;: &quot;&quot; &#125;, &quot;c2436a1d750cc3de3a6f8ab8a693af25b3371aa8f7f168d5561538dcd4a8ff2d&quot;: &#123; &quot;Name&quot;: &quot;ap1&quot;, &quot;EndpointID&quot;: &quot;75469fddbbdeb8b7a328c1a1c3cc7070bb1a3e102f5fb97cc332dcbc22829af5&quot;, &quot;MacAddress&quot;: &quot;02:42:ac:11:00:02&quot;, &quot;IPv4Address&quot;: &quot;172.17.0.2/16&quot;, &quot;IPv6Address&quot;: &quot;&quot; &#125;&#125;# æµ‹è¯•æ˜¯å¦å¯ä»¥é€šè¿‡å®¹å™¨åç§°è®¿é—®docker exec -it ap2 ping ap1## è¾“å‡ºï¼Œä¸å¯ä»¥é€šè¿‡å®¹å™¨åç§°è®¿é—®ping: bad address &#x27;ap1&#x27;## å¦‚æœå¸Œæœ›é€šè¿‡å®¹å™¨åç§°è®¿é—®ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ docker network create åˆ›å»ºä¸€ä¸ªæ–°çš„ç½‘ç»œ å¦‚æœæ²¡æœ‰å®‰è£… brctlï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹å¼å®‰è£… 12345678910111213141516171819202122# centos7:yum install bridge-utils -y# centos8: ä¸æ”¯æŒyumæºå®‰è£…ï¼Œéœ€è¦æ‰‹åŠ¨ç¼–è¯‘å®‰è£…# ä¸‹è½½æºç å®‰è£…ï¼Œç›®å‰æœ€æ–°ç‰ˆæœ¬ä¸º1.7.1wget https://mirrors.edge.kernel.org/pub/linux/utils/net/bridge-utils/bridge-utils-1.7.1.tar.gztar -zxvf bridge-utils-1.7.1.tar.gzcd bridge-utils-1.7.1# éœ€è¦å…ˆå®‰è£…ç¼–è¯‘æ‰€éœ€çš„å·¥å…·å’Œä¾èµ–dnf install autoconf automake libtool make -y# å› ä¸ºæºç ç›®å½•ä¸­æ²¡æœ‰ configure æ–‡ä»¶ï¼ˆä½†æœ‰ configure.acï¼‰ï¼Œæ‰€ä»¥éœ€è¦å…ˆè¿è¡Œå¦‚ä¸‹å‘½ä»¤ç”Ÿæˆ configure æ–‡ä»¶autoreconf -i# é…ç½®./configure# ç¼–è¯‘ ä¸” å®‰è£…make &amp;&amp; make install# æ·»åŠ åˆ°ç¯å¢ƒå˜é‡echo &quot;export PATH=$PATH:/usr/local/sbin&quot; &gt;&gt; ~/.bashrcsource ~/.bashrcbrctl --version## è¾“å‡ºç»“æœbridge-utils, 1.7 Docker é»˜è®¤çš„ bridge ç½‘ç»œå’Œ Linux å†…æ ¸ä¸­çš„ docker0 ç½‘æ¡¥æ˜¯ä¸€ä¸€å¯¹åº”çš„å…³ç³»ã€‚bridge æ˜¯ Docker å¯¹ç½‘ç»œçš„å‘½åï¼Œè€Œ docker0 æ˜¯å†…æ ¸ä¸­ç½‘æ¡¥çš„åå­—ã€‚ docker0è´Ÿè´£ç»™è¿æ¥å…¶ä¸Šçš„å®¹å™¨åˆ†é…ipåœ°å€ï¼Œå¹¶ä¸”æ˜¯æ¯ä¸ªå®¹å™¨çš„é»˜è®¤ç½‘å…³ã€‚å½“å®¹å™¨éœ€è¦è®¿é—®å¤–ç½‘æ—¶ï¼Œä¼šé€šè¿‡docker0è½¬åˆ°å®¿ä¸»æœºçš„eth0ä¸Šï¼Œæ‰€ä»¥åªè¦å®¿ä¸»æœºå¯ä»¥è®¿é—®å¤–ç½‘ï¼Œé‚£ä¹ˆå®¹å™¨ä¹Ÿå¯ä»¥è®¿é—®å¤–ç½‘ã€‚ 1234567891011121314# æŸ¥çœ‹å®¿ä¸»æœºçš„è·¯ç”±è¡¨$ route -nKernel IP routing tableDestination Gateway Genmask Flags Metric Ref Use Iface0.0.0.0 10.250.0.1 0.0.0.0 UG 100 0 0 eth010.250.0.0 0.0.0.0 255.255.255.0 U 100 0 0 eth0172.17.0.0 0.0.0.0 255.255.0.0 U 0 0 0 docker0# æŸ¥çœ‹ap1å®¹å™¨çš„è·¯ç”±è¡¨$ docker exec -it ap1 route -nKernel IP routing tableDestination Gateway Genmask Flags Metric Ref Use Iface0.0.0.0 172.17.0.1 0.0.0.0 UG 0 0 0 eth0172.17.0.0 0.0.0.0 255.255.0.0 U 0 0 0 eth0 Docker Container çš„ bridge æ¡¥æ¥æ¨¡å¼å¯ä»¥å‚è€ƒä¸‹å›¾ docker network ç›¸å…³å‘½ä»¤ å‘½ä»¤ åŠŸèƒ½è¯´æ˜ ç¤ºä¾‹ ç¤ºä¾‹è¾“å‡ºï¼ˆç®€ç•¥ï¼‰ docker network ls åˆ—å‡ºæ‰€æœ‰ Docker ç½‘ç»œ docker network ls bridge, host, none ç­‰ç½‘ç»œåç§° docker network inspect &lt;ç½‘ç»œå&gt; æŸ¥çœ‹æŒ‡å®šç½‘ç»œçš„è¯¦ç»†ä¿¡æ¯ï¼ˆå¦‚ IP èŒƒå›´ã€è¿æ¥å®¹å™¨ç­‰ï¼‰ docker network inspect bridge æ˜¾ç¤º JSONï¼Œå«å­ç½‘ã€ç½‘å…³ã€å®¹å™¨ç­‰ä¿¡æ¯ docker network create &lt;ç½‘ç»œå&gt; åˆ›å»ºè‡ªå®šä¹‰ç½‘ç»œï¼ˆé»˜è®¤æ¡¥æ¥ï¼‰ docker network create my-net my-net ç½‘ç»œ ID docker network rm &lt;ç½‘ç»œå&gt; åˆ é™¤ç½‘ç»œï¼ˆä¸èƒ½æœ‰å®¹å™¨è¿æ¥ï¼‰ docker network rm my-net æˆåŠŸåˆ é™¤æ— æç¤ºï¼Œå¤±è´¥ä¼šæœ‰é”™è¯¯ä¿¡æ¯ docker network connect &lt;ç½‘ç»œå&gt; &lt;å®¹å™¨å&gt; å°†ä¸€ä¸ªå®¹å™¨è¿æ¥åˆ°æŒ‡å®šç½‘ç»œ docker network connect my-net my-container æ— è¾“å‡ºï¼Œå®¹å™¨è¿æ¥æˆåŠŸ docker network disconnect &lt;ç½‘ç»œå&gt; &lt;å®¹å™¨å&gt; å°†å®¹å™¨ä»ç½‘ç»œä¸­æ–­å¼€è¿æ¥ docker network disconnect my-net my-container æ— è¾“å‡ºï¼Œæ–­å¼€æˆåŠŸ docker network prune åˆ é™¤æ‰€æœ‰æœªä½¿ç”¨çš„ç½‘ç»œï¼ˆæ…ç”¨ï¼‰ docker network prune ä¼šæç¤ºæ˜¯å¦ç¡®è®¤ï¼Œæ¸…ç†æœªä½¿ç”¨ç½‘ç»œ docker network create : åˆ›å»ºç½‘ç»œ è¯­æ³• 1docker network create [OPTIONS] NETWORK_NAME å¸¸ç”¨å‚æ•°è¯´æ˜è¡¨ å‚æ•° è¯´æ˜ ç¤ºä¾‹ --driver æˆ– -d æŒ‡å®šç½‘ç»œé©±åŠ¨ç±»å‹ï¼Œå¦‚ bridge, overlay, macvlan, host, none --driver bridge --subnet æŒ‡å®šå­ç½‘åœ°å€èŒƒå›´ï¼ˆCIDRï¼‰ --subnet 192.168.100.0/24 --gateway æŒ‡å®šç½‘å…³ IP åœ°å€ --gateway 192.168.100.1 --ip-range æŒ‡å®šå¯åˆ†é…çš„ IP èŒƒå›´ --ip-range 192.168.100.0/25 --aux-address ä¿ç•™æŸäº› IP åœ°å€ä¸è¢«åˆ†é… --aux-address=&quot;reserved=192.168.100.254&quot; --internal åˆ›å»ºä¸€ä¸ªå†…éƒ¨ç½‘ç»œï¼ˆä¸èƒ½è®¿é—®å¤–éƒ¨ï¼‰ --internal --attachable åˆ›å»ºå¯ä¾›å•ç‹¬å®¹å™¨è¿æ¥çš„ç½‘ç»œï¼ˆSwarm ä¸­ï¼‰ --attachable --label æ·»åŠ æ ‡ç­¾ --label env=dev --opt æä¾›è‡ªå®šä¹‰é©±åŠ¨é€‰é¡¹ --opt encrypted=true --driver æˆ– -d : å¸¸è§çš„ Docker ç½‘ç»œé©±åŠ¨ç±»å‹ ç±»å‹ å«ä¹‰ æ˜¯å¦æ”¯æŒç«¯å£æ˜ å°„ ç‰¹ç‚¹ä¸åº”ç”¨åœºæ™¯ bridgeï¼ˆé»˜è®¤ï¼‰ é»˜è®¤çš„æ¡¥æ¥ç½‘ç»œï¼Œå®¹å™¨é€šè¿‡è™šæ‹Ÿç½‘æ¡¥è¿æ¥ï¼Œå…±äº«å®¿ä¸»æœºçš„ç½‘ç»œæ¥å£ã€‚ âœ… æ˜¯ é»˜è®¤æ¨¡å¼ï¼Œé€‚ç”¨äºå•ä¸»æœºéƒ¨ç½²ã€å¤šä¸ªå®¹å™¨éœ€è¦äº’é€šçš„åœºæ™¯ã€‚å¯æ˜ å°„ç«¯å£å¯¹å¤–è®¿é—®ã€‚ host å®¹å™¨ä¸å®¿ä¸»æœºå…±ç”¨ç½‘ç»œå‘½åç©ºé—´ï¼Œå®¹å™¨ç›´æ¥ä½¿ç”¨å®¿ä¸»æœºçš„ IP å’Œç«¯å£ã€‚ âŒ å¦ æ— ç½‘ç»œéš”ç¦»ï¼Œæ€§èƒ½é«˜ï¼Œé€‚ç”¨äºé«˜æ€§èƒ½ã€ä½å»¶è¿Ÿåœºæ™¯ï¼ˆå¦‚æ¸¸æˆæœåŠ¡å™¨ï¼‰ã€‚ none å®¹å™¨æ²¡æœ‰ç½‘ç»œæ¥å£ï¼Œå®Œå…¨éš”ç¦»ã€‚ âŒ å¦ ç”¨äºå®‰å…¨æ€§æˆ–æµ‹è¯•ç½‘ç»œä¸å¯è¾¾åœºæ™¯ã€‚ macvlan ä¸ºå®¹å™¨åˆ†é…ç‹¬ç«‹ MAC å’Œ IPï¼Œå®¹å™¨åƒç‰©ç†ä¸»æœºä¸€æ ·å‡ºç°åœ¨å±€åŸŸç½‘ä¸­ã€‚ âœ… æ˜¯ï¼ˆå°‘è§ï¼‰ é€‚ç”¨äºå®¹å™¨å¿…é¡»ç›´æ¥æš´éœ²åœ¨ç‰©ç†ç½‘ç»œä¸­çš„åœºæ™¯ï¼ˆå¦‚ DHCP æœåŠ¡ã€ARP å¹¿æ’­ï¼‰ã€‚ ipvlanï¼ˆé«˜çº§ï¼‰ ç±»ä¼¼ macvlanï¼Œä½†ä¸ä½¿ç”¨è™šæ‹Ÿ MAC åœ°å€ã€‚ âœ… æ˜¯ï¼ˆå°‘è§ï¼‰ é«˜çº§ç½‘ç»œæ–¹æ¡ˆï¼Œé€‚ç”¨äºå¯¹ç½‘ç»œæ‹“æ‰‘ç²¾ç»†æ§åˆ¶çš„åœºæ™¯ã€‚ overlay ç”¨äºå¤šä¸»æœºä¹‹é—´å®¹å™¨é€šä¿¡ï¼Œéœ€è¦ Docker Swarm æ”¯æŒã€‚ âœ… æ˜¯ï¼ˆSwarmï¼‰ è·¨ä¸»æœºéƒ¨ç½²æœåŠ¡çš„å¿…è¦æ‰‹æ®µï¼Œé€‚åˆå®¹å™¨ç¼–æ’å¹³å°ï¼ˆå¦‚ Swarmã€Kubernetesï¼‰ã€‚ å‰é¢æˆ‘ä»¬è¯´è¿‡ï¼ŒDockerä¼šè‡ªåŠ¨åˆ›å»ºä¸‰ä¸ªç½‘ç»œï¼Œå³ï¼šbridgeã€hostã€noneã€‚å¯¹äºå•å°å®¿ä¸»æœºçš„åœºæ™¯ï¼Œç»å¤§å¤šæ•°æƒ…å†µä¸‹æˆ‘ä»¬éƒ½åªä¼šä½¿ç”¨bridgeç½‘ç»œã€‚ ç¤ºä¾‹ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657# åˆ›å»ºä¸€ä¸ªåä¸ºmy-networkçš„ç½‘ç»œ$ docker network create my-network# ç­‰åŒäºï¼Œå› ä¸ºé»˜è®¤çš„ç½‘ç»œé©±åŠ¨ä¸ºbridge$ docker network create --driver bridge my-network# æŸ¥çœ‹ç½‘ç»œï¼Œå¯ä»¥çœ‹åˆ°æ–°å»ºçš„ç½‘ç»œçš„é©±åŠ¨ä¸ºbridge$ docker network ls -f name=my-networkNETWORK ID NAME DRIVER SCOPEc2dbe1686790 my-network bridge local# æŸ¥çœ‹å®¿ä¸»æœºçš„ç½‘æ¡¥ä¿¡æ¯$ brctl show## è¾“å‡ºï¼Œå¯ä»¥çœ‹åˆ°æ­¤æ—¶æœ‰ä¸€ä¸ªç½‘æ¡¥è®¾å¤‡ br-c2dbe1686790ï¼Œbr: bridgeï¼Œc2dbe1686790ï¼šnetwork idbridge name bridge id STP enabled interfacesbr-c2dbe1686790 8000.02425be81fae nodocker0 8000.0242d6d509b1 no vethc0e0cc3 vethf4b7577# æŸ¥çœ‹å®¿ä¸»æœºçš„ç½‘å¡$ ip addr## è¾“å‡ºï¼Œbr-c2dbe1686790 ç½‘å¡åç§°ï¼Œå…¶IPç½‘æ®µä¸º 172.18.0.1/1613: br-c2dbe1686790: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc noqueue state DOWN group default link/ether 02:42:5b:e8:1f:ae brd ff:ff:ff:ff:ff:ff inet 172.18.0.1/16 brd 172.18.255.255 scope global br-c2dbe1686790 valid_lft forever preferred_lft forever# å¯åŠ¨ä¸¤ä¸ªå®¹å™¨å¹¶æ·»åŠ åˆ°my-networkç½‘ç»œä¸­$ docker run -itd --network my-network --name a1 alpine$ docker run -itd --network my-network --name a2 alpine$ ip addr## è¾“å‡º,å¯ä»¥çœ‹åˆ°ä¸¤ä¸ªå®¹å™¨éƒ½æ·»åŠ åˆ°äº†my-networkç½‘ç»œä¸­bridge name bridge id STP enabled interfacesbr-c2dbe1686790 8000.02425be81fae no veth094946c vetha2ba68adocker0 8000.0242d6d509b1 no vethc0e0cc3 vethf4b7577# æµ‹è¯•è¿é€šæ€§ï¼Œå¯ä»¥çœ‹åˆ° a1å¯ä»¥pingé€š a2ï¼Œåè¿‡æ¥ a2ä¹Ÿå¯ä»¥pingé€š a1$ docker exec -it a1 ping a2PING a2 (172.18.0.4): 56 data bytes64 bytes from 172.18.0.4: seq=0 ttl=64 time=2.127 ms64 bytes from 172.18.0.4: seq=1 ttl=64 time=0.119 ms$ docker psCONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMESe0fb0614591e alpine &quot;/bin/sh&quot; 4 minutes ago Up 4 minutes a2fc6e9477d2b7 alpine &quot;/bin/sh&quot; 4 minutes ago Up 4 minutes a19d3ed5be1916 alpine &quot;/bin/sh&quot; 4 hours ago Up 4 hours ap2c2436a1d750c alpine &quot;/bin/sh&quot; 4 hours ago Up 4 hours ap1# ä¸åŒç½‘ç»œä¸­çš„å®¹å™¨ä¹‹é—´ä¸èƒ½ç›¸äº’pingé€š## é€šè¿‡å®¹å™¨åç§°æ— æ³•pingé€š$ docker exec -it a1 ping ap1ping: bad address &#x27;ap1&#x27;## é€šè¿‡ap1å®¹å™¨IPä¹Ÿæ— æ³•pingé€šï¼Œè¿™å°±å®ç°äº†ä¸åŒç½‘ç»œä¸­çš„ç½‘ç»œéš”ç¦»$ docker exec -it a1 ping 172.17.0.2 å¦‚æœåˆ›å»ºç½‘ç»œæ—¶æ²¡æœ‰æŒ‡å®šå­ç½‘ï¼Œåˆ™ä»docker0çš„172.17.0.0/16å¾€åæ’ï¼Œæ¯”å¦‚æˆ‘ä»¬ä¸Šé¢åˆ›å»ºçš„my-networkï¼Œå…¶å­ç½‘å°±æ˜¯172.18.0.0/16ï¼Œå¦‚ä¸‹å‘½ä»¤åˆ›å»ºä¸€ä¸ªbridgeç½‘ç»œï¼Œå¹¶æŒ‡å®šå­ç½‘ã€ç½‘å…³ç­‰ä¿¡æ¯ 12345$ docker network create \\ --driver bridge \\ --subnet 192.168.50.0/24 \\ --gateway 192.168.50.1 \\ my-custom-net bridge æ€»ç»“ é»˜è®¤åˆ›å»ºçš„ docker0 ç½‘ç»œï¼Œæ˜¯ä¸€ä¸ªæ¡¥æ¥ç½‘ç»œï¼Œåœ¨ docker network ä¸­çš„åç§°ä¸º bridgeï¼Œè¯¥ç½‘ç»œä¸‹çš„å®¹å™¨å¯ä»¥é€šè¿‡IPåœ°å€ç›¸äº’è®¿é—®ï¼Œä½†ä¸èƒ½é€šè¿‡å®¹å™¨åç§°è®¿é—® é€šè¿‡docker network create &lt;ç½‘ç»œåç§°&gt;åˆ›å»ºçš„ç½‘ç»œä¹Ÿæ˜¯ä¸€ä¸ªæ¡¥æ¥ç½‘ç»œï¼Œåœ¨è¿™ä¸ªç½‘ç»œä¸‹ï¼Œå®¹å™¨å¯ä»¥é€šè¿‡IPåœ°å€ç›¸äº’è®¿é—®ï¼Œä¹Ÿèƒ½é€šè¿‡å®¹å™¨åç§°è®¿é—®ã€‚ docker network ls : åˆ—å‡ºæ‰€æœ‰ç½‘ç»œ 123456789101112# åˆ—å‡ºæ‰€æœ‰ç½‘ç»œ$ docker network ls# è¾“å‡ºæŒ‡å®šçš„ä¿¡æ¯$ docker network ls --format &quot;table &#123;&#123;.ID&#125;&#125;\\t&#123;&#123;.Name&#125;&#125;\\t&#123;&#123;.Scope&#125;&#125;&quot;# è¾“å‡ºjsonæ ¼å¼$ docker network ls --format &quot;json&quot;# è¿‡æ»¤$ docker network ls -f &quot;driver=bridge&quot;# ä¸æˆªæ–­è¾“å‡º$ docker network ls --no-trunc# åªæ˜¾ç¤ºnetwork id$ docker network ls -q docker network inspect : æŸ¥çœ‹ç½‘ç»œè¯¦æƒ… 123456# æŸ¥çœ‹åç§°ä¸ºbridgeç½‘ç»œè¯¦æƒ…$ docker network inspect bridge# æŸ¥çœ‹å½“å‰ç½‘ç»œä¸‹æœ‰å“ªäº›å®¹å™¨$ docker network inspect bridge --format &quot;&#123;&#123;.Containers&#125;&#125;&quot;# è¾“å‡ºjsonæ ¼å¼$ docker network inspect bridge --format &quot;json&quot; docker network prune : æ¸…ç†æ²¡ç”¨çš„ç½‘ç»œ 123456# åˆ é™¤æ‰€æœ‰æœªä½¿ç”¨çš„ç½‘ç»œ$ docker network prune# åˆ é™¤æ‰€æœ‰æœªä½¿ç”¨çš„ç½‘ç»œï¼Œæ— éœ€ç¡®è®¤$ docker network prune -f# æ¸…ç†24å°æ—¶å†…æœªä½¿ç”¨çš„ç½‘ç»œ$ docker network prune --filter &quot;until=24h&quot; docker network rm : åˆ é™¤ç½‘ç»œ 123456# åˆ é™¤æŒ‡å®šçš„ç½‘ç»œ$ docker network rm &lt;network-name&gt;# åˆ é™¤æ‰€æœ‰ç½‘ç»œ$ docker network rm $(docker network ls -q)# åˆ é™¤æ‰€æœ‰bridgeç½‘ç»œï¼Œè¿™é‡Œè¦æ³¨æ„ï¼Œdockeré»˜è®¤åˆ›å»ºçš„3ä¸ªç½‘ç»œæ˜¯åˆ é™¤ä¸æ‰çš„$ docker network rm $(docker network ls -q -f driver=bridge) docker network connect : å°†å®¹å™¨è¿æ¥åˆ°ç½‘ç»œ 12# å°†å®¹å™¨è¿æ¥åˆ°ç½‘ç»œï¼Œå¦‚æœå®¹å™¨å¯åŠ¨æ—¶å¿˜è®°è¿æ¥ç½‘ç»œï¼Œè¿™é‡Œå¯ä»¥æ‰‹åŠ¨æ·»åŠ $ docker network connect &lt;network-name&gt; &lt;container-name&gt; docker network disconnect : å°†å®¹å™¨ä»ç½‘ç»œæ–­å¼€ 1$ docker network disconnect &lt;network-name&gt; &lt;container-name&gt; æœ¬æ–‡æ€»ç»“ å®¹å™¨ä¸ç½‘ç»œæ˜¯å¤šå¯¹å¤šçš„å…³ç³»ï¼Œå³ä¸€ä¸ªç½‘ç»œå¯ä»¥æœ‰å¤šä¸ªå®¹å™¨ï¼Œä¸€ä¸ªå®¹å™¨ä¹Ÿå¯ä»¥è¿æ¥åˆ°å¤šä¸ªç½‘ç»œã€‚ docker0 æ˜¯ docker é»˜è®¤åˆ›å»ºçš„ç½‘ç»œï¼Œä¸æŒ‡å®šç½‘ç»œçš„æƒ…å†µä¸‹æ‰€æœ‰å®¹å™¨éƒ½è¿æ¥åˆ° docker0 ç½‘ç»œã€‚ docker0 æ˜¯ bridge ç½‘ç»œï¼Œè¯¥ç½‘ç»œä¸­çš„å®¹å™¨ä¹‹é—´å¯ä»¥é€šè¿‡ IP äº’ç›¸è®¿é—®ï¼Œä½†ä¸èƒ½é€šè¿‡å®¹å™¨åç§°è®¿é—®ã€‚ è‡ªå»ºçš„ bridge ç½‘ç»œä¸­çš„å®¹å™¨å¯ä»¥é€šè¿‡å®¹å™¨åç§°ï¼ˆæˆ–å®¹å™¨IDï¼Œä½†ä¸å¸¸ç”¨ï¼‰è®¿é—®ã€‚ ä¸åŒçš„ bridge ç½‘ç»œä¸­çš„å®¹å™¨ä¸èƒ½äº’ç›¸è®¿é—®ã€‚ --link vs --network é¡¹ç›® --link --network åŠŸèƒ½ å°†ä¸€ä¸ªå®¹å™¨é“¾æ¥åˆ°å¦ä¸€ä¸ªå®¹å™¨ï¼Œå¹¶è®¾ç½®ç¯å¢ƒå˜é‡å’Œä¸»æœºåæ˜ å°„ å°†å®¹å™¨åŠ å…¥åˆ°ä¸€ä¸ªè‡ªå®šä¹‰ç½‘ç»œä¸­ï¼Œå®ç°çµæ´»ã€éš”ç¦»çš„ç½‘ç»œé€šä¿¡ æ˜¯å¦æ¨è âŒ ä¸æ¨èï¼ˆå·²åºŸå¼ƒï¼‰ âœ… æ¨èä½¿ç”¨ ç½‘ç»œéš”ç¦» åŸºäºé»˜è®¤ bridge ç½‘ç»œï¼Œéš”ç¦»æ€§å·® å¯ä»¥åˆ›å»ºè‡ªå®šä¹‰ç½‘ç»œï¼ˆbridgeã€overlay ç­‰ï¼‰ï¼Œéš”ç¦»æ€§å¼º å¯æ‰©å±•æ€§ åªé€‚ç”¨äºå·²è¿è¡Œçš„å®¹å™¨ï¼Œè¿æ¥å›ºå®š æ”¯æŒå¤šä¸ªå®¹å™¨ï¼Œçµæ´»ç»„åˆå’ŒåŠ¨æ€æ‰©å±• DNS æ”¯æŒ ä»…è®¾ç½®ç¯å¢ƒå˜é‡ï¼Œä¸æ”¯æŒè‡ªåŠ¨ DNS è‡ªå®šä¹‰ç½‘ç»œä¸­æ”¯æŒå®¹å™¨åç§°ä½œä¸º DNS åç§° ç”Ÿå‘½å‘¨æœŸ ä¸€æ–¹å®¹å™¨å…³é—­ï¼Œå¦ä¸€æ–¹ä»ä¿å­˜è¿‡æ—¶é“¾æ¥ ç½‘ç»œå­˜åœ¨å³å¯ï¼Œå®¹å™¨ç”Ÿå‘½å‘¨æœŸä¸äº’ç›¸å½±å“ å®‰å…¨æ€§ æ‰€æœ‰å®¹å™¨å…±äº« bridgeï¼Œå®¹æ˜“ç›¸äº’è®¿é—® è‡ªå®šä¹‰ç½‘ç»œé—´é»˜è®¤éš”ç¦»ï¼Œå®‰å…¨æ€§æ›´å¥½","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» Docker å‘½ä»¤ ä¸­ ç½‘ç»œç®¡ç† ç›¸å…³å‘½ä»¤ Dockerå®˜æ–¹æ–‡æ¡£","date_published":"2025-05-28T13:40:05.000Z","tags":["æŠ€æœ¯","docker","docker"]},{"id":"https://blog.hanqunfeng.com/2025/05/28/docker-command-volume/","url":"https://blog.hanqunfeng.com/2025/05/28/docker-command-volume/","title":"Docker å‘½ä»¤ ä¹‹ æ•°æ®å·(Volume)","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç» Docker å‘½ä»¤ ä¸­ æ•°æ®å·ç®¡ç† ç›¸å…³å‘½ä»¤</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://docs.docker.com\">Dockerå®˜æ–¹æ–‡æ¡£</a></p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"ä»€ä¹ˆæ˜¯Volume-æ•°æ®å·\">ä»€ä¹ˆæ˜¯Volume(æ•°æ®å·)?</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Volume æ˜¯ç”± Docker ç®¡ç†çš„ç‰¹æ®Šç›®å½•ï¼Œä½äºå®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿä¸­(<code>/var/lib/docker/volumes/</code>)ï¼Œç”¨äºå­˜å‚¨å’Œå…±äº«å®¹å™¨çš„æ•°æ®ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å½“å®¹å™¨è¢«åˆ é™¤åï¼Œå®¹å™¨å†…çš„æ–‡ä»¶ç³»ç»Ÿä¹Ÿä¼šä¸€èµ·åˆ é™¤ï¼Œä½†æŒ‚è½½åœ¨ Volume ä¸­çš„æ•°æ®ä¸ä¼šä¸¢å¤±ï¼Œå¯ä¾›å¤šä¸ªå®¹å™¨å…±äº«ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>Volume çš„ç‰¹ç‚¹</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>ç‰¹æ€§</th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>æ•°æ®æŒä¹…åŒ–</td>\n<td>å³ä½¿å®¹å™¨åˆ é™¤ï¼Œæ•°æ®ä»ä¿ç•™åœ¨å·ä¸­</td>\n</tr>\n<tr>\n<td>å¤šå®¹å™¨å…±äº«è®¿é—®</td>\n<td>å¤šä¸ªå®¹å™¨å¯ä»¥æŒ‚è½½åŒä¸€ä¸ªå·ï¼Œå®ç°æ•°æ®å…±äº«</td>\n</tr>\n<tr>\n<td>ä¸ä¾èµ–å®¹å™¨è·¯å¾„</td>\n<td>å·ä¸å®¹å™¨ç”Ÿå‘½å‘¨æœŸè§£è€¦ï¼Œæ”¯æŒçµæ´»çš„å®¹å™¨é‡å»ºå’Œå‡çº§</td>\n</tr>\n<tr>\n<td>ç®¡ç†ç®€ä¾¿</td>\n<td>å¯ç”¨ <code>docker volume</code> å‘½ä»¤è¿›è¡ŒæŸ¥çœ‹ã€åˆ›å»ºã€åˆ é™¤ç­‰æ“ä½œ</td>\n</tr>\n<tr>\n<td>å®‰å…¨éš”ç¦»</td>\n<td>Docker ç®¡ç†çš„è·¯å¾„æ¯”ç»‘å®šæŒ‚è½½æ›´å®‰å…¨</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"docker-volume-ç›¸å…³å‘½ä»¤\"><code>docker volume</code> ç›¸å…³å‘½ä»¤</h2>\n<table>\n<thead>\n<tr>\n<th>å‘½ä»¤</th>\n<th>ä½œç”¨è¯´æ˜</th>\n<th>ç¤ºä¾‹</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>docker volume create</code></td>\n<td>åˆ›å»ºä¸€ä¸ªæ–°çš„å·ï¼Œåç§°å¯é€‰ï¼ˆä¸æŒ‡å®šä¼šè‡ªåŠ¨ç”Ÿæˆï¼‰</td>\n<td><code>docker volume create myvolume</code></td>\n</tr>\n<tr>\n<td><code>docker volume ls</code></td>\n<td>åˆ—å‡ºæ‰€æœ‰å·²å­˜åœ¨çš„å·</td>\n<td><code>docker volume ls</code></td>\n</tr>\n<tr>\n<td><code>docker volume inspect &lt;name&gt;</code></td>\n<td>æŸ¥çœ‹æŒ‡å®šå·çš„è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…æ‹¬æŒ‚è½½ç‚¹ã€é©±åŠ¨ç­‰</td>\n<td><code>docker volume inspect myvolume</code></td>\n</tr>\n<tr>\n<td><code>docker volume rm &lt;name&gt;</code></td>\n<td>åˆ é™¤ä¸€ä¸ªå·ï¼ˆå‰ææ˜¯æ²¡æœ‰å®¹å™¨æ­£åœ¨ä½¿ç”¨è¯¥å·ï¼‰</td>\n<td><code>docker volume rm myvolume</code></td>\n</tr>\n<tr>\n<td><code>docker volume prune</code></td>\n<td>åˆ é™¤æ‰€æœ‰æœªè¢«ä½¿ç”¨çš„å·ï¼ˆä¼šæœ‰ç¡®è®¤æç¤ºï¼‰</td>\n<td><code>docker volume prune</code></td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"docker-volume-create-åˆ›å»ºä¸€ä¸ªæ–°çš„å·\"><code>docker volume create</code> : åˆ›å»ºä¸€ä¸ªæ–°çš„å·</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¯­æ³•</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker volume create [OPTIONS] [VOLUME]</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å‚æ•°è¯¦è§£</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>é€‰é¡¹</th>\n<th>è¯´æ˜</th>\n<th>ç¤ºä¾‹</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>-d, --driver string</code></td>\n<td>æŒ‡å®šå·é©±åŠ¨ç¨‹åºï¼Œé»˜è®¤æ˜¯ <code>local</code>ï¼ˆæœ¬åœ°å­˜å‚¨ï¼‰</td>\n<td><code>-d local</code> æˆ– ç¬¬ä¸‰æ–¹é©±åŠ¨åç§°(éœ€è¦å®‰è£…ç¬¬ä¸‰æ–¹æ’ä»¶)</td>\n</tr>\n<tr>\n<td><code>--label list</code></td>\n<td>ç»™å·æ·»åŠ æ ‡ç­¾ï¼ˆå…ƒæ•°æ®ï¼‰ï¼Œå¯ç”¨äºåˆ†ç±»ã€è¿‡æ»¤</td>\n<td><code>--label env=prod</code></td>\n</tr>\n<tr>\n<td><code>-o, --opt map</code></td>\n<td>è®¾ç½®é©±åŠ¨çš„ç‰¹å®šé€‰é¡¹ï¼Œæ ¼å¼ä¸º <code>key=value</code>ï¼Œå¤šä¸ªé€‰é¡¹å¯é‡å¤ä½¿ç”¨</td>\n<td><code>-o type=tmpfs -o device=tmpfs</code></td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç¤ºä¾‹</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åˆ›å»ºä¸€ä¸ªé»˜è®¤å·ï¼ˆlocal é©±åŠ¨ï¼‰</span></span><br><span class=\"line\">docker volume create myvolume</span><br><span class=\"line\"><span class=\"comment\"># ä¹Ÿå¯ä»¥åœ¨å¯åŠ¨å®¹å™¨çš„æ—¶å€™åˆ›å»ºé»˜è®¤æ•°æ®å·ï¼Œå¦‚ä¸‹å‘½ä»¤ï¼Œè‹¥ myvolume å·ä¸å­˜åœ¨ï¼Œåˆ™ä¼šè‡ªåŠ¨åˆ›å»º</span></span><br><span class=\"line\">docker run -d -v myvolume:/data nginx</span><br><span class=\"line\">docker run -d --mount <span class=\"built_in\">type</span>=volume,<span class=\"built_in\">source</span>=myvolume,target=/data nginx</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åˆ›å»ºä¸€ä¸ªå¸¦æœ‰æ ‡ç­¾çš„å·</span></span><br><span class=\"line\">docker volume create --label <span class=\"built_in\">env</span>=dev --label team=backend myvolume</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åˆ›å»ºåŒ¿åå·ï¼ˆä¸æŒ‡å®šåç§°ï¼‰</span></span><br><span class=\"line\">docker volume create</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ä½¿ç”¨ tmpfs ç±»å‹å·ï¼ˆåªå­˜äºå†…å­˜ä¸­ï¼Œä¸è½ç›˜ï¼‰,é€‚ç”¨äºé«˜é€Ÿè¯»å†™ä½†ä¸éœ€è¦æŒä¹…åŒ–çš„æ•°æ®</span></span><br><span class=\"line\">docker volume create \\</span><br><span class=\"line\">  -d <span class=\"built_in\">local</span> \\            <span class=\"comment\"># æŒ‡å®šé©±åŠ¨ç¨‹åºä¸º local</span></span><br><span class=\"line\">  -o <span class=\"built_in\">type</span>=tmpfs \\       <span class=\"comment\"># æŒ‡å®šåº•å±‚æ–‡ä»¶ç³»ç»Ÿç±»å‹ä¸º tmpfsï¼ˆå†…å­˜æ–‡ä»¶ç³»ç»Ÿï¼‰</span></span><br><span class=\"line\">  -o device=tmpfs \\     <span class=\"comment\"># è®¾ç½®æŒ‚è½½è®¾å¤‡ä¸º tmpfsï¼Œç”¨äºä¸ type=tmpfs é…åˆ</span></span><br><span class=\"line\">  -o o=size=100m \\      <span class=\"comment\"># è®¾ç½® tmpfs çš„æœ€å¤§å®¹é‡ä¸º 100MB</span></span><br><span class=\"line\">  mytmpfs               <span class=\"comment\"># å·çš„åç§°ï¼Œå¯é€šè¿‡ docker volume ls æŸ¥çœ‹</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰é©±åŠ¨çš„å·ï¼ˆå¦‚ nfsï¼‰</span></span><br><span class=\"line\">docker volume create \\</span><br><span class=\"line\">  -d <span class=\"built_in\">local</span> \\                    <span class=\"comment\"># é»˜è®¤é©±åŠ¨ç¨‹åºä¸º local</span></span><br><span class=\"line\">  -o <span class=\"built_in\">type</span>=nfs \\                 <span class=\"comment\"># åº•å±‚æ–‡ä»¶ç³»ç»Ÿç±»å‹ä¸º nfs</span></span><br><span class=\"line\">  -o o=addr=192.168.1.100,rw \\  <span class=\"comment\"># è®¾ç½® nfs çš„åœ°å€å’Œè¯»å†™æƒé™ï¼Œè‹¥åªè¯»ä¸º ro</span></span><br><span class=\"line\">  -o device=:/path/to/share \\   <span class=\"comment\"># æŒ‚è½½è®¾å¤‡ä¸º nfsï¼Œæ ¼å¼ä¸ºï¼šnfs://192.168.1.100:/path/to/share</span></span><br><span class=\"line\">  mynfs                         <span class=\"comment\"># å·çš„åç§°ï¼Œå¯é€šè¿‡ docker volume ls æŸ¥çœ‹</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ›å»ºçš„æ•°æ®å·ä¼šä¿å­˜åœ¨ <code>/var/lib/docker/volumes/</code> ç›®å½•ä¸‹ï¼Œæ¯”å¦‚æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªå· myvolumeï¼Œé‚£ä¹ˆè¯¥å·ä¼šä¿å­˜åœ¨ <code>/var/lib/docker/volumes/myvolume/_data</code> ç›®å½•ä¸‹</p>\n</li>\n</ul>\n<h3 id=\"docker-volume-ls-åˆ—å‡ºæ‰€æœ‰å·²å­˜åœ¨çš„å·\"><code>docker volume ls</code> : åˆ—å‡ºæ‰€æœ‰å·²å­˜åœ¨çš„å·</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åˆ—å‡ºæ‰€æœ‰å·</span></span><br><span class=\"line\">docker volume <span class=\"built_in\">ls</span></span><br><span class=\"line\"><span class=\"comment\"># åˆ—å‡ºæ‰€æœ‰å·çš„ID</span></span><br><span class=\"line\">docker volume <span class=\"built_in\">ls</span> -q</span><br><span class=\"line\"><span class=\"comment\"># åˆ—å‡ºæŒ‡å®šé©±åŠ¨çš„å·</span></span><br><span class=\"line\">docker volume <span class=\"built_in\">ls</span> -f driver=<span class=\"built_in\">local</span></span><br><span class=\"line\"><span class=\"comment\"># åˆ—å‡ºæŒ‡å®šæ ‡ç­¾çš„å·</span></span><br><span class=\"line\">docker volume <span class=\"built_in\">ls</span> -f label=<span class=\"built_in\">env</span>=dev</span><br><span class=\"line\"><span class=\"comment\"># åˆ—å‡ºæ‰€æœ‰æœªä½¿ç”¨çš„å·ï¼ŒåŒ…æ‹¬åŒ¿åå·å’Œå‘½åå·</span></span><br><span class=\"line\">docker volume <span class=\"built_in\">ls</span> -f dangling=<span class=\"literal\">true</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"docker-volume-inspect-name-æŸ¥çœ‹æŒ‡å®šå·çš„è¯¦ç»†ä¿¡æ¯\"><code>docker volume inspect &lt;name&gt;</code> : æŸ¥çœ‹æŒ‡å®šå·çš„è¯¦ç»†ä¿¡æ¯</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åˆ—å‡ºæŒ‡å®šå·çš„è¯¦ç»†ä¿¡æ¯</span></span><br><span class=\"line\">docker volume inspect myvolume</span><br><span class=\"line\"><span class=\"comment\"># åˆ—å‡ºæŒ‡å®šå·çš„è¯¦ç»†ä¿¡æ¯ï¼Œå¹¶ä½¿ç”¨jsonæ ¼å¼è¾“å‡º</span></span><br><span class=\"line\">docker volume inspect -f json myvolume</span><br><span class=\"line\"><span class=\"comment\"># åˆ—å‡ºæŒ‡å®šå·çš„æŒ‚è½½ç‚¹</span></span><br><span class=\"line\">docker volume inspect myvolume --format <span class=\"string\">&quot;&#123;&#123;.Mountpoint&#125;&#125;&quot;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"docker-volume-prune-åˆ é™¤æ‰€æœ‰æœªè¢«å®¹å™¨ä½¿ç”¨çš„å·\"><code>docker volume prune</code> : åˆ é™¤æ‰€æœ‰æœªè¢«å®¹å™¨ä½¿ç”¨çš„å·</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åˆ é™¤æ‰€æœ‰æœªè¢«ä½¿ç”¨çš„åŒ¿åæ•°æ®å·ï¼Œä¼šæç¤ºç¡®è®¤</span></span><br><span class=\"line\">docker volume prune</span><br><span class=\"line\"><span class=\"comment\"># åˆ é™¤æ‰€æœ‰æœªè¢«ä½¿ç”¨çš„æ•°æ®å·ï¼Œä¼šæç¤ºç¡®è®¤</span></span><br><span class=\"line\">docker volume prune -a</span><br><span class=\"line\"><span class=\"comment\"># åˆ é™¤æ‰€æœ‰æœªè¢«ä½¿ç”¨çš„å·ï¼Œæ— éœ€ç¡®è®¤ç«‹åˆ»åˆ é™¤</span></span><br><span class=\"line\">docker volume prune -a -f</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åŒ¿åå· vs å‘½åå·</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">åŒ¿åå·ï¼šæ²¡æœ‰åç§°ï¼Œåªåœ¨ <code>docker run -v /container/path</code> æ—¶è‡ªåŠ¨åˆ›å»ºï¼›</li>\n<li class=\"lvl-4\">å‘½åå·ï¼šæœ‰åç§°ï¼Œä¾‹å¦‚ <code>docker run -v mydata:/container/path</code>ï¼›</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"docker-volume-rm-name-åˆ é™¤æ•°æ®å·\"><code>docker volume rm &lt;name&gt;</code> : åˆ é™¤æ•°æ®å·</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åˆ é™¤æŒ‡å®šæ•°æ®å·</span></span><br><span class=\"line\">docker volume <span class=\"built_in\">rm</span> myvolume</span><br><span class=\"line\"><span class=\"comment\"># åˆ é™¤æ‰€æœ‰æ•°æ®å·</span></span><br><span class=\"line\">docker volume <span class=\"built_in\">rm</span> $(docker volume <span class=\"built_in\">ls</span> -q)</span><br><span class=\"line\"><span class=\"comment\"># åˆ é™¤æ‰€æœ‰æœªä½¿ç”¨çš„æ•°æ®å·</span></span><br><span class=\"line\">docker volume <span class=\"built_in\">rm</span> $(docker volume <span class=\"built_in\">ls</span> -qf dangling=<span class=\"literal\">true</span>)</span><br><span class=\"line\"><span class=\"comment\"># åˆ é™¤æ‰€æœ‰æœªä½¿ç”¨çš„æ•°æ®å·ï¼Œæ— éœ€ç¡®è®¤</span></span><br><span class=\"line\">docker volume <span class=\"built_in\">rm</span> $(docker volume <span class=\"built_in\">ls</span> -qf dangling=<span class=\"literal\">true</span>) -f</span><br></pre></td></tr></table></figure>","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» Docker å‘½ä»¤ ä¸­ æ•°æ®å·ç®¡ç† ç›¸å…³å‘½ä»¤ Dockerå®˜æ–¹æ–‡æ¡£ ä»€ä¹ˆæ˜¯Volume(æ•°æ®å·)? Volume æ˜¯ç”± Docker ç®¡ç†çš„ç‰¹æ®Šç›®å½•ï¼Œä½äºå®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿä¸­(/var/lib/docker/volumes/)ï¼Œç”¨äºå­˜å‚¨å’Œå…±äº«å®¹å™¨çš„æ•°æ®ã€‚ å½“å®¹å™¨è¢«åˆ é™¤åï¼Œå®¹å™¨å†…çš„æ–‡ä»¶ç³»ç»Ÿä¹Ÿä¼šä¸€èµ·åˆ é™¤ï¼Œä½†æŒ‚è½½åœ¨ Volume ä¸­çš„æ•°æ®ä¸ä¼šä¸¢å¤±ï¼Œå¯ä¾›å¤šä¸ªå®¹å™¨å…±äº«ã€‚ Volume çš„ç‰¹ç‚¹ ç‰¹æ€§ è¯´æ˜ æ•°æ®æŒä¹…åŒ– å³ä½¿å®¹å™¨åˆ é™¤ï¼Œæ•°æ®ä»ä¿ç•™åœ¨å·ä¸­ å¤šå®¹å™¨å…±äº«è®¿é—® å¤šä¸ªå®¹å™¨å¯ä»¥æŒ‚è½½åŒä¸€ä¸ªå·ï¼Œå®ç°æ•°æ®å…±äº« ä¸ä¾èµ–å®¹å™¨è·¯å¾„ å·ä¸å®¹å™¨ç”Ÿå‘½å‘¨æœŸè§£è€¦ï¼Œæ”¯æŒçµæ´»çš„å®¹å™¨é‡å»ºå’Œå‡çº§ ç®¡ç†ç®€ä¾¿ å¯ç”¨ docker volume å‘½ä»¤è¿›è¡ŒæŸ¥çœ‹ã€åˆ›å»ºã€åˆ é™¤ç­‰æ“ä½œ å®‰å…¨éš”ç¦» Docker ç®¡ç†çš„è·¯å¾„æ¯”ç»‘å®šæŒ‚è½½æ›´å®‰å…¨ docker volume ç›¸å…³å‘½ä»¤ å‘½ä»¤ ä½œç”¨è¯´æ˜ ç¤ºä¾‹ docker volume create åˆ›å»ºä¸€ä¸ªæ–°çš„å·ï¼Œåç§°å¯é€‰ï¼ˆä¸æŒ‡å®šä¼šè‡ªåŠ¨ç”Ÿæˆï¼‰ docker volume create myvolume docker volume ls åˆ—å‡ºæ‰€æœ‰å·²å­˜åœ¨çš„å· docker volume ls docker volume inspect &lt;name&gt; æŸ¥çœ‹æŒ‡å®šå·çš„è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…æ‹¬æŒ‚è½½ç‚¹ã€é©±åŠ¨ç­‰ docker volume inspect myvolume docker volume rm &lt;name&gt; åˆ é™¤ä¸€ä¸ªå·ï¼ˆå‰ææ˜¯æ²¡æœ‰å®¹å™¨æ­£åœ¨ä½¿ç”¨è¯¥å·ï¼‰ docker volume rm myvolume docker volume prune åˆ é™¤æ‰€æœ‰æœªè¢«ä½¿ç”¨çš„å·ï¼ˆä¼šæœ‰ç¡®è®¤æç¤ºï¼‰ docker volume prune docker volume create : åˆ›å»ºä¸€ä¸ªæ–°çš„å· è¯­æ³• 1docker volume create [OPTIONS] [VOLUME] å‚æ•°è¯¦è§£ é€‰é¡¹ è¯´æ˜ ç¤ºä¾‹ -d, --driver string æŒ‡å®šå·é©±åŠ¨ç¨‹åºï¼Œé»˜è®¤æ˜¯ localï¼ˆæœ¬åœ°å­˜å‚¨ï¼‰ -d local æˆ– ç¬¬ä¸‰æ–¹é©±åŠ¨åç§°(éœ€è¦å®‰è£…ç¬¬ä¸‰æ–¹æ’ä»¶) --label list ç»™å·æ·»åŠ æ ‡ç­¾ï¼ˆå…ƒæ•°æ®ï¼‰ï¼Œå¯ç”¨äºåˆ†ç±»ã€è¿‡æ»¤ --label env=prod -o, --opt map è®¾ç½®é©±åŠ¨çš„ç‰¹å®šé€‰é¡¹ï¼Œæ ¼å¼ä¸º key=valueï¼Œå¤šä¸ªé€‰é¡¹å¯é‡å¤ä½¿ç”¨ -o type=tmpfs -o device=tmpfs ç¤ºä¾‹ 12345678910111213141516171819202122232425262728# åˆ›å»ºä¸€ä¸ªé»˜è®¤å·ï¼ˆlocal é©±åŠ¨ï¼‰docker volume create myvolume# ä¹Ÿå¯ä»¥åœ¨å¯åŠ¨å®¹å™¨çš„æ—¶å€™åˆ›å»ºé»˜è®¤æ•°æ®å·ï¼Œå¦‚ä¸‹å‘½ä»¤ï¼Œè‹¥ myvolume å·ä¸å­˜åœ¨ï¼Œåˆ™ä¼šè‡ªåŠ¨åˆ›å»ºdocker run -d -v myvolume:/data nginxdocker run -d --mount type=volume,source=myvolume,target=/data nginx# åˆ›å»ºä¸€ä¸ªå¸¦æœ‰æ ‡ç­¾çš„å·docker volume create --label env=dev --label team=backend myvolume# åˆ›å»ºåŒ¿åå·ï¼ˆä¸æŒ‡å®šåç§°ï¼‰docker volume create# ä½¿ç”¨ tmpfs ç±»å‹å·ï¼ˆåªå­˜äºå†…å­˜ä¸­ï¼Œä¸è½ç›˜ï¼‰,é€‚ç”¨äºé«˜é€Ÿè¯»å†™ä½†ä¸éœ€è¦æŒä¹…åŒ–çš„æ•°æ®docker volume create \\ -d local \\ # æŒ‡å®šé©±åŠ¨ç¨‹åºä¸º local -o type=tmpfs \\ # æŒ‡å®šåº•å±‚æ–‡ä»¶ç³»ç»Ÿç±»å‹ä¸º tmpfsï¼ˆå†…å­˜æ–‡ä»¶ç³»ç»Ÿï¼‰ -o device=tmpfs \\ # è®¾ç½®æŒ‚è½½è®¾å¤‡ä¸º tmpfsï¼Œç”¨äºä¸ type=tmpfs é…åˆ -o o=size=100m \\ # è®¾ç½® tmpfs çš„æœ€å¤§å®¹é‡ä¸º 100MB mytmpfs # å·çš„åç§°ï¼Œå¯é€šè¿‡ docker volume ls æŸ¥çœ‹# åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰é©±åŠ¨çš„å·ï¼ˆå¦‚ nfsï¼‰docker volume create \\ -d local \\ # é»˜è®¤é©±åŠ¨ç¨‹åºä¸º local -o type=nfs \\ # åº•å±‚æ–‡ä»¶ç³»ç»Ÿç±»å‹ä¸º nfs -o o=addr=192.168.1.100,rw \\ # è®¾ç½® nfs çš„åœ°å€å’Œè¯»å†™æƒé™ï¼Œè‹¥åªè¯»ä¸º ro -o device=:/path/to/share \\ # æŒ‚è½½è®¾å¤‡ä¸º nfsï¼Œæ ¼å¼ä¸ºï¼šnfs://192.168.1.100:/path/to/share mynfs # å·çš„åç§°ï¼Œå¯é€šè¿‡ docker volume ls æŸ¥çœ‹ åˆ›å»ºçš„æ•°æ®å·ä¼šä¿å­˜åœ¨ /var/lib/docker/volumes/ ç›®å½•ä¸‹ï¼Œæ¯”å¦‚æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªå· myvolumeï¼Œé‚£ä¹ˆè¯¥å·ä¼šä¿å­˜åœ¨ /var/lib/docker/volumes/myvolume/_data ç›®å½•ä¸‹ docker volume ls : åˆ—å‡ºæ‰€æœ‰å·²å­˜åœ¨çš„å· 12345678910# åˆ—å‡ºæ‰€æœ‰å·docker volume ls# åˆ—å‡ºæ‰€æœ‰å·çš„IDdocker volume ls -q# åˆ—å‡ºæŒ‡å®šé©±åŠ¨çš„å·docker volume ls -f driver=local# åˆ—å‡ºæŒ‡å®šæ ‡ç­¾çš„å·docker volume ls -f label=env=dev# åˆ—å‡ºæ‰€æœ‰æœªä½¿ç”¨çš„å·ï¼ŒåŒ…æ‹¬åŒ¿åå·å’Œå‘½åå·docker volume ls -f dangling=true docker volume inspect &lt;name&gt; : æŸ¥çœ‹æŒ‡å®šå·çš„è¯¦ç»†ä¿¡æ¯ 123456# åˆ—å‡ºæŒ‡å®šå·çš„è¯¦ç»†ä¿¡æ¯docker volume inspect myvolume# åˆ—å‡ºæŒ‡å®šå·çš„è¯¦ç»†ä¿¡æ¯ï¼Œå¹¶ä½¿ç”¨jsonæ ¼å¼è¾“å‡ºdocker volume inspect -f json myvolume# åˆ—å‡ºæŒ‡å®šå·çš„æŒ‚è½½ç‚¹docker volume inspect myvolume --format &quot;&#123;&#123;.Mountpoint&#125;&#125;&quot; docker volume prune : åˆ é™¤æ‰€æœ‰æœªè¢«å®¹å™¨ä½¿ç”¨çš„å· 123456# åˆ é™¤æ‰€æœ‰æœªè¢«ä½¿ç”¨çš„åŒ¿åæ•°æ®å·ï¼Œä¼šæç¤ºç¡®è®¤docker volume prune# åˆ é™¤æ‰€æœ‰æœªè¢«ä½¿ç”¨çš„æ•°æ®å·ï¼Œä¼šæç¤ºç¡®è®¤docker volume prune -a# åˆ é™¤æ‰€æœ‰æœªè¢«ä½¿ç”¨çš„å·ï¼Œæ— éœ€ç¡®è®¤ç«‹åˆ»åˆ é™¤docker volume prune -a -f åŒ¿åå· vs å‘½åå· åŒ¿åå·ï¼šæ²¡æœ‰åç§°ï¼Œåªåœ¨ docker run -v /container/path æ—¶è‡ªåŠ¨åˆ›å»ºï¼› å‘½åå·ï¼šæœ‰åç§°ï¼Œä¾‹å¦‚ docker run -v mydata:/container/pathï¼› docker volume rm &lt;name&gt; : åˆ é™¤æ•°æ®å· 12345678# åˆ é™¤æŒ‡å®šæ•°æ®å·docker volume rm myvolume# åˆ é™¤æ‰€æœ‰æ•°æ®å·docker volume rm $(docker volume ls -q)# åˆ é™¤æ‰€æœ‰æœªä½¿ç”¨çš„æ•°æ®å·docker volume rm $(docker volume ls -qf dangling=true)# åˆ é™¤æ‰€æœ‰æœªä½¿ç”¨çš„æ•°æ®å·ï¼Œæ— éœ€ç¡®è®¤docker volume rm $(docker volume ls -qf dangling=true) -f","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» Docker å‘½ä»¤ ä¸­ æ•°æ®å·ç®¡ç† ç›¸å…³å‘½ä»¤ Dockerå®˜æ–¹æ–‡æ¡£","date_published":"2025-05-28T13:30:05.000Z","tags":["æŠ€æœ¯","docker","docker"]},{"id":"https://blog.hanqunfeng.com/2025/05/27/docker-command-container/","url":"https://blog.hanqunfeng.com/2025/05/27/docker-command-container/","title":"Docker å‘½ä»¤ ä¹‹ å®¹å™¨(Container)","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç» Docker å‘½ä»¤ ä¸­ å®¹å™¨ç®¡ç† ç›¸å…³å‘½ä»¤</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://docs.docker.com\">Dockerå®˜æ–¹æ–‡æ¡£</a></p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"å®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸ\">å®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸ</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å®¹å™¨å¯èƒ½å¤„äºä»¥ä¸‹å‡ ç§çŠ¶æ€ï¼š</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-5\">åˆå»ºï¼ˆcreatedï¼‰</li>\n<li class=\"lvl-5\">è¿è¡Œï¼ˆrunningï¼‰</li>\n<li class=\"lvl-5\">æš‚åœï¼ˆpausedï¼‰</li>\n<li class=\"lvl-5\">åœæ­¢ï¼ˆstoppedï¼‰</li>\n<li class=\"lvl-5\">åˆ é™¤ï¼ˆdeletedï¼‰</li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<p>å„ç”Ÿå‘½å‘¨æœŸä¹‹é—´çš„è½¬æ¢å…³ç³»å¦‚å›¾æ‰€ç¤ºï¼š<br>\n<img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/uPic/19n9NJ.png\" alt=\"\"></p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>å‘½ä»¤/æƒ…å†µ</th>\n<th>è¯´æ˜</th>\n<th>å®¹å™¨çŠ¶æ€å˜æ›´</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>docker create</code></td>\n<td>åˆ›å»ºå®¹å™¨åï¼Œä¸ç«‹å³å¯åŠ¨è¿è¡Œï¼Œå®¹å™¨è¿›å…¥åˆå»ºçŠ¶æ€</td>\n<td>åˆå»ºçŠ¶æ€</td>\n</tr>\n<tr>\n<td><code>docker run</code></td>\n<td>åˆ›å»ºå®¹å™¨ï¼Œå¹¶ç«‹å³å¯åŠ¨è¿è¡Œï¼Œè¿›å…¥è¿è¡ŒçŠ¶æ€</td>\n<td>åˆå»º â†’ è¿è¡Œ</td>\n</tr>\n<tr>\n<td><code>docker start</code></td>\n<td>å¯åŠ¨å·²åˆ›å»ºçš„å®¹å™¨ï¼Œå®¹å™¨è½¬ä¸ºè¿è¡ŒçŠ¶æ€</td>\n<td>åœæ­¢ â†’ è¿è¡Œ</td>\n</tr>\n<tr>\n<td><code>docker stop</code></td>\n<td>åœæ­¢æ­£åœ¨è¿è¡Œçš„å®¹å™¨ï¼Œå®¹å™¨è½¬å…¥åœæ­¢çŠ¶æ€</td>\n<td>è¿è¡Œ â†’ åœæ­¢</td>\n</tr>\n<tr>\n<td><code>docker kill</code></td>\n<td>å¼ºåˆ¶ç»ˆæ­¢å®¹å™¨ï¼Œç›¸å½“äºâ€œæ–­ç”µâ€ï¼Œå®¹æ˜“ä¸¢å¤±æ•°æ®ï¼Œä¸å»ºè®®è½»æ˜“ä½¿ç”¨</td>\n<td>è¿è¡Œ â†’ åœæ­¢ï¼ˆéæ­£å¸¸ï¼‰</td>\n</tr>\n<tr>\n<td><code>docker restart</code></td>\n<td>é‡å¯å®¹å™¨ï¼Œå®¹å™¨é‡æ–°è¿›å…¥è¿è¡ŒçŠ¶æ€</td>\n<td>è¿è¡Œ â†’ åœæ­¢ â†’ è¿è¡Œ</td>\n</tr>\n<tr>\n<td><code>docker pause</code></td>\n<td>æš‚åœå®¹å™¨å†…æ‰€æœ‰è¿›ç¨‹ï¼Œå®¹å™¨è¿›å…¥æš‚åœçŠ¶æ€</td>\n<td>è¿è¡Œ â†’ æš‚åœ</td>\n</tr>\n<tr>\n<td><code>docker unpause</code></td>\n<td>å–æ¶ˆæš‚åœçŠ¶æ€ï¼Œå®¹å™¨æ¢å¤è¿è¡Œ</td>\n<td>æš‚åœ â†’ è¿è¡Œ</td>\n</tr>\n<tr>\n<td><code>docker rm</code></td>\n<td>åˆ é™¤å®¹å™¨ï¼Œå®¹å™¨è½¬å…¥åˆ é™¤çŠ¶æ€</td>\n<td>ä»»æ„ â†’ åˆ é™¤</td>\n</tr>\n<tr>\n<td>Killed by out-of-memory (OOM)</td>\n<td>å®¿ä¸»æœºå†…å­˜è€—å°½ï¼Œå®¹å™¨è¢«ç³»ç»Ÿç»ˆæ­¢ï¼Œæ­¤ä¸ºéè®¡åˆ’ç»ˆæ­¢ï¼›å»ºè®®æ€æ­»å†…å­˜å ç”¨æœ€é«˜çš„å®¹å™¨</td>\n<td>è¿è¡Œ â†’ åœæ­¢ï¼ˆå¼‚å¸¸ï¼‰</td>\n</tr>\n<tr>\n<td>Container process exited</td>\n<td>å®¹å™¨è¿›ç¨‹å¼‚å¸¸ç»ˆæ­¢åï¼Œè¿›å…¥â€œæ˜¯å¦é‡å¯â€åˆ¤æ–­æµç¨‹ï¼šæ˜¯åˆ™æ‰§è¡Œ <code>start</code> è¿›å…¥è¿è¡Œï¼›å¦åˆ™ä¿æŒåœæ­¢çŠ¶æ€</td>\n<td>å¼‚å¸¸ â†’ åœæ­¢æˆ–è¿è¡Œ</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"docker-container-å®¹å™¨ç®¡ç†\"><code>docker container</code> : å®¹å™¨ç®¡ç†</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><code>docker container --help</code></p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>å‘½ä»¤</th>\n<th>è¯´æ˜</th>\n<th>åˆ«å</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>attach</td>\n<td>å°†æœ¬åœ°çš„æ ‡å‡†è¾“å…¥ã€è¾“å‡ºå’Œé”™è¯¯æµé™„åŠ åˆ°ä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„å®¹å™¨ä¸Š</td>\n<td>docker attach</td>\n</tr>\n<tr>\n<td>commit</td>\n<td>æ ¹æ®å®¹å™¨çš„æ›´æ”¹åˆ›å»ºä¸€ä¸ªæ–°çš„é•œåƒ</td>\n<td>docker commit</td>\n</tr>\n<tr>\n<td>cp</td>\n<td>åœ¨å®¹å™¨å’Œæœ¬åœ°æ–‡ä»¶ç³»ç»Ÿä¹‹é—´å¤åˆ¶æ–‡ä»¶/æ–‡ä»¶å¤¹</td>\n<td>docker cp</td>\n</tr>\n<tr>\n<td>create</td>\n<td>åˆ›å»ºä¸€ä¸ªæ–°çš„å®¹å™¨</td>\n<td>docker create</td>\n</tr>\n<tr>\n<td>diff</td>\n<td>æ£€æŸ¥å®¹å™¨æ–‡ä»¶ç³»ç»Ÿä¸Šçš„æ–‡ä»¶æˆ–ç›®å½•çš„æ›´æ”¹</td>\n<td>docker diff</td>\n</tr>\n<tr>\n<td>exec</td>\n<td>åœ¨æ­£åœ¨è¿è¡Œçš„å®¹å™¨ä¸­æ‰§è¡Œå‘½ä»¤</td>\n<td>docker exec</td>\n</tr>\n<tr>\n<td>export</td>\n<td>å°†å®¹å™¨çš„æ–‡ä»¶ç³»ç»Ÿå¯¼å‡ºä¸º tar å½’æ¡£æ–‡ä»¶</td>\n<td>docker export</td>\n</tr>\n<tr>\n<td>inspect</td>\n<td>æ˜¾ç¤ºä¸€ä¸ªæˆ–å¤šä¸ªå®¹å™¨çš„è¯¦ç»†ä¿¡æ¯</td>\n<td>å¯ä»¥ä½¿ç”¨ <code>docker inspect</code></td>\n</tr>\n<tr>\n<td>kill</td>\n<td>ç»ˆæ­¢ä¸€ä¸ªæˆ–å¤šä¸ªæ­£åœ¨è¿è¡Œçš„å®¹å™¨</td>\n<td>docker kill</td>\n</tr>\n<tr>\n<td>logs</td>\n<td>è·å–å®¹å™¨çš„æ—¥å¿—</td>\n<td>docker logs</td>\n</tr>\n<tr>\n<td>ls</td>\n<td>åˆ—å‡ºå®¹å™¨</td>\n<td>docker ps</td>\n</tr>\n<tr>\n<td>pause</td>\n<td>æš‚åœä¸€ä¸ªæˆ–å¤šä¸ªå®¹å™¨å†…çš„æ‰€æœ‰è¿›ç¨‹</td>\n<td>docker pause</td>\n</tr>\n<tr>\n<td>port</td>\n<td>åˆ—å‡ºå®¹å™¨çš„ç«¯å£æ˜ å°„æˆ–ç‰¹å®šçš„ç«¯å£æ˜ å°„</td>\n<td>docker port</td>\n</tr>\n<tr>\n<td>prune</td>\n<td>åˆ é™¤æ‰€æœ‰å·²åœæ­¢çš„å®¹å™¨</td>\n<td></td>\n</tr>\n<tr>\n<td>rename</td>\n<td>é‡å‘½åä¸€ä¸ªå®¹å™¨</td>\n<td>docker rename</td>\n</tr>\n<tr>\n<td>restart</td>\n<td>é‡å¯ä¸€ä¸ªæˆ–å¤šä¸ªå®¹å™¨</td>\n<td>docker restart</td>\n</tr>\n<tr>\n<td>rm</td>\n<td>åˆ é™¤ä¸€ä¸ªæˆ–å¤šä¸ªå®¹å™¨</td>\n<td>docker rm</td>\n</tr>\n<tr>\n<td>run</td>\n<td>æ ¹æ®é•œåƒåˆ›å»ºå¹¶è¿è¡Œä¸€ä¸ªæ–°å®¹å™¨</td>\n<td>docker run</td>\n</tr>\n<tr>\n<td>start</td>\n<td>å¯åŠ¨ä¸€ä¸ªæˆ–å¤šä¸ªå·²åœæ­¢çš„å®¹å™¨</td>\n<td>docker start</td>\n</tr>\n<tr>\n<td>stats</td>\n<td>å®æ—¶æ˜¾ç¤ºå®¹å™¨èµ„æºä½¿ç”¨ç»Ÿè®¡ä¿¡æ¯</td>\n<td>docker stats</td>\n</tr>\n<tr>\n<td>stop</td>\n<td>åœæ­¢ä¸€ä¸ªæˆ–å¤šä¸ªæ­£åœ¨è¿è¡Œçš„å®¹å™¨</td>\n<td>docker stop</td>\n</tr>\n<tr>\n<td>top</td>\n<td>æ˜¾ç¤ºå®¹å™¨ä¸­è¿è¡Œçš„è¿›ç¨‹</td>\n<td>docker top</td>\n</tr>\n<tr>\n<td>unpause</td>\n<td>å–æ¶ˆæš‚åœä¸€ä¸ªæˆ–å¤šä¸ªå®¹å™¨å†…çš„æ‰€æœ‰è¿›ç¨‹</td>\n<td>docker unpause</td>\n</tr>\n<tr>\n<td>update</td>\n<td>æ›´æ–°ä¸€ä¸ªæˆ–å¤šä¸ªå®¹å™¨çš„é…ç½®</td>\n<td>docker update</td>\n</tr>\n<tr>\n<td>wait</td>\n<td>é˜»å¡ç›´åˆ°ä¸€ä¸ªæˆ–å¤šä¸ªå®¹å™¨åœæ­¢ï¼Œç„¶åæ‰“å°å…¶é€€å‡ºä»£ç </td>\n<td>docker wait</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¿è¡Œ <code>docker container COMMAND --help</code> å¯è·å–æŸä¸ªå‘½ä»¤çš„æ›´å¤šä¿¡æ¯ã€‚</p>\n</li>\n</ul>\n<h3 id=\"docker-create-åˆ›å»ºå®¹å™¨ï¼Œä½†ä¸å¯åŠ¨\"><code>docker create</code> : åˆ›å»ºå®¹å™¨ï¼Œä½†ä¸å¯åŠ¨</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ docker create \\</span><br><span class=\"line\">    --name my-container \\ <span class=\"comment\"># å®¹å™¨å</span></span><br><span class=\"line\">    -e MY_ENV_VAR=my-value \\ <span class=\"comment\"># è®¾ç½®ç¯å¢ƒå˜é‡</span></span><br><span class=\"line\">    -p 80:80 \\ <span class=\"comment\"># æ˜ å°„ç«¯å£ï¼Œæ ¼å¼ï¼šå®¿ä¸»æœºç«¯å£:å®¹å™¨ç«¯å£</span></span><br><span class=\"line\">    -v /path/to/my/dir:/path/in/container \\ <span class=\"comment\"># æ˜ å°„ç›®å½•ï¼Œæ ¼å¼ï¼šå®¿ä¸»æœºç›®å½•:å®¹å™¨ç›®å½•ï¼Œéƒ½å¿…é¡»æ˜¯ç»å¯¹è·¯å¾„</span></span><br><span class=\"line\">    --restart always \\ <span class=\"comment\"># è®¾ç½®é‡å¯ç­–ç•¥</span></span><br><span class=\"line\">    nginx:latest \\ <span class=\"comment\"># é•œåƒåï¼Œé•œåƒä¸å­˜åœ¨æ—¶ä¼šè‡ªåŠ¨ä¸‹è½½</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><code>docker create</code> ä¸ <code>docker run</code> çš„å‚æ•°åŸºæœ¬ä¸€è‡´ï¼Œå…·ä½“æŸ¥çœ‹ä¸‹é¢ <code>docker run</code> ä¸­çš„ä»‹ç»ã€‚</p>\n</li>\n</ul>\n<h3 id=\"docker-start-å¯åŠ¨ä¸€ä¸ªå®¹å™¨\"><code>docker start</code> : å¯åŠ¨ä¸€ä¸ªå®¹å™¨</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¯åŠ¨ä¸€ä¸ªå®¹å™¨ï¼Œå®¹å™¨å¿…é¡»å·²ç»åˆ›å»ºï¼Œå¹¶ä¸”å¤„äºåœæ­¢çŠ¶æ€ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># è¯­æ³•ï¼šdocker start &lt;container_id|container_name&gt;</span></span><br><span class=\"line\">$ docker start my-container</span><br></pre></td></tr></table></figure>\n<h3 id=\"docker-run-åˆ›å»ºå¹¶å¯åŠ¨ä¸€ä¸ªå®¹å™¨\"><code>docker run</code> : åˆ›å»ºå¹¶å¯åŠ¨ä¸€ä¸ªå®¹å™¨</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç›¸å½“äº<code>docker create</code> + <code>docker start</code></p>\n</li>\n<li class=\"lvl-2\">\n<p>å¸¸ç”¨å‚æ•°è¯´æ˜</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>å‚æ•°</th>\n<th>è¯´æ˜</th>\n<th>ç¤ºä¾‹</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>-d</code>, <code>--detach</code></td>\n<td>åå°è¿è¡Œå®¹å™¨ï¼ˆå³â€œå®ˆæŠ¤æ€â€ï¼‰ï¼Œ<code>run</code>ç‹¬æœ‰</td>\n<td><code>docker run -d nginx</code></td>\n</tr>\n<tr>\n<td><code>-it</code></td>\n<td>äº¤äº’å¼è¿è¡Œå®¹å™¨å¹¶åˆ†é…ç»ˆç«¯ï¼ˆå¸¸ç”¨äºè°ƒè¯•ï¼‰</td>\n<td><code>docker run -it ubuntu bash</code></td>\n</tr>\n<tr>\n<td><code>--name</code></td>\n<td>æŒ‡å®šå®¹å™¨åç§°</td>\n<td><code>docker run --name my-nginx nginx</code></td>\n</tr>\n<tr>\n<td><code>--rm</code></td>\n<td>å®¹å™¨é€€å‡ºæ—¶è‡ªåŠ¨åˆ é™¤</td>\n<td><code>docker run --rm ubuntu</code></td>\n</tr>\n<tr>\n<td><code>-p</code>, <code>--publish</code></td>\n<td>ç«¯å£æ˜ å°„ï¼ˆå®¿ä¸»æœº:å®¹å™¨ï¼‰</td>\n<td><code>docker run -p 8080:80 nginx</code></td>\n</tr>\n<tr>\n<td><code>-P</code>, <code>--publish-all</code></td>\n<td>è‡ªåŠ¨éšæœºæ˜ å°„å®¹å™¨å†…éƒ¨æ‰€æœ‰æš´éœ²ç«¯å£åˆ°å®¿ä¸»æœºç«¯å£</td>\n<td><code>docker run -P nginx</code></td>\n</tr>\n<tr>\n<td><code>-v</code>, <code>--volume</code></td>\n<td>æŒ‚è½½å·ï¼ˆå®¿ä¸»æœºç›®å½•:å®¹å™¨ç›®å½•ï¼‰</td>\n<td><code>docker run -v /data:/app/data myapp</code></td>\n</tr>\n<tr>\n<td><code>--mount</code></td>\n<td>æ›´çµæ´»çš„æŒ‚è½½æ–¹å¼ï¼ˆæ¨èæ–°é¡¹ç›®ä½¿ç”¨ï¼‰</td>\n<td><code>docker run --mount type=bind,source=/host,target=/container nginx</code></td>\n</tr>\n<tr>\n<td><code>--env</code>, <code>-e</code></td>\n<td>è®¾ç½®ç¯å¢ƒå˜é‡</td>\n<td><code>docker run -e ENV=prod myapp</code></td>\n</tr>\n<tr>\n<td><code>--env-file</code></td>\n<td>ä»æ–‡ä»¶ä¸­åŠ è½½å¤šä¸ªç¯å¢ƒå˜é‡</td>\n<td><code>docker run --env-file .env myapp</code></td>\n</tr>\n<tr>\n<td><code>--network</code></td>\n<td>è®¾ç½®å®¹å™¨ä½¿ç”¨çš„ç½‘ç»œæ¨¡å¼</td>\n<td><code>docker run --network host myapp</code></td>\n</tr>\n<tr>\n<td><code>--restart</code></td>\n<td>è®¾ç½®å®¹å™¨çš„è‡ªåŠ¨é‡å¯ç­–ç•¥</td>\n<td><code>docker run --restart=always myapp</code></td>\n</tr>\n<tr>\n<td><code>--privileged</code></td>\n<td>ç»™äºˆå®¹å™¨æ›´å¤šçš„æƒé™ï¼ˆå¦‚è®¿é—® host è®¾å¤‡ï¼‰</td>\n<td><code>docker run --privileged myapp</code></td>\n</tr>\n<tr>\n<td><code>--entrypoint</code></td>\n<td>è¦†ç›–é•œåƒé»˜è®¤çš„ ENTRYPOINT</td>\n<td><code>docker run --entrypoint /bin/bash myapp</code></td>\n</tr>\n<tr>\n<td><code>-u</code>, <code>--user</code></td>\n<td>æŒ‡å®šå®¹å™¨å†…è¿è¡Œçš„ç”¨æˆ·ï¼ˆæ ¼å¼ï¼šUID æˆ– UID:GIDï¼‰</td>\n<td><code>docker run --user 1000:1000 myapp</code></td>\n</tr>\n<tr>\n<td><code>-c</code>, <code>--cpu-shares</code></td>\n<td>è®¾ç½® CPU æƒé‡ï¼ˆç›¸å¯¹å€¼ï¼‰</td>\n<td><code>docker run --cpu-shares=512 myapp</code></td>\n</tr>\n<tr>\n<td><code>-m</code>, <code>--memory</code></td>\n<td>é™åˆ¶å®¹å™¨æœ€å¤§å†…å­˜ï¼ˆå¦‚ <code>512m</code>, <code>1g</code>ï¼‰</td>\n<td><code>docker run --memory=512m myapp</code></td>\n</tr>\n<tr>\n<td><code>-h</code>,<code> --hostname</code></td>\n<td>è®¾ç½®å®¹å™¨ä¸»æœºå</td>\n<td><code>docker run -h myhost myapp</code></td>\n</tr>\n<tr>\n<td><code>--link</code>(æ›´æ¨èä½¿ç”¨ <code>--network</code>)</td>\n<td>åˆ›å»ºé“¾æ¥åˆ°å…¶ä»–å®¹å™¨</td>\n<td><code>docker run --link myapp:app myapp2</code></td>\n</tr>\n<tr>\n<td><code>--cpus</code></td>\n<td>é™åˆ¶å®¹å™¨ä½¿ç”¨çš„CPUæ ¸æ•°</td>\n<td><code>docker run --cpus=&quot;1.5&quot;</code></td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><code>-p</code>, <code>--publish</code> ç«¯å£æ˜ å°„</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker run -p [ä¸»æœºIP:]ä¸»æœºç«¯å£:å®¹å™¨ç«¯å£[/åè®®]</span><br></pre></td></tr></table></figure>\n<table>\n<thead>\n<tr>\n<th>ç¤ºä¾‹</th>\n<th>å«ä¹‰è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>-p 8080:80</code></td>\n<td>å°†ä¸»æœºçš„ 8080 ç«¯å£æ˜ å°„åˆ°å®¹å™¨çš„ 80 ç«¯å£ï¼ˆé»˜è®¤ TCPï¼‰</td>\n</tr>\n<tr>\n<td><code>-p 127.0.0.1:8080:80</code></td>\n<td>ä»…å°†ä¸»æœºæœ¬åœ° IPï¼ˆ127.0.0.1ï¼‰çš„ 8080 æ˜ å°„åˆ°å®¹å™¨çš„ 80 ç«¯å£ï¼ˆå¤–éƒ¨æ— æ³•è®¿é—®ï¼‰</td>\n</tr>\n<tr>\n<td><code>-p 8080:80/tcp</code></td>\n<td>æ˜¾å¼æŒ‡å®šåè®®ä¸º TCPï¼ˆç­‰åŒäºä¸åŠ  <code>/tcp</code>ï¼‰</td>\n</tr>\n<tr>\n<td><code>-p 8080:80/udp</code></td>\n<td>æ˜ å°„ UDP åè®®ç«¯å£ï¼ˆå¦‚ DNS æœåŠ¡ç­‰ï¼‰</td>\n</tr>\n<tr>\n<td><code>-p 8080</code></td>\n<td>å®¿ä¸»æœºéšæœºç«¯å£æ˜ å°„åˆ°å®¹å™¨çš„8080ç«¯å£</td>\n</tr>\n<tr>\n<td><code>-p 3000-3006:4000-4006</code></td>\n<td><strong>èŒƒå›´æ˜ å°„</strong>ï¼Œä¸èƒ½æ˜ å°„éå¯¹ç§°èŒƒå›´ï¼ˆå¦‚ 3000-3006:4000-4006ï¼‰ï¼Œåªèƒ½ä¸€ä¸€å¯¹åº”</td>\n</tr>\n<tr>\n<td>å¤šä¸ª <code>-p</code></td>\n<td>å¯ä»¥å¤šæ¬¡ä½¿ç”¨ <code>-p</code>ï¼Œæ˜ å°„å¤šä¸ªç«¯å£ã€‚ä¾‹å¦‚ï¼š<code>-p 80:80 -p 443:443</code></td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><code>-v, --volume</code> æ•°æ®å·æ˜ å°„</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker run -v &lt;æœ¬åœ°è·¯å¾„&gt;:&lt;å®¹å™¨è·¯å¾„&gt;[:æƒé™]</span><br><span class=\"line\">  <span class=\"comment\"># &lt;æœ¬åœ°è·¯å¾„&gt;\tä¸»æœºä¸Šçš„è·¯å¾„ï¼ˆç»å¯¹è·¯å¾„ï¼Œæˆ–å‘½åå·ï¼‰ï¼Œç›®å½•ä¸å­˜åœ¨ä¼šè‡ªåŠ¨åˆ›å»º</span></span><br><span class=\"line\">  <span class=\"comment\"># &lt;å®¹å™¨è·¯å¾„&gt;\tå®¹å™¨å†…çš„è·¯å¾„ï¼Œç›®å½•ä¸å­˜åœ¨ä¼šè‡ªåŠ¨åˆ›å»º</span></span><br><span class=\"line\">  <span class=\"comment\"># [:æƒé™]\tå¯é€‰ï¼šroï¼ˆåªè¯»ï¼‰ æˆ– rwï¼ˆè¯»å†™ï¼Œé»˜è®¤ï¼‰</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ç¤ºä¾‹</span></span><br><span class=\"line\"><span class=\"comment\"># æŒ‚è½½æœ¬åœ°ç›®å½•åˆ°å®¹å™¨</span></span><br><span class=\"line\">docker run -v /data:/app/data myapp</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŒ‚è½½ä¸ºåªè¯»</span></span><br><span class=\"line\">docker run -v /data:/app/data:ro myapp</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŒ‚è½½å¤šä¸ªæ•°æ®å·</span></span><br><span class=\"line\">docker run -v /data1:/app/data1 -v /data2:/app/data2 myapp</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ä½¿ç”¨å‘½åå·</span></span><br><span class=\"line\">docker volume create mydata</span><br><span class=\"line\">docker run -v mydata:/app/data myapp</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><code>--mount</code> æŒ‚è½½å·</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># --mount æ˜¯ Docker æ¨èä½¿ç”¨çš„ ç°ä»£æŒ‚è½½æ–¹å¼ï¼ŒåŠŸèƒ½å’Œ -vï¼ˆæˆ– --volumeï¼‰ç±»ä¼¼ï¼Œä½†è¯­æ³•æ›´æ¸…æ™°ã€ç»“æ„æ›´è§„èŒƒï¼Œé€‚ç”¨äºå·ï¼ˆvolumeï¼‰ã€ç»‘å®šæŒ‚è½½ï¼ˆbindï¼‰å’Œä¸´æ—¶æŒ‚è½½ï¼ˆtmpfsï¼‰ã€‚</span></span><br><span class=\"line\">docker run --mount <span class=\"built_in\">type</span>=&lt;ç±»å‹&gt;,<span class=\"built_in\">source</span>=&lt;ä¸»æœºè·¯å¾„æˆ–å·å&gt;,target=&lt;å®¹å™¨è·¯å¾„&gt;[,<span class=\"built_in\">readonly</span>]</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>ä¸‰ç§æŒ‚è½½ç±»å‹å¯¹æ¯”</p>\n</blockquote>\n<table>\n<thead>\n<tr>\n<th>ç±»å‹ (<code>type</code>)</th>\n<th>ç”¨é€”</th>\n<th>ç¤ºä¾‹ <code>source</code></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>volume</code></td>\n<td>ä½¿ç”¨ Docker ç®¡ç†çš„å·</td>\n<td>å·åï¼Œå¦‚ <code>mydata</code></td>\n</tr>\n<tr>\n<td><code>bind</code></td>\n<td>æŒ‚è½½å®¿ä¸»æœºçš„å®é™…è·¯å¾„</td>\n<td>ç»å¯¹è·¯å¾„ï¼Œå¦‚ <code>/home/user/app/config</code></td>\n</tr>\n<tr>\n<td><code>tmpfs</code></td>\n<td>æŒ‚è½½å†…å­˜ä¸­çš„ä¸´æ—¶æ–‡ä»¶ç³»ç»Ÿ</td>\n<td>æ— éœ€æŒ‡å®š <code>source</code></td>\n</tr>\n</tbody>\n</table>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ä½¿ç”¨å‘½åå·æŒ‚è½½ï¼ˆæ¨èæ–¹å¼ï¼‰,è¿™é‡Œ --target æŒ‡å®šå®¹å™¨å†…çš„æŒ‚è½½ç‚¹ï¼Œä¹Ÿå¯ä»¥æ›¿æ¢ä¸º --destination</span></span><br><span class=\"line\">docker run --mount <span class=\"built_in\">type</span>=volume,<span class=\"built_in\">source</span>=mydata,target=/app/data myapp</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ä½¿ç”¨æœ¬åœ°è·¯å¾„æŒ‚è½½ï¼ˆç»‘å®šæŒ‚è½½ï¼‰,sourceæŒ‡å®šçš„æœ¬åœ°è·¯å¾„å¿…é¡»å­˜åœ¨</span></span><br><span class=\"line\">docker run --mount <span class=\"built_in\">type</span>=<span class=\"built_in\">bind</span>,<span class=\"built_in\">source</span>=/home/user/app/config,target=/app/config myapp</span><br><span class=\"line\"><span class=\"comment\"># åªè¯»æŒ‚è½½ï¼Œreadonly å¯ä»¥ç®€å†™ä¸º ro</span></span><br><span class=\"line\">docker run --mount <span class=\"built_in\">type</span>=<span class=\"built_in\">bind</span>,<span class=\"built_in\">source</span>=/home/user/app/config,target=/app/config,<span class=\"built_in\">readonly</span> myapp</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ä½¿ç”¨å†…å­˜ä¸­çš„ä¸´æ—¶æ–‡ä»¶ç³»ç»ŸæŒ‚è½½ï¼Œæ•°æ®ä¸ä¼šæŒä¹…åŒ–ï¼Œåªå­˜å‚¨åœ¨å®¹å™¨è¿è¡Œæ—¶çš„å†…å­˜ä¸­</span></span><br><span class=\"line\">docker run --mount <span class=\"built_in\">type</span>=tmpfs,target=/app/tmpfs myapp</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><code>--link</code> å®¹å™¨é—´é“¾æ¥</p>\n</li>\n</ul>\n<blockquote>\n<p>ç”¨äºåœ¨å®¹å™¨ä¹‹é—´å»ºç«‹è¿æ¥ï¼Œä½¿ä¸€ä¸ªå®¹å™¨å¯ä»¥é€šè¿‡å¦ä¸€ä¸ªå®¹å™¨çš„åç§°è®¿é—®å…¶ç½‘ç»œä¿¡æ¯ï¼ˆå¦‚ IPã€ç¯å¢ƒå˜é‡ç­‰ï¼‰ã€‚<br>\næ³¨æ„ï¼š<code>--link</code> å·²è¢«å¼ƒç”¨ï¼Œå»ºè®®ä½¿ç”¨ <code>--network</code> æ¥å®ç°å®¹å™¨é—´é“¾æ¥ã€‚</p>\n</blockquote>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker run --<span class=\"built_in\">link</span> &lt;ç›®æ ‡å®¹å™¨å&gt;:&lt;åˆ«å&gt; &lt;å…¶ä»–å‚æ•°&gt; &lt;é•œåƒå&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">## ç¤ºä¾‹</span></span><br><span class=\"line\"><span class=\"comment\"># åœºæ™¯ï¼šä¸€ä¸ª web å®¹å™¨æƒ³è¦è¿æ¥å¦ä¸€ä¸ªè¿è¡Œä¸­çš„ db å®¹å™¨</span></span><br><span class=\"line\"><span class=\"comment\"># å…ˆå¯åŠ¨æ•°æ®åº“å®¹å™¨</span></span><br><span class=\"line\">docker run -d --name db mysql</span><br><span class=\"line\"><span class=\"comment\"># å¯åŠ¨ web å®¹å™¨å¹¶è¿æ¥åˆ° db å®¹å™¨</span></span><br><span class=\"line\">docker run -it --<span class=\"built_in\">rm</span> --name web --<span class=\"built_in\">link</span> db:mydb ubuntu bash</span><br><span class=\"line\"><span class=\"comment\"># åœ¨ web å®¹å™¨ä¸­ï¼Œç°åœ¨ä½ å¯ä»¥ç”¨ mydb æ¥è®¿é—® db å®¹å™¨ï¼Œä½†åè¿‡æ¥ db å®¹å™¨æ— æ³•è®¿é—® web å®¹å™¨</span></span><br><span class=\"line\">docker <span class=\"built_in\">exec</span> web ping mydb</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">## æ”¹ç”¨ --network å®ç°</span></span><br><span class=\"line\">docker network create mynet</span><br><span class=\"line\">docker run -d --name db --network mynet mysql</span><br><span class=\"line\">docker run -it --<span class=\"built_in\">rm</span> --name web --network mynet ubuntu bash</span><br><span class=\"line\">docker <span class=\"built_in\">exec</span> web ping db</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><code>--network</code> ç½‘ç»œæ¨¡å¼ç±»å‹</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>ç±»å‹</th>\n<th>å«ä¹‰</th>\n<th>ç‰¹ç‚¹/é€‚ç”¨åœºæ™¯</th>\n<th>æ˜¯å¦å…è®¸ç«¯å£æ˜ å°„</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>bridge</code></td>\n<td>é»˜è®¤ç½‘ç»œç±»å‹ï¼ˆç”¨æˆ·è‡ªå®šä¹‰æˆ– Docker é»˜è®¤æ¡¥æ¥ç½‘ç»œï¼‰</td>\n<td>å®¹å™¨é€šè¿‡è™šæ‹Ÿç½‘æ¡¥è¿æ¥ï¼Œå¯ç›¸äº’é€šä¿¡ï¼›é€‚ç”¨äºå•ä¸»æœºéƒ¨ç½²</td>\n<td>âœ… æ˜¯</td>\n</tr>\n<tr>\n<td><code>host</code></td>\n<td>å®¹å™¨ä¸å®¿ä¸»æœºå…±äº«ç½‘ç»œæ ˆ</td>\n<td>æ²¡æœ‰ç½‘ç»œéš”ç¦»ï¼Œå®¹å™¨ä½¿ç”¨å®¿ä¸»æœºçš„ IP å’Œç«¯å£ï¼Œæ€§èƒ½é«˜ï¼Œé€‚åˆå¯¹ç½‘ç»œè¦æ±‚é«˜çš„æœåŠ¡</td>\n<td>âŒ å¦</td>\n</tr>\n<tr>\n<td><code>none</code></td>\n<td>å®¹å™¨æ²¡æœ‰ç½‘ç»œæ¥å£</td>\n<td>å®Œå…¨éš”ç¦»ï¼›é€‚ç”¨äºéœ€è¦å®Œå…¨æ§åˆ¶ç½‘ç»œçš„åœºæ™¯æˆ–æµ‹è¯•ç½‘ç»œä¸å¯è¾¾æ€§</td>\n<td>âŒ å¦</td>\n</tr>\n<tr>\n<td><code>&lt;user-defined&gt;</code></td>\n<td>ç”¨æˆ·è‡ªå®šä¹‰çš„ç½‘ç»œåç§°ï¼Œé€šè¿‡ <code>docker network create</code> åˆ›å»º</td>\n<td>æ”¯æŒå®¹å™¨åç§°äº’è§£æï¼ˆDNSï¼‰ï¼Œé€‚åˆå¤šå®¹å™¨é€šä¿¡åœºæ™¯ï¼Œå¦‚ Docker Compose</td>\n<td>âœ… æ˜¯</td>\n</tr>\n<tr>\n<td><code>container:&lt;name|id&gt;</code></td>\n<td>ä¸å¦ä¸€ä¸ªå®¹å™¨å…±äº«ç½‘ç»œå‘½åç©ºé—´</td>\n<td>ä¸¤ä¸ªå®¹å™¨å…±äº« IP å’Œç«¯å£ï¼Œé€‚ç”¨äºä¸»-è¾…å®¹å™¨æ¨¡å¼ï¼Œå¦‚ sidecar å®¹å™¨å…±äº«ä¸»å®¹å™¨ç½‘ç»œ</td>\n<td>âŒ å¦</td>\n</tr>\n</tbody>\n</table>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ä½¿ç”¨é»˜è®¤ bridge ç½‘ç»œ</span></span><br><span class=\"line\">docker run -p 8080:80 --network bridge --name my-nginx nginx</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ä¸å®¿ä¸»æœºå…±äº«ç½‘ç»œï¼Œä¸èƒ½ä½¿ç”¨-p</span></span><br><span class=\"line\">docker run --network host nginx</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ä¸ä½¿ç”¨ä»»ä½•ç½‘ç»œï¼Œä¸èƒ½ä½¿ç”¨-p</span></span><br><span class=\"line\">docker run --network none nginx</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ä½¿ç”¨å·²åˆ›å»ºçš„è‡ªå®šä¹‰ç½‘ç»œï¼Œç›¸åŒç½‘ç»œå‘½åç©ºé—´ä¸‹çš„å®¹å™¨ï¼Œå¯ä»¥é€šè¿‡å®¹å™¨ åç§°æˆ–ID äº’ç›¸è®¿é—®</span></span><br><span class=\"line\">docker network create nginx_net</span><br><span class=\"line\">docker run -p 8080:80 --network nginx_net nginx</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ä¸å¦ä¸€ä¸ªå®¹å™¨å…±äº«ç½‘ç»œå‘½åç©ºé—´ï¼Œä¸èƒ½ä½¿ç”¨-pï¼Œå¹¶ä¸”æ­¤æ—¶æ–°å¯åŠ¨çš„å®¹å™¨å ç”¨çš„ç«¯å£ä¸èƒ½ä¸è¦è¿æ¥çš„å®¹å™¨ç«¯å£ä¸€è‡´ï¼Œå¦åˆ™å°†å¯åŠ¨å¤±è´¥</span></span><br><span class=\"line\">docker run --network container:my-nginx busybox</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><code>--restart</code> é‡å¯ç­–ç•¥</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>ç­–ç•¥</th>\n<th>å«ä¹‰</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>no</code>ï¼ˆé»˜è®¤ï¼‰</td>\n<td>å®¹å™¨é€€å‡ºåä¸ä¼šè‡ªåŠ¨é‡å¯</td>\n</tr>\n<tr>\n<td><code>always</code></td>\n<td>æ— è®ºé€€å‡ºçŠ¶æ€ç å¦‚ä½•ï¼Œå®¹å™¨æ€»æ˜¯è‡ªåŠ¨é‡å¯</td>\n</tr>\n<tr>\n<td><code>unless-stopped</code></td>\n<td>å®¹å™¨æ€»æ˜¯è‡ªåŠ¨é‡å¯ï¼Œé™¤éç”¨æˆ·æ‰‹åŠ¨åœæ­¢å®ƒ</td>\n</tr>\n<tr>\n<td><code>on-failure[:N]</code></td>\n<td>ä»…åœ¨å®¹å™¨é 0 çŠ¶æ€ç é€€å‡ºæ—¶è‡ªåŠ¨é‡å¯ï¼ˆå¯é€‰è®¾ç½®æœ€å¤§é‡å¯æ¬¡æ•° Nï¼‰</td>\n</tr>\n</tbody>\n</table>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å®¹å™¨éæ­£å¸¸é€€å‡ºæ—¶è‡ªåŠ¨é‡å¯</span></span><br><span class=\"line\">docker run --restart on-failure my-app</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æœ€å¤šé‡å¯ 5 æ¬¡</span></span><br><span class=\"line\">docker run --restart on-failure:5 my-app</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ€»æ˜¯é‡å¯ï¼ˆå³ä½¿ä½ é‡å¯ Docker æœåŠ¡åï¼‰</span></span><br><span class=\"line\">docker run --restart always my-app</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># é™¤éæ‰‹åŠ¨åœæ­¢ï¼Œå¦åˆ™ä¸€ç›´é‡å¯</span></span><br><span class=\"line\">docker run --restart unless-stopped my-app</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><code>--cpu-shares</code> : è®¾ç½®å®¹å™¨çš„ CPU ç›¸å¯¹æƒé‡ï¼Œå³åœ¨ CPU èµ„æºç«äº‰æ—¶çš„ç›¸å¯¹ä¼˜å…ˆçº§ï¼Œé»˜è®¤å€¼ä¸º 1024ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å®¹å™¨1ï¼Œæƒé‡ 1024ï¼ˆé»˜è®¤ï¼‰</span></span><br><span class=\"line\">docker run -d --name c1 --cpu-shares 1024 nginx</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å®¹å™¨2ï¼Œæƒé‡ 512ï¼ˆä¼˜å…ˆçº§ä½ï¼‰</span></span><br><span class=\"line\">docker run -d --name c2 --cpu-shares 512 nginx</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">## è¯´æ˜ï¼š</span></span><br><span class=\"line\">  <span class=\"comment\"># c1çš„æƒé‡1024ï¼Œc2çš„æƒé‡512,ä¸æ˜¯ç»å¯¹é™åˆ¶ï¼Œè€Œæ˜¯åˆ†é…æ¯”ä¾‹</span></span><br><span class=\"line\">  <span class=\"comment\"># è¯¥æƒé‡è¡¨ç¤ºå®¹å™¨åœ¨ CPU ç«äº‰ä¸‹ï¼Œæƒé‡è¶Šé«˜åˆ™ä¼˜å…ˆçº§è¶Šé«˜ï¼Œä¼šå°½å¯èƒ½ä½¿ç”¨ CPU èµ„æºã€‚</span></span><br><span class=\"line\">  <span class=\"comment\"># å¦‚æœè¿™ä¸¤ä¸ªå®¹å™¨éƒ½è¿è¡Œåœ¨ CPU å¿™ç¢Œçš„ç¯å¢ƒä¸‹(åªæœ‰åœ¨ å¤šå®¹å™¨å…±äº« CPU ä¸”ç«äº‰èµ„æº çš„æƒ…å†µä¸‹æ‰ç”Ÿæ•ˆ)ï¼š</span></span><br><span class=\"line\">    <span class=\"comment\"># c1 å°†è·å¾—å¤§çº¦ 2/3 çš„ CPU æ—¶é—´</span></span><br><span class=\"line\">    <span class=\"comment\"># c2 å°†è·å¾—å¤§çº¦ 1/3 çš„ CPU æ—¶é—´</span></span><br><span class=\"line\">  <span class=\"comment\"># å¦‚æœç³»ç»Ÿ CPU ç©ºé—²ï¼Œæ‰€æœ‰å®¹å™¨éƒ½å¯ä»¥ä½¿ç”¨ 100% çš„ CPUã€‚</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><code>docker run</code> ç¤ºä¾‹</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å¯åŠ¨ä¸€ä¸ªnginx å®¹å™¨</span></span><br><span class=\"line\">docker run -d -p 80:80 --name nginx nginx</span><br><span class=\"line\"><span class=\"comment\"># æ›¿æ¢nginxé•œåƒé»˜è®¤çš„å¯åŠ¨å‘½ä»¤ï¼Œnginx é•œåƒé»˜è®¤å¯åŠ¨ nginx æœåŠ¡ï¼Œæ­¤å‘½ä»¤ä¼šæ”¹ä¸ºæ‰§è¡Œ nginx -v æ˜¾ç¤ºç‰ˆæœ¬å·</span></span><br><span class=\"line\">docker run --name test_nginx --entrypoint <span class=\"string\">&quot;&quot;</span> nginx nginx -v</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ‰§è¡Œè„šæœ¬æˆ–å‘½ä»¤ï¼Œè¿™é‡Œæ·»åŠ  --rm å‚æ•°ï¼Œè¡¨ç¤ºè¿è¡Œç»“æŸåè‡ªåŠ¨åˆ é™¤å®¹å™¨ï¼Œè¿™é‡Œæ˜¯å®‰è£… ping å‘½ä»¤</span></span><br><span class=\"line\">docker run --<span class=\"built_in\">rm</span> ubuntu bash -c <span class=\"string\">&quot;apt update &amp;&amp; apt install -y iputils-ping&quot;</span></span><br><span class=\"line\"><span class=\"comment\"># äº¤äº’å¼æ‰§è¡Œ shell å‘½ä»¤ï¼Œæ‰§è¡Œå‘½ä»¤åä¼šè¿›å…¥å®¹å™¨çš„shell</span></span><br><span class=\"line\">docker run --<span class=\"built_in\">rm</span> -it ubuntu /bin/bash</span><br><span class=\"line\"><span class=\"comment\"># è¿™æ ·ä¹Ÿå¯ä»¥ï¼Œå› ä¸º ubuntu çš„é»˜è®¤å¯åŠ¨å‘½ä»¤æ˜¯ /bin/bash</span></span><br><span class=\"line\">docker run --<span class=\"built_in\">rm</span> -it ubuntu</span><br><span class=\"line\"><span class=\"comment\"># è½¬åˆ°åå°è¿è¡Œ</span></span><br><span class=\"line\">docker run --<span class=\"built_in\">rm</span> -itd ubuntu</span><br></pre></td></tr></table></figure>\n<h3 id=\"docker-stop-åœæ­¢å®¹å™¨ï¼Œå®¹å™¨ä¼˜é›…é€€å‡º\"><code>docker stop</code> : åœæ­¢å®¹å™¨ï¼Œå®¹å™¨ä¼˜é›…é€€å‡º</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åœæ­¢å®¹å™¨ï¼Œé€šè¿‡å®¹å™¨åç§°</span></span><br><span class=\"line\">docker stop test_nginx</span><br><span class=\"line\"><span class=\"comment\"># åœæ­¢å®¹å™¨ï¼Œé€šè¿‡å®¹å™¨ID</span></span><br><span class=\"line\">docker stop 5d7c0c5d5c0c</span><br><span class=\"line\"><span class=\"comment\"># åœæ­¢æ‰€æœ‰æ­£åœ¨è¿è¡Œçš„å®¹å™¨</span></span><br><span class=\"line\">docker stop $(docker ps -q)</span><br><span class=\"line\"><span class=\"comment\"># ç­‰å¾…5ç§’åå¼ºåˆ¶å…³é—­</span></span><br><span class=\"line\">docker stop -t 5 test_nginx</span><br></pre></td></tr></table></figure>\n<h3 id=\"docker-kill-å¼ºåˆ¶åœæ­¢å®¹å™¨\"><code>docker kill</code> : å¼ºåˆ¶åœæ­¢å®¹å™¨</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å½“å®¹å™¨å®Œå…¨å¡æ­»ã€æŒ‚èµ·ã€ä¸å“åº” <code>stop</code> å‘½ä»¤æ—¶ä½¿ç”¨</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker <span class=\"built_in\">kill</span> test_nginx</span><br><span class=\"line\">docker <span class=\"built_in\">kill</span> 5d7c0c5d5c0c</span><br><span class=\"line\">docker <span class=\"built_in\">kill</span> $(docker ps -q)</span><br></pre></td></tr></table></figure>\n<h3 id=\"docker-restart-é‡å¯å®¹å™¨\"><code>docker restart</code> : é‡å¯å®¹å™¨</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker restart test_nginx</span><br><span class=\"line\">docker restart 5d7c0c5d5c0c</span><br><span class=\"line\">docker restart $(docker ps -q)</span><br></pre></td></tr></table></figure>\n<h3 id=\"docker-pause-æš‚åœå®¹å™¨\"><code>docker pause</code> : æš‚åœå®¹å™¨</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æš‚åœåå®¿ä¸»æœºå°†ä¸å†ä¸ºå®¹å™¨åˆ†é…CPUæ—¶é—´ç‰‡ï¼Œä½†å†…å­˜ä¾ç„¶æœ‰æ•ˆï¼Œä½ å¯ä»¥ç†è§£ä¸ºæ­¤æ—¶ä¸ºå®¹å™¨ä¿å­˜äº†å¿«ç…§</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker pause test_nginx</span><br><span class=\"line\">docker pause 5d7c0c5d5c0c</span><br><span class=\"line\">docker pause $(docker ps -q)</span><br></pre></td></tr></table></figure>\n<h3 id=\"docker-unpause-æ¢å¤å®¹å™¨\"><code>docker unpause</code> : æ¢å¤å®¹å™¨</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker unpause test_nginx</span><br><span class=\"line\">docker unpause 5d7c0c5d5c0c</span><br><span class=\"line\">docker unpause $(docker ps -q)</span><br></pre></td></tr></table></figure>\n<h3 id=\"docker-ps-æŸ¥çœ‹å®¹å™¨åˆ—è¡¨\"><code>docker ps</code> : æŸ¥çœ‹å®¹å™¨åˆ—è¡¨</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æ˜¾ç¤ºæ‰€æœ‰æ­£åœ¨è¿è¡Œçš„å®¹å™¨</span></span><br><span class=\"line\">docker ps</span><br><span class=\"line\"><span class=\"comment\"># æ˜¾ç¤ºæ‰€æœ‰å®¹å™¨</span></span><br><span class=\"line\">docker ps -a</span><br><span class=\"line\"><span class=\"comment\"># æ˜¾ç¤ºæ‰€æœ‰æ­£åœ¨è¿è¡Œçš„å®¹å™¨çš„ID</span></span><br><span class=\"line\">docker ps -q</span><br><span class=\"line\"><span class=\"comment\"># ä¸æˆªæ–­è¾“å‡ºï¼Œæ­¤æ—¶ COMMAND åˆ—ä¼šæ˜¾ç¤ºå®Œæ•´çš„å‘½ä»¤</span></span><br><span class=\"line\">docker ps -notrunc</span><br><span class=\"line\"><span class=\"comment\"># æ˜¾ç¤ºæœ€è¿‘åˆ›å»ºçš„5æ¡å®¹å™¨</span></span><br><span class=\"line\">docker ps -n 5</span><br><span class=\"line\"><span class=\"comment\"># è¿‡æ»¤å™¨ï¼Œæ˜¾ç¤ºçŠ¶æ€ä¸ºexitedçš„å®¹å™¨</span></span><br><span class=\"line\">docker ps -a --filter <span class=\"string\">&quot;status=exited&quot;</span></span><br><span class=\"line\"><span class=\"comment\"># æŒ‡å®šæ¨¡æ¿ï¼Œåªæ˜¾ç¤º ID å’Œ Names</span></span><br><span class=\"line\">docker ps --format <span class=\"string\">&quot;&#123;&#123;.ID&#125;&#125;: &#123;&#123;.Names&#125;&#125;&quot;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"docker-inspect-æŸ¥çœ‹å®¹å™¨ä¿¡æ¯\"><code>docker inspect</code> : æŸ¥çœ‹å®¹å™¨ä¿¡æ¯</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹å®¹å™¨ä¿¡æ¯</span></span><br><span class=\"line\">docker inspect &lt;container_id&gt;</span><br><span class=\"line\"><span class=\"comment\"># è·å–å®¹å™¨åç§°</span></span><br><span class=\"line\">docker inspect --format=<span class=\"string\">&#x27;&#123;&#123;.Name&#125;&#125;&#x27;</span> &lt;container_id | container_name&gt;</span><br><span class=\"line\"><span class=\"comment\"># è·å–å®¹å™¨é•œåƒ</span></span><br><span class=\"line\">docker inspect --format=<span class=\"string\">&#x27;&#123;&#123;.Config.Image&#125;&#125;&#x27;</span> &lt;container_id | container_name&gt;</span><br><span class=\"line\"><span class=\"comment\"># è·å–å®¹å™¨ç¯å¢ƒå˜é‡</span></span><br><span class=\"line\">docker inspect --format=<span class=\"string\">&#x27;&#123;&#123;.Config.Env&#125;&#125;&#x27;</span> &lt;container_id | container_name&gt;</span><br><span class=\"line\"><span class=\"comment\"># è·å–å®¹å™¨çŠ¶æ€ï¼Œå‰é¢çš„ json è¡¨ç¤ºè¾“å‡ºä¸º json æ ¼å¼</span></span><br><span class=\"line\">docker inspect --format=<span class=\"string\">&#x27;&#123;&#123;json .State&#125;&#125;&#x27;</span> &lt;container_id | container_name&gt;</span><br><span class=\"line\"><span class=\"comment\"># è·å–å®¹å™¨å†…å­˜é™åˆ¶</span></span><br><span class=\"line\">docker inspect --format=<span class=\"string\">&#x27;&#123;&#123;.HostConfig.Memory&#125;&#125;&#x27;</span> &lt;container_id | container_name&gt;</span><br><span class=\"line\"><span class=\"comment\"># è·å–å®¹å™¨label</span></span><br><span class=\"line\">docker inspect --format=<span class=\"string\">&#x27;&#123;&#123;json .Config.Labels&#125;&#125;&#x27;</span> &lt;container_id | container_name&gt;</span><br><span class=\"line\"><span class=\"comment\"># è·å–å®¹å™¨çš„ç½‘ç»œä¿¡æ¯</span></span><br><span class=\"line\">docker inspect --format=<span class=\"string\">&#x27;&#123;&#123;json .NetworkSettings&#125;&#125;&#x27;</span> &lt;container_id | container_name&gt;</span><br></pre></td></tr></table></figure>\n<h3 id=\"docker-logs-è·å–å®¹å™¨æ—¥å¿—\"><code>docker logs</code> : è·å–å®¹å™¨æ—¥å¿—</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># è·å–å®¹å™¨æ—¥å¿—</span></span><br><span class=\"line\">docker logs &lt;container_id | container_name&gt;</span><br><span class=\"line\"><span class=\"comment\"># è·å–å®¹å™¨å®æ—¶æ—¥å¿—</span></span><br><span class=\"line\">docker logs -f &lt;container_id | container_name&gt;</span><br><span class=\"line\"><span class=\"comment\"># è·å–å®¹å™¨æœ€æ–°çš„ 10 è¡Œæ—¥å¿—</span></span><br><span class=\"line\">docker logs -n 10 &lt;container_id | container_name&gt;</span><br><span class=\"line\"><span class=\"comment\"># è·å–å®¹å™¨çš„å¸¦æ—¶é—´æˆ³çš„æ—¥å¿—</span></span><br><span class=\"line\">docker logs -t &lt;container_id | container_name&gt;</span><br><span class=\"line\"><span class=\"comment\"># è·å–å®¹å™¨çš„æ—¥å¿—ï¼Œä» 1 å°æ—¶å‰å¼€å§‹</span></span><br><span class=\"line\">docker logs --since 1h &lt;container_id | container_name&gt;</span><br><span class=\"line\"><span class=\"comment\"># è·å–å®¹å™¨çš„æ—¥å¿—ï¼Œç›´åˆ° 1 å°æ—¶å‰</span></span><br><span class=\"line\">docker logs --<span class=\"keyword\">until</span> 1h &lt;container_id | container_name&gt;</span><br><span class=\"line\"><span class=\"comment\"># è·å–å®¹å™¨çš„è¯¦ç»†æ—¥å¿—</span></span><br><span class=\"line\">docker logs --details &lt;container_id | container_name&gt;</span><br><span class=\"line\"><span class=\"comment\"># è·å–å®¹å™¨çš„æ—¥å¿—ï¼Œä» 2 å°æ—¶å‰å¼€å§‹ï¼Œç›´åˆ° 1 å°æ—¶å‰</span></span><br><span class=\"line\">docker logs --since 2h --<span class=\"keyword\">until</span> 1h &lt;container_id | container_name&gt;</span><br></pre></td></tr></table></figure>\n<h3 id=\"docker-exec-åœ¨å·²ç»è¿è¡Œçš„å®¹å™¨ä¸­æ‰§è¡Œå‘½ä»¤\"><code>docker exec</code> : åœ¨å·²ç»è¿è¡Œçš„å®¹å™¨ä¸­æ‰§è¡Œå‘½ä»¤</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åœ¨å·²ç»è¿è¡Œçš„å®¹å™¨ä¸­æ‰§è¡Œå‘½ä»¤</span></span><br><span class=\"line\">docker <span class=\"built_in\">exec</span> &lt;container_id | container_name&gt; &lt;<span class=\"built_in\">command</span>&gt;</span><br><span class=\"line\"><span class=\"comment\"># è¿›å…¥å®¹å™¨shell</span></span><br><span class=\"line\">docker <span class=\"built_in\">exec</span> -it &lt;container_id | container_name&gt; bash</span><br></pre></td></tr></table></figure>\n<h3 id=\"docker-rename-é‡å‘½åå®¹å™¨\"><code>docker rename</code> : é‡å‘½åå®¹å™¨</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker rename &lt;old_container_name&gt; &lt;new_container_name&gt;</span><br></pre></td></tr></table></figure>\n<h3 id=\"docker-cp-å®¹å™¨ä¸å®¿ä¸»æœºé—´å¤åˆ¶æ–‡ä»¶\"><code>docker cp</code> : å®¹å™¨ä¸å®¿ä¸»æœºé—´å¤åˆ¶æ–‡ä»¶</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å®¿ä¸»æœº -&gt; å®¹å™¨</span></span><br><span class=\"line\"><span class=\"comment\"># docker cp &lt;host_path&gt; &lt;container_id | container_name&gt;:&lt;container_path&gt;</span></span><br><span class=\"line\">docker <span class=\"built_in\">cp</span> ./docker-command-container.md nginx:/tmp</span><br><span class=\"line\"><span class=\"comment\"># å®¹å™¨ -&gt; å®¿ä¸»æœº</span></span><br><span class=\"line\"><span class=\"comment\"># docker cp &lt;container_id | container_name&gt;:&lt;container_path&gt; &lt;host_path&gt;</span></span><br><span class=\"line\">docker <span class=\"built_in\">cp</span> nginx:/tmp/docker-command-container.md ./</span><br></pre></td></tr></table></figure>\n<h3 id=\"docker-rm-åˆ é™¤å®¹å™¨\"><code>docker rm</code> : åˆ é™¤å®¹å™¨</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åˆ é™¤æŒ‡å®šå®¹å™¨</span></span><br><span class=\"line\">docker <span class=\"built_in\">rm</span> &lt;container_id | container_name&gt;</span><br><span class=\"line\"><span class=\"comment\"># åˆ é™¤æ‰€æœ‰å®¹å™¨</span></span><br><span class=\"line\">docker <span class=\"built_in\">rm</span> $(docker ps -aq)</span><br></pre></td></tr></table></figure>\n<h3 id=\"docker-container-prune-åˆ é™¤æ‰€æœ‰åœæ­¢çš„å®¹å™¨\"><code>docker container prune</code> : åˆ é™¤æ‰€æœ‰åœæ­¢çš„å®¹å™¨</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker container prune</span><br></pre></td></tr></table></figure>\n<h3 id=\"docker-update-æ›´æ–°å®¹å™¨é…ç½®\"><code>docker update</code> : æ›´æ–°å®¹å™¨é…ç½®</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æ›´æ–°æŒ‡å®šå®¹å™¨çš„CPUæ ¸æ•°å’Œå†…å­˜å¤§å°</span></span><br><span class=\"line\">docker update --cpus=2 --memory=2g &lt;container_id | container_name&gt;</span><br><span class=\"line\"><span class=\"comment\"># æ›´æ–°æŒ‡å®šå®¹å™¨è‡ªåŠ¨é‡å¯</span></span><br><span class=\"line\">docker update --restart=always &lt;container_id | container_name&gt;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¹¶ä¸æ˜¯æ‰€æœ‰çš„é…ç½®éƒ½æ”¯æŒæ›´æ–°ï¼Œupdate å‘½ä»¤åªæ”¯æŒå¦‚ä¸‹é…ç½®ï¼ŒåŸºæœ¬ä¸Šä¹Ÿå°±åªèƒ½è°ƒä¸€ä¸‹cpuå’Œå†…å­˜ï¼Œä»¥åŠè‡ªåŠ¨é‡å¯ç­–ç•¥ï¼Œæ‰€ä»¥åˆ¶ä½œå®¹å™¨æ—¶ä¸€å®šè¦åšå¥½è§„åˆ’ã€‚</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>å‚æ•°å</th>\n<th>è¯´æ˜</th>\n<th>ç¤ºä¾‹å€¼</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>--blkio-weight</code></td>\n<td>è®¾ç½® Block IO çš„ç›¸å¯¹æƒé‡ï¼ŒèŒƒå›´æ˜¯ 10 åˆ° 1000ï¼Œè®¾ç½®ä¸º 0 è¡¨ç¤ºç¦ç”¨ï¼ˆé»˜è®¤å€¼ä¸º 0ï¼‰</td>\n<td><code>--blkio-weight=500</code></td>\n</tr>\n<tr>\n<td><code>--cpu-period</code></td>\n<td>è®¾ç½® CPU CFSï¼ˆå®Œå…¨å…¬å¹³è°ƒåº¦å™¨ï¼‰çš„å‘¨æœŸé™åˆ¶ï¼ˆå•ä½ï¼šå¾®ç§’ï¼‰</td>\n<td><code>--cpu-period=100000</code></td>\n</tr>\n<tr>\n<td><code>--cpu-quota</code></td>\n<td>è®¾ç½® CPU CFS çš„é…é¢é™åˆ¶ï¼ˆå•ä½ï¼šå¾®ç§’ï¼‰</td>\n<td><code>--cpu-quota=50000</code></td>\n</tr>\n<tr>\n<td><code>--cpu-rt-period</code></td>\n<td>è®¾ç½®å®æ—¶ CPU çš„è°ƒåº¦å‘¨æœŸï¼ˆå•ä½ï¼šå¾®ç§’ï¼‰</td>\n<td><code>--cpu-rt-period=1000000</code></td>\n</tr>\n<tr>\n<td><code>--cpu-rt-runtime</code></td>\n<td>è®¾ç½®å®æ—¶ CPU çš„è¿è¡Œæ—¶é—´é™åˆ¶ï¼ˆå•ä½ï¼šå¾®ç§’ï¼‰</td>\n<td><code>--cpu-rt-runtime=950000</code></td>\n</tr>\n<tr>\n<td><code>-c</code>, <code>--cpu-shares</code></td>\n<td>è®¾ç½® CPU å…±äº«æƒé‡ï¼Œé»˜è®¤å€¼ä¸º 1024</td>\n<td><code>--cpu-shares=512</code></td>\n</tr>\n<tr>\n<td><code>--cpus</code></td>\n<td>é™åˆ¶å®¹å™¨ä½¿ç”¨çš„ CPU æ•°é‡ï¼ˆæ”¯æŒå°æ•°ï¼‰</td>\n<td><code>--cpus=1.5</code></td>\n</tr>\n<tr>\n<td><code>--cpuset-cpus</code></td>\n<td>æŒ‡å®šå®¹å™¨å¯ä»¥åœ¨å“ªäº› CPU ä¸Šè¿è¡Œï¼ˆå¦‚ 0-3ã€0,1ï¼‰</td>\n<td><code>--cpuset-cpus=&quot;0,1&quot;</code></td>\n</tr>\n<tr>\n<td><code>--cpuset-mems</code></td>\n<td>æŒ‡å®šå®¹å™¨å¯ä»¥ä½¿ç”¨å“ªäº›å†…å­˜èŠ‚ç‚¹ï¼ˆå¦‚ 0-3ã€0,1ï¼‰ï¼Œé€‚ç”¨äº NUMA ç³»ç»Ÿ</td>\n<td><code>--cpuset-mems=&quot;0&quot;</code></td>\n</tr>\n<tr>\n<td><code>-m</code>, <code>--memory</code></td>\n<td>è®¾ç½®å†…å­˜é™åˆ¶ï¼ˆä¾‹å¦‚ 512mã€2gï¼‰</td>\n<td><code>--memory=1g</code></td>\n</tr>\n<tr>\n<td><code>--memory-reservation</code></td>\n<td>è®¾ç½®å†…å­˜è½¯é™åˆ¶ï¼ˆä½äº <code>--memory</code> çš„å€¼æ—¶ï¼Œå…è®¸ç³»ç»Ÿåœ¨å‹åŠ›è¾ƒå°æ—¶å›æ”¶ï¼‰</td>\n<td><code>--memory-reservation=512m</code></td>\n</tr>\n<tr>\n<td><code>--memory-swap</code></td>\n<td>è®¾ç½® swap é™åˆ¶ï¼ˆå†…å­˜ + swap æ€»å’Œï¼‰ï¼Œè®¾ä¸º -1 è¡¨ç¤ºæ— é™åˆ¶</td>\n<td><code>--memory-swap=2g</code></td>\n</tr>\n<tr>\n<td><code>--pids-limit</code></td>\n<td>è®¾ç½®å®¹å™¨çš„æœ€å¤§è¿›ç¨‹æ•°é‡ï¼Œè®¾ä¸º -1 è¡¨ç¤ºæ— é™åˆ¶</td>\n<td><code>--pids-limit=100</code></td>\n</tr>\n<tr>\n<td><code>--restart</code></td>\n<td>è®¾ç½®å®¹å™¨é€€å‡ºåçš„é‡å¯ç­–ç•¥</td>\n<td><code>--restart=always</code></td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"docker-stats-æ˜¾ç¤ºå®¹å™¨çš„å®æ—¶èµ„æºä½¿ç”¨æƒ…å†µ\"><code>docker stats</code> : æ˜¾ç¤ºå®¹å™¨çš„å®æ—¶èµ„æºä½¿ç”¨æƒ…å†µ</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æ˜¾ç¤ºæ‰€æœ‰å®¹å™¨çš„å®æ—¶èµ„æºä½¿ç”¨æƒ…å†µ</span></span><br><span class=\"line\">docker stats</span><br><span class=\"line\"><span class=\"comment\">## è¾“å‡º</span></span><br><span class=\"line\">CONTAINER ID   NAME         CPU %     MEM USAGE / LIMIT     MEM %     NET I/O           BLOCK I/O     PIDS</span><br><span class=\"line\">15caf520e3a5   nginx        0.00%     10.22MiB / 7.752GiB   0.13%     6.38kB / 2.61kB   0B / 28.7kB   13</span><br><span class=\"line\">b680087420b8   dockge       0.01%     199.5MiB / 7.752GiB   2.51%     6.44kB / 1.48kB   94.8MB / 0B   24</span><br><span class=\"line\">861dd9c1475f   remote-api   0.00%     4.188MiB / 7.752GiB   0.05%     2.77kB / 126B     3.31MB / 0B   1</span><br><span class=\"line\"><span class=\"comment\">### CONTAINER ID ä¸ NAMEï¼šå®¹å™¨ ID ä¸åç§°ã€‚</span></span><br><span class=\"line\"><span class=\"comment\">### CPU % ä¸ MEM %ï¼šå®¹å™¨ä½¿ç”¨çš„ CPU å’Œå†…å­˜çš„ç™¾åˆ†æ¯”ã€‚</span></span><br><span class=\"line\"><span class=\"comment\">### MEM USAGE / LIMITï¼šå®¹å™¨æ­£åœ¨ä½¿ç”¨çš„æ€»å†…å­˜ï¼Œä»¥åŠå…è®¸ä½¿ç”¨çš„å†…å­˜æ€»é‡ã€‚</span></span><br><span class=\"line\"><span class=\"comment\">### NET I/Oï¼šå®¹å™¨é€šè¿‡å…¶ç½‘ç»œæ¥å£å‘é€å’Œæ¥æ”¶çš„æ•°æ®é‡ã€‚</span></span><br><span class=\"line\"><span class=\"comment\">### BLOCK I/Oï¼šå®¹å™¨ä»ä¸»æœºä¸Šçš„å—è®¾å¤‡è¯»å–å’Œå†™å…¥çš„æ•°æ®é‡ã€‚</span></span><br><span class=\"line\"><span class=\"comment\">### PIDsï¼šå®¹å™¨åˆ›å»ºçš„è¿›ç¨‹æˆ–çº¿ç¨‹æ•°ã€‚</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åˆ—å‡ºæ‰€æœ‰å®¹å™¨çš„èµ„æºä½¿ç”¨æƒ…å†µï¼ŒåŒ…æ‹¬è¿è¡Œå’Œåœæ­¢çš„</span></span><br><span class=\"line\">docker stats -a</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å±•ç¤ºå½“å‰çŠ¶æ€å°±ç›´æ¥é€€å‡ºäº†ï¼Œä¸å†å®æ—¶æ›´æ–°ã€‚</span></span><br><span class=\"line\">docker stats --no-stream</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŒ‡å®šè¾“å‡ºæ¨¡æ¿ï¼Œè¿™é‡ŒåŠ ä¸åŠ  table éƒ½å¯ä»¥</span></span><br><span class=\"line\">docker stats --no-stream --format <span class=\"string\">&quot;table &#123;&#123;.Name&#125;&#125;\\t&#123;&#123;.CPUPerc&#125;&#125;\\t&#123;&#123;.MemUsage&#125;&#125;&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># è¾“å‡ºjsonæ ¼å¼</span></span><br><span class=\"line\">docker stats --no-stream --format json</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŒ‡å®šå®¹å™¨</span></span><br><span class=\"line\">docker stats &lt;container_id | container_name&gt;</span><br></pre></td></tr></table></figure>\n<h3 id=\"docker-top-æŸ¥çœ‹æ­£åœ¨è¿è¡Œçš„è¿›ç¨‹\"><code>docker top</code> :  æŸ¥çœ‹æ­£åœ¨è¿è¡Œçš„è¿›ç¨‹</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># docker top &lt;container_id | container_name&gt; [ps options]</span></span><br><span class=\"line\">docker top nginx</span><br></pre></td></tr></table></figure>\n<h3 id=\"docker-port-åˆ—å‡ºæŒ‡å®šçš„å®¹å™¨çš„ç«¯å£æ˜ å°„\"><code>docker port</code> : åˆ—å‡ºæŒ‡å®šçš„å®¹å™¨çš„ç«¯å£æ˜ å°„</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># docker port &lt;container_id | container_name&gt;</span></span><br><span class=\"line\">$ docker port nginx</span><br><span class=\"line\">80/tcp -&gt; 0.0.0.0:8081</span><br></pre></td></tr></table></figure>\n<h3 id=\"docker-diff-åˆ—å‡ºå®¹å™¨è¿è¡Œæ—¶å¯¹æ–‡ä»¶ç³»ç»Ÿçš„ä¿®æ”¹\"><code>docker diff</code> : åˆ—å‡ºå®¹å™¨è¿è¡Œæ—¶å¯¹æ–‡ä»¶ç³»ç»Ÿçš„ä¿®æ”¹</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># docker diff &lt;container_id | container_name&gt;</span></span><br><span class=\"line\">$ docker diff nginx</span><br><span class=\"line\">C /root</span><br><span class=\"line\">A /root/.bash_history</span><br><span class=\"line\">C /run</span><br><span class=\"line\">A /run/nginx.pid</span><br><span class=\"line\">C /tmp</span><br><span class=\"line\">A /tmp/demo.py</span><br><span class=\"line\">C /var</span><br><span class=\"line\">C /var/cache</span><br><span class=\"line\">C /var/cache/nginx</span><br><span class=\"line\">A /var/cache/nginx/client_temp</span><br><span class=\"line\">A /var/cache/nginx/fastcgi_temp</span><br><span class=\"line\">A /var/cache/nginx/proxy_temp</span><br><span class=\"line\">A /var/cache/nginx/scgi_temp</span><br><span class=\"line\">A /var/cache/nginx/uwsgi_temp</span><br><span class=\"line\">C /etc</span><br><span class=\"line\">C /etc/nginx</span><br><span class=\"line\">C /etc/nginx/conf.d</span><br><span class=\"line\">C /etc/nginx/conf.d/default.conf</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å‰ç¼€å«ä¹‰è¯´æ˜ï¼š</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>æ ‡å¿—</th>\n<th>å«ä¹‰</th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>A</code></td>\n<td><strong>Addedï¼ˆæ–°å¢ï¼‰</strong></td>\n<td>æ–‡ä»¶æˆ–ç›®å½•æ˜¯å®¹å™¨è¿è¡Œåæ–°å¢çš„</td>\n</tr>\n<tr>\n<td><code>C</code></td>\n<td><strong>Changedï¼ˆä¿®æ”¹ï¼‰</strong></td>\n<td>æ–‡ä»¶æˆ–ç›®å½•æ˜¯å·²æœ‰çš„ï¼Œä½†å†…å®¹æˆ–å…ƒæ•°æ®ï¼ˆå¦‚æƒé™ã€æ—¶é—´æˆ³ç­‰ï¼‰è¢«ä¿®æ”¹äº†</td>\n</tr>\n<tr>\n<td><code>D</code></td>\n<td><strong>Deletedï¼ˆåˆ é™¤ï¼‰</strong></td>\n<td>æ–‡ä»¶æˆ–ç›®å½•æ˜¯å­˜åœ¨äºåŸé•œåƒä¸­çš„ï¼Œä½†åœ¨å®¹å™¨ä¸­è¢«åˆ é™¤</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"docker-commit-ä»å®¹å™¨åˆ›å»ºä¸€ä¸ªæ–°çš„é•œåƒ\"><code>docker commit</code> : ä»å®¹å™¨åˆ›å»ºä¸€ä¸ªæ–°çš„é•œåƒ</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># docker commit &lt;container_id | container_name&gt; [image_name[:tag]]</span></span><br><span class=\"line\">docker commit nginx nginx:v1.0</span><br></pre></td></tr></table></figure>\n<h3 id=\"docker-export-å¯¼å‡ºå®¹å™¨å†…å®¹ä¸º-tar-æ–‡ä»¶\"><code>docker export</code> : å¯¼å‡ºå®¹å™¨å†…å®¹ä¸º tar æ–‡ä»¶</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker <span class=\"built_in\">export</span> nginx &gt; nginx.tar</span><br><span class=\"line\">dcoker <span class=\"built_in\">export</span> -o nginx.tar nginx</span><br><span class=\"line\">docker <span class=\"built_in\">export</span> nginx | gzip &gt; nginx.tar.gz</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Docker Export / Save / Commit å‘½ä»¤å¯¹æ¯”ä¸å¯¼å…¥æ–¹å¼ä¸€è§ˆè¡¨</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>å‘½ä»¤</th>\n<th>æ“ä½œå¯¹è±¡</th>\n<th>è¾“å‡ºå†…å®¹</th>\n<th>æ˜¯å¦åŒ…å«å†å²å±‚ï¼ˆé•œåƒå±‚ï¼‰</th>\n<th>æ˜¯å¦ä¿ç•™å…ƒæ•°æ®ï¼ˆæ ‡ç­¾ã€å‘½ä»¤ç­‰ï¼‰</th>\n<th>å…¸å‹ç”¨é€”</th>\n<th>å¯¼å…¥å‘½ä»¤</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>docker export</code></td>\n<td><strong>å®¹å™¨</strong></td>\n<td>å®¹å™¨çš„æ–‡ä»¶ç³»ç»Ÿï¼ˆtar å½’æ¡£ï¼‰</td>\n<td>âŒ å¦</td>\n<td>âŒ å¦</td>\n<td>å¤‡ä»½å®¹å™¨æ–‡ä»¶ç³»ç»Ÿæˆ–è¿ç§»å®¹å™¨çŠ¶æ€</td>\n<td><code>docker import &lt;tar&gt; &lt;image:tag&gt;</code></td>\n</tr>\n<tr>\n<td><code>docker save</code></td>\n<td><strong>é•œåƒ</strong></td>\n<td>é•œåƒçš„å®Œæ•´å†…å®¹ï¼ˆå«æ‰€æœ‰å±‚çš„ tarï¼‰</td>\n<td>âœ… æ˜¯</td>\n<td>âœ… æ˜¯</td>\n<td>åˆ†å‘æˆ–å¤‡ä»½é•œåƒ</td>\n<td><code>docker load &lt; &lt;tar&gt;</code></td>\n</tr>\n<tr>\n<td><code>docker commit</code></td>\n<td><strong>å®¹å™¨</strong></td>\n<td>åˆ›å»ºä¸€ä¸ªæ–°çš„é•œåƒ</td>\n<td>âœ… æ˜¯ï¼ˆä½†åªä¸€å±‚ï¼‰</td>\n<td>âœ… æ˜¯</td>\n<td>å°†å½“å‰å®¹å™¨çŠ¶æ€æ‰“åŒ…æˆæ–°é•œåƒ</td>\n<td>ä¸é€‚ç”¨ï¼ˆç›´æ¥ç”Ÿæˆé•œåƒï¼‰</td>\n</tr>\n</tbody>\n</table>\n","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» Docker å‘½ä»¤ ä¸­ å®¹å™¨ç®¡ç† ç›¸å…³å‘½ä»¤ Dockerå®˜æ–¹æ–‡æ¡£ å®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸ å®¹å™¨å¯èƒ½å¤„äºä»¥ä¸‹å‡ ç§çŠ¶æ€ï¼š åˆå»ºï¼ˆcreatedï¼‰ è¿è¡Œï¼ˆrunningï¼‰ æš‚åœï¼ˆpausedï¼‰ åœæ­¢ï¼ˆstoppedï¼‰ åˆ é™¤ï¼ˆdeletedï¼‰ å„ç”Ÿå‘½å‘¨æœŸä¹‹é—´çš„è½¬æ¢å…³ç³»å¦‚å›¾æ‰€ç¤ºï¼š å‘½ä»¤/æƒ…å†µ è¯´æ˜ å®¹å™¨çŠ¶æ€å˜æ›´ docker create åˆ›å»ºå®¹å™¨åï¼Œä¸ç«‹å³å¯åŠ¨è¿è¡Œï¼Œå®¹å™¨è¿›å…¥åˆå»ºçŠ¶æ€ åˆå»ºçŠ¶æ€ docker run åˆ›å»ºå®¹å™¨ï¼Œå¹¶ç«‹å³å¯åŠ¨è¿è¡Œï¼Œè¿›å…¥è¿è¡ŒçŠ¶æ€ åˆå»º â†’ è¿è¡Œ docker start å¯åŠ¨å·²åˆ›å»ºçš„å®¹å™¨ï¼Œå®¹å™¨è½¬ä¸ºè¿è¡ŒçŠ¶æ€ åœæ­¢ â†’ è¿è¡Œ docker stop åœæ­¢æ­£åœ¨è¿è¡Œçš„å®¹å™¨ï¼Œå®¹å™¨è½¬å…¥åœæ­¢çŠ¶æ€ è¿è¡Œ â†’ åœæ­¢ docker kill å¼ºåˆ¶ç»ˆæ­¢å®¹å™¨ï¼Œç›¸å½“äºâ€œæ–­ç”µâ€ï¼Œå®¹æ˜“ä¸¢å¤±æ•°æ®ï¼Œä¸å»ºè®®è½»æ˜“ä½¿ç”¨ è¿è¡Œ â†’ åœæ­¢ï¼ˆéæ­£å¸¸ï¼‰ docker restart é‡å¯å®¹å™¨ï¼Œå®¹å™¨é‡æ–°è¿›å…¥è¿è¡ŒçŠ¶æ€ è¿è¡Œ â†’ åœæ­¢ â†’ è¿è¡Œ docker pause æš‚åœå®¹å™¨å†…æ‰€æœ‰è¿›ç¨‹ï¼Œå®¹å™¨è¿›å…¥æš‚åœçŠ¶æ€ è¿è¡Œ â†’ æš‚åœ docker unpause å–æ¶ˆæš‚åœçŠ¶æ€ï¼Œå®¹å™¨æ¢å¤è¿è¡Œ æš‚åœ â†’ è¿è¡Œ docker rm åˆ é™¤å®¹å™¨ï¼Œå®¹å™¨è½¬å…¥åˆ é™¤çŠ¶æ€ ä»»æ„ â†’ åˆ é™¤ Killed by out-of-memory (OOM) å®¿ä¸»æœºå†…å­˜è€—å°½ï¼Œå®¹å™¨è¢«ç³»ç»Ÿç»ˆæ­¢ï¼Œæ­¤ä¸ºéè®¡åˆ’ç»ˆæ­¢ï¼›å»ºè®®æ€æ­»å†…å­˜å ç”¨æœ€é«˜çš„å®¹å™¨ è¿è¡Œ â†’ åœæ­¢ï¼ˆå¼‚å¸¸ï¼‰ Container process exited å®¹å™¨è¿›ç¨‹å¼‚å¸¸ç»ˆæ­¢åï¼Œè¿›å…¥â€œæ˜¯å¦é‡å¯â€åˆ¤æ–­æµç¨‹ï¼šæ˜¯åˆ™æ‰§è¡Œ start è¿›å…¥è¿è¡Œï¼›å¦åˆ™ä¿æŒåœæ­¢çŠ¶æ€ å¼‚å¸¸ â†’ åœæ­¢æˆ–è¿è¡Œ docker container : å®¹å™¨ç®¡ç† docker container --help å‘½ä»¤ è¯´æ˜ åˆ«å attach å°†æœ¬åœ°çš„æ ‡å‡†è¾“å…¥ã€è¾“å‡ºå’Œé”™è¯¯æµé™„åŠ åˆ°ä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„å®¹å™¨ä¸Š docker attach commit æ ¹æ®å®¹å™¨çš„æ›´æ”¹åˆ›å»ºä¸€ä¸ªæ–°çš„é•œåƒ docker commit cp åœ¨å®¹å™¨å’Œæœ¬åœ°æ–‡ä»¶ç³»ç»Ÿä¹‹é—´å¤åˆ¶æ–‡ä»¶/æ–‡ä»¶å¤¹ docker cp create åˆ›å»ºä¸€ä¸ªæ–°çš„å®¹å™¨ docker create diff æ£€æŸ¥å®¹å™¨æ–‡ä»¶ç³»ç»Ÿä¸Šçš„æ–‡ä»¶æˆ–ç›®å½•çš„æ›´æ”¹ docker diff exec åœ¨æ­£åœ¨è¿è¡Œçš„å®¹å™¨ä¸­æ‰§è¡Œå‘½ä»¤ docker exec export å°†å®¹å™¨çš„æ–‡ä»¶ç³»ç»Ÿå¯¼å‡ºä¸º tar å½’æ¡£æ–‡ä»¶ docker export inspect æ˜¾ç¤ºä¸€ä¸ªæˆ–å¤šä¸ªå®¹å™¨çš„è¯¦ç»†ä¿¡æ¯ å¯ä»¥ä½¿ç”¨ docker inspect kill ç»ˆæ­¢ä¸€ä¸ªæˆ–å¤šä¸ªæ­£åœ¨è¿è¡Œçš„å®¹å™¨ docker kill logs è·å–å®¹å™¨çš„æ—¥å¿— docker logs ls åˆ—å‡ºå®¹å™¨ docker ps pause æš‚åœä¸€ä¸ªæˆ–å¤šä¸ªå®¹å™¨å†…çš„æ‰€æœ‰è¿›ç¨‹ docker pause port åˆ—å‡ºå®¹å™¨çš„ç«¯å£æ˜ å°„æˆ–ç‰¹å®šçš„ç«¯å£æ˜ å°„ docker port prune åˆ é™¤æ‰€æœ‰å·²åœæ­¢çš„å®¹å™¨ rename é‡å‘½åä¸€ä¸ªå®¹å™¨ docker rename restart é‡å¯ä¸€ä¸ªæˆ–å¤šä¸ªå®¹å™¨ docker restart rm åˆ é™¤ä¸€ä¸ªæˆ–å¤šä¸ªå®¹å™¨ docker rm run æ ¹æ®é•œåƒåˆ›å»ºå¹¶è¿è¡Œä¸€ä¸ªæ–°å®¹å™¨ docker run start å¯åŠ¨ä¸€ä¸ªæˆ–å¤šä¸ªå·²åœæ­¢çš„å®¹å™¨ docker start stats å®æ—¶æ˜¾ç¤ºå®¹å™¨èµ„æºä½¿ç”¨ç»Ÿè®¡ä¿¡æ¯ docker stats stop åœæ­¢ä¸€ä¸ªæˆ–å¤šä¸ªæ­£åœ¨è¿è¡Œçš„å®¹å™¨ docker stop top æ˜¾ç¤ºå®¹å™¨ä¸­è¿è¡Œçš„è¿›ç¨‹ docker top unpause å–æ¶ˆæš‚åœä¸€ä¸ªæˆ–å¤šä¸ªå®¹å™¨å†…çš„æ‰€æœ‰è¿›ç¨‹ docker unpause update æ›´æ–°ä¸€ä¸ªæˆ–å¤šä¸ªå®¹å™¨çš„é…ç½® docker update wait é˜»å¡ç›´åˆ°ä¸€ä¸ªæˆ–å¤šä¸ªå®¹å™¨åœæ­¢ï¼Œç„¶åæ‰“å°å…¶é€€å‡ºä»£ç  docker wait è¿è¡Œ docker container COMMAND --help å¯è·å–æŸä¸ªå‘½ä»¤çš„æ›´å¤šä¿¡æ¯ã€‚ docker create : åˆ›å»ºå®¹å™¨ï¼Œä½†ä¸å¯åŠ¨ 1234567$ docker create \\ --name my-container \\ # å®¹å™¨å -e MY_ENV_VAR=my-value \\ # è®¾ç½®ç¯å¢ƒå˜é‡ -p 80:80 \\ # æ˜ å°„ç«¯å£ï¼Œæ ¼å¼ï¼šå®¿ä¸»æœºç«¯å£:å®¹å™¨ç«¯å£ -v /path/to/my/dir:/path/in/container \\ # æ˜ å°„ç›®å½•ï¼Œæ ¼å¼ï¼šå®¿ä¸»æœºç›®å½•:å®¹å™¨ç›®å½•ï¼Œéƒ½å¿…é¡»æ˜¯ç»å¯¹è·¯å¾„ --restart always \\ # è®¾ç½®é‡å¯ç­–ç•¥ nginx:latest \\ # é•œåƒåï¼Œé•œåƒä¸å­˜åœ¨æ—¶ä¼šè‡ªåŠ¨ä¸‹è½½ docker create ä¸ docker run çš„å‚æ•°åŸºæœ¬ä¸€è‡´ï¼Œå…·ä½“æŸ¥çœ‹ä¸‹é¢ docker run ä¸­çš„ä»‹ç»ã€‚ docker start : å¯åŠ¨ä¸€ä¸ªå®¹å™¨ å¯åŠ¨ä¸€ä¸ªå®¹å™¨ï¼Œå®¹å™¨å¿…é¡»å·²ç»åˆ›å»ºï¼Œå¹¶ä¸”å¤„äºåœæ­¢çŠ¶æ€ã€‚ 12# è¯­æ³•ï¼šdocker start &lt;container_id|container_name&gt;$ docker start my-container docker run : åˆ›å»ºå¹¶å¯åŠ¨ä¸€ä¸ªå®¹å™¨ ç›¸å½“äºdocker create + docker start å¸¸ç”¨å‚æ•°è¯´æ˜ å‚æ•° è¯´æ˜ ç¤ºä¾‹ -d, --detach åå°è¿è¡Œå®¹å™¨ï¼ˆå³â€œå®ˆæŠ¤æ€â€ï¼‰ï¼Œrunç‹¬æœ‰ docker run -d nginx -it äº¤äº’å¼è¿è¡Œå®¹å™¨å¹¶åˆ†é…ç»ˆç«¯ï¼ˆå¸¸ç”¨äºè°ƒè¯•ï¼‰ docker run -it ubuntu bash --name æŒ‡å®šå®¹å™¨åç§° docker run --name my-nginx nginx --rm å®¹å™¨é€€å‡ºæ—¶è‡ªåŠ¨åˆ é™¤ docker run --rm ubuntu -p, --publish ç«¯å£æ˜ å°„ï¼ˆå®¿ä¸»æœº:å®¹å™¨ï¼‰ docker run -p 8080:80 nginx -P, --publish-all è‡ªåŠ¨éšæœºæ˜ å°„å®¹å™¨å†…éƒ¨æ‰€æœ‰æš´éœ²ç«¯å£åˆ°å®¿ä¸»æœºç«¯å£ docker run -P nginx -v, --volume æŒ‚è½½å·ï¼ˆå®¿ä¸»æœºç›®å½•:å®¹å™¨ç›®å½•ï¼‰ docker run -v /data:/app/data myapp --mount æ›´çµæ´»çš„æŒ‚è½½æ–¹å¼ï¼ˆæ¨èæ–°é¡¹ç›®ä½¿ç”¨ï¼‰ docker run --mount type=bind,source=/host,target=/container nginx --env, -e è®¾ç½®ç¯å¢ƒå˜é‡ docker run -e ENV=prod myapp --env-file ä»æ–‡ä»¶ä¸­åŠ è½½å¤šä¸ªç¯å¢ƒå˜é‡ docker run --env-file .env myapp --network è®¾ç½®å®¹å™¨ä½¿ç”¨çš„ç½‘ç»œæ¨¡å¼ docker run --network host myapp --restart è®¾ç½®å®¹å™¨çš„è‡ªåŠ¨é‡å¯ç­–ç•¥ docker run --restart=always myapp --privileged ç»™äºˆå®¹å™¨æ›´å¤šçš„æƒé™ï¼ˆå¦‚è®¿é—® host è®¾å¤‡ï¼‰ docker run --privileged myapp --entrypoint è¦†ç›–é•œåƒé»˜è®¤çš„ ENTRYPOINT docker run --entrypoint /bin/bash myapp -u, --user æŒ‡å®šå®¹å™¨å†…è¿è¡Œçš„ç”¨æˆ·ï¼ˆæ ¼å¼ï¼šUID æˆ– UID:GIDï¼‰ docker run --user 1000:1000 myapp -c, --cpu-shares è®¾ç½® CPU æƒé‡ï¼ˆç›¸å¯¹å€¼ï¼‰ docker run --cpu-shares=512 myapp -m, --memory é™åˆ¶å®¹å™¨æœ€å¤§å†…å­˜ï¼ˆå¦‚ 512m, 1gï¼‰ docker run --memory=512m myapp -h, --hostname è®¾ç½®å®¹å™¨ä¸»æœºå docker run -h myhost myapp --link(æ›´æ¨èä½¿ç”¨ --network) åˆ›å»ºé“¾æ¥åˆ°å…¶ä»–å®¹å™¨ docker run --link myapp:app myapp2 --cpus é™åˆ¶å®¹å™¨ä½¿ç”¨çš„CPUæ ¸æ•° docker run --cpus=&quot;1.5&quot; -p, --publish ç«¯å£æ˜ å°„ 1docker run -p [ä¸»æœºIP:]ä¸»æœºç«¯å£:å®¹å™¨ç«¯å£[/åè®®] ç¤ºä¾‹ å«ä¹‰è¯´æ˜ -p 8080:80 å°†ä¸»æœºçš„ 8080 ç«¯å£æ˜ å°„åˆ°å®¹å™¨çš„ 80 ç«¯å£ï¼ˆé»˜è®¤ TCPï¼‰ -p 127.0.0.1:8080:80 ä»…å°†ä¸»æœºæœ¬åœ° IPï¼ˆ127.0.0.1ï¼‰çš„ 8080 æ˜ å°„åˆ°å®¹å™¨çš„ 80 ç«¯å£ï¼ˆå¤–éƒ¨æ— æ³•è®¿é—®ï¼‰ -p 8080:80/tcp æ˜¾å¼æŒ‡å®šåè®®ä¸º TCPï¼ˆç­‰åŒäºä¸åŠ  /tcpï¼‰ -p 8080:80/udp æ˜ å°„ UDP åè®®ç«¯å£ï¼ˆå¦‚ DNS æœåŠ¡ç­‰ï¼‰ -p 8080 å®¿ä¸»æœºéšæœºç«¯å£æ˜ å°„åˆ°å®¹å™¨çš„8080ç«¯å£ -p 3000-3006:4000-4006 èŒƒå›´æ˜ å°„ï¼Œä¸èƒ½æ˜ å°„éå¯¹ç§°èŒƒå›´ï¼ˆå¦‚ 3000-3006:4000-4006ï¼‰ï¼Œåªèƒ½ä¸€ä¸€å¯¹åº” å¤šä¸ª -p å¯ä»¥å¤šæ¬¡ä½¿ç”¨ -pï¼Œæ˜ å°„å¤šä¸ªç«¯å£ã€‚ä¾‹å¦‚ï¼š-p 80:80 -p 443:443 -v, --volume æ•°æ®å·æ˜ å°„ 123456789101112131415161718docker run -v &lt;æœ¬åœ°è·¯å¾„&gt;:&lt;å®¹å™¨è·¯å¾„&gt;[:æƒé™] # &lt;æœ¬åœ°è·¯å¾„&gt; ä¸»æœºä¸Šçš„è·¯å¾„ï¼ˆç»å¯¹è·¯å¾„ï¼Œæˆ–å‘½åå·ï¼‰ï¼Œç›®å½•ä¸å­˜åœ¨ä¼šè‡ªåŠ¨åˆ›å»º # &lt;å®¹å™¨è·¯å¾„&gt; å®¹å™¨å†…çš„è·¯å¾„ï¼Œç›®å½•ä¸å­˜åœ¨ä¼šè‡ªåŠ¨åˆ›å»º # [:æƒé™] å¯é€‰ï¼šroï¼ˆåªè¯»ï¼‰ æˆ– rwï¼ˆè¯»å†™ï¼Œé»˜è®¤ï¼‰# ç¤ºä¾‹# æŒ‚è½½æœ¬åœ°ç›®å½•åˆ°å®¹å™¨docker run -v /data:/app/data myapp# æŒ‚è½½ä¸ºåªè¯»docker run -v /data:/app/data:ro myapp# æŒ‚è½½å¤šä¸ªæ•°æ®å·docker run -v /data1:/app/data1 -v /data2:/app/data2 myapp# ä½¿ç”¨å‘½åå·docker volume create mydatadocker run -v mydata:/app/data myapp --mount æŒ‚è½½å· 12# --mount æ˜¯ Docker æ¨èä½¿ç”¨çš„ ç°ä»£æŒ‚è½½æ–¹å¼ï¼ŒåŠŸèƒ½å’Œ -vï¼ˆæˆ– --volumeï¼‰ç±»ä¼¼ï¼Œä½†è¯­æ³•æ›´æ¸…æ™°ã€ç»“æ„æ›´è§„èŒƒï¼Œé€‚ç”¨äºå·ï¼ˆvolumeï¼‰ã€ç»‘å®šæŒ‚è½½ï¼ˆbindï¼‰å’Œä¸´æ—¶æŒ‚è½½ï¼ˆtmpfsï¼‰ã€‚docker run --mount type=&lt;ç±»å‹&gt;,source=&lt;ä¸»æœºè·¯å¾„æˆ–å·å&gt;,target=&lt;å®¹å™¨è·¯å¾„&gt;[,readonly] ä¸‰ç§æŒ‚è½½ç±»å‹å¯¹æ¯” ç±»å‹ (type) ç”¨é€” ç¤ºä¾‹ source volume ä½¿ç”¨ Docker ç®¡ç†çš„å· å·åï¼Œå¦‚ mydata bind æŒ‚è½½å®¿ä¸»æœºçš„å®é™…è·¯å¾„ ç»å¯¹è·¯å¾„ï¼Œå¦‚ /home/user/app/config tmpfs æŒ‚è½½å†…å­˜ä¸­çš„ä¸´æ—¶æ–‡ä»¶ç³»ç»Ÿ æ— éœ€æŒ‡å®š source 12345678910# ä½¿ç”¨å‘½åå·æŒ‚è½½ï¼ˆæ¨èæ–¹å¼ï¼‰,è¿™é‡Œ --target æŒ‡å®šå®¹å™¨å†…çš„æŒ‚è½½ç‚¹ï¼Œä¹Ÿå¯ä»¥æ›¿æ¢ä¸º --destinationdocker run --mount type=volume,source=mydata,target=/app/data myapp# ä½¿ç”¨æœ¬åœ°è·¯å¾„æŒ‚è½½ï¼ˆç»‘å®šæŒ‚è½½ï¼‰,sourceæŒ‡å®šçš„æœ¬åœ°è·¯å¾„å¿…é¡»å­˜åœ¨docker run --mount type=bind,source=/home/user/app/config,target=/app/config myapp# åªè¯»æŒ‚è½½ï¼Œreadonly å¯ä»¥ç®€å†™ä¸º rodocker run --mount type=bind,source=/home/user/app/config,target=/app/config,readonly myapp# ä½¿ç”¨å†…å­˜ä¸­çš„ä¸´æ—¶æ–‡ä»¶ç³»ç»ŸæŒ‚è½½ï¼Œæ•°æ®ä¸ä¼šæŒä¹…åŒ–ï¼Œåªå­˜å‚¨åœ¨å®¹å™¨è¿è¡Œæ—¶çš„å†…å­˜ä¸­docker run --mount type=tmpfs,target=/app/tmpfs myapp --link å®¹å™¨é—´é“¾æ¥ ç”¨äºåœ¨å®¹å™¨ä¹‹é—´å»ºç«‹è¿æ¥ï¼Œä½¿ä¸€ä¸ªå®¹å™¨å¯ä»¥é€šè¿‡å¦ä¸€ä¸ªå®¹å™¨çš„åç§°è®¿é—®å…¶ç½‘ç»œä¿¡æ¯ï¼ˆå¦‚ IPã€ç¯å¢ƒå˜é‡ç­‰ï¼‰ã€‚ æ³¨æ„ï¼š--link å·²è¢«å¼ƒç”¨ï¼Œå»ºè®®ä½¿ç”¨ --network æ¥å®ç°å®¹å™¨é—´é“¾æ¥ã€‚ 12345678910111213141516docker run --link &lt;ç›®æ ‡å®¹å™¨å&gt;:&lt;åˆ«å&gt; &lt;å…¶ä»–å‚æ•°&gt; &lt;é•œåƒå&gt;## ç¤ºä¾‹# åœºæ™¯ï¼šä¸€ä¸ª web å®¹å™¨æƒ³è¦è¿æ¥å¦ä¸€ä¸ªè¿è¡Œä¸­çš„ db å®¹å™¨# å…ˆå¯åŠ¨æ•°æ®åº“å®¹å™¨docker run -d --name db mysql# å¯åŠ¨ web å®¹å™¨å¹¶è¿æ¥åˆ° db å®¹å™¨docker run -it --rm --name web --link db:mydb ubuntu bash# åœ¨ web å®¹å™¨ä¸­ï¼Œç°åœ¨ä½ å¯ä»¥ç”¨ mydb æ¥è®¿é—® db å®¹å™¨ï¼Œä½†åè¿‡æ¥ db å®¹å™¨æ— æ³•è®¿é—® web å®¹å™¨docker exec web ping mydb## æ”¹ç”¨ --network å®ç°docker network create mynetdocker run -d --name db --network mynet mysqldocker run -it --rm --name web --network mynet ubuntu bashdocker exec web ping db --network ç½‘ç»œæ¨¡å¼ç±»å‹ ç±»å‹ å«ä¹‰ ç‰¹ç‚¹/é€‚ç”¨åœºæ™¯ æ˜¯å¦å…è®¸ç«¯å£æ˜ å°„ bridge é»˜è®¤ç½‘ç»œç±»å‹ï¼ˆç”¨æˆ·è‡ªå®šä¹‰æˆ– Docker é»˜è®¤æ¡¥æ¥ç½‘ç»œï¼‰ å®¹å™¨é€šè¿‡è™šæ‹Ÿç½‘æ¡¥è¿æ¥ï¼Œå¯ç›¸äº’é€šä¿¡ï¼›é€‚ç”¨äºå•ä¸»æœºéƒ¨ç½² âœ… æ˜¯ host å®¹å™¨ä¸å®¿ä¸»æœºå…±äº«ç½‘ç»œæ ˆ æ²¡æœ‰ç½‘ç»œéš”ç¦»ï¼Œå®¹å™¨ä½¿ç”¨å®¿ä¸»æœºçš„ IP å’Œç«¯å£ï¼Œæ€§èƒ½é«˜ï¼Œé€‚åˆå¯¹ç½‘ç»œè¦æ±‚é«˜çš„æœåŠ¡ âŒ å¦ none å®¹å™¨æ²¡æœ‰ç½‘ç»œæ¥å£ å®Œå…¨éš”ç¦»ï¼›é€‚ç”¨äºéœ€è¦å®Œå…¨æ§åˆ¶ç½‘ç»œçš„åœºæ™¯æˆ–æµ‹è¯•ç½‘ç»œä¸å¯è¾¾æ€§ âŒ å¦ &lt;user-defined&gt; ç”¨æˆ·è‡ªå®šä¹‰çš„ç½‘ç»œåç§°ï¼Œé€šè¿‡ docker network create åˆ›å»º æ”¯æŒå®¹å™¨åç§°äº’è§£æï¼ˆDNSï¼‰ï¼Œé€‚åˆå¤šå®¹å™¨é€šä¿¡åœºæ™¯ï¼Œå¦‚ Docker Compose âœ… æ˜¯ container:&lt;name|id&gt; ä¸å¦ä¸€ä¸ªå®¹å™¨å…±äº«ç½‘ç»œå‘½åç©ºé—´ ä¸¤ä¸ªå®¹å™¨å…±äº« IP å’Œç«¯å£ï¼Œé€‚ç”¨äºä¸»-è¾…å®¹å™¨æ¨¡å¼ï¼Œå¦‚ sidecar å®¹å™¨å…±äº«ä¸»å®¹å™¨ç½‘ç»œ âŒ å¦ 123456789101112131415# ä½¿ç”¨é»˜è®¤ bridge ç½‘ç»œdocker run -p 8080:80 --network bridge --name my-nginx nginx# ä¸å®¿ä¸»æœºå…±äº«ç½‘ç»œï¼Œä¸èƒ½ä½¿ç”¨-pdocker run --network host nginx# ä¸ä½¿ç”¨ä»»ä½•ç½‘ç»œï¼Œä¸èƒ½ä½¿ç”¨-pdocker run --network none nginx# ä½¿ç”¨å·²åˆ›å»ºçš„è‡ªå®šä¹‰ç½‘ç»œï¼Œç›¸åŒç½‘ç»œå‘½åç©ºé—´ä¸‹çš„å®¹å™¨ï¼Œå¯ä»¥é€šè¿‡å®¹å™¨ åç§°æˆ–ID äº’ç›¸è®¿é—®docker network create nginx_netdocker run -p 8080:80 --network nginx_net nginx# ä¸å¦ä¸€ä¸ªå®¹å™¨å…±äº«ç½‘ç»œå‘½åç©ºé—´ï¼Œä¸èƒ½ä½¿ç”¨-pï¼Œå¹¶ä¸”æ­¤æ—¶æ–°å¯åŠ¨çš„å®¹å™¨å ç”¨çš„ç«¯å£ä¸èƒ½ä¸è¦è¿æ¥çš„å®¹å™¨ç«¯å£ä¸€è‡´ï¼Œå¦åˆ™å°†å¯åŠ¨å¤±è´¥docker run --network container:my-nginx busybox --restart é‡å¯ç­–ç•¥ ç­–ç•¥ å«ä¹‰ noï¼ˆé»˜è®¤ï¼‰ å®¹å™¨é€€å‡ºåä¸ä¼šè‡ªåŠ¨é‡å¯ always æ— è®ºé€€å‡ºçŠ¶æ€ç å¦‚ä½•ï¼Œå®¹å™¨æ€»æ˜¯è‡ªåŠ¨é‡å¯ unless-stopped å®¹å™¨æ€»æ˜¯è‡ªåŠ¨é‡å¯ï¼Œé™¤éç”¨æˆ·æ‰‹åŠ¨åœæ­¢å®ƒ on-failure[:N] ä»…åœ¨å®¹å™¨é 0 çŠ¶æ€ç é€€å‡ºæ—¶è‡ªåŠ¨é‡å¯ï¼ˆå¯é€‰è®¾ç½®æœ€å¤§é‡å¯æ¬¡æ•° Nï¼‰ 1234567891011# å®¹å™¨éæ­£å¸¸é€€å‡ºæ—¶è‡ªåŠ¨é‡å¯docker run --restart on-failure my-app# æœ€å¤šé‡å¯ 5 æ¬¡docker run --restart on-failure:5 my-app# æ€»æ˜¯é‡å¯ï¼ˆå³ä½¿ä½ é‡å¯ Docker æœåŠ¡åï¼‰docker run --restart always my-app# é™¤éæ‰‹åŠ¨åœæ­¢ï¼Œå¦åˆ™ä¸€ç›´é‡å¯docker run --restart unless-stopped my-app --cpu-shares : è®¾ç½®å®¹å™¨çš„ CPU ç›¸å¯¹æƒé‡ï¼Œå³åœ¨ CPU èµ„æºç«äº‰æ—¶çš„ç›¸å¯¹ä¼˜å…ˆçº§ï¼Œé»˜è®¤å€¼ä¸º 1024ã€‚ 12345678910111213# å®¹å™¨1ï¼Œæƒé‡ 1024ï¼ˆé»˜è®¤ï¼‰docker run -d --name c1 --cpu-shares 1024 nginx# å®¹å™¨2ï¼Œæƒé‡ 512ï¼ˆä¼˜å…ˆçº§ä½ï¼‰docker run -d --name c2 --cpu-shares 512 nginx## è¯´æ˜ï¼š # c1çš„æƒé‡1024ï¼Œc2çš„æƒé‡512,ä¸æ˜¯ç»å¯¹é™åˆ¶ï¼Œè€Œæ˜¯åˆ†é…æ¯”ä¾‹ # è¯¥æƒé‡è¡¨ç¤ºå®¹å™¨åœ¨ CPU ç«äº‰ä¸‹ï¼Œæƒé‡è¶Šé«˜åˆ™ä¼˜å…ˆçº§è¶Šé«˜ï¼Œä¼šå°½å¯èƒ½ä½¿ç”¨ CPU èµ„æºã€‚ # å¦‚æœè¿™ä¸¤ä¸ªå®¹å™¨éƒ½è¿è¡Œåœ¨ CPU å¿™ç¢Œçš„ç¯å¢ƒä¸‹(åªæœ‰åœ¨ å¤šå®¹å™¨å…±äº« CPU ä¸”ç«äº‰èµ„æº çš„æƒ…å†µä¸‹æ‰ç”Ÿæ•ˆ)ï¼š # c1 å°†è·å¾—å¤§çº¦ 2/3 çš„ CPU æ—¶é—´ # c2 å°†è·å¾—å¤§çº¦ 1/3 çš„ CPU æ—¶é—´ # å¦‚æœç³»ç»Ÿ CPU ç©ºé—²ï¼Œæ‰€æœ‰å®¹å™¨éƒ½å¯ä»¥ä½¿ç”¨ 100% çš„ CPUã€‚ docker run ç¤ºä¾‹ 12345678910111213# å¯åŠ¨ä¸€ä¸ªnginx å®¹å™¨docker run -d -p 80:80 --name nginx nginx# æ›¿æ¢nginxé•œåƒé»˜è®¤çš„å¯åŠ¨å‘½ä»¤ï¼Œnginx é•œåƒé»˜è®¤å¯åŠ¨ nginx æœåŠ¡ï¼Œæ­¤å‘½ä»¤ä¼šæ”¹ä¸ºæ‰§è¡Œ nginx -v æ˜¾ç¤ºç‰ˆæœ¬å·docker run --name test_nginx --entrypoint &quot;&quot; nginx nginx -v# æ‰§è¡Œè„šæœ¬æˆ–å‘½ä»¤ï¼Œè¿™é‡Œæ·»åŠ  --rm å‚æ•°ï¼Œè¡¨ç¤ºè¿è¡Œç»“æŸåè‡ªåŠ¨åˆ é™¤å®¹å™¨ï¼Œè¿™é‡Œæ˜¯å®‰è£… ping å‘½ä»¤docker run --rm ubuntu bash -c &quot;apt update &amp;&amp; apt install -y iputils-ping&quot;# äº¤äº’å¼æ‰§è¡Œ shell å‘½ä»¤ï¼Œæ‰§è¡Œå‘½ä»¤åä¼šè¿›å…¥å®¹å™¨çš„shelldocker run --rm -it ubuntu /bin/bash# è¿™æ ·ä¹Ÿå¯ä»¥ï¼Œå› ä¸º ubuntu çš„é»˜è®¤å¯åŠ¨å‘½ä»¤æ˜¯ /bin/bashdocker run --rm -it ubuntu# è½¬åˆ°åå°è¿è¡Œdocker run --rm -itd ubuntu docker stop : åœæ­¢å®¹å™¨ï¼Œå®¹å™¨ä¼˜é›…é€€å‡º 12345678# åœæ­¢å®¹å™¨ï¼Œé€šè¿‡å®¹å™¨åç§°docker stop test_nginx# åœæ­¢å®¹å™¨ï¼Œé€šè¿‡å®¹å™¨IDdocker stop 5d7c0c5d5c0c# åœæ­¢æ‰€æœ‰æ­£åœ¨è¿è¡Œçš„å®¹å™¨docker stop $(docker ps -q)# ç­‰å¾…5ç§’åå¼ºåˆ¶å…³é—­docker stop -t 5 test_nginx docker kill : å¼ºåˆ¶åœæ­¢å®¹å™¨ å½“å®¹å™¨å®Œå…¨å¡æ­»ã€æŒ‚èµ·ã€ä¸å“åº” stop å‘½ä»¤æ—¶ä½¿ç”¨ 123docker kill test_nginxdocker kill 5d7c0c5d5c0cdocker kill $(docker ps -q) docker restart : é‡å¯å®¹å™¨ 123docker restart test_nginxdocker restart 5d7c0c5d5c0cdocker restart $(docker ps -q) docker pause : æš‚åœå®¹å™¨ æš‚åœåå®¿ä¸»æœºå°†ä¸å†ä¸ºå®¹å™¨åˆ†é…CPUæ—¶é—´ç‰‡ï¼Œä½†å†…å­˜ä¾ç„¶æœ‰æ•ˆï¼Œä½ å¯ä»¥ç†è§£ä¸ºæ­¤æ—¶ä¸ºå®¹å™¨ä¿å­˜äº†å¿«ç…§ 123docker pause test_nginxdocker pause 5d7c0c5d5c0cdocker pause $(docker ps -q) docker unpause : æ¢å¤å®¹å™¨ 123docker unpause test_nginxdocker unpause 5d7c0c5d5c0cdocker unpause $(docker ps -q) docker ps : æŸ¥çœ‹å®¹å™¨åˆ—è¡¨ 1234567891011121314# æ˜¾ç¤ºæ‰€æœ‰æ­£åœ¨è¿è¡Œçš„å®¹å™¨docker ps# æ˜¾ç¤ºæ‰€æœ‰å®¹å™¨docker ps -a# æ˜¾ç¤ºæ‰€æœ‰æ­£åœ¨è¿è¡Œçš„å®¹å™¨çš„IDdocker ps -q# ä¸æˆªæ–­è¾“å‡ºï¼Œæ­¤æ—¶ COMMAND åˆ—ä¼šæ˜¾ç¤ºå®Œæ•´çš„å‘½ä»¤docker ps -notrunc# æ˜¾ç¤ºæœ€è¿‘åˆ›å»ºçš„5æ¡å®¹å™¨docker ps -n 5# è¿‡æ»¤å™¨ï¼Œæ˜¾ç¤ºçŠ¶æ€ä¸ºexitedçš„å®¹å™¨docker ps -a --filter &quot;status=exited&quot;# æŒ‡å®šæ¨¡æ¿ï¼Œåªæ˜¾ç¤º ID å’Œ Namesdocker ps --format &quot;&#123;&#123;.ID&#125;&#125;: &#123;&#123;.Names&#125;&#125;&quot; docker inspect : æŸ¥çœ‹å®¹å™¨ä¿¡æ¯ 12345678910111213141516# æŸ¥çœ‹å®¹å™¨ä¿¡æ¯docker inspect &lt;container_id&gt;# è·å–å®¹å™¨åç§°docker inspect --format=&#x27;&#123;&#123;.Name&#125;&#125;&#x27; &lt;container_id | container_name&gt;# è·å–å®¹å™¨é•œåƒdocker inspect --format=&#x27;&#123;&#123;.Config.Image&#125;&#125;&#x27; &lt;container_id | container_name&gt;# è·å–å®¹å™¨ç¯å¢ƒå˜é‡docker inspect --format=&#x27;&#123;&#123;.Config.Env&#125;&#125;&#x27; &lt;container_id | container_name&gt;# è·å–å®¹å™¨çŠ¶æ€ï¼Œå‰é¢çš„ json è¡¨ç¤ºè¾“å‡ºä¸º json æ ¼å¼docker inspect --format=&#x27;&#123;&#123;json .State&#125;&#125;&#x27; &lt;container_id | container_name&gt;# è·å–å®¹å™¨å†…å­˜é™åˆ¶docker inspect --format=&#x27;&#123;&#123;.HostConfig.Memory&#125;&#125;&#x27; &lt;container_id | container_name&gt;# è·å–å®¹å™¨labeldocker inspect --format=&#x27;&#123;&#123;json .Config.Labels&#125;&#125;&#x27; &lt;container_id | container_name&gt;# è·å–å®¹å™¨çš„ç½‘ç»œä¿¡æ¯docker inspect --format=&#x27;&#123;&#123;json .NetworkSettings&#125;&#125;&#x27; &lt;container_id | container_name&gt; docker logs : è·å–å®¹å™¨æ—¥å¿— 12345678910111213141516# è·å–å®¹å™¨æ—¥å¿—docker logs &lt;container_id | container_name&gt;# è·å–å®¹å™¨å®æ—¶æ—¥å¿—docker logs -f &lt;container_id | container_name&gt;# è·å–å®¹å™¨æœ€æ–°çš„ 10 è¡Œæ—¥å¿—docker logs -n 10 &lt;container_id | container_name&gt;# è·å–å®¹å™¨çš„å¸¦æ—¶é—´æˆ³çš„æ—¥å¿—docker logs -t &lt;container_id | container_name&gt;# è·å–å®¹å™¨çš„æ—¥å¿—ï¼Œä» 1 å°æ—¶å‰å¼€å§‹docker logs --since 1h &lt;container_id | container_name&gt;# è·å–å®¹å™¨çš„æ—¥å¿—ï¼Œç›´åˆ° 1 å°æ—¶å‰docker logs --until 1h &lt;container_id | container_name&gt;# è·å–å®¹å™¨çš„è¯¦ç»†æ—¥å¿—docker logs --details &lt;container_id | container_name&gt;# è·å–å®¹å™¨çš„æ—¥å¿—ï¼Œä» 2 å°æ—¶å‰å¼€å§‹ï¼Œç›´åˆ° 1 å°æ—¶å‰docker logs --since 2h --until 1h &lt;container_id | container_name&gt; docker exec : åœ¨å·²ç»è¿è¡Œçš„å®¹å™¨ä¸­æ‰§è¡Œå‘½ä»¤ 1234# åœ¨å·²ç»è¿è¡Œçš„å®¹å™¨ä¸­æ‰§è¡Œå‘½ä»¤docker exec &lt;container_id | container_name&gt; &lt;command&gt;# è¿›å…¥å®¹å™¨shelldocker exec -it &lt;container_id | container_name&gt; bash docker rename : é‡å‘½åå®¹å™¨ 1docker rename &lt;old_container_name&gt; &lt;new_container_name&gt; docker cp : å®¹å™¨ä¸å®¿ä¸»æœºé—´å¤åˆ¶æ–‡ä»¶ 123456# å®¿ä¸»æœº -&gt; å®¹å™¨# docker cp &lt;host_path&gt; &lt;container_id | container_name&gt;:&lt;container_path&gt;docker cp ./docker-command-container.md nginx:/tmp# å®¹å™¨ -&gt; å®¿ä¸»æœº# docker cp &lt;container_id | container_name&gt;:&lt;container_path&gt; &lt;host_path&gt;docker cp nginx:/tmp/docker-command-container.md ./ docker rm : åˆ é™¤å®¹å™¨ 1234# åˆ é™¤æŒ‡å®šå®¹å™¨docker rm &lt;container_id | container_name&gt;# åˆ é™¤æ‰€æœ‰å®¹å™¨docker rm $(docker ps -aq) docker container prune : åˆ é™¤æ‰€æœ‰åœæ­¢çš„å®¹å™¨ 1docker container prune docker update : æ›´æ–°å®¹å™¨é…ç½® 1234# æ›´æ–°æŒ‡å®šå®¹å™¨çš„CPUæ ¸æ•°å’Œå†…å­˜å¤§å°docker update --cpus=2 --memory=2g &lt;container_id | container_name&gt;# æ›´æ–°æŒ‡å®šå®¹å™¨è‡ªåŠ¨é‡å¯docker update --restart=always &lt;container_id | container_name&gt; å¹¶ä¸æ˜¯æ‰€æœ‰çš„é…ç½®éƒ½æ”¯æŒæ›´æ–°ï¼Œupdate å‘½ä»¤åªæ”¯æŒå¦‚ä¸‹é…ç½®ï¼ŒåŸºæœ¬ä¸Šä¹Ÿå°±åªèƒ½è°ƒä¸€ä¸‹cpuå’Œå†…å­˜ï¼Œä»¥åŠè‡ªåŠ¨é‡å¯ç­–ç•¥ï¼Œæ‰€ä»¥åˆ¶ä½œå®¹å™¨æ—¶ä¸€å®šè¦åšå¥½è§„åˆ’ã€‚ å‚æ•°å è¯´æ˜ ç¤ºä¾‹å€¼ --blkio-weight è®¾ç½® Block IO çš„ç›¸å¯¹æƒé‡ï¼ŒèŒƒå›´æ˜¯ 10 åˆ° 1000ï¼Œè®¾ç½®ä¸º 0 è¡¨ç¤ºç¦ç”¨ï¼ˆé»˜è®¤å€¼ä¸º 0ï¼‰ --blkio-weight=500 --cpu-period è®¾ç½® CPU CFSï¼ˆå®Œå…¨å…¬å¹³è°ƒåº¦å™¨ï¼‰çš„å‘¨æœŸé™åˆ¶ï¼ˆå•ä½ï¼šå¾®ç§’ï¼‰ --cpu-period=100000 --cpu-quota è®¾ç½® CPU CFS çš„é…é¢é™åˆ¶ï¼ˆå•ä½ï¼šå¾®ç§’ï¼‰ --cpu-quota=50000 --cpu-rt-period è®¾ç½®å®æ—¶ CPU çš„è°ƒåº¦å‘¨æœŸï¼ˆå•ä½ï¼šå¾®ç§’ï¼‰ --cpu-rt-period=1000000 --cpu-rt-runtime è®¾ç½®å®æ—¶ CPU çš„è¿è¡Œæ—¶é—´é™åˆ¶ï¼ˆå•ä½ï¼šå¾®ç§’ï¼‰ --cpu-rt-runtime=950000 -c, --cpu-shares è®¾ç½® CPU å…±äº«æƒé‡ï¼Œé»˜è®¤å€¼ä¸º 1024 --cpu-shares=512 --cpus é™åˆ¶å®¹å™¨ä½¿ç”¨çš„ CPU æ•°é‡ï¼ˆæ”¯æŒå°æ•°ï¼‰ --cpus=1.5 --cpuset-cpus æŒ‡å®šå®¹å™¨å¯ä»¥åœ¨å“ªäº› CPU ä¸Šè¿è¡Œï¼ˆå¦‚ 0-3ã€0,1ï¼‰ --cpuset-cpus=&quot;0,1&quot; --cpuset-mems æŒ‡å®šå®¹å™¨å¯ä»¥ä½¿ç”¨å“ªäº›å†…å­˜èŠ‚ç‚¹ï¼ˆå¦‚ 0-3ã€0,1ï¼‰ï¼Œé€‚ç”¨äº NUMA ç³»ç»Ÿ --cpuset-mems=&quot;0&quot; -m, --memory è®¾ç½®å†…å­˜é™åˆ¶ï¼ˆä¾‹å¦‚ 512mã€2gï¼‰ --memory=1g --memory-reservation è®¾ç½®å†…å­˜è½¯é™åˆ¶ï¼ˆä½äº --memory çš„å€¼æ—¶ï¼Œå…è®¸ç³»ç»Ÿåœ¨å‹åŠ›è¾ƒå°æ—¶å›æ”¶ï¼‰ --memory-reservation=512m --memory-swap è®¾ç½® swap é™åˆ¶ï¼ˆå†…å­˜ + swap æ€»å’Œï¼‰ï¼Œè®¾ä¸º -1 è¡¨ç¤ºæ— é™åˆ¶ --memory-swap=2g --pids-limit è®¾ç½®å®¹å™¨çš„æœ€å¤§è¿›ç¨‹æ•°é‡ï¼Œè®¾ä¸º -1 è¡¨ç¤ºæ— é™åˆ¶ --pids-limit=100 --restart è®¾ç½®å®¹å™¨é€€å‡ºåçš„é‡å¯ç­–ç•¥ --restart=always docker stats : æ˜¾ç¤ºå®¹å™¨çš„å®æ—¶èµ„æºä½¿ç”¨æƒ…å†µ 12345678910111213141516171819202122232425262728# æ˜¾ç¤ºæ‰€æœ‰å®¹å™¨çš„å®æ—¶èµ„æºä½¿ç”¨æƒ…å†µdocker stats## è¾“å‡ºCONTAINER ID NAME CPU % MEM USAGE / LIMIT MEM % NET I/O BLOCK I/O PIDS15caf520e3a5 nginx 0.00% 10.22MiB / 7.752GiB 0.13% 6.38kB / 2.61kB 0B / 28.7kB 13b680087420b8 dockge 0.01% 199.5MiB / 7.752GiB 2.51% 6.44kB / 1.48kB 94.8MB / 0B 24861dd9c1475f remote-api 0.00% 4.188MiB / 7.752GiB 0.05% 2.77kB / 126B 3.31MB / 0B 1### CONTAINER ID ä¸ NAMEï¼šå®¹å™¨ ID ä¸åç§°ã€‚### CPU % ä¸ MEM %ï¼šå®¹å™¨ä½¿ç”¨çš„ CPU å’Œå†…å­˜çš„ç™¾åˆ†æ¯”ã€‚### MEM USAGE / LIMITï¼šå®¹å™¨æ­£åœ¨ä½¿ç”¨çš„æ€»å†…å­˜ï¼Œä»¥åŠå…è®¸ä½¿ç”¨çš„å†…å­˜æ€»é‡ã€‚### NET I/Oï¼šå®¹å™¨é€šè¿‡å…¶ç½‘ç»œæ¥å£å‘é€å’Œæ¥æ”¶çš„æ•°æ®é‡ã€‚### BLOCK I/Oï¼šå®¹å™¨ä»ä¸»æœºä¸Šçš„å—è®¾å¤‡è¯»å–å’Œå†™å…¥çš„æ•°æ®é‡ã€‚### PIDsï¼šå®¹å™¨åˆ›å»ºçš„è¿›ç¨‹æˆ–çº¿ç¨‹æ•°ã€‚# åˆ—å‡ºæ‰€æœ‰å®¹å™¨çš„èµ„æºä½¿ç”¨æƒ…å†µï¼ŒåŒ…æ‹¬è¿è¡Œå’Œåœæ­¢çš„docker stats -a# å±•ç¤ºå½“å‰çŠ¶æ€å°±ç›´æ¥é€€å‡ºäº†ï¼Œä¸å†å®æ—¶æ›´æ–°ã€‚docker stats --no-stream# æŒ‡å®šè¾“å‡ºæ¨¡æ¿ï¼Œè¿™é‡ŒåŠ ä¸åŠ  table éƒ½å¯ä»¥docker stats --no-stream --format &quot;table &#123;&#123;.Name&#125;&#125;\\t&#123;&#123;.CPUPerc&#125;&#125;\\t&#123;&#123;.MemUsage&#125;&#125;&quot;# è¾“å‡ºjsonæ ¼å¼docker stats --no-stream --format json# æŒ‡å®šå®¹å™¨docker stats &lt;container_id | container_name&gt; docker top : æŸ¥çœ‹æ­£åœ¨è¿è¡Œçš„è¿›ç¨‹ 12# docker top &lt;container_id | container_name&gt; [ps options]docker top nginx docker port : åˆ—å‡ºæŒ‡å®šçš„å®¹å™¨çš„ç«¯å£æ˜ å°„ 123# docker port &lt;container_id | container_name&gt;$ docker port nginx80/tcp -&gt; 0.0.0.0:8081 docker diff : åˆ—å‡ºå®¹å™¨è¿è¡Œæ—¶å¯¹æ–‡ä»¶ç³»ç»Ÿçš„ä¿®æ”¹ 1234567891011121314151617181920# docker diff &lt;container_id | container_name&gt;$ docker diff nginxC /rootA /root/.bash_historyC /runA /run/nginx.pidC /tmpA /tmp/demo.pyC /varC /var/cacheC /var/cache/nginxA /var/cache/nginx/client_tempA /var/cache/nginx/fastcgi_tempA /var/cache/nginx/proxy_tempA /var/cache/nginx/scgi_tempA /var/cache/nginx/uwsgi_tempC /etcC /etc/nginxC /etc/nginx/conf.dC /etc/nginx/conf.d/default.conf å‰ç¼€å«ä¹‰è¯´æ˜ï¼š æ ‡å¿— å«ä¹‰ è¯´æ˜ A Addedï¼ˆæ–°å¢ï¼‰ æ–‡ä»¶æˆ–ç›®å½•æ˜¯å®¹å™¨è¿è¡Œåæ–°å¢çš„ C Changedï¼ˆä¿®æ”¹ï¼‰ æ–‡ä»¶æˆ–ç›®å½•æ˜¯å·²æœ‰çš„ï¼Œä½†å†…å®¹æˆ–å…ƒæ•°æ®ï¼ˆå¦‚æƒé™ã€æ—¶é—´æˆ³ç­‰ï¼‰è¢«ä¿®æ”¹äº† D Deletedï¼ˆåˆ é™¤ï¼‰ æ–‡ä»¶æˆ–ç›®å½•æ˜¯å­˜åœ¨äºåŸé•œåƒä¸­çš„ï¼Œä½†åœ¨å®¹å™¨ä¸­è¢«åˆ é™¤ docker commit : ä»å®¹å™¨åˆ›å»ºä¸€ä¸ªæ–°çš„é•œåƒ 12# docker commit &lt;container_id | container_name&gt; [image_name[:tag]]docker commit nginx nginx:v1.0 docker export : å¯¼å‡ºå®¹å™¨å†…å®¹ä¸º tar æ–‡ä»¶ 123docker export nginx &gt; nginx.tardcoker export -o nginx.tar nginxdocker export nginx | gzip &gt; nginx.tar.gz Docker Export / Save / Commit å‘½ä»¤å¯¹æ¯”ä¸å¯¼å…¥æ–¹å¼ä¸€è§ˆè¡¨ å‘½ä»¤ æ“ä½œå¯¹è±¡ è¾“å‡ºå†…å®¹ æ˜¯å¦åŒ…å«å†å²å±‚ï¼ˆé•œåƒå±‚ï¼‰ æ˜¯å¦ä¿ç•™å…ƒæ•°æ®ï¼ˆæ ‡ç­¾ã€å‘½ä»¤ç­‰ï¼‰ å…¸å‹ç”¨é€” å¯¼å…¥å‘½ä»¤ docker export å®¹å™¨ å®¹å™¨çš„æ–‡ä»¶ç³»ç»Ÿï¼ˆtar å½’æ¡£ï¼‰ âŒ å¦ âŒ å¦ å¤‡ä»½å®¹å™¨æ–‡ä»¶ç³»ç»Ÿæˆ–è¿ç§»å®¹å™¨çŠ¶æ€ docker import &lt;tar&gt; &lt;image:tag&gt; docker save é•œåƒ é•œåƒçš„å®Œæ•´å†…å®¹ï¼ˆå«æ‰€æœ‰å±‚çš„ tarï¼‰ âœ… æ˜¯ âœ… æ˜¯ åˆ†å‘æˆ–å¤‡ä»½é•œåƒ docker load &lt; &lt;tar&gt; docker commit å®¹å™¨ åˆ›å»ºä¸€ä¸ªæ–°çš„é•œåƒ âœ… æ˜¯ï¼ˆä½†åªä¸€å±‚ï¼‰ âœ… æ˜¯ å°†å½“å‰å®¹å™¨çŠ¶æ€æ‰“åŒ…æˆæ–°é•œåƒ ä¸é€‚ç”¨ï¼ˆç›´æ¥ç”Ÿæˆé•œåƒï¼‰","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» Docker å‘½ä»¤ ä¸­ å®¹å™¨ç®¡ç† ç›¸å…³å‘½ä»¤ Dockerå®˜æ–¹æ–‡æ¡£","date_published":"2025-05-27T13:30:05.000Z","tags":["æŠ€æœ¯","docker","docker"]},{"id":"https://blog.hanqunfeng.com/2025/05/26/docker-dockerfile/","url":"https://blog.hanqunfeng.com/2025/05/26/docker-dockerfile/","title":"Docker å‘½ä»¤ ä¹‹ Dockerfile","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç» Docker å‘½ä»¤ ä¸­ Dockerfile çš„ä½¿ç”¨æ–¹æ³•</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://docs.docker.com\">Dockerå®˜æ–¹æ–‡æ¡£</a></p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://docs.docker.com/engine/reference/builder/\">Dockerfileå®˜æ–¹æ–‡æ¡£</a></p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"Dockerfile-æ˜¯ä»€ä¹ˆï¼Ÿ\">Dockerfile æ˜¯ä»€ä¹ˆï¼Ÿ</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Dockerå¯ä»¥é€šè¿‡è¯»å– <code>Dockerfile</code> ä¸­çš„æŒ‡ä»¤æ¥è‡ªåŠ¨æ„å»ºé•œåƒã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><code>Dockerfile</code> æ˜¯ä¸€ä¸ªæ–‡æœ¬æ–‡æ¡£ï¼Œå…¶ä¸­åŒ…å«ç”¨æˆ·å¯ä»¥åœ¨å‘½ä»¤è¡Œä¸Šè°ƒç”¨ä»¥ç»„è£…é•œåƒçš„æ‰€æœ‰æŒ‡ä»¤ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å¯ä»¥åœ¨Dockerfileä¸­ä½¿ç”¨çš„æŒ‡ä»¤ï¼š</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>æŒ‡ä»¤</th>\n<th>ä¸­æ–‡æè¿°</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>ADD</strong></td>\n<td>å°†æœ¬åœ°æˆ–è¿œç¨‹çš„æ–‡ä»¶/ç›®å½•æ·»åŠ åˆ°é•œåƒä¸­ï¼Œæ”¯æŒè‡ªåŠ¨è§£å‹ <code>.tar</code> æ–‡ä»¶å’Œä½¿ç”¨ URL ä¸‹è½½è¿œç¨‹èµ„æºã€‚é€šå¸¸æ¨èä½¿ç”¨ <code>COPY</code>ï¼Œé™¤ééœ€è¦è¿™äº›é«˜çº§åŠŸèƒ½ã€‚</td>\n</tr>\n<tr>\n<td><strong>ARG</strong></td>\n<td>å®šä¹‰æ„å»ºé˜¶æ®µä½¿ç”¨çš„å˜é‡ï¼Œå¯åœ¨ <code>docker build</code> å‘½ä»¤ä¸­é€šè¿‡ <code>--build-arg</code> ä¼ å…¥ï¼Œå˜é‡ä»…åœ¨æ„å»ºæ—¶æœ‰æ•ˆï¼Œä¸ä¼šä¿ç•™åœ¨æœ€ç»ˆé•œåƒä¸­ã€‚</td>\n</tr>\n<tr>\n<td><strong>CMD</strong></td>\n<td>æŒ‡å®šå®¹å™¨é»˜è®¤æ‰§è¡Œçš„å‘½ä»¤å’Œå‚æ•°ï¼Œå®¹å™¨è¿è¡Œæ—¶è‹¥æœªæŒ‡å®šå‘½ä»¤ï¼Œåˆ™ä½¿ç”¨è¯¥æŒ‡ä»¤è®¾ç½®çš„å‘½ä»¤ã€‚å¦‚æœé…ç½®äº†å¤šä¸ª<code>CMD</code>ï¼Œåˆ™åªæœ‰æœ€åä¸€ä¸ªç”Ÿæ•ˆã€‚å’Œ<code>ENTRYPOINT</code>å…±åŒä½¿ç”¨æ—¶ï¼Œä½œä¸ºä¼ é€’ç»™<code>ENTRYPOINT</code>çš„å‚æ•°ã€‚å¯è¢« <code>docker run</code> æä¾›çš„å‘½ä»¤è¦†ç›–ã€‚</td>\n</tr>\n<tr>\n<td><strong>COPY</strong></td>\n<td>å°†æ„å»ºä¸Šä¸‹æ–‡ä¸­çš„æ–‡ä»¶æˆ–ç›®å½•å¤åˆ¶åˆ°é•œåƒä¸­ã€‚ç›¸æ¯” <code>ADD</code> æ›´ç®€å•ã€å®‰å…¨ï¼Œæ¨èä¼˜å…ˆä½¿ç”¨ã€‚</td>\n</tr>\n<tr>\n<td><strong>ENTRYPOINT</strong></td>\n<td>æŒ‡å®šå®¹å™¨å¯åŠ¨æ—¶çš„ä¸»å‘½ä»¤ï¼Œä¸å®¹æ˜“è¢« <code>docker run</code> ä¸­çš„å‘½ä»¤è¦†ç›–ã€‚å¯ä¸ <code>CMD</code> é…åˆä½¿ç”¨ï¼Œç”¨äºæä¾›é»˜è®¤å‚æ•°ã€‚</td>\n</tr>\n<tr>\n<td><strong>ENV</strong></td>\n<td>è®¾ç½®ç¯å¢ƒå˜é‡ï¼Œå˜é‡å°†åœ¨æ„å»ºå’Œå®¹å™¨è¿è¡Œæ—¶å‡å¯ä½¿ç”¨ã€‚ä¾‹å¦‚ï¼šé…ç½®åº”ç”¨å‚æ•°æˆ–ç³»ç»Ÿè·¯å¾„ç­‰ã€‚</td>\n</tr>\n<tr>\n<td><strong>EXPOSE</strong></td>\n<td>å£°æ˜å®¹å™¨è¿è¡Œæ—¶å°†å¼€æ”¾çš„ç«¯å£ï¼Œä»…ç”¨äºæ–‡æ¡£è¯´æ˜æˆ–ä¸å®¹å™¨ç¼–æ’å·¥å…·é…åˆï¼Œä¸ä¼šè‡ªåŠ¨è¿›è¡Œç«¯å£æ˜ å°„ã€‚</td>\n</tr>\n<tr>\n<td><strong>FROM</strong></td>\n<td>æŒ‡å®šåŸºç¡€é•œåƒï¼Œæ˜¯ Dockerfile çš„èµ·ç‚¹ã€‚ä¹Ÿå¯ä»¥ç”¨äºå¤šé˜¶æ®µæ„å»ºï¼Œé€šè¿‡å¤šæ¬¡ä½¿ç”¨ <code>FROM</code> æŒ‡ä»¤åˆ›å»ºå¤šä¸ªæ„å»ºé˜¶æ®µã€‚</td>\n</tr>\n<tr>\n<td><strong>HEALTHCHECK</strong></td>\n<td>å®šä¹‰å®¹å™¨å¥åº·æ£€æŸ¥å‘½ä»¤ï¼Œç”¨äºå®šæœŸæ£€æµ‹å®¹å™¨å†…éƒ¨æœåŠ¡çš„å¥åº·çŠ¶æ€ï¼Œå¯ç»“åˆå®¹å™¨ç¼–æ’ç³»ç»Ÿå®ç°æ•…éšœè‡ªåŠ¨æ¢å¤ã€‚</td>\n</tr>\n<tr>\n<td><strong>LABEL</strong></td>\n<td>ä¸ºé•œåƒæ·»åŠ é”®å€¼å¯¹å½¢å¼çš„å…ƒæ•°æ®ï¼Œä¾‹å¦‚ç‰ˆæœ¬ã€ç»´æŠ¤è€…ã€ç”¨é€”è¯´æ˜ç­‰ï¼Œæ–¹ä¾¿é•œåƒç®¡ç†ä¸è‡ªåŠ¨åŒ–å¤„ç†ã€‚</td>\n</tr>\n<tr>\n<td><strong>MAINTAINER</strong></td>\n<td>ï¼ˆå·²å¼ƒç”¨ï¼‰ç”¨äºæŒ‡å®šé•œåƒç»´æŠ¤è€…ä¿¡æ¯ï¼Œæ¨èæ”¹ç”¨ <code>LABEL</code> æ¥è®¾ç½®ä½œè€…ä¿¡æ¯ã€‚</td>\n</tr>\n<tr>\n<td><strong>ONBUILD</strong></td>\n<td>å®šä¹‰ä¸€ä¸ªè§¦å‘æŒ‡ä»¤ï¼Œå½“å½“å‰é•œåƒä½œä¸ºåŸºç¡€é•œåƒè¢«å…¶ä»– Dockerfile ä½¿ç”¨æ—¶è‡ªåŠ¨æ‰§è¡Œã€‚å¸¸ç”¨äºåŸºç¡€é•œåƒçš„é¢„è®¾è¡Œä¸ºã€‚</td>\n</tr>\n<tr>\n<td><strong>RUN</strong></td>\n<td>æ‰§è¡Œä¸€æ¡å‘½ä»¤å¹¶æäº¤ç»“æœä½œä¸ºæ–°é•œåƒå±‚ï¼Œå¸¸ç”¨äºå®‰è£…è½¯ä»¶åŒ…ã€å¤åˆ¶æ–‡ä»¶ã€è®¾ç½®æƒé™ç­‰æ„å»ºæ“ä½œã€‚</td>\n</tr>\n<tr>\n<td><strong>SHELL</strong></td>\n<td>æ›´æ”¹ Dockerfile ä¸­åç»­ <code>RUN</code>ã€<code>CMD</code>ã€<code>ENTRYPOINT</code> ç­‰æŒ‡ä»¤çš„é»˜è®¤ shellï¼ˆå¦‚ä½¿ç”¨ <code>sh</code> æˆ– <code>powershell</code>ï¼‰ã€‚</td>\n</tr>\n<tr>\n<td><strong>STOPSIGNAL</strong></td>\n<td>è®¾ç½®å®¹å™¨ç»ˆæ­¢æ—¶å‘é€çš„ç³»ç»Ÿä¿¡å·ï¼ˆå¦‚ <code>SIGTERM</code>ï¼‰ï¼Œç”¨äºä¼˜é›…å…³é—­åº”ç”¨ã€‚</td>\n</tr>\n<tr>\n<td><strong>USER</strong></td>\n<td>è®¾ç½®æ‰§è¡Œåç»­å‘½ä»¤æ—¶æ‰€ä½¿ç”¨çš„ç”¨æˆ·å’Œç”¨æˆ·ç»„ï¼Œå¢å¼ºå®¹å™¨çš„å®‰å…¨æ€§ï¼Œé¿å…ä½¿ç”¨ root æƒé™ã€‚</td>\n</tr>\n<tr>\n<td><strong>VOLUME</strong></td>\n<td>å®šä¹‰å®¹å™¨å†…çš„æŒ‚è½½ç‚¹ï¼Œç”¨äºæŒä¹…åŒ–æ•°æ®æˆ–ä¸å®¿ä¸»æœº/å…¶ä»–å®¹å™¨å…±äº«æ•°æ®ã€‚è¿è¡Œå®¹å™¨æ—¶å¯æŒ‡å®šæŒ‚è½½è·¯å¾„ã€‚</td>\n</tr>\n<tr>\n<td><strong>WORKDIR</strong></td>\n<td>è®¾ç½®å·¥ä½œç›®å½•ï¼Œç›¸å½“äºæ‰§è¡Œ <code>cd</code>ï¼Œç”¨äºç®€åŒ–åç»­å‘½ä»¤ä¸­çš„è·¯å¾„ã€‚è‹¥ç›®å½•ä¸å­˜åœ¨åˆ™è‡ªåŠ¨åˆ›å»ºã€‚</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ„å»ºé˜¶æ®µæŒ‡ä»¤ï¼šFROM, ARG, ENV, COPY, ADD, RUN, WORKDIR, LABEL, USER, SHELL, ONBUILD</p>\n</li>\n<li class=\"lvl-2\">\n<p>å¯åŠ¨é…ç½®æŒ‡ä»¤ï¼šCMD, ENTRYPOINT, HEALTHCHECK, EXPOSE, VOLUME, STOPSIGNAL</p>\n</li>\n</ul>\n<h2 id=\"Dockerfile-æŒ‡ä»¤ä»‹ç»\">Dockerfile æŒ‡ä»¤ä»‹ç»</h2>\n<h3 id=\"FROM\">FROM</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>FROM æŒ‡ä»¤ç”¨äºæŒ‡å®šåŸºç¡€é•œåƒï¼ˆbase imageï¼‰ï¼Œæ˜¯æ¯ä¸€ä¸ª Dockerfile ä¸­å¿…é¡»çš„ç¬¬ä¸€æ¡æŒ‡ä»¤ã€‚æ‰€æœ‰åç»­æŒ‡ä»¤éƒ½æ˜¯åŸºäºè¿™ä¸ªåŸºç¡€é•œåƒæ„å»ºçš„ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>è¯­æ³•</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">FROM &lt;image&gt;[:&lt;tag&gt;] [AS &lt;stage-name&gt;]</span><br><span class=\"line\"><span class=\"comment\"># è¯´æ˜ï¼š</span></span><br><span class=\"line\"><span class=\"comment\">#   &lt;image&gt;ï¼šé•œåƒåç§°ï¼ˆå¯ä»¥æ˜¯æœ¬åœ°å·²æœ‰çš„ï¼Œä¹Ÿå¯ä»¥æ˜¯ä» Docker Hub æˆ–å…¶ä»–é•œåƒä»“åº“æ‹‰å–çš„ï¼‰</span></span><br><span class=\"line\"><span class=\"comment\">#   [:&lt;tag&gt;]ï¼šé•œåƒæ ‡ç­¾ï¼ˆå¯é€‰ï¼Œé»˜è®¤æ˜¯ latestï¼‰</span></span><br><span class=\"line\"><span class=\"comment\">#   [AS &lt;stage-name&gt;]ï¼šä¸ºè¯¥æ„å»ºé˜¶æ®µæŒ‡å®šåç§°ï¼Œç”¨äºå¤šé˜¶æ®µæ„å»º</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç¤ºä¾‹</p>\n</li>\n</ul>\n<figure class=\"highlight dockerfile\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ä½¿ç”¨æœ€æ–°ç‰ˆæœ¬çš„é•œåƒï¼ˆé»˜è®¤æ ‡ç­¾æ˜¯ latestï¼‰</span></span><br><span class=\"line\"><span class=\"keyword\">FROM</span> node</span><br><span class=\"line\"><span class=\"comment\"># ä½¿ç”¨æŒ‡å®šçš„æ ‡ç­¾</span></span><br><span class=\"line\"><span class=\"keyword\">FROM</span> node:<span class=\"number\">16.13</span>.<span class=\"number\">2</span>-alpine</span><br><span class=\"line\"><span class=\"comment\"># ä½¿ç”¨ç§æœ‰é•œåƒä»“åº“</span></span><br><span class=\"line\"><span class=\"keyword\">FROM</span> private.registry.com/my-image:latest</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ä½¿ç”¨å¤šé˜¶æ®µæ„å»º</span></span><br><span class=\"line\"><span class=\"keyword\">FROM</span> golang:<span class=\"number\">1.20</span> AS builder</span><br><span class=\"line\"><span class=\"keyword\">WORKDIR</span><span class=\"language-bash\"> /app</span></span><br><span class=\"line\"><span class=\"keyword\">COPY</span><span class=\"language-bash\"> . .</span></span><br><span class=\"line\"><span class=\"keyword\">RUN</span><span class=\"language-bash\"> go build -o myapp</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">FROM</span> alpine:latest</span><br><span class=\"line\"><span class=\"keyword\">COPY</span><span class=\"language-bash\"> --from=builder /app/myapp /usr/local/bin/myapp</span></span><br><span class=\"line\"><span class=\"keyword\">ENTRYPOINT</span><span class=\"language-bash\"> [<span class=\"string\">&quot;myapp&quot;</span>]</span></span><br><span class=\"line\"><span class=\"comment\">## è¿™é‡Œç”¨äº†ä¸¤ä¸ªé˜¶æ®µï¼š</span></span><br><span class=\"line\"><span class=\"comment\">###   builder é˜¶æ®µç”¨æ¥ç¼–è¯‘åº”ç”¨ï¼›</span></span><br><span class=\"line\"><span class=\"comment\">###   alpine é˜¶æ®µç”¨æ¥æ‰“åŒ…æœ€ç»ˆé•œåƒï¼ŒåªåŒ…å«ç¼–è¯‘å¥½çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå‡å°‘ä½“ç§¯ã€‚</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"WORKDIR\">WORKDIR</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>WORKDIR æŒ‡å®šäº†å·¥ä½œç›®å½•ï¼Œå³åç»­æ‰€æœ‰æŒ‡ä»¤ï¼ˆå¦‚ RUNã€CMDã€ENTRYPOINTã€COPYã€ADD ç­‰ï¼‰æ‰€è¿è¡Œçš„å½“å‰è·¯å¾„ï¼ˆworking directoryï¼‰ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å¦‚æœç›®å½•ä¸å­˜åœ¨ï¼ŒDocker ä¼šè‡ªåŠ¨åˆ›å»ºå®ƒã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>æ¯ä¸ª WORKDIR éƒ½ä¼šåˆ›å»ºä¸€å±‚é•œåƒï¼ˆlayerï¼‰ï¼Œæ‰€ä»¥ä¸è¦é‡å¤è®¾ç½®æ— æ„ä¹‰çš„è·¯å¾„ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>è¯­æ³•</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">WORKDIR &lt;path&gt;</span><br><span class=\"line\"><span class=\"comment\"># è¯´æ˜ï¼š</span></span><br><span class=\"line\"><span class=\"comment\">#   &lt;path&gt;ï¼šè¦åˆ‡æ¢çš„å·¥ä½œç›®å½•ï¼Œå¯ä»¥æ˜¯ç»å¯¹è·¯å¾„æˆ–ç›¸å¯¹è·¯å¾„ã€‚</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç¤ºä¾‹</p>\n</li>\n</ul>\n<figure class=\"highlight dockerfile\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># è®¾ç½®ç»å¯¹è·¯å¾„</span></span><br><span class=\"line\"><span class=\"keyword\">WORKDIR</span><span class=\"language-bash\"> /app</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># è¿ç»­è®¾ç½®å¤šä¸ªå·¥ä½œç›®å½•ï¼ˆé€å±‚åµŒå¥—ï¼‰</span></span><br><span class=\"line\"><span class=\"keyword\">WORKDIR</span><span class=\"language-bash\"> /var</span></span><br><span class=\"line\"><span class=\"keyword\">WORKDIR</span><span class=\"language-bash\"> www</span></span><br><span class=\"line\"><span class=\"keyword\">WORKDIR</span><span class=\"language-bash\"> html</span></span><br><span class=\"line\"><span class=\"comment\"># ç­‰åŒäº:</span></span><br><span class=\"line\"><span class=\"keyword\">WORKDIR</span><span class=\"language-bash\"> /var/www/html</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># é¿å…åœ¨ RUN cd some_dir åç»§ç»­æ‰§è¡Œä¾èµ–è·¯å¾„çš„å‘½ä»¤ï¼Œå› ä¸º Docker æ¯ä¸€æ¡æŒ‡ä»¤éƒ½æ˜¯æ–°çš„ shell å®ä¾‹ï¼Œcd ä¸ä¼šè·¨æŒ‡ä»¤ä¿ç•™ï¼Œåº”è¯¥æ”¹ç”¨ WORKDIRã€‚</span></span><br><span class=\"line\"><span class=\"keyword\">RUN</span><span class=\"language-bash\"> <span class=\"built_in\">cd</span> some_dir  <span class=\"comment\"># é”™è¯¯</span></span></span><br><span class=\"line\"><span class=\"keyword\">WORKDIR</span><span class=\"language-bash\"> some_dir <span class=\"comment\"># æ­£ç¡®</span></span></span><br></pre></td></tr></table></figure>\n<h3 id=\"ARG\">ARG</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ARG ç”¨äºåœ¨ æ„å»ºé•œåƒæ—¶ï¼ˆbuild-timeï¼‰ä¼ å…¥å‚æ•°ã€‚è¿™äº›å‚æ•°åªåœ¨ æ„å»ºé˜¶æ®µæœ‰æ•ˆï¼Œä¸ä¼šå‡ºç°åœ¨æœ€ç»ˆé•œåƒä¸­ï¼Œä¹Ÿä¸ä¼šåœ¨å®¹å™¨è¿è¡Œæ—¶è¢«ä¿ç•™ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>è¯­æ³•</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ARG &lt;name&gt;[=&lt;default_value&gt;]</span><br><span class=\"line\"><span class=\"comment\"># è¯´æ˜ï¼š</span></span><br><span class=\"line\"><span class=\"comment\">#   &lt;name&gt;ï¼šå‚æ•°åç§°</span></span><br><span class=\"line\"><span class=\"comment\">#   [=&lt;default_value&gt;]ï¼šå‚æ•°çš„é»˜è®¤å€¼ï¼Œå¦‚æœæœªä¼ å…¥å‚æ•°ï¼Œåˆ™ä½¿ç”¨é»˜è®¤å€¼ï¼Œå¦‚æœä¸ºè®¾ç½®default_valueï¼Œåˆ™æ„å»ºé•œåƒæ—¶å¿…é¡»ä¼ é€’å‚æ•°ï¼Œ--build-arg</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç¤ºä¾‹</p>\n</li>\n</ul>\n<figure class=\"highlight dockerfile\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å®šä¹‰ä¸€ä¸ªå‚æ•°ï¼Œåœ¨æ„å»ºé•œåƒæ—¶å¿…é¡»ä¼ å…¥å‚æ•°ï¼Œ--build-arg APP_ENV=development</span></span><br><span class=\"line\"><span class=\"keyword\">ARG</span> APP_ENV</span><br><span class=\"line\"><span class=\"comment\"># å¸¦é»˜è®¤å€¼çš„ ARG</span></span><br><span class=\"line\"><span class=\"keyword\">ARG</span> APP_ENV=development</span><br><span class=\"line\"><span class=\"comment\"># ä½¿ç”¨å‚æ•°</span></span><br><span class=\"line\"><span class=\"keyword\">RUN</span><span class=\"language-bash\"> <span class=\"built_in\">echo</span> <span class=\"string\">&quot;å½“å‰ç¯å¢ƒï¼š<span class=\"variable\">$&#123;APP_ENV&#125;</span>&quot;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ä¸ FROM ä¸€èµ·ç”¨ï¼ˆä» Docker 17.05 èµ·ï¼‰</span></span><br><span class=\"line\"><span class=\"keyword\">ARG</span> BASE=ubuntu</span><br><span class=\"line\"><span class=\"keyword\">FROM</span> $&#123;BASE&#125;:<span class=\"number\">22.04</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"ENV\">ENV</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ENV æŒ‡ä»¤ç”¨äºåœ¨é•œåƒæ„å»ºè¿‡ç¨‹ä¸­å®šä¹‰ç¯å¢ƒå˜é‡ï¼ˆEnvironment Variablesï¼‰ã€‚è¿™äº›å˜é‡å¯ä»¥åœ¨ä¹‹åçš„æ„å»ºæ­¥éª¤ï¼ˆæ¯”å¦‚ RUNã€CMD ç­‰ï¼‰ä¸­ä½¿ç”¨ï¼Œä¹Ÿä¼šåœ¨å®¹å™¨è¿è¡Œæ—¶ç”Ÿæ•ˆã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>è¯­æ³•</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ä¸¤ç§è¯­æ³•</span></span><br><span class=\"line\">ENV &lt;key&gt; &lt;value&gt;</span><br><span class=\"line\">ENV &lt;key&gt;=&lt;value&gt; ...</span><br><span class=\"line\"><span class=\"comment\"># è¯´æ˜ï¼š</span></span><br><span class=\"line\"><span class=\"comment\">#   &lt;key&gt;ï¼šç¯å¢ƒå˜é‡çš„åç§°</span></span><br><span class=\"line\"><span class=\"comment\">#   &lt;value&gt;ï¼šç¯å¢ƒå˜é‡çš„å€¼</span></span><br><span class=\"line\"><span class=\"comment\"># å¦‚æœå®šä¹‰å¤šä¸ªå˜é‡ï¼Œæ¨èä½¿ç”¨ key=value çš„å½¢å¼ã€‚</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç¤ºä¾‹</p>\n</li>\n</ul>\n<figure class=\"highlight dockerfile\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å®šä¹‰ä¸€ä¸ªç¯å¢ƒå˜é‡</span></span><br><span class=\"line\"><span class=\"keyword\">ENV</span> APP_ENV=production</span><br><span class=\"line\"><span class=\"comment\"># å®šä¹‰å¤šä¸ªå˜é‡</span></span><br><span class=\"line\"><span class=\"keyword\">ENV</span> APP_PORT=<span class=\"number\">8080</span> NODE_ENV=production</span><br><span class=\"line\"><span class=\"comment\"># ä½¿ç”¨å¤šè¡Œæ ¼å¼ï¼ˆæé«˜å¯è¯»æ€§ï¼‰</span></span><br><span class=\"line\"><span class=\"keyword\">ENV</span> PATH=<span class=\"string\">&quot;/usr/local/bin:$&#123;PATH&#125;&quot;</span> \\</span><br><span class=\"line\">    LANG=<span class=\"string\">&quot;en_US.UTF-8&quot;</span> \\</span><br><span class=\"line\">    TZ=<span class=\"string\">&quot;Asia/Shanghai&quot;</span></span><br><span class=\"line\"><span class=\"comment\"># ä¹Ÿå¯ä»¥åˆ†å¼€å®šä¹‰</span></span><br><span class=\"line\"><span class=\"keyword\">ENV</span> PATH=<span class=\"string\">&quot;/usr/local/bin:$PATH&quot;</span></span><br><span class=\"line\"><span class=\"keyword\">ENV</span> LANG=<span class=\"string\">&quot;en_US.UTF-8&quot;</span></span><br><span class=\"line\"><span class=\"keyword\">ENV</span> TZ=<span class=\"string\">&quot;Asia/Shanghai&quot;</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ³¨æ„ï¼šENV æŒ‡ä»¤å®šä¹‰çš„ç¯å¢ƒå˜é‡åœ¨æ„å»ºé˜¶æ®µå’Œè¿è¡Œé˜¶æ®µéƒ½ä¼šç”Ÿæ•ˆï¼Œä½†è¿è¡Œé˜¶æ®µä¼šè¦†ç›–æ„å»ºé˜¶æ®µå®šä¹‰çš„å˜é‡ã€‚</p>\n</li>\n</ul>\n<h3 id=\"LABEL\">LABEL</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>LABEL ç”¨äºä¸ºé•œåƒæ·»åŠ å…ƒæ•°æ®æ ‡ç­¾ï¼Œä»¥ <code>key=value</code> çš„å½¢å¼å­˜åœ¨ã€‚è¿™äº›æ ‡ç­¾å¯ä»¥æ˜¯ä½œè€…ä¿¡æ¯ã€ç‰ˆæœ¬æè¿°ã€ç”¨é€”è¯´æ˜ã€æ„å»ºæ—¶é—´ç­‰ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>æ—§çš„ <code>MAINTAINER</code> æŒ‡ä»¤ç°åœ¨å·²è¢«åºŸå¼ƒï¼Œæ¨èä½¿ç”¨ <code>LABEL</code> æ¥ä»£æ›¿ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>æ¯ä¸ª LABEL éƒ½ä¼šåˆ›å»ºä¸€å±‚é•œåƒï¼ˆlayerï¼‰ï¼Œæ¨èä¸€æ¬¡è®¾ç½®å¤šä¸ªã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>è¯­æ³•</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">LABEL &lt;key&gt;=&lt;value&gt; [&lt;key&gt;=&lt;value&gt;...]</span><br><span class=\"line\"><span class=\"comment\"># è¯´æ˜ï¼š</span></span><br><span class=\"line\"><span class=\"comment\">#   &lt;key&gt;ï¼šæ ‡ç­¾çš„é”®</span></span><br><span class=\"line\"><span class=\"comment\">#   &lt;value&gt;ï¼šæ ‡ç­¾çš„å€¼</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç¤ºä¾‹</p>\n</li>\n</ul>\n<figure class=\"highlight dockerfile\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æ·»åŠ ä¸€ä¸ªæ ‡ç­¾</span></span><br><span class=\"line\"><span class=\"keyword\">LABEL</span><span class=\"language-bash\"> maintainer=<span class=\"string\">&quot;yourname@example.com&quot;</span></span></span><br><span class=\"line\"><span class=\"comment\"># æ¢è¡Œæ ¼å¼ï¼ˆæ¨èï¼‰,ä»¥ä¸‹æ ‡ç­¾ç¬¦åˆ OCIï¼ˆOpen Container Initiativeï¼‰ é•œåƒè§„èŒƒ</span></span><br><span class=\"line\"><span class=\"keyword\">LABEL</span><span class=\"language-bash\"> \\</span></span><br><span class=\"line\"><span class=\"language-bash\">    org.opencontainers.image.title=<span class=\"string\">&quot;MyApp&quot;</span> \\</span></span><br><span class=\"line\"><span class=\"language-bash\">    org.opencontainers.image.description=<span class=\"string\">&quot;æ¼”ç¤ºé¡¹ç›®&quot;</span> \\</span></span><br><span class=\"line\"><span class=\"language-bash\">    org.opencontainers.image.version=<span class=\"string\">&quot;1.0.0&quot;</span> \\</span></span><br><span class=\"line\"><span class=\"language-bash\">    org.opencontainers.image.authors=<span class=\"string\">&quot;zhangsan@example.com&quot;</span></span></span><br></pre></td></tr></table></figure>\n<h3 id=\"USER\">USER</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>USER æŒ‡ä»¤ç”¨äºæŒ‡å®šåç»­æŒ‡ä»¤ï¼ˆå¦‚ RUNã€CMDã€ENTRYPOINTã€COPY ç­‰ï¼‰ä»¥å“ªä¸ªç”¨æˆ·èº«ä»½æ¥æ‰§è¡Œã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒDocker å®¹å™¨ä¸­çš„å‘½ä»¤ä»¥ root ç”¨æˆ·è¿è¡Œï¼Œè¿™è™½ç„¶çµæ´»ä½†ä¸å®‰å…¨ã€‚ä½¿ç”¨ USER å¯ä»¥è®©æˆ‘ä»¬åˆ‡æ¢åˆ°æ™®é€šç”¨æˆ·ï¼Œä»è€Œæå‡å®¹å™¨çš„å®‰å…¨æ€§ï¼Œé˜²æ­¢æ½œåœ¨çš„æƒé™æ»¥ç”¨ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>è¯­æ³•</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">USER &lt;user&gt;[:&lt;group&gt;]</span><br><span class=\"line\"><span class=\"comment\"># è¯´æ˜ï¼š</span></span><br><span class=\"line\"><span class=\"comment\">#   &lt;user&gt;ï¼šç”¨æˆ·åæˆ– UID</span></span><br><span class=\"line\"><span class=\"comment\">#   [:&lt;group&gt;]ï¼šå¯é€‰ï¼Œç”¨æˆ·ç»„åæˆ– GID</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç¤ºä¾‹</p>\n</li>\n</ul>\n<figure class=\"highlight dockerfile\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># è®¾ç½®ç”¨æˆ·</span></span><br><span class=\"line\"><span class=\"keyword\">USER</span> appuser</span><br><span class=\"line\"><span class=\"comment\"># è®¾ç½®ç”¨æˆ·ç»„</span></span><br><span class=\"line\"><span class=\"keyword\">USER</span> appuser:appgroup</span><br><span class=\"line\"><span class=\"comment\"># ä½¿ç”¨ UID å’Œ GID</span></span><br><span class=\"line\"><span class=\"keyword\">USER</span> <span class=\"number\">1000</span>:<span class=\"number\">1000</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¦‚æœåŸºç¡€é•œåƒä¸­æ²¡æœ‰ä½ æƒ³è¦çš„ç”¨æˆ·ï¼Œéœ€è¦åœ¨ Dockerfile ä¸­æ‰‹åŠ¨åˆ›å»º</p>\n</li>\n</ul>\n<figure class=\"highlight dockerfile\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åˆ›å»ºç”¨æˆ·å’Œç»„</span></span><br><span class=\"line\"><span class=\"keyword\">RUN</span><span class=\"language-bash\"> groupadd -r appgroup &amp;&amp; useradd -r -g appgroup appuser</span></span><br><span class=\"line\"><span class=\"comment\"># åˆ‡æ¢ç”¨æˆ·</span></span><br><span class=\"line\"><span class=\"keyword\">USER</span> appuser</span><br></pre></td></tr></table></figure>\n<h3 id=\"ADD\">ADD</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ADD ç”¨äºå°†æœ¬åœ°æ–‡ä»¶æˆ–ç›®å½•ã€è¿œç¨‹æ–‡ä»¶ï¼ˆURLï¼‰ æˆ– å‹ç¼©åŒ… å¤åˆ¶åˆ°é•œåƒä¸­çš„æŒ‡å®šä½ç½®ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å®ƒçš„åŠŸèƒ½ç±»ä¼¼äº COPYï¼Œä½†æ¯” COPY å¤šå‡ ä¸ªåŠŸèƒ½ï¼ˆè§£å‹ã€æ‹‰å–è¿œç¨‹æ–‡ä»¶ç­‰ï¼‰ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>è¯­æ³•</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ADD &lt;src&gt;... &lt;dest&gt;</span><br><span class=\"line\"><span class=\"comment\"># è¯´æ˜ï¼š</span></span><br><span class=\"line\"><span class=\"comment\">#   &lt;src&gt;ï¼šè¦å¤åˆ¶çš„æ–‡ä»¶æˆ–ç›®å½•ï¼Œå¯ä»¥æ˜¯æœ¬åœ°æ–‡ä»¶ã€è¿œç¨‹ URLã€å‹ç¼©åŒ…ç­‰</span></span><br><span class=\"line\"><span class=\"comment\">#   &lt;dest&gt;ï¼šç›®æ ‡è·¯å¾„</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç¤ºä¾‹</p>\n</li>\n</ul>\n<figure class=\"highlight dockerfile\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ä»æœ¬åœ°æ–‡ä»¶å¤åˆ¶</span></span><br><span class=\"line\"><span class=\"keyword\">ADD</span><span class=\"language-bash\"> app.jar /app.jar</span></span><br><span class=\"line\"><span class=\"comment\"># å¤åˆ¶å¤šä¸ª</span></span><br><span class=\"line\"><span class=\"keyword\">ADD</span><span class=\"language-bash\"> app1.jar app2.jar /app/</span></span><br><span class=\"line\"><span class=\"comment\"># é€šé…ç¬¦</span></span><br><span class=\"line\"><span class=\"keyword\">ADD</span><span class=\"language-bash\"> static-assets/*.html /app/public/</span></span><br><span class=\"line\"><span class=\"comment\"># ä»è¿œç¨‹ URL å¤åˆ¶</span></span><br><span class=\"line\"><span class=\"keyword\">ADD</span><span class=\"language-bash\"> https://example.com/app.jar /app.jar</span></span><br><span class=\"line\"><span class=\"comment\"># ä»å‹ç¼©åŒ…ä¸­å¤åˆ¶</span></span><br><span class=\"line\"><span class=\"keyword\">ADD</span><span class=\"language-bash\"> static-assets.tar.gz /app/public/</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ€ä½³å®è·µæ˜¯ä¼˜å…ˆä½¿ç”¨ COPYï¼Œåªæœ‰åœ¨éœ€è¦ ADD çš„é¢å¤–åŠŸèƒ½æ—¶æ‰ä½¿ç”¨å®ƒã€‚</p>\n</li>\n</ul>\n<h3 id=\"COPY\">COPY</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>COPY æŒ‡ä»¤ç”¨äºå°†ä¸»æœºä¸Šçš„æ–‡ä»¶æˆ–ç›®å½•å¤åˆ¶åˆ°é•œåƒçš„æ–‡ä»¶ç³»ç»Ÿä¸­ã€‚å®ƒæ˜¯æ„å»ºé•œåƒè¿‡ç¨‹ä¸­æœ€å¸¸ç”¨çš„æ•°æ®å¼•å…¥æ–¹å¼ä¹‹ä¸€ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä¸ ADD ç±»ä¼¼ï¼Œä½†åŠŸèƒ½æ›´ç®€å•ã€æ˜ç¡®ã€å®‰å…¨</p>\n</li>\n<li class=\"lvl-2\">\n<p>æ¨èä¼˜å…ˆä½¿ç”¨ COPYï¼Œé™¤éä½ ç¡®å®éœ€è¦ ADD æä¾›çš„è‡ªåŠ¨è§£å‹æˆ–è¿œç¨‹ä¸‹è½½åŠŸèƒ½ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>è¯­æ³•</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">COPY &lt;src&gt;... &lt;dest&gt;</span><br><span class=\"line\"><span class=\"comment\"># è¯´æ˜ï¼š</span></span><br><span class=\"line\"><span class=\"comment\">#   &lt;src&gt;ï¼šè¦å¤åˆ¶çš„æ–‡ä»¶æˆ–ç›®å½•</span></span><br><span class=\"line\"><span class=\"comment\">#   &lt;dest&gt;ï¼šç›®æ ‡è·¯å¾„</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç¤ºä¾‹</p>\n</li>\n</ul>\n<figure class=\"highlight dockerfile\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å¤åˆ¶å•ä¸ªæ–‡ä»¶</span></span><br><span class=\"line\"><span class=\"keyword\">COPY</span><span class=\"language-bash\"> app.jar /app.jar</span></span><br><span class=\"line\"><span class=\"comment\"># å¤åˆ¶å¤šä¸ªæ–‡ä»¶</span></span><br><span class=\"line\"><span class=\"keyword\">COPY</span><span class=\"language-bash\"> app1.jar app2.jar /app/</span></span><br><span class=\"line\"><span class=\"comment\"># å¤åˆ¶ç›®å½•</span></span><br><span class=\"line\"><span class=\"keyword\">COPY</span><span class=\"language-bash\"> static-assets/ /app/public/</span></span><br><span class=\"line\"><span class=\"comment\"># é€šé…ç¬¦</span></span><br><span class=\"line\"><span class=\"keyword\">COPY</span><span class=\"language-bash\"> static-assets/*.html /app/public/</span></span><br><span class=\"line\"><span class=\"comment\"># è®¾ç½®ç›®æ ‡æ–‡ä»¶å±ä¸»å±ç»„</span></span><br><span class=\"line\"><span class=\"keyword\">COPY</span><span class=\"language-bash\"> --<span class=\"built_in\">chown</span>=appuser:appgroup app.jar /app.jar</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"RUN\">RUN</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>RUN æŒ‡ä»¤ç”¨äºåœ¨é•œåƒæ„å»ºé˜¶æ®µæ‰§è¡Œå‘½ä»¤ï¼Œç»“æœä¼šè¢«æ‰“åŒ…è¿›é•œåƒå±‚ä¸­ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å®ƒå¯ä»¥ç”¨äºå®‰è£…ä¾èµ–ã€ç¼–è¯‘ä»£ç ã€è¿è¡Œå‘½ä»¤ç­‰ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>æ¯ä¸€æ¡ RUN æŒ‡ä»¤ä¼šåˆ›å»ºä¸€å±‚é•œåƒï¼ˆlayerï¼‰,åˆå¹¶å¤šä¸ªå‘½ä»¤æˆä¸€æ¡ RUNï¼Œå¯ä»¥å‡å°‘é•œåƒå±‚æ•°ï¼ˆä¾‹å¦‚ä½¿ç”¨ &amp;&amp; ä¸²è”ï¼‰ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>è¯­æ³•</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ç¬¬ä¸€ç§æ ¼å¼ï¼šå®é™…è¿è¡Œçš„æ˜¯ï¼š/bin/sh -c &quot;&lt;å‘½ä»¤å­—ç¬¦ä¸²&gt;&quot;</span></span><br><span class=\"line\">RUN &lt;å‘½ä»¤å­—ç¬¦ä¸²&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ç¬¬äºŒç§æ ¼å¼</span></span><br><span class=\"line\">RUN [<span class=\"string\">&quot;å¯æ‰§è¡Œæ–‡ä»¶&quot;</span>, <span class=\"string\">&quot;å‚æ•°1&quot;</span>, <span class=\"string\">&quot;å‚æ•°2&quot;</span>, ...]</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç¤ºä¾‹</p>\n</li>\n</ul>\n<figure class=\"highlight dockerfile\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å‘½ä»¤å­—ç¬¦ä¸²</span></span><br><span class=\"line\"><span class=\"keyword\">RUN</span><span class=\"language-bash\"> apt-get update &amp;&amp; apt-get install -y curl</span></span><br><span class=\"line\"><span class=\"comment\"># æ„å»ºå¤šä¸ªå‘½ä»¤(ç”¨ &amp;&amp; ä¸²è”)</span></span><br><span class=\"line\"><span class=\"keyword\">RUN</span><span class=\"language-bash\"> apt-get update &amp;&amp; \\</span></span><br><span class=\"line\"><span class=\"language-bash\">    apt-get install -y python3 &amp;&amp; \\</span></span><br><span class=\"line\"><span class=\"language-bash\">    <span class=\"built_in\">rm</span> -rf /var/lib/apt/lists/*</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å¯æ‰§è¡Œæ–‡ä»¶å‚æ•°</span></span><br><span class=\"line\"><span class=\"keyword\">RUN</span><span class=\"language-bash\"> [<span class=\"string\">&quot;/bin/sh&quot;</span>, <span class=\"string\">&quot;-c&quot;</span>, <span class=\"string\">&quot;curl https://example.com/app.jar &gt; app.jar&quot;</span>]</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"CMD\">CMD</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>CMD ç”¨äºæŒ‡å®šå®¹å™¨å¯åŠ¨æ—¶é»˜è®¤æ‰§è¡Œçš„å‘½ä»¤åŠå…¶å‚æ•°ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å¦‚æœç”¨æˆ·åœ¨è¿è¡Œå®¹å™¨æ—¶æ²¡æœ‰æ‰‹åŠ¨æŒ‡å®šå…¶ä»–å‘½ä»¤ï¼ŒDocker å°±ä¼šä½¿ç”¨ CMD æä¾›çš„å†…å®¹ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å®ƒå¯ä»¥å®šä¹‰å¤šä¸ªï¼Œä½†åªæœ‰æœ€åä¸€ä¸ªä¼šè¢«ä½¿ç”¨ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>è¯­æ³•</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Shell å½¢å¼ï¼ˆå­—ç¬¦ä¸²ï¼‰</span></span><br><span class=\"line\">CMD <span class=\"built_in\">command</span> param1 param2</span><br><span class=\"line\"><span class=\"comment\"># ç­‰ä»·äº /bin/sh -c &quot;command param1 param2&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Exec å½¢å¼ï¼ˆæ•°ç»„ï¼‰</span></span><br><span class=\"line\">CMD [<span class=\"string\">&quot;executable&quot;</span>, <span class=\"string\">&quot;param1&quot;</span>, <span class=\"string\">&quot;param2&quot;</span>, ...]</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç¤ºä¾‹</p>\n</li>\n</ul>\n<figure class=\"highlight dockerfile\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ç®€å• shell å‘½ä»¤</span></span><br><span class=\"line\"><span class=\"keyword\">CMD</span><span class=\"language-bash\"> <span class=\"built_in\">echo</span> <span class=\"string\">&quot;Hello from container&quot;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Exec å½¢å¼</span></span><br><span class=\"line\"><span class=\"keyword\">CMD</span><span class=\"language-bash\"> [<span class=\"string\">&quot;npm&quot;</span>, <span class=\"string\">&quot;start&quot;</span>]</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ä½œä¸º ENTRYPOINT çš„å‚æ•°</span></span><br><span class=\"line\"><span class=\"keyword\">ENTRYPOINT</span><span class=\"language-bash\"> [<span class=\"string\">&quot;python3&quot;</span>, <span class=\"string\">&quot;app.py&quot;</span>]</span></span><br><span class=\"line\"><span class=\"keyword\">CMD</span><span class=\"language-bash\"> [<span class=\"string\">&quot;--host=0.0.0.0&quot;</span>, <span class=\"string\">&quot;--port=8080&quot;</span>]</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç”¨æˆ·å¯ä»¥è¦†ç›– CMDï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker run &lt;myapp&gt; npm run <span class=\"built_in\">test</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"ENTRYPOINT\">ENTRYPOINT</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ENTRYPOINT å®šä¹‰å®¹å™¨å¯åŠ¨æ—¶æ‰§è¡Œçš„ä¸»å‘½ä»¤ï¼Œç›¸æ¯” CMDï¼Œå®ƒä¸å®¹æ˜“è¢«è¦†ç›–ï¼Œæ›´é€‚åˆåˆ¶ä½œâ€œä¸“ç”¨å‹â€å®¹å™¨ï¼ˆå¦‚ nginxã€python è„šæœ¬ç­‰ï¼‰ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä½ å¯ä»¥æŠŠ ENTRYPOINT ç†è§£ä¸ºå®¹å™¨çš„â€œä¸»ç¨‹åºâ€ï¼Œè€Œ CMD æ˜¯ä¸ºå®ƒæä¾›çš„é»˜è®¤â€œå‘½ä»¤è¡Œå‚æ•°â€ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>è¯­æ³•</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Shell å½¢å¼ï¼ˆå­—ç¬¦ä¸²ï¼‰</span></span><br><span class=\"line\">ENTRYPOINT <span class=\"built_in\">command</span> param1 param2</span><br><span class=\"line\"><span class=\"comment\">#  ç­‰ä»·äº /bin/sh -c &quot;command param1 param2&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Exec å½¢å¼ï¼ˆæ•°ç»„ï¼‰</span></span><br><span class=\"line\">ENTRYPOINT [<span class=\"string\">&quot;executable&quot;</span>, <span class=\"string\">&quot;param1&quot;</span>, <span class=\"string\">&quot;param2&quot;</span>, ...]</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç¤ºä¾‹</p>\n</li>\n</ul>\n<figure class=\"highlight dockerfile\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ç®€å• shell å‘½ä»¤</span></span><br><span class=\"line\"><span class=\"keyword\">ENTRYPOINT</span><span class=\"language-bash\"> <span class=\"built_in\">echo</span> <span class=\"string\">&quot;Hello from container&quot;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Exec å½¢å¼</span></span><br><span class=\"line\"><span class=\"keyword\">ENTRYPOINT</span><span class=\"language-bash\"> [<span class=\"string\">&quot;npm&quot;</span>, <span class=\"string\">&quot;start&quot;</span>]</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ç»“åˆ CMD ä½¿ç”¨</span></span><br><span class=\"line\"><span class=\"keyword\">ENTRYPOINT</span><span class=\"language-bash\"> [<span class=\"string\">&quot;python3&quot;</span>, <span class=\"string\">&quot;app.py&quot;</span>]</span></span><br><span class=\"line\"><span class=\"keyword\">CMD</span><span class=\"language-bash\"> [<span class=\"string\">&quot;--host=0.0.0.0&quot;</span>, <span class=\"string\">&quot;--port=8080&quot;</span>]</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"EXPOSE\">EXPOSE</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>EXPOSE ç”¨äºå£°æ˜å®¹å™¨å°†ä¼šç›‘å¬çš„ç«¯å£ï¼Œè®©ä½¿ç”¨è¯¥é•œåƒçš„äººçŸ¥é“åº”è¯¥å¯¹å¤–å¼€æ”¾å“ªäº›ç«¯å£ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>âš ï¸ æ³¨æ„ï¼šEXPOSE å¹¶ä¸ä¼šçœŸçš„å¼€æ”¾ç«¯å£ï¼Œåªæ˜¯â€œå£°æ˜â€è¿™ä¸ªå®¹å™¨ç›‘å¬äº†è¿™äº›ç«¯å£ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>è¦è®©ç«¯å£çœŸæ­£æš´éœ²å‡ºæ¥ï¼Œè¿˜éœ€è¦åœ¨è¿è¡Œå®¹å™¨æ—¶åŠ ä¸Š <code>-p</code> æˆ– <code>--publish</code> å‚æ•°ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>è¯­æ³•</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">EXPOSE &lt;port&gt; [&lt;port&gt;/&lt;protocol&gt;...]</span><br><span class=\"line\"><span class=\"comment\"># è¯´æ˜ï¼š</span></span><br><span class=\"line\"><span class=\"comment\">#   &lt;port&gt;ï¼šç«¯å£å·ï¼Œå¯ä»¥æ˜¯å•ä¸ªç«¯å£å·ï¼Œä¹Ÿå¯ä»¥æ˜¯èŒƒå›´ï¼ˆå¦‚ 8080-8085ï¼‰</span></span><br><span class=\"line\"><span class=\"comment\">#   &lt;protocol&gt;ï¼šåè®®ï¼Œå¯ä»¥æ˜¯ tcp æˆ– udpï¼Œé»˜è®¤ä¸º tcp</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç¤ºä¾‹</p>\n</li>\n</ul>\n<figure class=\"highlight dockerfile\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">EXPOSE</span> <span class=\"number\">8080</span></span><br><span class=\"line\"><span class=\"keyword\">EXPOSE</span> <span class=\"number\">8080</span>/udp</span><br><span class=\"line\"><span class=\"keyword\">EXPOSE</span> <span class=\"number\">8080</span>-<span class=\"number\">8085</span></span><br><span class=\"line\"><span class=\"keyword\">EXPOSE</span> <span class=\"number\">8080</span> <span class=\"number\">8081</span> <span class=\"number\">8082</span> <span class=\"number\">8083</span> <span class=\"number\">8084</span> <span class=\"number\">8085</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"VOLUME\">VOLUME</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>VOLUME æŒ‡ä»¤ç”¨äºå£°æ˜ä¸€ä¸ªæˆ–å¤šä¸ªå®¹å™¨ä¸­çš„æŒ‚è½½ç‚¹ï¼ˆmount pointï¼‰ï¼Œç”¨äºæŒä¹…åŒ–æ•°æ®æˆ–ä¸å®¿ä¸»æœº/å…¶ä»–å®¹å™¨å…±äº«æ•°æ®ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>è¯­æ³•ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">VOLUME [<span class=\"string\">&quot;/path/in/container&quot;</span>, ...]</span><br><span class=\"line\"><span class=\"comment\"># è·¯å¾„å¿…é¡»æ˜¯å®¹å™¨å†…éƒ¨çš„ç»å¯¹è·¯å¾„</span></span><br><span class=\"line\"><span class=\"comment\"># å¯ä»¥ä¸€æ¬¡å£°æ˜ä¸€ä¸ªï¼Œä¹Ÿå¯ä»¥æ˜¯å¤šä¸ªã€‚</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç¤ºä¾‹</p>\n</li>\n</ul>\n<figure class=\"highlight dockerfile\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å£°æ˜ä¸€ä¸ªæŒ‚è½½ç‚¹</span></span><br><span class=\"line\"><span class=\"keyword\">VOLUME</span><span class=\"language-bash\"> /app/public</span></span><br><span class=\"line\"><span class=\"comment\"># å£°æ˜å¤šä¸ªæŒ‚è½½ç‚¹</span></span><br><span class=\"line\"><span class=\"keyword\">VOLUME</span><span class=\"language-bash\"> [<span class=\"string\">&quot;/app/public&quot;</span>, <span class=\"string\">&quot;/app/logs&quot;</span>]</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å½“å®¹å™¨è¿è¡Œæ—¶ï¼Œå¯ä»¥å°†é•œåƒä¸­å£°æ˜çš„æŒ‚è½½ç‚¹æ˜ å°„åˆ°å®¿ä¸»æœºä¸Šï¼Œä»è€Œå®ç°æŒä¹…åŒ–æ•°æ®ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker run -v /host/path:/app/public myimage</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¦‚æœä½ æ²¡æœ‰æ‰‹åŠ¨ç»‘å®šæŒ‚è½½ï¼ŒDocker ä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªåŒ¿åå·ï¼Œå·çš„å†…å®¹é»˜è®¤ä¿å­˜åœ¨å®¿ä¸»æœºçš„ <code>/var/lib/docker/volumes</code> ä¸‹ã€‚</p>\n</li>\n</ul>\n<h3 id=\"HEALTHCHECK\">HEALTHCHECK</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>HEALTHCHECK ç”¨æ¥å®šä¹‰å®¹å™¨è¿è¡Œæ—¶çš„å¥åº·æ£€æŸ¥å‘½ä»¤ï¼Œå®šæœŸæ£€æµ‹å®¹å™¨å†…æœåŠ¡çš„çŠ¶æ€ï¼Œå¸®åŠ©ç¼–æ’å·¥å…·ï¼ˆDocker Swarmã€Kubernetes ç­‰ï¼‰åˆ¤æ–­å®¹å™¨æ˜¯å¦å¥åº·ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å¦‚æœå¥åº·æ£€æŸ¥å¤±è´¥ï¼ŒDocker ä¼šå°†å®¹å™¨æ ‡è®°ä¸º unhealthyï¼Œä¾¿äºè‡ªåŠ¨é‡å¯æˆ–æ›¿æ¢ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>è¯­æ³•</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">HEALTHCHECK &lt;options&gt; CMD &lt;<span class=\"built_in\">command</span>&gt;</span><br><span class=\"line\"><span class=\"comment\"># è¯´æ˜ï¼š</span></span><br><span class=\"line\"><span class=\"comment\"># &lt;options&gt;ï¼šå¯é€‰é¡¹ï¼Œç”¨äºè®¾ç½®å¥åº·æ£€æŸ¥çš„é€‰é¡¹ï¼Œå¦‚è¶…æ—¶æ—¶é—´ã€é‡è¯•æ¬¡æ•°ç­‰ã€‚</span></span><br><span class=\"line\"><span class=\"comment\"># &lt;command&gt;ï¼šå¥åº·æ£€æŸ¥å‘½ä»¤ï¼Œå¯ä»¥æ˜¯ä»»ä½•æœ‰æ•ˆçš„ shell å‘½ä»¤ã€‚</span></span><br><span class=\"line\">            <span class=\"comment\"># å¿…é¡»è¿”å›é€€å‡ºç :</span></span><br><span class=\"line\">              <span class=\"comment\"># 0 è¡¨ç¤ºå¥åº·</span></span><br><span class=\"line\">              <span class=\"comment\"># 1 è¡¨ç¤ºä¸å¥åº·</span></span><br><span class=\"line\">              <span class=\"comment\"># 2 è¡¨ç¤ºæœªçŸ¥</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¯é€‰å‚æ•°ï¼ˆOPTIONSï¼‰</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>å‚æ•°</th>\n<th>è¯´æ˜</th>\n<th>é»˜è®¤å€¼</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>--interval=DURATION</code></td>\n<td>ä¸¤æ¬¡å¥åº·æ£€æŸ¥ä¹‹é—´çš„æ—¶é—´é—´éš”</td>\n<td>30s</td>\n</tr>\n<tr>\n<td><code>--timeout=DURATION</code></td>\n<td>å•æ¬¡æ£€æµ‹å‘½ä»¤çš„è¶…æ—¶æ—¶é—´</td>\n<td>30s</td>\n</tr>\n<tr>\n<td><code>--start-period=DURATION</code></td>\n<td>å®¹å™¨å¯åŠ¨åï¼Œå¼€å§‹å¥åº·æ£€æŸ¥å‰çš„ç­‰å¾…æ—¶é—´</td>\n<td>0s</td>\n</tr>\n<tr>\n<td><code>--retries=N</code></td>\n<td>è¿ç»­å¤±è´¥å‡ æ¬¡ååˆ¤å®šå®¹å™¨ä¸å¥åº·</td>\n<td>3</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç¤ºä¾‹</p>\n</li>\n</ul>\n<figure class=\"highlight dockerfile\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ä½¿ç”¨ curl æ£€æµ‹ Web æœåŠ¡æ˜¯å¦å“åº”</span></span><br><span class=\"line\"><span class=\"keyword\">HEALTHCHECK</span><span class=\"language-bash\"> --interval=5s --<span class=\"built_in\">timeout</span>=3s --retries=3 CMD curl -f http://localhost:8080/health || <span class=\"built_in\">exit</span> 1</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¿è¡Œå®¹å™¨åï¼Œå¯ä»¥ç”¨å‘½ä»¤æŸ¥çœ‹å¥åº·çŠ¶æ€</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å¦‚æœé•œåƒä¸­æœ‰å¥åº·æ£€æŸ¥ï¼Œå¯ä»¥æŸ¥çœ‹å®¹å™¨çŠ¶æ€ï¼ˆSTATUSï¼‰</span></span><br><span class=\"line\">docker ps</span><br><span class=\"line\">  <span class=\"comment\"># STATUS åˆ—ä¼šæ˜¾ç¤ºï¼š</span></span><br><span class=\"line\">  <span class=\"comment\">#   healthy</span></span><br><span class=\"line\">  <span class=\"comment\">#   unhealthy</span></span><br><span class=\"line\">  <span class=\"comment\">#   startingï¼ˆå¯åŠ¨ä¸­ï¼‰</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹æ›´è¯¦ç»†çš„ä¿¡æ¯</span></span><br><span class=\"line\">docker inspect --format=<span class=\"string\">&#x27;&#123;&#123;json .State.Health&#125;&#125;&#x27;</span> &lt;container-id&gt;</span><br></pre></td></tr></table></figure>\n<h3 id=\"SHELL\">SHELL</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>SHELL æŒ‡ä»¤ç”¨æ¥è‡ªå®šä¹‰åç»­ RUNã€CMD å’Œ ENTRYPOINT æŒ‡ä»¤æ‰€ä½¿ç”¨çš„é»˜è®¤ shell ç¨‹åºå’Œå‚æ•°ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>é»˜è®¤æƒ…å†µä¸‹ï¼š</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">åœ¨ Linux é•œåƒä¸­ï¼ŒDocker ä½¿ç”¨ /bin/sh -c</li>\n<li class=\"lvl-4\">åœ¨ Windows é•œåƒä¸­ï¼Œä½¿ç”¨ cmd /S /C</li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<p>ä½¿ç”¨ SHELLï¼Œä½ å¯ä»¥æ›¿æ¢ä¸ºå…¶ä»– shellï¼Œå¦‚ Bashã€PowerShellã€zsh ç­‰ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>è¯­æ³•</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">SHELL [<span class=\"string\">&quot;executable&quot;</span>, <span class=\"string\">&quot;param1&quot;</span>, <span class=\"string\">&quot;param2&quot;</span>, ...]</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç¤ºä¾‹</p>\n</li>\n</ul>\n<figure class=\"highlight dockerfile\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åˆ‡æ¢åˆ° bash</span></span><br><span class=\"line\"><span class=\"keyword\">SHELL</span><span class=\"language-bash\"> [<span class=\"string\">&quot;bash&quot;</span>, <span class=\"string\">&quot;-c&quot;</span>]</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å¤šæ¬¡åˆ‡æ¢</span></span><br><span class=\"line\"><span class=\"keyword\">SHELL</span><span class=\"language-bash\"> [<span class=\"string\">&quot;/bin/bash&quot;</span>, <span class=\"string\">&quot;-c&quot;</span>]</span></span><br><span class=\"line\"><span class=\"keyword\">RUN</span><span class=\"language-bash\"> <span class=\"built_in\">echo</span> <span class=\"string\">&quot;Hello from Bash&quot;</span> <span class=\"comment\"># åœ¨ Bash ä¸­æ‰§è¡Œ</span></span></span><br><span class=\"line\"><span class=\"keyword\">SHELL</span><span class=\"language-bash\"> [<span class=\"string\">&quot;/bin/sh&quot;</span>, <span class=\"string\">&quot;-c&quot;</span>]</span></span><br><span class=\"line\"><span class=\"keyword\">RUN</span><span class=\"language-bash\"> <span class=\"built_in\">echo</span> <span class=\"string\">&quot;Now back to sh&quot;</span> <span class=\"comment\">#  åœ¨ sh ä¸­æ‰§è¡Œ</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Windows</span></span><br><span class=\"line\"><span class=\"keyword\">SHELL</span><span class=\"language-bash\"> [<span class=\"string\">&quot;powershell&quot;</span>, <span class=\"string\">&quot;-Command&quot;</span>]</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"STOPSIGNAL\">STOPSIGNAL</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>STOPSIGNAL æŒ‡å®šå½“å®¹å™¨æ”¶åˆ° <code>docker stop</code> å‘½ä»¤æ—¶ï¼Œå‘é€ç»™å®¹å™¨ä¸»è¿›ç¨‹çš„ä¿¡å·ç±»å‹ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒDocker ä¼šå‘å®¹å™¨çš„ä¸»è¿›ç¨‹å‘é€ <code>SIGTERM</code> ä¿¡å·ï¼Œè®©å®ƒæœ‰æœºä¼šä¼˜é›…åœ°é€€å‡ºï¼ˆåœ¨è¶…æ—¶æ—¶æœªé€€å‡ºåˆ™å‘ <code>SIGKILL</code> å¼ºåˆ¶ç»ˆæ­¢ï¼‰ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>é»˜è®¤æƒ…å†µï¼Œå¤§å¤šæ•°ç¨‹åºï¼ˆå¦‚ nginxï¼‰ï¼Œä¸éœ€è¦è®¾ç½®ï¼ˆé»˜è®¤ SIGTERMï¼‰</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä½†æœ‰äº›ç¨‹åºå¯èƒ½éœ€è¦ä½¿ç”¨ä¸åŒçš„ä¿¡å·ï¼Œæ¯”å¦‚ SIGINTã€SIGHUPï¼Œè¿™æ—¶ä½ å¯ä»¥é€šè¿‡ STOPSIGNAL æ¥ä¿®æ”¹ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>è¯­æ³•</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">STOPSIGNAL &lt;signal&gt;</span><br><span class=\"line\"><span class=\"comment\"># è¯´æ˜ï¼š</span></span><br><span class=\"line\"><span class=\"comment\"># å…¶ä¸­ &lt;signal&gt; å¯ä»¥æ˜¯ï¼š</span></span><br><span class=\"line\"><span class=\"comment\">#   ä¿¡å·åç§°ï¼Œä¾‹å¦‚ï¼šSIGTERMã€SIGKILLã€SIGINTã€SIGHUP</span></span><br><span class=\"line\"><span class=\"comment\">#   æˆ–ä¿¡å·ç¼–å·ï¼Œä¾‹å¦‚ï¼š15ï¼ˆç­‰ä»·äº SIGTERMï¼‰</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç¤ºä¾‹</p>\n</li>\n</ul>\n<figure class=\"highlight dockerfile\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># è¿™æ˜¯é»˜è®¤è¡Œä¸ºï¼Œä¸å†™ä¹Ÿä¸€æ ·ã€‚</span></span><br><span class=\"line\"><span class=\"keyword\">STOPSIGNAL</span> SIGTERM</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ä¿®æ”¹ä¸º SIGINT</span></span><br><span class=\"line\"><span class=\"keyword\">STOPSIGNAL</span> SIGINT</span><br></pre></td></tr></table></figure>\n<h3 id=\"ONBUILD\">ONBUILD</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ONBUILD ç”¨äºå®šä¹‰å»¶è¿Ÿæ‰§è¡Œçš„æ„å»ºæŒ‡ä»¤ï¼Œå³è¿™äº›å‘½ä»¤ä¸ä¼šåœ¨å½“å‰ Dockerfile æ„å»ºæ—¶æ‰§è¡Œï¼Œè€Œæ˜¯åœ¨ ä»¥å½“å‰é•œåƒä¸ºåŸºç¡€çš„å­é•œåƒä¸­æ„å»ºæ—¶è§¦å‘æ‰§è¡Œã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å®ƒçš„å…¸å‹ç”¨é€”æ˜¯ï¼šæ„å»ºä¸€ä¸ªâ€œé€šç”¨åŸºç¡€é•œåƒâ€ï¼Œè®©ä½¿ç”¨è€…åœ¨è‡ªå·±çš„ Dockerfile ä¸­ FROM å®ƒæ—¶è‡ªåŠ¨ç»§æ‰¿ä¸€äº›æ“ä½œï¼ˆæ¯”å¦‚ COPYã€RUN ç­‰ï¼‰ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ONBUILD æ˜¯ä¸€ç§è®¾è®¡æ¨¡å¼ï¼Œæ–¹ä¾¿åŸºç¡€é•œåƒä½œè€…é¢„å…ˆå®šä¹‰â€œæœªæ¥å­é•œåƒæ„å»ºæ—¶ä¸€å®šè¦æ‰§è¡Œçš„æ­¥éª¤â€ï¼Œè€Œä¸æ˜¯åœ¨åŸºç¡€é•œåƒä¸­â€œç¡¬ç¼–ç â€é‚£äº›æ­¥éª¤ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>è¯­æ³•</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ONBUILD &lt;INSTRUCTION&gt;</span><br><span class=\"line\"><span class=\"comment\"># è¯´æ˜ï¼š</span></span><br><span class=\"line\"><span class=\"comment\"># &lt;INSTRUCTION&gt;ï¼šå¿…é¡»æ˜¯ä¸€ä¸ªåˆæ³•çš„ Dockerfile æŒ‡ä»¤ï¼Œå¦‚ RUNã€COPYã€ADDã€CMD ç­‰ï¼ˆä½†ä¸èƒ½æ˜¯ FROM, ONBUILD, HEALTHCHECK ç­‰ï¼‰ã€‚</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç¤ºä¾‹</p>\n</li>\n</ul>\n<figure class=\"highlight dockerfile\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åŸºç¡€é•œåƒä¸­ä½¿ç”¨ ONBUILD</span></span><br><span class=\"line\"><span class=\"comment\"># æ–‡ä»¶ï¼šDockerfile.base</span></span><br><span class=\"line\"><span class=\"keyword\">FROM</span> node:<span class=\"number\">18</span></span><br><span class=\"line\"><span class=\"keyword\">WORKDIR</span><span class=\"language-bash\"> /app</span></span><br><span class=\"line\"><span class=\"keyword\">ONBUILD</span> <span class=\"keyword\">COPY</span><span class=\"language-bash\"> . /app</span></span><br><span class=\"line\"><span class=\"keyword\">ONBUILD</span> <span class=\"keyword\">RUN</span><span class=\"language-bash\"> npm install</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ„å»ºåŸºç¡€é•œåƒ</span></span><br><span class=\"line\">docker build -t my-node-base -f Dockerfile.base .</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ä½¿ç”¨åŸºç¡€é•œåƒæ„å»ºå­é•œåƒ</span></span><br><span class=\"line\"><span class=\"comment\"># æ–‡ä»¶ï¼šDockerfileï¼ˆå­é•œåƒï¼‰</span></span><br><span class=\"line\"><span class=\"keyword\">FROM</span> my-node-base</span><br><span class=\"line\"><span class=\"keyword\">CMD</span><span class=\"language-bash\"> [<span class=\"string\">&quot;node&quot;</span>, <span class=\"string\">&quot;index.js&quot;</span>]</span></span><br><span class=\"line\"><span class=\"comment\"># æ„å»ºå­é•œåƒæ—¶ï¼Œç­‰äºè‡ªåŠ¨æ’å…¥äº†ï¼š</span></span><br><span class=\"line\"><span class=\"keyword\">COPY</span><span class=\"language-bash\"> . /app</span></span><br><span class=\"line\"><span class=\"keyword\">RUN</span><span class=\"language-bash\"> npm install</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ONBUILD æ˜¯ä¸€ç§â€œæ„å»ºé’©å­â€æœºåˆ¶</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">ONBUILD å¯ä»¥ç†è§£æˆâ€œé’©å­â€æˆ–â€œè§¦å‘å™¨â€ï¼š\n<ul class=\"lvl-4\">\n<li class=\"lvl-6\">åœ¨åŸºç¡€é•œåƒæ„å»ºæ—¶ä¸æ‰§è¡Œ</li>\n<li class=\"lvl-6\">ä½†å½“æŸäººä»¥è¿™ä¸ªåŸºç¡€é•œåƒä¸ºèµ·ç‚¹å†™è‡ªå·±çš„ Dockerfileï¼Œå¹¶æ„å»ºæ—¶ï¼Œè¿™äº› ONBUILD é‡Œçš„æŒ‡ä»¤è‡ªåŠ¨æ’å…¥æ‰§è¡Œ</li>\n</ul>\n</li>\n<li class=\"lvl-4\">è¿™æ ·ï¼š\n<ul class=\"lvl-4\">\n<li class=\"lvl-6\">åŸºç¡€é•œåƒåªè´Ÿè´£å®šä¹‰ç¯å¢ƒï¼ˆnodeã€npmç‰ˆæœ¬ã€ç³»ç»Ÿä¾èµ–ç­‰ï¼‰ï¼Œä¿æŒè½»é‡</li>\n<li class=\"lvl-6\">ä¸‹æ¸¸é¡¹ç›®å¯ä»¥ä¸ç”¨å†™é‡å¤çš„ä»£ç å¤åˆ¶å’Œå®‰è£…æŒ‡ä»¤ï¼Œè‡ªåŠ¨ç»§æ‰¿åŸºç¡€é•œåƒé¢„å®šä¹‰çš„æ„å»ºæ­¥éª¤</li>\n<li class=\"lvl-6\">ä»£ç å¤åˆ¶å’Œä¾èµ–å®‰è£…åœ¨ä¸‹æ¸¸é•œåƒæ„å»ºæ—¶æ‰§è¡Œï¼Œä½¿ç”¨è‡ªå·±çš„ä¸Šä¸‹æ–‡ï¼ˆä¹Ÿå°±æ˜¯é¡¹ç›®ä»£ç ï¼‰</li>\n</ul>\n</li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<p><code>ONBUILD</code> æ€»ç»“</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>ç‰¹æ€§</th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>â± å»¶è¿Ÿæ‰§è¡Œ</td>\n<td>æ„å»ºåŸºç¡€é•œåƒæ—¶ä¸ä¼šæ‰§è¡Œï¼Œåœ¨å­é•œåƒæ„å»ºæ—¶è§¦å‘</td>\n</tr>\n<tr>\n<td>âœ… æ”¯æŒæŒ‡ä»¤</td>\n<td>ä¾‹å¦‚ <code>RUN</code>, <code>COPY</code>, <code>ADD</code>, <code>CMD</code>, <code>WORKDIR</code>, <code>ENV</code> ç­‰</td>\n</tr>\n<tr>\n<td>âŒ ä¸æ”¯æŒ</td>\n<td><code>FROM</code>, <code>ONBUILD</code>, <code>HEALTHCHECK</code>, <code>SHELL</code>, <code>STOPSIGNAL</code></td>\n</tr>\n<tr>\n<td>ğŸ‘ ä¸æ¨èæ»¥ç”¨</td>\n<td>ä¼šéšè—æ„å»ºè¡Œä¸ºï¼Œé™ä½å¯ç»´æŠ¤æ€§</td>\n</tr>\n<tr>\n<td>âœ… æ¨èåœºæ™¯</td>\n<td>å›¢é˜Ÿå…±äº«æ¨¡æ¿ã€æ„å»ºâ€œæ ‡å‡†å¼€å‘é•œåƒâ€</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"Dockerfile-å“ªäº›-æŒ‡ä»¤-ä¼šåˆ›å»ºæ–°çš„å±‚\">Dockerfile å“ªäº› æŒ‡ä»¤ ä¼šåˆ›å»ºæ–°çš„å±‚</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å½“ Dockerfile ä¸­åˆ›å»ºæ–°å±‚çš„æŒ‡ä»¤å†…å®¹å‘ç”Ÿå˜åŒ–æ—¶ï¼Œä½¿ç”¨ <code>--no-cache</code> é€‰é¡¹å¯ä»¥ç¡®ä¿è¿™äº›å˜æ›´è¢«æ­£ç¡®åº”ç”¨ã€‚</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>æŒ‡ä»¤</th>\n<th>æè¿°</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>ADD</td>\n<td>ä» <src> å¤åˆ¶æ–‡ä»¶å¹¶è‡ªåŠ¨è§£å‹ï¼ˆå¦‚æœæ˜¯ä¸€ä¸ª tar æ–‡ä»¶ï¼‰åˆ°å®¹å™¨çš„ <dest> è·¯å¾„ã€‚</td>\n</tr>\n<tr>\n<td>COPY</td>\n<td>ä» <src> å¤åˆ¶æ–‡ä»¶åˆ°å®¹å™¨çš„ <dest> è·¯å¾„ï¼Œä¸ä¼šè‡ªåŠ¨è§£å‹ã€‚</td>\n</tr>\n<tr>\n<td>RUN</td>\n<td>æ‰§è¡Œä»»æ„å‘½ä»¤å¹¶åœ¨å®¹å™¨ä¸­åšå‡ºæ›´æ”¹ã€‚æ¯æ¡ RUN æŒ‡ä»¤éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å±‚ã€‚</td>\n</tr>\n<tr>\n<td>ENV</td>\n<td>è®¾ç½®ç¯å¢ƒå˜é‡ã€‚æ¯ä¸€è¡Œ ENV æŒ‡ä»¤éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å±‚ã€‚</td>\n</tr>\n<tr>\n<td>WORKDIR</td>\n<td>è®¾ç½®å·¥ä½œç›®å½•ã€‚æ¯ä¸€è¡Œ WORKDIR æŒ‡ä»¤éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å±‚ã€‚</td>\n</tr>\n<tr>\n<td>VOLUME</td>\n<td>åˆ›å»ºä¸€ä¸ªæŒ‚è½½ç‚¹ã€‚æ¯ä¸€è¡Œ VOLUME æŒ‡ä»¤éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å±‚ã€‚</td>\n</tr>\n<tr>\n<td>LABEL</td>\n<td>æ·»åŠ å…ƒæ•°æ®æ ‡ç­¾ã€‚æ¯ä¸€è¡Œ LABEL æŒ‡ä»¤éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å±‚ã€‚</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"Dockerfile-ç¤ºä¾‹-Spring-Boot-åº”ç”¨\">Dockerfile ç¤ºä¾‹: Spring Boot åº”ç”¨</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç›®å½•ç»“æ„</p>\n</li>\n</ul>\n<figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">springbootweb/</span><br><span class=\"line\">â”œâ”€â”€ Dockerfile</span><br><span class=\"line\">â”œâ”€â”€ target/</span><br><span class=\"line\">â”‚   â””â”€â”€ app.jar</span><br><span class=\"line\">â”œâ”€â”€ <span class=\"type\">static</span>-assets.tar.gz</span><br><span class=\"line\">â””â”€â”€ ...</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Dockerfile</p>\n</li>\n</ul>\n<figure class=\"highlight dockerfile\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ä½¿ç”¨è½»é‡çº§ Alpine ç‰ˆæœ¬çš„ OpenJDK 17 å®˜æ–¹é•œåƒï¼Œé€‚åˆéƒ¨ç½² Spring Boot åº”ç”¨</span></span><br><span class=\"line\"><span class=\"keyword\">FROM</span> openjdk:<span class=\"number\">17</span>-alpine</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># è®¾ç½®æ„å»ºæ—¶å˜é‡ï¼Œé»˜è®¤ä½¿ç”¨æ„å»ºå¥½çš„ jar æ–‡ä»¶</span></span><br><span class=\"line\"><span class=\"keyword\">ARG</span> JAR_FILE=target/app.jar</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># è®¾ç½®è¿è¡Œæ—¶ç¯å¢ƒå˜é‡</span></span><br><span class=\"line\"><span class=\"keyword\">ENV</span> JAVA_OPTS=<span class=\"string\">&quot;-Xms1024M -Xmx1024M -XX:MetaspaceSize=128M -XX:MaxMetaspaceSize=128M&quot;</span></span><br><span class=\"line\"><span class=\"keyword\">ENV</span> TZ=Asia/Shanghai</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># é•œåƒå…ƒä¿¡æ¯</span></span><br><span class=\"line\"><span class=\"keyword\">LABEL</span><span class=\"language-bash\"> maintainer=<span class=\"string\">&quot;yourname@example.com&quot;</span></span></span><br><span class=\"line\"><span class=\"keyword\">LABEL</span><span class=\"language-bash\"> version=<span class=\"string\">&quot;1.0.0&quot;</span></span></span><br><span class=\"line\"><span class=\"keyword\">LABEL</span><span class=\"language-bash\"> description=<span class=\"string\">&quot;ç”¨äºéƒ¨ç½² Spring Boot åº”ç”¨çš„ç”Ÿäº§çº§é•œåƒ&quot;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># è®¾ç½®å·¥ä½œç›®å½•</span></span><br><span class=\"line\"><span class=\"keyword\">WORKDIR</span><span class=\"language-bash\"> /app</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ç¤ºä¾‹ RUNï¼šå®‰è£… curlï¼ˆç”¨äºå®¹å™¨å¥åº·æ£€æŸ¥æˆ–è°ƒè¯•ï¼‰</span></span><br><span class=\"line\"><span class=\"keyword\">RUN</span><span class=\"language-bash\"> apk add --no-cache curl</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å¤åˆ¶ Spring Boot æ„å»ºç”Ÿæˆçš„ jar åŒ…</span></span><br><span class=\"line\"><span class=\"keyword\">COPY</span><span class=\"language-bash\"> <span class=\"variable\">$&#123;JAR_FILE&#125;</span> app.jar</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># è§£å‹é™æ€èµ„æºåˆ°å®¹å™¨ä¸­ï¼ˆADD å¯ä»¥è‡ªåŠ¨è§£å‹ tar.gzï¼‰</span></span><br><span class=\"line\"><span class=\"keyword\">ADD</span><span class=\"language-bash\"> static-assets.tar.gz /app/public/</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å£°æ˜æš´éœ²çš„åº”ç”¨ç«¯å£ï¼ˆSpring Boot é»˜è®¤æ˜¯ 8080ï¼‰</span></span><br><span class=\"line\"><span class=\"keyword\">EXPOSE</span> <span class=\"number\">8080</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å®¹å™¨å¥åº·æ£€æŸ¥ï¼šè®¿é—® actuator å¥åº·ç«¯ç‚¹</span></span><br><span class=\"line\"><span class=\"keyword\">HEALTHCHECK</span><span class=\"language-bash\"> --interval=30s --<span class=\"built_in\">timeout</span>=5s --retries=3 \\</span></span><br><span class=\"line\"><span class=\"language-bash\">  CMD curl -f http://localhost:8080/app/actuator/health || <span class=\"built_in\">exit</span> 1</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å®¹å™¨ç»ˆæ­¢æ—¶ä¼˜é›…å…³é—­ï¼ˆJava æ¨è SIGTERMï¼‰</span></span><br><span class=\"line\"><span class=\"keyword\">STOPSIGNAL</span> SIGTERM</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># è®¾ç½®å®¹å™¨å¯åŠ¨æ—¶çš„ä¸»å‘½ä»¤ï¼ˆENTRYPOINT ä¸ä¼šè¢« docker run å‚æ•°è¦†ç›–ï¼‰</span></span><br><span class=\"line\"><span class=\"keyword\">ENTRYPOINT</span><span class=\"language-bash\"> [<span class=\"string\">&quot;sh&quot;</span>, <span class=\"string\">&quot;-c&quot;</span>, <span class=\"string\">&quot;java <span class=\"variable\">$JAVA_OPTS</span> -jar app.jar&quot;</span>]</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># CMD æä¾›é»˜è®¤çš„è¿è¡Œå‚æ•°ï¼Œå¯ä»¥è¢« docker run è¦†ç›–</span></span><br><span class=\"line\"><span class=\"comment\"># è¿™é‡Œé€šè¿‡ Spring Boot å‚æ•°è®¾ç½®å¯åŠ¨ç¯å¢ƒå’Œç«¯å£å·</span></span><br><span class=\"line\"><span class=\"keyword\">CMD</span><span class=\"language-bash\"> [<span class=\"string\">&quot;--spring.profiles.active=app&quot;</span>, <span class=\"string\">&quot;--server.port=8080&quot;</span>]</span></span><br><span class=\"line\"><span class=\"comment\"># è¿™é‡Œä½¿ç”¨çš„æ˜¯ ENTRYPOINT + CMD çš„æ··åˆæ¨¡å¼</span></span><br><span class=\"line\"><span class=\"comment\"># å®Œæ•´å‘½ä»¤ï¼š java $JAVA_OPTS -jar app.jar --spring.profiles.active=app --server.port=8080</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å£°æ˜ä¸€ä¸ªå·æŒ‚è½½ç‚¹ï¼Œè¿è¡Œå®¹å™¨æ—¶å¯å°†è¯¥è·¯å¾„æ˜ å°„åˆ°å®¿ä¸»æœºï¼Œå®ç°æ•°æ®æŒä¹…åŒ–</span></span><br><span class=\"line\"><span class=\"keyword\">VOLUME</span><span class=\"language-bash\"> [<span class=\"string\">&quot;/app/logs&quot;</span>]</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ„å»ºé•œåƒ</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æ„å»ºé•œåƒæ—¶ç”¨ --build-arg æŒ‡å®šæ„å»ºå‚æ•°ï¼Œå¦‚æœéœ€è¦å¤šä¸ªï¼Œå°±é…ç½®å¤šä¸ª --build-arg</span></span><br><span class=\"line\">docker build --build-arg JAR_FILE=target/app.jar -t springbootweb:latest .</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¿è¡Œå®¹å™¨</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker run -d --name springbootweb \\</span><br><span class=\"line\">  -p 8080:8080 \\</span><br><span class=\"line\">  -e JAVA_OPTS=<span class=\"string\">&quot;-Xms512m -Xmx1024m&quot;</span> \\</span><br><span class=\"line\">  -v /home/centos/logs/app/:/app/logs \\</span><br><span class=\"line\">  springbootweb:latest</span><br></pre></td></tr></table></figure>\n<h2 id=\"Dockerfile-ç¤ºä¾‹-å¤šé˜¶æ®µæ„å»º\">Dockerfile ç¤ºä¾‹: å¤šé˜¶æ®µæ„å»º</h2>\n<figure class=\"highlight dockerfile\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ç¬¬ä¸€é˜¶æ®µï¼šè·å–ä»£ç </span></span><br><span class=\"line\"><span class=\"keyword\">FROM</span> alpine/git as fetcher</span><br><span class=\"line\"><span class=\"keyword\">WORKDIR</span><span class=\"language-bash\"> /workspace/application</span></span><br><span class=\"line\"><span class=\"comment\"># å°†æ›¿æ¢ä¸ºå®é™…çš„Gitä»“åº“URLå’Œåˆ†æ”¯/æ ‡ç­¾</span></span><br><span class=\"line\"><span class=\"keyword\">ARG</span> GIT_REPOSITORY=https://gitee.com/hanqunfeng/springbootweb.git</span><br><span class=\"line\"><span class=\"keyword\">ARG</span> GIT_BRANCH=master</span><br><span class=\"line\"><span class=\"keyword\">RUN</span><span class=\"language-bash\"> git <span class=\"built_in\">clone</span> -b <span class=\"variable\">$&#123;GIT_BRANCH&#125;</span> <span class=\"variable\">$&#123;GIT_REPOSITORY&#125;</span> .</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ç¬¬äºŒé˜¶æ®µï¼šä½¿ç”¨Mavenç¯å¢ƒè¿›è¡Œæ„å»º</span></span><br><span class=\"line\"><span class=\"keyword\">FROM</span> maven:<span class=\"number\">3.8</span>.<span class=\"number\">4</span>-openjdk-<span class=\"number\">17</span> AS builder</span><br><span class=\"line\"><span class=\"keyword\">WORKDIR</span><span class=\"language-bash\"> /workspace/application</span></span><br><span class=\"line\"><span class=\"comment\"># ä»ç¬¬ä¸€é˜¶æ®µå¤åˆ¶ä»£ç </span></span><br><span class=\"line\"><span class=\"keyword\">COPY</span><span class=\"language-bash\"> --from=fetcher /workspace/application .</span></span><br><span class=\"line\"><span class=\"comment\"># ä½¿ç”¨Mavenæ¸…ç†å¹¶æ‰“åŒ…</span></span><br><span class=\"line\"><span class=\"keyword\">RUN</span><span class=\"language-bash\"> mvn clean package -DskipTests</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ç¬¬ä¸‰é˜¶æ®µï¼šåˆ›å»ºæœ€ç»ˆçš„è¿è¡Œç¯å¢ƒ</span></span><br><span class=\"line\"><span class=\"keyword\">FROM</span> openjdk:<span class=\"number\">17</span>-alpine</span><br><span class=\"line\"><span class=\"keyword\">WORKDIR</span><span class=\"language-bash\"> /app</span></span><br><span class=\"line\"><span class=\"comment\"># è®¾ç½®è¿è¡Œæ—¶ç¯å¢ƒå˜é‡</span></span><br><span class=\"line\"><span class=\"keyword\">ENV</span> JAVA_OPTS=<span class=\"string\">&quot;-Xms1024M -Xmx1024M -XX:MetaspaceSize=128M -XX:MaxMetaspaceSize=128M&quot;</span></span><br><span class=\"line\"><span class=\"comment\"># å°†ç¬¬äºŒé˜¶æ®µç”Ÿæˆçš„ç›®æ ‡æ–‡ä»¶å¤åˆ¶åˆ°è¿™é‡Œã€‚æ³¨æ„è¿™é‡Œå‡è®¾ä½ çš„spring bootå·¥ç¨‹æ‰“æˆçš„jaråæ˜¯target/app.jar</span></span><br><span class=\"line\"><span class=\"keyword\">COPY</span><span class=\"language-bash\"> --from=builder /workspace/application/target/app.jar app.jar</span></span><br><span class=\"line\"><span class=\"comment\"># æš´éœ²ç«¯å£ï¼ˆå¦‚æœéœ€è¦çš„è¯ï¼‰ã€‚è¯·æ ¹æ®å®é™…æƒ…å†µä¿®æ”¹ç«¯å£å·</span></span><br><span class=\"line\"><span class=\"keyword\">EXPOSE</span> <span class=\"number\">8080</span></span><br><span class=\"line\"><span class=\"comment\"># å£°æ˜ä¸€ä¸ªå·æŒ‚è½½ç‚¹ï¼Œè¿è¡Œå®¹å™¨æ—¶å¯å°†è¯¥è·¯å¾„æ˜ å°„åˆ°å®¿ä¸»æœºï¼Œå®ç°æ•°æ®æŒä¹…åŒ–</span></span><br><span class=\"line\"><span class=\"keyword\">VOLUME</span><span class=\"language-bash\"> [<span class=\"string\">&quot;/app/logs&quot;</span>]</span></span><br><span class=\"line\"><span class=\"comment\"># è®¾ç½®å®¹å™¨å¯åŠ¨æ—¶çš„ä¸»å‘½ä»¤ï¼ˆENTRYPOINT ä¸ä¼šè¢« docker run å‚æ•°è¦†ç›–ï¼‰</span></span><br><span class=\"line\"><span class=\"keyword\">ENTRYPOINT</span><span class=\"language-bash\"> [<span class=\"string\">&quot;sh&quot;</span>, <span class=\"string\">&quot;-c&quot;</span>, <span class=\"string\">&quot;java <span class=\"variable\">$JAVA_OPTS</span> -jar app.jar&quot;</span>]</span></span><br><span class=\"line\"><span class=\"comment\"># CMD æä¾›é»˜è®¤çš„è¿è¡Œå‚æ•°ï¼Œå¯ä»¥è¢« docker run è¦†ç›–</span></span><br><span class=\"line\"><span class=\"comment\"># è¿™é‡Œé€šè¿‡ Spring Boot å‚æ•°è®¾ç½®å¯åŠ¨ç¯å¢ƒå’Œç«¯å£å·</span></span><br><span class=\"line\"><span class=\"keyword\">CMD</span><span class=\"language-bash\"> [<span class=\"string\">&quot;--spring.profiles.active=app&quot;</span>, <span class=\"string\">&quot;--server.port=8080&quot;</span>]</span></span><br><span class=\"line\"><span class=\"comment\"># è¿™é‡Œä½¿ç”¨çš„æ˜¯ ENTRYPOINT + CMD çš„æ··åˆæ¨¡å¼</span></span><br><span class=\"line\"><span class=\"comment\"># å®Œæ•´å‘½ä»¤ï¼š java $JAVA_OPTS -jar app.jar --spring.profiles.active=app --server.port=8080</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ„å»ºé•œåƒ</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æ„å»ºé•œåƒï¼Œ--no-cache è¡¨ç¤ºä¸ä½¿ç”¨ç¼“å­˜ï¼Œæ¯æ¬¡æ„å»ºéƒ½ä¼šé‡æ–°æ„å»º</span></span><br><span class=\"line\">docker build --no-cache -t app:latest .</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¿è¡Œå®¹å™¨</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker run -d --name app \\</span><br><span class=\"line\">  -p 8080:8080 \\</span><br><span class=\"line\">  -e JAVA_OPTS=<span class=\"string\">&quot;-Xms512m -Xmx1024m&quot;</span> \\</span><br><span class=\"line\">  -v /home/centos/logs/app/:/app/logs \\</span><br><span class=\"line\">  app:latest</span><br></pre></td></tr></table></figure>","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» Docker å‘½ä»¤ ä¸­ Dockerfile çš„ä½¿ç”¨æ–¹æ³• Dockerå®˜æ–¹æ–‡æ¡£ Dockerfileå®˜æ–¹æ–‡æ¡£ Dockerfile æ˜¯ä»€ä¹ˆï¼Ÿ Dockerå¯ä»¥é€šè¿‡è¯»å– Dockerfile ä¸­çš„æŒ‡ä»¤æ¥è‡ªåŠ¨æ„å»ºé•œåƒã€‚ Dockerfile æ˜¯ä¸€ä¸ªæ–‡æœ¬æ–‡æ¡£ï¼Œå…¶ä¸­åŒ…å«ç”¨æˆ·å¯ä»¥åœ¨å‘½ä»¤è¡Œä¸Šè°ƒç”¨ä»¥ç»„è£…é•œåƒçš„æ‰€æœ‰æŒ‡ä»¤ã€‚ å¯ä»¥åœ¨Dockerfileä¸­ä½¿ç”¨çš„æŒ‡ä»¤ï¼š æŒ‡ä»¤ ä¸­æ–‡æè¿° ADD å°†æœ¬åœ°æˆ–è¿œç¨‹çš„æ–‡ä»¶/ç›®å½•æ·»åŠ åˆ°é•œåƒä¸­ï¼Œæ”¯æŒè‡ªåŠ¨è§£å‹ .tar æ–‡ä»¶å’Œä½¿ç”¨ URL ä¸‹è½½è¿œç¨‹èµ„æºã€‚é€šå¸¸æ¨èä½¿ç”¨ COPYï¼Œé™¤ééœ€è¦è¿™äº›é«˜çº§åŠŸèƒ½ã€‚ ARG å®šä¹‰æ„å»ºé˜¶æ®µä½¿ç”¨çš„å˜é‡ï¼Œå¯åœ¨ docker build å‘½ä»¤ä¸­é€šè¿‡ --build-arg ä¼ å…¥ï¼Œå˜é‡ä»…åœ¨æ„å»ºæ—¶æœ‰æ•ˆï¼Œä¸ä¼šä¿ç•™åœ¨æœ€ç»ˆé•œåƒä¸­ã€‚ CMD æŒ‡å®šå®¹å™¨é»˜è®¤æ‰§è¡Œçš„å‘½ä»¤å’Œå‚æ•°ï¼Œå®¹å™¨è¿è¡Œæ—¶è‹¥æœªæŒ‡å®šå‘½ä»¤ï¼Œåˆ™ä½¿ç”¨è¯¥æŒ‡ä»¤è®¾ç½®çš„å‘½ä»¤ã€‚å¦‚æœé…ç½®äº†å¤šä¸ªCMDï¼Œåˆ™åªæœ‰æœ€åä¸€ä¸ªç”Ÿæ•ˆã€‚å’ŒENTRYPOINTå…±åŒä½¿ç”¨æ—¶ï¼Œä½œä¸ºä¼ é€’ç»™ENTRYPOINTçš„å‚æ•°ã€‚å¯è¢« docker run æä¾›çš„å‘½ä»¤è¦†ç›–ã€‚ COPY å°†æ„å»ºä¸Šä¸‹æ–‡ä¸­çš„æ–‡ä»¶æˆ–ç›®å½•å¤åˆ¶åˆ°é•œåƒä¸­ã€‚ç›¸æ¯” ADD æ›´ç®€å•ã€å®‰å…¨ï¼Œæ¨èä¼˜å…ˆä½¿ç”¨ã€‚ ENTRYPOINT æŒ‡å®šå®¹å™¨å¯åŠ¨æ—¶çš„ä¸»å‘½ä»¤ï¼Œä¸å®¹æ˜“è¢« docker run ä¸­çš„å‘½ä»¤è¦†ç›–ã€‚å¯ä¸ CMD é…åˆä½¿ç”¨ï¼Œç”¨äºæä¾›é»˜è®¤å‚æ•°ã€‚ ENV è®¾ç½®ç¯å¢ƒå˜é‡ï¼Œå˜é‡å°†åœ¨æ„å»ºå’Œå®¹å™¨è¿è¡Œæ—¶å‡å¯ä½¿ç”¨ã€‚ä¾‹å¦‚ï¼šé…ç½®åº”ç”¨å‚æ•°æˆ–ç³»ç»Ÿè·¯å¾„ç­‰ã€‚ EXPOSE å£°æ˜å®¹å™¨è¿è¡Œæ—¶å°†å¼€æ”¾çš„ç«¯å£ï¼Œä»…ç”¨äºæ–‡æ¡£è¯´æ˜æˆ–ä¸å®¹å™¨ç¼–æ’å·¥å…·é…åˆï¼Œä¸ä¼šè‡ªåŠ¨è¿›è¡Œç«¯å£æ˜ å°„ã€‚ FROM æŒ‡å®šåŸºç¡€é•œåƒï¼Œæ˜¯ Dockerfile çš„èµ·ç‚¹ã€‚ä¹Ÿå¯ä»¥ç”¨äºå¤šé˜¶æ®µæ„å»ºï¼Œé€šè¿‡å¤šæ¬¡ä½¿ç”¨ FROM æŒ‡ä»¤åˆ›å»ºå¤šä¸ªæ„å»ºé˜¶æ®µã€‚ HEALTHCHECK å®šä¹‰å®¹å™¨å¥åº·æ£€æŸ¥å‘½ä»¤ï¼Œç”¨äºå®šæœŸæ£€æµ‹å®¹å™¨å†…éƒ¨æœåŠ¡çš„å¥åº·çŠ¶æ€ï¼Œå¯ç»“åˆå®¹å™¨ç¼–æ’ç³»ç»Ÿå®ç°æ•…éšœè‡ªåŠ¨æ¢å¤ã€‚ LABEL ä¸ºé•œåƒæ·»åŠ é”®å€¼å¯¹å½¢å¼çš„å…ƒæ•°æ®ï¼Œä¾‹å¦‚ç‰ˆæœ¬ã€ç»´æŠ¤è€…ã€ç”¨é€”è¯´æ˜ç­‰ï¼Œæ–¹ä¾¿é•œåƒç®¡ç†ä¸è‡ªåŠ¨åŒ–å¤„ç†ã€‚ MAINTAINER ï¼ˆå·²å¼ƒç”¨ï¼‰ç”¨äºæŒ‡å®šé•œåƒç»´æŠ¤è€…ä¿¡æ¯ï¼Œæ¨èæ”¹ç”¨ LABEL æ¥è®¾ç½®ä½œè€…ä¿¡æ¯ã€‚ ONBUILD å®šä¹‰ä¸€ä¸ªè§¦å‘æŒ‡ä»¤ï¼Œå½“å½“å‰é•œåƒä½œä¸ºåŸºç¡€é•œåƒè¢«å…¶ä»– Dockerfile ä½¿ç”¨æ—¶è‡ªåŠ¨æ‰§è¡Œã€‚å¸¸ç”¨äºåŸºç¡€é•œåƒçš„é¢„è®¾è¡Œä¸ºã€‚ RUN æ‰§è¡Œä¸€æ¡å‘½ä»¤å¹¶æäº¤ç»“æœä½œä¸ºæ–°é•œåƒå±‚ï¼Œå¸¸ç”¨äºå®‰è£…è½¯ä»¶åŒ…ã€å¤åˆ¶æ–‡ä»¶ã€è®¾ç½®æƒé™ç­‰æ„å»ºæ“ä½œã€‚ SHELL æ›´æ”¹ Dockerfile ä¸­åç»­ RUNã€CMDã€ENTRYPOINT ç­‰æŒ‡ä»¤çš„é»˜è®¤ shellï¼ˆå¦‚ä½¿ç”¨ sh æˆ– powershellï¼‰ã€‚ STOPSIGNAL è®¾ç½®å®¹å™¨ç»ˆæ­¢æ—¶å‘é€çš„ç³»ç»Ÿä¿¡å·ï¼ˆå¦‚ SIGTERMï¼‰ï¼Œç”¨äºä¼˜é›…å…³é—­åº”ç”¨ã€‚ USER è®¾ç½®æ‰§è¡Œåç»­å‘½ä»¤æ—¶æ‰€ä½¿ç”¨çš„ç”¨æˆ·å’Œç”¨æˆ·ç»„ï¼Œå¢å¼ºå®¹å™¨çš„å®‰å…¨æ€§ï¼Œé¿å…ä½¿ç”¨ root æƒé™ã€‚ VOLUME å®šä¹‰å®¹å™¨å†…çš„æŒ‚è½½ç‚¹ï¼Œç”¨äºæŒä¹…åŒ–æ•°æ®æˆ–ä¸å®¿ä¸»æœº/å…¶ä»–å®¹å™¨å…±äº«æ•°æ®ã€‚è¿è¡Œå®¹å™¨æ—¶å¯æŒ‡å®šæŒ‚è½½è·¯å¾„ã€‚ WORKDIR è®¾ç½®å·¥ä½œç›®å½•ï¼Œç›¸å½“äºæ‰§è¡Œ cdï¼Œç”¨äºç®€åŒ–åç»­å‘½ä»¤ä¸­çš„è·¯å¾„ã€‚è‹¥ç›®å½•ä¸å­˜åœ¨åˆ™è‡ªåŠ¨åˆ›å»ºã€‚ æ„å»ºé˜¶æ®µæŒ‡ä»¤ï¼šFROM, ARG, ENV, COPY, ADD, RUN, WORKDIR, LABEL, USER, SHELL, ONBUILD å¯åŠ¨é…ç½®æŒ‡ä»¤ï¼šCMD, ENTRYPOINT, HEALTHCHECK, EXPOSE, VOLUME, STOPSIGNAL Dockerfile æŒ‡ä»¤ä»‹ç» FROM FROM æŒ‡ä»¤ç”¨äºæŒ‡å®šåŸºç¡€é•œåƒï¼ˆbase imageï¼‰ï¼Œæ˜¯æ¯ä¸€ä¸ª Dockerfile ä¸­å¿…é¡»çš„ç¬¬ä¸€æ¡æŒ‡ä»¤ã€‚æ‰€æœ‰åç»­æŒ‡ä»¤éƒ½æ˜¯åŸºäºè¿™ä¸ªåŸºç¡€é•œåƒæ„å»ºçš„ã€‚ è¯­æ³• 12345FROM &lt;image&gt;[:&lt;tag&gt;] [AS &lt;stage-name&gt;]# è¯´æ˜ï¼š# &lt;image&gt;ï¼šé•œåƒåç§°ï¼ˆå¯ä»¥æ˜¯æœ¬åœ°å·²æœ‰çš„ï¼Œä¹Ÿå¯ä»¥æ˜¯ä» Docker Hub æˆ–å…¶ä»–é•œåƒä»“åº“æ‹‰å–çš„ï¼‰# [:&lt;tag&gt;]ï¼šé•œåƒæ ‡ç­¾ï¼ˆå¯é€‰ï¼Œé»˜è®¤æ˜¯ latestï¼‰# [AS &lt;stage-name&gt;]ï¼šä¸ºè¯¥æ„å»ºé˜¶æ®µæŒ‡å®šåç§°ï¼Œç”¨äºå¤šé˜¶æ®µæ„å»º ç¤ºä¾‹ 12345678910111213141516171819# ä½¿ç”¨æœ€æ–°ç‰ˆæœ¬çš„é•œåƒï¼ˆé»˜è®¤æ ‡ç­¾æ˜¯ latestï¼‰FROM node# ä½¿ç”¨æŒ‡å®šçš„æ ‡ç­¾FROM node:16.13.2-alpine# ä½¿ç”¨ç§æœ‰é•œåƒä»“åº“FROM private.registry.com/my-image:latest# ä½¿ç”¨å¤šé˜¶æ®µæ„å»ºFROM golang:1.20 AS builderWORKDIR /appCOPY . .RUN go build -o myappFROM alpine:latestCOPY --from=builder /app/myapp /usr/local/bin/myappENTRYPOINT [&quot;myapp&quot;]## è¿™é‡Œç”¨äº†ä¸¤ä¸ªé˜¶æ®µï¼š### builder é˜¶æ®µç”¨æ¥ç¼–è¯‘åº”ç”¨ï¼›### alpine é˜¶æ®µç”¨æ¥æ‰“åŒ…æœ€ç»ˆé•œåƒï¼ŒåªåŒ…å«ç¼–è¯‘å¥½çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå‡å°‘ä½“ç§¯ã€‚ WORKDIR WORKDIR æŒ‡å®šäº†å·¥ä½œç›®å½•ï¼Œå³åç»­æ‰€æœ‰æŒ‡ä»¤ï¼ˆå¦‚ RUNã€CMDã€ENTRYPOINTã€COPYã€ADD ç­‰ï¼‰æ‰€è¿è¡Œçš„å½“å‰è·¯å¾„ï¼ˆworking directoryï¼‰ã€‚ å¦‚æœç›®å½•ä¸å­˜åœ¨ï¼ŒDocker ä¼šè‡ªåŠ¨åˆ›å»ºå®ƒã€‚ æ¯ä¸ª WORKDIR éƒ½ä¼šåˆ›å»ºä¸€å±‚é•œåƒï¼ˆlayerï¼‰ï¼Œæ‰€ä»¥ä¸è¦é‡å¤è®¾ç½®æ— æ„ä¹‰çš„è·¯å¾„ã€‚ è¯­æ³• 123WORKDIR &lt;path&gt;# è¯´æ˜ï¼š# &lt;path&gt;ï¼šè¦åˆ‡æ¢çš„å·¥ä½œç›®å½•ï¼Œå¯ä»¥æ˜¯ç»å¯¹è·¯å¾„æˆ–ç›¸å¯¹è·¯å¾„ã€‚ ç¤ºä¾‹ 12345678910111213# è®¾ç½®ç»å¯¹è·¯å¾„WORKDIR /app# è¿ç»­è®¾ç½®å¤šä¸ªå·¥ä½œç›®å½•ï¼ˆé€å±‚åµŒå¥—ï¼‰WORKDIR /varWORKDIR wwwWORKDIR html# ç­‰åŒäº:WORKDIR /var/www/html# é¿å…åœ¨ RUN cd some_dir åç»§ç»­æ‰§è¡Œä¾èµ–è·¯å¾„çš„å‘½ä»¤ï¼Œå› ä¸º Docker æ¯ä¸€æ¡æŒ‡ä»¤éƒ½æ˜¯æ–°çš„ shell å®ä¾‹ï¼Œcd ä¸ä¼šè·¨æŒ‡ä»¤ä¿ç•™ï¼Œåº”è¯¥æ”¹ç”¨ WORKDIRã€‚RUN cd some_dir # é”™è¯¯WORKDIR some_dir # æ­£ç¡® ARG ARG ç”¨äºåœ¨ æ„å»ºé•œåƒæ—¶ï¼ˆbuild-timeï¼‰ä¼ å…¥å‚æ•°ã€‚è¿™äº›å‚æ•°åªåœ¨ æ„å»ºé˜¶æ®µæœ‰æ•ˆï¼Œä¸ä¼šå‡ºç°åœ¨æœ€ç»ˆé•œåƒä¸­ï¼Œä¹Ÿä¸ä¼šåœ¨å®¹å™¨è¿è¡Œæ—¶è¢«ä¿ç•™ã€‚ è¯­æ³• 1234ARG &lt;name&gt;[=&lt;default_value&gt;]# è¯´æ˜ï¼š# &lt;name&gt;ï¼šå‚æ•°åç§°# [=&lt;default_value&gt;]ï¼šå‚æ•°çš„é»˜è®¤å€¼ï¼Œå¦‚æœæœªä¼ å…¥å‚æ•°ï¼Œåˆ™ä½¿ç”¨é»˜è®¤å€¼ï¼Œå¦‚æœä¸ºè®¾ç½®default_valueï¼Œåˆ™æ„å»ºé•œåƒæ—¶å¿…é¡»ä¼ é€’å‚æ•°ï¼Œ--build-arg ç¤ºä¾‹ 12345678910# å®šä¹‰ä¸€ä¸ªå‚æ•°ï¼Œåœ¨æ„å»ºé•œåƒæ—¶å¿…é¡»ä¼ å…¥å‚æ•°ï¼Œ--build-arg APP_ENV=developmentARG APP_ENV# å¸¦é»˜è®¤å€¼çš„ ARGARG APP_ENV=development# ä½¿ç”¨å‚æ•°RUN echo &quot;å½“å‰ç¯å¢ƒï¼š$&#123;APP_ENV&#125;&quot;# ä¸ FROM ä¸€èµ·ç”¨ï¼ˆä» Docker 17.05 èµ·ï¼‰ARG BASE=ubuntuFROM $&#123;BASE&#125;:22.04 ENV ENV æŒ‡ä»¤ç”¨äºåœ¨é•œåƒæ„å»ºè¿‡ç¨‹ä¸­å®šä¹‰ç¯å¢ƒå˜é‡ï¼ˆEnvironment Variablesï¼‰ã€‚è¿™äº›å˜é‡å¯ä»¥åœ¨ä¹‹åçš„æ„å»ºæ­¥éª¤ï¼ˆæ¯”å¦‚ RUNã€CMD ç­‰ï¼‰ä¸­ä½¿ç”¨ï¼Œä¹Ÿä¼šåœ¨å®¹å™¨è¿è¡Œæ—¶ç”Ÿæ•ˆã€‚ è¯­æ³• 1234567# ä¸¤ç§è¯­æ³•ENV &lt;key&gt; &lt;value&gt;ENV &lt;key&gt;=&lt;value&gt; ...# è¯´æ˜ï¼š# &lt;key&gt;ï¼šç¯å¢ƒå˜é‡çš„åç§°# &lt;value&gt;ï¼šç¯å¢ƒå˜é‡çš„å€¼# å¦‚æœå®šä¹‰å¤šä¸ªå˜é‡ï¼Œæ¨èä½¿ç”¨ key=value çš„å½¢å¼ã€‚ ç¤ºä¾‹ 123456789101112# å®šä¹‰ä¸€ä¸ªç¯å¢ƒå˜é‡ENV APP_ENV=production# å®šä¹‰å¤šä¸ªå˜é‡ENV APP_PORT=8080 NODE_ENV=production# ä½¿ç”¨å¤šè¡Œæ ¼å¼ï¼ˆæé«˜å¯è¯»æ€§ï¼‰ENV PATH=&quot;/usr/local/bin:$&#123;PATH&#125;&quot; \\ LANG=&quot;en_US.UTF-8&quot; \\ TZ=&quot;Asia/Shanghai&quot;# ä¹Ÿå¯ä»¥åˆ†å¼€å®šä¹‰ENV PATH=&quot;/usr/local/bin:$PATH&quot;ENV LANG=&quot;en_US.UTF-8&quot;ENV TZ=&quot;Asia/Shanghai&quot; æ³¨æ„ï¼šENV æŒ‡ä»¤å®šä¹‰çš„ç¯å¢ƒå˜é‡åœ¨æ„å»ºé˜¶æ®µå’Œè¿è¡Œé˜¶æ®µéƒ½ä¼šç”Ÿæ•ˆï¼Œä½†è¿è¡Œé˜¶æ®µä¼šè¦†ç›–æ„å»ºé˜¶æ®µå®šä¹‰çš„å˜é‡ã€‚ LABEL LABEL ç”¨äºä¸ºé•œåƒæ·»åŠ å…ƒæ•°æ®æ ‡ç­¾ï¼Œä»¥ key=value çš„å½¢å¼å­˜åœ¨ã€‚è¿™äº›æ ‡ç­¾å¯ä»¥æ˜¯ä½œè€…ä¿¡æ¯ã€ç‰ˆæœ¬æè¿°ã€ç”¨é€”è¯´æ˜ã€æ„å»ºæ—¶é—´ç­‰ã€‚ æ—§çš„ MAINTAINER æŒ‡ä»¤ç°åœ¨å·²è¢«åºŸå¼ƒï¼Œæ¨èä½¿ç”¨ LABEL æ¥ä»£æ›¿ã€‚ æ¯ä¸ª LABEL éƒ½ä¼šåˆ›å»ºä¸€å±‚é•œåƒï¼ˆlayerï¼‰ï¼Œæ¨èä¸€æ¬¡è®¾ç½®å¤šä¸ªã€‚ è¯­æ³• 1234LABEL &lt;key&gt;=&lt;value&gt; [&lt;key&gt;=&lt;value&gt;...]# è¯´æ˜ï¼š# &lt;key&gt;ï¼šæ ‡ç­¾çš„é”®# &lt;value&gt;ï¼šæ ‡ç­¾çš„å€¼ ç¤ºä¾‹ 12345678# æ·»åŠ ä¸€ä¸ªæ ‡ç­¾LABEL maintainer=&quot;yourname@example.com&quot;# æ¢è¡Œæ ¼å¼ï¼ˆæ¨èï¼‰,ä»¥ä¸‹æ ‡ç­¾ç¬¦åˆ OCIï¼ˆOpen Container Initiativeï¼‰ é•œåƒè§„èŒƒLABEL \\ org.opencontainers.image.title=&quot;MyApp&quot; \\ org.opencontainers.image.description=&quot;æ¼”ç¤ºé¡¹ç›®&quot; \\ org.opencontainers.image.version=&quot;1.0.0&quot; \\ org.opencontainers.image.authors=&quot;zhangsan@example.com&quot; USER USER æŒ‡ä»¤ç”¨äºæŒ‡å®šåç»­æŒ‡ä»¤ï¼ˆå¦‚ RUNã€CMDã€ENTRYPOINTã€COPY ç­‰ï¼‰ä»¥å“ªä¸ªç”¨æˆ·èº«ä»½æ¥æ‰§è¡Œã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼ŒDocker å®¹å™¨ä¸­çš„å‘½ä»¤ä»¥ root ç”¨æˆ·è¿è¡Œï¼Œè¿™è™½ç„¶çµæ´»ä½†ä¸å®‰å…¨ã€‚ä½¿ç”¨ USER å¯ä»¥è®©æˆ‘ä»¬åˆ‡æ¢åˆ°æ™®é€šç”¨æˆ·ï¼Œä»è€Œæå‡å®¹å™¨çš„å®‰å…¨æ€§ï¼Œé˜²æ­¢æ½œåœ¨çš„æƒé™æ»¥ç”¨ã€‚ è¯­æ³• 1234USER &lt;user&gt;[:&lt;group&gt;]# è¯´æ˜ï¼š# &lt;user&gt;ï¼šç”¨æˆ·åæˆ– UID# [:&lt;group&gt;]ï¼šå¯é€‰ï¼Œç”¨æˆ·ç»„åæˆ– GID ç¤ºä¾‹ 123456# è®¾ç½®ç”¨æˆ·USER appuser# è®¾ç½®ç”¨æˆ·ç»„USER appuser:appgroup# ä½¿ç”¨ UID å’Œ GIDUSER 1000:1000 å¦‚æœåŸºç¡€é•œåƒä¸­æ²¡æœ‰ä½ æƒ³è¦çš„ç”¨æˆ·ï¼Œéœ€è¦åœ¨ Dockerfile ä¸­æ‰‹åŠ¨åˆ›å»º 1234# åˆ›å»ºç”¨æˆ·å’Œç»„RUN groupadd -r appgroup &amp;&amp; useradd -r -g appgroup appuser# åˆ‡æ¢ç”¨æˆ·USER appuser ADD ADD ç”¨äºå°†æœ¬åœ°æ–‡ä»¶æˆ–ç›®å½•ã€è¿œç¨‹æ–‡ä»¶ï¼ˆURLï¼‰ æˆ– å‹ç¼©åŒ… å¤åˆ¶åˆ°é•œåƒä¸­çš„æŒ‡å®šä½ç½®ã€‚ å®ƒçš„åŠŸèƒ½ç±»ä¼¼äº COPYï¼Œä½†æ¯” COPY å¤šå‡ ä¸ªåŠŸèƒ½ï¼ˆè§£å‹ã€æ‹‰å–è¿œç¨‹æ–‡ä»¶ç­‰ï¼‰ã€‚ è¯­æ³• 1234ADD &lt;src&gt;... &lt;dest&gt;# è¯´æ˜ï¼š# &lt;src&gt;ï¼šè¦å¤åˆ¶çš„æ–‡ä»¶æˆ–ç›®å½•ï¼Œå¯ä»¥æ˜¯æœ¬åœ°æ–‡ä»¶ã€è¿œç¨‹ URLã€å‹ç¼©åŒ…ç­‰# &lt;dest&gt;ï¼šç›®æ ‡è·¯å¾„ ç¤ºä¾‹ 12345678910# ä»æœ¬åœ°æ–‡ä»¶å¤åˆ¶ADD app.jar /app.jar# å¤åˆ¶å¤šä¸ªADD app1.jar app2.jar /app/# é€šé…ç¬¦ADD static-assets/*.html /app/public/# ä»è¿œç¨‹ URL å¤åˆ¶ADD https://example.com/app.jar /app.jar# ä»å‹ç¼©åŒ…ä¸­å¤åˆ¶ADD static-assets.tar.gz /app/public/ æœ€ä½³å®è·µæ˜¯ä¼˜å…ˆä½¿ç”¨ COPYï¼Œåªæœ‰åœ¨éœ€è¦ ADD çš„é¢å¤–åŠŸèƒ½æ—¶æ‰ä½¿ç”¨å®ƒã€‚ COPY COPY æŒ‡ä»¤ç”¨äºå°†ä¸»æœºä¸Šçš„æ–‡ä»¶æˆ–ç›®å½•å¤åˆ¶åˆ°é•œåƒçš„æ–‡ä»¶ç³»ç»Ÿä¸­ã€‚å®ƒæ˜¯æ„å»ºé•œåƒè¿‡ç¨‹ä¸­æœ€å¸¸ç”¨çš„æ•°æ®å¼•å…¥æ–¹å¼ä¹‹ä¸€ã€‚ ä¸ ADD ç±»ä¼¼ï¼Œä½†åŠŸèƒ½æ›´ç®€å•ã€æ˜ç¡®ã€å®‰å…¨ æ¨èä¼˜å…ˆä½¿ç”¨ COPYï¼Œé™¤éä½ ç¡®å®éœ€è¦ ADD æä¾›çš„è‡ªåŠ¨è§£å‹æˆ–è¿œç¨‹ä¸‹è½½åŠŸèƒ½ã€‚ è¯­æ³• 1234COPY &lt;src&gt;... &lt;dest&gt;# è¯´æ˜ï¼š# &lt;src&gt;ï¼šè¦å¤åˆ¶çš„æ–‡ä»¶æˆ–ç›®å½•# &lt;dest&gt;ï¼šç›®æ ‡è·¯å¾„ ç¤ºä¾‹ 12345678910# å¤åˆ¶å•ä¸ªæ–‡ä»¶COPY app.jar /app.jar# å¤åˆ¶å¤šä¸ªæ–‡ä»¶COPY app1.jar app2.jar /app/# å¤åˆ¶ç›®å½•COPY static-assets/ /app/public/# é€šé…ç¬¦COPY static-assets/*.html /app/public/# è®¾ç½®ç›®æ ‡æ–‡ä»¶å±ä¸»å±ç»„COPY --chown=appuser:appgroup app.jar /app.jar RUN RUN æŒ‡ä»¤ç”¨äºåœ¨é•œåƒæ„å»ºé˜¶æ®µæ‰§è¡Œå‘½ä»¤ï¼Œç»“æœä¼šè¢«æ‰“åŒ…è¿›é•œåƒå±‚ä¸­ã€‚ å®ƒå¯ä»¥ç”¨äºå®‰è£…ä¾èµ–ã€ç¼–è¯‘ä»£ç ã€è¿è¡Œå‘½ä»¤ç­‰ã€‚ æ¯ä¸€æ¡ RUN æŒ‡ä»¤ä¼šåˆ›å»ºä¸€å±‚é•œåƒï¼ˆlayerï¼‰,åˆå¹¶å¤šä¸ªå‘½ä»¤æˆä¸€æ¡ RUNï¼Œå¯ä»¥å‡å°‘é•œåƒå±‚æ•°ï¼ˆä¾‹å¦‚ä½¿ç”¨ &amp;&amp; ä¸²è”ï¼‰ã€‚ è¯­æ³• 12345# ç¬¬ä¸€ç§æ ¼å¼ï¼šå®é™…è¿è¡Œçš„æ˜¯ï¼š/bin/sh -c &quot;&lt;å‘½ä»¤å­—ç¬¦ä¸²&gt;&quot;RUN &lt;å‘½ä»¤å­—ç¬¦ä¸²&gt;# ç¬¬äºŒç§æ ¼å¼RUN [&quot;å¯æ‰§è¡Œæ–‡ä»¶&quot;, &quot;å‚æ•°1&quot;, &quot;å‚æ•°2&quot;, ...] ç¤ºä¾‹ 12345678910# å‘½ä»¤å­—ç¬¦ä¸²RUN apt-get update &amp;&amp; apt-get install -y curl# æ„å»ºå¤šä¸ªå‘½ä»¤(ç”¨ &amp;&amp; ä¸²è”)RUN apt-get update &amp;&amp; \\ apt-get install -y python3 &amp;&amp; \\ rm -rf /var/lib/apt/lists/*# å¯æ‰§è¡Œæ–‡ä»¶å‚æ•°RUN [&quot;/bin/sh&quot;, &quot;-c&quot;, &quot;curl https://example.com/app.jar &gt; app.jar&quot;] CMD CMD ç”¨äºæŒ‡å®šå®¹å™¨å¯åŠ¨æ—¶é»˜è®¤æ‰§è¡Œçš„å‘½ä»¤åŠå…¶å‚æ•°ã€‚ å¦‚æœç”¨æˆ·åœ¨è¿è¡Œå®¹å™¨æ—¶æ²¡æœ‰æ‰‹åŠ¨æŒ‡å®šå…¶ä»–å‘½ä»¤ï¼ŒDocker å°±ä¼šä½¿ç”¨ CMD æä¾›çš„å†…å®¹ã€‚ å®ƒå¯ä»¥å®šä¹‰å¤šä¸ªï¼Œä½†åªæœ‰æœ€åä¸€ä¸ªä¼šè¢«ä½¿ç”¨ã€‚ è¯­æ³• 1234567# Shell å½¢å¼ï¼ˆå­—ç¬¦ä¸²ï¼‰CMD command param1 param2# ç­‰ä»·äº /bin/sh -c &quot;command param1 param2&quot;# Exec å½¢å¼ï¼ˆæ•°ç»„ï¼‰CMD [&quot;executable&quot;, &quot;param1&quot;, &quot;param2&quot;, ...] ç¤ºä¾‹ 123456789# ç®€å• shell å‘½ä»¤CMD echo &quot;Hello from container&quot;# Exec å½¢å¼CMD [&quot;npm&quot;, &quot;start&quot;]# ä½œä¸º ENTRYPOINT çš„å‚æ•°ENTRYPOINT [&quot;python3&quot;, &quot;app.py&quot;]CMD [&quot;--host=0.0.0.0&quot;, &quot;--port=8080&quot;] ç”¨æˆ·å¯ä»¥è¦†ç›– CMDï¼š 1docker run &lt;myapp&gt; npm run test ENTRYPOINT ENTRYPOINT å®šä¹‰å®¹å™¨å¯åŠ¨æ—¶æ‰§è¡Œçš„ä¸»å‘½ä»¤ï¼Œç›¸æ¯” CMDï¼Œå®ƒä¸å®¹æ˜“è¢«è¦†ç›–ï¼Œæ›´é€‚åˆåˆ¶ä½œâ€œä¸“ç”¨å‹â€å®¹å™¨ï¼ˆå¦‚ nginxã€python è„šæœ¬ç­‰ï¼‰ã€‚ ä½ å¯ä»¥æŠŠ ENTRYPOINT ç†è§£ä¸ºå®¹å™¨çš„â€œä¸»ç¨‹åºâ€ï¼Œè€Œ CMD æ˜¯ä¸ºå®ƒæä¾›çš„é»˜è®¤â€œå‘½ä»¤è¡Œå‚æ•°â€ã€‚ è¯­æ³• 123456# Shell å½¢å¼ï¼ˆå­—ç¬¦ä¸²ï¼‰ENTRYPOINT command param1 param2# ç­‰ä»·äº /bin/sh -c &quot;command param1 param2&quot;# Exec å½¢å¼ï¼ˆæ•°ç»„ï¼‰ENTRYPOINT [&quot;executable&quot;, &quot;param1&quot;, &quot;param2&quot;, ...] ç¤ºä¾‹ 123456789# ç®€å• shell å‘½ä»¤ENTRYPOINT echo &quot;Hello from container&quot;# Exec å½¢å¼ENTRYPOINT [&quot;npm&quot;, &quot;start&quot;]# ç»“åˆ CMD ä½¿ç”¨ENTRYPOINT [&quot;python3&quot;, &quot;app.py&quot;]CMD [&quot;--host=0.0.0.0&quot;, &quot;--port=8080&quot;] EXPOSE EXPOSE ç”¨äºå£°æ˜å®¹å™¨å°†ä¼šç›‘å¬çš„ç«¯å£ï¼Œè®©ä½¿ç”¨è¯¥é•œåƒçš„äººçŸ¥é“åº”è¯¥å¯¹å¤–å¼€æ”¾å“ªäº›ç«¯å£ã€‚ âš ï¸ æ³¨æ„ï¼šEXPOSE å¹¶ä¸ä¼šçœŸçš„å¼€æ”¾ç«¯å£ï¼Œåªæ˜¯â€œå£°æ˜â€è¿™ä¸ªå®¹å™¨ç›‘å¬äº†è¿™äº›ç«¯å£ã€‚ è¦è®©ç«¯å£çœŸæ­£æš´éœ²å‡ºæ¥ï¼Œè¿˜éœ€è¦åœ¨è¿è¡Œå®¹å™¨æ—¶åŠ ä¸Š -p æˆ– --publish å‚æ•°ã€‚ è¯­æ³• 1234EXPOSE &lt;port&gt; [&lt;port&gt;/&lt;protocol&gt;...]# è¯´æ˜ï¼š# &lt;port&gt;ï¼šç«¯å£å·ï¼Œå¯ä»¥æ˜¯å•ä¸ªç«¯å£å·ï¼Œä¹Ÿå¯ä»¥æ˜¯èŒƒå›´ï¼ˆå¦‚ 8080-8085ï¼‰# &lt;protocol&gt;ï¼šåè®®ï¼Œå¯ä»¥æ˜¯ tcp æˆ– udpï¼Œé»˜è®¤ä¸º tcp ç¤ºä¾‹ 1234EXPOSE 8080EXPOSE 8080/udpEXPOSE 8080-8085EXPOSE 8080 8081 8082 8083 8084 8085 VOLUME VOLUME æŒ‡ä»¤ç”¨äºå£°æ˜ä¸€ä¸ªæˆ–å¤šä¸ªå®¹å™¨ä¸­çš„æŒ‚è½½ç‚¹ï¼ˆmount pointï¼‰ï¼Œç”¨äºæŒä¹…åŒ–æ•°æ®æˆ–ä¸å®¿ä¸»æœº/å…¶ä»–å®¹å™¨å…±äº«æ•°æ®ã€‚ è¯­æ³•ï¼š 123VOLUME [&quot;/path/in/container&quot;, ...]# è·¯å¾„å¿…é¡»æ˜¯å®¹å™¨å†…éƒ¨çš„ç»å¯¹è·¯å¾„# å¯ä»¥ä¸€æ¬¡å£°æ˜ä¸€ä¸ªï¼Œä¹Ÿå¯ä»¥æ˜¯å¤šä¸ªã€‚ ç¤ºä¾‹ 1234# å£°æ˜ä¸€ä¸ªæŒ‚è½½ç‚¹VOLUME /app/public# å£°æ˜å¤šä¸ªæŒ‚è½½ç‚¹VOLUME [&quot;/app/public&quot;, &quot;/app/logs&quot;] å½“å®¹å™¨è¿è¡Œæ—¶ï¼Œå¯ä»¥å°†é•œåƒä¸­å£°æ˜çš„æŒ‚è½½ç‚¹æ˜ å°„åˆ°å®¿ä¸»æœºä¸Šï¼Œä»è€Œå®ç°æŒä¹…åŒ–æ•°æ®ã€‚ 1docker run -v /host/path:/app/public myimage å¦‚æœä½ æ²¡æœ‰æ‰‹åŠ¨ç»‘å®šæŒ‚è½½ï¼ŒDocker ä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªåŒ¿åå·ï¼Œå·çš„å†…å®¹é»˜è®¤ä¿å­˜åœ¨å®¿ä¸»æœºçš„ /var/lib/docker/volumes ä¸‹ã€‚ HEALTHCHECK HEALTHCHECK ç”¨æ¥å®šä¹‰å®¹å™¨è¿è¡Œæ—¶çš„å¥åº·æ£€æŸ¥å‘½ä»¤ï¼Œå®šæœŸæ£€æµ‹å®¹å™¨å†…æœåŠ¡çš„çŠ¶æ€ï¼Œå¸®åŠ©ç¼–æ’å·¥å…·ï¼ˆDocker Swarmã€Kubernetes ç­‰ï¼‰åˆ¤æ–­å®¹å™¨æ˜¯å¦å¥åº·ã€‚ å¦‚æœå¥åº·æ£€æŸ¥å¤±è´¥ï¼ŒDocker ä¼šå°†å®¹å™¨æ ‡è®°ä¸º unhealthyï¼Œä¾¿äºè‡ªåŠ¨é‡å¯æˆ–æ›¿æ¢ã€‚ è¯­æ³• 12345678HEALTHCHECK &lt;options&gt; CMD &lt;command&gt;# è¯´æ˜ï¼š# &lt;options&gt;ï¼šå¯é€‰é¡¹ï¼Œç”¨äºè®¾ç½®å¥åº·æ£€æŸ¥çš„é€‰é¡¹ï¼Œå¦‚è¶…æ—¶æ—¶é—´ã€é‡è¯•æ¬¡æ•°ç­‰ã€‚# &lt;command&gt;ï¼šå¥åº·æ£€æŸ¥å‘½ä»¤ï¼Œå¯ä»¥æ˜¯ä»»ä½•æœ‰æ•ˆçš„ shell å‘½ä»¤ã€‚ # å¿…é¡»è¿”å›é€€å‡ºç : # 0 è¡¨ç¤ºå¥åº· # 1 è¡¨ç¤ºä¸å¥åº· # 2 è¡¨ç¤ºæœªçŸ¥ å¯é€‰å‚æ•°ï¼ˆOPTIONSï¼‰ å‚æ•° è¯´æ˜ é»˜è®¤å€¼ --interval=DURATION ä¸¤æ¬¡å¥åº·æ£€æŸ¥ä¹‹é—´çš„æ—¶é—´é—´éš” 30s --timeout=DURATION å•æ¬¡æ£€æµ‹å‘½ä»¤çš„è¶…æ—¶æ—¶é—´ 30s --start-period=DURATION å®¹å™¨å¯åŠ¨åï¼Œå¼€å§‹å¥åº·æ£€æŸ¥å‰çš„ç­‰å¾…æ—¶é—´ 0s --retries=N è¿ç»­å¤±è´¥å‡ æ¬¡ååˆ¤å®šå®¹å™¨ä¸å¥åº· 3 ç¤ºä¾‹ 12# ä½¿ç”¨ curl æ£€æµ‹ Web æœåŠ¡æ˜¯å¦å“åº”HEALTHCHECK --interval=5s --timeout=3s --retries=3 CMD curl -f http://localhost:8080/health || exit 1 è¿è¡Œå®¹å™¨åï¼Œå¯ä»¥ç”¨å‘½ä»¤æŸ¥çœ‹å¥åº·çŠ¶æ€ 123456789# å¦‚æœé•œåƒä¸­æœ‰å¥åº·æ£€æŸ¥ï¼Œå¯ä»¥æŸ¥çœ‹å®¹å™¨çŠ¶æ€ï¼ˆSTATUSï¼‰docker ps # STATUS åˆ—ä¼šæ˜¾ç¤ºï¼š # healthy # unhealthy # startingï¼ˆå¯åŠ¨ä¸­ï¼‰# æŸ¥çœ‹æ›´è¯¦ç»†çš„ä¿¡æ¯docker inspect --format=&#x27;&#123;&#123;json .State.Health&#125;&#125;&#x27; &lt;container-id&gt; SHELL SHELL æŒ‡ä»¤ç”¨æ¥è‡ªå®šä¹‰åç»­ RUNã€CMD å’Œ ENTRYPOINT æŒ‡ä»¤æ‰€ä½¿ç”¨çš„é»˜è®¤ shell ç¨‹åºå’Œå‚æ•°ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼š åœ¨ Linux é•œåƒä¸­ï¼ŒDocker ä½¿ç”¨ /bin/sh -c åœ¨ Windows é•œåƒä¸­ï¼Œä½¿ç”¨ cmd /S /C ä½¿ç”¨ SHELLï¼Œä½ å¯ä»¥æ›¿æ¢ä¸ºå…¶ä»– shellï¼Œå¦‚ Bashã€PowerShellã€zsh ç­‰ã€‚ è¯­æ³• 1SHELL [&quot;executable&quot;, &quot;param1&quot;, &quot;param2&quot;, ...] ç¤ºä¾‹ 123456789101112# åˆ‡æ¢åˆ° bashSHELL [&quot;bash&quot;, &quot;-c&quot;]# å¤šæ¬¡åˆ‡æ¢SHELL [&quot;/bin/bash&quot;, &quot;-c&quot;]RUN echo &quot;Hello from Bash&quot; # åœ¨ Bash ä¸­æ‰§è¡ŒSHELL [&quot;/bin/sh&quot;, &quot;-c&quot;]RUN echo &quot;Now back to sh&quot; # åœ¨ sh ä¸­æ‰§è¡Œ# WindowsSHELL [&quot;powershell&quot;, &quot;-Command&quot;] STOPSIGNAL STOPSIGNAL æŒ‡å®šå½“å®¹å™¨æ”¶åˆ° docker stop å‘½ä»¤æ—¶ï¼Œå‘é€ç»™å®¹å™¨ä¸»è¿›ç¨‹çš„ä¿¡å·ç±»å‹ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼ŒDocker ä¼šå‘å®¹å™¨çš„ä¸»è¿›ç¨‹å‘é€ SIGTERM ä¿¡å·ï¼Œè®©å®ƒæœ‰æœºä¼šä¼˜é›…åœ°é€€å‡ºï¼ˆåœ¨è¶…æ—¶æ—¶æœªé€€å‡ºåˆ™å‘ SIGKILL å¼ºåˆ¶ç»ˆæ­¢ï¼‰ã€‚ é»˜è®¤æƒ…å†µï¼Œå¤§å¤šæ•°ç¨‹åºï¼ˆå¦‚ nginxï¼‰ï¼Œä¸éœ€è¦è®¾ç½®ï¼ˆé»˜è®¤ SIGTERMï¼‰ ä½†æœ‰äº›ç¨‹åºå¯èƒ½éœ€è¦ä½¿ç”¨ä¸åŒçš„ä¿¡å·ï¼Œæ¯”å¦‚ SIGINTã€SIGHUPï¼Œè¿™æ—¶ä½ å¯ä»¥é€šè¿‡ STOPSIGNAL æ¥ä¿®æ”¹ã€‚ è¯­æ³• 12345STOPSIGNAL &lt;signal&gt;# è¯´æ˜ï¼š# å…¶ä¸­ &lt;signal&gt; å¯ä»¥æ˜¯ï¼š# ä¿¡å·åç§°ï¼Œä¾‹å¦‚ï¼šSIGTERMã€SIGKILLã€SIGINTã€SIGHUP# æˆ–ä¿¡å·ç¼–å·ï¼Œä¾‹å¦‚ï¼š15ï¼ˆç­‰ä»·äº SIGTERMï¼‰ ç¤ºä¾‹ 12345# è¿™æ˜¯é»˜è®¤è¡Œä¸ºï¼Œä¸å†™ä¹Ÿä¸€æ ·ã€‚STOPSIGNAL SIGTERM# ä¿®æ”¹ä¸º SIGINTSTOPSIGNAL SIGINT ONBUILD ONBUILD ç”¨äºå®šä¹‰å»¶è¿Ÿæ‰§è¡Œçš„æ„å»ºæŒ‡ä»¤ï¼Œå³è¿™äº›å‘½ä»¤ä¸ä¼šåœ¨å½“å‰ Dockerfile æ„å»ºæ—¶æ‰§è¡Œï¼Œè€Œæ˜¯åœ¨ ä»¥å½“å‰é•œåƒä¸ºåŸºç¡€çš„å­é•œåƒä¸­æ„å»ºæ—¶è§¦å‘æ‰§è¡Œã€‚ å®ƒçš„å…¸å‹ç”¨é€”æ˜¯ï¼šæ„å»ºä¸€ä¸ªâ€œé€šç”¨åŸºç¡€é•œåƒâ€ï¼Œè®©ä½¿ç”¨è€…åœ¨è‡ªå·±çš„ Dockerfile ä¸­ FROM å®ƒæ—¶è‡ªåŠ¨ç»§æ‰¿ä¸€äº›æ“ä½œï¼ˆæ¯”å¦‚ COPYã€RUN ç­‰ï¼‰ã€‚ ONBUILD æ˜¯ä¸€ç§è®¾è®¡æ¨¡å¼ï¼Œæ–¹ä¾¿åŸºç¡€é•œåƒä½œè€…é¢„å…ˆå®šä¹‰â€œæœªæ¥å­é•œåƒæ„å»ºæ—¶ä¸€å®šè¦æ‰§è¡Œçš„æ­¥éª¤â€ï¼Œè€Œä¸æ˜¯åœ¨åŸºç¡€é•œåƒä¸­â€œç¡¬ç¼–ç â€é‚£äº›æ­¥éª¤ã€‚ è¯­æ³• 123ONBUILD &lt;INSTRUCTION&gt;# è¯´æ˜ï¼š# &lt;INSTRUCTION&gt;ï¼šå¿…é¡»æ˜¯ä¸€ä¸ªåˆæ³•çš„ Dockerfile æŒ‡ä»¤ï¼Œå¦‚ RUNã€COPYã€ADDã€CMD ç­‰ï¼ˆä½†ä¸èƒ½æ˜¯ FROM, ONBUILD, HEALTHCHECK ç­‰ï¼‰ã€‚ ç¤ºä¾‹ 1234567891011121314151617# åŸºç¡€é•œåƒä¸­ä½¿ç”¨ ONBUILD# æ–‡ä»¶ï¼šDockerfile.baseFROM node:18WORKDIR /appONBUILD COPY . /appONBUILD RUN npm install# æ„å»ºåŸºç¡€é•œåƒdocker build -t my-node-base -f Dockerfile.base .# ä½¿ç”¨åŸºç¡€é•œåƒæ„å»ºå­é•œåƒ# æ–‡ä»¶ï¼šDockerfileï¼ˆå­é•œåƒï¼‰FROM my-node-baseCMD [&quot;node&quot;, &quot;index.js&quot;]# æ„å»ºå­é•œåƒæ—¶ï¼Œç­‰äºè‡ªåŠ¨æ’å…¥äº†ï¼šCOPY . /appRUN npm install ONBUILD æ˜¯ä¸€ç§â€œæ„å»ºé’©å­â€æœºåˆ¶ ONBUILD å¯ä»¥ç†è§£æˆâ€œé’©å­â€æˆ–â€œè§¦å‘å™¨â€ï¼š åœ¨åŸºç¡€é•œåƒæ„å»ºæ—¶ä¸æ‰§è¡Œ ä½†å½“æŸäººä»¥è¿™ä¸ªåŸºç¡€é•œåƒä¸ºèµ·ç‚¹å†™è‡ªå·±çš„ Dockerfileï¼Œå¹¶æ„å»ºæ—¶ï¼Œè¿™äº› ONBUILD é‡Œçš„æŒ‡ä»¤è‡ªåŠ¨æ’å…¥æ‰§è¡Œ è¿™æ ·ï¼š åŸºç¡€é•œåƒåªè´Ÿè´£å®šä¹‰ç¯å¢ƒï¼ˆnodeã€npmç‰ˆæœ¬ã€ç³»ç»Ÿä¾èµ–ç­‰ï¼‰ï¼Œä¿æŒè½»é‡ ä¸‹æ¸¸é¡¹ç›®å¯ä»¥ä¸ç”¨å†™é‡å¤çš„ä»£ç å¤åˆ¶å’Œå®‰è£…æŒ‡ä»¤ï¼Œè‡ªåŠ¨ç»§æ‰¿åŸºç¡€é•œåƒé¢„å®šä¹‰çš„æ„å»ºæ­¥éª¤ ä»£ç å¤åˆ¶å’Œä¾èµ–å®‰è£…åœ¨ä¸‹æ¸¸é•œåƒæ„å»ºæ—¶æ‰§è¡Œï¼Œä½¿ç”¨è‡ªå·±çš„ä¸Šä¸‹æ–‡ï¼ˆä¹Ÿå°±æ˜¯é¡¹ç›®ä»£ç ï¼‰ ONBUILD æ€»ç»“ ç‰¹æ€§ è¯´æ˜ â± å»¶è¿Ÿæ‰§è¡Œ æ„å»ºåŸºç¡€é•œåƒæ—¶ä¸ä¼šæ‰§è¡Œï¼Œåœ¨å­é•œåƒæ„å»ºæ—¶è§¦å‘ âœ… æ”¯æŒæŒ‡ä»¤ ä¾‹å¦‚ RUN, COPY, ADD, CMD, WORKDIR, ENV ç­‰ âŒ ä¸æ”¯æŒ FROM, ONBUILD, HEALTHCHECK, SHELL, STOPSIGNAL ğŸ‘ ä¸æ¨èæ»¥ç”¨ ä¼šéšè—æ„å»ºè¡Œä¸ºï¼Œé™ä½å¯ç»´æŠ¤æ€§ âœ… æ¨èåœºæ™¯ å›¢é˜Ÿå…±äº«æ¨¡æ¿ã€æ„å»ºâ€œæ ‡å‡†å¼€å‘é•œåƒâ€ Dockerfile å“ªäº› æŒ‡ä»¤ ä¼šåˆ›å»ºæ–°çš„å±‚ å½“ Dockerfile ä¸­åˆ›å»ºæ–°å±‚çš„æŒ‡ä»¤å†…å®¹å‘ç”Ÿå˜åŒ–æ—¶ï¼Œä½¿ç”¨ --no-cache é€‰é¡¹å¯ä»¥ç¡®ä¿è¿™äº›å˜æ›´è¢«æ­£ç¡®åº”ç”¨ã€‚ æŒ‡ä»¤ æè¿° ADD ä» å¤åˆ¶æ–‡ä»¶å¹¶è‡ªåŠ¨è§£å‹ï¼ˆå¦‚æœæ˜¯ä¸€ä¸ª tar æ–‡ä»¶ï¼‰åˆ°å®¹å™¨çš„ è·¯å¾„ã€‚ COPY ä» å¤åˆ¶æ–‡ä»¶åˆ°å®¹å™¨çš„ è·¯å¾„ï¼Œä¸ä¼šè‡ªåŠ¨è§£å‹ã€‚ RUN æ‰§è¡Œä»»æ„å‘½ä»¤å¹¶åœ¨å®¹å™¨ä¸­åšå‡ºæ›´æ”¹ã€‚æ¯æ¡ RUN æŒ‡ä»¤éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å±‚ã€‚ ENV è®¾ç½®ç¯å¢ƒå˜é‡ã€‚æ¯ä¸€è¡Œ ENV æŒ‡ä»¤éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å±‚ã€‚ WORKDIR è®¾ç½®å·¥ä½œç›®å½•ã€‚æ¯ä¸€è¡Œ WORKDIR æŒ‡ä»¤éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å±‚ã€‚ VOLUME åˆ›å»ºä¸€ä¸ªæŒ‚è½½ç‚¹ã€‚æ¯ä¸€è¡Œ VOLUME æŒ‡ä»¤éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å±‚ã€‚ LABEL æ·»åŠ å…ƒæ•°æ®æ ‡ç­¾ã€‚æ¯ä¸€è¡Œ LABEL æŒ‡ä»¤éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å±‚ã€‚ Dockerfile ç¤ºä¾‹: Spring Boot åº”ç”¨ ç›®å½•ç»“æ„ 1234567springbootweb/â”œâ”€â”€ Dockerfileâ”œâ”€â”€ target/â”‚ â””â”€â”€ app.jarâ”œâ”€â”€ static-assets.tar.gzâ””â”€â”€ ... Dockerfile 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748# ä½¿ç”¨è½»é‡çº§ Alpine ç‰ˆæœ¬çš„ OpenJDK 17 å®˜æ–¹é•œåƒï¼Œé€‚åˆéƒ¨ç½² Spring Boot åº”ç”¨FROM openjdk:17-alpine# è®¾ç½®æ„å»ºæ—¶å˜é‡ï¼Œé»˜è®¤ä½¿ç”¨æ„å»ºå¥½çš„ jar æ–‡ä»¶ARG JAR_FILE=target/app.jar# è®¾ç½®è¿è¡Œæ—¶ç¯å¢ƒå˜é‡ENV JAVA_OPTS=&quot;-Xms1024M -Xmx1024M -XX:MetaspaceSize=128M -XX:MaxMetaspaceSize=128M&quot;ENV TZ=Asia/Shanghai# é•œåƒå…ƒä¿¡æ¯LABEL maintainer=&quot;yourname@example.com&quot;LABEL version=&quot;1.0.0&quot;LABEL description=&quot;ç”¨äºéƒ¨ç½² Spring Boot åº”ç”¨çš„ç”Ÿäº§çº§é•œåƒ&quot;# è®¾ç½®å·¥ä½œç›®å½•WORKDIR /app# ç¤ºä¾‹ RUNï¼šå®‰è£… curlï¼ˆç”¨äºå®¹å™¨å¥åº·æ£€æŸ¥æˆ–è°ƒè¯•ï¼‰RUN apk add --no-cache curl# å¤åˆ¶ Spring Boot æ„å»ºç”Ÿæˆçš„ jar åŒ…COPY $&#123;JAR_FILE&#125; app.jar# è§£å‹é™æ€èµ„æºåˆ°å®¹å™¨ä¸­ï¼ˆADD å¯ä»¥è‡ªåŠ¨è§£å‹ tar.gzï¼‰ADD static-assets.tar.gz /app/public/# å£°æ˜æš´éœ²çš„åº”ç”¨ç«¯å£ï¼ˆSpring Boot é»˜è®¤æ˜¯ 8080ï¼‰EXPOSE 8080# å®¹å™¨å¥åº·æ£€æŸ¥ï¼šè®¿é—® actuator å¥åº·ç«¯ç‚¹HEALTHCHECK --interval=30s --timeout=5s --retries=3 \\ CMD curl -f http://localhost:8080/app/actuator/health || exit 1# å®¹å™¨ç»ˆæ­¢æ—¶ä¼˜é›…å…³é—­ï¼ˆJava æ¨è SIGTERMï¼‰STOPSIGNAL SIGTERM# è®¾ç½®å®¹å™¨å¯åŠ¨æ—¶çš„ä¸»å‘½ä»¤ï¼ˆENTRYPOINT ä¸ä¼šè¢« docker run å‚æ•°è¦†ç›–ï¼‰ENTRYPOINT [&quot;sh&quot;, &quot;-c&quot;, &quot;java $JAVA_OPTS -jar app.jar&quot;]# CMD æä¾›é»˜è®¤çš„è¿è¡Œå‚æ•°ï¼Œå¯ä»¥è¢« docker run è¦†ç›–# è¿™é‡Œé€šè¿‡ Spring Boot å‚æ•°è®¾ç½®å¯åŠ¨ç¯å¢ƒå’Œç«¯å£å·CMD [&quot;--spring.profiles.active=app&quot;, &quot;--server.port=8080&quot;]# è¿™é‡Œä½¿ç”¨çš„æ˜¯ ENTRYPOINT + CMD çš„æ··åˆæ¨¡å¼# å®Œæ•´å‘½ä»¤ï¼š java $JAVA_OPTS -jar app.jar --spring.profiles.active=app --server.port=8080# å£°æ˜ä¸€ä¸ªå·æŒ‚è½½ç‚¹ï¼Œè¿è¡Œå®¹å™¨æ—¶å¯å°†è¯¥è·¯å¾„æ˜ å°„åˆ°å®¿ä¸»æœºï¼Œå®ç°æ•°æ®æŒä¹…åŒ–VOLUME [&quot;/app/logs&quot;] æ„å»ºé•œåƒ 12# æ„å»ºé•œåƒæ—¶ç”¨ --build-arg æŒ‡å®šæ„å»ºå‚æ•°ï¼Œå¦‚æœéœ€è¦å¤šä¸ªï¼Œå°±é…ç½®å¤šä¸ª --build-argdocker build --build-arg JAR_FILE=target/app.jar -t springbootweb:latest . è¿è¡Œå®¹å™¨ 12345docker run -d --name springbootweb \\ -p 8080:8080 \\ -e JAVA_OPTS=&quot;-Xms512m -Xmx1024m&quot; \\ -v /home/centos/logs/app/:/app/logs \\ springbootweb:latest Dockerfile ç¤ºä¾‹: å¤šé˜¶æ®µæ„å»º 12345678910111213141516171819202122232425262728293031323334# ç¬¬ä¸€é˜¶æ®µï¼šè·å–ä»£ç FROM alpine/git as fetcherWORKDIR /workspace/application# å°†æ›¿æ¢ä¸ºå®é™…çš„Gitä»“åº“URLå’Œåˆ†æ”¯/æ ‡ç­¾ARG GIT_REPOSITORY=https://gitee.com/hanqunfeng/springbootweb.gitARG GIT_BRANCH=masterRUN git clone -b $&#123;GIT_BRANCH&#125; $&#123;GIT_REPOSITORY&#125; .# ç¬¬äºŒé˜¶æ®µï¼šä½¿ç”¨Mavenç¯å¢ƒè¿›è¡Œæ„å»ºFROM maven:3.8.4-openjdk-17 AS builderWORKDIR /workspace/application# ä»ç¬¬ä¸€é˜¶æ®µå¤åˆ¶ä»£ç COPY --from=fetcher /workspace/application .# ä½¿ç”¨Mavenæ¸…ç†å¹¶æ‰“åŒ…RUN mvn clean package -DskipTests# ç¬¬ä¸‰é˜¶æ®µï¼šåˆ›å»ºæœ€ç»ˆçš„è¿è¡Œç¯å¢ƒFROM openjdk:17-alpineWORKDIR /app# è®¾ç½®è¿è¡Œæ—¶ç¯å¢ƒå˜é‡ENV JAVA_OPTS=&quot;-Xms1024M -Xmx1024M -XX:MetaspaceSize=128M -XX:MaxMetaspaceSize=128M&quot;# å°†ç¬¬äºŒé˜¶æ®µç”Ÿæˆçš„ç›®æ ‡æ–‡ä»¶å¤åˆ¶åˆ°è¿™é‡Œã€‚æ³¨æ„è¿™é‡Œå‡è®¾ä½ çš„spring bootå·¥ç¨‹æ‰“æˆçš„jaråæ˜¯target/app.jarCOPY --from=builder /workspace/application/target/app.jar app.jar# æš´éœ²ç«¯å£ï¼ˆå¦‚æœéœ€è¦çš„è¯ï¼‰ã€‚è¯·æ ¹æ®å®é™…æƒ…å†µä¿®æ”¹ç«¯å£å·EXPOSE 8080# å£°æ˜ä¸€ä¸ªå·æŒ‚è½½ç‚¹ï¼Œè¿è¡Œå®¹å™¨æ—¶å¯å°†è¯¥è·¯å¾„æ˜ å°„åˆ°å®¿ä¸»æœºï¼Œå®ç°æ•°æ®æŒä¹…åŒ–VOLUME [&quot;/app/logs&quot;]# è®¾ç½®å®¹å™¨å¯åŠ¨æ—¶çš„ä¸»å‘½ä»¤ï¼ˆENTRYPOINT ä¸ä¼šè¢« docker run å‚æ•°è¦†ç›–ï¼‰ENTRYPOINT [&quot;sh&quot;, &quot;-c&quot;, &quot;java $JAVA_OPTS -jar app.jar&quot;]# CMD æä¾›é»˜è®¤çš„è¿è¡Œå‚æ•°ï¼Œå¯ä»¥è¢« docker run è¦†ç›–# è¿™é‡Œé€šè¿‡ Spring Boot å‚æ•°è®¾ç½®å¯åŠ¨ç¯å¢ƒå’Œç«¯å£å·CMD [&quot;--spring.profiles.active=app&quot;, &quot;--server.port=8080&quot;]# è¿™é‡Œä½¿ç”¨çš„æ˜¯ ENTRYPOINT + CMD çš„æ··åˆæ¨¡å¼# å®Œæ•´å‘½ä»¤ï¼š java $JAVA_OPTS -jar app.jar --spring.profiles.active=app --server.port=8080 æ„å»ºé•œåƒ 12# æ„å»ºé•œåƒï¼Œ--no-cache è¡¨ç¤ºä¸ä½¿ç”¨ç¼“å­˜ï¼Œæ¯æ¬¡æ„å»ºéƒ½ä¼šé‡æ–°æ„å»ºdocker build --no-cache -t app:latest . è¿è¡Œå®¹å™¨ 12345docker run -d --name app \\ -p 8080:8080 \\ -e JAVA_OPTS=&quot;-Xms512m -Xmx1024m&quot; \\ -v /home/centos/logs/app/:/app/logs \\ app:latest","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» Docker å‘½ä»¤ ä¸­ Dockerfile çš„ä½¿ç”¨æ–¹æ³• Dockerå®˜æ–¹æ–‡æ¡£ Dockerfileå®˜æ–¹æ–‡æ¡£","date_published":"2025-05-26T13:30:05.000Z","tags":["æŠ€æœ¯","docker","docker"]},{"id":"https://blog.hanqunfeng.com/2025/05/22/docker-command-image/","url":"https://blog.hanqunfeng.com/2025/05/22/docker-command-image/","title":"Docker å‘½ä»¤ ä¹‹ é•œåƒ(Image)","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç» Docker å‘½ä»¤ ä¸­ é•œåƒç®¡ç† ç›¸å…³å‘½ä»¤</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://docs.docker.com\">Dockerå®˜æ–¹æ–‡æ¡£</a></p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://docs.docker.com/reference/#application-programming-interfaces-apis\">Application programming interfaces (APIs)</a></p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"docker-search-æœç´¢é•œåƒ\"><code>docker search</code> : æœç´¢é•œåƒ</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ¨èåœ¨<a href=\"https://hub.docker.com/\">dockerhub</a>ä¸Šæœç´¢é•œåƒï¼Œä»¥è·å–æ›´è¯¦ç»†çš„é•œåƒä¿¡æ¯ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å›½å†…ä¹Ÿå¯ä»¥é€šè¿‡<a href=\"https://1ms.run/\">æ¯«ç§’é•œåƒ</a>,<a href=\"https://dockers.xuanyuan.me\">è½©è¾• Docker é•œåƒæœç´¢</a>æ¥æœç´¢é•œåƒã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ docker search --<span class=\"built_in\">help</span></span><br><span class=\"line\">ç”¨æ³•:  docker search [OPTIONS] TERM</span><br><span class=\"line\"></span><br><span class=\"line\">åœ¨ Docker Hub ä¸­æœç´¢é•œåƒ</span><br><span class=\"line\"></span><br><span class=\"line\">é€‰é¡¹:</span><br><span class=\"line\">  -f, --filter filter   æ ¹æ®æä¾›çš„æ¡ä»¶è¿‡æ»¤è¾“å‡ºï¼Œå¸¸è§çš„è¿‡æ»¤æ¡ä»¶åŒ…æ‹¬ï¼šstarsï¼ˆæ˜Ÿçº§ï¼‰ã€is-officialï¼ˆæ˜¯å¦ä¸ºå®˜æ–¹é•œåƒï¼‰</span><br><span class=\"line\">      --format string   ä½¿ç”¨ Go æ¨¡æ¿ç¾åŒ–è¾“å‡ºï¼Œä¸å¤ªå¸¸ç”¨</span><br><span class=\"line\">      --<span class=\"built_in\">limit</span> int       æœç´¢ç»“æœçš„æœ€å¤§æ•°é‡</span><br><span class=\"line\">      --no-trunc        ä¸æˆªæ–­è¾“å‡ºå†…å®¹ï¼Œæ˜¾ç¤ºå®Œæ•´ä¿¡æ¯ï¼ˆé»˜è®¤è¾“å‡ºä¸­æŸäº›å­—æ®µå¦‚æè¿°å¯èƒ½è¢«æˆªæ–­ï¼‰</span><br></pre></td></tr></table></figure>\n<h3 id=\"ç¤ºä¾‹\">ç¤ºä¾‹</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æœç´¢åç§°ä¸­åŒ…å« nginx çš„é•œåƒ</span></span><br><span class=\"line\">$ docker search nginx</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æœç´¢åç§°ä¸­åŒ…å« nginx ä¸”æ˜Ÿçº§ä¸å°‘äº 100 çš„é•œåƒã€‚</span></span><br><span class=\"line\">$ docker search -f stars=100 nginx</span><br><span class=\"line\"><span class=\"comment\"># æœç´¢å®˜æ–¹é•œåƒ</span></span><br><span class=\"line\">$ docker search -f is-official=<span class=\"literal\">true</span> nginx</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æœç´¢ nginxï¼ŒæŒ‰ç…§æŒ‡å®šæ¨¡æ¿æ ¼å¼åŒ–è¾“å‡º</span></span><br><span class=\"line\">$ docker search nginx --format <span class=\"string\">&quot;&#123;&#123;.Name&#125;&#125;: &#123;&#123;.StarCount&#125;&#125; stars:  &#123;&#123;.Description&#125;&#125;&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æœç´¢nginxé•œåƒï¼Œå¹¶é™åˆ¶5ä¸ªç»“æœ</span></span><br><span class=\"line\">$ docker search nginx --<span class=\"built_in\">limit</span> 5</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ç»„åˆä½¿ç”¨å¤šä¸ªé€‰é¡¹</span></span><br><span class=\"line\">$ docker search -f stars=100 --<span class=\"built_in\">limit</span> 5 --no-trunc nginx</span><br></pre></td></tr></table></figure>\n<div class=\"tips\">\n<p><em><strong><code>docker search</code> å‘½ä»¤æŠ¥é”™çš„è§£å†³æ–¹æ³•</strong></em></p>\n<ul class=\"lvl-1\">\n<li class=\"lvl-2\">ç›®å‰å›½å†…ä½¿ç”¨<code>docker search</code>æ—¶ä¼šå‡ºç°<code>Error response from daemon: Get &quot;https://index.docker.io/v1/search?q=nginx&amp;n=25&quot;: dial tcp 210.56.51.193:443: i/o timeout</code>çš„é”™è¯¯ï¼Œå³ä¾¿æˆ‘ä»¬é…ç½®äº†å›½å†…çš„é•œåƒæºï¼Œè¿™ä¸ªé”™è¯¯è¿˜æ˜¯ä¼šå­˜åœ¨ã€‚</li>\n<li class=\"lvl-2\">å³ä¾¿ä¸ºå®¿ä¸»æœºå’Œdockeréƒ½é…ç½®ä¸ŠDNSä¹Ÿä¾ç„¶ä¼šæŠ¥é”™ã€‚</li>\n<li class=\"lvl-2\">ä¸è¿‡å¯ä»¥é€šè¿‡ç¬¬ä¸‰æ–¹é•œåƒä»“åº“è¿›è¡ŒæŸ¥è¯¢ï¼Œæ¯”å¦‚åœ¨æŸ¥è¯¢çš„é•œåƒåç§°å‰åŠ ä¸Š <code>docker.1ms.run/</code>ï¼Œæ¯”å¦‚æŸ¥è¯¢<code>nginx</code>é•œåƒï¼Œåˆ™è¾“å…¥<code>docker search docker.1ms.run/nginx</code>ï¼Œè¿™é‡Œè¦æ³¨æ„å¹¶ä¸æ˜¯æ‰€æœ‰çš„ç¬¬ä¸‰æ–¹é•œåƒä»“åº“éƒ½æ”¯æŒæŸ¥è¯¢ã€‚</li>\n<li class=\"lvl-2\">å¯ä»¥ç¼–å†™ä¸€ä¸ªè„šæœ¬<code>docker_search</code>ï¼ŒæŸ¥è¯¢é•œåƒå¹¶è¾“å‡ºç»“æœï¼Œå¦‚ä¸‹ï¼š</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cat</span> &lt;&lt; <span class=\"string\">&#x27;EOF&#x27;</span> &gt; docker_search</span><br><span class=\"line\"><span class=\"comment\">#!/bin/bash</span></span><br><span class=\"line\">QUERY=<span class=\"variable\">$&#123;1&#125;</span>     <span class=\"comment\"># æŸ¥è¯¢å…³é”®è¯ï¼Œè¿™é‡Œè¦æ³¨æ„ï¼Œç¬¬ä¸€ä¸ªå‚æ•°å¿…é¡»æ˜¯æŸ¥è¯¢å…³é”®è¯</span></span><br><span class=\"line\"><span class=\"comment\"># è·å–é™¤ç¬¬ä¸€ä¸ªå‚æ•°å¤–çš„æ‰€æœ‰å‚æ•°</span></span><br><span class=\"line\">ARGS=<span class=\"variable\">$&#123;@:2&#125;</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;æŸ¥è¯¢é•œåƒï¼šdocker search docker.1ms.run/<span class=\"variable\">$QUERY</span> <span class=\"variable\">$ARGS</span>&quot;</span></span><br><span class=\"line\">docker search docker.1ms.run/<span class=\"variable\">$QUERY</span> <span class=\"variable\">$ARGS</span></span><br><span class=\"line\">EOF</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># è®¾ç½®æ‰§è¡Œæƒé™</span></span><br><span class=\"line\"><span class=\"built_in\">chmod</span> +x docker_search</span><br><span class=\"line\"><span class=\"comment\"># å°†å…¶ç§»åŠ¨åˆ° /usr/local/bin/</span></span><br><span class=\"line\"><span class=\"built_in\">mv</span> docker_search /usr/local/bin/docker_search</span><br><span class=\"line\"><span class=\"comment\"># å¦‚æœ/usr/local/bin/æ²¡æœ‰åœ¨PATHä¸­ï¼Œè¯·æ·»åŠ åˆ°ç¯å¢ƒå˜é‡</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;export PATH=<span class=\"variable\">$PATH</span>:/usr/local/sbin&quot;</span> &gt;&gt; ~/.bashrc</span><br><span class=\"line\"><span class=\"built_in\">source</span> ~/.bashrc</span><br><span class=\"line\"><span class=\"comment\"># æµ‹è¯•</span></span><br><span class=\"line\">docker_search redis -f stars=100 --<span class=\"built_in\">limit</span> 5 --no-trunc</span><br><span class=\"line\"><span class=\"comment\">## è¾“å‡º</span></span><br><span class=\"line\">NAME                DESCRIPTION                                                                                       STARS     OFFICIAL</span><br><span class=\"line\">redis               Redis is the worldâ€™s fastest data platform <span class=\"keyword\">for</span> caching, vector search, and NoSQL databases.      13315     [OK]</span><br><span class=\"line\">redis/redis-stack   redis-stack installs a Redis server with additional database capabilities and the RedisInsight.   149</span><br><span class=\"line\">bitnami/redis       Bitnami container image <span class=\"keyword\">for</span> Redis</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-1\">\n<li class=\"lvl-2\">åŸºäºurlæœç´¢ï¼Œæ”¯æŒåˆ†é¡µï¼Œä½†ä¸èƒ½æ”¯æŒå…¶å®ƒsearchå‚æ•°</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cat</span> &lt;&lt; <span class=\"string\">&#x27;EOF&#x27;</span> &gt; docker_search_by_url</span><br><span class=\"line\"><span class=\"comment\">#!/bin/bash</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å‚æ•°å¤„ç†</span></span><br><span class=\"line\">QUERY=<span class=\"variable\">$&#123;1:-nginx&#125;</span>     <span class=\"comment\"># é»˜è®¤æŸ¥è¯¢å…³é”®è¯</span></span><br><span class=\"line\">N=<span class=\"variable\">$&#123;2:-25&#125;</span>            <span class=\"comment\"># é»˜è®¤æ¯é¡µæ¡æ•°</span></span><br><span class=\"line\">PAGE=<span class=\"variable\">$&#123;3:-1&#125;</span>          <span class=\"comment\"># é»˜è®¤é¡µç </span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># é•œåƒæºåˆ—è¡¨ï¼šä¾æ¬¡å°è¯•è®¿é—®è¿™äº›åŸŸåï¼Œè¿™é‡Œè¦æ³¨æ„ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„é•œåƒæºéƒ½æ”¯æŒæœç´¢åŠŸèƒ½</span></span><br><span class=\"line\">REGISTRIES=(</span><br><span class=\"line\">  <span class=\"string\">&quot;docker.1ms.run&quot;</span></span><br><span class=\"line\">  <span class=\"string\">&quot;register.librax.org&quot;</span></span><br><span class=\"line\">  <span class=\"comment\"># ä½ å¯ä»¥ç»§ç»­æ·»åŠ å¤‡ç”¨åŸŸå</span></span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åˆå§‹åŒ–æˆåŠŸæ ‡å¿—</span></span><br><span class=\"line\">WORKING_URL=<span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># éå†åŸŸåï¼Œæ‰¾åˆ°ç¬¬ä¸€ä¸ªå¯è®¿é—®çš„</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> REG <span class=\"keyword\">in</span> <span class=\"string\">&quot;<span class=\"variable\">$&#123;REGISTRIES[@]&#125;</span>&quot;</span>; <span class=\"keyword\">do</span></span><br><span class=\"line\">  TEST_URL=<span class=\"string\">&quot;https://<span class=\"variable\">$&#123;REG&#125;</span>/v1/search?q=test&amp;n=1&quot;</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> curl -s --connect-timeout 2 <span class=\"string\">&quot;<span class=\"variable\">$TEST_URL</span>&quot;</span> | grep -q <span class=\"string\">&#x27;&quot;results&quot;&#x27;</span>; <span class=\"keyword\">then</span></span><br><span class=\"line\">    WORKING_URL=<span class=\"string\">&quot;https://<span class=\"variable\">$&#123;REG&#125;</span>/v1/search?q=<span class=\"variable\">$&#123;QUERY&#125;</span>&amp;n=<span class=\"variable\">$&#123;N&#125;</span>&amp;page=<span class=\"variable\">$&#123;PAGE&#125;</span>&quot;</span></span><br><span class=\"line\">    <span class=\"built_in\">break</span></span><br><span class=\"line\">  <span class=\"keyword\">fi</span></span><br><span class=\"line\"><span class=\"keyword\">done</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å¦‚æœéƒ½å¤±è´¥ï¼Œé€€å‡º</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> [ -z <span class=\"string\">&quot;<span class=\"variable\">$WORKING_URL</span>&quot;</span> ]; <span class=\"keyword\">then</span></span><br><span class=\"line\">  <span class=\"built_in\">echo</span> <span class=\"string\">&quot;âŒ æ— æ³•è¿æ¥ä»»ä½•é•œåƒæºï¼Œè¯·æ£€æŸ¥ç½‘ç»œæˆ–å¤‡ç”¨åŸŸåè®¾ç½®ã€‚&quot;</span></span><br><span class=\"line\">  <span class=\"built_in\">exit</span> 1</span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># è¯·æ±‚æ•°æ®å¹¶æ ¼å¼åŒ–è¾“å‡º</span></span><br><span class=\"line\">curl -s <span class=\"string\">&quot;<span class=\"variable\">$WORKING_URL</span>&quot;</span> \\</span><br><span class=\"line\">| jq -r <span class=\"string\">&#x27;[&quot;NAME&quot;,&quot;STARS&quot;,&quot;OFFICIAL&quot;,&quot;DESCRIPTION&quot;],</span></span><br><span class=\"line\"><span class=\"string\">         (.results[] |</span></span><br><span class=\"line\"><span class=\"string\">         [.name,</span></span><br><span class=\"line\"><span class=\"string\">          (.star_count|tostring),</span></span><br><span class=\"line\"><span class=\"string\">          (if .is_official then &quot;[OK]&quot; else &quot;&quot; end),</span></span><br><span class=\"line\"><span class=\"string\">          .description])</span></span><br><span class=\"line\"><span class=\"string\">         | @tsv&#x27;</span> \\</span><br><span class=\"line\">| column -t -s $<span class=\"string\">&#x27;\\t&#x27;</span></span><br><span class=\"line\">EOF</span><br></pre></td></tr></table></figure>\n</div>\n<h2 id=\"docker-image-é•œåƒç®¡ç†\"><code>docker image</code> : é•œåƒç®¡ç†</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><code>docker image --help</code></p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>å‘½ä»¤</th>\n<th>è¯´æ˜</th>\n<th>åˆ«å(ç®€å†™)</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>build</td>\n<td>ä» Dockerfile æ„å»ºä¸€ä¸ªé•œåƒ</td>\n<td>docker build</td>\n</tr>\n<tr>\n<td>history</td>\n<td>æ˜¾ç¤ºé•œåƒçš„å†å²è®°å½•</td>\n<td>docker history</td>\n</tr>\n<tr>\n<td>import</td>\n<td>ä» tar åŒ…å¯¼å…¥å†…å®¹ä»¥åˆ›å»ºæ–‡ä»¶ç³»ç»Ÿé•œåƒ</td>\n<td>docker import</td>\n</tr>\n<tr>\n<td>inspect</td>\n<td>æ˜¾ç¤ºä¸€ä¸ªæˆ–å¤šä¸ªé•œåƒçš„è¯¦ç»†ä¿¡æ¯</td>\n<td>å¯ä»¥ä½¿ç”¨ <code>docker inspect</code></td>\n</tr>\n<tr>\n<td>load</td>\n<td>ä» tar å½’æ¡£æˆ–æ ‡å‡†è¾“å…¥ä¸­åŠ è½½é•œåƒ</td>\n<td>docker load</td>\n</tr>\n<tr>\n<td>ls</td>\n<td>åˆ—å‡ºé•œåƒ</td>\n<td>docker images</td>\n</tr>\n<tr>\n<td>prune</td>\n<td>ç§»é™¤æœªä½¿ç”¨çš„é•œåƒ</td>\n<td></td>\n</tr>\n<tr>\n<td>pull</td>\n<td>ä»é•œåƒä»“åº“ä¸‹è½½é•œåƒ</td>\n<td>docker pull</td>\n</tr>\n<tr>\n<td>push</td>\n<td>ä¸Šä¼ é•œåƒåˆ°é•œåƒä»“åº“</td>\n<td>docker push</td>\n</tr>\n<tr>\n<td>rm</td>\n<td>ç§»é™¤ä¸€ä¸ªæˆ–å¤šä¸ªé•œåƒ</td>\n<td>docker rmi</td>\n</tr>\n<tr>\n<td>save</td>\n<td>å°†ä¸€ä¸ªæˆ–å¤šä¸ªé•œåƒä¿å­˜ä¸º tar å½’æ¡£ï¼ˆé»˜è®¤è¾“å‡ºåˆ°æ ‡å‡†è¾“å‡ºï¼‰</td>\n<td>docker save</td>\n</tr>\n<tr>\n<td>tag</td>\n<td>åˆ›å»ºä¸€ä¸ªæ ‡ç­¾ TARGET_IMAGE æŒ‡å‘ SOURCE_IMAGE</td>\n<td>docker tag</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¿è¡Œ <code>docker image COMMAND --help</code> å¯è·å–æŸä¸ªå‘½ä»¤çš„æ›´å¤šä¿¡æ¯ã€‚</p>\n</li>\n</ul>\n<h3 id=\"docker-pull-æ‹‰å–é•œåƒ\"><code>docker pull</code> : æ‹‰å–é•œåƒ</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><code>docker image pull</code> == <code>docker pull</code></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å‘½ä»¤æ ¼å¼ï¼Œä¸åŠ tagé»˜è®¤æ‹‰å– :latest</span></span><br><span class=\"line\">$ docker pull &lt;image_name&gt;[:&lt;tag&gt;]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ‹‰å–nginxé•œåƒï¼Œé»˜è®¤æ‹‰å–æœ€æ–°ç‰ˆæœ¬ï¼šlatestï¼Œnginxæ˜¯å®˜æ–¹é•œåƒï¼Œå®Œæ•´åç§°å®é™…ä¸Šæ˜¯ library/nginx</span></span><br><span class=\"line\">$ docker pull nginx  ==  docker pull library/nginx  ==  docker pull nginx:latest</span><br><span class=\"line\"><span class=\"comment\"># æ‹‰å–æŒ‡å®štagçš„é•œåƒ</span></span><br><span class=\"line\">$ docker pull nginx:1.28.0</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ‹‰å–éå®˜æ–¹é•œåƒï¼Œç”¨æˆ·ä¸Šä¼ çš„</span></span><br><span class=\"line\">$ docker pull hanqunfeng/alpine-jre8-slim:1.0.0</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ‹‰å–æŒ‡å®šå¹³å°çš„é•œåƒï¼Œå¦‚æœä¸æŒ‡å®š --platform å‚æ•°ï¼Œé»˜è®¤ä¼šæ‹‰å–ä¸ä½ å½“å‰ Docker å®¢æˆ·ç«¯è¿è¡Œå¹³å°åŒ¹é…çš„é•œåƒï¼Œé€šè¿‡ docker version æŸ¥çœ‹</span></span><br><span class=\"line\">$ docker pull --platform=linux/amd64 nginx:latest</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åœ¨ <a href=\"/2025/05/20/docker-install/\" title=\"Linux å®‰è£… Docker\">Linux å®‰è£… Docker</a> ä¸­ä»‹ç»äº†å¦‚é…ç½®å›½å†…çš„é•œåƒåŠ é€Ÿæºæ¥åŠ å¿«é•œåƒçš„æ‹‰å–ï¼Œä½†æ˜¯å›½å†…é•œåƒæºä¸ç¨³å®šï¼Œéšæ—¶éƒ½æœ‰å¯èƒ½ä¸å¯ç”¨ï¼Œè€Œä¸”æ¯æ¬¡é‡æ–°é…ç½®é•œåƒæºè¿˜éœ€è¦é‡å¯Dockerï¼Œå¯ä»¥ç¼–å†™ä¸€ä¸ªè„šæœ¬æ¥å®Œæˆ<code>pull</code>ï¼Œè¿™æ ·æ¯æ¬¡æ›´æ–°é•œåƒæºæ—¶åªéœ€è¦ä¿®æ”¹è„šæœ¬ï¼Œè€Œä¸éœ€è¦é‡å¯Dockeräº†ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># è„šæœ¬åç§°ï¼šdocker_pull</span></span><br><span class=\"line\"><span class=\"comment\">#!/bin/bash</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ç”¨æ³•æ£€æŸ¥</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> [[ -z <span class=\"string\">&quot;<span class=\"variable\">$1</span>&quot;</span> ]]; <span class=\"keyword\">then</span></span><br><span class=\"line\">  <span class=\"built_in\">echo</span> <span class=\"string\">&quot;ç”¨æ³•: <span class=\"variable\">$0</span> &lt;é•œåƒå&gt;ï¼Œä¾‹å¦‚ï¼šdocker_pull redis&quot;</span></span><br><span class=\"line\">  <span class=\"built_in\">exit</span> 1</span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åŸå§‹é•œåƒåç§°ï¼Œä¾‹å¦‚ nginx æˆ– someuser/image</span></span><br><span class=\"line\">ORIGINAL_IMAGE_NAME=<span class=\"string\">&quot;<span class=\"variable\">$1</span>&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># é•œåƒæºåˆ—è¡¨ï¼Œä¿®æ”¹é•œåƒæºæ—¶åªéœ€è¦ä¿®æ”¹è¯¥åˆ—è¡¨å³å¯</span></span><br><span class=\"line\">MIRROR_LIST=(</span><br><span class=\"line\">  <span class=\"string\">&quot;docker.1ms.run&quot;</span></span><br><span class=\"line\">  <span class=\"string\">&quot;docker.xuanyuan.me&quot;</span></span><br><span class=\"line\">  <span class=\"string\">&quot;docker.m.daocloud.io&quot;</span></span><br><span class=\"line\">  <span class=\"string\">&quot;docker.1panel.live&quot;</span></span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å¦‚æœé•œåƒåä¸­ä¸åŒ…å« &quot;/&quot;ï¼ŒåŠ ä¸Š &quot;library/&quot;</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> [[ <span class=\"string\">&quot;<span class=\"variable\">$ORIGINAL_IMAGE_NAME</span>&quot;</span> != *<span class=\"string\">&quot;/&quot;</span>* ]]; <span class=\"keyword\">then</span></span><br><span class=\"line\">  IMAGE_NAME=<span class=\"string\">&quot;library/<span class=\"variable\">$ORIGINAL_IMAGE_NAME</span>&quot;</span></span><br><span class=\"line\"><span class=\"keyword\">else</span></span><br><span class=\"line\">  IMAGE_NAME=<span class=\"string\">&quot;<span class=\"variable\">$ORIGINAL_IMAGE_NAME</span>&quot;</span></span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># éå†é•œåƒæº</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> MIRROR <span class=\"keyword\">in</span> <span class=\"string\">&quot;<span class=\"variable\">$&#123;MIRROR_LIST[@]&#125;</span>&quot;</span>; <span class=\"keyword\">do</span></span><br><span class=\"line\">  FULL_IMAGE=<span class=\"string\">&quot;<span class=\"variable\">$MIRROR</span>/<span class=\"variable\">$IMAGE_NAME</span>&quot;</span></span><br><span class=\"line\">  <span class=\"built_in\">echo</span> <span class=\"string\">&quot;å°è¯•ä» <span class=\"variable\">$FULL_IMAGE</span> æ‹‰å–é•œåƒ...&quot;</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> docker pull <span class=\"string\">&quot;<span class=\"variable\">$FULL_IMAGE</span>&quot;</span>; <span class=\"keyword\">then</span></span><br><span class=\"line\">    <span class=\"built_in\">echo</span> <span class=\"string\">&quot;æˆåŠŸæ‹‰å–é•œåƒï¼š<span class=\"variable\">$FULL_IMAGE</span>&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># å°†é•œåƒé‡å‘½åä¸ºå»é™¤é•œåƒæºå‰ç¼€çš„ç‰ˆæœ¬</span></span><br><span class=\"line\">    docker tag <span class=\"string\">&quot;<span class=\"variable\">$FULL_IMAGE</span>&quot;</span> <span class=\"string\">&quot;<span class=\"variable\">$ORIGINAL_IMAGE_NAME</span>&quot;</span></span><br><span class=\"line\">    <span class=\"built_in\">echo</span> <span class=\"string\">&quot;é•œåƒé‡å‘½åä¸ºï¼š<span class=\"variable\">$ORIGINAL_IMAGE_NAME</span>&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># å¯é€‰ï¼šåˆ é™¤å¸¦é•œåƒæºå‰ç¼€çš„é•œåƒ</span></span><br><span class=\"line\">    docker rmi <span class=\"string\">&quot;<span class=\"variable\">$FULL_IMAGE</span>&quot;</span> &gt;/dev/null 2&gt;&amp;1</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">exit</span> 0</span><br><span class=\"line\">  <span class=\"keyword\">else</span></span><br><span class=\"line\">    <span class=\"built_in\">echo</span> <span class=\"string\">&quot;ä» <span class=\"variable\">$MIRROR</span> æ‹‰å–å¤±è´¥ï¼Œå°è¯•ä¸‹ä¸€ä¸ªé•œåƒæº...&quot;</span></span><br><span class=\"line\">  <span class=\"keyword\">fi</span></span><br><span class=\"line\"><span class=\"keyword\">done</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;æ‰€æœ‰é•œåƒæºå°è¯•å¤±è´¥ï¼Œæ— æ³•æ‹‰å–é•œåƒï¼š<span class=\"variable\">$ORIGINAL_IMAGE_NAME</span>&quot;</span></span><br><span class=\"line\"><span class=\"built_in\">exit</span> 1</span><br></pre></td></tr></table></figure>\n<div class=\"tips\">\n<p><em><strong>å¦‚ä½•è·å–é•œåƒtag</strong></em></p>\n<ul class=\"lvl-1\">\n<li class=\"lvl-2\">docker å‘½ä»¤ä¸­æ²¡æœ‰æä¾›ç›´æ¥è·å–é•œåƒtagçš„å‘½ä»¤ï¼Œå¦‚æœä¸æƒ³åˆ°<code>dockerhub</code>ä¸ŠæŸ¥çœ‹ï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹å¼è·å–(éœ€è¦ç§‘å­¦ä¸Šç½‘)ï¼š</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åªæ˜¾ç¤ºtagåç§°ï¼Œå®˜æ–¹é•œåƒæ›¿æ¢ nginxï¼Œéå®˜æ–¹é•œåƒæ›¿æ¢ libryary/nginxï¼Œpage_size=5è¡¨ç¤ºæ¯é¡µ5æ¡æ•°æ®ï¼Œpage=1è¡¨ç¤ºç¬¬ä¸€é¡µï¼ˆé»˜è®¤ä¸º1ï¼‰</span></span><br><span class=\"line\">curl -s <span class=\"string\">&quot;https://registry.hub.docker.com/v2/repositories/library/nginx/tags?page_size=5&amp;page=1&quot;</span> | jq <span class=\"string\">&#x27;.results[].name&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">## ä¹Ÿå¯ä»¥ä½¿ç”¨å¦‚ä¸‹urlï¼Œä¸¤è€…æ•ˆæœç›¸åŒ</span></span><br><span class=\"line\"><span class=\"comment\">## https://hub.docker.com/v2/namespaces/&#123;namespace&#125;/repositories/&#123;repository&#125;/tags?page_size=5&amp;page=1</span></span><br><span class=\"line\"><span class=\"comment\">## ç¤ºä¾‹ï¼šhttps://hub.docker.com/v2/namespaces/library/repositories/nginx/tags?page_size=1&amp;page=1</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># è¾“å‡ºjsonæ ¼å¼ï¼Œå¹¶æ˜¾ç¤ºæœ€åæ›´æ–°æ—¶é—´å’Œé•œåƒå¤§å°</span></span><br><span class=\"line\">curl -s <span class=\"string\">&quot;https://registry.hub.docker.com/v2/repositories/library/nginx/tags?page_size=5&amp;page=1&quot;</span> | jq <span class=\"string\">&#x27;.results[] | &#123;name,last_updated,full_size&#125;&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># è¾“å‡ºè¡¨æ ¼æ ¼å¼ï¼Œå¹¶æ ¼å¼åŒ–è¾“å‡º</span></span><br><span class=\"line\">curl -s <span class=\"string\">&quot;https://registry.hub.docker.com/v2/repositories/library/nginx/tags?page_size=5&amp;page=1&quot;</span> \\</span><br><span class=\"line\">| jq -r <span class=\"string\">&#x27;.results[] |</span></span><br><span class=\"line\"><span class=\"string\">  &quot;\\(.name)\\t\\t\\(.last_updated | sub(&quot;T&quot;; &quot; &quot;) | sub(&quot;\\\\..*&quot;; &quot;&quot;))\\t\\t\\(((.full_size / 1024 / 1024 * 100 | round)/100) | tostring) MB&quot;&#x27;</span> \\</span><br><span class=\"line\">  | awk <span class=\"string\">&#x27;&#123;printf &quot;%-30s %-20s %8.2f MB\\n&quot;, $1, $2&quot; &quot;$3, $4&#125;&#x27;</span></span><br></pre></td></tr></table></figure>\n</div>\n<h3 id=\"docker-images-åˆ—å‡ºé•œåƒ\"><code>docker images</code> : åˆ—å‡ºé•œåƒ</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><code>docker image ls</code> == <code>docker images</code></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åˆ—å‡ºæ‰€æœ‰é•œåƒï¼Œä¸åŒ…æ‹¬æ‚¬ç©ºé•œåƒï¼Œï¼ˆdangling images:æ²¡æœ‰ tag çš„é•œåƒ,é€šå¸¸æ˜¯æ„å»ºä¸­é—´äº§ç‰©,ä¾‹å¦‚ï¼š&lt;none&gt;:&lt;none&gt; å½¢å¼ã€‚ï¼‰</span></span><br><span class=\"line\">$ docker images</span><br><span class=\"line\"><span class=\"comment\"># åˆ—å‡ºæ‰€æœ‰é•œåƒï¼ŒåŒ…æ‹¬æ‚¬ç©ºé•œåƒ</span></span><br><span class=\"line\">$ docker images -a</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åˆ—å‡ºæ‰€æœ‰é•œåƒï¼Œå¹¶æ˜¾ç¤ºé•œåƒçš„æ‘˜è¦ä¿¡æ¯</span></span><br><span class=\"line\">$ docker images --digests</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åˆ—å‡ºæ‰€æœ‰é•œåƒï¼Œå¹¶è¾“å‡ºä¸ºjsonæ ¼å¼</span></span><br><span class=\"line\">$ docker images --format json</span><br><span class=\"line\"><span class=\"comment\"># åªæ˜¾ç¤ºé•œåƒåç§°å’Œæ ‡ç­¾</span></span><br><span class=\"line\">$ docker images --format <span class=\"string\">&quot;&#123;&#123;.Repository&#125;&#125;:&#123;&#123;.Tag&#125;&#125;&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åªæ˜¾ç¤ºé•œåƒID</span></span><br><span class=\"line\">$ docker images -q</span><br></pre></td></tr></table></figure>\n<h3 id=\"docker-inspect-æŸ¥çœ‹é•œåƒçš„è¯¦ç»†ä¿¡æ¯\"><code>docker inspect</code> : æŸ¥çœ‹é•œåƒçš„è¯¦ç»†ä¿¡æ¯</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><code>docker image inspect</code> == <code>docker inspect</code></p>\n</li>\n<li class=\"lvl-2\">\n<p>è¿™é‡Œè¦æ³¨æ„ï¼Œ<code>docker inspect</code>å¦‚æœåŸºäºåç§°æŸ¥æ‰¾ä¼šä¼˜å…ˆæŸ¥æ‰¾å®¹å™¨</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å‘½ä»¤æ ¼å¼</span></span><br><span class=\"line\">$ docker inspect [OPTIONS] NAME|ID [NAME|ID...]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ˜¾ç¤ºé•œåƒçš„è¯¦ç»†ä¿¡æ¯ï¼Œé•œåƒåç§°</span></span><br><span class=\"line\">$ docker inspect nginx</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ˜¾ç¤ºé•œåƒçš„è¯¦ç»†ä¿¡æ¯ï¼Œé•œåƒID</span></span><br><span class=\"line\">$ docker inspect 9f0c0d0a0f0f</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ˜¾ç¤ºé•œåƒçš„Labelsä¿¡æ¯ï¼Œè·å–jsonä¸­æŒ‡å®šçš„å­—æ®µ</span></span><br><span class=\"line\">$ docker image inspect --format=<span class=\"string\">&#x27;&#123;&#123;json .Config.Labels&#125;&#125;&#x27;</span> nginx</span><br></pre></td></tr></table></figure>\n<h3 id=\"docker-image-prune-åˆ é™¤æœªä½¿ç”¨çš„é•œåƒ\"><code>docker image prune</code> : åˆ é™¤æœªä½¿ç”¨çš„é•œåƒ</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åˆ é™¤æ‚¬ç©ºé•œåƒï¼Œï¼ˆdangling images:æ²¡æœ‰ tag çš„é•œåƒ,é€šå¸¸æ˜¯æ„å»ºä¸­é—´äº§ç‰©,ä¾‹å¦‚ï¼š&lt;none&gt;:&lt;none&gt; å½¢å¼ã€‚ï¼‰</span></span><br><span class=\"line\">$ docker image prune</span><br><span class=\"line\"><span class=\"comment\"># åˆ é™¤å…¨éƒ¨æœªä½¿ç”¨é•œåƒ(æœªè¢«ä»»ä½•ä¸€ä¸ªå®¹å™¨å¼•ç”¨)ï¼ŒåŒ…æ‹¬æ‚¬ç©ºé•œåƒ</span></span><br><span class=\"line\">$ docker image prune -a</span><br><span class=\"line\"><span class=\"comment\"># ä¸è¿›è¡Œç¡®è®¤æç¤ºï¼Œç›´æ¥æ‰§è¡Œ</span></span><br><span class=\"line\">$ docker image prune -f</span><br></pre></td></tr></table></figure>\n<h3 id=\"docker-rmi-åˆ é™¤é•œåƒ\"><code>docker rmi</code> : åˆ é™¤é•œåƒ</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><code>docker image rm</code> == <code>docker rmi</code></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å‘½ä»¤æ ¼å¼</span></span><br><span class=\"line\">$ docker rmi [OPTIONS] IMAGE [IMAGE...]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åˆ é™¤é•œåƒï¼Œé•œåƒåç§°</span></span><br><span class=\"line\">$ docker rmi nginx</span><br><span class=\"line\"><span class=\"comment\"># åˆ é™¤å¤šä¸ªé•œåƒï¼Œç©ºæ ¼åˆ†éš”</span></span><br><span class=\"line\">$ docker rmi nginx mysql</span><br><span class=\"line\"><span class=\"comment\"># åˆ é™¤é•œåƒï¼Œé•œåƒID</span></span><br><span class=\"line\">$ docker rmi 9f0c0d0a0f0f</span><br><span class=\"line\"><span class=\"comment\"># å¼ºåˆ¶åˆ é™¤é•œåƒï¼Œå½“é•œåƒè¢«å®¹å™¨å¼•ç”¨æ—¶ï¼Œä¼šæŠ¥é”™ï¼Œéœ€è¦ä½¿ç”¨-få‚æ•°è¿›è¡Œå¼ºåˆ¶åˆ é™¤</span></span><br><span class=\"line\">$ docker rmi -f nginx</span><br><span class=\"line\"><span class=\"comment\"># åˆ é™¤å…¨éƒ¨é•œåƒ</span></span><br><span class=\"line\">$ docker rmi $(docker images -q)</span><br></pre></td></tr></table></figure>\n<h3 id=\"docker-history-æŸ¥çœ‹é•œåƒçš„æ„å»ºå†å²\"><code>docker history</code> : æŸ¥çœ‹é•œåƒçš„æ„å»ºå†å²</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><code>docker image history</code> == <code>docker history</code></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å‘½ä»¤æ ¼å¼</span></span><br><span class=\"line\">$ docker <span class=\"built_in\">history</span> [OPTIONS] IMAGE</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹é•œåƒçš„å†å²è®°å½•ï¼Œé•œåƒåç§°</span></span><br><span class=\"line\">$ docker <span class=\"built_in\">history</span> nginx</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹é•œåƒçš„å†å²è®°å½•ï¼Œé•œåƒID</span></span><br><span class=\"line\">$ docker <span class=\"built_in\">history</span> 9f0c0d0a0f0f</span><br><span class=\"line\"><span class=\"comment\"># æ˜¾ç¤ºå®Œæ•´çš„é•œåƒå†å²è®°å½•ï¼Œé»˜è®¤`CREATED BY`ä¸­çš„ä¿¡æ¯å¤ªé•¿ä¼šè¢«æˆªæ–­</span></span><br><span class=\"line\">$ docker <span class=\"built_in\">history</span> --no-trunc nginx</span><br><span class=\"line\"><span class=\"comment\"># æ˜¾ç¤ºä¸ºjsonæ ¼å¼</span></span><br><span class=\"line\">$ docker <span class=\"built_in\">history</span> --format=json nginx</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><code>docker history</code> æ˜¾ç¤ºçš„æ˜¯æ„å»ºå†å²ï¼Œä¼šå°†æ¯ä¸€ä¸ª Dockerfile æŒ‡ä»¤éƒ½ç®—ä¸€å±‚ï¼Œè€Œä¸æ˜¯ç‰©ç†é•œåƒå±‚ï¼ˆlayerï¼‰æ•°é‡ï¼Œè‹¥è¦æŸ¥çœ‹é•œåƒçš„ç‰©ç†å±‚æ•°ï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ docker image inspect --format <span class=\"string\">&#x27;&#123;&#123; len .RootFS.Layers &#125;&#125;&#x27;</span> nginx</span><br></pre></td></tr></table></figure>\n<h3 id=\"docker-tag-åˆ›å»ºä¸€ä¸ªæ ‡ç­¾\"><code>docker tag</code> : åˆ›å»ºä¸€ä¸ªæ ‡ç­¾</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><code>docker image tag</code> == <code>docker tag</code></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å‘½ä»¤æ ¼å¼</span></span><br><span class=\"line\">$ docker tag SOURCE_IMAGE[:TAG] TARGET_IMAGE[:TAG]</span><br><span class=\"line\"><span class=\"comment\"># åˆ›å»ºä¸€ä¸ªæ ‡ç­¾</span></span><br><span class=\"line\">$ docker tag nginx:latest hanqunfeng/nginx:latest</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹é•œåƒï¼Œå¯ä»¥çœ‹åˆ°ä¸¤ä¸ªé•œåƒçš„ IMAGE ID ä¸€è‡´</span></span><br><span class=\"line\">$ docker images</span><br><span class=\"line\">REPOSITORY         TAG       IMAGE ID       CREATED       SIZE</span><br><span class=\"line\">hanqunfeng/nginx   latest    be69f2940aaf   5 weeks ago   192MB</span><br><span class=\"line\">nginx              latest    be69f2940aaf   5 weeks ago   192MB</span><br><span class=\"line\"><span class=\"comment\"># æ­¤æ—¶è‹¥é€šè¿‡ IMAGE ID åˆ é™¤é•œåƒï¼Œä¼šæŠ¥é”™ï¼Œæç¤ºè¢«å¤šä¸ª REPOSITORY å…³è”ï¼Œéœ€è¦ä½¿ç”¨ -f å‚æ•°è¿›è¡Œå¼ºåˆ¶åˆ é™¤</span></span><br><span class=\"line\">$ docker rmi be69f2940aaf</span><br><span class=\"line\">Error response from daemon: conflict: unable to delete be69f2940aaf (must be forced) - image is referenced <span class=\"keyword\">in</span> multiple repositories</span><br></pre></td></tr></table></figure>\n<h3 id=\"docker-save-å°†é•œåƒä¿å­˜ä¸º-tar-å½’æ¡£\"><code>docker save</code> : å°†é•œåƒä¿å­˜ä¸º tar å½’æ¡£</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><code>docker image save</code> == <code>docker save</code></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å‘½ä»¤æ ¼å¼</span></span><br><span class=\"line\">$ docker save [OPTIONS] IMAGE [IMAGE...]</span><br><span class=\"line\"><span class=\"comment\"># å°†é•œåƒä¿å­˜ä¸º tar å½’æ¡£ï¼Œ-o  æŒ‡å®šè¾“å‡ºæ–‡ä»¶ï¼Œæ–‡ä»¶åç§°ä»»æ„ï¼Œç”šè‡³éƒ½ä¸éœ€è¦ä»¥ .tar ç»“å°¾</span></span><br><span class=\"line\">$ docker save -o nginx.tar nginx</span><br><span class=\"line\"><span class=\"comment\"># æˆ–è€…</span></span><br><span class=\"line\">$ docker save nginx &gt; nginx.tar</span><br></pre></td></tr></table></figure>\n<h3 id=\"docker-load-ä»-tar-å½’æ¡£ä¸­åŠ è½½é•œåƒ\"><code>docker load</code> : ä» tar å½’æ¡£ä¸­åŠ è½½é•œåƒ</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><code>docker image load</code> == <code>docker load</code></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å‘½ä»¤æ ¼å¼</span></span><br><span class=\"line\">$ docker load [OPTIONS]</span><br><span class=\"line\"><span class=\"comment\"># ä» tar å½’æ¡£ä¸­åŠ è½½é•œåƒï¼Œå¯¼å‡ºtarå½’æ¡£æ—¶çš„é•œåƒåç§°å°±æ˜¯åŠ è½½åçš„é•œåƒåç§°</span></span><br><span class=\"line\">$ docker load -i nginx.tar</span><br><span class=\"line\"><span class=\"comment\"># -q å‚æ•°è¡¨ç¤ºä¸æ˜¾ç¤ºè¿›åº¦æ¡</span></span><br><span class=\"line\">$ docker load -q -i nginx.tar</span><br></pre></td></tr></table></figure>\n<h3 id=\"docker-import-ä»æ–‡ä»¶åˆ›å»ºé•œåƒ\"><code>docker import</code> : ä»æ–‡ä»¶åˆ›å»ºé•œåƒ</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><code>docker image import</code> == <code>docker import</code></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å‘½ä»¤æ ¼å¼</span></span><br><span class=\"line\">$ docker import [OPTIONS] FILE|URL|- [REPOSITORY[:TAG]]</span><br><span class=\"line\"><span class=\"comment\">## å‚æ•°è¯´æ˜</span></span><br><span class=\"line\">file\tæœ¬åœ° tar æ–‡ä»¶ï¼Œä¾‹å¦‚ rootfs.tar</span><br><span class=\"line\">URL\t    ç½‘ç»œåœ°å€ï¼ˆhttp/httpsï¼‰</span><br><span class=\"line\">-\t    ä»æ ‡å‡†è¾“å…¥è¯»å–ï¼ˆæ¯”å¦‚é€šè¿‡ç®¡é“ï¼‰</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># è¾“å‡ºé•œåƒåç§°ä¸æ ‡ç­¾</span></span><br><span class=\"line\">REPOSITORY[:TAG]\tå¯¼å…¥åé•œåƒçš„åç§°ä¸æ ‡ç­¾</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># OPTIONS</span></span><br><span class=\"line\">--change\tåœ¨å¯¼å…¥é•œåƒæ—¶è®¾ç½® Dockerfile æŒ‡ä»¤ï¼Œå¦‚ CMDã€ENVã€EXPOSE ç­‰</span><br><span class=\"line\">--message, -m\tæ·»åŠ å¯¼å…¥è¯´æ˜ï¼ˆcommit messageï¼‰</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><code>docker import</code> ä¸  <code>docker load</code> çš„åŒºåˆ«</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>å‘½ä»¤</th>\n<th>ç”¨é€”</th>\n<th>æ ¼å¼</th>\n<th>æ˜¯å¦ä¿ç•™å†å²</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>docker import</code></td>\n<td>å¯¼å…¥æ–‡ä»¶ç³»ç»Ÿï¼Œåˆ›å»ºé•œåƒ(ç”± <code>docker export</code> ç”Ÿæˆ)</td>\n<td>çº¯æ–‡ä»¶ç³»ç»Ÿ tar åŒ…</td>\n<td>âŒ ä¸ä¿ç•™å†å²ã€æ ‡ç­¾ç­‰å…ƒæ•°æ®</td>\n</tr>\n<tr>\n<td><code>docker load</code></td>\n<td>åŠ è½½é•œåƒï¼ˆé€šå¸¸ç”± <code>docker save</code> ç”Ÿæˆï¼‰</td>\n<td>Docker é•œåƒ tarï¼ˆå«å…ƒæ•°æ®ï¼‰</td>\n<td>âœ… ä¿ç•™ tagã€å±‚ã€å†å²ç­‰</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç¤ºä¾‹: ä»å®¹å™¨å¯¼å‡ºå†å¯¼å…¥</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å¯åŠ¨ä¸€ä¸ªå®¹å™¨</span></span><br><span class=\"line\">$ docker run -d -p 8080:80 --name nginx nginx</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å¯¼å‡ºå®¹å™¨æ–‡ä»¶ç³»ç»Ÿï¼Œæ­¤æ—¶ nginx å®¹å™¨ä¸­çš„æ‰€æœ‰æ–‡ä»¶éƒ½ä¿å­˜åœ¨ my_nginx.tar æ–‡ä»¶ä¸­</span></span><br><span class=\"line\">$ docker <span class=\"built_in\">export</span> -o my_nginx.tar nginx</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å¯¼å…¥æ–‡ä»¶ç³»ç»Ÿï¼Œå¯¼å…¥æ—¶æŒ‡å®š å¯åŠ¨å‘½ä»¤ï¼Œå› ä¸º my_nginx.tar åªæ˜¯æ–‡ä»¶ï¼Œå¹¶ä¸åŒ…å«ä»»ä½•å¯åŠ¨å‘½ä»¤</span></span><br><span class=\"line\">$ docker import --change=<span class=\"string\">&#x27;CMD [&quot;nginx&quot;, &quot;-g&quot;, &quot;daemon off;&quot;]&#x27;</span> my_nginx.tar nginx:my_tag</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹é•œåƒï¼Œé•œåƒIDä¸ä¸€è‡´</span></span><br><span class=\"line\">$ docker images</span><br><span class=\"line\">REPOSITORY         TAG       IMAGE ID       CREATED         SIZE</span><br><span class=\"line\">nginx              my_tag    4ab42de31bac   4 seconds ago   191MB</span><br><span class=\"line\">nginx              latest    be69f2940aaf   5 weeks ago     192MB</span><br></pre></td></tr></table></figure>\n<h3 id=\"docker-build-ä»æŒ‡å®šç›®å½•æˆ–URLä¸­çš„-Dockerfile-æ„å»º-Docker-é•œåƒ\"><code>docker build</code> : ä»æŒ‡å®šç›®å½•æˆ–URLä¸­çš„ Dockerfile æ„å»º Docker é•œåƒ</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><code>docker image build</code> == <code>docker build</code></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å‘½ä»¤æ ¼å¼</span></span><br><span class=\"line\">docker build [OPTIONS] PATH | URL | -</span><br><span class=\"line\"><span class=\"comment\"># å‚æ•°è¯´æ˜</span></span><br><span class=\"line\">PATH\t  Dockerfile æ‰€åœ¨çš„ç›®å½•</span><br><span class=\"line\">URL\t      Git ä»“åº“çš„ URL</span><br><span class=\"line\">-\t      ä»æ ‡å‡†è¾“å…¥è¯»å– Dockerfile</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ„å»ºé•œåƒï¼Œ-t: æŒ‡å®šé•œåƒåç§°ï¼Œ.: è¡¨ç¤ºä»å½“å‰ç›®å½•æŸ¥æ‰¾Dockerfileï¼Œé»˜è®¤æ–‡ä»¶åç§°ä¸º Dockerfile</span></span><br><span class=\"line\">docker build -t myimage:latest .</span><br><span class=\"line\"><span class=\"comment\"># æ„å»ºé•œåƒï¼Œ-f: æŒ‡å®š Dockerfile çš„ç›¸å¯¹è·¯å¾„ï¼Œ.: è¡¨ç¤ºåŸºäºå½“å‰ç›®å½•ï¼Œå®é™…çš„ Dockerfile è·¯å¾„å°±æ˜¯ ./path/MyDockerfile</span></span><br><span class=\"line\">docker build -t myimage:latest -f path/MyDockerfile .</span><br><span class=\"line\"><span class=\"comment\"># å®é™…çš„ Dockerfile è·¯å¾„å°±æ˜¯ /usr/local/path/MyDockerfile</span></span><br><span class=\"line\">docker build -t myimage:latest -f path/MyDockerfile /usr/local</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ„å»ºé•œåƒï¼Œä» Git ä»“åº“ä¸­æ„å»ºï¼Œgit ä»“åº“çš„ Dockerfile å¿…é¡»åœ¨æ ¹ç›®å½•ä¸‹</span></span><br><span class=\"line\">docker build https://github.com/hanqunfeng/docker_test.git -t abc:1.0.0</span><br><span class=\"line\"><span class=\"comment\"># æ„å»ºé•œåƒï¼Œä» Git ä»“åº“ä¸­æ„å»ºï¼ŒæŒ‡å®š Dockerfile çš„ç›¸å¯¹è·¯å¾„</span></span><br><span class=\"line\">docker build -f docker/Dockerfile https://github.com/hanqunfeng/docker_test.git -t abc:1.0.1</span><br><span class=\"line\"><span class=\"comment\"># æ„å»ºé•œåƒï¼Œä» Git ä»“åº“ä¸­æ„å»ºï¼ŒæŒ‡å®šåˆ†æ”¯æˆ– tag</span></span><br><span class=\"line\">docker build -f docker/Dockerfile https://github.com/hanqunfeng/docker_test.git#release -t abc:1.0.2</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ„å»ºé•œåƒï¼Œ--no-cache è¡¨ç¤ºä¸ä½¿ç”¨ç¼“å­˜ï¼Œæ¯æ¬¡æ„å»ºéƒ½ä¼šé‡æ–°æ„å»ºï¼Œä½†ä¼šéå¸¸æ…¢ï¼Œä¸€èˆ¬æ²¡æœ‰å¯¼è‡´æŸä¸€ä¸ªå±‚å‘ç”Ÿå˜åŒ–æ—¶ä¸éœ€è¦åŠ ä¸Šè¿™ä¸ªå‚æ•°</span></span><br><span class=\"line\">docker build --no-cache -t app:latest .</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><code>docker build</code>ä¸­è¿˜æœ‰ä¸€äº›é‡è¦çš„å‚æ•°ï¼Œä»¥åŠ<code>Dockerfile</code>æ–‡ä»¶è¯¥æ€ä¹ˆç¼–å†™ï¼Œè¯·å‚è€ƒ<a href=\"/2025/05/26/docker-dockerfile/\" title=\"Docker å‘½ä»¤ ä¹‹ Dockerfile\">Docker å‘½ä»¤ ä¹‹ Dockerfile</a></p>\n</li>\n</ul>\n<h3 id=\"docker-push-æ¨é€æœ¬åœ°é•œåƒåˆ°è¿œç¨‹ä»“åº“\"><code>docker push</code> : æ¨é€æœ¬åœ°é•œåƒåˆ°è¿œç¨‹ä»“åº“</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><code>docker image push</code> == <code>docker push</code></p>\n</li>\n<li class=\"lvl-2\">\n<p>è¿™é‡Œä»‹ç»å¦‚ä½•å°†é•œåƒæ¨é€åˆ°<code>docker hub</code>è¿œç¨‹ä»“åº“</p>\n</li>\n<li class=\"lvl-2\">\n<p>éœ€è¦å…ˆåœ¨<a href=\"https://hub.docker.com/\">docker hub</a>ç½‘ç«™ä¸Šåˆ›å»ºä¸€ä¸ªè´¦å·ï¼Œæ¯”å¦‚æˆ‘çš„ç”¨æˆ·åæ˜¯<code>hanqunfeng</code></p>\n</li>\n<li class=\"lvl-2\">\n<p>ç„¶åå°±å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤å°†æœ¬åœ°é•œåƒæ¨é€åˆ°è¿œç¨‹ä»“åº“äº†</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹æœ¬åœ°é•œåƒ</span></span><br><span class=\"line\">$ docker images</span><br><span class=\"line\">REPOSITORY         TAG       IMAGE ID       CREATED        SIZE</span><br><span class=\"line\">nginx              latest    e573c6323878   18 hours ago   191MB</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å¯¹nginxé•œåƒæ‰“tag,å‰ç¼€å¿…é¡»ä¸ç”¨æˆ·åä¸€è‡´</span></span><br><span class=\"line\">$ docker tag nginx hanqunfeng/nginx:1.0.0</span><br><span class=\"line\">$ docker images</span><br><span class=\"line\">REPOSITORY         TAG       IMAGE ID       CREATED        SIZE</span><br><span class=\"line\">hanqunfeng/nginx   1.0.0     be69f2940aaf   5 weeks ago    192MB</span><br><span class=\"line\">nginx              latest    be69f2940aaf   5 weeks ago    192MB</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ç™»å½• loghup</span></span><br><span class=\"line\">$ docker login -u hanqunfeng</span><br><span class=\"line\"></span><br><span class=\"line\">i Info â†’ A Personal Access Token (PAT) can be used instead.</span><br><span class=\"line\">          To create a PAT, visit https://app.docker.com/settings</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">Password: <span class=\"comment\"># è¾“å…¥å¯†ç </span></span><br><span class=\"line\">Login Succeeded</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ç™»å½•åŒæ—¶è¾“å…¥å¯†ç </span></span><br><span class=\"line\"><span class=\"comment\"># docker login -u hanqunfeng -p 12345678</span></span><br><span class=\"line\"><span class=\"comment\"># ç™»å½•å…¶å®ƒä»“åº“</span></span><br><span class=\"line\"><span class=\"comment\"># docker login -u username -p password registry.orther.com</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ¨é€åˆ°docker hubï¼Œæ­¤åå°±å¯ä»¥é€šè¿‡ docker pull hanqunfeng/nginx:1.0.0 è·å–äº†</span></span><br><span class=\"line\">$ docker push hanqunfeng/nginx:1.0.0</span><br></pre></td></tr></table></figure>\n","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» Docker å‘½ä»¤ ä¸­ é•œåƒç®¡ç† ç›¸å…³å‘½ä»¤ Dockerå®˜æ–¹æ–‡æ¡£ Application programming interfaces (APIs) docker search : æœç´¢é•œåƒ æ¨èåœ¨dockerhubä¸Šæœç´¢é•œåƒï¼Œä»¥è·å–æ›´è¯¦ç»†çš„é•œåƒä¿¡æ¯ã€‚ å›½å†…ä¹Ÿå¯ä»¥é€šè¿‡æ¯«ç§’é•œåƒ,è½©è¾• Docker é•œåƒæœç´¢æ¥æœç´¢é•œåƒã€‚ 12345678910$ docker search --helpç”¨æ³•: docker search [OPTIONS] TERMåœ¨ Docker Hub ä¸­æœç´¢é•œåƒé€‰é¡¹: -f, --filter filter æ ¹æ®æä¾›çš„æ¡ä»¶è¿‡æ»¤è¾“å‡ºï¼Œå¸¸è§çš„è¿‡æ»¤æ¡ä»¶åŒ…æ‹¬ï¼šstarsï¼ˆæ˜Ÿçº§ï¼‰ã€is-officialï¼ˆæ˜¯å¦ä¸ºå®˜æ–¹é•œåƒï¼‰ --format string ä½¿ç”¨ Go æ¨¡æ¿ç¾åŒ–è¾“å‡ºï¼Œä¸å¤ªå¸¸ç”¨ --limit int æœç´¢ç»“æœçš„æœ€å¤§æ•°é‡ --no-trunc ä¸æˆªæ–­è¾“å‡ºå†…å®¹ï¼Œæ˜¾ç¤ºå®Œæ•´ä¿¡æ¯ï¼ˆé»˜è®¤è¾“å‡ºä¸­æŸäº›å­—æ®µå¦‚æè¿°å¯èƒ½è¢«æˆªæ–­ï¼‰ ç¤ºä¾‹ 12345678910111213141516# æœç´¢åç§°ä¸­åŒ…å« nginx çš„é•œåƒ$ docker search nginx# æœç´¢åç§°ä¸­åŒ…å« nginx ä¸”æ˜Ÿçº§ä¸å°‘äº 100 çš„é•œåƒã€‚$ docker search -f stars=100 nginx# æœç´¢å®˜æ–¹é•œåƒ$ docker search -f is-official=true nginx# æœç´¢ nginxï¼ŒæŒ‰ç…§æŒ‡å®šæ¨¡æ¿æ ¼å¼åŒ–è¾“å‡º$ docker search nginx --format &quot;&#123;&#123;.Name&#125;&#125;: &#123;&#123;.StarCount&#125;&#125; stars: &#123;&#123;.Description&#125;&#125;&quot;# æœç´¢nginxé•œåƒï¼Œå¹¶é™åˆ¶5ä¸ªç»“æœ$ docker search nginx --limit 5# ç»„åˆä½¿ç”¨å¤šä¸ªé€‰é¡¹$ docker search -f stars=100 --limit 5 --no-trunc nginx docker search å‘½ä»¤æŠ¥é”™çš„è§£å†³æ–¹æ³• ç›®å‰å›½å†…ä½¿ç”¨docker searchæ—¶ä¼šå‡ºç°Error response from daemon: Get &quot;https://index.docker.io/v1/search?q=nginx&amp;n=25&quot;: dial tcp 210.56.51.193:443: i/o timeoutçš„é”™è¯¯ï¼Œå³ä¾¿æˆ‘ä»¬é…ç½®äº†å›½å†…çš„é•œåƒæºï¼Œè¿™ä¸ªé”™è¯¯è¿˜æ˜¯ä¼šå­˜åœ¨ã€‚ å³ä¾¿ä¸ºå®¿ä¸»æœºå’Œdockeréƒ½é…ç½®ä¸ŠDNSä¹Ÿä¾ç„¶ä¼šæŠ¥é”™ã€‚ ä¸è¿‡å¯ä»¥é€šè¿‡ç¬¬ä¸‰æ–¹é•œåƒä»“åº“è¿›è¡ŒæŸ¥è¯¢ï¼Œæ¯”å¦‚åœ¨æŸ¥è¯¢çš„é•œåƒåç§°å‰åŠ ä¸Š docker.1ms.run/ï¼Œæ¯”å¦‚æŸ¥è¯¢nginxé•œåƒï¼Œåˆ™è¾“å…¥docker search docker.1ms.run/nginxï¼Œè¿™é‡Œè¦æ³¨æ„å¹¶ä¸æ˜¯æ‰€æœ‰çš„ç¬¬ä¸‰æ–¹é•œåƒä»“åº“éƒ½æ”¯æŒæŸ¥è¯¢ã€‚ å¯ä»¥ç¼–å†™ä¸€ä¸ªè„šæœ¬docker_searchï¼ŒæŸ¥è¯¢é•œåƒå¹¶è¾“å‡ºç»“æœï¼Œå¦‚ä¸‹ï¼š 1234567891011121314151617181920212223cat &lt;&lt; &#x27;EOF&#x27; &gt; docker_search#!/bin/bashQUERY=$&#123;1&#125; # æŸ¥è¯¢å…³é”®è¯ï¼Œè¿™é‡Œè¦æ³¨æ„ï¼Œç¬¬ä¸€ä¸ªå‚æ•°å¿…é¡»æ˜¯æŸ¥è¯¢å…³é”®è¯# è·å–é™¤ç¬¬ä¸€ä¸ªå‚æ•°å¤–çš„æ‰€æœ‰å‚æ•°ARGS=$&#123;@:2&#125;echo &quot;æŸ¥è¯¢é•œåƒï¼šdocker search docker.1ms.run/$QUERY $ARGS&quot;docker search docker.1ms.run/$QUERY $ARGSEOF# è®¾ç½®æ‰§è¡Œæƒé™chmod +x docker_search# å°†å…¶ç§»åŠ¨åˆ° /usr/local/bin/mv docker_search /usr/local/bin/docker_search# å¦‚æœ/usr/local/bin/æ²¡æœ‰åœ¨PATHä¸­ï¼Œè¯·æ·»åŠ åˆ°ç¯å¢ƒå˜é‡echo &quot;export PATH=$PATH:/usr/local/sbin&quot; &gt;&gt; ~/.bashrcsource ~/.bashrc# æµ‹è¯•docker_search redis -f stars=100 --limit 5 --no-trunc## è¾“å‡ºNAME DESCRIPTION STARS OFFICIALredis Redis is the worldâ€™s fastest data platform for caching, vector search, and NoSQL databases. 13315 [OK]redis/redis-stack redis-stack installs a Redis server with additional database capabilities and the RedisInsight. 149bitnami/redis Bitnami container image for Redis åŸºäºurlæœç´¢ï¼Œæ”¯æŒåˆ†é¡µï¼Œä½†ä¸èƒ½æ”¯æŒå…¶å®ƒsearchå‚æ•° 1234567891011121314151617181920212223242526272829303132333435363738394041424344cat &lt;&lt; &#x27;EOF&#x27; &gt; docker_search_by_url#!/bin/bash# å‚æ•°å¤„ç†QUERY=$&#123;1:-nginx&#125; # é»˜è®¤æŸ¥è¯¢å…³é”®è¯N=$&#123;2:-25&#125; # é»˜è®¤æ¯é¡µæ¡æ•°PAGE=$&#123;3:-1&#125; # é»˜è®¤é¡µç # é•œåƒæºåˆ—è¡¨ï¼šä¾æ¬¡å°è¯•è®¿é—®è¿™äº›åŸŸåï¼Œè¿™é‡Œè¦æ³¨æ„ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„é•œåƒæºéƒ½æ”¯æŒæœç´¢åŠŸèƒ½REGISTRIES=( &quot;docker.1ms.run&quot; &quot;register.librax.org&quot; # ä½ å¯ä»¥ç»§ç»­æ·»åŠ å¤‡ç”¨åŸŸå)# åˆå§‹åŒ–æˆåŠŸæ ‡å¿—WORKING_URL=&quot;&quot;# éå†åŸŸåï¼Œæ‰¾åˆ°ç¬¬ä¸€ä¸ªå¯è®¿é—®çš„for REG in &quot;$&#123;REGISTRIES[@]&#125;&quot;; do TEST_URL=&quot;https://$&#123;REG&#125;/v1/search?q=test&amp;n=1&quot; if curl -s --connect-timeout 2 &quot;$TEST_URL&quot; | grep -q &#x27;&quot;results&quot;&#x27;; then WORKING_URL=&quot;https://$&#123;REG&#125;/v1/search?q=$&#123;QUERY&#125;&amp;n=$&#123;N&#125;&amp;page=$&#123;PAGE&#125;&quot; break fidone# å¦‚æœéƒ½å¤±è´¥ï¼Œé€€å‡ºif [ -z &quot;$WORKING_URL&quot; ]; then echo &quot;âŒ æ— æ³•è¿æ¥ä»»ä½•é•œåƒæºï¼Œè¯·æ£€æŸ¥ç½‘ç»œæˆ–å¤‡ç”¨åŸŸåè®¾ç½®ã€‚&quot; exit 1fi# è¯·æ±‚æ•°æ®å¹¶æ ¼å¼åŒ–è¾“å‡ºcurl -s &quot;$WORKING_URL&quot; \\| jq -r &#x27;[&quot;NAME&quot;,&quot;STARS&quot;,&quot;OFFICIAL&quot;,&quot;DESCRIPTION&quot;], (.results[] | [.name, (.star_count|tostring), (if .is_official then &quot;[OK]&quot; else &quot;&quot; end), .description]) | @tsv&#x27; \\| column -t -s $&#x27;\\t&#x27;EOF docker image : é•œåƒç®¡ç† docker image --help å‘½ä»¤ è¯´æ˜ åˆ«å(ç®€å†™) build ä» Dockerfile æ„å»ºä¸€ä¸ªé•œåƒ docker build history æ˜¾ç¤ºé•œåƒçš„å†å²è®°å½• docker history import ä» tar åŒ…å¯¼å…¥å†…å®¹ä»¥åˆ›å»ºæ–‡ä»¶ç³»ç»Ÿé•œåƒ docker import inspect æ˜¾ç¤ºä¸€ä¸ªæˆ–å¤šä¸ªé•œåƒçš„è¯¦ç»†ä¿¡æ¯ å¯ä»¥ä½¿ç”¨ docker inspect load ä» tar å½’æ¡£æˆ–æ ‡å‡†è¾“å…¥ä¸­åŠ è½½é•œåƒ docker load ls åˆ—å‡ºé•œåƒ docker images prune ç§»é™¤æœªä½¿ç”¨çš„é•œåƒ pull ä»é•œåƒä»“åº“ä¸‹è½½é•œåƒ docker pull push ä¸Šä¼ é•œåƒåˆ°é•œåƒä»“åº“ docker push rm ç§»é™¤ä¸€ä¸ªæˆ–å¤šä¸ªé•œåƒ docker rmi save å°†ä¸€ä¸ªæˆ–å¤šä¸ªé•œåƒä¿å­˜ä¸º tar å½’æ¡£ï¼ˆé»˜è®¤è¾“å‡ºåˆ°æ ‡å‡†è¾“å‡ºï¼‰ docker save tag åˆ›å»ºä¸€ä¸ªæ ‡ç­¾ TARGET_IMAGE æŒ‡å‘ SOURCE_IMAGE docker tag è¿è¡Œ docker image COMMAND --help å¯è·å–æŸä¸ªå‘½ä»¤çš„æ›´å¤šä¿¡æ¯ã€‚ docker pull : æ‹‰å–é•œåƒ docker image pull == docker pull 12345678910111213# å‘½ä»¤æ ¼å¼ï¼Œä¸åŠ tagé»˜è®¤æ‹‰å– :latest$ docker pull &lt;image_name&gt;[:&lt;tag&gt;]# æ‹‰å–nginxé•œåƒï¼Œé»˜è®¤æ‹‰å–æœ€æ–°ç‰ˆæœ¬ï¼šlatestï¼Œnginxæ˜¯å®˜æ–¹é•œåƒï¼Œå®Œæ•´åç§°å®é™…ä¸Šæ˜¯ library/nginx$ docker pull nginx == docker pull library/nginx == docker pull nginx:latest# æ‹‰å–æŒ‡å®štagçš„é•œåƒ$ docker pull nginx:1.28.0# æ‹‰å–éå®˜æ–¹é•œåƒï¼Œç”¨æˆ·ä¸Šä¼ çš„$ docker pull hanqunfeng/alpine-jre8-slim:1.0.0# æ‹‰å–æŒ‡å®šå¹³å°çš„é•œåƒï¼Œå¦‚æœä¸æŒ‡å®š --platform å‚æ•°ï¼Œé»˜è®¤ä¼šæ‹‰å–ä¸ä½ å½“å‰ Docker å®¢æˆ·ç«¯è¿è¡Œå¹³å°åŒ¹é…çš„é•œåƒï¼Œé€šè¿‡ docker version æŸ¥çœ‹$ docker pull --platform=linux/amd64 nginx:latest åœ¨ Linux å®‰è£… Docker ä¸­ä»‹ç»äº†å¦‚é…ç½®å›½å†…çš„é•œåƒåŠ é€Ÿæºæ¥åŠ å¿«é•œåƒçš„æ‹‰å–ï¼Œä½†æ˜¯å›½å†…é•œåƒæºä¸ç¨³å®šï¼Œéšæ—¶éƒ½æœ‰å¯èƒ½ä¸å¯ç”¨ï¼Œè€Œä¸”æ¯æ¬¡é‡æ–°é…ç½®é•œåƒæºè¿˜éœ€è¦é‡å¯Dockerï¼Œå¯ä»¥ç¼–å†™ä¸€ä¸ªè„šæœ¬æ¥å®Œæˆpullï¼Œè¿™æ ·æ¯æ¬¡æ›´æ–°é•œåƒæºæ—¶åªéœ€è¦ä¿®æ”¹è„šæœ¬ï¼Œè€Œä¸éœ€è¦é‡å¯Dockeräº†ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849# è„šæœ¬åç§°ï¼šdocker_pull#!/bin/bash# ç”¨æ³•æ£€æŸ¥if [[ -z &quot;$1&quot; ]]; then echo &quot;ç”¨æ³•: $0 &lt;é•œåƒå&gt;ï¼Œä¾‹å¦‚ï¼šdocker_pull redis&quot; exit 1fi# åŸå§‹é•œåƒåç§°ï¼Œä¾‹å¦‚ nginx æˆ– someuser/imageORIGINAL_IMAGE_NAME=&quot;$1&quot;# é•œåƒæºåˆ—è¡¨ï¼Œä¿®æ”¹é•œåƒæºæ—¶åªéœ€è¦ä¿®æ”¹è¯¥åˆ—è¡¨å³å¯MIRROR_LIST=( &quot;docker.1ms.run&quot; &quot;docker.xuanyuan.me&quot; &quot;docker.m.daocloud.io&quot; &quot;docker.1panel.live&quot;)# å¦‚æœé•œåƒåä¸­ä¸åŒ…å« &quot;/&quot;ï¼ŒåŠ ä¸Š &quot;library/&quot;if [[ &quot;$ORIGINAL_IMAGE_NAME&quot; != *&quot;/&quot;* ]]; then IMAGE_NAME=&quot;library/$ORIGINAL_IMAGE_NAME&quot;else IMAGE_NAME=&quot;$ORIGINAL_IMAGE_NAME&quot;fi# éå†é•œåƒæºfor MIRROR in &quot;$&#123;MIRROR_LIST[@]&#125;&quot;; do FULL_IMAGE=&quot;$MIRROR/$IMAGE_NAME&quot; echo &quot;å°è¯•ä» $FULL_IMAGE æ‹‰å–é•œåƒ...&quot; if docker pull &quot;$FULL_IMAGE&quot;; then echo &quot;æˆåŠŸæ‹‰å–é•œåƒï¼š$FULL_IMAGE&quot; # å°†é•œåƒé‡å‘½åä¸ºå»é™¤é•œåƒæºå‰ç¼€çš„ç‰ˆæœ¬ docker tag &quot;$FULL_IMAGE&quot; &quot;$ORIGINAL_IMAGE_NAME&quot; echo &quot;é•œåƒé‡å‘½åä¸ºï¼š$ORIGINAL_IMAGE_NAME&quot; # å¯é€‰ï¼šåˆ é™¤å¸¦é•œåƒæºå‰ç¼€çš„é•œåƒ docker rmi &quot;$FULL_IMAGE&quot; &gt;/dev/null 2&gt;&amp;1 exit 0 else echo &quot;ä» $MIRROR æ‹‰å–å¤±è´¥ï¼Œå°è¯•ä¸‹ä¸€ä¸ªé•œåƒæº...&quot; fidoneecho &quot;æ‰€æœ‰é•œåƒæºå°è¯•å¤±è´¥ï¼Œæ— æ³•æ‹‰å–é•œåƒï¼š$ORIGINAL_IMAGE_NAME&quot;exit 1 å¦‚ä½•è·å–é•œåƒtag docker å‘½ä»¤ä¸­æ²¡æœ‰æä¾›ç›´æ¥è·å–é•œåƒtagçš„å‘½ä»¤ï¼Œå¦‚æœä¸æƒ³åˆ°dockerhubä¸ŠæŸ¥çœ‹ï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹å¼è·å–(éœ€è¦ç§‘å­¦ä¸Šç½‘)ï¼š 123456789101112131415# åªæ˜¾ç¤ºtagåç§°ï¼Œå®˜æ–¹é•œåƒæ›¿æ¢ nginxï¼Œéå®˜æ–¹é•œåƒæ›¿æ¢ libryary/nginxï¼Œpage_size=5è¡¨ç¤ºæ¯é¡µ5æ¡æ•°æ®ï¼Œpage=1è¡¨ç¤ºç¬¬ä¸€é¡µï¼ˆé»˜è®¤ä¸º1ï¼‰curl -s &quot;https://registry.hub.docker.com/v2/repositories/library/nginx/tags?page_size=5&amp;page=1&quot; | jq &#x27;.results[].name&#x27;## ä¹Ÿå¯ä»¥ä½¿ç”¨å¦‚ä¸‹urlï¼Œä¸¤è€…æ•ˆæœç›¸åŒ## https://hub.docker.com/v2/namespaces/&#123;namespace&#125;/repositories/&#123;repository&#125;/tags?page_size=5&amp;page=1## ç¤ºä¾‹ï¼šhttps://hub.docker.com/v2/namespaces/library/repositories/nginx/tags?page_size=1&amp;page=1# è¾“å‡ºjsonæ ¼å¼ï¼Œå¹¶æ˜¾ç¤ºæœ€åæ›´æ–°æ—¶é—´å’Œé•œåƒå¤§å°curl -s &quot;https://registry.hub.docker.com/v2/repositories/library/nginx/tags?page_size=5&amp;page=1&quot; | jq &#x27;.results[] | &#123;name,last_updated,full_size&#125;&#x27;# è¾“å‡ºè¡¨æ ¼æ ¼å¼ï¼Œå¹¶æ ¼å¼åŒ–è¾“å‡ºcurl -s &quot;https://registry.hub.docker.com/v2/repositories/library/nginx/tags?page_size=5&amp;page=1&quot; \\| jq -r &#x27;.results[] | &quot;\\(.name)\\t\\t\\(.last_updated | sub(&quot;T&quot;; &quot; &quot;) | sub(&quot;\\\\..*&quot;; &quot;&quot;))\\t\\t\\(((.full_size / 1024 / 1024 * 100 | round)/100) | tostring) MB&quot;&#x27; \\ | awk &#x27;&#123;printf &quot;%-30s %-20s %8.2f MB\\n&quot;, $1, $2&quot; &quot;$3, $4&#125;&#x27; docker images : åˆ—å‡ºé•œåƒ docker image ls == docker images 123456789101112131415# åˆ—å‡ºæ‰€æœ‰é•œåƒï¼Œä¸åŒ…æ‹¬æ‚¬ç©ºé•œåƒï¼Œï¼ˆdangling images:æ²¡æœ‰ tag çš„é•œåƒ,é€šå¸¸æ˜¯æ„å»ºä¸­é—´äº§ç‰©,ä¾‹å¦‚ï¼š&lt;none&gt;:&lt;none&gt; å½¢å¼ã€‚ï¼‰$ docker images# åˆ—å‡ºæ‰€æœ‰é•œåƒï¼ŒåŒ…æ‹¬æ‚¬ç©ºé•œåƒ$ docker images -a# åˆ—å‡ºæ‰€æœ‰é•œåƒï¼Œå¹¶æ˜¾ç¤ºé•œåƒçš„æ‘˜è¦ä¿¡æ¯$ docker images --digests# åˆ—å‡ºæ‰€æœ‰é•œåƒï¼Œå¹¶è¾“å‡ºä¸ºjsonæ ¼å¼$ docker images --format json# åªæ˜¾ç¤ºé•œåƒåç§°å’Œæ ‡ç­¾$ docker images --format &quot;&#123;&#123;.Repository&#125;&#125;:&#123;&#123;.Tag&#125;&#125;&quot;# åªæ˜¾ç¤ºé•œåƒID$ docker images -q docker inspect : æŸ¥çœ‹é•œåƒçš„è¯¦ç»†ä¿¡æ¯ docker image inspect == docker inspect è¿™é‡Œè¦æ³¨æ„ï¼Œdocker inspectå¦‚æœåŸºäºåç§°æŸ¥æ‰¾ä¼šä¼˜å…ˆæŸ¥æ‰¾å®¹å™¨ 1234567891011# å‘½ä»¤æ ¼å¼$ docker inspect [OPTIONS] NAME|ID [NAME|ID...]# æ˜¾ç¤ºé•œåƒçš„è¯¦ç»†ä¿¡æ¯ï¼Œé•œåƒåç§°$ docker inspect nginx# æ˜¾ç¤ºé•œåƒçš„è¯¦ç»†ä¿¡æ¯ï¼Œé•œåƒID$ docker inspect 9f0c0d0a0f0f# æ˜¾ç¤ºé•œåƒçš„Labelsä¿¡æ¯ï¼Œè·å–jsonä¸­æŒ‡å®šçš„å­—æ®µ$ docker image inspect --format=&#x27;&#123;&#123;json .Config.Labels&#125;&#125;&#x27; nginx docker image prune : åˆ é™¤æœªä½¿ç”¨çš„é•œåƒ 123456# åˆ é™¤æ‚¬ç©ºé•œåƒï¼Œï¼ˆdangling images:æ²¡æœ‰ tag çš„é•œåƒ,é€šå¸¸æ˜¯æ„å»ºä¸­é—´äº§ç‰©,ä¾‹å¦‚ï¼š&lt;none&gt;:&lt;none&gt; å½¢å¼ã€‚ï¼‰$ docker image prune# åˆ é™¤å…¨éƒ¨æœªä½¿ç”¨é•œåƒ(æœªè¢«ä»»ä½•ä¸€ä¸ªå®¹å™¨å¼•ç”¨)ï¼ŒåŒ…æ‹¬æ‚¬ç©ºé•œåƒ$ docker image prune -a# ä¸è¿›è¡Œç¡®è®¤æç¤ºï¼Œç›´æ¥æ‰§è¡Œ$ docker image prune -f docker rmi : åˆ é™¤é•œåƒ docker image rm == docker rmi 12345678910111213# å‘½ä»¤æ ¼å¼$ docker rmi [OPTIONS] IMAGE [IMAGE...]# åˆ é™¤é•œåƒï¼Œé•œåƒåç§°$ docker rmi nginx# åˆ é™¤å¤šä¸ªé•œåƒï¼Œç©ºæ ¼åˆ†éš”$ docker rmi nginx mysql# åˆ é™¤é•œåƒï¼Œé•œåƒID$ docker rmi 9f0c0d0a0f0f# å¼ºåˆ¶åˆ é™¤é•œåƒï¼Œå½“é•œåƒè¢«å®¹å™¨å¼•ç”¨æ—¶ï¼Œä¼šæŠ¥é”™ï¼Œéœ€è¦ä½¿ç”¨-få‚æ•°è¿›è¡Œå¼ºåˆ¶åˆ é™¤$ docker rmi -f nginx# åˆ é™¤å…¨éƒ¨é•œåƒ$ docker rmi $(docker images -q) docker history : æŸ¥çœ‹é•œåƒçš„æ„å»ºå†å² docker image history == docker history 12345678910# å‘½ä»¤æ ¼å¼$ docker history [OPTIONS] IMAGE# æŸ¥çœ‹é•œåƒçš„å†å²è®°å½•ï¼Œé•œåƒåç§°$ docker history nginx# æŸ¥çœ‹é•œåƒçš„å†å²è®°å½•ï¼Œé•œåƒID$ docker history 9f0c0d0a0f0f# æ˜¾ç¤ºå®Œæ•´çš„é•œåƒå†å²è®°å½•ï¼Œé»˜è®¤`CREATED BY`ä¸­çš„ä¿¡æ¯å¤ªé•¿ä¼šè¢«æˆªæ–­$ docker history --no-trunc nginx# æ˜¾ç¤ºä¸ºjsonæ ¼å¼$ docker history --format=json nginx docker history æ˜¾ç¤ºçš„æ˜¯æ„å»ºå†å²ï¼Œä¼šå°†æ¯ä¸€ä¸ª Dockerfile æŒ‡ä»¤éƒ½ç®—ä¸€å±‚ï¼Œè€Œä¸æ˜¯ç‰©ç†é•œåƒå±‚ï¼ˆlayerï¼‰æ•°é‡ï¼Œè‹¥è¦æŸ¥çœ‹é•œåƒçš„ç‰©ç†å±‚æ•°ï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹ 1$ docker image inspect --format &#x27;&#123;&#123; len .RootFS.Layers &#125;&#125;&#x27; nginx docker tag : åˆ›å»ºä¸€ä¸ªæ ‡ç­¾ docker image tag == docker tag 123456789101112# å‘½ä»¤æ ¼å¼$ docker tag SOURCE_IMAGE[:TAG] TARGET_IMAGE[:TAG]# åˆ›å»ºä¸€ä¸ªæ ‡ç­¾$ docker tag nginx:latest hanqunfeng/nginx:latest# æŸ¥çœ‹é•œåƒï¼Œå¯ä»¥çœ‹åˆ°ä¸¤ä¸ªé•œåƒçš„ IMAGE ID ä¸€è‡´$ docker imagesREPOSITORY TAG IMAGE ID CREATED SIZEhanqunfeng/nginx latest be69f2940aaf 5 weeks ago 192MBnginx latest be69f2940aaf 5 weeks ago 192MB# æ­¤æ—¶è‹¥é€šè¿‡ IMAGE ID åˆ é™¤é•œåƒï¼Œä¼šæŠ¥é”™ï¼Œæç¤ºè¢«å¤šä¸ª REPOSITORY å…³è”ï¼Œéœ€è¦ä½¿ç”¨ -f å‚æ•°è¿›è¡Œå¼ºåˆ¶åˆ é™¤$ docker rmi be69f2940aafError response from daemon: conflict: unable to delete be69f2940aaf (must be forced) - image is referenced in multiple repositories docker save : å°†é•œåƒä¿å­˜ä¸º tar å½’æ¡£ docker image save == docker save 123456# å‘½ä»¤æ ¼å¼$ docker save [OPTIONS] IMAGE [IMAGE...]# å°†é•œåƒä¿å­˜ä¸º tar å½’æ¡£ï¼Œ-o æŒ‡å®šè¾“å‡ºæ–‡ä»¶ï¼Œæ–‡ä»¶åç§°ä»»æ„ï¼Œç”šè‡³éƒ½ä¸éœ€è¦ä»¥ .tar ç»“å°¾$ docker save -o nginx.tar nginx# æˆ–è€…$ docker save nginx &gt; nginx.tar docker load : ä» tar å½’æ¡£ä¸­åŠ è½½é•œåƒ docker image load == docker load 123456# å‘½ä»¤æ ¼å¼$ docker load [OPTIONS]# ä» tar å½’æ¡£ä¸­åŠ è½½é•œåƒï¼Œå¯¼å‡ºtarå½’æ¡£æ—¶çš„é•œåƒåç§°å°±æ˜¯åŠ è½½åçš„é•œåƒåç§°$ docker load -i nginx.tar# -q å‚æ•°è¡¨ç¤ºä¸æ˜¾ç¤ºè¿›åº¦æ¡$ docker load -q -i nginx.tar docker import : ä»æ–‡ä»¶åˆ›å»ºé•œåƒ docker image import == docker import 12345678910111213# å‘½ä»¤æ ¼å¼$ docker import [OPTIONS] FILE|URL|- [REPOSITORY[:TAG]]## å‚æ•°è¯´æ˜file æœ¬åœ° tar æ–‡ä»¶ï¼Œä¾‹å¦‚ rootfs.tarURL ç½‘ç»œåœ°å€ï¼ˆhttp/httpsï¼‰- ä»æ ‡å‡†è¾“å…¥è¯»å–ï¼ˆæ¯”å¦‚é€šè¿‡ç®¡é“ï¼‰# è¾“å‡ºé•œåƒåç§°ä¸æ ‡ç­¾REPOSITORY[:TAG] å¯¼å…¥åé•œåƒçš„åç§°ä¸æ ‡ç­¾# OPTIONS--change åœ¨å¯¼å…¥é•œåƒæ—¶è®¾ç½® Dockerfile æŒ‡ä»¤ï¼Œå¦‚ CMDã€ENVã€EXPOSE ç­‰--message, -m æ·»åŠ å¯¼å…¥è¯´æ˜ï¼ˆcommit messageï¼‰ docker import ä¸ docker load çš„åŒºåˆ« å‘½ä»¤ ç”¨é€” æ ¼å¼ æ˜¯å¦ä¿ç•™å†å² docker import å¯¼å…¥æ–‡ä»¶ç³»ç»Ÿï¼Œåˆ›å»ºé•œåƒ(ç”± docker export ç”Ÿæˆ) çº¯æ–‡ä»¶ç³»ç»Ÿ tar åŒ… âŒ ä¸ä¿ç•™å†å²ã€æ ‡ç­¾ç­‰å…ƒæ•°æ® docker load åŠ è½½é•œåƒï¼ˆé€šå¸¸ç”± docker save ç”Ÿæˆï¼‰ Docker é•œåƒ tarï¼ˆå«å…ƒæ•°æ®ï¼‰ âœ… ä¿ç•™ tagã€å±‚ã€å†å²ç­‰ ç¤ºä¾‹: ä»å®¹å™¨å¯¼å‡ºå†å¯¼å…¥ 1234567891011121314# å¯åŠ¨ä¸€ä¸ªå®¹å™¨$ docker run -d -p 8080:80 --name nginx nginx# å¯¼å‡ºå®¹å™¨æ–‡ä»¶ç³»ç»Ÿï¼Œæ­¤æ—¶ nginx å®¹å™¨ä¸­çš„æ‰€æœ‰æ–‡ä»¶éƒ½ä¿å­˜åœ¨ my_nginx.tar æ–‡ä»¶ä¸­$ docker export -o my_nginx.tar nginx# å¯¼å…¥æ–‡ä»¶ç³»ç»Ÿï¼Œå¯¼å…¥æ—¶æŒ‡å®š å¯åŠ¨å‘½ä»¤ï¼Œå› ä¸º my_nginx.tar åªæ˜¯æ–‡ä»¶ï¼Œå¹¶ä¸åŒ…å«ä»»ä½•å¯åŠ¨å‘½ä»¤$ docker import --change=&#x27;CMD [&quot;nginx&quot;, &quot;-g&quot;, &quot;daemon off;&quot;]&#x27; my_nginx.tar nginx:my_tag# æŸ¥çœ‹é•œåƒï¼Œé•œåƒIDä¸ä¸€è‡´$ docker imagesREPOSITORY TAG IMAGE ID CREATED SIZEnginx my_tag 4ab42de31bac 4 seconds ago 191MBnginx latest be69f2940aaf 5 weeks ago 192MB docker build : ä»æŒ‡å®šç›®å½•æˆ–URLä¸­çš„ Dockerfile æ„å»º Docker é•œåƒ docker image build == docker build 123456789101112131415161718192021222324# å‘½ä»¤æ ¼å¼docker build [OPTIONS] PATH | URL | -# å‚æ•°è¯´æ˜PATH Dockerfile æ‰€åœ¨çš„ç›®å½•URL Git ä»“åº“çš„ URL- ä»æ ‡å‡†è¾“å…¥è¯»å– Dockerfile# æ„å»ºé•œåƒï¼Œ-t: æŒ‡å®šé•œåƒåç§°ï¼Œ.: è¡¨ç¤ºä»å½“å‰ç›®å½•æŸ¥æ‰¾Dockerfileï¼Œé»˜è®¤æ–‡ä»¶åç§°ä¸º Dockerfiledocker build -t myimage:latest .# æ„å»ºé•œåƒï¼Œ-f: æŒ‡å®š Dockerfile çš„ç›¸å¯¹è·¯å¾„ï¼Œ.: è¡¨ç¤ºåŸºäºå½“å‰ç›®å½•ï¼Œå®é™…çš„ Dockerfile è·¯å¾„å°±æ˜¯ ./path/MyDockerfiledocker build -t myimage:latest -f path/MyDockerfile .# å®é™…çš„ Dockerfile è·¯å¾„å°±æ˜¯ /usr/local/path/MyDockerfiledocker build -t myimage:latest -f path/MyDockerfile /usr/local# æ„å»ºé•œåƒï¼Œä» Git ä»“åº“ä¸­æ„å»ºï¼Œgit ä»“åº“çš„ Dockerfile å¿…é¡»åœ¨æ ¹ç›®å½•ä¸‹docker build https://github.com/hanqunfeng/docker_test.git -t abc:1.0.0# æ„å»ºé•œåƒï¼Œä» Git ä»“åº“ä¸­æ„å»ºï¼ŒæŒ‡å®š Dockerfile çš„ç›¸å¯¹è·¯å¾„docker build -f docker/Dockerfile https://github.com/hanqunfeng/docker_test.git -t abc:1.0.1# æ„å»ºé•œåƒï¼Œä» Git ä»“åº“ä¸­æ„å»ºï¼ŒæŒ‡å®šåˆ†æ”¯æˆ– tagdocker build -f docker/Dockerfile https://github.com/hanqunfeng/docker_test.git#release -t abc:1.0.2# æ„å»ºé•œåƒï¼Œ--no-cache è¡¨ç¤ºä¸ä½¿ç”¨ç¼“å­˜ï¼Œæ¯æ¬¡æ„å»ºéƒ½ä¼šé‡æ–°æ„å»ºï¼Œä½†ä¼šéå¸¸æ…¢ï¼Œä¸€èˆ¬æ²¡æœ‰å¯¼è‡´æŸä¸€ä¸ªå±‚å‘ç”Ÿå˜åŒ–æ—¶ä¸éœ€è¦åŠ ä¸Šè¿™ä¸ªå‚æ•°docker build --no-cache -t app:latest . docker buildä¸­è¿˜æœ‰ä¸€äº›é‡è¦çš„å‚æ•°ï¼Œä»¥åŠDockerfileæ–‡ä»¶è¯¥æ€ä¹ˆç¼–å†™ï¼Œè¯·å‚è€ƒDocker å‘½ä»¤ ä¹‹ Dockerfile docker push : æ¨é€æœ¬åœ°é•œåƒåˆ°è¿œç¨‹ä»“åº“ docker image push == docker push è¿™é‡Œä»‹ç»å¦‚ä½•å°†é•œåƒæ¨é€åˆ°docker hubè¿œç¨‹ä»“åº“ éœ€è¦å…ˆåœ¨docker hubç½‘ç«™ä¸Šåˆ›å»ºä¸€ä¸ªè´¦å·ï¼Œæ¯”å¦‚æˆ‘çš„ç”¨æˆ·åæ˜¯hanqunfeng ç„¶åå°±å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤å°†æœ¬åœ°é•œåƒæ¨é€åˆ°è¿œç¨‹ä»“åº“äº† 1234567891011121314151617181920212223242526272829# æŸ¥çœ‹æœ¬åœ°é•œåƒ$ docker imagesREPOSITORY TAG IMAGE ID CREATED SIZEnginx latest e573c6323878 18 hours ago 191MB# å¯¹nginxé•œåƒæ‰“tag,å‰ç¼€å¿…é¡»ä¸ç”¨æˆ·åä¸€è‡´$ docker tag nginx hanqunfeng/nginx:1.0.0$ docker imagesREPOSITORY TAG IMAGE ID CREATED SIZEhanqunfeng/nginx 1.0.0 be69f2940aaf 5 weeks ago 192MBnginx latest be69f2940aaf 5 weeks ago 192MB# ç™»å½• loghup$ docker login -u hanqunfengi Info â†’ A Personal Access Token (PAT) can be used instead. To create a PAT, visit https://app.docker.com/settingsPassword: # è¾“å…¥å¯†ç Login Succeeded# ç™»å½•åŒæ—¶è¾“å…¥å¯†ç # docker login -u hanqunfeng -p 12345678# ç™»å½•å…¶å®ƒä»“åº“# docker login -u username -p password registry.orther.com# æ¨é€åˆ°docker hubï¼Œæ­¤åå°±å¯ä»¥é€šè¿‡ docker pull hanqunfeng/nginx:1.0.0 è·å–äº†$ docker push hanqunfeng/nginx:1.0.0","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» Docker å‘½ä»¤ ä¸­ é•œåƒç®¡ç† ç›¸å…³å‘½ä»¤ Dockerå®˜æ–¹æ–‡æ¡£ Application programming interfaces (APIs)","date_published":"2025-05-22T13:30:05.000Z","tags":["æŠ€æœ¯","docker","docker"]},{"id":"https://blog.hanqunfeng.com/2025/05/20/docker-install/","url":"https://blog.hanqunfeng.com/2025/05/20/docker-install/","title":"Linux å®‰è£… Docker","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç» Linux ä¸‹çš„ Docker å®‰è£…æ–¹æ³•ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>windowsã€macosã€ubuntuç­‰æ¡Œé¢ç³»ç»Ÿè¯·å®‰è£… <a href=\"https://www.docker.com/products/docker-desktop/\">Docker Desktop</a>ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>é˜¿é‡Œäº‘ä¸“æœ‰æœåŠ¡å™¨å‚è€ƒï¼š<a href=\"https://help.aliyun.com/zh/ecs/use-cases/install-and-use-docker\">é˜¿é‡Œäº‘ä¸“æœ‰æœåŠ¡å™¨å¦‚ä½•å®‰è£…Docker</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>è…¾è®¯äº‘ä¸“æœ‰æœåŠ¡å™¨å‚è€ƒï¼š<a href=\"https://cloud.tencent.com/document/product/1207/45596\">è…¾è®¯äº‘ä¸“æœ‰æœåŠ¡å™¨å¦‚ä½•å®‰è£…Docker</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>AWSä¸“æœ‰æœåŠ¡å™¨å‚è€ƒï¼š<a href=\"/2025/05/19/docker-install-aws/\" title=\"AWSä¸“æœ‰æœåŠ¡å™¨å¦‚ä½•å®‰è£…Docker\">AWSä¸“æœ‰æœåŠ¡å™¨å¦‚ä½•å®‰è£…Docker</a></p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://docs.docker.com\">Dockerå®˜æ–¹æ–‡æ¡£</a></p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://docs.docker.com/engine/install/\">å®‰è£…Docker Engine</a></p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"Docker-ç®€ä»‹\">Docker ç®€ä»‹</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Docker æ˜¯ä¸€ä¸ªå¼€æºçš„å®¹å™¨åŒ–å¹³å°ï¼Œç”¨äºæ‰“åŒ…ã€åˆ†å‘å’Œè¿è¡Œåº”ç”¨ç¨‹åºã€‚å®ƒé€šè¿‡å°†åº”ç”¨ç¨‹åºåŠå…¶ä¾èµ–æ‰“åŒ…åˆ°ä¸€ä¸ªâ€œå®¹å™¨â€ä¸­ï¼Œç¡®ä¿åº”ç”¨åœ¨ä¸åŒç¯å¢ƒä¸­å§‹ç»ˆèƒ½å¤Ÿä¸€è‡´è¿è¡Œã€‚ä¸ä¼ ç»Ÿçš„è™šæ‹Ÿæœºç›¸æ¯”ï¼ŒDocker å®¹å™¨æ›´è½»é‡ã€å¯åŠ¨æ›´å¿«ã€èµ„æºå ç”¨æ›´å°‘ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>Docker é‡‡ç”¨<code>å®¢æˆ·ç«¯-æœåŠ¡å™¨</code>æ¶æ„ï¼Œæ ¸å¿ƒç»„ä»¶åŒ…æ‹¬ <code>Docker Engine</code>ï¼ˆè´Ÿè´£æ„å»ºå’Œè¿è¡Œå®¹å™¨ï¼‰ã€<code>Dockerfile</code>ï¼ˆå®šä¹‰æ„å»ºé•œåƒçš„æŒ‡ä»¤ï¼‰ã€<code>é•œåƒ</code>ï¼ˆåº”ç”¨å’Œä¾èµ–çš„åªè¯»æ¨¡æ¿ï¼‰å’Œ<code>å®¹å™¨</code>ï¼ˆåŸºäºé•œåƒè¿è¡Œçš„å®ä¾‹ï¼‰ã€‚å¼€å‘è€…å¯ä»¥é€šè¿‡ Docker Hub å…±äº«æˆ–ä¸‹è½½é•œåƒï¼Œæå¤§ç®€åŒ–äº†éƒ¨ç½²æµç¨‹ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>æ€»ç»“æ¥è¯´ï¼ŒDocker æé«˜äº†å¼€å‘æ•ˆç‡ï¼Œæ”¯æŒæŒç»­é›†æˆä¸éƒ¨ç½²ï¼ˆCI/CDï¼‰ï¼Œåœ¨å¾®æœåŠ¡æ¶æ„ä¸­å°¤ä¸ºå¸¸ç”¨ï¼Œæ˜¯ç°ä»£ DevOps æµç¨‹çš„é‡è¦å·¥å…·ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://docs.docker.com/get-started/docker-overview/\">Dockeræ˜¯ä»€ä¹ˆï¼Ÿ</a><br>\n<img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/uPic/nIdftv.png\" alt=\"\"></p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>åç§°</th>\n<th>æè¿°</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Docker ä»“åº“ï¼ˆRegistryï¼‰</td>\n<td>Dockerä»“åº“ç”¨äºå­˜å‚¨Dockeré•œåƒã€‚Docker Hubæ˜¯ä¸€ä¸ªä»»ä½•äººéƒ½å¯ä»¥ä½¿ç”¨çš„å…¬å…±ä»“åº“ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼ŒDockeråœ¨Docker Hubä¸ŠæŸ¥æ‰¾å›¾åƒã€‚ä½ ä¹Ÿå¯ä»¥é…ç½®è‡ªå·±çš„ç§äººä»“åº“ã€‚<br>å½“æ‚¨ä½¿ç”¨docker pullæˆ–docker runå‘½ä»¤æ—¶ï¼ŒDockerä¼šä»æ‚¨é…ç½®çš„ä»“åº“ä¸­æå–æ‰€éœ€çš„é•œåƒã€‚å½“æ‚¨ä½¿ç”¨docker pushå‘½ä»¤æ—¶ï¼ŒDockerä¼šå°†æ‚¨çš„é•œåƒæ¨é€åˆ°å·²é…ç½®çš„ä»“åº“ä¸­ã€‚</td>\n</tr>\n<tr>\n<td>Docker å®ˆæŠ¤è¿›ç¨‹ï¼ˆDaemonï¼‰</td>\n<td>ç›‘å¬Docker APIè¯·æ±‚ï¼Œå¹¶ç®¡ç†Dockerå¯¹è±¡ï¼Œå¦‚é•œåƒã€å®¹å™¨ã€ç½‘ç»œå’Œå·ã€‚å®ˆæŠ¤ç¨‹åºè¿˜å¯ä»¥ä¸å…¶ä»–å®ˆæŠ¤ç¨‹åºé€šä¿¡æ¥ç®¡ç†DockeræœåŠ¡ã€‚</td>\n</tr>\n<tr>\n<td>Docker å®¢æˆ·ç«¯ï¼ˆClientï¼‰</td>\n<td>Docker å®¢æˆ·ç«¯ï¼ˆdockerï¼‰æ˜¯è®¸å¤šç”¨æˆ·ä¸ Docker äº¤äº’çš„ä¸»è¦æ–¹å¼ã€‚å½“ä½ ä½¿ç”¨å¦‚ docker run è¿™æ ·çš„å‘½ä»¤æ—¶ï¼Œå®¢æˆ·ç«¯ä¼šå°†è¿™äº›å‘½ä»¤å‘é€ç»™ dockerdï¼ˆDocker å®ˆæŠ¤è¿›ç¨‹ï¼‰ï¼Œç”±å®ƒæ¥æ‰§è¡Œè¿™äº›æ“ä½œã€‚<br>docker å‘½ä»¤æ˜¯é€šè¿‡ Docker API è¿›è¡Œé€šä¿¡çš„ã€‚Docker å®¢æˆ·ç«¯å¯ä»¥ä¸å¤šä¸ªå®ˆæŠ¤è¿›ç¨‹è¿›è¡Œé€šä¿¡ã€‚</td>\n</tr>\n<tr>\n<td>Docker ä¸»æœºï¼ˆHostï¼‰</td>\n<td>è¿è¡Œ Docker å®ˆæŠ¤è¿›ç¨‹å’Œå®¹å™¨çš„ç‰©ç†æˆ–è™šæ‹Ÿæœºå™¨ã€‚</td>\n</tr>\n<tr>\n<td>Docker é•œåƒï¼ˆImagesï¼‰</td>\n<td>åˆ›å»ºå®¹å™¨çš„åªè¯»æ¨¡æ¿ï¼ŒåŒ…å«è¿è¡Œåº”ç”¨æ‰€éœ€çš„æ‰€æœ‰æ–‡ä»¶å’Œé…ç½®ã€‚</td>\n</tr>\n<tr>\n<td>Docker å®¹å™¨ï¼ˆContainerï¼‰</td>\n<td>åŸºäºé•œåƒè¿è¡Œçš„å®ä¾‹ï¼Œæ˜¯ä¸€ä¸ªæˆ–å¤šä¸ªåº”ç”¨çš„ç‹¬ç«‹è¿è¡Œç¯å¢ƒã€‚</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"Docker-å®‰è£…\">Docker å®‰è£…</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å…¨æ–°å®‰è£…å‰éœ€è¦å…ˆå¸è½½æ—§ç‰ˆæœ¬ï¼Œå¸è½½<code>docker</code>ä¹Ÿå¯ä»¥æŒ‰ç…§å¦‚ä¸‹æ–¹å¼æ“ä½œ</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åˆ é™¤Dockerç›¸å…³æº</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> <span class=\"built_in\">rm</span> -f /etc/yum.repos.d/docker*.repo</span><br><span class=\"line\"><span class=\"comment\"># åˆ é™¤Dockerç›¸å…³è½¯ä»¶åŒ…ï¼Œdnfå¯èƒ½ä¼šæŠ¥å‘Šæ‚¨æ²¡æœ‰å®‰è£…è¿™äº›è½¯ä»¶åŒ…ã€‚</span></span><br><span class=\"line\"><span class=\"comment\"># å¸è½½dockeræ—§ç‰ˆæœ¬</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> dnf -y remove \\</span><br><span class=\"line\">               docker \\</span><br><span class=\"line\">               docker-client \\</span><br><span class=\"line\">               docker-client-latest \\</span><br><span class=\"line\">               docker-common \\</span><br><span class=\"line\">               docker-latest \\</span><br><span class=\"line\">               docker-latest-logrotate \\</span><br><span class=\"line\">               docker-logrotate \\</span><br><span class=\"line\">               docker-engine</span><br><span class=\"line\"><span class=\"comment\"># å¸è½½dockeræ–°ç‰ˆæœ¬</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> dnf -y remove \\</span><br><span class=\"line\">            docker-ce \\</span><br><span class=\"line\">            containerd.io \\</span><br><span class=\"line\">            docker-ce-rootless-extras \\</span><br><span class=\"line\">            docker-buildx-plugin \\</span><br><span class=\"line\">            docker-ce-cli \\</span><br><span class=\"line\">            docker-compose-plugin</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åˆ é™¤Dockeræ•°æ®,é•œåƒã€å®¹å™¨ã€å·å’Œç½‘ç»œ</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> <span class=\"built_in\">rm</span> -rf /var/lib/docker</span><br><span class=\"line\"><span class=\"built_in\">sudo</span> <span class=\"built_in\">rm</span> -rf /var/lib/containerd</span><br><span class=\"line\"><span class=\"comment\"># åˆ é™¤Dockeré…ç½®</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> <span class=\"built_in\">rm</span> -rf /etc/docker/</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è®¾ç½®dockerå­˜å‚¨åº“</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">sudo</span> dnf -y install dnf-plugins-core</span><br><span class=\"line\"><span class=\"comment\"># æµ·å¤–ï¼Œæ·»åŠ Dockerçš„å®˜æ–¹å­˜å‚¨åº“</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> dnf config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo</span><br><span class=\"line\"><span class=\"comment\"># å›½å†…ï¼Œæ·»åŠ é˜¿é‡Œäº‘çš„å­˜å‚¨åº“</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> dnf config-manager --add-repo https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å®‰è£… Docker</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å®‰è£…æœ€æ–°ç‰ˆæœ¬ï¼Œå‡çº§ docker æ—¶ä¹Ÿæ˜¯æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> dnf -y install docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å®‰è£…æŒ‡å®šç‰ˆæœ¬</span></span><br><span class=\"line\"><span class=\"comment\"># å…ˆæŸ¥çœ‹æ‰€æœ‰ç‰ˆæœ¬</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> dnf list docker-ce --showduplicates | <span class=\"built_in\">sort</span> -r</span><br><span class=\"line\"><span class=\"comment\">## è¾“å‡º</span></span><br><span class=\"line\">docker-ce.x86_64               3:26.1.3-1.el8                  docker-ce-stable</span><br><span class=\"line\">docker-ce.x86_64               3:26.1.3-1.el8                  @docker-ce-stable</span><br><span class=\"line\">docker-ce.x86_64               3:26.1.2-1.el8                  docker-ce-stable</span><br><span class=\"line\">docker-ce.x86_64               3:26.1.1-1.el8                  docker-ce-stable</span><br><span class=\"line\">docker-ce.x86_64               3:26.1.0-1.el8                  docker-ce-stable</span><br><span class=\"line\">â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å®‰è£…æŒ‡å®šç‰ˆæœ¬ï¼Œè¿™é‡Œ VERSION_STRING ä¸ºç‰ˆæœ¬å·ï¼Œä¾‹å¦‚ 3:26.1.3-1.el8</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> dnf install docker-ce-&lt;VERSION_STRING&gt; docker-ce-cli-&lt;VERSION_STRING&gt; containerd.io docker-buildx-plugin docker-compose-plugin -y</span><br><span class=\"line\"><span class=\"comment\">## æ¯”å¦‚</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> dnf install docker-ce-3:26.1.3-1.el8 docker-ce-cli-3:26.1.3-1.el8 containerd.io docker-buildx-plugin docker-compose-plugin -y</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¯åŠ¨ Docker</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># è®¾ç½®Dockerå®ˆæŠ¤è¿›ç¨‹åœ¨ç³»ç»Ÿå¯åŠ¨æ—¶è‡ªåŠ¨å¯åŠ¨</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> systemctl <span class=\"built_in\">enable</span> docker</span><br><span class=\"line\"><span class=\"comment\"># å¯åŠ¨Docker</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> systemctl start docker</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ·»åŠ å½“å‰ç”¨æˆ·åˆ°dockerç»„</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æ·»åŠ å½“å‰ç”¨æˆ·åˆ°dockerç»„ï¼Œè¿™æ ·å½“å‰ç”¨æˆ·å°±å¯ä»¥ä¸éœ€è¦ä½¿ç”¨sudoå°±èƒ½ä½¿ç”¨dockerå‘½ä»¤</span></span><br><span class=\"line\"><span class=\"comment\"># å½“å‰ç”¨æˆ·æ˜¯centos</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> usermod -aG docker centos</span><br><span class=\"line\"><span class=\"comment\"># è®©ç»„æƒé™ç«‹å³ç”Ÿæ•ˆæœ€ç¨³å¦¥çš„åšæ³•æ˜¯ï¼šæ³¨é”€å¹¶é‡æ–°ç™»å½•è¿œç¨‹ä¸»æœºï¼Œä½†ä¹Ÿå¯ä»¥å°è¯•ç”¨ä¸‹é¢å‘½ä»¤ç«‹å³åŠ è½½æ–°ç»„</span></span><br><span class=\"line\">newgrp docker</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>éªŒè¯ Docker å®‰è£…</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker version <span class=\"comment\"># æŸ¥çœ‹ Docker version</span></span><br><span class=\"line\"><span class=\"comment\"># æ˜¾ç¤º Docker åŸºæœ¬ä¿¡æ¯ï¼ŒåŒ…æ‹¬ç‰ˆæœ¬ä¿¡æ¯ï¼Œæ’ä»¶ä¿¡æ¯ï¼Œé•œåƒåŠ é€Ÿä¿¡æ¯ç­‰ç­‰ã€‚</span></span><br><span class=\"line\">docker info</span><br><span class=\"line\"><span class=\"comment\"># æ‹‰å–hello-worldé•œåƒï¼Œæ­¤æ—¶å›½å†…ä¼šæç¤ºè®¿é—®å¤±è´¥ï¼Œéœ€è¦æ·»åŠ å›½å†…é•œåƒæº</span></span><br><span class=\"line\">docker pull hello-world</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ·»åŠ å›½å†…é•œåƒæº</p>\n</li>\n</ul>\n<blockquote>\n<p>ç›®å‰å›½å†…å¤§éƒ¨åˆ†çš„Dockeré•œåƒæºéƒ½å…³é—­äº†ï¼Œå¦å¤–é˜¿é‡Œäº‘çš„Dockeré•œåƒæºåªå…è®¸åœ¨é˜¿é‡Œäº‘çš„æœºå™¨ä¸Šä½¿ç”¨ã€‚<br>\nå‚è€ƒï¼š<a href=\"https://blog.xuanyuan.me/archives/1154\">Docker/DockerHub å›½å†…é•œåƒæº/åŠ é€Ÿåˆ—è¡¨</a>,<a href=\"https://status.1panel.top/status/docker\">å›½å†… Docker æœåŠ¡çŠ¶æ€ &amp; é•œåƒåŠ é€Ÿç›‘æ§</a><br>\næ³¨æ„ï¼šå›½å†…é•œåƒæºçš„æ›´æ–°ä¼šæ¯”å®˜ç½‘æ»åï¼Œä½†åªè¦ä¸æ˜¯è·å–æœ€æ–°ç‰ˆæœ¬åŸºæœ¬ä¸Šæ˜¯å¤Ÿç”¨çš„ã€‚</p>\n</blockquote>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">sudo</span> <span class=\"built_in\">tee</span> /etc/docker/daemon.json &lt;&lt;<span class=\"string\">EOF</span></span><br><span class=\"line\"><span class=\"string\">&#123;</span></span><br><span class=\"line\"><span class=\"string\">    &quot;registry-mirrors&quot;: [</span></span><br><span class=\"line\"><span class=\"string\">        &quot;https://docker.1ms.run&quot;,</span></span><br><span class=\"line\"><span class=\"string\">        &quot;https://docker.xuanyuan.me&quot;,</span></span><br><span class=\"line\"><span class=\"string\">        &quot;https://docker.m.daocloud.io&quot;</span></span><br><span class=\"line\"><span class=\"string\">    ]</span></span><br><span class=\"line\"><span class=\"string\">&#125;</span></span><br><span class=\"line\"><span class=\"string\">EOF</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># é‡å¯Docker</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> systemctl daemon-reload</span><br><span class=\"line\"><span class=\"built_in\">sudo</span> systemctl restart docker</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹æ˜¯å¦é…ç½®ç”Ÿæ•ˆï¼ŒæŸ¥çœ‹ Registry Mirrors ä¸­çš„é…ç½®</span></span><br><span class=\"line\">docker info</span><br><span class=\"line\"><span class=\"comment\"># éªŒè¯å›½å†…é•œåƒæº</span></span><br><span class=\"line\">docker pull hello-world</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Dockerå‘½ä»¤è‡ªåŠ¨è¡¥å…¨ï¼Œå‚è€ƒï¼š<a href=\"https://docs.docker.com/engine/cli/completion/\">å®˜æ–¹æ–‡æ¡£</a></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ä½¿ç”¨çš„bash</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å®‰è£…bash-completion</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> dnf install bash-completion -y</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ·»åŠ è‡ªåŠ¨è¡¥å…¨åˆ°å½“å‰ç™»å½•ç”¨æˆ·</span></span><br><span class=\"line\"><span class=\"built_in\">cat</span> &lt;&lt;<span class=\"string\">EOT &gt;&gt; ~/.bashrc</span></span><br><span class=\"line\"><span class=\"string\">if [ -f /etc/bash_completion ]; then</span></span><br><span class=\"line\"><span class=\"string\">    . /etc/bash_completion</span></span><br><span class=\"line\"><span class=\"string\">fi</span></span><br><span class=\"line\"><span class=\"string\">EOT</span></span><br><span class=\"line\"><span class=\"comment\"># åˆ·æ–°bash</span></span><br><span class=\"line\"><span class=\"built_in\">source</span> ~/.bashrc</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åˆ›å»ºè‡ªåŠ¨è¡¥å…¨æ–‡ä»¶</span></span><br><span class=\"line\"><span class=\"built_in\">mkdir</span> -p ~/.local/share/bash-completion/completions</span><br><span class=\"line\">docker completion bash &gt; ~/.local/share/bash-completion/completions/docker</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å¯åŠ¨ä¸€ä¸ªæ–°çš„bash</span></span><br><span class=\"line\"><span class=\"built_in\">exec</span> bash</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><code>/var/lib/docker</code> ç”¨äºå­˜å‚¨ Docker è¿è¡Œæ—¶ç”Ÿæˆçš„æ•°æ®ï¼Œå¦‚é•œåƒã€å®¹å™¨ã€ç½‘ç»œã€å·ã€é…ç½®æ–‡ä»¶ã€æ—¥å¿—ç­‰ï¼Œå…¶ç›®å½•ç»“æ„è¯´æ˜å¦‚ä¸‹ï¼š</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>ç›®å½•å</th>\n<th>ä½œç”¨è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>buildkit/</code></td>\n<td>å­˜æ”¾ Docker BuildKit æ„å»ºç¼“å­˜å’ŒçŠ¶æ€ä¿¡æ¯ï¼›æ„å»ºé•œåƒæ—¶çš„ä¸­é—´æ–‡ä»¶å’Œä¸Šä¸‹æ–‡ä¼šå­˜äºæ­¤ï¼Œç©ºé—´å ç”¨å¯èƒ½è¾ƒå¤§ã€‚</td>\n</tr>\n<tr>\n<td><code>containers/</code></td>\n<td>æ¯ä¸ªå®¹å™¨ä¸€ä¸ªå­ç›®å½•ï¼ŒåŒ…å«é…ç½®æ–‡ä»¶å’Œè¿è¡Œæ—¥å¿—ï¼ˆå¦‚ <code>container.log</code>ï¼‰ï¼Œç”¨äºå®¹å™¨çš„è¿è¡ŒçŠ¶æ€è®°å½•å’Œç®¡ç†ã€‚</td>\n</tr>\n<tr>\n<td><code>engine-id</code></td>\n<td>å­˜å‚¨ Docker å¼•æ“çš„å”¯ä¸€ IDï¼ŒDocker å®‰è£…æ—¶ç”Ÿæˆï¼Œå¸¸ç”¨äº swarm èŠ‚ç‚¹è¯†åˆ«ã€‚</td>\n</tr>\n<tr>\n<td><code>image/</code></td>\n<td>é•œåƒçš„å…ƒæ•°æ®ï¼ˆä¸å«å®é™… layer æ•°æ®ï¼‰ï¼Œç»„ç»‡é•œåƒçš„ç»“æ„ã€æ ‡ç­¾ã€é©±åŠ¨ç­‰ä¿¡æ¯ã€‚</td>\n</tr>\n<tr>\n<td><code>network/</code></td>\n<td>ç½‘ç»œé…ç½®åŠçŠ¶æ€ä¿¡æ¯ï¼Œå¦‚é»˜è®¤ <code>bridge</code> ç½‘ç»œã€è‡ªå®šä¹‰ç½‘ç»œé…ç½®ç­‰ã€‚</td>\n</tr>\n<tr>\n<td><code>overlay2/</code></td>\n<td>é•œåƒå’Œå®¹å™¨å®é™…çš„æ•°æ®å±‚ï¼ˆoverlay2 æ˜¯å­˜å‚¨é©±åŠ¨ï¼‰ï¼ŒåŒ…å«æ‰€æœ‰è”åˆæ–‡ä»¶ç³»ç»Ÿå±‚ï¼Œæ˜¯ Docker ä¸­æœ€å¤§çš„ç©ºé—´ä½¿ç”¨è€…ã€‚</td>\n</tr>\n<tr>\n<td><code>plugins/</code></td>\n<td>å­˜æ”¾ Docker æ’ä»¶ï¼ˆå¦‚ç½‘ç»œã€å·æ’ä»¶ï¼‰çš„é…ç½®å’Œæ•°æ®ï¼Œä¸€èˆ¬ä¸ºç©ºï¼Œé™¤éä½¿ç”¨äº†æ‰©å±•æ’ä»¶ã€‚</td>\n</tr>\n<tr>\n<td><code>runtimes/</code></td>\n<td>æ”¯æŒçš„ OCI runtime é…ç½®ç›®å½•ï¼Œå¦‚é»˜è®¤çš„ <code>runc</code>ï¼Œä¹Ÿå¯èƒ½åŒ…å«å…¶ä»– runtimeï¼ˆå¦‚ <code>kata</code>, <code>gvisor</code>ï¼‰ã€‚</td>\n</tr>\n<tr>\n<td><code>swarm/</code></td>\n<td>Docker swarm æ¨¡å¼ä¸‹çš„é›†ç¾¤å…ƒæ•°æ®ä¸èŠ‚ç‚¹çŠ¶æ€ï¼Œä»…åœ¨åˆå§‹åŒ– swarm åå­˜åœ¨å®é™…æ•°æ®ã€‚</td>\n</tr>\n<tr>\n<td><code>tmp/</code></td>\n<td>Docker çš„ä¸´æ—¶æ–‡ä»¶ç›®å½•ï¼Œå¦‚é•œåƒä¸‹è½½ç¼“å­˜ã€æŒ‚è½½æ“ä½œä¸­çš„ä¸´æ—¶æ–‡ä»¶ï¼Œé€šå¸¸å¯ä»¥æ¸…ç†ä½†éœ€å°å¿ƒã€‚</td>\n</tr>\n<tr>\n<td><code>volumes/</code></td>\n<td>Docker å·çš„æ•°æ®ç›®å½•ï¼Œæ¯ä¸ªå·ä¸€ä¸ªå­ç›®å½•ï¼Œå·ä¸­çš„æŒä¹…åŒ–æ•°æ®å®é™…å­˜æ”¾äºæ­¤ã€‚</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><code>/var/lib/containerd</code> æ˜¯ Containerd å®ˆæŠ¤è¿›ç¨‹çš„é»˜è®¤æ•°æ®å­˜å‚¨ç›®å½•ã€‚Containerd æ˜¯ Docker å’Œå…¶ä»–å®¹å™¨å¹³å°ï¼ˆå¦‚ Kubernetesï¼‰åº•å±‚çš„ å®¹å™¨è¿è¡Œæ—¶ï¼ˆContainer Runtimeï¼‰ï¼Œè´Ÿè´£æ‹‰å–é•œåƒã€ç®¡ç†å®¹å™¨ç”Ÿå‘½å‘¨æœŸã€æŒ‚è½½æ–‡ä»¶ç³»ç»Ÿç­‰æ“ä½œã€‚å…¶ç›®å½•ç»“æ„è¯´æ˜å¦‚ä¸‹ï¼š</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>ç›®å½•å</th>\n<th>ä½œç”¨è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>io.containerd.content.v1.content/</code></td>\n<td>å­˜å‚¨é•œåƒ layer çš„å®é™…äºŒè¿›åˆ¶å†…å®¹ï¼ˆblobï¼‰ï¼Œéµå¾ª OCI é•œåƒè§„èŒƒï¼Œæ˜¯é•œåƒå’Œå®¹å™¨æ–‡ä»¶ç³»ç»Ÿçš„æ•°æ®æ¥æºã€‚</td>\n</tr>\n<tr>\n<td><code>io.containerd.metadata.v1.bolt/</code></td>\n<td>ä½¿ç”¨ BoltDB å­˜å‚¨ containerd çš„å…ƒæ•°æ®ï¼ˆå¦‚é•œåƒä¿¡æ¯ã€å®¹å™¨çŠ¶æ€ã€å¿«ç…§å¼•ç”¨ç­‰ï¼‰ï¼Œæ˜¯ containerd çš„æ ¸å¿ƒå…ƒæ•°æ®æ•°æ®åº“ã€‚</td>\n</tr>\n<tr>\n<td><code>io.containerd.runtime.v1.linux/</code></td>\n<td>å­˜å‚¨æ—§ç‰ˆï¼ˆv1 APIï¼‰è¿è¡Œæ—¶å®¹å™¨ä¿¡æ¯ï¼Œç›®å‰å·²é€æ­¥è¢« <code>v2</code> æ¥å£å–ä»£ï¼Œä»…åœ¨å‘åå…¼å®¹åœºæ™¯ä¸­å­˜åœ¨ã€‚</td>\n</tr>\n<tr>\n<td><code>io.containerd.runtime.v2.task/</code></td>\n<td>å­˜å‚¨ v2 è¿è¡Œæ—¶æ¥å£ä¸‹å®¹å™¨çš„è¿è¡Œæ—¶çŠ¶æ€ï¼Œå¦‚å®¹å™¨è¿›ç¨‹çš„ shimã€PIDã€æ—¥å¿—è·¯å¾„ç­‰ï¼Œæ˜¯å®¹å™¨å®é™…è¿è¡Œæ—¶æ‰€ä¾èµ–çš„ã€‚</td>\n</tr>\n<tr>\n<td><code>io.containerd.snapshotter.v1.native/</code></td>\n<td>ä½¿ç”¨ native æ¨¡å¼å­˜å‚¨çš„å®¹å™¨å¿«ç…§ï¼ˆæ–‡ä»¶ç³»ç»Ÿå±‚ï¼‰ï¼Œç›´æ¥å¤åˆ¶åº•å±‚æ–‡ä»¶ï¼›æ€§èƒ½è¾ƒå·®ï¼Œå ç”¨ç©ºé—´è¾ƒå¤§ï¼Œä¸»è¦ç”¨äºæµ‹è¯•æˆ–ç‰¹å®šç”¨é€”ã€‚</td>\n</tr>\n<tr>\n<td><code>io.containerd.snapshotter.v1.overlayfs/</code></td>\n<td>ä½¿ç”¨ overlayfs æ¨¡å¼å­˜å‚¨å®¹å™¨çš„æ–‡ä»¶ç³»ç»Ÿå¿«ç…§ï¼ˆé•œåƒå±‚å’Œå®¹å™¨å±‚ï¼‰ï¼›è¿™æ˜¯ç”Ÿäº§ç¯å¢ƒé»˜è®¤çš„é«˜æ•ˆå­˜å‚¨é©±åŠ¨ã€‚</td>\n</tr>\n<tr>\n<td><code>tmpmounts/</code></td>\n<td>ä¸´æ—¶æŒ‚è½½ç‚¹ç›®å½•ï¼Œcontainerd ç”¨äºé•œåƒè§£åŒ…ã€ä¸­é—´æ„å»ºè¿‡ç¨‹ä¸­çš„æŒ‚è½½æ“ä½œï¼Œé€šå¸¸æ˜¯æ„å»ºæˆ–è¿è¡Œè¿‡ç¨‹çš„ä¸´æ—¶æ•°æ®ã€‚</td>\n</tr>\n</tbody>\n</table>\n<div class=\"tips\">\n<p><em><strong>MacOS/Windowsä¸‹æ— æ³•æŸ¥çœ‹<code>/var/lib/docker</code>çš„è§£å†³æ–¹æ³•</strong></em></p>\n<ul class=\"lvl-1\">\n<li class=\"lvl-2\">åœ¨ MacOS/Windows ä¸Šä½¿ç”¨Dockeræ—¶ï¼Œæ˜¯å¯åŠ¨äº†ä¸€ä¸ªè™šæ‹Ÿæœºæ¥è¿è¡Œdockerçš„ï¼Œç”±äºå…¶è¿è¡Œåœ¨è™šæ‹Ÿæœºå†…éƒ¨ï¼Œç›´æ¥æŸ¥æ‰¾<code>/var/lib/docker</code>è·¯å¾„æ˜¯æ— æ•ˆçš„ã€‚</li>\n<li class=\"lvl-2\">è§£å†³æ–¹æ³•å¦‚ä¸‹ï¼š</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å¯åŠ¨ä¸€ä¸ªä¸´æ—¶å®¹å™¨ï¼Œå¹¶è¿›å…¥å…¶å†…éƒ¨</span></span><br><span class=\"line\">docker run --<span class=\"built_in\">rm</span> -it --privileged --pid=host debian nsenter -t 1 -m -u -n -i sh</span><br><span class=\"line\"><span class=\"comment\">## è¯´æ˜</span></span><br><span class=\"line\">--it</span><br><span class=\"line\">    äº¤äº’å¼åœ°è¿è¡Œå®¹å™¨,å¹¶åˆ†é…ä¸€ä¸ªä¼ªç»ˆç«¯</span><br><span class=\"line\"></span><br><span class=\"line\">--<span class=\"built_in\">rm</span></span><br><span class=\"line\">    é€€å‡ºå®¹å™¨æ—¶ï¼Œè‡ªåŠ¨åˆ é™¤å®¹å™¨</span><br><span class=\"line\"></span><br><span class=\"line\">--privileged</span><br><span class=\"line\">    ç»™å®¹å™¨ç‰¹æƒæƒé™ï¼Œè¿™æ„å‘³ç€å®¹å™¨å‡ ä¹æ‹¥æœ‰å®¿ä¸»æœºçš„æ‰€æœ‰èƒ½åŠ›ï¼Œèƒ½è®¿é—® /devã€ä¿®æ”¹å†…æ ¸å‚æ•°ç­‰ã€‚éå¸¸å¼ºå¤§ä½†ä¹Ÿå¾ˆå±é™©ã€‚</span><br><span class=\"line\"></span><br><span class=\"line\">--pid=host</span><br><span class=\"line\">    å®¹å™¨å…±äº«å®¿ä¸»æœºçš„è¿›ç¨‹å‘½åç©ºé—´ï¼ˆPID Namespaceï¼‰ã€‚</span><br><span class=\"line\">    è¿™ä½¿å¾—å®¹å™¨å¯ä»¥çœ‹åˆ°å¹¶è®¿é—®å®¿ä¸»æœºçš„æ‰€æœ‰è¿›ç¨‹ï¼ˆåŒ…æ‹¬ PID 1ï¼Œå³ç³»ç»Ÿ init è¿›ç¨‹ï¼‰ã€‚</span><br><span class=\"line\"></span><br><span class=\"line\">debian</span><br><span class=\"line\">    ä½¿ç”¨çš„åŸºç¡€é•œåƒæ˜¯ Debianï¼Œå®¹å™¨é‡Œè¿è¡Œçš„æ˜¯è¿™ä¸ªç³»ç»Ÿã€‚</span><br><span class=\"line\"></span><br><span class=\"line\">nsenter -t 1 -m -u -n -i sh</span><br><span class=\"line\">    è¿™æ˜¯å®¹å™¨å†…éƒ¨è¿è¡Œçš„å‘½ä»¤ï¼Œç”¨æ¥è¿›å…¥å®¿ä¸»æœºçš„å‘½åç©ºé—´ï¼š</span><br><span class=\"line\">        nsenterï¼šLinux å·¥å…·ï¼Œç”¨äºè¿›å…¥å…¶ä»–è¿›ç¨‹çš„å‘½åç©ºé—´ã€‚</span><br><span class=\"line\">        -t 1ï¼šæŒ‡å®šç›®æ ‡è¿›ç¨‹çš„ PID æ˜¯ 1ï¼ˆå®¿ä¸»æœºçš„ init æˆ– systemdï¼‰ã€‚</span><br><span class=\"line\">        -mï¼šè¿›å…¥ç›®æ ‡è¿›ç¨‹çš„ Mount Namespaceï¼ˆæ–‡ä»¶ç³»ç»ŸæŒ‚è½½ï¼‰ã€‚</span><br><span class=\"line\">        -uï¼šè¿›å…¥ç›®æ ‡çš„ UTS Namespaceï¼ˆä¸»æœºåç­‰ï¼‰ã€‚</span><br><span class=\"line\">        -nï¼šè¿›å…¥ç›®æ ‡çš„ Network Namespaceï¼ˆç½‘ç»œï¼‰ã€‚</span><br><span class=\"line\">        -iï¼šè¿›å…¥ç›®æ ‡çš„ IPC Namespaceï¼ˆè¿›ç¨‹é—´é€šä¿¡ï¼‰ã€‚</span><br><span class=\"line\">        shï¼šåœ¨è¿™äº›å‘½åç©ºé—´ä¸­æ‰§è¡Œä¸€ä¸ª shellã€‚</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-1\">\n<li class=\"lvl-2\">è¿™ä¸ªå‘½ä»¤å¯åŠ¨ä¸€ä¸ªåŸºäº Debian çš„å®¹å™¨ï¼Œç»™å®ƒæ‰€æœ‰ç‰¹æƒï¼Œè®©å®ƒèƒ½çœ‹åˆ°å®¿ä¸»æœºçš„è¿›ç¨‹ï¼Œç„¶åä½¿ç”¨ nsenter è¿›å…¥ PID ä¸º 1 çš„æ‰€æœ‰å‘½åç©ºé—´ï¼ˆç›¸å½“äºè¿›å…¥å®¿ä¸»æœºçš„è§†è§’ï¼‰ï¼Œæœ€åå¯åŠ¨ä¸€ä¸ª shï¼Œä½ å°±åœ¨å®¹å™¨é‡Œ â€œå˜æˆäº†å®¿ä¸»æœºâ€ã€‚</li>\n<li class=\"lvl-2\">è¿™æ ·ï¼Œä½ å°±å¯ä»¥åœ¨è¿™ä¸ªå®¹å™¨ä¸­æŸ¥çœ‹<code>/var/lib/docker</code>ç›®å½•äº†ã€‚</li>\n</ul>\n</div>\n","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» Linux ä¸‹çš„ Docker å®‰è£…æ–¹æ³•ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚ windowsã€macosã€ubuntuç­‰æ¡Œé¢ç³»ç»Ÿè¯·å®‰è£… Docker Desktopã€‚ é˜¿é‡Œäº‘ä¸“æœ‰æœåŠ¡å™¨å‚è€ƒï¼šé˜¿é‡Œäº‘ä¸“æœ‰æœåŠ¡å™¨å¦‚ä½•å®‰è£…Docker è…¾è®¯äº‘ä¸“æœ‰æœåŠ¡å™¨å‚è€ƒï¼šè…¾è®¯äº‘ä¸“æœ‰æœåŠ¡å™¨å¦‚ä½•å®‰è£…Docker AWSä¸“æœ‰æœåŠ¡å™¨å‚è€ƒï¼šAWSä¸“æœ‰æœåŠ¡å™¨å¦‚ä½•å®‰è£…Docker Dockerå®˜æ–¹æ–‡æ¡£ å®‰è£…Docker Engine Docker ç®€ä»‹ Docker æ˜¯ä¸€ä¸ªå¼€æºçš„å®¹å™¨åŒ–å¹³å°ï¼Œç”¨äºæ‰“åŒ…ã€åˆ†å‘å’Œè¿è¡Œåº”ç”¨ç¨‹åºã€‚å®ƒé€šè¿‡å°†åº”ç”¨ç¨‹åºåŠå…¶ä¾èµ–æ‰“åŒ…åˆ°ä¸€ä¸ªâ€œå®¹å™¨â€ä¸­ï¼Œç¡®ä¿åº”ç”¨åœ¨ä¸åŒç¯å¢ƒä¸­å§‹ç»ˆèƒ½å¤Ÿä¸€è‡´è¿è¡Œã€‚ä¸ä¼ ç»Ÿçš„è™šæ‹Ÿæœºç›¸æ¯”ï¼ŒDocker å®¹å™¨æ›´è½»é‡ã€å¯åŠ¨æ›´å¿«ã€èµ„æºå ç”¨æ›´å°‘ã€‚ Docker é‡‡ç”¨å®¢æˆ·ç«¯-æœåŠ¡å™¨æ¶æ„ï¼Œæ ¸å¿ƒç»„ä»¶åŒ…æ‹¬ Docker Engineï¼ˆè´Ÿè´£æ„å»ºå’Œè¿è¡Œå®¹å™¨ï¼‰ã€Dockerfileï¼ˆå®šä¹‰æ„å»ºé•œåƒçš„æŒ‡ä»¤ï¼‰ã€é•œåƒï¼ˆåº”ç”¨å’Œä¾èµ–çš„åªè¯»æ¨¡æ¿ï¼‰å’Œå®¹å™¨ï¼ˆåŸºäºé•œåƒè¿è¡Œçš„å®ä¾‹ï¼‰ã€‚å¼€å‘è€…å¯ä»¥é€šè¿‡ Docker Hub å…±äº«æˆ–ä¸‹è½½é•œåƒï¼Œæå¤§ç®€åŒ–äº†éƒ¨ç½²æµç¨‹ã€‚ æ€»ç»“æ¥è¯´ï¼ŒDocker æé«˜äº†å¼€å‘æ•ˆç‡ï¼Œæ”¯æŒæŒç»­é›†æˆä¸éƒ¨ç½²ï¼ˆCI/CDï¼‰ï¼Œåœ¨å¾®æœåŠ¡æ¶æ„ä¸­å°¤ä¸ºå¸¸ç”¨ï¼Œæ˜¯ç°ä»£ DevOps æµç¨‹çš„é‡è¦å·¥å…·ã€‚ Dockeræ˜¯ä»€ä¹ˆï¼Ÿ åç§° æè¿° Docker ä»“åº“ï¼ˆRegistryï¼‰ Dockerä»“åº“ç”¨äºå­˜å‚¨Dockeré•œåƒã€‚Docker Hubæ˜¯ä¸€ä¸ªä»»ä½•äººéƒ½å¯ä»¥ä½¿ç”¨çš„å…¬å…±ä»“åº“ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼ŒDockeråœ¨Docker Hubä¸ŠæŸ¥æ‰¾å›¾åƒã€‚ä½ ä¹Ÿå¯ä»¥é…ç½®è‡ªå·±çš„ç§äººä»“åº“ã€‚å½“æ‚¨ä½¿ç”¨docker pullæˆ–docker runå‘½ä»¤æ—¶ï¼ŒDockerä¼šä»æ‚¨é…ç½®çš„ä»“åº“ä¸­æå–æ‰€éœ€çš„é•œåƒã€‚å½“æ‚¨ä½¿ç”¨docker pushå‘½ä»¤æ—¶ï¼ŒDockerä¼šå°†æ‚¨çš„é•œåƒæ¨é€åˆ°å·²é…ç½®çš„ä»“åº“ä¸­ã€‚ Docker å®ˆæŠ¤è¿›ç¨‹ï¼ˆDaemonï¼‰ ç›‘å¬Docker APIè¯·æ±‚ï¼Œå¹¶ç®¡ç†Dockerå¯¹è±¡ï¼Œå¦‚é•œåƒã€å®¹å™¨ã€ç½‘ç»œå’Œå·ã€‚å®ˆæŠ¤ç¨‹åºè¿˜å¯ä»¥ä¸å…¶ä»–å®ˆæŠ¤ç¨‹åºé€šä¿¡æ¥ç®¡ç†DockeræœåŠ¡ã€‚ Docker å®¢æˆ·ç«¯ï¼ˆClientï¼‰ Docker å®¢æˆ·ç«¯ï¼ˆdockerï¼‰æ˜¯è®¸å¤šç”¨æˆ·ä¸ Docker äº¤äº’çš„ä¸»è¦æ–¹å¼ã€‚å½“ä½ ä½¿ç”¨å¦‚ docker run è¿™æ ·çš„å‘½ä»¤æ—¶ï¼Œå®¢æˆ·ç«¯ä¼šå°†è¿™äº›å‘½ä»¤å‘é€ç»™ dockerdï¼ˆDocker å®ˆæŠ¤è¿›ç¨‹ï¼‰ï¼Œç”±å®ƒæ¥æ‰§è¡Œè¿™äº›æ“ä½œã€‚docker å‘½ä»¤æ˜¯é€šè¿‡ Docker API è¿›è¡Œé€šä¿¡çš„ã€‚Docker å®¢æˆ·ç«¯å¯ä»¥ä¸å¤šä¸ªå®ˆæŠ¤è¿›ç¨‹è¿›è¡Œé€šä¿¡ã€‚ Docker ä¸»æœºï¼ˆHostï¼‰ è¿è¡Œ Docker å®ˆæŠ¤è¿›ç¨‹å’Œå®¹å™¨çš„ç‰©ç†æˆ–è™šæ‹Ÿæœºå™¨ã€‚ Docker é•œåƒï¼ˆImagesï¼‰ åˆ›å»ºå®¹å™¨çš„åªè¯»æ¨¡æ¿ï¼ŒåŒ…å«è¿è¡Œåº”ç”¨æ‰€éœ€çš„æ‰€æœ‰æ–‡ä»¶å’Œé…ç½®ã€‚ Docker å®¹å™¨ï¼ˆContainerï¼‰ åŸºäºé•œåƒè¿è¡Œçš„å®ä¾‹ï¼Œæ˜¯ä¸€ä¸ªæˆ–å¤šä¸ªåº”ç”¨çš„ç‹¬ç«‹è¿è¡Œç¯å¢ƒã€‚ Docker å®‰è£… å…¨æ–°å®‰è£…å‰éœ€è¦å…ˆå¸è½½æ—§ç‰ˆæœ¬ï¼Œå¸è½½dockerä¹Ÿå¯ä»¥æŒ‰ç…§å¦‚ä¸‹æ–¹å¼æ“ä½œ 123456789101112131415161718192021222324252627# åˆ é™¤Dockerç›¸å…³æºsudo rm -f /etc/yum.repos.d/docker*.repo# åˆ é™¤Dockerç›¸å…³è½¯ä»¶åŒ…ï¼Œdnfå¯èƒ½ä¼šæŠ¥å‘Šæ‚¨æ²¡æœ‰å®‰è£…è¿™äº›è½¯ä»¶åŒ…ã€‚# å¸è½½dockeræ—§ç‰ˆæœ¬sudo dnf -y remove \\ docker \\ docker-client \\ docker-client-latest \\ docker-common \\ docker-latest \\ docker-latest-logrotate \\ docker-logrotate \\ docker-engine# å¸è½½dockeræ–°ç‰ˆæœ¬sudo dnf -y remove \\ docker-ce \\ containerd.io \\ docker-ce-rootless-extras \\ docker-buildx-plugin \\ docker-ce-cli \\ docker-compose-plugin# åˆ é™¤Dockeræ•°æ®,é•œåƒã€å®¹å™¨ã€å·å’Œç½‘ç»œsudo rm -rf /var/lib/dockersudo rm -rf /var/lib/containerd# åˆ é™¤Dockeré…ç½®sudo rm -rf /etc/docker/ è®¾ç½®dockerå­˜å‚¨åº“ 12345sudo dnf -y install dnf-plugins-core# æµ·å¤–ï¼Œæ·»åŠ Dockerçš„å®˜æ–¹å­˜å‚¨åº“sudo dnf config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo# å›½å†…ï¼Œæ·»åŠ é˜¿é‡Œäº‘çš„å­˜å‚¨åº“sudo dnf config-manager --add-repo https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo å®‰è£… Docker 123456789101112131415161718# å®‰è£…æœ€æ–°ç‰ˆæœ¬ï¼Œå‡çº§ docker æ—¶ä¹Ÿæ˜¯æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤sudo dnf -y install docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin# å®‰è£…æŒ‡å®šç‰ˆæœ¬# å…ˆæŸ¥çœ‹æ‰€æœ‰ç‰ˆæœ¬sudo dnf list docker-ce --showduplicates | sort -r## è¾“å‡ºdocker-ce.x86_64 3:26.1.3-1.el8 docker-ce-stabledocker-ce.x86_64 3:26.1.3-1.el8 @docker-ce-stabledocker-ce.x86_64 3:26.1.2-1.el8 docker-ce-stabledocker-ce.x86_64 3:26.1.1-1.el8 docker-ce-stabledocker-ce.x86_64 3:26.1.0-1.el8 docker-ce-stableâ€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦# å®‰è£…æŒ‡å®šç‰ˆæœ¬ï¼Œè¿™é‡Œ VERSION_STRING ä¸ºç‰ˆæœ¬å·ï¼Œä¾‹å¦‚ 3:26.1.3-1.el8sudo dnf install docker-ce-&lt;VERSION_STRING&gt; docker-ce-cli-&lt;VERSION_STRING&gt; containerd.io docker-buildx-plugin docker-compose-plugin -y## æ¯”å¦‚sudo dnf install docker-ce-3:26.1.3-1.el8 docker-ce-cli-3:26.1.3-1.el8 containerd.io docker-buildx-plugin docker-compose-plugin -y å¯åŠ¨ Docker 1234# è®¾ç½®Dockerå®ˆæŠ¤è¿›ç¨‹åœ¨ç³»ç»Ÿå¯åŠ¨æ—¶è‡ªåŠ¨å¯åŠ¨sudo systemctl enable docker# å¯åŠ¨Dockersudo systemctl start docker æ·»åŠ å½“å‰ç”¨æˆ·åˆ°dockerç»„ 12345# æ·»åŠ å½“å‰ç”¨æˆ·åˆ°dockerç»„ï¼Œè¿™æ ·å½“å‰ç”¨æˆ·å°±å¯ä»¥ä¸éœ€è¦ä½¿ç”¨sudoå°±èƒ½ä½¿ç”¨dockerå‘½ä»¤# å½“å‰ç”¨æˆ·æ˜¯centossudo usermod -aG docker centos# è®©ç»„æƒé™ç«‹å³ç”Ÿæ•ˆæœ€ç¨³å¦¥çš„åšæ³•æ˜¯ï¼šæ³¨é”€å¹¶é‡æ–°ç™»å½•è¿œç¨‹ä¸»æœºï¼Œä½†ä¹Ÿå¯ä»¥å°è¯•ç”¨ä¸‹é¢å‘½ä»¤ç«‹å³åŠ è½½æ–°ç»„newgrp docker éªŒè¯ Docker å®‰è£… 12345docker version # æŸ¥çœ‹ Docker version# æ˜¾ç¤º Docker åŸºæœ¬ä¿¡æ¯ï¼ŒåŒ…æ‹¬ç‰ˆæœ¬ä¿¡æ¯ï¼Œæ’ä»¶ä¿¡æ¯ï¼Œé•œåƒåŠ é€Ÿä¿¡æ¯ç­‰ç­‰ã€‚docker info# æ‹‰å–hello-worldé•œåƒï¼Œæ­¤æ—¶å›½å†…ä¼šæç¤ºè®¿é—®å¤±è´¥ï¼Œéœ€è¦æ·»åŠ å›½å†…é•œåƒæºdocker pull hello-world æ·»åŠ å›½å†…é•œåƒæº ç›®å‰å›½å†…å¤§éƒ¨åˆ†çš„Dockeré•œåƒæºéƒ½å…³é—­äº†ï¼Œå¦å¤–é˜¿é‡Œäº‘çš„Dockeré•œåƒæºåªå…è®¸åœ¨é˜¿é‡Œäº‘çš„æœºå™¨ä¸Šä½¿ç”¨ã€‚ å‚è€ƒï¼šDocker/DockerHub å›½å†…é•œåƒæº/åŠ é€Ÿåˆ—è¡¨,å›½å†… Docker æœåŠ¡çŠ¶æ€ &amp; é•œåƒåŠ é€Ÿç›‘æ§ æ³¨æ„ï¼šå›½å†…é•œåƒæºçš„æ›´æ–°ä¼šæ¯”å®˜ç½‘æ»åï¼Œä½†åªè¦ä¸æ˜¯è·å–æœ€æ–°ç‰ˆæœ¬åŸºæœ¬ä¸Šæ˜¯å¤Ÿç”¨çš„ã€‚ 123456789101112131415161718sudo tee /etc/docker/daemon.json &lt;&lt;EOF&#123; &quot;registry-mirrors&quot;: [ &quot;https://docker.1ms.run&quot;, &quot;https://docker.xuanyuan.me&quot;, &quot;https://docker.m.daocloud.io&quot; ]&#125;EOF# é‡å¯Dockersudo systemctl daemon-reloadsudo systemctl restart docker# å¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹æ˜¯å¦é…ç½®ç”Ÿæ•ˆï¼ŒæŸ¥çœ‹ Registry Mirrors ä¸­çš„é…ç½®docker info# éªŒè¯å›½å†…é•œåƒæºdocker pull hello-world Dockerå‘½ä»¤è‡ªåŠ¨è¡¥å…¨ï¼Œå‚è€ƒï¼šå®˜æ–¹æ–‡æ¡£ 1234567891011121314151617181920# ä½¿ç”¨çš„bash# å®‰è£…bash-completionsudo dnf install bash-completion -y# æ·»åŠ è‡ªåŠ¨è¡¥å…¨åˆ°å½“å‰ç™»å½•ç”¨æˆ·cat &lt;&lt;EOT &gt;&gt; ~/.bashrcif [ -f /etc/bash_completion ]; then . /etc/bash_completionfiEOT# åˆ·æ–°bashsource ~/.bashrc# åˆ›å»ºè‡ªåŠ¨è¡¥å…¨æ–‡ä»¶mkdir -p ~/.local/share/bash-completion/completionsdocker completion bash &gt; ~/.local/share/bash-completion/completions/docker# å¯åŠ¨ä¸€ä¸ªæ–°çš„bashexec bash /var/lib/docker ç”¨äºå­˜å‚¨ Docker è¿è¡Œæ—¶ç”Ÿæˆçš„æ•°æ®ï¼Œå¦‚é•œåƒã€å®¹å™¨ã€ç½‘ç»œã€å·ã€é…ç½®æ–‡ä»¶ã€æ—¥å¿—ç­‰ï¼Œå…¶ç›®å½•ç»“æ„è¯´æ˜å¦‚ä¸‹ï¼š ç›®å½•å ä½œç”¨è¯´æ˜ buildkit/ å­˜æ”¾ Docker BuildKit æ„å»ºç¼“å­˜å’ŒçŠ¶æ€ä¿¡æ¯ï¼›æ„å»ºé•œåƒæ—¶çš„ä¸­é—´æ–‡ä»¶å’Œä¸Šä¸‹æ–‡ä¼šå­˜äºæ­¤ï¼Œç©ºé—´å ç”¨å¯èƒ½è¾ƒå¤§ã€‚ containers/ æ¯ä¸ªå®¹å™¨ä¸€ä¸ªå­ç›®å½•ï¼ŒåŒ…å«é…ç½®æ–‡ä»¶å’Œè¿è¡Œæ—¥å¿—ï¼ˆå¦‚ container.logï¼‰ï¼Œç”¨äºå®¹å™¨çš„è¿è¡ŒçŠ¶æ€è®°å½•å’Œç®¡ç†ã€‚ engine-id å­˜å‚¨ Docker å¼•æ“çš„å”¯ä¸€ IDï¼ŒDocker å®‰è£…æ—¶ç”Ÿæˆï¼Œå¸¸ç”¨äº swarm èŠ‚ç‚¹è¯†åˆ«ã€‚ image/ é•œåƒçš„å…ƒæ•°æ®ï¼ˆä¸å«å®é™… layer æ•°æ®ï¼‰ï¼Œç»„ç»‡é•œåƒçš„ç»“æ„ã€æ ‡ç­¾ã€é©±åŠ¨ç­‰ä¿¡æ¯ã€‚ network/ ç½‘ç»œé…ç½®åŠçŠ¶æ€ä¿¡æ¯ï¼Œå¦‚é»˜è®¤ bridge ç½‘ç»œã€è‡ªå®šä¹‰ç½‘ç»œé…ç½®ç­‰ã€‚ overlay2/ é•œåƒå’Œå®¹å™¨å®é™…çš„æ•°æ®å±‚ï¼ˆoverlay2 æ˜¯å­˜å‚¨é©±åŠ¨ï¼‰ï¼ŒåŒ…å«æ‰€æœ‰è”åˆæ–‡ä»¶ç³»ç»Ÿå±‚ï¼Œæ˜¯ Docker ä¸­æœ€å¤§çš„ç©ºé—´ä½¿ç”¨è€…ã€‚ plugins/ å­˜æ”¾ Docker æ’ä»¶ï¼ˆå¦‚ç½‘ç»œã€å·æ’ä»¶ï¼‰çš„é…ç½®å’Œæ•°æ®ï¼Œä¸€èˆ¬ä¸ºç©ºï¼Œé™¤éä½¿ç”¨äº†æ‰©å±•æ’ä»¶ã€‚ runtimes/ æ”¯æŒçš„ OCI runtime é…ç½®ç›®å½•ï¼Œå¦‚é»˜è®¤çš„ runcï¼Œä¹Ÿå¯èƒ½åŒ…å«å…¶ä»– runtimeï¼ˆå¦‚ kata, gvisorï¼‰ã€‚ swarm/ Docker swarm æ¨¡å¼ä¸‹çš„é›†ç¾¤å…ƒæ•°æ®ä¸èŠ‚ç‚¹çŠ¶æ€ï¼Œä»…åœ¨åˆå§‹åŒ– swarm åå­˜åœ¨å®é™…æ•°æ®ã€‚ tmp/ Docker çš„ä¸´æ—¶æ–‡ä»¶ç›®å½•ï¼Œå¦‚é•œåƒä¸‹è½½ç¼“å­˜ã€æŒ‚è½½æ“ä½œä¸­çš„ä¸´æ—¶æ–‡ä»¶ï¼Œé€šå¸¸å¯ä»¥æ¸…ç†ä½†éœ€å°å¿ƒã€‚ volumes/ Docker å·çš„æ•°æ®ç›®å½•ï¼Œæ¯ä¸ªå·ä¸€ä¸ªå­ç›®å½•ï¼Œå·ä¸­çš„æŒä¹…åŒ–æ•°æ®å®é™…å­˜æ”¾äºæ­¤ã€‚ /var/lib/containerd æ˜¯ Containerd å®ˆæŠ¤è¿›ç¨‹çš„é»˜è®¤æ•°æ®å­˜å‚¨ç›®å½•ã€‚Containerd æ˜¯ Docker å’Œå…¶ä»–å®¹å™¨å¹³å°ï¼ˆå¦‚ Kubernetesï¼‰åº•å±‚çš„ å®¹å™¨è¿è¡Œæ—¶ï¼ˆContainer Runtimeï¼‰ï¼Œè´Ÿè´£æ‹‰å–é•œåƒã€ç®¡ç†å®¹å™¨ç”Ÿå‘½å‘¨æœŸã€æŒ‚è½½æ–‡ä»¶ç³»ç»Ÿç­‰æ“ä½œã€‚å…¶ç›®å½•ç»“æ„è¯´æ˜å¦‚ä¸‹ï¼š ç›®å½•å ä½œç”¨è¯´æ˜ io.containerd.content.v1.content/ å­˜å‚¨é•œåƒ layer çš„å®é™…äºŒè¿›åˆ¶å†…å®¹ï¼ˆblobï¼‰ï¼Œéµå¾ª OCI é•œåƒè§„èŒƒï¼Œæ˜¯é•œåƒå’Œå®¹å™¨æ–‡ä»¶ç³»ç»Ÿçš„æ•°æ®æ¥æºã€‚ io.containerd.metadata.v1.bolt/ ä½¿ç”¨ BoltDB å­˜å‚¨ containerd çš„å…ƒæ•°æ®ï¼ˆå¦‚é•œåƒä¿¡æ¯ã€å®¹å™¨çŠ¶æ€ã€å¿«ç…§å¼•ç”¨ç­‰ï¼‰ï¼Œæ˜¯ containerd çš„æ ¸å¿ƒå…ƒæ•°æ®æ•°æ®åº“ã€‚ io.containerd.runtime.v1.linux/ å­˜å‚¨æ—§ç‰ˆï¼ˆv1 APIï¼‰è¿è¡Œæ—¶å®¹å™¨ä¿¡æ¯ï¼Œç›®å‰å·²é€æ­¥è¢« v2 æ¥å£å–ä»£ï¼Œä»…åœ¨å‘åå…¼å®¹åœºæ™¯ä¸­å­˜åœ¨ã€‚ io.containerd.runtime.v2.task/ å­˜å‚¨ v2 è¿è¡Œæ—¶æ¥å£ä¸‹å®¹å™¨çš„è¿è¡Œæ—¶çŠ¶æ€ï¼Œå¦‚å®¹å™¨è¿›ç¨‹çš„ shimã€PIDã€æ—¥å¿—è·¯å¾„ç­‰ï¼Œæ˜¯å®¹å™¨å®é™…è¿è¡Œæ—¶æ‰€ä¾èµ–çš„ã€‚ io.containerd.snapshotter.v1.native/ ä½¿ç”¨ native æ¨¡å¼å­˜å‚¨çš„å®¹å™¨å¿«ç…§ï¼ˆæ–‡ä»¶ç³»ç»Ÿå±‚ï¼‰ï¼Œç›´æ¥å¤åˆ¶åº•å±‚æ–‡ä»¶ï¼›æ€§èƒ½è¾ƒå·®ï¼Œå ç”¨ç©ºé—´è¾ƒå¤§ï¼Œä¸»è¦ç”¨äºæµ‹è¯•æˆ–ç‰¹å®šç”¨é€”ã€‚ io.containerd.snapshotter.v1.overlayfs/ ä½¿ç”¨ overlayfs æ¨¡å¼å­˜å‚¨å®¹å™¨çš„æ–‡ä»¶ç³»ç»Ÿå¿«ç…§ï¼ˆé•œåƒå±‚å’Œå®¹å™¨å±‚ï¼‰ï¼›è¿™æ˜¯ç”Ÿäº§ç¯å¢ƒé»˜è®¤çš„é«˜æ•ˆå­˜å‚¨é©±åŠ¨ã€‚ tmpmounts/ ä¸´æ—¶æŒ‚è½½ç‚¹ç›®å½•ï¼Œcontainerd ç”¨äºé•œåƒè§£åŒ…ã€ä¸­é—´æ„å»ºè¿‡ç¨‹ä¸­çš„æŒ‚è½½æ“ä½œï¼Œé€šå¸¸æ˜¯æ„å»ºæˆ–è¿è¡Œè¿‡ç¨‹çš„ä¸´æ—¶æ•°æ®ã€‚ MacOS/Windowsä¸‹æ— æ³•æŸ¥çœ‹/var/lib/dockerçš„è§£å†³æ–¹æ³• åœ¨ MacOS/Windows ä¸Šä½¿ç”¨Dockeræ—¶ï¼Œæ˜¯å¯åŠ¨äº†ä¸€ä¸ªè™šæ‹Ÿæœºæ¥è¿è¡Œdockerçš„ï¼Œç”±äºå…¶è¿è¡Œåœ¨è™šæ‹Ÿæœºå†…éƒ¨ï¼Œç›´æ¥æŸ¥æ‰¾/var/lib/dockerè·¯å¾„æ˜¯æ— æ•ˆçš„ã€‚ è§£å†³æ–¹æ³•å¦‚ä¸‹ï¼š 12345678910111213141516171819202122232425262728# å¯åŠ¨ä¸€ä¸ªä¸´æ—¶å®¹å™¨ï¼Œå¹¶è¿›å…¥å…¶å†…éƒ¨docker run --rm -it --privileged --pid=host debian nsenter -t 1 -m -u -n -i sh## è¯´æ˜--it äº¤äº’å¼åœ°è¿è¡Œå®¹å™¨,å¹¶åˆ†é…ä¸€ä¸ªä¼ªç»ˆç«¯--rm é€€å‡ºå®¹å™¨æ—¶ï¼Œè‡ªåŠ¨åˆ é™¤å®¹å™¨--privileged ç»™å®¹å™¨ç‰¹æƒæƒé™ï¼Œè¿™æ„å‘³ç€å®¹å™¨å‡ ä¹æ‹¥æœ‰å®¿ä¸»æœºçš„æ‰€æœ‰èƒ½åŠ›ï¼Œèƒ½è®¿é—® /devã€ä¿®æ”¹å†…æ ¸å‚æ•°ç­‰ã€‚éå¸¸å¼ºå¤§ä½†ä¹Ÿå¾ˆå±é™©ã€‚--pid=host å®¹å™¨å…±äº«å®¿ä¸»æœºçš„è¿›ç¨‹å‘½åç©ºé—´ï¼ˆPID Namespaceï¼‰ã€‚ è¿™ä½¿å¾—å®¹å™¨å¯ä»¥çœ‹åˆ°å¹¶è®¿é—®å®¿ä¸»æœºçš„æ‰€æœ‰è¿›ç¨‹ï¼ˆåŒ…æ‹¬ PID 1ï¼Œå³ç³»ç»Ÿ init è¿›ç¨‹ï¼‰ã€‚debian ä½¿ç”¨çš„åŸºç¡€é•œåƒæ˜¯ Debianï¼Œå®¹å™¨é‡Œè¿è¡Œçš„æ˜¯è¿™ä¸ªç³»ç»Ÿã€‚nsenter -t 1 -m -u -n -i sh è¿™æ˜¯å®¹å™¨å†…éƒ¨è¿è¡Œçš„å‘½ä»¤ï¼Œç”¨æ¥è¿›å…¥å®¿ä¸»æœºçš„å‘½åç©ºé—´ï¼š nsenterï¼šLinux å·¥å…·ï¼Œç”¨äºè¿›å…¥å…¶ä»–è¿›ç¨‹çš„å‘½åç©ºé—´ã€‚ -t 1ï¼šæŒ‡å®šç›®æ ‡è¿›ç¨‹çš„ PID æ˜¯ 1ï¼ˆå®¿ä¸»æœºçš„ init æˆ– systemdï¼‰ã€‚ -mï¼šè¿›å…¥ç›®æ ‡è¿›ç¨‹çš„ Mount Namespaceï¼ˆæ–‡ä»¶ç³»ç»ŸæŒ‚è½½ï¼‰ã€‚ -uï¼šè¿›å…¥ç›®æ ‡çš„ UTS Namespaceï¼ˆä¸»æœºåç­‰ï¼‰ã€‚ -nï¼šè¿›å…¥ç›®æ ‡çš„ Network Namespaceï¼ˆç½‘ç»œï¼‰ã€‚ -iï¼šè¿›å…¥ç›®æ ‡çš„ IPC Namespaceï¼ˆè¿›ç¨‹é—´é€šä¿¡ï¼‰ã€‚ shï¼šåœ¨è¿™äº›å‘½åç©ºé—´ä¸­æ‰§è¡Œä¸€ä¸ª shellã€‚ è¿™ä¸ªå‘½ä»¤å¯åŠ¨ä¸€ä¸ªåŸºäº Debian çš„å®¹å™¨ï¼Œç»™å®ƒæ‰€æœ‰ç‰¹æƒï¼Œè®©å®ƒèƒ½çœ‹åˆ°å®¿ä¸»æœºçš„è¿›ç¨‹ï¼Œç„¶åä½¿ç”¨ nsenter è¿›å…¥ PID ä¸º 1 çš„æ‰€æœ‰å‘½åç©ºé—´ï¼ˆç›¸å½“äºè¿›å…¥å®¿ä¸»æœºçš„è§†è§’ï¼‰ï¼Œæœ€åå¯åŠ¨ä¸€ä¸ª shï¼Œä½ å°±åœ¨å®¹å™¨é‡Œ â€œå˜æˆäº†å®¿ä¸»æœºâ€ã€‚ è¿™æ ·ï¼Œä½ å°±å¯ä»¥åœ¨è¿™ä¸ªå®¹å™¨ä¸­æŸ¥çœ‹/var/lib/dockerç›®å½•äº†ã€‚","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» Linux ä¸‹çš„ Docker å®‰è£…æ–¹æ³•ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚ windowsã€macosã€ubuntuç­‰æ¡Œé¢ç³»ç»Ÿè¯·å®‰è£… Docker Desktopã€‚ é˜¿é‡Œäº‘ä¸“æœ‰æœåŠ¡å™¨å‚è€ƒï¼šé˜¿é‡Œäº‘ä¸“æœ‰æœåŠ¡å™¨å¦‚ä½•å®‰è£…Docker è…¾è®¯äº‘ä¸“æœ‰æœåŠ¡å™¨å‚è€ƒï¼šè…¾è®¯äº‘ä¸“æœ‰æœåŠ¡å™¨å¦‚ä½•å®‰è£…Docker AWSä¸“æœ‰æœåŠ¡å™¨å‚è€ƒï¼šAWSä¸“æœ‰æœåŠ¡å™¨å¦‚ä½•å®‰è£…Docker Dockerå®˜æ–¹æ–‡æ¡£ å®‰è£…Docker Engine","date_published":"2025-05-20T13:30:05.000Z","tags":["æŠ€æœ¯","docker","docker"]},{"id":"https://blog.hanqunfeng.com/2025/05/19/docker-install-aws/","url":"https://blog.hanqunfeng.com/2025/05/19/docker-install-aws/","title":"AWSä¸“æœ‰æœåŠ¡å™¨å¦‚ä½•å®‰è£…Docker","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç»å¦‚ä½•åœ¨ AWS ä¸“æœ‰æœåŠ¡å™¨ä¸Šå®‰è£… Docker</p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Update and install Docker</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> yum update -y</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Amazon Linux 2</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> amazon-linux-extras install docker -y</span><br><span class=\"line\"><span class=\"comment\"># Amazon Linux 2023</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> yum install docker -y</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Install Docker Composeï¼Œæ³¨æ„é€šè¿‡è¿™ç§æ–¹å¼å®‰è£…çš„composeçš„ä½¿ç”¨æ–¹å¼ä¸º `docker-compose`ï¼Œè€Œéæ ‡å‡†çš„ `docker compose`</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> curl -L <span class=\"string\">&quot;https://github.com/docker/compose/releases/latest/download/docker-compose-<span class=\"subst\">$(uname -s)</span>-<span class=\"subst\">$(uname -m)</span>&quot;</span> -o /usr/local/bin/docker-compose</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Make the docker-compose command available</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> <span class=\"built_in\">chmod</span> +x /usr/local/bin/docker-compose</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Enable Docker service</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> systemctl <span class=\"built_in\">enable</span> docker</span><br><span class=\"line\"><span class=\"comment\"># Start the service</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> systemctl start docker</span><br><span class=\"line\"><span class=\"comment\"># Add the current user to the docker group</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> usermod -aG docker ec2-user</span><br><span class=\"line\"><span class=\"comment\"># è®©ç»„æƒé™ç«‹å³ç”Ÿæ•ˆæœ€ç¨³å¦¥çš„åšæ³•æ˜¯ï¼šæ³¨é”€å¹¶é‡æ–°ç™»å½•è¿œç¨‹ä¸»æœºï¼Œä½†ä¹Ÿå¯ä»¥å°è¯•ç”¨ä¸‹é¢å‘½ä»¤ç«‹å³åŠ è½½æ–°ç»„</span></span><br><span class=\"line\">newgrp docker</span><br><span class=\"line\"><span class=\"comment\"># Check Docker version</span></span><br><span class=\"line\">docker version</span><br><span class=\"line\"><span class=\"comment\"># Test Docker</span></span><br><span class=\"line\">docker run hello-world</span><br></pre></td></tr></table></figure>","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç»å¦‚ä½•åœ¨ AWS ä¸“æœ‰æœåŠ¡å™¨ä¸Šå®‰è£… Docker 12345678910111213141516171819202122232425262728# Update and install Dockersudo yum update -y# Amazon Linux 2sudo amazon-linux-extras install docker -y# Amazon Linux 2023sudo yum install docker -y# Install Docker Composeï¼Œæ³¨æ„é€šè¿‡è¿™ç§æ–¹å¼å®‰è£…çš„composeçš„ä½¿ç”¨æ–¹å¼ä¸º `docker-compose`ï¼Œè€Œéæ ‡å‡†çš„ `docker compose`sudo curl -L &quot;https://github.com/docker/compose/releases/latest/download/docker-compose-$(uname -s)-$(uname -m)&quot; -o /usr/local/bin/docker-compose# Make the docker-compose command availablesudo chmod +x /usr/local/bin/docker-compose# Enable Docker servicesudo systemctl enable docker# Start the servicesudo systemctl start docker# Add the current user to the docker groupsudo usermod -aG docker ec2-user# è®©ç»„æƒé™ç«‹å³ç”Ÿæ•ˆæœ€ç¨³å¦¥çš„åšæ³•æ˜¯ï¼šæ³¨é”€å¹¶é‡æ–°ç™»å½•è¿œç¨‹ä¸»æœºï¼Œä½†ä¹Ÿå¯ä»¥å°è¯•ç”¨ä¸‹é¢å‘½ä»¤ç«‹å³åŠ è½½æ–°ç»„newgrp docker# Check Docker versiondocker version# Test Dockerdocker run hello-world","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç»å¦‚ä½•åœ¨ AWS ä¸“æœ‰æœåŠ¡å™¨ä¸Šå®‰è£… Docker","date_published":"2025-05-19T13:30:05.000Z","tags":["æŠ€æœ¯","docker","docker"]},{"id":"https://blog.hanqunfeng.com/2025/05/13/jvm-tools-01/","url":"https://blog.hanqunfeng.com/2025/05/13/jvm-tools-01/","title":"JVM ä¹‹ å‘½ä»¤è¡Œå·¥å…·","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç»JVMçš„å‘½ä»¤è¡Œå·¥å…·</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://docs.oracle.com/javase/specs/jvms/se8/html/index.html\">JDK8 The JavaÂ® Virtual Machine Specification</a></p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://docs.oracle.com/javase/8/docs/technotes/tools/unix/java.html\">JDK8çš„javaæŒ‡ä»¤çš„å®˜â½…â½‚æ¡£</a></p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://docs.oracle.com/en/java/javase/17/docs/specs/man/index.html\">JDKâ¼¯å…·å®˜â½¹â½‚æ¡£</a></p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://docs.oracle.com/en/java/javase/17/docs/specs/man/java.html\">JDK17çš„javaæŒ‡ä»¤çš„å®˜â½…â½‚æ¡£</a></p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"JVM-çš„å‚æ•°-ä¸‰ç±»\">JVM çš„å‚æ•°(ä¸‰ç±»)</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ ‡å‡†å‚æ•°: ä»¥<code>-</code>å¼€å¤´ï¼Œæ‰€æœ‰ HotSpot éƒ½â½€æŒã€‚ä¾‹å¦‚<code>java -version</code>ã€‚è¿™ç±»å‚æ•°å¯ä»¥ä½¿â½¤<code>java -help</code> æˆ–è€…<code>java -?</code>å…¨éƒ¨æ‰“å°å‡ºæ¥</p>\n</li>\n<li class=\"lvl-2\">\n<p>â¾®æ ‡å‡†å‚æ•°: ä»¥<code>-X</code>å¼€å¤´ï¼Œæ˜¯ç‰¹å®š HotSpotç‰ˆæœ¬â½€æŒçš„æŒ‡ä»¤ã€‚ä¾‹å¦‚<code>java -Xms200M -Xmx200M</code>ã€‚è¿™ç±»æŒ‡ä»¤å¯ä»¥â½¤<code>java -X</code> å…¨éƒ¨æ‰“å°å‡ºæ¥ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä¸ç¨³å®šå‚æ•°: è¿™ä¹Ÿæ˜¯ JVMè°ƒä¼˜çš„å™©æ¢¦ã€‚ä»¥<code>-XX</code> å¼€å¤´ï¼Œè¿™äº›å‚æ•°æ˜¯è·Ÿç‰¹å®šHotSpotç‰ˆæœ¬å¯¹åº”çš„ï¼Œå¾ˆæœ‰å¯èƒ½æ¢ä¸ªç‰ˆæœ¬å°±æ²¡æœ‰äº†ã€‚è¯¦ç»†çš„â½‚æ¡£èµ„æ–™ä¹Ÿç‰¹åˆ«å°‘ã€‚JDK8 ä¸­çš„ä»¥ä¸‹â¼ä¸ªæŒ‡ä»¤å¯ä»¥å¸®åŠ©å¼€å‘è€…äº†è§£ JDK8 ä¸­çš„è¿™â¼€ç±»ä¸ç¨³å®šå‚æ•°ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">java -XX:+PrintFlagsInitial -version   <span class=\"comment\"># æ‰€æœ‰å‚æ•°çš„é»˜è®¤å€¼</span></span><br><span class=\"line\">java -XX:+PrintFlagsFinal -version      <span class=\"comment\"># æ‰€æœ‰å‚æ•°æœ€ç»ˆâ½£æ•ˆçš„å€¼ã€‚</span></span><br><span class=\"line\">java -XX:+UnlockExperimentalVMOptions -XX:+PrintFlagsFinal -version      <span class=\"comment\"># æ‰€æœ‰å‚æ•°æœ€ç»ˆâ½£æ•ˆçš„å€¼ï¼ŒåŒ…å«å®éªŒæ€§å‚æ•°ã€‚</span></span><br><span class=\"line\">java -XX:+PrintCommandLineFlags -version <span class=\"comment\"># å½“å‰å‘½ä»¤ç”Ÿæ•ˆçš„å€¼ï¼Œå¯ä»¥çœ‹åˆ°æ˜¯â½¤çš„å“ªç§GCã€‚ JDK1.8é»˜è®¤â½¤çš„ParallelGC</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"è¿è¡Œ-java-XX-UnlockExperimentalVMOptions-XX-PrintFlagsFinal-version-è¿”å›å€¼è¯´æ˜\">è¿è¡Œ <code>java -XX:+UnlockExperimentalVMOptions -XX:+PrintFlagsFinal -version</code> è¿”å›å€¼è¯´æ˜</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[Global flags]</span><br><span class=\"line\">     intx ActiveProcessorCount                      = -1                                  &#123;product&#125;</span><br><span class=\"line\">    uintx AdaptiveSizeDecrementScaleFactor          = 4                                   &#123;product&#125;</span><br><span class=\"line\">    uintx AdaptiveSizeMajorGCDecayTimeScale         = 10                                  &#123;product&#125;</span><br><span class=\"line\">    uintx AdaptiveSizePausePolicy                   = 0                                   &#123;product&#125;</span><br><span class=\"line\">    uintx AdaptiveSizePolicyCollectionCostMargin    = 50                                  &#123;product&#125;</span><br><span class=\"line\">    uintx AdaptiveSizePolicyInitializingSteps       = 20                                  &#123;product&#125;</span><br><span class=\"line\">    uintx AdaptiveSizePolicyOutputInterval          = 0                                   &#123;product&#125;</span><br><span class=\"line\">    uintx AdaptiveSizePolicyWeight                  = 10                                  &#123;product&#125;</span><br><span class=\"line\">    uintx AdaptiveSizeThroughPutPolicy              = 0                                   &#123;product&#125;</span><br><span class=\"line\">    uintx AdaptiveTimeWeight                        = 25                                  &#123;product&#125;</span><br><span class=\"line\">     bool AdjustConcurrency                         = <span class=\"literal\">false</span>                               &#123;product&#125;</span><br><span class=\"line\">     bool AggressiveHeap                            = <span class=\"literal\">false</span>                               &#123;product&#125;</span><br><span class=\"line\">     bool AggressiveOpts                            = <span class=\"literal\">false</span>                               &#123;product&#125;</span><br><span class=\"line\">     intx AliasLevel                                = 3                                   &#123;C2 product&#125;</span><br><span class=\"line\">     â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦</span><br><span class=\"line\"><span class=\"comment\"># æ ¼å¼ï¼šflagç±»å‹ï¼Œflagåç§°ï¼Œflagå€¼ï¼Œflagæ¥æºä¸ä½œç”¨åŸŸä¿®é¥°ç¬¦</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>flagç±»å‹:</p>\n</li>\n</ul>\n<blockquote>\n<p>jdk8</p>\n</blockquote>\n<table>\n<thead>\n<tr>\n<th>æ ‡è¯†ç¬¦</th>\n<th>å«ä¹‰</th>\n<th>æè¿°è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>intx</code></td>\n<td>æœ‰ç¬¦å·æ•´æ•°ï¼ˆint extendedï¼‰</td>\n<td>ç”¨äºè¡¨ç¤ºå¸¦ç¬¦å·æ•´æ•°å‹å‚æ•°</td>\n</tr>\n<tr>\n<td><code>uintx</code></td>\n<td>æ— ç¬¦å·æ•´æ•°ï¼ˆunsigned int extendedï¼‰</td>\n<td>è¡¨ç¤ºéè´Ÿæ•´æ•°å‹å‚æ•°</td>\n</tr>\n<tr>\n<td><code>uint64_t</code></td>\n<td>æ— ç¬¦å· 64 ä½æ•´æ•°</td>\n<td>é€‚ç”¨äºéœ€è¦æ›´å¤§æ•´æ•°å€¼çš„å‚æ•°ï¼Œæ¯”å¦‚å†…å­˜å¤§å°ã€çº³ç§’æ—¶é—´æˆ³ç­‰</td>\n</tr>\n<tr>\n<td><code>bool</code></td>\n<td>å¸ƒå°”å‹</td>\n<td><code>true</code> æˆ– <code>false</code>ï¼Œè¡¨ç¤ºå¼€å…³å‹å‚æ•°ã€‚<code>+</code>è¡¨ç¤ºå¼€å¯ï¼Œ<code>-</code>è¡¨ç¤ºå…³é—­ã€‚ å¦‚ <code>-XX:+UseG1GC</code>ï¼Œè¡¨ç¤ºå¼€å¯ G1 å›æ”¶å™¨åŠŸèƒ½ã€‚</td>\n</tr>\n<tr>\n<td><code>double</code></td>\n<td>åŒç²¾åº¦æµ®ç‚¹å‹</td>\n<td>ç”¨äºè¡¨ç¤ºæµ®ç‚¹æ•°å€¼ç±»å‹çš„ JVM å‚æ•°</td>\n</tr>\n<tr>\n<td><code>ccstr</code></td>\n<td>å¸¸é‡ C å­—ç¬¦ä¸²æŒ‡é’ˆ</td>\n<td>è¡¨ç¤ºå­—ç¬¦ä¸²å‚æ•°ï¼ˆä¸å¯å˜ï¼‰</td>\n</tr>\n<tr>\n<td><code>ccstrlist</code></td>\n<td>C å­—ç¬¦ä¸²åˆ—è¡¨</td>\n<td>è¡¨ç¤ºä»¥é€—å·åˆ†éš”çš„å­—ç¬¦ä¸²åˆ—è¡¨</td>\n</tr>\n</tbody>\n</table>\n<blockquote>\n<p>jdk11åå‡ºç°æ›´å¤šçš„ç±»å‹</p>\n</blockquote>\n<table>\n<thead>\n<tr>\n<th>æ ‡è¯†ç¬¦</th>\n<th>å«ä¹‰</th>\n<th>æè¿°è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>int</code></td>\n<td>æœ‰ç¬¦å·æ•´æ•°,é€šå¸¸æ˜¯ 32 ä½</td>\n<td>JVM å†…éƒ¨ä½¿ç”¨çš„æ™®é€š int å‚æ•°</td>\n</tr>\n<tr>\n<td><code>uint</code></td>\n<td>æ— ç¬¦å·æ•´æ•°,é€šå¸¸æ˜¯ 32 ä½</td>\n<td>å°‘é‡ç”¨äºç‰¹æ®Šåœºæ™¯çš„å‚æ•°</td>\n</tr>\n<tr>\n<td><code>size_t</code></td>\n<td>å†…å­˜å¤§å°</td>\n<td>è¡¨ç¤ºå†…å­˜å¤§å°å‚æ•°ï¼ˆå•ä½ä¸€èˆ¬ä¸ºå­—èŠ‚ï¼‰,jdk11åå‡ºç°ï¼ŒåŸæ¥æ˜¯ <code>uintx</code></td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>flagæ¥æºä¸ä½œç”¨åŸŸä¿®é¥°ç¬¦</p>\n</li>\n</ul>\n<blockquote>\n<p>jdk8</p>\n</blockquote>\n<table>\n<thead>\n<tr>\n<th>æ ‡è®°</th>\n<th>å«ä¹‰</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>&#123;product&#125;</code></td>\n<td>æ­£å¼äº§å“å‚æ•°ï¼ˆç”¨æˆ·å¯ç”¨ï¼Œå¯é€šè¿‡ <code>-XX:</code> è¿›è¡Œè®¾ç½®ï¼‰</td>\n</tr>\n<tr>\n<td><code>&#123;pd product&#125;</code></td>\n<td>å¹³å°ç›¸å…³çš„æ­£å¼å‚æ•°ï¼ˆplatform-dependentï¼‰ï¼Œåœ¨æŸäº›æ“ä½œç³»ç»Ÿ/CPU ä¸Šå¯ç”¨</td>\n</tr>\n<tr>\n<td><code>&#123;C1 product&#125;</code></td>\n<td>ä»…åœ¨ä½¿ç”¨ <strong>C1 ç¼–è¯‘å™¨ï¼ˆä¼˜åŒ–ç¼–è¯‘å™¨ï¼‰</strong> æ—¶æœ‰æ•ˆçš„å‚æ•°</td>\n</tr>\n<tr>\n<td><code>&#123;C2 product&#125;</code></td>\n<td>ä»…åœ¨ä½¿ç”¨ <strong>C2 ç¼–è¯‘å™¨ï¼ˆä¼˜åŒ–ç¼–è¯‘å™¨ï¼‰</strong> æ—¶æœ‰æ•ˆçš„å‚æ•°</td>\n</tr>\n<tr>\n<td><code>&#123;manageable&#125;</code></td>\n<td>å¯é€šè¿‡ JMX åŠ¨æ€ç®¡ç†çš„å‚æ•°ï¼ˆè¿è¡Œæ—¶å¯è°ƒæ•´ï¼‰</td>\n</tr>\n<tr>\n<td><code>&#123;ARCH product&#125;</code></td>\n<td>ä¸ CPU æ¶æ„ç›¸å…³çš„äº§å“å‚æ•°ï¼ˆå¦‚ x86ã€ARM ç­‰ï¼‰</td>\n</tr>\n<tr>\n<td><code>&#123;lp64_product&#125;</code></td>\n<td>ä»…åœ¨ 64 ä½ JVM ä¸Šæ‰æœ‰æ•ˆçš„äº§å“å‚æ•°</td>\n</tr>\n<tr>\n<td><code>&#123;experimental&#125;</code></td>\n<td>å®éªŒæ€§çš„ å‚æ•°ï¼Œå¯èƒ½åœ¨å°†æ¥çš„ç‰ˆæœ¬ä¸­åˆ é™¤æˆ–æ›´æ”¹ã€‚éœ€è¦å¼€å¯ -XX:+UnlockExperimentalVMOptions</td>\n</tr>\n</tbody>\n</table>\n<blockquote>\n<p>jdk11åå‡ºç°æ›´å¤šçš„ç±»å‹</p>\n</blockquote>\n<table>\n<thead>\n<tr>\n<th>æ ‡è®°</th>\n<th>å«ä¹‰</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>&#123;C1 pd product&#125;</code></td>\n<td>å¹³å°ç›¸å…³çš„æ­£å¼å‚æ•°,ä»…åœ¨ä½¿ç”¨ <strong>C1 ç¼–è¯‘å™¨ï¼ˆä¼˜åŒ–ç¼–è¯‘å™¨ï¼‰</strong> æ—¶æœ‰æ•ˆçš„å‚æ•°</td>\n</tr>\n<tr>\n<td><code>&#123;C2 pd product&#125;</code></td>\n<td>å¹³å°ç›¸å…³çš„æ­£å¼å‚æ•°,ä»…åœ¨ä½¿ç”¨ <strong>C2 ç¼–è¯‘å™¨ï¼ˆä¼˜åŒ–ç¼–è¯‘å™¨ï¼‰</strong> æ—¶æœ‰æ•ˆçš„å‚æ•°</td>\n</tr>\n<tr>\n<td><code>&#123;JVMCI product&#125;</code></td>\n<td>æ­¤å‚æ•°é€‚ç”¨äº JVMCI æˆ– Graal ç¼–è¯‘å™¨ç›¸å…³åŠŸèƒ½ï¼Œjdk21æ·»åŠ </td>\n</tr>\n</tbody>\n</table>\n<blockquote>\n<p>å¦å¤–ï¼Œjdk11+ ä¸­ï¼Œæœ€åè¿˜ä¼šå¤šå‡ºä¸€åˆ—ï¼Œå…¶ä½œç”¨æ˜¯è¯´æ˜è¯¥å‚æ•°çš„è®¾ç½®æ¥æº</p>\n</blockquote>\n<table>\n<thead>\n<tr>\n<th>æ¥æºæ ‡è¯†</th>\n<th>å«ä¹‰è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>&#123;default&#125;</code></td>\n<td>ä½¿ç”¨çš„æ˜¯è¯¥å‚æ•°çš„é»˜è®¤å€¼ï¼ˆæ²¡æœ‰è¢«ç”¨æˆ·æˆ–ç³»ç»Ÿè®¾ç½®ï¼‰</td>\n</tr>\n<tr>\n<td><code>&#123;command line&#125;</code></td>\n<td>ç”¨æˆ·é€šè¿‡å‘½ä»¤è¡Œæ˜¾å¼è®¾ç½®çš„å‚æ•°ï¼ˆå¦‚ <code>-XX:+UseG1GC</code>ï¼‰</td>\n</tr>\n<tr>\n<td><code>&#123;ergonomic&#125;</code></td>\n<td>JVM æ ¹æ®ç³»ç»Ÿç¯å¢ƒè‡ªåŠ¨é€‰æ‹©çš„å€¼ï¼ˆè‡ªé€‚åº”è®¾ç½®ï¼‰</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"jps-æŸ¥çœ‹å½“å‰jvmä¸­çš„è¿›ç¨‹\">jps: æŸ¥çœ‹å½“å‰jvmä¸­çš„è¿›ç¨‹</h2>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹javaè¿›ç¨‹ID</span></span><br><span class=\"line\">jps</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹javaè¿›ç¨‹ä¿¡æ¯ï¼ŒåŒ…æ‹¬IDå’Œå¯åŠ¨ç±»æˆ–jarçš„åç§°</span></span><br><span class=\"line\">jps -l</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹å¯åŠ¨javaè¿›ç¨‹æ—¶ä¼ é€’ç»™jvmçš„å‚æ•°è®¾ç½®</span></span><br><span class=\"line\">jps -v</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹javaè¿›ç¨‹ä¿¡æ¯ï¼ŒåŒæ—¶æ˜¾ç¤ºå¯åŠ¨javaè¿›ç¨‹æ—¶ä¼ é€’ç»™jvmçš„å‚æ•°è®¾ç½®</span></span><br><span class=\"line\">jps -lv</span><br></pre></td></tr></table></figure>\n<h2 id=\"jinfo-æŸ¥çœ‹JVMå‚æ•°\">jinfo: æŸ¥çœ‹JVMå‚æ•°</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>jinfo æ˜¯ JDK è‡ªå¸¦çš„å‘½ä»¤è¡Œå·¥å…·ä¹‹ä¸€ï¼Œç”¨äº æŸ¥çœ‹å’Œä¿®æ”¹æ­£åœ¨è¿è¡Œä¸­çš„ Java è¿›ç¨‹çš„é…ç½®ä¿¡æ¯ï¼Œä¸»è¦åŒ…æ‹¬ JVM å‚æ•°ã€ç³»ç»Ÿå±æ€§ç­‰ä¿¡æ¯ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>åœ¨ Java 9+ ä¹‹åè¢«æ ‡è®°ä¸º deprecatedï¼Œå»ºè®®æ”¹ç”¨ jcmd æ›¿ä»£</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹æ­£åœ¨è¿è¡Œçš„ JVM å‚æ•°</span></span><br><span class=\"line\">jinfo &lt;PID&gt;</span><br><span class=\"line\"><span class=\"comment\"># jcmd å‘½ä»¤ï¼Œåˆ†æˆä¸‰ä¸ª</span></span><br><span class=\"line\">jcmd &lt;pid&gt; VM.flags <span class=\"comment\"># VM Flags</span></span><br><span class=\"line\">jcmd &lt;pid&gt; VM.system_properties <span class=\"comment\"># System Properties</span></span><br><span class=\"line\">jcmd &lt;pid&gt; VM.command_line <span class=\"comment\"># Command Line</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹æŒ‡å®šè¿›ç¨‹çš„ç³»ç»Ÿå±æ€§ï¼ˆ-syspropsï¼‰</span></span><br><span class=\"line\">jinfo -sysprops &lt;PID&gt;</span><br><span class=\"line\"><span class=\"comment\"># jcmd å‘½ä»¤</span></span><br><span class=\"line\">jcmd &lt;pid&gt; VM.system_properties</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åŠ¨æ€ä¿®æ”¹ JVM å‚æ•°ï¼ˆä»…æ”¯æŒéƒ¨åˆ†å‚æ•°ï¼‰</span></span><br><span class=\"line\">jinfo -flag [+|-]&lt;flagname&gt; &lt;pid&gt;</span><br><span class=\"line\"><span class=\"comment\">## ä¾‹ï¼šæ‰“å¼€ GC æ—¥å¿—</span></span><br><span class=\"line\">jinfo -flag +PrintGC &lt;pid&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ£€æŸ¥æ˜¯å¦å¼€å¯äº†æŸä¸ª JVM ç‰¹æ€§ï¼ˆå¦‚ UseG1GCï¼‰</span></span><br><span class=\"line\">jinfo -flag UseG1GC &lt;pid&gt;</span><br></pre></td></tr></table></figure>\n<h2 id=\"jstat-æŸ¥çœ‹æŒ‡å®šJAVAè¿›ç¨‹çš„è¿è¡ŒçŠ¶æ€\">jstat: æŸ¥çœ‹æŒ‡å®šJAVAè¿›ç¨‹çš„è¿è¡ŒçŠ¶æ€</h2>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹è¿è¡ŒçŠ¶æ€</span></span><br><span class=\"line\">jstat -gc &lt;PID&gt;</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹è¿è¡ŒçŠ¶æ€ï¼Œæ¯éš”5000æ¯«ç§’è¾“å‡ºä¸€æ¬¡ï¼Œå…±è¾“å‡º20æ¬¡</span></span><br><span class=\"line\">jstat -gc &lt;PID&gt; 5000 20</span><br><span class=\"line\"><span class=\"comment\"># è¾“å‡º</span></span><br><span class=\"line\"> S0C    S1C    S0U    S1U      EC       EU        OC         OU       MC     MU    CCSC   CCSU   YGC     YGCT    FGC    FGCT     GCT</span><br><span class=\"line\">512.0  512.0   0.0   224.0  29696.0  27138.2   105984.0   96531.8   122368.0 114450.4 15360.0 14018.9    733    5.099   4      0.833    5.931</span><br><span class=\"line\">512.0  512.0   0.0   224.0  29696.0  27203.9   105984.0   96531.8   122368.0 114450.4 15360.0 14018.9    733    5.099   4      0.833    5.931</span><br><span class=\"line\">512.0  512.0   0.0   224.0  29696.0  27220.4   105984.0   96531.8   122368.0 114450.4 15360.0 14018.9    733    5.099   4      0.833    5.931</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å†…å­˜åŒºç»Ÿè®¡ï¼ˆå•ä½ï¼šKBï¼‰</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>åˆ—å</th>\n<th>å«ä¹‰è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>S0C</strong></td>\n<td>Survivor 0 åŒºçš„å®¹é‡ï¼ˆKBï¼‰</td>\n</tr>\n<tr>\n<td><strong>S1C</strong></td>\n<td>Survivor 1 åŒºçš„å®¹é‡ï¼ˆKBï¼‰</td>\n</tr>\n<tr>\n<td><strong>S0U</strong></td>\n<td>Survivor 0 åŒºå·²ä½¿ç”¨å†…å­˜ï¼ˆKBï¼‰</td>\n</tr>\n<tr>\n<td><strong>S1U</strong></td>\n<td>Survivor 1 åŒºå·²ä½¿ç”¨å†…å­˜ï¼ˆKBï¼‰</td>\n</tr>\n<tr>\n<td><strong>EC</strong></td>\n<td>Eden åŒºçš„å®¹é‡ï¼ˆKBï¼‰</td>\n</tr>\n<tr>\n<td><strong>EU</strong></td>\n<td>Eden åŒºå·²ä½¿ç”¨å†…å­˜ï¼ˆKBï¼‰</td>\n</tr>\n<tr>\n<td><strong>OC</strong></td>\n<td>Old Generationï¼ˆè€å¹´ä»£ï¼‰çš„å®¹é‡ï¼ˆKBï¼‰</td>\n</tr>\n<tr>\n<td><strong>OU</strong></td>\n<td>Old Generation å·²ä½¿ç”¨å†…å­˜ï¼ˆKBï¼‰</td>\n</tr>\n<tr>\n<td><strong>MC</strong></td>\n<td>Metaspaceï¼ˆå…ƒç©ºé—´ï¼‰çš„å®¹é‡ï¼ˆKBï¼‰</td>\n</tr>\n<tr>\n<td><strong>MU</strong></td>\n<td>Metaspace å·²ä½¿ç”¨å†…å­˜ï¼ˆKBï¼‰</td>\n</tr>\n<tr>\n<td><strong>CCSC</strong></td>\n<td>Compressed Class Space çš„å®¹é‡ï¼ˆKBï¼‰</td>\n</tr>\n<tr>\n<td><strong>CCSU</strong></td>\n<td>Compressed Class Space å·²ä½¿ç”¨å†…å­˜ï¼ˆKBï¼‰</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>GC æ¬¡æ•°ä¸è€—æ—¶(ä»åº”ç”¨ç¨‹åºå¯åŠ¨åˆ°é‡‡æ ·æ—¶)</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>åˆ—å</th>\n<th>å«ä¹‰è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>YGC</strong></td>\n<td>Young GCï¼ˆMinor GCï¼‰ çš„ç´¯è®¡æ¬¡æ•°</td>\n</tr>\n<tr>\n<td><strong>YGCT</strong></td>\n<td>Young GC ç´¯è®¡è€—æ—¶ï¼ˆå•ä½ï¼šç§’ï¼‰</td>\n</tr>\n<tr>\n<td><strong>FGC</strong></td>\n<td>Full GC çš„ç´¯è®¡æ¬¡æ•°</td>\n</tr>\n<tr>\n<td><strong>FGCT</strong></td>\n<td>Full GC ç´¯è®¡è€—æ—¶ï¼ˆå•ä½ï¼šç§’ï¼‰</td>\n</tr>\n<tr>\n<td><strong>GCT</strong></td>\n<td>GC æ€»è€—æ—¶ï¼ˆYGCT + FGCTï¼Œæ€»å’Œï¼‰</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"jstack-æŸ¥çœ‹æŒ‡å®šJAVAè¿›ç¨‹ä¸­å„çº¿ç¨‹çš„è°ƒç”¨å †æ ˆ\">jstack: æŸ¥çœ‹æŒ‡å®šJAVAè¿›ç¨‹ä¸­å„çº¿ç¨‹çš„è°ƒç”¨å †æ ˆ</h2>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æ‰“å°çº¿ç¨‹çš„æ ‡å‡†æ ˆä¿¡æ¯ï¼ˆæ ˆå¸§ + çº¿ç¨‹çŠ¶æ€ï¼‰</span></span><br><span class=\"line\">jstack &lt;PID&gt;</span><br><span class=\"line\"><span class=\"comment\"># åœ¨æ ‡å‡†è¾“å‡ºåŸºç¡€ä¸Šï¼Œé¢å¤–æ‰“å°çº¿ç¨‹æ‹¥æœ‰çš„é”ï¼ˆmonitorï¼‰å’Œ waited on é”å¯¹è±¡ä¿¡æ¯</span></span><br><span class=\"line\">jstack -l &lt;PID&gt;</span><br><span class=\"line\"><span class=\"comment\"># è¾“å‡ºåˆ°æ–‡ä»¶</span></span><br><span class=\"line\">jstack -l &lt;PID&gt; &gt; jstack.tdump <span class=\"comment\"># è¿™ä¸ªæ–‡ä»¶ååç¼€åªæ˜¯ä¸ºäº†æ–¹ä¾¿ jvisualvm æŸ¥çœ‹</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># è¾“å‡º</span></span><br><span class=\"line\"><span class=\"string\">&quot;idle-connection-reaper&quot;</span> <span class=\"comment\">#68 daemon prio=5 os_prio=0 tid=0x00007f38b6ae2800 nid=0x62e9 waiting on condition [0x00007f385b0f5000]</span></span><br><span class=\"line\">   java.lang.Thread.State: TIMED_WAITING (sleeping)</span><br><span class=\"line\">\tat java.lang.Thread.<span class=\"built_in\">sleep</span>(Native Method)</span><br><span class=\"line\">\tat software.amazon.awssdk.http.apache.internal.conn.IdleConnectionReaper<span class=\"variable\">$ReaperTask</span>.run(IdleConnectionReaper.java:151)</span><br><span class=\"line\">\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)</span><br><span class=\"line\">\tat java.util.concurrent.ThreadPoolExecutor<span class=\"variable\">$Worker</span>.run(ThreadPoolExecutor.java:624)</span><br><span class=\"line\">\tat java.lang.Thread.run(Thread.java:750)</span><br><span class=\"line\"></span><br><span class=\"line\">   Locked ownable synchronizers:</span><br><span class=\"line\">\t- &lt;0x00000000c561cfd8&gt; (a java.util.concurrent.ThreadPoolExecutor<span class=\"variable\">$Worker</span>)</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>jstackè¾“å‡ºå†…å®¹å«ä¹‰</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>å­—æ®µ</th>\n<th>å«ä¹‰</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>&quot;idle-connection-reaper&quot;</code></td>\n<td>çº¿ç¨‹åç§°ã€‚è¿™ä¸ªçº¿ç¨‹æ˜¯ AWS SDK ä¸­ç”¨äºæ¸…ç†ç©ºé—²è¿æ¥çš„åå°çº¿ç¨‹ã€‚</td>\n</tr>\n<tr>\n<td><code>#68</code></td>\n<td>çº¿ç¨‹ IDï¼ˆJava å±‚åˆ†é…çš„ç¼–å·ï¼‰ã€‚</td>\n</tr>\n<tr>\n<td><code>daemon</code></td>\n<td>è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ª <strong>å®ˆæŠ¤çº¿ç¨‹</strong>ã€‚JVM é€€å‡ºæ—¶ä¸ä¼šç­‰å¾…å®ˆæŠ¤çº¿ç¨‹è¿è¡Œç»“æŸã€‚</td>\n</tr>\n<tr>\n<td><code>prio=5</code></td>\n<td>Java å±‚çš„çº¿ç¨‹ä¼˜å…ˆçº§ï¼ˆé»˜è®¤ 1â€“10ï¼Œ5 æ˜¯é»˜è®¤ï¼‰ã€‚</td>\n</tr>\n<tr>\n<td><code>os_prio=0</code></td>\n<td>æ“ä½œç³»ç»Ÿå±‚çº¿ç¨‹ä¼˜å…ˆçº§ï¼ˆå–å†³äºæ“ä½œç³»ç»Ÿå’Œ JVM çš„å®ç°ï¼‰ã€‚</td>\n</tr>\n<tr>\n<td><code>tid=0x00007f38b6ae2800</code></td>\n<td>çº¿ç¨‹ IDï¼ˆJava å±‚ä½¿ç”¨çš„åœ°å€æ ‡è¯†ï¼‰ã€‚</td>\n</tr>\n<tr>\n<td><code>nid=0x62e9</code></td>\n<td>Native IDï¼Œæ“ä½œç³»ç»Ÿåˆ†é…çš„çº¿ç¨‹ IDï¼ˆåå…­è¿›åˆ¶è¡¨ç¤ºï¼‰ï¼Œå¯ä»¥é€šè¿‡å‘½ä»¤<code>printf &quot;%d\\n&quot; 0x62e9</code>è½¬æ¢ä¸º10è¿›åˆ¶ã€‚<br>  <code>ps -Lp &lt;PID&gt;</code> å’Œ <code>top -Hp &lt;PID&gt;</code> å±•ç¤ºçš„çº¿ç¨‹idæ˜¯10è¿›åˆ¶</td>\n</tr>\n<tr>\n<td><code>waiting on condition</code></td>\n<td>çº¿ç¨‹çŠ¶æ€è¯´æ˜ï¼šæ­£åœ¨ç­‰å¾…æŸç§æ¡ä»¶ï¼Œä¸€èˆ¬æŒ‡ <code>sleep()</code> æˆ– <code>wait()</code> ç­‰ã€‚</td>\n</tr>\n<tr>\n<td><code>[0x00007f385b0f5000]</code></td>\n<td>æ ˆå¸§çš„å†…å­˜åœ°å€ã€‚</td>\n</tr>\n<tr>\n<td><code>java.lang.Thread.State: TIMED_WAITING (sleeping)</code></td>\n<td>çº¿ç¨‹çŠ¶æ€ã€‚</td>\n</tr>\n<tr>\n<td><code>at java.lang.Thread.sleep(Native Method)</code> <br> â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦</td>\n<td>çº¿ç¨‹è°ƒç”¨æ ˆä¿¡æ¯ï¼ŒåŒ…æ‹¬è°ƒç”¨æ–¹æ³•ã€è°ƒç”¨å‚æ•°ã€è°ƒç”¨æ ˆå¸§ã€‚</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¦å¤–è¿˜æœ‰å¦‚ä¸‹ä¿¡æ¯ï¼Œè¡¨ç¤ºæ­¤çº¿ç¨‹æŒæœ‰çš„å¯æ‹¥æœ‰åŒæ­¥å™¨ï¼ˆä¾‹å¦‚ ReentrantLockï¼‰ï¼Œå…·ä½“å†…å®¹å¦‚ä¸‹ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Locked ownable synchronizers:</span><br><span class=\"line\">\t- &lt;0x00000000c561cfd8&gt; (a java.util.concurrent.ThreadPoolExecutor<span class=\"variable\">$Worker</span>)</span><br></pre></td></tr></table></figure>\n<table>\n<thead>\n<tr>\n<th>å†…å®¹</th>\n<th>å«ä¹‰</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>&lt;0x00000000c561cfd8&gt;</code></td>\n<td>æŒæœ‰é”çš„å¯¹è±¡åœ°å€ã€‚å¯ä»¥åœ¨å…¶ä»–çº¿ç¨‹ä¸­æŸ¥æ‰¾è¿™ä¸ªåœ°å€ï¼Œä»¥åˆ¤æ–­æ­»é”ç­‰é—®é¢˜ã€‚</td>\n</tr>\n<tr>\n<td><code>(a ThreadPoolExecutor$Worker)</code></td>\n<td>è¡¨ç¤ºè¯¥é”å±äº <code>ThreadPoolExecutor</code> çš„æŸä¸ª <code>Worker</code> çº¿ç¨‹ï¼ˆè¿™æ˜¯çº¿ç¨‹æ± çš„å·¥ä½œçº¿ç¨‹ï¼‰ã€‚</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>çº¿ç¨‹çŠ¶æ€</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>çŠ¶æ€</th>\n<th>å«ä¹‰</th>\n<th>å¸¸è§åŸå›  / ç¤ºä¾‹æ–¹æ³•</th>\n<th>ç¤ºä¾‹ jstack è¾“å‡º</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>RUNNABLE</code></td>\n<td>çº¿ç¨‹æ­£åœ¨è¿è¡Œæˆ–å‡†å¤‡è¿è¡Œï¼Œç­‰å¾… CPU æ—¶é—´ç‰‡ã€‚</td>\n<td>çº¿ç¨‹æ´»è·ƒè¿è¡Œä¸­</td>\n<td><code>&quot;Thread-0&quot; #1 prio=5 os_prio=0 tid=0x00007f8d9c001000 nid=0x1a runnable [0x00007f8dbf7fe000]</code></td>\n</tr>\n<tr>\n<td><code>BLOCKED (on object monitor)</code></td>\n<td>ç­‰å¾…è·å–å¯¹è±¡çš„ç›‘è§†å™¨é”ï¼ˆåŒæ­¥é”ï¼‰ï¼Œå³ç­‰å¾…è¿›å…¥åŒæ­¥å—æˆ–æ–¹æ³•ã€‚</td>\n<td><code>synchronized</code> åŒæ­¥å—æˆ–æ–¹æ³•</td>\n<td><code>&quot;Thread-1&quot; #2 prio=5 os_prio=0 tid=0x00007f8d9c002000 nid=0x1b waiting for monitor entry [0x00007f8dbeaff000]</code></td>\n</tr>\n<tr>\n<td><code>WAITING (on object monitor)</code></td>\n<td>æ— é™æœŸç­‰å¾…å…¶ä»–çº¿ç¨‹æ‰§è¡ŒæŸæ“ä½œã€‚</td>\n<td><code>Object.wait()</code><br><code>Thread.join()</code><br><code>LockSupport.park()</code><br><code>Condition.await()</code></td>\n<td><code>&quot;Thread-2&quot; #3 prio=5 os_prio=0 tid=0x00007f8d9c003000 nid=0x1c waiting on condition [0x00007f8dbebff000]</code></td>\n</tr>\n<tr>\n<td><code>TIMED_WAITING (on object monitor)</code></td>\n<td>ç­‰å¾…å›ºå®šæ—¶é—´ï¼Œç›´åˆ°æ¡ä»¶æ»¡è¶³æˆ–è¶…æ—¶ã€‚</td>\n<td><code>Object.wait(long)</code><br><code>Thread.sleep(long)</code><br><code>Condition.awaitNanos(long)</code><br><code>DelayQueue.take()</code></td>\n<td><code>&quot;Thread-3&quot; #4 prio=5 os_prio=0 tid=0x00007f8d9c004000 nid=0x1d timed_waiting [0x00007f8dbebff000]</code></td>\n</tr>\n<tr>\n<td><code>TERMINATED</code></td>\n<td>çº¿ç¨‹å·²è¿è¡Œå®Œæ¯•å¹¶é€€å‡ºï¼ˆé€šå¸¸ä¸åœ¨ jstack ä¸­æ˜¾ç¤ºï¼‰ã€‚</td>\n<td>-</td>\n<td>-</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"ä½¿ç”¨jstackæ£€æŸ¥æ­»é”\">ä½¿ç”¨jstackæ£€æŸ¥æ­»é”</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ­»é”æ˜¯æŒ‡å¤šä¸ªçº¿ç¨‹äº’ç›¸ç­‰å¾…å¯¹æ–¹é‡Šæ”¾é”ï¼Œå¯¼è‡´æ— æ³•ç»§ç»­è¿è¡Œçš„æƒ…å†µã€‚</p>\n</li>\n</ul>\n<h4 id=\"ç›´æ¥æŸ¥æ‰¾-Found-one-Java-level-deadlock-æç¤º\">ç›´æ¥æŸ¥æ‰¾ <code>Found one Java-level deadlock</code> æç¤º</h4>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Found one Java-level deadlock:</span><br><span class=\"line\">=============================</span><br><span class=\"line\"><span class=\"string\">&quot;Thread-1&quot;</span>:</span><br><span class=\"line\">  waiting to lock monitor 0x0000000005c0a098 (object 0x00000000d5c10a70, a java.lang.Object),</span><br><span class=\"line\">  <span class=\"built_in\">which</span> is held by <span class=\"string\">&quot;Thread-2&quot;</span></span><br><span class=\"line\"><span class=\"string\">&quot;Thread-2&quot;</span>:</span><br><span class=\"line\">  waiting to lock monitor 0x0000000005c0a128 (object 0x00000000d5c10aa0, a java.lang.Object),</span><br><span class=\"line\">  <span class=\"built_in\">which</span> is held by <span class=\"string\">&quot;Thread-1&quot;</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¡¨ç¤ºä¸¤ä¸ªçº¿ç¨‹äº’ç›¸ç­‰å¾…å¯¹æ–¹é‡Šæ”¾é”ï¼Œé€ æˆæ­»é”ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ç›®å‰åªæ”¯æŒæ‰¾å‡º <code>synchronized</code> å…³é”®å­—é˜»å¡ä½çš„çº¿ç¨‹ï¼Œå¦‚æœæ˜¯ <code>java.util.concurrent.Lock</code> ç›®å‰è¿˜ä¸æ”¯æŒã€‚</p>\n</li>\n</ul>\n<h4 id=\"æ‰‹åŠ¨åˆ¤æ–­æ­»é”çš„ç‰¹å¾ï¼ˆå¦‚æœæ²¡æœ‰ä¸Šé¢çš„æç¤ºï¼‰\">æ‰‹åŠ¨åˆ¤æ–­æ­»é”çš„ç‰¹å¾ï¼ˆå¦‚æœæ²¡æœ‰ä¸Šé¢çš„æç¤ºï¼‰</h4>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¦‚æœ JVM æ²¡æœ‰æ˜¾å¼æç¤ºï¼Œä½ å¯ä»¥é€šè¿‡ä»¥ä¸‹æ­»é”ç‰¹å¾è¿›è¡Œæ‰‹åŠ¨è¯†åˆ«ï¼š</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>ç‰¹å¾</th>\n<th>æè¿°</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>çº¿ç¨‹å¤„äº <code>BLOCKED</code> çŠ¶æ€</td>\n<td>çº¿ç¨‹è¢«é”é˜»å¡åœ¨ <code>monitor</code> ä¸Šã€‚</td>\n</tr>\n<tr>\n<td><code>waiting to lock</code> å’Œ <code>locked</code> å‡ºç°äº¤å‰</td>\n<td>ä¸€ä¸ªçº¿ç¨‹æ­£åœ¨ç­‰å¾…å¦ä¸€ä¸ªçº¿ç¨‹æŒæœ‰çš„é”ï¼Œè€Œå¦ä¸€ä¸ªçº¿ç¨‹ä¹Ÿåœ¨ç­‰å¾…å½“å‰çº¿ç¨‹çš„é”ã€‚</td>\n</tr>\n<tr>\n<td>æ²¡æœ‰èƒ½ç»§ç»­æ‰§è¡Œçš„çº¿ç¨‹</td>\n<td>å¤šä¸ªçº¿ç¨‹éƒ½å¤„äº <code>BLOCKED</code> çŠ¶æ€ï¼Œä¸”ç›¸äº’ä¾èµ–ã€‚</td>\n</tr>\n</tbody>\n</table>\n<div class=\"tips\">\n<p><em><strong>åœ¨ Java 8 ä¹‹åæ”¯æŒè·å– JVM å†…éƒ¨çº¿ç¨‹</strong></em></p>\n<ul class=\"lvl-1\">\n<li class=\"lvl-2\">VM å†…éƒ¨çº¿ç¨‹åŒ…æ‹¬ä¸‹é¢å‡ ç§ï¼š</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>çº¿ç¨‹ç±»å‹</th>\n<th>ç¤ºä¾‹åç§°</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>JITï¼ˆJust-In-Timeï¼‰ç¼–è¯‘çº¿ç¨‹</td>\n<td>C1 CompilerThread0, C2 CompilerThread0</td>\n</tr>\n<tr>\n<td>GC çº¿ç¨‹</td>\n<td>GC Thread0, G1 Young RemSet Sampling</td>\n</tr>\n<tr>\n<td>å…¶å®ƒå†…éƒ¨çº¿ç¨‹</td>\n<td>VM Periodic Task Thread, VM Thread, Service Thread</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-1\">\n<li class=\"lvl-2\">\n<p>è‡ª JDK 7 åŠä»¥ä¸Šç‰ˆæœ¬å¼€å§‹ï¼ŒHotSpot JVM é»˜è®¤å¯ç”¨äº†ï¼šåˆ†å±‚ç¼–è¯‘ï¼ˆTiered Compilationï¼‰ï¼Œå³åŒæ—¶ä½¿ç”¨ C1 å’Œ C2 ç¼–è¯‘å™¨ã€‚</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>ç¼–è¯‘å™¨</th>\n<th>ç‰¹æ€§</th>\n<th>ç”¨é€”</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>C1ï¼ˆClient Compilerï¼‰</strong></td>\n<td>ç¼–è¯‘é€Ÿåº¦å¿«ï¼Œä¼˜åŒ–å°‘</td>\n<td>ç¨‹åºå¯åŠ¨æ—¶ä½¿ç”¨ï¼Œæå‡å¯åŠ¨é€Ÿåº¦</td>\n</tr>\n<tr>\n<td><strong>C2ï¼ˆServer Compilerï¼‰</strong></td>\n<td>ç¼–è¯‘é€Ÿåº¦æ…¢ï¼Œä¼˜åŒ–å¼º</td>\n<td>çƒ­ç‚¹ä»£ç è¾¾åˆ°ä¸€å®šé—¨æ§›åä½¿ç”¨ï¼Œæå‡é•¿æœŸè¿è¡Œæ€§èƒ½</td>\n</tr>\n</tbody>\n</table>\n<blockquote>\n<p>JVM å¯åŠ¨åï¼Œå…ˆè§£é‡Šæ‰§è¡Œå­—èŠ‚ç ï¼›çƒ­ç‚¹ä»£ç é¦–å…ˆç”± C1 ç¼–è¯‘å™¨å¤„ç†ï¼›å¦‚æœè¿›ä¸€æ­¥å˜çƒ­ï¼Œäº¤ç”± C2 ç¼–è¯‘å™¨ä¼˜åŒ–ï¼›æ•´ä¸ªè¿‡ç¨‹ç”± JVM è‡ªåŠ¨ç®¡ç†ï¼Œä¸éœ€è¦æ‰‹åŠ¨å¹²é¢„ã€‚</p>\n</blockquote>\n<ul class=\"lvl-1\">\n<li class=\"lvl-2\">\n<p>æ˜¯å¦å¯ä»¥æŒ‡å®šåªç”¨æŸä¸ªç¼–è¯‘å™¨ï¼Ÿæ˜¯çš„ï¼Œä½ å¯ä»¥ç”¨ JVM å‚æ•°æ§åˆ¶ï¼Œä½†çœŸæ²¡å¿…è¦ã€‚</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>å‚æ•°</th>\n<th>å«ä¹‰</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>-client</code></td>\n<td>ä½¿ç”¨ C1 ç¼–è¯‘å™¨ï¼ˆé€‚åˆå¯åŠ¨å¿«ï¼‰</td>\n</tr>\n<tr>\n<td><code>-server</code></td>\n<td>ä½¿ç”¨ C2 ç¼–è¯‘å™¨ï¼ˆé€‚åˆé•¿æ—¶é—´è¿è¡Œçš„æœåŠ¡ï¼‰</td>\n</tr>\n<tr>\n<td><code>-XX:-TieredCompilation</code></td>\n<td>ç¦ç”¨åˆ†å±‚ç¼–è¯‘ï¼Œä»…ä½¿ç”¨ <code>-client</code> æˆ– <code>-server</code> æŒ‡å®šçš„ç¼–è¯‘å™¨</td>\n</tr>\n</tbody>\n</table>\n</div>\n<h2 id=\"jmap-åˆ†æè¿è¡Œä¸­-Java-è¿›ç¨‹çš„å†…å­˜ä½¿ç”¨æƒ…å†µ\">jmap: åˆ†æè¿è¡Œä¸­ Java è¿›ç¨‹çš„å†…å­˜ä½¿ç”¨æƒ…å†µ</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>jmap æ¯”è¾ƒæ¶ˆè€—å†…å­˜ï¼Œæ‰€ä»¥ä¸æ¨èç”Ÿäº§ç¯å¢ƒä½¿ç”¨ã€‚</p>\n</li>\n</ul>\n<h3 id=\"jmap-histo-pid-æŸ¥çœ‹ç±»å®ä¾‹æ•°é‡åŠå ç”¨å†…å­˜\"><code>jmap -histo &lt;pid&gt;</code>: æŸ¥çœ‹ç±»å®ä¾‹æ•°é‡åŠå ç”¨å†…å­˜</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ jmap -histo 25238</span><br><span class=\"line\">25238:</span><br><span class=\"line\"></span><br><span class=\"line\"> num     <span class=\"comment\">#instances         #bytes  class name</span></span><br><span class=\"line\">----------------------------------------------</span><br><span class=\"line\">   1:        106175       10838440  [C</span><br><span class=\"line\">   2:         94344        3019008  java.util.concurrent.ConcurrentHashMap<span class=\"variable\">$Node</span></span><br><span class=\"line\">   3:        105529        2532696  java.lang.String</span><br><span class=\"line\">   4:         11203        2496608  [B</span><br><span class=\"line\">   5:         20178        2430136  [Ljava.lang.Object;</span><br><span class=\"line\">   6:         21642        2399904  java.lang.Class</span><br><span class=\"line\">â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦</span><br><span class=\"line\">Total        857252       51328200</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># num: åºå·</span></span><br><span class=\"line\"><span class=\"comment\"># instances: å®ä¾‹æ•°é‡</span></span><br><span class=\"line\"><span class=\"comment\"># bytes: å®ä¾‹å­—èŠ‚æ•°</span></span><br><span class=\"line\"><span class=\"comment\"># class name: ç±»å, [C is a char[]ï¼Œ[S is a short[]ï¼Œ[I is a int[]ï¼Œ[B is a byte[]ï¼Œ[L is a List</span></span><br><span class=\"line\"><span class=\"comment\"># Total: æ€»æ•°</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"jmap-heap-pid-æŸ¥çœ‹å †ä½¿ç”¨æƒ…å†µ\"><code>jmap -heap &lt;pid&gt;</code>: æŸ¥çœ‹å †ä½¿ç”¨æƒ…å†µ</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ jmap -heap 25238</span><br><span class=\"line\">Attaching to process ID 25238, please <span class=\"built_in\">wait</span>...</span><br><span class=\"line\">Debugger attached successfully.</span><br><span class=\"line\">Server compiler detected.</span><br><span class=\"line\">JVM version is 25.371-b11</span><br><span class=\"line\"></span><br><span class=\"line\">using thread-local object allocation.</span><br><span class=\"line\">Parallel GC with 2 thread(s)</span><br><span class=\"line\"></span><br><span class=\"line\">Heap Configuration:    <span class=\"comment\"># å †é…ç½®</span></span><br><span class=\"line\">   MinHeapFreeRatio         = 0                     <span class=\"comment\"># æœ€å°ç©ºé—²ç™¾åˆ†æ¯”</span></span><br><span class=\"line\">   MaxHeapFreeRatio         = 100                     <span class=\"comment\"># æœ€å¤§ç©ºé—²ç™¾åˆ†æ¯”</span></span><br><span class=\"line\">   MaxHeapSize              = 1010827264 (964.0MB)    <span class=\"comment\"># æœ€å¤§å †å¤§å°</span></span><br><span class=\"line\">   NewSize                  = 21495808 (20.5MB)       <span class=\"comment\"># æ–°ç”Ÿä»£å¤§å°</span></span><br><span class=\"line\">   MaxNewSize               = 336592896 (321.0MB)     <span class=\"comment\"># æ–°ç”Ÿä»£æœ€å¤§å¤§å°</span></span><br><span class=\"line\">   OldSize                  = 43515904 (41.5MB)       <span class=\"comment\"># è€å¹´ä»£å¤§å°</span></span><br><span class=\"line\">   NewRatio                 = 2                       <span class=\"comment\"># æ–°ç”Ÿä»£ä¸è€å¹´ä»£æ¯”ä¾‹</span></span><br><span class=\"line\">   SurvivorRatio            = 8                       <span class=\"comment\"># å¹¸å­˜è€…æ¯”ä¾‹</span></span><br><span class=\"line\">   MetaspaceSize            = 21807104 (20.796875MB)   <span class=\"comment\"># å…ƒç©ºé—´å¤§å°</span></span><br><span class=\"line\">   CompressedClassSpaceSize = 1073741824 (1024.0MB)   <span class=\"comment\"># å‹ç¼©ç±»ç©ºé—´å¤§å°ï¼Œç”¨äºå­˜å‚¨æ‰€æœ‰ ç±»æŒ‡é’ˆï¼ˆKlass pointerï¼‰</span></span><br><span class=\"line\">   MaxMetaspaceSize         = 17592186044415 MB       <span class=\"comment\"># å…ƒç©ºé—´æœ€å¤§å¤§å°</span></span><br><span class=\"line\">   G1HeapRegionSize         = 0 (0.0MB)               <span class=\"comment\"># G1å †å¤§å°</span></span><br><span class=\"line\"></span><br><span class=\"line\">Heap Usage:       <span class=\"comment\"># å †ä½¿ç”¨æƒ…å†µ</span></span><br><span class=\"line\">PS Young Generation <span class=\"comment\"># å¹´è½»ç”Ÿä»£</span></span><br><span class=\"line\">Eden Space:         <span class=\"comment\"># Eden åŒº</span></span><br><span class=\"line\">   capacity = 30932992 (29.5MB)    <span class=\"comment\">#  Eden åŒºå¤§å°</span></span><br><span class=\"line\">   used     = 16705104 (15.931228637695312MB) <span class=\"comment\">#  Eden åŒºä½¿ç”¨æƒ…å†µ</span></span><br><span class=\"line\">   free     = 14227888 (13.568771362304688MB) <span class=\"comment\">#  Eden åŒºå‰©ä½™æƒ…å†µ</span></span><br><span class=\"line\">   54.00416487354343% used                    <span class=\"comment\">#  Eden åŒºä½¿ç”¨ç™¾åˆ†æ¯”</span></span><br><span class=\"line\">From Space:                      <span class=\"comment\"># å¹¸å­˜è€…åŒº survivor0</span></span><br><span class=\"line\">   capacity = 524288 (0.5MB)</span><br><span class=\"line\">   used     = 0 (0.0MB)</span><br><span class=\"line\">   free     = 524288 (0.5MB)</span><br><span class=\"line\">   0.0% used</span><br><span class=\"line\">To Space:                       <span class=\"comment\"># å¹¸å­˜è€…åŒº survivor1</span></span><br><span class=\"line\">   capacity = 524288 (0.5MB)</span><br><span class=\"line\">   used     = 0 (0.0MB)</span><br><span class=\"line\">   free     = 524288 (0.5MB)</span><br><span class=\"line\">   0.0% used</span><br><span class=\"line\">PS Old Generation                <span class=\"comment\"># è€å¹´ä»£</span></span><br><span class=\"line\">   capacity = 193462272 (184.5MB)</span><br><span class=\"line\">   used     = 43292112 (41.28657531738281MB)</span><br><span class=\"line\">   free     = 150170160 (143.2134246826172MB)</span><br><span class=\"line\">   22.377547597497458% used</span><br><span class=\"line\"></span><br><span class=\"line\">38722 interned Strings occupying 4184168 bytes. <span class=\"comment\"># å †ä¸­å­—ç¬¦ä¸²æ•°é‡åŠå ç”¨å†…å­˜</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"jmap-dump-live-format-b-file-file-pid-åˆ›å»ºä¸€ä¸ªå¿«ç…§ï¼Œå¹¶ä¿å­˜åˆ°æ–‡ä»¶ä¸­\"><code>jmap -dump:live,format=b,file=&lt;file&gt; &lt;pid&gt;</code>: åˆ›å»ºä¸€ä¸ªå¿«ç…§ï¼Œå¹¶ä¿å­˜åˆ°æ–‡ä»¶ä¸­</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åˆ›å»ºä¸€ä¸ªå¿«ç…§ï¼Œå¹¶ä¿å­˜åˆ°å½“å‰ç›®å½•ä¸‹</span></span><br><span class=\"line\">$ jmap -dump:live,format=b,file=test.hprof 25238</span><br><span class=\"line\">Dumping heap to /tmp/test.hprof ...</span><br><span class=\"line\">Heap dump file created</span><br></pre></td></tr></table></figure>\n<h2 id=\"jcmd-å¯ä»¥æ›¿ä»£jmapå‘½ä»¤ï¼Œjdk1-8-æ¨èä½¿ç”¨\">jcmd: å¯ä»¥æ›¿ä»£<code>jmap</code>å‘½ä»¤ï¼Œ<code>jdk1.8+</code>æ¨èä½¿ç”¨</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><code>jcmd</code> æ˜¯ <code>JDK</code> çš„ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼Œç”¨äºç®¡ç† <code>JVM</code>ï¼Œ<code>jcmd</code> å¯ä»¥æŸ¥çœ‹ <code>JVM</code> çš„è¿è¡ŒçŠ¶æ€ã€æŸ¥çœ‹å †å†…å­˜ä¿¡æ¯ã€è§¦å‘ GCã€æŸ¥çœ‹çº¿ç¨‹ä¿¡æ¯ã€æŸ¥çœ‹ç±»ä¿¡æ¯ç­‰ç­‰ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ç”Ÿäº§ç¯å¢ƒä¸å»ºè®®ä½¿ç”¨<code>jmap</code>ï¼Œå› å…¶ä¼šå ç”¨å¤§é‡å†…å­˜ï¼Œæ¨èä½¿ç”¨ <code>jcmd</code>ã€‚</p>\n</li>\n</ul>\n<h3 id=\"jcmd-pid-GC-heap-info-æŸ¥çœ‹å †ä½¿ç”¨æƒ…å†µ\"><code>jcmd &lt;pid&gt; GC.heap_info</code>: æŸ¥çœ‹å †ä½¿ç”¨æƒ…å†µ</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç±»ä¼¼ <code>jmap -heap &lt;pid&gt;</code></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ jcmd 25238 GC.heap_info</span><br><span class=\"line\">25238:</span><br><span class=\"line\"> PSYoungGen      total 30208K, used 23593K [0x00000000ebf00000, 0x00000000edd80000, 0x0000000100000000)</span><br><span class=\"line\">  eden space 29696K, 78% used [0x00000000ebf00000,0x00000000ed5d2560,0x00000000edc00000)</span><br><span class=\"line\">  from space 512K, 43% used [0x00000000edd00000,0x00000000edd38000,0x00000000edd80000)</span><br><span class=\"line\">  to   space 512K, 0% used [0x00000000edc80000,0x00000000edc80000,0x00000000edd00000)</span><br><span class=\"line\"> ParOldGen       total 105984K, used 96547K [0x00000000c3c00000, 0x00000000ca380000, 0x00000000ebf00000)</span><br><span class=\"line\">  object space 105984K, 91% used [0x00000000c3c00000,0x00000000c9a48f10,0x00000000ca380000)</span><br><span class=\"line\"> Metaspace       used 114450K, capacity 122262K, committed 122368K, reserved 1157120K</span><br><span class=\"line\">  class space    used 14018K, capacity 15294K, committed 15360K, reserved 1048576K</span><br></pre></td></tr></table></figure>\n<h3 id=\"jcmd-pid-GC-class-histogram-æŸ¥çœ‹ç±»åŠ è½½æƒ…å†µ\"><code>jcmd &lt;pid&gt; GC.class_histogram</code>: æŸ¥çœ‹ç±»åŠ è½½æƒ…å†µ</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç±»ä¼¼ <code>jmap -histo &lt;pid&gt;</code></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ jcmd 25238 GC.class_histogram</span><br><span class=\"line\">25238:</span><br><span class=\"line\"></span><br><span class=\"line\"> num     <span class=\"comment\">#instances         #bytes  class name</span></span><br><span class=\"line\">----------------------------------------------</span><br><span class=\"line\">   1:        106175       10838440  [C</span><br><span class=\"line\">   2:         94344        3019008  java.util.concurrent.ConcurrentHashMap<span class=\"variable\">$Node</span></span><br><span class=\"line\">   3:        105529        2532696  java.lang.String</span><br><span class=\"line\">   4:         11203        2496608  [B</span><br><span class=\"line\">   5:         20178        2430136  [Ljava.lang.Object;</span><br><span class=\"line\">   6:         21642        2399904  java.lang.Class</span><br><span class=\"line\">â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦</span><br><span class=\"line\">Total        857252       51328200</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># num: åºå·</span></span><br><span class=\"line\"><span class=\"comment\"># instances: å®ä¾‹æ•°é‡</span></span><br><span class=\"line\"><span class=\"comment\"># bytes: å®ä¾‹å­—èŠ‚æ•°</span></span><br><span class=\"line\"><span class=\"comment\"># class name: ç±»å, [C is a char[]ï¼Œ[S is a short[]ï¼Œ[I is a int[]ï¼Œ[B is a byte[]ï¼Œ[L is a List</span></span><br><span class=\"line\"><span class=\"comment\"># Total: æ€»æ•°</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"jcmd-pid-GC-heap-dump-path-to-heap-hprof-å¯¼å‡º-heap-dump\"><code>jcmd &lt;pid&gt; GC.heap_dump /path/to/heap.hprof</code>: å¯¼å‡º heap dump</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ›¿ä»£ <code>jmap -dump:format=b,file=heap.hprof &lt;pid&gt;</code>ï¼Œä½†ä»ä¼šæœ‰åœé¡¿ï¼ˆè§¦å‘FullGCï¼‰ï¼Œdump è¿‡ç¨‹æ…¢ï¼Œç”Ÿäº§ç¯å¢ƒæ…é‡ä½¿ç”¨</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ jcmd 25238 GC.heap_dump ./heap.hprof</span><br><span class=\"line\">25238:</span><br><span class=\"line\">Heap dump file created</span><br><span class=\"line\"><span class=\"comment\"># æ³¨æ„è¿™é‡Œä½¿ç”¨çš„æ˜¯ç›¸å¯¹ç›®å½•ï¼Œ./heap.hprofï¼Œä½†æ­¤æ—¶ &quot;./&quot; å¹¶ä¸æ˜¯è¿è¡Œå‘½ä»¤æ—¶æ‰€åœ¨çš„ç›®å½•ï¼Œè€Œæ˜¯æŒ‡ Java è¿›ç¨‹çš„å·¥ä½œç›®å½•ï¼Œå¦‚æœä½ ä¸çŸ¥é“å·¥ä½œç›®å½•ï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹</span></span><br><span class=\"line\">jcmd &lt;pid&gt; VM.system_properties | grep <span class=\"string\">&quot;user.dir&quot;</span></span><br><span class=\"line\"><span class=\"comment\"># linuxä¸‹ä¹Ÿå¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹</span></span><br><span class=\"line\"><span class=\"built_in\">ls</span> -l /proc/&lt;pid&gt;/cwd</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å› ä¸ºç”Ÿäº§ç¯å¢ƒä¸æ¨èä½¿ç”¨ <code>jmap</code> æˆ– <code>jcmd</code> å¯¼å‡º heap dumpï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦åœ¨ç”Ÿäº§ç¯å¢ƒä¸­é…ç½®å¦‚ä¸‹jvmå‚æ•°</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">-XX:+HeadDumpOnOutOfMemoryError <span class=\"comment\"># å†…å­˜æº¢å‡ºï¼ˆOOMï¼‰æ—¶ä¼šè‡ªåŠ¨ä¿å­˜å †å†…å­˜å¿«ç…§æ–‡ä»¶</span></span><br><span class=\"line\">-XX:HeapDumpPath=/path/to/dump.hprof <span class=\"comment\"># æŒ‡å®šå †å†…å­˜å¿«ç…§æ–‡ä»¶ä¿å­˜è·¯å¾„ï¼Œå¦‚æœä¸é…ç½®ï¼Œåˆ™é»˜è®¤ä¿å­˜åœ¨ Java è¿›ç¨‹çš„å·¥ä½œç›®å½•ä¸‹ï¼Œæ–‡ä»¶åç§°é»˜è®¤ä¸º java_&lt;pid&gt;.hprof</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"jhat-åˆ†æ-Java-Heap-Dump-æ–‡ä»¶ï¼ˆ-hprofï¼‰çš„å·¥å…·\">jhat: åˆ†æ Java Heap Dump æ–‡ä»¶ï¼ˆ.hprofï¼‰çš„å·¥å…·</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>jhatï¼ˆJava Heap Analysis Toolï¼‰æ˜¯ JDK é™„å¸¦çš„ä¸€ä¸ªç”¨äº**åˆ†æ Java Heap Dump æ–‡ä»¶ï¼ˆ.hprofï¼‰**çš„å·¥å…·ã€‚å®ƒå¯ä»¥å°†å †å¿«ç…§ä½œä¸º HTTP æœåŠ¡åŠ è½½ï¼Œå¹¶å…è®¸ä½ é€šè¿‡æµè§ˆå™¨äº¤äº’å¼åœ°æŸ¥çœ‹å’ŒæŸ¥è¯¢å¯¹è±¡ä¿¡æ¯ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä¸è¿‡éœ€è¦æ³¨æ„çš„æ˜¯ï¼š<br>\nğŸ”º ä» JDK 9 èµ·ï¼Œjhat å·²è¢«å®˜æ–¹åºŸå¼ƒï¼Œæ¨èä½¿ç”¨æ›´å¼ºå¤§çš„å·¥å…·å¦‚ <code>VisualVM</code>ã€<code>Eclipse MAT</code> æˆ– <code>jcmd + å¤–éƒ¨å·¥å…·</code>ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># é»˜è®¤ç«¯å£7000</span></span><br><span class=\"line\">jhat &lt;heap dump file&gt;</span><br><span class=\"line\"><span class=\"comment\"># æŒ‡å®šç«¯å£</span></span><br><span class=\"line\">jhat -port 8000 &lt;heap dump file&gt;</span><br></pre></td></tr></table></figure>\n<h2 id=\"jvisualvm-å›¾å½¢åŒ–çš„-JVM-ç›‘æ§ä¸åˆ†æå·¥å…·\">jvisualvm: å›¾å½¢åŒ–çš„ JVM ç›‘æ§ä¸åˆ†æå·¥å…·</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>jvisualvmï¼ˆå…¨ç§°ï¼šJava VisualVMï¼‰æ˜¯ Java å®˜æ–¹æä¾›çš„ä¸€æ¬¾ å›¾å½¢åŒ–çš„ JVM ç›‘æ§ä¸åˆ†æå·¥å…·ï¼Œç”¨äºè§‚å¯Ÿã€åˆ†æå’Œè°ƒè¯•æ­£åœ¨è¿è¡Œçš„ Java ç¨‹åºã€‚å®ƒéå¸¸é€‚åˆå¼€å‘å’Œæµ‹è¯•ç¯å¢ƒä¸­è¿›è¡Œå†…å­˜åˆ†æã€çº¿ç¨‹åˆ†æã€GC è¡Œä¸ºè§‚å¯Ÿç­‰ä»»åŠ¡ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>åŠŸèƒ½æ¦‚è§ˆ</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>åŠŸèƒ½</th>\n<th>æè¿°</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>è¿›ç¨‹ç›‘æ§</strong></td>\n<td>æŸ¥çœ‹æœ¬åœ°æˆ–è¿œç¨‹ JVM è¿›ç¨‹çš„å†…å­˜ã€CPUã€çº¿ç¨‹ç­‰è¿è¡ŒçŠ¶æ€</td>\n</tr>\n<tr>\n<td><strong>å†…å­˜ä½¿ç”¨åˆ†æ</strong></td>\n<td>æŸ¥çœ‹å †å†…å­˜ä½¿ç”¨æƒ…å†µã€GC æ¬¡æ•°å’Œæ—¶é—´ã€ç±»å®ä¾‹åˆ†å¸ƒç­‰</td>\n</tr>\n<tr>\n<td><strong>çº¿ç¨‹åˆ†æ</strong></td>\n<td>æŸ¥çœ‹çº¿ç¨‹çŠ¶æ€ã€çº¿ç¨‹æ ˆã€æ˜¯å¦å­˜åœ¨æ­»é”</td>\n</tr>\n<tr>\n<td><strong>GC åˆ†æ</strong></td>\n<td>å›¾å½¢åŒ–å±•ç¤º GC æ´»åŠ¨ã€é¢‘ç‡ä¸è€—æ—¶</td>\n</tr>\n<tr>\n<td><strong>å †è½¬å‚¨åˆ†æ</strong></td>\n<td>å¯¼å…¥ <code>.hprof</code> æ–‡ä»¶è¿›è¡Œå¯¹è±¡å®ä¾‹ã€ç±»ã€å¼•ç”¨å…³ç³»åˆ†æ</td>\n</tr>\n<tr>\n<td><strong>CPU åˆ†æ</strong></td>\n<td>åˆ†ææ–¹æ³•è°ƒç”¨è·¯å¾„ã€è€—æ—¶ã€çƒ­ç‚¹ä»£ç ï¼ˆéœ€æ‰‹åŠ¨å¯ç”¨ CPU profilerï¼‰</td>\n</tr>\n<tr>\n<td><strong>æ’ä»¶æ”¯æŒ</strong></td>\n<td>å¯ä»¥é€šè¿‡æ’ä»¶å®‰è£…æ›´å¤šåŠŸèƒ½ï¼ˆå¦‚ Visual GCï¼‰</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¯åŠ¨ jvisualvm</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ä¸è¦åœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ï¼Œå¦‚æœæ˜¯åˆ†ææœåŠ¡ç«¯ .hprof æ–‡ä»¶ï¼Œå¯ä»¥å¯¼å‡ºåˆ°æœ¬åœ°ååœ¨æœ¬åœ°å¯åŠ¨</span></span><br><span class=\"line\">$ jvisualvm</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åœ¨ jvisualvm ä¸­å¯¼å…¥ .hprof æ–‡ä»¶</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ jvisualvm --openfile &lt;heap dump file&gt;</span><br><span class=\"line\"><span class=\"comment\"># æˆ–è€… å…ˆæ‰“å¼€ jvisualvm åï¼Œç‚¹å‡» File -&gt; Open File -&gt; é€‰æ‹© .hprof æ–‡ä»¶</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>âš ï¸ æ³¨æ„äº‹é¡¹</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>æ³¨æ„ç‚¹</th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>ä¸é€‚ç”¨äºå¤§è§„æ¨¡ç”Ÿäº§ç¯å¢ƒç›‘æ§</td>\n<td>å› ä¸ºå…¶åˆ†æè¿‡ç¨‹å¯èƒ½ä¼šå¯¹ JVM æœ‰è½»å¾®å½±å“</td>\n</tr>\n<tr>\n<td><code>.hprof</code> æ–‡ä»¶è¿‡å¤§æ—¶åŠ è½½ç¼“æ…¢</td>\n<td>å¯é…åˆ Eclipse MAT ä½¿ç”¨</td>\n</tr>\n<tr>\n<td>CPU/Memory Profiler ä¼šå¢åŠ ç³»ç»Ÿè´Ÿæ‹…</td>\n<td>ä½¿ç”¨æ—¶è°¨æ…ï¼Œå»ºè®®åªåœ¨æµ‹è¯•ç¯å¢ƒå¯ç”¨</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"Eclipse-MAT-Java-Heap-Dump-åˆ†æå·¥å…·\">Eclipse MAT: Java Heap Dump åˆ†æå·¥å…·</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><a href=\"https://eclipse.dev/mat\">Eclipse MAT</a>ï¼ˆEclipse Memory Analyzer Toolï¼‰æ˜¯ä¸€ä¸ªç”¨äºåˆ†æ Java å †å¿«ç…§çš„å·¥å…·ï¼Œå®ƒæä¾›äº†è®¸å¤šåŠŸèƒ½æ¥å¸®åŠ©å¼€å‘äººå‘˜ç†è§£ Java åº”ç”¨ç¨‹åºä¸­çš„å†…å­˜é—®é¢˜ã€‚</p>\n</li>\n</ul>\n<div class=\"tips\">\n<p><em><strong>MaxOSç³»ç»Ÿå®‰è£…Eclipse MATåï¼Œå¯åŠ¨æŠ¥é”™ï¼ŒæŠ¥é”™ä¿¡æ¯ä¸ºï¼šThe JVM shared library â€œ/Library/Internet Plug-Ins/JavaAppletPlugin.plugin/Contents/Home/bin/â€¦/lib/server/libjvm.dylibâ€ does not contain the JNI_CreateJavaVM symbol.</strong></em></p>\n<ul class=\"lvl-1\">\n<li class=\"lvl-2\">è§£å†³æ–¹æ³•ï¼š<br>\n1.åœ¨åº”ç”¨åˆ—è¡¨ï¼Œæ‰¾åˆ°<code>MemoryAnalyzer.app</code>ï¼Œç„¶åå³é”®å•å‡»åï¼Œé€‰æ‹©<code>æ˜¾ç¤ºåŒ…å†…å®¹</code>,è¿›å…¥Contentsç›®å½•ï¼Œæ‰¾åˆ°<code>Info.plist</code>æ–‡ä»¶<br>\n2.æ‰“å¼€<code>Info.plist</code>æ–‡ä»¶åï¼Œå¯ä»¥çœ‹åˆ°æ³¨é‡Š<code>&lt;string&gt;-vm&lt;/string&gt;</code>é…ç½®é¡¹ï¼Œæˆ‘ä»¬éœ€è¦åšçš„å°±æ˜¯æ‰“å¼€è¿™ä¸ªé…ç½®é¡¹ï¼Œå¹¶ä¸”å°†å…¶è®¾ç½®ä¸ºæˆ‘ä»¬ç³»ç»Ÿçš„Javaè·¯å¾„ï¼Œæœ€æ–°ç‰ˆéœ€è¦<code>jdk17+</code></li>\n</ul>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">string</span>&gt;</span>-vm<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">string</span>&gt;</span>/Users/hanqf/develop_soft/jdk17/bin/java<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></span><br></pre></td></tr></table></figure>\n</div>\n<h2 id=\"Arthas-æ¨è\">Arthas : æ¨è</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><a href=\"https://arthas.aliyun.com\">Arthas</a> æ˜¯é˜¿é‡Œå·´å·´å¼€æºçš„ä¸€æ¬¾ Java è¯Šæ–­å·¥å…·ï¼Œä¸“ä¸ºçº¿ä¸Šè¯Šæ–­è€Œè®¾è®¡ã€‚å®ƒå¯ä»¥å¸®åŠ©å¼€å‘è€…åœ¨ä¸é‡å¯ã€ä¸ä¿®æ”¹ä»£ç çš„æƒ…å†µä¸‹ï¼Œæ’æŸ¥ç”Ÿäº§ç¯å¢ƒä¸­ Java åº”ç”¨çš„é—®é¢˜ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>Arthas æ”¯æŒ JDK 6+ï¼Œæ”¯æŒ Linux/Mac/Windowsï¼Œé‡‡ç”¨å‘½ä»¤è¡Œäº¤äº’æ¨¡å¼ï¼ŒåŒæ—¶æä¾›ä¸°å¯Œçš„ Tab è‡ªåŠ¨è¡¥å…¨åŠŸèƒ½ï¼Œè¿›ä¸€æ­¥æ–¹ä¾¿è¿›è¡Œé—®é¢˜çš„å®šä½å’Œè¯Šæ–­ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>è¿™é‡Œè¦æ³¨æ„ä¸€ç‚¹ï¼Œå°±æ˜¯Arthasä»<code>4.x</code>ç‰ˆæœ¬å¼€å§‹ï¼Œéœ€è¦ä¾èµ–<code>JDK8+</code>ï¼Œå¦‚æœæ˜¯<code>JDK6/7</code>ï¼Œå¯ä»¥ä¸‹è½½æœ€åä¸€ä¸ª3.xç‰ˆæœ¬ <a href=\"https://github.com/alibaba/arthas/releases/tag/arthas-all-3.7.2\">3.7.2</a>ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä¸ºäº†æ–¹ä¾¿æˆ‘ä»¬å­¦ä¹ ï¼ŒArthasè¿˜ä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªç»ƒä¹ åœºï¼Œ<a href=\"https://killercoda.com/arthas/course/arthas-tutorials-cn\">Arthas Playground</a>ã€‚</p>\n</li>\n</ul>\n<h3 id=\"Arthas-æ ¸å¿ƒç‰¹ç‚¹\">Arthas æ ¸å¿ƒç‰¹ç‚¹</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ— éœ€é‡å¯ã€ä¾µå…¥æ€§ä½<br>\nArthas å¯ä»¥ attach åˆ°æ­£åœ¨è¿è¡Œçš„ JVM ä¸Šï¼Œä¸éœ€è¦é‡å¯æœåŠ¡æˆ–ä¿®æ”¹æºä»£ç ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å‘½ä»¤å¼äº¤äº’ä½“éªŒ<br>\nç±»ä¼¼ Linux shell çš„æ“ä½œæ–¹å¼ï¼Œæ”¯æŒ tab è¡¥å…¨ã€ä¸Šä¸‹é”®å†å²å‘½ä»¤ç­‰ï¼Œéå¸¸ç›´è§‚ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å®æ—¶æŸ¥çœ‹å’Œç›‘æ§<br>\nå¯æŸ¥çœ‹æ–¹æ³•å‚æ•°ã€è¿”å›å€¼ã€è°ƒç”¨æ ˆã€æ‰§è¡Œè€—æ—¶ã€JVM çº¿ç¨‹ã€å†…å­˜ç­‰å®æ—¶æ•°æ®ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å¤šç§è¿æ¥æ–¹å¼<br>\næ”¯æŒå‘½ä»¤è¡Œç»ˆç«¯ã€æœ¬åœ° shellã€Web é¡µé¢ã€telnet ç­‰å¤šç§è¿æ¥æ–¹å¼ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>æ”¯æŒå¤šç§ JVM ç‰ˆæœ¬<br>\næ”¯æŒ Java 6+ï¼ŒåŒ…æ‹¬ OpenJDKã€Oracle JDKã€Alibaba Dragonwell ç­‰ã€‚</p>\n</li>\n</ul>\n<h3 id=\"Arthas-å¸¸ç”¨å‘½ä»¤\">Arthas å¸¸ç”¨å‘½ä»¤</h3>\n<h4 id=\"å¯åŠ¨\">å¯åŠ¨</h4>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">java -jar arthas-boot.jar</span><br><span class=\"line\"><span class=\"comment\">## è¾“å‡º</span></span><br><span class=\"line\">java -jar arthas-boot.jar --target-ip 0.0.0.0</span><br><span class=\"line\">[INFO] JAVA_HOME: /Library/Java/JavaVirtualMachines/jdk1.8.0_271.jdk/Contents/Home/jre</span><br><span class=\"line\">[INFO] arthas-boot version: 4.0.5</span><br><span class=\"line\">[INFO] Process 43959 already using port 3658</span><br><span class=\"line\">[INFO] Process 43959 already using port 8563</span><br><span class=\"line\">[INFO] Found existing java process, please choose one and input the serial number of the process, eg : 1. Then hit ENTER.</span><br><span class=\"line\">* [1]: 43959 demo-arthas-spring-boot.jar</span><br><span class=\"line\">  [2]: 50851 org.jetbrains.idea.maven.server.RemoteMavenServer36</span><br><span class=\"line\">  [3]: 50813 org.sonarsource.sonarlint.core.backend.cli.SonarLintServerCli</span><br><span class=\"line\">  [4]: 50655 com.intellij.idea.Main</span><br><span class=\"line\"><span class=\"comment\"># å¯åŠ¨åï¼Œä¼šè‡ªåŠ¨è¿›å…¥äº¤äº’æ¨¡å¼ï¼Œæ­¤æ—¶è¾“å…¥è¦ç›‘æ§çš„è¿›ç¨‹åºå·</span></span><br><span class=\"line\">1 <span class=\"comment\"># æ¯”å¦‚è¿™é‡Œè¾“å…¥ 1 å›è½¦</span></span><br><span class=\"line\"><span class=\"comment\">## è¾“å‡º</span></span><br><span class=\"line\">[INFO] arthas home: /Users/hanqf/.arthas/lib/4.0.5/arthas</span><br><span class=\"line\">[INFO] The target process already listen port 3658, skip attach.</span><br><span class=\"line\">[INFO] arthas-client connect 0.0.0.0 3658</span><br><span class=\"line\">  ,---.  ,------. ,--------.,--.  ,--.  ,---.   ,---.</span><br><span class=\"line\"> /  O  \\ |  .--. <span class=\"string\">&#x27;&#x27;</span>--.  .--<span class=\"string\">&#x27;|  &#x27;</span>--<span class=\"string\">&#x27;  | /  O  \\ &#x27;</span>   .-<span class=\"string\">&#x27;</span></span><br><span class=\"line\"><span class=\"string\">|  .-.  ||  &#x27;</span>--<span class=\"string\">&#x27;.&#x27;</span>   |  |   |  .--.  ||  .-.  |`.  `-.</span><br><span class=\"line\">|  | |  ||  |\\  \\    |  |   |  |  |  ||  | |  |.-<span class=\"string\">&#x27;    |</span></span><br><span class=\"line\"><span class=\"string\">`--&#x27;</span> `--<span class=\"string\">&#x27;`--&#x27;</span> <span class=\"string\">&#x27;--&#x27;</span>   `--<span class=\"string\">&#x27;   `--&#x27;</span>  `--<span class=\"string\">&#x27;`--&#x27;</span> `--<span class=\"string\">&#x27;`-----&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\">wiki        https://arthas.aliyun.com/doc</span><br><span class=\"line\">tutorials   https://arthas.aliyun.com/doc/arthas-tutorials.html</span><br><span class=\"line\">version     4.0.5</span><br><span class=\"line\">main_class  demo-arthas-spring-boot.jar</span><br><span class=\"line\">pid         43959</span><br><span class=\"line\">start_time  2025-05-14 14:57:18.031</span><br><span class=\"line\">currnt_time 2025-05-14 14:59:22.004</span><br><span class=\"line\"></span><br><span class=\"line\">[arthas@43959]$ <span class=\"comment\"># æ­¤æ—¶è¿›å…¥ arthas å‘½ä»¤è¡Œäº¤äº’çŠ¶æ€</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># é€€å‡º arthas</span></span><br><span class=\"line\">[arthas@43959]$ stop <span class=\"comment\"># é€€å‡º arthas</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>arthas å‘½ä»¤æœ‰å¾ˆå¤šï¼Œå½“å¸¸ç”¨çš„ä¹Ÿå°±å‡ ä¸ªï¼Œå¦å¤–å¦‚æœè®°ä¸ä½æŸä¸ªå‘½ä»¤æ€ä¹ˆç”¨äº†å¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤æŸ¥è¯¢</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;<span class=\"built_in\">command</span>&gt; -h æˆ–è€… <span class=\"built_in\">help</span> &lt;<span class=\"built_in\">command</span>&gt;</span><br></pre></td></tr></table></figure>\n<h4 id=\"dashboard-å®æ—¶æŸ¥çœ‹-JVM-è¿è¡ŒçŠ¶æ€\">dashboard :  å®æ—¶æŸ¥çœ‹ JVM è¿è¡ŒçŠ¶æ€</h4>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹ JVM è¿è¡ŒçŠ¶æ€ï¼Œ é»˜è®¤æ¯éš” 5 ç§’åˆ·æ–° CPUã€å†…å­˜ã€çº¿ç¨‹ã€GC ç­‰ä¿¡æ¯</span></span><br><span class=\"line\"><span class=\"comment\"># é»˜è®¤ä¼šä¸€ç›´åˆ·æ–°çŠ¶æ€ï¼ŒæŒ‰ `q` æˆ–  `Ctrl+C` é€€å‡º</span></span><br><span class=\"line\">dashboard</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ¯éš” 2 ç§’åˆ·æ–°ä¸€æ¬¡</span></span><br><span class=\"line\">dashboard -i 2000</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åˆ·æ–° 10 æ¬¡ååœæ­¢</span></span><br><span class=\"line\">dashboard -n 10</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ¯éš” 2 ç§’åˆ·æ–°ä¸€æ¬¡ï¼Œåˆ·æ–° 10 æ¬¡ååœæ­¢</span></span><br><span class=\"line\">dashboard -i 2000 -n 10</span><br></pre></td></tr></table></figure>\n<p><img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/uPic/2L73Hi.png\" alt=\"\" width=\"1400\" height=\"900\"></p>\n<h4 id=\"thread-æŸ¥çœ‹å½“å‰-JVM-çº¿ç¨‹ä¿¡æ¯\">thread : æŸ¥çœ‹å½“å‰ JVM çº¿ç¨‹ä¿¡æ¯</h4>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹å½“å‰ JVM çº¿ç¨‹ä¿¡æ¯ï¼ŒæŒ‰ CPU ä½¿ç”¨ç‡å€’åº</span></span><br><span class=\"line\">thread</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹æ‰€æœ‰çº¿ç¨‹ä¿¡æ¯</span></span><br><span class=\"line\">thread --all</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹æŒ‡å®šçº¿ç¨‹çš„å †æ ˆä¿¡æ¯</span></span><br><span class=\"line\">thread 18</span><br><span class=\"line\"><span class=\"comment\">## è¾“å‡º</span></span><br><span class=\"line\"><span class=\"string\">&quot;http-nio-80-exec-1&quot;</span> Id=18 WAITING on java.util.concurrent.locks.AbstractQueuedSynchronizer<span class=\"variable\">$ConditionObject</span>@51866c16</span><br><span class=\"line\">    at sun.misc.Unsafe.park(Native Method)</span><br><span class=\"line\">    -  waiting on java.util.concurrent.locks.AbstractQueuedSynchronizer<span class=\"variable\">$ConditionObject</span>@51866c16</span><br><span class=\"line\">    at java.util.concurrent.locks.LockSupport.park(LockSupport.java:175)</span><br><span class=\"line\">    at java.util.concurrent.locks.AbstractQueuedSynchronizer<span class=\"variable\">$ConditionObject</span>.await(AbstractQueuedSynchronizer.java:2039)</span><br><span class=\"line\">    at java.util.concurrent.LinkedBlockingQueue.take(LinkedBlockingQueue.java:442)</span><br><span class=\"line\">    at org.apache.tomcat.util.threads.TaskQueue.take(TaskQueue.java:103)</span><br><span class=\"line\">    at org.apache.tomcat.util.threads.TaskQueue.take(TaskQueue.java:31)</span><br><span class=\"line\">    at java.util.concurrent.ThreadPoolExecutor.getTask(ThreadPoolExecutor.java:1074)</span><br><span class=\"line\">    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1134)</span><br><span class=\"line\">    at java.util.concurrent.ThreadPoolExecutor<span class=\"variable\">$Worker</span>.run(ThreadPoolExecutor.java:624)</span><br><span class=\"line\">    at org.apache.tomcat.util.threads.TaskThread<span class=\"variable\">$WrappingRunnable</span>.run(TaskThread.java:61)</span><br><span class=\"line\">    at java.lang.Thread.run(Thread.java:748)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹æœ€å¿™çš„å‰5ä¸ªçº¿ç¨‹çš„å †æ ˆä¿¡æ¯</span></span><br><span class=\"line\">thread -n 5</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹å…¨éƒ¨çº¿ç¨‹çš„å †æ ˆä¿¡æ¯</span></span><br><span class=\"line\">thread -n -1</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŒ‡å®š cpu ä½¿ç”¨ç‡ç»Ÿè®¡çš„é‡‡æ ·é—´éš”ï¼Œå•ä½ä¸ºæ¯«ç§’ï¼Œé»˜è®¤å€¼ä¸º 200</span></span><br><span class=\"line\">thread -i 500</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ‰¾å‡ºå½“å‰é˜»å¡å…¶ä»–çº¿ç¨‹çš„çº¿ç¨‹</span></span><br><span class=\"line\">thread -b</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹æŒ‡å®šçŠ¶æ€çš„çº¿ç¨‹</span></span><br><span class=\"line\">thread --state WAITING</span><br></pre></td></tr></table></figure>\n<h4 id=\"sc-æŸ¥çœ‹-JVM-å·²åŠ è½½çš„ç±»ä¿¡æ¯\">sc : æŸ¥çœ‹ JVM å·²åŠ è½½çš„ç±»ä¿¡æ¯</h4>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><code>Search-Class</code> çš„ç®€å†™ï¼Œè¿™ä¸ªå‘½ä»¤èƒ½æœç´¢å‡ºæ‰€æœ‰å·²ç»åŠ è½½åˆ° JVM ä¸­çš„ Class ä¿¡æ¯</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># é€šé…ç¬¦åŒ¹é…ï¼Œæ‰“å°æœç´¢åˆ°çš„ç±»å…¨å</span></span><br><span class=\"line\">sc *.demo.*</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ‰“å°ç±»çš„è¯¦ç»†ä¿¡æ¯</span></span><br><span class=\"line\">sc -d com.example.demo.arthas.AdminFilterConfig</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ‰“å°å‡ºç±»çš„ Field ä¿¡æ¯</span></span><br><span class=\"line\">sc -d -f com.example.demo.arthas.AdminFilterConfig</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># é€šé…ç¬¦æŸ¥è¯¢å¹¶è·å–classLoaderHash</span></span><br><span class=\"line\">sc -d *AdminFilterConfig | grep classLoaderHash</span><br></pre></td></tr></table></figure>\n<h4 id=\"sm-æŸ¥çœ‹å·²åŠ è½½ç±»çš„æ–¹æ³•ä¿¡æ¯\">sm  : æŸ¥çœ‹å·²åŠ è½½ç±»çš„æ–¹æ³•ä¿¡æ¯</h4>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><code>Search-Method</code> çš„ç®€å†™ï¼Œè¿™ä¸ªå‘½ä»¤èƒ½æœç´¢å‡ºæ‰€æœ‰å·²ç»åŠ è½½åˆ° JVM ä¸­çš„ Method ä¿¡æ¯</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æ‰“å°æŒ‡å®šç±»ä¸­çš„æ–¹æ³•</span></span><br><span class=\"line\">sm java.lang.String</span><br><span class=\"line\"><span class=\"comment\"># å±•ç¤ºæ–¹æ³•çš„è¯¦ç»†ä¿¡æ¯</span></span><br><span class=\"line\">sm -d java.lang.String</span><br><span class=\"line\"><span class=\"comment\"># å±•ç¤ºæŒ‡å®šæ–¹æ³•çš„è¯¦ç»†ä¿¡æ¯</span></span><br><span class=\"line\">sm -d java.lang.String substring</span><br><span class=\"line\"><span class=\"comment\"># æ¨¡ç³ŠåŒ¹é…</span></span><br><span class=\"line\">sm -d java.lang.String eq*</span><br></pre></td></tr></table></figure>\n<h4 id=\"jad-Javaæºç åç¼–è¯‘å·¥å…·\">jad : Javaæºç åç¼–è¯‘å·¥å…·</h4>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>éªŒè¯ç”Ÿäº§ç¯å¢ƒä¸‹çš„ä»£ç æ˜¯å¦ä¸æäº¤çš„ä»£ç ä¸€è‡´</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æ‰“å°å‡ºç±»çš„æºç ï¼Œç±»å</span></span><br><span class=\"line\">jad com.example.demo.arthas.user.UserController</span><br><span class=\"line\"><span class=\"comment\">## è¾“å‡º</span></span><br><span class=\"line\">jad com.example.demo.arthas.user.UserController</span><br><span class=\"line\"></span><br><span class=\"line\">ClassLoader:</span><br><span class=\"line\">+-org.springframework.boot.loader.LaunchedURLClassLoader@5b2133b1</span><br><span class=\"line\">  +-sun.misc.Launcher<span class=\"variable\">$AppClassLoader</span>@5c647e05</span><br><span class=\"line\">    +-sun.misc.Launcher<span class=\"variable\">$ExtClassLoader</span>@452b3a41</span><br><span class=\"line\"></span><br><span class=\"line\">Location:</span><br><span class=\"line\">file:/Users/hanqf/Desktop/arhtas_dir/demo-arthas-spring-boot.jar!/BOOT-INF/classes!/</span><br><span class=\"line\"></span><br><span class=\"line\">       /*</span><br><span class=\"line\">        * Decompiled with CFR.</span><br><span class=\"line\">        *</span><br><span class=\"line\">        * Could not load the following classes:</span><br><span class=\"line\">        *  com.example.demo.arthas.user.User</span><br><span class=\"line\">        *  org.slf4j.Logger</span><br><span class=\"line\">        *  org.slf4j.LoggerFactory</span><br><span class=\"line\">        *  org.springframework.web.bind.annotation.GetMapping</span><br><span class=\"line\">        *  org.springframework.web.bind.annotation.PathVariable</span><br><span class=\"line\">        *  org.springframework.web.bind.annotation.RestController</span><br><span class=\"line\">        */</span><br><span class=\"line\">       package com.example.demo.arthas.user;</span><br><span class=\"line\"></span><br><span class=\"line\">       import com.example.demo.arthas.user.User;</span><br><span class=\"line\">       import org.slf4j.Logger;</span><br><span class=\"line\">       import org.slf4j.LoggerFactory;</span><br><span class=\"line\">       import org.springframework.web.bind.annotation.GetMapping;</span><br><span class=\"line\">       import org.springframework.web.bind.annotation.PathVariable;</span><br><span class=\"line\">       import org.springframework.web.bind.annotation.RestController;</span><br><span class=\"line\"></span><br><span class=\"line\">       @RestController</span><br><span class=\"line\">       public class UserController &#123;</span><br><span class=\"line\">           private static final Logger logger = LoggerFactory.getLogger(UserController.class);</span><br><span class=\"line\"></span><br><span class=\"line\">           @GetMapping(value=&#123;<span class=\"string\">&quot;/user/&#123;id&#125;&quot;</span>&#125;)</span><br><span class=\"line\">           public User findUserById(@PathVariable Integer <span class=\"built_in\">id</span>) &#123;</span><br><span class=\"line\">/*15*/         logger.info(<span class=\"string\">&quot;id: &#123;&#125;&quot;</span>, (Object)<span class=\"built_in\">id</span>);</span><br><span class=\"line\">/*17*/         <span class=\"keyword\">if</span> (<span class=\"built_in\">id</span> != null &amp;&amp; <span class=\"built_in\">id</span> &lt; 1) &#123;</span><br><span class=\"line\">                   throw new IllegalArgumentException(<span class=\"string\">&quot;id &lt; 1&quot;</span>);</span><br><span class=\"line\">               &#125;</span><br><span class=\"line\">               <span class=\"built_in\">return</span> new User(id.intValue(), <span class=\"string\">&quot;name&quot;</span> + <span class=\"built_in\">id</span>);</span><br><span class=\"line\">           &#125;</span><br><span class=\"line\">       &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">Affect(row-cnt:1) cost <span class=\"keyword\">in</span> 411 ms.</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åç¼–è¯‘åçš„æºç ä¼šæœ‰ç±»åŠ è½½å™¨çš„ä¿¡æ¯ï¼Œå¦‚æœåªå¸Œæœ›æ‰“å°æºç ï¼Œå¯ä»¥åŠ ä¸Š --source-only</span></span><br><span class=\"line\">jad --source-only com.example.demo.arthas.user.UserController</span><br><span class=\"line\"><span class=\"comment\"># ä¸æ˜¾ç¤ºè¡Œå·</span></span><br><span class=\"line\">jad --source-only com.example.demo.arthas.user.UserController --lineNumber <span class=\"literal\">false</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># è¾“å‡ºåˆ°æ–‡ä»¶</span></span><br><span class=\"line\">jad --source-only com.example.demo.arthas.user.UserController &gt; /tmp/UserController.java</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ‰“å°å‡ºç±»ä¸­æŸä¸ªæ–¹æ³•çš„æºç ï¼Œç±»å + æ–¹æ³•å</span></span><br><span class=\"line\">jad com.example.demo.arthas.user.UserController findUserById</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åç¼–è¯‘æ—¶æŒ‡å®šdump classæ–‡ä»¶ç›®å½•</span></span><br><span class=\"line\">jad --source-only com.example.demo.arthas.user.UserController --lineNumber <span class=\"literal\">false</span> -d /tmp/jad</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å½“æœ‰å¤šä¸ª ClassLoader éƒ½åŠ è½½äº†è¿™ä¸ªç±»æ—¶ï¼Œjad å‘½ä»¤ä¼šè¾“å‡ºå¯¹åº” ClassLoader å®ä¾‹çš„ hashcodeï¼Œç„¶åä½ åªéœ€è¦é‡æ–°æ‰§è¡Œ jad å‘½ä»¤ï¼Œå¹¶ä½¿ç”¨å‚æ•° -c <hashcode> å°±å¯ä»¥åç¼–è¯‘æŒ‡å®š ClassLoader åŠ è½½çš„é‚£ä¸ªç±»äº†ï¼›</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ jad org.apache.log4j.Logger</span><br><span class=\"line\"></span><br><span class=\"line\">Found more than one class <span class=\"keyword\">for</span>: org.apache.log4j.Logger, Please use jad -c hashcode org.apache.log4j.Logger</span><br><span class=\"line\">HASHCODE  CLASSLOADER</span><br><span class=\"line\">69dcaba4  +-monitor<span class=\"string\">&#x27;s ModuleClassLoader</span></span><br><span class=\"line\"><span class=\"string\">6e51ad67  +-java.net.URLClassLoader@6e51ad67</span></span><br><span class=\"line\"><span class=\"string\">            +-sun.misc.Launcher$AppClassLoader@6951a712</span></span><br><span class=\"line\"><span class=\"string\">            +-sun.misc.Launcher$ExtClassLoader@6fafc4c2</span></span><br><span class=\"line\"><span class=\"string\">2bdd9114  +-pandora-qos-service&#x27;</span>s ModuleClassLoader</span><br><span class=\"line\">4c0df5f8  +-pandora-framework<span class=\"string\">&#x27;s ModuleClassLoader</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">Affect(row-cnt:0) cost in 38 ms.</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\"># æŒ‡å®šç±»åŠ è½½å™¨</span></span><br><span class=\"line\"><span class=\"string\">$ jad org.apache.log4j.Logger -c 69dcaba4</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"mc-Memory-Compiler-å†…å­˜ç¼–è¯‘å™¨ï¼Œç¼–è¯‘-javaæ–‡ä»¶ç”Ÿæˆ-class\">mc : Memory Compiler/å†…å­˜ç¼–è¯‘å™¨ï¼Œç¼–è¯‘<code>.java</code>æ–‡ä»¶ç”Ÿæˆ<code>.class</code></h4>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ç¼–è¯‘ï¼Œè¿™é‡Œä¸€å®šè¦æŒ‡å®šç±»åŠ è½½å™¨ï¼Œå¦åˆ™ä¼šæŠ¥é”™ï¼Œå› ä¸ºä½ ç¼–è¯‘çš„ç±»ä¸­å¯èƒ½importå…¶å®ƒç±»ï¼Œä¸æŒ‡å®šå°±ä¼šæç¤ºæ‰¾ä¸åˆ°å¯¹åº”çš„ç±»ã€‚</span></span><br><span class=\"line\"><span class=\"comment\"># ç±»åŠ è½½å™¨å¯ä»¥é€šè¿‡ jad å‘½ä»¤è·å–</span></span><br><span class=\"line\">mc --classLoaderClass org.springframework.boot.loader.LaunchedURLClassLoader /tmp/UserController.java</span><br><span class=\"line\"><span class=\"comment\"># æŒ‡å®šç±»åŠ è½½å™¨çš„ç¼–å·</span></span><br><span class=\"line\">mc -c 5b2133b1 /tmp/UserController.java</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å°† UserController.class æ–‡ä»¶è¾“å‡ºåˆ°æŒ‡å®šç›®å½•ï¼Œ -d æŒ‡å®šè¾“å‡ºç›®å½•</span></span><br><span class=\"line\">mc --classLoaderClass org.springframework.boot.loader.LaunchedURLClassLoader /tmp/UserController.java -d /tmp</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>mc å‘½ä»¤æœ‰å¯èƒ½å¤±è´¥ã€‚å¦‚æœç¼–è¯‘å¤±è´¥å¯ä»¥åœ¨æœ¬åœ°ç¼–è¯‘å¥½.classæ–‡ä»¶ï¼Œå†ä¸Šä¼ åˆ°æœåŠ¡å™¨ã€‚</p>\n</li>\n</ul>\n<h4 id=\"retransform-é‡æ–°åŠ è½½ç±»-çƒ­ä¿®æ”¹ä»£ç \">retransform : é‡æ–°åŠ è½½ç±»(çƒ­ä¿®æ”¹ä»£ç )</h4>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">retransform /tmp/com/example/demo/arthas/user/UserController.class</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹ é€šè¿‡ retransform é‡æ–°åŠ è½½çš„ class</span></span><br><span class=\"line\">retransform -l</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åˆ é™¤é€šè¿‡ retransform é‡æ–°åŠ è½½çš„ classï¼Œé€šè¿‡ id åˆ é™¤</span></span><br><span class=\"line\">retransform -d 1</span><br><span class=\"line\"><span class=\"comment\"># åˆ é™¤æ‰€æœ‰</span></span><br><span class=\"line\">retransform --deleteAll</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åˆ é™¤åè¦é‡æ–°è§¦å‘ retransformï¼Œå¦åˆ™å†…å­˜ä¸­ä¾æ—§ä½¿ç”¨çš„æ˜¯åˆ é™¤å‰çš„ class</span></span><br><span class=\"line\">retransform --classPattern com.example.demo.arthas.user.UserController</span><br></pre></td></tr></table></figure>\n<h4 id=\"sysprop-æŸ¥çœ‹å½“å‰-JVM-çš„ç³»ç»Ÿå±æ€§\">sysprop : æŸ¥çœ‹å½“å‰ JVM çš„ç³»ç»Ÿå±æ€§</h4>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æ‰“å°ç³»ç»Ÿå±æ€§</span></span><br><span class=\"line\">sysprop</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŒ‡å®šå•ä¸ª keyï¼Œkeyæ”¯æŒè‡ªåŠ¨è¡¥å…¨</span></span><br><span class=\"line\">sysprop java.version</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># é€šè¿‡grepè¿‡æ»¤</span></span><br><span class=\"line\">sysprop | grep user</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># è®¾ç½® æˆ– ä¿®æ”¹ ç³»ç»Ÿå±æ€§</span></span><br><span class=\"line\">sysprop testKey testValue</span><br></pre></td></tr></table></figure>\n<h4 id=\"sysenv-æŸ¥çœ‹å½“å‰-JVM-çš„ç¯å¢ƒå˜é‡\">sysenv : æŸ¥çœ‹å½“å‰ JVM çš„ç¯å¢ƒå˜é‡</h4>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åˆ—å‡ºæ‰€æœ‰ç¯å¢ƒå˜é‡</span></span><br><span class=\"line\">sysenv</span><br><span class=\"line\"><span class=\"comment\"># æŒ‡å®šå•ä¸ª keyï¼Œkeyæ”¯æŒè‡ªåŠ¨è¡¥å…¨</span></span><br><span class=\"line\">sysenv PATH</span><br><span class=\"line\"><span class=\"comment\"># é€šè¿‡grepè¿‡æ»¤</span></span><br><span class=\"line\">sysenv | grep PATH</span><br></pre></td></tr></table></figure>\n<h4 id=\"jvm-æŸ¥çœ‹å½“å‰-JVM-çš„ä¿¡æ¯ï¼ŒåŒ…å«å¾ˆå¤šé‡è¦çš„ä¿¡æ¯\">jvm : æŸ¥çœ‹å½“å‰ JVM çš„ä¿¡æ¯ï¼ŒåŒ…å«å¾ˆå¤šé‡è¦çš„ä¿¡æ¯</h4>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">jvm</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><code>GARBAGE-COLLECTORS </code> GC ç›¸å…³</p>\n</li>\n<li class=\"lvl-2\">\n<p><code>THREAD</code> ç›¸å…³</p>\n</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">COUNT: JVM å½“å‰æ´»è·ƒçš„çº¿ç¨‹æ•°</span><br><span class=\"line\">DAEMON-COUNT: JVM å½“å‰æ´»è·ƒçš„å®ˆæŠ¤çº¿ç¨‹æ•°</span><br><span class=\"line\">PEAK-COUNT: ä» JVM å¯åŠ¨å¼€å§‹æ›¾ç»æ´»ç€çš„æœ€å¤§çº¿ç¨‹æ•°</span><br><span class=\"line\">STARTED-COUNT: ä» JVM å¯åŠ¨å¼€å§‹æ€»å…±å¯åŠ¨è¿‡çš„çº¿ç¨‹æ¬¡æ•°</span><br><span class=\"line\">DEADLOCK-COUNT: JVM å½“å‰æ­»é”çš„çº¿ç¨‹æ•°</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><code>FILE-DESCRIPTOR</code> æ–‡ä»¶æè¿°ç¬¦ç›¸å…³</p>\n</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">MAX-FILE-DESCRIPTOR-COUNTï¼šJVM è¿›ç¨‹æœ€å¤§å¯ä»¥æ‰“å¼€çš„æ–‡ä»¶æè¿°ç¬¦æ•°</span><br><span class=\"line\">OPEN-FILE-DESCRIPTOR-COUNTï¼šJVM å½“å‰æ‰“å¼€çš„æ–‡ä»¶æè¿°ç¬¦æ•°</span><br></pre></td></tr></table></figure>\n<h4 id=\"watch-å‡½æ•°æ‰§è¡Œæ•°æ®è§‚æµ‹\">watch : å‡½æ•°æ‰§è¡Œæ•°æ®è§‚æµ‹</h4>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è®©ä½ èƒ½æ–¹ä¾¿çš„è§‚å¯Ÿåˆ°æŒ‡å®šå‡½æ•°çš„è°ƒç”¨æƒ…å†µã€‚èƒ½è§‚å¯Ÿåˆ°çš„èŒƒå›´ä¸ºï¼šè¿”å›å€¼ã€æŠ›å‡ºå¼‚å¸¸ã€å…¥å‚ï¼Œé€šè¿‡ç¼–å†™ OGNL è¡¨è¾¾å¼è¿›è¡Œå¯¹åº”å˜é‡çš„æŸ¥çœ‹ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># è§‚å¯ŸæŒ‡å®šç±»ä¸­æŸä¸ªæ–¹æ³•çš„è°ƒç”¨æƒ…å†µï¼ŒclassName +  methodName + è¿”å›å€¼è¡¨è¾¾å¼</span></span><br><span class=\"line\"><span class=\"comment\"># å¼€å¯åï¼Œå½“æ–¹æ³•è¢«è°ƒç”¨æ—¶ï¼Œä¼šæŒ‰ç…§æŒ‡å®šçš„ `è¿”å›å€¼è¡¨è¾¾å¼` è¾“å‡ºç»“æœï¼Œè¿”å›å€¼è¡¨è¾¾å¼ å¯ä»¥ä¸æŒ‡å®šï¼Œé»˜è®¤ä¸º &#123;params, target, returnObj&#125;</span></span><br><span class=\"line\">watch com.example.demo.arthas.user.UserController findUserById <span class=\"string\">&#x27;&#123;params, throwExp&#125;&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># è§‚å¯Ÿå…¨éƒ¨æ–¹æ³•ï¼Œé€šé…ç¬¦åŒ¹é…</span></span><br><span class=\"line\">watch com.example.demo.arthas.user.UserController <span class=\"string\">&#x27;*&#x27;</span> <span class=\"string\">&#x27;&#123;params, throwExp&#125;&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># é»˜è®¤è¾“å‡ºç»“æœæ²¡æœ‰å±•å¼€ï¼Œå¯ä»¥åŠ ä¸Š -x æŒ‡å®šè¾“å‡ºç»“æœçš„å±æ€§éå†æ·±åº¦ï¼Œé»˜è®¤ä¸º 1ï¼Œæœ€å¤§å€¼æ˜¯ 4</span></span><br><span class=\"line\">watch com.example.demo.arthas.user.UserController <span class=\"string\">&#x27;*&#x27;</span> <span class=\"string\">&#x27;&#123;params, throwExp&#125;&#x27;</span> -x 2</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ä»…å½“æŠ›å‡ºå¼‚å¸¸æ—¶æ‰æ‰“å°ï¼Œ-e åœ¨å‡½æ•°å¼‚å¸¸ä¹‹åè§‚å¯Ÿ</span></span><br><span class=\"line\">watch com.example.demo.arthas.user.UserController <span class=\"string\">&#x27;*&#x27;</span> <span class=\"string\">&#x27;&#123;params, throwExp&#125;&#x27;</span> -x 2 -e</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å‚æ•°æ¡ä»¶è¿‡æ»¤ï¼Œparams[0] &gt; 100 è¡¨ç¤ºæ–¹æ³•å…¥å‚ä¸­ç¬¬ä¸€ä¸ªå‚æ•°çš„å€¼å¤§äº 100 æ—¶æ‰è§¦å‘æ‰“å°</span></span><br><span class=\"line\">watch com.example.demo.arthas.user.UserController * returnObj <span class=\"string\">&#x27;params[0] &gt; 100&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŒ‰è¯·æ±‚è€—æ—¶è¿›è¡Œè¿‡æ»¤ï¼Œ#cost&gt;200 è¡¨ç¤ºè€—æ—¶å¤§äº200ms</span></span><br><span class=\"line\">watch com.example.demo.arthas.user.UserController * <span class=\"string\">&#x27;&#123;params, returnObj&#125;&#x27;</span> <span class=\"string\">&#x27;#cost&gt;200&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># é€€å‡ºwatch</span></span><br><span class=\"line\">q</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>watch å‘½ä»¤è¡¨è¾¾å¼æ”¯æŒå˜é‡è¯´æ˜è¡¨</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>åç§°</th>\n<th>ç±»å‹/è¯´æ˜</th>\n<th>ä½œç”¨/å«ä¹‰</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>loader</code></td>\n<td><code>ClassLoader</code></td>\n<td>æ–¹æ³•æ‰€åœ¨ç±»çš„ç±»åŠ è½½å™¨å¯¹è±¡</td>\n</tr>\n<tr>\n<td><code>clazz</code></td>\n<td><code>Class&lt;?&gt;</code></td>\n<td>æ–¹æ³•æ‰€å±çš„ç±»ï¼ˆ<code>Class</code> å¯¹è±¡ï¼‰</td>\n</tr>\n<tr>\n<td><code>method</code></td>\n<td><code>java.lang.reflect.Method</code></td>\n<td>è¢«è°ƒç”¨çš„æ–¹æ³•çš„åå°„å¯¹è±¡</td>\n</tr>\n<tr>\n<td><code>target</code></td>\n<td><code>Object</code></td>\n<td>æ–¹æ³•çš„è°ƒç”¨ç›®æ ‡å¯¹è±¡ï¼ˆå³ <code>this</code> å¯¹è±¡ï¼‰ï¼Œé™æ€æ–¹æ³•ä¸­ä¸º <code>null</code></td>\n</tr>\n<tr>\n<td><code>params</code></td>\n<td><code>Object[]</code></td>\n<td>æ–¹æ³•çš„å…¥å‚æ•°ç»„</td>\n</tr>\n<tr>\n<td><code>returnObj</code></td>\n<td><code>Object</code></td>\n<td>æ–¹æ³•çš„è¿”å›å€¼</td>\n</tr>\n<tr>\n<td><code>throwExp</code></td>\n<td><code>Throwable</code></td>\n<td>æ–¹æ³•æŠ›å‡ºçš„å¼‚å¸¸</td>\n</tr>\n<tr>\n<td><code>isBefore</code></td>\n<td><code>boolean</code></td>\n<td>å½“å‰æ‰§è¡Œä½ç½®æ˜¯å¦æ˜¯æ–¹æ³•è°ƒç”¨<strong>ä¹‹å‰</strong>ï¼ˆ<code>BEFORE</code> é˜¶æ®µï¼‰</td>\n</tr>\n<tr>\n<td><code>isThrow</code></td>\n<td><code>boolean</code></td>\n<td>å½“å‰æ–¹æ³•æ˜¯å¦ä»¥å¼‚å¸¸ç»“æŸï¼ˆ<code>THROWS</code> é˜¶æ®µï¼‰</td>\n</tr>\n<tr>\n<td><code>isReturn</code></td>\n<td><code>boolean</code></td>\n<td>å½“å‰æ–¹æ³•æ˜¯å¦æ­£å¸¸è¿”å›ï¼ˆ<code>RETURN</code> é˜¶æ®µï¼‰</td>\n</tr>\n</tbody>\n</table>\n<h4 id=\"jobs-æŸ¥çœ‹è¿è¡Œä¸­çš„ä»»åŠ¡\">jobs : æŸ¥çœ‹è¿è¡Œä¸­çš„ä»»åŠ¡</h4>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å¦‚ä¸‹å‘½ä»¤ä¼šè½¬åˆ°åå°è¿è¡Œ ï¼Œä¸linuxå‘½ä»¤ç±»ä¼¼ï¼Œå‘½ä»¤æœ€ååŠ ä¸Š `&amp;` å³å¯</span></span><br><span class=\"line\">watch com.example.demo.arthas.user.UserController * <span class=\"string\">&#x27;&#123;params, throwExp&#125;&#x27;</span> <span class=\"string\">&#x27;throwExp != null&#x27;</span> &gt;&gt; a.log &amp;</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹åå°ä»»åŠ¡</span></span><br><span class=\"line\"><span class=\"built_in\">jobs</span></span><br><span class=\"line\"><span class=\"comment\">## è¾“å‡º</span></span><br><span class=\"line\">[1]*</span><br><span class=\"line\">       Running           watch com.example.demo.arthas.user.UserController * <span class=\"string\">&#x27;&#123;params, throwExp&#125;&#x27;</span> <span class=\"string\">&#x27;throwExp != null&#x27;</span> &gt;&gt; a.log &amp;</span><br><span class=\"line\">       execution count : 0</span><br><span class=\"line\">       start time      : Thu May 15 15:10:04 CST 2025</span><br><span class=\"line\">       <span class=\"built_in\">timeout</span> <span class=\"built_in\">date</span>    : Fri May 16 15:10:04 CST 2025</span><br><span class=\"line\">       session         : ded56dfd-5683-4427-ac08-792f8fb75e5e (current)</span><br><span class=\"line\"><span class=\"comment\"># ç»“æŸä»»åŠ¡</span></span><br><span class=\"line\"><span class=\"built_in\">kill</span> 1 <span class=\"comment\"># 1ä¸ºåå°ä»»åŠ¡id</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å°†åå°ä»»åŠ¡è½¬åˆ°å‰å°</span></span><br><span class=\"line\"><span class=\"built_in\">fg</span> 1 <span class=\"comment\"># 1ä¸ºåå°ä»»åŠ¡id</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æš‚åœä»»åŠ¡ï¼Œä½†æ­¤æ—¶ä¼šå°†arthasè¿›ç¨‹éƒ½æŒ‚èµ·ï¼Œæ‰€ä»¥å¹¶ä¸å¥½ç”¨</span></span><br><span class=\"line\">ctrl+z</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å°†å‰å°ä»»åŠ¡è½¬åˆ°åå°ç»§ç»­æ‰§è¡Œ</span></span><br><span class=\"line\"><span class=\"built_in\">bg</span> 1 <span class=\"comment\"># 1ä¸ºå‰å°ä»»åŠ¡id</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"logger-æŸ¥çœ‹-logger-ä¿¡æ¯ï¼Œæ›´æ–°-logger-level\">logger : æŸ¥çœ‹ logger ä¿¡æ¯ï¼Œæ›´æ–° logger level</h4>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹ logger ä¿¡æ¯</span></span><br><span class=\"line\">logger</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹æŒ‡å®šåå­—çš„loggerä¿¡æ¯</span></span><br><span class=\"line\">logger -n ROOT</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹æ²¡æœ‰ appender çš„ logger çš„ä¿¡æ¯ï¼Œä¸åŠ è¿™ä¸ªå‚æ•°åªä¼šæ‰“å°æœ‰ appender çš„ logger çš„ä¿¡æ¯</span></span><br><span class=\"line\">logger --include-no-appender</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ›´æ–° logger levelï¼Œ-c classLoader çš„ hashcode</span></span><br><span class=\"line\">logger --name ROOT --level debug -c 5b2133b1</span><br><span class=\"line\">logger --name ROOT --level error --classLoaderClass org.springframework.boot.loader.LaunchedURLClassLoader</span><br></pre></td></tr></table></figure>\n<h4 id=\"classloader-æŸ¥çœ‹-classloader-çš„ç»§æ‰¿æ ‘ï¼Œurlsï¼Œç±»åŠ è½½ä¿¡æ¯\">classloader : æŸ¥çœ‹ classloader çš„ç»§æ‰¿æ ‘ï¼Œurlsï¼Œç±»åŠ è½½ä¿¡æ¯</h4>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹ classloader çš„ä¿¡æ¯ï¼ŒåŠ è½½classçš„æ•°é‡ï¼Œhashcodeï¼Œclassloader çš„ parent</span></span><br><span class=\"line\">classloader -l</span><br><span class=\"line\"><span class=\"comment\"># æ ‘å½¢å±•ç¤º</span></span><br><span class=\"line\">classloader -t</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥æ‰¾èµ„æºï¼Œæ¯”å¦‚æŸ¥æ‰¾æŒ‡å®šåç§°çš„æ–‡ä»¶</span></span><br><span class=\"line\">classloader -c 5b2133b1 -r application.properties</span><br><span class=\"line\">classloader --classLoaderClass org.springframework.boot.loader.LaunchedURLClassLoader -r logback-spring.xml</span><br></pre></td></tr></table></figure>\n<h4 id=\"ognl-æ‰§è¡Œ-ognl-è¡¨è¾¾å¼\">ognl : æ‰§è¡Œ ognl è¡¨è¾¾å¼</h4>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># è°ƒç”¨é™æ€å‡½æ•°</span></span><br><span class=\"line\">ognl <span class=\"string\">&#x27;@java.lang.System@out.println(&quot;hello&quot;)&#x27;</span></span><br><span class=\"line\">ognl <span class=\"string\">&#x27;@java.lang.Math@sqrt(9.0)&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># è·å–é™æ€ç±»çš„é™æ€å­—æ®µ</span></span><br><span class=\"line\">ognl <span class=\"string\">&#x27;@java.io.File@separator&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"># éœ€è¦æŒ‡å®šclassLoaderClass</span></span><br><span class=\"line\">ognl --classLoaderClass org.springframework.boot.loader.LaunchedURLClassLoader @com.example.demo.arthas.user.UserController@logger</span><br><span class=\"line\"><span class=\"comment\"># è·å–classLoaderHash</span></span><br><span class=\"line\">sc -d *UserController | grep classLoaderHash</span><br><span class=\"line\">ognl -c 5b2133b1 @com.example.demo.arthas.user.UserController@logger</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># è¿”å›å€¼å±•å¼€åŸºå±‚ -x</span></span><br><span class=\"line\">ognl -c 5b2133b1 @com.example.demo.arthas.user.UserController@logger -x 3</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ‰§è¡Œå¤šè¡Œè¡¨è¾¾å¼ï¼Œèµ‹å€¼ç»™ä¸´æ—¶å˜é‡ï¼Œè¿”å›ä¸€ä¸ª List</span></span><br><span class=\"line\">ognl <span class=\"string\">&#x27;#value1=@System@getProperty(&quot;java.home&quot;), #value2=@System@getProperty(&quot;java.runtime.name&quot;), &#123;#value1, #value2&#125;&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ç´¢å¼•</span></span><br><span class=\"line\"><span class=\"comment\"># è·å–æ•°ç»„ä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ </span></span><br><span class=\"line\">ognl <span class=\"string\">&quot;&#123;1,2,3,4&#125;[0]&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å˜é‡å¼•ç”¨ï¼Œä½¿ç”¨ # åœ¨ OGNL ä¸­å®šä¹‰ä¸´æ—¶å˜é‡ï¼Œä»–ä»¬å…¨å±€å¯è§ï¼Œæ­¤å¤–è¡¨è¾¾å¼è®¡ç®—çš„æ¯ä¸€æ­¥ç»“æœéƒ½ä¿å­˜åœ¨å˜é‡ this ä¸­</span></span><br><span class=\"line\"><span class=\"comment\"># ä¸‹é¢å‘½ä»¤é€šè¿‡è·å–åˆ—è¡¨çš„ç¬¬ä¸€ä¸ªå…ƒç´ è¿›è¡Œåˆ¤æ–­å¦‚æœå¤§äº 5 åˆ™ä¹˜ä»¥ 2 åä¹‹åˆ™åŠ  10</span></span><br><span class=\"line\">ognl <span class=\"string\">&quot;&#123;10,20,30&#125;[0].(#this &gt; 5 ? #this*2 : #this+10)&quot;</span></span><br><span class=\"line\"><span class=\"comment\"># æ¯ä¸ªå…ƒç´ ä¹˜ä»¥ 2 åè¿”å›</span></span><br><span class=\"line\">ognl <span class=\"string\">&quot;&#123;1, 2, 3&#125;.&#123;#this*2&#125;&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ–¹æ³•è°ƒç”¨</span></span><br><span class=\"line\"><span class=\"comment\"># é€šè¿‡ä¸‹é¢å‘½ä»¤å¯ä»¥è°ƒç”¨ ArrayList çš„ size() æ–¹æ³•è·å–åˆ° ArrayList çš„å¤§å°</span></span><br><span class=\"line\">ognl <span class=\"string\">&quot;&#123;1,2,3,4&#125;.size()&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å¤æ‚é“¾å¼è¡¨è¾¾å¼</span></span><br><span class=\"line\">ognl <span class=\"string\">&quot;@java.lang.System@out.(print(&#x27;Hello &#x27;), print(&#x27;world\\n&#x27;))&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ–°å»ºåŸç”Ÿæ•°ç»„</span></span><br><span class=\"line\">ognl <span class=\"string\">&quot;new int[] &#123;1, 2, 3&#125;&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ–°å»ºæ™®é€š Map</span></span><br><span class=\"line\">ognl <span class=\"string\">&quot;#&#123; &#x27;foo&#x27;: &#x27;foo value&#x27;, &#x27;bar&#x27;: &#x27;bar value&#x27; &#125;&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ–°å»ºç‰¹å®šç±»å‹ Map</span></span><br><span class=\"line\">ognl <span class=\"string\">&quot;#@java.util.HashMap@&#123; &#x27;foo&#x27;: &#x27;foo value&#x27;, &#x27;bar&#x27;: &#x27;bar value&#x27; &#125;&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥æ‰¾æ‰€æœ‰åŒ¹é…çš„å…ƒç´ </span></span><br><span class=\"line\">ognl <span class=\"string\">&quot;&#123;1024, &#x27;Hello world!&#x27;, true, 2048&#125;.&#123;? #this instanceof Number&#125;&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥æ‰¾ç¬¬ä¸€ä¸ªåŒ¹é…çš„å…ƒç´ </span></span><br><span class=\"line\">ognl <span class=\"string\">&quot;&#123;1024, &#x27;Hello world!&#x27;, true, 2048&#125;.&#123;^ #this instanceof Number&#125;&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥æ‰¾æœ€åä¸€ä¸ªåŒ¹é…çš„å…ƒç´ </span></span><br><span class=\"line\">ognl <span class=\"string\">&quot;&#123;1024, &#x27;Hello world!&#x27;, true, 2048&#125;.&#123;$ #this instanceof Number&#125;&quot;</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"vmoption-æŸ¥çœ‹ï¼Œæ›´æ–°-VM-è¯Šæ–­ç›¸å…³çš„å‚æ•°\">vmoption : æŸ¥çœ‹ï¼Œæ›´æ–° VM è¯Šæ–­ç›¸å…³çš„å‚æ•°</h4>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹æ‰€æœ‰çš„ option</span></span><br><span class=\"line\">vmoption</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹æŒ‡å®šçš„ option</span></span><br><span class=\"line\">vmoption PrintGC</span><br><span class=\"line\"><span class=\"comment\"># æ›´æ–°æŒ‡å®šçš„ option</span></span><br><span class=\"line\">vmoption PrintGC <span class=\"literal\">true</span></span><br><span class=\"line\">vmoption PrintGCDetails <span class=\"literal\">true</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"vmtool-å®ç°æŸ¥è¯¢å†…å­˜å¯¹è±¡ï¼Œå¼ºåˆ¶-GC-ç­‰åŠŸèƒ½\">vmtool : å®ç°æŸ¥è¯¢å†…å­˜å¯¹è±¡ï¼Œå¼ºåˆ¶ GC ç­‰åŠŸèƒ½</h4>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># è·å–å¯¹è±¡ï¼Œ--action getInstances: è·å–å¯¹è±¡å®ä¾‹ï¼Œ--className: æŒ‡å®šç±»åï¼Œ--limit: æŒ‡å®šè·å–æ•°é‡</span></span><br><span class=\"line\">vmtool --action getInstances --className java.lang.String --<span class=\"built_in\">limit</span> 10</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŒ‡å®š classloader nameï¼Œè¿™é‡Œè·å– springçš„ ApplicationContext å¯¹è±¡ï¼Œ-x: å±•å¼€å¤šå°‘å±‚</span></span><br><span class=\"line\">vmtool --action getInstances --classLoaderClass org.springframework.boot.loader.LaunchedURLClassLoader --className org.springframework.context.ApplicationContext -x 3</span><br><span class=\"line\"><span class=\"comment\"># æŒ‡å®š classloader hash</span></span><br><span class=\"line\">sc -d org.springframework.context.ApplicationContext | grep classLoaderHash</span><br><span class=\"line\">vmtool --action getInstances -c 19469ea2 --className org.springframework.context.ApplicationContext</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ‰§è¡Œè¡¨è¾¾å¼ï¼Œ--express: æ‰§è¡Œçš„è¡¨è¾¾å¼ï¼Œè¿™é‡Œæ˜¯è°ƒç”¨å¯¹è±¡çš„æ–¹æ³•</span></span><br><span class=\"line\">vmtool --action getInstances --className com.example.demo.arthas.aop.HelloWorldService --express <span class=\"string\">&#x27;instances[0].getHelloMessage()&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å¼ºåˆ¶ GCï¼Œå¯ä»¥ç»“åˆ vmoption å‘½ä»¤åŠ¨æ€æ‰“å¼€PrintGCå¼€å…³</span></span><br><span class=\"line\">vmtool --action forceGc</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ä¸­æ–­çº¿ç¨‹ï¼Œ -t çº¿ç¨‹ID,å¯ä»¥ä½¿ç”¨ threadå‘½ä»¤è·å–</span></span><br><span class=\"line\">vmtool --action interruptThread -t 1</span><br></pre></td></tr></table></figure>\n","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç»JVMçš„å‘½ä»¤è¡Œå·¥å…· JDK8 The JavaÂ® Virtual Machine Specification JDK8çš„javaæŒ‡ä»¤çš„å®˜â½…â½‚æ¡£ JDKâ¼¯å…·å®˜â½¹â½‚æ¡£ JDK17çš„javaæŒ‡ä»¤çš„å®˜â½…â½‚æ¡£ JVM çš„å‚æ•°(ä¸‰ç±») æ ‡å‡†å‚æ•°: ä»¥-å¼€å¤´ï¼Œæ‰€æœ‰ HotSpot éƒ½â½€æŒã€‚ä¾‹å¦‚java -versionã€‚è¿™ç±»å‚æ•°å¯ä»¥ä½¿â½¤java -help æˆ–è€…java -?å…¨éƒ¨æ‰“å°å‡ºæ¥ â¾®æ ‡å‡†å‚æ•°: ä»¥-Xå¼€å¤´ï¼Œæ˜¯ç‰¹å®š HotSpotç‰ˆæœ¬â½€æŒçš„æŒ‡ä»¤ã€‚ä¾‹å¦‚java -Xms200M -Xmx200Mã€‚è¿™ç±»æŒ‡ä»¤å¯ä»¥â½¤java -X å…¨éƒ¨æ‰“å°å‡ºæ¥ã€‚ ä¸ç¨³å®šå‚æ•°: è¿™ä¹Ÿæ˜¯ JVMè°ƒä¼˜çš„å™©æ¢¦ã€‚ä»¥-XX å¼€å¤´ï¼Œè¿™äº›å‚æ•°æ˜¯è·Ÿç‰¹å®šHotSpotç‰ˆæœ¬å¯¹åº”çš„ï¼Œå¾ˆæœ‰å¯èƒ½æ¢ä¸ªç‰ˆæœ¬å°±æ²¡æœ‰äº†ã€‚è¯¦ç»†çš„â½‚æ¡£èµ„æ–™ä¹Ÿç‰¹åˆ«å°‘ã€‚JDK8 ä¸­çš„ä»¥ä¸‹â¼ä¸ªæŒ‡ä»¤å¯ä»¥å¸®åŠ©å¼€å‘è€…äº†è§£ JDK8 ä¸­çš„è¿™â¼€ç±»ä¸ç¨³å®šå‚æ•°ã€‚ 1234java -XX:+PrintFlagsInitial -version # æ‰€æœ‰å‚æ•°çš„é»˜è®¤å€¼java -XX:+PrintFlagsFinal -version # æ‰€æœ‰å‚æ•°æœ€ç»ˆâ½£æ•ˆçš„å€¼ã€‚java -XX:+UnlockExperimentalVMOptions -XX:+PrintFlagsFinal -version # æ‰€æœ‰å‚æ•°æœ€ç»ˆâ½£æ•ˆçš„å€¼ï¼ŒåŒ…å«å®éªŒæ€§å‚æ•°ã€‚java -XX:+PrintCommandLineFlags -version # å½“å‰å‘½ä»¤ç”Ÿæ•ˆçš„å€¼ï¼Œå¯ä»¥çœ‹åˆ°æ˜¯â½¤çš„å“ªç§GCã€‚ JDK1.8é»˜è®¤â½¤çš„ParallelGC è¿è¡Œ java -XX:+UnlockExperimentalVMOptions -XX:+PrintFlagsFinal -version è¿”å›å€¼è¯´æ˜ 1234567891011121314151617[Global flags] intx ActiveProcessorCount = -1 &#123;product&#125; uintx AdaptiveSizeDecrementScaleFactor = 4 &#123;product&#125; uintx AdaptiveSizeMajorGCDecayTimeScale = 10 &#123;product&#125; uintx AdaptiveSizePausePolicy = 0 &#123;product&#125; uintx AdaptiveSizePolicyCollectionCostMargin = 50 &#123;product&#125; uintx AdaptiveSizePolicyInitializingSteps = 20 &#123;product&#125; uintx AdaptiveSizePolicyOutputInterval = 0 &#123;product&#125; uintx AdaptiveSizePolicyWeight = 10 &#123;product&#125; uintx AdaptiveSizeThroughPutPolicy = 0 &#123;product&#125; uintx AdaptiveTimeWeight = 25 &#123;product&#125; bool AdjustConcurrency = false &#123;product&#125; bool AggressiveHeap = false &#123;product&#125; bool AggressiveOpts = false &#123;product&#125; intx AliasLevel = 3 &#123;C2 product&#125; â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦# æ ¼å¼ï¼šflagç±»å‹ï¼Œflagåç§°ï¼Œflagå€¼ï¼Œflagæ¥æºä¸ä½œç”¨åŸŸä¿®é¥°ç¬¦ flagç±»å‹: jdk8 æ ‡è¯†ç¬¦ å«ä¹‰ æè¿°è¯´æ˜ intx æœ‰ç¬¦å·æ•´æ•°ï¼ˆint extendedï¼‰ ç”¨äºè¡¨ç¤ºå¸¦ç¬¦å·æ•´æ•°å‹å‚æ•° uintx æ— ç¬¦å·æ•´æ•°ï¼ˆunsigned int extendedï¼‰ è¡¨ç¤ºéè´Ÿæ•´æ•°å‹å‚æ•° uint64_t æ— ç¬¦å· 64 ä½æ•´æ•° é€‚ç”¨äºéœ€è¦æ›´å¤§æ•´æ•°å€¼çš„å‚æ•°ï¼Œæ¯”å¦‚å†…å­˜å¤§å°ã€çº³ç§’æ—¶é—´æˆ³ç­‰ bool å¸ƒå°”å‹ true æˆ– falseï¼Œè¡¨ç¤ºå¼€å…³å‹å‚æ•°ã€‚+è¡¨ç¤ºå¼€å¯ï¼Œ-è¡¨ç¤ºå…³é—­ã€‚ å¦‚ -XX:+UseG1GCï¼Œè¡¨ç¤ºå¼€å¯ G1 å›æ”¶å™¨åŠŸèƒ½ã€‚ double åŒç²¾åº¦æµ®ç‚¹å‹ ç”¨äºè¡¨ç¤ºæµ®ç‚¹æ•°å€¼ç±»å‹çš„ JVM å‚æ•° ccstr å¸¸é‡ C å­—ç¬¦ä¸²æŒ‡é’ˆ è¡¨ç¤ºå­—ç¬¦ä¸²å‚æ•°ï¼ˆä¸å¯å˜ï¼‰ ccstrlist C å­—ç¬¦ä¸²åˆ—è¡¨ è¡¨ç¤ºä»¥é€—å·åˆ†éš”çš„å­—ç¬¦ä¸²åˆ—è¡¨ jdk11åå‡ºç°æ›´å¤šçš„ç±»å‹ æ ‡è¯†ç¬¦ å«ä¹‰ æè¿°è¯´æ˜ int æœ‰ç¬¦å·æ•´æ•°,é€šå¸¸æ˜¯ 32 ä½ JVM å†…éƒ¨ä½¿ç”¨çš„æ™®é€š int å‚æ•° uint æ— ç¬¦å·æ•´æ•°,é€šå¸¸æ˜¯ 32 ä½ å°‘é‡ç”¨äºç‰¹æ®Šåœºæ™¯çš„å‚æ•° size_t å†…å­˜å¤§å° è¡¨ç¤ºå†…å­˜å¤§å°å‚æ•°ï¼ˆå•ä½ä¸€èˆ¬ä¸ºå­—èŠ‚ï¼‰,jdk11åå‡ºç°ï¼ŒåŸæ¥æ˜¯ uintx flagæ¥æºä¸ä½œç”¨åŸŸä¿®é¥°ç¬¦ jdk8 æ ‡è®° å«ä¹‰ &#123;product&#125; æ­£å¼äº§å“å‚æ•°ï¼ˆç”¨æˆ·å¯ç”¨ï¼Œå¯é€šè¿‡ -XX: è¿›è¡Œè®¾ç½®ï¼‰ &#123;pd product&#125; å¹³å°ç›¸å…³çš„æ­£å¼å‚æ•°ï¼ˆplatform-dependentï¼‰ï¼Œåœ¨æŸäº›æ“ä½œç³»ç»Ÿ/CPU ä¸Šå¯ç”¨ &#123;C1 product&#125; ä»…åœ¨ä½¿ç”¨ C1 ç¼–è¯‘å™¨ï¼ˆä¼˜åŒ–ç¼–è¯‘å™¨ï¼‰ æ—¶æœ‰æ•ˆçš„å‚æ•° &#123;C2 product&#125; ä»…åœ¨ä½¿ç”¨ C2 ç¼–è¯‘å™¨ï¼ˆä¼˜åŒ–ç¼–è¯‘å™¨ï¼‰ æ—¶æœ‰æ•ˆçš„å‚æ•° &#123;manageable&#125; å¯é€šè¿‡ JMX åŠ¨æ€ç®¡ç†çš„å‚æ•°ï¼ˆè¿è¡Œæ—¶å¯è°ƒæ•´ï¼‰ &#123;ARCH product&#125; ä¸ CPU æ¶æ„ç›¸å…³çš„äº§å“å‚æ•°ï¼ˆå¦‚ x86ã€ARM ç­‰ï¼‰ &#123;lp64_product&#125; ä»…åœ¨ 64 ä½ JVM ä¸Šæ‰æœ‰æ•ˆçš„äº§å“å‚æ•° &#123;experimental&#125; å®éªŒæ€§çš„ å‚æ•°ï¼Œå¯èƒ½åœ¨å°†æ¥çš„ç‰ˆæœ¬ä¸­åˆ é™¤æˆ–æ›´æ”¹ã€‚éœ€è¦å¼€å¯ -XX:+UnlockExperimentalVMOptions jdk11åå‡ºç°æ›´å¤šçš„ç±»å‹ æ ‡è®° å«ä¹‰ &#123;C1 pd product&#125; å¹³å°ç›¸å…³çš„æ­£å¼å‚æ•°,ä»…åœ¨ä½¿ç”¨ C1 ç¼–è¯‘å™¨ï¼ˆä¼˜åŒ–ç¼–è¯‘å™¨ï¼‰ æ—¶æœ‰æ•ˆçš„å‚æ•° &#123;C2 pd product&#125; å¹³å°ç›¸å…³çš„æ­£å¼å‚æ•°,ä»…åœ¨ä½¿ç”¨ C2 ç¼–è¯‘å™¨ï¼ˆä¼˜åŒ–ç¼–è¯‘å™¨ï¼‰ æ—¶æœ‰æ•ˆçš„å‚æ•° &#123;JVMCI product&#125; æ­¤å‚æ•°é€‚ç”¨äº JVMCI æˆ– Graal ç¼–è¯‘å™¨ç›¸å…³åŠŸèƒ½ï¼Œjdk21æ·»åŠ  å¦å¤–ï¼Œjdk11+ ä¸­ï¼Œæœ€åè¿˜ä¼šå¤šå‡ºä¸€åˆ—ï¼Œå…¶ä½œç”¨æ˜¯è¯´æ˜è¯¥å‚æ•°çš„è®¾ç½®æ¥æº æ¥æºæ ‡è¯† å«ä¹‰è¯´æ˜ &#123;default&#125; ä½¿ç”¨çš„æ˜¯è¯¥å‚æ•°çš„é»˜è®¤å€¼ï¼ˆæ²¡æœ‰è¢«ç”¨æˆ·æˆ–ç³»ç»Ÿè®¾ç½®ï¼‰ &#123;command line&#125; ç”¨æˆ·é€šè¿‡å‘½ä»¤è¡Œæ˜¾å¼è®¾ç½®çš„å‚æ•°ï¼ˆå¦‚ -XX:+UseG1GCï¼‰ &#123;ergonomic&#125; JVM æ ¹æ®ç³»ç»Ÿç¯å¢ƒè‡ªåŠ¨é€‰æ‹©çš„å€¼ï¼ˆè‡ªé€‚åº”è®¾ç½®ï¼‰ jps: æŸ¥çœ‹å½“å‰jvmä¸­çš„è¿›ç¨‹ 12345678# æŸ¥çœ‹javaè¿›ç¨‹IDjps# æŸ¥çœ‹javaè¿›ç¨‹ä¿¡æ¯ï¼ŒåŒ…æ‹¬IDå’Œå¯åŠ¨ç±»æˆ–jarçš„åç§°jps -l# æŸ¥çœ‹å¯åŠ¨javaè¿›ç¨‹æ—¶ä¼ é€’ç»™jvmçš„å‚æ•°è®¾ç½®jps -v# æŸ¥çœ‹javaè¿›ç¨‹ä¿¡æ¯ï¼ŒåŒæ—¶æ˜¾ç¤ºå¯åŠ¨javaè¿›ç¨‹æ—¶ä¼ é€’ç»™jvmçš„å‚æ•°è®¾ç½®jps -lv jinfo: æŸ¥çœ‹JVMå‚æ•° jinfo æ˜¯ JDK è‡ªå¸¦çš„å‘½ä»¤è¡Œå·¥å…·ä¹‹ä¸€ï¼Œç”¨äº æŸ¥çœ‹å’Œä¿®æ”¹æ­£åœ¨è¿è¡Œä¸­çš„ Java è¿›ç¨‹çš„é…ç½®ä¿¡æ¯ï¼Œä¸»è¦åŒ…æ‹¬ JVM å‚æ•°ã€ç³»ç»Ÿå±æ€§ç­‰ä¿¡æ¯ã€‚ åœ¨ Java 9+ ä¹‹åè¢«æ ‡è®°ä¸º deprecatedï¼Œå»ºè®®æ”¹ç”¨ jcmd æ›¿ä»£ 12345678910111213141516171819# æŸ¥çœ‹æ­£åœ¨è¿è¡Œçš„ JVM å‚æ•°jinfo &lt;PID&gt;# jcmd å‘½ä»¤ï¼Œåˆ†æˆä¸‰ä¸ªjcmd &lt;pid&gt; VM.flags # VM Flagsjcmd &lt;pid&gt; VM.system_properties # System Propertiesjcmd &lt;pid&gt; VM.command_line # Command Line# æŸ¥çœ‹æŒ‡å®šè¿›ç¨‹çš„ç³»ç»Ÿå±æ€§ï¼ˆ-syspropsï¼‰jinfo -sysprops &lt;PID&gt;# jcmd å‘½ä»¤jcmd &lt;pid&gt; VM.system_properties# åŠ¨æ€ä¿®æ”¹ JVM å‚æ•°ï¼ˆä»…æ”¯æŒéƒ¨åˆ†å‚æ•°ï¼‰jinfo -flag [+|-]&lt;flagname&gt; &lt;pid&gt;## ä¾‹ï¼šæ‰“å¼€ GC æ—¥å¿—jinfo -flag +PrintGC &lt;pid&gt;# æ£€æŸ¥æ˜¯å¦å¼€å¯äº†æŸä¸ª JVM ç‰¹æ€§ï¼ˆå¦‚ UseG1GCï¼‰jinfo -flag UseG1GC &lt;pid&gt; jstat: æŸ¥çœ‹æŒ‡å®šJAVAè¿›ç¨‹çš„è¿è¡ŒçŠ¶æ€ 123456789# æŸ¥çœ‹è¿è¡ŒçŠ¶æ€jstat -gc &lt;PID&gt;# æŸ¥çœ‹è¿è¡ŒçŠ¶æ€ï¼Œæ¯éš”5000æ¯«ç§’è¾“å‡ºä¸€æ¬¡ï¼Œå…±è¾“å‡º20æ¬¡jstat -gc &lt;PID&gt; 5000 20# è¾“å‡º S0C S1C S0U S1U EC EU OC OU MC MU CCSC CCSU YGC YGCT FGC FGCT GCT512.0 512.0 0.0 224.0 29696.0 27138.2 105984.0 96531.8 122368.0 114450.4 15360.0 14018.9 733 5.099 4 0.833 5.931512.0 512.0 0.0 224.0 29696.0 27203.9 105984.0 96531.8 122368.0 114450.4 15360.0 14018.9 733 5.099 4 0.833 5.931512.0 512.0 0.0 224.0 29696.0 27220.4 105984.0 96531.8 122368.0 114450.4 15360.0 14018.9 733 5.099 4 0.833 5.931 å†…å­˜åŒºç»Ÿè®¡ï¼ˆå•ä½ï¼šKBï¼‰ åˆ—å å«ä¹‰è¯´æ˜ S0C Survivor 0 åŒºçš„å®¹é‡ï¼ˆKBï¼‰ S1C Survivor 1 åŒºçš„å®¹é‡ï¼ˆKBï¼‰ S0U Survivor 0 åŒºå·²ä½¿ç”¨å†…å­˜ï¼ˆKBï¼‰ S1U Survivor 1 åŒºå·²ä½¿ç”¨å†…å­˜ï¼ˆKBï¼‰ EC Eden åŒºçš„å®¹é‡ï¼ˆKBï¼‰ EU Eden åŒºå·²ä½¿ç”¨å†…å­˜ï¼ˆKBï¼‰ OC Old Generationï¼ˆè€å¹´ä»£ï¼‰çš„å®¹é‡ï¼ˆKBï¼‰ OU Old Generation å·²ä½¿ç”¨å†…å­˜ï¼ˆKBï¼‰ MC Metaspaceï¼ˆå…ƒç©ºé—´ï¼‰çš„å®¹é‡ï¼ˆKBï¼‰ MU Metaspace å·²ä½¿ç”¨å†…å­˜ï¼ˆKBï¼‰ CCSC Compressed Class Space çš„å®¹é‡ï¼ˆKBï¼‰ CCSU Compressed Class Space å·²ä½¿ç”¨å†…å­˜ï¼ˆKBï¼‰ GC æ¬¡æ•°ä¸è€—æ—¶(ä»åº”ç”¨ç¨‹åºå¯åŠ¨åˆ°é‡‡æ ·æ—¶) åˆ—å å«ä¹‰è¯´æ˜ YGC Young GCï¼ˆMinor GCï¼‰ çš„ç´¯è®¡æ¬¡æ•° YGCT Young GC ç´¯è®¡è€—æ—¶ï¼ˆå•ä½ï¼šç§’ï¼‰ FGC Full GC çš„ç´¯è®¡æ¬¡æ•° FGCT Full GC ç´¯è®¡è€—æ—¶ï¼ˆå•ä½ï¼šç§’ï¼‰ GCT GC æ€»è€—æ—¶ï¼ˆYGCT + FGCTï¼Œæ€»å’Œï¼‰ jstack: æŸ¥çœ‹æŒ‡å®šJAVAè¿›ç¨‹ä¸­å„çº¿ç¨‹çš„è°ƒç”¨å †æ ˆ 123456789101112131415161718# æ‰“å°çº¿ç¨‹çš„æ ‡å‡†æ ˆä¿¡æ¯ï¼ˆæ ˆå¸§ + çº¿ç¨‹çŠ¶æ€ï¼‰jstack &lt;PID&gt;# åœ¨æ ‡å‡†è¾“å‡ºåŸºç¡€ä¸Šï¼Œé¢å¤–æ‰“å°çº¿ç¨‹æ‹¥æœ‰çš„é”ï¼ˆmonitorï¼‰å’Œ waited on é”å¯¹è±¡ä¿¡æ¯jstack -l &lt;PID&gt;# è¾“å‡ºåˆ°æ–‡ä»¶jstack -l &lt;PID&gt; &gt; jstack.tdump # è¿™ä¸ªæ–‡ä»¶ååç¼€åªæ˜¯ä¸ºäº†æ–¹ä¾¿ jvisualvm æŸ¥çœ‹# è¾“å‡º&quot;idle-connection-reaper&quot; #68 daemon prio=5 os_prio=0 tid=0x00007f38b6ae2800 nid=0x62e9 waiting on condition [0x00007f385b0f5000] java.lang.Thread.State: TIMED_WAITING (sleeping) at java.lang.Thread.sleep(Native Method) at software.amazon.awssdk.http.apache.internal.conn.IdleConnectionReaper$ReaperTask.run(IdleConnectionReaper.java:151) at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) at java.lang.Thread.run(Thread.java:750) Locked ownable synchronizers: - &lt;0x00000000c561cfd8&gt; (a java.util.concurrent.ThreadPoolExecutor$Worker) jstackè¾“å‡ºå†…å®¹å«ä¹‰ å­—æ®µ å«ä¹‰ &quot;idle-connection-reaper&quot; çº¿ç¨‹åç§°ã€‚è¿™ä¸ªçº¿ç¨‹æ˜¯ AWS SDK ä¸­ç”¨äºæ¸…ç†ç©ºé—²è¿æ¥çš„åå°çº¿ç¨‹ã€‚ #68 çº¿ç¨‹ IDï¼ˆJava å±‚åˆ†é…çš„ç¼–å·ï¼‰ã€‚ daemon è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ª å®ˆæŠ¤çº¿ç¨‹ã€‚JVM é€€å‡ºæ—¶ä¸ä¼šç­‰å¾…å®ˆæŠ¤çº¿ç¨‹è¿è¡Œç»“æŸã€‚ prio=5 Java å±‚çš„çº¿ç¨‹ä¼˜å…ˆçº§ï¼ˆé»˜è®¤ 1â€“10ï¼Œ5 æ˜¯é»˜è®¤ï¼‰ã€‚ os_prio=0 æ“ä½œç³»ç»Ÿå±‚çº¿ç¨‹ä¼˜å…ˆçº§ï¼ˆå–å†³äºæ“ä½œç³»ç»Ÿå’Œ JVM çš„å®ç°ï¼‰ã€‚ tid=0x00007f38b6ae2800 çº¿ç¨‹ IDï¼ˆJava å±‚ä½¿ç”¨çš„åœ°å€æ ‡è¯†ï¼‰ã€‚ nid=0x62e9 Native IDï¼Œæ“ä½œç³»ç»Ÿåˆ†é…çš„çº¿ç¨‹ IDï¼ˆåå…­è¿›åˆ¶è¡¨ç¤ºï¼‰ï¼Œå¯ä»¥é€šè¿‡å‘½ä»¤printf &quot;%d\\n&quot; 0x62e9è½¬æ¢ä¸º10è¿›åˆ¶ã€‚ ps -Lp &lt;PID&gt; å’Œ top -Hp &lt;PID&gt; å±•ç¤ºçš„çº¿ç¨‹idæ˜¯10è¿›åˆ¶ waiting on condition çº¿ç¨‹çŠ¶æ€è¯´æ˜ï¼šæ­£åœ¨ç­‰å¾…æŸç§æ¡ä»¶ï¼Œä¸€èˆ¬æŒ‡ sleep() æˆ– wait() ç­‰ã€‚ [0x00007f385b0f5000] æ ˆå¸§çš„å†…å­˜åœ°å€ã€‚ java.lang.Thread.State: TIMED_WAITING (sleeping) çº¿ç¨‹çŠ¶æ€ã€‚ at java.lang.Thread.sleep(Native Method) â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦ çº¿ç¨‹è°ƒç”¨æ ˆä¿¡æ¯ï¼ŒåŒ…æ‹¬è°ƒç”¨æ–¹æ³•ã€è°ƒç”¨å‚æ•°ã€è°ƒç”¨æ ˆå¸§ã€‚ å¦å¤–è¿˜æœ‰å¦‚ä¸‹ä¿¡æ¯ï¼Œè¡¨ç¤ºæ­¤çº¿ç¨‹æŒæœ‰çš„å¯æ‹¥æœ‰åŒæ­¥å™¨ï¼ˆä¾‹å¦‚ ReentrantLockï¼‰ï¼Œå…·ä½“å†…å®¹å¦‚ä¸‹ï¼š 12Locked ownable synchronizers: - &lt;0x00000000c561cfd8&gt; (a java.util.concurrent.ThreadPoolExecutor$Worker) å†…å®¹ å«ä¹‰ &lt;0x00000000c561cfd8&gt; æŒæœ‰é”çš„å¯¹è±¡åœ°å€ã€‚å¯ä»¥åœ¨å…¶ä»–çº¿ç¨‹ä¸­æŸ¥æ‰¾è¿™ä¸ªåœ°å€ï¼Œä»¥åˆ¤æ–­æ­»é”ç­‰é—®é¢˜ã€‚ (a ThreadPoolExecutor$Worker) è¡¨ç¤ºè¯¥é”å±äº ThreadPoolExecutor çš„æŸä¸ª Worker çº¿ç¨‹ï¼ˆè¿™æ˜¯çº¿ç¨‹æ± çš„å·¥ä½œçº¿ç¨‹ï¼‰ã€‚ çº¿ç¨‹çŠ¶æ€ çŠ¶æ€ å«ä¹‰ å¸¸è§åŸå›  / ç¤ºä¾‹æ–¹æ³• ç¤ºä¾‹ jstack è¾“å‡º RUNNABLE çº¿ç¨‹æ­£åœ¨è¿è¡Œæˆ–å‡†å¤‡è¿è¡Œï¼Œç­‰å¾… CPU æ—¶é—´ç‰‡ã€‚ çº¿ç¨‹æ´»è·ƒè¿è¡Œä¸­ &quot;Thread-0&quot; #1 prio=5 os_prio=0 tid=0x00007f8d9c001000 nid=0x1a runnable [0x00007f8dbf7fe000] BLOCKED (on object monitor) ç­‰å¾…è·å–å¯¹è±¡çš„ç›‘è§†å™¨é”ï¼ˆåŒæ­¥é”ï¼‰ï¼Œå³ç­‰å¾…è¿›å…¥åŒæ­¥å—æˆ–æ–¹æ³•ã€‚ synchronized åŒæ­¥å—æˆ–æ–¹æ³• &quot;Thread-1&quot; #2 prio=5 os_prio=0 tid=0x00007f8d9c002000 nid=0x1b waiting for monitor entry [0x00007f8dbeaff000] WAITING (on object monitor) æ— é™æœŸç­‰å¾…å…¶ä»–çº¿ç¨‹æ‰§è¡ŒæŸæ“ä½œã€‚ Object.wait()Thread.join()LockSupport.park()Condition.await() &quot;Thread-2&quot; #3 prio=5 os_prio=0 tid=0x00007f8d9c003000 nid=0x1c waiting on condition [0x00007f8dbebff000] TIMED_WAITING (on object monitor) ç­‰å¾…å›ºå®šæ—¶é—´ï¼Œç›´åˆ°æ¡ä»¶æ»¡è¶³æˆ–è¶…æ—¶ã€‚ Object.wait(long)Thread.sleep(long)Condition.awaitNanos(long)DelayQueue.take() &quot;Thread-3&quot; #4 prio=5 os_prio=0 tid=0x00007f8d9c004000 nid=0x1d timed_waiting [0x00007f8dbebff000] TERMINATED çº¿ç¨‹å·²è¿è¡Œå®Œæ¯•å¹¶é€€å‡ºï¼ˆé€šå¸¸ä¸åœ¨ jstack ä¸­æ˜¾ç¤ºï¼‰ã€‚ - - ä½¿ç”¨jstackæ£€æŸ¥æ­»é” æ­»é”æ˜¯æŒ‡å¤šä¸ªçº¿ç¨‹äº’ç›¸ç­‰å¾…å¯¹æ–¹é‡Šæ”¾é”ï¼Œå¯¼è‡´æ— æ³•ç»§ç»­è¿è¡Œçš„æƒ…å†µã€‚ ç›´æ¥æŸ¥æ‰¾ Found one Java-level deadlock æç¤º 12345678Found one Java-level deadlock:=============================&quot;Thread-1&quot;: waiting to lock monitor 0x0000000005c0a098 (object 0x00000000d5c10a70, a java.lang.Object), which is held by &quot;Thread-2&quot;&quot;Thread-2&quot;: waiting to lock monitor 0x0000000005c0a128 (object 0x00000000d5c10aa0, a java.lang.Object), which is held by &quot;Thread-1&quot; è¡¨ç¤ºä¸¤ä¸ªçº¿ç¨‹äº’ç›¸ç­‰å¾…å¯¹æ–¹é‡Šæ”¾é”ï¼Œé€ æˆæ­»é”ã€‚ ç›®å‰åªæ”¯æŒæ‰¾å‡º synchronized å…³é”®å­—é˜»å¡ä½çš„çº¿ç¨‹ï¼Œå¦‚æœæ˜¯ java.util.concurrent.Lock ç›®å‰è¿˜ä¸æ”¯æŒã€‚ æ‰‹åŠ¨åˆ¤æ–­æ­»é”çš„ç‰¹å¾ï¼ˆå¦‚æœæ²¡æœ‰ä¸Šé¢çš„æç¤ºï¼‰ å¦‚æœ JVM æ²¡æœ‰æ˜¾å¼æç¤ºï¼Œä½ å¯ä»¥é€šè¿‡ä»¥ä¸‹æ­»é”ç‰¹å¾è¿›è¡Œæ‰‹åŠ¨è¯†åˆ«ï¼š ç‰¹å¾ æè¿° çº¿ç¨‹å¤„äº BLOCKED çŠ¶æ€ çº¿ç¨‹è¢«é”é˜»å¡åœ¨ monitor ä¸Šã€‚ waiting to lock å’Œ locked å‡ºç°äº¤å‰ ä¸€ä¸ªçº¿ç¨‹æ­£åœ¨ç­‰å¾…å¦ä¸€ä¸ªçº¿ç¨‹æŒæœ‰çš„é”ï¼Œè€Œå¦ä¸€ä¸ªçº¿ç¨‹ä¹Ÿåœ¨ç­‰å¾…å½“å‰çº¿ç¨‹çš„é”ã€‚ æ²¡æœ‰èƒ½ç»§ç»­æ‰§è¡Œçš„çº¿ç¨‹ å¤šä¸ªçº¿ç¨‹éƒ½å¤„äº BLOCKED çŠ¶æ€ï¼Œä¸”ç›¸äº’ä¾èµ–ã€‚ åœ¨ Java 8 ä¹‹åæ”¯æŒè·å– JVM å†…éƒ¨çº¿ç¨‹ VM å†…éƒ¨çº¿ç¨‹åŒ…æ‹¬ä¸‹é¢å‡ ç§ï¼š çº¿ç¨‹ç±»å‹ ç¤ºä¾‹åç§° JITï¼ˆJust-In-Timeï¼‰ç¼–è¯‘çº¿ç¨‹ C1 CompilerThread0, C2 CompilerThread0 GC çº¿ç¨‹ GC Thread0, G1 Young RemSet Sampling å…¶å®ƒå†…éƒ¨çº¿ç¨‹ VM Periodic Task Thread, VM Thread, Service Thread è‡ª JDK 7 åŠä»¥ä¸Šç‰ˆæœ¬å¼€å§‹ï¼ŒHotSpot JVM é»˜è®¤å¯ç”¨äº†ï¼šåˆ†å±‚ç¼–è¯‘ï¼ˆTiered Compilationï¼‰ï¼Œå³åŒæ—¶ä½¿ç”¨ C1 å’Œ C2 ç¼–è¯‘å™¨ã€‚ ç¼–è¯‘å™¨ ç‰¹æ€§ ç”¨é€” C1ï¼ˆClient Compilerï¼‰ ç¼–è¯‘é€Ÿåº¦å¿«ï¼Œä¼˜åŒ–å°‘ ç¨‹åºå¯åŠ¨æ—¶ä½¿ç”¨ï¼Œæå‡å¯åŠ¨é€Ÿåº¦ C2ï¼ˆServer Compilerï¼‰ ç¼–è¯‘é€Ÿåº¦æ…¢ï¼Œä¼˜åŒ–å¼º çƒ­ç‚¹ä»£ç è¾¾åˆ°ä¸€å®šé—¨æ§›åä½¿ç”¨ï¼Œæå‡é•¿æœŸè¿è¡Œæ€§èƒ½ JVM å¯åŠ¨åï¼Œå…ˆè§£é‡Šæ‰§è¡Œå­—èŠ‚ç ï¼›çƒ­ç‚¹ä»£ç é¦–å…ˆç”± C1 ç¼–è¯‘å™¨å¤„ç†ï¼›å¦‚æœè¿›ä¸€æ­¥å˜çƒ­ï¼Œäº¤ç”± C2 ç¼–è¯‘å™¨ä¼˜åŒ–ï¼›æ•´ä¸ªè¿‡ç¨‹ç”± JVM è‡ªåŠ¨ç®¡ç†ï¼Œä¸éœ€è¦æ‰‹åŠ¨å¹²é¢„ã€‚ æ˜¯å¦å¯ä»¥æŒ‡å®šåªç”¨æŸä¸ªç¼–è¯‘å™¨ï¼Ÿæ˜¯çš„ï¼Œä½ å¯ä»¥ç”¨ JVM å‚æ•°æ§åˆ¶ï¼Œä½†çœŸæ²¡å¿…è¦ã€‚ å‚æ•° å«ä¹‰ -client ä½¿ç”¨ C1 ç¼–è¯‘å™¨ï¼ˆé€‚åˆå¯åŠ¨å¿«ï¼‰ -server ä½¿ç”¨ C2 ç¼–è¯‘å™¨ï¼ˆé€‚åˆé•¿æ—¶é—´è¿è¡Œçš„æœåŠ¡ï¼‰ -XX:-TieredCompilation ç¦ç”¨åˆ†å±‚ç¼–è¯‘ï¼Œä»…ä½¿ç”¨ -client æˆ– -server æŒ‡å®šçš„ç¼–è¯‘å™¨ jmap: åˆ†æè¿è¡Œä¸­ Java è¿›ç¨‹çš„å†…å­˜ä½¿ç”¨æƒ…å†µ jmap æ¯”è¾ƒæ¶ˆè€—å†…å­˜ï¼Œæ‰€ä»¥ä¸æ¨èç”Ÿäº§ç¯å¢ƒä½¿ç”¨ã€‚ jmap -histo &lt;pid&gt;: æŸ¥çœ‹ç±»å®ä¾‹æ•°é‡åŠå ç”¨å†…å­˜ 12345678910111213141516171819$ jmap -histo 2523825238: num #instances #bytes class name---------------------------------------------- 1: 106175 10838440 [C 2: 94344 3019008 java.util.concurrent.ConcurrentHashMap$Node 3: 105529 2532696 java.lang.String 4: 11203 2496608 [B 5: 20178 2430136 [Ljava.lang.Object; 6: 21642 2399904 java.lang.Classâ€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦Total 857252 51328200# num: åºå·# instances: å®ä¾‹æ•°é‡# bytes: å®ä¾‹å­—èŠ‚æ•°# class name: ç±»å, [C is a char[]ï¼Œ[S is a short[]ï¼Œ[I is a int[]ï¼Œ[B is a byte[]ï¼Œ[L is a List# Total: æ€»æ•° jmap -heap &lt;pid&gt;: æŸ¥çœ‹å †ä½¿ç”¨æƒ…å†µ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647$ jmap -heap 25238Attaching to process ID 25238, please wait...Debugger attached successfully.Server compiler detected.JVM version is 25.371-b11using thread-local object allocation.Parallel GC with 2 thread(s)Heap Configuration: # å †é…ç½® MinHeapFreeRatio = 0 # æœ€å°ç©ºé—²ç™¾åˆ†æ¯” MaxHeapFreeRatio = 100 # æœ€å¤§ç©ºé—²ç™¾åˆ†æ¯” MaxHeapSize = 1010827264 (964.0MB) # æœ€å¤§å †å¤§å° NewSize = 21495808 (20.5MB) # æ–°ç”Ÿä»£å¤§å° MaxNewSize = 336592896 (321.0MB) # æ–°ç”Ÿä»£æœ€å¤§å¤§å° OldSize = 43515904 (41.5MB) # è€å¹´ä»£å¤§å° NewRatio = 2 # æ–°ç”Ÿä»£ä¸è€å¹´ä»£æ¯”ä¾‹ SurvivorRatio = 8 # å¹¸å­˜è€…æ¯”ä¾‹ MetaspaceSize = 21807104 (20.796875MB) # å…ƒç©ºé—´å¤§å° CompressedClassSpaceSize = 1073741824 (1024.0MB) # å‹ç¼©ç±»ç©ºé—´å¤§å°ï¼Œç”¨äºå­˜å‚¨æ‰€æœ‰ ç±»æŒ‡é’ˆï¼ˆKlass pointerï¼‰ MaxMetaspaceSize = 17592186044415 MB # å…ƒç©ºé—´æœ€å¤§å¤§å° G1HeapRegionSize = 0 (0.0MB) # G1å †å¤§å°Heap Usage: # å †ä½¿ç”¨æƒ…å†µPS Young Generation # å¹´è½»ç”Ÿä»£Eden Space: # Eden åŒº capacity = 30932992 (29.5MB) # Eden åŒºå¤§å° used = 16705104 (15.931228637695312MB) # Eden åŒºä½¿ç”¨æƒ…å†µ free = 14227888 (13.568771362304688MB) # Eden åŒºå‰©ä½™æƒ…å†µ 54.00416487354343% used # Eden åŒºä½¿ç”¨ç™¾åˆ†æ¯”From Space: # å¹¸å­˜è€…åŒº survivor0 capacity = 524288 (0.5MB) used = 0 (0.0MB) free = 524288 (0.5MB) 0.0% usedTo Space: # å¹¸å­˜è€…åŒº survivor1 capacity = 524288 (0.5MB) used = 0 (0.0MB) free = 524288 (0.5MB) 0.0% usedPS Old Generation # è€å¹´ä»£ capacity = 193462272 (184.5MB) used = 43292112 (41.28657531738281MB) free = 150170160 (143.2134246826172MB) 22.377547597497458% used38722 interned Strings occupying 4184168 bytes. # å †ä¸­å­—ç¬¦ä¸²æ•°é‡åŠå ç”¨å†…å­˜ jmap -dump:live,format=b,file=&lt;file&gt; &lt;pid&gt;: åˆ›å»ºä¸€ä¸ªå¿«ç…§ï¼Œå¹¶ä¿å­˜åˆ°æ–‡ä»¶ä¸­ 1234# åˆ›å»ºä¸€ä¸ªå¿«ç…§ï¼Œå¹¶ä¿å­˜åˆ°å½“å‰ç›®å½•ä¸‹$ jmap -dump:live,format=b,file=test.hprof 25238Dumping heap to /tmp/test.hprof ...Heap dump file created jcmd: å¯ä»¥æ›¿ä»£jmapå‘½ä»¤ï¼Œjdk1.8+æ¨èä½¿ç”¨ jcmd æ˜¯ JDK çš„ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼Œç”¨äºç®¡ç† JVMï¼Œjcmd å¯ä»¥æŸ¥çœ‹ JVM çš„è¿è¡ŒçŠ¶æ€ã€æŸ¥çœ‹å †å†…å­˜ä¿¡æ¯ã€è§¦å‘ GCã€æŸ¥çœ‹çº¿ç¨‹ä¿¡æ¯ã€æŸ¥çœ‹ç±»ä¿¡æ¯ç­‰ç­‰ã€‚ ç”Ÿäº§ç¯å¢ƒä¸å»ºè®®ä½¿ç”¨jmapï¼Œå› å…¶ä¼šå ç”¨å¤§é‡å†…å­˜ï¼Œæ¨èä½¿ç”¨ jcmdã€‚ jcmd &lt;pid&gt; GC.heap_info: æŸ¥çœ‹å †ä½¿ç”¨æƒ…å†µ ç±»ä¼¼ jmap -heap &lt;pid&gt; 12345678910$ jcmd 25238 GC.heap_info25238: PSYoungGen total 30208K, used 23593K [0x00000000ebf00000, 0x00000000edd80000, 0x0000000100000000) eden space 29696K, 78% used [0x00000000ebf00000,0x00000000ed5d2560,0x00000000edc00000) from space 512K, 43% used [0x00000000edd00000,0x00000000edd38000,0x00000000edd80000) to space 512K, 0% used [0x00000000edc80000,0x00000000edc80000,0x00000000edd00000) ParOldGen total 105984K, used 96547K [0x00000000c3c00000, 0x00000000ca380000, 0x00000000ebf00000) object space 105984K, 91% used [0x00000000c3c00000,0x00000000c9a48f10,0x00000000ca380000) Metaspace used 114450K, capacity 122262K, committed 122368K, reserved 1157120K class space used 14018K, capacity 15294K, committed 15360K, reserved 1048576K jcmd &lt;pid&gt; GC.class_histogram: æŸ¥çœ‹ç±»åŠ è½½æƒ…å†µ ç±»ä¼¼ jmap -histo &lt;pid&gt; 12345678910111213141516171819$ jcmd 25238 GC.class_histogram25238: num #instances #bytes class name---------------------------------------------- 1: 106175 10838440 [C 2: 94344 3019008 java.util.concurrent.ConcurrentHashMap$Node 3: 105529 2532696 java.lang.String 4: 11203 2496608 [B 5: 20178 2430136 [Ljava.lang.Object; 6: 21642 2399904 java.lang.Classâ€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦Total 857252 51328200# num: åºå·# instances: å®ä¾‹æ•°é‡# bytes: å®ä¾‹å­—èŠ‚æ•°# class name: ç±»å, [C is a char[]ï¼Œ[S is a short[]ï¼Œ[I is a int[]ï¼Œ[B is a byte[]ï¼Œ[L is a List# Total: æ€»æ•° jcmd &lt;pid&gt; GC.heap_dump /path/to/heap.hprof: å¯¼å‡º heap dump æ›¿ä»£ jmap -dump:format=b,file=heap.hprof &lt;pid&gt;ï¼Œä½†ä»ä¼šæœ‰åœé¡¿ï¼ˆè§¦å‘FullGCï¼‰ï¼Œdump è¿‡ç¨‹æ…¢ï¼Œç”Ÿäº§ç¯å¢ƒæ…é‡ä½¿ç”¨ 1234567$ jcmd 25238 GC.heap_dump ./heap.hprof25238:Heap dump file created# æ³¨æ„è¿™é‡Œä½¿ç”¨çš„æ˜¯ç›¸å¯¹ç›®å½•ï¼Œ./heap.hprofï¼Œä½†æ­¤æ—¶ &quot;./&quot; å¹¶ä¸æ˜¯è¿è¡Œå‘½ä»¤æ—¶æ‰€åœ¨çš„ç›®å½•ï¼Œè€Œæ˜¯æŒ‡ Java è¿›ç¨‹çš„å·¥ä½œç›®å½•ï¼Œå¦‚æœä½ ä¸çŸ¥é“å·¥ä½œç›®å½•ï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹jcmd &lt;pid&gt; VM.system_properties | grep &quot;user.dir&quot;# linuxä¸‹ä¹Ÿå¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹ls -l /proc/&lt;pid&gt;/cwd å› ä¸ºç”Ÿäº§ç¯å¢ƒä¸æ¨èä½¿ç”¨ jmap æˆ– jcmd å¯¼å‡º heap dumpï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦åœ¨ç”Ÿäº§ç¯å¢ƒä¸­é…ç½®å¦‚ä¸‹jvmå‚æ•° 12-XX:+HeadDumpOnOutOfMemoryError # å†…å­˜æº¢å‡ºï¼ˆOOMï¼‰æ—¶ä¼šè‡ªåŠ¨ä¿å­˜å †å†…å­˜å¿«ç…§æ–‡ä»¶-XX:HeapDumpPath=/path/to/dump.hprof # æŒ‡å®šå †å†…å­˜å¿«ç…§æ–‡ä»¶ä¿å­˜è·¯å¾„ï¼Œå¦‚æœä¸é…ç½®ï¼Œåˆ™é»˜è®¤ä¿å­˜åœ¨ Java è¿›ç¨‹çš„å·¥ä½œç›®å½•ä¸‹ï¼Œæ–‡ä»¶åç§°é»˜è®¤ä¸º java_&lt;pid&gt;.hprof jhat: åˆ†æ Java Heap Dump æ–‡ä»¶ï¼ˆ.hprofï¼‰çš„å·¥å…· jhatï¼ˆJava Heap Analysis Toolï¼‰æ˜¯ JDK é™„å¸¦çš„ä¸€ä¸ªç”¨äº**åˆ†æ Java Heap Dump æ–‡ä»¶ï¼ˆ.hprofï¼‰**çš„å·¥å…·ã€‚å®ƒå¯ä»¥å°†å †å¿«ç…§ä½œä¸º HTTP æœåŠ¡åŠ è½½ï¼Œå¹¶å…è®¸ä½ é€šè¿‡æµè§ˆå™¨äº¤äº’å¼åœ°æŸ¥çœ‹å’ŒæŸ¥è¯¢å¯¹è±¡ä¿¡æ¯ã€‚ ä¸è¿‡éœ€è¦æ³¨æ„çš„æ˜¯ï¼š ğŸ”º ä» JDK 9 èµ·ï¼Œjhat å·²è¢«å®˜æ–¹åºŸå¼ƒï¼Œæ¨èä½¿ç”¨æ›´å¼ºå¤§çš„å·¥å…·å¦‚ VisualVMã€Eclipse MAT æˆ– jcmd + å¤–éƒ¨å·¥å…·ã€‚ 1234# é»˜è®¤ç«¯å£7000jhat &lt;heap dump file&gt;# æŒ‡å®šç«¯å£jhat -port 8000 &lt;heap dump file&gt; jvisualvm: å›¾å½¢åŒ–çš„ JVM ç›‘æ§ä¸åˆ†æå·¥å…· jvisualvmï¼ˆå…¨ç§°ï¼šJava VisualVMï¼‰æ˜¯ Java å®˜æ–¹æä¾›çš„ä¸€æ¬¾ å›¾å½¢åŒ–çš„ JVM ç›‘æ§ä¸åˆ†æå·¥å…·ï¼Œç”¨äºè§‚å¯Ÿã€åˆ†æå’Œè°ƒè¯•æ­£åœ¨è¿è¡Œçš„ Java ç¨‹åºã€‚å®ƒéå¸¸é€‚åˆå¼€å‘å’Œæµ‹è¯•ç¯å¢ƒä¸­è¿›è¡Œå†…å­˜åˆ†æã€çº¿ç¨‹åˆ†æã€GC è¡Œä¸ºè§‚å¯Ÿç­‰ä»»åŠ¡ã€‚ åŠŸèƒ½æ¦‚è§ˆ åŠŸèƒ½ æè¿° è¿›ç¨‹ç›‘æ§ æŸ¥çœ‹æœ¬åœ°æˆ–è¿œç¨‹ JVM è¿›ç¨‹çš„å†…å­˜ã€CPUã€çº¿ç¨‹ç­‰è¿è¡ŒçŠ¶æ€ å†…å­˜ä½¿ç”¨åˆ†æ æŸ¥çœ‹å †å†…å­˜ä½¿ç”¨æƒ…å†µã€GC æ¬¡æ•°å’Œæ—¶é—´ã€ç±»å®ä¾‹åˆ†å¸ƒç­‰ çº¿ç¨‹åˆ†æ æŸ¥çœ‹çº¿ç¨‹çŠ¶æ€ã€çº¿ç¨‹æ ˆã€æ˜¯å¦å­˜åœ¨æ­»é” GC åˆ†æ å›¾å½¢åŒ–å±•ç¤º GC æ´»åŠ¨ã€é¢‘ç‡ä¸è€—æ—¶ å †è½¬å‚¨åˆ†æ å¯¼å…¥ .hprof æ–‡ä»¶è¿›è¡Œå¯¹è±¡å®ä¾‹ã€ç±»ã€å¼•ç”¨å…³ç³»åˆ†æ CPU åˆ†æ åˆ†ææ–¹æ³•è°ƒç”¨è·¯å¾„ã€è€—æ—¶ã€çƒ­ç‚¹ä»£ç ï¼ˆéœ€æ‰‹åŠ¨å¯ç”¨ CPU profilerï¼‰ æ’ä»¶æ”¯æŒ å¯ä»¥é€šè¿‡æ’ä»¶å®‰è£…æ›´å¤šåŠŸèƒ½ï¼ˆå¦‚ Visual GCï¼‰ å¯åŠ¨ jvisualvm 12# ä¸è¦åœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ï¼Œå¦‚æœæ˜¯åˆ†ææœåŠ¡ç«¯ .hprof æ–‡ä»¶ï¼Œå¯ä»¥å¯¼å‡ºåˆ°æœ¬åœ°ååœ¨æœ¬åœ°å¯åŠ¨$ jvisualvm åœ¨ jvisualvm ä¸­å¯¼å…¥ .hprof æ–‡ä»¶ 12$ jvisualvm --openfile &lt;heap dump file&gt;# æˆ–è€… å…ˆæ‰“å¼€ jvisualvm åï¼Œç‚¹å‡» File -&gt; Open File -&gt; é€‰æ‹© .hprof æ–‡ä»¶ âš ï¸ æ³¨æ„äº‹é¡¹ æ³¨æ„ç‚¹ è¯´æ˜ ä¸é€‚ç”¨äºå¤§è§„æ¨¡ç”Ÿäº§ç¯å¢ƒç›‘æ§ å› ä¸ºå…¶åˆ†æè¿‡ç¨‹å¯èƒ½ä¼šå¯¹ JVM æœ‰è½»å¾®å½±å“ .hprof æ–‡ä»¶è¿‡å¤§æ—¶åŠ è½½ç¼“æ…¢ å¯é…åˆ Eclipse MAT ä½¿ç”¨ CPU/Memory Profiler ä¼šå¢åŠ ç³»ç»Ÿè´Ÿæ‹… ä½¿ç”¨æ—¶è°¨æ…ï¼Œå»ºè®®åªåœ¨æµ‹è¯•ç¯å¢ƒå¯ç”¨ Eclipse MAT: Java Heap Dump åˆ†æå·¥å…· Eclipse MATï¼ˆEclipse Memory Analyzer Toolï¼‰æ˜¯ä¸€ä¸ªç”¨äºåˆ†æ Java å †å¿«ç…§çš„å·¥å…·ï¼Œå®ƒæä¾›äº†è®¸å¤šåŠŸèƒ½æ¥å¸®åŠ©å¼€å‘äººå‘˜ç†è§£ Java åº”ç”¨ç¨‹åºä¸­çš„å†…å­˜é—®é¢˜ã€‚ MaxOSç³»ç»Ÿå®‰è£…Eclipse MATåï¼Œå¯åŠ¨æŠ¥é”™ï¼ŒæŠ¥é”™ä¿¡æ¯ä¸ºï¼šThe JVM shared library â€œ/Library/Internet Plug-Ins/JavaAppletPlugin.plugin/Contents/Home/bin/â€¦/lib/server/libjvm.dylibâ€ does not contain the JNI_CreateJavaVM symbol. è§£å†³æ–¹æ³•ï¼š 1.åœ¨åº”ç”¨åˆ—è¡¨ï¼Œæ‰¾åˆ°MemoryAnalyzer.appï¼Œç„¶åå³é”®å•å‡»åï¼Œé€‰æ‹©æ˜¾ç¤ºåŒ…å†…å®¹,è¿›å…¥Contentsç›®å½•ï¼Œæ‰¾åˆ°Info.plistæ–‡ä»¶ 2.æ‰“å¼€Info.plistæ–‡ä»¶åï¼Œå¯ä»¥çœ‹åˆ°æ³¨é‡Š&lt;string&gt;-vm&lt;/string&gt;é…ç½®é¡¹ï¼Œæˆ‘ä»¬éœ€è¦åšçš„å°±æ˜¯æ‰“å¼€è¿™ä¸ªé…ç½®é¡¹ï¼Œå¹¶ä¸”å°†å…¶è®¾ç½®ä¸ºæˆ‘ä»¬ç³»ç»Ÿçš„Javaè·¯å¾„ï¼Œæœ€æ–°ç‰ˆéœ€è¦jdk17+ 12&lt;string&gt;-vm&lt;/string&gt;&lt;string&gt;/Users/hanqf/develop_soft/jdk17/bin/java&lt;/string&gt; Arthas : æ¨è Arthas æ˜¯é˜¿é‡Œå·´å·´å¼€æºçš„ä¸€æ¬¾ Java è¯Šæ–­å·¥å…·ï¼Œä¸“ä¸ºçº¿ä¸Šè¯Šæ–­è€Œè®¾è®¡ã€‚å®ƒå¯ä»¥å¸®åŠ©å¼€å‘è€…åœ¨ä¸é‡å¯ã€ä¸ä¿®æ”¹ä»£ç çš„æƒ…å†µä¸‹ï¼Œæ’æŸ¥ç”Ÿäº§ç¯å¢ƒä¸­ Java åº”ç”¨çš„é—®é¢˜ã€‚ Arthas æ”¯æŒ JDK 6+ï¼Œæ”¯æŒ Linux/Mac/Windowsï¼Œé‡‡ç”¨å‘½ä»¤è¡Œäº¤äº’æ¨¡å¼ï¼ŒåŒæ—¶æä¾›ä¸°å¯Œçš„ Tab è‡ªåŠ¨è¡¥å…¨åŠŸèƒ½ï¼Œè¿›ä¸€æ­¥æ–¹ä¾¿è¿›è¡Œé—®é¢˜çš„å®šä½å’Œè¯Šæ–­ã€‚ è¿™é‡Œè¦æ³¨æ„ä¸€ç‚¹ï¼Œå°±æ˜¯Arthasä»4.xç‰ˆæœ¬å¼€å§‹ï¼Œéœ€è¦ä¾èµ–JDK8+ï¼Œå¦‚æœæ˜¯JDK6/7ï¼Œå¯ä»¥ä¸‹è½½æœ€åä¸€ä¸ª3.xç‰ˆæœ¬ 3.7.2ã€‚ ä¸ºäº†æ–¹ä¾¿æˆ‘ä»¬å­¦ä¹ ï¼ŒArthasè¿˜ä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªç»ƒä¹ åœºï¼ŒArthas Playgroundã€‚ Arthas æ ¸å¿ƒç‰¹ç‚¹ æ— éœ€é‡å¯ã€ä¾µå…¥æ€§ä½ Arthas å¯ä»¥ attach åˆ°æ­£åœ¨è¿è¡Œçš„ JVM ä¸Šï¼Œä¸éœ€è¦é‡å¯æœåŠ¡æˆ–ä¿®æ”¹æºä»£ç ã€‚ å‘½ä»¤å¼äº¤äº’ä½“éªŒ ç±»ä¼¼ Linux shell çš„æ“ä½œæ–¹å¼ï¼Œæ”¯æŒ tab è¡¥å…¨ã€ä¸Šä¸‹é”®å†å²å‘½ä»¤ç­‰ï¼Œéå¸¸ç›´è§‚ã€‚ å®æ—¶æŸ¥çœ‹å’Œç›‘æ§ å¯æŸ¥çœ‹æ–¹æ³•å‚æ•°ã€è¿”å›å€¼ã€è°ƒç”¨æ ˆã€æ‰§è¡Œè€—æ—¶ã€JVM çº¿ç¨‹ã€å†…å­˜ç­‰å®æ—¶æ•°æ®ã€‚ å¤šç§è¿æ¥æ–¹å¼ æ”¯æŒå‘½ä»¤è¡Œç»ˆç«¯ã€æœ¬åœ° shellã€Web é¡µé¢ã€telnet ç­‰å¤šç§è¿æ¥æ–¹å¼ã€‚ æ”¯æŒå¤šç§ JVM ç‰ˆæœ¬ æ”¯æŒ Java 6+ï¼ŒåŒ…æ‹¬ OpenJDKã€Oracle JDKã€Alibaba Dragonwell ç­‰ã€‚ Arthas å¸¸ç”¨å‘½ä»¤ å¯åŠ¨ 123456789101112131415161718192021222324252627282930313233343536java -jar arthas-boot.jar## è¾“å‡ºjava -jar arthas-boot.jar --target-ip 0.0.0.0[INFO] JAVA_HOME: /Library/Java/JavaVirtualMachines/jdk1.8.0_271.jdk/Contents/Home/jre[INFO] arthas-boot version: 4.0.5[INFO] Process 43959 already using port 3658[INFO] Process 43959 already using port 8563[INFO] Found existing java process, please choose one and input the serial number of the process, eg : 1. Then hit ENTER.* [1]: 43959 demo-arthas-spring-boot.jar [2]: 50851 org.jetbrains.idea.maven.server.RemoteMavenServer36 [3]: 50813 org.sonarsource.sonarlint.core.backend.cli.SonarLintServerCli [4]: 50655 com.intellij.idea.Main# å¯åŠ¨åï¼Œä¼šè‡ªåŠ¨è¿›å…¥äº¤äº’æ¨¡å¼ï¼Œæ­¤æ—¶è¾“å…¥è¦ç›‘æ§çš„è¿›ç¨‹åºå·1 # æ¯”å¦‚è¿™é‡Œè¾“å…¥ 1 å›è½¦## è¾“å‡º[INFO] arthas home: /Users/hanqf/.arthas/lib/4.0.5/arthas[INFO] The target process already listen port 3658, skip attach.[INFO] arthas-client connect 0.0.0.0 3658 ,---. ,------. ,--------.,--. ,--. ,---. ,---. / O \\ | .--. &#x27;&#x27;--. .--&#x27;| &#x27;--&#x27; | / O \\ &#x27; .-&#x27;| .-. || &#x27;--&#x27;.&#x27; | | | .--. || .-. |`. `-.| | | || |\\ \\ | | | | | || | | |.-&#x27; |`--&#x27; `--&#x27;`--&#x27; &#x27;--&#x27; `--&#x27; `--&#x27; `--&#x27;`--&#x27; `--&#x27;`-----&#x27;wiki https://arthas.aliyun.com/doctutorials https://arthas.aliyun.com/doc/arthas-tutorials.htmlversion 4.0.5main_class demo-arthas-spring-boot.jarpid 43959start_time 2025-05-14 14:57:18.031currnt_time 2025-05-14 14:59:22.004[arthas@43959]$ # æ­¤æ—¶è¿›å…¥ arthas å‘½ä»¤è¡Œäº¤äº’çŠ¶æ€# é€€å‡º arthas[arthas@43959]$ stop # é€€å‡º arthas arthas å‘½ä»¤æœ‰å¾ˆå¤šï¼Œå½“å¸¸ç”¨çš„ä¹Ÿå°±å‡ ä¸ªï¼Œå¦å¤–å¦‚æœè®°ä¸ä½æŸä¸ªå‘½ä»¤æ€ä¹ˆç”¨äº†å¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤æŸ¥è¯¢ 1&lt;command&gt; -h æˆ–è€… help &lt;command&gt; dashboard : å®æ—¶æŸ¥çœ‹ JVM è¿è¡ŒçŠ¶æ€ 123456789101112# æŸ¥çœ‹ JVM è¿è¡ŒçŠ¶æ€ï¼Œ é»˜è®¤æ¯éš” 5 ç§’åˆ·æ–° CPUã€å†…å­˜ã€çº¿ç¨‹ã€GC ç­‰ä¿¡æ¯# é»˜è®¤ä¼šä¸€ç›´åˆ·æ–°çŠ¶æ€ï¼ŒæŒ‰ `q` æˆ– `Ctrl+C` é€€å‡ºdashboard# æ¯éš” 2 ç§’åˆ·æ–°ä¸€æ¬¡dashboard -i 2000# åˆ·æ–° 10 æ¬¡ååœæ­¢dashboard -n 10# æ¯éš” 2 ç§’åˆ·æ–°ä¸€æ¬¡ï¼Œåˆ·æ–° 10 æ¬¡ååœæ­¢dashboard -i 2000 -n 10 thread : æŸ¥çœ‹å½“å‰ JVM çº¿ç¨‹ä¿¡æ¯ 1234567891011121314151617181920212223242526272829303132333435# æŸ¥çœ‹å½“å‰ JVM çº¿ç¨‹ä¿¡æ¯ï¼ŒæŒ‰ CPU ä½¿ç”¨ç‡å€’åºthread# æŸ¥çœ‹æ‰€æœ‰çº¿ç¨‹ä¿¡æ¯thread --all# æŸ¥çœ‹æŒ‡å®šçº¿ç¨‹çš„å †æ ˆä¿¡æ¯thread 18## è¾“å‡º&quot;http-nio-80-exec-1&quot; Id=18 WAITING on java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject@51866c16 at sun.misc.Unsafe.park(Native Method) - waiting on java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject@51866c16 at java.util.concurrent.locks.LockSupport.park(LockSupport.java:175) at java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.await(AbstractQueuedSynchronizer.java:2039) at java.util.concurrent.LinkedBlockingQueue.take(LinkedBlockingQueue.java:442) at org.apache.tomcat.util.threads.TaskQueue.take(TaskQueue.java:103) at org.apache.tomcat.util.threads.TaskQueue.take(TaskQueue.java:31) at java.util.concurrent.ThreadPoolExecutor.getTask(ThreadPoolExecutor.java:1074) at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1134) at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61) at java.lang.Thread.run(Thread.java:748)# æŸ¥çœ‹æœ€å¿™çš„å‰5ä¸ªçº¿ç¨‹çš„å †æ ˆä¿¡æ¯thread -n 5# æŸ¥çœ‹å…¨éƒ¨çº¿ç¨‹çš„å †æ ˆä¿¡æ¯thread -n -1# æŒ‡å®š cpu ä½¿ç”¨ç‡ç»Ÿè®¡çš„é‡‡æ ·é—´éš”ï¼Œå•ä½ä¸ºæ¯«ç§’ï¼Œé»˜è®¤å€¼ä¸º 200thread -i 500# æ‰¾å‡ºå½“å‰é˜»å¡å…¶ä»–çº¿ç¨‹çš„çº¿ç¨‹thread -b# æŸ¥çœ‹æŒ‡å®šçŠ¶æ€çš„çº¿ç¨‹thread --state WAITING sc : æŸ¥çœ‹ JVM å·²åŠ è½½çš„ç±»ä¿¡æ¯ Search-Class çš„ç®€å†™ï¼Œè¿™ä¸ªå‘½ä»¤èƒ½æœç´¢å‡ºæ‰€æœ‰å·²ç»åŠ è½½åˆ° JVM ä¸­çš„ Class ä¿¡æ¯ 1234567891011# é€šé…ç¬¦åŒ¹é…ï¼Œæ‰“å°æœç´¢åˆ°çš„ç±»å…¨åsc *.demo.*# æ‰“å°ç±»çš„è¯¦ç»†ä¿¡æ¯sc -d com.example.demo.arthas.AdminFilterConfig# æ‰“å°å‡ºç±»çš„ Field ä¿¡æ¯sc -d -f com.example.demo.arthas.AdminFilterConfig# é€šé…ç¬¦æŸ¥è¯¢å¹¶è·å–classLoaderHashsc -d *AdminFilterConfig | grep classLoaderHash sm : æŸ¥çœ‹å·²åŠ è½½ç±»çš„æ–¹æ³•ä¿¡æ¯ Search-Method çš„ç®€å†™ï¼Œè¿™ä¸ªå‘½ä»¤èƒ½æœç´¢å‡ºæ‰€æœ‰å·²ç»åŠ è½½åˆ° JVM ä¸­çš„ Method ä¿¡æ¯ 12345678# æ‰“å°æŒ‡å®šç±»ä¸­çš„æ–¹æ³•sm java.lang.String# å±•ç¤ºæ–¹æ³•çš„è¯¦ç»†ä¿¡æ¯sm -d java.lang.String# å±•ç¤ºæŒ‡å®šæ–¹æ³•çš„è¯¦ç»†ä¿¡æ¯sm -d java.lang.String substring# æ¨¡ç³ŠåŒ¹é…sm -d java.lang.String eq* jad : Javaæºç åç¼–è¯‘å·¥å…· éªŒè¯ç”Ÿäº§ç¯å¢ƒä¸‹çš„ä»£ç æ˜¯å¦ä¸æäº¤çš„ä»£ç ä¸€è‡´ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748# æ‰“å°å‡ºç±»çš„æºç ï¼Œç±»åjad com.example.demo.arthas.user.UserController## è¾“å‡ºjad com.example.demo.arthas.user.UserControllerClassLoader:+-org.springframework.boot.loader.LaunchedURLClassLoader@5b2133b1 +-sun.misc.Launcher$AppClassLoader@5c647e05 +-sun.misc.Launcher$ExtClassLoader@452b3a41Location:file:/Users/hanqf/Desktop/arhtas_dir/demo-arthas-spring-boot.jar!/BOOT-INF/classes!/ /* * Decompiled with CFR. * * Could not load the following classes: * com.example.demo.arthas.user.User * org.slf4j.Logger * org.slf4j.LoggerFactory * org.springframework.web.bind.annotation.GetMapping * org.springframework.web.bind.annotation.PathVariable * org.springframework.web.bind.annotation.RestController */ package com.example.demo.arthas.user; import com.example.demo.arthas.user.User; import org.slf4j.Logger; import org.slf4j.LoggerFactory; import org.springframework.web.bind.annotation.GetMapping; import org.springframework.web.bind.annotation.PathVariable; import org.springframework.web.bind.annotation.RestController; @RestController public class UserController &#123; private static final Logger logger = LoggerFactory.getLogger(UserController.class); @GetMapping(value=&#123;&quot;/user/&#123;id&#125;&quot;&#125;) public User findUserById(@PathVariable Integer id) &#123;/*15*/ logger.info(&quot;id: &#123;&#125;&quot;, (Object)id);/*17*/ if (id != null &amp;&amp; id &lt; 1) &#123; throw new IllegalArgumentException(&quot;id &lt; 1&quot;); &#125; return new User(id.intValue(), &quot;name&quot; + id); &#125; &#125;Affect(row-cnt:1) cost in 411 ms. 12345678910111213# åç¼–è¯‘åçš„æºç ä¼šæœ‰ç±»åŠ è½½å™¨çš„ä¿¡æ¯ï¼Œå¦‚æœåªå¸Œæœ›æ‰“å°æºç ï¼Œå¯ä»¥åŠ ä¸Š --source-onlyjad --source-only com.example.demo.arthas.user.UserController# ä¸æ˜¾ç¤ºè¡Œå·jad --source-only com.example.demo.arthas.user.UserController --lineNumber false# è¾“å‡ºåˆ°æ–‡ä»¶jad --source-only com.example.demo.arthas.user.UserController &gt; /tmp/UserController.java# æ‰“å°å‡ºç±»ä¸­æŸä¸ªæ–¹æ³•çš„æºç ï¼Œç±»å + æ–¹æ³•åjad com.example.demo.arthas.user.UserController findUserById# åç¼–è¯‘æ—¶æŒ‡å®šdump classæ–‡ä»¶ç›®å½•jad --source-only com.example.demo.arthas.user.UserController --lineNumber false -d /tmp/jad å½“æœ‰å¤šä¸ª ClassLoader éƒ½åŠ è½½äº†è¿™ä¸ªç±»æ—¶ï¼Œjad å‘½ä»¤ä¼šè¾“å‡ºå¯¹åº” ClassLoader å®ä¾‹çš„ hashcodeï¼Œç„¶åä½ åªéœ€è¦é‡æ–°æ‰§è¡Œ jad å‘½ä»¤ï¼Œå¹¶ä½¿ç”¨å‚æ•° -c å°±å¯ä»¥åç¼–è¯‘æŒ‡å®š ClassLoader åŠ è½½çš„é‚£ä¸ªç±»äº†ï¼› 123456789101112131415$ jad org.apache.log4j.LoggerFound more than one class for: org.apache.log4j.Logger, Please use jad -c hashcode org.apache.log4j.LoggerHASHCODE CLASSLOADER69dcaba4 +-monitor&#x27;s ModuleClassLoader6e51ad67 +-java.net.URLClassLoader@6e51ad67 +-sun.misc.Launcher$AppClassLoader@6951a712 +-sun.misc.Launcher$ExtClassLoader@6fafc4c22bdd9114 +-pandora-qos-service&#x27;s ModuleClassLoader4c0df5f8 +-pandora-framework&#x27;s ModuleClassLoaderAffect(row-cnt:0) cost in 38 ms.# æŒ‡å®šç±»åŠ è½½å™¨$ jad org.apache.log4j.Logger -c 69dcaba4 mc : Memory Compiler/å†…å­˜ç¼–è¯‘å™¨ï¼Œç¼–è¯‘.javaæ–‡ä»¶ç”Ÿæˆ.class 12345678# ç¼–è¯‘ï¼Œè¿™é‡Œä¸€å®šè¦æŒ‡å®šç±»åŠ è½½å™¨ï¼Œå¦åˆ™ä¼šæŠ¥é”™ï¼Œå› ä¸ºä½ ç¼–è¯‘çš„ç±»ä¸­å¯èƒ½importå…¶å®ƒç±»ï¼Œä¸æŒ‡å®šå°±ä¼šæç¤ºæ‰¾ä¸åˆ°å¯¹åº”çš„ç±»ã€‚# ç±»åŠ è½½å™¨å¯ä»¥é€šè¿‡ jad å‘½ä»¤è·å–mc --classLoaderClass org.springframework.boot.loader.LaunchedURLClassLoader /tmp/UserController.java# æŒ‡å®šç±»åŠ è½½å™¨çš„ç¼–å·mc -c 5b2133b1 /tmp/UserController.java# å°† UserController.class æ–‡ä»¶è¾“å‡ºåˆ°æŒ‡å®šç›®å½•ï¼Œ -d æŒ‡å®šè¾“å‡ºç›®å½•mc --classLoaderClass org.springframework.boot.loader.LaunchedURLClassLoader /tmp/UserController.java -d /tmp mc å‘½ä»¤æœ‰å¯èƒ½å¤±è´¥ã€‚å¦‚æœç¼–è¯‘å¤±è´¥å¯ä»¥åœ¨æœ¬åœ°ç¼–è¯‘å¥½.classæ–‡ä»¶ï¼Œå†ä¸Šä¼ åˆ°æœåŠ¡å™¨ã€‚ retransform : é‡æ–°åŠ è½½ç±»(çƒ­ä¿®æ”¹ä»£ç ) 123456789101112retransform /tmp/com/example/demo/arthas/user/UserController.class# æŸ¥çœ‹ é€šè¿‡ retransform é‡æ–°åŠ è½½çš„ classretransform -l# åˆ é™¤é€šè¿‡ retransform é‡æ–°åŠ è½½çš„ classï¼Œé€šè¿‡ id åˆ é™¤retransform -d 1# åˆ é™¤æ‰€æœ‰retransform --deleteAll# åˆ é™¤åè¦é‡æ–°è§¦å‘ retransformï¼Œå¦åˆ™å†…å­˜ä¸­ä¾æ—§ä½¿ç”¨çš„æ˜¯åˆ é™¤å‰çš„ classretransform --classPattern com.example.demo.arthas.user.UserController sysprop : æŸ¥çœ‹å½“å‰ JVM çš„ç³»ç»Ÿå±æ€§ 1234567891011# æ‰“å°ç³»ç»Ÿå±æ€§sysprop# æŒ‡å®šå•ä¸ª keyï¼Œkeyæ”¯æŒè‡ªåŠ¨è¡¥å…¨sysprop java.version# é€šè¿‡grepè¿‡æ»¤sysprop | grep user# è®¾ç½® æˆ– ä¿®æ”¹ ç³»ç»Ÿå±æ€§sysprop testKey testValue sysenv : æŸ¥çœ‹å½“å‰ JVM çš„ç¯å¢ƒå˜é‡ 123456# åˆ—å‡ºæ‰€æœ‰ç¯å¢ƒå˜é‡sysenv# æŒ‡å®šå•ä¸ª keyï¼Œkeyæ”¯æŒè‡ªåŠ¨è¡¥å…¨sysenv PATH# é€šè¿‡grepè¿‡æ»¤sysenv | grep PATH jvm : æŸ¥çœ‹å½“å‰ JVM çš„ä¿¡æ¯ï¼ŒåŒ…å«å¾ˆå¤šé‡è¦çš„ä¿¡æ¯ 1jvm GARBAGE-COLLECTORS GC ç›¸å…³ THREAD ç›¸å…³ 12345COUNT: JVM å½“å‰æ´»è·ƒçš„çº¿ç¨‹æ•°DAEMON-COUNT: JVM å½“å‰æ´»è·ƒçš„å®ˆæŠ¤çº¿ç¨‹æ•°PEAK-COUNT: ä» JVM å¯åŠ¨å¼€å§‹æ›¾ç»æ´»ç€çš„æœ€å¤§çº¿ç¨‹æ•°STARTED-COUNT: ä» JVM å¯åŠ¨å¼€å§‹æ€»å…±å¯åŠ¨è¿‡çš„çº¿ç¨‹æ¬¡æ•°DEADLOCK-COUNT: JVM å½“å‰æ­»é”çš„çº¿ç¨‹æ•° FILE-DESCRIPTOR æ–‡ä»¶æè¿°ç¬¦ç›¸å…³ 12MAX-FILE-DESCRIPTOR-COUNTï¼šJVM è¿›ç¨‹æœ€å¤§å¯ä»¥æ‰“å¼€çš„æ–‡ä»¶æè¿°ç¬¦æ•°OPEN-FILE-DESCRIPTOR-COUNTï¼šJVM å½“å‰æ‰“å¼€çš„æ–‡ä»¶æè¿°ç¬¦æ•° watch : å‡½æ•°æ‰§è¡Œæ•°æ®è§‚æµ‹ è®©ä½ èƒ½æ–¹ä¾¿çš„è§‚å¯Ÿåˆ°æŒ‡å®šå‡½æ•°çš„è°ƒç”¨æƒ…å†µã€‚èƒ½è§‚å¯Ÿåˆ°çš„èŒƒå›´ä¸ºï¼šè¿”å›å€¼ã€æŠ›å‡ºå¼‚å¸¸ã€å…¥å‚ï¼Œé€šè¿‡ç¼–å†™ OGNL è¡¨è¾¾å¼è¿›è¡Œå¯¹åº”å˜é‡çš„æŸ¥çœ‹ã€‚ 123456789101112131415161718192021# è§‚å¯ŸæŒ‡å®šç±»ä¸­æŸä¸ªæ–¹æ³•çš„è°ƒç”¨æƒ…å†µï¼ŒclassName + methodName + è¿”å›å€¼è¡¨è¾¾å¼# å¼€å¯åï¼Œå½“æ–¹æ³•è¢«è°ƒç”¨æ—¶ï¼Œä¼šæŒ‰ç…§æŒ‡å®šçš„ `è¿”å›å€¼è¡¨è¾¾å¼` è¾“å‡ºç»“æœï¼Œè¿”å›å€¼è¡¨è¾¾å¼ å¯ä»¥ä¸æŒ‡å®šï¼Œé»˜è®¤ä¸º &#123;params, target, returnObj&#125;watch com.example.demo.arthas.user.UserController findUserById &#x27;&#123;params, throwExp&#125;&#x27;# è§‚å¯Ÿå…¨éƒ¨æ–¹æ³•ï¼Œé€šé…ç¬¦åŒ¹é…watch com.example.demo.arthas.user.UserController &#x27;*&#x27; &#x27;&#123;params, throwExp&#125;&#x27;# é»˜è®¤è¾“å‡ºç»“æœæ²¡æœ‰å±•å¼€ï¼Œå¯ä»¥åŠ ä¸Š -x æŒ‡å®šè¾“å‡ºç»“æœçš„å±æ€§éå†æ·±åº¦ï¼Œé»˜è®¤ä¸º 1ï¼Œæœ€å¤§å€¼æ˜¯ 4watch com.example.demo.arthas.user.UserController &#x27;*&#x27; &#x27;&#123;params, throwExp&#125;&#x27; -x 2# ä»…å½“æŠ›å‡ºå¼‚å¸¸æ—¶æ‰æ‰“å°ï¼Œ-e åœ¨å‡½æ•°å¼‚å¸¸ä¹‹åè§‚å¯Ÿwatch com.example.demo.arthas.user.UserController &#x27;*&#x27; &#x27;&#123;params, throwExp&#125;&#x27; -x 2 -e# å‚æ•°æ¡ä»¶è¿‡æ»¤ï¼Œparams[0] &gt; 100 è¡¨ç¤ºæ–¹æ³•å…¥å‚ä¸­ç¬¬ä¸€ä¸ªå‚æ•°çš„å€¼å¤§äº 100 æ—¶æ‰è§¦å‘æ‰“å°watch com.example.demo.arthas.user.UserController * returnObj &#x27;params[0] &gt; 100&#x27;# æŒ‰è¯·æ±‚è€—æ—¶è¿›è¡Œè¿‡æ»¤ï¼Œ#cost&gt;200 è¡¨ç¤ºè€—æ—¶å¤§äº200mswatch com.example.demo.arthas.user.UserController * &#x27;&#123;params, returnObj&#125;&#x27; &#x27;#cost&gt;200&#x27;# é€€å‡ºwatchq watch å‘½ä»¤è¡¨è¾¾å¼æ”¯æŒå˜é‡è¯´æ˜è¡¨ åç§° ç±»å‹/è¯´æ˜ ä½œç”¨/å«ä¹‰ loader ClassLoader æ–¹æ³•æ‰€åœ¨ç±»çš„ç±»åŠ è½½å™¨å¯¹è±¡ clazz Class&lt;?&gt; æ–¹æ³•æ‰€å±çš„ç±»ï¼ˆClass å¯¹è±¡ï¼‰ method java.lang.reflect.Method è¢«è°ƒç”¨çš„æ–¹æ³•çš„åå°„å¯¹è±¡ target Object æ–¹æ³•çš„è°ƒç”¨ç›®æ ‡å¯¹è±¡ï¼ˆå³ this å¯¹è±¡ï¼‰ï¼Œé™æ€æ–¹æ³•ä¸­ä¸º null params Object[] æ–¹æ³•çš„å…¥å‚æ•°ç»„ returnObj Object æ–¹æ³•çš„è¿”å›å€¼ throwExp Throwable æ–¹æ³•æŠ›å‡ºçš„å¼‚å¸¸ isBefore boolean å½“å‰æ‰§è¡Œä½ç½®æ˜¯å¦æ˜¯æ–¹æ³•è°ƒç”¨ä¹‹å‰ï¼ˆBEFORE é˜¶æ®µï¼‰ isThrow boolean å½“å‰æ–¹æ³•æ˜¯å¦ä»¥å¼‚å¸¸ç»“æŸï¼ˆTHROWS é˜¶æ®µï¼‰ isReturn boolean å½“å‰æ–¹æ³•æ˜¯å¦æ­£å¸¸è¿”å›ï¼ˆRETURN é˜¶æ®µï¼‰ jobs : æŸ¥çœ‹è¿è¡Œä¸­çš„ä»»åŠ¡ 12345678910111213141516171819202122# å¦‚ä¸‹å‘½ä»¤ä¼šè½¬åˆ°åå°è¿è¡Œ ï¼Œä¸linuxå‘½ä»¤ç±»ä¼¼ï¼Œå‘½ä»¤æœ€ååŠ ä¸Š `&amp;` å³å¯watch com.example.demo.arthas.user.UserController * &#x27;&#123;params, throwExp&#125;&#x27; &#x27;throwExp != null&#x27; &gt;&gt; a.log &amp;# æŸ¥çœ‹åå°ä»»åŠ¡jobs## è¾“å‡º[1]* Running watch com.example.demo.arthas.user.UserController * &#x27;&#123;params, throwExp&#125;&#x27; &#x27;throwExp != null&#x27; &gt;&gt; a.log &amp; execution count : 0 start time : Thu May 15 15:10:04 CST 2025 timeout date : Fri May 16 15:10:04 CST 2025 session : ded56dfd-5683-4427-ac08-792f8fb75e5e (current)# ç»“æŸä»»åŠ¡kill 1 # 1ä¸ºåå°ä»»åŠ¡id# å°†åå°ä»»åŠ¡è½¬åˆ°å‰å°fg 1 # 1ä¸ºåå°ä»»åŠ¡id# æš‚åœä»»åŠ¡ï¼Œä½†æ­¤æ—¶ä¼šå°†arthasè¿›ç¨‹éƒ½æŒ‚èµ·ï¼Œæ‰€ä»¥å¹¶ä¸å¥½ç”¨ctrl+z# å°†å‰å°ä»»åŠ¡è½¬åˆ°åå°ç»§ç»­æ‰§è¡Œbg 1 # 1ä¸ºå‰å°ä»»åŠ¡id logger : æŸ¥çœ‹ logger ä¿¡æ¯ï¼Œæ›´æ–° logger level 1234567891011# æŸ¥çœ‹ logger ä¿¡æ¯logger# æŸ¥çœ‹æŒ‡å®šåå­—çš„loggerä¿¡æ¯logger -n ROOT# æŸ¥çœ‹æ²¡æœ‰ appender çš„ logger çš„ä¿¡æ¯ï¼Œä¸åŠ è¿™ä¸ªå‚æ•°åªä¼šæ‰“å°æœ‰ appender çš„ logger çš„ä¿¡æ¯logger --include-no-appender# æ›´æ–° logger levelï¼Œ-c classLoader çš„ hashcodelogger --name ROOT --level debug -c 5b2133b1logger --name ROOT --level error --classLoaderClass org.springframework.boot.loader.LaunchedURLClassLoader classloader : æŸ¥çœ‹ classloader çš„ç»§æ‰¿æ ‘ï¼Œurlsï¼Œç±»åŠ è½½ä¿¡æ¯ 12345678# æŸ¥çœ‹ classloader çš„ä¿¡æ¯ï¼ŒåŠ è½½classçš„æ•°é‡ï¼Œhashcodeï¼Œclassloader çš„ parentclassloader -l# æ ‘å½¢å±•ç¤ºclassloader -t# æŸ¥æ‰¾èµ„æºï¼Œæ¯”å¦‚æŸ¥æ‰¾æŒ‡å®šåç§°çš„æ–‡ä»¶classloader -c 5b2133b1 -r application.propertiesclassloader --classLoaderClass org.springframework.boot.loader.LaunchedURLClassLoader -r logback-spring.xml ognl : æ‰§è¡Œ ognl è¡¨è¾¾å¼ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152# è°ƒç”¨é™æ€å‡½æ•°ognl &#x27;@java.lang.System@out.println(&quot;hello&quot;)&#x27;ognl &#x27;@java.lang.Math@sqrt(9.0)&#x27;# è·å–é™æ€ç±»çš„é™æ€å­—æ®µognl &#x27;@java.io.File@separator&#x27;# éœ€è¦æŒ‡å®šclassLoaderClassognl --classLoaderClass org.springframework.boot.loader.LaunchedURLClassLoader @com.example.demo.arthas.user.UserController@logger# è·å–classLoaderHashsc -d *UserController | grep classLoaderHashognl -c 5b2133b1 @com.example.demo.arthas.user.UserController@logger# è¿”å›å€¼å±•å¼€åŸºå±‚ -xognl -c 5b2133b1 @com.example.demo.arthas.user.UserController@logger -x 3# æ‰§è¡Œå¤šè¡Œè¡¨è¾¾å¼ï¼Œèµ‹å€¼ç»™ä¸´æ—¶å˜é‡ï¼Œè¿”å›ä¸€ä¸ª Listognl &#x27;#value1=@System@getProperty(&quot;java.home&quot;), #value2=@System@getProperty(&quot;java.runtime.name&quot;), &#123;#value1, #value2&#125;&#x27;# ç´¢å¼•# è·å–æ•°ç»„ä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ ognl &quot;&#123;1,2,3,4&#125;[0]&quot;# å˜é‡å¼•ç”¨ï¼Œä½¿ç”¨ # åœ¨ OGNL ä¸­å®šä¹‰ä¸´æ—¶å˜é‡ï¼Œä»–ä»¬å…¨å±€å¯è§ï¼Œæ­¤å¤–è¡¨è¾¾å¼è®¡ç®—çš„æ¯ä¸€æ­¥ç»“æœéƒ½ä¿å­˜åœ¨å˜é‡ this ä¸­# ä¸‹é¢å‘½ä»¤é€šè¿‡è·å–åˆ—è¡¨çš„ç¬¬ä¸€ä¸ªå…ƒç´ è¿›è¡Œåˆ¤æ–­å¦‚æœå¤§äº 5 åˆ™ä¹˜ä»¥ 2 åä¹‹åˆ™åŠ  10ognl &quot;&#123;10,20,30&#125;[0].(#this &gt; 5 ? #this*2 : #this+10)&quot;# æ¯ä¸ªå…ƒç´ ä¹˜ä»¥ 2 åè¿”å›ognl &quot;&#123;1, 2, 3&#125;.&#123;#this*2&#125;&quot;# æ–¹æ³•è°ƒç”¨# é€šè¿‡ä¸‹é¢å‘½ä»¤å¯ä»¥è°ƒç”¨ ArrayList çš„ size() æ–¹æ³•è·å–åˆ° ArrayList çš„å¤§å°ognl &quot;&#123;1,2,3,4&#125;.size()&quot;# å¤æ‚é“¾å¼è¡¨è¾¾å¼ognl &quot;@java.lang.System@out.(print(&#x27;Hello &#x27;), print(&#x27;world\\n&#x27;))&quot;# æ–°å»ºåŸç”Ÿæ•°ç»„ognl &quot;new int[] &#123;1, 2, 3&#125;&quot;# æ–°å»ºæ™®é€š Mapognl &quot;#&#123; &#x27;foo&#x27;: &#x27;foo value&#x27;, &#x27;bar&#x27;: &#x27;bar value&#x27; &#125;&quot;# æ–°å»ºç‰¹å®šç±»å‹ Mapognl &quot;#@java.util.HashMap@&#123; &#x27;foo&#x27;: &#x27;foo value&#x27;, &#x27;bar&#x27;: &#x27;bar value&#x27; &#125;&quot;# æŸ¥æ‰¾æ‰€æœ‰åŒ¹é…çš„å…ƒç´ ognl &quot;&#123;1024, &#x27;Hello world!&#x27;, true, 2048&#125;.&#123;? #this instanceof Number&#125;&quot;# æŸ¥æ‰¾ç¬¬ä¸€ä¸ªåŒ¹é…çš„å…ƒç´ ognl &quot;&#123;1024, &#x27;Hello world!&#x27;, true, 2048&#125;.&#123;^ #this instanceof Number&#125;&quot;# æŸ¥æ‰¾æœ€åä¸€ä¸ªåŒ¹é…çš„å…ƒç´ ognl &quot;&#123;1024, &#x27;Hello world!&#x27;, true, 2048&#125;.&#123;$ #this instanceof Number&#125;&quot; vmoption : æŸ¥çœ‹ï¼Œæ›´æ–° VM è¯Šæ–­ç›¸å…³çš„å‚æ•° 1234567# æŸ¥çœ‹æ‰€æœ‰çš„ optionvmoption# æŸ¥çœ‹æŒ‡å®šçš„ optionvmoption PrintGC# æ›´æ–°æŒ‡å®šçš„ optionvmoption PrintGC truevmoption PrintGCDetails true vmtool : å®ç°æŸ¥è¯¢å†…å­˜å¯¹è±¡ï¼Œå¼ºåˆ¶ GC ç­‰åŠŸèƒ½ 1234567891011121314151617# è·å–å¯¹è±¡ï¼Œ--action getInstances: è·å–å¯¹è±¡å®ä¾‹ï¼Œ--className: æŒ‡å®šç±»åï¼Œ--limit: æŒ‡å®šè·å–æ•°é‡vmtool --action getInstances --className java.lang.String --limit 10# æŒ‡å®š classloader nameï¼Œè¿™é‡Œè·å– springçš„ ApplicationContext å¯¹è±¡ï¼Œ-x: å±•å¼€å¤šå°‘å±‚vmtool --action getInstances --classLoaderClass org.springframework.boot.loader.LaunchedURLClassLoader --className org.springframework.context.ApplicationContext -x 3# æŒ‡å®š classloader hashsc -d org.springframework.context.ApplicationContext | grep classLoaderHashvmtool --action getInstances -c 19469ea2 --className org.springframework.context.ApplicationContext# æ‰§è¡Œè¡¨è¾¾å¼ï¼Œ--express: æ‰§è¡Œçš„è¡¨è¾¾å¼ï¼Œè¿™é‡Œæ˜¯è°ƒç”¨å¯¹è±¡çš„æ–¹æ³•vmtool --action getInstances --className com.example.demo.arthas.aop.HelloWorldService --express &#x27;instances[0].getHelloMessage()&#x27;# å¼ºåˆ¶ GCï¼Œå¯ä»¥ç»“åˆ vmoption å‘½ä»¤åŠ¨æ€æ‰“å¼€PrintGCå¼€å…³vmtool --action forceGc# ä¸­æ–­çº¿ç¨‹ï¼Œ -t çº¿ç¨‹ID,å¯ä»¥ä½¿ç”¨ threadå‘½ä»¤è·å–vmtool --action interruptThread -t 1","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç»JVMçš„å‘½ä»¤è¡Œå·¥å…· JDK8 The JavaÂ® Virtual Machine Specification JDK8çš„javaæŒ‡ä»¤çš„å®˜â½…â½‚æ¡£ JDKâ¼¯å…·å®˜â½¹â½‚æ¡£ JDK17çš„javaæŒ‡ä»¤çš„å®˜â½…â½‚æ¡£","date_published":"2025-05-13T13:30:05.000Z","tags":["æŠ€æœ¯","jvm","jvm"]},{"id":"https://blog.hanqunfeng.com/2025/05/12/jvm-gc-01/","url":"https://blog.hanqunfeng.com/2025/05/12/jvm-gc-01/","title":"JVM ä¹‹ å†…å­˜æ¨¡å‹ä¸åƒåœ¾å›æ”¶æœºåˆ¶(GC)","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç»JVMçš„å†…å­˜æ¨¡å‹ä¸åƒåœ¾å›æ”¶æœºåˆ¶</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://docs.oracle.com/javase/specs/jvms/se8/html/index.html\">JDK8 The JavaÂ® Virtual Machine Specification</a></p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://docs.oracle.com/javase/8/docs/technotes/tools/unix/java.html\">JDK8çš„javaæŒ‡ä»¤çš„å®˜â½…â½‚æ¡£</a></p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://docs.oracle.com/en/java/javase/17/docs/specs/man/index.html\">JDKâ¼¯å…·å®˜â½¹â½‚æ¡£</a></p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://docs.oracle.com/en/java/javase/17/docs/specs/man/java.html\">JDK17çš„javaæŒ‡ä»¤çš„å®˜â½…â½‚æ¡£</a></p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"JVMè™šæ‹Ÿæœºç»“æ„-HotSpot\">JVMè™šæ‹Ÿæœºç»“æ„(HotSpot)</h2>\n<p><img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/uPic/cGMyEe.png\" alt=\"\"></p>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è®¾ç½®å†…å­˜åˆ†é…ç¤ºä¾‹</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># jdk1.8+</span></span><br><span class=\"line\">java â€Xms2048M â€Xmx2048M â€Xmn1024M â€Xss512K â€XX:MetaspaceSize=128M â€XX:MaxMetaspaceSize=256M â€jar server.jar</span><br><span class=\"line\"><span class=\"comment\"># jdk1.6/1.7</span></span><br><span class=\"line\">java â€Xms2048M â€Xmx2048M â€Xmn1024M â€Xss512K â€XX:PermSize=128M â€XX:MaxPermSize=256M â€jar server.jar</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å„å‚æ•°å«ä¹‰ä¸é»˜è®¤å€¼ï¼ˆé’ˆå¯¹ JDK 1.8ï¼‰</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>å‚æ•°</th>\n<th>å«ä¹‰è¯´æ˜</th>\n<th>é»˜è®¤å€¼ï¼ˆJDK 1.8ï¼‰</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>-Xms2048M</code></td>\n<td><strong>åˆå§‹å †å¤§å°</strong>ï¼Œå³ JVM å¯åŠ¨æ—¶åˆ†é…çš„å †å†…å­˜å¤§å°ï¼ˆè¿™é‡Œæ˜¯ 2GBï¼‰</td>\n<td>ç‰©ç†å†…å­˜çš„ 1/64ï¼ˆæœ€å° 1MBï¼‰ï¼Œæ¨èé…ç½®ä¸ºä¸ -Xmx ä¸€è‡´</td>\n</tr>\n<tr>\n<td><code>-Xmx2048M</code></td>\n<td><strong>æœ€å¤§å †å†…å­˜å¤§å°</strong>ï¼ŒJVM å…è®¸åˆ†é…çš„æœ€å¤§å †å†…å­˜</td>\n<td>ç‰©ç†å†…å­˜çš„ 1/4ï¼ˆå—é™äº 32ä½/64ä½ï¼‰</td>\n</tr>\n<tr>\n<td><code>-Xmn1024M</code></td>\n<td><strong>æ–°ç”Ÿä»£å¤§å°</strong>ï¼ˆEden + Survivorï¼‰ä¸º 1GB</td>\n<td>æœªæ˜¾å¼æŒ‡å®šæ—¶ï¼Œé€šå¸¸å å †çš„ 1/3 å·¦å³</td>\n</tr>\n<tr>\n<td><code>-Xss512K</code></td>\n<td><strong>æ¯ä¸ªçº¿ç¨‹çš„æ ˆå¤§å°</strong>ï¼ˆThread Stack Sizeï¼‰ï¼Œè¿™é‡Œè®¾ç½®ä¸º 512KB</td>\n<td>1MBï¼ˆ64ä½ç³»ç»Ÿï¼‰æˆ– 512KBï¼ˆ32ä½ç³»ç»Ÿï¼‰</td>\n</tr>\n<tr>\n<td><code>-XX:MetaspaceSize=256M</code></td>\n<td><strong>å…ƒç©ºé—´åˆå§‹å¤§å°</strong>ï¼ˆç”¨äºåŠ è½½ç±»çš„å…ƒæ•°æ®ï¼Œä¸å†ä½¿ç”¨ PermGenï¼‰ï¼Œè¾¾åˆ°è¯¥å€¼åï¼ŒJVM ä¼šè§¦å‘ä¸€æ¬¡ GCï¼Œç©ºé—´ä¸å¤Ÿæ—¶ä¼šè¿›è¡Œæ‰©å®¹ï¼Œæœ€å¤§åˆ°  <code>MaxMetaspaceSize</code></td>\n<td>é»˜è®¤ 21MBï¼ˆå®¢æˆ·ç«¯ï¼‰æˆ– 16MBï¼ˆæœåŠ¡å™¨ç«¯ï¼‰ï¼Œä¸ºé¿å…é¢‘ç¹æ‰©å®¹å¯¼è‡´çš„GCï¼Œå¯ä»¥è®¾ç½®çš„ç¨å¾®å¤§ä¸€äº›ï¼Œæ¯”å¦‚<code>MaxMetaspaceSize</code>çš„ä¸€åŠï¼Œæˆ–å¹²è„†ä¸<code>MaxMetaspaceSize</code>ä¸€æ ·å¤§</td>\n</tr>\n<tr>\n<td><code>-XX:MaxMetaspaceSize=256M</code></td>\n<td><strong>å…ƒç©ºé—´æœ€å¤§å¤§å°</strong>ï¼Œæ¥è¿‘è®¾ç½®å€¼æ—¶ä¼šè§¦å‘ Full GC</td>\n<td>æ— é™åˆ¶ï¼ˆé»˜è®¤åªå—ç‰©ç†å†…å­˜çº¦æŸï¼‰ ï¼Œæ¨èé…ç½®ä¸€ä¸ªåˆé€‚çš„æ•°å€¼ï¼Œæ¯”å¦‚8Gçš„å†…å­˜å¯ä»¥é…ç½®ä¸º256M</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"ç±»è£…è½½å­ç³»ç»Ÿï¼ˆClass-Loading-Subsystemï¼‰\">ç±»è£…è½½å­ç³»ç»Ÿï¼ˆClass Loading Subsystemï¼‰</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç±»è£…è½½å­ç³»ç»Ÿè´Ÿè´£å°† <code>.class</code> æ–‡ä»¶åŠ è½½åˆ° JVM ä¸­ï¼Œå¹¶è¿›è¡Œè§£æã€éªŒè¯ã€åˆå§‹åŒ–ç­‰è¿‡ç¨‹ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>åŠ è½½è¿‡ç¨‹çš„å‡ ä¸ªé˜¶æ®µï¼š</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>é˜¶æ®µ</th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>åŠ è½½ï¼ˆLoadingï¼‰</strong></td>\n<td>å°† <code>.class</code> æ–‡ä»¶è¯»å–ä¸ºäºŒè¿›åˆ¶æ•°æ®ï¼Œæ„é€  <code>Class</code> å¯¹è±¡</td>\n</tr>\n<tr>\n<td><strong>éªŒè¯ï¼ˆVerificationï¼‰</strong></td>\n<td>ç¡®ä¿å­—èŠ‚ç æ–‡ä»¶æ ¼å¼æ­£ç¡®ã€å®‰å…¨åˆæ³•ï¼ˆé˜²æ­¢æ¶æ„ä»£ç ï¼‰</td>\n</tr>\n<tr>\n<td><strong>å‡†å¤‡ï¼ˆPreparationï¼‰</strong></td>\n<td>ä¸ºç±»çš„é™æ€å˜é‡åˆ†é…å†…å­˜ï¼Œå¹¶è®¾ç½®é»˜è®¤åˆå§‹å€¼</td>\n</tr>\n<tr>\n<td><strong>è§£æï¼ˆResolutionï¼‰</strong></td>\n<td>å°†å¸¸é‡æ± ä¸­çš„ç¬¦å·å¼•ç”¨æ›¿æ¢ä¸ºç›´æ¥å¼•ç”¨ï¼ˆæ–¹æ³•ã€å­—æ®µç­‰ï¼‰</td>\n</tr>\n<tr>\n<td><strong>åˆå§‹åŒ–ï¼ˆInitializationï¼‰</strong></td>\n<td>æ‰§è¡Œ <code>&lt;clinit&gt;</code> é™æ€åˆå§‹åŒ–æ–¹æ³•ï¼Œå¯¹é™æ€å˜é‡èµ‹åˆå§‹å€¼</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç±»åŠ è½½å™¨ï¼ˆClassLoaderï¼‰ä½“ç³»ç»“æ„ï¼šè¯¦ç»†å‚è€ƒ <a href=\"/2025/05/08/jvm-classloader-01/\" title=\"JVM ä¹‹ ç±»åŠ è½½å™¨\">JVM ä¹‹ ç±»åŠ è½½å™¨</a></p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>ç±»åŠ è½½å™¨åç§°</th>\n<th>åŠ è½½å†…å®¹</th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>å¼•å¯¼ç±»åŠ è½½å™¨ï¼ˆBootstrap ClassLoaderï¼‰</strong></td>\n<td>Java æ ¸å¿ƒç±»åº“ï¼ˆå¦‚ <code>java.lang.*</code>ï¼‰</td>\n<td>ç”± JVM è‡ªèº«å®ç°ï¼Œç”¨æœ¬åœ°ä»£ç å®ç°ï¼Œæ— æ³•ç›´æ¥è®¿é—®</td>\n</tr>\n<tr>\n<td><strong>æ‰©å±•ç±»åŠ è½½å™¨ï¼ˆExtension ClassLoaderï¼‰</strong></td>\n<td><code>JAVA_HOME/jre/lib/ext</code> ç›®å½•ä¸‹çš„ç±»</td>\n<td>åŠ è½½æ ‡å‡†æ‰©å±•ç±»åº“</td>\n</tr>\n<tr>\n<td><strong>åº”ç”¨ç±»åŠ è½½å™¨ï¼ˆApplication ClassLoaderï¼‰</strong></td>\n<td>ç”¨æˆ·åº”ç”¨ç±»è·¯å¾„ï¼ˆCLASSPATH æŒ‡å®šçš„ç›®å½•ï¼‰</td>\n<td>æœ€å¸¸ç”¨ï¼ŒåŠ è½½å¤§å¤šæ•°åº”ç”¨ä»£ç </td>\n</tr>\n<tr>\n<td><strong>è‡ªå®šä¹‰ç±»åŠ è½½å™¨ï¼ˆCustom ClassLoaderï¼‰</strong></td>\n<td>ç”¨æˆ·æ‰‹åŠ¨å®ç°çš„ç±»åŠ è½½å™¨</td>\n<td>å¯ä»¥æ‰“ç ´åŒäº²å§”æ´¾æœºåˆ¶ï¼Œå®ç°çƒ­åŠ è½½ã€åŠ å¯†ç±»åŠ è½½ç­‰</td>\n</tr>\n</tbody>\n</table>\n<blockquote>\n<p>ç±»åŠ è½½é‡‡ç”¨ åŒäº²å§”æ´¾æ¨¡å‹ï¼šè¯·æ±‚ä¼šå…ˆå‘çˆ¶åŠ è½½å™¨å§”æ‰˜ï¼Œåªæœ‰åœ¨çˆ¶åŠ è½½å™¨åŠ è½½å¤±è´¥æ—¶æ‰å°è¯•è‡ªèº«åŠ è½½ã€‚</p>\n</blockquote>\n<h3 id=\"å­—èŠ‚ç æ‰§è¡Œå¼•æ“ï¼ˆExecution-Engineï¼‰\">å­—èŠ‚ç æ‰§è¡Œå¼•æ“ï¼ˆExecution Engineï¼‰</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å­—èŠ‚ç æ‰§è¡Œå¼•æ“è´Ÿè´£å°† Java å­—èŠ‚ç è§£é‡Šæˆ–ç¼–è¯‘ä¸ºæœºå™¨ä»£ç ï¼Œå¹¶åœ¨åº•å±‚å¹³å°ä¸Šæ‰§è¡Œã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>æ‰§è¡Œå¼•æ“çš„æ ¸å¿ƒæ¨¡å—</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>ç»„ä»¶åç§°</th>\n<th>ä½œç”¨è¯´æ˜</th>\n<th>å…³é”®ç‰¹æ€§</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>è§£é‡Šå™¨ï¼ˆInterpreterï¼‰</strong></td>\n<td>å°†å­—èŠ‚ç é€æ¡è§£é‡Šæ‰§è¡Œ</td>\n<td>å¯åŠ¨å¿«ï¼Œé€‚åˆå†·ä»£ç ï¼ˆéçƒ­ç‚¹ä»£ç ï¼‰ï¼Œæ‰§è¡Œæ•ˆç‡ç›¸å¯¹è¾ƒä½</td>\n</tr>\n<tr>\n<td><strong>å³æ—¶ç¼–è¯‘å™¨ï¼ˆJIT Compilerï¼‰</strong></td>\n<td>å°†çƒ­ç‚¹ä»£ç ç¼–è¯‘ä¸ºæœ¬åœ°æœºå™¨ç ï¼Œæé«˜æ‰§è¡Œæ•ˆç‡</td>\n<td>åŒ…å« C1ï¼ˆClientï¼‰å’Œ C2ï¼ˆServerï¼‰ä¸¤ç§ï¼Œæ”¯æŒä¼˜åŒ–å¦‚ï¼šæ–¹æ³•å†…è”ã€é€ƒé€¸åˆ†æã€å¾ªç¯å±•å¼€ç­‰</td>\n</tr>\n<tr>\n<td><strong>åƒåœ¾æ”¶é›†å™¨ï¼ˆGarbage Collector, GCï¼‰</strong></td>\n<td>è‡ªåŠ¨å†…å­˜ç®¡ç†ï¼Œè´Ÿè´£å¯¹è±¡ç”Ÿå‘½å‘¨æœŸçš„å›æ”¶</td>\n<td>å¸¸è§ç®—æ³•åŒ…æ‹¬ï¼šSerialã€Parallelã€CMSã€G1ã€ZGCï¼ˆä½å»¶è¿Ÿï¼‰ç­‰ï¼Œæ ¹æ®ä¸åŒåœºæ™¯é€‰æ‹©</td>\n</tr>\n<tr>\n<td><strong>æœ¬åœ°æ¥å£ï¼ˆNative Interfaceï¼‰</strong></td>\n<td>æ”¯æŒ Java ä¸æœ¬åœ°è¯­è¨€ï¼ˆå¦‚ C/C++ï¼‰çš„äº’æ“ä½œ</td>\n<td>é€šè¿‡ JNIï¼ˆJava Native Interfaceï¼‰å®ç°ï¼Œè°ƒç”¨åº•å±‚æ“ä½œç³»ç»Ÿæˆ–ç¬¬ä¸‰æ–¹åº“åŠŸèƒ½</td>\n</tr>\n</tbody>\n</table>\n<div class=\"tips\">\n<p><em><strong>å³æ—¶ç¼–è¯‘å™¨ï¼ˆJIT Compilerï¼‰</strong></em></p>\n<ul class=\"lvl-1\">\n<li class=\"lvl-2\">JVM çš„ HotSpot ç¼–è¯‘å™¨æœ‰ä¸¤ä¸ªä¸»è¦ç»„ä»¶ï¼š<br>\nC1 ç¼–è¯‘å™¨ï¼ˆClient ç¼–è¯‘å™¨ï¼‰ï¼šè½»é‡ã€å¿«é€Ÿç¼–è¯‘ï¼Œä¼˜åŒ–å°‘ã€‚<br>\nC2 ç¼–è¯‘å™¨ï¼ˆServer ç¼–è¯‘å™¨ï¼‰ï¼šä¼˜åŒ–é«˜çº§ï¼Œè€—æ—¶é•¿ï¼Œé€‚åˆé•¿æ—¶é—´è¿è¡Œçš„çƒ­ç‚¹ä»£ç ã€‚</li>\n<li class=\"lvl-2\">åœ¨ 64 ä½ JDK ä¸­ï¼Œé»˜è®¤å°±æ˜¯ -server æ¨¡å¼ <code>(C2 ç¼–è¯‘å™¨)</code> ï¼Œä¸å†æ”¯æŒ -client <code>(C1 ç¼–è¯‘å™¨)</code>ã€‚</li>\n<li class=\"lvl-2\">åœ¨ 32 ä½ JDK ä¸­ï¼Œæ ¹æ®å¹³å°å’Œå¯åŠ¨æ–¹å¼ï¼Œå¯èƒ½ä¼šè‡ªåŠ¨é€‰æ‹© -client æˆ– -serverï¼Œä¹Ÿå¯ä»¥æ‰‹åŠ¨æŒ‡å®šã€‚</li>\n<li class=\"lvl-2\">åˆ†å±‚ç¼–è¯‘ï¼ˆTiered Compilationï¼‰ å…è®¸ JVM åœ¨ä¸€å¼€å§‹ç”¨ C1 ç¼–è¯‘å™¨å¿«é€Ÿç¼–è¯‘å­—èŠ‚ç ï¼Œåç»­çƒ­ç‚¹ä»£ç å†äº¤ç»™ C2 ç¼–è¯‘å™¨è¿›è¡Œæ›´é«˜çº§ä¼˜åŒ–ã€‚è¿™æ ·ç»“åˆäº† -clientï¼ˆå¿«å¯åŠ¨ï¼‰å’Œ -serverï¼ˆé«˜æ€§èƒ½ï¼‰çš„ä¼˜ç‚¹ã€‚<code>TieredCompilation</code>å‚æ•°æ§åˆ¶æ˜¯å¦å¼€å¯åˆ†å±‚ç¼–è¯‘ï¼Œé»˜è®¤å¼€å¯ã€‚</li>\n<li class=\"lvl-2\"><code>-XX:TieredStopAtLeve=&lt;level&gt;</code> å‚æ•°æ§åˆ¶ ç¼–è¯‘å™¨æœ€å¤šä½¿ç”¨å“ªä¸€å±‚ä¼˜åŒ–çº§åˆ«ã€‚å®ƒçš„å–å€¼å¦‚ä¸‹ï¼Œå€¼è¶Šä½å¯åŠ¨è¶Šå¿«ï¼Œä½†ä¼˜åŒ–è¶Šå°‘ã€‚</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>å€¼</th>\n<th>å«ä¹‰</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>0</td>\n<td>ä»…è§£é‡Šæ‰§è¡Œï¼ˆä¸å¼€å¯ç¼–è¯‘å™¨ï¼‰</td>\n</tr>\n<tr>\n<td>1</td>\n<td>åªä½¿ç”¨ C1 ç¼–è¯‘å™¨çš„ç¬¬ä¸€çº§ï¼ˆæœ€å°‘ä¼˜åŒ–ï¼‰</td>\n</tr>\n<tr>\n<td>2</td>\n<td>C1 ç¬¬äºŒçº§ï¼Œç•¥å¤šä¼˜åŒ–</td>\n</tr>\n<tr>\n<td>3</td>\n<td>C1 ç¬¬ä¸‰çº§ï¼Œæ›´ä¼˜åŒ–</td>\n</tr>\n<tr>\n<td>4</td>\n<td>å¯ç”¨ C2 ç¼–è¯‘å™¨ï¼ˆå®Œå…¨ä¼˜åŒ–ï¼Œé»˜è®¤å€¼ï¼‰</td>\n</tr>\n</tbody>\n</table>\n</div>\n<h3 id=\"JVM-å†…å­˜æ¨¡å‹ï¼ˆJava-Memory-Modelï¼ŒJMMï¼‰\">JVM å†…å­˜æ¨¡å‹ï¼ˆJava Memory Modelï¼ŒJMMï¼‰</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>JMM æ˜¯ Java è™šæ‹Ÿæœºè§„èŒƒä¸­å®šä¹‰çš„ä¸€ç§ æŠ½è±¡å†…å­˜æ¨¡å‹ï¼Œå®ƒå†³å®šäº†å¤šçº¿ç¨‹ç¨‹åºä¸­å˜é‡çš„è¯»å†™å¯è§æ€§ã€æœ‰åºæ€§å’ŒåŸå­æ€§ã€‚åŒæ—¶ï¼ŒJVM åœ¨ç‰©ç†å±‚ä¹Ÿæœ‰ä¸€ä¸ªå®é™…çš„å†…å­˜ç»“æ„ï¼Œç§°ä¸ºè¿è¡Œæ—¶æ•°æ®åŒºåŸŸï¼ˆRuntime Data Areasï¼‰ï¼Œè¿™ä¸¤ä¸ªå¯ä»¥ç»“åˆç†è§£ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>JMM çš„ä¸»è¦ç›®æ ‡</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-6\">ä¿è¯å¤šçº¿ç¨‹ç¯å¢ƒä¸‹çš„æ•°æ®ä¸€è‡´æ€§</li>\n<li class=\"lvl-6\">æŒ‡å¯¼ JVM å’Œ CPU çš„å†…å­˜äº¤äº’è¡Œä¸ºï¼ˆå¦‚é‡æ’åºã€ç¼“å­˜ï¼‰</li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<p>å®é™…è¿è¡Œæ—¶å†…å­˜ç»“æ„å¦‚ä¸‹ï¼š</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>å†…å­˜åŒºåŸŸ</th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>ğŸ“Œ <strong>ç¨‹åºè®¡æ•°å™¨ï¼ˆPCï¼‰</strong></td>\n<td>æ¯ä¸ªçº¿ç¨‹ç§æœ‰ï¼Œè®°å½•å½“å‰æ‰§è¡Œçš„å­—èŠ‚ç æŒ‡ä»¤åœ°å€</td>\n</tr>\n<tr>\n<td>ğŸ“Œ <strong>Java çº¿ç¨‹æ ˆ</strong></td>\n<td>æ¯ä¸ªçº¿ç¨‹ç§æœ‰ï¼Œæ–¹æ³•è°ƒç”¨æ—¶ç”¨äºå­˜å‚¨å±€éƒ¨å˜é‡ã€æ“ä½œæ•°æ ˆç­‰</td>\n</tr>\n<tr>\n<td>ğŸ“Œ <strong>æœ¬åœ°æ–¹æ³•æ ˆ</strong></td>\n<td>ä¸è™šæ‹Ÿæœºæ ˆç±»ä¼¼ï¼Œç”¨äº native æ–¹æ³•</td>\n</tr>\n<tr>\n<td>ğŸ“Œ <strong>å †ï¼ˆHeapï¼‰</strong></td>\n<td>æ‰€æœ‰çº¿ç¨‹å…±äº«ï¼Œå­˜å‚¨å¯¹è±¡å®ä¾‹ã€æ•°ç»„ç­‰ï¼ŒGC çš„ä¸»è¦åŒºåŸŸ</td>\n</tr>\n<tr>\n<td>ğŸ“Œ <strong>æ–¹æ³•åŒºï¼ˆæˆ–å…ƒç©ºé—´ï¼‰</strong></td>\n<td>æ‰€æœ‰çº¿ç¨‹å…±äº«ï¼Œå­˜å‚¨ç±»ä¿¡æ¯ã€é™æ€å˜é‡ã€å¸¸é‡æ± ç­‰ï¼ˆJDK8 åç§°ä¸º Metaspaceï¼‰</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"åƒåœ¾å›æ”¶å™¨\">åƒåœ¾å›æ”¶å™¨</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åƒåœ¾å›æ”¶å™¨è´Ÿè´£è‡ªåŠ¨ç®¡ç†å†…å­˜ï¼Œå›æ”¶ä¸å†ä½¿ç”¨çš„å¯¹è±¡ï¼Œé¿å…å†…å­˜æ³„æ¼å’Œæº¢å‡ºã€‚</p>\n</li>\n</ul>\n<h3 id=\"ä»€ä¹ˆæ˜¯åƒåœ¾\">ä»€ä¹ˆæ˜¯åƒåœ¾</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å†…å­˜ä¸­æ²¡æœ‰è¢«ï¼ˆçº¿ç¨‹æ ˆå˜é‡ï¼Œé™æ€å˜é‡ï¼Œå¸¸é‡æ± ï¼ŒJNIæŒ‡é’ˆï¼‰å¼•ç”¨çš„åœ°å€å°±æ˜¯åƒåœ¾</p>\n</li>\n<li class=\"lvl-2\">\n<p>å¯è¾¾æ€§åˆ†æç®—æ³•ï¼šæ˜¯ç°ä»£ JVM åˆ¤æ–­ä¸€ä¸ªå¯¹è±¡æ˜¯å¦â€œè¿˜æ´»ç€â€çš„ä¸»è¦ç®—æ³•ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">åŸºæœ¬æ€æƒ³ï¼š</span><br><span class=\"line\">ä»ä¸€ç»„ç§°ä¸º â€œGC Rootsâ€ çš„å¯¹è±¡å‡ºå‘ï¼Œæ²¿ç€å¯¹è±¡ä¹‹é—´çš„å¼•ç”¨é“¾å‘ä¸‹æœç´¢ã€‚</span><br><span class=\"line\">å¦‚æœæŸä¸ªå¯¹è±¡ å¯ä»¥ä» GC Roots è¿½è¸ªåˆ°ï¼Œå°±è®¤ä¸ºå®ƒæ˜¯ â€œå¯è¾¾â€ çš„ï¼ˆAliveï¼‰ã€‚</span><br><span class=\"line\">å¦åˆ™å°±è®¤ä¸ºæ˜¯ â€œä¸å¯è¾¾â€ çš„ï¼ˆGarbageï¼‰ï¼Œå¯ä»¥è¢«å›æ”¶ã€‚</span><br></pre></td></tr></table></figure>\n<div class=\"tips\">\n<ul class=\"lvl-1\">\n<li class=\"lvl-2\">\n<p>åœ¨ JVM ä¸­ï¼Œ<code>GC Roots</code> æ˜¯ä¸€äº› å§‹ç»ˆå¯ç”¨çš„ã€ä¸ä¼šè¢«åƒåœ¾å›æ”¶çš„å¼•ç”¨èµ·ç‚¹ï¼Œä¸»è¦åŒ…æ‹¬ï¼š</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>GC Roots æ¥æº</th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>å½“å‰çº¿ç¨‹æ ˆä¸­çš„å¼•ç”¨ï¼ˆå±€éƒ¨å˜é‡è¡¨ï¼‰</td>\n<td>å„ä¸ªçº¿ç¨‹æ­£åœ¨è°ƒç”¨çš„æ–¹æ³•ä¸­çš„å±€éƒ¨å˜é‡ã€å‚æ•°ç­‰</td>\n</tr>\n<tr>\n<td>é™æ€å­—æ®µå¼•ç”¨</td>\n<td>ç±»çš„é™æ€å­—æ®µå¼•ç”¨çš„å¯¹è±¡</td>\n</tr>\n<tr>\n<td>JNI å¼•ç”¨ï¼ˆNative æ–¹æ³•å¼•ç”¨ï¼‰</td>\n<td>Java æœ¬åœ°æ–¹æ³•ä¸­å¼•ç”¨çš„å¯¹è±¡</td>\n</tr>\n<tr>\n<td>å¸¸é‡å¼•ç”¨æ± ä¸­çš„å¯¹è±¡</td>\n<td>å­—ç¬¦ä¸²å¸¸é‡ç­‰å¯èƒ½æŒæœ‰å¯¹è±¡å¼•ç”¨</td>\n</tr>\n<tr>\n<td>æ´»åŠ¨çº¿ç¨‹å¯¹è±¡</td>\n<td>çº¿ç¨‹è‡ªèº«åœ¨ GC æ—¶ä¸ä¼šè¢«å›æ”¶</td>\n</tr>\n<tr>\n<td>JVM å†…éƒ¨ç»“æ„ï¼ˆå¦‚ç³»ç»Ÿç±»åŠ è½½å™¨ç­‰ï¼‰</td>\n<td>JVM å…³é”®ç³»ç»Ÿå¯¹è±¡</td>\n</tr>\n</tbody>\n</table>\n</div>\n<h3 id=\"åƒåœ¾å›æ”¶å™¨ç§ç±»ï¼š\">åƒåœ¾å›æ”¶å™¨ç§ç±»ï¼š</h3>\n<p><img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/uPic/TEILZ9.png\" alt=\"\"></p>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å·¦è¾¹6ç§å«åˆ†ä»£æ¨¡å‹ï¼Œå³è¾¹çš„4ç§å«åˆ†åŒºæ¨¡å‹</p>\n</li>\n</ul>\n<div class=\"tips\">\n<p><em><strong>åˆ†ä»£æ¨¡å‹ï¼ˆGenerational Modelï¼‰</strong></em><br>\nå †å†…å­˜åˆ’åˆ†ä¸ºï¼š<br>\nå¹´è½»ä»£ï¼ˆYoung Generationï¼‰ï¼šå­˜æ”¾æ–°åˆ›å»ºçš„å¯¹è±¡ï¼Œåˆ†ä¸º Eden å’Œ Survivor åŒºã€‚<br>\nè€å¹´ä»£ï¼ˆOld Generationï¼‰ï¼šå­˜æ”¾ç»è¿‡å¤šæ¬¡ GC åä»ç„¶å­˜æ´»çš„å¯¹è±¡ã€‚</p>\n<p><em><strong>åˆ†åŒºæ¨¡å‹ï¼ˆRegion-based Modelï¼‰</strong></em><br>\nåˆ†åŒºæ¨¡å‹ï¼ˆå¦‚ G1ã€ZGCã€Shenandoahï¼‰ä¸å†ä¸¥æ ¼æŒ‰ç…§ä»£åˆ’åˆ†å†…å­˜ï¼Œè€Œæ˜¯æŠŠå †åˆ’åˆ†ä¸ºå¤šä¸ª å¤§å°ç›¸åŒçš„ Regionã€‚æ¯ä¸ª Region å¯ä»¥åœ¨è¿è¡Œæ—¶è¢«åŠ¨æ€æ ‡è®°ä¸º Edenã€Survivor æˆ– Oldã€‚</p>\n</div>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ†ä»£æ¨¡å‹ä¸­ï¼Œä¸Šé¢3ä¸ªæ˜¯æ–°ç”Ÿä»£åƒåœ¾å›æ”¶å™¨ï¼Œä¸‹é¢3ä¸ªæ˜¯è€å¹´ä»£åƒåœ¾å›æ”¶å™¨ï¼Œå¯ä»¥äº¤å‰é…å¯¹ï¼ˆè§ä¸Šå›¾è™šçº¿ï¼‰ï¼Œä½†æœ€å¸¸ç”¨æ˜¯ä¸Šä¸‹ä¸¤ä¸¤é…å¯¹ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>CMSå³å¯ä»¥ä½œä¸ºæ–°ç”Ÿä»£åƒåœ¾å›æ”¶å™¨ï¼Œä¹Ÿå¯ä»¥ä½œä¸ºè€å¹´ä»£åƒåœ¾å›æ”¶å™¨ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>EpsilonGCï¼Œæ˜¯ä¸€ä¸ªç‰¹æ®Šçš„åƒåœ¾å›æ”¶å™¨ï¼Œå®ƒä¸å›æ”¶ä»»ä½•å¯¹è±¡ï¼Œåªè´Ÿè´£æœ€ç»ˆè®°å½•ï¼Œåšæµ‹è¯•ç”¨çš„ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ç›®å‰æœ€å…ˆè¿›çš„æ¨¡å‹æ˜¯ <code>ZGC</code>ï¼Œjkd11å¼€å§‹æ”¯æŒï¼Œä½†ç›´åˆ°JDK16æ‰æ¯”è¾ƒå®Œå–„ï¼Œç›®å‰éé»˜è®¤é…ç½®ï¼Œéœ€è¦æ‰‹åŠ¨é…ç½®ã€‚å…¶ä¸Redhatå‡ºå“çš„ <code>Shenandoah</code> æ˜¯ç«äº‰å…³ç³»ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å¸¸è§åƒåœ¾å›æ”¶å™¨åŠå…¶åˆ†ç±»ã€JDKç‰ˆæœ¬</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>åƒåœ¾å›æ”¶å™¨</th>\n<th>æ‰€å±æ¨¡å‹</th>\n<th>è¯´æ˜</th>\n<th>é¦–æ¬¡å‡ºç° JDK ç‰ˆæœ¬</th>\n<th>å¯ç”¨å‘½ä»¤ï¼ˆJVM å‚æ•°ï¼‰</th>\n<th>é€‚åˆçš„å †å†…å­˜å¤§å°</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>Serial</strong></td>\n<td>åˆ†ä»£æ¨¡å‹</td>\n<td>å•çº¿ç¨‹ï¼Œæ–°ç”Ÿä»£å’Œè€å¹´ä»£éƒ½ä½¿ç”¨ Serialï¼Œé€‚ç”¨äºå°å †å†…å­˜, <code>å·²å¼ƒç”¨</code></td>\n<td>JDK 1.2</td>\n<td><code>-XX:+UseSerialGC</code></td>\n<td>ğŸ’¾ å°äº 1GB</td>\n</tr>\n<tr>\n<td><strong>ParNew</strong></td>\n<td>åˆ†ä»£æ¨¡å‹</td>\n<td>Serial çš„å¤šçº¿ç¨‹ç‰ˆæœ¬ï¼Œ<strong>ä»…ç”¨äº CMS æ–°ç”Ÿä»£</strong>, <code>JDK11å·²å¼ƒç”¨</code></td>\n<td>JDK 1.4</td>\n<td><code>-XX:+UseParNewGC -XX:+UseConcMarkSweepGC</code></td>\n<td>ğŸ’¾ 1GB ~ 4GB</td>\n</tr>\n<tr>\n<td><strong>Parallelï¼ˆååé‡ GCï¼‰</strong></td>\n<td>åˆ†ä»£æ¨¡å‹</td>\n<td>å¤šçº¿ç¨‹ GCï¼Œé€‚åˆååé‡ä¼˜å…ˆçš„åº”ç”¨åœºæ™¯</td>\n<td>JDK 1.4</td>\n<td><code>-XX:+UseParallelGC</code>ï¼ˆæ–°ç”Ÿä»£ï¼‰<br><code>-XX:+UseParallelOldGC</code>ï¼ˆè€å¹´ä»£ï¼‰</td>\n<td>ğŸ’¾ 2GB ~ 8GB</td>\n</tr>\n<tr>\n<td><strong>CMSï¼ˆConcurrent Mark Sweepï¼‰</strong></td>\n<td>åˆ†ä»£æ¨¡å‹</td>\n<td>è€å¹´ä»£å¹¶å‘æ ‡è®°-æ¸…é™¤ï¼Œä½å»¶è¿Ÿï¼Œä½†å­˜åœ¨ç¢ç‰‡ï¼Œ<code>JDK14å·²å¼ƒç”¨</code></td>\n<td>JDK 1.4</td>\n<td><code>-XX:+UseConcMarkSweepGC</code></td>\n<td>ğŸ’¾ 2GB ~ 8GB</td>\n</tr>\n<tr>\n<td><strong>G1ï¼ˆGarbage Firstï¼‰</strong></td>\n<td>åˆ†åŒºæ¨¡å‹</td>\n<td>å°†å †åˆ’åˆ†ä¸º Regionï¼Œé€»è¾‘åˆ†ä»£ï¼Œæ”¯æŒå¹¶å‘å‹ç¼©ï¼Œå¹³è¡¡å»¶è¿Ÿä¸åå</td>\n<td>JDK 7u4ï¼ˆæ­£å¼ï¼‰</td>\n<td><code>-XX:+UseG1GC</code></td>\n<td>ğŸ’¾ 4GB ~ æ•°å GB</td>\n</tr>\n<tr>\n<td><strong>ZGCï¼ˆZ Garbage Collectorï¼‰</strong></td>\n<td>åˆ†åŒºæ¨¡å‹</td>\n<td>Region å¼¹æ€§å¤§å°ï¼Œæ”¯æŒè¶…å¤§å †ï¼Œä½å»¶è¿Ÿï¼ˆ&lt;10ms åœé¡¿ï¼‰</td>\n<td>JDK 11ï¼ˆå®éªŒï¼‰ï¼ŒJDK 15ï¼ˆæ­£å¼ï¼‰</td>\n<td><code>-XX:+UseZGC</code></td>\n<td>ğŸ’¾ 8GB ~ æ•° TBï¼ˆè¶…å¤§å †ï¼‰</td>\n</tr>\n<tr>\n<td><strong>Shenandoah</strong></td>\n<td>åˆ†åŒºæ¨¡å‹</td>\n<td>çº¢å¸½ä¸»å¯¼ï¼Œä½å»¶è¿Ÿï¼Œå¹¶å‘å›æ”¶ä¸å¹¶å‘å‹ç¼©</td>\n<td>JDK 12ï¼ˆå®éªŒï¼‰ï¼ŒJDK 15ï¼ˆæ­£å¼ï¼‰</td>\n<td><code>-XX:+UseShenandoahGC</code></td>\n<td>ğŸ’¾ 2GB ~ æ•°å GB</td>\n</tr>\n</tbody>\n</table>\n<blockquote>\n<p>å¯¹äº CMSï¼Œå¯ç”¨åä¼šè‡ªåŠ¨ä½¿ç”¨ ParNew ä½œä¸ºæ–°ç”Ÿä»£å›æ”¶å™¨ï¼ˆé™¤éæ˜¾å¼ç¦æ­¢ï¼‰ã€‚<br>\nå¯¹äº Parallel GC å¯ç”¨ <code>-XX:+UseParallelGC</code>ï¼ˆæ–°ç”Ÿä»£ï¼‰ä¼šè‡ªåŠ¨å¯ç”¨ <code>-XX:+UseParallelOldGC</code>ï¼ˆè€å¹´ä»£ï¼‰ã€‚<br>\nå¯¹äºZGCï¼Œjdk15ä»¥å‰æœ€å¤§æ”¯æŒ4Tå†…å­˜ï¼Œä¹‹åæœ€å¤§æ”¯æŒ16Tå†…å­˜ã€‚</p>\n</blockquote>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å„ç‰ˆæœ¬é»˜è®¤åƒåœ¾å›æ”¶å™¨åŠæ¨èé…ç½®ï¼ˆJDK 1.6 èµ·ï¼‰</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>JDK ç‰ˆæœ¬</th>\n<th>é»˜è®¤ GC</th>\n<th>å»ºè®®ä½¿ç”¨ GCï¼ˆæŒ‰åœºæ™¯åˆ†ç±»ï¼‰</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>JDK 1.6</strong></td>\n<td>Serial / Parallel</td>\n<td>- å°å‹åº”ç”¨ï¼ˆå¦‚æ¡Œé¢ç¨‹åºï¼‰ï¼š<code>-XX:+UseSerialGC</code>  <br> - ä¸­å¤§å‹åº”ç”¨ï¼ˆååé‡ä¼˜å…ˆï¼‰ï¼š<code>-XX:+UseParallelGC</code></td>\n</tr>\n<tr>\n<td><strong>JDK 1.7</strong></td>\n<td>åŒä¸Š</td>\n<td>åŒ JDK 1.6</td>\n</tr>\n<tr>\n<td><strong>JDK 1.8</strong></td>\n<td>Parallel</td>\n<td>- ååä¼˜å…ˆï¼šé»˜è®¤ <code>-XX:+UseParallelGC</code> <br> - å“åº”ä¼˜å…ˆï¼š<code>-XX:+UseConcMarkSweepGC</code>ï¼ˆCMSï¼‰<br> - å¤§å † + æœªæ¥å‡çº§è€ƒè™‘ï¼š<code>-XX:+UseG1GC</code>ï¼ˆæ¨èï¼‰</td>\n</tr>\n<tr>\n<td><strong>JDK 9-14</strong></td>\n<td>G1 GC</td>\n<td>- ä¸€èˆ¬é»˜è®¤å³å¯ï¼š<code>-XX:+UseG1GC</code>ï¼ˆå»¶è¿Ÿä¸ååå¹³è¡¡ï¼‰<br> - æç«¯ä½å»¶è¿Ÿè¦æ±‚ï¼šå‡çº§åˆ° JDK 11+ ä½¿ç”¨ ZGC/Shenandoah</td>\n</tr>\n<tr>\n<td><strong>JDK 15+</strong></td>\n<td>G1 GCï¼ˆé»˜è®¤ï¼‰ï¼ŒZGC / Shenandoah å¯é€‰</td>\n<td>- å»¶è¿Ÿæ•æ„Ÿï¼ˆåœ¨çº¿æœåŠ¡ã€RTç³»ç»Ÿï¼‰ï¼š<code>-XX:+UseZGC</code> æˆ– <code>-XX:+UseShenandoahGC</code><br> - ååä¸ºä¸»ï¼š<code>-XX:+UseParallelGC</code><br> - ç»¼åˆå¹³è¡¡ï¼š<code>-XX:+UseG1GC</code>ï¼ˆé»˜è®¤ï¼‰</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ¤æ–­é»˜è®¤ GC çš„æ–¹å¼</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">java -XX:+PrintCommandLineFlags -version</span><br></pre></td></tr></table></figure>\n<h3 id=\"åƒåœ¾å›æ”¶ç®—æ³•\">åƒåœ¾å›æ”¶ç®—æ³•</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>JVM ä¸­å¸¸è§åƒåœ¾å›æ”¶ç®—æ³•æ±‡æ€»</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>ç®—æ³•åç§°</th>\n<th>æ ¸å¿ƒæ€æƒ³</th>\n<th>é€‚ç”¨é˜¶æ®µ/åŒºåŸŸ</th>\n<th>ä¼˜ç¼ºç‚¹ç®€è¿°</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>æ ‡è®°-æ¸…é™¤ï¼ˆMark-Sweepï¼‰</strong></td>\n<td>æ ‡è®°å‡ºå­˜æ´»å¯¹è±¡ï¼Œæ¸…é™¤æœªæ ‡è®°å¯¹è±¡</td>\n<td>è€å¹´ä»£</td>\n<td>ç®€å•é«˜æ•ˆï¼Œä½†ä¼šäº§ç”Ÿå¤§é‡ç¢ç‰‡ï¼Œä¸é€‚åˆè¿ç»­å†…å­˜åˆ†é…</td>\n</tr>\n<tr>\n<td><strong>æ ‡è®°-æ•´ç†ï¼ˆMark-Compactï¼‰</strong></td>\n<td>æ ‡è®°åç§»åŠ¨å­˜æ´»å¯¹è±¡ï¼Œæ•´ç†ç¢ç‰‡</td>\n<td>è€å¹´ä»£</td>\n<td>æ¶ˆé™¤ç¢ç‰‡ï¼Œä»£ä»·æ˜¯ç§»åŠ¨å¯¹è±¡ï¼Œé€‚ç”¨äºè€å¹´ä»£å‹ç¼©</td>\n</tr>\n<tr>\n<td><strong>å¤åˆ¶ç®—æ³•ï¼ˆCopyingï¼‰</strong></td>\n<td>å°†å¯¹è±¡å¤åˆ¶åˆ°å¦ä¸€å—å†…å­˜ï¼ˆå¦‚ Eden â†’ Survivorï¼‰</td>\n<td>æ–°ç”Ÿä»£</td>\n<td>é«˜æ•ˆç‡ï¼Œé€‚åˆå›æ”¶å¤§å¤šæ•°å¯¹è±¡çŸ­å‘½çš„æ–°ç”Ÿä»£ï¼Œä½†éœ€è¦é¢å¤–ç©ºé—´</td>\n</tr>\n<tr>\n<td><strong>åˆ†ä»£å›æ”¶ï¼ˆGenerationalï¼‰</strong></td>\n<td>å°†å¯¹è±¡æŒ‰ç”Ÿå‘½å‘¨æœŸåˆ’åˆ†ï¼ˆæ–°ç”Ÿä»£/è€å¹´ä»£ï¼‰</td>\n<td>æ•´ä¸ªå †ç»“æ„</td>\n<td>å®ç”¨æ€§å¼ºï¼Œç»“åˆä¸åŒç®—æ³•åº”ç”¨äºä¸åŒä»£ï¼Œç°ä»£ GC åŸºç¡€</td>\n</tr>\n<tr>\n<td><strong>åˆ†åŒºå›æ”¶ï¼ˆRegion-basedï¼‰</strong></td>\n<td>å°†å †åˆ’åˆ†ä¸ºè‹¥å¹²ç­‰å¤§å°çš„ Region åŠ¨æ€åˆ†é…</td>\n<td>æ•´ä¸ªå †ï¼ˆå¦‚ G1ã€ZGCï¼‰</td>\n<td>æ›´çµæ´»ï¼Œæ”¯æŒå¹¶å‘å¹¶è¡Œï¼Œå‡å°‘ STW åœé¡¿ï¼Œé€‚ç”¨äºå¤§å †ã€ä½å»¶è¿Ÿåœºæ™¯</td>\n</tr>\n<tr>\n<td><strong>å¢é‡å›æ”¶ï¼ˆIncrementalï¼‰</strong></td>\n<td>åˆ†é˜¶æ®µå°æ­¥æ‰§è¡Œ GC ä»¥å‡å°‘å•æ¬¡åœé¡¿</td>\n<td>æŸäº›å¹¶å‘/ä½å»¶è¿Ÿ GC</td>\n<td>å‡å°‘æš‚åœæ—¶é—´ï¼Œä½†æ•´ä½“æ•ˆç‡å¯èƒ½é™ä½</td>\n</tr>\n<tr>\n<td><strong>å¹¶å‘å›æ”¶ï¼ˆConcurrentï¼‰</strong></td>\n<td>æ ‡è®°ã€æ¸…ç†ç­‰æ­¥éª¤ä¸åº”ç”¨çº¿ç¨‹å¹¶å‘æ‰§è¡Œ</td>\n<td>CMSã€G1ã€ZGC ç­‰</td>\n<td>åœé¡¿æ—¶é—´çŸ­ï¼Œå¯¹å“åº”æ—¶é—´è¦æ±‚é«˜çš„ç³»ç»Ÿå‹å¥½</td>\n</tr>\n<tr>\n<td><strong>ä¸‰è‰²æ ‡è®°ï¼ˆTri-color Markingï¼‰</strong></td>\n<td>å¹¶å‘æ ‡è®°ç®—æ³•çš„ä¸€ç§å®ç°æ€æƒ³</td>\n<td>CMSã€G1ã€ZGC ç­‰</td>\n<td>ç™½ï¼ˆå¾…å›æ”¶ï¼‰ã€ç°ï¼ˆå·²æ ‡è®°æœªæ‰«æï¼‰ã€é»‘ï¼ˆå·²æ ‡è®°å·²æ‰«æï¼‰ï¼Œé¿å…â€œæ¼æ ‡â€é—®é¢˜</td>\n</tr>\n<tr>\n<td><strong>SATBï¼ˆSnapshot-At-The-Beginningï¼‰</strong></td>\n<td>å¹¶å‘æ ‡è®°çš„å¿«ç…§ç­–ç•¥</td>\n<td>G1ã€ZGC</td>\n<td>ä¿è¯åœ¨å¹¶å‘æ ‡è®°è¿‡ç¨‹ä¸­ä¸é—æ¼æ–°å¼•ç”¨ï¼Œé€‚åˆé«˜å¹¶å‘åœºæ™¯</td>\n</tr>\n<tr>\n<td><strong>Lazy Compactionï¼ˆå»¶è¿Ÿå‹ç¼©ï¼‰</strong></td>\n<td>ä¸æ¯æ¬¡ GC éƒ½å‹ç¼©ï¼Œè§†æƒ…å†µè€Œå®š</td>\n<td>G1 ç­‰</td>\n<td>é™ä½ä¸å¿…è¦çš„ç§»åŠ¨æˆæœ¬</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¯¹åº”å…³ç³»ï¼šGC å›æ”¶å™¨å’Œåº•å±‚ç®—æ³•</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>å›æ”¶å™¨</th>\n<th>ä½¿ç”¨çš„ç®—æ³•ç»„åˆ</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>Serial</strong></td>\n<td>æ–°ç”Ÿä»£ï¼šå¤åˆ¶ç®—æ³•<br>è€å¹´ä»£ï¼šæ ‡è®°-æ•´ç†</td>\n</tr>\n<tr>\n<td><strong>ParNew</strong></td>\n<td>æ–°ç”Ÿä»£ï¼šå¤åˆ¶ç®—æ³•ï¼ˆå¤šçº¿ç¨‹ï¼‰</td>\n</tr>\n<tr>\n<td><strong>Parallel</strong></td>\n<td>æ–°ç”Ÿä»£ï¼šå¤åˆ¶ç®—æ³•<br>è€å¹´ä»£ï¼šæ ‡è®°-æ•´ç†</td>\n</tr>\n<tr>\n<td><strong>CMS</strong></td>\n<td>æ–°ç”Ÿä»£ï¼šParNewï¼ˆå¤åˆ¶ï¼‰<br>è€å¹´ä»£ï¼šæ ‡è®°-æ¸…é™¤ + ä¸‰è‰²æ ‡è®° + å¹¶å‘</td>\n</tr>\n<tr>\n<td><strong>G1</strong></td>\n<td>åˆ†åŒºå›æ”¶ + ä¸‰è‰²æ ‡è®° + SATB + Lazy Compaction</td>\n</tr>\n<tr>\n<td><strong>ZGC</strong></td>\n<td>åˆ†åŒºå›æ”¶ + å¹¶å‘æ ‡è®° + SATB + Region Remapping</td>\n</tr>\n<tr>\n<td><strong>Shenandoah</strong></td>\n<td>åˆ†åŒºå›æ”¶ + å¹¶å‘æ ‡è®° + å¹¶å‘å‹ç¼© + ä¸‰è‰²æ ‡è®°</td>\n</tr>\n</tbody>\n</table>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class=\"line\">       â”‚   å¸¸è§ GC ç®—æ³•åˆ†ç±»       â”‚</span><br><span class=\"line\">       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><br><span class=\"line\">                 â”‚</span><br><span class=\"line\">   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class=\"line\">   â”‚                            â”‚</span><br><span class=\"line\">åˆ†ä»£æ¨¡å‹                      åˆ†åŒºæ¨¡å‹</span><br><span class=\"line\">   â”‚                            â”‚</span><br><span class=\"line\"> â”Œâ”€â”´â”€â”€â”€â”€â”€â”                  â”Œâ”€â”€â”€â”´â”€â”€â”€â”€â”€â”</span><br><span class=\"line\">å¤åˆ¶   æ ‡è®°-æ¸…é™¤         Region-based å¹¶å‘</span><br><span class=\"line\">      æ ‡è®°-æ•´ç†             SATB / ä¸‰è‰²æ ‡è®°</span><br></pre></td></tr></table></figure>\n<h4 id=\"ä»€ä¹ˆæ˜¯-STWï¼ˆStop-The-Worldï¼‰\">ä»€ä¹ˆæ˜¯ STWï¼ˆStop-The-Worldï¼‰</h4>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>STWï¼ˆStop-The-Worldï¼‰ æŒ‡çš„æ˜¯ï¼šåœ¨æŸäº›åƒåœ¾å›æ”¶é˜¶æ®µï¼ŒJVM ä¼šæš‚åœæ‰€æœ‰åº”ç”¨çº¿ç¨‹ï¼ˆä¹Ÿå«ç”¨æˆ·çº¿ç¨‹ï¼‰ï¼Œè®©åƒåœ¾å›æ”¶çº¿ç¨‹ç‹¬å  CPU æ‰§è¡Œ GC é€»è¾‘ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä½ å¯ä»¥è¿™æ ·ç†è§£ STW</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-6\">JVM ä¼šâ€œæŒ‰ä¸‹æš‚åœé”®â€æš‚åœæ‰€æœ‰æ­£åœ¨è¿è¡Œçš„ Java ç¨‹åºä»£ç ï¼›</li>\n<li class=\"lvl-6\">ç„¶å ä¸“å¿ƒè¿›è¡Œ GC çš„æŸäº›é˜¶æ®µï¼ˆå¦‚æ ‡è®°ã€æ•´ç†ã€å¤åˆ¶ç­‰ï¼‰ï¼›</li>\n<li class=\"lvl-6\">GC å®Œæˆåï¼Œæ‰ä¼šâ€œæ¢å¤è¿è¡Œâ€åº”ç”¨çº¿ç¨‹ã€‚</li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<p>å„ GC ä¸­ STW çš„å­˜åœ¨æƒ…å†µ</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>å›æ”¶å™¨</th>\n<th>æ˜¯å¦å­˜åœ¨ STWï¼Ÿ</th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Serial</td>\n<td>âœ… æ˜¯ï¼Œå…¨åœé¡¿ï¼Œå…¨é˜¶æ®µå•çº¿ç¨‹</td>\n<td>å †è¶Šå¤§ STW è¶Šé•¿</td>\n</tr>\n<tr>\n<td>Parallel</td>\n<td>âœ… æ˜¯ï¼Œå…¨åœé¡¿ï¼Œå¤šçº¿ç¨‹æ‰§è¡Œ GC</td>\n<td>æé«˜æ•ˆç‡ä½†ä»ä¼šæš‚åœ</td>\n</tr>\n<tr>\n<td>CMS</td>\n<td>âœ… æœ‰ï¼Œåˆå§‹æ ‡è®°å’Œæœ€ç»ˆé‡æ–°æ ‡è®°æ˜¯ STW</td>\n<td>å¤§éƒ¨åˆ†é˜¶æ®µå¹¶å‘æ‰§è¡Œ</td>\n</tr>\n<tr>\n<td>G1</td>\n<td>âœ… æœ‰ï¼Œä½†è®¾è®¡ä¸ºå°½å¯èƒ½ç¼©çŸ­ STW</td>\n<td>åˆ†é˜¶æ®µå¹¶å‘ + å¹¶è¡Œå¤„ç†</td>\n</tr>\n<tr>\n<td>ZGC</td>\n<td>âœ… æçŸ­ï¼ˆ&lt;10msï¼‰</td>\n<td>ä»…ä¸ªåˆ«é˜¶æ®µæ˜¯ STWï¼Œå‡ ä¹æ„ŸçŸ¥ä¸åˆ°</td>\n</tr>\n<tr>\n<td>Shenandoah</td>\n<td>âœ… æçŸ­</td>\n<td>é«˜åº¦å¹¶å‘ï¼ŒSTW æ—¶é—´ä¹ŸæçŸ­</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¸ºä»€ä¹ˆè¦å…³æ³¨ STWï¼Ÿ</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-6\">åœ¨å“åº”æ—¶é—´æ•æ„Ÿå‹ç³»ç»Ÿï¼ˆå¦‚åœ¨çº¿äº¤æ˜“ç³»ç»Ÿã€æ¸¸æˆæœåŠ¡å™¨ã€API ç½‘å…³ï¼‰ä¸­ï¼Œé•¿æ—¶é—´çš„ STW ä¼šé€ æˆç”¨æˆ·è¯·æ±‚å¡é¡¿ã€è¶…æ—¶ã€‚</li>\n<li class=\"lvl-6\">å› æ­¤ï¼Œé€‰æ‹© ä½ STW çš„ GCï¼ˆå¦‚ G1ã€ZGCã€Shenandoahï¼‰ å¯¹è¿™ç±»ç³»ç»Ÿè‡³å…³é‡è¦ã€‚</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"å †å†…å­˜ç»“æ„\">å †å†…å­˜ç»“æ„</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¸åŒçš„åƒåœ¾å›æ”¶å™¨å†³å®šäº†å †å†…å­˜çš„ç»“æ„ä¸åŒï¼Œä½†æ€»ä½“ä¸Šåˆ†ä¸ºä¸¤ç§ç±»å‹ï¼šåˆ†ä»£æ¨¡å‹å’Œåˆ†åŒºæ¨¡å‹ã€‚</p>\n</li>\n</ul>\n<h3 id=\"åˆ†ä»£æ¨¡å‹\">åˆ†ä»£æ¨¡å‹</h3>\n<h4 id=\"Parallel-åƒåœ¾å›æ”¶å™¨\">Parallel åƒåœ¾å›æ”¶å™¨</h4>\n<p><img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/uPic/Apr5aY.png\" alt=\"\"></p>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å †ç»“æ„è¢«åˆ’åˆ†ä¸º <code>Old Generationï¼ˆè€å¹´ä»£ï¼‰</code> å’Œ <code>Young Generationï¼ˆæ–°ç”Ÿä»£ï¼‰</code> ä¸¤éƒ¨åˆ†ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><code>Young Generation</code> ç”± <code>Eden</code> å’Œ ä¸¤ä¸ª <code>Survivor</code> ç»„æˆï¼Œå…¶ä¸­ <code>Eden</code> æ˜¯ä¸€ä¸ªè¿ç»­çš„å†…å­˜åŒºåŸŸï¼Œ<code>Survivor</code> æ˜¯ä¸€ä¸ªéè¿ç»­çš„å†…å­˜åŒºåŸŸã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œ<code>Young Generation</code>å å †å†…å­˜çš„ <code>1/3</code>,  <code>Old Generation</code> å å †å†…å­˜çš„ <code>2/3</code>ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œ<code>Eden:S0:S1 = 8:1:1</code> ,å¦‚æœå¸Œæœ›ä¸º 4:1:1ï¼Œä½¿ç”¨ <code>-XX:SurvivorRatio=4</code>ï¼Œä½†å®é™…ä¸Šè¿™ä¸ªæ¯”ä¾‹å¹¶ä¸æ˜¯å›ºå®šçš„ï¼Œè€Œæ˜¯ç”±jvmåŸºäºæƒ…å†µè‡ªåŠ¨å˜åŒ–çš„ï¼Œå› ä¸ºJVMé»˜è®¤å¼€å¯äº†è¿™ä¸ªå‚æ•°<code>-XX:+UseAdaptiveSizePolicy</code>ï¼Œå¦‚æœå¸Œæœ›å›ºå®šè¿™ä¸ªæ¯”ä¾‹ï¼Œå¯ä»¥è®¾ç½®ä¸º <code>-XX:-UseAdaptiveSizePolicy</code>æ¥å…³é—­è¿™ä¸ªé…ç½®ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œå¯¹è±¡æœ€å¤šç»å†<code>15æ¬¡</code>Minor GCåè¿›å…¥è€å¹´ä»£ï¼Œå¯ä»¥é€šè¿‡ <code>-XX:MaxTenuringThreshold=n</code> è®¾ç½®ã€‚</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>åŒºåŸŸ</th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>Eden</strong></td>\n<td>å¯¹è±¡é¦–æ¬¡åˆ›å»ºçš„åŒºåŸŸï¼Œå¤§éƒ¨åˆ†å¯¹è±¡åœ¨è¿™é‡Œåˆ›å»ºå¹¶å¾ˆå¿«è¢«å›æ”¶</td>\n</tr>\n<tr>\n<td><strong>S0/S1</strong></td>\n<td>Survivor åŒºåŸŸï¼šä¸¤ä¸ªäº¤æ›¿ä½¿ç”¨çš„ç¼“å†²åŒºï¼ˆFrom å’Œ Toï¼‰ï¼Œç”¨äºæ‹·è´å­˜æ´»å¯¹è±¡</td>\n</tr>\n<tr>\n<td><strong>Old</strong></td>\n<td>è€å¹´ä»£ï¼šå­˜æ´»æ¬¡æ•°å¤šã€ç”Ÿå‘½å‘¨æœŸé•¿çš„å¯¹è±¡ä¼šä»æ–°ç”Ÿä»£æ™‹å‡åˆ°è€å¹´ä»£ï¼Œå›æ”¶é¢‘ç‡ä½</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¯¹è±¡å†…å­˜åˆ†é…å›¾è§£(ç®€åŒ–)</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">åˆ›å»ºå¯¹è±¡</span><br><span class=\"line\">   â†“</span><br><span class=\"line\">è¿›å…¥ Eden åŒºï¼ˆæ–°ç”Ÿä»£ï¼‰</span><br><span class=\"line\">   â†“ Eden åŒºæ»¡</span><br><span class=\"line\">ç¬¬ä¸€æ¬¡ Minor GCï¼ˆå­˜æ´»å¯¹è±¡[Eden]å¤åˆ¶åˆ° S0ï¼‰</span><br><span class=\"line\">   â†“ Eden åŒºæ»¡ æˆ– S0 åŒºæ»¡</span><br><span class=\"line\">ç¬¬äºŒæ¬¡ Minor GCï¼ˆå­˜æ´»å¯¹è±¡[Edenå’ŒS0]å¤åˆ¶åˆ° S1ï¼Œå¹´é¾„ +1ï¼‰</span><br><span class=\"line\">   â†“ Eden åŒºæ»¡ æˆ– S1 åŒºæ»¡</span><br><span class=\"line\">ç¬¬ä¸‰æ¬¡ Minor GCï¼ˆå­˜æ´»å¯¹è±¡[Edenå’ŒS1]å¤åˆ¶åˆ° S0ï¼Œå¹´é¾„ +1ï¼‰</span><br><span class=\"line\">   â†“</span><br><span class=\"line\">â€¦â€¦  S0/S1 äº¤æ›¿ï¼Œå¹´é¾„è¾¾åˆ°é˜ˆå€¼ï¼ˆå¦‚ 15ï¼‰</span><br><span class=\"line\">   â†“ è¿˜æ²¡æœ‰è¢«å›æ”¶</span><br><span class=\"line\">æ™‹å‡åˆ° Old åŒºï¼ˆè€å¹´ä»£ï¼‰ï¼Œç­‰å¾…OldåŒºæ»¡ è§¦å‘ Full GC</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¤§å¯¹è±¡ç›´æ¥è¿›å…¥è€å¹´ä»£</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-6\">å¤§å¯¹è±¡å°±æ˜¯éœ€è¦å¤§é‡è¿ç»­å†…å­˜ç©ºé—´çš„å¯¹è±¡ï¼ˆæ¯”å¦‚ï¼šå­—ç¬¦ä¸²ã€æ•°ç»„ï¼‰ï¼Œå¦‚æœå¯¹è±¡å¾ˆå¤§ï¼ˆå¦‚è¶…è¿‡ Eden åŒºå¤§å°ï¼Œæˆ–æ˜¯è¶…è¿‡ Survivor åŒºå¤§å°ï¼‰ï¼Œå¯èƒ½ç›´æ¥åˆ†é…åˆ°è€å¹´ä»£</li>\n<li class=\"lvl-6\">ä¹Ÿå¯ä»¥é€šè¿‡ <code>-XX:PretenureSizeThreshold=&lt;å¤§å°ï¼Œå•ä½å­—èŠ‚&gt;</code> æ§åˆ¶è¶…è¿‡ä¸€å®šå¤§å°çš„å¯¹è±¡æ˜¯å¦ç›´æ¥åˆ†é…åˆ°è€å¹´ä»£ï¼ˆOld Generationï¼‰ï¼Œè·³è¿‡æ–°ç”Ÿä»£ï¼ˆEdenï¼‰ï¼Œä»¥é¿å…å¤§å¯¹è±¡é¢‘ç¹åœ¨å¹´è½»ä»£é€ æˆ GC å‹åŠ›ã€‚è¿™ä¸ªå‚æ•°åªåœ¨ Serial å’ŒParNewä¸¤ä¸ªæ”¶é›†å™¨ä¸‹æœ‰æ•ˆã€‚</li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<p>å¯¹è±¡åŠ¨æ€å¹´é¾„åˆ¤æ–­</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-6\">å¯¹è±¡åœ¨SurvivoråŒºæ¥å›ç§»åŠ¨æ—¶ï¼Œå¦‚æœè¿™æ‰¹å¯¹è±¡çš„æ€»å¤§å°å¤§äºè¿™å—SurvivoråŒºåŸŸå†…å­˜å¤§å°çš„50%(-XX:TargetSurvivorRatioå¯ä»¥æŒ‡å®š)ï¼Œé‚£ä¹ˆæ­¤æ—¶å¤§äºç­‰äºè¿™æ‰¹å¯¹è±¡å¹´é¾„æœ€å¤§å€¼çš„å¯¹è±¡ï¼Œå°±å¯ä»¥ç›´æ¥è¿›å…¥è€å¹´ä»£äº†ï¼Œ</li>\n<li class=\"lvl-6\">ä¾‹å¦‚SurvivoråŒºåŸŸé‡Œç°åœ¨æœ‰ä¸€æ‰¹å¯¹è±¡ï¼Œå¹´é¾„1+å¹´é¾„2+å¹´é¾„nçš„å¤šä¸ªå¹´é¾„å¯¹è±¡æ€»å’Œè¶…è¿‡äº†SurvivoråŒºåŸŸçš„50%ï¼Œæ­¤æ—¶å°±ä¼šæŠŠå¹´é¾„n(å«)ä»¥ä¸Šçš„å¯¹è±¡éƒ½æ”¾å…¥è€å¹´ä»£ã€‚è¿™ä¸ªè§„åˆ™å…¶å®æ˜¯å¸Œæœ›é‚£äº›å¯èƒ½æ˜¯é•¿æœŸå­˜æ´»çš„å¯¹è±¡ï¼Œå°½æ—©è¿›å…¥è€å¹´ä»£ã€‚</li>\n<li class=\"lvl-6\">å¯¹è±¡åŠ¨æ€å¹´é¾„åˆ¤æ–­æœºåˆ¶ä¸€èˆ¬æ˜¯åœ¨minor gcä¹‹åè§¦å‘çš„ã€‚</li>\n</ul>\n</li>\n</ul>\n<div class=\"tips\">\n<ul class=\"lvl-1\">\n<li class=\"lvl-2\">\n<p>å¯¹è±¡é€ƒé€¸åˆ†æ</p>\n<ul class=\"lvl-3\">\n<li class=\"lvl-6\">å¦‚æœå¯¹è±¡å¾ˆå°ï¼Œä¸”åªåœ¨æ–¹æ³•å†…éƒ¨ä½¿ç”¨ï¼Œå¹¶æ²¡æœ‰è¢«å¤–éƒ¨å¼•ç”¨ï¼Œåˆ™å…¶æœ‰å¯èƒ½ç›´æ¥åˆ†é…åˆ°æ ˆå†…å­˜ï¼Œè€Œä¸è¿›å…¥å †å†…å­˜</li>\n<li class=\"lvl-6\">JVMå¯¹äºè¿™ç§æƒ…å†µå¯ä»¥é€šè¿‡å¼€å¯é€ƒé€¸åˆ†æå‚æ•°(-XX:+DoEscapeAnalysis)æ¥ä¼˜åŒ–å¯¹è±¡å†…å­˜åˆ†é…ä½ç½®ï¼Œä½¿å…¶é€šè¿‡<code>æ ‡é‡æ›¿æ¢</code>ä¼˜å…ˆåˆ†é…åœ¨æ ˆä¸Š(æ ˆä¸Šåˆ†é…)ï¼ŒJDK7ä¹‹åé»˜è®¤å¼€å¯é€ƒé€¸åˆ†æï¼Œå¦‚æœè¦å…³é—­ä½¿ç”¨å‚æ•°(-XX:-DoEscapeAnalysis)</li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<p>æ ‡é‡æ›¿æ¢</p>\n<ul class=\"lvl-3\">\n<li class=\"lvl-6\">é€šè¿‡é€ƒé€¸åˆ†æç¡®å®šè¯¥å¯¹è±¡ä¸ä¼šè¢«å¤–éƒ¨è®¿é—®ï¼Œå¹¶ä¸”å¯¹è±¡å¯ä»¥è¢«è¿›ä¸€æ­¥åˆ†è§£æ—¶ï¼ŒJVMä¸ä¼šåˆ›å»ºè¯¥å¯¹è±¡ï¼Œè€Œæ˜¯å°†è¯¥å¯¹è±¡æˆå‘˜å˜é‡åˆ†è§£è‹¥å¹²ä¸ªè¢«è¿™ä¸ªæ–¹æ³•ä½¿ç”¨çš„æˆå‘˜å˜é‡æ‰€ä»£æ›¿ï¼Œè¿™äº›ä»£æ›¿çš„æˆå‘˜å˜é‡åœ¨æ ˆå¸§æˆ–å¯„å­˜å™¨ä¸Šåˆ†é…ç©ºé—´ï¼Œè¿™æ ·å°±ä¸ä¼šå› ä¸ºæ²¡æœ‰ä¸€å¤§å—è¿ç»­ç©ºé—´å¯¼è‡´å¯¹è±¡å†…å­˜ä¸å¤Ÿåˆ†é…ã€‚</li>\n<li class=\"lvl-6\">å¼€å¯æ ‡é‡æ›¿æ¢å‚æ•°(-XX:+EliminateAllocations)ï¼ŒJDK7ä¹‹åé»˜è®¤å¼€å¯ã€‚</li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<p>æ ‡é‡ä¸èšåˆé‡</p>\n<ul class=\"lvl-3\">\n<li class=\"lvl-6\">æ ‡é‡å³ä¸å¯è¢«è¿›ä¸€æ­¥åˆ†è§£çš„é‡ï¼Œè€ŒJAVAçš„åŸºæœ¬æ•°æ®ç±»å‹å°±æ˜¯æ ‡é‡ï¼ˆå¦‚ï¼šintï¼Œlongç­‰åŸºæœ¬æ•°æ®ç±»å‹ä»¥åŠreferenceç±»å‹ç­‰ï¼‰ï¼Œ</li>\n<li class=\"lvl-6\">æ ‡é‡çš„å¯¹ç«‹å°±æ˜¯å¯ä»¥è¢«è¿›ä¸€æ­¥åˆ†è§£çš„é‡ï¼Œè€Œè¿™ç§é‡ç§°ä¹‹ä¸ºèšåˆé‡ã€‚è€Œåœ¨JAVAä¸­å¯¹è±¡å°±æ˜¯å¯ä»¥è¢«è¿›ä¸€æ­¥åˆ†è§£çš„èšåˆé‡ã€‚</li>\n</ul>\n</li>\n</ul>\n</div>\n<h4 id=\"Parallel-åƒåœ¾å›æ”¶å™¨ï¼ˆParallel-GCï¼‰-çš„å·¥ä½œæ–¹å¼\">Parallel åƒåœ¾å›æ”¶å™¨ï¼ˆParallel GCï¼‰ çš„å·¥ä½œæ–¹å¼</h4>\n<p><img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/uPic/fo2Egs.png\" alt=\"\" width=\"1200\" height=\"600\"></p>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Parallel GC æ˜¯å¤šçº¿ç¨‹åƒåœ¾å›æ”¶å™¨ï¼Œå¯ä»¥é€šè¿‡ <code>-XX:ParallelGCThreads</code> æ¥è®¾ç½®GCçº¿ç¨‹æ•°é‡ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å½“ Parallel GC è¢«è§¦å‘ï¼ˆä¾‹å¦‚ Minor GC æˆ– Full GCï¼‰æ—¶ï¼Œæ‰€æœ‰ç”¨æˆ·çº¿ç¨‹ è¢«å®Œå…¨æš‚åœï¼ˆStop-The-World, STWï¼‰</p>\n</li>\n</ul>\n<h4 id=\"Parallel-GC-å‚æ•°é…ç½®è¡¨ï¼ˆååé‡ä¼˜å…ˆ-GCï¼‰\">Parallel GC å‚æ•°é…ç½®è¡¨ï¼ˆååé‡ä¼˜å…ˆ GCï¼‰</h4>\n<table>\n<thead>\n<tr>\n<th>å‚æ•°å</th>\n<th>è¯´æ˜</th>\n<th>é»˜è®¤å€¼ï¼ˆå¦‚æœªç‰¹åˆ«è¯´æ˜ï¼‰</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>-XX:+UseParallelGC</code></td>\n<td>å¼€å¯ Parallel GCï¼Œç”¨äºæ–°ç”Ÿä»£æ”¶é›†</td>\n<td>-</td>\n</tr>\n<tr>\n<td><code>-XX:+UseParallelOldGC</code></td>\n<td>å¼€å¯è€å¹´ä»£å¹¶è¡Œæ”¶é›†ï¼ˆParallel Oldï¼‰</td>\n<td>-</td>\n</tr>\n<tr>\n<td><code>-XX:ParallelGCThreads</code></td>\n<td>åƒåœ¾å›æ”¶æ—¶çš„å¹¶è¡Œçº¿ç¨‹æ•°ï¼ˆä¸ CPU æ•°é‡ç›¸å…³ï¼‰</td>\n<td>æ ¹æ®ç¡¬ä»¶è‡ªåŠ¨é…ç½®</td>\n</tr>\n<tr>\n<td><code>-XX:MaxGCPauseMillis</code></td>\n<td>è®¾ç½® GC æœ€å¤§æš‚åœæ—¶é—´ç›®æ ‡ï¼ˆå½±å“å†…å­˜åˆ†é…ç­–ç•¥ï¼‰</td>\n<td>ä¸€ä¸ªéå¸¸å¤§çš„å€¼ï¼Œå¯ä»¥è®¤ä¸ºæ— é™åˆ¶ï¼ˆå»ºè®®æŒ‰éœ€è®¾ç½®ï¼‰</td>\n</tr>\n<tr>\n<td><code>-XX:GCTimeRatio</code></td>\n<td>è®¾ç½® GC æ—¶é—´ä¸åº”ç”¨è¿è¡Œæ—¶é—´çš„æ¯”å€¼ï¼ˆ0~100ï¼‰<br>å€¼è¶Šå°ï¼ŒGC è¶Šé¢‘ç¹ï¼Œå€¼è¶Šå¤§ GC è¶Šå°‘</td>\n<td>99ï¼ˆè¡¨ç¤º 1% ç”¨äº GCï¼Œ99% ç”¨äºåº”ç”¨ï¼‰</td>\n</tr>\n<tr>\n<td><code>-XX:+UseAdaptiveSizePolicy</code></td>\n<td>å¯ç”¨è‡ªé€‚åº” GC ç­–ç•¥ï¼ˆæ ¹æ®è¿è¡ŒçŠ¶å†µè‡ªåŠ¨è°ƒæ•´å„åŒºåŸŸå¤§å°ï¼‰</td>\n<td>é»˜è®¤å¼€å¯</td>\n</tr>\n<tr>\n<td><code>-XX:SurvivorRatio</code></td>\n<td>Eden ä¸ Survivor çš„å†…å­˜æ¯”ä¾‹ï¼ˆå¦‚ 8 è¡¨ç¤º Eden:S0:S1 = 8:1:1ï¼‰</td>\n<td>8</td>\n</tr>\n<tr>\n<td><code>-XX:InitialTenuringThreshold</code></td>\n<td>å¯¹è±¡æ™‹å‡åˆ°è€å¹´ä»£çš„åˆå§‹å¹´é¾„ï¼ˆä¼šéšè¿è¡ŒåŠ¨æ€è°ƒæ•´ï¼‰</td>\n<td>7</td>\n</tr>\n<tr>\n<td><code>-XX:MaxTenuringThreshold</code></td>\n<td>æ™‹å‡åˆ°è€å¹´ä»£çš„æœ€å¤§å¹´é¾„ï¼ˆå¯¹è±¡åœ¨ Survivor åŒºç»å†å‡ æ¬¡ GCï¼‰</td>\n<td>15</td>\n</tr>\n<tr>\n<td><code>-XX:PretenureSizeThreshold</code></td>\n<td>è®¾ç½®å¤§å¯¹è±¡é˜ˆå€¼ï¼Œè¶…è¿‡è¯¥å¤§å°çš„å¯¹è±¡ç›´æ¥åˆ†é…åˆ°è€å¹´ä»£</td>\n<td>0ï¼ˆå³ç¦ç”¨ï¼‰</td>\n</tr>\n<tr>\n<td><code>-XX:+ScavengeBeforeFullGC</code></td>\n<td>åœ¨ Full GC ä¹‹å‰æ˜¯å¦å…ˆæ‰§è¡Œä¸€æ¬¡ Minor GC</td>\n<td>trueå¯</td>\n</tr>\n<tr>\n<td><code>-XX:+UseFastAccessorMethods</code></td>\n<td>ä¼˜åŒ–åŸå§‹ç±»å‹çš„ get/set æ–¹æ³•æ€§èƒ½</td>\n<td>falseå¯</td>\n</tr>\n<tr>\n<td><code>-XX:+AlwaysPreTouch</code></td>\n<td>JVM å¯åŠ¨æ—¶ç«‹å³åˆ†é…å¹¶åˆå§‹åŒ–æ‰€æœ‰å†…å­˜é¡µï¼Œé¿å…è¿è¡Œæ—¶é¦–æ¬¡åˆ†é…å¸¦æ¥çš„åœé¡¿</td>\n<td>false</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"åˆ†åŒºæ¨¡å‹\">åˆ†åŒºæ¨¡å‹</h3>\n<h4 id=\"G1-åƒåœ¾å›æ”¶å™¨\">G1 åƒåœ¾å›æ”¶å™¨</h4>\n<p><img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/uPic/AaqBxm.png\" alt=\"\" width=\"900\" height=\"300\"></p>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>G1(Garbage-First) å±äº ç‰©ç†ä¸Šåˆ†åŒºï¼Œé€»è¾‘ä¸Šåˆ†ä»£ï¼ŒçœŸæ­£çš„åˆ†åŒºæ¨¡å‹æ˜¯ <code>ZGC</code>ï¼ˆjdk21åä¹Ÿæ”¯æŒåˆ†ä»£ï¼‰</p>\n</li>\n<li class=\"lvl-2\">\n<p>G1å°†Javaå †åˆ’åˆ†ä¸ºå¤šä¸ªå¤§å°ç›¸ç­‰çš„Regionï¼ŒRegionå¤§å°æ˜¯2çš„å¹‚ï¼ŒèŒƒå›´åœ¨1MBåˆ°32MBä¹‹é—´ã€‚JDK9ä¹‹å‰é»˜è®¤æœ€å¤šæ”¯æŒ2048ä¸ªRegionï¼Œè¿™å°±å¯¼è‡´G1æœ€å¤§æ”¯æŒ64G çš„å † (<code>2048 Regions Ã— 32MB = 64GB</code>)ï¼ŒJDK10ä¹‹åçš„ç‰ˆæœ¬å¯æ”¯æŒæ›´å¤šRegionæ•°é‡ï¼ŒJDK17è¿›ä¸€æ­¥ä¼˜åŒ–äº†Regionæ˜ å°„æœºåˆ¶ï¼Œæå‡äº†å¤§å †åœºæ™¯ä¸‹çš„æ€§èƒ½ï¼Œä½¿å…¶å¯ä»¥æ”¯æŒæ›´å¤§çš„å†…å­˜ï¼Œä½†å¯¹äºè¶…å¤§å †ï¼ˆ&gt;1Tï¼‰ï¼Œè€ƒè™‘åˆ°GCæš‚åœæ—¶é—´ï¼Œå»ºè®®ä½¿ç”¨ZGCæˆ–Shenandoah GCã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>Regionä¸€æ—¦è¢«å›æ”¶ï¼Œé‡æ–°åˆ†é…æ—¶å¯ä»¥æ˜¯ä»»æ„ç±»å‹ï¼Œæ¯”å¦‚åŸå…ˆæ˜¯<code>Eden</code>ï¼Œé‚£ä¹ˆé‡æ–°åˆ†é…æ—¶å¯ä»¥æ˜¯<code>Old</code>ï¼Œåä¹‹äº¦ç„¶ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä¸€èˆ¬Regionå¤§å°ç”±JVMè‡ªåŠ¨è®¡ç®—ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ç”¨å‚æ•°<code>-XX:G1HeapRegionSize</code>æ‰‹åŠ¨æŒ‡å®šRegionå¤§å°ï¼Œä½†æ˜¯æ¨èé»˜è®¤çš„è®¡ç®—æ–¹å¼ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>G1ä¿ç•™äº†å¹´è½»ä»£å’Œè€å¹´ä»£çš„æ¦‚å¿µï¼Œä½†ä¸å†æ˜¯ç‰©ç†éš”é˜‚äº†ï¼Œå®ƒä»¬éƒ½æ˜¯ï¼ˆå¯ä»¥ä¸è¿ç»­ï¼‰Regionçš„é›†åˆã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>åœ¨ G1 GC ä¸­ï¼Œä¸è¦ä½¿ç”¨ <code>-Xmn</code>ï¼ŒG1 ä¸­æ¨èä½¿ç”¨ä»¥ä¸‹æ›´ç»†ç²’åº¦çš„æ§åˆ¶æ–¹å¼ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># è¿™æ˜¯å®éªŒæ€§å‚æ•°ï¼Œéœ€è¦å¼€å¯ `-XX:+UnlockExperimentalVMOptions`ï¼Œä½†ä¾æ—§æ¨èåœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨</span></span><br><span class=\"line\">-XX:G1NewSizePercent=5</span><br><span class=\"line\">-XX:G1MaxNewSizePercent=60</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>é»˜è®¤å¹´è½»ä»£å¯¹å †å†…å­˜çš„å æ¯”æ˜¯<code>5%</code>ï¼Œå¦‚æœå †å¤§å°ä¸º4096Mï¼Œé‚£ä¹ˆå¹´è½»ä»£å æ®200MBå·¦å³çš„å†…å­˜ï¼Œå¯¹åº”å¤§æ¦‚æ˜¯100ä¸ªRegionï¼Œå¯ä»¥é€šè¿‡   <code>-XX:G1NewSizePercent</code>è®¾ç½®æ–°ç”Ÿä»£åˆå§‹å æ¯”ï¼Œè¿™æ˜¯å®éªŒæ€§å‚æ•°ï¼Œéœ€è¦å¼€å¯ <code>-XX:+UnlockExperimentalVMOptions</code>ï¼Œä½†ä¾æ—§æ¨èåœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>åœ¨ç³»ç»Ÿè¿è¡Œä¸­ï¼ŒJVMä¼šä¸åœçš„ç»™å¹´è½»ä»£å¢åŠ æ›´å¤šçš„Regionï¼Œä½†æ˜¯æœ€å¤šæ–°ç”Ÿä»£çš„å æ¯”ä¸ä¼šè¶…è¿‡<code>60%</code>ï¼Œå¯ä»¥é€šè¿‡<code>-XX:G1MaxNewSizePercent</code>è°ƒæ•´ï¼Œè¿™æ˜¯å®éªŒæ€§å‚æ•°ï¼Œéœ€è¦å¼€å¯ <code>-XX:+UnlockExperimentalVMOptions</code>ï¼Œä½†ä¾æ—§æ¨èåœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å¹´è½»ä»£ä¸­çš„Edenå’ŒSurvivorå¯¹åº”çš„regionä¹Ÿè·Ÿä¹‹å‰ä¸€æ ·ï¼Œé»˜è®¤<code>8:1:1</code>ï¼Œå‡è®¾å¹´è½»ä»£ç°åœ¨æœ‰1000ä¸ªregionï¼ŒedenåŒºå¯¹åº”800ä¸ªï¼Œs0å¯¹åº”100ä¸ªï¼Œs1å¯¹åº”100ä¸ªã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä¸€ä¸ªRegionå¯èƒ½ä¹‹å‰æ˜¯å¹´è½»ä»£ï¼Œå¦‚æœRegionè¿›è¡Œäº†åƒåœ¾å›æ”¶ï¼Œä¹‹åå¯èƒ½åˆä¼šå˜æˆè€å¹´ä»£ï¼Œä¹Ÿå°±æ˜¯è¯´Regionçš„åŒºåŸŸåŠŸèƒ½å¯èƒ½ä¼šåŠ¨æ€å˜åŒ–ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>G1åƒåœ¾æ”¶é›†å™¨å¯¹äºå¯¹è±¡ä»€ä¹ˆæ—¶å€™ä¼šè½¬ç§»åˆ°è€å¹´ä»£è·Ÿä¹‹å‰è®²è¿‡çš„åŸåˆ™ä¸€æ ·ï¼Œå”¯ä¸€ä¸åŒçš„æ˜¯å¯¹å¤§å¯¹è±¡çš„å¤„ç†ï¼ŒG1æœ‰ä¸“é—¨åˆ†é…å¤§å¯¹è±¡çš„Regionå«<code>Humongous</code>åŒºï¼Œè€Œä¸æ˜¯è®©å¤§å¯¹è±¡ç›´æ¥è¿›å…¥è€å¹´ä»£çš„Regionä¸­ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>åœ¨G1ä¸­ï¼Œå¤§å¯¹è±¡çš„åˆ¤å®šè§„åˆ™å°±æ˜¯ä¸€ä¸ªå¤§å¯¹è±¡è¶…è¿‡äº†ä¸€ä¸ªRegionå¤§å°çš„<code>50%</code>ï¼Œæ¯”å¦‚æŒ‰ç…§ä¸Šé¢ç®—çš„ï¼Œæ¯ä¸ªRegionæ˜¯2Mï¼Œåªè¦ä¸€ä¸ªå¤§å¯¹è±¡è¶…è¿‡äº†1Mï¼Œå°±ä¼šè¢«æ”¾å…¥Humongousä¸­ï¼Œè€Œä¸”ä¸€ä¸ªå¤§å¯¹è±¡å¦‚æœå¤ªå¤§ï¼Œå¯èƒ½ä¼šæ¨ªè·¨å¤šä¸ªRegionæ¥å­˜æ”¾ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>HumongousåŒºä¸“é—¨å­˜æ”¾çŸ­æœŸå·¨å‹å¯¹è±¡ï¼Œä¸ç”¨ç›´æ¥è¿›è€å¹´ä»£ï¼Œå¯ä»¥èŠ‚çº¦è€å¹´ä»£çš„ç©ºé—´ï¼Œé¿å…å› ä¸ºè€å¹´ä»£ç©ºé—´ä¸å¤Ÿçš„GCå¼€é”€ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>Full GCçš„æ—¶å€™é™¤äº†æ”¶é›†å¹´è½»ä»£å’Œè€å¹´ä»£ä¹‹å¤–ï¼Œä¹Ÿä¼šå°†HumongousåŒºä¸€å¹¶å›æ”¶ã€‚</p>\n</li>\n</ul>\n<h5 id=\"G1åƒåœ¾æ”¶é›†åˆ†ç±»\">G1åƒåœ¾æ”¶é›†åˆ†ç±»</h5>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>YoungGC<br>\nYoungGCå¹¶ä¸æ˜¯è¯´ç°æœ‰çš„EdenåŒºæ”¾æ»¡äº†å°±ä¼šé©¬ä¸Šè§¦å‘ï¼ŒG1ä¼šè®¡ç®—ä¸‹ç°åœ¨EdenåŒºå›æ”¶å¤§æ¦‚è¦å¤šä¹…æ—¶é—´ï¼Œå¦‚æœå›æ”¶æ—¶é—´è¿œè¿œå°äºå‚æ•° <code>-XX:MaxGCPauseMills</code> è®¾å®šçš„å€¼ï¼Œé‚£ä¹ˆå¢åŠ å¹´è½»ä»£çš„regionï¼Œç»§ç»­ç»™æ–°å¯¹è±¡å­˜æ”¾ï¼Œä¸ä¼šé©¬ä¸ŠåšYoungGCï¼Œç›´åˆ°ä¸‹ä¸€æ¬¡EdenåŒºæ”¾æ»¡ï¼ŒG1è®¡ç®—å›æ”¶æ—¶é—´æ¥è¿‘å‚æ•° <code>-XX:MaxGCPauseMills</code> è®¾å®šçš„å€¼ï¼Œé‚£ä¹ˆå°±ä¼šè§¦å‘Young GC</p>\n</li>\n<li class=\"lvl-2\">\n<p>MixedGC<br>\nä¸æ˜¯FullGCï¼Œè€å¹´ä»£çš„å †å æœ‰ç‡è¾¾åˆ°å‚æ•° <code>-XX:InitiatingHeapOccupancyPercent</code> è®¾å®šçš„å€¼åˆ™è§¦å‘ï¼Œå›æ”¶æ‰€æœ‰çš„Youngå’Œéƒ¨åˆ†Old(æ ¹æ®æœŸæœ›çš„GCåœé¡¿æ—¶é—´ç¡®å®šoldåŒºåƒåœ¾æ”¶é›†çš„ä¼˜å…ˆé¡ºåº)ä»¥åŠå¤§å¯¹è±¡åŒºï¼Œæ­£å¸¸æƒ…å†µG1çš„åƒåœ¾æ”¶é›†æ˜¯å…ˆåšMixedGCï¼Œä¸»è¦ä½¿ç”¨å¤åˆ¶ç®—æ³•ï¼Œéœ€è¦æŠŠå„ä¸ªregionä¸­å­˜æ´»çš„å¯¹è±¡æ‹·è´åˆ°åˆ«çš„regioné‡Œå»ï¼Œæ‹·è´è¿‡ç¨‹ä¸­å¦‚æœå‘ç°æ²¡æœ‰è¶³å¤Ÿçš„ç©ºregionèƒ½å¤Ÿæ‰¿è½½æ‹·è´å¯¹è±¡å°±ä¼šè§¦å‘ä¸€æ¬¡Full GC</p>\n</li>\n<li class=\"lvl-2\">\n<p>Full GC<br>\nåœæ­¢ç³»ç»Ÿç¨‹åºï¼Œç„¶åé‡‡ç”¨å•çº¿ç¨‹è¿›è¡Œæ ‡è®°ã€æ¸…ç†å’Œå‹ç¼©æ•´ç†ï¼Œå¥½ç©ºé—²å‡ºæ¥ä¸€æ‰¹Regionæ¥ä¾›ä¸‹ä¸€æ¬¡MixedGCä½¿ç”¨ï¼Œè¿™ä¸ªè¿‡ç¨‹æ˜¯éå¸¸è€—æ—¶çš„ã€‚(Shenandoahä¼˜åŒ–æˆå¤šçº¿ç¨‹æ”¶é›†äº†)</p>\n</li>\n</ul>\n<h4 id=\"G1-æ”¶é›†å™¨çš„å·¥ä½œæ–¹å¼-MixedGC\">G1 æ”¶é›†å™¨çš„å·¥ä½œæ–¹å¼(MixedGC)</h4>\n<p><img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/uPic/XbkEoh.png\" alt=\"\" width=\"1200\" height=\"400\"></p>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å›¾ä¸­ä¸»è¦å±•ç¤ºäº†ä¸€ä¸ªå…¸å‹çš„ G1 GC çš„ å¹¶å‘æ ‡è®°å‘¨æœŸï¼ˆConcurrent Mark Cycleï¼‰ çš„è¿‡ç¨‹ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å›¾ä¸­çš„æ°´å¹³ç®­å¤´è¡¨ç¤ºå„çº¿ç¨‹ï¼ˆç”¨æˆ·çº¿ç¨‹å’ŒGCçº¿ç¨‹ï¼‰çš„æ‰§è¡Œè·¯å¾„ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ç«–ç›´çš„<code>Safepoint</code>çº¿è¡¨ç¤ºä¸€æ¬¡GCè¿‡ç¨‹ä¸­ä¼šæš‚åœæ‰€æœ‰ç”¨æˆ·çº¿ç¨‹çš„æ—¶åˆ»ï¼ˆStop-The-Worldï¼‰ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1ï¸âƒ£ åˆå§‹æ ‡è®°ï¼ˆInitial Markï¼‰</span><br><span class=\"line\">    è¿›å…¥ Safepointï¼š æ‰€æœ‰ç”¨æˆ·çº¿ç¨‹åœ¨æ­¤åˆ»æš‚åœï¼ˆSTWï¼‰ã€‚</span><br><span class=\"line\">    æ ‡è®° GC Roots ç›´æ¥å¯è¾¾å¯¹è±¡ã€‚</span><br><span class=\"line\">    éå¸¸çŸ­æš‚ï¼Œä½†å±äº Stop-The-World é˜¶æ®µã€‚</span><br><span class=\"line\">    å›¾ä¸­æ˜¯â€œåˆå§‹æ ‡è®°â€ç®­å¤´åœ¨ Safepoint ä¹‹åç«‹åˆ»æ‰§è¡Œã€‚</span><br><span class=\"line\"></span><br><span class=\"line\">2ï¸âƒ£ å¹¶å‘æ ‡è®°ï¼ˆConcurrent Markï¼‰</span><br><span class=\"line\">    ç”¨æˆ·çº¿ç¨‹ æ¢å¤è¿è¡Œï¼ˆå›¾ä¸­ç”¨æˆ·çº¿ç¨‹ç»§ç»­å‘å³å»¶ä¼¸ï¼‰ã€‚</span><br><span class=\"line\">    GC çº¿ç¨‹ å¹¶å‘è¿›è¡Œæ ‡è®°å·¥ä½œï¼ˆå³åœ¨ç”¨æˆ·çº¿ç¨‹è¿è¡ŒæœŸé—´è¿›è¡Œæ ‡è®°ï¼‰ã€‚</span><br><span class=\"line\">    å›¾ä¸­è“è‰²çš„â€œå¹¶å‘æ ‡è®°â€ç®­å¤´ä¸ç”¨æˆ·çº¿ç¨‹ç®­å¤´å¹¶è¡Œæ˜¾ç¤ºï¼Œè¡¨ç¤ºå¹¶å‘æ‰§è¡Œã€‚</span><br><span class=\"line\"></span><br><span class=\"line\">3ï¸âƒ£ æœ€ç»ˆæ ‡è®°ï¼ˆRemark / Final Markï¼‰</span><br><span class=\"line\">    å†æ¬¡è¿›å…¥ Safepointã€‚</span><br><span class=\"line\">    é‡æ–°æš‚åœæ‰€æœ‰ç”¨æˆ·çº¿ç¨‹ã€‚</span><br><span class=\"line\">    å¤„ç†å¹¶å‘æ ‡è®°é˜¶æ®µä¸­é—æ¼çš„å¼•ç”¨æ›´æ–°ç­‰ä¿¡æ¯ï¼Œä¿è¯æ ‡è®°çš„å‡†ç¡®æ€§ã€‚</span><br><span class=\"line\"></span><br><span class=\"line\">4ï¸âƒ£ ç­›é€‰å›æ”¶ï¼ˆCleanup / Filtered Collectionï¼‰</span><br><span class=\"line\">    å¯¹å·²æ ‡è®°çš„å¯¹è±¡åšæ¸…ç†ï¼ˆå›æ”¶ä¸å¯è¾¾å¯¹è±¡ï¼‰ã€‚</span><br><span class=\"line\">    åˆ¤æ–­æ˜¯å¦éœ€è¦å›æ”¶æŸäº› Regionã€‚</span><br><span class=\"line\">    å›¾ä¸­è“è‰²ç®­å¤´æ ‡æ³¨ä¸ºâ€œç­›é€‰å›æ”¶â€ã€‚</span><br><span class=\"line\"></span><br><span class=\"line\">5ï¸âƒ£ æ¢å¤ç”¨æˆ·çº¿ç¨‹</span><br><span class=\"line\">    åœ¨æœ€åä¸€ä¸ª Safepoint ä¹‹åï¼Œæ‰€æœ‰ç”¨æˆ·çº¿ç¨‹é‡æ–°å¼€å§‹æ‰§è¡Œï¼ˆå›¾ä¸­é»„è‰²ç®­å¤´é‡æ–°å‘å³å»¶ä¼¸ï¼‰ã€‚</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>G1çš„GC è¿‡ç¨‹ä¼šç»å†å¤šæ¬¡<code>Safepoint</code>ï¼Œä½†åªæœ‰ <code>å¹¶å‘æ ‡è®°é˜¶æ®µ</code> æ˜¯æ•´ä¸ªå‘¨æœŸä¸­æœ€è€—æ—¶ä½†ä¸ä¼šæš‚åœç”¨æˆ·çº¿ç¨‹(STW)çš„éƒ¨åˆ†ã€‚</p>\n</li>\n</ul>\n<div class=\"tips\">\n<p><em><strong>Safepointï¼ˆå®‰å…¨ç‚¹ï¼‰</strong></em></p>\n<ul class=\"lvl-1\">\n<li class=\"lvl-2\">åœ¨ JVMï¼ˆJava è™šæ‹Ÿæœºï¼‰ä¸­ï¼ŒSafepointï¼ˆå®‰å…¨ç‚¹ï¼‰ æ˜¯ä¸€ä¸ªéå¸¸é‡è¦çš„æ¦‚å¿µï¼Œå®ƒä»£è¡¨ æ‰€æœ‰çº¿ç¨‹å¿…é¡»â€œå®‰å…¨åœ°â€æš‚åœçš„æŸä¸ªæ—¶é—´ç‚¹ï¼Œä»¥ä¾¿ JVM èƒ½å¤Ÿæ‰§è¡ŒæŸäº›å…¨å±€æ“ä½œï¼Œæ¯”å¦‚ï¼š<br>\nåƒåœ¾å›æ”¶ï¼ˆGCï¼‰<br>\næ ˆéå†ï¼ˆä¾‹å¦‚ç”Ÿæˆå †å¿«ç…§ã€åšé€ƒé€¸åˆ†æç­‰ï¼‰<br>\nç±»å¸è½½<br>\nJIT ç¼–è¯‘çš„ä¸€äº›é‡å†™æ“ä½œç­‰</li>\n<li class=\"lvl-2\">å¦‚æœçº¿ç¨‹æ­£åœ¨è¿è¡Œã€æ”¹å˜å †ä¸­å¯¹è±¡çš„æ•°æ®ï¼Œé‚£ä¹ˆ GC å°±æ— æ³•å‡†ç¡®æ ‡è®°å’Œå›æ”¶å¯¹è±¡ã€‚å› æ­¤ JVM éœ€è¦ è®©æ‰€æœ‰çº¿ç¨‹åœ¨ä¸€ä¸ªâ€œå¯æ§ã€å®‰å…¨çš„ä½ç½®â€ä¸Šæš‚åœï¼Œè¿™ä¸ªä½ç½®å°±å« Safepointã€‚</li>\n<li class=\"lvl-2\">Safepoint æ˜¯æ€ä¹ˆå·¥ä½œçš„ï¼Ÿ<br>\n1.JVM å‘å‡ºâ€œè¿›å…¥ Safepointâ€çš„ä¿¡å·ï¼ˆæ¯”å¦‚è¦å¼€å§‹ GCï¼‰<br>\n2.æ‰€æœ‰çº¿ç¨‹æ”¶åˆ°ä¿¡å·åï¼Œå¿…é¡»ç­‰åˆ°â€œæœ€è¿‘çš„ Safepointâ€å†åœä¸‹æ¥ï¼š<br>\nSafepoint ä¸æ˜¯ä»»æ„ä½ç½®éƒ½å¯ä»¥åœï¼Œå®ƒåªå‡ºç°åœ¨å­—èŠ‚ç ä¸­ä¸€äº›ç‰¹å®šçš„æŒ‡ä»¤ç‚¹ï¼ˆæ¯”å¦‚æ–¹æ³•è°ƒç”¨ã€å¾ªç¯è·³è½¬ç­‰ï¼‰<br>\n3.ç­‰æ‰€æœ‰çº¿ç¨‹éƒ½è¿›å…¥ Safepoint åï¼ŒJVM æ‰èƒ½å¼€å§‹æ‰§è¡Œ GC ç­‰å…¨å±€æ“ä½œã€‚</li>\n</ul>\n</div>\n<h5 id=\"G1-æ”¶é›†å™¨å‚æ•°é…ç½®è¡¨\">G1 æ”¶é›†å™¨å‚æ•°é…ç½®è¡¨</h5>\n<table>\n<thead>\n<tr>\n<th>å‚æ•°å</th>\n<th>è¯´æ˜</th>\n<th>é»˜è®¤å€¼</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>-XX:+UseG1GC</code></td>\n<td>ä½¿ç”¨ G1 åƒåœ¾æ”¶é›†å™¨</td>\n<td>-</td>\n</tr>\n<tr>\n<td><code>-XX:ParallelGCThreads</code></td>\n<td>æŒ‡å®š GC å·¥ä½œçš„çº¿ç¨‹æ•°é‡</td>\n<td>ä¸ CPU æ•°é‡ç›¸å…³</td>\n</tr>\n<tr>\n<td><code>-XX:G1HeapRegionSize</code></td>\n<td>è®¾ç½®å †åˆ†åŒºå¤§å°ï¼ˆ1MB~32MBï¼Œ2 çš„å¹‚ï¼‰ï¼Œå †é»˜è®¤åˆ’åˆ†ä¸º 2048 ä¸ª Region</td>\n<td>è‡ªåŠ¨è®¡ç®—</td>\n</tr>\n<tr>\n<td><code>-XX:MaxGCPauseMillis</code></td>\n<td>è®¾ç½® GC ç›®æ ‡æœ€å¤§æš‚åœæ—¶é—´</td>\n<td>200ms</td>\n</tr>\n<tr>\n<td><code>-XX:G1NewSizePercent</code></td>\n<td>æ–°ç”Ÿä»£åˆå§‹å æ¯”ï¼ˆå æ•´ä¸ªå †ï¼‰ï¼Œå®éªŒæ€§å‚æ•°ï¼Œ-XX:+UnlockExperimentalVMOptions</td>\n<td>5%</td>\n</tr>\n<tr>\n<td><code>-XX:G1MaxNewSizePercent</code></td>\n<td>æ–°ç”Ÿä»£æœ€å¤§å æ¯”ï¼ˆå æ•´ä¸ªå †ï¼‰ï¼Œå®éªŒæ€§å‚æ•°ï¼Œ-XX:+UnlockExperimentalVMOptions</td>\n<td>60%</td>\n</tr>\n<tr>\n<td><code>-XX:TargetSurvivorRatio</code></td>\n<td>Survivor åŒºå¡«å……ç›®æ ‡ï¼ˆè¶…è¿‡è¯¥æ¯”ä¾‹ï¼Œæ™‹å‡è€å¹´ä»£ï¼‰</td>\n<td>50%</td>\n</tr>\n<tr>\n<td><code>-XX:MaxTenuringThreshold</code></td>\n<td>æœ€å¤§å¯¹è±¡å¹´é¾„é˜ˆå€¼ï¼ˆå¹´é¾„è¶…è¿‡å°†è¿›å…¥è€å¹´ä»£ï¼‰</td>\n<td>15</td>\n</tr>\n<tr>\n<td><code>-XX:InitiatingHeapOccupancyPercent</code></td>\n<td>è€å¹´ä»£çš„ä½¿ç”¨ç‡è¶…è¿‡è¯¥å€¼è§¦å‘ Mixed GC</td>\n<td>45%</td>\n</tr>\n<tr>\n<td><code>-XX:G1MixedGCLiveThresholdPercent</code></td>\n<td>Mixed GC ä¸­ï¼šRegion å­˜æ´»å¯¹è±¡å æ¯”ä½äºè¯¥å€¼æ‰ä¼šè¢«å›æ”¶ï¼Œå®éªŒæ€§å‚æ•°ï¼Œ-XX:+UnlockExperimentalVMOptions</td>\n<td>85%</td>\n</tr>\n<tr>\n<td><code>-XX:G1HeapWastePercent</code></td>\n<td>Mixed GC å›æ”¶ç›®æ ‡ï¼šç©ºé—² Region è¾¾å †æ€»é‡è¯¥ç™¾åˆ†æ¯”å°±ç»“æŸæ··åˆå›æ”¶</td>\n<td>5%</td>\n</tr>\n<tr>\n<td><code>-XX:G1ReservePercent</code></td>\n<td>ä¸ºæ»¡è¶³åœé¡¿æ—¶é—´ç›®æ ‡ä¿ç•™çš„å †ç©ºé—´æ¯”ä¾‹ï¼Œæ˜¯ä¸€ç§ç©ºé—´æ¢æ—¶é—´çš„ç­–ç•¥ï¼Œåœ¨å†…å­˜ä¸è¶³æ—¶å¯èƒ½é€ æˆå†…å­˜æ›´åŠ ç´§å¼ </td>\n<td>10%</td>\n</tr>\n<tr>\n<td><code>-XX:G1UseAdaptiveIHOP</code></td>\n<td>æ˜¯å¦å¯ç”¨è‡ªé€‚åº”IHOPï¼Œå¯ç”¨åG1ä¼šåœ¨åˆå§‹é‡‡æ ·åè‡ªåŠ¨è°ƒæ•´IHOPå€¼</td>\n<td>true</td>\n</tr>\n<tr>\n<td><code>-XX:G1AdaptiveIHOPNumInitialSamples</code></td>\n<td>æŒ‡å®šå‰å‡ æ¬¡GCæ´»åŠ¨æŒ‰IHOPå‚æ•°è®¡ç®—</td>\n<td>3</td>\n</tr>\n<tr>\n<td><code>-XX:SoftRefLRUPolicyMSPerMB</code></td>\n<td>æ¯MBå †å†…å­˜ä¸­è½¯å¼•ç”¨çš„è¿‡æœŸæ—¶é—´(ms)</td>\n<td>1000</td>\n</tr>\n<tr>\n<td><code>-XX:G1OldCSetRegionThresholdPercent</code></td>\n<td>è®¾ç½®ä¸€æ¬¡æ··åˆGCä¸­éœ€è¦æ¸…ç†çš„OldåŒºçš„å†…å­˜æ¯”ä¾‹ï¼Œè°ƒå¤§å¯é™ä½G1é¢‘ç‡ä½†ä¼šå¢åŠ æ¯æ¬¡GCæ—¶é—´</td>\n<td>10%</td>\n</tr>\n<tr>\n<td><code>-XX:G1MixedGCCountTarget</code></td>\n<td>è®¾ç½®G1åƒåœ¾å›æ”¶å™¨çš„çº¿ç¨‹ä¸Šé™ï¼ŒHotSpotä¼šæ ¹æ®æ¸…ç†ç›®æ ‡è‡ªåŠ¨è®¡ç®—æ‰€éœ€çº¿ç¨‹æ•°ï¼Œä½†ä¸ä¼šè¶…è¿‡æ­¤ä¸Šé™</td>\n<td>8</td>\n</tr>\n</tbody>\n</table>\n<h4 id=\"ZGC-åƒåœ¾å›æ”¶å™¨\">ZGC åƒåœ¾å›æ”¶å™¨</h4>\n<p><img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/uPic/bBUAYt.png\" alt=\"\" width=\"700\" height=\"500\"></p>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ZGC(Z Garbage Collector)æ˜¯ä¸€æ¬¾JDK 11ä¸­æ–°åŠ å…¥çš„å…·æœ‰å®éªŒæ€§è´¨çš„ä½å»¶è¿Ÿåƒåœ¾æ”¶é›†å™¨ï¼ŒZGCå¯ä»¥è¯´æºè‡ªäºæ˜¯Azul Systemå…¬å¸å¼€å‘çš„C4ï¼ˆConcurrent Continuously Compacting Collectorï¼‰ æ”¶é›†å™¨</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>Platform</th>\n<th>Supported</th>\n<th>Since</th>\n<th>Comment</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Linux/x64</td>\n<td>âœ…</td>\n<td>JDK 11</td>\n<td></td>\n</tr>\n<tr>\n<td>Linux/AArch64</td>\n<td>âœ…</td>\n<td>JDK 13</td>\n<td></td>\n</tr>\n<tr>\n<td>macOS</td>\n<td>âœ…</td>\n<td>JDK 14</td>\n<td></td>\n</tr>\n<tr>\n<td>Windows</td>\n<td>âœ…</td>\n<td>JDK 14</td>\n<td>Requires Windows version 1803 (Windows 10 or Windows Server 2019) or later.</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ZGCæ”¶é›†å™¨æ˜¯ä¸€æ¬¾åŸºäºRegionå†…å­˜å¸ƒå±€çš„ï¼Œæš‚æ—¶ä¸è®¾åˆ†ä»£çš„(jdk21åæ”¯æŒåˆ†ä»£)ï¼Œä½¿ç”¨äº†<code>è¯»å±éšœ</code>ã€<code>é¢œè‰²æŒ‡é’ˆ</code>ç­‰æŠ€æœ¯æ¥å®ç°å¯å¹¶å‘çš„æ ‡è®°-æ•´ç†ç®—æ³•çš„ï¼Œä»¥ä½å»¶è¿Ÿä¸ºé¦–è¦ç›®æ ‡çš„ä¸€æ¬¾åƒåœ¾æ”¶é›†å™¨ã€‚</p>\n</li>\n</ul>\n<div class=\"tips\">\n<p><em><strong>é¢œè‰²æŒ‡é’ˆ</strong></em></p>\n<ul class=\"lvl-1\">\n<li class=\"lvl-2\">åœ¨ ZGCï¼ˆZ Garbage Collectorï¼‰ä¸­ï¼Œé¢œè‰²æŒ‡é’ˆï¼ˆColored Pointerï¼‰æ˜¯ä¸€ç§æ ¸å¿ƒæœºåˆ¶ï¼ŒæŠŠå¯¹è±¡çš„ GC çŠ¶æ€ä¿¡æ¯ç›´æ¥åµŒå…¥åˆ°å¯¹è±¡çš„å¼•ç”¨ï¼ˆåœ°å€ï¼‰ä¸­ï¼Œç”¨äºåœ¨ä¸å¢åŠ å¯¹è±¡é¢å¤–å…ƒæ•°æ®çš„å‰æä¸‹ï¼Œè·Ÿè¸ªå¯¹è±¡åœ¨åƒåœ¾å›æ”¶è¿‡ç¨‹ä¸­çš„çŠ¶æ€ã€‚</li>\n<li class=\"lvl-2\">åœ¨ä¼ ç»Ÿ GC ä¸­ï¼Œå¯¹è±¡çš„â€œé¢œè‰²â€ï¼ˆå¦‚ç™½è‰²ã€ç°è‰²ã€é»‘è‰²ï¼‰è¡¨ç¤ºå…¶åœ¨ GC ä¸åŒé˜¶æ®µçš„çŠ¶æ€ï¼Œè¿™äº›ä¿¡æ¯ä¸€èˆ¬å­˜å‚¨åœ¨é¢å¤–çš„æ•°æ®ç»“æ„ä¸­ï¼ˆå¦‚è®°å¿†é›†åˆã€ä½å›¾ç­‰ï¼‰ã€‚</li>\n<li class=\"lvl-2\">è€Œåœ¨ ZGC ä¸­ï¼ŒZGC å°†å¯¹è±¡çš„è¿™äº›çŠ¶æ€ä¿¡æ¯ç¼–ç è¿›æŒ‡é’ˆçš„é«˜ä½ä¸­ã€‚æ‰€ä»¥ä¸€ä¸ªå¯¹è±¡å¼•ç”¨ï¼ˆpointerï¼‰ä¸ä»…ä»…æ˜¯å†…å­˜åœ°å€ï¼Œè¿˜æºå¸¦äº†å¯¹è±¡åœ¨ GC è¿‡ç¨‹ä¸­çš„â€œé¢œè‰²â€ä¿¡æ¯ã€‚</li>\n<li class=\"lvl-2\">ZGC ä¸»è¦è¿è¡Œåœ¨ 64 ä½ç³»ç»Ÿä¸Šï¼Œä½†å½“å‰çš„æ“ä½œç³»ç»Ÿå’Œ CPU å®é™…ä¸Šåªä½¿ç”¨ 48ï½57 ä½è™šæ‹Ÿåœ°å€ã€‚ZGC åˆ©ç”¨æœªä½¿ç”¨çš„é«˜ä½è¿›è¡Œç¼–ç ã€‚<br>\n<img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/uPic/LD51Zb.png\" alt=\"\" width=\"900\" height=\"300\"></li>\n<li class=\"lvl-2\">æ¯ä¸ªå¯¹è±¡æœ‰ä¸€ä¸ª64ä½æŒ‡é’ˆï¼Œè¿™64ä½è¢«åˆ†ä¸ºï¼š</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>ä½æ•°</th>\n<th>åç§°</th>\n<th>å«ä¹‰</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>18 ä½</td>\n<td>é¢„ç•™</td>\n<td>ä¿ç•™ä½ï¼Œæœªæ¥å¯èƒ½ç”¨äºæ‰©å±•åŠŸèƒ½</td>\n</tr>\n<tr>\n<td>1 ä½</td>\n<td>Finalizable</td>\n<td>è¡¨ç¤ºå¯¹è±¡å¯ç»ˆç»“ï¼ˆå³å®ç°äº† <code>finalize()</code> æ–¹æ³•ï¼‰</td>\n</tr>\n<tr>\n<td>1 ä½</td>\n<td>Remapped</td>\n<td>æ ‡è¯†å¯¹è±¡æ˜¯å¦å·²è¢«è½¬ç§»(ç”¨äºæ ‡è¯†æŸä¸ªå¼•ç”¨æ˜¯å¦å·²ç»è¢«é‡å®šå‘ï¼ˆæ›´æ–°ä¸ºæ–°åœ°å€ï¼‰)ï¼›ä¸º 1 è¡¨ç¤ºè¯¥å¯¹è±¡æœªåœ¨é‡å®šä½é›†ï¼ˆRelocation Setï¼‰ä¸­ï¼Œå³æ–°åœ°å€ï¼Œä¸º0è¡¨ç¤ºæ—§åœ°å€</td>\n</tr>\n<tr>\n<td>1 ä½</td>\n<td>Marked1</td>\n<td>æ ‡è®°ä½ä¹‹ä¸€ï¼Œç”¨äº GC è¿‡ç¨‹ä¸­çš„å¯¹è±¡æ ‡è®°é˜¶æ®µ ,ç”±äº ZGC æ˜¯å¹¶å‘ GCï¼Œéœ€è¦ä¸¤ä½æ¥æ”¯æŒé¢œè‰²åˆ‡æ¢æœºåˆ¶ï¼ˆColor Flipï¼‰ï¼Œç¡®ä¿åœ¨ä¸åŒ GC å‘¨æœŸä¸­å¯ä»¥åŒºåˆ†æ–°æ—§æ ‡è®°ï¼Œéœ€è¦è§¦å‘ä¸€æ¬¡è¯»å–å±éšœï¼ˆload barrierï¼‰ï¼Œæ‰¾åˆ°å¯¹è±¡çš„æ–°ä½ç½®ï¼Œå¹¶æ›´æ–°è¿™ä¸ªå¼•ç”¨ã€‚</td>\n</tr>\n<tr>\n<td>1 ä½</td>\n<td>Marked0</td>\n<td>å¦ä¸€ä¸ªæ ‡è®°ä½ï¼Œä¸ Marked1 é…åˆç”¨äº GC æ ‡è®°é˜¶æ®µ</td>\n</tr>\n<tr>\n<td>42 ä½</td>\n<td>å¯¹è±¡åœ°å€éƒ¨åˆ†</td>\n<td>å®é™…çš„å†…å­˜åœ°å€éƒ¨åˆ†ï¼Œæœ€å¤šå¯è¡¨ç¤º 2^42 å­—èŠ‚ï¼ˆå³ 4 TBï¼‰,jdk15åå ç”¨ 44ä½ï¼Œæ”¯æŒ 16TB</td>\n</tr>\n</tbody>\n</table>\n<p><em><strong>è¯»å±éšœ</strong></em></p>\n<ul class=\"lvl-1\">\n<li class=\"lvl-2\">\n<p>ZGCï¼ˆZ Garbage Collectorï¼‰ä¸­çš„**è¯»å±éšœï¼ˆRead Barrierï¼‰æ˜¯å…¶æ ¸å¿ƒæœºåˆ¶ä¹‹ä¸€ï¼Œå®ƒä¿è¯äº†å¹¶å‘å‹ç¼©ï¼ˆå¯¹è±¡ç§»åŠ¨ï¼‰**æ—¶ç¨‹åºçš„æ­£ç¡®æ€§ï¼Œæ˜¯å®ç°ä½å»¶è¿Ÿã€é«˜å¹¶å‘åƒåœ¾å›æ”¶çš„å…³é”®ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>åœ¨ä¼ ç»Ÿ GC ä¸­ï¼Œå¦‚æœå¯¹è±¡åœ¨ GC è¿‡ç¨‹ä¸­è¢«ç§»åŠ¨ï¼Œç¨‹åºè®¿é—®åˆ°çš„å¯¹è±¡åœ°å€å¯èƒ½å°±æ— æ•ˆäº†ã€‚å› æ­¤ï¼Œéœ€è¦**â€œåœä¸–ç•Œâ€**å°†æ‰€æœ‰å¼•ç”¨æ›´æ–°ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>è€Œ ZGC çš„è®¾è®¡ç›®æ ‡æ˜¯ &lt;10ms çš„ GC åœé¡¿æ—¶é—´ï¼Œæ‰€ä»¥å®ƒé‡‡ç”¨ <code>å¹¶å‘æ ‡è®° + å¹¶å‘ç§»åŠ¨ + å¹¶å‘å¼•ç”¨æ›´æ–°</code> çš„æ¨¡å¼ã€‚åœ¨è¿™ç§æ¨¡å¼ä¸‹ï¼Œå¯¹è±¡å¯ä»¥åœ¨ç¨‹åºè¿è¡Œæ—¶è¢«ç§»åŠ¨ï¼Œä½†ç¨‹åºè®¿é—®æ—¶å¿…é¡»â€œçŸ¥é“â€è¿™ä¸ªå¯¹è±¡æ˜¯å¦å·²ç»è¢«ç§»åŠ¨ï¼Œå¹¶è·å–å…¶æœ€æ–°åœ°å€ï¼Œè¿™å°±æ˜¯è¯»å±éšœçš„èŒè´£ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>è¯»å±éšœæ˜¯ä¸€ç§åœ¨è¯»å–å¯¹è±¡å¼•ç”¨æ—¶è‡ªåŠ¨æ’å…¥çš„é€»è¾‘ï¼Œç”¨äºæ£€æŸ¥å¼•ç”¨æ˜¯å¦æœ‰æ•ˆï¼Œå¹¶åœ¨å¿…è¦æ—¶è¿›è¡Œä¿®æ­£ï¼ˆå³åœ°å€é‡å®šå‘ï¼‰ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ZGC æ˜¯ç›®å‰å”¯ä¸€åœ¨æ‰€æœ‰å¯¹è±¡è®¿é—®ä¸­éƒ½ä½¿ç”¨è¯»å±éšœçš„ GCï¼Œå®ƒåœ¨æ¯æ¬¡å¯¹è±¡æŒ‡é’ˆè§£å¼•ç”¨æ—¶éƒ½è¿›è¡Œå¦‚ä¸‹æ“ä½œï¼š</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>èŒè´£</th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>æ£€æµ‹å¼•ç”¨æ˜¯å¦æ˜¯è€åœ°å€</strong></td>\n<td>åˆ©ç”¨æŒ‡é’ˆä¸­çš„å…ƒä¿¡æ¯ï¼ˆé¢œè‰²æŒ‡é’ˆï¼Œå¦‚ Remapped ä½ï¼‰åˆ¤æ–­å¼•ç”¨æ˜¯å¦å·²ç»è¢«æ›´æ–°</td>\n</tr>\n<tr>\n<td><strong>å¦‚æœæœªæ›´æ–°åˆ™é‡å®šå‘å¼•ç”¨</strong></td>\n<td>å¦‚æœå¼•ç”¨çš„æ˜¯æ—§åœ°å€ï¼Œå±éšœä¼šé€šè¿‡ forwarding table æ‰¾åˆ°æ–°åœ°å€å¹¶æ›´æ–°</td>\n</tr>\n<tr>\n<td><strong>ä¿è¯æœ€ç»ˆè®¿é—®å¯¹è±¡çš„åœ°å€æ­£ç¡®</strong></td>\n<td>å³ä½¿åœ¨å¯¹è±¡ç§»åŠ¨è¿‡ç¨‹ä¸­ï¼Œç¨‹åºä¹Ÿæ€»èƒ½è®¿é—®åˆ°æœ‰æ•ˆåœ°å€ï¼Œæ— éœ€åœé¡¿æ‰€æœ‰çº¿ç¨‹</td>\n</tr>\n</tbody>\n</table>\n<pre>\n<code class=\"mermaid\">\ngraph TD\nA[ç¨‹åºè®¿é—®å¯¹è±¡å¼•ç”¨&lt;br&#x2F;&gt;ä¾‹å¦‚ï¼šPerson p &#x3D; personField] --&gt; B[JVM æ’å…¥è¯»å±éšœé€»è¾‘]\nB --&gt; C[è¯»å±éšœæ£€æŸ¥é¢œè‰²æŒ‡é’ˆä¸­çš„ Remapped ä½]\nC --&gt; D{Remapped ä½ä¸º 0 å—ï¼Ÿ}\nD -- æ˜¯ --&gt; E[æ£€æŸ¥å¯¹è±¡æ˜¯å¦å·²è¢«ç§»åŠ¨]\nE --&gt; F[æ›´æ–°å¼•ç”¨åœ°å€ä¸ºæ–°åœ°å€]\nF --&gt; G[è®¾ç½® Remapped ä½ä¸º 1]\nG --&gt; H[ä½¿ç”¨æ›´æ–°åçš„å¼•ç”¨è®¿é—®å¯¹è±¡]\nD -- å¦ --&gt; I[ç›´æ¥ä½¿ç”¨å½“å‰å¼•ç”¨è®¿é—®å¯¹è±¡]\n</code>\n</pre>\n</div>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ZGCçš„Regionå¯ä»¥å…·æœ‰å¤§ã€ä¸­ã€å°ä¸‰ç±»å®¹é‡ï¼š</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-6\">å°å‹Regionï¼ˆSmall Regionï¼‰ ï¼š å®¹é‡å›ºå®šä¸º2MBï¼Œç”¨äºæ”¾ç½®å°äº256KBçš„å°å¯¹è±¡ã€‚</li>\n<li class=\"lvl-6\">ä¸­å‹Regionï¼ˆMedium Regionï¼‰ ï¼š å®¹é‡å›ºå®šä¸º32MBï¼Œç”¨äºæ”¾ç½®å¤§äºç­‰äº256KBä½†å°äº4MBçš„å¯¹è±¡ã€‚</li>\n<li class=\"lvl-6\">å¤§å‹Regionï¼ˆLarge Regionï¼‰ ï¼š å®¹é‡ä¸å›ºå®šï¼Œå¯ä»¥åŠ¨æ€å˜åŒ–ï¼Œä½†å¿…é¡»ä¸º2MBçš„æ•´æ•°å€ï¼Œç”¨äºæ”¾ç½®4MBæˆ–ä»¥ä¸Šçš„å¤§å¯¹è±¡ã€‚</li>\n</ul>\n<blockquote>\n<p>æ¯ä¸ªå¤§å‹Regionä¸­åªä¼šå­˜æ”¾ä¸€ä¸ªå¤§å¯¹è±¡ï¼Œè¿™ä¹Ÿé¢„ç¤ºç€è™½ç„¶åå­—å«ä½œâ€œå¤§å‹Regionâ€ï¼Œä½†å®ƒçš„å®é™…å®¹é‡å®Œå…¨æœ‰å¯èƒ½å°äºä¸­å‹Regionï¼Œæœ€å°å®¹é‡å¯ä½è‡³4MBã€‚</p>\n</blockquote>\n</li>\n<li class=\"lvl-2\">\n<p>ZGC ç‰¹ç‚¹ï¼š</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-6\">æ”¯æŒæå¤§å †ï¼ˆJDK 15 èµ·æ”¯æŒæœ€é«˜ 16TBï¼‰</li>\n<li class=\"lvl-6\">GC åœé¡¿æ—¶é—´é€šå¸¸ä½äº 1msï¼ˆä¸å †å¤§å°åŸºæœ¬æ— å…³ï¼‰</li>\n<li class=\"lvl-6\">é€‚åˆä½å»¶è¿Ÿã€é«˜ååã€é«˜å¯ç”¨çš„åº”ç”¨åœºæ™¯ï¼Œå¦‚äº¤æ˜“ç³»ç»Ÿã€å¹¿å‘Šæ¨èç­‰</li>\n</ul>\n</li>\n</ul>\n<h5 id=\"ZGC-æ”¶é›†å™¨çš„å·¥ä½œæ–¹å¼\">ZGC æ”¶é›†å™¨çš„å·¥ä½œæ–¹å¼</h5>\n<p><img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/uPic/94yKcU.png\" alt=\"\"></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1ï¸âƒ£ å¹¶å‘æ ‡è®°ï¼ˆConcurrent Markï¼‰ï¼š</span><br><span class=\"line\">   ä¸G1ä¸€æ ·ï¼Œå¹¶å‘æ ‡è®°æ˜¯éå†å¯¹è±¡å›¾åšå¯è¾¾æ€§åˆ†æçš„é˜¶æ®µï¼Œ</span><br><span class=\"line\">   å®ƒçš„åˆå§‹æ ‡è®°(Mark Start)å’Œæœ€ç»ˆæ ‡è®°(Mark End)ä¹Ÿä¼šå‡ºç°çŸ­æš‚çš„åœé¡¿ï¼Œ</span><br><span class=\"line\">   ä¸G1ä¸åŒçš„æ˜¯ï¼ŒZGCçš„æ ‡è®°æ˜¯åœ¨æŒ‡é’ˆä¸Šè€Œä¸æ˜¯åœ¨å¯¹è±¡ä¸Šè¿›è¡Œçš„ï¼Œ</span><br><span class=\"line\">   æ ‡è®°é˜¶æ®µä¼šæ›´æ–°æŸ“è‰²æŒ‡é’ˆä¸­çš„ Marked 0ã€ Marked 1 æ ‡å¿—ä½ã€‚</span><br><span class=\"line\"></span><br><span class=\"line\">2ï¸âƒ£ å¹¶å‘é¢„å¤‡é‡åˆ†é…ï¼ˆConcurrent Prepare <span class=\"keyword\">for</span> Relocateï¼‰ï¼š</span><br><span class=\"line\">   è¿™ä¸ªé˜¶æ®µéœ€è¦æ ¹æ®ç‰¹å®šçš„æŸ¥è¯¢æ¡ä»¶ç»Ÿè®¡å¾—å‡ºæœ¬æ¬¡æ”¶é›†è¿‡ç¨‹è¦æ¸…ç†å“ªäº›Regionï¼Œå°†è¿™äº›Regionç»„æˆé‡åˆ†é…é›†ï¼ˆRelocation Setï¼‰ã€‚</span><br><span class=\"line\">   ZGCæ¯æ¬¡å›æ”¶éƒ½ä¼šæ‰«ææ‰€æœ‰çš„Regionï¼Œç”¨èŒƒå›´æ›´å¤§çš„æ‰«ææˆæœ¬æ¢å–çœå»G1ä¸­è®°å¿†é›†çš„ç»´æŠ¤æˆæœ¬ã€‚</span><br><span class=\"line\"></span><br><span class=\"line\">3ï¸âƒ£ å¹¶å‘é‡åˆ†é…ï¼ˆConcurrent Relocateï¼‰ï¼š</span><br><span class=\"line\">   é‡åˆ†é…æ˜¯ZGCæ‰§è¡Œè¿‡ç¨‹ä¸­çš„æ ¸å¿ƒé˜¶æ®µï¼Œè¿™ä¸ªè¿‡ç¨‹è¦æŠŠé‡åˆ†é…é›†ä¸­çš„å­˜æ´»å¯¹è±¡å¤åˆ¶åˆ°æ–°çš„Regionä¸Šï¼Œ</span><br><span class=\"line\">   å¹¶ä¸ºé‡åˆ†é…é›†ä¸­çš„æ¯ä¸ªRegionç»´æŠ¤ä¸€ä¸ªè½¬å‘è¡¨ï¼ˆForward Tableï¼‰ï¼Œè®°å½•ä»æ—§å¯¹è±¡åˆ°æ–°å¯¹è±¡çš„è½¬å‘å…³ç³»ã€‚</span><br><span class=\"line\">   ZGCæ”¶é›†å™¨èƒ½ä»…ä»å¼•ç”¨ä¸Šå°±æ˜ç¡®å¾—çŸ¥ä¸€ä¸ªå¯¹è±¡æ˜¯å¦å¤„äºé‡åˆ†é…é›†ä¹‹ä¸­ï¼Œå¦‚æœç”¨æˆ·çº¿ç¨‹æ­¤æ—¶å¹¶å‘è®¿é—®äº†ä½äºé‡åˆ†é…é›†ä¸­çš„å¯¹è±¡ï¼Œ</span><br><span class=\"line\">   è¿™æ¬¡è®¿é—®å°†ä¼šè¢«é¢„ç½®çš„å†…å­˜å±éšœ(è¯»å±éšœ)æ‰€æˆªè·ï¼Œç„¶åç«‹å³æ ¹æ®Regionä¸Šçš„è½¬å‘è¡¨è®°å½•å°†è®¿é—®è½¬å‘åˆ°æ–°å¤åˆ¶çš„å¯¹è±¡ä¸Šï¼Œ</span><br><span class=\"line\">   å¹¶åŒæ—¶ä¿®æ­£æ›´æ–°è¯¥å¼•ç”¨çš„å€¼ï¼Œä½¿å…¶ç›´æ¥æŒ‡å‘æ–°å¯¹è±¡ï¼ŒZGCå°†è¿™ç§è¡Œä¸ºç§°ä¸ºæŒ‡é’ˆçš„â€œè‡ªæ„ˆâ€ï¼ˆSelf-Healingï¼‰èƒ½åŠ›ã€‚</span><br><span class=\"line\"></span><br><span class=\"line\">4ï¸âƒ£ å¹¶å‘é‡æ˜ å°„ï¼ˆConcurrent Remapï¼‰ï¼š</span><br><span class=\"line\">   é‡æ˜ å°„æ‰€åšçš„å°±æ˜¯ä¿®æ­£æ•´ä¸ªå †ä¸­æŒ‡å‘é‡åˆ†é…é›†ä¸­æ—§å¯¹è±¡çš„æ‰€æœ‰å¼•ç”¨ï¼Œä½†æ˜¯ZGCä¸­å¯¹è±¡å¼•ç”¨å­˜åœ¨â€œè‡ªæ„ˆâ€åŠŸèƒ½ï¼Œæ‰€ä»¥è¿™ä¸ªé‡æ˜ å°„æ“ä½œå¹¶ä¸æ˜¯å¾ˆè¿«åˆ‡ã€‚</span><br><span class=\"line\">   ZGCå¾ˆå·§å¦™åœ°æŠŠå¹¶å‘é‡æ˜ å°„é˜¶æ®µï¼ˆConcurrent Remapï¼‰è¦åšçš„å·¥ä½œï¼Œåˆå¹¶åˆ°äº†ä¸‹ä¸€æ¬¡åƒåœ¾æ”¶é›†å¾ªç¯ä¸­çš„å¹¶å‘æ ‡è®°é˜¶æ®µï¼ˆConcurrent Markï¼‰é‡Œå»å®Œæˆï¼Œ</span><br><span class=\"line\">   åæ­£å®ƒä»¬éƒ½æ˜¯è¦éå†æ‰€æœ‰å¯¹è±¡çš„ï¼Œè¿™æ ·åˆå¹¶å°±èŠ‚çœäº†ä¸€æ¬¡éå†å¯¹è±¡å›¾çš„å¼€é”€ã€‚</span><br><span class=\"line\">   ä¸€æ—¦æ‰€æœ‰æŒ‡é’ˆéƒ½è¢«ä¿®æ­£ä¹‹åï¼Œ åŸæ¥è®°å½•æ–°æ—§å¯¹è±¡å…³ç³»çš„è½¬å‘è¡¨å°±å¯ä»¥é‡Šæ”¾æ‰äº†ã€‚</span><br></pre></td></tr></table></figure>\n<h5 id=\"ZGCå­˜åœ¨çš„é—®é¢˜\">ZGCå­˜åœ¨çš„é—®é¢˜</h5>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ZGCæœ€å¤§çš„é—®é¢˜æ˜¯<code>æµ®åŠ¨åƒåœ¾</code>ã€‚ZGCçš„åœé¡¿æ—¶é—´æ˜¯åœ¨10msä»¥ä¸‹ï¼Œä½†æ˜¯ZGCçš„æ‰§è¡Œæ—¶é—´è¿˜æ˜¯è¿œè¿œå¤§äºè¿™ä¸ªæ—¶é—´çš„ã€‚å‡å¦‚ZGCå…¨è¿‡ç¨‹éœ€è¦æ‰§è¡Œ10åˆ†é’Ÿï¼Œåœ¨è¿™ä¸ªæœŸé—´ç”±äºå¯¹è±¡åˆ†é…é€Ÿç‡å¾ˆé«˜ï¼Œå°†åˆ›å»ºå¤§é‡çš„æ–°å¯¹è±¡ï¼Œè¿™äº›å¯¹è±¡å¾ˆéš¾è¿›å…¥å½“æ¬¡GCï¼Œæ‰€ä»¥åªèƒ½åœ¨ä¸‹æ¬¡GCçš„æ—¶å€™è¿›è¡Œå›æ”¶ï¼Œè¿™äº›åªèƒ½ç­‰åˆ°ä¸‹æ¬¡GCæ‰èƒ½å›æ”¶çš„å¯¹è±¡å°±æ˜¯æµ®åŠ¨åƒåœ¾ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ZGCæ²¡æœ‰åˆ†ä»£æ¦‚å¿µï¼Œæ¯æ¬¡éƒ½éœ€è¦è¿›è¡Œå…¨å †æ‰«æï¼Œå¯¼è‡´ä¸€äº›â€œæœç”Ÿå¤•æ­»â€çš„å¯¹è±¡æ²¡èƒ½åŠæ—¶çš„è¢«å›æ”¶ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ç›®å‰å”¯ä¸€çš„åŠæ³•æ˜¯å¢å¤§å †çš„å®¹é‡ï¼Œä½¿å¾—ç¨‹åºå¾—åˆ°æ›´å¤šçš„å–˜æ¯æ—¶é—´ï¼Œä½†æ˜¯è¿™ä¸ªä¹Ÿæ˜¯ä¸€ä¸ªæ²»æ ‡ä¸æ²»æœ¬çš„æ–¹æ¡ˆã€‚å¦‚æœéœ€è¦ä»æ ¹æœ¬ä¸Šè§£å†³è¿™ä¸ªé—®é¢˜ï¼Œè¿˜æ˜¯éœ€è¦å¼•å…¥åˆ†ä»£æ”¶é›†ï¼Œè®©æ–°ç”Ÿå¯¹è±¡éƒ½åœ¨ä¸€ä¸ªä¸“é—¨çš„åŒºåŸŸä¸­åˆ›å»ºï¼Œç„¶åä¸“é—¨é’ˆå¯¹è¿™ä¸ªåŒºåŸŸè¿›è¡Œæ›´é¢‘ç¹ã€æ›´å¿«çš„æ”¶é›†ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>JDK21æ­£å¼å¼•å…¥äº†åˆ†ä»£ï¼ˆjdk17æ˜¯é¢„è§ˆç‰ˆï¼‰ï¼Œå¯ä»¥åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨ï¼Œéœ€è¦æ‰‹åŠ¨å¼€å¯ï¼š<code>-XX:+ZGenerational</code></p>\n</li>\n</ul>\n<h5 id=\"ZGC-æ”¶é›†å™¨å‚æ•°é…ç½®è¡¨\">ZGC æ”¶é›†å™¨å‚æ•°é…ç½®è¡¨</h5>\n<table>\n<thead>\n<tr>\n<th>å‚æ•°å</th>\n<th>è¯´æ˜</th>\n<th>é»˜è®¤å€¼ï¼ˆå¦‚æœªç‰¹æ®Šæ ‡æ³¨ï¼‰</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>-XX:+UseZGC</code></td>\n<td>å¯ç”¨ ZGC åƒåœ¾æ”¶é›†å™¨</td>\n<td>-</td>\n</tr>\n<tr>\n<td><code>-XX:+UnlockExperimentalVMOptions</code></td>\n<td>è§£é”å®éªŒæ€§å‚æ•°ï¼ˆJDK 11~14 ä½¿ç”¨ ZGC å¿…é¡»ï¼‰</td>\n<td>-</td>\n</tr>\n<tr>\n<td><code>-XX:+UseLargePages</code></td>\n<td>å¯ç”¨å¤§é¡µå†…å­˜ï¼ˆæ€§èƒ½ä¼˜åŒ–ï¼‰</td>\n<td>false</td>\n</tr>\n<tr>\n<td><code>-XX:+UseTransparentHugePages</code></td>\n<td>å¯ç”¨é€æ˜å¤§é¡µï¼ˆéƒ¨åˆ† Linux ä¸Šå¯ç»“åˆä½¿ç”¨ï¼‰</td>\n<td>false</td>\n</tr>\n<tr>\n<td><code>-Xmx</code> / <code>-Xms</code></td>\n<td>è®¾ç½®æœ€å¤§/åˆå§‹å †å¤§å°</td>\n<td>ç”¨æˆ·é…ç½®</td>\n</tr>\n<tr>\n<td><code>-XX:ZUncommitDelay=&lt;ç§’&gt;</code></td>\n<td>æœªä½¿ç”¨å†…å­˜é‡Šæ”¾å›æ“ä½œç³»ç»Ÿçš„å»¶è¿Ÿæ—¶é—´ï¼ˆZGC ä¼šè‡ªåŠ¨é‡Šæ”¾å†…å­˜ï¼‰</td>\n<td>300ï¼ˆ5åˆ†é’Ÿï¼‰</td>\n</tr>\n<tr>\n<td><code>-XX:SoftMaxHeapSize=&lt;å¤§å°&gt;</code></td>\n<td>è½¯æœ€å¤§å †ï¼ˆSoft Heap Limitï¼‰ï¼šZGC å°è¯•å°†ä½¿ç”¨çš„å †æ§åˆ¶åœ¨è¯¥å€¼ä»¥å†…</td>\n<td>é»˜è®¤ç­‰äº -Xmx</td>\n</tr>\n<tr>\n<td><code>-XX:MaxHeapFreeRatio</code></td>\n<td>æœ€å¤§å †ç©ºé—²æ¯”ä¾‹ï¼ˆè¶…è¿‡æ­¤æ¯”ä¾‹å¯èƒ½è§¦å‘å†…å­˜é‡Šæ”¾ï¼‰</td>\n<td>70</td>\n</tr>\n<tr>\n<td><code>-XX:MinHeapFreeRatio</code></td>\n<td>æœ€å°å †ç©ºé—²æ¯”ä¾‹ï¼ˆä½äºæ­¤æ¯”ä¾‹å¯èƒ½è§¦å‘æ‰©å®¹ï¼‰</td>\n<td>40</td>\n</tr>\n<tr>\n<td><code>-XX:+ZGenerational</code></td>\n<td>å¯ç”¨ ZGC åˆ†ä»£æ”¶é›†ï¼ˆä» JDK 21 èµ·æ”¯æŒï¼Œé»˜è®¤å…³é—­ï¼‰</td>\n<td>falseï¼ˆJDK 21+ï¼‰</td>\n</tr>\n<tr>\n<td><code>-XX:+PrintGC</code> / <code>-Xlog:gc*</code></td>\n<td>å¼€å¯ GC æ—¥å¿—è¾“å‡º</td>\n<td>-</td>\n</tr>\n<tr>\n<td><code>-XX:+ZProactive</code></td>\n<td>ä¸»åŠ¨å›æ”¶ç­–ç•¥ï¼ˆåœ¨ç³»ç»Ÿç©ºé—²æ—¶å°è¯•å›æ”¶ï¼‰</td>\n<td>true</td>\n</tr>\n<tr>\n<td><code>-XX:ZCollectionInterval=&lt;ç§’&gt;</code></td>\n<td>ä¸»åŠ¨å›æ”¶ä¹‹é—´çš„æœ€å°æ—¶é—´é—´éš”ï¼ˆé…åˆ ZProactiveï¼‰</td>\n<td>é»˜è®¤å€¼å› ç‰ˆæœ¬è€Œå¼‚</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"ZGC-vs-G1-GC-vs-Parallel-GC-å¯¹æ¯”è¡¨\">ZGC vs G1 GC vs Parallel GC å¯¹æ¯”è¡¨</h3>\n<table>\n<thead>\n<tr>\n<th>ç‰¹æ€§</th>\n<th><strong>ZGC</strong></th>\n<th><strong>G1 GC</strong></th>\n<th><strong>Parallel GC</strong></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>è®¾è®¡ç›®æ ‡</strong></td>\n<td><strong>æä½å»¶è¿Ÿ</strong>ï¼Œ&lt;1ms åœé¡¿</td>\n<td>å¹³è¡¡ <strong>ä½å»¶è¿Ÿ</strong> ä¸ <strong>é«˜åå</strong></td>\n<td><strong>é«˜åå</strong>ï¼Œæœ€å¤§åŒ– CPU ä½¿ç”¨</td>\n</tr>\n<tr>\n<td><strong>GC åœé¡¿æ—¶é—´</strong></td>\n<td>&lt;1msï¼Œå †å¤§å°å¢åŠ ä¸å½±å“åœé¡¿æ—¶é—´</td>\n<td>å‡ ååˆ°å‡ ç™¾æ¯«ç§’ï¼Œå †è¶Šå¤§åœé¡¿è¶Šæ˜æ˜¾</td>\n<td>åœé¡¿æ—¶é—´å¯èƒ½è¾¾åˆ°ç§’çº§ï¼Œ<strong>å †è¶Šå¤§è¶Šæ˜æ˜¾</strong></td>\n</tr>\n<tr>\n<td><strong>å †å¤§å°æ”¯æŒ</strong></td>\n<td>æ”¯æŒé«˜è¾¾ <strong>16TB</strong>ï¼ˆJDK 15+ï¼‰</td>\n<td>æ”¯æŒ <strong>æœ€å¤š 4TB</strong></td>\n<td>æ”¯æŒå¤§å †ï¼Œä½†åœé¡¿æ˜æ˜¾</td>\n</tr>\n<tr>\n<td><strong>æ˜¯å¦åˆ†ä»£</strong></td>\n<td>é»˜è®¤ä¸åˆ†ä»£ï¼ˆJDK 21+ å¯å¼€å¯ <code>-XX:+ZGenerational</code>ï¼‰</td>\n<td>åˆ†ä»£ï¼ˆæ–°ç”Ÿä»£ + è€å¹´ä»£ï¼‰</td>\n<td>åˆ†ä»£ï¼ˆæ–°ç”Ÿä»£ + è€å¹´ä»£ï¼‰</td>\n</tr>\n<tr>\n<td><strong>å¹¶å‘å›æ”¶</strong></td>\n<td>æ˜¯ï¼Œ<strong>åŒ…æ‹¬æ ‡è®°ã€å‹ç¼©ã€å¼•ç”¨å¤„ç†éƒ½å¹¶å‘</strong></td>\n<td>éƒ¨åˆ†å¹¶å‘ï¼Œä»åŒ…å«æ˜æ˜¾ Stop-The-World é˜¶æ®µ</td>\n<td>å¦ï¼Œ<strong>å…¨éƒ¨ Stop-The-World</strong></td>\n</tr>\n<tr>\n<td><strong>ç§»åŠ¨å¯¹è±¡æ—¶æ˜¯å¦åœé¡¿</strong></td>\n<td>å¦ï¼Œä½¿ç”¨è¯»å±éšœå¹¶å‘è½¬ç§»å¯¹è±¡</td>\n<td>æ˜¯ï¼ˆé€šè¿‡å¤åˆ¶åŒºåŸŸï¼‰</td>\n<td>æ˜¯</td>\n</tr>\n<tr>\n<td><strong>å®ç°æœºåˆ¶</strong></td>\n<td>æ ‡è®°-é‡å®šä½ï¼ŒåŸºäºè¯»å±éšœ</td>\n<td>Region åˆ†åŒº + æ ‡è®°-å¤åˆ¶ + Mixed GC</td>\n<td>æ ‡è®°-å¤åˆ¶ï¼ˆæ–°ç”Ÿä»£ï¼‰ã€æ ‡è®°-æ•´ç†ï¼ˆè€å¹´ä»£ï¼‰</td>\n</tr>\n<tr>\n<td><strong>ååèƒ½åŠ›</strong></td>\n<td>ä¸­é«˜</td>\n<td>é«˜</td>\n<td><strong>æœ€é«˜</strong></td>\n</tr>\n<tr>\n<td><strong>é€‚ç”¨åœºæ™¯</strong></td>\n<td>ä½å»¶è¿Ÿç³»ç»Ÿï¼Œå¦‚é‡‘èã€äº¤æ˜“ã€æ¨èç­‰å®æ—¶åº”ç”¨</td>\n<td>é€šç”¨åå°ç³»ç»Ÿã€Web æœåŠ¡ç­‰</td>\n<td>æ‰¹å¤„ç†ã€æ•°æ®è®¡ç®—ã€æ—¥å¿—åˆ†æç­‰ä¸æ•æ„Ÿäºåœé¡¿çš„ç³»ç»Ÿ</td>\n</tr>\n<tr>\n<td><strong>é»˜è®¤å¯ç”¨</strong></td>\n<td>å¦ï¼Œéœ€æŒ‡å®š <code>-XX:+UseZGC</code></td>\n<td>JDK 9+ é»˜è®¤ GC</td>\n<td>JDK 8 åŠä»¥å‰é»˜è®¤ GC</td>\n</tr>\n<tr>\n<td><strong>è°ƒä¼˜å¤æ‚åº¦</strong></td>\n<td>ä½ï¼Œå¤§å¤šæ•°å‚æ•°å¯çœç•¥</td>\n<td>ä¸­ï¼Œéœ€è¦è®¾ç½®ç›®æ ‡åœé¡¿æ—¶é—´ç­‰</td>\n<td>é«˜ï¼Œéœ€è¦ç²¾ç»†é…ç½® Eden/Survivor ç­‰æ¯”ä¾‹</td>\n</tr>\n<tr>\n<td><strong>GC æ—¥å¿—é…ç½®æ–¹å¼</strong></td>\n<td>ç»Ÿä¸€æ—¥å¿—æ ¼å¼ï¼š<code>-Xlog:gc*</code>ï¼ˆJDK 9+ï¼‰</td>\n<td>æ”¯æŒä¼ ç»Ÿçš„ <code>-XX:+PrintGCDetails</code> å’Œ <code>-Xlog:gc*</code> æ—¥å¿—è¾“å‡º</td>\n<td>ä¸»è¦ä½¿ç”¨æ—§å‚æ•°ï¼š<code>-XX:+PrintGCDetails</code> ç­‰</td>\n</tr>\n</tbody>\n</table>\n<div class=\"tips\">\n<p><em><strong>ZGC ååèƒ½åŠ›è¾ƒå¼±çš„åŸå› </strong></em></p>\n<table>\n<thead>\n<tr>\n<th>åŸå› </th>\n<th>è§£é‡Š</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>1. å¹¶å‘é˜¶æ®µä»£ä»·è¾ƒé«˜</strong></td>\n<td>ZGC å‡ ä¹æ‰€æœ‰çš„ GC å·¥ä½œï¼ˆåŒ…æ‹¬æ ‡è®°ã€æ•´ç†ã€å¼•ç”¨å¤„ç†ã€è½¬ç§»å¯¹è±¡ï¼‰éƒ½åœ¨ä¸åº”ç”¨çº¿ç¨‹å¹¶å‘æ‰§è¡Œã€‚è™½ç„¶å‡å°‘äº†åœé¡¿ï¼Œä½†è¿™äº› GC çº¿ç¨‹ä¸ä¸šåŠ¡çº¿ç¨‹å…±äº« CPU èµ„æºï¼Œ<strong>å¢åŠ äº† CPU ä¸Šä¸‹æ–‡åˆ‡æ¢å’Œç¼“å­˜ç«äº‰</strong>ï¼Œä»è€Œå½±å“ä¸šåŠ¡çº¿ç¨‹çš„æ‰§è¡Œæ•ˆç‡ã€‚</td>\n</tr>\n<tr>\n<td><strong>2. è¯»å±éšœå¼€é”€</strong></td>\n<td>ZGC ä¾èµ–<strong>ç€è‰²æŒ‡é’ˆå’Œè¯»å±éšœï¼ˆload barrierï¼‰æœºåˆ¶</strong>æ¥è·Ÿè¸ªå¯¹è±¡å¼•ç”¨çŠ¶æ€ï¼Œæ”¯æŒå¹¶å‘è½¬ç§»ã€‚è™½ç„¶éå¸¸é«˜æ•ˆï¼Œä½†ä»æ¯”ä¼ ç»Ÿ GC çš„æ™®é€šè¯»å†™è·¯å¾„æ…¢ä¸€äº›ï¼Œåœ¨é«˜é¢‘è®¿é—®å¯¹è±¡åœºæ™¯ä¸‹ä¼šå¸¦æ¥ä¸€å®š CPU å¼€é”€ã€‚</td>\n</tr>\n<tr>\n<td><strong>3. å¯¹ç¡¬ä»¶ä¾èµ–é«˜ï¼Œè°ƒåº¦ä¿å®ˆ</strong></td>\n<td>ä¸ºäº†å®ç°â€œ&lt;1ms åœé¡¿â€çš„ç›®æ ‡ï¼ŒZGC ä¼šé€‰æ‹©æ›´ä¿å®ˆçš„è°ƒåº¦ç­–ç•¥ï¼ˆå¦‚é¿å…å¹¶å‘çº¿ç¨‹ä½¿ç”¨è¿‡å¤š CPUï¼‰ï¼Œè€Œä¸ä¼šåƒ Parallel GC é‚£æ ·â€œæ¦¨å¹²â€æ‰€æœ‰æ ¸å¿ƒèµ„æºã€‚</td>\n</tr>\n<tr>\n<td><strong>4. å†…å­˜å¼€é”€æ›´é«˜</strong></td>\n<td>ä¸ºäº†æ”¯æŒå¹¶å‘å‹ç¼©å’Œè½¬ç§»ï¼ŒZGC é€šå¸¸éœ€è¦ä¸ºæ¯ä¸ªå¯¹è±¡ä¿ç•™å…ƒæ•°æ®å’Œæ›´å¤šçš„è½¬ç§»ç©ºé—´ï¼ˆå³â€œæµ®åŠ¨åƒåœ¾â€åŒºåŸŸï¼‰ï¼Œè¿™å¯èƒ½å¯¼è‡´<strong>é¢‘ç¹çš„ GC å‘¨æœŸ</strong>ï¼Œå½±å“ååã€‚</td>\n</tr>\n<tr>\n<td><strong>5. è®¾è®¡ç›®æ ‡éååä¼˜å…ˆ</strong></td>\n<td>ZGC çš„é¦–è¦ç›®æ ‡æ˜¯<strong>ä½å»¶è¿Ÿè€Œéæœ€å¤§åå</strong>ã€‚ä¸ Parallel GCï¼ˆä»¥ååä¸ºæ ¸å¿ƒï¼‰è®¾è®¡ç›®æ ‡ä¸åŒï¼ŒZGC æ›´é€‚åˆåœºæ™¯ä¸ºâ€œå¯¹å»¶è¿Ÿæ•æ„Ÿä½†ååå¯æ¥å—â€çš„ç³»ç»Ÿã€‚</td>\n</tr>\n</tbody>\n</table>\n<p>æœ€ç³Ÿç³•çš„æƒ…å†µä¸‹ååé‡ä¼šé™ä½15%ã€‚è¿™éƒ½ä¸æ˜¯äº‹ï¼Œåœé¡¿æ—¶é—´è¶³å¤Ÿä¼˜ç§€ã€‚è‡³äºååé‡ï¼Œé€šè¿‡æ‰©å®¹åˆ†åˆ†é’Ÿè§£å†³ã€‚<br>\nå¦å¤–ï¼ŒOracleå®˜æ–¹æåˆ°äº†å®ƒæœ€å¤§çš„ä¼˜ç‚¹æ˜¯ï¼šå®ƒçš„åœé¡¿æ—¶é—´ä¸ä¼šéšç€å †çš„å¢å¤§è€Œå¢é•¿ï¼<br>\nä¹Ÿå°±æ˜¯è¯´ï¼Œå‡ åGå †çš„åœé¡¿æ—¶é—´æ˜¯10msä»¥ä¸‹ï¼Œå‡ ç™¾Gç”šè‡³ä¸ŠTå †çš„åœé¡¿æ—¶é—´ä¹Ÿæ˜¯10msä»¥ä¸‹ã€‚</p>\n<p>ZGC ååå¼±ï¼Œä¸æ˜¯å› ä¸ºæŠ€æœ¯è½åï¼Œè€Œæ˜¯å› ä¸ºå®ƒä¸»åŠ¨é€‰æ‹©åœ¨ä½å»¶è¿Ÿå’Œé«˜ååä¹‹é—´åå‘äº†ä½å»¶è¿Ÿã€‚<br>\nåœ¨å¯¹å“åº”æ—¶é—´è¦æ±‚æé«˜çš„ç³»ç»Ÿä¸­ï¼Œå®ƒæ˜¯éå¸¸åˆé€‚çš„é€‰æ‹©ã€‚<br>\nä½†å¦‚æœä½ çš„ç›®æ ‡æ˜¯å‹æ¦¨æœºå™¨æ€§èƒ½è·‘æ‰¹å¤„ç†ã€æ—¥å¿—åˆ†æè¿™ç±»ååå¯¼å‘å‹ä»»åŠ¡ï¼ŒParallel GC æˆ– G1 ä¼šæ›´åˆé€‚ã€‚</p>\n</div>\n<h2 id=\"å†…å­˜æº¢å‡º-OutOfMemoryErrorï¼Œç®€ç§°-OOM\">å†…å­˜æº¢å‡º(OutOfMemoryErrorï¼Œç®€ç§° OOM)</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>JVM å¸¸è§å†…å­˜æº¢å‡ºç±»å‹æ±‡æ€»è¡¨</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>æº¢å‡ºç±»å‹</th>\n<th>å¼‚å¸¸ä¿¡æ¯</th>\n<th>è§¦å‘åŸå› /æè¿°</th>\n<th>ç›¸å…³å‚æ•°å’Œå»ºè®®é…ç½®</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>å †å†…å­˜æº¢å‡º</strong></td>\n<td><code>java.lang.OutOfMemoryError: Java heap space</code></td>\n<td>- åˆ›å»ºå¤§é‡å¯¹è±¡ï¼Œå †ç©ºé—´ä¸è¶³<br>- å†…å­˜æ³„æ¼ï¼šå¯¹è±¡ä¸å†ä½¿ç”¨å´æœ‰å¼ºå¼•ç”¨<br>- è€å¹´ä»£å¯¹è±¡å¤ªå¤šæ— æ³•æ™‹å‡</td>\n<td><code>-Xms</code> / <code>-Xmx</code> è®¾ç½®å †å¤§å°</td>\n</tr>\n<tr>\n<td><strong>æ ˆæº¢å‡ºï¼ˆé€’å½’ï¼‰</strong></td>\n<td><code>java.lang.StackOverflowError</code></td>\n<td>- æ–¹æ³•æ— é™é€’å½’æˆ–é€’å½’å±‚çº§å¤ªæ·±</td>\n<td><code>-Xss</code> è®¾ç½®çº¿ç¨‹æ ˆå¤§å°</td>\n</tr>\n<tr>\n<td><strong>æ— æ³•åˆ›å»ºæ–°çº¿ç¨‹</strong></td>\n<td><code>java.lang.OutOfMemoryError: unable to create new native thread</code></td>\n<td>- åˆ›å»ºçº¿ç¨‹è¿‡å¤šï¼ˆå¦‚çº¿ç¨‹æ± é…ç½®è¿‡å¤§ï¼‰<br>- ç³»ç»Ÿæˆ– JVM native çº¿ç¨‹èµ„æºè€—å°½</td>\n<td>æ§åˆ¶çº¿ç¨‹æ± å¤§å°ï¼Œé¿å…æ— é™æ–°å»ºçº¿ç¨‹</td>\n</tr>\n<tr>\n<td><strong>å…ƒç©ºé—´æº¢å‡º</strong></td>\n<td><code>java.lang.OutOfMemoryError: Metaspace</code></td>\n<td>- åŠ¨æ€åŠ è½½ç±»è¿‡å¤šï¼ˆå¦‚ä½¿ç”¨ CGLIBã€JSP åŠ¨æ€ç”Ÿæˆç±»ï¼‰<br>- ç±»æ— æ³•å¸è½½ï¼ˆå¦‚ ClassLoader æ³„æ¼ï¼‰</td>\n<td><code>-XX:MetaspaceSize</code> / <code>-XX:MaxMetaspaceSize</code></td>\n</tr>\n<tr>\n<td><strong>ç›´æ¥å†…å­˜æº¢å‡º</strong></td>\n<td><code>java.lang.OutOfMemoryError: Direct buffer memory</code></td>\n<td>- ä½¿ç”¨ <code>ByteBuffer.allocateDirect()</code> åˆ†é…å¤§é‡ç›´æ¥å†…å­˜<br>- Netty ç­‰æ¡†æ¶é»˜è®¤ä½¿ç”¨ç›´æ¥å†…å­˜</td>\n<td><code>-XX:MaxDirectMemorySize</code></td>\n</tr>\n<tr>\n<td><strong>GC å¼€é”€è¿‡é«˜</strong></td>\n<td><code>java.lang.OutOfMemoryError: GC overhead limit exceeded</code></td>\n<td>- JVM èŠ±è´¹ &gt;98% çš„æ—¶é—´ GC ä½†å›æ”¶ &lt;2% çš„å†…å­˜ï¼Œè®¤ä¸ºè¿›å…¥â€œGC æ­»å¾ªç¯â€</td>\n<td>åˆ†æ GC æ—¥å¿—ã€ä¼˜åŒ–å †è®¾ç½®</td>\n</tr>\n<tr>\n<td><strong>ç±»å¸è½½å¤±è´¥ï¼ˆå†…å­˜æ³„æ¼ï¼‰</strong></td>\n<td>ï¼ˆä¸ä¸€å®šæŠ¥é”™ï¼Œä½†å¯èƒ½å¯¼è‡´ Metaspace OOMï¼‰</td>\n<td>- Web å®¹å™¨é¢‘ç¹éƒ¨ç½²çƒ­æ›´æ–° WAR åŒ…æ—¶ï¼ŒClassLoader æ— æ³•å¸è½½ï¼Œå¯¼è‡´ç±»æ°¸ä¹…é©»ç•™</td>\n<td>ä¼˜åŒ– ClassLoader ç®¡ç†ï¼Œä½¿ç”¨å†…å­˜åˆ†æå·¥å…·</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å †å¿«ç…§(å †è½¬å‚¨)æ–‡ä»¶åˆ†æ</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>å‚æ•°</th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>-XX:+HeapDumpOnOutOfMemoryError</code></td>\n<td>OOM æ—¶ç”Ÿæˆå †è½¬å‚¨æ–‡ä»¶ ,å»ºè®®ç”Ÿäº§ç¯å¢ƒå¼€å¯</td>\n</tr>\n<tr>\n<td><code>-XX:HeapDumpPath=xxx.hprof</code></td>\n<td>æŒ‡å®šå †è½¬å‚¨æ–‡ä»¶ä¿å­˜è·¯å¾„ <br> é»˜è®¤ä¿å­˜åœ¨å½“å‰ç›®å½•</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¸¸ç”¨åˆ†æå·¥å…·ä¸å‘½ä»¤</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>å·¥å…·/å‘½ä»¤</th>\n<th>ç®€ä»‹ä¸åŠŸèƒ½</th>\n<th>ä½¿ç”¨è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>MATï¼ˆMemory Analyzer Toolï¼‰</strong></td>\n<td>Eclipse å‡ºå“çš„å¼ºå¤§å›¾å½¢å·¥å…·ï¼Œæ”¯æŒæ³„æ¼åˆ†æã€å¯¹è±¡å¼•ç”¨é“¾åˆ†æã€å†…å­˜å ç”¨ç»Ÿè®¡ç­‰</td>\n<td>ä¸‹è½½åœ°å€ï¼š<br><a href=\"https://www.eclipse.org/mat/\">https://www.eclipse.org/mat/</a><br>æ‰“å¼€åç›´æ¥å¯¼å…¥ <code>.hprof</code> æ–‡ä»¶å³å¯åˆ†æ</td>\n</tr>\n<tr>\n<td><strong>VisualVM</strong></td>\n<td>å®˜æ–¹å¯è§†åŒ– JVM ç›‘æ§å·¥å…·ï¼Œæ”¯æŒå®æ—¶åˆ†æã€GC æŸ¥çœ‹ã€çº¿ç¨‹çŠ¶æ€ä¸å †è½¬å‚¨æŸ¥çœ‹</td>\n<td>é™„å¸¦äº JDKï¼ˆæˆ–å•ç‹¬å®‰è£…ï¼‰ï¼Œæ‰“å¼€ <code>.hprof</code> æ–‡ä»¶è¿›è¡Œå¯è§†åŒ–åˆ†æ</td>\n</tr>\n<tr>\n<td><strong>JProfiler</strong></td>\n<td>å•†ä¸šçº§ Java æ€§èƒ½åˆ†æå·¥å…·ï¼Œæä¾›å †åˆ†æã€CPU åˆ†æã€çº¿ç¨‹åˆ†æç­‰å…¨å¥—åŠŸèƒ½</td>\n<td>æ”¯æŒæ‰“å¼€ <code>.hprof</code> æ–‡ä»¶ï¼Œä¹Ÿå¯åœ¨è¿è¡Œæ—¶é…åˆä½¿ç”¨ï¼ˆéœ€ä»˜è´¹æˆ–è¯•ç”¨ï¼‰</td>\n</tr>\n<tr>\n<td><strong>YourKit</strong></td>\n<td>å•†ä¸šæ€§èƒ½åˆ†æå·¥å…·ï¼Œç•Œé¢å‹å¥½ï¼Œæ”¯æŒä¸°å¯Œçš„åˆ†æåŠŸèƒ½</td>\n<td>æ”¯æŒå †åˆ†æï¼Œé€‚åˆå†…å­˜æ³„æ¼æ’æŸ¥</td>\n</tr>\n<tr>\n<td><strong>jhat</strong>ï¼ˆè¿‡æ—¶ï¼‰</td>\n<td>JDK é™„å¸¦çš„æ—§å·¥å…·ï¼Œç”¨äºåˆ†æ <code>.hprof</code> æ–‡ä»¶ï¼Œå¼€å¯ Web ç•Œé¢æŸ¥çœ‹ï¼ˆå·²åºŸå¼ƒï¼‰</td>\n<td>å‘½ä»¤ï¼š<code>jhat heapdump.hprof</code>ï¼Œæµè§ˆå™¨è®¿é—® <code>http://localhost:7000</code>ï¼ˆJDK 8 åŠä»¥ä¸‹ï¼‰</td>\n</tr>\n<tr>\n<td><strong>jmap</strong></td>\n<td>ç”¨äºç”Ÿæˆå †è½¬å‚¨æ–‡ä»¶æˆ–æŸ¥çœ‹å †å¯¹è±¡ç»Ÿè®¡ä¿¡æ¯ï¼ˆ<strong>ä¸æ˜¯åˆ†æå·¥å…·æœ¬èº«</strong>ï¼‰</td>\n<td>å‘½ä»¤ï¼š<code>jmap -dump:format=b,file=heap.hprof &lt;pid&gt;</code> ç”Ÿæˆè½¬å‚¨ï¼›é…åˆ MAT ä½¿ç”¨</td>\n</tr>\n<tr>\n<td><strong>jcmd</strong></td>\n<td>æ›´ç°ä»£çš„è¯Šæ–­å‘½ä»¤å·¥å…·ï¼Œå¯ç”Ÿæˆ heap dumpã€æ‰§è¡Œ GCã€æ‰“å° VM çŠ¶æ€ç­‰</td>\n<td>å‘½ä»¤ï¼š<code>jcmd &lt;pid&gt; GC.heap_dump heap.hprof</code></td>\n</tr>\n<tr>\n<td><strong><a href=\"http://GCEasy.io\">GCEasy.io</a></strong></td>\n<td>åœ¨çº¿åˆ†æå·¥å…·ï¼Œæ”¯æŒ <code>.hprof</code> æ–‡ä»¶å’Œ GC æ—¥å¿—ä¸Šä¼ åˆ†æ</td>\n<td>ç½‘ç«™ï¼š<a href=\"https://gceasy.io\">https://gceasy.io</a></td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>GCæ—¥å¿—ç›¸å…³å‚æ•°(JDK1.8åŠä»¥ä¸‹)</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>å‚æ•°</th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>-XX:+PrintGC</code></td>\n<td>æ‰“å°åŸºæœ¬ GC ä¿¡æ¯ï¼ˆå»ºè®®é…åˆ <code>-XX:+PrintGCDetails</code> ä½¿ç”¨ï¼‰,ä¸<code>-verbose:gc</code>ç­‰ä»·</td>\n</tr>\n<tr>\n<td><code>-XX:+PrintGCDetails</code></td>\n<td>æ‰“å°è¯¦ç»†çš„ GC æ—¥å¿—ä¿¡æ¯ï¼ˆå¦‚å„åŒºåŸŸä½¿ç”¨æƒ…å†µã€å¯¹è±¡åˆ†é…ã€æ™‹å‡ç­‰ï¼‰</td>\n</tr>\n<tr>\n<td><code>-XX:+PrintGCDateStamps</code></td>\n<td>åœ¨ GC æ—¥å¿—ä¸­æ·»åŠ æ—¥æœŸæ—¶é—´æˆ³</td>\n</tr>\n<tr>\n<td><code>-XX:+PrintGCTimeStamps</code></td>\n<td>åœ¨ GC æ—¥å¿—ä¸­æ·»åŠ  JVM å¯åŠ¨ä»¥æ¥çš„æ—¶é—´æˆ³</td>\n</tr>\n<tr>\n<td><code>-Xloggc:/var/log/myapp/gc.log</code></td>\n<td>å°† GC æ—¥å¿—è¾“å‡ºåˆ°æŒ‡å®šæ–‡ä»¶</td>\n</tr>\n<tr>\n<td><code>-XX:+UseGCLogFileRotation</code></td>\n<td>å¯ç”¨ GC æ—¥å¿—æ–‡ä»¶è½®è½¬ï¼ˆé€‚ç”¨äºå¤§è§„æ¨¡ç³»ç»Ÿçš„ GC æ—¥å¿—ç®¡ç†ï¼‰</td>\n</tr>\n<tr>\n<td><code>-XX:NumberOfGCLogFiles=5</code></td>\n<td>æœ€å¤šä¿ç•™ 5 ä¸ª GC æ—¥å¿—å†å²æ–‡ä»¶</td>\n</tr>\n<tr>\n<td><code>-XX:GCLogFileSize=10M</code></td>\n<td>æ¯ä¸ª GC æ—¥å¿—æ–‡ä»¶æœ€å¤§ä¸º 10MB</td>\n</tr>\n<tr>\n<td><code>-XX:+PrintGCCause</code></td>\n<td>æ‰“å° GC çš„è§¦å‘åŸå› ï¼ˆå¦‚ Minor GCã€System.gc() ç­‰ï¼‰</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>GCæ—¥å¿—ç›¸å…³å‚æ•°(JDK9+)</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-6\"><code>-Xlog</code> æ˜¯ç”¨äºé…ç½® JVM æ—¥å¿—è®°å½•çš„å‚æ•°ï¼Œå®ƒæ˜¯ä» JDK 9 å¼€å§‹å¼•å…¥çš„ç»Ÿä¸€æ—¥å¿—æ¡†æ¶ï¼ˆUnified Loggingï¼‰çš„ä¸€éƒ¨åˆ†ã€‚</li>\n<li class=\"lvl-6\">é€šè¿‡ -Xlog é€‰é¡¹ï¼Œä½ å¯ä»¥æ§åˆ¶æ—¥å¿—çš„ æ ‡ç­¾ï¼ˆtagsï¼‰ã€è¾“å‡ºçº§åˆ«ï¼ˆlevelï¼‰ã€è¾“å‡ºä½ç½®ï¼ˆoutputï¼‰ ç­‰å†…å®¹ã€‚</li>\n<li class=\"lvl-6\">åŸºæœ¬æ ¼å¼</li>\n</ul>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">-Xlog[:[tag1[,tag2...]][[:level][:[output][:[decorators][:rotation]]]]]</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-2\">\n<li class=\"lvl-6\">å¸¸è§ Tagsï¼ˆæ ‡ç­¾ï¼‰</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>ç±»åˆ«</th>\n<th>æ ‡ç­¾</th>\n<th>å«ä¹‰</th>\n<th>ç”¨é€”ç¤ºä¾‹</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>ç±»åŠ è½½</strong></td>\n<td><code>classload</code></td>\n<td>JVM ç±»åŠ è½½æ´»åŠ¨çš„æ€»ä½“ä¿¡æ¯</td>\n<td>è§‚å¯Ÿç±»åŠ è½½å¤±è´¥æˆ–é‡å¤åŠ è½½</td>\n</tr>\n<tr>\n<td></td>\n<td><code>class+load</code></td>\n<td>æ˜¾ç¤ºæ¯ä¸ªç±»åŠ è½½è¿‡ç¨‹ç»†èŠ‚</td>\n<td>å®šä½ç±»åŠ è½½å¼‚å¸¸ã€çƒ­åŠ è½½åˆ†æ</td>\n</tr>\n<tr>\n<td></td>\n<td><code>class+unload</code></td>\n<td>è®°å½•ç±»å¸è½½äº‹ä»¶</td>\n<td>åˆ†æç±»å¸è½½æ—¶æœºæˆ–å†…å­˜é‡Šæ”¾æƒ…å†µ</td>\n</tr>\n<tr>\n<td><strong>åƒåœ¾å›æ”¶</strong></td>\n<td><code>gc</code></td>\n<td>æ€»ä½“ GC æ´»åŠ¨ä¿¡æ¯</td>\n<td>GC è°ƒä¼˜å…¥é—¨ä½¿ç”¨</td>\n</tr>\n<tr>\n<td></td>\n<td><code>gc+start</code></td>\n<td>GC äº‹ä»¶å¼€å§‹æ—¶é—´ä¸ç±»å‹</td>\n<td>æŸ¥çœ‹ GC é¢‘ç‡ä¸è§¦å‘ç‚¹</td>\n</tr>\n<tr>\n<td></td>\n<td><code>gc+heap</code></td>\n<td>GC å‰åçš„å †ä½¿ç”¨æƒ…å†µ</td>\n<td>åˆ†æå †ä½¿ç”¨ä¸åˆ†åŒºå æ¯”</td>\n</tr>\n<tr>\n<td></td>\n<td><code>gc+phases</code></td>\n<td>GC å†…éƒ¨é˜¶æ®µç»†èŠ‚</td>\n<td>G1/ZGC ç­‰è°ƒè¯•ç”¨</td>\n</tr>\n<tr>\n<td></td>\n<td><code>gc+age</code></td>\n<td>å¹´é¾„åˆ†å¸ƒæƒ…å†µ</td>\n<td>åˆ¤æ–­å¯¹è±¡æ™‹å‡è·¯å¾„ã€è€å¹´ä»£å‹åŠ›</td>\n</tr>\n<tr>\n<td></td>\n<td><code>gc+ergo</code></td>\n<td>GC çš„è‡ªé€‚åº”è°ƒæ•´å†³ç­–</td>\n<td>æŸ¥çœ‹çº¿ç¨‹ã€å †å¤§å°è‡ªåŠ¨è°ƒæ•´é€»è¾‘</td>\n</tr>\n<tr>\n<td><strong>JIT ç¼–è¯‘</strong></td>\n<td><code>jit</code></td>\n<td>JIT ç¼–è¯‘æ—¥å¿—å…¥å£</td>\n<td>æ€§èƒ½çƒ­ç‚¹æ–¹æ³•åˆ†æ</td>\n</tr>\n<tr>\n<td></td>\n<td><code>compiler</code></td>\n<td>æ˜¾ç¤ºæ–¹æ³•ç¼–è¯‘ã€æ—¶é—´ç­‰</td>\n<td>åˆ¤æ–­æ˜¯å¦æœ‰æ–¹æ³•æœªè¢«ä¼˜åŒ–</td>\n</tr>\n<tr>\n<td></td>\n<td><code>codecache</code></td>\n<td>å·²ç¼–è¯‘ä»£ç å­˜å‚¨åŒºä½¿ç”¨æƒ…å†µ</td>\n<td>åˆ¤æ–­æ˜¯å¦è¾¾åˆ°ç¼“å­˜ä¸Šé™</td>\n</tr>\n<tr>\n<td></td>\n<td><code>nmethod</code></td>\n<td>JIT ç”Ÿæˆçš„ native æ–¹æ³•ç”Ÿå‘½å‘¨æœŸ</td>\n<td>è§‚å¯Ÿ native ä»£ç ç”Ÿæˆä¸å¸è½½</td>\n</tr>\n<tr>\n<td><strong>å†…å­˜</strong></td>\n<td><code>memory</code></td>\n<td>æ€»ä½“å†…å­˜ä½¿ç”¨æƒ…å†µ</td>\n<td>è¯Šæ–­å†…å­˜æ³„æ¼æˆ–æº¢å‡º</td>\n</tr>\n<tr>\n<td></td>\n<td><code>gc+heap</code></td>\n<td>å †ç»“æ„ä¸å ç”¨æƒ…å†µ</td>\n<td>ä¸ GC è”åˆåˆ†æä½¿ç”¨</td>\n</tr>\n<tr>\n<td></td>\n<td><code>os+memory</code></td>\n<td>JVM ä¸æ“ä½œç³»ç»Ÿé—´çš„å†…å­˜äº¤äº’</td>\n<td>åˆ¤æ–­æ˜¯å¦ç³»ç»Ÿå±‚å†…å­˜ç”³è¯·å¤±è´¥</td>\n</tr>\n<tr>\n<td><strong>çº¿ç¨‹</strong></td>\n<td><code>thread</code></td>\n<td>çº¿ç¨‹çš„åˆ›å»ºã€ç»ˆæ­¢ã€çŠ¶æ€å˜åŒ–</td>\n<td>çº¿ç¨‹æ³„æ¼æˆ–é¢‘ç¹åˆ›å»ºæ’æŸ¥</td>\n</tr>\n<tr>\n<td></td>\n<td><code>safepoint</code></td>\n<td>JVM è¿›å…¥/é€€å‡º safepoint çš„ä¿¡æ¯</td>\n<td>åˆ†æ STW åœé¡¿æ—¶é—´ä¸é¢‘ç‡</td>\n</tr>\n<tr>\n<td><strong>é”ä¸åŒæ­¥</strong></td>\n<td><code>synchronization</code></td>\n<td>é”ç«äº‰ã€è·å–å’Œé‡Šæ”¾ä¿¡æ¯</td>\n<td>åˆ†ææ€§èƒ½ç“¶é¢ˆä¸­çš„é”äº‰ç”¨</td>\n</tr>\n<tr>\n<td></td>\n<td><code>monitorinflation</code></td>\n<td>è½»é‡çº§é”å‡çº§ä¸ºé‡é‡çº§é”è¿‡ç¨‹</td>\n<td>æ’æŸ¥é”è†¨èƒ€å¯¼è‡´çš„å»¶è¿Ÿé—®é¢˜</td>\n</tr>\n<tr>\n<td><strong>æ“ä½œç³»ç»Ÿäº¤äº’</strong></td>\n<td><code>os</code></td>\n<td>JVM ä¸æ“ä½œç³»ç»Ÿäº¤äº’æ—¥å¿—</td>\n<td>å¸¸è§„ç³»ç»Ÿèµ„æºè¯·æ±‚ä¿¡æ¯</td>\n</tr>\n<tr>\n<td></td>\n<td><code>os+thread</code></td>\n<td>OS å±‚çº§çº¿ç¨‹ç®¡ç†ä¿¡æ¯</td>\n<td>é«˜å¹¶å‘æ—¶çº¿ç¨‹ç»‘å®šä¸è°ƒåº¦åˆ†æ</td>\n</tr>\n<tr>\n<td></td>\n<td><code>os+cpu</code></td>\n<td>CPU ä½¿ç”¨ä¸åˆ†å¸ƒæƒ…å†µ</td>\n<td>æ’æŸ¥é«˜ CPU ä½¿ç”¨çš„é—®é¢˜</td>\n</tr>\n<tr>\n<td><strong>ç±»å…ƒæ•°æ®</strong></td>\n<td><code>metaspace</code></td>\n<td>å…ƒç©ºé—´å†…å­˜ä½¿ç”¨ä¸å˜åŒ–</td>\n<td>æ’æŸ¥ Metaspace OOM</td>\n</tr>\n<tr>\n<td></td>\n<td><code>cds</code></td>\n<td>ç±»å…±äº«æ•°æ®ï¼ˆCDSï¼‰æ—¥å¿—</td>\n<td>åˆ†æç±»åŠ è½½åŠ é€Ÿæ˜¯å¦ç”Ÿæ•ˆ</td>\n</tr>\n<tr>\n<td><strong>å®‰å…¨</strong></td>\n<td><code>security</code></td>\n<td>å®‰å…¨ç›¸å…³æ“ä½œæ—¥å¿—</td>\n<td>æƒé™æ£€æŸ¥å¤±è´¥ã€å¯†é’¥åŠ è½½ç­‰è°ƒè¯•</td>\n</tr>\n<tr>\n<td></td>\n<td><code>module</code></td>\n<td>æ¨¡å—ç³»ç»Ÿï¼ˆJPMSï¼‰ç›¸å…³æ—¥å¿—</td>\n<td>æ¨¡å—è®¿é—®æ§åˆ¶å¤±è´¥åˆ†æ</td>\n</tr>\n<tr>\n<td><strong>å…¶ä»–</strong></td>\n<td><code>start</code></td>\n<td>JVM å¯åŠ¨æµç¨‹æ—¥å¿—</td>\n<td>å¯åŠ¨é˜¶æ®µæ…¢ã€å‡ºé”™æ—¶ä½¿ç”¨</td>\n</tr>\n<tr>\n<td></td>\n<td><code>init</code></td>\n<td>å„å­ç³»ç»Ÿåˆå§‹åŒ–è¿‡ç¨‹</td>\n<td>å®šä½å­ç³»ç»Ÿå¯åŠ¨é¡ºåºä¸å¼‚å¸¸</td>\n</tr>\n<tr>\n<td></td>\n<td><code>jni</code></td>\n<td>Java è°ƒç”¨ native æ–¹æ³•æ—¥å¿—</td>\n<td>JNI å´©æºƒã€æ€§èƒ½é—®é¢˜åˆ†æ</td>\n</tr>\n<tr>\n<td></td>\n<td><code>classpath</code></td>\n<td>ç±»è·¯å¾„åŠ è½½è¯¦æƒ…</td>\n<td>ç±»æ‰¾ä¸åˆ°ã€è·¯å¾„å†²çªç­‰é—®é¢˜æ’æŸ¥</td>\n</tr>\n<tr>\n<td></td>\n<td><code>exceptions</code></td>\n<td>å¼‚å¸¸ä¿¡æ¯åŠå †æ ˆæ‰“å°</td>\n<td>æ•è·æœªå¤„ç†å¼‚å¸¸ã€é¢‘ç¹æŠ›é”™åˆ†æ</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-2\">\n<li class=\"lvl-6\">\n<p>Levelï¼ˆçº§åˆ«ï¼‰</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>ç­‰çº§</th>\n<th>å«ä¹‰è¯´æ˜</th>\n<th>ç”¨é€”ç¤ºä¾‹</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>off</code></td>\n<td>å…³é—­æ—¥å¿—è®°å½•</td>\n<td>å®Œå…¨ç¦ç”¨æŒ‡å®šæ ‡ç­¾çš„æ—¥å¿—è¾“å‡º</td>\n</tr>\n<tr>\n<td><code>error</code></td>\n<td>ä¸¥é‡é”™è¯¯ï¼Œä»…è®°å½•å½±å“ç³»ç»Ÿè¿è¡Œçš„é”™è¯¯ä¿¡æ¯</td>\n<td>æ•è·å´©æºƒã€ä¸¥é‡æ•…éšœ</td>\n</tr>\n<tr>\n<td><code>warning</code></td>\n<td>æ½œåœ¨é—®é¢˜ï¼Œå¯èƒ½å½±å“ç¨³å®šæ€§</td>\n<td>è®°å½•å¯èƒ½çš„å†…å­˜ã€é…ç½®é—®é¢˜</td>\n</tr>\n<tr>\n<td><code>info</code></td>\n<td>å¸¸è§„ä¿¡æ¯ï¼ˆé»˜è®¤çº§åˆ«ï¼‰</td>\n<td>æ—¥å¸¸è¿è¡Œæ—¥å¿—ï¼Œå¦‚ GC æ¬¡æ•°</td>\n</tr>\n<tr>\n<td><code>debug</code></td>\n<td>æ›´è¯¦ç»†çš„è°ƒè¯•ä¿¡æ¯ï¼Œé€‚ç”¨äºé—®é¢˜è¯Šæ–­</td>\n<td>è·Ÿè¸ªè¡Œä¸ºå˜åŒ–æˆ–ä»£ç è·¯å¾„</td>\n</tr>\n<tr>\n<td><code>trace</code></td>\n<td>æœ€è¯¦ç»†çš„ä¿¡æ¯ï¼Œè®°å½•å‡ ä¹æ‰€æœ‰ç»†èŠ‚</td>\n<td>æ·±åº¦è°ƒè¯•ï¼Œå¦‚æ–¹æ³•çº§åˆ«è·Ÿè¸ª</td>\n</tr>\n<tr>\n<td><code>all</code></td>\n<td>æ‰“å°æ‰€æœ‰çº§åˆ«çš„æ—¥å¿—ï¼ˆåŒ…æ‹¬ trace åŠä»¥ä¸Šï¼‰</td>\n<td>å…¨é‡æ—¥å¿—è¾“å‡ºï¼Œç”¨äºå®Œå…¨ç›‘æ§</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-2\">\n<li class=\"lvl-6\">\n<p>Outputï¼ˆè¾“å‡ºä½ç½®ï¼‰</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>è¾“å‡ºä½ç½®</th>\n<th>å«ä¹‰è¯´æ˜</th>\n<th>ç¤ºä¾‹ç”¨æ³•</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>stdout</code></td>\n<td>æ ‡å‡†è¾“å‡ºï¼ˆé»˜è®¤ï¼‰</td>\n<td><code>-Xlog:gc=info:stdout</code></td>\n</tr>\n<tr>\n<td><code>stderr</code></td>\n<td>æ ‡å‡†é”™è¯¯è¾“å‡º</td>\n<td><code>-Xlog:gc=info:stderr</code></td>\n</tr>\n<tr>\n<td><code>file=è·¯å¾„</code></td>\n<td>è¾“å‡ºåˆ°æŒ‡å®šæ–‡ä»¶è·¯å¾„ï¼ˆè‡ªåŠ¨åˆ›å»ºæ–‡ä»¶ï¼‰</td>\n<td><code>-Xlog:gc:file=gc.log</code></td>\n</tr>\n<tr>\n<td>å¤šä¸ªè¾“å‡ºç”¨é€—å·åˆ†éš”</td>\n<td>å¯åŒæ—¶è¾“å‡ºåˆ°å¤šä¸ªä½ç½®</td>\n<td><code>-Xlog:gc:file=gc.log,stdout</code></td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-2\">\n<li class=\"lvl-6\">\n<p>Decoratorsï¼ˆè£…é¥°å™¨ï¼‰</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>è£…é¥°å™¨</th>\n<th>å«ä¹‰è¯´æ˜</th>\n<th>ç¤ºä¾‹è¾“å‡ºç‰‡æ®µï¼ˆå«è¯¥è£…é¥°å™¨æ—¶ï¼‰</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>time</code></td>\n<td>æ˜¾ç¤ºå½“å‰ç³»ç»Ÿæ—¶é—´ï¼ˆwall-clock timeï¼‰</td>\n<td><code>2025-05-16T10:45:12.123+0800</code></td>\n</tr>\n<tr>\n<td><code>uptime</code></td>\n<td>æ˜¾ç¤º JVM å¯åŠ¨ä»¥æ¥çš„è¿è¡Œæ—¶é—´ï¼ˆæ¯«ç§’ï¼‰</td>\n<td><code>5.123s</code>ï¼ˆè¡¨ç¤ºå·²è¿è¡Œ 5.123 ç§’ï¼‰</td>\n</tr>\n<tr>\n<td><code>level</code></td>\n<td>æ˜¾ç¤ºæ—¥å¿—çº§åˆ«ï¼ˆå¦‚ info, warning ç­‰ï¼‰</td>\n<td><code>[info]</code>, <code>[debug]</code></td>\n</tr>\n<tr>\n<td><code>tags</code></td>\n<td>æ˜¾ç¤ºæ—¥å¿—æ ‡ç­¾</td>\n<td><code>[gc]</code>, <code>[class,load]</code></td>\n</tr>\n<tr>\n<td><code>tid</code></td>\n<td>æ˜¾ç¤ºçº¿ç¨‹ ID</td>\n<td><code>tid=0x00007fddc4012800</code></td>\n</tr>\n<tr>\n<td><code>hostname</code></td>\n<td>æ˜¾ç¤ºä¸»æœºå</td>\n<td><code>host=example.local</code></td>\n</tr>\n<tr>\n<td><code>pid</code></td>\n<td>æ˜¾ç¤ºå½“å‰ JVM è¿›ç¨‹ ID</td>\n<td><code>pid=12345</code></td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-2\">\n<li class=\"lvl-6\">\n<p>Rotation (æ—¥å¿—è½®è½¬è®¾ç½®)</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>è®¾ç½®å‚æ•°</th>\n<th>å«ä¹‰è¯´æ˜</th>\n<th>ç¤ºä¾‹å€¼</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>filecount=n</code></td>\n<td>ä¿ç•™çš„æ—¥å¿—æ–‡ä»¶æ•°é‡ï¼ˆæœ€å¤§æ–‡ä»¶è½®è½¬æ•°ï¼‰</td>\n<td><code>filecount=5</code></td>\n</tr>\n<tr>\n<td><code>filesize=n</code></td>\n<td>å•ä¸ªæ—¥å¿—æ–‡ä»¶çš„æœ€å¤§å¤§å°ï¼ˆæ”¯æŒå•ä½ï¼šk/m/gï¼‰</td>\n<td><code>filesize=10m</code></td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-2\">\n<li class=\"lvl-6\">\n<p>ç¤ºä¾‹ï¼š</p>\n</li>\n</ul>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">-Xlog:gc*:file=/var/log/app/gc.log:time,<span class=\"built_in\">uptime</span>,level,tags:filecount=5,filesize=20M</span><br></pre></td></tr></table></figure>\n<table>\n<thead>\n<tr>\n<th>é¡¹</th>\n<th>å€¼</th>\n<th>å«ä¹‰</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>tag</code></td>\n<td><code>gc*</code></td>\n<td>åŒ¹é…æ‰€æœ‰ä»¥ <code>gc</code> å¼€å¤´çš„æ ‡ç­¾ï¼ˆå¦‚ <code>gc+heap</code> ç­‰ï¼‰</td>\n</tr>\n<tr>\n<td><code>level</code></td>\n<td><em>çœç•¥</em></td>\n<td>é»˜è®¤æ˜¯ <code>info</code></td>\n</tr>\n<tr>\n<td><code>output</code></td>\n<td><code>file=/var/log/app/gc.log</code></td>\n<td>æ—¥å¿—å†™å…¥è¯¥æ–‡ä»¶</td>\n</tr>\n<tr>\n<td><code>decorators</code></td>\n<td><code>time,uptime,level,tags</code></td>\n<td>æ—¥å¿—å‰ç¼€åŒ…å«æ—¶é—´ã€å¯åŠ¨æ—¶é—´ã€æ—¥å¿—çº§åˆ«ã€æ ‡ç­¾</td>\n</tr>\n<tr>\n<td><code>rotation</code></td>\n<td><code>filecount=5,filesize=20M</code></td>\n<td>æœ€å¤šä¿ç•™ 5 ä¸ªæ—¥å¿—æ–‡ä»¶ï¼Œå•ä¸ªæ–‡ä»¶æœ€å¤§ 20MB</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-2\">\n<li class=\"lvl-6\">\n<p>æ—¥å¿—æ–‡ä»¶ä¸­å¯ä»¥ä½¿ç”¨å˜é‡</p>\n</li>\n</ul>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">-Xlog:gc*:file=gc_%p_%t.log</span><br></pre></td></tr></table></figure>\n<p><strong>å¸¸ç”¨å˜é‡è¡¨</strong></p>\n<table>\n<thead>\n<tr>\n<th>å˜é‡</th>\n<th>å«ä¹‰</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>%p</td>\n<td>è¿›ç¨‹IDï¼ˆProcess IDï¼‰</td>\n</tr>\n<tr>\n<td>%t</td>\n<td>æ—¶é—´æˆ³ï¼ˆä»£è¡¨æ—¥å¿—æ–‡ä»¶åˆ›å»ºæ—¶çš„æ—¶é—´æˆ³ï¼‰</td>\n</tr>\n<tr>\n<td>%h</td>\n<td>ä¸»æœºåï¼ˆHostnameï¼‰</td>\n</tr>\n<tr>\n<td>%n</td>\n<td>åºåˆ—å·ï¼Œä»0å¼€å§‹ï¼Œæ¯åˆ›å»ºæ–°æ–‡ä»¶åŠ 1</td>\n</tr>\n<tr>\n<td>%u</td>\n<td>å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œç”¨äºè§£å†³æ–‡ä»¶åå†²çª</td>\n</tr>\n<tr>\n<td>%i</td>\n<td>å½“å¤šä¸ªJVMè¿›ç¨‹ä½¿ç”¨ç›¸åŒçš„æ–‡ä»¶åæ¨¡å¼æ—¶çš„åŒºåˆ†è®¡æ•°å™¨</td>\n</tr>\n</tbody>\n</table>\n<p><strong>æ—¶é—´ç›¸å…³å˜é‡è¡¨</strong></p>\n<table>\n<thead>\n<tr>\n<th>å˜é‡</th>\n<th>å«ä¹‰</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>%Y</td>\n<td>å¹´ï¼ˆYearï¼‰</td>\n</tr>\n<tr>\n<td>%m</td>\n<td>æœˆï¼ˆMonthï¼‰</td>\n</tr>\n<tr>\n<td>%d</td>\n<td>æ—¥ï¼ˆDayï¼‰</td>\n</tr>\n<tr>\n<td>%H</td>\n<td>å°æ—¶ï¼ˆHourï¼‰</td>\n</tr>\n<tr>\n<td>%M</td>\n<td>åˆ†é’Ÿï¼ˆMinuteï¼‰</td>\n</tr>\n<tr>\n<td>%S</td>\n<td>ç§’ï¼ˆSecondï¼‰</td>\n</tr>\n</tbody>\n</table>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åŸºç¡€é…ç½®</span></span><br><span class=\"line\">-Xlog:gc*:file=gc_%p_%Y%m%d_%H%M%S.<span class=\"built_in\">log</span>:time,<span class=\"built_in\">uptime</span>,level,tags:filecount=5,filesize=20M</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># è¯¦ç»†GCæ—¥å¿—é…ç½®</span></span><br><span class=\"line\">-Xlog:gc*=debug:file=gc_%p_%t.log:time,<span class=\"built_in\">uptime</span>,level,tags:filecount=10,filesize=50M</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å¤šç›®æ ‡è¾“å‡º</span></span><br><span class=\"line\">-Xlog:gc*=info:file=gc.log::filecount=5,filesize=20M -Xlog:gc*=debug:file=gc_detailed.log</span><br></pre></td></tr></table></figure>\n</li>\n<li class=\"lvl-2\">\n<p>å¯¹äºGCæ—¥å¿—çš„åˆ†æ<br>\näººå·¥åˆ†æè¿˜æ˜¯å¤ªå¤æ‚äº†ï¼Œå¯ä»¥ä½¿ç”¨<a href=\"https://gceasy.io\">GCEasy.io</a>ï¼Œæ¯ä¸ªæœˆå…è´¹5æ¬¡ã€‚</p>\n</li>\n</ul>\n","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç»JVMçš„å†…å­˜æ¨¡å‹ä¸åƒåœ¾å›æ”¶æœºåˆ¶ JDK8 The JavaÂ® Virtual Machine Specification JDK8çš„javaæŒ‡ä»¤çš„å®˜â½…â½‚æ¡£ JDKâ¼¯å…·å®˜â½¹â½‚æ¡£ JDK17çš„javaæŒ‡ä»¤çš„å®˜â½…â½‚æ¡£ JVMè™šæ‹Ÿæœºç»“æ„(HotSpot) è®¾ç½®å†…å­˜åˆ†é…ç¤ºä¾‹ 1234# jdk1.8+java â€Xms2048M â€Xmx2048M â€Xmn1024M â€Xss512K â€XX:MetaspaceSize=128M â€XX:MaxMetaspaceSize=256M â€jar server.jar# jdk1.6/1.7java â€Xms2048M â€Xmx2048M â€Xmn1024M â€Xss512K â€XX:PermSize=128M â€XX:MaxPermSize=256M â€jar server.jar å„å‚æ•°å«ä¹‰ä¸é»˜è®¤å€¼ï¼ˆé’ˆå¯¹ JDK 1.8ï¼‰ å‚æ•° å«ä¹‰è¯´æ˜ é»˜è®¤å€¼ï¼ˆJDK 1.8ï¼‰ -Xms2048M åˆå§‹å †å¤§å°ï¼Œå³ JVM å¯åŠ¨æ—¶åˆ†é…çš„å †å†…å­˜å¤§å°ï¼ˆè¿™é‡Œæ˜¯ 2GBï¼‰ ç‰©ç†å†…å­˜çš„ 1/64ï¼ˆæœ€å° 1MBï¼‰ï¼Œæ¨èé…ç½®ä¸ºä¸ -Xmx ä¸€è‡´ -Xmx2048M æœ€å¤§å †å†…å­˜å¤§å°ï¼ŒJVM å…è®¸åˆ†é…çš„æœ€å¤§å †å†…å­˜ ç‰©ç†å†…å­˜çš„ 1/4ï¼ˆå—é™äº 32ä½/64ä½ï¼‰ -Xmn1024M æ–°ç”Ÿä»£å¤§å°ï¼ˆEden + Survivorï¼‰ä¸º 1GB æœªæ˜¾å¼æŒ‡å®šæ—¶ï¼Œé€šå¸¸å å †çš„ 1/3 å·¦å³ -Xss512K æ¯ä¸ªçº¿ç¨‹çš„æ ˆå¤§å°ï¼ˆThread Stack Sizeï¼‰ï¼Œè¿™é‡Œè®¾ç½®ä¸º 512KB 1MBï¼ˆ64ä½ç³»ç»Ÿï¼‰æˆ– 512KBï¼ˆ32ä½ç³»ç»Ÿï¼‰ -XX:MetaspaceSize=256M å…ƒç©ºé—´åˆå§‹å¤§å°ï¼ˆç”¨äºåŠ è½½ç±»çš„å…ƒæ•°æ®ï¼Œä¸å†ä½¿ç”¨ PermGenï¼‰ï¼Œè¾¾åˆ°è¯¥å€¼åï¼ŒJVM ä¼šè§¦å‘ä¸€æ¬¡ GCï¼Œç©ºé—´ä¸å¤Ÿæ—¶ä¼šè¿›è¡Œæ‰©å®¹ï¼Œæœ€å¤§åˆ° MaxMetaspaceSize é»˜è®¤ 21MBï¼ˆå®¢æˆ·ç«¯ï¼‰æˆ– 16MBï¼ˆæœåŠ¡å™¨ç«¯ï¼‰ï¼Œä¸ºé¿å…é¢‘ç¹æ‰©å®¹å¯¼è‡´çš„GCï¼Œå¯ä»¥è®¾ç½®çš„ç¨å¾®å¤§ä¸€äº›ï¼Œæ¯”å¦‚MaxMetaspaceSizeçš„ä¸€åŠï¼Œæˆ–å¹²è„†ä¸MaxMetaspaceSizeä¸€æ ·å¤§ -XX:MaxMetaspaceSize=256M å…ƒç©ºé—´æœ€å¤§å¤§å°ï¼Œæ¥è¿‘è®¾ç½®å€¼æ—¶ä¼šè§¦å‘ Full GC æ— é™åˆ¶ï¼ˆé»˜è®¤åªå—ç‰©ç†å†…å­˜çº¦æŸï¼‰ ï¼Œæ¨èé…ç½®ä¸€ä¸ªåˆé€‚çš„æ•°å€¼ï¼Œæ¯”å¦‚8Gçš„å†…å­˜å¯ä»¥é…ç½®ä¸º256M ç±»è£…è½½å­ç³»ç»Ÿï¼ˆClass Loading Subsystemï¼‰ ç±»è£…è½½å­ç³»ç»Ÿè´Ÿè´£å°† .class æ–‡ä»¶åŠ è½½åˆ° JVM ä¸­ï¼Œå¹¶è¿›è¡Œè§£æã€éªŒè¯ã€åˆå§‹åŒ–ç­‰è¿‡ç¨‹ã€‚ åŠ è½½è¿‡ç¨‹çš„å‡ ä¸ªé˜¶æ®µï¼š é˜¶æ®µ è¯´æ˜ åŠ è½½ï¼ˆLoadingï¼‰ å°† .class æ–‡ä»¶è¯»å–ä¸ºäºŒè¿›åˆ¶æ•°æ®ï¼Œæ„é€  Class å¯¹è±¡ éªŒè¯ï¼ˆVerificationï¼‰ ç¡®ä¿å­—èŠ‚ç æ–‡ä»¶æ ¼å¼æ­£ç¡®ã€å®‰å…¨åˆæ³•ï¼ˆé˜²æ­¢æ¶æ„ä»£ç ï¼‰ å‡†å¤‡ï¼ˆPreparationï¼‰ ä¸ºç±»çš„é™æ€å˜é‡åˆ†é…å†…å­˜ï¼Œå¹¶è®¾ç½®é»˜è®¤åˆå§‹å€¼ è§£æï¼ˆResolutionï¼‰ å°†å¸¸é‡æ± ä¸­çš„ç¬¦å·å¼•ç”¨æ›¿æ¢ä¸ºç›´æ¥å¼•ç”¨ï¼ˆæ–¹æ³•ã€å­—æ®µç­‰ï¼‰ åˆå§‹åŒ–ï¼ˆInitializationï¼‰ æ‰§è¡Œ &lt;clinit&gt; é™æ€åˆå§‹åŒ–æ–¹æ³•ï¼Œå¯¹é™æ€å˜é‡èµ‹åˆå§‹å€¼ ç±»åŠ è½½å™¨ï¼ˆClassLoaderï¼‰ä½“ç³»ç»“æ„ï¼šè¯¦ç»†å‚è€ƒ JVM ä¹‹ ç±»åŠ è½½å™¨ ç±»åŠ è½½å™¨åç§° åŠ è½½å†…å®¹ è¯´æ˜ å¼•å¯¼ç±»åŠ è½½å™¨ï¼ˆBootstrap ClassLoaderï¼‰ Java æ ¸å¿ƒç±»åº“ï¼ˆå¦‚ java.lang.*ï¼‰ ç”± JVM è‡ªèº«å®ç°ï¼Œç”¨æœ¬åœ°ä»£ç å®ç°ï¼Œæ— æ³•ç›´æ¥è®¿é—® æ‰©å±•ç±»åŠ è½½å™¨ï¼ˆExtension ClassLoaderï¼‰ JAVA_HOME/jre/lib/ext ç›®å½•ä¸‹çš„ç±» åŠ è½½æ ‡å‡†æ‰©å±•ç±»åº“ åº”ç”¨ç±»åŠ è½½å™¨ï¼ˆApplication ClassLoaderï¼‰ ç”¨æˆ·åº”ç”¨ç±»è·¯å¾„ï¼ˆCLASSPATH æŒ‡å®šçš„ç›®å½•ï¼‰ æœ€å¸¸ç”¨ï¼ŒåŠ è½½å¤§å¤šæ•°åº”ç”¨ä»£ç  è‡ªå®šä¹‰ç±»åŠ è½½å™¨ï¼ˆCustom ClassLoaderï¼‰ ç”¨æˆ·æ‰‹åŠ¨å®ç°çš„ç±»åŠ è½½å™¨ å¯ä»¥æ‰“ç ´åŒäº²å§”æ´¾æœºåˆ¶ï¼Œå®ç°çƒ­åŠ è½½ã€åŠ å¯†ç±»åŠ è½½ç­‰ ç±»åŠ è½½é‡‡ç”¨ åŒäº²å§”æ´¾æ¨¡å‹ï¼šè¯·æ±‚ä¼šå…ˆå‘çˆ¶åŠ è½½å™¨å§”æ‰˜ï¼Œåªæœ‰åœ¨çˆ¶åŠ è½½å™¨åŠ è½½å¤±è´¥æ—¶æ‰å°è¯•è‡ªèº«åŠ è½½ã€‚ å­—èŠ‚ç æ‰§è¡Œå¼•æ“ï¼ˆExecution Engineï¼‰ å­—èŠ‚ç æ‰§è¡Œå¼•æ“è´Ÿè´£å°† Java å­—èŠ‚ç è§£é‡Šæˆ–ç¼–è¯‘ä¸ºæœºå™¨ä»£ç ï¼Œå¹¶åœ¨åº•å±‚å¹³å°ä¸Šæ‰§è¡Œã€‚ æ‰§è¡Œå¼•æ“çš„æ ¸å¿ƒæ¨¡å— ç»„ä»¶åç§° ä½œç”¨è¯´æ˜ å…³é”®ç‰¹æ€§ è§£é‡Šå™¨ï¼ˆInterpreterï¼‰ å°†å­—èŠ‚ç é€æ¡è§£é‡Šæ‰§è¡Œ å¯åŠ¨å¿«ï¼Œé€‚åˆå†·ä»£ç ï¼ˆéçƒ­ç‚¹ä»£ç ï¼‰ï¼Œæ‰§è¡Œæ•ˆç‡ç›¸å¯¹è¾ƒä½ å³æ—¶ç¼–è¯‘å™¨ï¼ˆJIT Compilerï¼‰ å°†çƒ­ç‚¹ä»£ç ç¼–è¯‘ä¸ºæœ¬åœ°æœºå™¨ç ï¼Œæé«˜æ‰§è¡Œæ•ˆç‡ åŒ…å« C1ï¼ˆClientï¼‰å’Œ C2ï¼ˆServerï¼‰ä¸¤ç§ï¼Œæ”¯æŒä¼˜åŒ–å¦‚ï¼šæ–¹æ³•å†…è”ã€é€ƒé€¸åˆ†æã€å¾ªç¯å±•å¼€ç­‰ åƒåœ¾æ”¶é›†å™¨ï¼ˆGarbage Collector, GCï¼‰ è‡ªåŠ¨å†…å­˜ç®¡ç†ï¼Œè´Ÿè´£å¯¹è±¡ç”Ÿå‘½å‘¨æœŸçš„å›æ”¶ å¸¸è§ç®—æ³•åŒ…æ‹¬ï¼šSerialã€Parallelã€CMSã€G1ã€ZGCï¼ˆä½å»¶è¿Ÿï¼‰ç­‰ï¼Œæ ¹æ®ä¸åŒåœºæ™¯é€‰æ‹© æœ¬åœ°æ¥å£ï¼ˆNative Interfaceï¼‰ æ”¯æŒ Java ä¸æœ¬åœ°è¯­è¨€ï¼ˆå¦‚ C/C++ï¼‰çš„äº’æ“ä½œ é€šè¿‡ JNIï¼ˆJava Native Interfaceï¼‰å®ç°ï¼Œè°ƒç”¨åº•å±‚æ“ä½œç³»ç»Ÿæˆ–ç¬¬ä¸‰æ–¹åº“åŠŸèƒ½ å³æ—¶ç¼–è¯‘å™¨ï¼ˆJIT Compilerï¼‰ JVM çš„ HotSpot ç¼–è¯‘å™¨æœ‰ä¸¤ä¸ªä¸»è¦ç»„ä»¶ï¼š C1 ç¼–è¯‘å™¨ï¼ˆClient ç¼–è¯‘å™¨ï¼‰ï¼šè½»é‡ã€å¿«é€Ÿç¼–è¯‘ï¼Œä¼˜åŒ–å°‘ã€‚ C2 ç¼–è¯‘å™¨ï¼ˆServer ç¼–è¯‘å™¨ï¼‰ï¼šä¼˜åŒ–é«˜çº§ï¼Œè€—æ—¶é•¿ï¼Œé€‚åˆé•¿æ—¶é—´è¿è¡Œçš„çƒ­ç‚¹ä»£ç ã€‚ åœ¨ 64 ä½ JDK ä¸­ï¼Œé»˜è®¤å°±æ˜¯ -server æ¨¡å¼ (C2 ç¼–è¯‘å™¨) ï¼Œä¸å†æ”¯æŒ -client (C1 ç¼–è¯‘å™¨)ã€‚ åœ¨ 32 ä½ JDK ä¸­ï¼Œæ ¹æ®å¹³å°å’Œå¯åŠ¨æ–¹å¼ï¼Œå¯èƒ½ä¼šè‡ªåŠ¨é€‰æ‹© -client æˆ– -serverï¼Œä¹Ÿå¯ä»¥æ‰‹åŠ¨æŒ‡å®šã€‚ åˆ†å±‚ç¼–è¯‘ï¼ˆTiered Compilationï¼‰ å…è®¸ JVM åœ¨ä¸€å¼€å§‹ç”¨ C1 ç¼–è¯‘å™¨å¿«é€Ÿç¼–è¯‘å­—èŠ‚ç ï¼Œåç»­çƒ­ç‚¹ä»£ç å†äº¤ç»™ C2 ç¼–è¯‘å™¨è¿›è¡Œæ›´é«˜çº§ä¼˜åŒ–ã€‚è¿™æ ·ç»“åˆäº† -clientï¼ˆå¿«å¯åŠ¨ï¼‰å’Œ -serverï¼ˆé«˜æ€§èƒ½ï¼‰çš„ä¼˜ç‚¹ã€‚TieredCompilationå‚æ•°æ§åˆ¶æ˜¯å¦å¼€å¯åˆ†å±‚ç¼–è¯‘ï¼Œé»˜è®¤å¼€å¯ã€‚ -XX:TieredStopAtLeve=&lt;level&gt; å‚æ•°æ§åˆ¶ ç¼–è¯‘å™¨æœ€å¤šä½¿ç”¨å“ªä¸€å±‚ä¼˜åŒ–çº§åˆ«ã€‚å®ƒçš„å–å€¼å¦‚ä¸‹ï¼Œå€¼è¶Šä½å¯åŠ¨è¶Šå¿«ï¼Œä½†ä¼˜åŒ–è¶Šå°‘ã€‚ å€¼ å«ä¹‰ 0 ä»…è§£é‡Šæ‰§è¡Œï¼ˆä¸å¼€å¯ç¼–è¯‘å™¨ï¼‰ 1 åªä½¿ç”¨ C1 ç¼–è¯‘å™¨çš„ç¬¬ä¸€çº§ï¼ˆæœ€å°‘ä¼˜åŒ–ï¼‰ 2 C1 ç¬¬äºŒçº§ï¼Œç•¥å¤šä¼˜åŒ– 3 C1 ç¬¬ä¸‰çº§ï¼Œæ›´ä¼˜åŒ– 4 å¯ç”¨ C2 ç¼–è¯‘å™¨ï¼ˆå®Œå…¨ä¼˜åŒ–ï¼Œé»˜è®¤å€¼ï¼‰ JVM å†…å­˜æ¨¡å‹ï¼ˆJava Memory Modelï¼ŒJMMï¼‰ JMM æ˜¯ Java è™šæ‹Ÿæœºè§„èŒƒä¸­å®šä¹‰çš„ä¸€ç§ æŠ½è±¡å†…å­˜æ¨¡å‹ï¼Œå®ƒå†³å®šäº†å¤šçº¿ç¨‹ç¨‹åºä¸­å˜é‡çš„è¯»å†™å¯è§æ€§ã€æœ‰åºæ€§å’ŒåŸå­æ€§ã€‚åŒæ—¶ï¼ŒJVM åœ¨ç‰©ç†å±‚ä¹Ÿæœ‰ä¸€ä¸ªå®é™…çš„å†…å­˜ç»“æ„ï¼Œç§°ä¸ºè¿è¡Œæ—¶æ•°æ®åŒºåŸŸï¼ˆRuntime Data Areasï¼‰ï¼Œè¿™ä¸¤ä¸ªå¯ä»¥ç»“åˆç†è§£ã€‚ JMM çš„ä¸»è¦ç›®æ ‡ ä¿è¯å¤šçº¿ç¨‹ç¯å¢ƒä¸‹çš„æ•°æ®ä¸€è‡´æ€§ æŒ‡å¯¼ JVM å’Œ CPU çš„å†…å­˜äº¤äº’è¡Œä¸ºï¼ˆå¦‚é‡æ’åºã€ç¼“å­˜ï¼‰ å®é™…è¿è¡Œæ—¶å†…å­˜ç»“æ„å¦‚ä¸‹ï¼š å†…å­˜åŒºåŸŸ è¯´æ˜ ğŸ“Œ ç¨‹åºè®¡æ•°å™¨ï¼ˆPCï¼‰ æ¯ä¸ªçº¿ç¨‹ç§æœ‰ï¼Œè®°å½•å½“å‰æ‰§è¡Œçš„å­—èŠ‚ç æŒ‡ä»¤åœ°å€ ğŸ“Œ Java çº¿ç¨‹æ ˆ æ¯ä¸ªçº¿ç¨‹ç§æœ‰ï¼Œæ–¹æ³•è°ƒç”¨æ—¶ç”¨äºå­˜å‚¨å±€éƒ¨å˜é‡ã€æ“ä½œæ•°æ ˆç­‰ ğŸ“Œ æœ¬åœ°æ–¹æ³•æ ˆ ä¸è™šæ‹Ÿæœºæ ˆç±»ä¼¼ï¼Œç”¨äº native æ–¹æ³• ğŸ“Œ å †ï¼ˆHeapï¼‰ æ‰€æœ‰çº¿ç¨‹å…±äº«ï¼Œå­˜å‚¨å¯¹è±¡å®ä¾‹ã€æ•°ç»„ç­‰ï¼ŒGC çš„ä¸»è¦åŒºåŸŸ ğŸ“Œ æ–¹æ³•åŒºï¼ˆæˆ–å…ƒç©ºé—´ï¼‰ æ‰€æœ‰çº¿ç¨‹å…±äº«ï¼Œå­˜å‚¨ç±»ä¿¡æ¯ã€é™æ€å˜é‡ã€å¸¸é‡æ± ç­‰ï¼ˆJDK8 åç§°ä¸º Metaspaceï¼‰ åƒåœ¾å›æ”¶å™¨ åƒåœ¾å›æ”¶å™¨è´Ÿè´£è‡ªåŠ¨ç®¡ç†å†…å­˜ï¼Œå›æ”¶ä¸å†ä½¿ç”¨çš„å¯¹è±¡ï¼Œé¿å…å†…å­˜æ³„æ¼å’Œæº¢å‡ºã€‚ ä»€ä¹ˆæ˜¯åƒåœ¾ å†…å­˜ä¸­æ²¡æœ‰è¢«ï¼ˆçº¿ç¨‹æ ˆå˜é‡ï¼Œé™æ€å˜é‡ï¼Œå¸¸é‡æ± ï¼ŒJNIæŒ‡é’ˆï¼‰å¼•ç”¨çš„åœ°å€å°±æ˜¯åƒåœ¾ å¯è¾¾æ€§åˆ†æç®—æ³•ï¼šæ˜¯ç°ä»£ JVM åˆ¤æ–­ä¸€ä¸ªå¯¹è±¡æ˜¯å¦â€œè¿˜æ´»ç€â€çš„ä¸»è¦ç®—æ³•ã€‚ 1234åŸºæœ¬æ€æƒ³ï¼šä»ä¸€ç»„ç§°ä¸º â€œGC Rootsâ€ çš„å¯¹è±¡å‡ºå‘ï¼Œæ²¿ç€å¯¹è±¡ä¹‹é—´çš„å¼•ç”¨é“¾å‘ä¸‹æœç´¢ã€‚å¦‚æœæŸä¸ªå¯¹è±¡ å¯ä»¥ä» GC Roots è¿½è¸ªåˆ°ï¼Œå°±è®¤ä¸ºå®ƒæ˜¯ â€œå¯è¾¾â€ çš„ï¼ˆAliveï¼‰ã€‚å¦åˆ™å°±è®¤ä¸ºæ˜¯ â€œä¸å¯è¾¾â€ çš„ï¼ˆGarbageï¼‰ï¼Œå¯ä»¥è¢«å›æ”¶ã€‚ åœ¨ JVM ä¸­ï¼ŒGC Roots æ˜¯ä¸€äº› å§‹ç»ˆå¯ç”¨çš„ã€ä¸ä¼šè¢«åƒåœ¾å›æ”¶çš„å¼•ç”¨èµ·ç‚¹ï¼Œä¸»è¦åŒ…æ‹¬ï¼š GC Roots æ¥æº è¯´æ˜ å½“å‰çº¿ç¨‹æ ˆä¸­çš„å¼•ç”¨ï¼ˆå±€éƒ¨å˜é‡è¡¨ï¼‰ å„ä¸ªçº¿ç¨‹æ­£åœ¨è°ƒç”¨çš„æ–¹æ³•ä¸­çš„å±€éƒ¨å˜é‡ã€å‚æ•°ç­‰ é™æ€å­—æ®µå¼•ç”¨ ç±»çš„é™æ€å­—æ®µå¼•ç”¨çš„å¯¹è±¡ JNI å¼•ç”¨ï¼ˆNative æ–¹æ³•å¼•ç”¨ï¼‰ Java æœ¬åœ°æ–¹æ³•ä¸­å¼•ç”¨çš„å¯¹è±¡ å¸¸é‡å¼•ç”¨æ± ä¸­çš„å¯¹è±¡ å­—ç¬¦ä¸²å¸¸é‡ç­‰å¯èƒ½æŒæœ‰å¯¹è±¡å¼•ç”¨ æ´»åŠ¨çº¿ç¨‹å¯¹è±¡ çº¿ç¨‹è‡ªèº«åœ¨ GC æ—¶ä¸ä¼šè¢«å›æ”¶ JVM å†…éƒ¨ç»“æ„ï¼ˆå¦‚ç³»ç»Ÿç±»åŠ è½½å™¨ç­‰ï¼‰ JVM å…³é”®ç³»ç»Ÿå¯¹è±¡ åƒåœ¾å›æ”¶å™¨ç§ç±»ï¼š å·¦è¾¹6ç§å«åˆ†ä»£æ¨¡å‹ï¼Œå³è¾¹çš„4ç§å«åˆ†åŒºæ¨¡å‹ åˆ†ä»£æ¨¡å‹ï¼ˆGenerational Modelï¼‰ å †å†…å­˜åˆ’åˆ†ä¸ºï¼š å¹´è½»ä»£ï¼ˆYoung Generationï¼‰ï¼šå­˜æ”¾æ–°åˆ›å»ºçš„å¯¹è±¡ï¼Œåˆ†ä¸º Eden å’Œ Survivor åŒºã€‚ è€å¹´ä»£ï¼ˆOld Generationï¼‰ï¼šå­˜æ”¾ç»è¿‡å¤šæ¬¡ GC åä»ç„¶å­˜æ´»çš„å¯¹è±¡ã€‚ åˆ†åŒºæ¨¡å‹ï¼ˆRegion-based Modelï¼‰ åˆ†åŒºæ¨¡å‹ï¼ˆå¦‚ G1ã€ZGCã€Shenandoahï¼‰ä¸å†ä¸¥æ ¼æŒ‰ç…§ä»£åˆ’åˆ†å†…å­˜ï¼Œè€Œæ˜¯æŠŠå †åˆ’åˆ†ä¸ºå¤šä¸ª å¤§å°ç›¸åŒçš„ Regionã€‚æ¯ä¸ª Region å¯ä»¥åœ¨è¿è¡Œæ—¶è¢«åŠ¨æ€æ ‡è®°ä¸º Edenã€Survivor æˆ– Oldã€‚ åˆ†ä»£æ¨¡å‹ä¸­ï¼Œä¸Šé¢3ä¸ªæ˜¯æ–°ç”Ÿä»£åƒåœ¾å›æ”¶å™¨ï¼Œä¸‹é¢3ä¸ªæ˜¯è€å¹´ä»£åƒåœ¾å›æ”¶å™¨ï¼Œå¯ä»¥äº¤å‰é…å¯¹ï¼ˆè§ä¸Šå›¾è™šçº¿ï¼‰ï¼Œä½†æœ€å¸¸ç”¨æ˜¯ä¸Šä¸‹ä¸¤ä¸¤é…å¯¹ã€‚ CMSå³å¯ä»¥ä½œä¸ºæ–°ç”Ÿä»£åƒåœ¾å›æ”¶å™¨ï¼Œä¹Ÿå¯ä»¥ä½œä¸ºè€å¹´ä»£åƒåœ¾å›æ”¶å™¨ã€‚ EpsilonGCï¼Œæ˜¯ä¸€ä¸ªç‰¹æ®Šçš„åƒåœ¾å›æ”¶å™¨ï¼Œå®ƒä¸å›æ”¶ä»»ä½•å¯¹è±¡ï¼Œåªè´Ÿè´£æœ€ç»ˆè®°å½•ï¼Œåšæµ‹è¯•ç”¨çš„ã€‚ ç›®å‰æœ€å…ˆè¿›çš„æ¨¡å‹æ˜¯ ZGCï¼Œjkd11å¼€å§‹æ”¯æŒï¼Œä½†ç›´åˆ°JDK16æ‰æ¯”è¾ƒå®Œå–„ï¼Œç›®å‰éé»˜è®¤é…ç½®ï¼Œéœ€è¦æ‰‹åŠ¨é…ç½®ã€‚å…¶ä¸Redhatå‡ºå“çš„ Shenandoah æ˜¯ç«äº‰å…³ç³»ã€‚ å¸¸è§åƒåœ¾å›æ”¶å™¨åŠå…¶åˆ†ç±»ã€JDKç‰ˆæœ¬ åƒåœ¾å›æ”¶å™¨ æ‰€å±æ¨¡å‹ è¯´æ˜ é¦–æ¬¡å‡ºç° JDK ç‰ˆæœ¬ å¯ç”¨å‘½ä»¤ï¼ˆJVM å‚æ•°ï¼‰ é€‚åˆçš„å †å†…å­˜å¤§å° Serial åˆ†ä»£æ¨¡å‹ å•çº¿ç¨‹ï¼Œæ–°ç”Ÿä»£å’Œè€å¹´ä»£éƒ½ä½¿ç”¨ Serialï¼Œé€‚ç”¨äºå°å †å†…å­˜, å·²å¼ƒç”¨ JDK 1.2 -XX:+UseSerialGC ğŸ’¾ å°äº 1GB ParNew åˆ†ä»£æ¨¡å‹ Serial çš„å¤šçº¿ç¨‹ç‰ˆæœ¬ï¼Œä»…ç”¨äº CMS æ–°ç”Ÿä»£, JDK11å·²å¼ƒç”¨ JDK 1.4 -XX:+UseParNewGC -XX:+UseConcMarkSweepGC ğŸ’¾ 1GB ~ 4GB Parallelï¼ˆååé‡ GCï¼‰ åˆ†ä»£æ¨¡å‹ å¤šçº¿ç¨‹ GCï¼Œé€‚åˆååé‡ä¼˜å…ˆçš„åº”ç”¨åœºæ™¯ JDK 1.4 -XX:+UseParallelGCï¼ˆæ–°ç”Ÿä»£ï¼‰-XX:+UseParallelOldGCï¼ˆè€å¹´ä»£ï¼‰ ğŸ’¾ 2GB ~ 8GB CMSï¼ˆConcurrent Mark Sweepï¼‰ åˆ†ä»£æ¨¡å‹ è€å¹´ä»£å¹¶å‘æ ‡è®°-æ¸…é™¤ï¼Œä½å»¶è¿Ÿï¼Œä½†å­˜åœ¨ç¢ç‰‡ï¼ŒJDK14å·²å¼ƒç”¨ JDK 1.4 -XX:+UseConcMarkSweepGC ğŸ’¾ 2GB ~ 8GB G1ï¼ˆGarbage Firstï¼‰ åˆ†åŒºæ¨¡å‹ å°†å †åˆ’åˆ†ä¸º Regionï¼Œé€»è¾‘åˆ†ä»£ï¼Œæ”¯æŒå¹¶å‘å‹ç¼©ï¼Œå¹³è¡¡å»¶è¿Ÿä¸åå JDK 7u4ï¼ˆæ­£å¼ï¼‰ -XX:+UseG1GC ğŸ’¾ 4GB ~ æ•°å GB ZGCï¼ˆZ Garbage Collectorï¼‰ åˆ†åŒºæ¨¡å‹ Region å¼¹æ€§å¤§å°ï¼Œæ”¯æŒè¶…å¤§å †ï¼Œä½å»¶è¿Ÿï¼ˆ&lt;10ms åœé¡¿ï¼‰ JDK 11ï¼ˆå®éªŒï¼‰ï¼ŒJDK 15ï¼ˆæ­£å¼ï¼‰ -XX:+UseZGC ğŸ’¾ 8GB ~ æ•° TBï¼ˆè¶…å¤§å †ï¼‰ Shenandoah åˆ†åŒºæ¨¡å‹ çº¢å¸½ä¸»å¯¼ï¼Œä½å»¶è¿Ÿï¼Œå¹¶å‘å›æ”¶ä¸å¹¶å‘å‹ç¼© JDK 12ï¼ˆå®éªŒï¼‰ï¼ŒJDK 15ï¼ˆæ­£å¼ï¼‰ -XX:+UseShenandoahGC ğŸ’¾ 2GB ~ æ•°å GB å¯¹äº CMSï¼Œå¯ç”¨åä¼šè‡ªåŠ¨ä½¿ç”¨ ParNew ä½œä¸ºæ–°ç”Ÿä»£å›æ”¶å™¨ï¼ˆé™¤éæ˜¾å¼ç¦æ­¢ï¼‰ã€‚ å¯¹äº Parallel GC å¯ç”¨ -XX:+UseParallelGCï¼ˆæ–°ç”Ÿä»£ï¼‰ä¼šè‡ªåŠ¨å¯ç”¨ -XX:+UseParallelOldGCï¼ˆè€å¹´ä»£ï¼‰ã€‚ å¯¹äºZGCï¼Œjdk15ä»¥å‰æœ€å¤§æ”¯æŒ4Tå†…å­˜ï¼Œä¹‹åæœ€å¤§æ”¯æŒ16Tå†…å­˜ã€‚ å„ç‰ˆæœ¬é»˜è®¤åƒåœ¾å›æ”¶å™¨åŠæ¨èé…ç½®ï¼ˆJDK 1.6 èµ·ï¼‰ JDK ç‰ˆæœ¬ é»˜è®¤ GC å»ºè®®ä½¿ç”¨ GCï¼ˆæŒ‰åœºæ™¯åˆ†ç±»ï¼‰ JDK 1.6 Serial / Parallel - å°å‹åº”ç”¨ï¼ˆå¦‚æ¡Œé¢ç¨‹åºï¼‰ï¼š-XX:+UseSerialGC - ä¸­å¤§å‹åº”ç”¨ï¼ˆååé‡ä¼˜å…ˆï¼‰ï¼š-XX:+UseParallelGC JDK 1.7 åŒä¸Š åŒ JDK 1.6 JDK 1.8 Parallel - ååä¼˜å…ˆï¼šé»˜è®¤ -XX:+UseParallelGC - å“åº”ä¼˜å…ˆï¼š-XX:+UseConcMarkSweepGCï¼ˆCMSï¼‰ - å¤§å † + æœªæ¥å‡çº§è€ƒè™‘ï¼š-XX:+UseG1GCï¼ˆæ¨èï¼‰ JDK 9-14 G1 GC - ä¸€èˆ¬é»˜è®¤å³å¯ï¼š-XX:+UseG1GCï¼ˆå»¶è¿Ÿä¸ååå¹³è¡¡ï¼‰ - æç«¯ä½å»¶è¿Ÿè¦æ±‚ï¼šå‡çº§åˆ° JDK 11+ ä½¿ç”¨ ZGC/Shenandoah JDK 15+ G1 GCï¼ˆé»˜è®¤ï¼‰ï¼ŒZGC / Shenandoah å¯é€‰ - å»¶è¿Ÿæ•æ„Ÿï¼ˆåœ¨çº¿æœåŠ¡ã€RTç³»ç»Ÿï¼‰ï¼š-XX:+UseZGC æˆ– -XX:+UseShenandoahGC - ååä¸ºä¸»ï¼š-XX:+UseParallelGC - ç»¼åˆå¹³è¡¡ï¼š-XX:+UseG1GCï¼ˆé»˜è®¤ï¼‰ åˆ¤æ–­é»˜è®¤ GC çš„æ–¹å¼ 1java -XX:+PrintCommandLineFlags -version åƒåœ¾å›æ”¶ç®—æ³• JVM ä¸­å¸¸è§åƒåœ¾å›æ”¶ç®—æ³•æ±‡æ€» ç®—æ³•åç§° æ ¸å¿ƒæ€æƒ³ é€‚ç”¨é˜¶æ®µ/åŒºåŸŸ ä¼˜ç¼ºç‚¹ç®€è¿° æ ‡è®°-æ¸…é™¤ï¼ˆMark-Sweepï¼‰ æ ‡è®°å‡ºå­˜æ´»å¯¹è±¡ï¼Œæ¸…é™¤æœªæ ‡è®°å¯¹è±¡ è€å¹´ä»£ ç®€å•é«˜æ•ˆï¼Œä½†ä¼šäº§ç”Ÿå¤§é‡ç¢ç‰‡ï¼Œä¸é€‚åˆè¿ç»­å†…å­˜åˆ†é… æ ‡è®°-æ•´ç†ï¼ˆMark-Compactï¼‰ æ ‡è®°åç§»åŠ¨å­˜æ´»å¯¹è±¡ï¼Œæ•´ç†ç¢ç‰‡ è€å¹´ä»£ æ¶ˆé™¤ç¢ç‰‡ï¼Œä»£ä»·æ˜¯ç§»åŠ¨å¯¹è±¡ï¼Œé€‚ç”¨äºè€å¹´ä»£å‹ç¼© å¤åˆ¶ç®—æ³•ï¼ˆCopyingï¼‰ å°†å¯¹è±¡å¤åˆ¶åˆ°å¦ä¸€å—å†…å­˜ï¼ˆå¦‚ Eden â†’ Survivorï¼‰ æ–°ç”Ÿä»£ é«˜æ•ˆç‡ï¼Œé€‚åˆå›æ”¶å¤§å¤šæ•°å¯¹è±¡çŸ­å‘½çš„æ–°ç”Ÿä»£ï¼Œä½†éœ€è¦é¢å¤–ç©ºé—´ åˆ†ä»£å›æ”¶ï¼ˆGenerationalï¼‰ å°†å¯¹è±¡æŒ‰ç”Ÿå‘½å‘¨æœŸåˆ’åˆ†ï¼ˆæ–°ç”Ÿä»£/è€å¹´ä»£ï¼‰ æ•´ä¸ªå †ç»“æ„ å®ç”¨æ€§å¼ºï¼Œç»“åˆä¸åŒç®—æ³•åº”ç”¨äºä¸åŒä»£ï¼Œç°ä»£ GC åŸºç¡€ åˆ†åŒºå›æ”¶ï¼ˆRegion-basedï¼‰ å°†å †åˆ’åˆ†ä¸ºè‹¥å¹²ç­‰å¤§å°çš„ Region åŠ¨æ€åˆ†é… æ•´ä¸ªå †ï¼ˆå¦‚ G1ã€ZGCï¼‰ æ›´çµæ´»ï¼Œæ”¯æŒå¹¶å‘å¹¶è¡Œï¼Œå‡å°‘ STW åœé¡¿ï¼Œé€‚ç”¨äºå¤§å †ã€ä½å»¶è¿Ÿåœºæ™¯ å¢é‡å›æ”¶ï¼ˆIncrementalï¼‰ åˆ†é˜¶æ®µå°æ­¥æ‰§è¡Œ GC ä»¥å‡å°‘å•æ¬¡åœé¡¿ æŸäº›å¹¶å‘/ä½å»¶è¿Ÿ GC å‡å°‘æš‚åœæ—¶é—´ï¼Œä½†æ•´ä½“æ•ˆç‡å¯èƒ½é™ä½ å¹¶å‘å›æ”¶ï¼ˆConcurrentï¼‰ æ ‡è®°ã€æ¸…ç†ç­‰æ­¥éª¤ä¸åº”ç”¨çº¿ç¨‹å¹¶å‘æ‰§è¡Œ CMSã€G1ã€ZGC ç­‰ åœé¡¿æ—¶é—´çŸ­ï¼Œå¯¹å“åº”æ—¶é—´è¦æ±‚é«˜çš„ç³»ç»Ÿå‹å¥½ ä¸‰è‰²æ ‡è®°ï¼ˆTri-color Markingï¼‰ å¹¶å‘æ ‡è®°ç®—æ³•çš„ä¸€ç§å®ç°æ€æƒ³ CMSã€G1ã€ZGC ç­‰ ç™½ï¼ˆå¾…å›æ”¶ï¼‰ã€ç°ï¼ˆå·²æ ‡è®°æœªæ‰«æï¼‰ã€é»‘ï¼ˆå·²æ ‡è®°å·²æ‰«æï¼‰ï¼Œé¿å…â€œæ¼æ ‡â€é—®é¢˜ SATBï¼ˆSnapshot-At-The-Beginningï¼‰ å¹¶å‘æ ‡è®°çš„å¿«ç…§ç­–ç•¥ G1ã€ZGC ä¿è¯åœ¨å¹¶å‘æ ‡è®°è¿‡ç¨‹ä¸­ä¸é—æ¼æ–°å¼•ç”¨ï¼Œé€‚åˆé«˜å¹¶å‘åœºæ™¯ Lazy Compactionï¼ˆå»¶è¿Ÿå‹ç¼©ï¼‰ ä¸æ¯æ¬¡ GC éƒ½å‹ç¼©ï¼Œè§†æƒ…å†µè€Œå®š G1 ç­‰ é™ä½ä¸å¿…è¦çš„ç§»åŠ¨æˆæœ¬ å¯¹åº”å…³ç³»ï¼šGC å›æ”¶å™¨å’Œåº•å±‚ç®—æ³• å›æ”¶å™¨ ä½¿ç”¨çš„ç®—æ³•ç»„åˆ Serial æ–°ç”Ÿä»£ï¼šå¤åˆ¶ç®—æ³•è€å¹´ä»£ï¼šæ ‡è®°-æ•´ç† ParNew æ–°ç”Ÿä»£ï¼šå¤åˆ¶ç®—æ³•ï¼ˆå¤šçº¿ç¨‹ï¼‰ Parallel æ–°ç”Ÿä»£ï¼šå¤åˆ¶ç®—æ³•è€å¹´ä»£ï¼šæ ‡è®°-æ•´ç† CMS æ–°ç”Ÿä»£ï¼šParNewï¼ˆå¤åˆ¶ï¼‰è€å¹´ä»£ï¼šæ ‡è®°-æ¸…é™¤ + ä¸‰è‰²æ ‡è®° + å¹¶å‘ G1 åˆ†åŒºå›æ”¶ + ä¸‰è‰²æ ‡è®° + SATB + Lazy Compaction ZGC åˆ†åŒºå›æ”¶ + å¹¶å‘æ ‡è®° + SATB + Region Remapping Shenandoah åˆ†åŒºå›æ”¶ + å¹¶å‘æ ‡è®° + å¹¶å‘å‹ç¼© + ä¸‰è‰²æ ‡è®° 1234567891011 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ å¸¸è§ GC ç®—æ³•åˆ†ç±» â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚åˆ†ä»£æ¨¡å‹ åˆ†åŒºæ¨¡å‹ â”‚ â”‚ â”Œâ”€â”´â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”´â”€â”€â”€â”€â”€â”å¤åˆ¶ æ ‡è®°-æ¸…é™¤ Region-based å¹¶å‘ æ ‡è®°-æ•´ç† SATB / ä¸‰è‰²æ ‡è®° ä»€ä¹ˆæ˜¯ STWï¼ˆStop-The-Worldï¼‰ STWï¼ˆStop-The-Worldï¼‰ æŒ‡çš„æ˜¯ï¼šåœ¨æŸäº›åƒåœ¾å›æ”¶é˜¶æ®µï¼ŒJVM ä¼šæš‚åœæ‰€æœ‰åº”ç”¨çº¿ç¨‹ï¼ˆä¹Ÿå«ç”¨æˆ·çº¿ç¨‹ï¼‰ï¼Œè®©åƒåœ¾å›æ”¶çº¿ç¨‹ç‹¬å  CPU æ‰§è¡Œ GC é€»è¾‘ã€‚ ä½ å¯ä»¥è¿™æ ·ç†è§£ STW JVM ä¼šâ€œæŒ‰ä¸‹æš‚åœé”®â€æš‚åœæ‰€æœ‰æ­£åœ¨è¿è¡Œçš„ Java ç¨‹åºä»£ç ï¼› ç„¶å ä¸“å¿ƒè¿›è¡Œ GC çš„æŸäº›é˜¶æ®µï¼ˆå¦‚æ ‡è®°ã€æ•´ç†ã€å¤åˆ¶ç­‰ï¼‰ï¼› GC å®Œæˆåï¼Œæ‰ä¼šâ€œæ¢å¤è¿è¡Œâ€åº”ç”¨çº¿ç¨‹ã€‚ å„ GC ä¸­ STW çš„å­˜åœ¨æƒ…å†µ å›æ”¶å™¨ æ˜¯å¦å­˜åœ¨ STWï¼Ÿ è¯´æ˜ Serial âœ… æ˜¯ï¼Œå…¨åœé¡¿ï¼Œå…¨é˜¶æ®µå•çº¿ç¨‹ å †è¶Šå¤§ STW è¶Šé•¿ Parallel âœ… æ˜¯ï¼Œå…¨åœé¡¿ï¼Œå¤šçº¿ç¨‹æ‰§è¡Œ GC æé«˜æ•ˆç‡ä½†ä»ä¼šæš‚åœ CMS âœ… æœ‰ï¼Œåˆå§‹æ ‡è®°å’Œæœ€ç»ˆé‡æ–°æ ‡è®°æ˜¯ STW å¤§éƒ¨åˆ†é˜¶æ®µå¹¶å‘æ‰§è¡Œ G1 âœ… æœ‰ï¼Œä½†è®¾è®¡ä¸ºå°½å¯èƒ½ç¼©çŸ­ STW åˆ†é˜¶æ®µå¹¶å‘ + å¹¶è¡Œå¤„ç† ZGC âœ… æçŸ­ï¼ˆ&lt;10msï¼‰ ä»…ä¸ªåˆ«é˜¶æ®µæ˜¯ STWï¼Œå‡ ä¹æ„ŸçŸ¥ä¸åˆ° Shenandoah âœ… æçŸ­ é«˜åº¦å¹¶å‘ï¼ŒSTW æ—¶é—´ä¹ŸæçŸ­ ä¸ºä»€ä¹ˆè¦å…³æ³¨ STWï¼Ÿ åœ¨å“åº”æ—¶é—´æ•æ„Ÿå‹ç³»ç»Ÿï¼ˆå¦‚åœ¨çº¿äº¤æ˜“ç³»ç»Ÿã€æ¸¸æˆæœåŠ¡å™¨ã€API ç½‘å…³ï¼‰ä¸­ï¼Œé•¿æ—¶é—´çš„ STW ä¼šé€ æˆç”¨æˆ·è¯·æ±‚å¡é¡¿ã€è¶…æ—¶ã€‚ å› æ­¤ï¼Œé€‰æ‹© ä½ STW çš„ GCï¼ˆå¦‚ G1ã€ZGCã€Shenandoahï¼‰ å¯¹è¿™ç±»ç³»ç»Ÿè‡³å…³é‡è¦ã€‚ å †å†…å­˜ç»“æ„ ä¸åŒçš„åƒåœ¾å›æ”¶å™¨å†³å®šäº†å †å†…å­˜çš„ç»“æ„ä¸åŒï¼Œä½†æ€»ä½“ä¸Šåˆ†ä¸ºä¸¤ç§ç±»å‹ï¼šåˆ†ä»£æ¨¡å‹å’Œåˆ†åŒºæ¨¡å‹ã€‚ åˆ†ä»£æ¨¡å‹ Parallel åƒåœ¾å›æ”¶å™¨ å †ç»“æ„è¢«åˆ’åˆ†ä¸º Old Generationï¼ˆè€å¹´ä»£ï¼‰ å’Œ Young Generationï¼ˆæ–°ç”Ÿä»£ï¼‰ ä¸¤éƒ¨åˆ†ã€‚ Young Generation ç”± Eden å’Œ ä¸¤ä¸ª Survivor ç»„æˆï¼Œå…¶ä¸­ Eden æ˜¯ä¸€ä¸ªè¿ç»­çš„å†…å­˜åŒºåŸŸï¼ŒSurvivor æ˜¯ä¸€ä¸ªéè¿ç»­çš„å†…å­˜åŒºåŸŸã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼ŒYoung Generationå å †å†…å­˜çš„ 1/3, Old Generation å å †å†…å­˜çš„ 2/3ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼ŒEden:S0:S1 = 8:1:1 ,å¦‚æœå¸Œæœ›ä¸º 4:1:1ï¼Œä½¿ç”¨ -XX:SurvivorRatio=4ï¼Œä½†å®é™…ä¸Šè¿™ä¸ªæ¯”ä¾‹å¹¶ä¸æ˜¯å›ºå®šçš„ï¼Œè€Œæ˜¯ç”±jvmåŸºäºæƒ…å†µè‡ªåŠ¨å˜åŒ–çš„ï¼Œå› ä¸ºJVMé»˜è®¤å¼€å¯äº†è¿™ä¸ªå‚æ•°-XX:+UseAdaptiveSizePolicyï¼Œå¦‚æœå¸Œæœ›å›ºå®šè¿™ä¸ªæ¯”ä¾‹ï¼Œå¯ä»¥è®¾ç½®ä¸º -XX:-UseAdaptiveSizePolicyæ¥å…³é—­è¿™ä¸ªé…ç½®ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œå¯¹è±¡æœ€å¤šç»å†15æ¬¡Minor GCåè¿›å…¥è€å¹´ä»£ï¼Œå¯ä»¥é€šè¿‡ -XX:MaxTenuringThreshold=n è®¾ç½®ã€‚ åŒºåŸŸ è¯´æ˜ Eden å¯¹è±¡é¦–æ¬¡åˆ›å»ºçš„åŒºåŸŸï¼Œå¤§éƒ¨åˆ†å¯¹è±¡åœ¨è¿™é‡Œåˆ›å»ºå¹¶å¾ˆå¿«è¢«å›æ”¶ S0/S1 Survivor åŒºåŸŸï¼šä¸¤ä¸ªäº¤æ›¿ä½¿ç”¨çš„ç¼“å†²åŒºï¼ˆFrom å’Œ Toï¼‰ï¼Œç”¨äºæ‹·è´å­˜æ´»å¯¹è±¡ Old è€å¹´ä»£ï¼šå­˜æ´»æ¬¡æ•°å¤šã€ç”Ÿå‘½å‘¨æœŸé•¿çš„å¯¹è±¡ä¼šä»æ–°ç”Ÿä»£æ™‹å‡åˆ°è€å¹´ä»£ï¼Œå›æ”¶é¢‘ç‡ä½ å¯¹è±¡å†…å­˜åˆ†é…å›¾è§£(ç®€åŒ–) 12345678910111213åˆ›å»ºå¯¹è±¡ â†“è¿›å…¥ Eden åŒºï¼ˆæ–°ç”Ÿä»£ï¼‰ â†“ Eden åŒºæ»¡ç¬¬ä¸€æ¬¡ Minor GCï¼ˆå­˜æ´»å¯¹è±¡[Eden]å¤åˆ¶åˆ° S0ï¼‰ â†“ Eden åŒºæ»¡ æˆ– S0 åŒºæ»¡ç¬¬äºŒæ¬¡ Minor GCï¼ˆå­˜æ´»å¯¹è±¡[Edenå’ŒS0]å¤åˆ¶åˆ° S1ï¼Œå¹´é¾„ +1ï¼‰ â†“ Eden åŒºæ»¡ æˆ– S1 åŒºæ»¡ç¬¬ä¸‰æ¬¡ Minor GCï¼ˆå­˜æ´»å¯¹è±¡[Edenå’ŒS1]å¤åˆ¶åˆ° S0ï¼Œå¹´é¾„ +1ï¼‰ â†“â€¦â€¦ S0/S1 äº¤æ›¿ï¼Œå¹´é¾„è¾¾åˆ°é˜ˆå€¼ï¼ˆå¦‚ 15ï¼‰ â†“ è¿˜æ²¡æœ‰è¢«å›æ”¶æ™‹å‡åˆ° Old åŒºï¼ˆè€å¹´ä»£ï¼‰ï¼Œç­‰å¾…OldåŒºæ»¡ è§¦å‘ Full GC å¤§å¯¹è±¡ç›´æ¥è¿›å…¥è€å¹´ä»£ å¤§å¯¹è±¡å°±æ˜¯éœ€è¦å¤§é‡è¿ç»­å†…å­˜ç©ºé—´çš„å¯¹è±¡ï¼ˆæ¯”å¦‚ï¼šå­—ç¬¦ä¸²ã€æ•°ç»„ï¼‰ï¼Œå¦‚æœå¯¹è±¡å¾ˆå¤§ï¼ˆå¦‚è¶…è¿‡ Eden åŒºå¤§å°ï¼Œæˆ–æ˜¯è¶…è¿‡ Survivor åŒºå¤§å°ï¼‰ï¼Œå¯èƒ½ç›´æ¥åˆ†é…åˆ°è€å¹´ä»£ ä¹Ÿå¯ä»¥é€šè¿‡ -XX:PretenureSizeThreshold=&lt;å¤§å°ï¼Œå•ä½å­—èŠ‚&gt; æ§åˆ¶è¶…è¿‡ä¸€å®šå¤§å°çš„å¯¹è±¡æ˜¯å¦ç›´æ¥åˆ†é…åˆ°è€å¹´ä»£ï¼ˆOld Generationï¼‰ï¼Œè·³è¿‡æ–°ç”Ÿä»£ï¼ˆEdenï¼‰ï¼Œä»¥é¿å…å¤§å¯¹è±¡é¢‘ç¹åœ¨å¹´è½»ä»£é€ æˆ GC å‹åŠ›ã€‚è¿™ä¸ªå‚æ•°åªåœ¨ Serial å’ŒParNewä¸¤ä¸ªæ”¶é›†å™¨ä¸‹æœ‰æ•ˆã€‚ å¯¹è±¡åŠ¨æ€å¹´é¾„åˆ¤æ–­ å¯¹è±¡åœ¨SurvivoråŒºæ¥å›ç§»åŠ¨æ—¶ï¼Œå¦‚æœè¿™æ‰¹å¯¹è±¡çš„æ€»å¤§å°å¤§äºè¿™å—SurvivoråŒºåŸŸå†…å­˜å¤§å°çš„50%(-XX:TargetSurvivorRatioå¯ä»¥æŒ‡å®š)ï¼Œé‚£ä¹ˆæ­¤æ—¶å¤§äºç­‰äºè¿™æ‰¹å¯¹è±¡å¹´é¾„æœ€å¤§å€¼çš„å¯¹è±¡ï¼Œå°±å¯ä»¥ç›´æ¥è¿›å…¥è€å¹´ä»£äº†ï¼Œ ä¾‹å¦‚SurvivoråŒºåŸŸé‡Œç°åœ¨æœ‰ä¸€æ‰¹å¯¹è±¡ï¼Œå¹´é¾„1+å¹´é¾„2+å¹´é¾„nçš„å¤šä¸ªå¹´é¾„å¯¹è±¡æ€»å’Œè¶…è¿‡äº†SurvivoråŒºåŸŸçš„50%ï¼Œæ­¤æ—¶å°±ä¼šæŠŠå¹´é¾„n(å«)ä»¥ä¸Šçš„å¯¹è±¡éƒ½æ”¾å…¥è€å¹´ä»£ã€‚è¿™ä¸ªè§„åˆ™å…¶å®æ˜¯å¸Œæœ›é‚£äº›å¯èƒ½æ˜¯é•¿æœŸå­˜æ´»çš„å¯¹è±¡ï¼Œå°½æ—©è¿›å…¥è€å¹´ä»£ã€‚ å¯¹è±¡åŠ¨æ€å¹´é¾„åˆ¤æ–­æœºåˆ¶ä¸€èˆ¬æ˜¯åœ¨minor gcä¹‹åè§¦å‘çš„ã€‚ å¯¹è±¡é€ƒé€¸åˆ†æ å¦‚æœå¯¹è±¡å¾ˆå°ï¼Œä¸”åªåœ¨æ–¹æ³•å†…éƒ¨ä½¿ç”¨ï¼Œå¹¶æ²¡æœ‰è¢«å¤–éƒ¨å¼•ç”¨ï¼Œåˆ™å…¶æœ‰å¯èƒ½ç›´æ¥åˆ†é…åˆ°æ ˆå†…å­˜ï¼Œè€Œä¸è¿›å…¥å †å†…å­˜ JVMå¯¹äºè¿™ç§æƒ…å†µå¯ä»¥é€šè¿‡å¼€å¯é€ƒé€¸åˆ†æå‚æ•°(-XX:+DoEscapeAnalysis)æ¥ä¼˜åŒ–å¯¹è±¡å†…å­˜åˆ†é…ä½ç½®ï¼Œä½¿å…¶é€šè¿‡æ ‡é‡æ›¿æ¢ä¼˜å…ˆåˆ†é…åœ¨æ ˆä¸Š(æ ˆä¸Šåˆ†é…)ï¼ŒJDK7ä¹‹åé»˜è®¤å¼€å¯é€ƒé€¸åˆ†æï¼Œå¦‚æœè¦å…³é—­ä½¿ç”¨å‚æ•°(-XX:-DoEscapeAnalysis) æ ‡é‡æ›¿æ¢ é€šè¿‡é€ƒé€¸åˆ†æç¡®å®šè¯¥å¯¹è±¡ä¸ä¼šè¢«å¤–éƒ¨è®¿é—®ï¼Œå¹¶ä¸”å¯¹è±¡å¯ä»¥è¢«è¿›ä¸€æ­¥åˆ†è§£æ—¶ï¼ŒJVMä¸ä¼šåˆ›å»ºè¯¥å¯¹è±¡ï¼Œè€Œæ˜¯å°†è¯¥å¯¹è±¡æˆå‘˜å˜é‡åˆ†è§£è‹¥å¹²ä¸ªè¢«è¿™ä¸ªæ–¹æ³•ä½¿ç”¨çš„æˆå‘˜å˜é‡æ‰€ä»£æ›¿ï¼Œè¿™äº›ä»£æ›¿çš„æˆå‘˜å˜é‡åœ¨æ ˆå¸§æˆ–å¯„å­˜å™¨ä¸Šåˆ†é…ç©ºé—´ï¼Œè¿™æ ·å°±ä¸ä¼šå› ä¸ºæ²¡æœ‰ä¸€å¤§å—è¿ç»­ç©ºé—´å¯¼è‡´å¯¹è±¡å†…å­˜ä¸å¤Ÿåˆ†é…ã€‚ å¼€å¯æ ‡é‡æ›¿æ¢å‚æ•°(-XX:+EliminateAllocations)ï¼ŒJDK7ä¹‹åé»˜è®¤å¼€å¯ã€‚ æ ‡é‡ä¸èšåˆé‡ æ ‡é‡å³ä¸å¯è¢«è¿›ä¸€æ­¥åˆ†è§£çš„é‡ï¼Œè€ŒJAVAçš„åŸºæœ¬æ•°æ®ç±»å‹å°±æ˜¯æ ‡é‡ï¼ˆå¦‚ï¼šintï¼Œlongç­‰åŸºæœ¬æ•°æ®ç±»å‹ä»¥åŠreferenceç±»å‹ç­‰ï¼‰ï¼Œ æ ‡é‡çš„å¯¹ç«‹å°±æ˜¯å¯ä»¥è¢«è¿›ä¸€æ­¥åˆ†è§£çš„é‡ï¼Œè€Œè¿™ç§é‡ç§°ä¹‹ä¸ºèšåˆé‡ã€‚è€Œåœ¨JAVAä¸­å¯¹è±¡å°±æ˜¯å¯ä»¥è¢«è¿›ä¸€æ­¥åˆ†è§£çš„èšåˆé‡ã€‚ Parallel åƒåœ¾å›æ”¶å™¨ï¼ˆParallel GCï¼‰ çš„å·¥ä½œæ–¹å¼ Parallel GC æ˜¯å¤šçº¿ç¨‹åƒåœ¾å›æ”¶å™¨ï¼Œå¯ä»¥é€šè¿‡ -XX:ParallelGCThreads æ¥è®¾ç½®GCçº¿ç¨‹æ•°é‡ã€‚ å½“ Parallel GC è¢«è§¦å‘ï¼ˆä¾‹å¦‚ Minor GC æˆ– Full GCï¼‰æ—¶ï¼Œæ‰€æœ‰ç”¨æˆ·çº¿ç¨‹ è¢«å®Œå…¨æš‚åœï¼ˆStop-The-World, STWï¼‰ Parallel GC å‚æ•°é…ç½®è¡¨ï¼ˆååé‡ä¼˜å…ˆ GCï¼‰ å‚æ•°å è¯´æ˜ é»˜è®¤å€¼ï¼ˆå¦‚æœªç‰¹åˆ«è¯´æ˜ï¼‰ -XX:+UseParallelGC å¼€å¯ Parallel GCï¼Œç”¨äºæ–°ç”Ÿä»£æ”¶é›† - -XX:+UseParallelOldGC å¼€å¯è€å¹´ä»£å¹¶è¡Œæ”¶é›†ï¼ˆParallel Oldï¼‰ - -XX:ParallelGCThreads åƒåœ¾å›æ”¶æ—¶çš„å¹¶è¡Œçº¿ç¨‹æ•°ï¼ˆä¸ CPU æ•°é‡ç›¸å…³ï¼‰ æ ¹æ®ç¡¬ä»¶è‡ªåŠ¨é…ç½® -XX:MaxGCPauseMillis è®¾ç½® GC æœ€å¤§æš‚åœæ—¶é—´ç›®æ ‡ï¼ˆå½±å“å†…å­˜åˆ†é…ç­–ç•¥ï¼‰ ä¸€ä¸ªéå¸¸å¤§çš„å€¼ï¼Œå¯ä»¥è®¤ä¸ºæ— é™åˆ¶ï¼ˆå»ºè®®æŒ‰éœ€è®¾ç½®ï¼‰ -XX:GCTimeRatio è®¾ç½® GC æ—¶é—´ä¸åº”ç”¨è¿è¡Œæ—¶é—´çš„æ¯”å€¼ï¼ˆ0~100ï¼‰å€¼è¶Šå°ï¼ŒGC è¶Šé¢‘ç¹ï¼Œå€¼è¶Šå¤§ GC è¶Šå°‘ 99ï¼ˆè¡¨ç¤º 1% ç”¨äº GCï¼Œ99% ç”¨äºåº”ç”¨ï¼‰ -XX:+UseAdaptiveSizePolicy å¯ç”¨è‡ªé€‚åº” GC ç­–ç•¥ï¼ˆæ ¹æ®è¿è¡ŒçŠ¶å†µè‡ªåŠ¨è°ƒæ•´å„åŒºåŸŸå¤§å°ï¼‰ é»˜è®¤å¼€å¯ -XX:SurvivorRatio Eden ä¸ Survivor çš„å†…å­˜æ¯”ä¾‹ï¼ˆå¦‚ 8 è¡¨ç¤º Eden:S0:S1 = 8:1:1ï¼‰ 8 -XX:InitialTenuringThreshold å¯¹è±¡æ™‹å‡åˆ°è€å¹´ä»£çš„åˆå§‹å¹´é¾„ï¼ˆä¼šéšè¿è¡ŒåŠ¨æ€è°ƒæ•´ï¼‰ 7 -XX:MaxTenuringThreshold æ™‹å‡åˆ°è€å¹´ä»£çš„æœ€å¤§å¹´é¾„ï¼ˆå¯¹è±¡åœ¨ Survivor åŒºç»å†å‡ æ¬¡ GCï¼‰ 15 -XX:PretenureSizeThreshold è®¾ç½®å¤§å¯¹è±¡é˜ˆå€¼ï¼Œè¶…è¿‡è¯¥å¤§å°çš„å¯¹è±¡ç›´æ¥åˆ†é…åˆ°è€å¹´ä»£ 0ï¼ˆå³ç¦ç”¨ï¼‰ -XX:+ScavengeBeforeFullGC åœ¨ Full GC ä¹‹å‰æ˜¯å¦å…ˆæ‰§è¡Œä¸€æ¬¡ Minor GC trueå¯ -XX:+UseFastAccessorMethods ä¼˜åŒ–åŸå§‹ç±»å‹çš„ get/set æ–¹æ³•æ€§èƒ½ falseå¯ -XX:+AlwaysPreTouch JVM å¯åŠ¨æ—¶ç«‹å³åˆ†é…å¹¶åˆå§‹åŒ–æ‰€æœ‰å†…å­˜é¡µï¼Œé¿å…è¿è¡Œæ—¶é¦–æ¬¡åˆ†é…å¸¦æ¥çš„åœé¡¿ false åˆ†åŒºæ¨¡å‹ G1 åƒåœ¾å›æ”¶å™¨ G1(Garbage-First) å±äº ç‰©ç†ä¸Šåˆ†åŒºï¼Œé€»è¾‘ä¸Šåˆ†ä»£ï¼ŒçœŸæ­£çš„åˆ†åŒºæ¨¡å‹æ˜¯ ZGCï¼ˆjdk21åä¹Ÿæ”¯æŒåˆ†ä»£ï¼‰ G1å°†Javaå †åˆ’åˆ†ä¸ºå¤šä¸ªå¤§å°ç›¸ç­‰çš„Regionï¼ŒRegionå¤§å°æ˜¯2çš„å¹‚ï¼ŒèŒƒå›´åœ¨1MBåˆ°32MBä¹‹é—´ã€‚JDK9ä¹‹å‰é»˜è®¤æœ€å¤šæ”¯æŒ2048ä¸ªRegionï¼Œè¿™å°±å¯¼è‡´G1æœ€å¤§æ”¯æŒ64G çš„å † (2048 Regions Ã— 32MB = 64GB)ï¼ŒJDK10ä¹‹åçš„ç‰ˆæœ¬å¯æ”¯æŒæ›´å¤šRegionæ•°é‡ï¼ŒJDK17è¿›ä¸€æ­¥ä¼˜åŒ–äº†Regionæ˜ å°„æœºåˆ¶ï¼Œæå‡äº†å¤§å †åœºæ™¯ä¸‹çš„æ€§èƒ½ï¼Œä½¿å…¶å¯ä»¥æ”¯æŒæ›´å¤§çš„å†…å­˜ï¼Œä½†å¯¹äºè¶…å¤§å †ï¼ˆ&gt;1Tï¼‰ï¼Œè€ƒè™‘åˆ°GCæš‚åœæ—¶é—´ï¼Œå»ºè®®ä½¿ç”¨ZGCæˆ–Shenandoah GCã€‚ Regionä¸€æ—¦è¢«å›æ”¶ï¼Œé‡æ–°åˆ†é…æ—¶å¯ä»¥æ˜¯ä»»æ„ç±»å‹ï¼Œæ¯”å¦‚åŸå…ˆæ˜¯Edenï¼Œé‚£ä¹ˆé‡æ–°åˆ†é…æ—¶å¯ä»¥æ˜¯Oldï¼Œåä¹‹äº¦ç„¶ã€‚ ä¸€èˆ¬Regionå¤§å°ç”±JVMè‡ªåŠ¨è®¡ç®—ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ç”¨å‚æ•°-XX:G1HeapRegionSizeæ‰‹åŠ¨æŒ‡å®šRegionå¤§å°ï¼Œä½†æ˜¯æ¨èé»˜è®¤çš„è®¡ç®—æ–¹å¼ã€‚ G1ä¿ç•™äº†å¹´è½»ä»£å’Œè€å¹´ä»£çš„æ¦‚å¿µï¼Œä½†ä¸å†æ˜¯ç‰©ç†éš”é˜‚äº†ï¼Œå®ƒä»¬éƒ½æ˜¯ï¼ˆå¯ä»¥ä¸è¿ç»­ï¼‰Regionçš„é›†åˆã€‚ åœ¨ G1 GC ä¸­ï¼Œä¸è¦ä½¿ç”¨ -Xmnï¼ŒG1 ä¸­æ¨èä½¿ç”¨ä»¥ä¸‹æ›´ç»†ç²’åº¦çš„æ§åˆ¶æ–¹å¼ï¼š 123# è¿™æ˜¯å®éªŒæ€§å‚æ•°ï¼Œéœ€è¦å¼€å¯ `-XX:+UnlockExperimentalVMOptions`ï¼Œä½†ä¾æ—§æ¨èåœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨-XX:G1NewSizePercent=5-XX:G1MaxNewSizePercent=60 é»˜è®¤å¹´è½»ä»£å¯¹å †å†…å­˜çš„å æ¯”æ˜¯5%ï¼Œå¦‚æœå †å¤§å°ä¸º4096Mï¼Œé‚£ä¹ˆå¹´è½»ä»£å æ®200MBå·¦å³çš„å†…å­˜ï¼Œå¯¹åº”å¤§æ¦‚æ˜¯100ä¸ªRegionï¼Œå¯ä»¥é€šè¿‡ -XX:G1NewSizePercentè®¾ç½®æ–°ç”Ÿä»£åˆå§‹å æ¯”ï¼Œè¿™æ˜¯å®éªŒæ€§å‚æ•°ï¼Œéœ€è¦å¼€å¯ -XX:+UnlockExperimentalVMOptionsï¼Œä½†ä¾æ—§æ¨èåœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨ã€‚ åœ¨ç³»ç»Ÿè¿è¡Œä¸­ï¼ŒJVMä¼šä¸åœçš„ç»™å¹´è½»ä»£å¢åŠ æ›´å¤šçš„Regionï¼Œä½†æ˜¯æœ€å¤šæ–°ç”Ÿä»£çš„å æ¯”ä¸ä¼šè¶…è¿‡60%ï¼Œå¯ä»¥é€šè¿‡-XX:G1MaxNewSizePercentè°ƒæ•´ï¼Œè¿™æ˜¯å®éªŒæ€§å‚æ•°ï¼Œéœ€è¦å¼€å¯ -XX:+UnlockExperimentalVMOptionsï¼Œä½†ä¾æ—§æ¨èåœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨ã€‚ å¹´è½»ä»£ä¸­çš„Edenå’ŒSurvivorå¯¹åº”çš„regionä¹Ÿè·Ÿä¹‹å‰ä¸€æ ·ï¼Œé»˜è®¤8:1:1ï¼Œå‡è®¾å¹´è½»ä»£ç°åœ¨æœ‰1000ä¸ªregionï¼ŒedenåŒºå¯¹åº”800ä¸ªï¼Œs0å¯¹åº”100ä¸ªï¼Œs1å¯¹åº”100ä¸ªã€‚ ä¸€ä¸ªRegionå¯èƒ½ä¹‹å‰æ˜¯å¹´è½»ä»£ï¼Œå¦‚æœRegionè¿›è¡Œäº†åƒåœ¾å›æ”¶ï¼Œä¹‹åå¯èƒ½åˆä¼šå˜æˆè€å¹´ä»£ï¼Œä¹Ÿå°±æ˜¯è¯´Regionçš„åŒºåŸŸåŠŸèƒ½å¯èƒ½ä¼šåŠ¨æ€å˜åŒ–ã€‚ G1åƒåœ¾æ”¶é›†å™¨å¯¹äºå¯¹è±¡ä»€ä¹ˆæ—¶å€™ä¼šè½¬ç§»åˆ°è€å¹´ä»£è·Ÿä¹‹å‰è®²è¿‡çš„åŸåˆ™ä¸€æ ·ï¼Œå”¯ä¸€ä¸åŒçš„æ˜¯å¯¹å¤§å¯¹è±¡çš„å¤„ç†ï¼ŒG1æœ‰ä¸“é—¨åˆ†é…å¤§å¯¹è±¡çš„Regionå«HumongousåŒºï¼Œè€Œä¸æ˜¯è®©å¤§å¯¹è±¡ç›´æ¥è¿›å…¥è€å¹´ä»£çš„Regionä¸­ã€‚ åœ¨G1ä¸­ï¼Œå¤§å¯¹è±¡çš„åˆ¤å®šè§„åˆ™å°±æ˜¯ä¸€ä¸ªå¤§å¯¹è±¡è¶…è¿‡äº†ä¸€ä¸ªRegionå¤§å°çš„50%ï¼Œæ¯”å¦‚æŒ‰ç…§ä¸Šé¢ç®—çš„ï¼Œæ¯ä¸ªRegionæ˜¯2Mï¼Œåªè¦ä¸€ä¸ªå¤§å¯¹è±¡è¶…è¿‡äº†1Mï¼Œå°±ä¼šè¢«æ”¾å…¥Humongousä¸­ï¼Œè€Œä¸”ä¸€ä¸ªå¤§å¯¹è±¡å¦‚æœå¤ªå¤§ï¼Œå¯èƒ½ä¼šæ¨ªè·¨å¤šä¸ªRegionæ¥å­˜æ”¾ã€‚ HumongousåŒºä¸“é—¨å­˜æ”¾çŸ­æœŸå·¨å‹å¯¹è±¡ï¼Œä¸ç”¨ç›´æ¥è¿›è€å¹´ä»£ï¼Œå¯ä»¥èŠ‚çº¦è€å¹´ä»£çš„ç©ºé—´ï¼Œé¿å…å› ä¸ºè€å¹´ä»£ç©ºé—´ä¸å¤Ÿçš„GCå¼€é”€ã€‚ Full GCçš„æ—¶å€™é™¤äº†æ”¶é›†å¹´è½»ä»£å’Œè€å¹´ä»£ä¹‹å¤–ï¼Œä¹Ÿä¼šå°†HumongousåŒºä¸€å¹¶å›æ”¶ã€‚ G1åƒåœ¾æ”¶é›†åˆ†ç±» YoungGC YoungGCå¹¶ä¸æ˜¯è¯´ç°æœ‰çš„EdenåŒºæ”¾æ»¡äº†å°±ä¼šé©¬ä¸Šè§¦å‘ï¼ŒG1ä¼šè®¡ç®—ä¸‹ç°åœ¨EdenåŒºå›æ”¶å¤§æ¦‚è¦å¤šä¹…æ—¶é—´ï¼Œå¦‚æœå›æ”¶æ—¶é—´è¿œè¿œå°äºå‚æ•° -XX:MaxGCPauseMills è®¾å®šçš„å€¼ï¼Œé‚£ä¹ˆå¢åŠ å¹´è½»ä»£çš„regionï¼Œç»§ç»­ç»™æ–°å¯¹è±¡å­˜æ”¾ï¼Œä¸ä¼šé©¬ä¸ŠåšYoungGCï¼Œç›´åˆ°ä¸‹ä¸€æ¬¡EdenåŒºæ”¾æ»¡ï¼ŒG1è®¡ç®—å›æ”¶æ—¶é—´æ¥è¿‘å‚æ•° -XX:MaxGCPauseMills è®¾å®šçš„å€¼ï¼Œé‚£ä¹ˆå°±ä¼šè§¦å‘Young GC MixedGC ä¸æ˜¯FullGCï¼Œè€å¹´ä»£çš„å †å æœ‰ç‡è¾¾åˆ°å‚æ•° -XX:InitiatingHeapOccupancyPercent è®¾å®šçš„å€¼åˆ™è§¦å‘ï¼Œå›æ”¶æ‰€æœ‰çš„Youngå’Œéƒ¨åˆ†Old(æ ¹æ®æœŸæœ›çš„GCåœé¡¿æ—¶é—´ç¡®å®šoldåŒºåƒåœ¾æ”¶é›†çš„ä¼˜å…ˆé¡ºåº)ä»¥åŠå¤§å¯¹è±¡åŒºï¼Œæ­£å¸¸æƒ…å†µG1çš„åƒåœ¾æ”¶é›†æ˜¯å…ˆåšMixedGCï¼Œä¸»è¦ä½¿ç”¨å¤åˆ¶ç®—æ³•ï¼Œéœ€è¦æŠŠå„ä¸ªregionä¸­å­˜æ´»çš„å¯¹è±¡æ‹·è´åˆ°åˆ«çš„regioné‡Œå»ï¼Œæ‹·è´è¿‡ç¨‹ä¸­å¦‚æœå‘ç°æ²¡æœ‰è¶³å¤Ÿçš„ç©ºregionèƒ½å¤Ÿæ‰¿è½½æ‹·è´å¯¹è±¡å°±ä¼šè§¦å‘ä¸€æ¬¡Full GC Full GC åœæ­¢ç³»ç»Ÿç¨‹åºï¼Œç„¶åé‡‡ç”¨å•çº¿ç¨‹è¿›è¡Œæ ‡è®°ã€æ¸…ç†å’Œå‹ç¼©æ•´ç†ï¼Œå¥½ç©ºé—²å‡ºæ¥ä¸€æ‰¹Regionæ¥ä¾›ä¸‹ä¸€æ¬¡MixedGCä½¿ç”¨ï¼Œè¿™ä¸ªè¿‡ç¨‹æ˜¯éå¸¸è€—æ—¶çš„ã€‚(Shenandoahä¼˜åŒ–æˆå¤šçº¿ç¨‹æ”¶é›†äº†) G1 æ”¶é›†å™¨çš„å·¥ä½œæ–¹å¼(MixedGC) å›¾ä¸­ä¸»è¦å±•ç¤ºäº†ä¸€ä¸ªå…¸å‹çš„ G1 GC çš„ å¹¶å‘æ ‡è®°å‘¨æœŸï¼ˆConcurrent Mark Cycleï¼‰ çš„è¿‡ç¨‹ã€‚ å›¾ä¸­çš„æ°´å¹³ç®­å¤´è¡¨ç¤ºå„çº¿ç¨‹ï¼ˆç”¨æˆ·çº¿ç¨‹å’ŒGCçº¿ç¨‹ï¼‰çš„æ‰§è¡Œè·¯å¾„ã€‚ ç«–ç›´çš„Safepointçº¿è¡¨ç¤ºä¸€æ¬¡GCè¿‡ç¨‹ä¸­ä¼šæš‚åœæ‰€æœ‰ç”¨æˆ·çº¿ç¨‹çš„æ—¶åˆ»ï¼ˆStop-The-Worldï¼‰ã€‚ 12345678910111213141516171819202122231ï¸âƒ£ åˆå§‹æ ‡è®°ï¼ˆInitial Markï¼‰ è¿›å…¥ Safepointï¼š æ‰€æœ‰ç”¨æˆ·çº¿ç¨‹åœ¨æ­¤åˆ»æš‚åœï¼ˆSTWï¼‰ã€‚ æ ‡è®° GC Roots ç›´æ¥å¯è¾¾å¯¹è±¡ã€‚ éå¸¸çŸ­æš‚ï¼Œä½†å±äº Stop-The-World é˜¶æ®µã€‚ å›¾ä¸­æ˜¯â€œåˆå§‹æ ‡è®°â€ç®­å¤´åœ¨ Safepoint ä¹‹åç«‹åˆ»æ‰§è¡Œã€‚2ï¸âƒ£ å¹¶å‘æ ‡è®°ï¼ˆConcurrent Markï¼‰ ç”¨æˆ·çº¿ç¨‹ æ¢å¤è¿è¡Œï¼ˆå›¾ä¸­ç”¨æˆ·çº¿ç¨‹ç»§ç»­å‘å³å»¶ä¼¸ï¼‰ã€‚ GC çº¿ç¨‹ å¹¶å‘è¿›è¡Œæ ‡è®°å·¥ä½œï¼ˆå³åœ¨ç”¨æˆ·çº¿ç¨‹è¿è¡ŒæœŸé—´è¿›è¡Œæ ‡è®°ï¼‰ã€‚ å›¾ä¸­è“è‰²çš„â€œå¹¶å‘æ ‡è®°â€ç®­å¤´ä¸ç”¨æˆ·çº¿ç¨‹ç®­å¤´å¹¶è¡Œæ˜¾ç¤ºï¼Œè¡¨ç¤ºå¹¶å‘æ‰§è¡Œã€‚3ï¸âƒ£ æœ€ç»ˆæ ‡è®°ï¼ˆRemark / Final Markï¼‰ å†æ¬¡è¿›å…¥ Safepointã€‚ é‡æ–°æš‚åœæ‰€æœ‰ç”¨æˆ·çº¿ç¨‹ã€‚ å¤„ç†å¹¶å‘æ ‡è®°é˜¶æ®µä¸­é—æ¼çš„å¼•ç”¨æ›´æ–°ç­‰ä¿¡æ¯ï¼Œä¿è¯æ ‡è®°çš„å‡†ç¡®æ€§ã€‚4ï¸âƒ£ ç­›é€‰å›æ”¶ï¼ˆCleanup / Filtered Collectionï¼‰ å¯¹å·²æ ‡è®°çš„å¯¹è±¡åšæ¸…ç†ï¼ˆå›æ”¶ä¸å¯è¾¾å¯¹è±¡ï¼‰ã€‚ åˆ¤æ–­æ˜¯å¦éœ€è¦å›æ”¶æŸäº› Regionã€‚ å›¾ä¸­è“è‰²ç®­å¤´æ ‡æ³¨ä¸ºâ€œç­›é€‰å›æ”¶â€ã€‚5ï¸âƒ£ æ¢å¤ç”¨æˆ·çº¿ç¨‹ åœ¨æœ€åä¸€ä¸ª Safepoint ä¹‹åï¼Œæ‰€æœ‰ç”¨æˆ·çº¿ç¨‹é‡æ–°å¼€å§‹æ‰§è¡Œï¼ˆå›¾ä¸­é»„è‰²ç®­å¤´é‡æ–°å‘å³å»¶ä¼¸ï¼‰ã€‚ G1çš„GC è¿‡ç¨‹ä¼šç»å†å¤šæ¬¡Safepointï¼Œä½†åªæœ‰ å¹¶å‘æ ‡è®°é˜¶æ®µ æ˜¯æ•´ä¸ªå‘¨æœŸä¸­æœ€è€—æ—¶ä½†ä¸ä¼šæš‚åœç”¨æˆ·çº¿ç¨‹(STW)çš„éƒ¨åˆ†ã€‚ Safepointï¼ˆå®‰å…¨ç‚¹ï¼‰ åœ¨ JVMï¼ˆJava è™šæ‹Ÿæœºï¼‰ä¸­ï¼ŒSafepointï¼ˆå®‰å…¨ç‚¹ï¼‰ æ˜¯ä¸€ä¸ªéå¸¸é‡è¦çš„æ¦‚å¿µï¼Œå®ƒä»£è¡¨ æ‰€æœ‰çº¿ç¨‹å¿…é¡»â€œå®‰å…¨åœ°â€æš‚åœçš„æŸä¸ªæ—¶é—´ç‚¹ï¼Œä»¥ä¾¿ JVM èƒ½å¤Ÿæ‰§è¡ŒæŸäº›å…¨å±€æ“ä½œï¼Œæ¯”å¦‚ï¼š åƒåœ¾å›æ”¶ï¼ˆGCï¼‰ æ ˆéå†ï¼ˆä¾‹å¦‚ç”Ÿæˆå †å¿«ç…§ã€åšé€ƒé€¸åˆ†æç­‰ï¼‰ ç±»å¸è½½ JIT ç¼–è¯‘çš„ä¸€äº›é‡å†™æ“ä½œç­‰ å¦‚æœçº¿ç¨‹æ­£åœ¨è¿è¡Œã€æ”¹å˜å †ä¸­å¯¹è±¡çš„æ•°æ®ï¼Œé‚£ä¹ˆ GC å°±æ— æ³•å‡†ç¡®æ ‡è®°å’Œå›æ”¶å¯¹è±¡ã€‚å› æ­¤ JVM éœ€è¦ è®©æ‰€æœ‰çº¿ç¨‹åœ¨ä¸€ä¸ªâ€œå¯æ§ã€å®‰å…¨çš„ä½ç½®â€ä¸Šæš‚åœï¼Œè¿™ä¸ªä½ç½®å°±å« Safepointã€‚ Safepoint æ˜¯æ€ä¹ˆå·¥ä½œçš„ï¼Ÿ 1.JVM å‘å‡ºâ€œè¿›å…¥ Safepointâ€çš„ä¿¡å·ï¼ˆæ¯”å¦‚è¦å¼€å§‹ GCï¼‰ 2.æ‰€æœ‰çº¿ç¨‹æ”¶åˆ°ä¿¡å·åï¼Œå¿…é¡»ç­‰åˆ°â€œæœ€è¿‘çš„ Safepointâ€å†åœä¸‹æ¥ï¼š Safepoint ä¸æ˜¯ä»»æ„ä½ç½®éƒ½å¯ä»¥åœï¼Œå®ƒåªå‡ºç°åœ¨å­—èŠ‚ç ä¸­ä¸€äº›ç‰¹å®šçš„æŒ‡ä»¤ç‚¹ï¼ˆæ¯”å¦‚æ–¹æ³•è°ƒç”¨ã€å¾ªç¯è·³è½¬ç­‰ï¼‰ 3.ç­‰æ‰€æœ‰çº¿ç¨‹éƒ½è¿›å…¥ Safepoint åï¼ŒJVM æ‰èƒ½å¼€å§‹æ‰§è¡Œ GC ç­‰å…¨å±€æ“ä½œã€‚ G1 æ”¶é›†å™¨å‚æ•°é…ç½®è¡¨ å‚æ•°å è¯´æ˜ é»˜è®¤å€¼ -XX:+UseG1GC ä½¿ç”¨ G1 åƒåœ¾æ”¶é›†å™¨ - -XX:ParallelGCThreads æŒ‡å®š GC å·¥ä½œçš„çº¿ç¨‹æ•°é‡ ä¸ CPU æ•°é‡ç›¸å…³ -XX:G1HeapRegionSize è®¾ç½®å †åˆ†åŒºå¤§å°ï¼ˆ1MB~32MBï¼Œ2 çš„å¹‚ï¼‰ï¼Œå †é»˜è®¤åˆ’åˆ†ä¸º 2048 ä¸ª Region è‡ªåŠ¨è®¡ç®— -XX:MaxGCPauseMillis è®¾ç½® GC ç›®æ ‡æœ€å¤§æš‚åœæ—¶é—´ 200ms -XX:G1NewSizePercent æ–°ç”Ÿä»£åˆå§‹å æ¯”ï¼ˆå æ•´ä¸ªå †ï¼‰ï¼Œå®éªŒæ€§å‚æ•°ï¼Œ-XX:+UnlockExperimentalVMOptions 5% -XX:G1MaxNewSizePercent æ–°ç”Ÿä»£æœ€å¤§å æ¯”ï¼ˆå æ•´ä¸ªå †ï¼‰ï¼Œå®éªŒæ€§å‚æ•°ï¼Œ-XX:+UnlockExperimentalVMOptions 60% -XX:TargetSurvivorRatio Survivor åŒºå¡«å……ç›®æ ‡ï¼ˆè¶…è¿‡è¯¥æ¯”ä¾‹ï¼Œæ™‹å‡è€å¹´ä»£ï¼‰ 50% -XX:MaxTenuringThreshold æœ€å¤§å¯¹è±¡å¹´é¾„é˜ˆå€¼ï¼ˆå¹´é¾„è¶…è¿‡å°†è¿›å…¥è€å¹´ä»£ï¼‰ 15 -XX:InitiatingHeapOccupancyPercent è€å¹´ä»£çš„ä½¿ç”¨ç‡è¶…è¿‡è¯¥å€¼è§¦å‘ Mixed GC 45% -XX:G1MixedGCLiveThresholdPercent Mixed GC ä¸­ï¼šRegion å­˜æ´»å¯¹è±¡å æ¯”ä½äºè¯¥å€¼æ‰ä¼šè¢«å›æ”¶ï¼Œå®éªŒæ€§å‚æ•°ï¼Œ-XX:+UnlockExperimentalVMOptions 85% -XX:G1HeapWastePercent Mixed GC å›æ”¶ç›®æ ‡ï¼šç©ºé—² Region è¾¾å †æ€»é‡è¯¥ç™¾åˆ†æ¯”å°±ç»“æŸæ··åˆå›æ”¶ 5% -XX:G1ReservePercent ä¸ºæ»¡è¶³åœé¡¿æ—¶é—´ç›®æ ‡ä¿ç•™çš„å †ç©ºé—´æ¯”ä¾‹ï¼Œæ˜¯ä¸€ç§ç©ºé—´æ¢æ—¶é—´çš„ç­–ç•¥ï¼Œåœ¨å†…å­˜ä¸è¶³æ—¶å¯èƒ½é€ æˆå†…å­˜æ›´åŠ ç´§å¼  10% -XX:G1UseAdaptiveIHOP æ˜¯å¦å¯ç”¨è‡ªé€‚åº”IHOPï¼Œå¯ç”¨åG1ä¼šåœ¨åˆå§‹é‡‡æ ·åè‡ªåŠ¨è°ƒæ•´IHOPå€¼ true -XX:G1AdaptiveIHOPNumInitialSamples æŒ‡å®šå‰å‡ æ¬¡GCæ´»åŠ¨æŒ‰IHOPå‚æ•°è®¡ç®— 3 -XX:SoftRefLRUPolicyMSPerMB æ¯MBå †å†…å­˜ä¸­è½¯å¼•ç”¨çš„è¿‡æœŸæ—¶é—´(ms) 1000 -XX:G1OldCSetRegionThresholdPercent è®¾ç½®ä¸€æ¬¡æ··åˆGCä¸­éœ€è¦æ¸…ç†çš„OldåŒºçš„å†…å­˜æ¯”ä¾‹ï¼Œè°ƒå¤§å¯é™ä½G1é¢‘ç‡ä½†ä¼šå¢åŠ æ¯æ¬¡GCæ—¶é—´ 10% -XX:G1MixedGCCountTarget è®¾ç½®G1åƒåœ¾å›æ”¶å™¨çš„çº¿ç¨‹ä¸Šé™ï¼ŒHotSpotä¼šæ ¹æ®æ¸…ç†ç›®æ ‡è‡ªåŠ¨è®¡ç®—æ‰€éœ€çº¿ç¨‹æ•°ï¼Œä½†ä¸ä¼šè¶…è¿‡æ­¤ä¸Šé™ 8 ZGC åƒåœ¾å›æ”¶å™¨ ZGC(Z Garbage Collector)æ˜¯ä¸€æ¬¾JDK 11ä¸­æ–°åŠ å…¥çš„å…·æœ‰å®éªŒæ€§è´¨çš„ä½å»¶è¿Ÿåƒåœ¾æ”¶é›†å™¨ï¼ŒZGCå¯ä»¥è¯´æºè‡ªäºæ˜¯Azul Systemå…¬å¸å¼€å‘çš„C4ï¼ˆConcurrent Continuously Compacting Collectorï¼‰ æ”¶é›†å™¨ Platform Supported Since Comment Linux/x64 âœ… JDK 11 Linux/AArch64 âœ… JDK 13 macOS âœ… JDK 14 Windows âœ… JDK 14 Requires Windows version 1803 (Windows 10 or Windows Server 2019) or later. ZGCæ”¶é›†å™¨æ˜¯ä¸€æ¬¾åŸºäºRegionå†…å­˜å¸ƒå±€çš„ï¼Œæš‚æ—¶ä¸è®¾åˆ†ä»£çš„(jdk21åæ”¯æŒåˆ†ä»£)ï¼Œä½¿ç”¨äº†è¯»å±éšœã€é¢œè‰²æŒ‡é’ˆç­‰æŠ€æœ¯æ¥å®ç°å¯å¹¶å‘çš„æ ‡è®°-æ•´ç†ç®—æ³•çš„ï¼Œä»¥ä½å»¶è¿Ÿä¸ºé¦–è¦ç›®æ ‡çš„ä¸€æ¬¾åƒåœ¾æ”¶é›†å™¨ã€‚ é¢œè‰²æŒ‡é’ˆ åœ¨ ZGCï¼ˆZ Garbage Collectorï¼‰ä¸­ï¼Œé¢œè‰²æŒ‡é’ˆï¼ˆColored Pointerï¼‰æ˜¯ä¸€ç§æ ¸å¿ƒæœºåˆ¶ï¼ŒæŠŠå¯¹è±¡çš„ GC çŠ¶æ€ä¿¡æ¯ç›´æ¥åµŒå…¥åˆ°å¯¹è±¡çš„å¼•ç”¨ï¼ˆåœ°å€ï¼‰ä¸­ï¼Œç”¨äºåœ¨ä¸å¢åŠ å¯¹è±¡é¢å¤–å…ƒæ•°æ®çš„å‰æä¸‹ï¼Œè·Ÿè¸ªå¯¹è±¡åœ¨åƒåœ¾å›æ”¶è¿‡ç¨‹ä¸­çš„çŠ¶æ€ã€‚ åœ¨ä¼ ç»Ÿ GC ä¸­ï¼Œå¯¹è±¡çš„â€œé¢œè‰²â€ï¼ˆå¦‚ç™½è‰²ã€ç°è‰²ã€é»‘è‰²ï¼‰è¡¨ç¤ºå…¶åœ¨ GC ä¸åŒé˜¶æ®µçš„çŠ¶æ€ï¼Œè¿™äº›ä¿¡æ¯ä¸€èˆ¬å­˜å‚¨åœ¨é¢å¤–çš„æ•°æ®ç»“æ„ä¸­ï¼ˆå¦‚è®°å¿†é›†åˆã€ä½å›¾ç­‰ï¼‰ã€‚ è€Œåœ¨ ZGC ä¸­ï¼ŒZGC å°†å¯¹è±¡çš„è¿™äº›çŠ¶æ€ä¿¡æ¯ç¼–ç è¿›æŒ‡é’ˆçš„é«˜ä½ä¸­ã€‚æ‰€ä»¥ä¸€ä¸ªå¯¹è±¡å¼•ç”¨ï¼ˆpointerï¼‰ä¸ä»…ä»…æ˜¯å†…å­˜åœ°å€ï¼Œè¿˜æºå¸¦äº†å¯¹è±¡åœ¨ GC è¿‡ç¨‹ä¸­çš„â€œé¢œè‰²â€ä¿¡æ¯ã€‚ ZGC ä¸»è¦è¿è¡Œåœ¨ 64 ä½ç³»ç»Ÿä¸Šï¼Œä½†å½“å‰çš„æ“ä½œç³»ç»Ÿå’Œ CPU å®é™…ä¸Šåªä½¿ç”¨ 48ï½57 ä½è™šæ‹Ÿåœ°å€ã€‚ZGC åˆ©ç”¨æœªä½¿ç”¨çš„é«˜ä½è¿›è¡Œç¼–ç ã€‚ æ¯ä¸ªå¯¹è±¡æœ‰ä¸€ä¸ª64ä½æŒ‡é’ˆï¼Œè¿™64ä½è¢«åˆ†ä¸ºï¼š ä½æ•° åç§° å«ä¹‰ 18 ä½ é¢„ç•™ ä¿ç•™ä½ï¼Œæœªæ¥å¯èƒ½ç”¨äºæ‰©å±•åŠŸèƒ½ 1 ä½ Finalizable è¡¨ç¤ºå¯¹è±¡å¯ç»ˆç»“ï¼ˆå³å®ç°äº† finalize() æ–¹æ³•ï¼‰ 1 ä½ Remapped æ ‡è¯†å¯¹è±¡æ˜¯å¦å·²è¢«è½¬ç§»(ç”¨äºæ ‡è¯†æŸä¸ªå¼•ç”¨æ˜¯å¦å·²ç»è¢«é‡å®šå‘ï¼ˆæ›´æ–°ä¸ºæ–°åœ°å€ï¼‰)ï¼›ä¸º 1 è¡¨ç¤ºè¯¥å¯¹è±¡æœªåœ¨é‡å®šä½é›†ï¼ˆRelocation Setï¼‰ä¸­ï¼Œå³æ–°åœ°å€ï¼Œä¸º0è¡¨ç¤ºæ—§åœ°å€ 1 ä½ Marked1 æ ‡è®°ä½ä¹‹ä¸€ï¼Œç”¨äº GC è¿‡ç¨‹ä¸­çš„å¯¹è±¡æ ‡è®°é˜¶æ®µ ,ç”±äº ZGC æ˜¯å¹¶å‘ GCï¼Œéœ€è¦ä¸¤ä½æ¥æ”¯æŒé¢œè‰²åˆ‡æ¢æœºåˆ¶ï¼ˆColor Flipï¼‰ï¼Œç¡®ä¿åœ¨ä¸åŒ GC å‘¨æœŸä¸­å¯ä»¥åŒºåˆ†æ–°æ—§æ ‡è®°ï¼Œéœ€è¦è§¦å‘ä¸€æ¬¡è¯»å–å±éšœï¼ˆload barrierï¼‰ï¼Œæ‰¾åˆ°å¯¹è±¡çš„æ–°ä½ç½®ï¼Œå¹¶æ›´æ–°è¿™ä¸ªå¼•ç”¨ã€‚ 1 ä½ Marked0 å¦ä¸€ä¸ªæ ‡è®°ä½ï¼Œä¸ Marked1 é…åˆç”¨äº GC æ ‡è®°é˜¶æ®µ 42 ä½ å¯¹è±¡åœ°å€éƒ¨åˆ† å®é™…çš„å†…å­˜åœ°å€éƒ¨åˆ†ï¼Œæœ€å¤šå¯è¡¨ç¤º 2^42 å­—èŠ‚ï¼ˆå³ 4 TBï¼‰,jdk15åå ç”¨ 44ä½ï¼Œæ”¯æŒ 16TB è¯»å±éšœ ZGCï¼ˆZ Garbage Collectorï¼‰ä¸­çš„**è¯»å±éšœï¼ˆRead Barrierï¼‰æ˜¯å…¶æ ¸å¿ƒæœºåˆ¶ä¹‹ä¸€ï¼Œå®ƒä¿è¯äº†å¹¶å‘å‹ç¼©ï¼ˆå¯¹è±¡ç§»åŠ¨ï¼‰**æ—¶ç¨‹åºçš„æ­£ç¡®æ€§ï¼Œæ˜¯å®ç°ä½å»¶è¿Ÿã€é«˜å¹¶å‘åƒåœ¾å›æ”¶çš„å…³é”®ã€‚ åœ¨ä¼ ç»Ÿ GC ä¸­ï¼Œå¦‚æœå¯¹è±¡åœ¨ GC è¿‡ç¨‹ä¸­è¢«ç§»åŠ¨ï¼Œç¨‹åºè®¿é—®åˆ°çš„å¯¹è±¡åœ°å€å¯èƒ½å°±æ— æ•ˆäº†ã€‚å› æ­¤ï¼Œéœ€è¦**â€œåœä¸–ç•Œâ€**å°†æ‰€æœ‰å¼•ç”¨æ›´æ–°ã€‚ è€Œ ZGC çš„è®¾è®¡ç›®æ ‡æ˜¯ &lt;10ms çš„ GC åœé¡¿æ—¶é—´ï¼Œæ‰€ä»¥å®ƒé‡‡ç”¨ å¹¶å‘æ ‡è®° + å¹¶å‘ç§»åŠ¨ + å¹¶å‘å¼•ç”¨æ›´æ–° çš„æ¨¡å¼ã€‚åœ¨è¿™ç§æ¨¡å¼ä¸‹ï¼Œå¯¹è±¡å¯ä»¥åœ¨ç¨‹åºè¿è¡Œæ—¶è¢«ç§»åŠ¨ï¼Œä½†ç¨‹åºè®¿é—®æ—¶å¿…é¡»â€œçŸ¥é“â€è¿™ä¸ªå¯¹è±¡æ˜¯å¦å·²ç»è¢«ç§»åŠ¨ï¼Œå¹¶è·å–å…¶æœ€æ–°åœ°å€ï¼Œè¿™å°±æ˜¯è¯»å±éšœçš„èŒè´£ã€‚ è¯»å±éšœæ˜¯ä¸€ç§åœ¨è¯»å–å¯¹è±¡å¼•ç”¨æ—¶è‡ªåŠ¨æ’å…¥çš„é€»è¾‘ï¼Œç”¨äºæ£€æŸ¥å¼•ç”¨æ˜¯å¦æœ‰æ•ˆï¼Œå¹¶åœ¨å¿…è¦æ—¶è¿›è¡Œä¿®æ­£ï¼ˆå³åœ°å€é‡å®šå‘ï¼‰ã€‚ ZGC æ˜¯ç›®å‰å”¯ä¸€åœ¨æ‰€æœ‰å¯¹è±¡è®¿é—®ä¸­éƒ½ä½¿ç”¨è¯»å±éšœçš„ GCï¼Œå®ƒåœ¨æ¯æ¬¡å¯¹è±¡æŒ‡é’ˆè§£å¼•ç”¨æ—¶éƒ½è¿›è¡Œå¦‚ä¸‹æ“ä½œï¼š èŒè´£ è¯´æ˜ æ£€æµ‹å¼•ç”¨æ˜¯å¦æ˜¯è€åœ°å€ åˆ©ç”¨æŒ‡é’ˆä¸­çš„å…ƒä¿¡æ¯ï¼ˆé¢œè‰²æŒ‡é’ˆï¼Œå¦‚ Remapped ä½ï¼‰åˆ¤æ–­å¼•ç”¨æ˜¯å¦å·²ç»è¢«æ›´æ–° å¦‚æœæœªæ›´æ–°åˆ™é‡å®šå‘å¼•ç”¨ å¦‚æœå¼•ç”¨çš„æ˜¯æ—§åœ°å€ï¼Œå±éšœä¼šé€šè¿‡ forwarding table æ‰¾åˆ°æ–°åœ°å€å¹¶æ›´æ–° ä¿è¯æœ€ç»ˆè®¿é—®å¯¹è±¡çš„åœ°å€æ­£ç¡® å³ä½¿åœ¨å¯¹è±¡ç§»åŠ¨è¿‡ç¨‹ä¸­ï¼Œç¨‹åºä¹Ÿæ€»èƒ½è®¿é—®åˆ°æœ‰æ•ˆåœ°å€ï¼Œæ— éœ€åœé¡¿æ‰€æœ‰çº¿ç¨‹ graph TD A[ç¨‹åºè®¿é—®å¯¹è±¡å¼•ç”¨&lt;br&#x2F;&gt;ä¾‹å¦‚ï¼šPerson p &#x3D; personField] --&gt; B[JVM æ’å…¥è¯»å±éšœé€»è¾‘] B --&gt; C[è¯»å±éšœæ£€æŸ¥é¢œè‰²æŒ‡é’ˆä¸­çš„ Remapped ä½] C --&gt; D{Remapped ä½ä¸º 0 å—ï¼Ÿ} D -- æ˜¯ --&gt; E[æ£€æŸ¥å¯¹è±¡æ˜¯å¦å·²è¢«ç§»åŠ¨] E --&gt; F[æ›´æ–°å¼•ç”¨åœ°å€ä¸ºæ–°åœ°å€] F --&gt; G[è®¾ç½® Remapped ä½ä¸º 1] G --&gt; H[ä½¿ç”¨æ›´æ–°åçš„å¼•ç”¨è®¿é—®å¯¹è±¡] D -- å¦ --&gt; I[ç›´æ¥ä½¿ç”¨å½“å‰å¼•ç”¨è®¿é—®å¯¹è±¡] ZGCçš„Regionå¯ä»¥å…·æœ‰å¤§ã€ä¸­ã€å°ä¸‰ç±»å®¹é‡ï¼š å°å‹Regionï¼ˆSmall Regionï¼‰ ï¼š å®¹é‡å›ºå®šä¸º2MBï¼Œç”¨äºæ”¾ç½®å°äº256KBçš„å°å¯¹è±¡ã€‚ ä¸­å‹Regionï¼ˆMedium Regionï¼‰ ï¼š å®¹é‡å›ºå®šä¸º32MBï¼Œç”¨äºæ”¾ç½®å¤§äºç­‰äº256KBä½†å°äº4MBçš„å¯¹è±¡ã€‚ å¤§å‹Regionï¼ˆLarge Regionï¼‰ ï¼š å®¹é‡ä¸å›ºå®šï¼Œå¯ä»¥åŠ¨æ€å˜åŒ–ï¼Œä½†å¿…é¡»ä¸º2MBçš„æ•´æ•°å€ï¼Œç”¨äºæ”¾ç½®4MBæˆ–ä»¥ä¸Šçš„å¤§å¯¹è±¡ã€‚ æ¯ä¸ªå¤§å‹Regionä¸­åªä¼šå­˜æ”¾ä¸€ä¸ªå¤§å¯¹è±¡ï¼Œè¿™ä¹Ÿé¢„ç¤ºç€è™½ç„¶åå­—å«ä½œâ€œå¤§å‹Regionâ€ï¼Œä½†å®ƒçš„å®é™…å®¹é‡å®Œå…¨æœ‰å¯èƒ½å°äºä¸­å‹Regionï¼Œæœ€å°å®¹é‡å¯ä½è‡³4MBã€‚ ZGC ç‰¹ç‚¹ï¼š æ”¯æŒæå¤§å †ï¼ˆJDK 15 èµ·æ”¯æŒæœ€é«˜ 16TBï¼‰ GC åœé¡¿æ—¶é—´é€šå¸¸ä½äº 1msï¼ˆä¸å †å¤§å°åŸºæœ¬æ— å…³ï¼‰ é€‚åˆä½å»¶è¿Ÿã€é«˜ååã€é«˜å¯ç”¨çš„åº”ç”¨åœºæ™¯ï¼Œå¦‚äº¤æ˜“ç³»ç»Ÿã€å¹¿å‘Šæ¨èç­‰ ZGC æ”¶é›†å™¨çš„å·¥ä½œæ–¹å¼ 123456789101112131415161718192021221ï¸âƒ£ å¹¶å‘æ ‡è®°ï¼ˆConcurrent Markï¼‰ï¼š ä¸G1ä¸€æ ·ï¼Œå¹¶å‘æ ‡è®°æ˜¯éå†å¯¹è±¡å›¾åšå¯è¾¾æ€§åˆ†æçš„é˜¶æ®µï¼Œ å®ƒçš„åˆå§‹æ ‡è®°(Mark Start)å’Œæœ€ç»ˆæ ‡è®°(Mark End)ä¹Ÿä¼šå‡ºç°çŸ­æš‚çš„åœé¡¿ï¼Œ ä¸G1ä¸åŒçš„æ˜¯ï¼ŒZGCçš„æ ‡è®°æ˜¯åœ¨æŒ‡é’ˆä¸Šè€Œä¸æ˜¯åœ¨å¯¹è±¡ä¸Šè¿›è¡Œçš„ï¼Œ æ ‡è®°é˜¶æ®µä¼šæ›´æ–°æŸ“è‰²æŒ‡é’ˆä¸­çš„ Marked 0ã€ Marked 1 æ ‡å¿—ä½ã€‚2ï¸âƒ£ å¹¶å‘é¢„å¤‡é‡åˆ†é…ï¼ˆConcurrent Prepare for Relocateï¼‰ï¼š è¿™ä¸ªé˜¶æ®µéœ€è¦æ ¹æ®ç‰¹å®šçš„æŸ¥è¯¢æ¡ä»¶ç»Ÿè®¡å¾—å‡ºæœ¬æ¬¡æ”¶é›†è¿‡ç¨‹è¦æ¸…ç†å“ªäº›Regionï¼Œå°†è¿™äº›Regionç»„æˆé‡åˆ†é…é›†ï¼ˆRelocation Setï¼‰ã€‚ ZGCæ¯æ¬¡å›æ”¶éƒ½ä¼šæ‰«ææ‰€æœ‰çš„Regionï¼Œç”¨èŒƒå›´æ›´å¤§çš„æ‰«ææˆæœ¬æ¢å–çœå»G1ä¸­è®°å¿†é›†çš„ç»´æŠ¤æˆæœ¬ã€‚3ï¸âƒ£ å¹¶å‘é‡åˆ†é…ï¼ˆConcurrent Relocateï¼‰ï¼š é‡åˆ†é…æ˜¯ZGCæ‰§è¡Œè¿‡ç¨‹ä¸­çš„æ ¸å¿ƒé˜¶æ®µï¼Œè¿™ä¸ªè¿‡ç¨‹è¦æŠŠé‡åˆ†é…é›†ä¸­çš„å­˜æ´»å¯¹è±¡å¤åˆ¶åˆ°æ–°çš„Regionä¸Šï¼Œ å¹¶ä¸ºé‡åˆ†é…é›†ä¸­çš„æ¯ä¸ªRegionç»´æŠ¤ä¸€ä¸ªè½¬å‘è¡¨ï¼ˆForward Tableï¼‰ï¼Œè®°å½•ä»æ—§å¯¹è±¡åˆ°æ–°å¯¹è±¡çš„è½¬å‘å…³ç³»ã€‚ ZGCæ”¶é›†å™¨èƒ½ä»…ä»å¼•ç”¨ä¸Šå°±æ˜ç¡®å¾—çŸ¥ä¸€ä¸ªå¯¹è±¡æ˜¯å¦å¤„äºé‡åˆ†é…é›†ä¹‹ä¸­ï¼Œå¦‚æœç”¨æˆ·çº¿ç¨‹æ­¤æ—¶å¹¶å‘è®¿é—®äº†ä½äºé‡åˆ†é…é›†ä¸­çš„å¯¹è±¡ï¼Œ è¿™æ¬¡è®¿é—®å°†ä¼šè¢«é¢„ç½®çš„å†…å­˜å±éšœ(è¯»å±éšœ)æ‰€æˆªè·ï¼Œç„¶åç«‹å³æ ¹æ®Regionä¸Šçš„è½¬å‘è¡¨è®°å½•å°†è®¿é—®è½¬å‘åˆ°æ–°å¤åˆ¶çš„å¯¹è±¡ä¸Šï¼Œ å¹¶åŒæ—¶ä¿®æ­£æ›´æ–°è¯¥å¼•ç”¨çš„å€¼ï¼Œä½¿å…¶ç›´æ¥æŒ‡å‘æ–°å¯¹è±¡ï¼ŒZGCå°†è¿™ç§è¡Œä¸ºç§°ä¸ºæŒ‡é’ˆçš„â€œè‡ªæ„ˆâ€ï¼ˆSelf-Healingï¼‰èƒ½åŠ›ã€‚4ï¸âƒ£ å¹¶å‘é‡æ˜ å°„ï¼ˆConcurrent Remapï¼‰ï¼š é‡æ˜ å°„æ‰€åšçš„å°±æ˜¯ä¿®æ­£æ•´ä¸ªå †ä¸­æŒ‡å‘é‡åˆ†é…é›†ä¸­æ—§å¯¹è±¡çš„æ‰€æœ‰å¼•ç”¨ï¼Œä½†æ˜¯ZGCä¸­å¯¹è±¡å¼•ç”¨å­˜åœ¨â€œè‡ªæ„ˆâ€åŠŸèƒ½ï¼Œæ‰€ä»¥è¿™ä¸ªé‡æ˜ å°„æ“ä½œå¹¶ä¸æ˜¯å¾ˆè¿«åˆ‡ã€‚ ZGCå¾ˆå·§å¦™åœ°æŠŠå¹¶å‘é‡æ˜ å°„é˜¶æ®µï¼ˆConcurrent Remapï¼‰è¦åšçš„å·¥ä½œï¼Œåˆå¹¶åˆ°äº†ä¸‹ä¸€æ¬¡åƒåœ¾æ”¶é›†å¾ªç¯ä¸­çš„å¹¶å‘æ ‡è®°é˜¶æ®µï¼ˆConcurrent Markï¼‰é‡Œå»å®Œæˆï¼Œ åæ­£å®ƒä»¬éƒ½æ˜¯è¦éå†æ‰€æœ‰å¯¹è±¡çš„ï¼Œè¿™æ ·åˆå¹¶å°±èŠ‚çœäº†ä¸€æ¬¡éå†å¯¹è±¡å›¾çš„å¼€é”€ã€‚ ä¸€æ—¦æ‰€æœ‰æŒ‡é’ˆéƒ½è¢«ä¿®æ­£ä¹‹åï¼Œ åŸæ¥è®°å½•æ–°æ—§å¯¹è±¡å…³ç³»çš„è½¬å‘è¡¨å°±å¯ä»¥é‡Šæ”¾æ‰äº†ã€‚ ZGCå­˜åœ¨çš„é—®é¢˜ ZGCæœ€å¤§çš„é—®é¢˜æ˜¯æµ®åŠ¨åƒåœ¾ã€‚ZGCçš„åœé¡¿æ—¶é—´æ˜¯åœ¨10msä»¥ä¸‹ï¼Œä½†æ˜¯ZGCçš„æ‰§è¡Œæ—¶é—´è¿˜æ˜¯è¿œè¿œå¤§äºè¿™ä¸ªæ—¶é—´çš„ã€‚å‡å¦‚ZGCå…¨è¿‡ç¨‹éœ€è¦æ‰§è¡Œ10åˆ†é’Ÿï¼Œåœ¨è¿™ä¸ªæœŸé—´ç”±äºå¯¹è±¡åˆ†é…é€Ÿç‡å¾ˆé«˜ï¼Œå°†åˆ›å»ºå¤§é‡çš„æ–°å¯¹è±¡ï¼Œè¿™äº›å¯¹è±¡å¾ˆéš¾è¿›å…¥å½“æ¬¡GCï¼Œæ‰€ä»¥åªèƒ½åœ¨ä¸‹æ¬¡GCçš„æ—¶å€™è¿›è¡Œå›æ”¶ï¼Œè¿™äº›åªèƒ½ç­‰åˆ°ä¸‹æ¬¡GCæ‰èƒ½å›æ”¶çš„å¯¹è±¡å°±æ˜¯æµ®åŠ¨åƒåœ¾ã€‚ ZGCæ²¡æœ‰åˆ†ä»£æ¦‚å¿µï¼Œæ¯æ¬¡éƒ½éœ€è¦è¿›è¡Œå…¨å †æ‰«æï¼Œå¯¼è‡´ä¸€äº›â€œæœç”Ÿå¤•æ­»â€çš„å¯¹è±¡æ²¡èƒ½åŠæ—¶çš„è¢«å›æ”¶ã€‚ ç›®å‰å”¯ä¸€çš„åŠæ³•æ˜¯å¢å¤§å †çš„å®¹é‡ï¼Œä½¿å¾—ç¨‹åºå¾—åˆ°æ›´å¤šçš„å–˜æ¯æ—¶é—´ï¼Œä½†æ˜¯è¿™ä¸ªä¹Ÿæ˜¯ä¸€ä¸ªæ²»æ ‡ä¸æ²»æœ¬çš„æ–¹æ¡ˆã€‚å¦‚æœéœ€è¦ä»æ ¹æœ¬ä¸Šè§£å†³è¿™ä¸ªé—®é¢˜ï¼Œè¿˜æ˜¯éœ€è¦å¼•å…¥åˆ†ä»£æ”¶é›†ï¼Œè®©æ–°ç”Ÿå¯¹è±¡éƒ½åœ¨ä¸€ä¸ªä¸“é—¨çš„åŒºåŸŸä¸­åˆ›å»ºï¼Œç„¶åä¸“é—¨é’ˆå¯¹è¿™ä¸ªåŒºåŸŸè¿›è¡Œæ›´é¢‘ç¹ã€æ›´å¿«çš„æ”¶é›†ã€‚ JDK21æ­£å¼å¼•å…¥äº†åˆ†ä»£ï¼ˆjdk17æ˜¯é¢„è§ˆç‰ˆï¼‰ï¼Œå¯ä»¥åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨ï¼Œéœ€è¦æ‰‹åŠ¨å¼€å¯ï¼š-XX:+ZGenerational ZGC æ”¶é›†å™¨å‚æ•°é…ç½®è¡¨ å‚æ•°å è¯´æ˜ é»˜è®¤å€¼ï¼ˆå¦‚æœªç‰¹æ®Šæ ‡æ³¨ï¼‰ -XX:+UseZGC å¯ç”¨ ZGC åƒåœ¾æ”¶é›†å™¨ - -XX:+UnlockExperimentalVMOptions è§£é”å®éªŒæ€§å‚æ•°ï¼ˆJDK 11~14 ä½¿ç”¨ ZGC å¿…é¡»ï¼‰ - -XX:+UseLargePages å¯ç”¨å¤§é¡µå†…å­˜ï¼ˆæ€§èƒ½ä¼˜åŒ–ï¼‰ false -XX:+UseTransparentHugePages å¯ç”¨é€æ˜å¤§é¡µï¼ˆéƒ¨åˆ† Linux ä¸Šå¯ç»“åˆä½¿ç”¨ï¼‰ false -Xmx / -Xms è®¾ç½®æœ€å¤§/åˆå§‹å †å¤§å° ç”¨æˆ·é…ç½® -XX:ZUncommitDelay=&lt;ç§’&gt; æœªä½¿ç”¨å†…å­˜é‡Šæ”¾å›æ“ä½œç³»ç»Ÿçš„å»¶è¿Ÿæ—¶é—´ï¼ˆZGC ä¼šè‡ªåŠ¨é‡Šæ”¾å†…å­˜ï¼‰ 300ï¼ˆ5åˆ†é’Ÿï¼‰ -XX:SoftMaxHeapSize=&lt;å¤§å°&gt; è½¯æœ€å¤§å †ï¼ˆSoft Heap Limitï¼‰ï¼šZGC å°è¯•å°†ä½¿ç”¨çš„å †æ§åˆ¶åœ¨è¯¥å€¼ä»¥å†… é»˜è®¤ç­‰äº -Xmx -XX:MaxHeapFreeRatio æœ€å¤§å †ç©ºé—²æ¯”ä¾‹ï¼ˆè¶…è¿‡æ­¤æ¯”ä¾‹å¯èƒ½è§¦å‘å†…å­˜é‡Šæ”¾ï¼‰ 70 -XX:MinHeapFreeRatio æœ€å°å †ç©ºé—²æ¯”ä¾‹ï¼ˆä½äºæ­¤æ¯”ä¾‹å¯èƒ½è§¦å‘æ‰©å®¹ï¼‰ 40 -XX:+ZGenerational å¯ç”¨ ZGC åˆ†ä»£æ”¶é›†ï¼ˆä» JDK 21 èµ·æ”¯æŒï¼Œé»˜è®¤å…³é—­ï¼‰ falseï¼ˆJDK 21+ï¼‰ -XX:+PrintGC / -Xlog:gc* å¼€å¯ GC æ—¥å¿—è¾“å‡º - -XX:+ZProactive ä¸»åŠ¨å›æ”¶ç­–ç•¥ï¼ˆåœ¨ç³»ç»Ÿç©ºé—²æ—¶å°è¯•å›æ”¶ï¼‰ true -XX:ZCollectionInterval=&lt;ç§’&gt; ä¸»åŠ¨å›æ”¶ä¹‹é—´çš„æœ€å°æ—¶é—´é—´éš”ï¼ˆé…åˆ ZProactiveï¼‰ é»˜è®¤å€¼å› ç‰ˆæœ¬è€Œå¼‚ ZGC vs G1 GC vs Parallel GC å¯¹æ¯”è¡¨ ç‰¹æ€§ ZGC G1 GC Parallel GC è®¾è®¡ç›®æ ‡ æä½å»¶è¿Ÿï¼Œ&lt;1ms åœé¡¿ å¹³è¡¡ ä½å»¶è¿Ÿ ä¸ é«˜åå é«˜ååï¼Œæœ€å¤§åŒ– CPU ä½¿ç”¨ GC åœé¡¿æ—¶é—´ &lt;1msï¼Œå †å¤§å°å¢åŠ ä¸å½±å“åœé¡¿æ—¶é—´ å‡ ååˆ°å‡ ç™¾æ¯«ç§’ï¼Œå †è¶Šå¤§åœé¡¿è¶Šæ˜æ˜¾ åœé¡¿æ—¶é—´å¯èƒ½è¾¾åˆ°ç§’çº§ï¼Œå †è¶Šå¤§è¶Šæ˜æ˜¾ å †å¤§å°æ”¯æŒ æ”¯æŒé«˜è¾¾ 16TBï¼ˆJDK 15+ï¼‰ æ”¯æŒ æœ€å¤š 4TB æ”¯æŒå¤§å †ï¼Œä½†åœé¡¿æ˜æ˜¾ æ˜¯å¦åˆ†ä»£ é»˜è®¤ä¸åˆ†ä»£ï¼ˆJDK 21+ å¯å¼€å¯ -XX:+ZGenerationalï¼‰ åˆ†ä»£ï¼ˆæ–°ç”Ÿä»£ + è€å¹´ä»£ï¼‰ åˆ†ä»£ï¼ˆæ–°ç”Ÿä»£ + è€å¹´ä»£ï¼‰ å¹¶å‘å›æ”¶ æ˜¯ï¼ŒåŒ…æ‹¬æ ‡è®°ã€å‹ç¼©ã€å¼•ç”¨å¤„ç†éƒ½å¹¶å‘ éƒ¨åˆ†å¹¶å‘ï¼Œä»åŒ…å«æ˜æ˜¾ Stop-The-World é˜¶æ®µ å¦ï¼Œå…¨éƒ¨ Stop-The-World ç§»åŠ¨å¯¹è±¡æ—¶æ˜¯å¦åœé¡¿ å¦ï¼Œä½¿ç”¨è¯»å±éšœå¹¶å‘è½¬ç§»å¯¹è±¡ æ˜¯ï¼ˆé€šè¿‡å¤åˆ¶åŒºåŸŸï¼‰ æ˜¯ å®ç°æœºåˆ¶ æ ‡è®°-é‡å®šä½ï¼ŒåŸºäºè¯»å±éšœ Region åˆ†åŒº + æ ‡è®°-å¤åˆ¶ + Mixed GC æ ‡è®°-å¤åˆ¶ï¼ˆæ–°ç”Ÿä»£ï¼‰ã€æ ‡è®°-æ•´ç†ï¼ˆè€å¹´ä»£ï¼‰ ååèƒ½åŠ› ä¸­é«˜ é«˜ æœ€é«˜ é€‚ç”¨åœºæ™¯ ä½å»¶è¿Ÿç³»ç»Ÿï¼Œå¦‚é‡‘èã€äº¤æ˜“ã€æ¨èç­‰å®æ—¶åº”ç”¨ é€šç”¨åå°ç³»ç»Ÿã€Web æœåŠ¡ç­‰ æ‰¹å¤„ç†ã€æ•°æ®è®¡ç®—ã€æ—¥å¿—åˆ†æç­‰ä¸æ•æ„Ÿäºåœé¡¿çš„ç³»ç»Ÿ é»˜è®¤å¯ç”¨ å¦ï¼Œéœ€æŒ‡å®š -XX:+UseZGC JDK 9+ é»˜è®¤ GC JDK 8 åŠä»¥å‰é»˜è®¤ GC è°ƒä¼˜å¤æ‚åº¦ ä½ï¼Œå¤§å¤šæ•°å‚æ•°å¯çœç•¥ ä¸­ï¼Œéœ€è¦è®¾ç½®ç›®æ ‡åœé¡¿æ—¶é—´ç­‰ é«˜ï¼Œéœ€è¦ç²¾ç»†é…ç½® Eden/Survivor ç­‰æ¯”ä¾‹ GC æ—¥å¿—é…ç½®æ–¹å¼ ç»Ÿä¸€æ—¥å¿—æ ¼å¼ï¼š-Xlog:gc*ï¼ˆJDK 9+ï¼‰ æ”¯æŒä¼ ç»Ÿçš„ -XX:+PrintGCDetails å’Œ -Xlog:gc* æ—¥å¿—è¾“å‡º ä¸»è¦ä½¿ç”¨æ—§å‚æ•°ï¼š-XX:+PrintGCDetails ç­‰ ZGC ååèƒ½åŠ›è¾ƒå¼±çš„åŸå›  åŸå›  è§£é‡Š 1. å¹¶å‘é˜¶æ®µä»£ä»·è¾ƒé«˜ ZGC å‡ ä¹æ‰€æœ‰çš„ GC å·¥ä½œï¼ˆåŒ…æ‹¬æ ‡è®°ã€æ•´ç†ã€å¼•ç”¨å¤„ç†ã€è½¬ç§»å¯¹è±¡ï¼‰éƒ½åœ¨ä¸åº”ç”¨çº¿ç¨‹å¹¶å‘æ‰§è¡Œã€‚è™½ç„¶å‡å°‘äº†åœé¡¿ï¼Œä½†è¿™äº› GC çº¿ç¨‹ä¸ä¸šåŠ¡çº¿ç¨‹å…±äº« CPU èµ„æºï¼Œå¢åŠ äº† CPU ä¸Šä¸‹æ–‡åˆ‡æ¢å’Œç¼“å­˜ç«äº‰ï¼Œä»è€Œå½±å“ä¸šåŠ¡çº¿ç¨‹çš„æ‰§è¡Œæ•ˆç‡ã€‚ 2. è¯»å±éšœå¼€é”€ ZGC ä¾èµ–ç€è‰²æŒ‡é’ˆå’Œè¯»å±éšœï¼ˆload barrierï¼‰æœºåˆ¶æ¥è·Ÿè¸ªå¯¹è±¡å¼•ç”¨çŠ¶æ€ï¼Œæ”¯æŒå¹¶å‘è½¬ç§»ã€‚è™½ç„¶éå¸¸é«˜æ•ˆï¼Œä½†ä»æ¯”ä¼ ç»Ÿ GC çš„æ™®é€šè¯»å†™è·¯å¾„æ…¢ä¸€äº›ï¼Œåœ¨é«˜é¢‘è®¿é—®å¯¹è±¡åœºæ™¯ä¸‹ä¼šå¸¦æ¥ä¸€å®š CPU å¼€é”€ã€‚ 3. å¯¹ç¡¬ä»¶ä¾èµ–é«˜ï¼Œè°ƒåº¦ä¿å®ˆ ä¸ºäº†å®ç°â€œ&lt;1ms åœé¡¿â€çš„ç›®æ ‡ï¼ŒZGC ä¼šé€‰æ‹©æ›´ä¿å®ˆçš„è°ƒåº¦ç­–ç•¥ï¼ˆå¦‚é¿å…å¹¶å‘çº¿ç¨‹ä½¿ç”¨è¿‡å¤š CPUï¼‰ï¼Œè€Œä¸ä¼šåƒ Parallel GC é‚£æ ·â€œæ¦¨å¹²â€æ‰€æœ‰æ ¸å¿ƒèµ„æºã€‚ 4. å†…å­˜å¼€é”€æ›´é«˜ ä¸ºäº†æ”¯æŒå¹¶å‘å‹ç¼©å’Œè½¬ç§»ï¼ŒZGC é€šå¸¸éœ€è¦ä¸ºæ¯ä¸ªå¯¹è±¡ä¿ç•™å…ƒæ•°æ®å’Œæ›´å¤šçš„è½¬ç§»ç©ºé—´ï¼ˆå³â€œæµ®åŠ¨åƒåœ¾â€åŒºåŸŸï¼‰ï¼Œè¿™å¯èƒ½å¯¼è‡´é¢‘ç¹çš„ GC å‘¨æœŸï¼Œå½±å“ååã€‚ 5. è®¾è®¡ç›®æ ‡éååä¼˜å…ˆ ZGC çš„é¦–è¦ç›®æ ‡æ˜¯ä½å»¶è¿Ÿè€Œéæœ€å¤§ååã€‚ä¸ Parallel GCï¼ˆä»¥ååä¸ºæ ¸å¿ƒï¼‰è®¾è®¡ç›®æ ‡ä¸åŒï¼ŒZGC æ›´é€‚åˆåœºæ™¯ä¸ºâ€œå¯¹å»¶è¿Ÿæ•æ„Ÿä½†ååå¯æ¥å—â€çš„ç³»ç»Ÿã€‚ æœ€ç³Ÿç³•çš„æƒ…å†µä¸‹ååé‡ä¼šé™ä½15%ã€‚è¿™éƒ½ä¸æ˜¯äº‹ï¼Œåœé¡¿æ—¶é—´è¶³å¤Ÿä¼˜ç§€ã€‚è‡³äºååé‡ï¼Œé€šè¿‡æ‰©å®¹åˆ†åˆ†é’Ÿè§£å†³ã€‚ å¦å¤–ï¼ŒOracleå®˜æ–¹æåˆ°äº†å®ƒæœ€å¤§çš„ä¼˜ç‚¹æ˜¯ï¼šå®ƒçš„åœé¡¿æ—¶é—´ä¸ä¼šéšç€å †çš„å¢å¤§è€Œå¢é•¿ï¼ ä¹Ÿå°±æ˜¯è¯´ï¼Œå‡ åGå †çš„åœé¡¿æ—¶é—´æ˜¯10msä»¥ä¸‹ï¼Œå‡ ç™¾Gç”šè‡³ä¸ŠTå †çš„åœé¡¿æ—¶é—´ä¹Ÿæ˜¯10msä»¥ä¸‹ã€‚ ZGC ååå¼±ï¼Œä¸æ˜¯å› ä¸ºæŠ€æœ¯è½åï¼Œè€Œæ˜¯å› ä¸ºå®ƒä¸»åŠ¨é€‰æ‹©åœ¨ä½å»¶è¿Ÿå’Œé«˜ååä¹‹é—´åå‘äº†ä½å»¶è¿Ÿã€‚ åœ¨å¯¹å“åº”æ—¶é—´è¦æ±‚æé«˜çš„ç³»ç»Ÿä¸­ï¼Œå®ƒæ˜¯éå¸¸åˆé€‚çš„é€‰æ‹©ã€‚ ä½†å¦‚æœä½ çš„ç›®æ ‡æ˜¯å‹æ¦¨æœºå™¨æ€§èƒ½è·‘æ‰¹å¤„ç†ã€æ—¥å¿—åˆ†æè¿™ç±»ååå¯¼å‘å‹ä»»åŠ¡ï¼ŒParallel GC æˆ– G1 ä¼šæ›´åˆé€‚ã€‚ å†…å­˜æº¢å‡º(OutOfMemoryErrorï¼Œç®€ç§° OOM) JVM å¸¸è§å†…å­˜æº¢å‡ºç±»å‹æ±‡æ€»è¡¨ æº¢å‡ºç±»å‹ å¼‚å¸¸ä¿¡æ¯ è§¦å‘åŸå› /æè¿° ç›¸å…³å‚æ•°å’Œå»ºè®®é…ç½® å †å†…å­˜æº¢å‡º java.lang.OutOfMemoryError: Java heap space - åˆ›å»ºå¤§é‡å¯¹è±¡ï¼Œå †ç©ºé—´ä¸è¶³- å†…å­˜æ³„æ¼ï¼šå¯¹è±¡ä¸å†ä½¿ç”¨å´æœ‰å¼ºå¼•ç”¨- è€å¹´ä»£å¯¹è±¡å¤ªå¤šæ— æ³•æ™‹å‡ -Xms / -Xmx è®¾ç½®å †å¤§å° æ ˆæº¢å‡ºï¼ˆé€’å½’ï¼‰ java.lang.StackOverflowError - æ–¹æ³•æ— é™é€’å½’æˆ–é€’å½’å±‚çº§å¤ªæ·± -Xss è®¾ç½®çº¿ç¨‹æ ˆå¤§å° æ— æ³•åˆ›å»ºæ–°çº¿ç¨‹ java.lang.OutOfMemoryError: unable to create new native thread - åˆ›å»ºçº¿ç¨‹è¿‡å¤šï¼ˆå¦‚çº¿ç¨‹æ± é…ç½®è¿‡å¤§ï¼‰- ç³»ç»Ÿæˆ– JVM native çº¿ç¨‹èµ„æºè€—å°½ æ§åˆ¶çº¿ç¨‹æ± å¤§å°ï¼Œé¿å…æ— é™æ–°å»ºçº¿ç¨‹ å…ƒç©ºé—´æº¢å‡º java.lang.OutOfMemoryError: Metaspace - åŠ¨æ€åŠ è½½ç±»è¿‡å¤šï¼ˆå¦‚ä½¿ç”¨ CGLIBã€JSP åŠ¨æ€ç”Ÿæˆç±»ï¼‰- ç±»æ— æ³•å¸è½½ï¼ˆå¦‚ ClassLoader æ³„æ¼ï¼‰ -XX:MetaspaceSize / -XX:MaxMetaspaceSize ç›´æ¥å†…å­˜æº¢å‡º java.lang.OutOfMemoryError: Direct buffer memory - ä½¿ç”¨ ByteBuffer.allocateDirect() åˆ†é…å¤§é‡ç›´æ¥å†…å­˜- Netty ç­‰æ¡†æ¶é»˜è®¤ä½¿ç”¨ç›´æ¥å†…å­˜ -XX:MaxDirectMemorySize GC å¼€é”€è¿‡é«˜ java.lang.OutOfMemoryError: GC overhead limit exceeded - JVM èŠ±è´¹ &gt;98% çš„æ—¶é—´ GC ä½†å›æ”¶ &lt;2% çš„å†…å­˜ï¼Œè®¤ä¸ºè¿›å…¥â€œGC æ­»å¾ªç¯â€ åˆ†æ GC æ—¥å¿—ã€ä¼˜åŒ–å †è®¾ç½® ç±»å¸è½½å¤±è´¥ï¼ˆå†…å­˜æ³„æ¼ï¼‰ ï¼ˆä¸ä¸€å®šæŠ¥é”™ï¼Œä½†å¯èƒ½å¯¼è‡´ Metaspace OOMï¼‰ - Web å®¹å™¨é¢‘ç¹éƒ¨ç½²çƒ­æ›´æ–° WAR åŒ…æ—¶ï¼ŒClassLoader æ— æ³•å¸è½½ï¼Œå¯¼è‡´ç±»æ°¸ä¹…é©»ç•™ ä¼˜åŒ– ClassLoader ç®¡ç†ï¼Œä½¿ç”¨å†…å­˜åˆ†æå·¥å…· å †å¿«ç…§(å †è½¬å‚¨)æ–‡ä»¶åˆ†æ å‚æ•° è¯´æ˜ -XX:+HeapDumpOnOutOfMemoryError OOM æ—¶ç”Ÿæˆå †è½¬å‚¨æ–‡ä»¶ ,å»ºè®®ç”Ÿäº§ç¯å¢ƒå¼€å¯ -XX:HeapDumpPath=xxx.hprof æŒ‡å®šå †è½¬å‚¨æ–‡ä»¶ä¿å­˜è·¯å¾„ é»˜è®¤ä¿å­˜åœ¨å½“å‰ç›®å½• å¸¸ç”¨åˆ†æå·¥å…·ä¸å‘½ä»¤ å·¥å…·/å‘½ä»¤ ç®€ä»‹ä¸åŠŸèƒ½ ä½¿ç”¨è¯´æ˜ MATï¼ˆMemory Analyzer Toolï¼‰ Eclipse å‡ºå“çš„å¼ºå¤§å›¾å½¢å·¥å…·ï¼Œæ”¯æŒæ³„æ¼åˆ†æã€å¯¹è±¡å¼•ç”¨é“¾åˆ†æã€å†…å­˜å ç”¨ç»Ÿè®¡ç­‰ ä¸‹è½½åœ°å€ï¼šhttps://www.eclipse.org/mat/æ‰“å¼€åç›´æ¥å¯¼å…¥ .hprof æ–‡ä»¶å³å¯åˆ†æ VisualVM å®˜æ–¹å¯è§†åŒ– JVM ç›‘æ§å·¥å…·ï¼Œæ”¯æŒå®æ—¶åˆ†æã€GC æŸ¥çœ‹ã€çº¿ç¨‹çŠ¶æ€ä¸å †è½¬å‚¨æŸ¥çœ‹ é™„å¸¦äº JDKï¼ˆæˆ–å•ç‹¬å®‰è£…ï¼‰ï¼Œæ‰“å¼€ .hprof æ–‡ä»¶è¿›è¡Œå¯è§†åŒ–åˆ†æ JProfiler å•†ä¸šçº§ Java æ€§èƒ½åˆ†æå·¥å…·ï¼Œæä¾›å †åˆ†æã€CPU åˆ†æã€çº¿ç¨‹åˆ†æç­‰å…¨å¥—åŠŸèƒ½ æ”¯æŒæ‰“å¼€ .hprof æ–‡ä»¶ï¼Œä¹Ÿå¯åœ¨è¿è¡Œæ—¶é…åˆä½¿ç”¨ï¼ˆéœ€ä»˜è´¹æˆ–è¯•ç”¨ï¼‰ YourKit å•†ä¸šæ€§èƒ½åˆ†æå·¥å…·ï¼Œç•Œé¢å‹å¥½ï¼Œæ”¯æŒä¸°å¯Œçš„åˆ†æåŠŸèƒ½ æ”¯æŒå †åˆ†æï¼Œé€‚åˆå†…å­˜æ³„æ¼æ’æŸ¥ jhatï¼ˆè¿‡æ—¶ï¼‰ JDK é™„å¸¦çš„æ—§å·¥å…·ï¼Œç”¨äºåˆ†æ .hprof æ–‡ä»¶ï¼Œå¼€å¯ Web ç•Œé¢æŸ¥çœ‹ï¼ˆå·²åºŸå¼ƒï¼‰ å‘½ä»¤ï¼šjhat heapdump.hprofï¼Œæµè§ˆå™¨è®¿é—® http://localhost:7000ï¼ˆJDK 8 åŠä»¥ä¸‹ï¼‰ jmap ç”¨äºç”Ÿæˆå †è½¬å‚¨æ–‡ä»¶æˆ–æŸ¥çœ‹å †å¯¹è±¡ç»Ÿè®¡ä¿¡æ¯ï¼ˆä¸æ˜¯åˆ†æå·¥å…·æœ¬èº«ï¼‰ å‘½ä»¤ï¼šjmap -dump:format=b,file=heap.hprof &lt;pid&gt; ç”Ÿæˆè½¬å‚¨ï¼›é…åˆ MAT ä½¿ç”¨ jcmd æ›´ç°ä»£çš„è¯Šæ–­å‘½ä»¤å·¥å…·ï¼Œå¯ç”Ÿæˆ heap dumpã€æ‰§è¡Œ GCã€æ‰“å° VM çŠ¶æ€ç­‰ å‘½ä»¤ï¼šjcmd &lt;pid&gt; GC.heap_dump heap.hprof GCEasy.io åœ¨çº¿åˆ†æå·¥å…·ï¼Œæ”¯æŒ .hprof æ–‡ä»¶å’Œ GC æ—¥å¿—ä¸Šä¼ åˆ†æ ç½‘ç«™ï¼šhttps://gceasy.io GCæ—¥å¿—ç›¸å…³å‚æ•°(JDK1.8åŠä»¥ä¸‹) å‚æ•° è¯´æ˜ -XX:+PrintGC æ‰“å°åŸºæœ¬ GC ä¿¡æ¯ï¼ˆå»ºè®®é…åˆ -XX:+PrintGCDetails ä½¿ç”¨ï¼‰,ä¸-verbose:gcç­‰ä»· -XX:+PrintGCDetails æ‰“å°è¯¦ç»†çš„ GC æ—¥å¿—ä¿¡æ¯ï¼ˆå¦‚å„åŒºåŸŸä½¿ç”¨æƒ…å†µã€å¯¹è±¡åˆ†é…ã€æ™‹å‡ç­‰ï¼‰ -XX:+PrintGCDateStamps åœ¨ GC æ—¥å¿—ä¸­æ·»åŠ æ—¥æœŸæ—¶é—´æˆ³ -XX:+PrintGCTimeStamps åœ¨ GC æ—¥å¿—ä¸­æ·»åŠ  JVM å¯åŠ¨ä»¥æ¥çš„æ—¶é—´æˆ³ -Xloggc:/var/log/myapp/gc.log å°† GC æ—¥å¿—è¾“å‡ºåˆ°æŒ‡å®šæ–‡ä»¶ -XX:+UseGCLogFileRotation å¯ç”¨ GC æ—¥å¿—æ–‡ä»¶è½®è½¬ï¼ˆé€‚ç”¨äºå¤§è§„æ¨¡ç³»ç»Ÿçš„ GC æ—¥å¿—ç®¡ç†ï¼‰ -XX:NumberOfGCLogFiles=5 æœ€å¤šä¿ç•™ 5 ä¸ª GC æ—¥å¿—å†å²æ–‡ä»¶ -XX:GCLogFileSize=10M æ¯ä¸ª GC æ—¥å¿—æ–‡ä»¶æœ€å¤§ä¸º 10MB -XX:+PrintGCCause æ‰“å° GC çš„è§¦å‘åŸå› ï¼ˆå¦‚ Minor GCã€System.gc() ç­‰ï¼‰ GCæ—¥å¿—ç›¸å…³å‚æ•°(JDK9+) -Xlog æ˜¯ç”¨äºé…ç½® JVM æ—¥å¿—è®°å½•çš„å‚æ•°ï¼Œå®ƒæ˜¯ä» JDK 9 å¼€å§‹å¼•å…¥çš„ç»Ÿä¸€æ—¥å¿—æ¡†æ¶ï¼ˆUnified Loggingï¼‰çš„ä¸€éƒ¨åˆ†ã€‚ é€šè¿‡ -Xlog é€‰é¡¹ï¼Œä½ å¯ä»¥æ§åˆ¶æ—¥å¿—çš„ æ ‡ç­¾ï¼ˆtagsï¼‰ã€è¾“å‡ºçº§åˆ«ï¼ˆlevelï¼‰ã€è¾“å‡ºä½ç½®ï¼ˆoutputï¼‰ ç­‰å†…å®¹ã€‚ åŸºæœ¬æ ¼å¼ 1-Xlog[:[tag1[,tag2...]][[:level][:[output][:[decorators][:rotation]]]]] å¸¸è§ Tagsï¼ˆæ ‡ç­¾ï¼‰ ç±»åˆ« æ ‡ç­¾ å«ä¹‰ ç”¨é€”ç¤ºä¾‹ ç±»åŠ è½½ classload JVM ç±»åŠ è½½æ´»åŠ¨çš„æ€»ä½“ä¿¡æ¯ è§‚å¯Ÿç±»åŠ è½½å¤±è´¥æˆ–é‡å¤åŠ è½½ class+load æ˜¾ç¤ºæ¯ä¸ªç±»åŠ è½½è¿‡ç¨‹ç»†èŠ‚ å®šä½ç±»åŠ è½½å¼‚å¸¸ã€çƒ­åŠ è½½åˆ†æ class+unload è®°å½•ç±»å¸è½½äº‹ä»¶ åˆ†æç±»å¸è½½æ—¶æœºæˆ–å†…å­˜é‡Šæ”¾æƒ…å†µ åƒåœ¾å›æ”¶ gc æ€»ä½“ GC æ´»åŠ¨ä¿¡æ¯ GC è°ƒä¼˜å…¥é—¨ä½¿ç”¨ gc+start GC äº‹ä»¶å¼€å§‹æ—¶é—´ä¸ç±»å‹ æŸ¥çœ‹ GC é¢‘ç‡ä¸è§¦å‘ç‚¹ gc+heap GC å‰åçš„å †ä½¿ç”¨æƒ…å†µ åˆ†æå †ä½¿ç”¨ä¸åˆ†åŒºå æ¯” gc+phases GC å†…éƒ¨é˜¶æ®µç»†èŠ‚ G1/ZGC ç­‰è°ƒè¯•ç”¨ gc+age å¹´é¾„åˆ†å¸ƒæƒ…å†µ åˆ¤æ–­å¯¹è±¡æ™‹å‡è·¯å¾„ã€è€å¹´ä»£å‹åŠ› gc+ergo GC çš„è‡ªé€‚åº”è°ƒæ•´å†³ç­– æŸ¥çœ‹çº¿ç¨‹ã€å †å¤§å°è‡ªåŠ¨è°ƒæ•´é€»è¾‘ JIT ç¼–è¯‘ jit JIT ç¼–è¯‘æ—¥å¿—å…¥å£ æ€§èƒ½çƒ­ç‚¹æ–¹æ³•åˆ†æ compiler æ˜¾ç¤ºæ–¹æ³•ç¼–è¯‘ã€æ—¶é—´ç­‰ åˆ¤æ–­æ˜¯å¦æœ‰æ–¹æ³•æœªè¢«ä¼˜åŒ– codecache å·²ç¼–è¯‘ä»£ç å­˜å‚¨åŒºä½¿ç”¨æƒ…å†µ åˆ¤æ–­æ˜¯å¦è¾¾åˆ°ç¼“å­˜ä¸Šé™ nmethod JIT ç”Ÿæˆçš„ native æ–¹æ³•ç”Ÿå‘½å‘¨æœŸ è§‚å¯Ÿ native ä»£ç ç”Ÿæˆä¸å¸è½½ å†…å­˜ memory æ€»ä½“å†…å­˜ä½¿ç”¨æƒ…å†µ è¯Šæ–­å†…å­˜æ³„æ¼æˆ–æº¢å‡º gc+heap å †ç»“æ„ä¸å ç”¨æƒ…å†µ ä¸ GC è”åˆåˆ†æä½¿ç”¨ os+memory JVM ä¸æ“ä½œç³»ç»Ÿé—´çš„å†…å­˜äº¤äº’ åˆ¤æ–­æ˜¯å¦ç³»ç»Ÿå±‚å†…å­˜ç”³è¯·å¤±è´¥ çº¿ç¨‹ thread çº¿ç¨‹çš„åˆ›å»ºã€ç»ˆæ­¢ã€çŠ¶æ€å˜åŒ– çº¿ç¨‹æ³„æ¼æˆ–é¢‘ç¹åˆ›å»ºæ’æŸ¥ safepoint JVM è¿›å…¥/é€€å‡º safepoint çš„ä¿¡æ¯ åˆ†æ STW åœé¡¿æ—¶é—´ä¸é¢‘ç‡ é”ä¸åŒæ­¥ synchronization é”ç«äº‰ã€è·å–å’Œé‡Šæ”¾ä¿¡æ¯ åˆ†ææ€§èƒ½ç“¶é¢ˆä¸­çš„é”äº‰ç”¨ monitorinflation è½»é‡çº§é”å‡çº§ä¸ºé‡é‡çº§é”è¿‡ç¨‹ æ’æŸ¥é”è†¨èƒ€å¯¼è‡´çš„å»¶è¿Ÿé—®é¢˜ æ“ä½œç³»ç»Ÿäº¤äº’ os JVM ä¸æ“ä½œç³»ç»Ÿäº¤äº’æ—¥å¿— å¸¸è§„ç³»ç»Ÿèµ„æºè¯·æ±‚ä¿¡æ¯ os+thread OS å±‚çº§çº¿ç¨‹ç®¡ç†ä¿¡æ¯ é«˜å¹¶å‘æ—¶çº¿ç¨‹ç»‘å®šä¸è°ƒåº¦åˆ†æ os+cpu CPU ä½¿ç”¨ä¸åˆ†å¸ƒæƒ…å†µ æ’æŸ¥é«˜ CPU ä½¿ç”¨çš„é—®é¢˜ ç±»å…ƒæ•°æ® metaspace å…ƒç©ºé—´å†…å­˜ä½¿ç”¨ä¸å˜åŒ– æ’æŸ¥ Metaspace OOM cds ç±»å…±äº«æ•°æ®ï¼ˆCDSï¼‰æ—¥å¿— åˆ†æç±»åŠ è½½åŠ é€Ÿæ˜¯å¦ç”Ÿæ•ˆ å®‰å…¨ security å®‰å…¨ç›¸å…³æ“ä½œæ—¥å¿— æƒé™æ£€æŸ¥å¤±è´¥ã€å¯†é’¥åŠ è½½ç­‰è°ƒè¯• module æ¨¡å—ç³»ç»Ÿï¼ˆJPMSï¼‰ç›¸å…³æ—¥å¿— æ¨¡å—è®¿é—®æ§åˆ¶å¤±è´¥åˆ†æ å…¶ä»– start JVM å¯åŠ¨æµç¨‹æ—¥å¿— å¯åŠ¨é˜¶æ®µæ…¢ã€å‡ºé”™æ—¶ä½¿ç”¨ init å„å­ç³»ç»Ÿåˆå§‹åŒ–è¿‡ç¨‹ å®šä½å­ç³»ç»Ÿå¯åŠ¨é¡ºåºä¸å¼‚å¸¸ jni Java è°ƒç”¨ native æ–¹æ³•æ—¥å¿— JNI å´©æºƒã€æ€§èƒ½é—®é¢˜åˆ†æ classpath ç±»è·¯å¾„åŠ è½½è¯¦æƒ… ç±»æ‰¾ä¸åˆ°ã€è·¯å¾„å†²çªç­‰é—®é¢˜æ’æŸ¥ exceptions å¼‚å¸¸ä¿¡æ¯åŠå †æ ˆæ‰“å° æ•è·æœªå¤„ç†å¼‚å¸¸ã€é¢‘ç¹æŠ›é”™åˆ†æ Levelï¼ˆçº§åˆ«ï¼‰ ç­‰çº§ å«ä¹‰è¯´æ˜ ç”¨é€”ç¤ºä¾‹ off å…³é—­æ—¥å¿—è®°å½• å®Œå…¨ç¦ç”¨æŒ‡å®šæ ‡ç­¾çš„æ—¥å¿—è¾“å‡º error ä¸¥é‡é”™è¯¯ï¼Œä»…è®°å½•å½±å“ç³»ç»Ÿè¿è¡Œçš„é”™è¯¯ä¿¡æ¯ æ•è·å´©æºƒã€ä¸¥é‡æ•…éšœ warning æ½œåœ¨é—®é¢˜ï¼Œå¯èƒ½å½±å“ç¨³å®šæ€§ è®°å½•å¯èƒ½çš„å†…å­˜ã€é…ç½®é—®é¢˜ info å¸¸è§„ä¿¡æ¯ï¼ˆé»˜è®¤çº§åˆ«ï¼‰ æ—¥å¸¸è¿è¡Œæ—¥å¿—ï¼Œå¦‚ GC æ¬¡æ•° debug æ›´è¯¦ç»†çš„è°ƒè¯•ä¿¡æ¯ï¼Œé€‚ç”¨äºé—®é¢˜è¯Šæ–­ è·Ÿè¸ªè¡Œä¸ºå˜åŒ–æˆ–ä»£ç è·¯å¾„ trace æœ€è¯¦ç»†çš„ä¿¡æ¯ï¼Œè®°å½•å‡ ä¹æ‰€æœ‰ç»†èŠ‚ æ·±åº¦è°ƒè¯•ï¼Œå¦‚æ–¹æ³•çº§åˆ«è·Ÿè¸ª all æ‰“å°æ‰€æœ‰çº§åˆ«çš„æ—¥å¿—ï¼ˆåŒ…æ‹¬ trace åŠä»¥ä¸Šï¼‰ å…¨é‡æ—¥å¿—è¾“å‡ºï¼Œç”¨äºå®Œå…¨ç›‘æ§ Outputï¼ˆè¾“å‡ºä½ç½®ï¼‰ è¾“å‡ºä½ç½® å«ä¹‰è¯´æ˜ ç¤ºä¾‹ç”¨æ³• stdout æ ‡å‡†è¾“å‡ºï¼ˆé»˜è®¤ï¼‰ -Xlog:gc=info:stdout stderr æ ‡å‡†é”™è¯¯è¾“å‡º -Xlog:gc=info:stderr file=è·¯å¾„ è¾“å‡ºåˆ°æŒ‡å®šæ–‡ä»¶è·¯å¾„ï¼ˆè‡ªåŠ¨åˆ›å»ºæ–‡ä»¶ï¼‰ -Xlog:gc:file=gc.log å¤šä¸ªè¾“å‡ºç”¨é€—å·åˆ†éš” å¯åŒæ—¶è¾“å‡ºåˆ°å¤šä¸ªä½ç½® -Xlog:gc:file=gc.log,stdout Decoratorsï¼ˆè£…é¥°å™¨ï¼‰ è£…é¥°å™¨ å«ä¹‰è¯´æ˜ ç¤ºä¾‹è¾“å‡ºç‰‡æ®µï¼ˆå«è¯¥è£…é¥°å™¨æ—¶ï¼‰ time æ˜¾ç¤ºå½“å‰ç³»ç»Ÿæ—¶é—´ï¼ˆwall-clock timeï¼‰ 2025-05-16T10:45:12.123+0800 uptime æ˜¾ç¤º JVM å¯åŠ¨ä»¥æ¥çš„è¿è¡Œæ—¶é—´ï¼ˆæ¯«ç§’ï¼‰ 5.123sï¼ˆè¡¨ç¤ºå·²è¿è¡Œ 5.123 ç§’ï¼‰ level æ˜¾ç¤ºæ—¥å¿—çº§åˆ«ï¼ˆå¦‚ info, warning ç­‰ï¼‰ [info], [debug] tags æ˜¾ç¤ºæ—¥å¿—æ ‡ç­¾ [gc], [class,load] tid æ˜¾ç¤ºçº¿ç¨‹ ID tid=0x00007fddc4012800 hostname æ˜¾ç¤ºä¸»æœºå host=example.local pid æ˜¾ç¤ºå½“å‰ JVM è¿›ç¨‹ ID pid=12345 Rotation (æ—¥å¿—è½®è½¬è®¾ç½®) è®¾ç½®å‚æ•° å«ä¹‰è¯´æ˜ ç¤ºä¾‹å€¼ filecount=n ä¿ç•™çš„æ—¥å¿—æ–‡ä»¶æ•°é‡ï¼ˆæœ€å¤§æ–‡ä»¶è½®è½¬æ•°ï¼‰ filecount=5 filesize=n å•ä¸ªæ—¥å¿—æ–‡ä»¶çš„æœ€å¤§å¤§å°ï¼ˆæ”¯æŒå•ä½ï¼šk/m/gï¼‰ filesize=10m ç¤ºä¾‹ï¼š 1-Xlog:gc*:file=/var/log/app/gc.log:time,uptime,level,tags:filecount=5,filesize=20M é¡¹ å€¼ å«ä¹‰ tag gc* åŒ¹é…æ‰€æœ‰ä»¥ gc å¼€å¤´çš„æ ‡ç­¾ï¼ˆå¦‚ gc+heap ç­‰ï¼‰ level çœç•¥ é»˜è®¤æ˜¯ info output file=/var/log/app/gc.log æ—¥å¿—å†™å…¥è¯¥æ–‡ä»¶ decorators time,uptime,level,tags æ—¥å¿—å‰ç¼€åŒ…å«æ—¶é—´ã€å¯åŠ¨æ—¶é—´ã€æ—¥å¿—çº§åˆ«ã€æ ‡ç­¾ rotation filecount=5,filesize=20M æœ€å¤šä¿ç•™ 5 ä¸ªæ—¥å¿—æ–‡ä»¶ï¼Œå•ä¸ªæ–‡ä»¶æœ€å¤§ 20MB æ—¥å¿—æ–‡ä»¶ä¸­å¯ä»¥ä½¿ç”¨å˜é‡ 1-Xlog:gc*:file=gc_%p_%t.log å¸¸ç”¨å˜é‡è¡¨ å˜é‡ å«ä¹‰ %p è¿›ç¨‹IDï¼ˆProcess IDï¼‰ %t æ—¶é—´æˆ³ï¼ˆä»£è¡¨æ—¥å¿—æ–‡ä»¶åˆ›å»ºæ—¶çš„æ—¶é—´æˆ³ï¼‰ %h ä¸»æœºåï¼ˆHostnameï¼‰ %n åºåˆ—å·ï¼Œä»0å¼€å§‹ï¼Œæ¯åˆ›å»ºæ–°æ–‡ä»¶åŠ 1 %u å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œç”¨äºè§£å†³æ–‡ä»¶åå†²çª %i å½“å¤šä¸ªJVMè¿›ç¨‹ä½¿ç”¨ç›¸åŒçš„æ–‡ä»¶åæ¨¡å¼æ—¶çš„åŒºåˆ†è®¡æ•°å™¨ æ—¶é—´ç›¸å…³å˜é‡è¡¨ å˜é‡ å«ä¹‰ %Y å¹´ï¼ˆYearï¼‰ %m æœˆï¼ˆMonthï¼‰ %d æ—¥ï¼ˆDayï¼‰ %H å°æ—¶ï¼ˆHourï¼‰ %M åˆ†é’Ÿï¼ˆMinuteï¼‰ %S ç§’ï¼ˆSecondï¼‰ 12345678# åŸºç¡€é…ç½®-Xlog:gc*:file=gc_%p_%Y%m%d_%H%M%S.log:time,uptime,level,tags:filecount=5,filesize=20M# è¯¦ç»†GCæ—¥å¿—é…ç½®-Xlog:gc*=debug:file=gc_%p_%t.log:time,uptime,level,tags:filecount=10,filesize=50M# å¤šç›®æ ‡è¾“å‡º-Xlog:gc*=info:file=gc.log::filecount=5,filesize=20M -Xlog:gc*=debug:file=gc_detailed.log å¯¹äºGCæ—¥å¿—çš„åˆ†æ äººå·¥åˆ†æè¿˜æ˜¯å¤ªå¤æ‚äº†ï¼Œå¯ä»¥ä½¿ç”¨GCEasy.ioï¼Œæ¯ä¸ªæœˆå…è´¹5æ¬¡ã€‚","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç»JVMçš„å†…å­˜æ¨¡å‹ä¸åƒåœ¾å›æ”¶æœºåˆ¶ JDK8 The JavaÂ® Virtual Machine Specification JDK8çš„javaæŒ‡ä»¤çš„å®˜â½…â½‚æ¡£ JDKâ¼¯å…·å®˜â½¹â½‚æ¡£ JDK17çš„javaæŒ‡ä»¤çš„å®˜â½…â½‚æ¡£","date_published":"2025-05-12T14:30:05.000Z","tags":["æŠ€æœ¯","jvm","jvm"]},{"id":"https://blog.hanqunfeng.com/2025/05/08/jvm-classloader-01/","url":"https://blog.hanqunfeng.com/2025/05/08/jvm-classloader-01/","title":"JVM ä¹‹ ç±»åŠ è½½å™¨","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç»JVMçš„ç±»åŠ è½½å™¨</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://docs.oracle.com/javase/specs/jvms/se8/html/index.html\">JDK8 The JavaÂ® Virtual Machine Specification</a></p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://docs.oracle.com/javase/8/docs/technotes/tools/unix/java.html\">JDK8çš„javaæŒ‡ä»¤çš„å®˜â½…â½‚æ¡£</a></p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://docs.oracle.com/en/java/javase/17/docs/specs/man/index.html\">JDKâ¼¯å…·å®˜â½¹â½‚æ¡£</a></p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://docs.oracle.com/en/java/javase/17/docs/specs/man/java.html\">JDK17çš„javaæŒ‡ä»¤çš„å®˜â½…â½‚æ¡£</a></p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"ç±»åŠ è½½å™¨\">ç±»åŠ è½½å™¨</h2>\n<p><img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/uPic/weBeGe.png\" alt=\"\" width=\"1200\" height=\"400\"></p>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å·¦ä¾§æ˜¯JDKä¸­å®ç°çš„ç±»åŠ è½½å™¨ï¼Œé€šè¿‡<code>parent</code>å±æ€§å½¢æˆâ½—â¼¦å…³ç³»ã€‚åº”â½¤ä¸­â¾ƒå®šä¹‰çš„ç±»åŠ è½½å™¨çš„<code>parent</code>éƒ½æ˜¯<br>\n<code>AppClassLoader</code></p>\n</li>\n<li class=\"lvl-2\">\n<p>å³ä¾§æ˜¯JDKä¸­çš„ç±»åŠ è½½å™¨å®ç°ç±»ã€‚é€šè¿‡ç±»ç»§æ‰¿çš„æœºåˆ¶å½¢æˆä½“ç³»ã€‚æœªæ¥æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ç»§æ‰¿ç›¸å…³çš„ç±»å®ç°â¾ƒå®šä¹‰ç±»<br>\nåŠ è½½å™¨ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>åœ¨ä»£ç ä¸­æŸ¥çœ‹ç±»åŠ è½½å™¨å…³ç³»</p>\n</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">LoaderDemo</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> ClassNotFoundException &#123;</span><br><span class=\"line\">        <span class=\"comment\">// â½—â¼¦å…³ç³» AppClassLoader &lt;- ExtClassLoader &lt;- BootStrap Classloader</span></span><br><span class=\"line\">        <span class=\"type\">ClassLoader</span> <span class=\"variable\">cl1</span> <span class=\"operator\">=</span> LoaderDemo.class.getClassLoader();</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;cl1 &gt; &quot;</span> + cl1); <span class=\"comment\">// sun.misc.Launcher$AppClassLoader@18b4aac2</span></span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;parent of cl1 &gt; &quot;</span> + cl1.getParent()); <span class=\"comment\">// sun.misc.Launcher$ExtClassLoader@1b6d3586</span></span><br><span class=\"line\">        <span class=\"comment\">// BootStrap Classloaderç”±C++å¼€å‘ï¼Œæ˜¯JVMè™šæ‹Ÿæœºçš„â¼€éƒ¨åˆ†ï¼Œæœ¬èº«ä¸æ˜¯JAVAç±»ã€‚</span></span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;grant parent of cl1 &gt; &quot;</span> + cl1.getParent().getParent()); <span class=\"comment\">// null</span></span><br><span class=\"line\">        <span class=\"comment\">// String,Intç­‰åŸºç¡€ç±»ç”±BootStrap ClassloaderåŠ è½½ã€‚</span></span><br><span class=\"line\">        <span class=\"type\">ClassLoader</span> <span class=\"variable\">cl2</span> <span class=\"operator\">=</span> String.class.getClassLoader();</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;cl2 &gt; &quot;</span> + cl2); <span class=\"comment\">// null</span></span><br><span class=\"line\">        System.out.println(cl1.loadClass(<span class=\"string\">&quot;java.util.List&quot;</span>).getClass().getClassLoader()); <span class=\"comment\">// null</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"åŒäº²å§”æ´¾æœºåˆ¶\">åŒäº²å§”æ´¾æœºåˆ¶</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å½“â¼€ä¸ªç±»åŠ è½½å™¨è¦åŠ è½½â¼€ä¸ªç±»æ—¶ï¼Œæ•´ä½“çš„è¿‡ç¨‹å°±æ˜¯é€šè¿‡åŒäº²å§”æ´¾æœºåˆ¶å‘ä¸Šå§”æ‰˜æŸ¥æ‰¾ï¼Œå¦‚æœæ²¡æœ‰æŸ¥æ‰¾åˆ°ï¼Œå°±å‘ä¸‹å§”æ‰˜åŠ è½½ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>Java ç±»åŠ è½½æœºåˆ¶ä¸­çš„<code>åŒäº²å§”æ´¾æ¨¡å‹ï¼ˆParent Delegation Modelï¼‰</code>æ˜¯ä¸€ç§ä¿è¯äº†ç±»åŠ è½½å™¨æŒ‰ç…§å±‚æ¬¡ç»“æ„ä»ä¸Šåˆ°ä¸‹æ¥åŠ è½½ç±»çš„ç­–ç•¥ã€‚è¿™ç§å±‚çº§åŒ–çš„åŠ è½½æµç¨‹ç¡®ä¿äº†åº”ç”¨ç¨‹åºèƒ½å¤Ÿå®‰å…¨åœ°åŠ è½½å¹¶ä½¿ç”¨æ¥è‡ªä¸åŒæ¥æºçš„ç±»ï¼ŒåŒæ—¶ä¹Ÿé¿å…äº†å†…å­˜ä¸­å‡ºç°ç›¸åŒç±»çš„å¤šä¸ªæ‹·è´ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä»¥ä¸‹æ˜¯åŒäº²å§”æ´¾æœºåˆ¶çš„å·¥ä½œåŸç†ï¼š</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">1.å½“ä¸€ä¸ªç±»åŠ è½½å™¨æ¥æ”¶åˆ°ç±»åŠ è½½è¯·æ±‚æ—¶ï¼Œå®ƒé¦–å…ˆä¸ä¼šè‡ªè¡Œå°è¯•å»å¯»æ‰¾ç±»æ–‡ä»¶ï¼Œè€Œæ˜¯å°†è¿™ä¸ªè¯·æ±‚å§”æ´¾ç»™å®ƒçš„çˆ¶ç±»åŠ è½½å™¨ã€‚</li>\n<li class=\"lvl-4\">2.çˆ¶ç±»åŠ è½½å™¨åŒæ ·éµå¾ªæ­¤è§„åˆ™ï¼Œå®ƒä¼šç»§ç»­æŠŠè¯·æ±‚å‘ä¸Šå§”æ´¾ç»™å®ƒçš„çˆ¶ç±»åŠ è½½å™¨ï¼Œç›´åˆ°è¾¾åˆ°æ ¹ï¼ˆbootstrappï¼‰ç±»åŠ è½½å™¨ä¸ºæ­¢ã€‚</li>\n<li class=\"lvl-4\">3.æ ¹ç±»åŠ è½½å™¨ä¸€èˆ¬ä¼šç›´æ¥è®¿é—®æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿæ¥æŸ¥æ‰¾ç±»æ–‡ä»¶ï¼Œæ¯”å¦‚ JDK è‡ªå¸¦çš„æ ¸å¿ƒç±»åº“ï¼Œæˆ–è€…åœ¨-XbootclasspathæŒ‡å®šçš„è·¯å¾„ä¸‹æŸ¥æ‰¾ã€‚</li>\n<li class=\"lvl-4\">4.å¦‚æœæ ¹ç±»åŠ è½½å™¨æ‰¾åˆ°äº†è¯¥ç±»ï¼Œåˆ™è¿›è¡Œç±»çš„åŠ è½½ï¼›å¦‚æœæ‰¾ä¸åˆ°ï¼Œåˆ™æŠŠè¿™ä¸ªä»»åŠ¡äº¤å›ç»™å‘å‡ºè¯·æ±‚çš„å­ç±»åŠ è½½å™¨ã€‚</li>\n<li class=\"lvl-4\">5.å­ç±»åŠ è½½å™¨ä¹Ÿé‡å¤æ­¥éª¤ 4ï¼Œè‹¥æ‰¾åˆ°åˆ™åŠ è½½ï¼Œå¦åˆ™ä¼ é€’ç»™ä¸‹ä¸€ä¸ªå­ç±»åŠ è½½å™¨ï¼Œç›´è‡³åŸå§‹æå‡ºè¯·æ±‚çš„ç±»åŠ è½½å™¨ã€‚</li>\n<li class=\"lvl-4\">6.è‹¥æ‰€æœ‰çš„ç±»åŠ è½½å™¨éƒ½æœªèƒ½æ‰¾åˆ°æ‰€éœ€çš„ç±»ï¼Œåˆ™æœ€ç»ˆæŠ›å‡ºClassNotFoundExceptionå¼‚å¸¸ã€‚<br>\n<img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/uPic/ftDnCj.png\" alt=\"\" width=\"600\" height=\"800\"></li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<p>åŒäº²å§”æ´¾æœ‰ä»¥ä¸‹å‡ ä¸ªä¼˜ç‚¹ï¼š</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">å®‰å…¨æ€§ï¼šç”±äºç±»åŠ è½½æ˜¯ä»é¡¶å±‚å¼€å§‹ï¼Œè¿™èƒ½é˜²æ­¢æ¶æ„ä»£ç é€šè¿‡åŠ è½½ç›¸åŒçš„åŒ…åå’Œç±»åæ›¿ä»£ç³»ç»Ÿçš„å…³é”®ç±»ã€‚</li>\n<li class=\"lvl-4\">å”¯ä¸€æ€§ï¼šæ¯ä¸ªç±»éƒ½ä¼šè¢«ç‰¹å®šçš„ç±»åŠ è½½å™¨åŠ è½½ä¸€æ¬¡ï¼Œå³ä¾¿æ˜¯åœ¨åˆ†å¸ƒå¼çš„ç¯å¢ƒä¸­ä¹Ÿèƒ½ä¿è¯ç±»çš„ç»Ÿä¸€æ€§ï¼Œé¿å…å› ä¸ºå¤šæ¬¡åŠ è½½å¯¼è‡´çš„é”™è¯¯ã€‚</li>\n<li class=\"lvl-4\">å¯é æ€§ï¼šç”¨æˆ·è‡ªå®šä¹‰çš„ç±»åŠ è½½å™¨ä¸ç”¨æ‹…å¿ƒåŸºç¡€ç±»å·²ç»è¢«åŠ è½½ï¼Œå®ƒä»¬å¯ä»¥ä¸“å¿ƒäºè‡ªå·±éœ€è¦å¤„ç†çš„éƒ¨åˆ†ã€‚</li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<p>ä¾‹å¦‚ï¼Œå½“åº”ç”¨ç¨‹åºè¿è¡Œæ—¶ï¼Œåº”ç”¨ç±»åŠ è½½å™¨ï¼ˆApplication ClassLoaderï¼‰æ¥æ”¶åˆ°å¯¹java.lang.Stringç±»çš„åŠ è½½è¯·æ±‚æ—¶ï¼Œå®ƒä¼šé¦–å…ˆå°†è¯·æ±‚ä¼ é€’ç»™æ‰©å±•ç±»åŠ è½½å™¨ï¼ˆExtension ClassLoaderï¼‰ï¼Œåè€…å†ä¼ é€’ç»™å¼•å¯¼ç±»åŠ è½½å™¨ï¼ˆBootstrap ClassLoaderï¼‰ã€‚å¼•å¯¼ç±»åŠ è½½å™¨ä¼šåœ¨å…¶æœç´¢è·¯å¾„ä¸­æ‰¾åˆ°Stringç±»ï¼Œå¹¶å®ŒæˆåŠ è½½è¿‡ç¨‹ã€‚å¦‚æœåº”ç”¨ç¨‹åºè¯•å›¾æä¾›è‡ªå·±çš„Stringç±»ï¼Œç”±äºåŒäº²å§”æ´¾çš„å­˜åœ¨ï¼Œåº”ç”¨ç¨‹åºæ‰€æŒ‡å®šçš„ç±»å¹¶ä¸ä¼šè¢«åŠ è½½ï¼Œä»è€Œä¿è¯äº†å¹³å°æ ¸å¿ƒ API çš„ä¸€è‡´æ€§ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>æ€»ä¹‹ï¼ŒåŒäº²å§”æ´¾æœºåˆ¶æ˜¯ Java ç±»åŠ è½½è¿‡ç¨‹ä¸­ä¸€ä¸ªéå¸¸é‡è¦çš„ç‰¹æ€§ï¼Œå®ƒä¸ä»…ç»´æŠ¤äº†ç±»åŠ è½½çš„å®‰å…¨æ€§å’Œä¸€è‡´æ€§ï¼Œä¹Ÿä¸ºå¼€å‘è€…æä¾›äº†çµæ´»å®šåˆ¶ç±»åŠ è½½è§„åˆ™çš„èƒ½åŠ›ã€‚</p>\n</li>\n</ul>\n<h3 id=\"æ¯ä¸ªç±»åŠ è½½å™¨æŸ¥æ‰¾ç±»çš„é»˜è®¤è·¯å¾„\">æ¯ä¸ªç±»åŠ è½½å™¨æŸ¥æ‰¾ç±»çš„é»˜è®¤è·¯å¾„</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åœ¨ Java ä¸­ï¼Œæ¯ä¸ªç±»åŠ è½½å™¨éƒ½æœ‰è‡ªå·±çš„ç±»è·¯å¾„ï¼ˆClasspathï¼‰å»æŸ¥æ‰¾ç±»æ–‡ä»¶ã€‚ä¸‹é¢æ˜¯å‡ ä¸ªä¸»è¦çš„ç±»åŠ è½½å™¨ä»¥åŠå®ƒä»¬çš„é»˜è®¤æŸ¥æ‰¾è·¯å¾„ï¼š</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>ç±»åŠ è½½å™¨åç§°</th>\n<th>ç±»å / åˆ«å</th>\n<th>çˆ¶ç±»åŠ è½½å™¨</th>\n<th>åŠ è½½å†…å®¹æè¿°</th>\n<th>é»˜è®¤æŸ¥æ‰¾è·¯å¾„ / ç³»ç»Ÿå±æ€§</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>å¯åŠ¨ç±»åŠ è½½å™¨</strong></td>\n<td>BootstrapClassLoader</td>\n<td>æ— </td>\n<td>åŠ è½½ <strong>æ ¸å¿ƒ Java ç±»åº“</strong></td>\n<td><code>&lt;JAVA_HOME&gt;/jre/lib/rt.jar</code>ï¼ˆJDK8 åŠä¹‹å‰ï¼‰æˆ– <code>sun.boot.class.path</code> æŒ‡å®šè·¯å¾„</td>\n</tr>\n<tr>\n<td><strong>æ‰©å±•ç±»åŠ è½½å™¨</strong></td>\n<td>ExtClassLoader</td>\n<td>BootstrapClassLoader</td>\n<td>åŠ è½½ Java å¹³å°æ‰©å±•ç±»åº“</td>\n<td><code>&lt;JAVA_HOME&gt;/jre/lib/ext</code> æˆ–ç”± <code>java.ext.dirs</code> ç³»ç»Ÿå±æ€§æŒ‡å®š</td>\n</tr>\n<tr>\n<td><strong>åº”ç”¨ç±»åŠ è½½å™¨</strong></td>\n<td>AppClassLoader</td>\n<td>ExtClassLoader</td>\n<td>åŠ è½½ <strong>åº”ç”¨ç¨‹åºç±»</strong>ï¼ˆç”¨æˆ·ç¼–å†™çš„ä»£ç ï¼‰</td>\n<td><code>-classpath</code>ã€<code>-cp</code> å‚æ•°ã€<code>CLASSPATH</code> ç¯å¢ƒå˜é‡ã€<code>java.class.path</code> å±æ€§ã€å½“å‰ç›®å½• (.)</td>\n</tr>\n<tr>\n<td><strong>è‡ªå®šä¹‰ç±»åŠ è½½å™¨</strong></td>\n<td>ç”¨æˆ·è‡ªå®šä¹‰</td>\n<td>å¯æŒ‡å®š</td>\n<td>å¯é€šè¿‡ç»§æ‰¿ <code>ClassLoader</code> å¹¶é‡å†™ <code>findClass()</code> æ–¹æ³•å®ç°è‡ªå®šä¹‰ç±»åŠ è½½é€»è¾‘ï¼Œå¦‚ä»ç½‘ç»œã€æ•°æ®åº“ç­‰åŠ è½½ç±»æ–‡ä»¶</td>\n<td>é»˜è®¤ç»§æ‰¿çˆ¶åŠ è½½å™¨æŸ¥æ‰¾è·¯å¾„ï¼Œä¹Ÿå¯è‡ªå®šä¹‰</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œé™¤äº† Bootstrap ClassLoader å¤–ï¼Œå…¶ä»–çš„æ‰€æœ‰ç±»åŠ è½½å™¨æœ€ç»ˆéƒ½æ˜¯java.lang.ClassLoaderçš„å­ç±»ï¼Œå¹¶ä¸”æ¯ä¸ªç±»åŠ è½½å™¨å®ä¾‹éƒ½æœ‰ä¸€ä¸ªç›´æ¥çš„çˆ¶ç±»åŠ è½½å™¨ã€‚å¦‚æœä½ åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„ç±»åŠ è½½å™¨ï¼Œå®ƒå°†ç»§æ‰¿ Application ClassLoader ä½œä¸ºå®ƒçš„çˆ¶ç±»ï¼Œé™¤éä½ åœ¨åˆ›å»ºæ—¶æŒ‡å®šäº†ä¸åŒçš„çˆ¶ç±»åŠ è½½å™¨ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>æ­¤å¤–ï¼ŒJava 9 å¼•å…¥äº†æ¨¡å—åŒ–ç³»ç»Ÿåï¼Œç±»åŠ è½½æœºåˆ¶ä¹Ÿæœ‰äº†ä¸€äº›å˜åŒ–ï¼Œå¯¹äºæ¨¡å—è·¯å¾„ä¸Šçš„ç±»åŠ è½½ï¼Œä¼šä½¿ç”¨æ–°çš„å±‚æ¬¡ç»“æ„æ¥å¤„ç†ï¼Œè¿™ä½¿å¾—ç±»åŠ è½½è¿‡ç¨‹æ›´åŠ çµæ´»åŒæ—¶ä¿æŒäº†å‘åçš„å…¼å®¹æ€§ã€‚ä¸è¿‡ï¼Œå¯¹äºä¼ ç»Ÿçš„ç±»è·¯å¾„ä¸Šçš„ç±»åŠ è½½ï¼ŒåŒäº²å§”æ´¾æ¨¡å‹ä»ç„¶é€‚ç”¨ã€‚<br>\n<img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/uPic/50fvA9.png\" alt=\"\" width=\"1200\" height=\"400\"></p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>ç±»åŠ è½½å™¨åç§°</th>\n<th>ç±»å / åˆ«å</th>\n<th>çˆ¶ç±»åŠ è½½å™¨</th>\n<th>åŠ è½½æ¨¡å—èŒƒå›´</th>\n<th>é»˜è®¤æŸ¥æ‰¾è·¯å¾„ / æ¨¡å—æ¥æº</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>å¼•å¯¼ç±»åŠ è½½å™¨</strong></td>\n<td><code>BootstrapClassLoader</code></td>\n<td>æ— </td>\n<td>åŠ è½½ <code>java.*</code> æ¨¡å—ï¼Œä¾‹å¦‚ <code>java.base</code>ï¼ˆåŒ…å« <code>java.lang</code>, <code>java.util</code> ç­‰ï¼‰</td>\n<td><code>$JAVA_HOME/jmods</code> ä¸­çš„æ¨¡å—æ–‡ä»¶ï¼Œæ ¸å¿ƒæ¨¡å—ç”± JVM å¯åŠ¨æ—¶ç›´æ¥åŠ è½½</td>\n</tr>\n<tr>\n<td><strong>å¹³å°ç±»åŠ è½½å™¨</strong></td>\n<td><code>PlatformClassLoader</code></td>\n<td>BootstrapClassLoader</td>\n<td>åŠ è½½ <code>jdk.*</code>ã€<code>javafx.*</code> ç­‰å¹³å°æ‰©å±•æ¨¡å—</td>\n<td><code>$JAVA_HOME/jmods</code>ï¼Œæ¨¡å—åä¸º <code>jdk.*</code>ã€<code>javafx.*</code> ç­‰ï¼›</td>\n</tr>\n<tr>\n<td><strong>åº”ç”¨ç±»åŠ è½½å™¨</strong></td>\n<td><code>AppClassLoader</code></td>\n<td>PlatformClassLoader</td>\n<td>åŠ è½½åº”ç”¨æ¨¡å—ï¼ˆç”¨æˆ·ä»£ç ï¼‰ï¼ŒåŒ…æ‹¬æ¨¡å—è·¯å¾„ <code>--module-path</code> å’Œç±»è·¯å¾„ <code>-classpath</code> ä¸‹çš„ç±»</td>\n<td>åº”ç”¨ç¨‹åºç¼–å†™çš„æ¨¡å—æˆ–ç±»ï¼Œæ¥è‡ªå‘½ä»¤è¡Œ <code>--module-path</code>ã€<code>-classpath</code> å‚æ•°ã€<code>CLASSPATH</code> ç¯å¢ƒå˜é‡ç­‰</td>\n</tr>\n<tr>\n<td><strong>è‡ªå®šä¹‰ç±»åŠ è½½å™¨</strong></td>\n<td>ç”¨æˆ·è‡ªå®šä¹‰</td>\n<td>å¯æŒ‡å®šçˆ¶åŠ è½½å™¨</td>\n<td>åŠ è½½éæ ‡å‡†ä½ç½®çš„ç±»ï¼Œå¯ç”¨äºæ’ä»¶ã€ç½‘ç»œåŠ è½½ã€åŠ å¯†ç±»åŠ è½½ç­‰</td>\n<td>é»˜è®¤éµå¾ªåŒäº²å§”æ´¾ï¼Œå¯é‡å†™ <code>findClass()</code> å®ç°è‡ªå®šä¹‰è·¯å¾„æŸ¥æ‰¾æˆ–å…¶ä»–æ•°æ®æºï¼Œå¦‚ç½‘ç»œã€æ•°æ®åº“ã€åŠ å¯†æ–‡ä»¶ç­‰</td>\n</tr>\n</tbody>\n</table>\n<blockquote>\n<p>jdk9+ä¸­ï¼Œåœ¨å§”æ´¾ç»™çˆ¶åŠ è½½å™¨åŠ è½½å‰ï¼Œå…ˆåˆ¤æ–­è¯¥ç±»æ˜¯å¦èƒ½å¤Ÿå½’å±åˆ°æŸä¸€ä¸ªç³»ç»Ÿæ¨¡å—ä¸­ï¼Œå¦‚æœå¯ä»¥æ‰¾åˆ°è¿™æ ·çš„å½’å±å…³ç³»ï¼Œå°±è¦ä¼˜å…ˆå§”æ´¾ç»™è´Ÿè´£é‚£ä¸ªæ¨¡å—çš„åŠ è½½å™¨å®ŒæˆåŠ è½½ã€‚</p>\n</blockquote>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åœ¨ä»£ç ä¸­æŸ¥çœ‹ç±»åŠ è½½è·¯å¾„</p>\n</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// BootStrap Classloaderï¼ŒåŠ è½½javaåŸºç¡€ç±»ã€‚</span></span><br><span class=\"line\">System.out.println(<span class=\"string\">&quot;BootStrap ClassLoaderåŠ è½½â½¬å½•ï¼š&quot;</span> + System.getProperty(<span class=\"string\">&quot;sun.boot.class.path&quot;</span>));</span><br><span class=\"line\"><span class=\"comment\">// Extention Classloader åŠ è½½â¼€äº›æ‰©å±•ç±»ã€‚ å¯é€šè¿‡-D java.ext.dirså¦â¾æŒ‡å®šâ½¬å½•</span></span><br><span class=\"line\">System.out.println(<span class=\"string\">&quot;Extention ClassLoaderåŠ è½½â½¬å½•ï¼š&quot;</span> + System.getProperty(<span class=\"string\">&quot;java.ext.dirs&quot;</span>));</span><br><span class=\"line\"><span class=\"comment\">// AppClassLoader åŠ è½½CLASSPATHï¼Œåº”â½¤ä¸‹çš„JaråŒ…ã€‚å¯é€šè¿‡-D java.class.pathå¦â¾æŒ‡å®šâ½¬å½•</span></span><br><span class=\"line\">System.out.println(<span class=\"string\">&quot;AppClassLoaderåŠ è½½â½¬å½•ï¼š&quot;</span> + System.getProperty(<span class=\"string\">&quot;java.class.path&quot;</span>));</span><br></pre></td></tr></table></figure>\n<h3 id=\"åŒäº²å§”æ´¾æœºåˆ¶çš„å®ç°åŸç†\">åŒäº²å§”æ´¾æœºåˆ¶çš„å®ç°åŸç†</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>java.lang.ClassLoader ç±»çš„ loadClass æ–¹æ³•æ˜¯åŒäº²å§”æ´¾çš„æ ¸å¿ƒå®ç°</p>\n</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * åŠ è½½æŒ‡å®šåç§°çš„ç±»ï¼Œå¹¶æ ¹æ® resolve å‚æ•°å†³å®šæ˜¯å¦è§£æè¯¥ç±»ã€‚</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * è¯¥æ–¹æ³•å®ç°äº†ç±»åŠ è½½çš„åŸºæœ¬é€»è¾‘ï¼ŒåŒ…æ‹¬æ£€æŸ¥ç±»æ˜¯å¦å·²åŠ è½½ã€å§”æ‰˜çˆ¶ç±»åŠ è½½å™¨åŠ è½½ã€</span></span><br><span class=\"line\"><span class=\"comment\"> * è‡ªè¡ŒåŠ è½½ç±»ä»¥åŠè§£æç±»ç­‰æ­¥éª¤ã€‚è¯¥æ–¹æ³•æ˜¯ Java ç±»åŠ è½½æœºåˆ¶çš„æ ¸å¿ƒéƒ¨åˆ†ä¹‹ä¸€ï¼Œ</span></span><br><span class=\"line\"><span class=\"comment\"> * éµå¾ªåŒäº²å§”æ´¾æ¨¡å‹ã€‚</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> name    è¦åŠ è½½çš„ç±»çš„å…¨é™å®šå</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> resolve å¦‚æœä¸º trueï¼Œåˆ™åœ¨åŠ è½½åè§£æè¯¥ç±»</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return</span> åŠ è½½çš„ Class å¯¹è±¡</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@throws</span> ClassNotFoundException å¦‚æœæ‰¾ä¸åˆ°æŒ‡å®šçš„ç±»</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"comment\">// è¿™ä¸ªâ½…æ³•æ˜¯protectedå£°æ˜çš„ï¼Œæ„å‘³ç€ï¼Œæ˜¯å¯ä»¥è¢«â¼¦ç±»è¦†ç›–çš„ï¼Œæ‰€ä»¥ï¼ŒåŒäº²å§”æ´¾æœºåˆ¶ä¹Ÿæ˜¯å¯ä»¥è¢«æ‰“ç ´çš„ï¼Œå¦‚Tomcatâ¼¦ç±»é‡å†™è¿™ä¸ªâ½…æ³•ï¼Œå¹¶ä½¿â½¤è‡ªå·±çš„ç±»åŠ è½½é€»è¾‘ã€‚</span></span><br><span class=\"line\"><span class=\"keyword\">protected</span> Class&lt;?&gt; loadClass(String name, <span class=\"type\">boolean</span> resolve)</span><br><span class=\"line\">        <span class=\"keyword\">throws</span> ClassNotFoundException &#123;</span><br><span class=\"line\">    <span class=\"comment\">// ä½¿ç”¨ synchronized ç¡®ä¿å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ç±»åŠ è½½çš„åŒæ­¥</span></span><br><span class=\"line\">    <span class=\"keyword\">synchronized</span> (getClassLoadingLock(name)) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// First, check if the class has already been loaded</span></span><br><span class=\"line\">        <span class=\"comment\">// æ¯ä¸ªç±»åŠ è½½å™¨å¯¹ä»–åŠ è½½è¿‡çš„ç±»éƒ½æœ‰â¼€ä¸ªç¼“å­˜ï¼Œå…ˆå»ç¼“å­˜ä¸­æŸ¥çœ‹æœ‰æ²¡æœ‰åŠ è½½è¿‡</span></span><br><span class=\"line\">        Class&lt;?&gt; c = findLoadedClass(name);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (c == <span class=\"literal\">null</span>) &#123; <span class=\"comment\">//æ²¡æœ‰åŠ è½½è¿‡ï¼Œå°±â¾›åŒäº²å§”æ´¾</span></span><br><span class=\"line\">            <span class=\"type\">long</span> <span class=\"variable\">t0</span> <span class=\"operator\">=</span> System.nanoTime();</span><br><span class=\"line\">            <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                <span class=\"comment\">// çˆ¶ç±»å­˜åœ¨åˆ™è®©â½—ç±»åŠ è½½å™¨è¿›â¾åŠ è½½</span></span><br><span class=\"line\">                <span class=\"keyword\">if</span> (parent != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                    c = parent.loadClass(name, <span class=\"literal\">false</span>);</span><br><span class=\"line\">                &#125; <span class=\"keyword\">else</span> &#123; <span class=\"comment\">//å¦‚æœçˆ¶ç±»ä¸å­˜åœ¨ï¼Œåˆ™ä»å¼•å¯¼ç±»åŠ è½½å™¨è¿›â¾åŠ è½½</span></span><br><span class=\"line\">                    c = findBootstrapClassOrNull(name);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125; <span class=\"keyword\">catch</span> (ClassNotFoundException e) &#123;</span><br><span class=\"line\">                <span class=\"comment\">// ClassNotFoundException thrown if class not found</span></span><br><span class=\"line\">                <span class=\"comment\">// from the non-null parent class loader</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (c == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                <span class=\"comment\">// If still not found, then invoke findClass in order</span></span><br><span class=\"line\">                <span class=\"comment\">// to find the class.</span></span><br><span class=\"line\">                <span class=\"type\">long</span> <span class=\"variable\">t1</span> <span class=\"operator\">=</span> System.nanoTime();</span><br><span class=\"line\">                <span class=\"comment\">// findClass æ–¹æ³•æ˜¯å­ç±»å®ç°çš„ï¼Œç”¨äºåŠ è½½æŒ‡å®šåç§°çš„ç±»</span></span><br><span class=\"line\">                <span class=\"comment\">// â½—ç±»åŠ è½½å™¨æ²¡æœ‰åŠ è½½è¿‡ï¼Œå°±â¾ƒâ¾è§£æclassâ½‚ä»¶åŠ è½½</span></span><br><span class=\"line\">                c = findClass(name);</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"comment\">// this is the defining class loader; record the stats</span></span><br><span class=\"line\">                <span class=\"comment\">// æ€§èƒ½ç»Ÿè®¡ï¼šè®°å½•ç±»åŠ è½½è¿‡ç¨‹ä¸­çš„æ—¶é—´æ¶ˆè€—å’Œè°ƒç”¨æ¬¡æ•°ï¼Œä¾¿äºç›‘æ§å’Œä¼˜åŒ–ã€‚</span></span><br><span class=\"line\">                sun.misc.PerfCounter.getParentDelegationTime().addTime(t1 - t0);</span><br><span class=\"line\">                sun.misc.PerfCounter.getFindClassTime().addElapsedTimeFrom(t1);</span><br><span class=\"line\">                sun.misc.PerfCounter.getFindClasses().increment();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// é»˜è®¤æƒ…å†µä¸‹ï¼ŒåŒäº²å§”æ´¾æ¨¡å‹åªè¿›â¾äº†éªŒè¯å’Œå‡†å¤‡é˜¶æ®µï¼Œâ½½ä¸è¿›â¾è§£æ(å¦‚é“¾æ¥ã€åˆå§‹åŒ–)</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (resolve) &#123;</span><br><span class=\"line\">            resolveClass(c);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> c;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¯¥æ–¹æ³•å®ç°äº†ç±»åŠ è½½çš„åŸºæœ¬é€»è¾‘ï¼ŒåŒ…æ‹¬æ£€æŸ¥ç±»æ˜¯å¦å·²åŠ è½½ã€å§”æ‰˜çˆ¶ç±»åŠ è½½å™¨åŠ è½½ã€è‡ªè¡ŒåŠ è½½ç±»ä»¥åŠè§£æç±»ç­‰æ­¥éª¤ã€‚è¯¥æ–¹æ³•æ˜¯ Java ç±»åŠ è½½æœºåˆ¶çš„æ ¸å¿ƒéƒ¨åˆ†ä¹‹ä¸€ï¼Œéµå¾ªåŒäº²å§”æ´¾æ¨¡å‹ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>è¿™ä¸ªâ½…æ³•æ˜¯<code>protected</code>å£°æ˜çš„ï¼Œæ„å‘³ç€ï¼Œæ˜¯å¯ä»¥è¢«â¼¦ç±»è¦†ç›–çš„ï¼Œæ‰€ä»¥ï¼ŒåŒäº²å§”æ´¾æœºåˆ¶ä¹Ÿæ˜¯å¯ä»¥è¢«æ‰“ç ´çš„ï¼Œå¦‚Tomcatâ¼¦ç±»é‡å†™è¿™ä¸ªâ½…æ³•ï¼Œå¹¶ä½¿â½¤è‡ªå·±çš„ç±»åŠ è½½é€»è¾‘ã€‚</p>\n</li>\n</ul>\n<h2 id=\"æ²™ç®±ä¿æŠ¤æœºåˆ¶\">æ²™ç®±ä¿æŠ¤æœºåˆ¶</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ²™ç®±ä¿æŠ¤æœºåˆ¶æ˜¯ Java è™šæ‹Ÿæœºæä¾›çš„ä¸€ç§å®‰å…¨æœºåˆ¶ï¼Œç”¨äºä¿æŠ¤åº”ç”¨ç¨‹åºå…å—æ¶æ„ä»£ç çš„æ”»å‡»ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>java.lang.ClassLoader ç±»çš„ preDefineClass æ–¹æ³•æ˜¯æ²™ç®±ä¿æŠ¤æœºåˆ¶çš„æ ¸å¿ƒå®ç°</p>\n</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// è¿™ä¸ªæ–¹æ³•åœ¨åŒäº²å§”æ´¾æ¨¡å‹ä¹‹å‰è¢«è°ƒç”¨ï¼Œç”¨äºåœ¨åŠ è½½ç±»ä¹‹å‰è¿›è¡Œä¸€äº›é¢„å¤„ç†æ“ä½œã€‚</span></span><br><span class=\"line\"><span class=\"comment\">// å‚æ•°ï¼š</span></span><br><span class=\"line\"><span class=\"comment\">// name: è¦åŠ è½½çš„ç±»çš„å…¨é™å®šåã€‚</span></span><br><span class=\"line\"><span class=\"comment\">// pd: æä¾›çš„ä¿æŠ¤åŸŸä¿¡æ¯ï¼Œå¯èƒ½ä¸º nullã€‚</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> ProtectionDomain <span class=\"title function_\">preDefineClass</span><span class=\"params\">(String name,</span></span><br><span class=\"line\"><span class=\"params\">                                            ProtectionDomain pd)</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!checkName(name))</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">NoClassDefFoundError</span>(<span class=\"string\">&quot;IllegalName: &quot;</span> + name);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// Note:  Checking logic in java.lang.invoke.MemberName.checkForTypeAlias</span></span><br><span class=\"line\">        <span class=\"comment\">// relies on the fact that spoofing is impossible if a class has a name</span></span><br><span class=\"line\">        <span class=\"comment\">// of the form &quot;java.*&quot;</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> ((name != <span class=\"literal\">null</span>) &amp;&amp; name.startsWith(<span class=\"string\">&quot;java.&quot;</span>)) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">SecurityException</span></span><br><span class=\"line\">                (<span class=\"string\">&quot;Prohibited package name: &quot;</span> +</span><br><span class=\"line\">                 name.substring(<span class=\"number\">0</span>, name.lastIndexOf(<span class=\"string\">&#x27;.&#x27;</span>)));</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (pd == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">            pd = defaultDomain;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (name != <span class=\"literal\">null</span>) checkCerts(name, pd.getCodeSource());</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> pd;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¿™ä¸ªæ–¹æ³• <code>preDefineClass</code> çš„ä½œç”¨æ˜¯åœ¨ç±»è¢«å®šä¹‰ä¹‹å‰è¿›è¡Œä¸€äº›å®‰å…¨æ£€æŸ¥å’Œå‡†å¤‡å·¥ä½œï¼Œç¡®ä¿ç±»çš„åˆæ³•æ€§ä¸å®‰å…¨æ€§ã€‚å®ƒé€šå¸¸ç”¨äºè‡ªå®šä¹‰ç±»åŠ è½½å™¨ä¸­ï¼Œä»¥å¢å¼ºç±»åŠ è½½è¿‡ç¨‹ä¸­çš„å®‰å…¨æ§åˆ¶ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>æ–¹æ³•ä½œç”¨è¯¦è§£ï¼š</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">1.é˜²æ­¢å®šä¹‰éæ³•ç±»åçš„ç±»ï¼ˆå¦‚ java.* åŒ…ä¸‹çš„ç±»ï¼‰ï¼š\n<ul class=\"lvl-4\">\n<li class=\"lvl-6\">å¦‚æœå°è¯•åŠ è½½çš„ç±»å±äº java. å¼€å¤´çš„æ ‡å‡†åŒ…ï¼ˆå¦‚ java.lang, java.util ç­‰ï¼‰ï¼Œä¼šæŠ›å‡º SecurityExceptionã€‚</li>\n<li class=\"lvl-6\">è¿™æ˜¯ä¸ºäº†é˜²æ­¢ç”¨æˆ·è‡ªå®šä¹‰ç±»ä¼ªè£…æˆ Java æ ¸å¿ƒç±»åº“ä¸­çš„ç±»ï¼Œä»è€Œé€ æˆå®‰å…¨é£é™©ã€‚</li>\n</ul>\n</li>\n<li class=\"lvl-4\">2.æ ¡éªŒç±»ååˆæ³•æ€§ï¼š\n<ul class=\"lvl-4\">\n<li class=\"lvl-6\">è°ƒç”¨ checkName(name) æ£€æŸ¥ç±»åæ˜¯å¦åˆæ³•ï¼ˆä¾‹å¦‚ä¸èƒ½åŒ…å« /ã€éæ³•å­—ç¬¦ç­‰ï¼‰ï¼Œè‹¥ä¸åˆæ³•åˆ™æŠ›å‡º NoClassDefFoundErrorã€‚</li>\n</ul>\n</li>\n<li class=\"lvl-4\">3.è¯ä¹¦ä¸€è‡´æ€§æ ¡éªŒï¼ˆç­¾åä¸€è‡´æ€§æ ¡éªŒï¼‰ï¼š\n<ul class=\"lvl-4\">\n<li class=\"lvl-6\">å¦‚æœç±»æœ‰åç§°ä¸”æä¾›äº† ProtectionDomainï¼Œä¼šè°ƒç”¨ checkCerts(name, codeSource) æ¥ç¡®ä¿å½“å‰ç±»çš„ç­¾åä¸å…¶æ‰€åœ¨åŒ…ä¸­å…¶ä»–ç±»çš„ç­¾åä¸€è‡´ã€‚</li>\n<li class=\"lvl-6\">é˜²æ­¢åŒä¸€åŒ…ä¸­æ··å…¥ä¸åŒç­¾åçš„ç±»ï¼Œé¿å…æ½œåœ¨çš„æ¶æ„ç¯¡æ”¹ã€‚</li>\n</ul>\n</li>\n<li class=\"lvl-4\">4.è®¾ç½®é»˜è®¤ä¿æŠ¤åŸŸï¼ˆProtectionDomainï¼‰ï¼š\n<ul class=\"lvl-4\">\n<li class=\"lvl-6\">å¦‚æœä¼ å…¥çš„ ProtectionDomain ä¸º nullï¼Œåˆ™ä½¿ç”¨ç±»åŠ è½½å™¨çš„é»˜è®¤åŸŸ defaultDomainã€‚</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"Linkingé“¾æ¥è¿‡ç¨‹\">Linkingé“¾æ¥è¿‡ç¨‹</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åœ¨ClassLoaderçš„<code>loadClass</code>â½…æ³•ä¸­ï¼Œè¿˜æœ‰â¼€ä¸ªä¸èµ·çœ¼çš„æ­¥éª¤ï¼Œ<code>resolveClass</code>ã€‚è¿™æ˜¯â¼€ä¸ª<code>native</code>â½…æ³•ã€‚â½½å…¶å®ç°çš„è¿‡ç¨‹ç§°ä¸º<code>linking-é“¾æ¥</code>ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>é“¾æ¥è¿‡ç¨‹çš„å®ç°åŠŸèƒ½å¦‚ä¸‹å›¾ï¼š<br>\n<img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/uPic/9vkhLN.png\" alt=\"\" width=\"900\" height=\"500\"></p>\n</li>\n<li class=\"lvl-2\">\n<p>å…¶ä¸­å…³äºåŠåˆå§‹åŒ–çŠ¶æ€å°±æ˜¯JDKåœ¨å¤„ç†â¼€ä¸ªç±»çš„staticé™æ€å±æ€§æ—¶ï¼Œä¼šå…ˆç»™è¿™ä¸ªå±æ€§åˆ†é…â¼€ä¸ªé»˜è®¤å€¼ï¼Œä½œâ½¤æ˜¯å ä½å†…å­˜ã€‚ç„¶åç­‰è¿æ¥è¿‡ç¨‹å®Œæˆåï¼Œåœ¨åâ¾¯çš„åˆå§‹åŒ–é˜¶æ®µï¼Œå†å°†é™æ€å±æ€§ä»é»˜è®¤å€¼ä¿®æ”¹ä¸ºæŒ‡å®šçš„åˆå§‹å€¼ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ç¬¦å·å¼•â½¤å’Œç›´æ¥å¼•â½¤</p>\n</li>\n</ul>\n<blockquote>\n<p>å¦‚æœAç±»ä¸­æœ‰â¼€ä¸ªé™æ€å±æ€§ï¼Œå¼•â½¤äº†å¦â¼€ä¸ªBç±»ã€‚é‚£ä¹ˆåœ¨å¯¹ç±»è¿›â¾åˆå§‹åŒ–çš„è¿‡ç¨‹ä¸­ï¼Œå› ä¸ºAå’ŒBè¿™ä¸¤ä¸ªç±»éƒ½æ²¡æœ‰åˆå§‹åŒ–ï¼ŒJVMå¹¶ä¸çŸ¥é“Aå’ŒBè¿™ä¸¤ä¸ªç±»çš„å…·ä½“åœ°å€ã€‚æ‰€ä»¥è¿™æ—¶ï¼Œåœ¨Aç±»ä¸­ï¼Œåªèƒ½åˆ›å»ºâ¼€ä¸ªä¸çŸ¥é“å…·ä½“åœ°å€çš„å¼•â½¤ï¼ŒæŒ‡å‘Bç±»ã€‚è¿™ä¸ªå¼•â½¤å°±ç§°ä¸ºç¬¦å·å¼•â½¤ã€‚â½½å½“Aç±»å’ŒBç±»éƒ½å®Œæˆåˆå§‹åŒ–åï¼ŒJVMâ¾ƒç„¶å°±éœ€è¦å°†è¿™ä¸ªç¬¦å·å¼•â½¤è½¬â½½æŒ‡å‘Bç±»å…·ä½“çš„å†…å­˜åœ°å€ï¼Œè¿™ä¸ªå¼•â½¤å°±ç§°ä¸ºç›´æ¥å¼•â½¤ã€‚</p>\n</blockquote>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ¥çœ‹ä¸€ä¸ªæœ‰æ„æ€çš„ç¤ºä¾‹</p>\n</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Apple</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// é™æ€å˜é‡æŒ‰å£°æ˜é¡ºåºåˆå§‹åŒ–</span></span><br><span class=\"line\">    <span class=\"comment\">// æ„é€ æ–¹æ³•åˆå§‹åŒ–appleå¯¹è±¡æ—¶ï¼Œpriceè¿˜æ²¡æœ‰è¢«åˆå§‹åŒ–ï¼Œå¤„äºé“¾æ¥è¿‡ç¨‹ä¸­çš„å‡†å¤‡é˜¶æ®µï¼Œå³åŠåˆå§‹åŒ–çŠ¶æ€ï¼Œæ‰€ä»¥priceä¸ºé»˜è®¤å€¼0.0</span></span><br><span class=\"line\">    <span class=\"keyword\">static</span> <span class=\"type\">Apple</span> <span class=\"variable\">apple</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Apple</span>(<span class=\"number\">10</span>);</span><br><span class=\"line\">    <span class=\"comment\">// è§£å†³æ–¹æ³•æ˜¯å°†priceå£°æ˜åœ¨appleçš„ä¸Šé¢å³å¯</span></span><br><span class=\"line\">    <span class=\"keyword\">static</span> <span class=\"type\">double</span> <span class=\"variable\">price</span> <span class=\"operator\">=</span> <span class=\"number\">20.00</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"type\">double</span> totalpay;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">Apple</span><span class=\"params\">(<span class=\"type\">double</span> discount)</span> &#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;====&quot;</span> + price);</span><br><span class=\"line\">        totalpay = price - discount;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">PriceTest</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> &#123;</span><br><span class=\"line\">        System.out.println(Apple.apple.totalpay); <span class=\"comment\">// -10.0</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¿™é‡Œæœ‰ä¸€ä¸ªæœ‰æ„æ€çš„é—®é¢˜ï¼Œå°±æ˜¯åªæœ‰å½“<code>loadClass</code>æ–¹æ³•ä¸­çš„<code>resolve</code>å‚æ•°ä¸º<code>true</code>æ—¶<code>resolveClass</code>æ–¹æ³•æ‰ä¼šè¢«è°ƒç”¨ï¼Œä½†æ˜¯å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œ<code>resolve</code>å‚æ•°éƒ½æ˜¯<code>false</code>ï¼Œè¿™ä¸æ˜¯å¼ºåˆ¶é™åˆ¶è€Œæ˜¯å‡ºäºä»¥ä¸‹åŸå› ï¼š</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">\n<ol>\n<li class=\"lvl-7\">é¿å…é€’å½’è§£æä¸­å‡ºç°é”™è¯¯æˆ–æ­»å¾ªç¯<br>\nåœ¨ç±»çš„è§£æè¿‡ç¨‹ä¸­ï¼Œå¦‚æœè¯¥ç±»å¼•ç”¨äº†å¦ä¸€ä¸ªè¿˜æ²¡åŠ è½½çš„ç±»ï¼Œç«‹å³è§£æå¯èƒ½ä¼šå¯¼è‡´æ— é™é€’å½’æˆ–åŠ è½½é¡ºåºé—®é¢˜ã€‚é€šè¿‡å»¶è¿Ÿè§£æï¼Œå¯ä»¥æ›´å¥½åœ°æ§åˆ¶åŠ è½½æµç¨‹ã€‚</li>\n</ol>\n</li>\n<li class=\"lvl-4\">\n<ol start=\"2\">\n<li class=\"lvl-7\">æé«˜åŠ è½½æ•ˆç‡<br>\nåŠ è½½ç±»å¯èƒ½ä¸ä¸€å®šé©¬ä¸Šå°±ç”¨åˆ°æ‰€æœ‰æ–¹æ³•ã€å­—æ®µç­‰ç¬¦å·å¼•ç”¨ï¼Œæ¨è¿Ÿè§£æå¯ä»¥æé«˜æ€§èƒ½ï¼Œå°¤å…¶åœ¨æ‰¹é‡åŠ è½½å¾ˆå¤šç±»æ—¶ã€‚</li>\n</ol>\n</li>\n<li class=\"lvl-4\">\n<ol start=\"3\">\n<li class=\"lvl-7\">æ›´çµæ´»åœ°å¤„ç†ç±»çš„ä¾èµ–<br>\nå¼€å‘è€…å¯ä»¥å…ˆåŠ è½½ç±»ï¼Œç¨åæ ¹æ®éœ€è¦å†è§£æã€‚ä¾‹å¦‚ï¼Œåœ¨è‡ªå®šä¹‰ç±»åŠ è½½å™¨ä¸­ï¼Œå¯èƒ½å…ˆåˆ¤æ–­ç±»æ˜¯å¦å·²ç»å­˜åœ¨ã€æ˜¯å¦éœ€è¦è¢«å¢å¼ºï¼ˆæ¯”å¦‚å­—èŠ‚ç å¢å¼ºï¼‰ï¼Œå†å†³å®šæ˜¯å¦è§£æã€‚</li>\n</ol>\n</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"é€šè¿‡ç±»åŠ è½½å™¨å¼•â¼Šå¤–éƒ¨JaråŒ…\">é€šè¿‡ç±»åŠ è½½å™¨å¼•â¼Šå¤–éƒ¨JaråŒ…</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è™½ç„¶é€šå¸¸æˆ‘ä»¬ä¼šå°†ä¾èµ–çš„ jar åŒ…ç›´æ¥æ”¾å…¥é¡¹ç›®çš„ classpath ä¸­ï¼ˆæ¯”å¦‚é€šè¿‡æ„å»ºå·¥å…·å¦‚ Maven æˆ– Gradle ç®¡ç†ï¼‰ï¼Œä½†åœ¨æŸäº›ç‰¹å®šåœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬ç¡®å®éœ€è¦åŠ¨æ€åœ°é€šè¿‡ URLClassLoader åŠ è½½å¤–éƒ¨ jar åŒ…ï¼Œè¿™æ˜¯ Java æä¾›çš„ä¸€ç§æ›´çµæ´»çš„ç±»åŠ è½½æœºåˆ¶ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä»¥ä¸‹æ˜¯ä¸€äº›å¿…é¡»æˆ–æ¨èä½¿ç”¨ URLClassLoader çš„å…¸å‹åº”ç”¨åœºæ™¯ï¼š</p>\n</li>\n</ul>\n<h3 id=\"1-æ’ä»¶æœºåˆ¶ï¼ˆPlugin-Systemï¼‰\">1. æ’ä»¶æœºåˆ¶ï¼ˆPlugin Systemï¼‰</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åœºæ™¯è¯´æ˜ï¼š<br>\nç³»ç»Ÿæ”¯æŒç”¨æˆ·è‡ªå®šä¹‰æ’ä»¶ï¼ˆå¦‚ IDE æ’ä»¶ã€æµè§ˆå™¨æ‰©å±•ã€æ¸¸æˆ modï¼‰ï¼Œè¿™äº›æ’ä»¶åœ¨è¿è¡Œæ—¶æ‰åŠ è½½ï¼Œé¡¹ç›®æœ¬èº«åœ¨ç¼–è¯‘æœŸå¹¶ä¸çŸ¥é“æœ‰å“ªäº›æ’ä»¶ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä¸¾ä¾‹ï¼š<br>\nEclipse æˆ– IntelliJ çš„æ’ä»¶ç³»ç»Ÿ<br>\nMinecraft çš„ mod åŠ è½½å™¨<br>\nSpring Boot Devtools é‡æ–°åŠ è½½æœºåˆ¶</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä¸ºä»€ä¹ˆä¸èƒ½ç›´æ¥æ”¾å…¥ classpathï¼Ÿ<br>\nå› ä¸ºæ’ä»¶æ˜¯åŠ¨æ€å‘ç°å’ŒåŠ è½½çš„ï¼Œä¸æ˜¯ç¼–è¯‘æ—¶ç¡®å®šçš„ã€‚</p>\n</li>\n</ul>\n<h3 id=\"2-çƒ­éƒ¨ç½²-åŠ¨æ€åŠ è½½ç±»\">2. çƒ­éƒ¨ç½² / åŠ¨æ€åŠ è½½ç±»</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åœºæ™¯è¯´æ˜ï¼š<br>\nä½ æƒ³åœ¨åº”ç”¨è¿è¡Œè¿‡ç¨‹ä¸­åŠ è½½æ–°çš„ jar æˆ–ç±»ï¼Œæ¯”å¦‚çƒ­æ›´æ–°ä¸€ä¸ªæ¨¡å—è€Œæ— éœ€é‡å¯æœåŠ¡ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä¸¾ä¾‹ï¼š<br>\nWeb å®¹å™¨ï¼ˆå¦‚ Tomcatï¼‰çš„åº”ç”¨é‡æ–°éƒ¨ç½²<br>\nä½¿ç”¨ URLClassLoader åŠ è½½æŸä¸ªæ¨¡å—çš„æ–°ç‰ˆæœ¬ä»¥å®ç°çƒ­æ›¿æ¢</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä¸ºä»€ä¹ˆä¸èƒ½æ”¾å…¥ classpathï¼Ÿ<br>\nclasspath åœ¨å¯åŠ¨æ—¶å°±å›ºå®šäº†ï¼Œä¸èƒ½åŠ¨æ€æ·»åŠ ï¼›è€Œ URLClassLoader å¯ä»¥è¿è¡Œæ—¶åŠ è½½æ–° jarã€‚</p>\n</li>\n</ul>\n<h3 id=\"3-å¤šç‰ˆæœ¬éš”ç¦»\">3. å¤šç‰ˆæœ¬éš”ç¦»</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åœºæ™¯è¯´æ˜ï¼š<br>\nä½ å¸Œæœ›ä¸åŒçš„æ¨¡å—ä½¿ç”¨åŒä¸€ä¸ªåº“çš„ä¸åŒç‰ˆæœ¬ï¼Œä½† classpath æ— æ³•æ”¯æŒä¸¤ä¸ªç‰ˆæœ¬çš„åŒä¸€ä¸ªç±»ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä¸¾ä¾‹ï¼š<br>\nä¸€ä¸ªæœåŠ¡å™¨è¿è¡Œå¤šä¸ªæœåŠ¡å®ä¾‹ï¼Œå®ƒä»¬åˆ†åˆ«ä¾èµ– log4j çš„ä¸åŒç‰ˆæœ¬<br>\nä¸€ä¸ªç³»ç»Ÿçš„æ’ä»¶ A ä½¿ç”¨ fastjson 1.xï¼Œæ’ä»¶ B ä½¿ç”¨ fastjson 2.x</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä¸ºä»€ä¹ˆä¸èƒ½æ”¾å…¥ classpathï¼Ÿ<br>\nclasspath æ˜¯å…±äº«çš„ï¼Œä¼šå‘ç”Ÿç±»å†²çªã€‚ä½¿ç”¨å¤šä¸ª URLClassLoaderï¼Œå¯å®ç°ç±»éš”ç¦»ã€‚</p>\n</li>\n</ul>\n<h3 id=\"4-è„šæœ¬æˆ–ç”¨æˆ·ä¸Šä¼ ä»£ç æ‰§è¡Œ\">4. è„šæœ¬æˆ–ç”¨æˆ·ä¸Šä¼ ä»£ç æ‰§è¡Œ</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åœºæ™¯è¯´æ˜ï¼š<br>\nç³»ç»Ÿå…è®¸ç”¨æˆ·ä¸Šä¼  jar æˆ– class æ–‡ä»¶ï¼Œç„¶ååœ¨æœåŠ¡ç«¯æ‰§è¡Œå…¶ä¸­çš„ç±»é€»è¾‘ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä¸¾ä¾‹ï¼š<br>\nåœ¨çº¿ç¼–ç¨‹å¹³å°ï¼ˆå¦‚ LeetCode åç«¯ï¼‰<br>\nç”¨æˆ·ä¸Šä¼ ç®—æ³• jarï¼Œå¹³å°è¿è¡Œå¹¶è¿”å›ç»“æœ</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä¸ºä»€ä¹ˆä¸èƒ½æ”¾å…¥ classpathï¼Ÿ<br>\nç”¨æˆ·ä¸Šä¼ å†…å®¹æ˜¯åŠ¨æ€çš„ï¼Œç³»ç»Ÿåœ¨è¿è¡Œå‰æ— æ³•é¢„çŸ¥ã€‚</p>\n</li>\n</ul>\n<h3 id=\"5-å®ç°ç±»çš„å»¶è¿ŸåŠ è½½ï¼ˆèŠ‚çœèµ„æºï¼‰\">5. å®ç°ç±»çš„å»¶è¿ŸåŠ è½½ï¼ˆèŠ‚çœèµ„æºï¼‰</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åœºæ™¯è¯´æ˜ï¼š<br>\næŸäº›ç±»/æ¨¡å—ä½“ç§¯è¾ƒå¤§æˆ–ä¾èµ–è¾ƒå¤šï¼Œä¸å¸Œæœ›åœ¨ç¨‹åºå¯åŠ¨æ—¶å°±åŠ è½½ï¼Œåªæœ‰çœŸæ­£ä½¿ç”¨æ—¶å†åŠ è½½ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä¸¾ä¾‹ï¼š<br>\nå¤§å‹æ¡Œé¢åº”ç”¨ï¼ˆå¦‚ IntelliJï¼‰åœ¨æ‰“å¼€æŸä¸ªåŠŸèƒ½æ¨¡å—æ—¶æ‰åŠ è½½ç›¸åº” jar</p>\n</li>\n</ul>\n<h3 id=\"æ€»ç»“\">æ€»ç»“</h3>\n<table>\n<thead>\n<tr>\n<th>åœºæ™¯</th>\n<th>ä½¿ç”¨ <code>URLClassLoader</code> çš„åŸå› </th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>æ’ä»¶ç³»ç»Ÿ</td>\n<td>æ’ä»¶åŠ¨æ€åŠ è½½ï¼Œä¸åœ¨é¡¹ç›®ç¼–è¯‘æ—¶å¯çŸ¥</td>\n</tr>\n<tr>\n<td>çƒ­éƒ¨ç½²</td>\n<td>åŠ¨æ€æ›¿æ¢æ¨¡å—ï¼Œæ— éœ€é‡å¯</td>\n</tr>\n<tr>\n<td>å¤šç‰ˆæœ¬å…±å­˜</td>\n<td>é¿å…ç±»å†²çªï¼Œå®ç°ç±»åŠ è½½éš”ç¦»</td>\n</tr>\n<tr>\n<td>ç”¨æˆ·ä¸Šä¼  jar</td>\n<td>å†…å®¹åŠ¨æ€ç”Ÿæˆï¼Œclasspath æ— æ³•é¢„å…ˆé…ç½®</td>\n</tr>\n<tr>\n<td>å»¶è¿ŸåŠ è½½æ¨¡å—</td>\n<td>å¯åŠ¨æ›´å¿«ï¼ŒèŠ‚çœå†…å­˜</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¦‚æœä½ æ˜¯åœ¨åšæ¡†æ¶è®¾è®¡æˆ–éœ€è¦åŠ¨æ€æ‰©å±•èƒ½åŠ›çš„åœºæ™¯ï¼Œç†è§£å¹¶ä½¿ç”¨ URLClassLoader ä¼šéå¸¸æœ‰å¸®åŠ©ã€‚</p>\n</li>\n</ul>\n<h3 id=\"åœºæ™¯å‡è®¾\">åœºæ™¯å‡è®¾</h3>\n<h4 id=\"è°ƒç”¨å¤–éƒ¨jar\">è°ƒç”¨å¤–éƒ¨jar</h4>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æˆ‘ä»¬æœ‰ä¸€ä¸ªå¤–éƒ¨ jar æ–‡ä»¶ï¼šhello-plugin.jarï¼Œå®ƒåŒ…å«ä¸€ä¸ªç±»ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// è¿™ä¸ªç±»ç¼–è¯‘åæ‰“åŒ…è¿› hello-plugin.jar</span></span><br><span class=\"line\"><span class=\"keyword\">package</span> com.example.plugin;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">HelloPlugin</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">sayHello</span><span class=\"params\">(String name)</span> &#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;Hello from plugin! :&quot;</span> + name);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¸»ç¨‹åºä½¿ç”¨ URLClassLoader åŠ¨æ€åŠ è½½è¿™ä¸ª jar</p>\n</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> java.io.File;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.lang.reflect.Method;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.net.URL;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.net.URLClassLoader;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">PluginLoader</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> Exception &#123;</span><br><span class=\"line\">        <span class=\"comment\">// å¤–éƒ¨ jar çš„è·¯å¾„</span></span><br><span class=\"line\">        <span class=\"type\">File</span> <span class=\"variable\">jarFile</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">File</span>(<span class=\"string\">&quot;plugins/hello-plugin.jar&quot;</span>);</span><br><span class=\"line\">        <span class=\"type\">URL</span> <span class=\"variable\">jarUrl</span> <span class=\"operator\">=</span> jarFile.toURI().toURL();</span><br><span class=\"line\">        <span class=\"comment\">// HTTPS jar çš„ URL</span></span><br><span class=\"line\">        <span class=\"comment\">// URL jarUrl = new URL(&quot;https://your-domain.com/libs/hello-plugin.jar&quot;);</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// æ„å»º URLClassLoaderï¼ˆä¹Ÿå¯ä»¥è®¾ç½®çˆ¶åŠ è½½å™¨ï¼‰</span></span><br><span class=\"line\">        <span class=\"type\">URLClassLoader</span> <span class=\"variable\">classLoader</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">URLClassLoader</span>(<span class=\"keyword\">new</span> <span class=\"title class_\">URL</span>[]&#123;jarUrl&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// åŠ è½½æ’ä»¶ç±»</span></span><br><span class=\"line\">        Class&lt;?&gt; clazz = classLoader.loadClass(<span class=\"string\">&quot;com.example.plugin.HelloPlugin&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// åˆ›å»ºå®ä¾‹å¹¶è°ƒç”¨æ–¹æ³•</span></span><br><span class=\"line\">        <span class=\"type\">Object</span> <span class=\"variable\">plugin</span> <span class=\"operator\">=</span> clazz.getDeclaredConstructor().newInstance();</span><br><span class=\"line\">        <span class=\"type\">Method</span> <span class=\"variable\">sayHello</span> <span class=\"operator\">=</span> clazz.getMethod(<span class=\"string\">&quot;sayHello&quot;</span>, String.class);</span><br><span class=\"line\">        sayHello.invoke(plugin, <span class=\"string\">&quot;World&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// å…³é—­ ClassLoaderï¼ˆJava 7+ æ¨èï¼‰</span></span><br><span class=\"line\">        classLoader.close();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"è¿è¡Œæ—¶åŠ¨æ€ç¼–è¯‘-Java-æºä»£ç \">è¿è¡Œæ—¶åŠ¨æ€ç¼–è¯‘ Java æºä»£ç </h4>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æˆ‘ä»¬æœ‰ä¸€ä¸ª java ä»£ç ç‰‡æ®µï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> javax.tools.JavaCompiler;</span><br><span class=\"line\"><span class=\"keyword\">import</span> javax.tools.ToolProvider;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.File;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.FileWriter;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.lang.reflect.Method;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.net.URL;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.net.URLClassLoader;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.nio.file.Files;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.nio.file.Path;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">DynamicJavaRunner</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> Exception &#123;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">className</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;com.example.dynamic.Hello&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// Java æºä»£ç </span></span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">sourceCode</span> <span class=\"operator\">=</span></span><br><span class=\"line\">                <span class=\"string\">&quot;package com.example.dynamic;\\n&quot;</span> +</span><br><span class=\"line\">                        <span class=\"string\">&quot;\\n&quot;</span> +</span><br><span class=\"line\">                        <span class=\"string\">&quot;public class Hello &#123;\\n&quot;</span> +</span><br><span class=\"line\">                        <span class=\"string\">&quot;    public void say() &#123;\\n&quot;</span> +</span><br><span class=\"line\">                        <span class=\"string\">&quot;        System.out.println(\\&quot;Hello from dynamic source!\\&quot;);\\n&quot;</span> +</span><br><span class=\"line\">                        <span class=\"string\">&quot;    &#125;\\n&quot;</span> +</span><br><span class=\"line\">                        <span class=\"string\">&quot;&#125;\\n&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// åˆ›å»ºä¸´æ—¶ç›®å½•</span></span><br><span class=\"line\">        <span class=\"type\">Path</span> <span class=\"variable\">tempDir</span> <span class=\"operator\">=</span> Files.createTempDirectory(<span class=\"string\">&quot;dynamic-classes&quot;</span>);</span><br><span class=\"line\">        <span class=\"type\">File</span> <span class=\"variable\">outputDir</span> <span class=\"operator\">=</span> tempDir.toFile();</span><br><span class=\"line\">        <span class=\"comment\">// System.out.println(&quot;ä¸´æ—¶ç›®å½•ï¼š&quot; + outputDir.getAbsolutePath());</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// åˆ›å»º .java æ–‡ä»¶</span></span><br><span class=\"line\">        <span class=\"type\">File</span> <span class=\"variable\">javaFile</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">File</span>(outputDir, <span class=\"string\">&quot;com/example/dynamic/Hello.java&quot;</span>);</span><br><span class=\"line\">        javaFile.getParentFile().mkdirs();</span><br><span class=\"line\">        <span class=\"keyword\">try</span> (<span class=\"type\">FileWriter</span> <span class=\"variable\">writer</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">FileWriter</span>(javaFile)) &#123;</span><br><span class=\"line\">            writer.write(sourceCode);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// ç¼–è¯‘ Java æ–‡ä»¶</span></span><br><span class=\"line\">        <span class=\"type\">JavaCompiler</span> <span class=\"variable\">compiler</span> <span class=\"operator\">=</span> ToolProvider.getSystemJavaCompiler();</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (compiler == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">            System.err.println(<span class=\"string\">&quot;è¯·ç”¨ JDK è€Œé JRE è¿è¡Œï¼&quot;</span>);</span><br><span class=\"line\">            <span class=\"keyword\">return</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"type\">int</span> <span class=\"variable\">result</span> <span class=\"operator\">=</span> compiler.run(<span class=\"literal\">null</span>, <span class=\"literal\">null</span>, <span class=\"literal\">null</span>, javaFile.getPath());</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (result != <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">            System.err.println(<span class=\"string\">&quot;ç¼–è¯‘å¤±è´¥ï¼&quot;</span>);</span><br><span class=\"line\">            <span class=\"keyword\">return</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// åŠ è½½ç±»å¹¶è°ƒç”¨</span></span><br><span class=\"line\">        <span class=\"type\">URLClassLoader</span> <span class=\"variable\">classLoader</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">URLClassLoader</span>(<span class=\"keyword\">new</span> <span class=\"title class_\">URL</span>[]&#123;outputDir.toURI().toURL()&#125;);</span><br><span class=\"line\">        Class&lt;?&gt; clazz = classLoader.loadClass(className);</span><br><span class=\"line\">        <span class=\"type\">Object</span> <span class=\"variable\">instance</span> <span class=\"operator\">=</span> clazz.getDeclaredConstructor().newInstance();</span><br><span class=\"line\">        <span class=\"type\">Method</span> <span class=\"variable\">method</span> <span class=\"operator\">=</span> clazz.getMethod(<span class=\"string\">&quot;say&quot;</span>);</span><br><span class=\"line\">        method.invoke(instance);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// æ¸…ç†ï¼ˆå¯é€‰ï¼‰</span></span><br><span class=\"line\">        classLoader.close();</span><br><span class=\"line\">        <span class=\"comment\">// åˆ é™¤ä¸´æ—¶ç›®å½•</span></span><br><span class=\"line\">        Files.walk(outputDir.toPath())</span><br><span class=\"line\">                .sorted(Comparator.reverseOrder()) <span class=\"comment\">// å…ˆåˆ æ–‡ä»¶ï¼Œå†åˆ ç›®å½•</span></span><br><span class=\"line\">                .map(Path::toFile)</span><br><span class=\"line\">                .forEach(File::delete);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å…³é”®ç‚¹è¯´æ˜</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>æœºåˆ¶</th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>JavaCompiler</code></td>\n<td>JDK è‡ªå¸¦çš„ç¼–è¯‘å™¨ï¼ˆ<code>tools.jar</code>ï¼‰</td>\n</tr>\n<tr>\n<td><code>ToolProvider.getSystemJavaCompiler()</code></td>\n<td>åªèƒ½åœ¨ JDK ç¯å¢ƒä¸­å·¥ä½œï¼ŒJRE æ— æ³•ä½¿ç”¨</td>\n</tr>\n<tr>\n<td><code>URLClassLoader</code></td>\n<td>ç”¨äºåŠ è½½ç¼–è¯‘åçš„ .class æ–‡ä»¶</td>\n</tr>\n<tr>\n<td><code>FileWriter</code></td>\n<td>ä¿å­˜ä»£ç ä¸ºä¸´æ—¶ Java æ–‡ä»¶</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"è‡ªå®šä¹‰ç±»åŠ è½½å™¨\">è‡ªå®šä¹‰ç±»åŠ è½½å™¨</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¦è‡ªå®šä¹‰ ClassLoaderï¼Œåªéœ€è¦ç»§æ‰¿äº <code>ClassLoader</code> æˆ–è€… <code>SecureClassLoader</code>ï¼Œå¹¶é‡å†™ <code>findClass()</code> æ–¹æ³•å³å¯</p>\n</li>\n<li class=\"lvl-2\">\n<p>ç¤ºä¾‹ï¼šæˆ‘ä»¬å¯¹ä¸Šé¢çš„ä»£ç è¿›è¡Œå‡çº§ï¼Œä¸åˆ›å»ºä¸´æ—¶æ–‡ä»¶ï¼Œè€Œæ˜¯åœ¨å†…å­˜ä¸­ç¼–è¯‘ä»£ç ï¼Œå¹¶ä»å†…å­˜ä¸­åŠ è½½å­—èŠ‚ç ï¼Œè€Œä¸ä¾èµ–ç£ç›˜æ–‡ä»¶ï¼Œæ›´é«˜æ•ˆä¹Ÿæ›´é€‚åˆç”Ÿäº§ç¯å¢ƒä¸­åŠ¨æ€ç±»åŠ è½½ï¼ˆå¦‚åœ¨çº¿ä»£ç æ‰§è¡Œã€è„šæœ¬å¼•æ“ç­‰ï¼‰ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> javax.tools.*;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.*;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.net.URI;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.*;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.lang.reflect.*;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">InMemoryJavaRunner</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> Exception &#123;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">className</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;com.example.dynamic.Hello&quot;</span>;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">sourceCode</span> <span class=\"operator\">=</span></span><br><span class=\"line\">                <span class=\"string\">&quot;package com.example.dynamic;\\n&quot;</span> +</span><br><span class=\"line\">                        <span class=\"string\">&quot;public class Hello &#123;\\n&quot;</span> +</span><br><span class=\"line\">                        <span class=\"string\">&quot;    public void say() &#123;\\n&quot;</span> +</span><br><span class=\"line\">                        <span class=\"string\">&quot;        System.out.println(\\&quot;Hello from memory compiled class!\\&quot;);\\n&quot;</span> +</span><br><span class=\"line\">                        <span class=\"string\">&quot;    &#125;\\n&quot;</span> +</span><br><span class=\"line\">                        <span class=\"string\">&quot;&#125;&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// è·å–ç³»ç»Ÿ Java ç¼–è¯‘å™¨</span></span><br><span class=\"line\">        <span class=\"type\">JavaCompiler</span> <span class=\"variable\">compiler</span> <span class=\"operator\">=</span> ToolProvider.getSystemJavaCompiler();</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (compiler == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">            System.err.println(<span class=\"string\">&quot;è¯·ä½¿ç”¨ JDK è¿è¡Œæ­¤ç¨‹åºï¼ˆé JREï¼‰&quot;</span>);</span><br><span class=\"line\">            <span class=\"keyword\">return</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// å‡†å¤‡ç¼–è¯‘æºä»£ç ï¼šä¸€ä¸ª JavaFileObject è¡¨ç¤ºæºä»£ç </span></span><br><span class=\"line\">        <span class=\"type\">JavaFileObject</span> <span class=\"variable\">sourceFile</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">JavaSourceFromString</span>(className, sourceCode);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// åˆ›å»ºè‡ªå®šä¹‰çš„å†…å­˜æ–‡ä»¶ç®¡ç†å™¨ï¼ˆæ›¿ä»£æ ‡å‡†çš„ç£ç›˜ç®¡ç†å™¨ï¼‰</span></span><br><span class=\"line\">        <span class=\"type\">StandardJavaFileManager</span> <span class=\"variable\">standardFileManager</span> <span class=\"operator\">=</span> compiler.getStandardFileManager(<span class=\"literal\">null</span>, <span class=\"literal\">null</span>, <span class=\"literal\">null</span>);</span><br><span class=\"line\">        <span class=\"type\">MemoryJavaFileManager</span> <span class=\"variable\">fileManager</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">MemoryJavaFileManager</span>(standardFileManager);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// æ‰§è¡Œç¼–è¯‘ä»»åŠ¡</span></span><br><span class=\"line\">        JavaCompiler.<span class=\"type\">CompilationTask</span> <span class=\"variable\">task</span> <span class=\"operator\">=</span> compiler.getTask(<span class=\"literal\">null</span>, fileManager, <span class=\"literal\">null</span>, <span class=\"literal\">null</span>, <span class=\"literal\">null</span>, Collections.singletonList(sourceFile));</span><br><span class=\"line\">        <span class=\"type\">boolean</span> <span class=\"variable\">success</span> <span class=\"operator\">=</span> task.call();</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!success) &#123;</span><br><span class=\"line\">            System.err.println(<span class=\"string\">&quot;ç¼–è¯‘å¤±è´¥ï¼&quot;</span>);</span><br><span class=\"line\">            <span class=\"keyword\">return</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// åŠ è½½ç¼–è¯‘åçš„ç±»</span></span><br><span class=\"line\">        Map&lt;String, <span class=\"type\">byte</span>[]&gt; classBytes = fileManager.getClassBytes();</span><br><span class=\"line\">        <span class=\"type\">InMemoryClassLoader</span> <span class=\"variable\">classLoader</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">InMemoryClassLoader</span>(classBytes);</span><br><span class=\"line\">        Class&lt;?&gt; clazz = classLoader.loadClass(className);</span><br><span class=\"line\">        <span class=\"type\">Object</span> <span class=\"variable\">instance</span> <span class=\"operator\">=</span> clazz.getDeclaredConstructor().newInstance();</span><br><span class=\"line\">        <span class=\"type\">Method</span> <span class=\"variable\">method</span> <span class=\"operator\">=</span> clazz.getMethod(<span class=\"string\">&quot;say&quot;</span>);</span><br><span class=\"line\">        method.invoke(instance);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// ç”¨äºè¡¨ç¤ºå†…å­˜ä¸­çš„ Java æºä»£ç </span></span><br><span class=\"line\">    <span class=\"keyword\">static</span> <span class=\"keyword\">class</span> <span class=\"title class_\">JavaSourceFromString</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">SimpleJavaFileObject</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">final</span> String code;</span><br><span class=\"line\"></span><br><span class=\"line\">        JavaSourceFromString(String className, String code) &#123;</span><br><span class=\"line\">            <span class=\"built_in\">super</span>(URI.create(<span class=\"string\">&quot;string:///&quot;</span> + className.replace(<span class=\"string\">&#x27;.&#x27;</span>, <span class=\"string\">&#x27;/&#x27;</span>) + Kind.SOURCE.extension), Kind.SOURCE);</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.code = code;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">public</span> CharSequence <span class=\"title function_\">getCharContent</span><span class=\"params\">(<span class=\"type\">boolean</span> ignoreEncodingErrors)</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> code;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// å°†ç¼–è¯‘çš„ class æ–‡ä»¶ä¿å­˜åœ¨å†…å­˜ä¸­ï¼ˆä¸æ˜¯æ–‡ä»¶ç³»ç»Ÿï¼‰</span></span><br><span class=\"line\">    <span class=\"keyword\">static</span> <span class=\"keyword\">class</span> <span class=\"title class_\">MemoryJavaFileManager</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">ForwardingJavaFileManager</span>&lt;StandardJavaFileManager&gt; &#123;</span><br><span class=\"line\">        <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> Map&lt;String, ByteArrayOutputStream&gt; classOutputBuffers = <span class=\"keyword\">new</span> <span class=\"title class_\">HashMap</span>&lt;&gt;();</span><br><span class=\"line\"></span><br><span class=\"line\">        MemoryJavaFileManager(StandardJavaFileManager standardManager) &#123;</span><br><span class=\"line\">            <span class=\"built_in\">super</span>(standardManager);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"keyword\">public</span> JavaFileObject <span class=\"title function_\">getJavaFileForOutput</span><span class=\"params\">(Location location, String className,</span></span><br><span class=\"line\"><span class=\"params\">                                                   JavaFileObject.Kind kind, FileObject sibling)</span> &#123;</span><br><span class=\"line\">            <span class=\"type\">ByteArrayOutputStream</span> <span class=\"variable\">outputStream</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ByteArrayOutputStream</span>();</span><br><span class=\"line\">            classOutputBuffers.put(className, outputStream);</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">SimpleJavaFileObject</span>(</span><br><span class=\"line\">                    URI.create(<span class=\"string\">&quot;mem:///&quot;</span> + className.replace(<span class=\"string\">&#x27;.&#x27;</span>, <span class=\"string\">&#x27;/&#x27;</span>) + kind.extension), kind) &#123;</span><br><span class=\"line\">                <span class=\"meta\">@Override</span></span><br><span class=\"line\">                <span class=\"keyword\">public</span> OutputStream <span class=\"title function_\">openOutputStream</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> outputStream;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">public</span> Map&lt;String, <span class=\"type\">byte</span>[]&gt; getClassBytes() &#123;</span><br><span class=\"line\">            Map&lt;String, <span class=\"type\">byte</span>[]&gt; result = <span class=\"keyword\">new</span> <span class=\"title class_\">HashMap</span>&lt;&gt;();</span><br><span class=\"line\">            <span class=\"keyword\">for</span> (Map.Entry&lt;String, ByteArrayOutputStream&gt; entry : classOutputBuffers.entrySet()) &#123;</span><br><span class=\"line\">                result.put(entry.getKey(), entry.getValue().toByteArray());</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> result;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// è‡ªå®šä¹‰ ClassLoaderï¼Œç”¨äºä»å†…å­˜ä¸­åŠ è½½å­—èŠ‚ç </span></span><br><span class=\"line\">    <span class=\"keyword\">static</span> <span class=\"keyword\">class</span> <span class=\"title class_\">InMemoryClassLoader</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">ClassLoader</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> Map&lt;String, <span class=\"type\">byte</span>[]&gt; classBytes;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"title function_\">InMemoryClassLoader</span><span class=\"params\">(Map&lt;String, <span class=\"type\">byte</span>[]&gt; classBytes)</span> &#123;</span><br><span class=\"line\">            <span class=\"built_in\">super</span>(ClassLoader.getSystemClassLoader());</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.classBytes = classBytes;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"keyword\">protected</span> Class&lt;?&gt; findClass(String name) <span class=\"keyword\">throws</span> ClassNotFoundException &#123;</span><br><span class=\"line\">            <span class=\"comment\">// ä»å†…å­˜ä¸­è·å–å­—èŠ‚ç </span></span><br><span class=\"line\">            <span class=\"type\">byte</span>[] bytes = classBytes.get(name);</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (bytes == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"built_in\">super</span>.findClass(name);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"comment\">// å®šä¹‰ç±»å¹¶è¿”å›ï¼Œä¸€å®šè¦ä½¿ç”¨ defineClass æ–¹æ³•</span></span><br><span class=\"line\">            <span class=\"keyword\">return</span> defineClass(name, bytes, <span class=\"number\">0</span>, bytes.length);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¿›ä¸€æ­¥å‡çº§ï¼šæˆ‘ä»¬ç°åœ¨å°†è¿™ä¸ªç³»ç»Ÿæ‰©å±•ä¸ºæ”¯æŒå¤šä¸ªç±»åŒæ—¶åŠ¨æ€ç¼–è¯‘ã€å†…å­˜åŠ è½½å¹¶æ‰§è¡Œã€‚è¿™å¯¹äºéœ€è¦å¤„ç†å¤šä¸ªç±»ï¼ˆä¾‹å¦‚æ¥å£ + å®ç°ã€å†…éƒ¨ä¾èµ–ç­‰ï¼‰éå¸¸å®ç”¨ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> javax.tools.*;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.*;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.net.URI;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.*;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.lang.reflect.*;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// ä¸»ç±»</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">MultiClassInMemoryCompiler</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> Exception &#123;</span><br><span class=\"line\">        <span class=\"comment\">// å‡†å¤‡å¤šä¸ªç±»çš„æºä»£ç </span></span><br><span class=\"line\">        Map&lt;String, String&gt; sources = <span class=\"keyword\">new</span> <span class=\"title class_\">HashMap</span>&lt;&gt;();</span><br><span class=\"line\">        sources.put(<span class=\"string\">&quot;com.example.api.Greeter&quot;</span>,</span><br><span class=\"line\">                <span class=\"string\">&quot;package com.example.api;\\n&quot;</span> +</span><br><span class=\"line\">                        <span class=\"string\">&quot;public interface Greeter &#123;\\n&quot;</span> +</span><br><span class=\"line\">                        <span class=\"string\">&quot;    void greet();\\n&quot;</span> +</span><br><span class=\"line\">                        <span class=\"string\">&quot;&#125;\\n&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        sources.put(<span class=\"string\">&quot;com.example.impl.EnglishGreeter&quot;</span>,</span><br><span class=\"line\">                <span class=\"string\">&quot;package com.example.impl;\\n&quot;</span> +</span><br><span class=\"line\">                        <span class=\"string\">&quot;import com.example.api.Greeter;\\n&quot;</span> +</span><br><span class=\"line\">                        <span class=\"string\">&quot;public class EnglishGreeter implements Greeter &#123;\\n&quot;</span> +</span><br><span class=\"line\">                        <span class=\"string\">&quot;    public void greet() &#123;\\n&quot;</span> +</span><br><span class=\"line\">                        <span class=\"string\">&quot;        System.out.println(\\&quot;Hello from EnglishGreeter!\\&quot;);\\n&quot;</span> +</span><br><span class=\"line\">                        <span class=\"string\">&quot;    &#125;\\n&quot;</span> +</span><br><span class=\"line\">                        <span class=\"string\">&quot;&#125;\\n&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">entryClassName</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;com.example.impl.EnglishGreeter&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// ç¼–è¯‘</span></span><br><span class=\"line\">        Map&lt;String, <span class=\"type\">byte</span>[]&gt; compiledClasses = compile(sources);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (compiledClasses == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">            System.err.println(<span class=\"string\">&quot;ç¼–è¯‘å¤±è´¥&quot;</span>);</span><br><span class=\"line\">            <span class=\"keyword\">return</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// åŠ è½½å¹¶æ‰§è¡Œ</span></span><br><span class=\"line\">        <span class=\"type\">InMemoryClassLoader</span> <span class=\"variable\">classLoader</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">InMemoryClassLoader</span>(compiledClasses);</span><br><span class=\"line\">        Class&lt;?&gt; clazz = classLoader.loadClass(entryClassName);</span><br><span class=\"line\">        <span class=\"type\">Object</span> <span class=\"variable\">obj</span> <span class=\"operator\">=</span> clazz.getDeclaredConstructor().newInstance();</span><br><span class=\"line\">        <span class=\"type\">Method</span> <span class=\"variable\">method</span> <span class=\"operator\">=</span> clazz.getMethod(<span class=\"string\">&quot;greet&quot;</span>);</span><br><span class=\"line\">        method.invoke(obj);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// ç¼–è¯‘å™¨å…¥å£ï¼Œæ”¯æŒå¤šä¸ªç±»</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> Map&lt;String, <span class=\"type\">byte</span>[]&gt; compile(Map&lt;String, String&gt; sources) &#123;</span><br><span class=\"line\">        <span class=\"type\">JavaCompiler</span> <span class=\"variable\">compiler</span> <span class=\"operator\">=</span> ToolProvider.getSystemJavaCompiler();</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (compiler == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">            System.err.println(<span class=\"string\">&quot;è¯·ä½¿ç”¨ JDK è¿è¡Œ&quot;</span>);</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        List&lt;JavaFileObject&gt; compilationUnits = <span class=\"keyword\">new</span> <span class=\"title class_\">ArrayList</span>&lt;&gt;();</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (Map.Entry&lt;String, String&gt; entry : sources.entrySet()) &#123;</span><br><span class=\"line\">            compilationUnits.add(<span class=\"keyword\">new</span> <span class=\"title class_\">JavaSourceFromString</span>(entry.getKey(), entry.getValue()));</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">StandardJavaFileManager</span> <span class=\"variable\">stdManager</span> <span class=\"operator\">=</span> compiler.getStandardFileManager(<span class=\"literal\">null</span>, <span class=\"literal\">null</span>, <span class=\"literal\">null</span>);</span><br><span class=\"line\">        <span class=\"type\">MemoryJavaFileManager</span> <span class=\"variable\">memManager</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">MemoryJavaFileManager</span>(stdManager);</span><br><span class=\"line\"></span><br><span class=\"line\">        JavaCompiler.<span class=\"type\">CompilationTask</span> <span class=\"variable\">task</span> <span class=\"operator\">=</span> compiler.getTask(<span class=\"literal\">null</span>, memManager, <span class=\"literal\">null</span>, <span class=\"literal\">null</span>, <span class=\"literal\">null</span>, compilationUnits);</span><br><span class=\"line\">        <span class=\"type\">boolean</span> <span class=\"variable\">success</span> <span class=\"operator\">=</span> task.call();</span><br><span class=\"line\">        <span class=\"keyword\">return</span> success ? memManager.getClassBytes() : <span class=\"literal\">null</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// æºæ–‡ä»¶è¡¨ç¤ºï¼ˆJava ä»£ç ä»¥å­—ç¬¦ä¸²æä¾›ï¼‰</span></span><br><span class=\"line\">    <span class=\"keyword\">static</span> <span class=\"keyword\">class</span> <span class=\"title class_\">JavaSourceFromString</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">SimpleJavaFileObject</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">final</span> String code;</span><br><span class=\"line\"></span><br><span class=\"line\">        JavaSourceFromString(String className, String code) &#123;</span><br><span class=\"line\">            <span class=\"built_in\">super</span>(URI.create(<span class=\"string\">&quot;string:///&quot;</span> + className.replace(<span class=\"string\">&#x27;.&#x27;</span>, <span class=\"string\">&#x27;/&#x27;</span>) + Kind.SOURCE.extension), Kind.SOURCE);</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.code = code;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"keyword\">public</span> CharSequence <span class=\"title function_\">getCharContent</span><span class=\"params\">(<span class=\"type\">boolean</span> ignoreEncodingErrors)</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> code;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// å†…å­˜ä¸­çš„ç¼–è¯‘è¾“å‡ºç®¡ç†å™¨</span></span><br><span class=\"line\">    <span class=\"keyword\">static</span> <span class=\"keyword\">class</span> <span class=\"title class_\">MemoryJavaFileManager</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">ForwardingJavaFileManager</span>&lt;StandardJavaFileManager&gt; &#123;</span><br><span class=\"line\">        <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> Map&lt;String, ByteArrayOutputStream&gt; classOutputBuffers = <span class=\"keyword\">new</span> <span class=\"title class_\">HashMap</span>&lt;&gt;();</span><br><span class=\"line\"></span><br><span class=\"line\">        MemoryJavaFileManager(StandardJavaFileManager standardManager) &#123;</span><br><span class=\"line\">            <span class=\"built_in\">super</span>(standardManager);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"keyword\">public</span> JavaFileObject <span class=\"title function_\">getJavaFileForOutput</span><span class=\"params\">(Location location, String className,</span></span><br><span class=\"line\"><span class=\"params\">                                                   JavaFileObject.Kind kind, FileObject sibling)</span> &#123;</span><br><span class=\"line\">            <span class=\"type\">ByteArrayOutputStream</span> <span class=\"variable\">outputStream</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ByteArrayOutputStream</span>();</span><br><span class=\"line\">            classOutputBuffers.put(className, outputStream);</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">SimpleJavaFileObject</span>(</span><br><span class=\"line\">                    URI.create(<span class=\"string\">&quot;mem:///&quot;</span> + className.replace(<span class=\"string\">&#x27;.&#x27;</span>, <span class=\"string\">&#x27;/&#x27;</span>) + kind.extension), kind) &#123;</span><br><span class=\"line\">                <span class=\"meta\">@Override</span></span><br><span class=\"line\">                <span class=\"keyword\">public</span> OutputStream <span class=\"title function_\">openOutputStream</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> outputStream;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">public</span> Map&lt;String, <span class=\"type\">byte</span>[]&gt; getClassBytes() &#123;</span><br><span class=\"line\">            Map&lt;String, <span class=\"type\">byte</span>[]&gt; result = <span class=\"keyword\">new</span> <span class=\"title class_\">HashMap</span>&lt;&gt;();</span><br><span class=\"line\">            <span class=\"keyword\">for</span> (Map.Entry&lt;String, ByteArrayOutputStream&gt; entry : classOutputBuffers.entrySet()) &#123;</span><br><span class=\"line\">                result.put(entry.getKey(), entry.getValue().toByteArray());</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> result;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// ç”¨äºåŠ è½½å†…å­˜ä¸­çš„ class</span></span><br><span class=\"line\">    <span class=\"keyword\">static</span> <span class=\"keyword\">class</span> <span class=\"title class_\">InMemoryClassLoader</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">ClassLoader</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> Map&lt;String, <span class=\"type\">byte</span>[]&gt; classBytes;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"title function_\">InMemoryClassLoader</span><span class=\"params\">(Map&lt;String, <span class=\"type\">byte</span>[]&gt; classBytes)</span> &#123;</span><br><span class=\"line\">            <span class=\"built_in\">super</span>(ClassLoader.getSystemClassLoader());</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.classBytes = classBytes;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"keyword\">protected</span> Class&lt;?&gt; findClass(String name) <span class=\"keyword\">throws</span> ClassNotFoundException &#123;</span><br><span class=\"line\">            <span class=\"type\">byte</span>[] bytes = classBytes.get(name);</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (bytes == <span class=\"literal\">null</span>) <span class=\"keyword\">return</span> <span class=\"built_in\">super</span>.findClass(name);</span><br><span class=\"line\">            <span class=\"keyword\">return</span> defineClass(name, bytes, <span class=\"number\">0</span>, bytes.length);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"æ‰“ç ´åŒäº²å§”æ´¾ï¼Œå®ç°åŒç±»å¤šç‰ˆæœ¬å…±å­˜\">æ‰“ç ´åŒäº²å§”æ´¾ï¼Œå®ç°åŒç±»å¤šç‰ˆæœ¬å…±å­˜</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å‡è®¾æˆ‘ä»¬æœ‰åŒä¸€ä¸ªjaråŒ…çš„ä¸åŒç‰ˆæœ¬ï¼Œæ¯”å¦‚ï¼š<code>a-1.0.jar</code>å’Œ<code>a-2.0.jar</code>ï¼Œä»–ä»¬å…·æœ‰åŒåçš„ <code>DemoClass</code>ç±» ,ç³»ç»Ÿ<code>classpath</code>ä¸­å¼•å…¥çš„æ˜¯ <code>a-1.0.jar</code>ï¼Œè€Œæ­¤æ—¶æˆ‘ä»¬é€šè¿‡â¾ƒå®šçš„ClassLoaderåŠ è½½ <code>a-2.0.jar</code>ï¼Œå¹¶è°ƒç”¨ <code>DemoClass</code>ç±» ï¼Œæˆ‘ä»¬ä¼šå‘ç°ï¼Œâ¾ƒå®šçš„ClassLoaderåŠ è½½çš„ç±»ä¾æ—§æ˜¯ <code>a-1.0.jar</code> ä¸­çš„ç±»ï¼Œè€Œä¸æ˜¯ <code>a-2.0.jar</code> ä¸­çš„ç±»ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä¸ºä»€ä¹ˆä¼šå‡ºç°è¿™ç§æƒ…å†µå‘¢ï¼Ÿè¿™å°±æ˜¯å› ä¸ºJDKçš„åŒäº²å§”æ´¾æœºåˆ¶ã€‚â¾ƒå®šçš„ClassLoaderçš„<code>parent</code>å±æ€§æŒ‡å‘çš„æ˜¯JDKå†…çš„<code>AppClassLoader</code>ï¼Œâ½½ <code>AppClassLoader</code> ä¼šåŠ è½½ç³»ç»Ÿå½“ä¸­çš„æ‰€æœ‰ä»£ç ï¼Œå°±åŒ…æ‹¬ <code>a-1.0.jar</code>ä¸­çš„ <code>DemoClass</code>ç±»ã€‚è¿™æ—¶ï¼Œâ¾ƒå®šçš„ClassLoaderå»åŠ è½½ <code>DemoClass</code>ç±»æ—¶ï¼Œé€šè¿‡åŒäº²å§”æ´¾å‘ä¸ŠæŸ¥æ‰¾ï¼Œâ¾ƒç„¶åŠ è½½å‡ºæ¥çš„å°±æ˜¯APPClassloaderä¸­çš„<code>DemoClass</code>äº†ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å¦‚ä½•æ‰“ç ´åŒäº²å§”æ´¾å‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥é€šè¿‡é‡å†™ <code>loadClass()</code>æ–¹æ³•ï¼Œæ¥æ‰“ç ´åŒäº²å§”æ´¾ï¼Œå®ç°ç±»â½‚ä»¶çš„åŠ è½½ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> java.io.ByteArrayOutputStream;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.InputStream;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.net.URL;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.net.URLConnection;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.security.SecureClassLoader;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">CustomClassLoader</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">SecureClassLoader</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> URL jarUrl;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">CustomClassLoader</span><span class=\"params\">(URL jarUrl)</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// åˆ›å»ºä¸€ä¸ªç‹¬ç«‹çš„å­ç±»åŠ è½½å™¨ï¼ŒåªåŠ è½½æŒ‡å®š JAR</span></span><br><span class=\"line\">        <span class=\"built_in\">this</span>.jarUrl = jarUrl;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> Class&lt;?&gt; loadClass(String name, <span class=\"type\">boolean</span> resolve) <span class=\"keyword\">throws</span> ClassNotFoundException &#123;</span><br><span class=\"line\">        <span class=\"comment\">// æŠŠåŒäº²å§”æ´¾æœºåˆ¶åè¿‡æ¥ï¼Œå…ˆåˆ°â¼¦ç±»åŠ è½½å™¨ä¸­åŠ è½½ï¼ŒåŠ è½½ä¸åˆ°å†å»â½—ç±»åŠ è½½å™¨ä¸­åŠ è½½ã€‚</span></span><br><span class=\"line\">        <span class=\"keyword\">synchronized</span> (getClassLoadingLock(name)) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// å¦‚æœç±»å·²åŠ è½½ï¼Œåˆ™ç›´æ¥è¿”å›</span></span><br><span class=\"line\">            Class&lt;?&gt; loadedClass = findLoadedClass(name);</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (loadedClass == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                loadedClass = findClass(name);</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                <span class=\"comment\">// å§”æ´¾ç»™çˆ¶ç±»åŠ è½½å™¨</span></span><br><span class=\"line\">                loadedClass = <span class=\"built_in\">super</span>.loadClass(name, resolve);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> loadedClass;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">protected</span> Class&lt;?&gt; findClass(String name) &#123;</span><br><span class=\"line\">        <span class=\"type\">int</span> code;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">// è®¿é—®jaråŒ…çš„url</span></span><br><span class=\"line\">            <span class=\"type\">URLConnection</span> <span class=\"variable\">urlConnection</span> <span class=\"operator\">=</span> jarUrl.openConnection();</span><br><span class=\"line\">            urlConnection.setUseCaches(<span class=\"literal\">false</span>);</span><br><span class=\"line\">            <span class=\"type\">InputStream</span> <span class=\"variable\">is</span> <span class=\"operator\">=</span> urlConnection.getInputStream();</span><br><span class=\"line\">            <span class=\"type\">ByteArrayOutputStream</span> <span class=\"variable\">bos</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ByteArrayOutputStream</span>();</span><br><span class=\"line\">            <span class=\"keyword\">while</span> ((code = is.read()) != -<span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">                bos.write(code);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"type\">byte</span>[] data = bos.toByteArray();</span><br><span class=\"line\">            is.close();</span><br><span class=\"line\">            bos.close();</span><br><span class=\"line\">            <span class=\"keyword\">return</span> defineClass(name, data, <span class=\"number\">0</span>, data.length);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æµ‹è¯•ä»£ç </p>\n</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> java.io.File;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.net.URL;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Test</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> Exception &#123;</span><br><span class=\"line\">        <span class=\"type\">File</span> <span class=\"variable\">jarFile</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">File</span>(<span class=\"string\">&quot;path/to/a-2.0.jar&quot;</span>);</span><br><span class=\"line\">        <span class=\"type\">URL</span> <span class=\"variable\">jarUrl</span> <span class=\"operator\">=</span> jarFile.toURI().toURL();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">CustomClassLoader</span> <span class=\"variable\">loader</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">CustomClassLoader</span>(jarUrl);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// åŠ è½½ DemoClass</span></span><br><span class=\"line\">        Class&lt;?&gt; clazz = loader.loadClass(<span class=\"string\">&quot;com.example.DemoClass&quot;</span>);</span><br><span class=\"line\">        <span class=\"type\">Object</span> <span class=\"variable\">obj</span> <span class=\"operator\">=</span> clazz.getDeclaredConstructor().newInstance();</span><br><span class=\"line\">        clazz.getMethod(<span class=\"string\">&quot;print&quot;</span>).invoke(obj);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"æ‰“ç ´åŒäº²å§”æ´¾æœºåˆ¶çš„å…¸å‹åœºæ™¯\">æ‰“ç ´åŒäº²å§”æ´¾æœºåˆ¶çš„å…¸å‹åœºæ™¯</h3>\n<h4 id=\"Tomcatç±»åŠ è½½å™¨\">Tomcatç±»åŠ è½½å™¨</h4>\n<p><img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/uPic/eGKhDn.png\" alt=\"\" width=\"550\" height=\"700\"></p>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>CommonClassLoaderï¼šTomcatæœ€åŸºæœ¬çš„ç±»åŠ è½½å™¨ï¼ŒåŠ è½½è·¯å¾„ä¸­çš„classå¯ä»¥è¢«Tomcatå®¹å™¨æœ¬èº«ä»¥åŠå„ä¸ªWebappè®¿é—®ï¼›</p>\n</li>\n<li class=\"lvl-2\">\n<p>CatalinaClassLoaderï¼šTomcatå®¹å™¨ç§æœ‰çš„ç±»åŠ è½½å™¨ï¼ŒåŠ è½½è·¯å¾„ä¸­çš„classå¯¹äºWebappä¸å¯â»…ï¼›</p>\n</li>\n<li class=\"lvl-2\">\n<p>SharedClassLoaderï¼šå„ä¸ªWebappå…±äº«çš„ç±»åŠ è½½å™¨ï¼ŒåŠ è½½è·¯å¾„ä¸­çš„classå¯¹äºæ‰€æœ‰Webappå¯â»…ï¼Œä½†æ˜¯å¯¹äºTomcatå®¹å™¨ä¸å¯â»…ï¼›</p>\n</li>\n<li class=\"lvl-2\">\n<p>WebappClassLoaderï¼šå„ä¸ªWebappç§æœ‰çš„ç±»åŠ è½½å™¨ï¼ŒåŠ è½½è·¯å¾„ä¸­çš„classåªå¯¹å½“å‰Webappå¯â»…ï¼Œâ½å¦‚åŠ è½½waråŒ…â¾¥ç›¸å…³çš„ç±»ï¼Œæ¯ä¸ªwaråŒ…åº”â½¤éƒ½æœ‰â¾ƒâ¼°çš„WebappClassLoaderï¼Œå®ç°ç›¸äº’éš”ç¦»ï¼Œâ½å¦‚ä¸åŒwaråŒ…åº”â½¤å¼•â¼Šäº†ä¸åŒçš„springç‰ˆæœ¬ï¼Œè¿™æ ·å®ç°å°±èƒ½åŠ è½½å„â¾ƒçš„springç‰ˆæœ¬ï¼›</p>\n</li>\n<li class=\"lvl-2\">\n<p>Jspç±»åŠ è½½å™¨ï¼šé’ˆå¯¹æ¯ä¸ªJSPâ»šâ¾¯åˆ›å»ºâ¼€ä¸ªåŠ è½½å™¨ã€‚è¿™ä¸ªåŠ è½½å™¨â½è¾ƒè½»é‡çº§ï¼Œæ‰€ä»¥Tomcatè¿˜å®ç°äº†çƒ­åŠ è½½ï¼Œä¹Ÿå°±æ˜¯JSPåªè¦ä¿®æ”¹äº†ï¼Œå°±åˆ›å»ºâ¼€ä¸ªæ–°çš„åŠ è½½å™¨ï¼Œä»â½½å®ç°äº†JSPâ»šâ¾¯çš„çƒ­æ›´æ–°ã€‚</p>\n</li>\n</ul>\n","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç»JVMçš„ç±»åŠ è½½å™¨ JDK8 The JavaÂ® Virtual Machine Specification JDK8çš„javaæŒ‡ä»¤çš„å®˜â½…â½‚æ¡£ JDKâ¼¯å…·å®˜â½¹â½‚æ¡£ JDK17çš„javaæŒ‡ä»¤çš„å®˜â½…â½‚æ¡£ ç±»åŠ è½½å™¨ å·¦ä¾§æ˜¯JDKä¸­å®ç°çš„ç±»åŠ è½½å™¨ï¼Œé€šè¿‡parentå±æ€§å½¢æˆâ½—â¼¦å…³ç³»ã€‚åº”â½¤ä¸­â¾ƒå®šä¹‰çš„ç±»åŠ è½½å™¨çš„parentéƒ½æ˜¯ AppClassLoader å³ä¾§æ˜¯JDKä¸­çš„ç±»åŠ è½½å™¨å®ç°ç±»ã€‚é€šè¿‡ç±»ç»§æ‰¿çš„æœºåˆ¶å½¢æˆä½“ç³»ã€‚æœªæ¥æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ç»§æ‰¿ç›¸å…³çš„ç±»å®ç°â¾ƒå®šä¹‰ç±» åŠ è½½å™¨ã€‚ åœ¨ä»£ç ä¸­æŸ¥çœ‹ç±»åŠ è½½å™¨å…³ç³» 1234567891011121314public class LoaderDemo &#123; public static void main(String[] args) throws ClassNotFoundException &#123; // â½—â¼¦å…³ç³» AppClassLoader &lt;- ExtClassLoader &lt;- BootStrap Classloader ClassLoader cl1 = LoaderDemo.class.getClassLoader(); System.out.println(&quot;cl1 &gt; &quot; + cl1); // sun.misc.Launcher$AppClassLoader@18b4aac2 System.out.println(&quot;parent of cl1 &gt; &quot; + cl1.getParent()); // sun.misc.Launcher$ExtClassLoader@1b6d3586 // BootStrap Classloaderç”±C++å¼€å‘ï¼Œæ˜¯JVMè™šæ‹Ÿæœºçš„â¼€éƒ¨åˆ†ï¼Œæœ¬èº«ä¸æ˜¯JAVAç±»ã€‚ System.out.println(&quot;grant parent of cl1 &gt; &quot; + cl1.getParent().getParent()); // null // String,Intç­‰åŸºç¡€ç±»ç”±BootStrap ClassloaderåŠ è½½ã€‚ ClassLoader cl2 = String.class.getClassLoader(); System.out.println(&quot;cl2 &gt; &quot; + cl2); // null System.out.println(cl1.loadClass(&quot;java.util.List&quot;).getClass().getClassLoader()); // null &#125;&#125; åŒäº²å§”æ´¾æœºåˆ¶ å½“â¼€ä¸ªç±»åŠ è½½å™¨è¦åŠ è½½â¼€ä¸ªç±»æ—¶ï¼Œæ•´ä½“çš„è¿‡ç¨‹å°±æ˜¯é€šè¿‡åŒäº²å§”æ´¾æœºåˆ¶å‘ä¸Šå§”æ‰˜æŸ¥æ‰¾ï¼Œå¦‚æœæ²¡æœ‰æŸ¥æ‰¾åˆ°ï¼Œå°±å‘ä¸‹å§”æ‰˜åŠ è½½ã€‚ Java ç±»åŠ è½½æœºåˆ¶ä¸­çš„åŒäº²å§”æ´¾æ¨¡å‹ï¼ˆParent Delegation Modelï¼‰æ˜¯ä¸€ç§ä¿è¯äº†ç±»åŠ è½½å™¨æŒ‰ç…§å±‚æ¬¡ç»“æ„ä»ä¸Šåˆ°ä¸‹æ¥åŠ è½½ç±»çš„ç­–ç•¥ã€‚è¿™ç§å±‚çº§åŒ–çš„åŠ è½½æµç¨‹ç¡®ä¿äº†åº”ç”¨ç¨‹åºèƒ½å¤Ÿå®‰å…¨åœ°åŠ è½½å¹¶ä½¿ç”¨æ¥è‡ªä¸åŒæ¥æºçš„ç±»ï¼ŒåŒæ—¶ä¹Ÿé¿å…äº†å†…å­˜ä¸­å‡ºç°ç›¸åŒç±»çš„å¤šä¸ªæ‹·è´ã€‚ ä»¥ä¸‹æ˜¯åŒäº²å§”æ´¾æœºåˆ¶çš„å·¥ä½œåŸç†ï¼š 1.å½“ä¸€ä¸ªç±»åŠ è½½å™¨æ¥æ”¶åˆ°ç±»åŠ è½½è¯·æ±‚æ—¶ï¼Œå®ƒé¦–å…ˆä¸ä¼šè‡ªè¡Œå°è¯•å»å¯»æ‰¾ç±»æ–‡ä»¶ï¼Œè€Œæ˜¯å°†è¿™ä¸ªè¯·æ±‚å§”æ´¾ç»™å®ƒçš„çˆ¶ç±»åŠ è½½å™¨ã€‚ 2.çˆ¶ç±»åŠ è½½å™¨åŒæ ·éµå¾ªæ­¤è§„åˆ™ï¼Œå®ƒä¼šç»§ç»­æŠŠè¯·æ±‚å‘ä¸Šå§”æ´¾ç»™å®ƒçš„çˆ¶ç±»åŠ è½½å™¨ï¼Œç›´åˆ°è¾¾åˆ°æ ¹ï¼ˆbootstrappï¼‰ç±»åŠ è½½å™¨ä¸ºæ­¢ã€‚ 3.æ ¹ç±»åŠ è½½å™¨ä¸€èˆ¬ä¼šç›´æ¥è®¿é—®æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿæ¥æŸ¥æ‰¾ç±»æ–‡ä»¶ï¼Œæ¯”å¦‚ JDK è‡ªå¸¦çš„æ ¸å¿ƒç±»åº“ï¼Œæˆ–è€…åœ¨-XbootclasspathæŒ‡å®šçš„è·¯å¾„ä¸‹æŸ¥æ‰¾ã€‚ 4.å¦‚æœæ ¹ç±»åŠ è½½å™¨æ‰¾åˆ°äº†è¯¥ç±»ï¼Œåˆ™è¿›è¡Œç±»çš„åŠ è½½ï¼›å¦‚æœæ‰¾ä¸åˆ°ï¼Œåˆ™æŠŠè¿™ä¸ªä»»åŠ¡äº¤å›ç»™å‘å‡ºè¯·æ±‚çš„å­ç±»åŠ è½½å™¨ã€‚ 5.å­ç±»åŠ è½½å™¨ä¹Ÿé‡å¤æ­¥éª¤ 4ï¼Œè‹¥æ‰¾åˆ°åˆ™åŠ è½½ï¼Œå¦åˆ™ä¼ é€’ç»™ä¸‹ä¸€ä¸ªå­ç±»åŠ è½½å™¨ï¼Œç›´è‡³åŸå§‹æå‡ºè¯·æ±‚çš„ç±»åŠ è½½å™¨ã€‚ 6.è‹¥æ‰€æœ‰çš„ç±»åŠ è½½å™¨éƒ½æœªèƒ½æ‰¾åˆ°æ‰€éœ€çš„ç±»ï¼Œåˆ™æœ€ç»ˆæŠ›å‡ºClassNotFoundExceptionå¼‚å¸¸ã€‚ åŒäº²å§”æ´¾æœ‰ä»¥ä¸‹å‡ ä¸ªä¼˜ç‚¹ï¼š å®‰å…¨æ€§ï¼šç”±äºç±»åŠ è½½æ˜¯ä»é¡¶å±‚å¼€å§‹ï¼Œè¿™èƒ½é˜²æ­¢æ¶æ„ä»£ç é€šè¿‡åŠ è½½ç›¸åŒçš„åŒ…åå’Œç±»åæ›¿ä»£ç³»ç»Ÿçš„å…³é”®ç±»ã€‚ å”¯ä¸€æ€§ï¼šæ¯ä¸ªç±»éƒ½ä¼šè¢«ç‰¹å®šçš„ç±»åŠ è½½å™¨åŠ è½½ä¸€æ¬¡ï¼Œå³ä¾¿æ˜¯åœ¨åˆ†å¸ƒå¼çš„ç¯å¢ƒä¸­ä¹Ÿèƒ½ä¿è¯ç±»çš„ç»Ÿä¸€æ€§ï¼Œé¿å…å› ä¸ºå¤šæ¬¡åŠ è½½å¯¼è‡´çš„é”™è¯¯ã€‚ å¯é æ€§ï¼šç”¨æˆ·è‡ªå®šä¹‰çš„ç±»åŠ è½½å™¨ä¸ç”¨æ‹…å¿ƒåŸºç¡€ç±»å·²ç»è¢«åŠ è½½ï¼Œå®ƒä»¬å¯ä»¥ä¸“å¿ƒäºè‡ªå·±éœ€è¦å¤„ç†çš„éƒ¨åˆ†ã€‚ ä¾‹å¦‚ï¼Œå½“åº”ç”¨ç¨‹åºè¿è¡Œæ—¶ï¼Œåº”ç”¨ç±»åŠ è½½å™¨ï¼ˆApplication ClassLoaderï¼‰æ¥æ”¶åˆ°å¯¹java.lang.Stringç±»çš„åŠ è½½è¯·æ±‚æ—¶ï¼Œå®ƒä¼šé¦–å…ˆå°†è¯·æ±‚ä¼ é€’ç»™æ‰©å±•ç±»åŠ è½½å™¨ï¼ˆExtension ClassLoaderï¼‰ï¼Œåè€…å†ä¼ é€’ç»™å¼•å¯¼ç±»åŠ è½½å™¨ï¼ˆBootstrap ClassLoaderï¼‰ã€‚å¼•å¯¼ç±»åŠ è½½å™¨ä¼šåœ¨å…¶æœç´¢è·¯å¾„ä¸­æ‰¾åˆ°Stringç±»ï¼Œå¹¶å®ŒæˆåŠ è½½è¿‡ç¨‹ã€‚å¦‚æœåº”ç”¨ç¨‹åºè¯•å›¾æä¾›è‡ªå·±çš„Stringç±»ï¼Œç”±äºåŒäº²å§”æ´¾çš„å­˜åœ¨ï¼Œåº”ç”¨ç¨‹åºæ‰€æŒ‡å®šçš„ç±»å¹¶ä¸ä¼šè¢«åŠ è½½ï¼Œä»è€Œä¿è¯äº†å¹³å°æ ¸å¿ƒ API çš„ä¸€è‡´æ€§ã€‚ æ€»ä¹‹ï¼ŒåŒäº²å§”æ´¾æœºåˆ¶æ˜¯ Java ç±»åŠ è½½è¿‡ç¨‹ä¸­ä¸€ä¸ªéå¸¸é‡è¦çš„ç‰¹æ€§ï¼Œå®ƒä¸ä»…ç»´æŠ¤äº†ç±»åŠ è½½çš„å®‰å…¨æ€§å’Œä¸€è‡´æ€§ï¼Œä¹Ÿä¸ºå¼€å‘è€…æä¾›äº†çµæ´»å®šåˆ¶ç±»åŠ è½½è§„åˆ™çš„èƒ½åŠ›ã€‚ æ¯ä¸ªç±»åŠ è½½å™¨æŸ¥æ‰¾ç±»çš„é»˜è®¤è·¯å¾„ åœ¨ Java ä¸­ï¼Œæ¯ä¸ªç±»åŠ è½½å™¨éƒ½æœ‰è‡ªå·±çš„ç±»è·¯å¾„ï¼ˆClasspathï¼‰å»æŸ¥æ‰¾ç±»æ–‡ä»¶ã€‚ä¸‹é¢æ˜¯å‡ ä¸ªä¸»è¦çš„ç±»åŠ è½½å™¨ä»¥åŠå®ƒä»¬çš„é»˜è®¤æŸ¥æ‰¾è·¯å¾„ï¼š ç±»åŠ è½½å™¨åç§° ç±»å / åˆ«å çˆ¶ç±»åŠ è½½å™¨ åŠ è½½å†…å®¹æè¿° é»˜è®¤æŸ¥æ‰¾è·¯å¾„ / ç³»ç»Ÿå±æ€§ å¯åŠ¨ç±»åŠ è½½å™¨ BootstrapClassLoader æ—  åŠ è½½ æ ¸å¿ƒ Java ç±»åº“ &lt;JAVA_HOME&gt;/jre/lib/rt.jarï¼ˆJDK8 åŠä¹‹å‰ï¼‰æˆ– sun.boot.class.path æŒ‡å®šè·¯å¾„ æ‰©å±•ç±»åŠ è½½å™¨ ExtClassLoader BootstrapClassLoader åŠ è½½ Java å¹³å°æ‰©å±•ç±»åº“ &lt;JAVA_HOME&gt;/jre/lib/ext æˆ–ç”± java.ext.dirs ç³»ç»Ÿå±æ€§æŒ‡å®š åº”ç”¨ç±»åŠ è½½å™¨ AppClassLoader ExtClassLoader åŠ è½½ åº”ç”¨ç¨‹åºç±»ï¼ˆç”¨æˆ·ç¼–å†™çš„ä»£ç ï¼‰ -classpathã€-cp å‚æ•°ã€CLASSPATH ç¯å¢ƒå˜é‡ã€java.class.path å±æ€§ã€å½“å‰ç›®å½• (.) è‡ªå®šä¹‰ç±»åŠ è½½å™¨ ç”¨æˆ·è‡ªå®šä¹‰ å¯æŒ‡å®š å¯é€šè¿‡ç»§æ‰¿ ClassLoader å¹¶é‡å†™ findClass() æ–¹æ³•å®ç°è‡ªå®šä¹‰ç±»åŠ è½½é€»è¾‘ï¼Œå¦‚ä»ç½‘ç»œã€æ•°æ®åº“ç­‰åŠ è½½ç±»æ–‡ä»¶ é»˜è®¤ç»§æ‰¿çˆ¶åŠ è½½å™¨æŸ¥æ‰¾è·¯å¾„ï¼Œä¹Ÿå¯è‡ªå®šä¹‰ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œé™¤äº† Bootstrap ClassLoader å¤–ï¼Œå…¶ä»–çš„æ‰€æœ‰ç±»åŠ è½½å™¨æœ€ç»ˆéƒ½æ˜¯java.lang.ClassLoaderçš„å­ç±»ï¼Œå¹¶ä¸”æ¯ä¸ªç±»åŠ è½½å™¨å®ä¾‹éƒ½æœ‰ä¸€ä¸ªç›´æ¥çš„çˆ¶ç±»åŠ è½½å™¨ã€‚å¦‚æœä½ åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„ç±»åŠ è½½å™¨ï¼Œå®ƒå°†ç»§æ‰¿ Application ClassLoader ä½œä¸ºå®ƒçš„çˆ¶ç±»ï¼Œé™¤éä½ åœ¨åˆ›å»ºæ—¶æŒ‡å®šäº†ä¸åŒçš„çˆ¶ç±»åŠ è½½å™¨ã€‚ æ­¤å¤–ï¼ŒJava 9 å¼•å…¥äº†æ¨¡å—åŒ–ç³»ç»Ÿåï¼Œç±»åŠ è½½æœºåˆ¶ä¹Ÿæœ‰äº†ä¸€äº›å˜åŒ–ï¼Œå¯¹äºæ¨¡å—è·¯å¾„ä¸Šçš„ç±»åŠ è½½ï¼Œä¼šä½¿ç”¨æ–°çš„å±‚æ¬¡ç»“æ„æ¥å¤„ç†ï¼Œè¿™ä½¿å¾—ç±»åŠ è½½è¿‡ç¨‹æ›´åŠ çµæ´»åŒæ—¶ä¿æŒäº†å‘åçš„å…¼å®¹æ€§ã€‚ä¸è¿‡ï¼Œå¯¹äºä¼ ç»Ÿçš„ç±»è·¯å¾„ä¸Šçš„ç±»åŠ è½½ï¼ŒåŒäº²å§”æ´¾æ¨¡å‹ä»ç„¶é€‚ç”¨ã€‚ ç±»åŠ è½½å™¨åç§° ç±»å / åˆ«å çˆ¶ç±»åŠ è½½å™¨ åŠ è½½æ¨¡å—èŒƒå›´ é»˜è®¤æŸ¥æ‰¾è·¯å¾„ / æ¨¡å—æ¥æº å¼•å¯¼ç±»åŠ è½½å™¨ BootstrapClassLoader æ—  åŠ è½½ java.* æ¨¡å—ï¼Œä¾‹å¦‚ java.baseï¼ˆåŒ…å« java.lang, java.util ç­‰ï¼‰ $JAVA_HOME/jmods ä¸­çš„æ¨¡å—æ–‡ä»¶ï¼Œæ ¸å¿ƒæ¨¡å—ç”± JVM å¯åŠ¨æ—¶ç›´æ¥åŠ è½½ å¹³å°ç±»åŠ è½½å™¨ PlatformClassLoader BootstrapClassLoader åŠ è½½ jdk.*ã€javafx.* ç­‰å¹³å°æ‰©å±•æ¨¡å— $JAVA_HOME/jmodsï¼Œæ¨¡å—åä¸º jdk.*ã€javafx.* ç­‰ï¼› åº”ç”¨ç±»åŠ è½½å™¨ AppClassLoader PlatformClassLoader åŠ è½½åº”ç”¨æ¨¡å—ï¼ˆç”¨æˆ·ä»£ç ï¼‰ï¼ŒåŒ…æ‹¬æ¨¡å—è·¯å¾„ --module-path å’Œç±»è·¯å¾„ -classpath ä¸‹çš„ç±» åº”ç”¨ç¨‹åºç¼–å†™çš„æ¨¡å—æˆ–ç±»ï¼Œæ¥è‡ªå‘½ä»¤è¡Œ --module-pathã€-classpath å‚æ•°ã€CLASSPATH ç¯å¢ƒå˜é‡ç­‰ è‡ªå®šä¹‰ç±»åŠ è½½å™¨ ç”¨æˆ·è‡ªå®šä¹‰ å¯æŒ‡å®šçˆ¶åŠ è½½å™¨ åŠ è½½éæ ‡å‡†ä½ç½®çš„ç±»ï¼Œå¯ç”¨äºæ’ä»¶ã€ç½‘ç»œåŠ è½½ã€åŠ å¯†ç±»åŠ è½½ç­‰ é»˜è®¤éµå¾ªåŒäº²å§”æ´¾ï¼Œå¯é‡å†™ findClass() å®ç°è‡ªå®šä¹‰è·¯å¾„æŸ¥æ‰¾æˆ–å…¶ä»–æ•°æ®æºï¼Œå¦‚ç½‘ç»œã€æ•°æ®åº“ã€åŠ å¯†æ–‡ä»¶ç­‰ jdk9+ä¸­ï¼Œåœ¨å§”æ´¾ç»™çˆ¶åŠ è½½å™¨åŠ è½½å‰ï¼Œå…ˆåˆ¤æ–­è¯¥ç±»æ˜¯å¦èƒ½å¤Ÿå½’å±åˆ°æŸä¸€ä¸ªç³»ç»Ÿæ¨¡å—ä¸­ï¼Œå¦‚æœå¯ä»¥æ‰¾åˆ°è¿™æ ·çš„å½’å±å…³ç³»ï¼Œå°±è¦ä¼˜å…ˆå§”æ´¾ç»™è´Ÿè´£é‚£ä¸ªæ¨¡å—çš„åŠ è½½å™¨å®ŒæˆåŠ è½½ã€‚ åœ¨ä»£ç ä¸­æŸ¥çœ‹ç±»åŠ è½½è·¯å¾„ 123456// BootStrap Classloaderï¼ŒåŠ è½½javaåŸºç¡€ç±»ã€‚System.out.println(&quot;BootStrap ClassLoaderåŠ è½½â½¬å½•ï¼š&quot; + System.getProperty(&quot;sun.boot.class.path&quot;));// Extention Classloader åŠ è½½â¼€äº›æ‰©å±•ç±»ã€‚ å¯é€šè¿‡-D java.ext.dirså¦â¾æŒ‡å®šâ½¬å½•System.out.println(&quot;Extention ClassLoaderåŠ è½½â½¬å½•ï¼š&quot; + System.getProperty(&quot;java.ext.dirs&quot;));// AppClassLoader åŠ è½½CLASSPATHï¼Œåº”â½¤ä¸‹çš„JaråŒ…ã€‚å¯é€šè¿‡-D java.class.pathå¦â¾æŒ‡å®šâ½¬å½•System.out.println(&quot;AppClassLoaderåŠ è½½â½¬å½•ï¼š&quot; + System.getProperty(&quot;java.class.path&quot;)); åŒäº²å§”æ´¾æœºåˆ¶çš„å®ç°åŸç† java.lang.ClassLoader ç±»çš„ loadClass æ–¹æ³•æ˜¯åŒäº²å§”æ´¾çš„æ ¸å¿ƒå®ç° 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657/** * åŠ è½½æŒ‡å®šåç§°çš„ç±»ï¼Œå¹¶æ ¹æ® resolve å‚æ•°å†³å®šæ˜¯å¦è§£æè¯¥ç±»ã€‚ * * è¯¥æ–¹æ³•å®ç°äº†ç±»åŠ è½½çš„åŸºæœ¬é€»è¾‘ï¼ŒåŒ…æ‹¬æ£€æŸ¥ç±»æ˜¯å¦å·²åŠ è½½ã€å§”æ‰˜çˆ¶ç±»åŠ è½½å™¨åŠ è½½ã€ * è‡ªè¡ŒåŠ è½½ç±»ä»¥åŠè§£æç±»ç­‰æ­¥éª¤ã€‚è¯¥æ–¹æ³•æ˜¯ Java ç±»åŠ è½½æœºåˆ¶çš„æ ¸å¿ƒéƒ¨åˆ†ä¹‹ä¸€ï¼Œ * éµå¾ªåŒäº²å§”æ´¾æ¨¡å‹ã€‚ * * @param name è¦åŠ è½½çš„ç±»çš„å…¨é™å®šå * @param resolve å¦‚æœä¸º trueï¼Œåˆ™åœ¨åŠ è½½åè§£æè¯¥ç±» * @return åŠ è½½çš„ Class å¯¹è±¡ * @throws ClassNotFoundException å¦‚æœæ‰¾ä¸åˆ°æŒ‡å®šçš„ç±» */// è¿™ä¸ªâ½…æ³•æ˜¯protectedå£°æ˜çš„ï¼Œæ„å‘³ç€ï¼Œæ˜¯å¯ä»¥è¢«â¼¦ç±»è¦†ç›–çš„ï¼Œæ‰€ä»¥ï¼ŒåŒäº²å§”æ´¾æœºåˆ¶ä¹Ÿæ˜¯å¯ä»¥è¢«æ‰“ç ´çš„ï¼Œå¦‚Tomcatâ¼¦ç±»é‡å†™è¿™ä¸ªâ½…æ³•ï¼Œå¹¶ä½¿â½¤è‡ªå·±çš„ç±»åŠ è½½é€»è¾‘ã€‚protected Class&lt;?&gt; loadClass(String name, boolean resolve) throws ClassNotFoundException &#123; // ä½¿ç”¨ synchronized ç¡®ä¿å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ç±»åŠ è½½çš„åŒæ­¥ synchronized (getClassLoadingLock(name)) &#123; // First, check if the class has already been loaded // æ¯ä¸ªç±»åŠ è½½å™¨å¯¹ä»–åŠ è½½è¿‡çš„ç±»éƒ½æœ‰â¼€ä¸ªç¼“å­˜ï¼Œå…ˆå»ç¼“å­˜ä¸­æŸ¥çœ‹æœ‰æ²¡æœ‰åŠ è½½è¿‡ Class&lt;?&gt; c = findLoadedClass(name); if (c == null) &#123; //æ²¡æœ‰åŠ è½½è¿‡ï¼Œå°±â¾›åŒäº²å§”æ´¾ long t0 = System.nanoTime(); try &#123; // çˆ¶ç±»å­˜åœ¨åˆ™è®©â½—ç±»åŠ è½½å™¨è¿›â¾åŠ è½½ if (parent != null) &#123; c = parent.loadClass(name, false); &#125; else &#123; //å¦‚æœçˆ¶ç±»ä¸å­˜åœ¨ï¼Œåˆ™ä»å¼•å¯¼ç±»åŠ è½½å™¨è¿›â¾åŠ è½½ c = findBootstrapClassOrNull(name); &#125; &#125; catch (ClassNotFoundException e) &#123; // ClassNotFoundException thrown if class not found // from the non-null parent class loader &#125; if (c == null) &#123; // If still not found, then invoke findClass in order // to find the class. long t1 = System.nanoTime(); // findClass æ–¹æ³•æ˜¯å­ç±»å®ç°çš„ï¼Œç”¨äºåŠ è½½æŒ‡å®šåç§°çš„ç±» // â½—ç±»åŠ è½½å™¨æ²¡æœ‰åŠ è½½è¿‡ï¼Œå°±â¾ƒâ¾è§£æclassâ½‚ä»¶åŠ è½½ c = findClass(name); // this is the defining class loader; record the stats // æ€§èƒ½ç»Ÿè®¡ï¼šè®°å½•ç±»åŠ è½½è¿‡ç¨‹ä¸­çš„æ—¶é—´æ¶ˆè€—å’Œè°ƒç”¨æ¬¡æ•°ï¼Œä¾¿äºç›‘æ§å’Œä¼˜åŒ–ã€‚ sun.misc.PerfCounter.getParentDelegationTime().addTime(t1 - t0); sun.misc.PerfCounter.getFindClassTime().addElapsedTimeFrom(t1); sun.misc.PerfCounter.getFindClasses().increment(); &#125; &#125; // é»˜è®¤æƒ…å†µä¸‹ï¼ŒåŒäº²å§”æ´¾æ¨¡å‹åªè¿›â¾äº†éªŒè¯å’Œå‡†å¤‡é˜¶æ®µï¼Œâ½½ä¸è¿›â¾è§£æ(å¦‚é“¾æ¥ã€åˆå§‹åŒ–) if (resolve) &#123; resolveClass(c); &#125; return c; &#125;&#125; è¯¥æ–¹æ³•å®ç°äº†ç±»åŠ è½½çš„åŸºæœ¬é€»è¾‘ï¼ŒåŒ…æ‹¬æ£€æŸ¥ç±»æ˜¯å¦å·²åŠ è½½ã€å§”æ‰˜çˆ¶ç±»åŠ è½½å™¨åŠ è½½ã€è‡ªè¡ŒåŠ è½½ç±»ä»¥åŠè§£æç±»ç­‰æ­¥éª¤ã€‚è¯¥æ–¹æ³•æ˜¯ Java ç±»åŠ è½½æœºåˆ¶çš„æ ¸å¿ƒéƒ¨åˆ†ä¹‹ä¸€ï¼Œéµå¾ªåŒäº²å§”æ´¾æ¨¡å‹ã€‚ è¿™ä¸ªâ½…æ³•æ˜¯protectedå£°æ˜çš„ï¼Œæ„å‘³ç€ï¼Œæ˜¯å¯ä»¥è¢«â¼¦ç±»è¦†ç›–çš„ï¼Œæ‰€ä»¥ï¼ŒåŒäº²å§”æ´¾æœºåˆ¶ä¹Ÿæ˜¯å¯ä»¥è¢«æ‰“ç ´çš„ï¼Œå¦‚Tomcatâ¼¦ç±»é‡å†™è¿™ä¸ªâ½…æ³•ï¼Œå¹¶ä½¿â½¤è‡ªå·±çš„ç±»åŠ è½½é€»è¾‘ã€‚ æ²™ç®±ä¿æŠ¤æœºåˆ¶ æ²™ç®±ä¿æŠ¤æœºåˆ¶æ˜¯ Java è™šæ‹Ÿæœºæä¾›çš„ä¸€ç§å®‰å…¨æœºåˆ¶ï¼Œç”¨äºä¿æŠ¤åº”ç”¨ç¨‹åºå…å—æ¶æ„ä»£ç çš„æ”»å‡»ã€‚ java.lang.ClassLoader ç±»çš„ preDefineClass æ–¹æ³•æ˜¯æ²™ç®±ä¿æŠ¤æœºåˆ¶çš„æ ¸å¿ƒå®ç° 1234567891011121314151617181920212223242526// è¿™ä¸ªæ–¹æ³•åœ¨åŒäº²å§”æ´¾æ¨¡å‹ä¹‹å‰è¢«è°ƒç”¨ï¼Œç”¨äºåœ¨åŠ è½½ç±»ä¹‹å‰è¿›è¡Œä¸€äº›é¢„å¤„ç†æ“ä½œã€‚// å‚æ•°ï¼š// name: è¦åŠ è½½çš„ç±»çš„å…¨é™å®šåã€‚// pd: æä¾›çš„ä¿æŠ¤åŸŸä¿¡æ¯ï¼Œå¯èƒ½ä¸º nullã€‚private ProtectionDomain preDefineClass(String name, ProtectionDomain pd) &#123; if (!checkName(name)) throw new NoClassDefFoundError(&quot;IllegalName: &quot; + name); // Note: Checking logic in java.lang.invoke.MemberName.checkForTypeAlias // relies on the fact that spoofing is impossible if a class has a name // of the form &quot;java.*&quot; if ((name != null) &amp;&amp; name.startsWith(&quot;java.&quot;)) &#123; throw new SecurityException (&quot;Prohibited package name: &quot; + name.substring(0, name.lastIndexOf(&#x27;.&#x27;))); &#125; if (pd == null) &#123; pd = defaultDomain; &#125; if (name != null) checkCerts(name, pd.getCodeSource()); return pd; &#125; è¿™ä¸ªæ–¹æ³• preDefineClass çš„ä½œç”¨æ˜¯åœ¨ç±»è¢«å®šä¹‰ä¹‹å‰è¿›è¡Œä¸€äº›å®‰å…¨æ£€æŸ¥å’Œå‡†å¤‡å·¥ä½œï¼Œç¡®ä¿ç±»çš„åˆæ³•æ€§ä¸å®‰å…¨æ€§ã€‚å®ƒé€šå¸¸ç”¨äºè‡ªå®šä¹‰ç±»åŠ è½½å™¨ä¸­ï¼Œä»¥å¢å¼ºç±»åŠ è½½è¿‡ç¨‹ä¸­çš„å®‰å…¨æ§åˆ¶ã€‚ æ–¹æ³•ä½œç”¨è¯¦è§£ï¼š 1.é˜²æ­¢å®šä¹‰éæ³•ç±»åçš„ç±»ï¼ˆå¦‚ java.* åŒ…ä¸‹çš„ç±»ï¼‰ï¼š å¦‚æœå°è¯•åŠ è½½çš„ç±»å±äº java. å¼€å¤´çš„æ ‡å‡†åŒ…ï¼ˆå¦‚ java.lang, java.util ç­‰ï¼‰ï¼Œä¼šæŠ›å‡º SecurityExceptionã€‚ è¿™æ˜¯ä¸ºäº†é˜²æ­¢ç”¨æˆ·è‡ªå®šä¹‰ç±»ä¼ªè£…æˆ Java æ ¸å¿ƒç±»åº“ä¸­çš„ç±»ï¼Œä»è€Œé€ æˆå®‰å…¨é£é™©ã€‚ 2.æ ¡éªŒç±»ååˆæ³•æ€§ï¼š è°ƒç”¨ checkName(name) æ£€æŸ¥ç±»åæ˜¯å¦åˆæ³•ï¼ˆä¾‹å¦‚ä¸èƒ½åŒ…å« /ã€éæ³•å­—ç¬¦ç­‰ï¼‰ï¼Œè‹¥ä¸åˆæ³•åˆ™æŠ›å‡º NoClassDefFoundErrorã€‚ 3.è¯ä¹¦ä¸€è‡´æ€§æ ¡éªŒï¼ˆç­¾åä¸€è‡´æ€§æ ¡éªŒï¼‰ï¼š å¦‚æœç±»æœ‰åç§°ä¸”æä¾›äº† ProtectionDomainï¼Œä¼šè°ƒç”¨ checkCerts(name, codeSource) æ¥ç¡®ä¿å½“å‰ç±»çš„ç­¾åä¸å…¶æ‰€åœ¨åŒ…ä¸­å…¶ä»–ç±»çš„ç­¾åä¸€è‡´ã€‚ é˜²æ­¢åŒä¸€åŒ…ä¸­æ··å…¥ä¸åŒç­¾åçš„ç±»ï¼Œé¿å…æ½œåœ¨çš„æ¶æ„ç¯¡æ”¹ã€‚ 4.è®¾ç½®é»˜è®¤ä¿æŠ¤åŸŸï¼ˆProtectionDomainï¼‰ï¼š å¦‚æœä¼ å…¥çš„ ProtectionDomain ä¸º nullï¼Œåˆ™ä½¿ç”¨ç±»åŠ è½½å™¨çš„é»˜è®¤åŸŸ defaultDomainã€‚ Linkingé“¾æ¥è¿‡ç¨‹ åœ¨ClassLoaderçš„loadClassâ½…æ³•ä¸­ï¼Œè¿˜æœ‰â¼€ä¸ªä¸èµ·çœ¼çš„æ­¥éª¤ï¼ŒresolveClassã€‚è¿™æ˜¯â¼€ä¸ªnativeâ½…æ³•ã€‚â½½å…¶å®ç°çš„è¿‡ç¨‹ç§°ä¸ºlinking-é“¾æ¥ã€‚ é“¾æ¥è¿‡ç¨‹çš„å®ç°åŠŸèƒ½å¦‚ä¸‹å›¾ï¼š å…¶ä¸­å…³äºåŠåˆå§‹åŒ–çŠ¶æ€å°±æ˜¯JDKåœ¨å¤„ç†â¼€ä¸ªç±»çš„staticé™æ€å±æ€§æ—¶ï¼Œä¼šå…ˆç»™è¿™ä¸ªå±æ€§åˆ†é…â¼€ä¸ªé»˜è®¤å€¼ï¼Œä½œâ½¤æ˜¯å ä½å†…å­˜ã€‚ç„¶åç­‰è¿æ¥è¿‡ç¨‹å®Œæˆåï¼Œåœ¨åâ¾¯çš„åˆå§‹åŒ–é˜¶æ®µï¼Œå†å°†é™æ€å±æ€§ä»é»˜è®¤å€¼ä¿®æ”¹ä¸ºæŒ‡å®šçš„åˆå§‹å€¼ã€‚ ç¬¦å·å¼•â½¤å’Œç›´æ¥å¼•â½¤ å¦‚æœAç±»ä¸­æœ‰â¼€ä¸ªé™æ€å±æ€§ï¼Œå¼•â½¤äº†å¦â¼€ä¸ªBç±»ã€‚é‚£ä¹ˆåœ¨å¯¹ç±»è¿›â¾åˆå§‹åŒ–çš„è¿‡ç¨‹ä¸­ï¼Œå› ä¸ºAå’ŒBè¿™ä¸¤ä¸ªç±»éƒ½æ²¡æœ‰åˆå§‹åŒ–ï¼ŒJVMå¹¶ä¸çŸ¥é“Aå’ŒBè¿™ä¸¤ä¸ªç±»çš„å…·ä½“åœ°å€ã€‚æ‰€ä»¥è¿™æ—¶ï¼Œåœ¨Aç±»ä¸­ï¼Œåªèƒ½åˆ›å»ºâ¼€ä¸ªä¸çŸ¥é“å…·ä½“åœ°å€çš„å¼•â½¤ï¼ŒæŒ‡å‘Bç±»ã€‚è¿™ä¸ªå¼•â½¤å°±ç§°ä¸ºç¬¦å·å¼•â½¤ã€‚â½½å½“Aç±»å’ŒBç±»éƒ½å®Œæˆåˆå§‹åŒ–åï¼ŒJVMâ¾ƒç„¶å°±éœ€è¦å°†è¿™ä¸ªç¬¦å·å¼•â½¤è½¬â½½æŒ‡å‘Bç±»å…·ä½“çš„å†…å­˜åœ°å€ï¼Œè¿™ä¸ªå¼•â½¤å°±ç§°ä¸ºç›´æ¥å¼•â½¤ã€‚ æ¥çœ‹ä¸€ä¸ªæœ‰æ„æ€çš„ç¤ºä¾‹ 1234567891011121314151617181920class Apple &#123; // é™æ€å˜é‡æŒ‰å£°æ˜é¡ºåºåˆå§‹åŒ– // æ„é€ æ–¹æ³•åˆå§‹åŒ–appleå¯¹è±¡æ—¶ï¼Œpriceè¿˜æ²¡æœ‰è¢«åˆå§‹åŒ–ï¼Œå¤„äºé“¾æ¥è¿‡ç¨‹ä¸­çš„å‡†å¤‡é˜¶æ®µï¼Œå³åŠåˆå§‹åŒ–çŠ¶æ€ï¼Œæ‰€ä»¥priceä¸ºé»˜è®¤å€¼0.0 static Apple apple = new Apple(10); // è§£å†³æ–¹æ³•æ˜¯å°†priceå£°æ˜åœ¨appleçš„ä¸Šé¢å³å¯ static double price = 20.00; double totalpay; public Apple(double discount) &#123; System.out.println(&quot;====&quot; + price); totalpay = price - discount; &#125;&#125;public class PriceTest &#123; public static void main(String[] args) &#123; System.out.println(Apple.apple.totalpay); // -10.0 &#125;&#125; è¿™é‡Œæœ‰ä¸€ä¸ªæœ‰æ„æ€çš„é—®é¢˜ï¼Œå°±æ˜¯åªæœ‰å½“loadClassæ–¹æ³•ä¸­çš„resolveå‚æ•°ä¸ºtrueæ—¶resolveClassæ–¹æ³•æ‰ä¼šè¢«è°ƒç”¨ï¼Œä½†æ˜¯å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œresolveå‚æ•°éƒ½æ˜¯falseï¼Œè¿™ä¸æ˜¯å¼ºåˆ¶é™åˆ¶è€Œæ˜¯å‡ºäºä»¥ä¸‹åŸå› ï¼š é¿å…é€’å½’è§£æä¸­å‡ºç°é”™è¯¯æˆ–æ­»å¾ªç¯ åœ¨ç±»çš„è§£æè¿‡ç¨‹ä¸­ï¼Œå¦‚æœè¯¥ç±»å¼•ç”¨äº†å¦ä¸€ä¸ªè¿˜æ²¡åŠ è½½çš„ç±»ï¼Œç«‹å³è§£æå¯èƒ½ä¼šå¯¼è‡´æ— é™é€’å½’æˆ–åŠ è½½é¡ºåºé—®é¢˜ã€‚é€šè¿‡å»¶è¿Ÿè§£æï¼Œå¯ä»¥æ›´å¥½åœ°æ§åˆ¶åŠ è½½æµç¨‹ã€‚ æé«˜åŠ è½½æ•ˆç‡ åŠ è½½ç±»å¯èƒ½ä¸ä¸€å®šé©¬ä¸Šå°±ç”¨åˆ°æ‰€æœ‰æ–¹æ³•ã€å­—æ®µç­‰ç¬¦å·å¼•ç”¨ï¼Œæ¨è¿Ÿè§£æå¯ä»¥æé«˜æ€§èƒ½ï¼Œå°¤å…¶åœ¨æ‰¹é‡åŠ è½½å¾ˆå¤šç±»æ—¶ã€‚ æ›´çµæ´»åœ°å¤„ç†ç±»çš„ä¾èµ– å¼€å‘è€…å¯ä»¥å…ˆåŠ è½½ç±»ï¼Œç¨åæ ¹æ®éœ€è¦å†è§£æã€‚ä¾‹å¦‚ï¼Œåœ¨è‡ªå®šä¹‰ç±»åŠ è½½å™¨ä¸­ï¼Œå¯èƒ½å…ˆåˆ¤æ–­ç±»æ˜¯å¦å·²ç»å­˜åœ¨ã€æ˜¯å¦éœ€è¦è¢«å¢å¼ºï¼ˆæ¯”å¦‚å­—èŠ‚ç å¢å¼ºï¼‰ï¼Œå†å†³å®šæ˜¯å¦è§£æã€‚ é€šè¿‡ç±»åŠ è½½å™¨å¼•â¼Šå¤–éƒ¨JaråŒ… è™½ç„¶é€šå¸¸æˆ‘ä»¬ä¼šå°†ä¾èµ–çš„ jar åŒ…ç›´æ¥æ”¾å…¥é¡¹ç›®çš„ classpath ä¸­ï¼ˆæ¯”å¦‚é€šè¿‡æ„å»ºå·¥å…·å¦‚ Maven æˆ– Gradle ç®¡ç†ï¼‰ï¼Œä½†åœ¨æŸäº›ç‰¹å®šåœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬ç¡®å®éœ€è¦åŠ¨æ€åœ°é€šè¿‡ URLClassLoader åŠ è½½å¤–éƒ¨ jar åŒ…ï¼Œè¿™æ˜¯ Java æä¾›çš„ä¸€ç§æ›´çµæ´»çš„ç±»åŠ è½½æœºåˆ¶ã€‚ ä»¥ä¸‹æ˜¯ä¸€äº›å¿…é¡»æˆ–æ¨èä½¿ç”¨ URLClassLoader çš„å…¸å‹åº”ç”¨åœºæ™¯ï¼š 1. æ’ä»¶æœºåˆ¶ï¼ˆPlugin Systemï¼‰ åœºæ™¯è¯´æ˜ï¼š ç³»ç»Ÿæ”¯æŒç”¨æˆ·è‡ªå®šä¹‰æ’ä»¶ï¼ˆå¦‚ IDE æ’ä»¶ã€æµè§ˆå™¨æ‰©å±•ã€æ¸¸æˆ modï¼‰ï¼Œè¿™äº›æ’ä»¶åœ¨è¿è¡Œæ—¶æ‰åŠ è½½ï¼Œé¡¹ç›®æœ¬èº«åœ¨ç¼–è¯‘æœŸå¹¶ä¸çŸ¥é“æœ‰å“ªäº›æ’ä»¶ã€‚ ä¸¾ä¾‹ï¼š Eclipse æˆ– IntelliJ çš„æ’ä»¶ç³»ç»Ÿ Minecraft çš„ mod åŠ è½½å™¨ Spring Boot Devtools é‡æ–°åŠ è½½æœºåˆ¶ ä¸ºä»€ä¹ˆä¸èƒ½ç›´æ¥æ”¾å…¥ classpathï¼Ÿ å› ä¸ºæ’ä»¶æ˜¯åŠ¨æ€å‘ç°å’ŒåŠ è½½çš„ï¼Œä¸æ˜¯ç¼–è¯‘æ—¶ç¡®å®šçš„ã€‚ 2. çƒ­éƒ¨ç½² / åŠ¨æ€åŠ è½½ç±» åœºæ™¯è¯´æ˜ï¼š ä½ æƒ³åœ¨åº”ç”¨è¿è¡Œè¿‡ç¨‹ä¸­åŠ è½½æ–°çš„ jar æˆ–ç±»ï¼Œæ¯”å¦‚çƒ­æ›´æ–°ä¸€ä¸ªæ¨¡å—è€Œæ— éœ€é‡å¯æœåŠ¡ã€‚ ä¸¾ä¾‹ï¼š Web å®¹å™¨ï¼ˆå¦‚ Tomcatï¼‰çš„åº”ç”¨é‡æ–°éƒ¨ç½² ä½¿ç”¨ URLClassLoader åŠ è½½æŸä¸ªæ¨¡å—çš„æ–°ç‰ˆæœ¬ä»¥å®ç°çƒ­æ›¿æ¢ ä¸ºä»€ä¹ˆä¸èƒ½æ”¾å…¥ classpathï¼Ÿ classpath åœ¨å¯åŠ¨æ—¶å°±å›ºå®šäº†ï¼Œä¸èƒ½åŠ¨æ€æ·»åŠ ï¼›è€Œ URLClassLoader å¯ä»¥è¿è¡Œæ—¶åŠ è½½æ–° jarã€‚ 3. å¤šç‰ˆæœ¬éš”ç¦» åœºæ™¯è¯´æ˜ï¼š ä½ å¸Œæœ›ä¸åŒçš„æ¨¡å—ä½¿ç”¨åŒä¸€ä¸ªåº“çš„ä¸åŒç‰ˆæœ¬ï¼Œä½† classpath æ— æ³•æ”¯æŒä¸¤ä¸ªç‰ˆæœ¬çš„åŒä¸€ä¸ªç±»ã€‚ ä¸¾ä¾‹ï¼š ä¸€ä¸ªæœåŠ¡å™¨è¿è¡Œå¤šä¸ªæœåŠ¡å®ä¾‹ï¼Œå®ƒä»¬åˆ†åˆ«ä¾èµ– log4j çš„ä¸åŒç‰ˆæœ¬ ä¸€ä¸ªç³»ç»Ÿçš„æ’ä»¶ A ä½¿ç”¨ fastjson 1.xï¼Œæ’ä»¶ B ä½¿ç”¨ fastjson 2.x ä¸ºä»€ä¹ˆä¸èƒ½æ”¾å…¥ classpathï¼Ÿ classpath æ˜¯å…±äº«çš„ï¼Œä¼šå‘ç”Ÿç±»å†²çªã€‚ä½¿ç”¨å¤šä¸ª URLClassLoaderï¼Œå¯å®ç°ç±»éš”ç¦»ã€‚ 4. è„šæœ¬æˆ–ç”¨æˆ·ä¸Šä¼ ä»£ç æ‰§è¡Œ åœºæ™¯è¯´æ˜ï¼š ç³»ç»Ÿå…è®¸ç”¨æˆ·ä¸Šä¼  jar æˆ– class æ–‡ä»¶ï¼Œç„¶ååœ¨æœåŠ¡ç«¯æ‰§è¡Œå…¶ä¸­çš„ç±»é€»è¾‘ã€‚ ä¸¾ä¾‹ï¼š åœ¨çº¿ç¼–ç¨‹å¹³å°ï¼ˆå¦‚ LeetCode åç«¯ï¼‰ ç”¨æˆ·ä¸Šä¼ ç®—æ³• jarï¼Œå¹³å°è¿è¡Œå¹¶è¿”å›ç»“æœ ä¸ºä»€ä¹ˆä¸èƒ½æ”¾å…¥ classpathï¼Ÿ ç”¨æˆ·ä¸Šä¼ å†…å®¹æ˜¯åŠ¨æ€çš„ï¼Œç³»ç»Ÿåœ¨è¿è¡Œå‰æ— æ³•é¢„çŸ¥ã€‚ 5. å®ç°ç±»çš„å»¶è¿ŸåŠ è½½ï¼ˆèŠ‚çœèµ„æºï¼‰ åœºæ™¯è¯´æ˜ï¼š æŸäº›ç±»/æ¨¡å—ä½“ç§¯è¾ƒå¤§æˆ–ä¾èµ–è¾ƒå¤šï¼Œä¸å¸Œæœ›åœ¨ç¨‹åºå¯åŠ¨æ—¶å°±åŠ è½½ï¼Œåªæœ‰çœŸæ­£ä½¿ç”¨æ—¶å†åŠ è½½ã€‚ ä¸¾ä¾‹ï¼š å¤§å‹æ¡Œé¢åº”ç”¨ï¼ˆå¦‚ IntelliJï¼‰åœ¨æ‰“å¼€æŸä¸ªåŠŸèƒ½æ¨¡å—æ—¶æ‰åŠ è½½ç›¸åº” jar æ€»ç»“ åœºæ™¯ ä½¿ç”¨ URLClassLoader çš„åŸå›  æ’ä»¶ç³»ç»Ÿ æ’ä»¶åŠ¨æ€åŠ è½½ï¼Œä¸åœ¨é¡¹ç›®ç¼–è¯‘æ—¶å¯çŸ¥ çƒ­éƒ¨ç½² åŠ¨æ€æ›¿æ¢æ¨¡å—ï¼Œæ— éœ€é‡å¯ å¤šç‰ˆæœ¬å…±å­˜ é¿å…ç±»å†²çªï¼Œå®ç°ç±»åŠ è½½éš”ç¦» ç”¨æˆ·ä¸Šä¼  jar å†…å®¹åŠ¨æ€ç”Ÿæˆï¼Œclasspath æ— æ³•é¢„å…ˆé…ç½® å»¶è¿ŸåŠ è½½æ¨¡å— å¯åŠ¨æ›´å¿«ï¼ŒèŠ‚çœå†…å­˜ å¦‚æœä½ æ˜¯åœ¨åšæ¡†æ¶è®¾è®¡æˆ–éœ€è¦åŠ¨æ€æ‰©å±•èƒ½åŠ›çš„åœºæ™¯ï¼Œç†è§£å¹¶ä½¿ç”¨ URLClassLoader ä¼šéå¸¸æœ‰å¸®åŠ©ã€‚ åœºæ™¯å‡è®¾ è°ƒç”¨å¤–éƒ¨jar æˆ‘ä»¬æœ‰ä¸€ä¸ªå¤–éƒ¨ jar æ–‡ä»¶ï¼šhello-plugin.jarï¼Œå®ƒåŒ…å«ä¸€ä¸ªç±»ï¼š 12345678// è¿™ä¸ªç±»ç¼–è¯‘åæ‰“åŒ…è¿› hello-plugin.jarpackage com.example.plugin;public class HelloPlugin &#123; public void sayHello(String name) &#123; System.out.println(&quot;Hello from plugin! :&quot; + name); &#125;&#125; ä¸»ç¨‹åºä½¿ç”¨ URLClassLoader åŠ¨æ€åŠ è½½è¿™ä¸ª jar 12345678910111213141516171819202122232425262728import java.io.File;import java.lang.reflect.Method;import java.net.URL;import java.net.URLClassLoader;public class PluginLoader &#123; public static void main(String[] args) throws Exception &#123; // å¤–éƒ¨ jar çš„è·¯å¾„ File jarFile = new File(&quot;plugins/hello-plugin.jar&quot;); URL jarUrl = jarFile.toURI().toURL(); // HTTPS jar çš„ URL // URL jarUrl = new URL(&quot;https://your-domain.com/libs/hello-plugin.jar&quot;); // æ„å»º URLClassLoaderï¼ˆä¹Ÿå¯ä»¥è®¾ç½®çˆ¶åŠ è½½å™¨ï¼‰ URLClassLoader classLoader = new URLClassLoader(new URL[]&#123;jarUrl&#125;); // åŠ è½½æ’ä»¶ç±» Class&lt;?&gt; clazz = classLoader.loadClass(&quot;com.example.plugin.HelloPlugin&quot;); // åˆ›å»ºå®ä¾‹å¹¶è°ƒç”¨æ–¹æ³• Object plugin = clazz.getDeclaredConstructor().newInstance(); Method sayHello = clazz.getMethod(&quot;sayHello&quot;, String.class); sayHello.invoke(plugin, &quot;World&quot;); // å…³é—­ ClassLoaderï¼ˆJava 7+ æ¨èï¼‰ classLoader.close(); &#125;&#125; è¿è¡Œæ—¶åŠ¨æ€ç¼–è¯‘ Java æºä»£ç  æˆ‘ä»¬æœ‰ä¸€ä¸ª java ä»£ç ç‰‡æ®µï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364import javax.tools.JavaCompiler;import javax.tools.ToolProvider;import java.io.File;import java.io.FileWriter;import java.lang.reflect.Method;import java.net.URL;import java.net.URLClassLoader;import java.nio.file.Files;import java.nio.file.Path;public class DynamicJavaRunner &#123; public static void main(String[] args) throws Exception &#123; String className = &quot;com.example.dynamic.Hello&quot;; // Java æºä»£ç  String sourceCode = &quot;package com.example.dynamic;\\n&quot; + &quot;\\n&quot; + &quot;public class Hello &#123;\\n&quot; + &quot; public void say() &#123;\\n&quot; + &quot; System.out.println(\\&quot;Hello from dynamic source!\\&quot;);\\n&quot; + &quot; &#125;\\n&quot; + &quot;&#125;\\n&quot;; // åˆ›å»ºä¸´æ—¶ç›®å½• Path tempDir = Files.createTempDirectory(&quot;dynamic-classes&quot;); File outputDir = tempDir.toFile(); // System.out.println(&quot;ä¸´æ—¶ç›®å½•ï¼š&quot; + outputDir.getAbsolutePath()); // åˆ›å»º .java æ–‡ä»¶ File javaFile = new File(outputDir, &quot;com/example/dynamic/Hello.java&quot;); javaFile.getParentFile().mkdirs(); try (FileWriter writer = new FileWriter(javaFile)) &#123; writer.write(sourceCode); &#125; // ç¼–è¯‘ Java æ–‡ä»¶ JavaCompiler compiler = ToolProvider.getSystemJavaCompiler(); if (compiler == null) &#123; System.err.println(&quot;è¯·ç”¨ JDK è€Œé JRE è¿è¡Œï¼&quot;); return; &#125; int result = compiler.run(null, null, null, javaFile.getPath()); if (result != 0) &#123; System.err.println(&quot;ç¼–è¯‘å¤±è´¥ï¼&quot;); return; &#125; // åŠ è½½ç±»å¹¶è°ƒç”¨ URLClassLoader classLoader = new URLClassLoader(new URL[]&#123;outputDir.toURI().toURL()&#125;); Class&lt;?&gt; clazz = classLoader.loadClass(className); Object instance = clazz.getDeclaredConstructor().newInstance(); Method method = clazz.getMethod(&quot;say&quot;); method.invoke(instance); // æ¸…ç†ï¼ˆå¯é€‰ï¼‰ classLoader.close(); // åˆ é™¤ä¸´æ—¶ç›®å½• Files.walk(outputDir.toPath()) .sorted(Comparator.reverseOrder()) // å…ˆåˆ æ–‡ä»¶ï¼Œå†åˆ ç›®å½• .map(Path::toFile) .forEach(File::delete); &#125;&#125; å…³é”®ç‚¹è¯´æ˜ æœºåˆ¶ è¯´æ˜ JavaCompiler JDK è‡ªå¸¦çš„ç¼–è¯‘å™¨ï¼ˆtools.jarï¼‰ ToolProvider.getSystemJavaCompiler() åªèƒ½åœ¨ JDK ç¯å¢ƒä¸­å·¥ä½œï¼ŒJRE æ— æ³•ä½¿ç”¨ URLClassLoader ç”¨äºåŠ è½½ç¼–è¯‘åçš„ .class æ–‡ä»¶ FileWriter ä¿å­˜ä»£ç ä¸ºä¸´æ—¶ Java æ–‡ä»¶ è‡ªå®šä¹‰ç±»åŠ è½½å™¨ è¦è‡ªå®šä¹‰ ClassLoaderï¼Œåªéœ€è¦ç»§æ‰¿äº ClassLoader æˆ–è€… SecureClassLoaderï¼Œå¹¶é‡å†™ findClass() æ–¹æ³•å³å¯ ç¤ºä¾‹ï¼šæˆ‘ä»¬å¯¹ä¸Šé¢çš„ä»£ç è¿›è¡Œå‡çº§ï¼Œä¸åˆ›å»ºä¸´æ—¶æ–‡ä»¶ï¼Œè€Œæ˜¯åœ¨å†…å­˜ä¸­ç¼–è¯‘ä»£ç ï¼Œå¹¶ä»å†…å­˜ä¸­åŠ è½½å­—èŠ‚ç ï¼Œè€Œä¸ä¾èµ–ç£ç›˜æ–‡ä»¶ï¼Œæ›´é«˜æ•ˆä¹Ÿæ›´é€‚åˆç”Ÿäº§ç¯å¢ƒä¸­åŠ¨æ€ç±»åŠ è½½ï¼ˆå¦‚åœ¨çº¿ä»£ç æ‰§è¡Œã€è„šæœ¬å¼•æ“ç­‰ï¼‰ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114import javax.tools.*;import java.io.*;import java.net.URI;import java.util.*;import java.lang.reflect.*;public class InMemoryJavaRunner &#123; public static void main(String[] args) throws Exception &#123; String className = &quot;com.example.dynamic.Hello&quot;; String sourceCode = &quot;package com.example.dynamic;\\n&quot; + &quot;public class Hello &#123;\\n&quot; + &quot; public void say() &#123;\\n&quot; + &quot; System.out.println(\\&quot;Hello from memory compiled class!\\&quot;);\\n&quot; + &quot; &#125;\\n&quot; + &quot;&#125;&quot;; // è·å–ç³»ç»Ÿ Java ç¼–è¯‘å™¨ JavaCompiler compiler = ToolProvider.getSystemJavaCompiler(); if (compiler == null) &#123; System.err.println(&quot;è¯·ä½¿ç”¨ JDK è¿è¡Œæ­¤ç¨‹åºï¼ˆé JREï¼‰&quot;); return; &#125; // å‡†å¤‡ç¼–è¯‘æºä»£ç ï¼šä¸€ä¸ª JavaFileObject è¡¨ç¤ºæºä»£ç  JavaFileObject sourceFile = new JavaSourceFromString(className, sourceCode); // åˆ›å»ºè‡ªå®šä¹‰çš„å†…å­˜æ–‡ä»¶ç®¡ç†å™¨ï¼ˆæ›¿ä»£æ ‡å‡†çš„ç£ç›˜ç®¡ç†å™¨ï¼‰ StandardJavaFileManager standardFileManager = compiler.getStandardFileManager(null, null, null); MemoryJavaFileManager fileManager = new MemoryJavaFileManager(standardFileManager); // æ‰§è¡Œç¼–è¯‘ä»»åŠ¡ JavaCompiler.CompilationTask task = compiler.getTask(null, fileManager, null, null, null, Collections.singletonList(sourceFile)); boolean success = task.call(); if (!success) &#123; System.err.println(&quot;ç¼–è¯‘å¤±è´¥ï¼&quot;); return; &#125; // åŠ è½½ç¼–è¯‘åçš„ç±» Map&lt;String, byte[]&gt; classBytes = fileManager.getClassBytes(); InMemoryClassLoader classLoader = new InMemoryClassLoader(classBytes); Class&lt;?&gt; clazz = classLoader.loadClass(className); Object instance = clazz.getDeclaredConstructor().newInstance(); Method method = clazz.getMethod(&quot;say&quot;); method.invoke(instance); &#125; // ç”¨äºè¡¨ç¤ºå†…å­˜ä¸­çš„ Java æºä»£ç  static class JavaSourceFromString extends SimpleJavaFileObject &#123; final String code; JavaSourceFromString(String className, String code) &#123; super(URI.create(&quot;string:///&quot; + className.replace(&#x27;.&#x27;, &#x27;/&#x27;) + Kind.SOURCE.extension), Kind.SOURCE); this.code = code; &#125; public CharSequence getCharContent(boolean ignoreEncodingErrors) &#123; return code; &#125; &#125; // å°†ç¼–è¯‘çš„ class æ–‡ä»¶ä¿å­˜åœ¨å†…å­˜ä¸­ï¼ˆä¸æ˜¯æ–‡ä»¶ç³»ç»Ÿï¼‰ static class MemoryJavaFileManager extends ForwardingJavaFileManager&lt;StandardJavaFileManager&gt; &#123; private final Map&lt;String, ByteArrayOutputStream&gt; classOutputBuffers = new HashMap&lt;&gt;(); MemoryJavaFileManager(StandardJavaFileManager standardManager) &#123; super(standardManager); &#125; @Override public JavaFileObject getJavaFileForOutput(Location location, String className, JavaFileObject.Kind kind, FileObject sibling) &#123; ByteArrayOutputStream outputStream = new ByteArrayOutputStream(); classOutputBuffers.put(className, outputStream); return new SimpleJavaFileObject( URI.create(&quot;mem:///&quot; + className.replace(&#x27;.&#x27;, &#x27;/&#x27;) + kind.extension), kind) &#123; @Override public OutputStream openOutputStream() &#123; return outputStream; &#125; &#125;; &#125; public Map&lt;String, byte[]&gt; getClassBytes() &#123; Map&lt;String, byte[]&gt; result = new HashMap&lt;&gt;(); for (Map.Entry&lt;String, ByteArrayOutputStream&gt; entry : classOutputBuffers.entrySet()) &#123; result.put(entry.getKey(), entry.getValue().toByteArray()); &#125; return result; &#125; &#125; // è‡ªå®šä¹‰ ClassLoaderï¼Œç”¨äºä»å†…å­˜ä¸­åŠ è½½å­—èŠ‚ç  static class InMemoryClassLoader extends ClassLoader &#123; private final Map&lt;String, byte[]&gt; classBytes; public InMemoryClassLoader(Map&lt;String, byte[]&gt; classBytes) &#123; super(ClassLoader.getSystemClassLoader()); this.classBytes = classBytes; &#125; @Override protected Class&lt;?&gt; findClass(String name) throws ClassNotFoundException &#123; // ä»å†…å­˜ä¸­è·å–å­—èŠ‚ç  byte[] bytes = classBytes.get(name); if (bytes == null) &#123; return super.findClass(name); &#125; // å®šä¹‰ç±»å¹¶è¿”å›ï¼Œä¸€å®šè¦ä½¿ç”¨ defineClass æ–¹æ³• return defineClass(name, bytes, 0, bytes.length); &#125; &#125;&#125; è¿›ä¸€æ­¥å‡çº§ï¼šæˆ‘ä»¬ç°åœ¨å°†è¿™ä¸ªç³»ç»Ÿæ‰©å±•ä¸ºæ”¯æŒå¤šä¸ªç±»åŒæ—¶åŠ¨æ€ç¼–è¯‘ã€å†…å­˜åŠ è½½å¹¶æ‰§è¡Œã€‚è¿™å¯¹äºéœ€è¦å¤„ç†å¤šä¸ªç±»ï¼ˆä¾‹å¦‚æ¥å£ + å®ç°ã€å†…éƒ¨ä¾èµ–ç­‰ï¼‰éå¸¸å®ç”¨ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127import javax.tools.*;import java.io.*;import java.net.URI;import java.util.*;import java.lang.reflect.*;// ä¸»ç±»public class MultiClassInMemoryCompiler &#123; public static void main(String[] args) throws Exception &#123; // å‡†å¤‡å¤šä¸ªç±»çš„æºä»£ç  Map&lt;String, String&gt; sources = new HashMap&lt;&gt;(); sources.put(&quot;com.example.api.Greeter&quot;, &quot;package com.example.api;\\n&quot; + &quot;public interface Greeter &#123;\\n&quot; + &quot; void greet();\\n&quot; + &quot;&#125;\\n&quot;); sources.put(&quot;com.example.impl.EnglishGreeter&quot;, &quot;package com.example.impl;\\n&quot; + &quot;import com.example.api.Greeter;\\n&quot; + &quot;public class EnglishGreeter implements Greeter &#123;\\n&quot; + &quot; public void greet() &#123;\\n&quot; + &quot; System.out.println(\\&quot;Hello from EnglishGreeter!\\&quot;);\\n&quot; + &quot; &#125;\\n&quot; + &quot;&#125;\\n&quot;); String entryClassName = &quot;com.example.impl.EnglishGreeter&quot;; // ç¼–è¯‘ Map&lt;String, byte[]&gt; compiledClasses = compile(sources); if (compiledClasses == null) &#123; System.err.println(&quot;ç¼–è¯‘å¤±è´¥&quot;); return; &#125; // åŠ è½½å¹¶æ‰§è¡Œ InMemoryClassLoader classLoader = new InMemoryClassLoader(compiledClasses); Class&lt;?&gt; clazz = classLoader.loadClass(entryClassName); Object obj = clazz.getDeclaredConstructor().newInstance(); Method method = clazz.getMethod(&quot;greet&quot;); method.invoke(obj); &#125; // ç¼–è¯‘å™¨å…¥å£ï¼Œæ”¯æŒå¤šä¸ªç±» public static Map&lt;String, byte[]&gt; compile(Map&lt;String, String&gt; sources) &#123; JavaCompiler compiler = ToolProvider.getSystemJavaCompiler(); if (compiler == null) &#123; System.err.println(&quot;è¯·ä½¿ç”¨ JDK è¿è¡Œ&quot;); return null; &#125; List&lt;JavaFileObject&gt; compilationUnits = new ArrayList&lt;&gt;(); for (Map.Entry&lt;String, String&gt; entry : sources.entrySet()) &#123; compilationUnits.add(new JavaSourceFromString(entry.getKey(), entry.getValue())); &#125; StandardJavaFileManager stdManager = compiler.getStandardFileManager(null, null, null); MemoryJavaFileManager memManager = new MemoryJavaFileManager(stdManager); JavaCompiler.CompilationTask task = compiler.getTask(null, memManager, null, null, null, compilationUnits); boolean success = task.call(); return success ? memManager.getClassBytes() : null; &#125; // æºæ–‡ä»¶è¡¨ç¤ºï¼ˆJava ä»£ç ä»¥å­—ç¬¦ä¸²æä¾›ï¼‰ static class JavaSourceFromString extends SimpleJavaFileObject &#123; final String code; JavaSourceFromString(String className, String code) &#123; super(URI.create(&quot;string:///&quot; + className.replace(&#x27;.&#x27;, &#x27;/&#x27;) + Kind.SOURCE.extension), Kind.SOURCE); this.code = code; &#125; @Override public CharSequence getCharContent(boolean ignoreEncodingErrors) &#123; return code; &#125; &#125; // å†…å­˜ä¸­çš„ç¼–è¯‘è¾“å‡ºç®¡ç†å™¨ static class MemoryJavaFileManager extends ForwardingJavaFileManager&lt;StandardJavaFileManager&gt; &#123; private final Map&lt;String, ByteArrayOutputStream&gt; classOutputBuffers = new HashMap&lt;&gt;(); MemoryJavaFileManager(StandardJavaFileManager standardManager) &#123; super(standardManager); &#125; @Override public JavaFileObject getJavaFileForOutput(Location location, String className, JavaFileObject.Kind kind, FileObject sibling) &#123; ByteArrayOutputStream outputStream = new ByteArrayOutputStream(); classOutputBuffers.put(className, outputStream); return new SimpleJavaFileObject( URI.create(&quot;mem:///&quot; + className.replace(&#x27;.&#x27;, &#x27;/&#x27;) + kind.extension), kind) &#123; @Override public OutputStream openOutputStream() &#123; return outputStream; &#125; &#125;; &#125; public Map&lt;String, byte[]&gt; getClassBytes() &#123; Map&lt;String, byte[]&gt; result = new HashMap&lt;&gt;(); for (Map.Entry&lt;String, ByteArrayOutputStream&gt; entry : classOutputBuffers.entrySet()) &#123; result.put(entry.getKey(), entry.getValue().toByteArray()); &#125; return result; &#125; &#125; // ç”¨äºåŠ è½½å†…å­˜ä¸­çš„ class static class InMemoryClassLoader extends ClassLoader &#123; private final Map&lt;String, byte[]&gt; classBytes; public InMemoryClassLoader(Map&lt;String, byte[]&gt; classBytes) &#123; super(ClassLoader.getSystemClassLoader()); this.classBytes = classBytes; &#125; @Override protected Class&lt;?&gt; findClass(String name) throws ClassNotFoundException &#123; byte[] bytes = classBytes.get(name); if (bytes == null) return super.findClass(name); return defineClass(name, bytes, 0, bytes.length); &#125; &#125;&#125; æ‰“ç ´åŒäº²å§”æ´¾ï¼Œå®ç°åŒç±»å¤šç‰ˆæœ¬å…±å­˜ å‡è®¾æˆ‘ä»¬æœ‰åŒä¸€ä¸ªjaråŒ…çš„ä¸åŒç‰ˆæœ¬ï¼Œæ¯”å¦‚ï¼ša-1.0.jarå’Œa-2.0.jarï¼Œä»–ä»¬å…·æœ‰åŒåçš„ DemoClassç±» ,ç³»ç»Ÿclasspathä¸­å¼•å…¥çš„æ˜¯ a-1.0.jarï¼Œè€Œæ­¤æ—¶æˆ‘ä»¬é€šè¿‡â¾ƒå®šçš„ClassLoaderåŠ è½½ a-2.0.jarï¼Œå¹¶è°ƒç”¨ DemoClassç±» ï¼Œæˆ‘ä»¬ä¼šå‘ç°ï¼Œâ¾ƒå®šçš„ClassLoaderåŠ è½½çš„ç±»ä¾æ—§æ˜¯ a-1.0.jar ä¸­çš„ç±»ï¼Œè€Œä¸æ˜¯ a-2.0.jar ä¸­çš„ç±»ã€‚ ä¸ºä»€ä¹ˆä¼šå‡ºç°è¿™ç§æƒ…å†µå‘¢ï¼Ÿè¿™å°±æ˜¯å› ä¸ºJDKçš„åŒäº²å§”æ´¾æœºåˆ¶ã€‚â¾ƒå®šçš„ClassLoaderçš„parentå±æ€§æŒ‡å‘çš„æ˜¯JDKå†…çš„AppClassLoaderï¼Œâ½½ AppClassLoader ä¼šåŠ è½½ç³»ç»Ÿå½“ä¸­çš„æ‰€æœ‰ä»£ç ï¼Œå°±åŒ…æ‹¬ a-1.0.jarä¸­çš„ DemoClassç±»ã€‚è¿™æ—¶ï¼Œâ¾ƒå®šçš„ClassLoaderå»åŠ è½½ DemoClassç±»æ—¶ï¼Œé€šè¿‡åŒäº²å§”æ´¾å‘ä¸ŠæŸ¥æ‰¾ï¼Œâ¾ƒç„¶åŠ è½½å‡ºæ¥çš„å°±æ˜¯APPClassloaderä¸­çš„DemoClassäº†ã€‚ å¦‚ä½•æ‰“ç ´åŒäº²å§”æ´¾å‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥é€šè¿‡é‡å†™ loadClass()æ–¹æ³•ï¼Œæ¥æ‰“ç ´åŒäº²å§”æ´¾ï¼Œå®ç°ç±»â½‚ä»¶çš„åŠ è½½ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152import java.io.ByteArrayOutputStream;import java.io.InputStream;import java.net.URL;import java.net.URLConnection;import java.security.SecureClassLoader;public class CustomClassLoader extends SecureClassLoader &#123; private URL jarUrl; public CustomClassLoader(URL jarUrl) &#123; // åˆ›å»ºä¸€ä¸ªç‹¬ç«‹çš„å­ç±»åŠ è½½å™¨ï¼ŒåªåŠ è½½æŒ‡å®š JAR this.jarUrl = jarUrl; &#125; @Override public Class&lt;?&gt; loadClass(String name, boolean resolve) throws ClassNotFoundException &#123; // æŠŠåŒäº²å§”æ´¾æœºåˆ¶åè¿‡æ¥ï¼Œå…ˆåˆ°â¼¦ç±»åŠ è½½å™¨ä¸­åŠ è½½ï¼ŒåŠ è½½ä¸åˆ°å†å»â½—ç±»åŠ è½½å™¨ä¸­åŠ è½½ã€‚ synchronized (getClassLoadingLock(name)) &#123; // å¦‚æœç±»å·²åŠ è½½ï¼Œåˆ™ç›´æ¥è¿”å› Class&lt;?&gt; loadedClass = findLoadedClass(name); if (loadedClass == null) &#123; loadedClass = findClass(name); &#125; else &#123; // å§”æ´¾ç»™çˆ¶ç±»åŠ è½½å™¨ loadedClass = super.loadClass(name, resolve); &#125; return loadedClass; &#125; &#125; @Override protected Class&lt;?&gt; findClass(String name) &#123; int code; try &#123; // è®¿é—®jaråŒ…çš„url URLConnection urlConnection = jarUrl.openConnection(); urlConnection.setUseCaches(false); InputStream is = urlConnection.getInputStream(); ByteArrayOutputStream bos = new ByteArrayOutputStream(); while ((code = is.read()) != -1) &#123; bos.write(code); &#125; byte[] data = bos.toByteArray(); is.close(); bos.close(); return defineClass(name, data, 0, data.length); &#125; catch (Exception e) &#123; return null; &#125; &#125;&#125; æµ‹è¯•ä»£ç  12345678910111213141516import java.io.File;import java.net.URL;public class Test &#123; public static void main(String[] args) throws Exception &#123; File jarFile = new File(&quot;path/to/a-2.0.jar&quot;); URL jarUrl = jarFile.toURI().toURL(); CustomClassLoader loader = new CustomClassLoader(jarUrl); // åŠ è½½ DemoClass Class&lt;?&gt; clazz = loader.loadClass(&quot;com.example.DemoClass&quot;); Object obj = clazz.getDeclaredConstructor().newInstance(); clazz.getMethod(&quot;print&quot;).invoke(obj); &#125;&#125; æ‰“ç ´åŒäº²å§”æ´¾æœºåˆ¶çš„å…¸å‹åœºæ™¯ Tomcatç±»åŠ è½½å™¨ CommonClassLoaderï¼šTomcatæœ€åŸºæœ¬çš„ç±»åŠ è½½å™¨ï¼ŒåŠ è½½è·¯å¾„ä¸­çš„classå¯ä»¥è¢«Tomcatå®¹å™¨æœ¬èº«ä»¥åŠå„ä¸ªWebappè®¿é—®ï¼› CatalinaClassLoaderï¼šTomcatå®¹å™¨ç§æœ‰çš„ç±»åŠ è½½å™¨ï¼ŒåŠ è½½è·¯å¾„ä¸­çš„classå¯¹äºWebappä¸å¯â»…ï¼› SharedClassLoaderï¼šå„ä¸ªWebappå…±äº«çš„ç±»åŠ è½½å™¨ï¼ŒåŠ è½½è·¯å¾„ä¸­çš„classå¯¹äºæ‰€æœ‰Webappå¯â»…ï¼Œä½†æ˜¯å¯¹äºTomcatå®¹å™¨ä¸å¯â»…ï¼› WebappClassLoaderï¼šå„ä¸ªWebappç§æœ‰çš„ç±»åŠ è½½å™¨ï¼ŒåŠ è½½è·¯å¾„ä¸­çš„classåªå¯¹å½“å‰Webappå¯â»…ï¼Œâ½å¦‚åŠ è½½waråŒ…â¾¥ç›¸å…³çš„ç±»ï¼Œæ¯ä¸ªwaråŒ…åº”â½¤éƒ½æœ‰â¾ƒâ¼°çš„WebappClassLoaderï¼Œå®ç°ç›¸äº’éš”ç¦»ï¼Œâ½å¦‚ä¸åŒwaråŒ…åº”â½¤å¼•â¼Šäº†ä¸åŒçš„springç‰ˆæœ¬ï¼Œè¿™æ ·å®ç°å°±èƒ½åŠ è½½å„â¾ƒçš„springç‰ˆæœ¬ï¼› Jspç±»åŠ è½½å™¨ï¼šé’ˆå¯¹æ¯ä¸ªJSPâ»šâ¾¯åˆ›å»ºâ¼€ä¸ªåŠ è½½å™¨ã€‚è¿™ä¸ªåŠ è½½å™¨â½è¾ƒè½»é‡çº§ï¼Œæ‰€ä»¥Tomcatè¿˜å®ç°äº†çƒ­åŠ è½½ï¼Œä¹Ÿå°±æ˜¯JSPåªè¦ä¿®æ”¹äº†ï¼Œå°±åˆ›å»ºâ¼€ä¸ªæ–°çš„åŠ è½½å™¨ï¼Œä»â½½å®ç°äº†JSPâ»šâ¾¯çš„çƒ­æ›´æ–°ã€‚","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç»JVMçš„ç±»åŠ è½½å™¨ JDK8 The JavaÂ® Virtual Machine Specification JDK8çš„javaæŒ‡ä»¤çš„å®˜â½…â½‚æ¡£ JDKâ¼¯å…·å®˜â½¹â½‚æ¡£ JDK17çš„javaæŒ‡ä»¤çš„å®˜â½…â½‚æ¡£","date_published":"2025-05-08T13:30:05.000Z","tags":["æŠ€æœ¯","jvm","jvm"]},{"id":"https://blog.hanqunfeng.com/2025/04/22/elasticsearch-06-api-aggs/","url":"https://blog.hanqunfeng.com/2025/04/22/elasticsearch-06-api-aggs/","title":"Elasticsearch çš„ REST APIs:èšåˆæŸ¥è¯¢","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç» Elasticsearch çš„ REST APIsï¼šèšåˆæŸ¥è¯¢</p>\n</li>\n<li class=\"lvl-2\">\n<p>Elasticsearchç‰ˆæœ¬8.17.3</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://www.elastic.co/guide/en/elasticsearch/reference/8.17/rest-apis.html\">å®˜æ–¹æ–‡æ¡£:REST APIs</a></p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://www.elastic.co/guide/en/elasticsearch/reference/8.17/search-aggregations.html\">å®˜æ–¹æ–‡æ¡£:Aggregations</a></p>\n</li>\n<li class=\"lvl-2\">\n<a href=\"/2025/04/17/elasticsearch-05-api/\" title=\"Elasticsearch çš„ REST APIs\">Elasticsearch çš„ REST APIs</a>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"èšåˆæŸ¥è¯¢\">èšåˆæŸ¥è¯¢</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><a href=\"https://www.elastic.co/guide/en/elasticsearch/reference/current/search-aggregations.html\">èšåˆæŸ¥è¯¢</a>ï¼Œå¯ä»¥è®©æˆ‘ä»¬æå…¶æ–¹ä¾¿çš„å®ç°å¯¹ç´¢å¼•æ•°æ®çš„ç»Ÿè®¡ã€åˆ†æã€è¿ç®—ç­‰æ“ä½œã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>åŸºæœ¬è¯­æ³•åŒ…æ‹¬ä»¥ä¸‹éƒ¨åˆ†ï¼š</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">æŸ¥è¯¢æ¡ä»¶ï¼šæŒ‡å®šéœ€è¦èšåˆçš„æ–‡æ¡£ï¼Œå¯ä»¥ä½¿ç”¨æ ‡å‡†çš„ Elasticsearch æŸ¥è¯¢è¯­æ³•ï¼Œå¦‚ termã€matchã€range ç­‰ç­‰ã€‚</li>\n<li class=\"lvl-4\">èšåˆå‡½æ•°ï¼šæŒ‡å®šè¦æ‰§è¡Œçš„èšåˆæ“ä½œï¼Œå¦‚ sumã€avgã€minã€maxã€termsã€date_histogram ç­‰ç­‰ã€‚æ¯ä¸ªèšåˆå‘½ä»¤éƒ½ä¼šç”Ÿæˆä¸€ä¸ªèšåˆç»“æœã€‚</li>\n<li class=\"lvl-4\">èšåˆåµŒå¥—ï¼šèšåˆå‘½ä»¤å¯ä»¥åµŒå¥—ï¼Œä»¥ä¾¿æ›´ç»†ç²’åº¦åœ°åˆ†ææ•°æ®ã€‚</li>\n</ul>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">GET &lt;index_name&gt;/_search</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">&quot;aggs&quot;</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;&lt;aggs_name&gt;&quot;</span>: &#123;</span><br><span class=\"line\">      <span class=\"string\">&quot;&lt;agg_type&gt;&quot;</span>: &#123;</span><br><span class=\"line\">        <span class=\"string\">&quot;field&quot;</span>: <span class=\"string\">&quot;&lt;field_name&gt;&quot;</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\"># è¯´æ˜</span></span><br><span class=\"line\">  <span class=\"comment\"># aggsï¼šèšåˆçš„æ ¹èŠ‚ç‚¹ï¼Œå›ºå®šå†™æ³•</span></span><br><span class=\"line\">  <span class=\"comment\"># aggs_nameï¼šèšåˆå‡½æ•°çš„åç§°ï¼Œè‡ªå·±éšæ„å®šä¹‰</span></span><br><span class=\"line\">  <span class=\"comment\"># agg_typeï¼šèšåˆç§ç±»ï¼Œæ¯”å¦‚æ˜¯æ¡¶èšåˆï¼ˆtermsï¼‰æˆ–è€…æ˜¯æŒ‡æ ‡èšåˆï¼ˆavgã€sumã€minã€maxç­‰ï¼‰</span></span><br><span class=\"line\">  <span class=\"comment\"># field_nameï¼šå­—æ®µåç§°æˆ–è€…å«åŸŸåã€‚</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>èšåˆçš„åˆ†ç±»</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">Metric Aggregationï¼šâ€”äº›æ•°å­¦è¿ç®—ï¼Œå¯ä»¥å¯¹æ–‡æ¡£å­—æ®µè¿›è¡Œç»Ÿè®¡åˆ†æï¼Œç±»æ¯”Mysqlä¸­çš„ min(), max(), sum() æ“ä½œã€‚</li>\n<li class=\"lvl-4\">Bucket Aggregationï¼šä¸€äº›æ»¡è¶³ç‰¹å®šæ¡ä»¶çš„æ–‡æ¡£çš„é›†åˆæ”¾ç½®åˆ°ä¸€ä¸ªæ¡¶é‡Œï¼Œæ¯ä¸€ä¸ªæ¡¶å…³è”ä¸€ä¸ªkeyï¼Œç±»æ¯”Mysqlä¸­çš„group byæ“ä½œã€‚</li>\n<li class=\"lvl-4\">Pipeline Aggregationï¼šå¯¹å…¶ä»–çš„èšåˆç»“æœè¿›è¡ŒäºŒæ¬¡èšåˆ</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"ç¤ºä¾‹æ•°æ®å‡†å¤‡\">ç¤ºä¾‹æ•°æ®å‡†å¤‡</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æˆ‘ä»¬éœ€è¦å…ˆå‡†å¤‡ä¸€äº›æ•°æ®ï¼Œæ‰èƒ½è¿›è¡Œèšåˆåˆ†æã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>åˆ›å»ºç´¢å¼•</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å¦‚æœå­˜åœ¨å…ˆåˆ é™¤</span></span><br><span class=\"line\">curl -X DELETE -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/shopping&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åˆ›å»ºç´¢å¼•</span></span><br><span class=\"line\">curl -X PUT -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/shopping&#x27;</span> \\</span><br><span class=\"line\">  -H <span class=\"string\">&#x27;Content-Type: application/json&#x27;</span> \\</span><br><span class=\"line\">  -d <span class=\"string\">&#x27;&#123;</span></span><br><span class=\"line\"><span class=\"string\">    &quot;settings&quot;:&#123;</span></span><br><span class=\"line\"><span class=\"string\">      &quot;number_of_shards&quot;:&quot;1&quot;,</span></span><br><span class=\"line\"><span class=\"string\">      &quot;number_of_replicas&quot;:&quot;2&quot;</span></span><br><span class=\"line\"><span class=\"string\">    &#125;,</span></span><br><span class=\"line\"><span class=\"string\">    &quot;mappings&quot;:&#123;</span></span><br><span class=\"line\"><span class=\"string\">      &quot;properties&quot;:&#123;</span></span><br><span class=\"line\"><span class=\"string\">        &quot;category&quot;:&#123;</span></span><br><span class=\"line\"><span class=\"string\">          &quot;type&quot;:&quot;keyword&quot;</span></span><br><span class=\"line\"><span class=\"string\">        &#125;,</span></span><br><span class=\"line\"><span class=\"string\">        &quot;price&quot;:&#123;</span></span><br><span class=\"line\"><span class=\"string\">          &quot;type&quot;:&quot;double&quot;</span></span><br><span class=\"line\"><span class=\"string\">        &#125;,</span></span><br><span class=\"line\"><span class=\"string\">        &quot;count&quot;:&#123;</span></span><br><span class=\"line\"><span class=\"string\">          &quot;type&quot;:&quot;integer&quot;</span></span><br><span class=\"line\"><span class=\"string\">        &#125;,</span></span><br><span class=\"line\"><span class=\"string\">        &quot;title&quot;:&#123;</span></span><br><span class=\"line\"><span class=\"string\">          &quot;type&quot;:&quot;text&quot;,</span></span><br><span class=\"line\"><span class=\"string\">          &quot;analyzer&quot;:&quot;ik_max_word&quot;,</span></span><br><span class=\"line\"><span class=\"string\">          &quot;search_analyzer&quot;:&quot;ik_smart&quot;</span></span><br><span class=\"line\"><span class=\"string\">        &#125;,</span></span><br><span class=\"line\"><span class=\"string\">        &quot;remark&quot;:&#123;</span></span><br><span class=\"line\"><span class=\"string\">        &quot;type&quot;:&quot;text&quot;,</span></span><br><span class=\"line\"><span class=\"string\">        &quot;analyzer&quot;:&quot;ik_max_word&quot;,</span></span><br><span class=\"line\"><span class=\"string\">        &quot;search_analyzer&quot;:&quot;ik_smart&quot;</span></span><br><span class=\"line\"><span class=\"string\">      &#125;,</span></span><br><span class=\"line\"><span class=\"string\">      &quot;address&quot;: &#123;</span></span><br><span class=\"line\"><span class=\"string\">        &quot;type&quot;: &quot;text&quot;,</span></span><br><span class=\"line\"><span class=\"string\">        &quot;analyzer&quot;: &quot;ik_max_word&quot;,</span></span><br><span class=\"line\"><span class=\"string\">        &quot;fields&quot;: &#123;</span></span><br><span class=\"line\"><span class=\"string\">          &quot;keyword&quot;: &#123;</span></span><br><span class=\"line\"><span class=\"string\">            &quot;type&quot;: &quot;keyword&quot;</span></span><br><span class=\"line\"><span class=\"string\">          &#125;</span></span><br><span class=\"line\"><span class=\"string\">        &#125;</span></span><br><span class=\"line\"><span class=\"string\">      &#125;,</span></span><br><span class=\"line\"><span class=\"string\">      &quot;tags&quot;: &#123;</span></span><br><span class=\"line\"><span class=\"string\">        &quot;type&quot;: &quot;keyword&quot;</span></span><br><span class=\"line\"><span class=\"string\">      &#125;,</span></span><br><span class=\"line\"><span class=\"string\">      &quot;created_at&quot;: &#123;&quot;type&quot;: &quot;date&quot;, &quot;format&quot;: &quot;yyyy-MM-dd HH:mm:ss&quot;&#125;</span></span><br><span class=\"line\"><span class=\"string\">      &#125;</span></span><br><span class=\"line\"><span class=\"string\">    &#125;</span></span><br><span class=\"line\"><span class=\"string\">  &#125;&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ’å…¥æ•°æ®</span></span><br><span class=\"line\">curl -X POST -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/_bulk&#x27;</span> \\</span><br><span class=\"line\">  -H <span class=\"string\">&#x27;Content-Type: application/json&#x27;</span> \\</span><br><span class=\"line\">  -d <span class=\"string\">&#x27;&#123; &quot;index&quot;: &#123; &quot;_index&quot;: &quot;shopping&quot;, &quot;_id&quot;: &quot;1&quot; &#125; &#125;</span></span><br><span class=\"line\"><span class=\"string\">&#123; &quot;category&quot;: &quot;electronics&quot;, &quot;price&quot;: 999.99, &quot;count&quot;: 10, &quot;title&quot;: &quot;Smartphone X - 128GB&quot;, &quot;remark&quot;: &quot;This latest Smartphone X comes with a powerful processor and high-resolution camera.&quot;, &quot;address&quot;: &quot;å¹¿å·å¤©æ²³å…¬å›­&quot;, &quot;tags&quot;: [&quot;latest&quot;, &quot;smartphone&quot;, &quot;technology&quot;], &quot;created_at&quot;: &quot;2025-04-22 03:30:02&quot; &#125;</span></span><br><span class=\"line\"><span class=\"string\">&#123; &quot;index&quot;: &#123; &quot;_index&quot;: &quot;shopping&quot;, &quot;_id&quot;: &quot;2&quot; &#125; &#125;</span></span><br><span class=\"line\"><span class=\"string\">&#123; &quot;category&quot;: &quot;fashion&quot;, &quot;price&quot;: 49.99, &quot;count&quot;: 25, &quot;title&quot;: &quot;Designer T-shirt&quot;, &quot;remark&quot;: &quot;Trendy designer T-shirt made with high quality fabric.&quot;, &quot;address&quot;: &quot;å¹¿å·è”æ¹¾å¤§å¦&quot;, &quot;tags&quot;: [&quot;clothing&quot;, &quot;designer&quot;, &quot;style&quot;], &quot;created_at&quot;: &quot;2025-04-21 12:15:00&quot; &#125;</span></span><br><span class=\"line\"><span class=\"string\">&#123; &quot;index&quot;: &#123; &quot;_index&quot;: &quot;shopping&quot;, &quot;_id&quot;: &quot;3&quot; &#125; &#125;</span></span><br><span class=\"line\"><span class=\"string\">&#123; &quot;category&quot;: &quot;home_appliances&quot;, &quot;price&quot;: 299.99, &quot;count&quot;: 5, &quot;title&quot;: &quot;Robot Vacuum Cleaner&quot;, &quot;remark&quot;: &quot;Efficient robot vacuum cleaner with smart navigation.&quot;, &quot;address&quot;: &quot;å¹¿å·ç™½äº‘å±±å…¬å›­&quot;, &quot;tags&quot;: [&quot;appliances&quot;, &quot;vacuum&quot;, &quot;robot&quot;], &quot;created_at&quot;: &quot;2025-04-20 08:45:30&quot; &#125;</span></span><br><span class=\"line\"><span class=\"string\">&#123; &quot;index&quot;: &#123; &quot;_index&quot;: &quot;shopping&quot;, &quot;_id&quot;: &quot;4&quot; &#125; &#125;</span></span><br><span class=\"line\"><span class=\"string\">&#123; &quot;category&quot;: &quot;books&quot;, &quot;price&quot;: 19.99, &quot;count&quot;: 100, &quot;title&quot;: &quot;Inspirational Novel&quot;, &quot;remark&quot;: &quot;A gripping novel that inspires and motivates.&quot;, &quot;address&quot;: &quot;321 Book Rd, Shenzhen, China&quot;, &quot;tags&quot;: [&quot;book&quot;, &quot;novel&quot;, &quot;inspiration&quot;], &quot;created_at&quot;: &quot;2025-04-19 10:05:00&quot; &#125;</span></span><br><span class=\"line\"><span class=\"string\">&#123; &quot;index&quot;: &#123; &quot;_index&quot;: &quot;shopping&quot;, &quot;_id&quot;: &quot;5&quot; &#125; &#125;</span></span><br><span class=\"line\"><span class=\"string\">&#123; &quot;category&quot;: &quot;groceries&quot;, &quot;price&quot;: 3.99, &quot;count&quot;: 200, &quot;title&quot;: &quot;Organic Apples&quot;, &quot;remark&quot;: &quot;Fresh and crispy organic apples.&quot;, &quot;address&quot;: &quot;654 Grocery Ln, Chengdu, China&quot;, &quot;tags&quot;: [&quot;fruit&quot;, &quot;organic&quot;, &quot;healthy&quot;], &quot;created_at&quot;: &quot;2025-04-18 14:30:45&quot; &#125;</span></span><br><span class=\"line\"><span class=\"string\">&#123; &quot;index&quot;: &#123; &quot;_index&quot;: &quot;shopping&quot;, &quot;_id&quot;: &quot;6&quot; &#125; &#125;</span></span><br><span class=\"line\"><span class=\"string\">&#123; &quot;category&quot;: &quot;electronics&quot;, &quot;price&quot;: 1999.99, &quot;count&quot;: 15, &quot;title&quot;: &quot;Smartphone X - 256GB&quot;, &quot;remark&quot;: &quot;This latest Smartphone X comes with a powerful processor and high-resolution camera.&quot;, &quot;address&quot;: &quot;å¹¿å·å¤©æ²³å…¬å›­&quot;, &quot;tags&quot;: [&quot;latest&quot;, &quot;smartphone&quot;, &quot;technology&quot;], &quot;created_at&quot;: &quot;2025-04-22 03:30:02&quot; &#125;</span></span><br><span class=\"line\"><span class=\"string\">&#x27;</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"Metric-Aggregation-æŒ‡æ ‡èšåˆ\">Metric Aggregation(æŒ‡æ ‡èšåˆ)</h2>\n<h3 id=\"å•å€¼åˆ†æï¸°åªè¾“å‡ºä¸€ä¸ªåˆ†æç»“æœ\">å•å€¼åˆ†æï¸°åªè¾“å‡ºä¸€ä¸ªåˆ†æç»“æœ</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>min, max, avg, sum</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æœ€å¤§å€¼ã€æœ€å°å€¼ã€å¹³å‡å€¼ã€æ€»å’Œ</span></span><br><span class=\"line\">GET /shopping/_search</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">&quot;size&quot;</span>: 0,  <span class=\"comment\"># ä¸è¿”å›æ–‡æ¡£ï¼Œåªè¿”å›èšåˆç»“æœ</span></span><br><span class=\"line\">  <span class=\"string\">&quot;aggs&quot;</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;max_price&quot;</span>: &#123; <span class=\"comment\"># è‡ªå®šä¹‰åç§°ï¼Œè¿™é‡Œè¿”å›æœ€å¤§å€¼</span></span><br><span class=\"line\">      <span class=\"string\">&quot;max&quot;</span>: &#123;     <span class=\"comment\"># æŒ‡æ ‡èšåˆå‡½æ•°åç§°</span></span><br><span class=\"line\">        <span class=\"string\">&quot;field&quot;</span>: <span class=\"string\">&quot;price&quot;</span> <span class=\"comment\"># æŒ‡æ ‡èšåˆå­—æ®µ</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"string\">&quot;min_price&quot;</span>: &#123;</span><br><span class=\"line\">      <span class=\"string\">&quot;min&quot;</span>: &#123;</span><br><span class=\"line\">        <span class=\"string\">&quot;field&quot;</span>: <span class=\"string\">&quot;price&quot;</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"string\">&quot;avg_price&quot;</span>: &#123;</span><br><span class=\"line\">      <span class=\"string\">&quot;avg&quot;</span>: &#123;</span><br><span class=\"line\">        <span class=\"string\">&quot;field&quot;</span>: <span class=\"string\">&quot;price&quot;</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"string\">&quot;sum_price&quot;</span>: &#123;</span><br><span class=\"line\">      <span class=\"string\">&quot;sum&quot;</span>: &#123;</span><br><span class=\"line\">        <span class=\"string\">&quot;field&quot;</span>: <span class=\"string\">&quot;price&quot;</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Cardinalityï¼ˆç±»ä¼¼distinct Count)</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">GET /shopping/_search</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">&quot;size&quot;</span>: 0, <span class=\"comment\"># ä¸è¿”å›æ–‡æ¡£ï¼Œåªè¿”å›èšåˆç»“æœ</span></span><br><span class=\"line\">  <span class=\"string\">&quot;aggs&quot;</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;cardinality_count&quot;</span>: &#123; <span class=\"comment\"># è‡ªå®šä¹‰åç§°ï¼Œè¿”å›å»é‡åçš„æ•°é‡</span></span><br><span class=\"line\">      <span class=\"string\">&quot;cardinality&quot;</span>: &#123;  <span class=\"comment\"># æŒ‡æ ‡èšåˆå‡½æ•°åç§°ï¼Œcardinalityè¡¨ç¤ºå»é‡</span></span><br><span class=\"line\">        <span class=\"string\">&quot;field&quot;</span>: <span class=\"string\">&quot;category&quot;</span> <span class=\"comment\"># æŒ‡æ ‡èšåˆå­—æ®µï¼Œå»é‡çš„å­—æ®µ</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"å¤šå€¼åˆ†æ-è¾“å‡ºå¤šä¸ªåˆ†æç»“æœ\">å¤šå€¼åˆ†æ:è¾“å‡ºå¤šä¸ªåˆ†æç»“æœ</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>statsï¼ˆç»Ÿè®¡ï¼‰, extended stats</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">GET /shopping/_search</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">&quot;size&quot;</span>: 0,</span><br><span class=\"line\">  <span class=\"string\">&quot;aggs&quot;</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;stats_price&quot;</span>: &#123;</span><br><span class=\"line\">      <span class=\"string\">&quot;stats&quot;</span>: &#123; <span class=\"comment\"># æŒ‡æ ‡èšåˆå‡½æ•°åç§°ï¼Œstatsè¡¨ç¤ºç»Ÿè®¡ï¼Œä¼šè¿”å›å¤šä¸ªæŒ‡æ ‡</span></span><br><span class=\"line\">        <span class=\"string\">&quot;field&quot;</span>: <span class=\"string\">&quot;price&quot;</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\"># ç»“æœ</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">&quot;took&quot;</span>: 15,</span><br><span class=\"line\">  <span class=\"string\">&quot;timed_out&quot;</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;_shards&quot;</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;total&quot;</span>: 1,</span><br><span class=\"line\">    <span class=\"string\">&quot;successful&quot;</span>: 1,</span><br><span class=\"line\">    <span class=\"string\">&quot;skipped&quot;</span>: 0,</span><br><span class=\"line\">    <span class=\"string\">&quot;failed&quot;</span>: 0</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"string\">&quot;hits&quot;</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;total&quot;</span>: &#123;</span><br><span class=\"line\">      <span class=\"string\">&quot;value&quot;</span>: 12,</span><br><span class=\"line\">      <span class=\"string\">&quot;relation&quot;</span>: <span class=\"string\">&quot;eq&quot;</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"string\">&quot;max_score&quot;</span>: null,</span><br><span class=\"line\">    <span class=\"string\">&quot;hits&quot;</span>: []     <span class=\"comment\"># å› ä¸ºè®¾ç½®size ä¸º 0ï¼Œæ‰€ä»¥è¿”å›çš„ç»“æœä¸ºç©º</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"string\">&quot;aggregations&quot;</span>: &#123; <span class=\"comment\"># èšåˆç»“æœ</span></span><br><span class=\"line\">    <span class=\"string\">&quot;stats_price&quot;</span>: &#123; <span class=\"comment\"># è‡ªå®šä¹‰åç§°ï¼Œè¿”å›å¤šç»„èšåˆç»“æœ</span></span><br><span class=\"line\">      <span class=\"string\">&quot;count&quot;</span>: 12,</span><br><span class=\"line\">      <span class=\"string\">&quot;min&quot;</span>: 3.99,</span><br><span class=\"line\">      <span class=\"string\">&quot;max&quot;</span>: 1999.99,</span><br><span class=\"line\">      <span class=\"string\">&quot;avg&quot;</span>: 562.1666666666666,</span><br><span class=\"line\">      <span class=\"string\">&quot;sum&quot;</span>: 6746</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>percentile ï¼ˆç™¾åˆ†ä½ï¼‰, percentile rank</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">GET /shopping/_search</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">&quot;size&quot;</span>: 0,</span><br><span class=\"line\">  <span class=\"string\">&quot;aggs&quot;</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;percentile_price&quot;</span>: &#123;</span><br><span class=\"line\">      <span class=\"string\">&quot;percentiles&quot;</span>: &#123; <span class=\"comment\"># æŒ‡æ ‡èšåˆå‡½æ•°åç§°ï¼Œpercentilesè¡¨ç¤ºç™¾åˆ†ä½æ•°èšåˆè®¡ç®—</span></span><br><span class=\"line\">        <span class=\"string\">&quot;field&quot;</span>: <span class=\"string\">&quot;price&quot;</span>, <span class=\"comment\"># æŒ‡æ ‡èšåˆå­—æ®µ</span></span><br><span class=\"line\">        <span class=\"string\">&quot;percents&quot;</span>: [1, 5, 25, 50, 75, 95, 99] <span class=\"comment\"># éœ€è¦è®¡ç®—ç™¾åˆ†ä½æ•°çš„æ•°ç»„</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\"># ç™¾åˆ†ä½æ•°æ˜¯ä¸€ä¸ªç»Ÿè®¡å­¦æ¦‚å¿µï¼Œç”¨äºæè¿°ä¸€ä¸ªç»™å®šé›†åˆçš„æ’åºå€¼ã€‚ä¾‹å¦‚ï¼š</span></span><br><span class=\"line\"><span class=\"comment\"># ç¬¬ 1 ç™¾åˆ†ä½æ•°è¡¨ç¤ºæ•°æ®ä¸­å°äºè¿™ä¸ªå€¼çš„æ‰€æœ‰æ•°æ®å æ€»æ•°çš„ 1%ã€‚</span></span><br><span class=\"line\"><span class=\"comment\"># ç¬¬ 50 ç™¾åˆ†ä½æ•°ï¼ˆä¸­ä½æ•°ï¼‰è¡¨ç¤ºæ•°æ®ä¸­çš„ä¸€åŠå°äºè¿™ä¸ªå€¼ï¼Œå¦ä¸€åŠå¤§äºè¿™ä¸ªå€¼ã€‚</span></span><br><span class=\"line\"><span class=\"comment\"># ç¬¬ 99 ç™¾åˆ†ä½æ•°è¡¨ç¤ºæ•°æ®ä¸­å°äºè¿™ä¸ªå€¼çš„æ‰€æœ‰æ•°æ®å æ€»æ•°çš„ 99%ã€‚</span></span><br><span class=\"line\"><span class=\"comment\"># é€šè¿‡è®¡ç®—è¿™äº›ç™¾åˆ†ä½æ•°ï¼Œä½ å¯ä»¥äº†è§£ price å­—æ®µåœ¨æ•´ä¸ªshoppingç´¢å¼•ä¸­çš„åˆ†å¸ƒæƒ…å†µï¼Œä»è€Œå¯ä»¥ç”¨äºæ•°æ®åˆ†æã€è¶‹åŠ¿åˆ¤æ–­ç­‰ã€‚</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>top hits(æ’åœ¨å‰é¢çš„ç¤ºä¾‹)</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">GET /shopping/_search</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">&quot;size&quot;</span>: 0,</span><br><span class=\"line\">  <span class=\"string\">&quot;aggs&quot;</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;top_hits&quot;</span>: &#123; <span class=\"comment\"># è‡ªå®šä¹‰åç§°ï¼Œè¿”å›æ’åœ¨å‰é¢çš„ç¤ºä¾‹</span></span><br><span class=\"line\">      <span class=\"string\">&quot;top_hits&quot;</span>: &#123; <span class=\"comment\"># æŒ‡æ ‡èšåˆå‡½æ•°åç§°ï¼Œtop_hitsè¡¨ç¤ºè¿”å›æ’åœ¨å‰é¢çš„ç¤ºä¾‹</span></span><br><span class=\"line\">        <span class=\"string\">&quot;sort&quot;</span>: [&#123;<span class=\"string\">&quot;price&quot;</span>: &#123;<span class=\"string\">&quot;order&quot;</span>: <span class=\"string\">&quot;desc&quot;</span>&#125;&#125;], <span class=\"comment\"># æ’åºï¼ŒæŒ‰ç…§priceå­—æ®µé™åºæ’åº</span></span><br><span class=\"line\">        <span class=\"string\">&quot;size&quot;</span>: 3 <span class=\"comment\"># åªè¿”å›å‰3ä¸ª</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"Bucket-Aggregation-æ¡¶èšåˆ\">Bucket Aggregation(æ¡¶èšåˆ)</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æŒ‰ç…§ä¸€å®šçš„è§„åˆ™ï¼Œå°†æ–‡æ¡£åˆ†é…åˆ°ä¸åŒçš„æ¡¶ä¸­ï¼Œä»è€Œè¾¾åˆ°åˆ†ç±»çš„ç›®çš„ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ESæä¾›çš„ä¸€äº›å¸¸è§çš„ Bucket Aggregationã€‚</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">termsï¼ˆè¯æ¡ï¼‰, rangeï¼ˆèŒƒå›´ï¼‰, date_rangeï¼ˆæ—¥æœŸèŒƒå›´ï¼‰, ip_rangeï¼ˆIPèŒƒå›´ï¼‰, missingï¼ˆç¼ºå¤±ï¼‰, histogramï¼ˆç›´æ–¹å›¾ï¼‰, date_histogramï¼ˆæ—¥æœŸç›´æ–¹å›¾ï¼‰, geo_distanceï¼ˆåœ°ç†è·ç¦»ï¼‰, significant_termsï¼ˆé‡è¦è¯æ¡ï¼‰, compositeï¼ˆç»„åˆï¼‰</li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<p>æ¡¶èšåˆå¯ä»¥ç”¨äºå„ç§åœºæ™¯ï¼Œä¾‹å¦‚ï¼š</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">å¯¹æ•°æ®è¿›è¡Œåˆ†ç»„ç»Ÿè®¡ï¼Œæ¯”å¦‚æŒ‰ç…§åœ°åŒºã€å¹´é¾„æ®µã€æ€§åˆ«ç­‰å­—æ®µè¿›è¡Œåˆ†ç»„ç»Ÿè®¡ã€‚</li>\n<li class=\"lvl-4\">å¯¹æ—¶é—´åºåˆ—æ•°æ®è¿›è¡Œæ—¶é—´æ®µåˆ†æï¼Œæ¯”å¦‚æŒ‰ç…§æ¯å°æ—¶ã€æ¯å¤©ã€æ¯æœˆã€æ¯å­£åº¦ã€æ¯å¹´ç­‰æ—¶é—´æ®µè¿›è¡Œåˆ†æã€‚</li>\n<li class=\"lvl-4\">å¯¹å„ç§æ ‡ç­¾ä¿¡æ¯åˆ†ç±»ï¼Œå¹¶ç»Ÿè®¡å…¶æ•°é‡ã€‚</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"termsï¼ˆè¯æ¡ï¼‰\">termsï¼ˆè¯æ¡ï¼‰</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æŒ‰ç…§å­—æ®µçš„å€¼è¿›è¡Œåˆ†ç»„ï¼Œå¹¶ç»Ÿè®¡æ¯ä¸ªç»„çš„æ•°é‡ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ç¤ºä¾‹ï¼šæŒ‰ç…§categoryå­—æ®µè¿›è¡Œåˆ†ç»„ï¼Œå¹¶ç»Ÿè®¡æ¯ä¸ªç»„çš„æ•°é‡ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">GET /shopping/_search</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">&quot;size&quot;</span>: 0,</span><br><span class=\"line\">  <span class=\"string\">&quot;aggs&quot;</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;category_count&quot;</span>: &#123; <span class=\"comment\"># è‡ªå®šä¹‰åç§°ï¼Œè¿”å›æ¯ä¸ªç»„çš„æ•°é‡</span></span><br><span class=\"line\">      <span class=\"string\">&quot;terms&quot;</span>: &#123; <span class=\"comment\"># æ¡¶èšåˆå‡½æ•°åç§°ï¼Œtermsè¡¨ç¤ºæŒ‰ç…§å­—æ®µçš„å€¼è¿›è¡Œåˆ†ç»„</span></span><br><span class=\"line\">        <span class=\"string\">&quot;field&quot;</span>: <span class=\"string\">&quot;category&quot;</span>, <span class=\"comment\"># æŒ‰ç…§categoryå­—æ®µè¿›è¡Œåˆ†ç»„ï¼Œæ³¨æ„ä¸èƒ½æ˜¯textç±»å‹ï¼Œå¦åˆ™ä¼šæŠ¥é”™</span></span><br><span class=\"line\">        <span class=\"string\">&quot;size&quot;</span>: 10, <span class=\"comment\"># åªè¿”å›å‰10ä¸ªï¼Œé»˜è®¤æ˜¯10</span></span><br><span class=\"line\">        <span class=\"string\">&quot;order&quot;</span>: &#123;<span class=\"string\">&quot;_count&quot;</span>: <span class=\"string\">&quot;desc&quot;</span>&#125; <span class=\"comment\"># æŒ‰ç…§æ•°é‡é™åºæ’åºï¼Œé»˜è®¤æ˜¯descï¼ŒBucketèšåˆä¼šç»Ÿè®¡Bucketå†…çš„æ–‡æ¡£æ•°é‡ï¼Œè®°ä¸º_countï¼Œå¹¶ä¸”æŒ‰ç…§_counté™åºæ’åº</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ç»“æœ</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">&quot;took&quot;</span>: 15,</span><br><span class=\"line\">  <span class=\"string\">&quot;timed_out&quot;</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;_shards&quot;</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;total&quot;</span>: 1,</span><br><span class=\"line\">    <span class=\"string\">&quot;successful&quot;</span>: 1,</span><br><span class=\"line\">    <span class=\"string\">&quot;skipped&quot;</span>: 0,</span><br><span class=\"line\">    <span class=\"string\">&quot;failed&quot;</span>: 0</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"string\">&quot;hits&quot;</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;total&quot;</span>: &#123;</span><br><span class=\"line\">      <span class=\"string\">&quot;value&quot;</span>: 12,</span><br><span class=\"line\">      <span class=\"string\">&quot;relation&quot;</span>: <span class=\"string\">&quot;eq&quot;</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"string\">&quot;max_score&quot;</span>: null,</span><br><span class=\"line\">    <span class=\"string\">&quot;hits&quot;</span>: []</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"string\">&quot;aggregations&quot;</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;category_count&quot;</span>: &#123;</span><br><span class=\"line\">      <span class=\"string\">&quot;doc_count_error_upper_bound&quot;</span>: 0,  <span class=\"comment\"># é”™è¯¯ä¸Šç•Œï¼Œè¡¨ç¤ºåœ¨èšåˆè¿‡ç¨‹ä¸­å¯èƒ½å­˜åœ¨ä¸€äº›é”™è¯¯ï¼Œä½†é”™è¯¯æ•°é‡ä¸ä¼šè¶…è¿‡è¿™ä¸ªå€¼</span></span><br><span class=\"line\">      <span class=\"string\">&quot;sum_other_doc_count&quot;</span>: 0,         <span class=\"comment\"># è¡¨ç¤ºåœ¨èšåˆè¿‡ç¨‹ä¸­ï¼Œé™¤äº†è¿”å›çš„10ä¸ªbucketï¼Œè¿˜æœ‰å…¶ä»–æ•°é‡ï¼Œè¿™ä¸ªæ•°é‡å°±æ˜¯sum_other_doc_count</span></span><br><span class=\"line\">      <span class=\"string\">&quot;buckets&quot;</span>: [                     <span class=\"comment\"># è¿”å›çš„bucket</span></span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"string\">&quot;key&quot;</span>: <span class=\"string\">&quot;electronics&quot;</span>,          <span class=\"comment\"># åˆ†ç»„çš„key</span></span><br><span class=\"line\">          <span class=\"string\">&quot;doc_count&quot;</span>: 4                 <span class=\"comment\"># åˆ†ç»„çš„æ•°é‡</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"string\">&quot;key&quot;</span>: <span class=\"string\">&quot;books&quot;</span>,</span><br><span class=\"line\">          <span class=\"string\">&quot;doc_count&quot;</span>: 2</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"string\">&quot;key&quot;</span>: <span class=\"string\">&quot;fashion&quot;</span>,</span><br><span class=\"line\">          <span class=\"string\">&quot;doc_count&quot;</span>: 2</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"string\">&quot;key&quot;</span>: <span class=\"string\">&quot;groceries&quot;</span>,</span><br><span class=\"line\">          <span class=\"string\">&quot;doc_count&quot;</span>: 2</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"string\">&quot;key&quot;</span>: <span class=\"string\">&quot;home_appliances&quot;</span>,</span><br><span class=\"line\">          <span class=\"string\">&quot;doc_count&quot;</span>: 2</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      ]</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>é™å®šèšåˆèŒƒå›´</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">GET /shopping/_search</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">&quot;query&quot;</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;range&quot;</span>: &#123;</span><br><span class=\"line\">      <span class=\"string\">&quot;price&quot;</span>: &#123;</span><br><span class=\"line\">        <span class=\"string\">&quot;gte&quot;</span>: 100 <span class=\"comment\"># é™å®šä»·æ ¼èŒƒå›´</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"string\">&quot;size&quot;</span>: 0,</span><br><span class=\"line\">  <span class=\"string\">&quot;aggs&quot;</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;category_count&quot;</span>: &#123; <span class=\"comment\"># è‡ªå®šä¹‰åç§°ï¼Œè¿”å›æ¯ä¸ªç»„çš„æ•°é‡</span></span><br><span class=\"line\">      <span class=\"string\">&quot;terms&quot;</span>: &#123; <span class=\"comment\"># æ¡¶èšåˆå‡½æ•°åç§°ï¼Œtermsè¡¨ç¤ºæŒ‰ç…§å­—æ®µçš„å€¼è¿›è¡Œåˆ†ç»„</span></span><br><span class=\"line\">        <span class=\"string\">&quot;field&quot;</span>: <span class=\"string\">&quot;category&quot;</span>, <span class=\"comment\"># æŒ‰ç…§categoryå­—æ®µè¿›è¡Œåˆ†ç»„</span></span><br><span class=\"line\">        <span class=\"string\">&quot;size&quot;</span>: 10, <span class=\"comment\"># åªè¿”å›å‰10ä¸ªï¼Œé»˜è®¤æ˜¯10</span></span><br><span class=\"line\">        <span class=\"string\">&quot;order&quot;</span>: &#123;<span class=\"string\">&quot;_count&quot;</span>: <span class=\"string\">&quot;desc&quot;</span>&#125; <span class=\"comment\"># æŒ‰ç…§æ•°é‡é™åºæ’åºï¼Œé»˜è®¤æ˜¯descï¼ŒBucketèšåˆä¼šç»Ÿè®¡Bucketå†…çš„æ–‡æ¡£æ•°é‡ï¼Œè®°ä¸º_countï¼Œå¹¶ä¸”æŒ‰ç…§_counté™åºæ’åº</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"rangeï¼ˆèŒƒå›´ï¼‰\">rangeï¼ˆèŒƒå›´ï¼‰</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æŒ‰ç…§å­—æ®µçš„å€¼è¿›è¡Œåˆ†ç»„ï¼Œå¹¶ç»Ÿè®¡æ¯ä¸ªç»„çš„æ•°é‡ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ç¤ºä¾‹ï¼šæŒ‰ç…§ä»·æ ¼èŒƒå›´è¿›è¡Œåˆ†ç»„ï¼Œå¹¶ç»Ÿè®¡æ¯ä¸ªç»„çš„æ•°é‡ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">GET /shopping/_search</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">&quot;size&quot;</span>: 0,</span><br><span class=\"line\">  <span class=\"string\">&quot;aggs&quot;</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;price_range&quot;</span>: &#123; <span class=\"comment\"># è‡ªå®šä¹‰åç§°ï¼Œè¿”å›æ¯ä¸ªç»„çš„æ•°é‡</span></span><br><span class=\"line\">      <span class=\"string\">&quot;range&quot;</span>: &#123; <span class=\"comment\"># æ¡¶èšåˆå‡½æ•°åç§°ï¼Œrangeè¡¨ç¤ºæŒ‰ç…§å­—æ®µçš„å€¼è¿›è¡Œåˆ†ç»„</span></span><br><span class=\"line\">        <span class=\"string\">&quot;field&quot;</span>: <span class=\"string\">&quot;price&quot;</span>, <span class=\"comment\"># æŒ‰ç…§priceå­—æ®µè¿›è¡Œåˆ†ç»„</span></span><br><span class=\"line\">        <span class=\"string\">&quot;ranges&quot;</span>: [</span><br><span class=\"line\">          &#123;<span class=\"string\">&quot;to&quot;</span>: 100&#125;, <span class=\"comment\"># å°äº100</span></span><br><span class=\"line\">          &#123;<span class=\"string\">&quot;from&quot;</span>: 100, <span class=\"string\">&quot;to&quot;</span>: 200&#125;, <span class=\"comment\"># 100-200ï¼ŒåŒ…æ‹¬100ï¼Œä¸åŒ…æ‹¬200</span></span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            <span class=\"string\">&quot;key&quot;</span>:<span class=\"string\">&quot;&gt;=200&quot;</span>, <span class=\"comment\"># è®¾å®šé”®å€¼ï¼Œç”¨äºåŒºåˆ†ä¸åŒèŒƒå›´</span></span><br><span class=\"line\">            <span class=\"string\">&quot;from&quot;</span>:200 <span class=\"comment\"># å¤§äºç­‰äº200</span></span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        ]</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\"># ç»“æœ</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">&quot;took&quot;</span>: 5,</span><br><span class=\"line\">  <span class=\"string\">&quot;timed_out&quot;</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;_shards&quot;</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;total&quot;</span>: 1,</span><br><span class=\"line\">    <span class=\"string\">&quot;successful&quot;</span>: 1,</span><br><span class=\"line\">    <span class=\"string\">&quot;skipped&quot;</span>: 0,</span><br><span class=\"line\">    <span class=\"string\">&quot;failed&quot;</span>: 0</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"string\">&quot;hits&quot;</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;total&quot;</span>: &#123;</span><br><span class=\"line\">      <span class=\"string\">&quot;value&quot;</span>: 12,</span><br><span class=\"line\">      <span class=\"string\">&quot;relation&quot;</span>: <span class=\"string\">&quot;eq&quot;</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"string\">&quot;max_score&quot;</span>: null,</span><br><span class=\"line\">    <span class=\"string\">&quot;hits&quot;</span>: []</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"string\">&quot;aggregations&quot;</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;price_range&quot;</span>: &#123;</span><br><span class=\"line\">      <span class=\"string\">&quot;buckets&quot;</span>: [</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"string\">&quot;key&quot;</span>: <span class=\"string\">&quot;*-100.0&quot;</span>,</span><br><span class=\"line\">          <span class=\"string\">&quot;to&quot;</span>: 100,</span><br><span class=\"line\">          <span class=\"string\">&quot;doc_count&quot;</span>: 6</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"string\">&quot;key&quot;</span>: <span class=\"string\">&quot;100.0-200.0&quot;</span>,</span><br><span class=\"line\">          <span class=\"string\">&quot;from&quot;</span>: 100,</span><br><span class=\"line\">          <span class=\"string\">&quot;to&quot;</span>: 200,</span><br><span class=\"line\">          <span class=\"string\">&quot;doc_count&quot;</span>: 0</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"string\">&quot;key&quot;</span>: <span class=\"string\">&quot;&gt;=200&quot;</span>,</span><br><span class=\"line\">          <span class=\"string\">&quot;from&quot;</span>: 200,</span><br><span class=\"line\">          <span class=\"string\">&quot;doc_count&quot;</span>: 6</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      ]</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"date-rangeï¼ˆæ—¥æœŸèŒƒå›´ï¼‰\">date_rangeï¼ˆæ—¥æœŸèŒƒå›´ï¼‰</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æŒ‰ç…§å­—æ®µçš„å€¼è¿›è¡Œåˆ†ç»„ï¼Œå¹¶ç»Ÿè®¡æ¯ä¸ªç»„çš„æ•°é‡ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ç¤ºä¾‹ï¼šæŒ‰ç…§æ—¥æœŸèŒƒå›´è¿›è¡Œåˆ†ç»„ï¼Œå¹¶ç»Ÿè®¡æ¯ä¸ªç»„çš„æ•°é‡ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">GET /shopping/_search</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">&quot;size&quot;</span>: 0,</span><br><span class=\"line\">  <span class=\"string\">&quot;aggs&quot;</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;date_range&quot;</span>: &#123;</span><br><span class=\"line\">      <span class=\"string\">&quot;date_range&quot;</span>: &#123;</span><br><span class=\"line\">        <span class=\"string\">&quot;field&quot;</span>: <span class=\"string\">&quot;created_at&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;ranges&quot;</span>: [</span><br><span class=\"line\">          &#123;<span class=\"string\">&quot;to&quot;</span>: <span class=\"string\">&quot;now-3d&quot;</span>&#125;, <span class=\"comment\"># å°äºå½“å‰æ—¶é—´å‡å»3å¤©</span></span><br><span class=\"line\">          &#123;<span class=\"string\">&quot;from&quot;</span>: <span class=\"string\">&quot;now-3d&quot;</span>,<span class=\"string\">&quot;to&quot;</span>: <span class=\"string\">&quot;now-1d&quot;</span>&#125;, <span class=\"comment\"># å¤§äºå½“å‰æ—¶é—´å‡å»3å¤©ï¼ˆåŒ…å«ï¼‰ï¼Œå°äºå½“å‰æ—¶é—´å‡å»1å¤©</span></span><br><span class=\"line\">          &#123;<span class=\"string\">&quot;key&quot;</span>:<span class=\"string\">&quot;now-1d&quot;</span>,<span class=\"string\">&quot;from&quot;</span>: <span class=\"string\">&quot;now-1d&quot;</span>&#125; <span class=\"comment\"># å¤§äºå½“å‰æ—¶é—´å‡å»1å¤©ï¼ˆåŒ…å«ï¼‰ï¼Œå¹¶è®¾ç½®é”®å€¼</span></span><br><span class=\"line\">        ]</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\"># ç»“æœ</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">&quot;took&quot;</span>: 3,</span><br><span class=\"line\">  <span class=\"string\">&quot;timed_out&quot;</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;_shards&quot;</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;total&quot;</span>: 1,</span><br><span class=\"line\">    <span class=\"string\">&quot;successful&quot;</span>: 1,</span><br><span class=\"line\">    <span class=\"string\">&quot;skipped&quot;</span>: 0,</span><br><span class=\"line\">    <span class=\"string\">&quot;failed&quot;</span>: 0</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"string\">&quot;hits&quot;</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;total&quot;</span>: &#123;</span><br><span class=\"line\">      <span class=\"string\">&quot;value&quot;</span>: 12,</span><br><span class=\"line\">      <span class=\"string\">&quot;relation&quot;</span>: <span class=\"string\">&quot;eq&quot;</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"string\">&quot;max_score&quot;</span>: null,</span><br><span class=\"line\">    <span class=\"string\">&quot;hits&quot;</span>: []</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"string\">&quot;aggregations&quot;</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;date_range&quot;</span>: &#123;</span><br><span class=\"line\">      <span class=\"string\">&quot;buckets&quot;</span>: [</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"string\">&quot;key&quot;</span>: <span class=\"string\">&quot;*-2025-04-20 03:14:17&quot;</span>,</span><br><span class=\"line\">          <span class=\"string\">&quot;to&quot;</span>: 1745118857610,</span><br><span class=\"line\">          <span class=\"string\">&quot;to_as_string&quot;</span>: <span class=\"string\">&quot;2025-04-20 03:14:17&quot;</span>,</span><br><span class=\"line\">          <span class=\"string\">&quot;doc_count&quot;</span>: 4</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"string\">&quot;key&quot;</span>: <span class=\"string\">&quot;2025-04-20 03:14:17-2025-04-22 03:14:17&quot;</span>,</span><br><span class=\"line\">          <span class=\"string\">&quot;from&quot;</span>: 1745118857610,</span><br><span class=\"line\">          <span class=\"string\">&quot;from_as_string&quot;</span>: <span class=\"string\">&quot;2025-04-20 03:14:17&quot;</span>,</span><br><span class=\"line\">          <span class=\"string\">&quot;to&quot;</span>: 1745291657610,</span><br><span class=\"line\">          <span class=\"string\">&quot;to_as_string&quot;</span>: <span class=\"string\">&quot;2025-04-22 03:14:17&quot;</span>,</span><br><span class=\"line\">          <span class=\"string\">&quot;doc_count&quot;</span>: 4</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"string\">&quot;key&quot;</span>: <span class=\"string\">&quot;now-1d&quot;</span>,</span><br><span class=\"line\">          <span class=\"string\">&quot;from&quot;</span>: 1745291657610,</span><br><span class=\"line\">          <span class=\"string\">&quot;from_as_string&quot;</span>: <span class=\"string\">&quot;2025-04-22 03:14:17&quot;</span>,</span><br><span class=\"line\">          <span class=\"string\">&quot;doc_count&quot;</span>: 4</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      ]</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ—¥æœŸæ ¼å¼</span></span><br><span class=\"line\">GET /shopping/_search</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">&quot;size&quot;</span>: 0,</span><br><span class=\"line\">  <span class=\"string\">&quot;aggs&quot;</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;date_range&quot;</span>: &#123;</span><br><span class=\"line\">      <span class=\"string\">&quot;date_range&quot;</span>: &#123;</span><br><span class=\"line\">        <span class=\"string\">&quot;field&quot;</span>: <span class=\"string\">&quot;created_at&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;ranges&quot;</span>: [</span><br><span class=\"line\">          &#123;<span class=\"string\">&quot;to&quot;</span>: <span class=\"string\">&quot;2025-04-20 00:00:00&quot;</span>&#125;, <span class=\"comment\"># æ³¨æ„è¿™é‡Œçš„æ ¼å¼å¿…é¡»ä¸å­—æ®µæ ¼å¼ä¸€è‡´</span></span><br><span class=\"line\">          &#123;<span class=\"string\">&quot;from&quot;</span>: <span class=\"string\">&quot;2025-04-20 00:00:00&quot;</span>,<span class=\"string\">&quot;to&quot;</span>: <span class=\"string\">&quot;2025-04-22 00:00:00&quot;</span>&#125;,</span><br><span class=\"line\">          &#123;<span class=\"string\">&quot;key&quot;</span>:<span class=\"string\">&quot;2025-04-22 00:00:00&quot;</span>,<span class=\"string\">&quot;from&quot;</span>: <span class=\"string\">&quot;2025-04-22 00:00:00&quot;</span>&#125;</span><br><span class=\"line\">        ]</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"histogramï¼ˆç›´æ–¹å›¾ï¼‰\">histogramï¼ˆç›´æ–¹å›¾ï¼‰</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æŒ‰ç…§é—´éš”è¿›è¡Œåˆ†ç»„ï¼Œå¹¶ç»Ÿè®¡æ¯ä¸ªç»„çš„æ•°é‡ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ç¤ºä¾‹ï¼šæŒ‰ç…§ä»·æ ¼çš„é—´éš”è¿›è¡Œåˆ†ç»„ï¼Œå¹¶ç»Ÿè®¡æ¯ä¸ªç»„çš„æ•°é‡ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">GET /shopping/_search</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">&quot;size&quot;</span>: 0,</span><br><span class=\"line\">  <span class=\"string\">&quot;aggs&quot;</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;price_histogram&quot;</span>: &#123;</span><br><span class=\"line\">      <span class=\"string\">&quot;histogram&quot;</span>: &#123;</span><br><span class=\"line\">        <span class=\"string\">&quot;field&quot;</span>: <span class=\"string\">&quot;price&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;interval&quot;</span>: 500, <span class=\"comment\"># é—´éš”500</span></span><br><span class=\"line\">        <span class=\"string\">&quot;extended_bounds&quot;</span>:&#123; <span class=\"comment\"># è®¾ç½®è¾¹ç•Œ</span></span><br><span class=\"line\">          <span class=\"string\">&quot;min&quot;</span>:0, <span class=\"comment\"># æœ€å°å€¼0</span></span><br><span class=\"line\">          <span class=\"string\">&quot;max&quot;</span>:2000 <span class=\"comment\"># æœ€å¤§å€¼2000</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\"># ç»“æœ</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">&quot;took&quot;</span>: 2,</span><br><span class=\"line\">  <span class=\"string\">&quot;timed_out&quot;</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;_shards&quot;</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;total&quot;</span>: 1,</span><br><span class=\"line\">    <span class=\"string\">&quot;successful&quot;</span>: 1,</span><br><span class=\"line\">    <span class=\"string\">&quot;skipped&quot;</span>: 0,</span><br><span class=\"line\">    <span class=\"string\">&quot;failed&quot;</span>: 0</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"string\">&quot;hits&quot;</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;total&quot;</span>: &#123;</span><br><span class=\"line\">      <span class=\"string\">&quot;value&quot;</span>: 12,</span><br><span class=\"line\">      <span class=\"string\">&quot;relation&quot;</span>: <span class=\"string\">&quot;eq&quot;</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"string\">&quot;max_score&quot;</span>: null,</span><br><span class=\"line\">    <span class=\"string\">&quot;hits&quot;</span>: []</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"string\">&quot;aggregations&quot;</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;price_histogram&quot;</span>: &#123;</span><br><span class=\"line\">      <span class=\"string\">&quot;buckets&quot;</span>: [</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"string\">&quot;key&quot;</span>: 0,</span><br><span class=\"line\">          <span class=\"string\">&quot;doc_count&quot;</span>: 8</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"string\">&quot;key&quot;</span>: 500,</span><br><span class=\"line\">          <span class=\"string\">&quot;doc_count&quot;</span>: 1</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"string\">&quot;key&quot;</span>: 1000,</span><br><span class=\"line\">          <span class=\"string\">&quot;doc_count&quot;</span>: 1</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"string\">&quot;key&quot;</span>: 1500,</span><br><span class=\"line\">          <span class=\"string\">&quot;doc_count&quot;</span>: 2</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"string\">&quot;key&quot;</span>: 2000,</span><br><span class=\"line\">          <span class=\"string\">&quot;doc_count&quot;</span>: 0</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      ]</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"top-hitsï¼ˆåˆ†æ¡¶å–å‰Næ¡ï¼‰\">top_hitsï¼ˆåˆ†æ¡¶å–å‰Næ¡ï¼‰</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æŒ‰ç…§å­—æ®µçš„å€¼è¿›è¡Œåˆ†ç»„ï¼Œå¹¶è¿”å›æ¯ä¸ªç»„çš„å‰Næ¡æ•°æ®ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ç¤ºä¾‹ï¼šæŒ‰ç…§categoryè¿›è¡Œåˆ†ç»„ï¼Œå¹¶è¿”å›æ¯ä¸ªç»„çš„å‰3æ¡æ•°æ®ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">GET /shopping/_search</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">&quot;size&quot;</span>: 0,</span><br><span class=\"line\">  <span class=\"string\">&quot;aggs&quot;</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;price_top_hits&quot;</span>: &#123; <span class=\"comment\"># è‡ªå®šä¹‰åç§°</span></span><br><span class=\"line\">      <span class=\"string\">&quot;terms&quot;</span>: &#123;</span><br><span class=\"line\">        <span class=\"string\">&quot;field&quot;</span>: <span class=\"string\">&quot;category&quot;</span>  <span class=\"comment\"># æŒ‰ç…§categoryå­—æ®µè¿›è¡Œåˆ†ç»„</span></span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      <span class=\"string\">&quot;aggs&quot;</span>: &#123;</span><br><span class=\"line\">        <span class=\"string\">&quot;top_hits&quot;</span>: &#123; <span class=\"comment\"># è‡ªå®šä¹‰åç§°</span></span><br><span class=\"line\">          <span class=\"string\">&quot;top_hits&quot;</span>: &#123; <span class=\"comment\"># è¿”å›æ¯ä¸ªç»„çš„å‰3æ¡æ•°æ®</span></span><br><span class=\"line\">            <span class=\"string\">&quot;size&quot;</span>: 3, <span class=\"comment\"># è¿”å›å‰3æ¡æ•°æ®</span></span><br><span class=\"line\">            <span class=\"string\">&quot;sort&quot;</span>: &#123; <span class=\"comment\"># æŒ‰ç…§created_atå­—æ®µè¿›è¡Œæ’åº</span></span><br><span class=\"line\">              <span class=\"string\">&quot;created_at&quot;</span>: &#123;</span><br><span class=\"line\">                <span class=\"string\">&quot;order&quot;</span>: <span class=\"string\">&quot;desc&quot;</span> <span class=\"comment\"># é™åº</span></span><br><span class=\"line\">              &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"å­èšåˆ\">å­èšåˆ</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å­èšåˆï¼šåœ¨èšåˆå‡½æ•°ä¸­ï¼Œè¿˜å¯ä»¥å†å®šä¹‰ä¸€ä¸ªèšåˆå‡½æ•°ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ç¤ºä¾‹ï¼šæŒ‰ç…§categoryè¿›è¡Œåˆ†ç»„ï¼Œå¹¶ç»Ÿè®¡ä»·æ ¼ä¿¡æ¯</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">GET /shopping/_search</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">&quot;size&quot;</span>: 0,</span><br><span class=\"line\">  <span class=\"string\">&quot;aggs&quot;</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;category_buckets&quot;</span>: &#123; <span class=\"comment\"># è‡ªå®šä¹‰åç§°</span></span><br><span class=\"line\">      <span class=\"string\">&quot;terms&quot;</span>: &#123;</span><br><span class=\"line\">        <span class=\"string\">&quot;field&quot;</span>: <span class=\"string\">&quot;category&quot;</span>  <span class=\"comment\"># æŒ‰ç…§categoryå­—æ®µè¿›è¡Œåˆ†ç»„</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"string\">&quot;aggs&quot;</span>: &#123; <span class=\"comment\"># å®šä¹‰å­èšåˆ</span></span><br><span class=\"line\">        <span class=\"string\">&quot;price_stats&quot;</span>: &#123;</span><br><span class=\"line\">          <span class=\"string\">&quot;stats&quot;</span>: &#123; <span class=\"comment\"># ç»Ÿè®¡ä»·æ ¼ä¿¡æ¯</span></span><br><span class=\"line\">            <span class=\"string\">&quot;field&quot;</span>: <span class=\"string\">&quot;price&quot;</span></span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å¤šå±‚åµŒå¥—</span></span><br><span class=\"line\"><span class=\"comment\"># å…ˆæŒ‰ç…§categoryè¿›è¡Œåˆ†ç»„ï¼Œå†æŒ‰ç…§addressè¿›è¡Œåˆ†ç»„ï¼Œå¹¶ç»Ÿè®¡ä»·æ ¼ä¿¡æ¯</span></span><br><span class=\"line\">GET /shopping/_search</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">&quot;size&quot;</span>:0,</span><br><span class=\"line\">  <span class=\"string\">&quot;aggs&quot;</span>:&#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;category_buckets&quot;</span>:&#123;</span><br><span class=\"line\">      <span class=\"string\">&quot;terms&quot;</span>:&#123;</span><br><span class=\"line\">        <span class=\"string\">&quot;field&quot;</span>:<span class=\"string\">&quot;category&quot;</span></span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      <span class=\"string\">&quot;aggs&quot;</span>:&#123;</span><br><span class=\"line\">        <span class=\"string\">&quot;address_buckets&quot;</span>:&#123;</span><br><span class=\"line\">          <span class=\"string\">&quot;terms&quot;</span>:&#123;</span><br><span class=\"line\">            <span class=\"string\">&quot;field&quot;</span>:<span class=\"string\">&quot;address.keyword&quot;</span></span><br><span class=\"line\">          &#125;,</span><br><span class=\"line\">          <span class=\"string\">&quot;aggs&quot;</span>:&#123;</span><br><span class=\"line\">            <span class=\"string\">&quot;price_stats&quot;</span>:&#123;</span><br><span class=\"line\">              <span class=\"string\">&quot;stats&quot;</span>:&#123;</span><br><span class=\"line\">                <span class=\"string\">&quot;field&quot;</span>:<span class=\"string\">&quot;price&quot;</span></span><br><span class=\"line\">              &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"Pipeline-Aggregation-ç®¡é“èšåˆ\">Pipeline Aggregation(ç®¡é“èšåˆ)</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ”¯æŒå¯¹èšåˆåˆ†æçš„ç»“æœï¼Œå†æ¬¡è¿›è¡Œèšåˆåˆ†æã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>Pipeline çš„åˆ†æç»“æœä¼šè¾“å‡ºåˆ°åŸç»“æœä¸­ï¼Œæ ¹æ®ä½ç½®çš„ä¸åŒï¼Œåˆ†ä¸ºä¸¤ç±»ï¼š</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">Sibling - ç»“æœå’Œç°æœ‰åˆ†æç»“æœåŒçº§\n<ul class=\"lvl-4\">\n<li class=\"lvl-6\">Maxï¼Œminï¼ŒAvg &amp; Sum Bucket</li>\n<li class=\"lvl-6\">Statsï¼ŒExtended Status Bucket</li>\n<li class=\"lvl-6\">Percentiles Bucket</li>\n</ul>\n</li>\n<li class=\"lvl-4\">Parent -ç»“æœå†…åµŒåˆ°ç°æœ‰çš„èšåˆåˆ†æç»“æœä¹‹ä¸­\n<ul class=\"lvl-4\">\n<li class=\"lvl-6\">Derivative(æ±‚å¯¼)</li>\n<li class=\"lvl-6\">Cumultive Sum(ç´¯è®¡æ±‚å’Œ)</li>\n<li class=\"lvl-6\">Moving Function(ç§»åŠ¨å¹³å‡å€¼)</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"Maxï¼Œminï¼ŒAvg-Sum-Bucket\">Maxï¼Œminï¼ŒAvg &amp; Sum Bucket</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Maxï¼Œminï¼ŒAvg &amp; Sum Bucketï¼šå¯¹èšåˆåˆ†æçš„ç»“æœè¿›è¡Œæœ€å¤§å€¼ã€æœ€å°å€¼ã€å¹³å‡å€¼ã€æ±‚å’Œç­‰æ“ä½œã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ç¤ºä¾‹ï¼šæŒ‰ç…§categoryè¿›è¡Œåˆ†ç»„æ±‚å‡ºå•†å“çš„å¹³å‡ä»·æ ¼ï¼Œå¹¶æ‰¾å‡ºå¹³å‡ä»·æ ¼æœ€ä½çš„åˆ†ç»„</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">GET /shopping/_search</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">&quot;size&quot;</span>:0,</span><br><span class=\"line\">  <span class=\"string\">&quot;aggs&quot;</span>:&#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;category_buckets&quot;</span>:&#123;</span><br><span class=\"line\">      <span class=\"string\">&quot;terms&quot;</span>:&#123;</span><br><span class=\"line\">        <span class=\"string\">&quot;field&quot;</span>:<span class=\"string\">&quot;category&quot;</span> <span class=\"comment\"># æŒ‰ç…§categoryå­—æ®µè¿›è¡Œåˆ†ç»„</span></span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      <span class=\"string\">&quot;aggs&quot;</span>:&#123;</span><br><span class=\"line\">        <span class=\"string\">&quot;price_avg&quot;</span>:&#123;</span><br><span class=\"line\">          <span class=\"string\">&quot;avg&quot;</span>:&#123; <span class=\"comment\"># æ±‚ä»·æ ¼å¹³å‡å€¼</span></span><br><span class=\"line\">            <span class=\"string\">&quot;field&quot;</span>:<span class=\"string\">&quot;price&quot;</span></span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"string\">&quot;min_price_in_category&quot;</span>:&#123; <span class=\"comment\"># æ‰¾å‡ºå¹³å‡ä»·æ ¼æœ€ä½çš„åˆ†ç»„</span></span><br><span class=\"line\">      <span class=\"string\">&quot;min_bucket&quot;</span>:&#123; <span class=\"comment\"># å¯¹èšåˆç»“æœè¿›è¡Œæœ€å°å€¼æ“ä½œ</span></span><br><span class=\"line\">        <span class=\"string\">&quot;buckets_path&quot;</span>:<span class=\"string\">&quot;category_buckets&gt;price_avg&quot;</span> <span class=\"comment\"># æŒ‡å®šè·¯å¾„ï¼Œå¯¹category_bucketsèšåˆç»“æœä¸­çš„price_avgå­—æ®µè¿›è¡Œæœ€å°å€¼æ“ä½œ</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"Statsï¼ŒExtended-Status-Bucket\">Statsï¼ŒExtended Status Bucket</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Statsï¼ŒExtended Status Bucketï¼šå¯¹èšåˆåˆ†æçš„ç»“æœè¿›è¡Œç»Ÿè®¡æ“ä½œï¼ŒåŒ…æ‹¬æœ€å¤§å€¼ã€æœ€å°å€¼ã€å¹³å‡å€¼ã€æ±‚å’Œã€æ•°é‡ç­‰ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ç¤ºä¾‹ï¼šæŒ‰ç…§categoryè¿›è¡Œåˆ†ç»„æ±‚å‡ºå•†å“çš„å¹³å‡ä»·æ ¼ï¼Œå¹¶å¯¹åˆ†ç»„ç»“æœè¿›è¡Œç»Ÿè®¡æ“ä½œ</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">GET /shopping/_search</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">&quot;size&quot;</span>: 0,</span><br><span class=\"line\">  <span class=\"string\">&quot;aggs&quot;</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;category_buckets&quot;</span>: &#123;</span><br><span class=\"line\">      <span class=\"string\">&quot;terms&quot;</span>: &#123;</span><br><span class=\"line\">        <span class=\"string\">&quot;field&quot;</span>: <span class=\"string\">&quot;category&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;size&quot;</span>: 10 <span class=\"comment\"># æŒ‡å®šåˆ†ç»„æ•°é‡</span></span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      <span class=\"string\">&quot;aggs&quot;</span>: &#123;</span><br><span class=\"line\">        <span class=\"string\">&quot;avg_price&quot;</span>: &#123;</span><br><span class=\"line\">          <span class=\"string\">&quot;avg&quot;</span>: &#123;</span><br><span class=\"line\">            <span class=\"string\">&quot;field&quot;</span>: <span class=\"string\">&quot;price&quot;</span></span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"string\">&quot;stats_price_by_job&quot;</span>:&#123;</span><br><span class=\"line\">      <span class=\"string\">&quot;stats_bucket&quot;</span>: &#123; <span class=\"comment\"># å¯¹èšåˆç»“æœè¿›è¡Œç»Ÿè®¡æ“ä½œ</span></span><br><span class=\"line\">        <span class=\"string\">&quot;buckets_path&quot;</span>: <span class=\"string\">&quot;category_buckets&gt;avg_price&quot;</span> <span class=\"comment\"># æŒ‡å®šè·¯å¾„ï¼Œå¯¹category_bucketsèšåˆç»“æœä¸­çš„avg_priceå­—æ®µè¿›è¡Œç»Ÿè®¡æ“ä½œ</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"Percentiles-Bucket\">Percentiles Bucket</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Percentiles Bucketï¼šå¯¹èšåˆåˆ†æçš„ç»“æœè¿›è¡Œç™¾åˆ†æ¯”æ“ä½œï¼ŒåŒ…æ‹¬ç™¾åˆ†æ¯”ã€ä¸­ä½æ•°ç­‰ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ç¤ºä¾‹ï¼šæŒ‰ç…§categoryè¿›è¡Œåˆ†ç»„æ±‚å‡ºå•†å“çš„å¹³å‡ä»·æ ¼ï¼Œå¹¶å¯¹åˆ†ç»„ç»“æœè¿›è¡Œç™¾åˆ†æ¯”æ“ä½œ</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">GET /shopping/_search</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">&quot;size&quot;</span>: 0,</span><br><span class=\"line\">  <span class=\"string\">&quot;aggs&quot;</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;category_buckets&quot;</span>: &#123;</span><br><span class=\"line\">      <span class=\"string\">&quot;terms&quot;</span>: &#123;</span><br><span class=\"line\">        <span class=\"string\">&quot;field&quot;</span>: <span class=\"string\">&quot;category&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;size&quot;</span>: 10</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      <span class=\"string\">&quot;aggs&quot;</span>: &#123;</span><br><span class=\"line\">        <span class=\"string\">&quot;avg_price&quot;</span>: &#123;</span><br><span class=\"line\">          <span class=\"string\">&quot;avg&quot;</span>: &#123;</span><br><span class=\"line\">            <span class=\"string\">&quot;field&quot;</span>: <span class=\"string\">&quot;price&quot;</span></span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"string\">&quot;percentiles_price_by_category&quot;</span>:&#123;</span><br><span class=\"line\">      <span class=\"string\">&quot;percentiles_bucket&quot;</span>: &#123; <span class=\"comment\"># å¯¹èšåˆç»“æœè¿›è¡Œç»Ÿè®¡æ“ä½œ</span></span><br><span class=\"line\">        <span class=\"string\">&quot;buckets_path&quot;</span>: <span class=\"string\">&quot;category_buckets&gt;avg_price&quot;</span> <span class=\"comment\"># æŒ‡å®šè·¯å¾„ï¼Œå¯¹category_bucketsèšåˆç»“æœä¸­çš„avg_priceå­—æ®µè¿›è¡Œç»Ÿè®¡æ“ä½œ</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"Cumulative-Sum\">Cumulative Sum</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Cumulative Sumï¼šå¯¹èšåˆåˆ†æçš„ç»“æœè¿›è¡Œç´¯è®¡æ±‚å’Œæ“ä½œã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ç¤ºä¾‹: æŒ‰ç…§ä»·æ ¼è¿›è¡Œåˆ†ç»„ï¼Œå¹¶ç»Ÿè®¡å¹³å‡ä»·æ ¼ä¿¡æ¯ï¼Œå¯¹åˆ†ç»„ç»“æœè¿›è¡Œç´¯è®¡æ±‚å’Œæ“ä½œã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">GET /shopping/_search</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">&quot;size&quot;</span>: 0,</span><br><span class=\"line\">  <span class=\"string\">&quot;aggs&quot;</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;price_histogram&quot;</span>: &#123;</span><br><span class=\"line\">      <span class=\"string\">&quot;histogram&quot;</span>: &#123;</span><br><span class=\"line\">        <span class=\"string\">&quot;field&quot;</span>: <span class=\"string\">&quot;price&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;interval&quot;</span>: 500, <span class=\"comment\"># é—´éš”500</span></span><br><span class=\"line\">        <span class=\"string\">&quot;extended_bounds&quot;</span>:&#123; <span class=\"comment\"># è®¾ç½®è¾¹ç•Œ</span></span><br><span class=\"line\">          <span class=\"string\">&quot;min&quot;</span>:0, <span class=\"comment\"># æœ€å°å€¼0</span></span><br><span class=\"line\">          <span class=\"string\">&quot;max&quot;</span>:2000 <span class=\"comment\"># æœ€å¤§å€¼2000</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      <span class=\"string\">&quot;aggs&quot;</span>: &#123;</span><br><span class=\"line\">        <span class=\"string\">&quot;avg_price&quot;</span>: &#123;</span><br><span class=\"line\">          <span class=\"string\">&quot;avg&quot;</span>: &#123;</span><br><span class=\"line\">            <span class=\"string\">&quot;field&quot;</span>: <span class=\"string\">&quot;price&quot;</span></span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        <span class=\"string\">&quot;cumulative_sum_price&quot;</span>: &#123;</span><br><span class=\"line\">          <span class=\"string\">&quot;cumulative_sum&quot;</span>: &#123; <span class=\"comment\"># å¯¹èšåˆç»“æœè¿›è¡Œç´¯è®¡æ±‚å’Œæ“ä½œ</span></span><br><span class=\"line\">            <span class=\"string\">&quot;buckets_path&quot;</span>: <span class=\"string\">&quot;avg_price&quot;</span> <span class=\"comment\"># æŒ‡å®šè·¯å¾„ï¼Œå¯¹avg_priceå­—æ®µè¿›è¡Œç´¯è®¡æ±‚å’Œæ“ä½œ</span></span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"Derivative\">Derivative</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Derivativeï¼šå¯¹èšåˆåˆ†æçš„ç»“æœè¿›è¡Œæ±‚å¯¼æ“ä½œã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>Derivative èšåˆæŸ¥è¯¢æ˜¯ Elasticsearch ä¸­çš„ä¸€ç§é«˜çº§èšåˆç±»å‹ï¼Œç”¨äºè®¡ç®—æŸä¸ªåº¦é‡å€¼éšæ—¶é—´ï¼ˆæˆ–å…¶ä»–é¡ºåºå­—æ®µï¼‰å˜åŒ–çš„é€Ÿç‡ã€‚å®ƒé€šå¸¸ç”¨äºæ—¶é—´åºåˆ—åˆ†æï¼Œä»¥æ­ç¤ºåº¦é‡å€¼çš„å¢å‡è¶‹åŠ¿ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ç¤ºä¾‹ï¼šæ˜¾ç¤ºæ¯å¤©çš„å¹³å‡ä»·æ ¼ä»¥åŠå¹³å‡ä»·æ ¼çš„å˜åŒ–è¶‹åŠ¿</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">GET /shopping/_search</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">&quot;size&quot;</span>: 0,</span><br><span class=\"line\">  <span class=\"string\">&quot;aggs&quot;</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;price_over_time&quot;</span>: &#123;</span><br><span class=\"line\">      <span class=\"string\">&quot;date_histogram&quot;</span>: &#123; <span class=\"comment\"># æŒ‰ç…§æ—¥æœŸè¿›è¡Œåˆ†ç»„</span></span><br><span class=\"line\">        <span class=\"string\">&quot;field&quot;</span>: <span class=\"string\">&quot;created_at&quot;</span>, <span class=\"comment\"># æŒ‡å®šå­—æ®µ</span></span><br><span class=\"line\">        <span class=\"string\">&quot;calendar_interval&quot;</span>: <span class=\"string\">&quot;day&quot;</span> <span class=\"comment\"># æŒ‡å®šæ—¶é—´é—´éš”ï¼Œå¯ç”¨çš„å€¼ï¼šyearã€quarterã€monthã€weekã€dayã€hourã€minuteã€second</span></span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      <span class=\"string\">&quot;aggs&quot;</span>: &#123;</span><br><span class=\"line\">        <span class=\"string\">&quot;average_price&quot;</span>: &#123;</span><br><span class=\"line\">          <span class=\"string\">&quot;avg&quot;</span>: &#123;</span><br><span class=\"line\">            <span class=\"string\">&quot;field&quot;</span>: <span class=\"string\">&quot;price&quot;</span></span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        <span class=\"string\">&quot;price_derivative&quot;</span>: &#123;</span><br><span class=\"line\">          <span class=\"string\">&quot;derivative&quot;</span>: &#123; <span class=\"comment\"># å¯¹èšåˆç»“æœè¿›è¡Œæ±‚å¯¼æ“ä½œ</span></span><br><span class=\"line\">            <span class=\"string\">&quot;buckets_path&quot;</span>: <span class=\"string\">&quot;average_price&quot;</span></span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"Moving-Function\">Moving Function</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Moving Functionï¼šå¯¹èšåˆåˆ†æçš„ç»“æœè¿›è¡Œç§»åŠ¨å¹³å‡å€¼æ“ä½œã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>Moving Function èšåˆæŸ¥è¯¢æ˜¯ Elasticsearch ä¸­çš„ä¸€ç§é«˜çº§èšåˆç±»å‹ï¼Œç”¨äºè®¡ç®—æŸä¸ªåº¦é‡å€¼åœ¨æ—¶é—´çª—å£å†…çš„ç§»åŠ¨å¹³å‡å€¼ã€‚å®ƒé€šå¸¸ç”¨äºæ—¶é—´åºåˆ—åˆ†æï¼Œä»¥äº†è§£åº¦é‡å€¼çš„å˜åŒ–è¶‹åŠ¿ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ç¤ºä¾‹ï¼šè®¡ç®— price å­—æ®µçš„ 7 å¤©ç§»åŠ¨å¹³å‡å€¼</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">GET /shopping/_search</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">&quot;size&quot;</span>: 0,</span><br><span class=\"line\">  <span class=\"string\">&quot;aggs&quot;</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;price_over_time&quot;</span>: &#123;</span><br><span class=\"line\">      <span class=\"string\">&quot;date_histogram&quot;</span>: &#123;</span><br><span class=\"line\">        <span class=\"string\">&quot;field&quot;</span>: <span class=\"string\">&quot;created_at&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;calendar_interval&quot;</span>: <span class=\"string\">&quot;day&quot;</span></span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      <span class=\"string\">&quot;aggs&quot;</span>: &#123;</span><br><span class=\"line\">        <span class=\"string\">&quot;daily_avg_price&quot;</span>: &#123;</span><br><span class=\"line\">          <span class=\"string\">&quot;avg&quot;</span>: &#123;</span><br><span class=\"line\">            <span class=\"string\">&quot;field&quot;</span>: <span class=\"string\">&quot;price&quot;</span></span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        <span class=\"string\">&quot;moving_avg_price&quot;</span>: &#123;</span><br><span class=\"line\">          <span class=\"string\">&quot;moving_fn&quot;</span>: &#123; <span class=\"comment\"># å¯¹èšåˆç»“æœè¿›è¡Œç§»åŠ¨å¹³å‡å€¼æ“ä½œ</span></span><br><span class=\"line\">            <span class=\"string\">&quot;buckets_path&quot;</span>: <span class=\"string\">&quot;daily_avg_price&quot;</span>, <span class=\"comment\"># æŒ‡å®šè·¯å¾„ï¼Œå¯¹daily_avg_priceå­—æ®µè¿›è¡Œç§»åŠ¨å¹³å‡å€¼æ“ä½œ</span></span><br><span class=\"line\">            <span class=\"string\">&quot;script&quot;</span>: <span class=\"string\">&quot;MovingFunctions.unweightedAvg(values)&quot;</span>, <span class=\"comment\"># æŒ‡å®šè„šæœ¬ï¼Œè®¡ç®—ç§»åŠ¨å¹³å‡å€¼</span></span><br><span class=\"line\">            <span class=\"string\">&quot;window&quot;</span>: 7, <span class=\"comment\"># çª—å£å¤§å°ï¼Œé»˜è®¤ä¸º 10</span></span><br><span class=\"line\">            <span class=\"string\">&quot;shift&quot;</span>: 0 <span class=\"comment\"># çª—å£åç§»é‡ï¼Œé»˜è®¤ä¸º 0</span></span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"ES-èšåˆæ€§èƒ½ä¼˜åŒ–\">ES èšåˆæ€§èƒ½ä¼˜åŒ–</h2>\n<h3 id=\"ç´¢å¼•é¢„æ’åº\">ç´¢å¼•é¢„æ’åº</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¦‚æœæ˜¯ Elasticsearch 6.X ä¹‹åç‰ˆæœ¬ï¼Œå¯ä»¥åœ¨æ’å…¥æ•°æ®æ—¶å¯¹ç´¢å¼•è¿›è¡Œé¢„æ’åºï¼Œè€Œä¸æ˜¯åœ¨æŸ¥è¯¢æ—¶å†å¯¹ç´¢å¼•è¿›è¡Œæ’åºï¼Œè¿™å°†æé«˜èŒƒå›´æŸ¥è¯¢ï¼ˆrange queryï¼‰å’Œæ’åºæ“ä½œçš„æ€§èƒ½ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä½†é¢„æ’åºå°†å¢åŠ  Elasticsearch å†™å…¥çš„æˆæœ¬ï¼Œå¯¼è‡´å¤§çº¦ 40%-50% çš„å†™æ€§èƒ½ä¸‹é™ï¼Œå¦‚æœåº”ç”¨åœºæ™¯æ˜¯æ›´å…³æ³¨å†™æ€§èƒ½çš„ä¸šåŠ¡ï¼Œå¼€å¯ç´¢å¼•é¢„æ’åºä¸æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é€‰æ‹©ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">PUT /my_index</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">&quot;settings&quot;</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;index&quot;</span>:&#123;</span><br><span class=\"line\">      <span class=\"string\">&quot;sort.field&quot;</span>: <span class=\"string\">&quot;create_time&quot;</span>,</span><br><span class=\"line\">      <span class=\"string\">&quot;sort.order&quot;</span>: <span class=\"string\">&quot;desc&quot;</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"string\">&quot;mappings&quot;</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;properties&quot;</span>: &#123;</span><br><span class=\"line\">      <span class=\"string\">&quot;create_time&quot;</span>:&#123;</span><br><span class=\"line\">        <span class=\"string\">&quot;type&quot;</span>: <span class=\"string\">&quot;date&quot;</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"ä½¿ç”¨åˆ†ç‰‡è¯·æ±‚ç¼“å­˜\">ä½¿ç”¨åˆ†ç‰‡è¯·æ±‚ç¼“å­˜</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>èšåˆè¯­å¥ä¸­ï¼Œè®¾ç½®ï¼šsizeï¼š0ï¼Œå°±ä¼šä½¿ç”¨åˆ†ç‰‡è¯·æ±‚ç¼“å­˜ç¼“å­˜ç»“æœã€‚size = 0 çš„å«ä¹‰æ˜¯ï¼šåªè¿”å›èšåˆç»“æœï¼Œä¸è¿”å›æŸ¥è¯¢ç»“æœã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">GET /my_index/_search</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">&quot;size&quot;</span>: 0,</span><br><span class=\"line\">  <span class=\"string\">&quot;aggs&quot;</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;remark_agg&quot;</span>: &#123;</span><br><span class=\"line\">      <span class=\"string\">&quot;terms&quot;</span>: &#123;</span><br><span class=\"line\">        <span class=\"string\">&quot;field&quot;</span>: <span class=\"string\">&quot;remark.keyword&quot;</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"æ‹†åˆ†èšåˆï¼Œä½¿èšåˆå¹¶è¡ŒåŒ–\">æ‹†åˆ†èšåˆï¼Œä½¿èšåˆå¹¶è¡ŒåŒ–</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Elasticsearch æŸ¥è¯¢æ¡ä»¶ä¸­åŒæ—¶æœ‰å¤šä¸ªæ¡ä»¶èšåˆï¼Œé»˜è®¤æƒ…å†µä¸‹èšåˆä¸æ˜¯å¹¶è¡Œè¿è¡Œçš„ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å½“ä¸ºæ¯ä¸ªèšåˆæä¾›è‡ªå·±çš„æŸ¥è¯¢å¹¶æ‰§è¡Œ msearch æ—¶ï¼Œæ€§èƒ½ä¼šæœ‰æ˜¾è‘—æå‡ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å› æ­¤ï¼Œåœ¨ CPU èµ„æºä¸æ˜¯ç“¶é¢ˆçš„å‰æä¸‹ï¼Œå¦‚æœæƒ³ç¼©çŸ­å“åº”æ—¶é—´ï¼Œå¯ä»¥å°†å¤šä¸ªèšåˆæ‹†åˆ†ä¸ºå¤šä¸ªæŸ¥è¯¢ï¼Œå€ŸåŠ©ï¼šmsearch å®ç°å¹¶è¡Œèšåˆã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#å¸¸è§„çš„å¤šæ¡ä»¶èšåˆå®ç°</span></span><br><span class=\"line\">GET /employees/_search</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">&quot;size&quot;</span>: 0,</span><br><span class=\"line\">  <span class=\"string\">&quot;aggs&quot;</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;job_agg&quot;</span>: &#123;</span><br><span class=\"line\">      <span class=\"string\">&quot;terms&quot;</span>: &#123;</span><br><span class=\"line\">        <span class=\"string\">&quot;field&quot;</span>: <span class=\"string\">&quot;job.keyword&quot;</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"string\">&quot;max_salary&quot;</span>:&#123;</span><br><span class=\"line\">      <span class=\"string\">&quot;max&quot;</span>: &#123;</span><br><span class=\"line\">        <span class=\"string\">&quot;field&quot;</span>: <span class=\"string\">&quot;salary&quot;</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\"># msearch æ‹†åˆ†å¤šä¸ªè¯­å¥çš„èšåˆå®ç°</span></span><br><span class=\"line\">GET _msearch</span><br><span class=\"line\">&#123;<span class=\"string\">&quot;index&quot;</span>:<span class=\"string\">&quot;employees&quot;</span>&#125;</span><br><span class=\"line\">&#123;<span class=\"string\">&quot;size&quot;</span>:0,<span class=\"string\">&quot;aggs&quot;</span>:&#123;<span class=\"string\">&quot;job_agg&quot;</span>:&#123;<span class=\"string\">&quot;terms&quot;</span>:&#123;<span class=\"string\">&quot;field&quot;</span>: <span class=\"string\">&quot;job.keyword&quot;</span>&#125;&#125;&#125;&#125;</span><br><span class=\"line\">&#123;<span class=\"string\">&quot;index&quot;</span>:<span class=\"string\">&quot;employees&quot;</span>&#125;</span><br><span class=\"line\">&#123;<span class=\"string\">&quot;size&quot;</span>:0,<span class=\"string\">&quot;aggs&quot;</span>:&#123;<span class=\"string\">&quot;max_salary&quot;</span>:&#123;<span class=\"string\">&quot;max&quot;</span>:&#123;<span class=\"string\">&quot;field&quot;</span>: <span class=\"string\">&quot;salary&quot;</span>&#125;&#125;&#125;&#125;</span><br></pre></td></tr></table></figure>","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» Elasticsearch çš„ REST APIsï¼šèšåˆæŸ¥è¯¢ Elasticsearchç‰ˆæœ¬8.17.3 å®˜æ–¹æ–‡æ¡£:REST APIs å®˜æ–¹æ–‡æ¡£:Aggregations Elasticsearch çš„ REST APIs èšåˆæŸ¥è¯¢ èšåˆæŸ¥è¯¢ï¼Œå¯ä»¥è®©æˆ‘ä»¬æå…¶æ–¹ä¾¿çš„å®ç°å¯¹ç´¢å¼•æ•°æ®çš„ç»Ÿè®¡ã€åˆ†æã€è¿ç®—ç­‰æ“ä½œã€‚ åŸºæœ¬è¯­æ³•åŒ…æ‹¬ä»¥ä¸‹éƒ¨åˆ†ï¼š æŸ¥è¯¢æ¡ä»¶ï¼šæŒ‡å®šéœ€è¦èšåˆçš„æ–‡æ¡£ï¼Œå¯ä»¥ä½¿ç”¨æ ‡å‡†çš„ Elasticsearch æŸ¥è¯¢è¯­æ³•ï¼Œå¦‚ termã€matchã€range ç­‰ç­‰ã€‚ èšåˆå‡½æ•°ï¼šæŒ‡å®šè¦æ‰§è¡Œçš„èšåˆæ“ä½œï¼Œå¦‚ sumã€avgã€minã€maxã€termsã€date_histogram ç­‰ç­‰ã€‚æ¯ä¸ªèšåˆå‘½ä»¤éƒ½ä¼šç”Ÿæˆä¸€ä¸ªèšåˆç»“æœã€‚ èšåˆåµŒå¥—ï¼šèšåˆå‘½ä»¤å¯ä»¥åµŒå¥—ï¼Œä»¥ä¾¿æ›´ç»†ç²’åº¦åœ°åˆ†ææ•°æ®ã€‚ 123456789101112131415GET &lt;index_name&gt;/_search&#123; &quot;aggs&quot;: &#123; &quot;&lt;aggs_name&gt;&quot;: &#123; &quot;&lt;agg_type&gt;&quot;: &#123; &quot;field&quot;: &quot;&lt;field_name&gt;&quot; &#125; &#125; &#125;&#125;# è¯´æ˜ # aggsï¼šèšåˆçš„æ ¹èŠ‚ç‚¹ï¼Œå›ºå®šå†™æ³• # aggs_nameï¼šèšåˆå‡½æ•°çš„åç§°ï¼Œè‡ªå·±éšæ„å®šä¹‰ # agg_typeï¼šèšåˆç§ç±»ï¼Œæ¯”å¦‚æ˜¯æ¡¶èšåˆï¼ˆtermsï¼‰æˆ–è€…æ˜¯æŒ‡æ ‡èšåˆï¼ˆavgã€sumã€minã€maxç­‰ï¼‰ # field_nameï¼šå­—æ®µåç§°æˆ–è€…å«åŸŸåã€‚ èšåˆçš„åˆ†ç±» Metric Aggregationï¼šâ€”äº›æ•°å­¦è¿ç®—ï¼Œå¯ä»¥å¯¹æ–‡æ¡£å­—æ®µè¿›è¡Œç»Ÿè®¡åˆ†æï¼Œç±»æ¯”Mysqlä¸­çš„ min(), max(), sum() æ“ä½œã€‚ Bucket Aggregationï¼šä¸€äº›æ»¡è¶³ç‰¹å®šæ¡ä»¶çš„æ–‡æ¡£çš„é›†åˆæ”¾ç½®åˆ°ä¸€ä¸ªæ¡¶é‡Œï¼Œæ¯ä¸€ä¸ªæ¡¶å…³è”ä¸€ä¸ªkeyï¼Œç±»æ¯”Mysqlä¸­çš„group byæ“ä½œã€‚ Pipeline Aggregationï¼šå¯¹å…¶ä»–çš„èšåˆç»“æœè¿›è¡ŒäºŒæ¬¡èšåˆ ç¤ºä¾‹æ•°æ®å‡†å¤‡ æˆ‘ä»¬éœ€è¦å…ˆå‡†å¤‡ä¸€äº›æ•°æ®ï¼Œæ‰èƒ½è¿›è¡Œèšåˆåˆ†æã€‚ åˆ›å»ºç´¢å¼• 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465# å¦‚æœå­˜åœ¨å…ˆåˆ é™¤curl -X DELETE -u elastic:123456 -k &#x27;https://127.0.0.1:9200/shopping&#x27;# åˆ›å»ºç´¢å¼•curl -X PUT -u elastic:123456 -k &#x27;https://127.0.0.1:9200/shopping&#x27; \\ -H &#x27;Content-Type: application/json&#x27; \\ -d &#x27;&#123; &quot;settings&quot;:&#123; &quot;number_of_shards&quot;:&quot;1&quot;, &quot;number_of_replicas&quot;:&quot;2&quot; &#125;, &quot;mappings&quot;:&#123; &quot;properties&quot;:&#123; &quot;category&quot;:&#123; &quot;type&quot;:&quot;keyword&quot; &#125;, &quot;price&quot;:&#123; &quot;type&quot;:&quot;double&quot; &#125;, &quot;count&quot;:&#123; &quot;type&quot;:&quot;integer&quot; &#125;, &quot;title&quot;:&#123; &quot;type&quot;:&quot;text&quot;, &quot;analyzer&quot;:&quot;ik_max_word&quot;, &quot;search_analyzer&quot;:&quot;ik_smart&quot; &#125;, &quot;remark&quot;:&#123; &quot;type&quot;:&quot;text&quot;, &quot;analyzer&quot;:&quot;ik_max_word&quot;, &quot;search_analyzer&quot;:&quot;ik_smart&quot; &#125;, &quot;address&quot;: &#123; &quot;type&quot;: &quot;text&quot;, &quot;analyzer&quot;: &quot;ik_max_word&quot;, &quot;fields&quot;: &#123; &quot;keyword&quot;: &#123; &quot;type&quot;: &quot;keyword&quot; &#125; &#125; &#125;, &quot;tags&quot;: &#123; &quot;type&quot;: &quot;keyword&quot; &#125;, &quot;created_at&quot;: &#123;&quot;type&quot;: &quot;date&quot;, &quot;format&quot;: &quot;yyyy-MM-dd HH:mm:ss&quot;&#125; &#125; &#125; &#125;&#x27;# æ’å…¥æ•°æ®curl -X POST -u elastic:123456 -k &#x27;https://127.0.0.1:9200/_bulk&#x27; \\ -H &#x27;Content-Type: application/json&#x27; \\ -d &#x27;&#123; &quot;index&quot;: &#123; &quot;_index&quot;: &quot;shopping&quot;, &quot;_id&quot;: &quot;1&quot; &#125; &#125;&#123; &quot;category&quot;: &quot;electronics&quot;, &quot;price&quot;: 999.99, &quot;count&quot;: 10, &quot;title&quot;: &quot;Smartphone X - 128GB&quot;, &quot;remark&quot;: &quot;This latest Smartphone X comes with a powerful processor and high-resolution camera.&quot;, &quot;address&quot;: &quot;å¹¿å·å¤©æ²³å…¬å›­&quot;, &quot;tags&quot;: [&quot;latest&quot;, &quot;smartphone&quot;, &quot;technology&quot;], &quot;created_at&quot;: &quot;2025-04-22 03:30:02&quot; &#125;&#123; &quot;index&quot;: &#123; &quot;_index&quot;: &quot;shopping&quot;, &quot;_id&quot;: &quot;2&quot; &#125; &#125;&#123; &quot;category&quot;: &quot;fashion&quot;, &quot;price&quot;: 49.99, &quot;count&quot;: 25, &quot;title&quot;: &quot;Designer T-shirt&quot;, &quot;remark&quot;: &quot;Trendy designer T-shirt made with high quality fabric.&quot;, &quot;address&quot;: &quot;å¹¿å·è”æ¹¾å¤§å¦&quot;, &quot;tags&quot;: [&quot;clothing&quot;, &quot;designer&quot;, &quot;style&quot;], &quot;created_at&quot;: &quot;2025-04-21 12:15:00&quot; &#125;&#123; &quot;index&quot;: &#123; &quot;_index&quot;: &quot;shopping&quot;, &quot;_id&quot;: &quot;3&quot; &#125; &#125;&#123; &quot;category&quot;: &quot;home_appliances&quot;, &quot;price&quot;: 299.99, &quot;count&quot;: 5, &quot;title&quot;: &quot;Robot Vacuum Cleaner&quot;, &quot;remark&quot;: &quot;Efficient robot vacuum cleaner with smart navigation.&quot;, &quot;address&quot;: &quot;å¹¿å·ç™½äº‘å±±å…¬å›­&quot;, &quot;tags&quot;: [&quot;appliances&quot;, &quot;vacuum&quot;, &quot;robot&quot;], &quot;created_at&quot;: &quot;2025-04-20 08:45:30&quot; &#125;&#123; &quot;index&quot;: &#123; &quot;_index&quot;: &quot;shopping&quot;, &quot;_id&quot;: &quot;4&quot; &#125; &#125;&#123; &quot;category&quot;: &quot;books&quot;, &quot;price&quot;: 19.99, &quot;count&quot;: 100, &quot;title&quot;: &quot;Inspirational Novel&quot;, &quot;remark&quot;: &quot;A gripping novel that inspires and motivates.&quot;, &quot;address&quot;: &quot;321 Book Rd, Shenzhen, China&quot;, &quot;tags&quot;: [&quot;book&quot;, &quot;novel&quot;, &quot;inspiration&quot;], &quot;created_at&quot;: &quot;2025-04-19 10:05:00&quot; &#125;&#123; &quot;index&quot;: &#123; &quot;_index&quot;: &quot;shopping&quot;, &quot;_id&quot;: &quot;5&quot; &#125; &#125;&#123; &quot;category&quot;: &quot;groceries&quot;, &quot;price&quot;: 3.99, &quot;count&quot;: 200, &quot;title&quot;: &quot;Organic Apples&quot;, &quot;remark&quot;: &quot;Fresh and crispy organic apples.&quot;, &quot;address&quot;: &quot;654 Grocery Ln, Chengdu, China&quot;, &quot;tags&quot;: [&quot;fruit&quot;, &quot;organic&quot;, &quot;healthy&quot;], &quot;created_at&quot;: &quot;2025-04-18 14:30:45&quot; &#125;&#123; &quot;index&quot;: &#123; &quot;_index&quot;: &quot;shopping&quot;, &quot;_id&quot;: &quot;6&quot; &#125; &#125;&#123; &quot;category&quot;: &quot;electronics&quot;, &quot;price&quot;: 1999.99, &quot;count&quot;: 15, &quot;title&quot;: &quot;Smartphone X - 256GB&quot;, &quot;remark&quot;: &quot;This latest Smartphone X comes with a powerful processor and high-resolution camera.&quot;, &quot;address&quot;: &quot;å¹¿å·å¤©æ²³å…¬å›­&quot;, &quot;tags&quot;: [&quot;latest&quot;, &quot;smartphone&quot;, &quot;technology&quot;], &quot;created_at&quot;: &quot;2025-04-22 03:30:02&quot; &#125;&#x27; Metric Aggregation(æŒ‡æ ‡èšåˆ) å•å€¼åˆ†æï¸°åªè¾“å‡ºä¸€ä¸ªåˆ†æç»“æœ min, max, avg, sum 123456789101112131415161718192021222324252627# æœ€å¤§å€¼ã€æœ€å°å€¼ã€å¹³å‡å€¼ã€æ€»å’ŒGET /shopping/_search&#123; &quot;size&quot;: 0, # ä¸è¿”å›æ–‡æ¡£ï¼Œåªè¿”å›èšåˆç»“æœ &quot;aggs&quot;: &#123; &quot;max_price&quot;: &#123; # è‡ªå®šä¹‰åç§°ï¼Œè¿™é‡Œè¿”å›æœ€å¤§å€¼ &quot;max&quot;: &#123; # æŒ‡æ ‡èšåˆå‡½æ•°åç§° &quot;field&quot;: &quot;price&quot; # æŒ‡æ ‡èšåˆå­—æ®µ &#125; &#125;, &quot;min_price&quot;: &#123; &quot;min&quot;: &#123; &quot;field&quot;: &quot;price&quot; &#125; &#125;, &quot;avg_price&quot;: &#123; &quot;avg&quot;: &#123; &quot;field&quot;: &quot;price&quot; &#125; &#125;, &quot;sum_price&quot;: &#123; &quot;sum&quot;: &#123; &quot;field&quot;: &quot;price&quot; &#125; &#125; &#125;&#125; Cardinalityï¼ˆç±»ä¼¼distinct Count) 1234567891011GET /shopping/_search&#123; &quot;size&quot;: 0, # ä¸è¿”å›æ–‡æ¡£ï¼Œåªè¿”å›èšåˆç»“æœ &quot;aggs&quot;: &#123; &quot;cardinality_count&quot;: &#123; # è‡ªå®šä¹‰åç§°ï¼Œè¿”å›å»é‡åçš„æ•°é‡ &quot;cardinality&quot;: &#123; # æŒ‡æ ‡èšåˆå‡½æ•°åç§°ï¼Œcardinalityè¡¨ç¤ºå»é‡ &quot;field&quot;: &quot;category&quot; # æŒ‡æ ‡èšåˆå­—æ®µï¼Œå»é‡çš„å­—æ®µ &#125; &#125; &#125;&#125; å¤šå€¼åˆ†æ:è¾“å‡ºå¤šä¸ªåˆ†æç»“æœ statsï¼ˆç»Ÿè®¡ï¼‰, extended stats 123456789101112131415161718192021222324252627282930313233343536373839GET /shopping/_search&#123; &quot;size&quot;: 0, &quot;aggs&quot;: &#123; &quot;stats_price&quot;: &#123; &quot;stats&quot;: &#123; # æŒ‡æ ‡èšåˆå‡½æ•°åç§°ï¼Œstatsè¡¨ç¤ºç»Ÿè®¡ï¼Œä¼šè¿”å›å¤šä¸ªæŒ‡æ ‡ &quot;field&quot;: &quot;price&quot; &#125; &#125; &#125;&#125;# ç»“æœ&#123; &quot;took&quot;: 15, &quot;timed_out&quot;: false, &quot;_shards&quot;: &#123; &quot;total&quot;: 1, &quot;successful&quot;: 1, &quot;skipped&quot;: 0, &quot;failed&quot;: 0 &#125;, &quot;hits&quot;: &#123; &quot;total&quot;: &#123; &quot;value&quot;: 12, &quot;relation&quot;: &quot;eq&quot; &#125;, &quot;max_score&quot;: null, &quot;hits&quot;: [] # å› ä¸ºè®¾ç½®size ä¸º 0ï¼Œæ‰€ä»¥è¿”å›çš„ç»“æœä¸ºç©º &#125;, &quot;aggregations&quot;: &#123; # èšåˆç»“æœ &quot;stats_price&quot;: &#123; # è‡ªå®šä¹‰åç§°ï¼Œè¿”å›å¤šç»„èšåˆç»“æœ &quot;count&quot;: 12, &quot;min&quot;: 3.99, &quot;max&quot;: 1999.99, &quot;avg&quot;: 562.1666666666666, &quot;sum&quot;: 6746 &#125; &#125;&#125; percentile ï¼ˆç™¾åˆ†ä½ï¼‰, percentile rank 1234567891011121314151617GET /shopping/_search&#123; &quot;size&quot;: 0, &quot;aggs&quot;: &#123; &quot;percentile_price&quot;: &#123; &quot;percentiles&quot;: &#123; # æŒ‡æ ‡èšåˆå‡½æ•°åç§°ï¼Œpercentilesè¡¨ç¤ºç™¾åˆ†ä½æ•°èšåˆè®¡ç®— &quot;field&quot;: &quot;price&quot;, # æŒ‡æ ‡èšåˆå­—æ®µ &quot;percents&quot;: [1, 5, 25, 50, 75, 95, 99] # éœ€è¦è®¡ç®—ç™¾åˆ†ä½æ•°çš„æ•°ç»„ &#125; &#125; &#125;&#125;# ç™¾åˆ†ä½æ•°æ˜¯ä¸€ä¸ªç»Ÿè®¡å­¦æ¦‚å¿µï¼Œç”¨äºæè¿°ä¸€ä¸ªç»™å®šé›†åˆçš„æ’åºå€¼ã€‚ä¾‹å¦‚ï¼š# ç¬¬ 1 ç™¾åˆ†ä½æ•°è¡¨ç¤ºæ•°æ®ä¸­å°äºè¿™ä¸ªå€¼çš„æ‰€æœ‰æ•°æ®å æ€»æ•°çš„ 1%ã€‚# ç¬¬ 50 ç™¾åˆ†ä½æ•°ï¼ˆä¸­ä½æ•°ï¼‰è¡¨ç¤ºæ•°æ®ä¸­çš„ä¸€åŠå°äºè¿™ä¸ªå€¼ï¼Œå¦ä¸€åŠå¤§äºè¿™ä¸ªå€¼ã€‚# ç¬¬ 99 ç™¾åˆ†ä½æ•°è¡¨ç¤ºæ•°æ®ä¸­å°äºè¿™ä¸ªå€¼çš„æ‰€æœ‰æ•°æ®å æ€»æ•°çš„ 99%ã€‚# é€šè¿‡è®¡ç®—è¿™äº›ç™¾åˆ†ä½æ•°ï¼Œä½ å¯ä»¥äº†è§£ price å­—æ®µåœ¨æ•´ä¸ªshoppingç´¢å¼•ä¸­çš„åˆ†å¸ƒæƒ…å†µï¼Œä»è€Œå¯ä»¥ç”¨äºæ•°æ®åˆ†æã€è¶‹åŠ¿åˆ¤æ–­ç­‰ã€‚ top hits(æ’åœ¨å‰é¢çš„ç¤ºä¾‹) 123456789101112GET /shopping/_search&#123; &quot;size&quot;: 0, &quot;aggs&quot;: &#123; &quot;top_hits&quot;: &#123; # è‡ªå®šä¹‰åç§°ï¼Œè¿”å›æ’åœ¨å‰é¢çš„ç¤ºä¾‹ &quot;top_hits&quot;: &#123; # æŒ‡æ ‡èšåˆå‡½æ•°åç§°ï¼Œtop_hitsè¡¨ç¤ºè¿”å›æ’åœ¨å‰é¢çš„ç¤ºä¾‹ &quot;sort&quot;: [&#123;&quot;price&quot;: &#123;&quot;order&quot;: &quot;desc&quot;&#125;&#125;], # æ’åºï¼ŒæŒ‰ç…§priceå­—æ®µé™åºæ’åº &quot;size&quot;: 3 # åªè¿”å›å‰3ä¸ª &#125; &#125; &#125;&#125; Bucket Aggregation(æ¡¶èšåˆ) æŒ‰ç…§ä¸€å®šçš„è§„åˆ™ï¼Œå°†æ–‡æ¡£åˆ†é…åˆ°ä¸åŒçš„æ¡¶ä¸­ï¼Œä»è€Œè¾¾åˆ°åˆ†ç±»çš„ç›®çš„ã€‚ ESæä¾›çš„ä¸€äº›å¸¸è§çš„ Bucket Aggregationã€‚ termsï¼ˆè¯æ¡ï¼‰, rangeï¼ˆèŒƒå›´ï¼‰, date_rangeï¼ˆæ—¥æœŸèŒƒå›´ï¼‰, ip_rangeï¼ˆIPèŒƒå›´ï¼‰, missingï¼ˆç¼ºå¤±ï¼‰, histogramï¼ˆç›´æ–¹å›¾ï¼‰, date_histogramï¼ˆæ—¥æœŸç›´æ–¹å›¾ï¼‰, geo_distanceï¼ˆåœ°ç†è·ç¦»ï¼‰, significant_termsï¼ˆé‡è¦è¯æ¡ï¼‰, compositeï¼ˆç»„åˆï¼‰ æ¡¶èšåˆå¯ä»¥ç”¨äºå„ç§åœºæ™¯ï¼Œä¾‹å¦‚ï¼š å¯¹æ•°æ®è¿›è¡Œåˆ†ç»„ç»Ÿè®¡ï¼Œæ¯”å¦‚æŒ‰ç…§åœ°åŒºã€å¹´é¾„æ®µã€æ€§åˆ«ç­‰å­—æ®µè¿›è¡Œåˆ†ç»„ç»Ÿè®¡ã€‚ å¯¹æ—¶é—´åºåˆ—æ•°æ®è¿›è¡Œæ—¶é—´æ®µåˆ†æï¼Œæ¯”å¦‚æŒ‰ç…§æ¯å°æ—¶ã€æ¯å¤©ã€æ¯æœˆã€æ¯å­£åº¦ã€æ¯å¹´ç­‰æ—¶é—´æ®µè¿›è¡Œåˆ†æã€‚ å¯¹å„ç§æ ‡ç­¾ä¿¡æ¯åˆ†ç±»ï¼Œå¹¶ç»Ÿè®¡å…¶æ•°é‡ã€‚ termsï¼ˆè¯æ¡ï¼‰ æŒ‰ç…§å­—æ®µçš„å€¼è¿›è¡Œåˆ†ç»„ï¼Œå¹¶ç»Ÿè®¡æ¯ä¸ªç»„çš„æ•°é‡ã€‚ ç¤ºä¾‹ï¼šæŒ‰ç…§categoryå­—æ®µè¿›è¡Œåˆ†ç»„ï¼Œå¹¶ç»Ÿè®¡æ¯ä¸ªç»„çš„æ•°é‡ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061GET /shopping/_search&#123; &quot;size&quot;: 0, &quot;aggs&quot;: &#123; &quot;category_count&quot;: &#123; # è‡ªå®šä¹‰åç§°ï¼Œè¿”å›æ¯ä¸ªç»„çš„æ•°é‡ &quot;terms&quot;: &#123; # æ¡¶èšåˆå‡½æ•°åç§°ï¼Œtermsè¡¨ç¤ºæŒ‰ç…§å­—æ®µçš„å€¼è¿›è¡Œåˆ†ç»„ &quot;field&quot;: &quot;category&quot;, # æŒ‰ç…§categoryå­—æ®µè¿›è¡Œåˆ†ç»„ï¼Œæ³¨æ„ä¸èƒ½æ˜¯textç±»å‹ï¼Œå¦åˆ™ä¼šæŠ¥é”™ &quot;size&quot;: 10, # åªè¿”å›å‰10ä¸ªï¼Œé»˜è®¤æ˜¯10 &quot;order&quot;: &#123;&quot;_count&quot;: &quot;desc&quot;&#125; # æŒ‰ç…§æ•°é‡é™åºæ’åºï¼Œé»˜è®¤æ˜¯descï¼ŒBucketèšåˆä¼šç»Ÿè®¡Bucketå†…çš„æ–‡æ¡£æ•°é‡ï¼Œè®°ä¸º_countï¼Œå¹¶ä¸”æŒ‰ç…§_counté™åºæ’åº &#125; &#125; &#125;&#125;# ç»“æœ&#123; &quot;took&quot;: 15, &quot;timed_out&quot;: false, &quot;_shards&quot;: &#123; &quot;total&quot;: 1, &quot;successful&quot;: 1, &quot;skipped&quot;: 0, &quot;failed&quot;: 0 &#125;, &quot;hits&quot;: &#123; &quot;total&quot;: &#123; &quot;value&quot;: 12, &quot;relation&quot;: &quot;eq&quot; &#125;, &quot;max_score&quot;: null, &quot;hits&quot;: [] &#125;, &quot;aggregations&quot;: &#123; &quot;category_count&quot;: &#123; &quot;doc_count_error_upper_bound&quot;: 0, # é”™è¯¯ä¸Šç•Œï¼Œè¡¨ç¤ºåœ¨èšåˆè¿‡ç¨‹ä¸­å¯èƒ½å­˜åœ¨ä¸€äº›é”™è¯¯ï¼Œä½†é”™è¯¯æ•°é‡ä¸ä¼šè¶…è¿‡è¿™ä¸ªå€¼ &quot;sum_other_doc_count&quot;: 0, # è¡¨ç¤ºåœ¨èšåˆè¿‡ç¨‹ä¸­ï¼Œé™¤äº†è¿”å›çš„10ä¸ªbucketï¼Œè¿˜æœ‰å…¶ä»–æ•°é‡ï¼Œè¿™ä¸ªæ•°é‡å°±æ˜¯sum_other_doc_count &quot;buckets&quot;: [ # è¿”å›çš„bucket &#123; &quot;key&quot;: &quot;electronics&quot;, # åˆ†ç»„çš„key &quot;doc_count&quot;: 4 # åˆ†ç»„çš„æ•°é‡ &#125;, &#123; &quot;key&quot;: &quot;books&quot;, &quot;doc_count&quot;: 2 &#125;, &#123; &quot;key&quot;: &quot;fashion&quot;, &quot;doc_count&quot;: 2 &#125;, &#123; &quot;key&quot;: &quot;groceries&quot;, &quot;doc_count&quot;: 2 &#125;, &#123; &quot;key&quot;: &quot;home_appliances&quot;, &quot;doc_count&quot;: 2 &#125; ] &#125; &#125;&#125; é™å®šèšåˆèŒƒå›´ 1234567891011121314151617181920GET /shopping/_search&#123; &quot;query&quot;: &#123; &quot;range&quot;: &#123; &quot;price&quot;: &#123; &quot;gte&quot;: 100 # é™å®šä»·æ ¼èŒƒå›´ &#125; &#125; &#125;, &quot;size&quot;: 0, &quot;aggs&quot;: &#123; &quot;category_count&quot;: &#123; # è‡ªå®šä¹‰åç§°ï¼Œè¿”å›æ¯ä¸ªç»„çš„æ•°é‡ &quot;terms&quot;: &#123; # æ¡¶èšåˆå‡½æ•°åç§°ï¼Œtermsè¡¨ç¤ºæŒ‰ç…§å­—æ®µçš„å€¼è¿›è¡Œåˆ†ç»„ &quot;field&quot;: &quot;category&quot;, # æŒ‰ç…§categoryå­—æ®µè¿›è¡Œåˆ†ç»„ &quot;size&quot;: 10, # åªè¿”å›å‰10ä¸ªï¼Œé»˜è®¤æ˜¯10 &quot;order&quot;: &#123;&quot;_count&quot;: &quot;desc&quot;&#125; # æŒ‰ç…§æ•°é‡é™åºæ’åºï¼Œé»˜è®¤æ˜¯descï¼ŒBucketèšåˆä¼šç»Ÿè®¡Bucketå†…çš„æ–‡æ¡£æ•°é‡ï¼Œè®°ä¸º_countï¼Œå¹¶ä¸”æŒ‰ç…§_counté™åºæ’åº &#125; &#125; &#125;&#125; rangeï¼ˆèŒƒå›´ï¼‰ æŒ‰ç…§å­—æ®µçš„å€¼è¿›è¡Œåˆ†ç»„ï¼Œå¹¶ç»Ÿè®¡æ¯ä¸ªç»„çš„æ•°é‡ã€‚ ç¤ºä¾‹ï¼šæŒ‰ç…§ä»·æ ¼èŒƒå›´è¿›è¡Œåˆ†ç»„ï¼Œå¹¶ç»Ÿè®¡æ¯ä¸ªç»„çš„æ•°é‡ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960GET /shopping/_search&#123; &quot;size&quot;: 0, &quot;aggs&quot;: &#123; &quot;price_range&quot;: &#123; # è‡ªå®šä¹‰åç§°ï¼Œè¿”å›æ¯ä¸ªç»„çš„æ•°é‡ &quot;range&quot;: &#123; # æ¡¶èšåˆå‡½æ•°åç§°ï¼Œrangeè¡¨ç¤ºæŒ‰ç…§å­—æ®µçš„å€¼è¿›è¡Œåˆ†ç»„ &quot;field&quot;: &quot;price&quot;, # æŒ‰ç…§priceå­—æ®µè¿›è¡Œåˆ†ç»„ &quot;ranges&quot;: [ &#123;&quot;to&quot;: 100&#125;, # å°äº100 &#123;&quot;from&quot;: 100, &quot;to&quot;: 200&#125;, # 100-200ï¼ŒåŒ…æ‹¬100ï¼Œä¸åŒ…æ‹¬200 &#123; &quot;key&quot;:&quot;&gt;=200&quot;, # è®¾å®šé”®å€¼ï¼Œç”¨äºåŒºåˆ†ä¸åŒèŒƒå›´ &quot;from&quot;:200 # å¤§äºç­‰äº200 &#125; ] &#125; &#125; &#125;&#125;# ç»“æœ&#123; &quot;took&quot;: 5, &quot;timed_out&quot;: false, &quot;_shards&quot;: &#123; &quot;total&quot;: 1, &quot;successful&quot;: 1, &quot;skipped&quot;: 0, &quot;failed&quot;: 0 &#125;, &quot;hits&quot;: &#123; &quot;total&quot;: &#123; &quot;value&quot;: 12, &quot;relation&quot;: &quot;eq&quot; &#125;, &quot;max_score&quot;: null, &quot;hits&quot;: [] &#125;, &quot;aggregations&quot;: &#123; &quot;price_range&quot;: &#123; &quot;buckets&quot;: [ &#123; &quot;key&quot;: &quot;*-100.0&quot;, &quot;to&quot;: 100, &quot;doc_count&quot;: 6 &#125;, &#123; &quot;key&quot;: &quot;100.0-200.0&quot;, &quot;from&quot;: 100, &quot;to&quot;: 200, &quot;doc_count&quot;: 0 &#125;, &#123; &quot;key&quot;: &quot;&gt;=200&quot;, &quot;from&quot;: 200, &quot;doc_count&quot;: 6 &#125; ] &#125; &#125;&#125; date_rangeï¼ˆæ—¥æœŸèŒƒå›´ï¼‰ æŒ‰ç…§å­—æ®µçš„å€¼è¿›è¡Œåˆ†ç»„ï¼Œå¹¶ç»Ÿè®¡æ¯ä¸ªç»„çš„æ•°é‡ã€‚ ç¤ºä¾‹ï¼šæŒ‰ç…§æ—¥æœŸèŒƒå›´è¿›è¡Œåˆ†ç»„ï¼Œå¹¶ç»Ÿè®¡æ¯ä¸ªç»„çš„æ•°é‡ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879GET /shopping/_search&#123; &quot;size&quot;: 0, &quot;aggs&quot;: &#123; &quot;date_range&quot;: &#123; &quot;date_range&quot;: &#123; &quot;field&quot;: &quot;created_at&quot;, &quot;ranges&quot;: [ &#123;&quot;to&quot;: &quot;now-3d&quot;&#125;, # å°äºå½“å‰æ—¶é—´å‡å»3å¤© &#123;&quot;from&quot;: &quot;now-3d&quot;,&quot;to&quot;: &quot;now-1d&quot;&#125;, # å¤§äºå½“å‰æ—¶é—´å‡å»3å¤©ï¼ˆåŒ…å«ï¼‰ï¼Œå°äºå½“å‰æ—¶é—´å‡å»1å¤© &#123;&quot;key&quot;:&quot;now-1d&quot;,&quot;from&quot;: &quot;now-1d&quot;&#125; # å¤§äºå½“å‰æ—¶é—´å‡å»1å¤©ï¼ˆåŒ…å«ï¼‰ï¼Œå¹¶è®¾ç½®é”®å€¼ ] &#125; &#125; &#125;&#125;# ç»“æœ&#123; &quot;took&quot;: 3, &quot;timed_out&quot;: false, &quot;_shards&quot;: &#123; &quot;total&quot;: 1, &quot;successful&quot;: 1, &quot;skipped&quot;: 0, &quot;failed&quot;: 0 &#125;, &quot;hits&quot;: &#123; &quot;total&quot;: &#123; &quot;value&quot;: 12, &quot;relation&quot;: &quot;eq&quot; &#125;, &quot;max_score&quot;: null, &quot;hits&quot;: [] &#125;, &quot;aggregations&quot;: &#123; &quot;date_range&quot;: &#123; &quot;buckets&quot;: [ &#123; &quot;key&quot;: &quot;*-2025-04-20 03:14:17&quot;, &quot;to&quot;: 1745118857610, &quot;to_as_string&quot;: &quot;2025-04-20 03:14:17&quot;, &quot;doc_count&quot;: 4 &#125;, &#123; &quot;key&quot;: &quot;2025-04-20 03:14:17-2025-04-22 03:14:17&quot;, &quot;from&quot;: 1745118857610, &quot;from_as_string&quot;: &quot;2025-04-20 03:14:17&quot;, &quot;to&quot;: 1745291657610, &quot;to_as_string&quot;: &quot;2025-04-22 03:14:17&quot;, &quot;doc_count&quot;: 4 &#125;, &#123; &quot;key&quot;: &quot;now-1d&quot;, &quot;from&quot;: 1745291657610, &quot;from_as_string&quot;: &quot;2025-04-22 03:14:17&quot;, &quot;doc_count&quot;: 4 &#125; ] &#125; &#125;&#125;# æ—¥æœŸæ ¼å¼GET /shopping/_search&#123; &quot;size&quot;: 0, &quot;aggs&quot;: &#123; &quot;date_range&quot;: &#123; &quot;date_range&quot;: &#123; &quot;field&quot;: &quot;created_at&quot;, &quot;ranges&quot;: [ &#123;&quot;to&quot;: &quot;2025-04-20 00:00:00&quot;&#125;, # æ³¨æ„è¿™é‡Œçš„æ ¼å¼å¿…é¡»ä¸å­—æ®µæ ¼å¼ä¸€è‡´ &#123;&quot;from&quot;: &quot;2025-04-20 00:00:00&quot;,&quot;to&quot;: &quot;2025-04-22 00:00:00&quot;&#125;, &#123;&quot;key&quot;:&quot;2025-04-22 00:00:00&quot;,&quot;from&quot;: &quot;2025-04-22 00:00:00&quot;&#125; ] &#125; &#125; &#125;&#125; histogramï¼ˆç›´æ–¹å›¾ï¼‰ æŒ‰ç…§é—´éš”è¿›è¡Œåˆ†ç»„ï¼Œå¹¶ç»Ÿè®¡æ¯ä¸ªç»„çš„æ•°é‡ã€‚ ç¤ºä¾‹ï¼šæŒ‰ç…§ä»·æ ¼çš„é—´éš”è¿›è¡Œåˆ†ç»„ï¼Œå¹¶ç»Ÿè®¡æ¯ä¸ªç»„çš„æ•°é‡ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061GET /shopping/_search&#123; &quot;size&quot;: 0, &quot;aggs&quot;: &#123; &quot;price_histogram&quot;: &#123; &quot;histogram&quot;: &#123; &quot;field&quot;: &quot;price&quot;, &quot;interval&quot;: 500, # é—´éš”500 &quot;extended_bounds&quot;:&#123; # è®¾ç½®è¾¹ç•Œ &quot;min&quot;:0, # æœ€å°å€¼0 &quot;max&quot;:2000 # æœ€å¤§å€¼2000 &#125; &#125; &#125; &#125;&#125;# ç»“æœ&#123; &quot;took&quot;: 2, &quot;timed_out&quot;: false, &quot;_shards&quot;: &#123; &quot;total&quot;: 1, &quot;successful&quot;: 1, &quot;skipped&quot;: 0, &quot;failed&quot;: 0 &#125;, &quot;hits&quot;: &#123; &quot;total&quot;: &#123; &quot;value&quot;: 12, &quot;relation&quot;: &quot;eq&quot; &#125;, &quot;max_score&quot;: null, &quot;hits&quot;: [] &#125;, &quot;aggregations&quot;: &#123; &quot;price_histogram&quot;: &#123; &quot;buckets&quot;: [ &#123; &quot;key&quot;: 0, &quot;doc_count&quot;: 8 &#125;, &#123; &quot;key&quot;: 500, &quot;doc_count&quot;: 1 &#125;, &#123; &quot;key&quot;: 1000, &quot;doc_count&quot;: 1 &#125;, &#123; &quot;key&quot;: 1500, &quot;doc_count&quot;: 2 &#125;, &#123; &quot;key&quot;: 2000, &quot;doc_count&quot;: 0 &#125; ] &#125; &#125;&#125; top_hitsï¼ˆåˆ†æ¡¶å–å‰Næ¡ï¼‰ æŒ‰ç…§å­—æ®µçš„å€¼è¿›è¡Œåˆ†ç»„ï¼Œå¹¶è¿”å›æ¯ä¸ªç»„çš„å‰Næ¡æ•°æ®ã€‚ ç¤ºä¾‹ï¼šæŒ‰ç…§categoryè¿›è¡Œåˆ†ç»„ï¼Œå¹¶è¿”å›æ¯ä¸ªç»„çš„å‰3æ¡æ•°æ®ã€‚ 1234567891011121314151617181920212223GET /shopping/_search&#123; &quot;size&quot;: 0, &quot;aggs&quot;: &#123; &quot;price_top_hits&quot;: &#123; # è‡ªå®šä¹‰åç§° &quot;terms&quot;: &#123; &quot;field&quot;: &quot;category&quot; # æŒ‰ç…§categoryå­—æ®µè¿›è¡Œåˆ†ç»„ &#125;, &quot;aggs&quot;: &#123; &quot;top_hits&quot;: &#123; # è‡ªå®šä¹‰åç§° &quot;top_hits&quot;: &#123; # è¿”å›æ¯ä¸ªç»„çš„å‰3æ¡æ•°æ® &quot;size&quot;: 3, # è¿”å›å‰3æ¡æ•°æ® &quot;sort&quot;: &#123; # æŒ‰ç…§created_atå­—æ®µè¿›è¡Œæ’åº &quot;created_at&quot;: &#123; &quot;order&quot;: &quot;desc&quot; # é™åº &#125; &#125; &#125; &#125; &#125; &#125; &#125;&#125; å­èšåˆ å­èšåˆï¼šåœ¨èšåˆå‡½æ•°ä¸­ï¼Œè¿˜å¯ä»¥å†å®šä¹‰ä¸€ä¸ªèšåˆå‡½æ•°ã€‚ ç¤ºä¾‹ï¼šæŒ‰ç…§categoryè¿›è¡Œåˆ†ç»„ï¼Œå¹¶ç»Ÿè®¡ä»·æ ¼ä¿¡æ¯ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546GET /shopping/_search&#123; &quot;size&quot;: 0, &quot;aggs&quot;: &#123; &quot;category_buckets&quot;: &#123; # è‡ªå®šä¹‰åç§° &quot;terms&quot;: &#123; &quot;field&quot;: &quot;category&quot; # æŒ‰ç…§categoryå­—æ®µè¿›è¡Œåˆ†ç»„ &#125; &quot;aggs&quot;: &#123; # å®šä¹‰å­èšåˆ &quot;price_stats&quot;: &#123; &quot;stats&quot;: &#123; # ç»Ÿè®¡ä»·æ ¼ä¿¡æ¯ &quot;field&quot;: &quot;price&quot; &#125; &#125; &#125; &#125; &#125;&#125;# å¤šå±‚åµŒå¥—# å…ˆæŒ‰ç…§categoryè¿›è¡Œåˆ†ç»„ï¼Œå†æŒ‰ç…§addressè¿›è¡Œåˆ†ç»„ï¼Œå¹¶ç»Ÿè®¡ä»·æ ¼ä¿¡æ¯GET /shopping/_search&#123; &quot;size&quot;:0, &quot;aggs&quot;:&#123; &quot;category_buckets&quot;:&#123; &quot;terms&quot;:&#123; &quot;field&quot;:&quot;category&quot; &#125;, &quot;aggs&quot;:&#123; &quot;address_buckets&quot;:&#123; &quot;terms&quot;:&#123; &quot;field&quot;:&quot;address.keyword&quot; &#125;, &quot;aggs&quot;:&#123; &quot;price_stats&quot;:&#123; &quot;stats&quot;:&#123; &quot;field&quot;:&quot;price&quot; &#125; &#125; &#125; &#125; &#125; &#125; &#125;&#125; Pipeline Aggregation(ç®¡é“èšåˆ) æ”¯æŒå¯¹èšåˆåˆ†æçš„ç»“æœï¼Œå†æ¬¡è¿›è¡Œèšåˆåˆ†æã€‚ Pipeline çš„åˆ†æç»“æœä¼šè¾“å‡ºåˆ°åŸç»“æœä¸­ï¼Œæ ¹æ®ä½ç½®çš„ä¸åŒï¼Œåˆ†ä¸ºä¸¤ç±»ï¼š Sibling - ç»“æœå’Œç°æœ‰åˆ†æç»“æœåŒçº§ Maxï¼Œminï¼ŒAvg &amp; Sum Bucket Statsï¼ŒExtended Status Bucket Percentiles Bucket Parent -ç»“æœå†…åµŒåˆ°ç°æœ‰çš„èšåˆåˆ†æç»“æœä¹‹ä¸­ Derivative(æ±‚å¯¼) Cumultive Sum(ç´¯è®¡æ±‚å’Œ) Moving Function(ç§»åŠ¨å¹³å‡å€¼) Maxï¼Œminï¼ŒAvg &amp; Sum Bucket Maxï¼Œminï¼ŒAvg &amp; Sum Bucketï¼šå¯¹èšåˆåˆ†æçš„ç»“æœè¿›è¡Œæœ€å¤§å€¼ã€æœ€å°å€¼ã€å¹³å‡å€¼ã€æ±‚å’Œç­‰æ“ä½œã€‚ ç¤ºä¾‹ï¼šæŒ‰ç…§categoryè¿›è¡Œåˆ†ç»„æ±‚å‡ºå•†å“çš„å¹³å‡ä»·æ ¼ï¼Œå¹¶æ‰¾å‡ºå¹³å‡ä»·æ ¼æœ€ä½çš„åˆ†ç»„ 1234567891011121314151617181920212223GET /shopping/_search&#123; &quot;size&quot;:0, &quot;aggs&quot;:&#123; &quot;category_buckets&quot;:&#123; &quot;terms&quot;:&#123; &quot;field&quot;:&quot;category&quot; # æŒ‰ç…§categoryå­—æ®µè¿›è¡Œåˆ†ç»„ &#125;, &quot;aggs&quot;:&#123; &quot;price_avg&quot;:&#123; &quot;avg&quot;:&#123; # æ±‚ä»·æ ¼å¹³å‡å€¼ &quot;field&quot;:&quot;price&quot; &#125; &#125; &#125; &#125;, &quot;min_price_in_category&quot;:&#123; # æ‰¾å‡ºå¹³å‡ä»·æ ¼æœ€ä½çš„åˆ†ç»„ &quot;min_bucket&quot;:&#123; # å¯¹èšåˆç»“æœè¿›è¡Œæœ€å°å€¼æ“ä½œ &quot;buckets_path&quot;:&quot;category_buckets&gt;price_avg&quot; # æŒ‡å®šè·¯å¾„ï¼Œå¯¹category_bucketsèšåˆç»“æœä¸­çš„price_avgå­—æ®µè¿›è¡Œæœ€å°å€¼æ“ä½œ &#125; &#125; &#125;&#125; Statsï¼ŒExtended Status Bucket Statsï¼ŒExtended Status Bucketï¼šå¯¹èšåˆåˆ†æçš„ç»“æœè¿›è¡Œç»Ÿè®¡æ“ä½œï¼ŒåŒ…æ‹¬æœ€å¤§å€¼ã€æœ€å°å€¼ã€å¹³å‡å€¼ã€æ±‚å’Œã€æ•°é‡ç­‰ã€‚ ç¤ºä¾‹ï¼šæŒ‰ç…§categoryè¿›è¡Œåˆ†ç»„æ±‚å‡ºå•†å“çš„å¹³å‡ä»·æ ¼ï¼Œå¹¶å¯¹åˆ†ç»„ç»“æœè¿›è¡Œç»Ÿè®¡æ“ä½œ 123456789101112131415161718192021222324GET /shopping/_search&#123; &quot;size&quot;: 0, &quot;aggs&quot;: &#123; &quot;category_buckets&quot;: &#123; &quot;terms&quot;: &#123; &quot;field&quot;: &quot;category&quot;, &quot;size&quot;: 10 # æŒ‡å®šåˆ†ç»„æ•°é‡ &#125;, &quot;aggs&quot;: &#123; &quot;avg_price&quot;: &#123; &quot;avg&quot;: &#123; &quot;field&quot;: &quot;price&quot; &#125; &#125; &#125; &#125;, &quot;stats_price_by_job&quot;:&#123; &quot;stats_bucket&quot;: &#123; # å¯¹èšåˆç»“æœè¿›è¡Œç»Ÿè®¡æ“ä½œ &quot;buckets_path&quot;: &quot;category_buckets&gt;avg_price&quot; # æŒ‡å®šè·¯å¾„ï¼Œå¯¹category_bucketsèšåˆç»“æœä¸­çš„avg_priceå­—æ®µè¿›è¡Œç»Ÿè®¡æ“ä½œ &#125; &#125; &#125;&#125; Percentiles Bucket Percentiles Bucketï¼šå¯¹èšåˆåˆ†æçš„ç»“æœè¿›è¡Œç™¾åˆ†æ¯”æ“ä½œï¼ŒåŒ…æ‹¬ç™¾åˆ†æ¯”ã€ä¸­ä½æ•°ç­‰ã€‚ ç¤ºä¾‹ï¼šæŒ‰ç…§categoryè¿›è¡Œåˆ†ç»„æ±‚å‡ºå•†å“çš„å¹³å‡ä»·æ ¼ï¼Œå¹¶å¯¹åˆ†ç»„ç»“æœè¿›è¡Œç™¾åˆ†æ¯”æ“ä½œ 123456789101112131415161718192021222324GET /shopping/_search&#123; &quot;size&quot;: 0, &quot;aggs&quot;: &#123; &quot;category_buckets&quot;: &#123; &quot;terms&quot;: &#123; &quot;field&quot;: &quot;category&quot;, &quot;size&quot;: 10 &#125;, &quot;aggs&quot;: &#123; &quot;avg_price&quot;: &#123; &quot;avg&quot;: &#123; &quot;field&quot;: &quot;price&quot; &#125; &#125; &#125; &#125;, &quot;percentiles_price_by_category&quot;:&#123; &quot;percentiles_bucket&quot;: &#123; # å¯¹èšåˆç»“æœè¿›è¡Œç»Ÿè®¡æ“ä½œ &quot;buckets_path&quot;: &quot;category_buckets&gt;avg_price&quot; # æŒ‡å®šè·¯å¾„ï¼Œå¯¹category_bucketsèšåˆç»“æœä¸­çš„avg_priceå­—æ®µè¿›è¡Œç»Ÿè®¡æ“ä½œ &#125; &#125; &#125;&#125; Cumulative Sum Cumulative Sumï¼šå¯¹èšåˆåˆ†æçš„ç»“æœè¿›è¡Œç´¯è®¡æ±‚å’Œæ“ä½œã€‚ ç¤ºä¾‹: æŒ‰ç…§ä»·æ ¼è¿›è¡Œåˆ†ç»„ï¼Œå¹¶ç»Ÿè®¡å¹³å‡ä»·æ ¼ä¿¡æ¯ï¼Œå¯¹åˆ†ç»„ç»“æœè¿›è¡Œç´¯è®¡æ±‚å’Œæ“ä½œã€‚ 12345678910111213141516171819202122232425262728GET /shopping/_search&#123; &quot;size&quot;: 0, &quot;aggs&quot;: &#123; &quot;price_histogram&quot;: &#123; &quot;histogram&quot;: &#123; &quot;field&quot;: &quot;price&quot;, &quot;interval&quot;: 500, # é—´éš”500 &quot;extended_bounds&quot;:&#123; # è®¾ç½®è¾¹ç•Œ &quot;min&quot;:0, # æœ€å°å€¼0 &quot;max&quot;:2000 # æœ€å¤§å€¼2000 &#125; &#125;, &quot;aggs&quot;: &#123; &quot;avg_price&quot;: &#123; &quot;avg&quot;: &#123; &quot;field&quot;: &quot;price&quot; &#125; &#125;, &quot;cumulative_sum_price&quot;: &#123; &quot;cumulative_sum&quot;: &#123; # å¯¹èšåˆç»“æœè¿›è¡Œç´¯è®¡æ±‚å’Œæ“ä½œ &quot;buckets_path&quot;: &quot;avg_price&quot; # æŒ‡å®šè·¯å¾„ï¼Œå¯¹avg_priceå­—æ®µè¿›è¡Œç´¯è®¡æ±‚å’Œæ“ä½œ &#125; &#125; &#125; &#125; &#125;&#125; Derivative Derivativeï¼šå¯¹èšåˆåˆ†æçš„ç»“æœè¿›è¡Œæ±‚å¯¼æ“ä½œã€‚ Derivative èšåˆæŸ¥è¯¢æ˜¯ Elasticsearch ä¸­çš„ä¸€ç§é«˜çº§èšåˆç±»å‹ï¼Œç”¨äºè®¡ç®—æŸä¸ªåº¦é‡å€¼éšæ—¶é—´ï¼ˆæˆ–å…¶ä»–é¡ºåºå­—æ®µï¼‰å˜åŒ–çš„é€Ÿç‡ã€‚å®ƒé€šå¸¸ç”¨äºæ—¶é—´åºåˆ—åˆ†æï¼Œä»¥æ­ç¤ºåº¦é‡å€¼çš„å¢å‡è¶‹åŠ¿ã€‚ ç¤ºä¾‹ï¼šæ˜¾ç¤ºæ¯å¤©çš„å¹³å‡ä»·æ ¼ä»¥åŠå¹³å‡ä»·æ ¼çš„å˜åŒ–è¶‹åŠ¿ 123456789101112131415161718192021222324GET /shopping/_search&#123; &quot;size&quot;: 0, &quot;aggs&quot;: &#123; &quot;price_over_time&quot;: &#123; &quot;date_histogram&quot;: &#123; # æŒ‰ç…§æ—¥æœŸè¿›è¡Œåˆ†ç»„ &quot;field&quot;: &quot;created_at&quot;, # æŒ‡å®šå­—æ®µ &quot;calendar_interval&quot;: &quot;day&quot; # æŒ‡å®šæ—¶é—´é—´éš”ï¼Œå¯ç”¨çš„å€¼ï¼šyearã€quarterã€monthã€weekã€dayã€hourã€minuteã€second &#125;, &quot;aggs&quot;: &#123; &quot;average_price&quot;: &#123; &quot;avg&quot;: &#123; &quot;field&quot;: &quot;price&quot; &#125; &#125;, &quot;price_derivative&quot;: &#123; &quot;derivative&quot;: &#123; # å¯¹èšåˆç»“æœè¿›è¡Œæ±‚å¯¼æ“ä½œ &quot;buckets_path&quot;: &quot;average_price&quot; &#125; &#125; &#125; &#125; &#125;&#125; Moving Function Moving Functionï¼šå¯¹èšåˆåˆ†æçš„ç»“æœè¿›è¡Œç§»åŠ¨å¹³å‡å€¼æ“ä½œã€‚ Moving Function èšåˆæŸ¥è¯¢æ˜¯ Elasticsearch ä¸­çš„ä¸€ç§é«˜çº§èšåˆç±»å‹ï¼Œç”¨äºè®¡ç®—æŸä¸ªåº¦é‡å€¼åœ¨æ—¶é—´çª—å£å†…çš„ç§»åŠ¨å¹³å‡å€¼ã€‚å®ƒé€šå¸¸ç”¨äºæ—¶é—´åºåˆ—åˆ†æï¼Œä»¥äº†è§£åº¦é‡å€¼çš„å˜åŒ–è¶‹åŠ¿ã€‚ ç¤ºä¾‹ï¼šè®¡ç®— price å­—æ®µçš„ 7 å¤©ç§»åŠ¨å¹³å‡å€¼ 123456789101112131415161718192021222324252627GET /shopping/_search&#123; &quot;size&quot;: 0, &quot;aggs&quot;: &#123; &quot;price_over_time&quot;: &#123; &quot;date_histogram&quot;: &#123; &quot;field&quot;: &quot;created_at&quot;, &quot;calendar_interval&quot;: &quot;day&quot; &#125;, &quot;aggs&quot;: &#123; &quot;daily_avg_price&quot;: &#123; &quot;avg&quot;: &#123; &quot;field&quot;: &quot;price&quot; &#125; &#125;, &quot;moving_avg_price&quot;: &#123; &quot;moving_fn&quot;: &#123; # å¯¹èšåˆç»“æœè¿›è¡Œç§»åŠ¨å¹³å‡å€¼æ“ä½œ &quot;buckets_path&quot;: &quot;daily_avg_price&quot;, # æŒ‡å®šè·¯å¾„ï¼Œå¯¹daily_avg_priceå­—æ®µè¿›è¡Œç§»åŠ¨å¹³å‡å€¼æ“ä½œ &quot;script&quot;: &quot;MovingFunctions.unweightedAvg(values)&quot;, # æŒ‡å®šè„šæœ¬ï¼Œè®¡ç®—ç§»åŠ¨å¹³å‡å€¼ &quot;window&quot;: 7, # çª—å£å¤§å°ï¼Œé»˜è®¤ä¸º 10 &quot;shift&quot;: 0 # çª—å£åç§»é‡ï¼Œé»˜è®¤ä¸º 0 &#125; &#125; &#125; &#125; &#125;&#125; ES èšåˆæ€§èƒ½ä¼˜åŒ– ç´¢å¼•é¢„æ’åº å¦‚æœæ˜¯ Elasticsearch 6.X ä¹‹åç‰ˆæœ¬ï¼Œå¯ä»¥åœ¨æ’å…¥æ•°æ®æ—¶å¯¹ç´¢å¼•è¿›è¡Œé¢„æ’åºï¼Œè€Œä¸æ˜¯åœ¨æŸ¥è¯¢æ—¶å†å¯¹ç´¢å¼•è¿›è¡Œæ’åºï¼Œè¿™å°†æé«˜èŒƒå›´æŸ¥è¯¢ï¼ˆrange queryï¼‰å’Œæ’åºæ“ä½œçš„æ€§èƒ½ã€‚ ä½†é¢„æ’åºå°†å¢åŠ  Elasticsearch å†™å…¥çš„æˆæœ¬ï¼Œå¯¼è‡´å¤§çº¦ 40%-50% çš„å†™æ€§èƒ½ä¸‹é™ï¼Œå¦‚æœåº”ç”¨åœºæ™¯æ˜¯æ›´å…³æ³¨å†™æ€§èƒ½çš„ä¸šåŠ¡ï¼Œå¼€å¯ç´¢å¼•é¢„æ’åºä¸æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é€‰æ‹©ã€‚ 12345678910111213141516PUT /my_index&#123; &quot;settings&quot;: &#123; &quot;index&quot;:&#123; &quot;sort.field&quot;: &quot;create_time&quot;, &quot;sort.order&quot;: &quot;desc&quot; &#125; &#125;, &quot;mappings&quot;: &#123; &quot;properties&quot;: &#123; &quot;create_time&quot;:&#123; &quot;type&quot;: &quot;date&quot; &#125; &#125; &#125;&#125; ä½¿ç”¨åˆ†ç‰‡è¯·æ±‚ç¼“å­˜ èšåˆè¯­å¥ä¸­ï¼Œè®¾ç½®ï¼šsizeï¼š0ï¼Œå°±ä¼šä½¿ç”¨åˆ†ç‰‡è¯·æ±‚ç¼“å­˜ç¼“å­˜ç»“æœã€‚size = 0 çš„å«ä¹‰æ˜¯ï¼šåªè¿”å›èšåˆç»“æœï¼Œä¸è¿”å›æŸ¥è¯¢ç»“æœã€‚ 1234567891011GET /my_index/_search&#123; &quot;size&quot;: 0, &quot;aggs&quot;: &#123; &quot;remark_agg&quot;: &#123; &quot;terms&quot;: &#123; &quot;field&quot;: &quot;remark.keyword&quot; &#125; &#125; &#125;&#125; æ‹†åˆ†èšåˆï¼Œä½¿èšåˆå¹¶è¡ŒåŒ– Elasticsearch æŸ¥è¯¢æ¡ä»¶ä¸­åŒæ—¶æœ‰å¤šä¸ªæ¡ä»¶èšåˆï¼Œé»˜è®¤æƒ…å†µä¸‹èšåˆä¸æ˜¯å¹¶è¡Œè¿è¡Œçš„ã€‚ å½“ä¸ºæ¯ä¸ªèšåˆæä¾›è‡ªå·±çš„æŸ¥è¯¢å¹¶æ‰§è¡Œ msearch æ—¶ï¼Œæ€§èƒ½ä¼šæœ‰æ˜¾è‘—æå‡ã€‚ å› æ­¤ï¼Œåœ¨ CPU èµ„æºä¸æ˜¯ç“¶é¢ˆçš„å‰æä¸‹ï¼Œå¦‚æœæƒ³ç¼©çŸ­å“åº”æ—¶é—´ï¼Œå¯ä»¥å°†å¤šä¸ªèšåˆæ‹†åˆ†ä¸ºå¤šä¸ªæŸ¥è¯¢ï¼Œå€ŸåŠ©ï¼šmsearch å®ç°å¹¶è¡Œèšåˆã€‚ 1234567891011121314151617181920212223#å¸¸è§„çš„å¤šæ¡ä»¶èšåˆå®ç°GET /employees/_search&#123; &quot;size&quot;: 0, &quot;aggs&quot;: &#123; &quot;job_agg&quot;: &#123; &quot;terms&quot;: &#123; &quot;field&quot;: &quot;job.keyword&quot; &#125; &#125;, &quot;max_salary&quot;:&#123; &quot;max&quot;: &#123; &quot;field&quot;: &quot;salary&quot; &#125; &#125; &#125;&#125;# msearch æ‹†åˆ†å¤šä¸ªè¯­å¥çš„èšåˆå®ç°GET _msearch&#123;&quot;index&quot;:&quot;employees&quot;&#125;&#123;&quot;size&quot;:0,&quot;aggs&quot;:&#123;&quot;job_agg&quot;:&#123;&quot;terms&quot;:&#123;&quot;field&quot;: &quot;job.keyword&quot;&#125;&#125;&#125;&#125;&#123;&quot;index&quot;:&quot;employees&quot;&#125;&#123;&quot;size&quot;:0,&quot;aggs&quot;:&#123;&quot;max_salary&quot;:&#123;&quot;max&quot;:&#123;&quot;field&quot;: &quot;salary&quot;&#125;&#125;&#125;&#125;","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» Elasticsearch çš„ REST APIsï¼šèšåˆæŸ¥è¯¢ Elasticsearchç‰ˆæœ¬8.17.3 å®˜æ–¹æ–‡æ¡£:REST APIs å®˜æ–¹æ–‡æ¡£:Aggregations Elasticsearch çš„ REST APIs","date_published":"2025-04-22T13:30:05.000Z","tags":["æŠ€æœ¯","elastic","elasticsearch","elasticsearch"]},{"id":"https://blog.hanqunfeng.com/2025/04/17/elasticsearch-05-api/","url":"https://blog.hanqunfeng.com/2025/04/17/elasticsearch-05-api/","title":"Elasticsearch çš„ REST APIs","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç» Elasticsearch çš„ REST APIs</p>\n</li>\n<li class=\"lvl-2\">\n<p>Elasticsearchç‰ˆæœ¬8.17.3</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://www.elastic.co/guide/en/elasticsearch/reference/8.17/rest-apis.html\">å®˜æ–¹æ–‡æ¡£:REST APIs</a></p>\n</li>\n<li class=\"lvl-2\">\n<a href=\"/2025/04/22/elasticsearch-06-api-aggs/\" title=\"Elasticsearch çš„ REST APIs:èšåˆæŸ¥è¯¢\">Elasticsearch çš„ REST APIs:èšåˆæŸ¥è¯¢</a>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"è¿”å›å†…å®¹æ ¼å¼åŒ–\">è¿”å›å†…å®¹æ ¼å¼åŒ–</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¿”å›jsonä¿¡æ¯æ ¼å¼: <code>?pretty</code> è¾“å‡ºæ ¼å¼åŒ–åçš„jsonï¼Œæ¯”å¦‚ï¼š<code>curl http://localhost:9200/_cluster/health?pretty</code></p>\n</li>\n<li class=\"lvl-2\">\n<p>è¿”å›è¡Œä¿¡æ¯æ ¼å¼: <code>?v</code> è¾“å‡ºå†…å®¹ä¸Šæ–¹ä¼šåŠ ä¸Šæ ‡é¢˜è¡Œï¼Œæ¯”å¦‚ï¼š<code>curl http://localhost:9200/_cat/health?v</code></p>\n</li>\n</ul>\n<h2 id=\"CAT-APIs\">CAT APIs</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Elasticsearch æä¾›äº† <a href=\"https://www.elastic.co/guide/en/elasticsearch/reference/8.17/cat.html\">CAT APIs</a>ï¼Œå®ƒä»¬æä¾›äº†ä¸€ç§ç®€å•çš„æ–¹å¼æ¥æŸ¥çœ‹é›†ç¾¤çŠ¶æ€å’Œé›†ç¾¤ä¸­çš„å„ç§èµ„æºï¼Œæ¯”å¦‚ç´¢å¼•ã€åˆ†ç‰‡ã€èŠ‚ç‚¹ç­‰ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">GET     /_cat/health             <span class=\"comment\">#æŸ¥çœ‹é›†ç¾¤å½“å‰çŠ¶æ€ï¼šçº¢ã€é»„ã€ç»¿</span></span><br><span class=\"line\">GET     /_cat/master             <span class=\"comment\">#æŸ¥çœ‹masterèŠ‚ç‚¹ä¿¡æ¯</span></span><br><span class=\"line\">GET     /_cat/nodes              <span class=\"comment\">#æŸ¥çœ‹æ‰€æœ‰èŠ‚ç‚¹ä¿¡æ¯</span></span><br><span class=\"line\">GET     /_cat/plugins            <span class=\"comment\">#æŸ¥çœ‹é›†ç¾¤å„ä¸ªèŠ‚ç‚¹ä¸Šçš„pluginä¿¡æ¯</span></span><br><span class=\"line\">GET     /_cat/indices            <span class=\"comment\">#æŸ¥çœ‹é›†ç¾¤ä¸­æ‰€æœ‰indexçš„è¯¦ç»†ä¿¡æ¯</span></span><br><span class=\"line\">GET     /_cat/indices/&#123;index&#125;    <span class=\"comment\">#æŸ¥çœ‹é›†ç¾¤ä¸­æŒ‡å®šindexçš„è¯¦ç»†ä¿¡æ¯ï¼Œindexï¼šç´¢å¼•åç§°</span></span><br><span class=\"line\">GET     /_cat/allocation         <span class=\"comment\">#æŸ¥çœ‹å•èŠ‚ç‚¹çš„shardåˆ†é…æ•´ä½“æƒ…å†µ</span></span><br><span class=\"line\">GET     /_cat/shards             <span class=\"comment\">#æŸ¥çœ‹å„shardçš„è¯¦ç»†æƒ…å†µ</span></span><br><span class=\"line\">GET     /_cat/shards/&#123;index&#125;     <span class=\"comment\">#æŸ¥çœ‹æŒ‡å®šåˆ†ç‰‡çš„è¯¦ç»†æƒ…å†µ</span></span><br><span class=\"line\">GET     /_cat/segments           <span class=\"comment\">#æŸ¥çœ‹å„indexçš„segmentè¯¦ç»†ä¿¡æ¯,åŒ…æ‹¬segmentå, æ‰€å±shard, å†…å­˜(ç£ç›˜)å ç”¨å¤§å°, æ˜¯å¦åˆ·ç›˜</span></span><br><span class=\"line\">GET     /_cat/segments/&#123;index&#125;   <span class=\"comment\">#æŸ¥çœ‹æŒ‡å®šindexçš„segmentè¯¦ç»†ä¿¡æ¯</span></span><br><span class=\"line\">GET     /_cat/count              <span class=\"comment\">#æŸ¥çœ‹å½“å‰é›†ç¾¤çš„docæ•°é‡</span></span><br><span class=\"line\">GET     /_cat/count/&#123;index&#125;      <span class=\"comment\">#æŸ¥çœ‹æŒ‡å®šç´¢å¼•çš„docæ•°é‡</span></span><br><span class=\"line\">GET     /_cat/recovery           <span class=\"comment\">#æŸ¥çœ‹é›†ç¾¤å†…æ¯ä¸ªshardçš„recoveryè¿‡ç¨‹.è°ƒæ•´replicaã€‚</span></span><br><span class=\"line\">GET     /_cat/recovery/&#123;index&#125;   <span class=\"comment\">#æŸ¥çœ‹æŒ‡å®šç´¢å¼•shardçš„recoveryè¿‡ç¨‹</span></span><br><span class=\"line\">GET     /_cat/pending_tasks      <span class=\"comment\">#æŸ¥çœ‹å½“å‰é›†ç¾¤çš„pending task</span></span><br><span class=\"line\">GET     /_cat/aliases            <span class=\"comment\">#æŸ¥çœ‹é›†ç¾¤ä¸­æ‰€æœ‰aliasä¿¡æ¯,è·¯ç”±é…ç½®ç­‰</span></span><br><span class=\"line\">GET     /_cat/aliases/&#123;<span class=\"built_in\">alias</span>&#125;    <span class=\"comment\">#æŸ¥çœ‹æŒ‡å®šç´¢å¼•çš„aliasä¿¡æ¯</span></span><br><span class=\"line\">GET     /_cat/thread_pool        <span class=\"comment\">#æŸ¥çœ‹é›†ç¾¤å„èŠ‚ç‚¹å†…éƒ¨ä¸åŒç±»å‹çš„threadpoolçš„ç»Ÿè®¡ä¿¡æ¯,</span></span><br><span class=\"line\">GET     /_cat/fielddata          <span class=\"comment\">#æŸ¥çœ‹å½“å‰é›†ç¾¤å„ä¸ªèŠ‚ç‚¹çš„fielddataå†…å­˜ä½¿ç”¨æƒ…å†µ</span></span><br><span class=\"line\">GET     /_cat/fielddata/&#123;fields&#125; <span class=\"comment\">#æŸ¥çœ‹æŒ‡å®šfieldçš„å†…å­˜ä½¿ç”¨æƒ…å†µ,é‡Œé¢ä¼ fieldå±æ€§å¯¹åº”çš„å€¼</span></span><br><span class=\"line\">GET     /_cat/nodeattrs          <span class=\"comment\">#æŸ¥çœ‹å•èŠ‚ç‚¹çš„è‡ªå®šä¹‰å±æ€§</span></span><br><span class=\"line\">GET     /_cat/repositories       <span class=\"comment\">#è¾“å‡ºé›†ç¾¤ä¸­æ³¨å†Œå¿«ç…§å­˜å‚¨åº“</span></span><br><span class=\"line\">GET     /_cat/templates          <span class=\"comment\">#è¾“å‡ºå½“å‰æ­£åœ¨å­˜åœ¨çš„æ¨¡æ¿ä¿¡æ¯</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"Cluster-APIs\">Cluster APIs</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Elasticsearch æä¾›äº†ä¸€ç³»åˆ—çš„ <a href=\"https://www.elastic.co/guide/en/elasticsearch/reference/8.17/cluster.html\">Cluster APIs</a>ï¼Œå®ƒä»¬æä¾›äº†ç®¡ç†å’Œç›‘æ§é›†ç¾¤çŠ¶æ€çš„åŠŸèƒ½</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">GET     /_cluster/health            <span class=\"comment\"># è·å–é›†ç¾¤çš„å¥åº·çŠ¶æ€ä¿¡æ¯ï¼ŒåŒ…æ‹¬äº†é›†ç¾¤æ€»ä½“çš„çŠ¶å†µå¦‚statusã€number_of_nodesç­‰ã€‚</span></span><br><span class=\"line\">GET     /_cluster/stats             <span class=\"comment\"># æä¾›æ•´ä¸ªé›†ç¾¤å±‚é¢çš„ç»Ÿè®¡ä¿¡æ¯ï¼ŒåŒ…å«ç´¢å¼•ã€èŠ‚ç‚¹å’Œå…¶ä»–é«˜çº§æŒ‡æ ‡ã€‚</span></span><br><span class=\"line\">GET     /_cluster/state             <span class=\"comment\"># æ˜¾ç¤ºé›†ç¾¤å…ƒæ•°æ®çš„çŠ¶æ€ï¼ŒåŒ…æ‹¬è®¾ç½®ã€å—ã€è·¯ç”±è¡¨åŠå…ƒæ•°æ®ç­‰ï¼Œå…è®¸ç”¨æˆ·æŸ¥çœ‹é›†ç¾¤çš„å½“å‰è§†å›¾ã€‚</span></span><br><span class=\"line\">POST    /_cluster/reroute           <span class=\"comment\"># POSTè¯·æ±‚ï¼Œç”¨äºæ‰‹åŠ¨æ”¹å˜åˆ†ç‰‡åˆ†é…æƒ…å†µï¼Œå¯ä»¥å®ç°å¦‚è¿ç§»åˆ†ç‰‡ã€å–æ¶ˆåˆ†é…ç­‰æ“ä½œã€‚</span></span><br><span class=\"line\">GET     /_cluster/nodes/hot_threads <span class=\"comment\"># è¿”å›é›†ç¾¤ä¸­å„ä¸ªèŠ‚ç‚¹â€œæœ€çƒ­â€çš„çº¿ç¨‹å †æ ˆè·Ÿè¸ªï¼Œé»˜è®¤æ˜¾ç¤ºå‰ä¸‰ä¸ªCPUæ—¶é—´æœ€é•¿çš„çº¿ç¨‹ã€‚</span></span><br><span class=\"line\">GET     /_cluster/allocation/explain <span class=\"comment\"># è§£é‡Šä¸ºä½•æŸä¸ªåˆ†ç‰‡è¢«å¦‚æ­¤åˆ†é…ï¼Œå¹¶æä¾›å¦‚ä½•è°ƒæ•´çš„å»ºè®®ã€‚</span></span><br><span class=\"line\">GET     /_cluster/pending_tasks     <span class=\"comment\"># åˆ—å‡ºæ‰€æœ‰ç­‰å¾…æ‰§è¡Œçš„ä»»åŠ¡åˆ—è¡¨ã€‚</span></span><br><span class=\"line\">GET     /_cluster/settings          <span class=\"comment\"># æŸ¥çœ‹æ•´ä¸ªé›†ç¾¤çº§åˆ«çš„è®¾ç½®ã€‚</span></span><br><span class=\"line\">PUT     /_cluster/settings          <span class=\"comment\"># æ›´æ–°æ•´ä¸ªé›†ç¾¤çº§åˆ«çš„è®¾ç½®ã€‚</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"Index-APIs\">Index APIs</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Elasticsearch æä¾›äº† <a href=\"https://www.elastic.co/guide/en/elasticsearch/reference/8.17/indices.html\">Index APIs</a>ï¼Œå®ƒä»¬æä¾›äº†å¯¹ç´¢å¼•çš„åˆ›å»ºã€æ›´æ–°ã€æŸ¥è¯¢å’Œåˆ é™¤ç­‰æ“ä½œã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>åˆ›å»ºç´¢å¼•</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># PUT /&lt;target&gt;</span></span><br><span class=\"line\"><span class=\"comment\"># è¿™é‡Œ shopping ä¸ºç´¢å¼•åç§°ï¼Œä½†æ­¤æ—¶æ²¡æœ‰ä¸ºç´¢å¼•è®¾ç½®åˆ†ç‰‡ç­–ç•¥ï¼Œä¹Ÿæ²¡æœ‰è®¾ç½®å­—æ®µä¿¡æ¯</span></span><br><span class=\"line\">curl -X PUT -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/shopping&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"># è¿”å›å€¼</span></span><br><span class=\"line\">&#123;<span class=\"string\">&quot;acknowledged&quot;</span>:<span class=\"literal\">true</span>,<span class=\"string\">&quot;shards_acknowledged&quot;</span>:<span class=\"literal\">true</span>,<span class=\"string\">&quot;index&quot;</span>:<span class=\"string\">&quot;shopping&quot;</span>&#125;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ›å»ºç´¢å¼•å¹¶è®¾ç½®ç´¢å¼•</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># PUT /&lt;target&gt;</span></span><br><span class=\"line\">curl -X PUT -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/shopping&#x27;</span> \\</span><br><span class=\"line\">  -H <span class=\"string\">&#x27;Content-Type: application/json&#x27;</span> \\</span><br><span class=\"line\">  -d <span class=\"string\">&#x27;&#123;&quot;settings&quot;:&#123;&quot;number_of_shards&quot;:&quot;1&quot;,&quot;number_of_replicas&quot;:&quot;2&quot;&#125;&#125;&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"># è¿”å›å€¼</span></span><br><span class=\"line\">&#123;<span class=\"string\">&quot;acknowledged&quot;</span>:<span class=\"literal\">true</span>,<span class=\"string\">&quot;shards_acknowledged&quot;</span>:<span class=\"literal\">true</span>,<span class=\"string\">&quot;index&quot;</span>:<span class=\"string\">&quot;shopping&quot;</span>&#125;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ›å»ºå¹¶æ˜ å°„ç´¢å¼•</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># PUT /&lt;target&gt;</span></span><br><span class=\"line\"><span class=\"comment\"># è¿™é‡Œè®¾ç½®ç´¢å¼•åˆ†ç‰‡æ•°é‡ä¸º1ï¼Œå‰¯æœ¬æ•°é‡ä¸º2ï¼Œå¹¶è®¾ç½®å­—æ®µä¿¡æ¯</span></span><br><span class=\"line\">curl -X PUT -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/shopping&#x27;</span> \\</span><br><span class=\"line\">  -H <span class=\"string\">&#x27;Content-Type: application/json&#x27;</span> \\</span><br><span class=\"line\">  -d <span class=\"string\">&#x27;&#123;</span></span><br><span class=\"line\"><span class=\"string\">    &quot;settings&quot;:&#123;</span></span><br><span class=\"line\"><span class=\"string\">      &quot;number_of_shards&quot;:&quot;1&quot;,</span></span><br><span class=\"line\"><span class=\"string\">      &quot;number_of_replicas&quot;:&quot;2&quot;</span></span><br><span class=\"line\"><span class=\"string\">    &#125;,</span></span><br><span class=\"line\"><span class=\"string\">    &quot;mappings&quot;:&#123;</span></span><br><span class=\"line\"><span class=\"string\">      &quot;properties&quot;:&#123;</span></span><br><span class=\"line\"><span class=\"string\">        &quot;title&quot;:&#123;</span></span><br><span class=\"line\"><span class=\"string\">          &quot;type&quot;:&quot;text&quot;</span></span><br><span class=\"line\"><span class=\"string\">        &#125;,</span></span><br><span class=\"line\"><span class=\"string\">        &quot;category&quot;:&#123;</span></span><br><span class=\"line\"><span class=\"string\">          &quot;type&quot;:&quot;keyword&quot;</span></span><br><span class=\"line\"><span class=\"string\">        &#125;,</span></span><br><span class=\"line\"><span class=\"string\">        &quot;price&quot;:&#123;</span></span><br><span class=\"line\"><span class=\"string\">          &quot;type&quot;:&quot;double&quot;</span></span><br><span class=\"line\"><span class=\"string\">        &#125;,</span></span><br><span class=\"line\"><span class=\"string\">        &quot;count&quot;:&#123;</span></span><br><span class=\"line\"><span class=\"string\">          &quot;type&quot;:&quot;integer&quot;</span></span><br><span class=\"line\"><span class=\"string\">        &#125;</span></span><br><span class=\"line\"><span class=\"string\">      &#125;</span></span><br><span class=\"line\"><span class=\"string\">    &#125;</span></span><br><span class=\"line\"><span class=\"string\">  &#125;&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å‚æ•°è¯´æ˜</span></span><br><span class=\"line\"><span class=\"comment\">## settings: è¿™ä¸ªå‚æ•°ç”¨äºé…ç½®ç´¢å¼•çš„è®¾ç½®ï¼ŒåŒ…æ‹¬åˆ†ç‰‡æ•°é‡å’Œå‰¯æœ¬æ•°é‡ã€‚</span></span><br><span class=\"line\"><span class=\"comment\">### number_of_shards: è¿™ä¸ªå‚æ•°æŒ‡å®šäº†ç´¢å¼•ä¸­åˆ†ç‰‡çš„æ•°é‡ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œnumber_of_shards è®¾ç½®ä¸º 1ï¼Œæ„å‘³ç€ç´¢å¼•å°†åªæœ‰ä¸€ä¸ªä¸»åˆ†ç‰‡ã€‚</span></span><br><span class=\"line\"><span class=\"comment\">### number_of_replicas: è¿™ä¸ªå‚æ•°æŒ‡å®šäº†æ¯ä¸ªä¸»åˆ†ç‰‡çš„å‰¯æœ¬æ•°é‡ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œnumber_of_replicas è®¾ç½®ä¸º 2ï¼Œæ„å‘³ç€æ¯ä¸ªä¸»åˆ†ç‰‡å°†æœ‰ä¸¤ä¸ªå‰¯æœ¬ã€‚</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">## mappings: è¿™ä¸ªå‚æ•°ç”¨äºå®šä¹‰ç´¢å¼•ä¸­çš„å­—æ®µå’Œå­—æ®µç±»å‹ã€‚</span></span><br><span class=\"line\"><span class=\"comment\">### properties: è¿™ä¸ªå‚æ•°å®šä¹‰äº†ç´¢å¼•ä¸­çš„å­—æ®µå’Œå­—æ®µç±»å‹ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæœ‰å››ä¸ªå­—æ®µï¼štitleã€categoryã€images å’Œ priceã€‚</span></span><br><span class=\"line\"><span class=\"comment\">### title: è¿™ä¸ªå­—æ®µçš„ç±»å‹æ˜¯ textï¼Œè¡¨ç¤ºå®ƒæ˜¯ä¸€ä¸ªå…¨æ–‡æ£€ç´¢å­—æ®µã€‚text é€‚åˆå­˜å‚¨é•¿æ–‡æœ¬æ•°æ®ï¼Œå¹¶æ”¯æŒå…¨æ–‡æœç´¢ã€‚</span></span><br><span class=\"line\"><span class=\"comment\">### category: è¿™ä¸ªå­—æ®µçš„ç±»å‹æ˜¯ keywordï¼Œè¡¨ç¤ºå®ƒæ˜¯ä¸€ä¸ªå…³é”®å­—å­—æ®µï¼Œä¸æ”¯æŒå…¨æ–‡æ£€ç´¢ã€‚keyword é€‚åˆå­˜å‚¨ä¸éœ€è¦åˆ†è¯çš„çŸ­æ–‡æœ¬æ•°æ®ï¼ˆå¦‚æ ‡ç­¾ã€ç±»åˆ«ç­‰ï¼‰ï¼Œå¹¶ä¸”å¯ä»¥ç”¨äºèšåˆå’Œè¿‡æ»¤ã€‚</span></span><br><span class=\"line\"><span class=\"comment\">### price: è¿™ä¸ªå­—æ®µçš„ç±»å‹æ˜¯ doubleï¼Œè¡¨ç¤ºå®ƒæ˜¯ä¸€ä¸ªæ•°å­—å­—æ®µã€‚double è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªåŒç²¾åº¦æµ®ç‚¹æ•°å­—æ®µï¼Œé€‚åˆå­˜å‚¨æ•°å€¼æ•°æ®ï¼Œå¦‚ä»·æ ¼</span></span><br><span class=\"line\"><span class=\"comment\">### count: è¿™ä¸ªå­—æ®µçš„ç±»å‹æ˜¯ integerï¼Œè¡¨ç¤ºå®ƒæ˜¯ä¸€ä¸ªæ•´æ•°å­—æ®µã€‚integer è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªæ•´æ•°å­—æ®µï¼Œé€‚åˆå­˜å‚¨æ•´æ•°æ•°æ®ï¼Œå¦‚å•†å“æ•°é‡ç­‰ã€‚</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># è¿”å›å€¼</span></span><br><span class=\"line\">&#123;<span class=\"string\">&quot;acknowledged&quot;</span>:<span class=\"literal\">true</span>,<span class=\"string\">&quot;shards_acknowledged&quot;</span>:<span class=\"literal\">true</span>,<span class=\"string\">&quot;index&quot;</span>:<span class=\"string\">&quot;shopping&quot;</span>&#125;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ›´æ–°ç´¢å¼•æ˜ å°„</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># PUT /&lt;target&gt;/_mapping</span></span><br><span class=\"line\"><span class=\"comment\"># æ³¨æ„è¯¥apiåªèƒ½å¢åŠ æ–°çš„å­—æ®µï¼Œä¸èƒ½ä¿®æ”¹å·²æœ‰å­—æ®µï¼Œå¦‚æœè¦ä¿®æ”¹æºå­—æ®µç±»å‹æˆ–è€…åˆ†è¯å™¨ç±»å‹ï¼Œä¸‹æ–‡ä¼šä»‹ç»</span></span><br><span class=\"line\">curl -X PUT -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/shopping/_mapping&#x27;</span> \\</span><br><span class=\"line\">  -H <span class=\"string\">&#x27;Content-Type: application/json&#x27;</span> \\</span><br><span class=\"line\">  -d <span class=\"string\">&#x27;&#123;</span></span><br><span class=\"line\"><span class=\"string\">    &quot;properties&quot;:&#123;</span></span><br><span class=\"line\"><span class=\"string\">      &quot;remark&quot;:&#123;</span></span><br><span class=\"line\"><span class=\"string\">        &quot;type&quot;:&quot;text&quot;,</span></span><br><span class=\"line\"><span class=\"string\">        &quot;analyzer&quot;:&quot;ik_max_word&quot;,</span></span><br><span class=\"line\"><span class=\"string\">        &quot;search_analyzer&quot;:&quot;ik_smart&quot;</span></span><br><span class=\"line\"><span class=\"string\">      &#125;,</span></span><br><span class=\"line\"><span class=\"string\">      &quot;address&quot;: &#123;</span></span><br><span class=\"line\"><span class=\"string\">        &quot;type&quot;: &quot;text&quot;,</span></span><br><span class=\"line\"><span class=\"string\">        &quot;analyzer&quot;: &quot;ik_max_word&quot;,</span></span><br><span class=\"line\"><span class=\"string\">        &quot;fields&quot;: &#123;</span></span><br><span class=\"line\"><span class=\"string\">          &quot;keyword&quot;: &#123;</span></span><br><span class=\"line\"><span class=\"string\">            &quot;type&quot;: &quot;keyword&quot;</span></span><br><span class=\"line\"><span class=\"string\">          &#125;</span></span><br><span class=\"line\"><span class=\"string\">        &#125;</span></span><br><span class=\"line\"><span class=\"string\">      &#125;,</span></span><br><span class=\"line\"><span class=\"string\">      &quot;tags&quot;: &#123;</span></span><br><span class=\"line\"><span class=\"string\">        &quot;type&quot;: &quot;keyword&quot;</span></span><br><span class=\"line\"><span class=\"string\">      &#125;,</span></span><br><span class=\"line\"><span class=\"string\">      &quot;created_at&quot;: &#123;&quot;type&quot;: &quot;date&quot;, &quot;format&quot;: &quot;yyyy-MM-dd HH:mm:ss&quot;&#125;</span></span><br><span class=\"line\"><span class=\"string\">    &#125;</span></span><br><span class=\"line\"><span class=\"string\">  &#125;&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"># å‚æ•°è¯´æ˜</span></span><br><span class=\"line\"><span class=\"comment\"># è¿™é‡Œä¸ºç´¢å¼•æ·»åŠ äº†4ä¸ªå­—æ®µ</span></span><br><span class=\"line\"><span class=\"comment\"># remarkï¼šæ–°å¢å­—æ®µï¼Œç±»å‹ä¸ºtextï¼Œåˆ†è¯å™¨ä¸ºik_max_wordï¼Œæœç´¢åˆ†è¯å™¨ä¸ºik_smart</span></span><br><span class=\"line\">  <span class=\"comment\"># analyzer: ç´¢å¼•åˆ†è¯å™¨</span></span><br><span class=\"line\">  <span class=\"comment\"># search_analyzerï¼šæœç´¢åˆ†è¯å™¨</span></span><br><span class=\"line\">  <span class=\"comment\"># ik_max_wordï¼šä¸­æ–‡åˆ†è¯å™¨ï¼Œå°†å¥å­æ‹†åˆ†ä¸ºæœ€å¤šè¯å…ƒï¼Œé€‚åˆé•¿å¥å­</span></span><br><span class=\"line\">  <span class=\"comment\"># ik_smartï¼šä¸­æ–‡åˆ†è¯å™¨ï¼Œå°†å¥å­æ‹†åˆ†ä¸ºæœ€å°‘è¯å…ƒï¼Œé€‚åˆçŸ­å¥å­</span></span><br><span class=\"line\"><span class=\"comment\"># addressï¼šæ–°å¢å­—æ®µï¼Œç±»å‹ä¸ºtextï¼Œåˆ†è¯å™¨ä¸ºik_max_wordï¼Œæœç´¢åˆ†è¯å™¨æœªæŒ‡å®šï¼Œé»˜è®¤ä¸åˆ†è¯å™¨åŒä¸€ä¸ªï¼Œè¿™é‡Œè¿˜ä¸ºaddressæ·»åŠ äº†keywordå­—æ®µï¼Œç”¨äºå­˜å‚¨åŸå§‹æ•°æ®ï¼Œä»¥æ”¯æŒç²¾ç¡®æœç´¢</span></span><br><span class=\"line\"><span class=\"comment\"># tagsï¼šæ–°å¢å­—æ®µï¼Œç±»å‹ä¸ºkeywordï¼Œä¸æ”¯æŒåˆ†è¯ï¼Œé€‚åˆå­˜å‚¨çŸ­æ–‡æœ¬æ•°æ®ï¼ˆå¦‚æ ‡ç­¾ã€ç±»åˆ«ç­‰ï¼‰ï¼Œå¹¶ä¸”å¯ä»¥ç”¨äºèšåˆå’Œè¿‡æ»¤ï¼Œå¯ä»¥å­˜å‚¨æ•°ç»„</span></span><br><span class=\"line\"><span class=\"comment\"># created_atï¼šæ–°å¢å­—æ®µï¼Œç±»å‹ä¸ºdateï¼Œæ ¼å¼ä¸ºyyyy-MM-dd HH:mm:ss</span></span><br><span class=\"line\"><span class=\"comment\"># è¿”å›å€¼</span></span><br><span class=\"line\">&#123;<span class=\"string\">&quot;acknowledged&quot;</span>:<span class=\"literal\">true</span>&#125;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ›´æ–°ç´¢å¼•è®¾ç½®</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># PUT /&lt;target&gt;/_settings</span></span><br><span class=\"line\"><span class=\"comment\"># æ³¨æ„è¿™é‡Œä¸èƒ½æ›´æ–°number_of_shards</span></span><br><span class=\"line\">curl -X PUT -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/shopping/_settings&#x27;</span> \\</span><br><span class=\"line\">  -H <span class=\"string\">&#x27;Content-Type: application/json&#x27;</span> \\</span><br><span class=\"line\">  -d <span class=\"string\">&#x27;&#123;&quot;number_of_replicas&quot;:&quot;1&quot;&#125;&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"># è¿”å›å€¼</span></span><br><span class=\"line\">&#123;<span class=\"string\">&quot;acknowledged&quot;</span>:<span class=\"literal\">true</span>&#125;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æŸ¥çœ‹æŒ‡å®šç´¢å¼•</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># GET /&lt;target&gt;</span></span><br><span class=\"line\">curl -X GET -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/shopping?pretty&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"># è¿”å›å€¼</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">&quot;shopping&quot;</span> : &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;aliases&quot;</span> : &#123; &#125;,</span><br><span class=\"line\">    <span class=\"string\">&quot;mappings&quot;</span> : &#123;</span><br><span class=\"line\">      <span class=\"string\">&quot;properties&quot;</span> : &#123;</span><br><span class=\"line\">        <span class=\"string\">&quot;address&quot;</span> : &#123;</span><br><span class=\"line\">          <span class=\"string\">&quot;type&quot;</span> : <span class=\"string\">&quot;text&quot;</span>,</span><br><span class=\"line\">          <span class=\"string\">&quot;fields&quot;</span> : &#123;</span><br><span class=\"line\">            <span class=\"string\">&quot;keyword&quot;</span> : &#123;</span><br><span class=\"line\">              <span class=\"string\">&quot;type&quot;</span> : <span class=\"string\">&quot;keyword&quot;</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">          &#125;,</span><br><span class=\"line\">          <span class=\"string\">&quot;analyzer&quot;</span> : <span class=\"string\">&quot;ik_max_word&quot;</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        <span class=\"string\">&quot;category&quot;</span> : &#123;</span><br><span class=\"line\">          <span class=\"string\">&quot;type&quot;</span> : <span class=\"string\">&quot;keyword&quot;</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        <span class=\"string\">&quot;count&quot;</span> : &#123;</span><br><span class=\"line\">          <span class=\"string\">&quot;type&quot;</span> : <span class=\"string\">&quot;integer&quot;</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        <span class=\"string\">&quot;created_at&quot;</span> : &#123;</span><br><span class=\"line\">          <span class=\"string\">&quot;type&quot;</span> : <span class=\"string\">&quot;date&quot;</span>,</span><br><span class=\"line\">          <span class=\"string\">&quot;format&quot;</span> : <span class=\"string\">&quot;yyyy-MM-dd HH:mm:ss&quot;</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        <span class=\"string\">&quot;price&quot;</span> : &#123;</span><br><span class=\"line\">          <span class=\"string\">&quot;type&quot;</span> : <span class=\"string\">&quot;double&quot;</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        <span class=\"string\">&quot;remark&quot;</span> : &#123;</span><br><span class=\"line\">          <span class=\"string\">&quot;type&quot;</span> : <span class=\"string\">&quot;text&quot;</span>,</span><br><span class=\"line\">          <span class=\"string\">&quot;analyzer&quot;</span> : <span class=\"string\">&quot;ik_max_word&quot;</span>,</span><br><span class=\"line\">          <span class=\"string\">&quot;search_analyzer&quot;</span> : <span class=\"string\">&quot;ik_smart&quot;</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        <span class=\"string\">&quot;tags&quot;</span> : &#123;</span><br><span class=\"line\">          <span class=\"string\">&quot;type&quot;</span> : <span class=\"string\">&quot;keyword&quot;</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        <span class=\"string\">&quot;title&quot;</span> : &#123;</span><br><span class=\"line\">          <span class=\"string\">&quot;type&quot;</span> : <span class=\"string\">&quot;text&quot;</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"string\">&quot;settings&quot;</span> : &#123;</span><br><span class=\"line\">      <span class=\"string\">&quot;index&quot;</span> : &#123;</span><br><span class=\"line\">        <span class=\"string\">&quot;routing&quot;</span> : &#123;</span><br><span class=\"line\">          <span class=\"string\">&quot;allocation&quot;</span> : &#123;</span><br><span class=\"line\">            <span class=\"string\">&quot;include&quot;</span> : &#123;</span><br><span class=\"line\">              <span class=\"string\">&quot;_tier_preference&quot;</span> : <span class=\"string\">&quot;data_content&quot;</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        <span class=\"string\">&quot;number_of_shards&quot;</span> : <span class=\"string\">&quot;1&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;provided_name&quot;</span> : <span class=\"string\">&quot;shopping&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;creation_date&quot;</span> : <span class=\"string\">&quot;1745291743120&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;number_of_replicas&quot;</span> : <span class=\"string\">&quot;1&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;uuid&quot;</span> : <span class=\"string\">&quot;Y1IWrdlQTUm-CbbIWweSxQ&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;version&quot;</span> : &#123;</span><br><span class=\"line\">          <span class=\"string\">&quot;created&quot;</span> : <span class=\"string\">&quot;8525000&quot;</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æŸ¥çœ‹ç´¢å¼•è®¾ç½®</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># GET /&lt;target&gt;/_settings</span></span><br><span class=\"line\">curl -X GET -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/shopping/_settings?pretty&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"># è¿”å›å€¼</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">&quot;shopping&quot;</span> : &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;mappings&quot;</span> : &#123;</span><br><span class=\"line\">      <span class=\"string\">&quot;properties&quot;</span> : &#123;</span><br><span class=\"line\">        <span class=\"string\">&quot;address&quot;</span> : &#123;</span><br><span class=\"line\">          <span class=\"string\">&quot;type&quot;</span> : <span class=\"string\">&quot;text&quot;</span>,</span><br><span class=\"line\">          <span class=\"string\">&quot;fields&quot;</span> : &#123;</span><br><span class=\"line\">            <span class=\"string\">&quot;keyword&quot;</span> : &#123;</span><br><span class=\"line\">              <span class=\"string\">&quot;type&quot;</span> : <span class=\"string\">&quot;keyword&quot;</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">          &#125;,</span><br><span class=\"line\">          <span class=\"string\">&quot;analyzer&quot;</span> : <span class=\"string\">&quot;ik_max_word&quot;</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        <span class=\"string\">&quot;category&quot;</span> : &#123;</span><br><span class=\"line\">          <span class=\"string\">&quot;type&quot;</span> : <span class=\"string\">&quot;keyword&quot;</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        <span class=\"string\">&quot;count&quot;</span> : &#123;</span><br><span class=\"line\">          <span class=\"string\">&quot;type&quot;</span> : <span class=\"string\">&quot;integer&quot;</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        <span class=\"string\">&quot;created_at&quot;</span> : &#123;</span><br><span class=\"line\">          <span class=\"string\">&quot;type&quot;</span> : <span class=\"string\">&quot;date&quot;</span>,</span><br><span class=\"line\">          <span class=\"string\">&quot;format&quot;</span> : <span class=\"string\">&quot;yyyy-MM-dd HH:mm:ss&quot;</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        <span class=\"string\">&quot;price&quot;</span> : &#123;</span><br><span class=\"line\">          <span class=\"string\">&quot;type&quot;</span> : <span class=\"string\">&quot;double&quot;</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        <span class=\"string\">&quot;remark&quot;</span> : &#123;</span><br><span class=\"line\">          <span class=\"string\">&quot;type&quot;</span> : <span class=\"string\">&quot;text&quot;</span>,</span><br><span class=\"line\">          <span class=\"string\">&quot;analyzer&quot;</span> : <span class=\"string\">&quot;ik_max_word&quot;</span>,</span><br><span class=\"line\">          <span class=\"string\">&quot;search_analyzer&quot;</span> : <span class=\"string\">&quot;ik_smart&quot;</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        <span class=\"string\">&quot;tags&quot;</span> : &#123;</span><br><span class=\"line\">          <span class=\"string\">&quot;type&quot;</span> : <span class=\"string\">&quot;keyword&quot;</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        <span class=\"string\">&quot;title&quot;</span> : &#123;</span><br><span class=\"line\">          <span class=\"string\">&quot;type&quot;</span> : <span class=\"string\">&quot;text&quot;</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æŸ¥çœ‹å­—æ®µæ˜ å°„</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># GET /&lt;target&gt;/_mapping/field/&lt;field&gt;</span></span><br><span class=\"line\"><span class=\"comment\"># shopping ä¸ºç´¢å¼•åç§°ï¼Œtitle ä¸ºå­—æ®µåç§°</span></span><br><span class=\"line\">curl -X GET -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/shopping/_mapping/field/title?pretty&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"># è¿”å›å€¼</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">&quot;shopping&quot;</span> : &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;mappings&quot;</span> : &#123;</span><br><span class=\"line\">      <span class=\"string\">&quot;title&quot;</span> : &#123;</span><br><span class=\"line\">        <span class=\"string\">&quot;full_name&quot;</span> : <span class=\"string\">&quot;title&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;mapping&quot;</span> : &#123;</span><br><span class=\"line\">          <span class=\"string\">&quot;title&quot;</span> : &#123;</span><br><span class=\"line\">            <span class=\"string\">&quot;type&quot;</span> : <span class=\"string\">&quot;text&quot;</span></span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ¤æ–­ç´¢å¼•æ˜¯å¦å­˜åœ¨</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ä½¿ç”¨ -I å‚æ•°æ¥å‘é€ HEAD è¯·æ±‚ï¼Œå¯ä»¥è·å–å“åº”å¤´è€Œä¸å¿…ä¸‹è½½å“åº”ä½“ã€‚</span></span><br><span class=\"line\"><span class=\"comment\"># HEAD /&lt;target&gt;</span></span><br><span class=\"line\">curl -I -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/shopping&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"># è¿”å›å€¼</span></span><br><span class=\"line\">HTTP/1.1 200 OK</span><br><span class=\"line\">X-elastic-product: Elasticsearch</span><br><span class=\"line\">content-type: application/json</span><br><span class=\"line\">content-length: 603</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># è¿™ä¸ªå‘½ä»¤ä¸ä¼šè¿”å›å“åº”ä½“ï¼Œä½†å®ƒçš„ HTTP å“åº”ä»£ç å¯ä»¥å‘Šè¯‰ä½ ç´¢å¼•çš„å­˜åœ¨æƒ…å†µï¼š</span></span><br><span class=\"line\">  <span class=\"comment\"># 200 OK è¡¨ç¤ºç´¢å¼•å­˜åœ¨ã€‚</span></span><br><span class=\"line\">  <span class=\"comment\"># 404 Not Found è¡¨ç¤ºç´¢å¼•ä¸å­˜åœ¨ã€‚</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ é™¤ç´¢å¼•</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># DELETE /&lt;target&gt;</span></span><br><span class=\"line\">curl -X DELETE -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/shopping&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"># è¿”å›å€¼</span></span><br><span class=\"line\">&#123;<span class=\"string\">&quot;acknowledged&quot;</span>:<span class=\"literal\">true</span>&#125;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¸ºç´¢å¼•åˆ›å»ºåˆ«å</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æ³¨æ„ï¼šä¸åŒç´¢å¼•å¯ä»¥æœ‰ç›¸åŒåç§°çš„åˆ«åï¼Œæ‰€ä»¥åœ¨æ•°æ®ç»“æ„ä¸€è‡´çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥ä¸ºä¸åŒçš„ç´¢å¼•åˆ›å»ºç›¸åŒçš„åˆ«åï¼Œç„¶åæ ¹æ®åˆ«åè¿›è¡Œæ•°æ®æŸ¥è¯¢</span></span><br><span class=\"line\"><span class=\"comment\"># POST /&lt;target&gt;/_alias/&lt;alias&gt;</span></span><br><span class=\"line\">curl -X POST -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/shopping/_alias/shopping_alias&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"># è¿”å›å€¼</span></span><br><span class=\"line\">&#123;<span class=\"string\">&quot;acknowledged&quot;</span>:<span class=\"literal\">true</span>&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ä¹Ÿå¯ä»¥ä½¿ç”¨å¦‚ä¸‹æ–¹æ³•</span></span><br><span class=\"line\">curl -X POST -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/_aliases&#x27;</span> \\</span><br><span class=\"line\">  -H <span class=\"string\">&#x27;Content-Type: application/json&#x27;</span> \\</span><br><span class=\"line\">  -d <span class=\"string\">&#x27;&#123;</span></span><br><span class=\"line\"><span class=\"string\">    &quot;actions&quot;: [</span></span><br><span class=\"line\"><span class=\"string\">      &#123;</span></span><br><span class=\"line\"><span class=\"string\">        &quot;add&quot;: &#123;</span></span><br><span class=\"line\"><span class=\"string\">          &quot;index&quot;: &quot;shopping&quot;,</span></span><br><span class=\"line\"><span class=\"string\">          &quot;alias&quot;: &quot;shopping_alias2&quot;</span></span><br><span class=\"line\"><span class=\"string\">        &#125;</span></span><br><span class=\"line\"><span class=\"string\">      &#125;</span></span><br><span class=\"line\"><span class=\"string\">    ]</span></span><br><span class=\"line\"><span class=\"string\">  &#125;&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"># è¿”å›å€¼</span></span><br><span class=\"line\">&#123;<span class=\"string\">&quot;acknowledged&quot;</span>:<span class=\"literal\">true</span>&#125;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æŸ¥çœ‹ç´¢å¼•åˆ«å</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># GET /&lt;target&gt;/_alias/&lt;alias&gt;</span></span><br><span class=\"line\">curl -X GET -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/shopping/_alias/shopping_alias?pretty&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"># è¿”å›å€¼</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">&quot;shopping&quot;</span> : &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;aliases&quot;</span> : &#123;</span><br><span class=\"line\">      <span class=\"string\">&quot;shopping_alias&quot;</span> : &#123; &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹å½“å‰ç´¢å¼•çš„æ‰€æœ‰åˆ«å</span></span><br><span class=\"line\">curl -X GET -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/shopping/_alias?pretty&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹æ‰€æœ‰ç´¢å¼•çš„åˆ«å</span></span><br><span class=\"line\">curl -X GET -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/_alias?pretty&#x27;</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¸ºç´¢å¼•åˆ é™¤åˆ«å</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># DELETE /&lt;target&gt;/_alias/&lt;alias&gt;</span></span><br><span class=\"line\">curl -X DELETE -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/shopping/_alias/shopping_alias&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"># è¿”å›å€¼</span></span><br><span class=\"line\">&#123;<span class=\"string\">&quot;acknowledged&quot;</span>:<span class=\"literal\">true</span>&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"å¦‚ä½•ä¿®æ”¹ç´¢å¼•å­—æ®µç±»å‹æˆ–åˆ†è¯å™¨ç±»å‹ï¼Ÿ\">å¦‚ä½•ä¿®æ”¹ç´¢å¼•å­—æ®µç±»å‹æˆ–åˆ†è¯å™¨ç±»å‹ï¼Ÿ</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ›å»ºæ–°çš„ç´¢å¼•</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># è¿™é‡Œä¸ºtitleå­—æ®µå¢åŠ åˆ†è¯å™¨</span></span><br><span class=\"line\">curl -X PUT -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/shopping_new&#x27;</span> \\</span><br><span class=\"line\">  -H <span class=\"string\">&#x27;Content-Type: application/json&#x27;</span> \\</span><br><span class=\"line\">  -d <span class=\"string\">&#x27;&#123;</span></span><br><span class=\"line\"><span class=\"string\">    &quot;settings&quot;:&#123;</span></span><br><span class=\"line\"><span class=\"string\">      &quot;number_of_shards&quot;:&quot;1&quot;,</span></span><br><span class=\"line\"><span class=\"string\">      &quot;number_of_replicas&quot;:&quot;2&quot;</span></span><br><span class=\"line\"><span class=\"string\">    &#125;,</span></span><br><span class=\"line\"><span class=\"string\">    &quot;mappings&quot;:&#123;</span></span><br><span class=\"line\"><span class=\"string\">      &quot;properties&quot;:&#123;</span></span><br><span class=\"line\"><span class=\"string\">        &quot;category&quot;:&#123;</span></span><br><span class=\"line\"><span class=\"string\">          &quot;type&quot;:&quot;keyword&quot;</span></span><br><span class=\"line\"><span class=\"string\">        &#125;,</span></span><br><span class=\"line\"><span class=\"string\">        &quot;price&quot;:&#123;</span></span><br><span class=\"line\"><span class=\"string\">          &quot;type&quot;:&quot;double&quot;</span></span><br><span class=\"line\"><span class=\"string\">        &#125;,</span></span><br><span class=\"line\"><span class=\"string\">        &quot;count&quot;:&#123;</span></span><br><span class=\"line\"><span class=\"string\">          &quot;type&quot;:&quot;integer&quot;</span></span><br><span class=\"line\"><span class=\"string\">        &#125;,</span></span><br><span class=\"line\"><span class=\"string\">        &quot;title&quot;:&#123;</span></span><br><span class=\"line\"><span class=\"string\">          &quot;type&quot;:&quot;text&quot;,</span></span><br><span class=\"line\"><span class=\"string\">          &quot;analyzer&quot;:&quot;ik_max_word&quot;,</span></span><br><span class=\"line\"><span class=\"string\">          &quot;search_analyzer&quot;:&quot;ik_smart&quot;</span></span><br><span class=\"line\"><span class=\"string\">        &#125;,</span></span><br><span class=\"line\"><span class=\"string\">        &quot;remark&quot;:&#123;</span></span><br><span class=\"line\"><span class=\"string\">        &quot;type&quot;:&quot;text&quot;,</span></span><br><span class=\"line\"><span class=\"string\">        &quot;analyzer&quot;:&quot;ik_max_word&quot;,</span></span><br><span class=\"line\"><span class=\"string\">        &quot;search_analyzer&quot;:&quot;ik_smart&quot;</span></span><br><span class=\"line\"><span class=\"string\">      &#125;,</span></span><br><span class=\"line\"><span class=\"string\">      &quot;address&quot;: &#123;</span></span><br><span class=\"line\"><span class=\"string\">        &quot;type&quot;: &quot;text&quot;,</span></span><br><span class=\"line\"><span class=\"string\">        &quot;analyzer&quot;: &quot;ik_max_word&quot;,</span></span><br><span class=\"line\"><span class=\"string\">        &quot;fields&quot;: &#123;</span></span><br><span class=\"line\"><span class=\"string\">          &quot;keyword&quot;: &#123;</span></span><br><span class=\"line\"><span class=\"string\">            &quot;type&quot;: &quot;keyword&quot;</span></span><br><span class=\"line\"><span class=\"string\">          &#125;</span></span><br><span class=\"line\"><span class=\"string\">        &#125;</span></span><br><span class=\"line\"><span class=\"string\">      &#125;,</span></span><br><span class=\"line\"><span class=\"string\">      &quot;tags&quot;: &#123;</span></span><br><span class=\"line\"><span class=\"string\">        &quot;type&quot;: &quot;keyword&quot;</span></span><br><span class=\"line\"><span class=\"string\">      &#125;,</span></span><br><span class=\"line\"><span class=\"string\">      &quot;created_at&quot;: &#123;&quot;type&quot;: &quot;date&quot;, &quot;format&quot;: &quot;yyyy-MM-dd HH:mm:ss&quot;&#125;</span></span><br><span class=\"line\"><span class=\"string\">      &#125;</span></span><br><span class=\"line\"><span class=\"string\">    &#125;</span></span><br><span class=\"line\"><span class=\"string\">  &#125;&#x27;</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å°†åŸç´¢å¼•çš„æ•°æ®è¿ç§»åˆ°æ–°ç´¢å¼•</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -X POST -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/_reindex&#x27;</span> \\</span><br><span class=\"line\">  -H <span class=\"string\">&#x27;Content-Type: application/json&#x27;</span> \\</span><br><span class=\"line\">  -d <span class=\"string\">&#x27;&#123;</span></span><br><span class=\"line\"><span class=\"string\">  &quot;source&quot;: &#123;</span></span><br><span class=\"line\"><span class=\"string\">    &quot;index&quot;: &quot;shopping&quot;</span></span><br><span class=\"line\"><span class=\"string\">  &#125;,</span></span><br><span class=\"line\"><span class=\"string\">  &quot;dest&quot;: &#123;</span></span><br><span class=\"line\"><span class=\"string\">    &quot;index&quot;: &quot;shopping_new&quot;</span></span><br><span class=\"line\"><span class=\"string\">  &#125;</span></span><br><span class=\"line\"><span class=\"string\">&#125;&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"># è¿”å›å€¼</span></span><br><span class=\"line\">&#123;<span class=\"string\">&quot;took&quot;</span>:101,<span class=\"string\">&quot;timed_out&quot;</span>:<span class=\"literal\">false</span>,<span class=\"string\">&quot;total&quot;</span>:2,<span class=\"string\">&quot;updated&quot;</span>:0,<span class=\"string\">&quot;created&quot;</span>:2,<span class=\"string\">&quot;deleted&quot;</span>:0,<span class=\"string\">&quot;batches&quot;</span>:1,<span class=\"string\">&quot;version_conflicts&quot;</span>:0,<span class=\"string\">&quot;noops&quot;</span>:0,<span class=\"string\">&quot;retries&quot;</span>:&#123;<span class=\"string\">&quot;bulk&quot;</span>:0,<span class=\"string\">&quot;search&quot;</span>:0&#125;,<span class=\"string\">&quot;throttled_millis&quot;</span>:0,<span class=\"string\">&quot;requests_per_second&quot;</span>:-1.0,<span class=\"string\">&quot;throttled_until_millis&quot;</span>:0,<span class=\"string\">&quot;failures&quot;</span>:[]&#125;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ é™¤åŸç´¢å¼•</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -X DELETE -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/shopping&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"># è¿”å›å€¼</span></span><br><span class=\"line\">&#123;<span class=\"string\">&quot;acknowledged&quot;</span>:<span class=\"literal\">true</span>&#125;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¸ºæ–°ç´¢å¼•åˆ›å»ºåˆ«å</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -X POST -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/shopping_new/_alias/shopping&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"># è¿”å›å€¼</span></span><br><span class=\"line\">&#123;<span class=\"string\">&quot;acknowledged&quot;</span>:<span class=\"literal\">true</span>,<span class=\"string\">&quot;errors&quot;</span>:<span class=\"literal\">false</span>&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"æ•°æ®å¢åˆ æ”¹åŸºæœ¬æ“ä½œ\">æ•°æ®å¢åˆ æ”¹åŸºæœ¬æ“ä½œ</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ–°å¢æ•°æ®</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">1.ä¸ºæŒ‡å®šç´¢å¼•æ’å…¥ä¸€æ¡æ•°æ®(_docæ–¹å¼ï¼šä¸æŒ‡å®šidé»˜è®¤éšæœºå­—ç¬¦ä¸²)</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># _doc çš„æ–¹å¼åˆ›å»ºç´¢å¼•æ•°æ®æ—¶ï¼Œå¯ä»¥ä¸æŒ‡å®šidï¼Œé»˜è®¤ä¼šåˆ›å»ºæ–°çš„idï¼Œidç±»å‹ä¸ºéšæœºå­—ç¬¦ä¸²</span></span><br><span class=\"line\"><span class=\"comment\"># POST /&lt;target&gt;/_doc</span></span><br><span class=\"line\">curl -X POST -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/shopping/_doc?pretty&#x27;</span> \\</span><br><span class=\"line\">  -H <span class=\"string\">&#x27;Content-Type: application/json&#x27;</span> \\</span><br><span class=\"line\">  -d <span class=\"string\">&#x27;&#123;</span></span><br><span class=\"line\"><span class=\"string\">    &quot;category&quot;: &quot;electronics&quot;,</span></span><br><span class=\"line\"><span class=\"string\">    &quot;price&quot;: 999.99,</span></span><br><span class=\"line\"><span class=\"string\">    &quot;count&quot;: 10,</span></span><br><span class=\"line\"><span class=\"string\">    &quot;title&quot;: &quot;Smartphone X - 128GB&quot;,</span></span><br><span class=\"line\"><span class=\"string\">    &quot;remark&quot;: &quot;This latest Smartphone X comes with a powerful processor and high-resolution camera.&quot;,</span></span><br><span class=\"line\"><span class=\"string\">    &quot;address&quot;: &quot;123 Electronic Ave, Beijing, China&quot;,</span></span><br><span class=\"line\"><span class=\"string\">    &quot;tags&quot;: [&quot;latest&quot;, &quot;smartphone&quot;, &quot;technology&quot;],</span></span><br><span class=\"line\"><span class=\"string\">    &quot;created_at&quot;: &quot;2025-04-22 03:30:02&quot;</span></span><br><span class=\"line\"><span class=\"string\">  &#125;&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"># è¿”å›å€¼</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">&quot;_index&quot;</span> : <span class=\"string\">&quot;shopping_new&quot;</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;_id&quot;</span> : <span class=\"string\">&quot;sImNW5YBmgASmV9McVvI&quot;</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;_version&quot;</span> : 1,</span><br><span class=\"line\">  <span class=\"string\">&quot;result&quot;</span> : <span class=\"string\">&quot;created&quot;</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;_shards&quot;</span> : &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;total&quot;</span> : 3,</span><br><span class=\"line\">    <span class=\"string\">&quot;successful&quot;</span> : 1,</span><br><span class=\"line\">    <span class=\"string\">&quot;failed&quot;</span> : 0</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"string\">&quot;_seq_no&quot;</span> : 1,</span><br><span class=\"line\">  <span class=\"string\">&quot;_primary_term&quot;</span> : 1</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">2.ä¸ºæŒ‡å®šç´¢å¼•æ’å…¥ä¸€æ¡æ•°æ®(_docæ–¹å¼ï¼šæŒ‡å®šid)</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># _doc çš„æ–¹å¼åˆ›å»ºç´¢å¼•æ•°æ®æ—¶ï¼Œå¦‚æœæŒ‡å®šidï¼Œå†æ¬¡æ‰§è¡Œæ—¶ä¼šå…ˆåˆ é™¤åŸæ•°æ®å†åˆ›å»ºæ–°æ•°æ®ï¼Œæ‰€ä»¥å¿…é¡»å…¨é‡æ›´æ–°æ‰è¡Œã€‚</span></span><br><span class=\"line\"><span class=\"comment\"># PUT /&lt;target&gt;/_doc</span></span><br><span class=\"line\">curl -X PUT -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/shopping/_doc/100?pretty&#x27;</span> \\</span><br><span class=\"line\">  -H <span class=\"string\">&#x27;Content-Type: application/json&#x27;</span> \\</span><br><span class=\"line\">  -d <span class=\"string\">&#x27;&#123;</span></span><br><span class=\"line\"><span class=\"string\">    &quot;category&quot;: &quot;electronics&quot;,</span></span><br><span class=\"line\"><span class=\"string\">    &quot;price&quot;: 999.99,</span></span><br><span class=\"line\"><span class=\"string\">    &quot;count&quot;: 10,</span></span><br><span class=\"line\"><span class=\"string\">    &quot;title&quot;: &quot;Smartphone X - 128GB&quot;,</span></span><br><span class=\"line\"><span class=\"string\">    &quot;remark&quot;: &quot;This latest Smartphone X comes with a powerful processor and high-resolution camera.&quot;,</span></span><br><span class=\"line\"><span class=\"string\">    &quot;address&quot;: &quot;123 Electronic Ave, Beijing, China&quot;,</span></span><br><span class=\"line\"><span class=\"string\">    &quot;tags&quot;: [&quot;latest&quot;, &quot;smartphone&quot;, &quot;technology&quot;],</span></span><br><span class=\"line\"><span class=\"string\">    &quot;created_at&quot;: &quot;2025-04-22 03:30:02&quot;</span></span><br><span class=\"line\"><span class=\"string\">  &#125;&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"># è¿”å›å€¼</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">&quot;_index&quot;</span> : <span class=\"string\">&quot;shopping_new&quot;</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;_id&quot;</span> : <span class=\"string\">&quot;100&quot;</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;_version&quot;</span> : 1,</span><br><span class=\"line\">  <span class=\"string\">&quot;result&quot;</span> : <span class=\"string\">&quot;created&quot;</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;_shards&quot;</span> : &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;total&quot;</span> : 3,</span><br><span class=\"line\">    <span class=\"string\">&quot;successful&quot;</span> : 1,</span><br><span class=\"line\">    <span class=\"string\">&quot;failed&quot;</span> : 0</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"string\">&quot;_seq_no&quot;</span> : 2,</span><br><span class=\"line\">  <span class=\"string\">&quot;_primary_term&quot;</span> : 1</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">\n<p>3.ä¸ºæŒ‡å®šç´¢å¼•æ’å…¥ä¸€æ¡æ•°æ®(_createæ–¹å¼ï¼šæŒ‡å®šid)</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># _create çš„æ–¹å¼åˆ›å»ºç´¢å¼•æ•°æ®æ—¶ï¼Œå¿…é¡»æŒ‡å®šid,è€Œä¸”åªèƒ½æ‰§è¡Œä¸€æ¬¡ï¼Œå› ä¸ºæ‰§è¡Œè¿‡ä¸€æ¬¡åæŒ‡å®šidçš„æ•°æ®å°±å­˜åœ¨äº†ï¼Œä¸èƒ½å†æ¬¡åˆ›å»º</span></span><br><span class=\"line\"><span class=\"comment\"># POST /&lt;target&gt;/_create/&lt;id&gt;</span></span><br><span class=\"line\">curl -X POST -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/shopping/_create/1?pretty&#x27;</span> \\</span><br><span class=\"line\">  -H <span class=\"string\">&#x27;Content-Type: application/json&#x27;</span> \\</span><br><span class=\"line\">  -d <span class=\"string\">&#x27;&#123;</span></span><br><span class=\"line\"><span class=\"string\">    &quot;category&quot;: &quot;electronics&quot;,</span></span><br><span class=\"line\"><span class=\"string\">    &quot;price&quot;: 999.99,</span></span><br><span class=\"line\"><span class=\"string\">    &quot;count&quot;: 10,</span></span><br><span class=\"line\"><span class=\"string\">    &quot;title&quot;: &quot;Smartphone X - 128GB&quot;,</span></span><br><span class=\"line\"><span class=\"string\">    &quot;remark&quot;: &quot;This latest Smartphone X comes with a powerful processor and high-resolution camera.&quot;,</span></span><br><span class=\"line\"><span class=\"string\">    &quot;address&quot;: &quot;123 Electronic Ave, Beijing, China&quot;,</span></span><br><span class=\"line\"><span class=\"string\">    &quot;tags&quot;: [&quot;latest&quot;, &quot;smartphone&quot;, &quot;technology&quot;],</span></span><br><span class=\"line\"><span class=\"string\">    &quot;created_at&quot;: &quot;2025-04-22 03:30:02&quot;</span></span><br><span class=\"line\"><span class=\"string\">  &#125;&#x27;</span></span><br></pre></td></tr></table></figure>\n</li>\n<li class=\"lvl-2\">\n<p>ä¿®æ”¹æ•°æ®</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">1.ä¿®æ”¹å…¨éƒ¨æ•°æ®</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># POST /&lt;target&gt;/_doc/&lt;id&gt;</span></span><br><span class=\"line\"><span class=\"comment\"># æ‰§è¡Œæ—¶ä¼šå…ˆåˆ é™¤åŸæ•°æ®å†åˆ›å»ºæ–°æ•°æ®ï¼Œæ‰€ä»¥å¿…é¡»å…¨é‡æ›´æ–°æ‰è¡Œã€‚</span></span><br><span class=\"line\">curl -X POST -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/shopping/_doc/sImNW5YBmgASmV9McVvI&#x27;</span> \\</span><br><span class=\"line\">  -H <span class=\"string\">&#x27;Content-Type: application/json&#x27;</span> \\</span><br><span class=\"line\">  -d <span class=\"string\">&#x27;&#123;</span></span><br><span class=\"line\"><span class=\"string\">    &quot;category&quot;: &quot;electronics&quot;,</span></span><br><span class=\"line\"><span class=\"string\">    &quot;price&quot;: 999.99,</span></span><br><span class=\"line\"><span class=\"string\">    &quot;count&quot;: 20,</span></span><br><span class=\"line\"><span class=\"string\">    &quot;title&quot;: &quot;Smartphone X - 128GB&quot;,</span></span><br><span class=\"line\"><span class=\"string\">    &quot;remark&quot;: &quot;This latest Smartphone X comes with a powerful processor and high-resolution camera.&quot;,</span></span><br><span class=\"line\"><span class=\"string\">    &quot;address&quot;: &quot;123 Electronic Ave, Beijing, China&quot;,</span></span><br><span class=\"line\"><span class=\"string\">    &quot;tags&quot;: [&quot;latest&quot;, &quot;smartphone&quot;, &quot;technology&quot;],</span></span><br><span class=\"line\"><span class=\"string\">    &quot;created_at&quot;: &quot;2025-04-22 03:30:02&quot;</span></span><br><span class=\"line\"><span class=\"string\">  &#125;&#x27;</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">2.ä¿®æ”¹éƒ¨åˆ†æ•°æ®</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># POST /&lt;target&gt;/_update/&lt;id&gt;</span></span><br><span class=\"line\"><span class=\"comment\"># æ‰§è¡Œæ—¶åªä¼šä¿®æ”¹æŒ‡å®šå­—æ®µï¼Œä¸ä¼šåˆ é™¤åŸæ•°æ®ï¼Œæ‰€ä»¥å¯ä»¥éƒ¨åˆ†æ›´æ–°ã€‚</span></span><br><span class=\"line\">curl -X POST -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/shopping/_update/1&#x27;</span> \\</span><br><span class=\"line\">  -H <span class=\"string\">&#x27;Content-Type: application/json&#x27;</span> \\</span><br><span class=\"line\">  -d <span class=\"string\">&#x27;&#123;&quot;doc&quot;:&#123;&quot;count&quot;:100&#125;&#125;&#x27;</span></span><br></pre></td></tr></table></figure>\n</li>\n<li class=\"lvl-2\">\n<p>æŸ¥è¯¢æŒ‡å®šç´¢å¼•çš„æŒ‡å®šidçš„æ•°æ®</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># GET /&lt;target&gt;/_doc/&lt;id&gt;</span></span><br><span class=\"line\">curl -X GET -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/shopping/_doc/100?pretty&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"># è¿”å›å€¼</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">&quot;_index&quot;</span> : <span class=\"string\">&quot;shopping_new&quot;</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;_id&quot;</span> : <span class=\"string\">&quot;100&quot;</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;_version&quot;</span> : 1,</span><br><span class=\"line\">  <span class=\"string\">&quot;_seq_no&quot;</span> : 2,</span><br><span class=\"line\">  <span class=\"string\">&quot;_primary_term&quot;</span> : 1,</span><br><span class=\"line\">  <span class=\"string\">&quot;found&quot;</span> : <span class=\"literal\">true</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;_source&quot;</span> : &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;category&quot;</span> : <span class=\"string\">&quot;electronics&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;price&quot;</span> : 999.99,</span><br><span class=\"line\">    <span class=\"string\">&quot;count&quot;</span> : 10,</span><br><span class=\"line\">    <span class=\"string\">&quot;title&quot;</span> : <span class=\"string\">&quot;Smartphone X - 128GB&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;remark&quot;</span> : <span class=\"string\">&quot;This latest Smartphone X comes with a powerful processor and high-resolution camera.&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;address&quot;</span> : <span class=\"string\">&quot;123 Electronic Ave, Beijing, China&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;tags&quot;</span> : [</span><br><span class=\"line\">      <span class=\"string\">&quot;latest&quot;</span>,</span><br><span class=\"line\">      <span class=\"string\">&quot;smartphone&quot;</span>,</span><br><span class=\"line\">      <span class=\"string\">&quot;technology&quot;</span></span><br><span class=\"line\">    ],</span><br><span class=\"line\">    <span class=\"string\">&quot;created_at&quot;</span> : <span class=\"string\">&quot;2025-04-22 03:30:02&quot;</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ é™¤æŒ‡å®šç´¢å¼•çš„æŒ‡å®šidçš„æ•°æ®</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># DELETE /&lt;target&gt;/_doc/&lt;id&gt;</span></span><br><span class=\"line\">curl -X DELETE -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/shopping/_doc/100&#x27;</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ é™¤ç´¢å¼•å…¨éƒ¨æ•°æ®</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -X POST -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/shopping/_delete_by_query?pretty&#x27;</span> \\</span><br><span class=\"line\">  -H <span class=\"string\">&#x27;Content-Type: application/json&#x27;</span> \\</span><br><span class=\"line\">  -d <span class=\"string\">&#x27;&#123;&quot;query&quot;:&#123;&quot;match_all&quot;:&#123;&#125;&#125;&#125;&#x27;</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"æ‰¹é‡æ“ä½œ\">æ‰¹é‡æ“ä½œ</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ‰¹é‡æ–°å¢æ•°æ®</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æ³¨æ„æ•°æ®è¡Œè¦é¡¶è¡Œå†™ï¼Œå‰é¢ä¸è¦æœ‰ç©ºæ ¼</span></span><br><span class=\"line\"><span class=\"comment\"># POST /_bulk</span></span><br><span class=\"line\">curl -X POST -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/_bulk&#x27;</span> \\</span><br><span class=\"line\">  -H <span class=\"string\">&#x27;Content-Type: application/json&#x27;</span> \\</span><br><span class=\"line\">  -d <span class=\"string\">&#x27;&#123; &quot;index&quot;: &#123; &quot;_index&quot;: &quot;shopping&quot;, &quot;_id&quot;: &quot;1&quot; &#125; &#125;</span></span><br><span class=\"line\"><span class=\"string\">&#123; &quot;category&quot;: &quot;electronics&quot;, &quot;price&quot;: 999.99, &quot;count&quot;: 10, &quot;title&quot;: &quot;Smartphone X - 128GB&quot;, &quot;remark&quot;: &quot;This latest Smartphone X comes with a powerful processor and high-resolution camera.&quot;, &quot;address&quot;: &quot;å¹¿å·å¤©æ²³å…¬å›­&quot;, &quot;tags&quot;: [&quot;latest&quot;, &quot;smartphone&quot;, &quot;technology&quot;], &quot;created_at&quot;: &quot;2025-04-22 03:30:02&quot; &#125;</span></span><br><span class=\"line\"><span class=\"string\">&#123; &quot;index&quot;: &#123; &quot;_index&quot;: &quot;shopping&quot;, &quot;_id&quot;: &quot;2&quot; &#125; &#125;</span></span><br><span class=\"line\"><span class=\"string\">&#123; &quot;category&quot;: &quot;fashion&quot;, &quot;price&quot;: 49.99, &quot;count&quot;: 25, &quot;title&quot;: &quot;Designer T-shirt&quot;, &quot;remark&quot;: &quot;Trendy designer T-shirt made with high quality fabric.&quot;, &quot;address&quot;: &quot;å¹¿å·è”æ¹¾å¤§å¦&quot;, &quot;tags&quot;: [&quot;clothing&quot;, &quot;designer&quot;, &quot;style&quot;], &quot;created_at&quot;: &quot;2025-04-21 12:15:00&quot; &#125;</span></span><br><span class=\"line\"><span class=\"string\">&#123; &quot;index&quot;: &#123; &quot;_index&quot;: &quot;shopping&quot;, &quot;_id&quot;: &quot;3&quot; &#125; &#125;</span></span><br><span class=\"line\"><span class=\"string\">&#123; &quot;category&quot;: &quot;home_appliances&quot;, &quot;price&quot;: 299.99, &quot;count&quot;: 5, &quot;title&quot;: &quot;Robot Vacuum Cleaner&quot;, &quot;remark&quot;: &quot;Efficient robot vacuum cleaner with smart navigation.&quot;, &quot;address&quot;: &quot;å¹¿å·ç™½äº‘å±±å…¬å›­&quot;, &quot;tags&quot;: [&quot;appliances&quot;, &quot;vacuum&quot;, &quot;robot&quot;], &quot;created_at&quot;: &quot;2025-04-20 08:45:30&quot; &#125;</span></span><br><span class=\"line\"><span class=\"string\">&#123; &quot;index&quot;: &#123; &quot;_index&quot;: &quot;shopping&quot;, &quot;_id&quot;: &quot;4&quot; &#125; &#125;</span></span><br><span class=\"line\"><span class=\"string\">&#123; &quot;category&quot;: &quot;books&quot;, &quot;price&quot;: 19.99, &quot;count&quot;: 100, &quot;title&quot;: &quot;Inspirational Novel&quot;, &quot;remark&quot;: &quot;A gripping novel that inspires and motivates.&quot;, &quot;address&quot;: &quot;321 Book Rd, Shenzhen, China&quot;, &quot;tags&quot;: [&quot;book&quot;, &quot;novel&quot;, &quot;inspiration&quot;], &quot;created_at&quot;: &quot;2025-04-19 10:05:00&quot; &#125;</span></span><br><span class=\"line\"><span class=\"string\">&#123; &quot;index&quot;: &#123; &quot;_index&quot;: &quot;shopping&quot;, &quot;_id&quot;: &quot;5&quot; &#125; &#125;</span></span><br><span class=\"line\"><span class=\"string\">&#123; &quot;category&quot;: &quot;groceries&quot;, &quot;price&quot;: 3.99, &quot;count&quot;: 200, &quot;title&quot;: &quot;Organic Apples&quot;, &quot;remark&quot;: &quot;Fresh and crispy organic apples.&quot;, &quot;address&quot;: &quot;654 Grocery Ln, Chengdu, China&quot;, &quot;tags&quot;: [&quot;fruit&quot;, &quot;organic&quot;, &quot;healthy&quot;], &quot;created_at&quot;: &quot;2025-04-18 14:30:45&quot; &#125;</span></span><br><span class=\"line\"><span class=\"string\">&#123; &quot;index&quot;: &#123; &quot;_index&quot;: &quot;shopping&quot;, &quot;_id&quot;: &quot;6&quot; &#125; &#125;</span></span><br><span class=\"line\"><span class=\"string\">&#123; &quot;category&quot;: &quot;electronics&quot;, &quot;price&quot;: 1999.99, &quot;count&quot;: 15, &quot;title&quot;: &quot;Smartphone X - 256GB&quot;, &quot;remark&quot;: &quot;This latest Smartphone X comes with a powerful processor and high-resolution camera.&quot;, &quot;address&quot;: &quot;å¹¿å·å¤©æ²³å…¬å›­&quot;, &quot;tags&quot;: [&quot;latest&quot;, &quot;smartphone&quot;, &quot;technology&quot;], &quot;created_at&quot;: &quot;2025-04-22 03:30:02&quot; &#125;</span></span><br><span class=\"line\"><span class=\"string\">&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"># å‚æ•°è¯´æ˜</span></span><br><span class=\"line\"><span class=\"comment\"># index: ç”¨äºåˆ›å»ºæ–°æ–‡æ¡£æˆ–æ›¿æ¢å·²æœ‰æ–‡æ¡£ã€‚</span></span><br><span class=\"line\"><span class=\"comment\"># create: ç”¨äºåˆ›å»ºæ–°æ–‡æ¡£ï¼Œå¦‚æœæ–‡æ¡£å·²å­˜åœ¨ï¼Œåˆ™è¿”å›é”™è¯¯ã€‚</span></span><br><span class=\"line\"><span class=\"comment\"># _index: æŒ‡å®šç´¢å¼•åç§°ã€‚</span></span><br><span class=\"line\"><span class=\"comment\"># _id: æŒ‡å®šæ–‡æ¡£IDã€‚å¦‚æœä¸æŒ‡å®šåˆ™ä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªéšæœºçš„IDã€‚</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ‰¹é‡æ–°å¢æ•°æ®æ—¶ä¹Ÿå¯ä»¥åœ¨urlä¸­æŒ‡å®šç´¢å¼•åç§°</span></span><br><span class=\"line\"><span class=\"comment\"># æ­¤æ—¶å¯ä»¥æŒ‡å®šidï¼Œå¦‚æœä¸æŒ‡å®šåˆ™è‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªéšæœºå­—ç¬¦ä¸²çš„ID</span></span><br><span class=\"line\"><span class=\"comment\"># POST /&lt;target&gt;/_bulk</span></span><br><span class=\"line\">curl -X POST -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/shopping/_bulk&#x27;</span> \\</span><br><span class=\"line\">  -H <span class=\"string\">&#x27;Content-Type: application/json&#x27;</span> \\</span><br><span class=\"line\">  -d <span class=\"string\">&#x27;&#123; &quot;index&quot;: &#123;&#125; &#125;</span></span><br><span class=\"line\"><span class=\"string\">&#123; &quot;category&quot;: &quot;electronics&quot;, &quot;price&quot;: 999.99, &quot;count&quot;: 10, &quot;title&quot;: &quot;Smartphone X - 128GB&quot;, &quot;remark&quot;: &quot;This latest Smartphone X comes with a powerful processor and high-resolution camera.&quot;, &quot;address&quot;: &quot;å¹¿å·å¤©æ²³å…¬å›­&quot;, &quot;tags&quot;: [&quot;latest&quot;, &quot;smartphone&quot;, &quot;technology&quot;], &quot;created_at&quot;: &quot;2025-04-22 03:30:02&quot; &#125;</span></span><br><span class=\"line\"><span class=\"string\">&#123; &quot;index&quot;: &#123;&#125; &#125;</span></span><br><span class=\"line\"><span class=\"string\">&#123; &quot;category&quot;: &quot;fashion&quot;, &quot;price&quot;: 49.99, &quot;count&quot;: 25, &quot;title&quot;: &quot;Designer T-shirt&quot;, &quot;remark&quot;: &quot;Trendy designer T-shirt made with high quality fabric.&quot;, &quot;address&quot;: &quot;å¹¿å·è”æ¹¾å¤§å¦&quot;, &quot;tags&quot;: [&quot;clothing&quot;, &quot;designer&quot;, &quot;style&quot;], &quot;created_at&quot;: &quot;2025-04-21 12:15:00&quot; &#125;</span></span><br><span class=\"line\"><span class=\"string\">&#123; &quot;index&quot;: &#123;&#125; &#125;</span></span><br><span class=\"line\"><span class=\"string\">&#123; &quot;category&quot;: &quot;home_appliances&quot;, &quot;price&quot;: 299.99, &quot;count&quot;: 5, &quot;title&quot;: &quot;Robot Vacuum Cleaner&quot;, &quot;remark&quot;: &quot;Efficient robot vacuum cleaner with smart navigation.&quot;, &quot;address&quot;: &quot;å¹¿å·ç™½äº‘å±±å…¬å›­&quot;, &quot;tags&quot;: [&quot;appliances&quot;, &quot;vacuum&quot;, &quot;robot&quot;], &quot;created_at&quot;: &quot;2025-04-20 08:45:30&quot; &#125;</span></span><br><span class=\"line\"><span class=\"string\">&#123; &quot;index&quot;: &#123;&#125; &#125;</span></span><br><span class=\"line\"><span class=\"string\">&#123; &quot;category&quot;: &quot;books&quot;, &quot;price&quot;: 19.99, &quot;count&quot;: 100, &quot;title&quot;: &quot;Inspirational Novel&quot;, &quot;remark&quot;: &quot;A gripping novel that inspires and motivates.&quot;, &quot;address&quot;: &quot;321 Book Rd, Shenzhen, China&quot;, &quot;tags&quot;: [&quot;book&quot;, &quot;novel&quot;, &quot;inspiration&quot;], &quot;created_at&quot;: &quot;2025-04-19 10:05:00&quot; &#125;</span></span><br><span class=\"line\"><span class=\"string\">&#123; &quot;index&quot;: &#123;&#125; &#125;</span></span><br><span class=\"line\"><span class=\"string\">&#123; &quot;category&quot;: &quot;groceries&quot;, &quot;price&quot;: 3.99, &quot;count&quot;: 200, &quot;title&quot;: &quot;Organic Apples&quot;, &quot;remark&quot;: &quot;Fresh and crispy organic apples.&quot;, &quot;address&quot;: &quot;654 Grocery Ln, Chengdu, China&quot;, &quot;tags&quot;: [&quot;fruit&quot;, &quot;organic&quot;, &quot;healthy&quot;], &quot;created_at&quot;: &quot;2025-04-18 14:30:45&quot; &#125;</span></span><br><span class=\"line\"><span class=\"string\">&#123; &quot;index&quot;: &#123;&#125; &#125;</span></span><br><span class=\"line\"><span class=\"string\">&#123; &quot;category&quot;: &quot;electronics&quot;, &quot;price&quot;: 1999.99, &quot;count&quot;: 15, &quot;title&quot;: &quot;Smartphone X - 256GB&quot;, &quot;remark&quot;: &quot;This latest Smartphone X comes with a powerful processor and high-resolution camera.&quot;, &quot;address&quot;: &quot;å¹¿å·å¤©æ²³å…¬å›­&quot;, &quot;tags&quot;: [&quot;latest&quot;, &quot;smartphone&quot;, &quot;technology&quot;], &quot;created_at&quot;: &quot;2025-04-22 03:30:02&quot; &#125;</span></span><br><span class=\"line\"><span class=\"string\">&#x27;</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ‰¹é‡ä¿®æ”¹æ•°æ®</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æ³¨æ„æ•°æ®è¡Œè¦é¡¶è¡Œå†™ï¼Œå‰é¢ä¸è¦æœ‰ç©ºæ ¼</span></span><br><span class=\"line\">curl -X POST -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/_bulk&#x27;</span> \\</span><br><span class=\"line\">  -H <span class=\"string\">&#x27;Content-Type: application/json&#x27;</span> \\</span><br><span class=\"line\">  -d <span class=\"string\">&#x27;&#123;&quot;update&quot;:&#123;&quot;_index&quot;:&quot;shopping&quot;,&quot;_id&quot;:&quot;1&quot;&#125;&#125;</span></span><br><span class=\"line\"><span class=\"string\">&#123;&quot;doc&quot;:&#123;&quot;title&quot;:&quot;Smartphone X2 - 128GB&quot;,&quot;price&quot;:1000.11&#125;&#125;</span></span><br><span class=\"line\"><span class=\"string\">&#123;&quot;update&quot;:&#123;&quot;_index&quot;:&quot;shopping&quot;,&quot;_id&quot;:&quot;2&quot;&#125;&#125;</span></span><br><span class=\"line\"><span class=\"string\">&#123;&quot;doc&quot;:&#123;&quot;title&quot;:&quot;T-shirt&quot;,&quot;price&quot;:45.99&#125;&#125;</span></span><br><span class=\"line\"><span class=\"string\">&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"># å‚æ•°è¯´æ˜</span></span><br><span class=\"line\"><span class=\"comment\"># update: ç”¨äºæ›´æ–°æ–‡æ¡£ã€‚</span></span><br><span class=\"line\"><span class=\"comment\"># doc: æŒ‡å®šè¦æ›´æ–°çš„å­—æ®µã€‚</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ‰¹é‡åˆ é™¤æ•°æ®</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æ³¨æ„æ•°æ®è¡Œè¦é¡¶è¡Œå†™ï¼Œå‰é¢ä¸è¦æœ‰ç©ºæ ¼</span></span><br><span class=\"line\">curl -X POST -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/_bulk&#x27;</span> \\</span><br><span class=\"line\">  -H <span class=\"string\">&#x27;Content-Type: application/json&#x27;</span> \\</span><br><span class=\"line\">  -d <span class=\"string\">&#x27;&#123;&quot;delete&quot;:&#123;&quot;_index&quot;:&quot;shopping&quot;,&quot;_id&quot;:&quot;1&quot;&#125;&#125;</span></span><br><span class=\"line\"><span class=\"string\">&#123;&quot;delete&quot;:&#123;&quot;_index&quot;:&quot;shopping&quot;,&quot;_id&quot;:&quot;2&quot;&#125;&#125;</span></span><br><span class=\"line\"><span class=\"string\">&#123;&quot;delete&quot;:&#123;&quot;_index&quot;:&quot;shopping&quot;,&quot;_id&quot;:&quot;3&quot;&#125;&#125;</span></span><br><span class=\"line\"><span class=\"string\">&#123;&quot;delete&quot;:&#123;&quot;_index&quot;:&quot;shopping&quot;,&quot;_id&quot;:&quot;4&quot;&#125;&#125;</span></span><br><span class=\"line\"><span class=\"string\">&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"># å‚æ•°è¯´æ˜</span></span><br><span class=\"line\"><span class=\"comment\"># delete: ç”¨äºåˆ é™¤æ–‡æ¡£ã€‚</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"æ¡ä»¶æ›´æ–°\">æ¡ä»¶æ›´æ–°</h2>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># POST /&lt;target&gt;/_update_by_query</span></span><br><span class=\"line\"><span class=\"comment\"># è¿™é‡Œå°†categoryä¸ºåä¸ºçš„æ•°æ®ä»·æ ¼æ”¹ä¸º1999</span></span><br><span class=\"line\">curl -X POST -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/shopping/_update_by_query?pretty&#x27;</span> \\</span><br><span class=\"line\">  -H <span class=\"string\">&#x27;Content-Type: application/json&#x27;</span> \\</span><br><span class=\"line\">  -d <span class=\"string\">&#x27;&#123;</span></span><br><span class=\"line\"><span class=\"string\">    &quot;query&quot;: &#123;</span></span><br><span class=\"line\"><span class=\"string\">      &quot;match&quot;: &#123;</span></span><br><span class=\"line\"><span class=\"string\">        &quot;category&quot;: &quot;books&quot;</span></span><br><span class=\"line\"><span class=\"string\">      &#125;</span></span><br><span class=\"line\"><span class=\"string\">    &#125;,</span></span><br><span class=\"line\"><span class=\"string\">    &quot;script&quot;: &#123;</span></span><br><span class=\"line\"><span class=\"string\">      &quot;source&quot;: &quot;ctx._source.price = 20.99&quot;,</span></span><br><span class=\"line\"><span class=\"string\">      &quot;lang&quot;: &quot;painless&quot;</span></span><br><span class=\"line\"><span class=\"string\">    &#125;</span></span><br><span class=\"line\"><span class=\"string\">  &#125;&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"># å‚æ•°è¯´æ˜</span></span><br><span class=\"line\"><span class=\"comment\">## &quot;query&quot;: &#123;&#125;  æŸ¥è¯¢æ¡ä»¶</span></span><br><span class=\"line\"><span class=\"comment\">## &quot;script&quot;: &#123;&#125;  è„šæœ¬</span></span><br><span class=\"line\"><span class=\"comment\">### source: è„šæœ¬å†…å®¹</span></span><br><span class=\"line\"><span class=\"comment\">### lang: è„šæœ¬è¯­è¨€</span></span><br><span class=\"line\"><span class=\"comment\">#### painless æ˜¯ Elasticsearch å®˜æ–¹æä¾›çš„è„šæœ¬è¯­è¨€ï¼Œå®ƒæä¾›äº†è®¸å¤šå†…ç½®å‡½æ•°å’Œå˜é‡ï¼Œå¯ä»¥æ–¹ä¾¿åœ°å®ç°å„ç§å¤æ‚çš„é€»è¾‘æ“ä½œã€‚https://www.elastic.co/guide/en/elasticsearch/painless/current/painless-lang-spec.html</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"æ¡ä»¶åˆ é™¤\">æ¡ä»¶åˆ é™¤</h2>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># POST /&lt;target&gt;/_delete_by_query</span></span><br><span class=\"line\">curl -X POST -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/shopping/_delete_by_query?pretty&#x27;</span> \\</span><br><span class=\"line\">  -H <span class=\"string\">&#x27;Content-Type: application/json&#x27;</span> \\</span><br><span class=\"line\">  -d <span class=\"string\">&#x27;&#123;&quot;query&quot;:&#123;&quot;match&quot;:&#123;&quot;category&quot;:&quot;books&quot;&#125;&#125;&#125;&#x27;</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"æ¡ä»¶æŸ¥è¯¢\">æ¡ä»¶æŸ¥è¯¢</h2>\n<h3 id=\"match-all-å…¨éƒ¨åŒ¹é…æŸ¥è¯¢\">match_all: å…¨éƒ¨åŒ¹é…æŸ¥è¯¢</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># GET /&lt;target&gt;/_search</span></span><br><span class=\"line\">curl -X GET -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27;</span></span><br><span class=\"line\">  -H <span class=\"string\">&#x27;Content-Type: application/json&#x27;</span> \\</span><br><span class=\"line\">  -d <span class=\"string\">&#x27;&#123;&quot;query&quot;:&#123;&quot;match_all&quot;:&#123;&#125;&#125;&#125;&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æˆ–è€…ç®€å†™ä¸º</span></span><br><span class=\"line\">curl -X GET -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"term-ç²¾ç¡®åŒ¹é…æŸ¥è¯¢ï¼ˆå…³é”®å­—æŸ¥è¯¢ï¼Œå³ä¸åˆ†è¯ï¼‰\">term: ç²¾ç¡®åŒ¹é…æŸ¥è¯¢ï¼ˆå…³é”®å­—æŸ¥è¯¢ï¼Œå³ä¸åˆ†è¯ï¼‰</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -X GET -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27;</span> \\</span><br><span class=\"line\">  -H <span class=\"string\">&#x27;Content-Type: application/json&#x27;</span> \\</span><br><span class=\"line\">  -d <span class=\"string\">&#x27;&#123;&quot;query&quot;:&#123;&quot;term&quot;:&#123;&quot;category&quot;:&quot;electronics&quot;&#125;&#125;&#125;&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å¦‚æœå­—æ®µè¢«é¢å¤–è®¾ç½® keyword ç±»å‹ï¼Œåˆ™éœ€è¦åŠ ä¸Š .keyword åç¼€</span></span><br><span class=\"line\">curl -X GET -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27;</span> \\</span><br><span class=\"line\">  -H <span class=\"string\">&#x27;Content-Type: application/json&#x27;</span> \\</span><br><span class=\"line\">  -d <span class=\"string\">&#x27;&#123;&quot;query&quot;:&#123;&quot;term&quot;:&#123;&quot;address.keyword&quot;:&quot;å¹¿å·ç™½äº‘å±±å…¬å›­&quot;&#125;&#125;&#125;&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># termå¤„ç†å¤šå€¼å­—æ®µ(æ•°ç»„)æ—¶ï¼ŒtermæŸ¥è¯¢æ˜¯åŒ…å«ï¼Œä¸æ˜¯ç­‰äº</span></span><br><span class=\"line\">curl -X GET -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27;</span> \\</span><br><span class=\"line\">  -H <span class=\"string\">&#x27;Content-Type: application/json&#x27;</span> \\</span><br><span class=\"line\">  -d <span class=\"string\">&#x27;&#123;&quot;query&quot;:&#123;&quot;term&quot;:&#123;&quot;tags&quot;:&quot;technology&quot;&#125;&#125;&#125;&#x27;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"terms-å¤šå…³é”®å­—ç²¾ç¡®åŒ¹é…æŸ¥è¯¢\">terms: å¤šå…³é”®å­—ç²¾ç¡®åŒ¹é…æŸ¥è¯¢</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -X GET -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27;</span> \\</span><br><span class=\"line\">  -H <span class=\"string\">&#x27;Content-Type: application/json&#x27;</span> \\</span><br><span class=\"line\">  -d <span class=\"string\">&#x27;&#123;&quot;query&quot;:&#123;&quot;terms&quot;:&#123;&quot;category&quot;:[&quot;electronics&quot;,&quot;books&quot;]&#125;&#125;&#125;&#x27;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"range-èŒƒå›´æŸ¥è¯¢\">range: èŒƒå›´æŸ¥è¯¢</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -X GET -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27;</span> \\</span><br><span class=\"line\">  -H <span class=\"string\">&#x27;Content-Type: application/json&#x27;</span> \\</span><br><span class=\"line\">  -d <span class=\"string\">&#x27;&#123;&quot;query&quot;:&#123;&quot;range&quot;:&#123;&quot;price&quot;:&#123;&quot;gte&quot;:20,&quot;lte&quot;:30&#125;&#125;&#125;&#125;&#x27;</span></span><br><span class=\"line\">  <span class=\"comment\"># gte: å¤§äºç­‰äº</span></span><br><span class=\"line\">  <span class=\"comment\"># lte: å°äºç­‰äº</span></span><br><span class=\"line\">  <span class=\"comment\"># gt: å¤§äº</span></span><br><span class=\"line\">  <span class=\"comment\"># lt: å°äº</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ—¶é—´èŒƒå›´æŸ¥è¯¢</span></span><br><span class=\"line\">curl -X GET -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27;</span> \\</span><br><span class=\"line\">  -H <span class=\"string\">&#x27;Content-Type: application/json&#x27;</span> \\</span><br><span class=\"line\">  -d <span class=\"string\">&#x27;&#123;&quot;query&quot;:&#123;&quot;range&quot;:&#123;&quot;created_at&quot;:&#123;&quot;gte&quot;:&quot;2025-04-20 00:00:00&quot;,&quot;lte&quot;:&quot;2025-05-20 23:59:59&quot;&#125;&#125;&#125;&#125;&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åŸºäºæ—¥æœŸæ•°å­¦è¡¨è¾¾å¼æŸ¥è¯¢</span></span><br><span class=\"line\">curl -X GET -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27;</span> \\</span><br><span class=\"line\">  -H <span class=\"string\">&#x27;Content-Type: application/json&#x27;</span> \\</span><br><span class=\"line\">  -d <span class=\"string\">&#x27;&#123;&quot;query&quot;:&#123;&quot;range&quot;:&#123;&quot;created_at&quot;:&#123;&quot;gte&quot;:&quot;now-1y&quot;&#125;&#125;&#125;&#125;&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ”¯æŒçš„æ—¥æœŸè¡¨è¾¾å¼</span></span><br><span class=\"line\"><span class=\"comment\"># - nowï¼šå½“å‰æ—¶é—´ç‚¹ã€‚</span></span><br><span class=\"line\"><span class=\"comment\"># - now-1dï¼šä»å½“å‰æ—¶é—´ç‚¹å‘å‰æ¨1å¤©çš„æ—¶é—´ç‚¹ã€‚</span></span><br><span class=\"line\"><span class=\"comment\"># - now-1wï¼šä»å½“å‰æ—¶é—´ç‚¹å‘å‰æ¨1å‘¨çš„æ—¶é—´ç‚¹ã€‚</span></span><br><span class=\"line\"><span class=\"comment\"># - now-1Mï¼šä»å½“å‰æ—¶é—´ç‚¹å‘å‰æ¨1ä¸ªæœˆçš„æ—¶é—´ç‚¹ã€‚</span></span><br><span class=\"line\"><span class=\"comment\"># - now-1yï¼šä»å½“å‰æ—¶é—´ç‚¹å‘å‰æ¨1å¹´çš„æ—¶é—´ç‚¹ã€‚</span></span><br><span class=\"line\"><span class=\"comment\"># - now+1hï¼šä»å½“å‰æ—¶é—´ç‚¹å‘åæ¨1å°æ—¶çš„æ—¶é—´ç‚¹ã€‚</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"exists-æŸ¥è¯¢å­—æ®µå­˜åœ¨çš„æ•°æ®\">exists: æŸ¥è¯¢å­—æ®µå­˜åœ¨çš„æ•°æ®</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -X GET -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27;</span> \\</span><br><span class=\"line\">  -H <span class=\"string\">&#x27;Content-Type: application/json&#x27;</span> \\</span><br><span class=\"line\">  -d <span class=\"string\">&#x27;&#123;&quot;query&quot;:&#123;&quot;exists&quot;:&#123;&quot;field&quot;:&quot;title&quot;&#125;&#125;&#125;&#x27;</span></span><br><span class=\"line\">  <span class=\"comment\"># field: æŒ‡å®šè¦æŸ¥è¯¢çš„å­—æ®µ</span></span><br><span class=\"line\">  <span class=\"comment\"># ç¤ºä¾‹ï¼šæŸ¥è¯¢ title å­—æ®µå­˜åœ¨çš„æ–‡æ¡£</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"ids-æ ¹æ®ä¸€ç»„IDæŸ¥è¯¢\">ids: æ ¹æ®ä¸€ç»„IDæŸ¥è¯¢</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -X GET -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27;</span> \\</span><br><span class=\"line\">  -H <span class=\"string\">&#x27;Content-Type: application/json&#x27;</span> \\</span><br><span class=\"line\">  -d <span class=\"string\">&#x27;&#123;&quot;query&quot;:&#123;&quot;ids&quot;:&#123;&quot;values&quot;:[&quot;1&quot;,&quot;2&quot;]&#125;&#125;&#125;&#x27;</span></span><br><span class=\"line\">  <span class=\"comment\"># values: æŒ‡å®šè¦æŸ¥è¯¢çš„IDåˆ—è¡¨</span></span><br><span class=\"line\">  <span class=\"comment\"># ç¤ºä¾‹ï¼šæŸ¥è¯¢IDä¸º1å’Œ2çš„æ–‡æ¡£</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"prefix-å‰ç¼€æŸ¥è¯¢\">prefix: å‰ç¼€æŸ¥è¯¢</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä»…é€‚ç”¨äºå…³é”®å­—ç±»å‹(keyword)çš„å­—æ®µ</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -X GET -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27;</span> \\</span><br><span class=\"line\">  -H <span class=\"string\">&#x27;Content-Type: application/json&#x27;</span> \\</span><br><span class=\"line\">  -d <span class=\"string\">&#x27;&#123;&quot;query&quot;:&#123;&quot;prefix&quot;:&#123;&quot;category&quot;:&quot;elec&quot;&#125;&#125;&#125;&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ä»…é€‚ç”¨äºkeywordç±»å‹å­—æ®µï¼Œæ‰€ä»¥ä¸‹é¢è¿™ä¸ªè¯·æ±‚æŸ¥è¯¢ä¸åˆ°æ•°æ®</span></span><br><span class=\"line\">curl -X GET -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27;</span> \\</span><br><span class=\"line\">  -H <span class=\"string\">&#x27;Content-Type: application/json&#x27;</span> \\</span><br><span class=\"line\">  -d <span class=\"string\">&#x27;&#123;&quot;query&quot;:&#123;&quot;prefix&quot;:&#123;&quot;address&quot;:&quot;å¹¿å·ç™½äº‘å±±&quot;&#125;&#125;&#125;&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"># å› ä¸ºaddressè¢«é™„åŠ äº†keywordç±»å‹ï¼Œæ‰€ä»¥éœ€è¦åŠ ä¸Š.keywordåç¼€åå¯ä»¥æŸ¥è¯¢åˆ°æ•°æ®</span></span><br><span class=\"line\">curl -X GET -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27;</span> \\</span><br><span class=\"line\">  -H <span class=\"string\">&#x27;Content-Type: application/json&#x27;</span> \\</span><br><span class=\"line\">  -d <span class=\"string\">&#x27;&#123;&quot;query&quot;:&#123;&quot;prefix&quot;:&#123;&quot;address.keyword&quot;:&quot;å¹¿å·ç™½äº‘å±±&quot;&#125;&#125;&#125;&#x27;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"wildcard-é€šé…ç¬¦æŸ¥è¯¢\">wildcard: é€šé…ç¬¦æŸ¥è¯¢</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä»…é€‚ç”¨äºå…³é”®å­—ç±»å‹(keyword)çš„å­—æ®µ</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -X GET -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27;</span> \\</span><br><span class=\"line\">  -H <span class=\"string\">&#x27;Content-Type: application/json&#x27;</span> \\</span><br><span class=\"line\">  -d <span class=\"string\">&#x27;&#123;&quot;query&quot;:&#123;&quot;wildcard&quot;:&#123;&quot;category&quot;:&quot;e?e*&quot;&#125;&#125;&#125;&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"># ?: ä»»æ„å•ä¸ªå­—ç¬¦</span></span><br><span class=\"line\"><span class=\"comment\"># *: ä»»æ„å¤šä¸ªå­—ç¬¦</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"regexp-æ­£åˆ™è¡¨è¾¾å¼æŸ¥è¯¢\">regexp: æ­£åˆ™è¡¨è¾¾å¼æŸ¥è¯¢</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä»…é€‚ç”¨äºå…³é”®å­—ç±»å‹(keyword)çš„å­—æ®µ</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -X GET -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27;</span> \\</span><br><span class=\"line\">  -H <span class=\"string\">&#x27;Content-Type: application/json&#x27;</span> \\</span><br><span class=\"line\">  -d <span class=\"string\">&#x27;&#123;&quot;query&quot;:&#123;&quot;regexp&quot;:&#123;&quot;category&quot;:&quot;e.e.*&quot;&#125;&#125;&#125;&#x27;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"fuzzy-æ”¯æŒç¼–è¾‘è·ç¦»çš„æ¨¡ç³ŠæŸ¥è¯¢\">fuzzy: æ”¯æŒç¼–è¾‘è·ç¦»çš„æ¨¡ç³ŠæŸ¥è¯¢</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä»…é€‚ç”¨äºå…³é”®å­—ç±»å‹(keyword)çš„å­—æ®µ</p>\n</li>\n<li class=\"lvl-2\">\n<p>fuzzyæ£€ç´¢æ˜¯ä¸€ç§å¼ºå¤§çš„æœç´¢åŠŸèƒ½ï¼Œå®ƒèƒ½å¤Ÿåœ¨ç”¨æˆ·è¾“å…¥å†…å®¹å­˜åœ¨æ‹¼å†™é”™è¯¯æˆ–ä¸Šä¸‹æ–‡ä¸ä¸€è‡´æ—¶ï¼Œä»ç„¶è¿”å›ä¸æœç´¢è¯ç›¸ä¼¼çš„æ–‡æ¡£ã€‚é€šè¿‡ä½¿ç”¨ç¼–è¾‘è·ç¦»ç®—æ³•æ¥åº¦é‡è¾“å…¥è¯ä¸æ–‡æ¡£ä¸­è¯æ¡çš„ç›¸ä¼¼ç¨‹åº¦ï¼Œæ¨¡ç³ŠæŸ¥è¯¢åœ¨ä¿è¯æœç´¢ç»“æœç›¸å…³æ€§çš„åŒæ—¶ï¼Œæœ‰æ•ˆåœ°æé«˜äº†æœç´¢å®¹é”™èƒ½åŠ›ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ç¼–è¾‘è·ç¦»æ˜¯æŒ‡ä»ä¸€ä¸ªå•è¯è½¬æ¢åˆ°å¦ä¸€ä¸ªå•è¯éœ€è¦ç¼–è¾‘å•å­—ç¬¦çš„æ¬¡æ•°ã€‚å¦‚ä¸­æ–‡é›†å›¢åˆ°ä¸­å¨é›†å›¢ç¼–è¾‘è·ç¦»å°±æ˜¯1ï¼Œåªéœ€è¦ä¿®æ”¹ä¸€ä¸ªå­—ç¬¦ï¼›å¦‚æœfuzzinesså€¼åœ¨è¿™é‡Œè®¾ç½®æˆ2ï¼Œä¼šæŠŠç¼–è¾‘è·ç¦»ä¸º2çš„ä¸œä¸œé›†å›¢ä¹ŸæŸ¥å‡ºæ¥ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -X GET -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27;</span> \\</span><br><span class=\"line\">  -H <span class=\"string\">&#x27;Content-Type: application/json&#x27;</span> \\</span><br><span class=\"line\">  -d <span class=\"string\">&#x27;&#123;</span></span><br><span class=\"line\"><span class=\"string\">      &quot;query&quot;:&#123;</span></span><br><span class=\"line\"><span class=\"string\">        &quot;fuzzy&quot;:&#123;</span></span><br><span class=\"line\"><span class=\"string\">          &quot;category&quot;:&#123;</span></span><br><span class=\"line\"><span class=\"string\">            &quot;value&quot;:&quot;beeks&quot;,</span></span><br><span class=\"line\"><span class=\"string\">            &quot;fuzziness&quot;:&quot;2&quot;,</span></span><br><span class=\"line\"><span class=\"string\">            &quot;prefix_length&quot;:1</span></span><br><span class=\"line\"><span class=\"string\">          &#125;</span></span><br><span class=\"line\"><span class=\"string\">        &#125;</span></span><br><span class=\"line\"><span class=\"string\">      &#125;</span></span><br><span class=\"line\"><span class=\"string\">    &#125;&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"># fuzzinessï¼šç”¨äºç¼–è¾‘è·ç¦»çš„è®¾ç½®ï¼Œå…¶é»˜è®¤å€¼ä¸ºAUTOï¼Œæ”¯æŒçš„æ•°å€¼ä¸º[0ï¼Œ1ï¼Œ2]ã€‚å¦‚æœå€¼è®¾ç½®è¶Šç•Œä¼šæŠ¥é”™ã€‚</span></span><br><span class=\"line\"><span class=\"comment\"># prefix_length: æœç´¢è¯çš„å‰ç¼€é•¿åº¦ï¼Œåœ¨æ­¤é•¿åº¦å†…ä¸ä¼šåº”ç”¨æ¨¡ç³ŠåŒ¹é…ã€‚é»˜è®¤æ˜¯0ï¼Œå³æ•´ä¸ªè¯éƒ½ä¼šè¢«æ¨¡ç³ŠåŒ¹é…ã€‚</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"match-å…¨æ–‡æ£€ç´¢-å³åˆ†è¯\">match: å…¨æ–‡æ£€ç´¢(å³åˆ†è¯)</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -X GET -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27;</span> \\</span><br><span class=\"line\">  -H <span class=\"string\">&#x27;Content-Type: application/json&#x27;</span> \\</span><br><span class=\"line\">  -d <span class=\"string\">&#x27;&#123;&quot;query&quot;:&#123;&quot;match&quot;:&#123;&quot;address&quot;:&quot;å¹¿å·ç™½äº‘å±±å…¬å›­&quot;&#125;&#125;&#125;&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å› ä¸º desc çš„ç´¢å¼•åˆ†è¯å™¨æ˜¯ ik_max_wordï¼ŒæŸ¥çœ‹â€œå¹¿å·ç™½äº‘å±±å…¬å›­â€è¢«åˆ†è¯åçš„ç»“æœ</span></span><br><span class=\"line\">curl -X GET -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/_analyze?pretty&#x27;</span> \\</span><br><span class=\"line\">  -H <span class=\"string\">&#x27;Content-Type: application/json&#x27;</span> \\</span><br><span class=\"line\">  -d <span class=\"string\">&#x27;&#123;</span></span><br><span class=\"line\"><span class=\"string\">        &quot;analyzer&quot;: &quot;ik_max_word&quot;,</span></span><br><span class=\"line\"><span class=\"string\">        &quot;text&quot;: &quot;å¹¿å·ç™½äº‘å±±å…¬å›­&quot;</span></span><br><span class=\"line\"><span class=\"string\">    &#125;&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"># è¿”å›å€¼</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">&quot;tokens&quot;</span> : [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      <span class=\"string\">&quot;token&quot;</span> : <span class=\"string\">&quot;å¹¿å·&quot;</span>,</span><br><span class=\"line\">      <span class=\"string\">&quot;start_offset&quot;</span> : 0,</span><br><span class=\"line\">      <span class=\"string\">&quot;end_offset&quot;</span> : 2,</span><br><span class=\"line\">      <span class=\"string\">&quot;type&quot;</span> : <span class=\"string\">&quot;CN_WORD&quot;</span>,</span><br><span class=\"line\">      <span class=\"string\">&quot;position&quot;</span> : 0</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      <span class=\"string\">&quot;token&quot;</span> : <span class=\"string\">&quot;ç™½äº‘å±±&quot;</span>,</span><br><span class=\"line\">      <span class=\"string\">&quot;start_offset&quot;</span> : 2,</span><br><span class=\"line\">      <span class=\"string\">&quot;end_offset&quot;</span> : 5,</span><br><span class=\"line\">      <span class=\"string\">&quot;type&quot;</span> : <span class=\"string\">&quot;CN_WORD&quot;</span>,</span><br><span class=\"line\">      <span class=\"string\">&quot;position&quot;</span> : 1</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      <span class=\"string\">&quot;token&quot;</span> : <span class=\"string\">&quot;ç™½äº‘&quot;</span>,</span><br><span class=\"line\">      <span class=\"string\">&quot;start_offset&quot;</span> : 2,</span><br><span class=\"line\">      <span class=\"string\">&quot;end_offset&quot;</span> : 4,</span><br><span class=\"line\">      <span class=\"string\">&quot;type&quot;</span> : <span class=\"string\">&quot;CN_WORD&quot;</span>,</span><br><span class=\"line\">      <span class=\"string\">&quot;position&quot;</span> : 2</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      <span class=\"string\">&quot;token&quot;</span> : <span class=\"string\">&quot;äº‘å±±&quot;</span>,</span><br><span class=\"line\">      <span class=\"string\">&quot;start_offset&quot;</span> : 3,</span><br><span class=\"line\">      <span class=\"string\">&quot;end_offset&quot;</span> : 5,</span><br><span class=\"line\">      <span class=\"string\">&quot;type&quot;</span> : <span class=\"string\">&quot;CN_WORD&quot;</span>,</span><br><span class=\"line\">      <span class=\"string\">&quot;position&quot;</span> : 3</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      <span class=\"string\">&quot;token&quot;</span> : <span class=\"string\">&quot;å…¬å›­&quot;</span>,</span><br><span class=\"line\">      <span class=\"string\">&quot;start_offset&quot;</span> : 5,</span><br><span class=\"line\">      <span class=\"string\">&quot;end_offset&quot;</span> : 7,</span><br><span class=\"line\">      <span class=\"string\">&quot;type&quot;</span> : <span class=\"string\">&quot;CN_WORD&quot;</span>,</span><br><span class=\"line\">      <span class=\"string\">&quot;position&quot;</span> : 4</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\"># æ‰€ä»¥åªè¦descä¸­åŒ…å«å¦‚ä¸Šè¿™äº›å†…å®¹çš„æ•°æ®éƒ½ä¼šè¢«åŒ¹é…ä¸Š</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ä½†æ˜¯è¿™æ ·åŒ¹é…çš„ç»“æœå°±ä¸å¤Ÿç²¾ç¡®ï¼Œå¦‚ä½•å°½é‡åŒ¹é…æ›´å¤šçš„åˆ†è¯å‘¢ï¼Œå¯ä»¥å¢åŠ  minimum_should_match</span></span><br><span class=\"line\">curl -X GET -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27;</span> \\</span><br><span class=\"line\">  -H <span class=\"string\">&#x27;Content-Type: application/json&#x27;</span> \\</span><br><span class=\"line\">  -d <span class=\"string\">&#x27;&#123;</span></span><br><span class=\"line\"><span class=\"string\">    &quot;query&quot;:&#123;</span></span><br><span class=\"line\"><span class=\"string\">      &quot;match&quot;:&#123;</span></span><br><span class=\"line\"><span class=\"string\">        &quot;address&quot;:&#123;</span></span><br><span class=\"line\"><span class=\"string\">          &quot;query&quot;: &quot;å¹¿å·ç™½äº‘å±±å…¬å›­&quot;,</span></span><br><span class=\"line\"><span class=\"string\">          &quot;minimum_should_match&quot;: 2</span></span><br><span class=\"line\"><span class=\"string\">        &#125;</span></span><br><span class=\"line\"><span class=\"string\">      &#125;</span></span><br><span class=\"line\"><span class=\"string\">    &#125;</span></span><br><span class=\"line\"><span class=\"string\">  &#125;&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"># minimum_should_match: 2 è¡¨ç¤ºè‡³å°‘åŒ¹é…ä¸¤ä¸ª</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å¦‚æœå¸Œæœ›å…¨éƒ¨éƒ½åŒ¹é…å‘¢</span></span><br><span class=\"line\">curl -X GET -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27;</span> \\</span><br><span class=\"line\">  -H <span class=\"string\">&#x27;Content-Type: application/json&#x27;</span> \\</span><br><span class=\"line\">  -d <span class=\"string\">&#x27;&#123;</span></span><br><span class=\"line\"><span class=\"string\">    &quot;query&quot;:&#123;</span></span><br><span class=\"line\"><span class=\"string\">      &quot;match&quot;:&#123;</span></span><br><span class=\"line\"><span class=\"string\">        &quot;address&quot;:&#123;</span></span><br><span class=\"line\"><span class=\"string\">          &quot;query&quot;: &quot;å¹¿å·ç™½äº‘å±±å…¬å›­&quot;,</span></span><br><span class=\"line\"><span class=\"string\">          &quot;operator&quot;: &quot;and&quot;</span></span><br><span class=\"line\"><span class=\"string\">        &#125;</span></span><br><span class=\"line\"><span class=\"string\">      &#125;</span></span><br><span class=\"line\"><span class=\"string\">    &#125;</span></span><br><span class=\"line\"><span class=\"string\">  &#125;&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"># operator: and è¡¨ç¤ºå…¨éƒ¨åŒ¹é…ï¼Œæ­¤æ—¶ç›¸å½“äºç²¾ç¡®åŒ¹é…ï¼Œå…¶é»˜è®¤å€¼æ˜¯ or</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"multi-match-å¤šå­—æ®µæŸ¥è¯¢\">multi_match: å¤šå­—æ®µæŸ¥è¯¢</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>multi_matchæŸ¥è¯¢åœ¨Elasticsearchä¸­ç”¨äºåœ¨å¤šä¸ªå­—æ®µä¸Šæ‰§è¡Œç›¸åŒçš„æœç´¢æ“ä½œã€‚å®ƒå¯ä»¥æ¥å—ä¸€ä¸ªæŸ¥è¯¢å­—ç¬¦ä¸²ï¼Œå¹¶åœ¨æŒ‡å®šçš„å­—æ®µé›†åˆä¸­æœç´¢è¿™ä¸ªå­—ç¬¦ä¸²ã€‚multi_matchæŸ¥è¯¢æä¾›äº†çµæ´»çš„åŒ¹é…ç±»å‹å’Œæ“ä½œç¬¦é€‰é¡¹ï¼Œä»¥ä¾¿æ ¹æ®ä¸åŒçš„æœç´¢éœ€æ±‚è°ƒæ•´æœç´¢è¡Œä¸ºã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -X GET -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27;</span> \\</span><br><span class=\"line\">  -H <span class=\"string\">&#x27;Content-Type: application/json&#x27;</span> \\</span><br><span class=\"line\">  -d <span class=\"string\">&#x27;&#123;</span></span><br><span class=\"line\"><span class=\"string\">    &quot;query&quot;:&#123;</span></span><br><span class=\"line\"><span class=\"string\">      &quot;multi_match&quot;:&#123;</span></span><br><span class=\"line\"><span class=\"string\">        &quot;query&quot;: &quot;å¹¿å·shirt&quot;,</span></span><br><span class=\"line\"><span class=\"string\">        &quot;fields&quot;:[&quot;title&quot;,&quot;address&quot;]</span></span><br><span class=\"line\"><span class=\"string\">      &#125;</span></span><br><span class=\"line\"><span class=\"string\">    &#125;</span></span><br><span class=\"line\"><span class=\"string\">  &#125;&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"># query: æŸ¥è¯¢æ¡ä»¶</span></span><br><span class=\"line\"><span class=\"comment\"># fields: æŒ‡å®šå¤šä¸ªå­—æ®µè¿›è¡ŒåŒ¹é…</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"match-phrase-çŸ­è¯­æŸ¥è¯¢\">match_phrase: çŸ­è¯­æŸ¥è¯¢</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>match_phraseæŸ¥è¯¢åœ¨Elasticsearchä¸­ç”¨äºæ‰§è¡ŒçŸ­è¯­æœç´¢ï¼Œå®ƒä¸ä»…åŒ¹é…æ•´ä¸ªçŸ­è¯­ï¼Œè€Œä¸”è¿˜è€ƒè™‘äº†çŸ­è¯­ä¸­å„ä¸ªè¯çš„é¡ºåºå’Œä½ç½®ã€‚è¿™ç§æŸ¥è¯¢ç±»å‹å¯¹äºæœç´¢ç²¾ç¡®çŸ­è¯­éå¸¸æœ‰ç”¨ï¼Œå°¤å…¶æ˜¯åœ¨ç”¨æˆ·è¾“å…¥çš„æŸ¥è¯¢ä¸æ–‡æ¡£ä¸­çš„æ–‡æœ¬è¡¨è¾¾æ–¹å¼éœ€è¦ä¸¥æ ¼åŒ¹é…æ—¶ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -X GET -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27;</span> \\</span><br><span class=\"line\">  -H <span class=\"string\">&#x27;Content-Type: application/json&#x27;</span> \\</span><br><span class=\"line\">  -d <span class=\"string\">&#x27;&#123;</span></span><br><span class=\"line\"><span class=\"string\">  &quot;query&quot;:&#123;</span></span><br><span class=\"line\"><span class=\"string\">      &quot;match_phrase&quot;:&#123;</span></span><br><span class=\"line\"><span class=\"string\">        &quot;address&quot;:&#123;</span></span><br><span class=\"line\"><span class=\"string\">          &quot;query&quot;:&quot;å¹¿å·ç™½äº‘å±±&quot;</span></span><br><span class=\"line\"><span class=\"string\">        &#125;</span></span><br><span class=\"line\"><span class=\"string\">      &#125;</span></span><br><span class=\"line\"><span class=\"string\">    &#125;</span></span><br><span class=\"line\"><span class=\"string\">  &#125;&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"># è¦æ±‚æŸ¥è¯¢ç»“æœä¸­çš„æ•°æ®å¿…é¡»åŒ…å«&quot;å¹¿å·ç™½äº‘å±±&quot;ï¼Œè€Œä¸”â€œå¹¿å·â€å’Œâ€œç™½äº‘å±±â€è¿™ä¸¤ä¸ªè¯æ˜¯ä¸èƒ½åˆ†å¼€çš„ï¼Œå› ä¸º match_phrase åŒ¹é…çš„æ˜¯ç›¸é‚»è¯æ¡</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"query-string-æ”¯æŒä¸æˆ–éè¡¨è¾¾å¼çš„æŸ¥è¯¢\">query_string: æ”¯æŒ<code>ä¸æˆ–é</code>è¡¨è¾¾å¼çš„æŸ¥è¯¢</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>query_stringæŸ¥è¯¢æ˜¯ä¸€ç§çµæ´»çš„æŸ¥è¯¢ç±»å‹ï¼Œå®ƒå…è®¸ä½¿ç”¨LuceneæŸ¥è¯¢è¯­æ³•æ¥æ„å»ºå¤æ‚çš„æœç´¢æŸ¥è¯¢ã€‚è¿™ç§æŸ¥è¯¢ç±»å‹æ”¯æŒå¤šç§é€»è¾‘è¿ç®—ç¬¦ï¼ŒåŒ…æ‹¬ä¸ï¼ˆANDï¼‰ã€æˆ–ï¼ˆORï¼‰å’Œéï¼ˆNOTï¼‰ï¼Œä»¥åŠé€šé…ç¬¦ã€æ¨¡ç³Šæœç´¢å’Œæ­£åˆ™è¡¨è¾¾å¼ç­‰åŠŸèƒ½ã€‚query_stringæŸ¥è¯¢å¯ä»¥åœ¨å•ä¸ªæˆ–å¤šä¸ªå­—æ®µä¸Šè¿›è¡Œæœç´¢ï¼Œå¹¶ä¸”å¯ä»¥å¤„ç†å¤æ‚çš„æŸ¥è¯¢é€»è¾‘ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>æ³¨æ„: æŸ¥è¯¢å­—æ®µåˆ†è¯å°±å°†æŸ¥è¯¢æ¡ä»¶åˆ†è¯æŸ¥è¯¢ï¼ŒæŸ¥è¯¢å­—æ®µä¸åˆ†è¯å°†æŸ¥è¯¢æ¡ä»¶ä¸åˆ†è¯æŸ¥è¯¢</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æŸ¥è¯¢æ‰€æœ‰å­—æ®µä¸­åŒ…å« &quot;å…¬å›­&quot;å’Œ &quot;åä¸º&quot; çš„æ–‡æ¡£</span></span><br><span class=\"line\">curl -X GET -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27;</span> \\</span><br><span class=\"line\">  -H <span class=\"string\">&#x27;Content-Type: application/json&#x27;</span> \\</span><br><span class=\"line\">  -d <span class=\"string\">&#x27;&#123;</span></span><br><span class=\"line\"><span class=\"string\">  &quot;query&quot;:&#123;</span></span><br><span class=\"line\"><span class=\"string\">      &quot;query_string&quot;:&#123;</span></span><br><span class=\"line\"><span class=\"string\">        &quot;query&quot;:&quot;å…¬å›­ AND electronics&quot;</span></span><br><span class=\"line\"><span class=\"string\">      &#125;</span></span><br><span class=\"line\"><span class=\"string\">    &#125;</span></span><br><span class=\"line\"><span class=\"string\">  &#125;&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŒ‡å®šæŸ¥è¯¢çš„å•ä¸ªå­—æ®µ</span></span><br><span class=\"line\">curl -X GET -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27;</span> \\</span><br><span class=\"line\">  -H <span class=\"string\">&#x27;Content-Type: application/json&#x27;</span> \\</span><br><span class=\"line\">  -d <span class=\"string\">&#x27;&#123;</span></span><br><span class=\"line\"><span class=\"string\">  &quot;query&quot;:&#123;</span></span><br><span class=\"line\"><span class=\"string\">      &quot;query_string&quot;:&#123;</span></span><br><span class=\"line\"><span class=\"string\">        &quot;default_field&quot;:&quot;category&quot;,</span></span><br><span class=\"line\"><span class=\"string\">        &quot;query&quot;:&quot;ç™½äº‘å±± OR books&quot;</span></span><br><span class=\"line\"><span class=\"string\">      &#125;</span></span><br><span class=\"line\"><span class=\"string\">    &#125;</span></span><br><span class=\"line\"><span class=\"string\">  &#125;&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŒ‡å®šæŸ¥è¯¢çš„å¤šä¸ªå­—æ®µ</span></span><br><span class=\"line\">curl -X GET -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27;</span> \\</span><br><span class=\"line\">  -H <span class=\"string\">&#x27;Content-Type: application/json&#x27;</span> \\</span><br><span class=\"line\">  -d <span class=\"string\">&#x27;&#123;</span></span><br><span class=\"line\"><span class=\"string\">  &quot;query&quot;:&#123;</span></span><br><span class=\"line\"><span class=\"string\">      &quot;query_string&quot;:&#123;</span></span><br><span class=\"line\"><span class=\"string\">        &quot;fields&quot;:[&quot;category&quot;,&quot;address&quot;],</span></span><br><span class=\"line\"><span class=\"string\">        &quot;query&quot;:&quot;ç™½äº‘å±± OR (electronics AND shirt)&quot;</span></span><br><span class=\"line\"><span class=\"string\">      &#125;</span></span><br><span class=\"line\"><span class=\"string\">    &#125;</span></span><br><span class=\"line\"><span class=\"string\">  &#125;&#x27;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"simple-query-string-ç±»ä¼¼-query-stringï¼Œä½†æ˜¯ä¼šå¿½ç•¥é”™è¯¯çš„è¯­æ³•ï¼ŒåŒæ—¶åªæ”¯æŒéƒ¨åˆ†æŸ¥è¯¢è¯­æ³•\">simple_query_string: ç±»ä¼¼ <code>query_string</code>ï¼Œä½†æ˜¯ä¼šå¿½ç•¥é”™è¯¯çš„è¯­æ³•ï¼ŒåŒæ—¶åªæ”¯æŒéƒ¨åˆ†æŸ¥è¯¢è¯­æ³•</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -X GET -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27;</span> \\</span><br><span class=\"line\">  -H <span class=\"string\">&#x27;Content-Type: application/json&#x27;</span> \\</span><br><span class=\"line\">  -d <span class=\"string\">&#x27;&#123;</span></span><br><span class=\"line\"><span class=\"string\">  &quot;query&quot;:&#123;</span></span><br><span class=\"line\"><span class=\"string\">      &quot;simple_query_string&quot;:&#123;</span></span><br><span class=\"line\"><span class=\"string\">        &quot;query&quot;:&quot;å¹¿å·å…¬å›­&quot;,</span></span><br><span class=\"line\"><span class=\"string\">        &quot;default_operator&quot;:&quot;AND&quot;</span></span><br><span class=\"line\"><span class=\"string\">      &#125;</span></span><br><span class=\"line\"><span class=\"string\">    &#125;</span></span><br><span class=\"line\"><span class=\"string\">  &#125;&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"># default_operator: é»˜è®¤ä¸º ORï¼Œè®¾ç½®ä¸º AND åˆ™å¿…é¡»åŒæ—¶åŒ¹é…</span></span><br></pre></td></tr></table></figure>\n<div class=\"tips\">\n<p><em><strong>ESæŸ¥è¯¢ç»“æœå±æ€§å«ä¹‰</strong></em></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">&quot;took&quot;</span>:16,          <span class=\"comment\"># è¡¨ç¤ºæŸ¥è¯¢ä»è¯·æ±‚åˆ°å®Œæˆè€—æ—¶ 16 æ¯«ç§’ã€‚</span></span><br><span class=\"line\">  <span class=\"string\">&quot;timed_out&quot;</span>:<span class=\"literal\">false</span>,  <span class=\"comment\"># è¡¨ç¤ºæŸ¥è¯¢åœ¨è§„å®šçš„æ—¶é—´å†…å®Œæˆï¼Œæ²¡æœ‰å‘ç”Ÿè¶…æ—¶ã€‚å¦‚æœä¸º trueï¼Œåˆ™è¡¨ç¤ºæŸ¥è¯¢è¶…æ—¶ã€‚</span></span><br><span class=\"line\">  <span class=\"string\">&quot;_shards&quot;</span>:&#123;         <span class=\"comment\"># æ¶‰åŠåˆ°æŸ¥è¯¢è¿‡ç¨‹ä¸­ä½¿ç”¨çš„åˆ†ç‰‡ä¿¡æ¯</span></span><br><span class=\"line\">    <span class=\"string\">&quot;total&quot;</span>:1,        <span class=\"comment\"># è¡¨ç¤ºæŸ¥è¯¢æ¶‰åŠåˆ°çš„æ€»åˆ†ç‰‡æ•°ä¸º 1</span></span><br><span class=\"line\">    <span class=\"string\">&quot;successful&quot;</span>:1,   <span class=\"comment\"># è¡¨ç¤ºæŸ¥è¯¢æˆåŠŸå®Œæˆçš„åˆ†ç‰‡æ•°ä¸º 1</span></span><br><span class=\"line\">    <span class=\"string\">&quot;skipped&quot;</span>:0,      <span class=\"comment\"># è¡¨ç¤ºæŸ¥è¯¢è¿‡ç¨‹ä¸­è¢«è·³è¿‡çš„åˆ†ç‰‡æ•°ä¸º 0</span></span><br><span class=\"line\">    <span class=\"string\">&quot;failed&quot;</span>:0        <span class=\"comment\"># è¡¨ç¤ºæŸ¥è¯¢è¿‡ç¨‹ä¸­å¤±è´¥çš„åˆ†ç‰‡æ•°ä¸º 0</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"string\">&quot;hits&quot;</span>:&#123;            <span class=\"comment\"># åŒ…å«æŸ¥è¯¢ç»“æœçš„è¯¦ç»†ä¿¡æ¯</span></span><br><span class=\"line\">    <span class=\"string\">&quot;total&quot;</span>:&#123;         <span class=\"comment\"># åŒ…å«æŸ¥è¯¢ç»“æœçš„æ€»æ•°</span></span><br><span class=\"line\">      <span class=\"string\">&quot;value&quot;</span>:4,      <span class=\"comment\"># è¡¨ç¤ºæŸ¥è¯¢ç»“æœçš„æ€»æ•°ä¸º 4</span></span><br><span class=\"line\">      <span class=\"string\">&quot;relation&quot;</span>:<span class=\"string\">&quot;eq&quot;</span> <span class=\"comment\"># è¡¨ç¤ºè¿”å›çš„æ€»æ•° value æ˜¯ç¡®åˆ‡çš„ï¼ˆequalï¼‰ã€‚å¦‚æœä¸º gteï¼Œåˆ™è¡¨ç¤ºè¿”å›çš„æ€»æ•°æ˜¯ä¸€ä¸ªä¸‹é™å€¼ã€‚</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"string\">&quot;max_score&quot;</span>:0.0,  <span class=\"comment\"># è¡¨ç¤ºåŒ¹é…åˆ°çš„æ–‡æ¡£ä¸­æœ€é«˜çš„å¾—åˆ†ã€‚å¦‚æœæ˜¯æ’åºæŸ¥è¯¢ï¼Œè¿™ä¸ªå€¼ä¼šæœ‰æ„ä¹‰ã€‚å½“å‰ç»“æœå› ä¸º size: 0ï¼Œæ²¡æœ‰å®é™…è¿”å›æ–‡æ¡£ï¼Œæ‰€ä»¥å¾—åˆ†ä¸º 0.0</span></span><br><span class=\"line\">    <span class=\"string\">&quot;hits&quot;</span>:[ ]        <span class=\"comment\"># åŒ…å«æŸ¥è¯¢ç»“æœçš„åˆ—è¡¨ï¼Œæ¯ä¸ªç»“æœéƒ½æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼ŒåŒ…å«æ–‡æ¡£çš„å…ƒæ•°æ®ï¼Œå¦‚ idã€åˆ†æ•°ç­‰ã€‚</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</div>\n<h2 id=\"bool-æŸ¥è¯¢\">bool æŸ¥è¯¢</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¸ƒå°”æŸ¥è¯¢å¯ä»¥æŒ‰ç…§å¸ƒå°”é€»è¾‘æ¡ä»¶ç»„ç»‡å¤šæ¡æŸ¥è¯¢è¯­å¥ï¼Œåªæœ‰ç¬¦åˆæ•´ä¸ªå¸ƒå°”æ¡ä»¶çš„æ–‡æ¡£æ‰ä¼šè¢«æœç´¢å‡ºæ¥ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>åœ¨å¸ƒå°”æ¡ä»¶ä¸­ï¼Œå¯ä»¥åŒ…å«ä¸¤ç§ä¸åŒçš„ä¸Šä¸‹æ–‡ã€‚</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">1.æœç´¢ä¸Šä¸‹æ–‡(query context)ï¼šä½¿ç”¨æœç´¢ä¸Šä¸‹æ–‡æ—¶ï¼ŒElasticsearchéœ€è¦è®¡ç®—æ¯ä¸ªæ–‡æ¡£ä¸æœç´¢æ¡ä»¶çš„ç›¸å…³åº¦å¾—åˆ†ï¼Œè¿™ä¸ªå¾—åˆ†çš„è®¡ç®—éœ€ä½¿ç”¨ä¸€å¥—å¤æ‚çš„è®¡ç®—å…¬å¼ï¼Œæœ‰ä¸€å®šçš„æ€§èƒ½å¼€é”€ï¼Œå¸¦æ–‡æœ¬åˆ†æçš„å…¨æ–‡æ£€ç´¢çš„æŸ¥è¯¢è¯­å¥å¾ˆé€‚åˆæ”¾åœ¨æœç´¢ä¸Šä¸‹æ–‡ä¸­ã€‚</li>\n<li class=\"lvl-4\">2.è¿‡æ»¤ä¸Šä¸‹æ–‡(filter context)ï¼šä½¿ç”¨è¿‡æ»¤ä¸Šä¸‹æ–‡æ—¶ï¼ŒElasticsearchåªéœ€è¦åˆ¤æ–­æœç´¢æ¡ä»¶è·Ÿæ–‡æ¡£æ•°æ®æ˜¯å¦åŒ¹é…ï¼Œä¾‹å¦‚ä½¿ç”¨<code>Term query</code>åˆ¤æ–­ä¸€ä¸ªå€¼æ˜¯å¦è·Ÿæœç´¢å†…å®¹ä¸€è‡´ï¼Œä½¿ç”¨<code>Range query</code>åˆ¤æ–­æŸæ•°æ®æ˜¯å¦ä½äºæŸä¸ªåŒºé—´ç­‰ã€‚è¿‡æ»¤ä¸Šä¸‹æ–‡çš„æŸ¥è¯¢ä¸éœ€è¦è¿›è¡Œç›¸å…³åº¦å¾—åˆ†è®¡ç®—ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ç¼“å­˜åŠ å¿«å“åº”é€Ÿåº¦ï¼Œå¾ˆå¤šæœ¯è¯­çº§æŸ¥è¯¢è¯­å¥éƒ½é€‚åˆæ”¾åœ¨è¿‡æ»¤ä¸Šä¸‹æ–‡ä¸­ã€‚</li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<p>bool æŸ¥è¯¢åŒ…å« mustã€must_notã€shouldã€filter å››ç§å­å¥ã€‚</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>ç±»å‹</th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>must</td>\n<td>å¯åŒ…å«å¤šä¸ªæŸ¥è¯¢æ¡ä»¶ï¼Œæ¯ä¸ªæ¡ä»¶å‡æ»¡è¶³çš„æ–‡æ¡£æ‰èƒ½è¢«æœç´¢åˆ°ï¼Œæ¯æ¬¡æŸ¥è¯¢éœ€è¦è®¡ç®—ç›¸å…³åº¦å¾—åˆ†ï¼Œå±äºæœç´¢ä¸Šä¸‹æ–‡</td>\n</tr>\n<tr>\n<td>should</td>\n<td>å¯åŒ…å«å¤šä¸ªæŸ¥è¯¢æ¡ä»¶ï¼Œä¸å­˜åœ¨mustå’Œfiteræ¡ä»¶æ—¶ï¼Œè‡³å°‘è¦æ»¡è¶³å¤šä¸ªæŸ¥è¯¢æ¡ä»¶ä¸­çš„ä¸€ä¸ªï¼Œæ–‡æ¡£æ‰èƒ½è¢«æœç´¢åˆ°ï¼Œå¦åˆ™éœ€æ»¡è¶³çš„æ¡ä»¶æ•°é‡ä¸å—é™åˆ¶,åŒ¹é…åˆ°çš„æŸ¥è¯¢è¶Šå¤šç›¸å…³åº¦è¶Šé«˜ï¼Œä¹Ÿå±äºæœç´¢ä¸Šä¸‹æ–‡</td>\n</tr>\n<tr>\n<td>filter</td>\n<td>å¯åŒ…å«å¤šä¸ªè¿‡æ»¤æ¡ä»¶ï¼Œæ¯ä¸ªæ¡ä»¶å‡æ»¡è¶³çš„æ–‡æ¡£æ‰èƒ½è¢«æœç´¢åˆ°ï¼Œæ¯ä¸ªè¿‡æ»¤æ¡ä»¶ä¸è®¡ç®—ç›¸å…³åº¦å¾—åˆ†ï¼Œç»“æœåœ¨ä¸€å®šæ¡ä»¶ä¸‹ä¼šè¢«ç¼“å­˜ï¼Œ å±äºè¿‡æ»¤ä¸Šä¸‹æ–‡</td>\n</tr>\n<tr>\n<td>must_not</td>\n<td>å¯åŒ…å«å¤šä¸ªè¿‡æ»¤æ¡ä»¶ï¼Œæ¯ä¸ªæ¡ä»¶å‡ä¸æ»¡è¶³çš„æ–‡æ¡£æ‰èƒ½è¢«æœç´¢åˆ°ï¼Œæ¯ä¸ªè¿‡æ»¤æ¡ä»¶ä¸è®¡ç®—ç›¸å…³åº¦å¾—åˆ†ï¼Œç»“æœåœ¨ä¸€å®šæ¡ä»¶ä¸‹ä¼šè¢«ç¼“å­˜ï¼Œ å±äºè¿‡æ»¤ä¸Šä¸‹æ–‡</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"must\">must</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ä¸¤ä¸ªæ¡ä»¶éƒ½éœ€è¦æ»¡è¶³</span></span><br><span class=\"line\">curl -X GET -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27;</span> \\</span><br><span class=\"line\">  -H <span class=\"string\">&#x27;Content-Type: application/json&#x27;</span> \\</span><br><span class=\"line\">  -d <span class=\"string\">&#x27;&#123;</span></span><br><span class=\"line\"><span class=\"string\">  &quot;query&quot;:&#123;</span></span><br><span class=\"line\"><span class=\"string\">      &quot;bool&quot;:&#123;</span></span><br><span class=\"line\"><span class=\"string\">        &quot;must&quot;:[</span></span><br><span class=\"line\"><span class=\"string\">          &#123;&quot;match&quot;:&#123;&quot;category&quot;:&quot;electronics&quot;&#125;&#125;,</span></span><br><span class=\"line\"><span class=\"string\">          &#123;&quot;match&quot;:&#123;&quot;desc&quot;:&quot;å…¬å›­&quot;&#125;&#125;</span></span><br><span class=\"line\"><span class=\"string\">        ]</span></span><br><span class=\"line\"><span class=\"string\">      &#125;</span></span><br><span class=\"line\"><span class=\"string\">    &#125;</span></span><br><span class=\"line\"><span class=\"string\">  &#125;&#x27;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"must-not\">must_not</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ä¸¤ä¸ªæ¡ä»¶éƒ½ä¸æ»¡è¶³</span></span><br><span class=\"line\">curl -X GET -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27;</span> \\</span><br><span class=\"line\">  -H <span class=\"string\">&#x27;Content-Type: application/json&#x27;</span> \\</span><br><span class=\"line\">  -d <span class=\"string\">&#x27;&#123;</span></span><br><span class=\"line\"><span class=\"string\">  &quot;query&quot;:&#123;</span></span><br><span class=\"line\"><span class=\"string\">      &quot;bool&quot;:&#123;</span></span><br><span class=\"line\"><span class=\"string\">        &quot;must_not&quot;:[</span></span><br><span class=\"line\"><span class=\"string\">          &#123;&quot;match&quot;:&#123;&quot;category&quot;:&quot;electronics&quot;&#125;&#125;,</span></span><br><span class=\"line\"><span class=\"string\">          &#123;&quot;match&quot;:&#123;&quot;desc&quot;:&quot;å…¬å›­&quot;&#125;&#125;</span></span><br><span class=\"line\"><span class=\"string\">        ]</span></span><br><span class=\"line\"><span class=\"string\">      &#125;</span></span><br><span class=\"line\"><span class=\"string\">    &#125;</span></span><br><span class=\"line\"><span class=\"string\">  &#125;&#x27;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"should\">should</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ä¸¤ä¸ªæ¡ä»¶æ»¡è¶³ä¸€ä¸ªå³å¯</span></span><br><span class=\"line\">curl -X GET -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27;</span> \\</span><br><span class=\"line\">  -H <span class=\"string\">&#x27;Content-Type: application/json&#x27;</span> \\</span><br><span class=\"line\">  -d <span class=\"string\">&#x27;&#123;</span></span><br><span class=\"line\"><span class=\"string\">  &quot;query&quot;:&#123;</span></span><br><span class=\"line\"><span class=\"string\">      &quot;bool&quot;:&#123;</span></span><br><span class=\"line\"><span class=\"string\">        &quot;should&quot;:[</span></span><br><span class=\"line\"><span class=\"string\">          &#123;&quot;match&quot;:&#123;&quot;category&quot;:&quot;electronics&quot;&#125;&#125;,</span></span><br><span class=\"line\"><span class=\"string\">          &#123;&quot;match&quot;:&#123;&quot;desc&quot;:&quot;å…¬å›­&quot;&#125;&#125;</span></span><br><span class=\"line\"><span class=\"string\">        ]</span></span><br><span class=\"line\"><span class=\"string\">      &#125;</span></span><br><span class=\"line\"><span class=\"string\">    &#125;</span></span><br><span class=\"line\"><span class=\"string\">  &#125;&#x27;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"filter\">filter</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># filterä¸­çš„æ¡ä»¶ä¸ºé matchï¼Œå³ä¸èƒ½æ˜¯å…¨æ–‡æ£€ç´¢</span></span><br><span class=\"line\">curl -X GET -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27;</span> \\</span><br><span class=\"line\">  -H <span class=\"string\">&#x27;Content-Type: application/json&#x27;</span> \\</span><br><span class=\"line\">  -d <span class=\"string\">&#x27;&#123;</span></span><br><span class=\"line\"><span class=\"string\">  &quot;query&quot;:&#123;</span></span><br><span class=\"line\"><span class=\"string\">      &quot;bool&quot;:&#123;</span></span><br><span class=\"line\"><span class=\"string\">        &quot;filter&quot;:[</span></span><br><span class=\"line\"><span class=\"string\">          &#123;&quot;term&quot;:&#123;&quot;category&quot;:&quot;electronics&quot;&#125;&#125;,</span></span><br><span class=\"line\"><span class=\"string\">          &#123;&quot;range&quot;:&#123;&quot;price&quot;:&#123;&quot;gte&quot;:20&#125;&#125;&#125;</span></span><br><span class=\"line\"><span class=\"string\">        ]</span></span><br><span class=\"line\"><span class=\"string\">      &#125;</span></span><br><span class=\"line\"><span class=\"string\">    &#125;</span></span><br><span class=\"line\"><span class=\"string\">  &#125;&#x27;</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"åˆ†é¡µä¸æ’åº\">åˆ†é¡µä¸æ’åº</h2>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># from: ä»ç¬¬å‡ æ¡å¼€å§‹ï¼Œé»˜è®¤0</span></span><br><span class=\"line\"><span class=\"comment\"># size: å–å¤šå°‘æ¡</span></span><br><span class=\"line\"><span class=\"comment\"># sort: æ’åºï¼Œé»˜è®¤ä¸ºæŒ‰æ–‡æ¡£idå‡åº</span></span><br><span class=\"line\">curl -X GET -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27;</span> \\</span><br><span class=\"line\">  -H <span class=\"string\">&#x27;Content-Type: application/json&#x27;</span> \\</span><br><span class=\"line\">  -d <span class=\"string\">&#x27;&#123;</span></span><br><span class=\"line\"><span class=\"string\">  &quot;query&quot;:&#123;&quot;range&quot;:&#123;&quot;price&quot;:&#123;&quot;gte&quot;:20,&quot;lte&quot;:30&#125;&#125;&#125;,</span></span><br><span class=\"line\"><span class=\"string\">  &quot;sort&quot;:[&#123;&quot;price&quot;:&quot;address&quot;&#125;],</span></span><br><span class=\"line\"><span class=\"string\">  &quot;from&quot;:0,</span></span><br><span class=\"line\"><span class=\"string\">  &quot;size&quot;:5</span></span><br><span class=\"line\"><span class=\"string\">  &#125;&#x27;</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"åªè¿”å›éƒ¨åˆ†å­—æ®µ\">åªè¿”å›éƒ¨åˆ†å­—æ®µ</h2>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># _source: æŒ‡å®šè¦è¿”å›çš„å­—æ®µåˆ—è¡¨</span></span><br><span class=\"line\">curl -X GET -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27;</span> \\</span><br><span class=\"line\">  -H <span class=\"string\">&#x27;Content-Type: application/json&#x27;</span> \\</span><br><span class=\"line\">  -d <span class=\"string\">&#x27;</span></span><br><span class=\"line\"><span class=\"string\">  &#123;&quot;query&quot;:&#123;&quot;range&quot;:&#123;&quot;price&quot;:&#123;&quot;gte&quot;:20,&quot;lte&quot;:30&#125;&#125;&#125;,</span></span><br><span class=\"line\"><span class=\"string\">  &quot;_source&quot;:[&quot;category&quot;,&quot;title&quot;,&quot;price&quot;]</span></span><br><span class=\"line\"><span class=\"string\">  &#125;&#x27;</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"é«˜äº®æ˜¾ç¤º\">é«˜äº®æ˜¾ç¤º</h2>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># é«˜äº®æ˜¾ç¤ºä»…æ”¯æŒå…¨æ–‡æ£€ç´¢å­—æ®µ</span></span><br><span class=\"line\">curl -X GET -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27;</span> \\</span><br><span class=\"line\">  -H <span class=\"string\">&#x27;Content-Type: application/json&#x27;</span> \\</span><br><span class=\"line\">  -d <span class=\"string\">&#x27;&#123;</span></span><br><span class=\"line\"><span class=\"string\">    &quot;query&quot;: &#123;</span></span><br><span class=\"line\"><span class=\"string\">      &quot;multi_match&quot;: &#123;</span></span><br><span class=\"line\"><span class=\"string\">        &quot;fields&quot;: [&quot;title&quot;,&quot;address&quot;],</span></span><br><span class=\"line\"><span class=\"string\">        &quot;query&quot;: &quot;å…¬å›­shirt&quot;</span></span><br><span class=\"line\"><span class=\"string\">      &#125;</span></span><br><span class=\"line\"><span class=\"string\">    &#125;,</span></span><br><span class=\"line\"><span class=\"string\">    &quot;highlight&quot;: &#123;</span></span><br><span class=\"line\"><span class=\"string\">      &quot;post_tags&quot;: [&quot;&lt;/span&gt;&quot;],</span></span><br><span class=\"line\"><span class=\"string\">      &quot;pre_tags&quot;: [&quot;&lt;span style=&#x27;</span>color:red<span class=\"string\">&#x27;&gt;&quot;],</span></span><br><span class=\"line\"><span class=\"string\">      &quot;fields&quot;: &#123;</span></span><br><span class=\"line\"><span class=\"string\">        &quot;*&quot;:&#123;&#125;</span></span><br><span class=\"line\"><span class=\"string\">      &#125;</span></span><br><span class=\"line\"><span class=\"string\">    &#125;</span></span><br><span class=\"line\"><span class=\"string\">  &#125;&#x27;</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"åœ°ç†ç©ºé—´ä½ç½®æŸ¥è¯¢\">åœ°ç†ç©ºé—´ä½ç½®æŸ¥è¯¢</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åœ°ç†ç©ºé—´ä½ç½®æŸ¥è¯¢æ˜¯æ•°æ®åº“å’Œæœç´¢ç³»ç»Ÿä¸­çš„ä¸€ä¸ªé‡è¦ç‰¹æ€§ï¼Œç‰¹åˆ«æ˜¯åœ¨åœ°ç†ä¿¡æ¯ç³»ç»Ÿï¼ˆGISï¼‰å’Œä½ç½®æœåŠ¡ä¸­ã€‚å®ƒå…è®¸ç”¨æˆ·åŸºäºåœ°ç†ä½ç½®ä¿¡æ¯æ¥æœç´¢å’Œè¿‡æ»¤æ•°æ®ã€‚åœ¨Elasticsearchè¿™æ ·çš„å…¨æ–‡æœç´¢å¼•æ“ä¸­ï¼Œåœ°ç†ç©ºé—´ä½ç½®æŸ¥è¯¢è¢«å¹¿æ³›åº”ç”¨ï¼Œä¾‹å¦‚åœ¨æ—…è¡Œã€æˆ¿åœ°äº§ã€ç‰©æµå’Œé›¶å”®ç­‰è¡Œä¸šï¼Œç”¨äºæä¾›åŸºäºä½ç½®çš„æœç´¢åŠŸèƒ½ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>åœ¨Elasticsearchä¸­ï¼Œåœ°ç†ç©ºé—´æ•°æ®é€šå¸¸å­˜å‚¨åœ¨<code>geo_point</code>å­—æ®µç±»å‹ä¸­ã€‚è¿™ç§å­—æ®µç±»å‹å¯ä»¥å­˜å‚¨çº¬åº¦å’Œç»åº¦åæ ‡ï¼Œç”¨äºè¡¨ç¤ºåœ°çƒä¸Šçš„ä¸€ä¸ªç‚¹ã€‚</p>\n</li>\n</ul>\n<h3 id=\"ç¤ºä¾‹\">ç¤ºä¾‹</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ›å»ºä¸€ä¸ªç´¢å¼•ï¼Œå¹¶æ·»åŠ ä¸€ä¸ª<code>geo_point</code>å­—æ®µï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -X PUT -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/tourist_spots&#x27;</span> \\</span><br><span class=\"line\">  -H <span class=\"string\">&#x27;Content-Type: application/json&#x27;</span> \\</span><br><span class=\"line\">  -d <span class=\"string\">&#x27;&#123;</span></span><br><span class=\"line\"><span class=\"string\">    &quot;mappings&quot;: &#123;</span></span><br><span class=\"line\"><span class=\"string\">      &quot;properties&quot;: &#123;</span></span><br><span class=\"line\"><span class=\"string\">        &quot;name&quot;: &#123;</span></span><br><span class=\"line\"><span class=\"string\">          &quot;type&quot;: &quot;text&quot;,</span></span><br><span class=\"line\"><span class=\"string\">          &quot;analyzer&quot;: &quot;ik_max_word&quot;,</span></span><br><span class=\"line\"><span class=\"string\">          &quot;search_analyzer&quot;: &quot;ik_max_word&quot;</span></span><br><span class=\"line\"><span class=\"string\">        &#125;,</span></span><br><span class=\"line\"><span class=\"string\">        &quot;location&quot;: &#123;</span></span><br><span class=\"line\"><span class=\"string\">          &quot;type&quot;: &quot;geo_point&quot;</span></span><br><span class=\"line\"><span class=\"string\">        &#125;</span></span><br><span class=\"line\"><span class=\"string\">      &#125;</span></span><br><span class=\"line\"><span class=\"string\">    &#125;</span></span><br><span class=\"line\"><span class=\"string\">  &#125;&#x27;</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ’å…¥æ•°æ®</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -X POST -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/tourist_spots/_bulk&#x27;</span> \\</span><br><span class=\"line\">  -H <span class=\"string\">&#x27;Content-Type: application/json&#x27;</span> \\</span><br><span class=\"line\">  -d <span class=\"string\">&#x27;&#123;&quot;index&quot;:&#123;&#125;&#125;</span></span><br><span class=\"line\"><span class=\"string\">&#123;&quot;name&quot;:&quot;é›·å³°å¡”&quot;,&quot;location&quot;:&#123;&quot;lat&quot;:30.2615,&quot;lon&quot;:120.1480&#125;&#125;</span></span><br><span class=\"line\"><span class=\"string\">&#123;&quot;index&quot;:&#123;&#125;&#125;</span></span><br><span class=\"line\"><span class=\"string\">&#123;&quot;name&quot;:&quot;è¥¿æ¹–&quot;,&quot;location&quot;:&#123;&quot;lat&quot;:30.2614,&quot;lon&quot;:120.1479&#125;&#125;</span></span><br><span class=\"line\"><span class=\"string\">&#123;&quot;index&quot;:&#123;&#125;&#125;</span></span><br><span class=\"line\"><span class=\"string\">&#123;&quot;name&quot;:&quot;è‹å ¤æ˜¥æ™“&quot;,&quot;location&quot;:&#123;&quot;lat&quot;:30.2624,&quot;lon&quot;:120.1708&#125;&#125;</span></span><br><span class=\"line\"><span class=\"string\">&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"># lat: çº¬åº¦</span></span><br><span class=\"line\"><span class=\"comment\"># lon: ç»åº¦</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æŸ¥è¯¢æ•°æ®</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æŸ¥è¯¢æ­å·è¥¿æ¹–5kmé™„è¿‘çš„æ™¯ç‚¹</span></span><br><span class=\"line\"><span class=\"comment\"># é›·å³°å¡” - ä½äºè¥¿æ¹–é™„è¿‘ï¼Œè·ç¦»çº¦2.8å…¬é‡Œã€‚</span></span><br><span class=\"line\"><span class=\"comment\"># è‹å ¤æ˜¥æ™“ - ä½äºè¥¿æ¹–è¾¹ï¼Œè·ç¦»è¥¿æ¹–ä¸­å¿ƒçº¦1å…¬é‡Œã€‚</span></span><br><span class=\"line\">curl -X GET -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/tourist_spots/_search?pretty&#x27;</span> \\</span><br><span class=\"line\">  -H <span class=\"string\">&#x27;Content-Type: application/json&#x27;</span> \\</span><br><span class=\"line\">  -d <span class=\"string\">&#x27;&#123;</span></span><br><span class=\"line\"><span class=\"string\">    &quot;query&quot;: &#123;</span></span><br><span class=\"line\"><span class=\"string\">      &quot;bool&quot;: &#123;</span></span><br><span class=\"line\"><span class=\"string\">        &quot;must&quot;: &#123;</span></span><br><span class=\"line\"><span class=\"string\">          &quot;match_all&quot;: &#123;&#125;</span></span><br><span class=\"line\"><span class=\"string\">        &#125;,</span></span><br><span class=\"line\"><span class=\"string\">        &quot;filter&quot;: &#123;</span></span><br><span class=\"line\"><span class=\"string\">          &quot;geo_distance&quot;: &#123;</span></span><br><span class=\"line\"><span class=\"string\">            &quot;distance&quot;: &quot;5km&quot;,</span></span><br><span class=\"line\"><span class=\"string\">            &quot;distance_type&quot;: &quot;arc&quot;,</span></span><br><span class=\"line\"><span class=\"string\">            &quot;location&quot;: &#123;</span></span><br><span class=\"line\"><span class=\"string\">              &quot;lat&quot;: 30.2614,</span></span><br><span class=\"line\"><span class=\"string\">              &quot;lon&quot;: 120.1479</span></span><br><span class=\"line\"><span class=\"string\">            &#125;</span></span><br><span class=\"line\"><span class=\"string\">          &#125;</span></span><br><span class=\"line\"><span class=\"string\">        &#125;</span></span><br><span class=\"line\"><span class=\"string\">      &#125;</span></span><br><span class=\"line\"><span class=\"string\">    &#125;</span></span><br><span class=\"line\"><span class=\"string\">  &#125;&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># distance: 5km è¡¨ç¤ºè·ç¦»ä¸º5å…¬é‡Œ</span></span><br><span class=\"line\"><span class=\"comment\"># distance_type: arc, plane, sloppy_arc,</span></span><br><span class=\"line\">  <span class=\"comment\"># arc: é»˜è®¤å€¼ï¼Œä½¿ç”¨haversineå…¬å¼è®¡ç®—è·ç¦»ï¼Œç»“æœæ˜¯ç²¾ç¡®çš„ï¼Œä½†è®¡ç®—é€Ÿåº¦è¾ƒæ…¢ã€‚</span></span><br><span class=\"line\">  <span class=\"comment\"># plane: ä½¿ç”¨å¹³é¢ç›´è§’åæ ‡ç³»è®¡ç®—è·ç¦»ï¼Œç»“æœæ˜¯ç²—ç•¥çš„ï¼Œä½†è®¡ç®—é€Ÿåº¦æ›´å¿«ã€‚</span></span><br><span class=\"line\">  <span class=\"comment\"># sloppy_arc: ä½¿ç”¨haversineå…¬å¼è®¡ç®—è·ç¦»ï¼Œä½†å…è®¸è¯¯å·®ã€‚</span></span><br><span class=\"line\"><span class=\"comment\"># location: æœç´¢æ¡ä»¶</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"å‘é‡æœç´¢\">å‘é‡æœç´¢</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Elasticsearch 8.x å¼•å…¥äº†ä¸€ä¸ªé‡è¦çš„æ–°ç‰¹æ€§ï¼šå‘é‡æ£€ç´¢ï¼ˆVector Searchï¼‰ï¼Œç‰¹åˆ«æ˜¯é€šè¿‡KNNï¼ˆK-Nearest Neighborsï¼‰ç®—æ³•æ”¯æŒå‘é‡è¿‘é‚»æ£€ç´¢ã€‚è¿™ä¸€ç‰¹æ€§ä½¿å¾—Elasticsearchåœ¨æœºå™¨å­¦ä¹ ã€æ•°æ®åˆ†æå’Œæ¨èç³»ç»Ÿç­‰é¢†åŸŸçš„åº”ç”¨å˜å¾—æ›´åŠ å¹¿æ³›å’Œå¼ºå¤§ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å‘é‡æ£€ç´¢çš„åŸºæœ¬æ€è·¯æ˜¯ï¼Œå°†æ–‡æ¡£ï¼ˆæˆ–æ•°æ®é¡¹ï¼‰è¡¨ç¤ºä¸ºé«˜ç»´å‘é‡ï¼Œå¹¶ä½¿ç”¨è¿™äº›å‘é‡æ¥æ‰§è¡Œç›¸ä¼¼æ€§æœç´¢ã€‚åœ¨Elasticsearchä¸­ï¼Œè¿™äº›å‘é‡è¢«å­˜å‚¨åœ¨<code>dense_vector</code>ç±»å‹çš„å­—æ®µä¸­ï¼Œç„¶åä½¿ç”¨KNNç®—æ³•æ¥æ‰¾åˆ°ä¸ç»™å®šå‘é‡æœ€ç›¸ä¼¼çš„å…¶ä»–å‘é‡ã€‚</p>\n</li>\n</ul>\n<h3 id=\"ç¤ºä¾‹-2\">ç¤ºä¾‹</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ›å»ºç´¢å¼•</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -X PUT -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/image-index&#x27;</span> \\</span><br><span class=\"line\">  -H <span class=\"string\">&#x27;Content-Type: application/json&#x27;</span> \\</span><br><span class=\"line\">  -d <span class=\"string\">&#x27;&#123;</span></span><br><span class=\"line\"><span class=\"string\">    &quot;mappings&quot;: &#123;</span></span><br><span class=\"line\"><span class=\"string\">      &quot;properties&quot;: &#123;</span></span><br><span class=\"line\"><span class=\"string\">        &quot;image-vector&quot;: &#123;</span></span><br><span class=\"line\"><span class=\"string\">          &quot;type&quot;: &quot;dense_vector&quot;,</span></span><br><span class=\"line\"><span class=\"string\">          &quot;dims&quot;: 3</span></span><br><span class=\"line\"><span class=\"string\">        &#125;,</span></span><br><span class=\"line\"><span class=\"string\">        &quot;title&quot;: &#123;</span></span><br><span class=\"line\"><span class=\"string\">          &quot;type&quot;: &quot;text&quot;</span></span><br><span class=\"line\"><span class=\"string\">        &#125;,</span></span><br><span class=\"line\"><span class=\"string\">        &quot;file-type&quot;: &#123;</span></span><br><span class=\"line\"><span class=\"string\">          &quot;type&quot;: &quot;keyword&quot;</span></span><br><span class=\"line\"><span class=\"string\">        &#125;,</span></span><br><span class=\"line\"><span class=\"string\">        &quot;my_label&quot;: &#123;</span></span><br><span class=\"line\"><span class=\"string\">          &quot;type&quot;: &quot;text&quot;</span></span><br><span class=\"line\"><span class=\"string\">        &#125;</span></span><br><span class=\"line\"><span class=\"string\">      &#125;</span></span><br><span class=\"line\"><span class=\"string\">    &#125;</span></span><br><span class=\"line\"><span class=\"string\">  &#125;&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"># dims: 3  è¡¨ç¤º3ç»´å‘é‡ï¼Œæœ€é«˜æ”¯æŒ2048</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ·»åŠ æ•°æ®</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -X POST -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/image-index/_bulk&#x27;</span> \\</span><br><span class=\"line\">  -H <span class=\"string\">&#x27;Content-Type: application/json&#x27;</span> \\</span><br><span class=\"line\">  -d <span class=\"string\">&#x27;&#123; &quot;index&quot;: &#123;&#125; &#125;</span></span><br><span class=\"line\"><span class=\"string\">&#123; &quot;image-vector&quot;: [-5, 9, -12], &quot;title&quot;: &quot;Image A&quot;, &quot;file-type&quot;: &quot;jpeg&quot;, &quot;my_label&quot;: &quot;red&quot; &#125;</span></span><br><span class=\"line\"><span class=\"string\">&#123; &quot;index&quot;: &#123;&#125; &#125;</span></span><br><span class=\"line\"><span class=\"string\">&#123; &quot;image-vector&quot;: [10, -2, 3], &quot;title&quot;: &quot;Image B&quot;, &quot;file-type&quot;: &quot;png&quot;, &quot;my_label&quot;: &quot;blue&quot; &#125;</span></span><br><span class=\"line\"><span class=\"string\">&#123; &quot;index&quot;: &#123;&#125; &#125;</span></span><br><span class=\"line\"><span class=\"string\">&#123; &quot;image-vector&quot;: [4, 0, -1], &quot;title&quot;: &quot;Image C&quot;, &quot;file-type&quot;: &quot;gif&quot;, &quot;my_label&quot;: &quot;red&quot; &#125;</span></span><br><span class=\"line\"><span class=\"string\">&#x27;</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å‘é‡æ£€ç´¢</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -X POST -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/image-index/_search?pretty&#x27;</span> \\</span><br><span class=\"line\">  -H <span class=\"string\">&#x27;Content-Type: application/json&#x27;</span> \\</span><br><span class=\"line\">  -d <span class=\"string\">&#x27;&#123;</span></span><br><span class=\"line\"><span class=\"string\">    &quot;query&quot;:&#123; &quot;match_all&quot;: &#123;&#125; &#125;,</span></span><br><span class=\"line\"><span class=\"string\">    &quot;knn&quot;: &#123;</span></span><br><span class=\"line\"><span class=\"string\">      &quot;field&quot;: &quot;image-vector&quot;,</span></span><br><span class=\"line\"><span class=\"string\">      &quot;query_vector&quot;: [-5, 10, -12],</span></span><br><span class=\"line\"><span class=\"string\">      &quot;k&quot;: 10,</span></span><br><span class=\"line\"><span class=\"string\">      &quot;num_candidates&quot;: 100</span></span><br><span class=\"line\"><span class=\"string\">    &#125;,</span></span><br><span class=\"line\"><span class=\"string\">    &quot;fields&quot;: [ &quot;title&quot;, &quot;file-type&quot; ]</span></span><br><span class=\"line\"><span class=\"string\">  &#125;&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># query: æœç´¢æ¡ä»¶ï¼Œè¿™é‡Œå¯ä»¥ä¸åŠ è¿™ä¸ª</span></span><br><span class=\"line\"><span class=\"comment\"># knn: 8.8.1 ç‰ˆæœ¬å¼€å§‹é»˜è®¤æ”¯æŒ</span></span><br><span class=\"line\"><span class=\"comment\"># field: æœç´¢å‘é‡å­—æ®µ</span></span><br><span class=\"line\"><span class=\"comment\"># query_vector: æœç´¢å‘é‡</span></span><br><span class=\"line\"><span class=\"comment\"># k: æœç´¢ç»“æœæ•°é‡</span></span><br><span class=\"line\"><span class=\"comment\"># num_candidates: æœç´¢å€™é€‰æ•°é‡ï¼Œç”¨äºä¼˜åŒ–æ€§èƒ½</span></span><br><span class=\"line\"><span class=\"comment\"># fields: æœç´¢ç»“æœè¿”å›å­—æ®µ</span></span><br></pre></td></tr></table></figure>","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» Elasticsearch çš„ REST APIs Elasticsearchç‰ˆæœ¬8.17.3 å®˜æ–¹æ–‡æ¡£:REST APIs Elasticsearch çš„ REST APIs:èšåˆæŸ¥è¯¢ è¿”å›å†…å®¹æ ¼å¼åŒ– è¿”å›jsonä¿¡æ¯æ ¼å¼: ?pretty è¾“å‡ºæ ¼å¼åŒ–åçš„jsonï¼Œæ¯”å¦‚ï¼šcurl http://localhost:9200/_cluster/health?pretty è¿”å›è¡Œä¿¡æ¯æ ¼å¼: ?v è¾“å‡ºå†…å®¹ä¸Šæ–¹ä¼šåŠ ä¸Šæ ‡é¢˜è¡Œï¼Œæ¯”å¦‚ï¼šcurl http://localhost:9200/_cat/health?v CAT APIs Elasticsearch æä¾›äº† CAT APIsï¼Œå®ƒä»¬æä¾›äº†ä¸€ç§ç®€å•çš„æ–¹å¼æ¥æŸ¥çœ‹é›†ç¾¤çŠ¶æ€å’Œé›†ç¾¤ä¸­çš„å„ç§èµ„æºï¼Œæ¯”å¦‚ç´¢å¼•ã€åˆ†ç‰‡ã€èŠ‚ç‚¹ç­‰ã€‚ 123456789101112131415161718192021222324GET /_cat/health #æŸ¥çœ‹é›†ç¾¤å½“å‰çŠ¶æ€ï¼šçº¢ã€é»„ã€ç»¿GET /_cat/master #æŸ¥çœ‹masterèŠ‚ç‚¹ä¿¡æ¯GET /_cat/nodes #æŸ¥çœ‹æ‰€æœ‰èŠ‚ç‚¹ä¿¡æ¯GET /_cat/plugins #æŸ¥çœ‹é›†ç¾¤å„ä¸ªèŠ‚ç‚¹ä¸Šçš„pluginä¿¡æ¯GET /_cat/indices #æŸ¥çœ‹é›†ç¾¤ä¸­æ‰€æœ‰indexçš„è¯¦ç»†ä¿¡æ¯GET /_cat/indices/&#123;index&#125; #æŸ¥çœ‹é›†ç¾¤ä¸­æŒ‡å®šindexçš„è¯¦ç»†ä¿¡æ¯ï¼Œindexï¼šç´¢å¼•åç§°GET /_cat/allocation #æŸ¥çœ‹å•èŠ‚ç‚¹çš„shardåˆ†é…æ•´ä½“æƒ…å†µGET /_cat/shards #æŸ¥çœ‹å„shardçš„è¯¦ç»†æƒ…å†µGET /_cat/shards/&#123;index&#125; #æŸ¥çœ‹æŒ‡å®šåˆ†ç‰‡çš„è¯¦ç»†æƒ…å†µGET /_cat/segments #æŸ¥çœ‹å„indexçš„segmentè¯¦ç»†ä¿¡æ¯,åŒ…æ‹¬segmentå, æ‰€å±shard, å†…å­˜(ç£ç›˜)å ç”¨å¤§å°, æ˜¯å¦åˆ·ç›˜GET /_cat/segments/&#123;index&#125; #æŸ¥çœ‹æŒ‡å®šindexçš„segmentè¯¦ç»†ä¿¡æ¯GET /_cat/count #æŸ¥çœ‹å½“å‰é›†ç¾¤çš„docæ•°é‡GET /_cat/count/&#123;index&#125; #æŸ¥çœ‹æŒ‡å®šç´¢å¼•çš„docæ•°é‡GET /_cat/recovery #æŸ¥çœ‹é›†ç¾¤å†…æ¯ä¸ªshardçš„recoveryè¿‡ç¨‹.è°ƒæ•´replicaã€‚GET /_cat/recovery/&#123;index&#125; #æŸ¥çœ‹æŒ‡å®šç´¢å¼•shardçš„recoveryè¿‡ç¨‹GET /_cat/pending_tasks #æŸ¥çœ‹å½“å‰é›†ç¾¤çš„pending taskGET /_cat/aliases #æŸ¥çœ‹é›†ç¾¤ä¸­æ‰€æœ‰aliasä¿¡æ¯,è·¯ç”±é…ç½®ç­‰GET /_cat/aliases/&#123;alias&#125; #æŸ¥çœ‹æŒ‡å®šç´¢å¼•çš„aliasä¿¡æ¯GET /_cat/thread_pool #æŸ¥çœ‹é›†ç¾¤å„èŠ‚ç‚¹å†…éƒ¨ä¸åŒç±»å‹çš„threadpoolçš„ç»Ÿè®¡ä¿¡æ¯,GET /_cat/fielddata #æŸ¥çœ‹å½“å‰é›†ç¾¤å„ä¸ªèŠ‚ç‚¹çš„fielddataå†…å­˜ä½¿ç”¨æƒ…å†µGET /_cat/fielddata/&#123;fields&#125; #æŸ¥çœ‹æŒ‡å®šfieldçš„å†…å­˜ä½¿ç”¨æƒ…å†µ,é‡Œé¢ä¼ fieldå±æ€§å¯¹åº”çš„å€¼GET /_cat/nodeattrs #æŸ¥çœ‹å•èŠ‚ç‚¹çš„è‡ªå®šä¹‰å±æ€§GET /_cat/repositories #è¾“å‡ºé›†ç¾¤ä¸­æ³¨å†Œå¿«ç…§å­˜å‚¨åº“GET /_cat/templates #è¾“å‡ºå½“å‰æ­£åœ¨å­˜åœ¨çš„æ¨¡æ¿ä¿¡æ¯ Cluster APIs Elasticsearch æä¾›äº†ä¸€ç³»åˆ—çš„ Cluster APIsï¼Œå®ƒä»¬æä¾›äº†ç®¡ç†å’Œç›‘æ§é›†ç¾¤çŠ¶æ€çš„åŠŸèƒ½ 123456789GET /_cluster/health # è·å–é›†ç¾¤çš„å¥åº·çŠ¶æ€ä¿¡æ¯ï¼ŒåŒ…æ‹¬äº†é›†ç¾¤æ€»ä½“çš„çŠ¶å†µå¦‚statusã€number_of_nodesç­‰ã€‚GET /_cluster/stats # æä¾›æ•´ä¸ªé›†ç¾¤å±‚é¢çš„ç»Ÿè®¡ä¿¡æ¯ï¼ŒåŒ…å«ç´¢å¼•ã€èŠ‚ç‚¹å’Œå…¶ä»–é«˜çº§æŒ‡æ ‡ã€‚GET /_cluster/state # æ˜¾ç¤ºé›†ç¾¤å…ƒæ•°æ®çš„çŠ¶æ€ï¼ŒåŒ…æ‹¬è®¾ç½®ã€å—ã€è·¯ç”±è¡¨åŠå…ƒæ•°æ®ç­‰ï¼Œå…è®¸ç”¨æˆ·æŸ¥çœ‹é›†ç¾¤çš„å½“å‰è§†å›¾ã€‚POST /_cluster/reroute # POSTè¯·æ±‚ï¼Œç”¨äºæ‰‹åŠ¨æ”¹å˜åˆ†ç‰‡åˆ†é…æƒ…å†µï¼Œå¯ä»¥å®ç°å¦‚è¿ç§»åˆ†ç‰‡ã€å–æ¶ˆåˆ†é…ç­‰æ“ä½œã€‚GET /_cluster/nodes/hot_threads # è¿”å›é›†ç¾¤ä¸­å„ä¸ªèŠ‚ç‚¹â€œæœ€çƒ­â€çš„çº¿ç¨‹å †æ ˆè·Ÿè¸ªï¼Œé»˜è®¤æ˜¾ç¤ºå‰ä¸‰ä¸ªCPUæ—¶é—´æœ€é•¿çš„çº¿ç¨‹ã€‚GET /_cluster/allocation/explain # è§£é‡Šä¸ºä½•æŸä¸ªåˆ†ç‰‡è¢«å¦‚æ­¤åˆ†é…ï¼Œå¹¶æä¾›å¦‚ä½•è°ƒæ•´çš„å»ºè®®ã€‚GET /_cluster/pending_tasks # åˆ—å‡ºæ‰€æœ‰ç­‰å¾…æ‰§è¡Œçš„ä»»åŠ¡åˆ—è¡¨ã€‚GET /_cluster/settings # æŸ¥çœ‹æ•´ä¸ªé›†ç¾¤çº§åˆ«çš„è®¾ç½®ã€‚PUT /_cluster/settings # æ›´æ–°æ•´ä¸ªé›†ç¾¤çº§åˆ«çš„è®¾ç½®ã€‚ Index APIs Elasticsearch æä¾›äº† Index APIsï¼Œå®ƒä»¬æä¾›äº†å¯¹ç´¢å¼•çš„åˆ›å»ºã€æ›´æ–°ã€æŸ¥è¯¢å’Œåˆ é™¤ç­‰æ“ä½œã€‚ åˆ›å»ºç´¢å¼• 12345# PUT /&lt;target&gt;# è¿™é‡Œ shopping ä¸ºç´¢å¼•åç§°ï¼Œä½†æ­¤æ—¶æ²¡æœ‰ä¸ºç´¢å¼•è®¾ç½®åˆ†ç‰‡ç­–ç•¥ï¼Œä¹Ÿæ²¡æœ‰è®¾ç½®å­—æ®µä¿¡æ¯curl -X PUT -u elastic:123456 -k &#x27;https://127.0.0.1:9200/shopping&#x27;# è¿”å›å€¼&#123;&quot;acknowledged&quot;:true,&quot;shards_acknowledged&quot;:true,&quot;index&quot;:&quot;shopping&quot;&#125; åˆ›å»ºç´¢å¼•å¹¶è®¾ç½®ç´¢å¼• 123456# PUT /&lt;target&gt;curl -X PUT -u elastic:123456 -k &#x27;https://127.0.0.1:9200/shopping&#x27; \\ -H &#x27;Content-Type: application/json&#x27; \\ -d &#x27;&#123;&quot;settings&quot;:&#123;&quot;number_of_shards&quot;:&quot;1&quot;,&quot;number_of_replicas&quot;:&quot;2&quot;&#125;&#125;&#x27;# è¿”å›å€¼&#123;&quot;acknowledged&quot;:true,&quot;shards_acknowledged&quot;:true,&quot;index&quot;:&quot;shopping&quot;&#125; åˆ›å»ºå¹¶æ˜ å°„ç´¢å¼• 1234567891011121314151617181920212223242526272829303132333435363738394041# PUT /&lt;target&gt;# è¿™é‡Œè®¾ç½®ç´¢å¼•åˆ†ç‰‡æ•°é‡ä¸º1ï¼Œå‰¯æœ¬æ•°é‡ä¸º2ï¼Œå¹¶è®¾ç½®å­—æ®µä¿¡æ¯curl -X PUT -u elastic:123456 -k &#x27;https://127.0.0.1:9200/shopping&#x27; \\ -H &#x27;Content-Type: application/json&#x27; \\ -d &#x27;&#123; &quot;settings&quot;:&#123; &quot;number_of_shards&quot;:&quot;1&quot;, &quot;number_of_replicas&quot;:&quot;2&quot; &#125;, &quot;mappings&quot;:&#123; &quot;properties&quot;:&#123; &quot;title&quot;:&#123; &quot;type&quot;:&quot;text&quot; &#125;, &quot;category&quot;:&#123; &quot;type&quot;:&quot;keyword&quot; &#125;, &quot;price&quot;:&#123; &quot;type&quot;:&quot;double&quot; &#125;, &quot;count&quot;:&#123; &quot;type&quot;:&quot;integer&quot; &#125; &#125; &#125; &#125;&#x27;# å‚æ•°è¯´æ˜## settings: è¿™ä¸ªå‚æ•°ç”¨äºé…ç½®ç´¢å¼•çš„è®¾ç½®ï¼ŒåŒ…æ‹¬åˆ†ç‰‡æ•°é‡å’Œå‰¯æœ¬æ•°é‡ã€‚### number_of_shards: è¿™ä¸ªå‚æ•°æŒ‡å®šäº†ç´¢å¼•ä¸­åˆ†ç‰‡çš„æ•°é‡ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œnumber_of_shards è®¾ç½®ä¸º 1ï¼Œæ„å‘³ç€ç´¢å¼•å°†åªæœ‰ä¸€ä¸ªä¸»åˆ†ç‰‡ã€‚### number_of_replicas: è¿™ä¸ªå‚æ•°æŒ‡å®šäº†æ¯ä¸ªä¸»åˆ†ç‰‡çš„å‰¯æœ¬æ•°é‡ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œnumber_of_replicas è®¾ç½®ä¸º 2ï¼Œæ„å‘³ç€æ¯ä¸ªä¸»åˆ†ç‰‡å°†æœ‰ä¸¤ä¸ªå‰¯æœ¬ã€‚## mappings: è¿™ä¸ªå‚æ•°ç”¨äºå®šä¹‰ç´¢å¼•ä¸­çš„å­—æ®µå’Œå­—æ®µç±»å‹ã€‚### properties: è¿™ä¸ªå‚æ•°å®šä¹‰äº†ç´¢å¼•ä¸­çš„å­—æ®µå’Œå­—æ®µç±»å‹ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæœ‰å››ä¸ªå­—æ®µï¼štitleã€categoryã€images å’Œ priceã€‚### title: è¿™ä¸ªå­—æ®µçš„ç±»å‹æ˜¯ textï¼Œè¡¨ç¤ºå®ƒæ˜¯ä¸€ä¸ªå…¨æ–‡æ£€ç´¢å­—æ®µã€‚text é€‚åˆå­˜å‚¨é•¿æ–‡æœ¬æ•°æ®ï¼Œå¹¶æ”¯æŒå…¨æ–‡æœç´¢ã€‚### category: è¿™ä¸ªå­—æ®µçš„ç±»å‹æ˜¯ keywordï¼Œè¡¨ç¤ºå®ƒæ˜¯ä¸€ä¸ªå…³é”®å­—å­—æ®µï¼Œä¸æ”¯æŒå…¨æ–‡æ£€ç´¢ã€‚keyword é€‚åˆå­˜å‚¨ä¸éœ€è¦åˆ†è¯çš„çŸ­æ–‡æœ¬æ•°æ®ï¼ˆå¦‚æ ‡ç­¾ã€ç±»åˆ«ç­‰ï¼‰ï¼Œå¹¶ä¸”å¯ä»¥ç”¨äºèšåˆå’Œè¿‡æ»¤ã€‚### price: è¿™ä¸ªå­—æ®µçš„ç±»å‹æ˜¯ doubleï¼Œè¡¨ç¤ºå®ƒæ˜¯ä¸€ä¸ªæ•°å­—å­—æ®µã€‚double è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªåŒç²¾åº¦æµ®ç‚¹æ•°å­—æ®µï¼Œé€‚åˆå­˜å‚¨æ•°å€¼æ•°æ®ï¼Œå¦‚ä»·æ ¼### count: è¿™ä¸ªå­—æ®µçš„ç±»å‹æ˜¯ integerï¼Œè¡¨ç¤ºå®ƒæ˜¯ä¸€ä¸ªæ•´æ•°å­—æ®µã€‚integer è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªæ•´æ•°å­—æ®µï¼Œé€‚åˆå­˜å‚¨æ•´æ•°æ•°æ®ï¼Œå¦‚å•†å“æ•°é‡ç­‰ã€‚# è¿”å›å€¼&#123;&quot;acknowledged&quot;:true,&quot;shards_acknowledged&quot;:true,&quot;index&quot;:&quot;shopping&quot;&#125; æ›´æ–°ç´¢å¼•æ˜ å°„ 1234567891011121314151617181920212223242526272829303132333435363738# PUT /&lt;target&gt;/_mapping# æ³¨æ„è¯¥apiåªèƒ½å¢åŠ æ–°çš„å­—æ®µï¼Œä¸èƒ½ä¿®æ”¹å·²æœ‰å­—æ®µï¼Œå¦‚æœè¦ä¿®æ”¹æºå­—æ®µç±»å‹æˆ–è€…åˆ†è¯å™¨ç±»å‹ï¼Œä¸‹æ–‡ä¼šä»‹ç»curl -X PUT -u elastic:123456 -k &#x27;https://127.0.0.1:9200/shopping/_mapping&#x27; \\ -H &#x27;Content-Type: application/json&#x27; \\ -d &#x27;&#123; &quot;properties&quot;:&#123; &quot;remark&quot;:&#123; &quot;type&quot;:&quot;text&quot;, &quot;analyzer&quot;:&quot;ik_max_word&quot;, &quot;search_analyzer&quot;:&quot;ik_smart&quot; &#125;, &quot;address&quot;: &#123; &quot;type&quot;: &quot;text&quot;, &quot;analyzer&quot;: &quot;ik_max_word&quot;, &quot;fields&quot;: &#123; &quot;keyword&quot;: &#123; &quot;type&quot;: &quot;keyword&quot; &#125; &#125; &#125;, &quot;tags&quot;: &#123; &quot;type&quot;: &quot;keyword&quot; &#125;, &quot;created_at&quot;: &#123;&quot;type&quot;: &quot;date&quot;, &quot;format&quot;: &quot;yyyy-MM-dd HH:mm:ss&quot;&#125; &#125; &#125;&#x27;# å‚æ•°è¯´æ˜# è¿™é‡Œä¸ºç´¢å¼•æ·»åŠ äº†4ä¸ªå­—æ®µ# remarkï¼šæ–°å¢å­—æ®µï¼Œç±»å‹ä¸ºtextï¼Œåˆ†è¯å™¨ä¸ºik_max_wordï¼Œæœç´¢åˆ†è¯å™¨ä¸ºik_smart # analyzer: ç´¢å¼•åˆ†è¯å™¨ # search_analyzerï¼šæœç´¢åˆ†è¯å™¨ # ik_max_wordï¼šä¸­æ–‡åˆ†è¯å™¨ï¼Œå°†å¥å­æ‹†åˆ†ä¸ºæœ€å¤šè¯å…ƒï¼Œé€‚åˆé•¿å¥å­ # ik_smartï¼šä¸­æ–‡åˆ†è¯å™¨ï¼Œå°†å¥å­æ‹†åˆ†ä¸ºæœ€å°‘è¯å…ƒï¼Œé€‚åˆçŸ­å¥å­# addressï¼šæ–°å¢å­—æ®µï¼Œç±»å‹ä¸ºtextï¼Œåˆ†è¯å™¨ä¸ºik_max_wordï¼Œæœç´¢åˆ†è¯å™¨æœªæŒ‡å®šï¼Œé»˜è®¤ä¸åˆ†è¯å™¨åŒä¸€ä¸ªï¼Œè¿™é‡Œè¿˜ä¸ºaddressæ·»åŠ äº†keywordå­—æ®µï¼Œç”¨äºå­˜å‚¨åŸå§‹æ•°æ®ï¼Œä»¥æ”¯æŒç²¾ç¡®æœç´¢# tagsï¼šæ–°å¢å­—æ®µï¼Œç±»å‹ä¸ºkeywordï¼Œä¸æ”¯æŒåˆ†è¯ï¼Œé€‚åˆå­˜å‚¨çŸ­æ–‡æœ¬æ•°æ®ï¼ˆå¦‚æ ‡ç­¾ã€ç±»åˆ«ç­‰ï¼‰ï¼Œå¹¶ä¸”å¯ä»¥ç”¨äºèšåˆå’Œè¿‡æ»¤ï¼Œå¯ä»¥å­˜å‚¨æ•°ç»„# created_atï¼šæ–°å¢å­—æ®µï¼Œç±»å‹ä¸ºdateï¼Œæ ¼å¼ä¸ºyyyy-MM-dd HH:mm:ss# è¿”å›å€¼&#123;&quot;acknowledged&quot;:true&#125; æ›´æ–°ç´¢å¼•è®¾ç½® 1234567# PUT /&lt;target&gt;/_settings# æ³¨æ„è¿™é‡Œä¸èƒ½æ›´æ–°number_of_shardscurl -X PUT -u elastic:123456 -k &#x27;https://127.0.0.1:9200/shopping/_settings&#x27; \\ -H &#x27;Content-Type: application/json&#x27; \\ -d &#x27;&#123;&quot;number_of_replicas&quot;:&quot;1&quot;&#125;&#x27;# è¿”å›å€¼&#123;&quot;acknowledged&quot;:true&#125; æŸ¥çœ‹æŒ‡å®šç´¢å¼• 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364# GET /&lt;target&gt;curl -X GET -u elastic:123456 -k &#x27;https://127.0.0.1:9200/shopping?pretty&#x27;# è¿”å›å€¼&#123; &quot;shopping&quot; : &#123; &quot;aliases&quot; : &#123; &#125;, &quot;mappings&quot; : &#123; &quot;properties&quot; : &#123; &quot;address&quot; : &#123; &quot;type&quot; : &quot;text&quot;, &quot;fields&quot; : &#123; &quot;keyword&quot; : &#123; &quot;type&quot; : &quot;keyword&quot; &#125; &#125;, &quot;analyzer&quot; : &quot;ik_max_word&quot; &#125;, &quot;category&quot; : &#123; &quot;type&quot; : &quot;keyword&quot; &#125;, &quot;count&quot; : &#123; &quot;type&quot; : &quot;integer&quot; &#125;, &quot;created_at&quot; : &#123; &quot;type&quot; : &quot;date&quot;, &quot;format&quot; : &quot;yyyy-MM-dd HH:mm:ss&quot; &#125;, &quot;price&quot; : &#123; &quot;type&quot; : &quot;double&quot; &#125;, &quot;remark&quot; : &#123; &quot;type&quot; : &quot;text&quot;, &quot;analyzer&quot; : &quot;ik_max_word&quot;, &quot;search_analyzer&quot; : &quot;ik_smart&quot; &#125;, &quot;tags&quot; : &#123; &quot;type&quot; : &quot;keyword&quot; &#125;, &quot;title&quot; : &#123; &quot;type&quot; : &quot;text&quot; &#125; &#125; &#125;, &quot;settings&quot; : &#123; &quot;index&quot; : &#123; &quot;routing&quot; : &#123; &quot;allocation&quot; : &#123; &quot;include&quot; : &#123; &quot;_tier_preference&quot; : &quot;data_content&quot; &#125; &#125; &#125;, &quot;number_of_shards&quot; : &quot;1&quot;, &quot;provided_name&quot; : &quot;shopping&quot;, &quot;creation_date&quot; : &quot;1745291743120&quot;, &quot;number_of_replicas&quot; : &quot;1&quot;, &quot;uuid&quot; : &quot;Y1IWrdlQTUm-CbbIWweSxQ&quot;, &quot;version&quot; : &#123; &quot;created&quot; : &quot;8525000&quot; &#125; &#125; &#125; &#125;&#125; æŸ¥çœ‹ç´¢å¼•è®¾ç½® 1234567891011121314151617181920212223242526272829303132333435363738394041424344# GET /&lt;target&gt;/_settingscurl -X GET -u elastic:123456 -k &#x27;https://127.0.0.1:9200/shopping/_settings?pretty&#x27;# è¿”å›å€¼&#123; &quot;shopping&quot; : &#123; &quot;mappings&quot; : &#123; &quot;properties&quot; : &#123; &quot;address&quot; : &#123; &quot;type&quot; : &quot;text&quot;, &quot;fields&quot; : &#123; &quot;keyword&quot; : &#123; &quot;type&quot; : &quot;keyword&quot; &#125; &#125;, &quot;analyzer&quot; : &quot;ik_max_word&quot; &#125;, &quot;category&quot; : &#123; &quot;type&quot; : &quot;keyword&quot; &#125;, &quot;count&quot; : &#123; &quot;type&quot; : &quot;integer&quot; &#125;, &quot;created_at&quot; : &#123; &quot;type&quot; : &quot;date&quot;, &quot;format&quot; : &quot;yyyy-MM-dd HH:mm:ss&quot; &#125;, &quot;price&quot; : &#123; &quot;type&quot; : &quot;double&quot; &#125;, &quot;remark&quot; : &#123; &quot;type&quot; : &quot;text&quot;, &quot;analyzer&quot; : &quot;ik_max_word&quot;, &quot;search_analyzer&quot; : &quot;ik_smart&quot; &#125;, &quot;tags&quot; : &#123; &quot;type&quot; : &quot;keyword&quot; &#125;, &quot;title&quot; : &#123; &quot;type&quot; : &quot;text&quot; &#125; &#125; &#125; &#125;&#125; æŸ¥çœ‹å­—æ®µæ˜ å°„ 123456789101112131415161718# GET /&lt;target&gt;/_mapping/field/&lt;field&gt;# shopping ä¸ºç´¢å¼•åç§°ï¼Œtitle ä¸ºå­—æ®µåç§°curl -X GET -u elastic:123456 -k &#x27;https://127.0.0.1:9200/shopping/_mapping/field/title?pretty&#x27;# è¿”å›å€¼&#123; &quot;shopping&quot; : &#123; &quot;mappings&quot; : &#123; &quot;title&quot; : &#123; &quot;full_name&quot; : &quot;title&quot;, &quot;mapping&quot; : &#123; &quot;title&quot; : &#123; &quot;type&quot; : &quot;text&quot; &#125; &#125; &#125; &#125; &#125;&#125; åˆ¤æ–­ç´¢å¼•æ˜¯å¦å­˜åœ¨ 12345678910111213# ä½¿ç”¨ -I å‚æ•°æ¥å‘é€ HEAD è¯·æ±‚ï¼Œå¯ä»¥è·å–å“åº”å¤´è€Œä¸å¿…ä¸‹è½½å“åº”ä½“ã€‚# HEAD /&lt;target&gt;curl -I -u elastic:123456 -k &#x27;https://127.0.0.1:9200/shopping&#x27;# è¿”å›å€¼HTTP/1.1 200 OKX-elastic-product: Elasticsearchcontent-type: application/jsoncontent-length: 603# è¿™ä¸ªå‘½ä»¤ä¸ä¼šè¿”å›å“åº”ä½“ï¼Œä½†å®ƒçš„ HTTP å“åº”ä»£ç å¯ä»¥å‘Šè¯‰ä½ ç´¢å¼•çš„å­˜åœ¨æƒ…å†µï¼š # 200 OK è¡¨ç¤ºç´¢å¼•å­˜åœ¨ã€‚ # 404 Not Found è¡¨ç¤ºç´¢å¼•ä¸å­˜åœ¨ã€‚ åˆ é™¤ç´¢å¼• 1234# DELETE /&lt;target&gt;curl -X DELETE -u elastic:123456 -k &#x27;https://127.0.0.1:9200/shopping&#x27;# è¿”å›å€¼&#123;&quot;acknowledged&quot;:true&#125; ä¸ºç´¢å¼•åˆ›å»ºåˆ«å 123456789101112131415161718192021# æ³¨æ„ï¼šä¸åŒç´¢å¼•å¯ä»¥æœ‰ç›¸åŒåç§°çš„åˆ«åï¼Œæ‰€ä»¥åœ¨æ•°æ®ç»“æ„ä¸€è‡´çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥ä¸ºä¸åŒçš„ç´¢å¼•åˆ›å»ºç›¸åŒçš„åˆ«åï¼Œç„¶åæ ¹æ®åˆ«åè¿›è¡Œæ•°æ®æŸ¥è¯¢# POST /&lt;target&gt;/_alias/&lt;alias&gt;curl -X POST -u elastic:123456 -k &#x27;https://127.0.0.1:9200/shopping/_alias/shopping_alias&#x27;# è¿”å›å€¼&#123;&quot;acknowledged&quot;:true&#125;# ä¹Ÿå¯ä»¥ä½¿ç”¨å¦‚ä¸‹æ–¹æ³•curl -X POST -u elastic:123456 -k &#x27;https://127.0.0.1:9200/_aliases&#x27; \\ -H &#x27;Content-Type: application/json&#x27; \\ -d &#x27;&#123; &quot;actions&quot;: [ &#123; &quot;add&quot;: &#123; &quot;index&quot;: &quot;shopping&quot;, &quot;alias&quot;: &quot;shopping_alias2&quot; &#125; &#125; ] &#125;&#x27;# è¿”å›å€¼&#123;&quot;acknowledged&quot;:true&#125; æŸ¥çœ‹ç´¢å¼•åˆ«å 12345678910111213141516# GET /&lt;target&gt;/_alias/&lt;alias&gt;curl -X GET -u elastic:123456 -k &#x27;https://127.0.0.1:9200/shopping/_alias/shopping_alias?pretty&#x27;# è¿”å›å€¼&#123; &quot;shopping&quot; : &#123; &quot;aliases&quot; : &#123; &quot;shopping_alias&quot; : &#123; &#125; &#125; &#125;&#125;# æŸ¥çœ‹å½“å‰ç´¢å¼•çš„æ‰€æœ‰åˆ«åcurl -X GET -u elastic:123456 -k &#x27;https://127.0.0.1:9200/shopping/_alias?pretty&#x27;# æŸ¥çœ‹æ‰€æœ‰ç´¢å¼•çš„åˆ«åcurl -X GET -u elastic:123456 -k &#x27;https://127.0.0.1:9200/_alias?pretty&#x27; ä¸ºç´¢å¼•åˆ é™¤åˆ«å 1234# DELETE /&lt;target&gt;/_alias/&lt;alias&gt;curl -X DELETE -u elastic:123456 -k &#x27;https://127.0.0.1:9200/shopping/_alias/shopping_alias&#x27;# è¿”å›å€¼&#123;&quot;acknowledged&quot;:true&#125; å¦‚ä½•ä¿®æ”¹ç´¢å¼•å­—æ®µç±»å‹æˆ–åˆ†è¯å™¨ç±»å‹ï¼Ÿ åˆ›å»ºæ–°çš„ç´¢å¼• 123456789101112131415161718192021222324252627282930313233343536373839404142434445# è¿™é‡Œä¸ºtitleå­—æ®µå¢åŠ åˆ†è¯å™¨curl -X PUT -u elastic:123456 -k &#x27;https://127.0.0.1:9200/shopping_new&#x27; \\ -H &#x27;Content-Type: application/json&#x27; \\ -d &#x27;&#123; &quot;settings&quot;:&#123; &quot;number_of_shards&quot;:&quot;1&quot;, &quot;number_of_replicas&quot;:&quot;2&quot; &#125;, &quot;mappings&quot;:&#123; &quot;properties&quot;:&#123; &quot;category&quot;:&#123; &quot;type&quot;:&quot;keyword&quot; &#125;, &quot;price&quot;:&#123; &quot;type&quot;:&quot;double&quot; &#125;, &quot;count&quot;:&#123; &quot;type&quot;:&quot;integer&quot; &#125;, &quot;title&quot;:&#123; &quot;type&quot;:&quot;text&quot;, &quot;analyzer&quot;:&quot;ik_max_word&quot;, &quot;search_analyzer&quot;:&quot;ik_smart&quot; &#125;, &quot;remark&quot;:&#123; &quot;type&quot;:&quot;text&quot;, &quot;analyzer&quot;:&quot;ik_max_word&quot;, &quot;search_analyzer&quot;:&quot;ik_smart&quot; &#125;, &quot;address&quot;: &#123; &quot;type&quot;: &quot;text&quot;, &quot;analyzer&quot;: &quot;ik_max_word&quot;, &quot;fields&quot;: &#123; &quot;keyword&quot;: &#123; &quot;type&quot;: &quot;keyword&quot; &#125; &#125; &#125;, &quot;tags&quot;: &#123; &quot;type&quot;: &quot;keyword&quot; &#125;, &quot;created_at&quot;: &#123;&quot;type&quot;: &quot;date&quot;, &quot;format&quot;: &quot;yyyy-MM-dd HH:mm:ss&quot;&#125; &#125; &#125; &#125;&#x27; å°†åŸç´¢å¼•çš„æ•°æ®è¿ç§»åˆ°æ–°ç´¢å¼• 123456789101112curl -X POST -u elastic:123456 -k &#x27;https://127.0.0.1:9200/_reindex&#x27; \\ -H &#x27;Content-Type: application/json&#x27; \\ -d &#x27;&#123; &quot;source&quot;: &#123; &quot;index&quot;: &quot;shopping&quot; &#125;, &quot;dest&quot;: &#123; &quot;index&quot;: &quot;shopping_new&quot; &#125;&#125;&#x27;# è¿”å›å€¼&#123;&quot;took&quot;:101,&quot;timed_out&quot;:false,&quot;total&quot;:2,&quot;updated&quot;:0,&quot;created&quot;:2,&quot;deleted&quot;:0,&quot;batches&quot;:1,&quot;version_conflicts&quot;:0,&quot;noops&quot;:0,&quot;retries&quot;:&#123;&quot;bulk&quot;:0,&quot;search&quot;:0&#125;,&quot;throttled_millis&quot;:0,&quot;requests_per_second&quot;:-1.0,&quot;throttled_until_millis&quot;:0,&quot;failures&quot;:[]&#125; åˆ é™¤åŸç´¢å¼• 123curl -X DELETE -u elastic:123456 -k &#x27;https://127.0.0.1:9200/shopping&#x27;# è¿”å›å€¼&#123;&quot;acknowledged&quot;:true&#125; ä¸ºæ–°ç´¢å¼•åˆ›å»ºåˆ«å 123curl -X POST -u elastic:123456 -k &#x27;https://127.0.0.1:9200/shopping_new/_alias/shopping&#x27;# è¿”å›å€¼&#123;&quot;acknowledged&quot;:true,&quot;errors&quot;:false&#125; æ•°æ®å¢åˆ æ”¹åŸºæœ¬æ“ä½œ æ–°å¢æ•°æ® 1.ä¸ºæŒ‡å®šç´¢å¼•æ’å…¥ä¸€æ¡æ•°æ®(_docæ–¹å¼ï¼šä¸æŒ‡å®šidé»˜è®¤éšæœºå­—ç¬¦ä¸²) 12345678910111213141516171819202122232425262728# _doc çš„æ–¹å¼åˆ›å»ºç´¢å¼•æ•°æ®æ—¶ï¼Œå¯ä»¥ä¸æŒ‡å®šidï¼Œé»˜è®¤ä¼šåˆ›å»ºæ–°çš„idï¼Œidç±»å‹ä¸ºéšæœºå­—ç¬¦ä¸²# POST /&lt;target&gt;/_doccurl -X POST -u elastic:123456 -k &#x27;https://127.0.0.1:9200/shopping/_doc?pretty&#x27; \\ -H &#x27;Content-Type: application/json&#x27; \\ -d &#x27;&#123; &quot;category&quot;: &quot;electronics&quot;, &quot;price&quot;: 999.99, &quot;count&quot;: 10, &quot;title&quot;: &quot;Smartphone X - 128GB&quot;, &quot;remark&quot;: &quot;This latest Smartphone X comes with a powerful processor and high-resolution camera.&quot;, &quot;address&quot;: &quot;123 Electronic Ave, Beijing, China&quot;, &quot;tags&quot;: [&quot;latest&quot;, &quot;smartphone&quot;, &quot;technology&quot;], &quot;created_at&quot;: &quot;2025-04-22 03:30:02&quot; &#125;&#x27;# è¿”å›å€¼&#123; &quot;_index&quot; : &quot;shopping_new&quot;, &quot;_id&quot; : &quot;sImNW5YBmgASmV9McVvI&quot;, &quot;_version&quot; : 1, &quot;result&quot; : &quot;created&quot;, &quot;_shards&quot; : &#123; &quot;total&quot; : 3, &quot;successful&quot; : 1, &quot;failed&quot; : 0 &#125;, &quot;_seq_no&quot; : 1, &quot;_primary_term&quot; : 1&#125; 2.ä¸ºæŒ‡å®šç´¢å¼•æ’å…¥ä¸€æ¡æ•°æ®(_docæ–¹å¼ï¼šæŒ‡å®šid) 12345678910111213141516171819202122232425262728# _doc çš„æ–¹å¼åˆ›å»ºç´¢å¼•æ•°æ®æ—¶ï¼Œå¦‚æœæŒ‡å®šidï¼Œå†æ¬¡æ‰§è¡Œæ—¶ä¼šå…ˆåˆ é™¤åŸæ•°æ®å†åˆ›å»ºæ–°æ•°æ®ï¼Œæ‰€ä»¥å¿…é¡»å…¨é‡æ›´æ–°æ‰è¡Œã€‚# PUT /&lt;target&gt;/_doccurl -X PUT -u elastic:123456 -k &#x27;https://127.0.0.1:9200/shopping/_doc/100?pretty&#x27; \\ -H &#x27;Content-Type: application/json&#x27; \\ -d &#x27;&#123; &quot;category&quot;: &quot;electronics&quot;, &quot;price&quot;: 999.99, &quot;count&quot;: 10, &quot;title&quot;: &quot;Smartphone X - 128GB&quot;, &quot;remark&quot;: &quot;This latest Smartphone X comes with a powerful processor and high-resolution camera.&quot;, &quot;address&quot;: &quot;123 Electronic Ave, Beijing, China&quot;, &quot;tags&quot;: [&quot;latest&quot;, &quot;smartphone&quot;, &quot;technology&quot;], &quot;created_at&quot;: &quot;2025-04-22 03:30:02&quot; &#125;&#x27;# è¿”å›å€¼&#123; &quot;_index&quot; : &quot;shopping_new&quot;, &quot;_id&quot; : &quot;100&quot;, &quot;_version&quot; : 1, &quot;result&quot; : &quot;created&quot;, &quot;_shards&quot; : &#123; &quot;total&quot; : 3, &quot;successful&quot; : 1, &quot;failed&quot; : 0 &#125;, &quot;_seq_no&quot; : 2, &quot;_primary_term&quot; : 1&#125; 3.ä¸ºæŒ‡å®šç´¢å¼•æ’å…¥ä¸€æ¡æ•°æ®(_createæ–¹å¼ï¼šæŒ‡å®šid) 1234567891011121314# _create çš„æ–¹å¼åˆ›å»ºç´¢å¼•æ•°æ®æ—¶ï¼Œå¿…é¡»æŒ‡å®šid,è€Œä¸”åªèƒ½æ‰§è¡Œä¸€æ¬¡ï¼Œå› ä¸ºæ‰§è¡Œè¿‡ä¸€æ¬¡åæŒ‡å®šidçš„æ•°æ®å°±å­˜åœ¨äº†ï¼Œä¸èƒ½å†æ¬¡åˆ›å»º# POST /&lt;target&gt;/_create/&lt;id&gt;curl -X POST -u elastic:123456 -k &#x27;https://127.0.0.1:9200/shopping/_create/1?pretty&#x27; \\ -H &#x27;Content-Type: application/json&#x27; \\ -d &#x27;&#123; &quot;category&quot;: &quot;electronics&quot;, &quot;price&quot;: 999.99, &quot;count&quot;: 10, &quot;title&quot;: &quot;Smartphone X - 128GB&quot;, &quot;remark&quot;: &quot;This latest Smartphone X comes with a powerful processor and high-resolution camera.&quot;, &quot;address&quot;: &quot;123 Electronic Ave, Beijing, China&quot;, &quot;tags&quot;: [&quot;latest&quot;, &quot;smartphone&quot;, &quot;technology&quot;], &quot;created_at&quot;: &quot;2025-04-22 03:30:02&quot; &#125;&#x27; ä¿®æ”¹æ•°æ® 1.ä¿®æ”¹å…¨éƒ¨æ•°æ® 1234567891011121314# POST /&lt;target&gt;/_doc/&lt;id&gt;# æ‰§è¡Œæ—¶ä¼šå…ˆåˆ é™¤åŸæ•°æ®å†åˆ›å»ºæ–°æ•°æ®ï¼Œæ‰€ä»¥å¿…é¡»å…¨é‡æ›´æ–°æ‰è¡Œã€‚curl -X POST -u elastic:123456 -k &#x27;https://127.0.0.1:9200/shopping/_doc/sImNW5YBmgASmV9McVvI&#x27; \\ -H &#x27;Content-Type: application/json&#x27; \\ -d &#x27;&#123; &quot;category&quot;: &quot;electronics&quot;, &quot;price&quot;: 999.99, &quot;count&quot;: 20, &quot;title&quot;: &quot;Smartphone X - 128GB&quot;, &quot;remark&quot;: &quot;This latest Smartphone X comes with a powerful processor and high-resolution camera.&quot;, &quot;address&quot;: &quot;123 Electronic Ave, Beijing, China&quot;, &quot;tags&quot;: [&quot;latest&quot;, &quot;smartphone&quot;, &quot;technology&quot;], &quot;created_at&quot;: &quot;2025-04-22 03:30:02&quot; &#125;&#x27; 2.ä¿®æ”¹éƒ¨åˆ†æ•°æ® 12345# POST /&lt;target&gt;/_update/&lt;id&gt;# æ‰§è¡Œæ—¶åªä¼šä¿®æ”¹æŒ‡å®šå­—æ®µï¼Œä¸ä¼šåˆ é™¤åŸæ•°æ®ï¼Œæ‰€ä»¥å¯ä»¥éƒ¨åˆ†æ›´æ–°ã€‚curl -X POST -u elastic:123456 -k &#x27;https://127.0.0.1:9200/shopping/_update/1&#x27; \\ -H &#x27;Content-Type: application/json&#x27; \\ -d &#x27;&#123;&quot;doc&quot;:&#123;&quot;count&quot;:100&#125;&#125;&#x27; æŸ¥è¯¢æŒ‡å®šç´¢å¼•çš„æŒ‡å®šidçš„æ•°æ® 12345678910111213141516171819202122232425# GET /&lt;target&gt;/_doc/&lt;id&gt;curl -X GET -u elastic:123456 -k &#x27;https://127.0.0.1:9200/shopping/_doc/100?pretty&#x27;# è¿”å›å€¼&#123; &quot;_index&quot; : &quot;shopping_new&quot;, &quot;_id&quot; : &quot;100&quot;, &quot;_version&quot; : 1, &quot;_seq_no&quot; : 2, &quot;_primary_term&quot; : 1, &quot;found&quot; : true, &quot;_source&quot; : &#123; &quot;category&quot; : &quot;electronics&quot;, &quot;price&quot; : 999.99, &quot;count&quot; : 10, &quot;title&quot; : &quot;Smartphone X - 128GB&quot;, &quot;remark&quot; : &quot;This latest Smartphone X comes with a powerful processor and high-resolution camera.&quot;, &quot;address&quot; : &quot;123 Electronic Ave, Beijing, China&quot;, &quot;tags&quot; : [ &quot;latest&quot;, &quot;smartphone&quot;, &quot;technology&quot; ], &quot;created_at&quot; : &quot;2025-04-22 03:30:02&quot; &#125;&#125; åˆ é™¤æŒ‡å®šç´¢å¼•çš„æŒ‡å®šidçš„æ•°æ® 12# DELETE /&lt;target&gt;/_doc/&lt;id&gt;curl -X DELETE -u elastic:123456 -k &#x27;https://127.0.0.1:9200/shopping/_doc/100&#x27; åˆ é™¤ç´¢å¼•å…¨éƒ¨æ•°æ® 123curl -X POST -u elastic:123456 -k &#x27;https://127.0.0.1:9200/shopping/_delete_by_query?pretty&#x27; \\ -H &#x27;Content-Type: application/json&#x27; \\ -d &#x27;&#123;&quot;query&quot;:&#123;&quot;match_all&quot;:&#123;&#125;&#125;&#125;&#x27; æ‰¹é‡æ“ä½œ æ‰¹é‡æ–°å¢æ•°æ® 1234567891011121314151617181920212223242526272829303132333435363738394041# æ³¨æ„æ•°æ®è¡Œè¦é¡¶è¡Œå†™ï¼Œå‰é¢ä¸è¦æœ‰ç©ºæ ¼# POST /_bulkcurl -X POST -u elastic:123456 -k &#x27;https://127.0.0.1:9200/_bulk&#x27; \\ -H &#x27;Content-Type: application/json&#x27; \\ -d &#x27;&#123; &quot;index&quot;: &#123; &quot;_index&quot;: &quot;shopping&quot;, &quot;_id&quot;: &quot;1&quot; &#125; &#125;&#123; &quot;category&quot;: &quot;electronics&quot;, &quot;price&quot;: 999.99, &quot;count&quot;: 10, &quot;title&quot;: &quot;Smartphone X - 128GB&quot;, &quot;remark&quot;: &quot;This latest Smartphone X comes with a powerful processor and high-resolution camera.&quot;, &quot;address&quot;: &quot;å¹¿å·å¤©æ²³å…¬å›­&quot;, &quot;tags&quot;: [&quot;latest&quot;, &quot;smartphone&quot;, &quot;technology&quot;], &quot;created_at&quot;: &quot;2025-04-22 03:30:02&quot; &#125;&#123; &quot;index&quot;: &#123; &quot;_index&quot;: &quot;shopping&quot;, &quot;_id&quot;: &quot;2&quot; &#125; &#125;&#123; &quot;category&quot;: &quot;fashion&quot;, &quot;price&quot;: 49.99, &quot;count&quot;: 25, &quot;title&quot;: &quot;Designer T-shirt&quot;, &quot;remark&quot;: &quot;Trendy designer T-shirt made with high quality fabric.&quot;, &quot;address&quot;: &quot;å¹¿å·è”æ¹¾å¤§å¦&quot;, &quot;tags&quot;: [&quot;clothing&quot;, &quot;designer&quot;, &quot;style&quot;], &quot;created_at&quot;: &quot;2025-04-21 12:15:00&quot; &#125;&#123; &quot;index&quot;: &#123; &quot;_index&quot;: &quot;shopping&quot;, &quot;_id&quot;: &quot;3&quot; &#125; &#125;&#123; &quot;category&quot;: &quot;home_appliances&quot;, &quot;price&quot;: 299.99, &quot;count&quot;: 5, &quot;title&quot;: &quot;Robot Vacuum Cleaner&quot;, &quot;remark&quot;: &quot;Efficient robot vacuum cleaner with smart navigation.&quot;, &quot;address&quot;: &quot;å¹¿å·ç™½äº‘å±±å…¬å›­&quot;, &quot;tags&quot;: [&quot;appliances&quot;, &quot;vacuum&quot;, &quot;robot&quot;], &quot;created_at&quot;: &quot;2025-04-20 08:45:30&quot; &#125;&#123; &quot;index&quot;: &#123; &quot;_index&quot;: &quot;shopping&quot;, &quot;_id&quot;: &quot;4&quot; &#125; &#125;&#123; &quot;category&quot;: &quot;books&quot;, &quot;price&quot;: 19.99, &quot;count&quot;: 100, &quot;title&quot;: &quot;Inspirational Novel&quot;, &quot;remark&quot;: &quot;A gripping novel that inspires and motivates.&quot;, &quot;address&quot;: &quot;321 Book Rd, Shenzhen, China&quot;, &quot;tags&quot;: [&quot;book&quot;, &quot;novel&quot;, &quot;inspiration&quot;], &quot;created_at&quot;: &quot;2025-04-19 10:05:00&quot; &#125;&#123; &quot;index&quot;: &#123; &quot;_index&quot;: &quot;shopping&quot;, &quot;_id&quot;: &quot;5&quot; &#125; &#125;&#123; &quot;category&quot;: &quot;groceries&quot;, &quot;price&quot;: 3.99, &quot;count&quot;: 200, &quot;title&quot;: &quot;Organic Apples&quot;, &quot;remark&quot;: &quot;Fresh and crispy organic apples.&quot;, &quot;address&quot;: &quot;654 Grocery Ln, Chengdu, China&quot;, &quot;tags&quot;: [&quot;fruit&quot;, &quot;organic&quot;, &quot;healthy&quot;], &quot;created_at&quot;: &quot;2025-04-18 14:30:45&quot; &#125;&#123; &quot;index&quot;: &#123; &quot;_index&quot;: &quot;shopping&quot;, &quot;_id&quot;: &quot;6&quot; &#125; &#125;&#123; &quot;category&quot;: &quot;electronics&quot;, &quot;price&quot;: 1999.99, &quot;count&quot;: 15, &quot;title&quot;: &quot;Smartphone X - 256GB&quot;, &quot;remark&quot;: &quot;This latest Smartphone X comes with a powerful processor and high-resolution camera.&quot;, &quot;address&quot;: &quot;å¹¿å·å¤©æ²³å…¬å›­&quot;, &quot;tags&quot;: [&quot;latest&quot;, &quot;smartphone&quot;, &quot;technology&quot;], &quot;created_at&quot;: &quot;2025-04-22 03:30:02&quot; &#125;&#x27;# å‚æ•°è¯´æ˜# index: ç”¨äºåˆ›å»ºæ–°æ–‡æ¡£æˆ–æ›¿æ¢å·²æœ‰æ–‡æ¡£ã€‚# create: ç”¨äºåˆ›å»ºæ–°æ–‡æ¡£ï¼Œå¦‚æœæ–‡æ¡£å·²å­˜åœ¨ï¼Œåˆ™è¿”å›é”™è¯¯ã€‚# _index: æŒ‡å®šç´¢å¼•åç§°ã€‚# _id: æŒ‡å®šæ–‡æ¡£IDã€‚å¦‚æœä¸æŒ‡å®šåˆ™ä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªéšæœºçš„IDã€‚# æ‰¹é‡æ–°å¢æ•°æ®æ—¶ä¹Ÿå¯ä»¥åœ¨urlä¸­æŒ‡å®šç´¢å¼•åç§°# æ­¤æ—¶å¯ä»¥æŒ‡å®šidï¼Œå¦‚æœä¸æŒ‡å®šåˆ™è‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªéšæœºå­—ç¬¦ä¸²çš„ID# POST /&lt;target&gt;/_bulkcurl -X POST -u elastic:123456 -k &#x27;https://127.0.0.1:9200/shopping/_bulk&#x27; \\ -H &#x27;Content-Type: application/json&#x27; \\ -d &#x27;&#123; &quot;index&quot;: &#123;&#125; &#125;&#123; &quot;category&quot;: &quot;electronics&quot;, &quot;price&quot;: 999.99, &quot;count&quot;: 10, &quot;title&quot;: &quot;Smartphone X - 128GB&quot;, &quot;remark&quot;: &quot;This latest Smartphone X comes with a powerful processor and high-resolution camera.&quot;, &quot;address&quot;: &quot;å¹¿å·å¤©æ²³å…¬å›­&quot;, &quot;tags&quot;: [&quot;latest&quot;, &quot;smartphone&quot;, &quot;technology&quot;], &quot;created_at&quot;: &quot;2025-04-22 03:30:02&quot; &#125;&#123; &quot;index&quot;: &#123;&#125; &#125;&#123; &quot;category&quot;: &quot;fashion&quot;, &quot;price&quot;: 49.99, &quot;count&quot;: 25, &quot;title&quot;: &quot;Designer T-shirt&quot;, &quot;remark&quot;: &quot;Trendy designer T-shirt made with high quality fabric.&quot;, &quot;address&quot;: &quot;å¹¿å·è”æ¹¾å¤§å¦&quot;, &quot;tags&quot;: [&quot;clothing&quot;, &quot;designer&quot;, &quot;style&quot;], &quot;created_at&quot;: &quot;2025-04-21 12:15:00&quot; &#125;&#123; &quot;index&quot;: &#123;&#125; &#125;&#123; &quot;category&quot;: &quot;home_appliances&quot;, &quot;price&quot;: 299.99, &quot;count&quot;: 5, &quot;title&quot;: &quot;Robot Vacuum Cleaner&quot;, &quot;remark&quot;: &quot;Efficient robot vacuum cleaner with smart navigation.&quot;, &quot;address&quot;: &quot;å¹¿å·ç™½äº‘å±±å…¬å›­&quot;, &quot;tags&quot;: [&quot;appliances&quot;, &quot;vacuum&quot;, &quot;robot&quot;], &quot;created_at&quot;: &quot;2025-04-20 08:45:30&quot; &#125;&#123; &quot;index&quot;: &#123;&#125; &#125;&#123; &quot;category&quot;: &quot;books&quot;, &quot;price&quot;: 19.99, &quot;count&quot;: 100, &quot;title&quot;: &quot;Inspirational Novel&quot;, &quot;remark&quot;: &quot;A gripping novel that inspires and motivates.&quot;, &quot;address&quot;: &quot;321 Book Rd, Shenzhen, China&quot;, &quot;tags&quot;: [&quot;book&quot;, &quot;novel&quot;, &quot;inspiration&quot;], &quot;created_at&quot;: &quot;2025-04-19 10:05:00&quot; &#125;&#123; &quot;index&quot;: &#123;&#125; &#125;&#123; &quot;category&quot;: &quot;groceries&quot;, &quot;price&quot;: 3.99, &quot;count&quot;: 200, &quot;title&quot;: &quot;Organic Apples&quot;, &quot;remark&quot;: &quot;Fresh and crispy organic apples.&quot;, &quot;address&quot;: &quot;654 Grocery Ln, Chengdu, China&quot;, &quot;tags&quot;: [&quot;fruit&quot;, &quot;organic&quot;, &quot;healthy&quot;], &quot;created_at&quot;: &quot;2025-04-18 14:30:45&quot; &#125;&#123; &quot;index&quot;: &#123;&#125; &#125;&#123; &quot;category&quot;: &quot;electronics&quot;, &quot;price&quot;: 1999.99, &quot;count&quot;: 15, &quot;title&quot;: &quot;Smartphone X - 256GB&quot;, &quot;remark&quot;: &quot;This latest Smartphone X comes with a powerful processor and high-resolution camera.&quot;, &quot;address&quot;: &quot;å¹¿å·å¤©æ²³å…¬å›­&quot;, &quot;tags&quot;: [&quot;latest&quot;, &quot;smartphone&quot;, &quot;technology&quot;], &quot;created_at&quot;: &quot;2025-04-22 03:30:02&quot; &#125;&#x27; æ‰¹é‡ä¿®æ”¹æ•°æ® 1234567891011# æ³¨æ„æ•°æ®è¡Œè¦é¡¶è¡Œå†™ï¼Œå‰é¢ä¸è¦æœ‰ç©ºæ ¼curl -X POST -u elastic:123456 -k &#x27;https://127.0.0.1:9200/_bulk&#x27; \\ -H &#x27;Content-Type: application/json&#x27; \\ -d &#x27;&#123;&quot;update&quot;:&#123;&quot;_index&quot;:&quot;shopping&quot;,&quot;_id&quot;:&quot;1&quot;&#125;&#125;&#123;&quot;doc&quot;:&#123;&quot;title&quot;:&quot;Smartphone X2 - 128GB&quot;,&quot;price&quot;:1000.11&#125;&#125;&#123;&quot;update&quot;:&#123;&quot;_index&quot;:&quot;shopping&quot;,&quot;_id&quot;:&quot;2&quot;&#125;&#125;&#123;&quot;doc&quot;:&#123;&quot;title&quot;:&quot;T-shirt&quot;,&quot;price&quot;:45.99&#125;&#125;&#x27;# å‚æ•°è¯´æ˜# update: ç”¨äºæ›´æ–°æ–‡æ¡£ã€‚# doc: æŒ‡å®šè¦æ›´æ–°çš„å­—æ®µã€‚ æ‰¹é‡åˆ é™¤æ•°æ® 12345678910# æ³¨æ„æ•°æ®è¡Œè¦é¡¶è¡Œå†™ï¼Œå‰é¢ä¸è¦æœ‰ç©ºæ ¼curl -X POST -u elastic:123456 -k &#x27;https://127.0.0.1:9200/_bulk&#x27; \\ -H &#x27;Content-Type: application/json&#x27; \\ -d &#x27;&#123;&quot;delete&quot;:&#123;&quot;_index&quot;:&quot;shopping&quot;,&quot;_id&quot;:&quot;1&quot;&#125;&#125;&#123;&quot;delete&quot;:&#123;&quot;_index&quot;:&quot;shopping&quot;,&quot;_id&quot;:&quot;2&quot;&#125;&#125;&#123;&quot;delete&quot;:&#123;&quot;_index&quot;:&quot;shopping&quot;,&quot;_id&quot;:&quot;3&quot;&#125;&#125;&#123;&quot;delete&quot;:&#123;&quot;_index&quot;:&quot;shopping&quot;,&quot;_id&quot;:&quot;4&quot;&#125;&#125;&#x27;# å‚æ•°è¯´æ˜# delete: ç”¨äºåˆ é™¤æ–‡æ¡£ã€‚ æ¡ä»¶æ›´æ–° 123456789101112131415161718192021# POST /&lt;target&gt;/_update_by_query# è¿™é‡Œå°†categoryä¸ºåä¸ºçš„æ•°æ®ä»·æ ¼æ”¹ä¸º1999curl -X POST -u elastic:123456 -k &#x27;https://127.0.0.1:9200/shopping/_update_by_query?pretty&#x27; \\ -H &#x27;Content-Type: application/json&#x27; \\ -d &#x27;&#123; &quot;query&quot;: &#123; &quot;match&quot;: &#123; &quot;category&quot;: &quot;books&quot; &#125; &#125;, &quot;script&quot;: &#123; &quot;source&quot;: &quot;ctx._source.price = 20.99&quot;, &quot;lang&quot;: &quot;painless&quot; &#125; &#125;&#x27;# å‚æ•°è¯´æ˜## &quot;query&quot;: &#123;&#125; æŸ¥è¯¢æ¡ä»¶## &quot;script&quot;: &#123;&#125; è„šæœ¬### source: è„šæœ¬å†…å®¹### lang: è„šæœ¬è¯­è¨€#### painless æ˜¯ Elasticsearch å®˜æ–¹æä¾›çš„è„šæœ¬è¯­è¨€ï¼Œå®ƒæä¾›äº†è®¸å¤šå†…ç½®å‡½æ•°å’Œå˜é‡ï¼Œå¯ä»¥æ–¹ä¾¿åœ°å®ç°å„ç§å¤æ‚çš„é€»è¾‘æ“ä½œã€‚https://www.elastic.co/guide/en/elasticsearch/painless/current/painless-lang-spec.html æ¡ä»¶åˆ é™¤ 1234# POST /&lt;target&gt;/_delete_by_querycurl -X POST -u elastic:123456 -k &#x27;https://127.0.0.1:9200/shopping/_delete_by_query?pretty&#x27; \\ -H &#x27;Content-Type: application/json&#x27; \\ -d &#x27;&#123;&quot;query&quot;:&#123;&quot;match&quot;:&#123;&quot;category&quot;:&quot;books&quot;&#125;&#125;&#125;&#x27; æ¡ä»¶æŸ¥è¯¢ match_all: å…¨éƒ¨åŒ¹é…æŸ¥è¯¢ 1234567# GET /&lt;target&gt;/_searchcurl -X GET -u elastic:123456 -k &#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27; -H &#x27;Content-Type: application/json&#x27; \\ -d &#x27;&#123;&quot;query&quot;:&#123;&quot;match_all&quot;:&#123;&#125;&#125;&#125;&#x27;# æˆ–è€…ç®€å†™ä¸ºcurl -X GET -u elastic:123456 -k &#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27; term: ç²¾ç¡®åŒ¹é…æŸ¥è¯¢ï¼ˆå…³é”®å­—æŸ¥è¯¢ï¼Œå³ä¸åˆ†è¯ï¼‰ 12345678910111213curl -X GET -u elastic:123456 -k &#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27; \\ -H &#x27;Content-Type: application/json&#x27; \\ -d &#x27;&#123;&quot;query&quot;:&#123;&quot;term&quot;:&#123;&quot;category&quot;:&quot;electronics&quot;&#125;&#125;&#125;&#x27;# å¦‚æœå­—æ®µè¢«é¢å¤–è®¾ç½® keyword ç±»å‹ï¼Œåˆ™éœ€è¦åŠ ä¸Š .keyword åç¼€curl -X GET -u elastic:123456 -k &#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27; \\ -H &#x27;Content-Type: application/json&#x27; \\ -d &#x27;&#123;&quot;query&quot;:&#123;&quot;term&quot;:&#123;&quot;address.keyword&quot;:&quot;å¹¿å·ç™½äº‘å±±å…¬å›­&quot;&#125;&#125;&#125;&#x27;# termå¤„ç†å¤šå€¼å­—æ®µ(æ•°ç»„)æ—¶ï¼ŒtermæŸ¥è¯¢æ˜¯åŒ…å«ï¼Œä¸æ˜¯ç­‰äºcurl -X GET -u elastic:123456 -k &#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27; \\ -H &#x27;Content-Type: application/json&#x27; \\ -d &#x27;&#123;&quot;query&quot;:&#123;&quot;term&quot;:&#123;&quot;tags&quot;:&quot;technology&quot;&#125;&#125;&#125;&#x27; terms: å¤šå…³é”®å­—ç²¾ç¡®åŒ¹é…æŸ¥è¯¢ 123curl -X GET -u elastic:123456 -k &#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27; \\ -H &#x27;Content-Type: application/json&#x27; \\ -d &#x27;&#123;&quot;query&quot;:&#123;&quot;terms&quot;:&#123;&quot;category&quot;:[&quot;electronics&quot;,&quot;books&quot;]&#125;&#125;&#125;&#x27; range: èŒƒå›´æŸ¥è¯¢ 12345678910111213141516171819202122232425curl -X GET -u elastic:123456 -k &#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27; \\ -H &#x27;Content-Type: application/json&#x27; \\ -d &#x27;&#123;&quot;query&quot;:&#123;&quot;range&quot;:&#123;&quot;price&quot;:&#123;&quot;gte&quot;:20,&quot;lte&quot;:30&#125;&#125;&#125;&#125;&#x27; # gte: å¤§äºç­‰äº # lte: å°äºç­‰äº # gt: å¤§äº # lt: å°äº# æ—¶é—´èŒƒå›´æŸ¥è¯¢curl -X GET -u elastic:123456 -k &#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27; \\ -H &#x27;Content-Type: application/json&#x27; \\ -d &#x27;&#123;&quot;query&quot;:&#123;&quot;range&quot;:&#123;&quot;created_at&quot;:&#123;&quot;gte&quot;:&quot;2025-04-20 00:00:00&quot;,&quot;lte&quot;:&quot;2025-05-20 23:59:59&quot;&#125;&#125;&#125;&#125;&#x27;# åŸºäºæ—¥æœŸæ•°å­¦è¡¨è¾¾å¼æŸ¥è¯¢curl -X GET -u elastic:123456 -k &#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27; \\ -H &#x27;Content-Type: application/json&#x27; \\ -d &#x27;&#123;&quot;query&quot;:&#123;&quot;range&quot;:&#123;&quot;created_at&quot;:&#123;&quot;gte&quot;:&quot;now-1y&quot;&#125;&#125;&#125;&#125;&#x27;# æ”¯æŒçš„æ—¥æœŸè¡¨è¾¾å¼# - nowï¼šå½“å‰æ—¶é—´ç‚¹ã€‚# - now-1dï¼šä»å½“å‰æ—¶é—´ç‚¹å‘å‰æ¨1å¤©çš„æ—¶é—´ç‚¹ã€‚# - now-1wï¼šä»å½“å‰æ—¶é—´ç‚¹å‘å‰æ¨1å‘¨çš„æ—¶é—´ç‚¹ã€‚# - now-1Mï¼šä»å½“å‰æ—¶é—´ç‚¹å‘å‰æ¨1ä¸ªæœˆçš„æ—¶é—´ç‚¹ã€‚# - now-1yï¼šä»å½“å‰æ—¶é—´ç‚¹å‘å‰æ¨1å¹´çš„æ—¶é—´ç‚¹ã€‚# - now+1hï¼šä»å½“å‰æ—¶é—´ç‚¹å‘åæ¨1å°æ—¶çš„æ—¶é—´ç‚¹ã€‚ exists: æŸ¥è¯¢å­—æ®µå­˜åœ¨çš„æ•°æ® 12345curl -X GET -u elastic:123456 -k &#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27; \\ -H &#x27;Content-Type: application/json&#x27; \\ -d &#x27;&#123;&quot;query&quot;:&#123;&quot;exists&quot;:&#123;&quot;field&quot;:&quot;title&quot;&#125;&#125;&#125;&#x27; # field: æŒ‡å®šè¦æŸ¥è¯¢çš„å­—æ®µ # ç¤ºä¾‹ï¼šæŸ¥è¯¢ title å­—æ®µå­˜åœ¨çš„æ–‡æ¡£ ids: æ ¹æ®ä¸€ç»„IDæŸ¥è¯¢ 12345curl -X GET -u elastic:123456 -k &#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27; \\ -H &#x27;Content-Type: application/json&#x27; \\ -d &#x27;&#123;&quot;query&quot;:&#123;&quot;ids&quot;:&#123;&quot;values&quot;:[&quot;1&quot;,&quot;2&quot;]&#125;&#125;&#125;&#x27; # values: æŒ‡å®šè¦æŸ¥è¯¢çš„IDåˆ—è¡¨ # ç¤ºä¾‹ï¼šæŸ¥è¯¢IDä¸º1å’Œ2çš„æ–‡æ¡£ prefix: å‰ç¼€æŸ¥è¯¢ ä»…é€‚ç”¨äºå…³é”®å­—ç±»å‹(keyword)çš„å­—æ®µ 123456789101112curl -X GET -u elastic:123456 -k &#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27; \\ -H &#x27;Content-Type: application/json&#x27; \\ -d &#x27;&#123;&quot;query&quot;:&#123;&quot;prefix&quot;:&#123;&quot;category&quot;:&quot;elec&quot;&#125;&#125;&#125;&#x27;# ä»…é€‚ç”¨äºkeywordç±»å‹å­—æ®µï¼Œæ‰€ä»¥ä¸‹é¢è¿™ä¸ªè¯·æ±‚æŸ¥è¯¢ä¸åˆ°æ•°æ®curl -X GET -u elastic:123456 -k &#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27; \\ -H &#x27;Content-Type: application/json&#x27; \\ -d &#x27;&#123;&quot;query&quot;:&#123;&quot;prefix&quot;:&#123;&quot;address&quot;:&quot;å¹¿å·ç™½äº‘å±±&quot;&#125;&#125;&#125;&#x27;# å› ä¸ºaddressè¢«é™„åŠ äº†keywordç±»å‹ï¼Œæ‰€ä»¥éœ€è¦åŠ ä¸Š.keywordåç¼€åå¯ä»¥æŸ¥è¯¢åˆ°æ•°æ®curl -X GET -u elastic:123456 -k &#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27; \\ -H &#x27;Content-Type: application/json&#x27; \\ -d &#x27;&#123;&quot;query&quot;:&#123;&quot;prefix&quot;:&#123;&quot;address.keyword&quot;:&quot;å¹¿å·ç™½äº‘å±±&quot;&#125;&#125;&#125;&#x27; wildcard: é€šé…ç¬¦æŸ¥è¯¢ ä»…é€‚ç”¨äºå…³é”®å­—ç±»å‹(keyword)çš„å­—æ®µ 12345curl -X GET -u elastic:123456 -k &#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27; \\ -H &#x27;Content-Type: application/json&#x27; \\ -d &#x27;&#123;&quot;query&quot;:&#123;&quot;wildcard&quot;:&#123;&quot;category&quot;:&quot;e?e*&quot;&#125;&#125;&#125;&#x27;# ?: ä»»æ„å•ä¸ªå­—ç¬¦# *: ä»»æ„å¤šä¸ªå­—ç¬¦ regexp: æ­£åˆ™è¡¨è¾¾å¼æŸ¥è¯¢ ä»…é€‚ç”¨äºå…³é”®å­—ç±»å‹(keyword)çš„å­—æ®µ 123curl -X GET -u elastic:123456 -k &#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27; \\ -H &#x27;Content-Type: application/json&#x27; \\ -d &#x27;&#123;&quot;query&quot;:&#123;&quot;regexp&quot;:&#123;&quot;category&quot;:&quot;e.e.*&quot;&#125;&#125;&#125;&#x27; fuzzy: æ”¯æŒç¼–è¾‘è·ç¦»çš„æ¨¡ç³ŠæŸ¥è¯¢ ä»…é€‚ç”¨äºå…³é”®å­—ç±»å‹(keyword)çš„å­—æ®µ fuzzyæ£€ç´¢æ˜¯ä¸€ç§å¼ºå¤§çš„æœç´¢åŠŸèƒ½ï¼Œå®ƒèƒ½å¤Ÿåœ¨ç”¨æˆ·è¾“å…¥å†…å®¹å­˜åœ¨æ‹¼å†™é”™è¯¯æˆ–ä¸Šä¸‹æ–‡ä¸ä¸€è‡´æ—¶ï¼Œä»ç„¶è¿”å›ä¸æœç´¢è¯ç›¸ä¼¼çš„æ–‡æ¡£ã€‚é€šè¿‡ä½¿ç”¨ç¼–è¾‘è·ç¦»ç®—æ³•æ¥åº¦é‡è¾“å…¥è¯ä¸æ–‡æ¡£ä¸­è¯æ¡çš„ç›¸ä¼¼ç¨‹åº¦ï¼Œæ¨¡ç³ŠæŸ¥è¯¢åœ¨ä¿è¯æœç´¢ç»“æœç›¸å…³æ€§çš„åŒæ—¶ï¼Œæœ‰æ•ˆåœ°æé«˜äº†æœç´¢å®¹é”™èƒ½åŠ›ã€‚ ç¼–è¾‘è·ç¦»æ˜¯æŒ‡ä»ä¸€ä¸ªå•è¯è½¬æ¢åˆ°å¦ä¸€ä¸ªå•è¯éœ€è¦ç¼–è¾‘å•å­—ç¬¦çš„æ¬¡æ•°ã€‚å¦‚ä¸­æ–‡é›†å›¢åˆ°ä¸­å¨é›†å›¢ç¼–è¾‘è·ç¦»å°±æ˜¯1ï¼Œåªéœ€è¦ä¿®æ”¹ä¸€ä¸ªå­—ç¬¦ï¼›å¦‚æœfuzzinesså€¼åœ¨è¿™é‡Œè®¾ç½®æˆ2ï¼Œä¼šæŠŠç¼–è¾‘è·ç¦»ä¸º2çš„ä¸œä¸œé›†å›¢ä¹ŸæŸ¥å‡ºæ¥ã€‚ 123456789101112131415curl -X GET -u elastic:123456 -k &#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27; \\ -H &#x27;Content-Type: application/json&#x27; \\ -d &#x27;&#123; &quot;query&quot;:&#123; &quot;fuzzy&quot;:&#123; &quot;category&quot;:&#123; &quot;value&quot;:&quot;beeks&quot;, &quot;fuzziness&quot;:&quot;2&quot;, &quot;prefix_length&quot;:1 &#125; &#125; &#125; &#125;&#x27;# fuzzinessï¼šç”¨äºç¼–è¾‘è·ç¦»çš„è®¾ç½®ï¼Œå…¶é»˜è®¤å€¼ä¸ºAUTOï¼Œæ”¯æŒçš„æ•°å€¼ä¸º[0ï¼Œ1ï¼Œ2]ã€‚å¦‚æœå€¼è®¾ç½®è¶Šç•Œä¼šæŠ¥é”™ã€‚# prefix_length: æœç´¢è¯çš„å‰ç¼€é•¿åº¦ï¼Œåœ¨æ­¤é•¿åº¦å†…ä¸ä¼šåº”ç”¨æ¨¡ç³ŠåŒ¹é…ã€‚é»˜è®¤æ˜¯0ï¼Œå³æ•´ä¸ªè¯éƒ½ä¼šè¢«æ¨¡ç³ŠåŒ¹é…ã€‚ match: å…¨æ–‡æ£€ç´¢(å³åˆ†è¯) 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182curl -X GET -u elastic:123456 -k &#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27; \\ -H &#x27;Content-Type: application/json&#x27; \\ -d &#x27;&#123;&quot;query&quot;:&#123;&quot;match&quot;:&#123;&quot;address&quot;:&quot;å¹¿å·ç™½äº‘å±±å…¬å›­&quot;&#125;&#125;&#125;&#x27;# å› ä¸º desc çš„ç´¢å¼•åˆ†è¯å™¨æ˜¯ ik_max_wordï¼ŒæŸ¥çœ‹â€œå¹¿å·ç™½äº‘å±±å…¬å›­â€è¢«åˆ†è¯åçš„ç»“æœcurl -X GET -u elastic:123456 -k &#x27;https://127.0.0.1:9200/_analyze?pretty&#x27; \\ -H &#x27;Content-Type: application/json&#x27; \\ -d &#x27;&#123; &quot;analyzer&quot;: &quot;ik_max_word&quot;, &quot;text&quot;: &quot;å¹¿å·ç™½äº‘å±±å…¬å›­&quot; &#125;&#x27;# è¿”å›å€¼&#123; &quot;tokens&quot; : [ &#123; &quot;token&quot; : &quot;å¹¿å·&quot;, &quot;start_offset&quot; : 0, &quot;end_offset&quot; : 2, &quot;type&quot; : &quot;CN_WORD&quot;, &quot;position&quot; : 0 &#125;, &#123; &quot;token&quot; : &quot;ç™½äº‘å±±&quot;, &quot;start_offset&quot; : 2, &quot;end_offset&quot; : 5, &quot;type&quot; : &quot;CN_WORD&quot;, &quot;position&quot; : 1 &#125;, &#123; &quot;token&quot; : &quot;ç™½äº‘&quot;, &quot;start_offset&quot; : 2, &quot;end_offset&quot; : 4, &quot;type&quot; : &quot;CN_WORD&quot;, &quot;position&quot; : 2 &#125;, &#123; &quot;token&quot; : &quot;äº‘å±±&quot;, &quot;start_offset&quot; : 3, &quot;end_offset&quot; : 5, &quot;type&quot; : &quot;CN_WORD&quot;, &quot;position&quot; : 3 &#125;, &#123; &quot;token&quot; : &quot;å…¬å›­&quot;, &quot;start_offset&quot; : 5, &quot;end_offset&quot; : 7, &quot;type&quot; : &quot;CN_WORD&quot;, &quot;position&quot; : 4 &#125; ]&#125;# æ‰€ä»¥åªè¦descä¸­åŒ…å«å¦‚ä¸Šè¿™äº›å†…å®¹çš„æ•°æ®éƒ½ä¼šè¢«åŒ¹é…ä¸Š# ä½†æ˜¯è¿™æ ·åŒ¹é…çš„ç»“æœå°±ä¸å¤Ÿç²¾ç¡®ï¼Œå¦‚ä½•å°½é‡åŒ¹é…æ›´å¤šçš„åˆ†è¯å‘¢ï¼Œå¯ä»¥å¢åŠ  minimum_should_matchcurl -X GET -u elastic:123456 -k &#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27; \\ -H &#x27;Content-Type: application/json&#x27; \\ -d &#x27;&#123; &quot;query&quot;:&#123; &quot;match&quot;:&#123; &quot;address&quot;:&#123; &quot;query&quot;: &quot;å¹¿å·ç™½äº‘å±±å…¬å›­&quot;, &quot;minimum_should_match&quot;: 2 &#125; &#125; &#125; &#125;&#x27;# minimum_should_match: 2 è¡¨ç¤ºè‡³å°‘åŒ¹é…ä¸¤ä¸ª# å¦‚æœå¸Œæœ›å…¨éƒ¨éƒ½åŒ¹é…å‘¢curl -X GET -u elastic:123456 -k &#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27; \\ -H &#x27;Content-Type: application/json&#x27; \\ -d &#x27;&#123; &quot;query&quot;:&#123; &quot;match&quot;:&#123; &quot;address&quot;:&#123; &quot;query&quot;: &quot;å¹¿å·ç™½äº‘å±±å…¬å›­&quot;, &quot;operator&quot;: &quot;and&quot; &#125; &#125; &#125; &#125;&#x27;# operator: and è¡¨ç¤ºå…¨éƒ¨åŒ¹é…ï¼Œæ­¤æ—¶ç›¸å½“äºç²¾ç¡®åŒ¹é…ï¼Œå…¶é»˜è®¤å€¼æ˜¯ or multi_match: å¤šå­—æ®µæŸ¥è¯¢ multi_matchæŸ¥è¯¢åœ¨Elasticsearchä¸­ç”¨äºåœ¨å¤šä¸ªå­—æ®µä¸Šæ‰§è¡Œç›¸åŒçš„æœç´¢æ“ä½œã€‚å®ƒå¯ä»¥æ¥å—ä¸€ä¸ªæŸ¥è¯¢å­—ç¬¦ä¸²ï¼Œå¹¶åœ¨æŒ‡å®šçš„å­—æ®µé›†åˆä¸­æœç´¢è¿™ä¸ªå­—ç¬¦ä¸²ã€‚multi_matchæŸ¥è¯¢æä¾›äº†çµæ´»çš„åŒ¹é…ç±»å‹å’Œæ“ä½œç¬¦é€‰é¡¹ï¼Œä»¥ä¾¿æ ¹æ®ä¸åŒçš„æœç´¢éœ€æ±‚è°ƒæ•´æœç´¢è¡Œä¸ºã€‚ 123456789101112curl -X GET -u elastic:123456 -k &#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27; \\ -H &#x27;Content-Type: application/json&#x27; \\ -d &#x27;&#123; &quot;query&quot;:&#123; &quot;multi_match&quot;:&#123; &quot;query&quot;: &quot;å¹¿å·shirt&quot;, &quot;fields&quot;:[&quot;title&quot;,&quot;address&quot;] &#125; &#125; &#125;&#x27;# query: æŸ¥è¯¢æ¡ä»¶# fields: æŒ‡å®šå¤šä¸ªå­—æ®µè¿›è¡ŒåŒ¹é… match_phrase: çŸ­è¯­æŸ¥è¯¢ match_phraseæŸ¥è¯¢åœ¨Elasticsearchä¸­ç”¨äºæ‰§è¡ŒçŸ­è¯­æœç´¢ï¼Œå®ƒä¸ä»…åŒ¹é…æ•´ä¸ªçŸ­è¯­ï¼Œè€Œä¸”è¿˜è€ƒè™‘äº†çŸ­è¯­ä¸­å„ä¸ªè¯çš„é¡ºåºå’Œä½ç½®ã€‚è¿™ç§æŸ¥è¯¢ç±»å‹å¯¹äºæœç´¢ç²¾ç¡®çŸ­è¯­éå¸¸æœ‰ç”¨ï¼Œå°¤å…¶æ˜¯åœ¨ç”¨æˆ·è¾“å…¥çš„æŸ¥è¯¢ä¸æ–‡æ¡£ä¸­çš„æ–‡æœ¬è¡¨è¾¾æ–¹å¼éœ€è¦ä¸¥æ ¼åŒ¹é…æ—¶ã€‚ 123456789101112curl -X GET -u elastic:123456 -k &#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27; \\ -H &#x27;Content-Type: application/json&#x27; \\ -d &#x27;&#123; &quot;query&quot;:&#123; &quot;match_phrase&quot;:&#123; &quot;address&quot;:&#123; &quot;query&quot;:&quot;å¹¿å·ç™½äº‘å±±&quot; &#125; &#125; &#125; &#125;&#x27;# è¦æ±‚æŸ¥è¯¢ç»“æœä¸­çš„æ•°æ®å¿…é¡»åŒ…å«&quot;å¹¿å·ç™½äº‘å±±&quot;ï¼Œè€Œä¸”â€œå¹¿å·â€å’Œâ€œç™½äº‘å±±â€è¿™ä¸¤ä¸ªè¯æ˜¯ä¸èƒ½åˆ†å¼€çš„ï¼Œå› ä¸º match_phrase åŒ¹é…çš„æ˜¯ç›¸é‚»è¯æ¡ query_string: æ”¯æŒä¸æˆ–éè¡¨è¾¾å¼çš„æŸ¥è¯¢ query_stringæŸ¥è¯¢æ˜¯ä¸€ç§çµæ´»çš„æŸ¥è¯¢ç±»å‹ï¼Œå®ƒå…è®¸ä½¿ç”¨LuceneæŸ¥è¯¢è¯­æ³•æ¥æ„å»ºå¤æ‚çš„æœç´¢æŸ¥è¯¢ã€‚è¿™ç§æŸ¥è¯¢ç±»å‹æ”¯æŒå¤šç§é€»è¾‘è¿ç®—ç¬¦ï¼ŒåŒ…æ‹¬ä¸ï¼ˆANDï¼‰ã€æˆ–ï¼ˆORï¼‰å’Œéï¼ˆNOTï¼‰ï¼Œä»¥åŠé€šé…ç¬¦ã€æ¨¡ç³Šæœç´¢å’Œæ­£åˆ™è¡¨è¾¾å¼ç­‰åŠŸèƒ½ã€‚query_stringæŸ¥è¯¢å¯ä»¥åœ¨å•ä¸ªæˆ–å¤šä¸ªå­—æ®µä¸Šè¿›è¡Œæœç´¢ï¼Œå¹¶ä¸”å¯ä»¥å¤„ç†å¤æ‚çš„æŸ¥è¯¢é€»è¾‘ã€‚ æ³¨æ„: æŸ¥è¯¢å­—æ®µåˆ†è¯å°±å°†æŸ¥è¯¢æ¡ä»¶åˆ†è¯æŸ¥è¯¢ï¼ŒæŸ¥è¯¢å­—æ®µä¸åˆ†è¯å°†æŸ¥è¯¢æ¡ä»¶ä¸åˆ†è¯æŸ¥è¯¢ 12345678910111213141516171819202122232425262728293031323334# æŸ¥è¯¢æ‰€æœ‰å­—æ®µä¸­åŒ…å« &quot;å…¬å›­&quot;å’Œ &quot;åä¸º&quot; çš„æ–‡æ¡£curl -X GET -u elastic:123456 -k &#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27; \\ -H &#x27;Content-Type: application/json&#x27; \\ -d &#x27;&#123; &quot;query&quot;:&#123; &quot;query_string&quot;:&#123; &quot;query&quot;:&quot;å…¬å›­ AND electronics&quot; &#125; &#125; &#125;&#x27;# æŒ‡å®šæŸ¥è¯¢çš„å•ä¸ªå­—æ®µcurl -X GET -u elastic:123456 -k &#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27; \\ -H &#x27;Content-Type: application/json&#x27; \\ -d &#x27;&#123; &quot;query&quot;:&#123; &quot;query_string&quot;:&#123; &quot;default_field&quot;:&quot;category&quot;, &quot;query&quot;:&quot;ç™½äº‘å±± OR books&quot; &#125; &#125; &#125;&#x27;# æŒ‡å®šæŸ¥è¯¢çš„å¤šä¸ªå­—æ®µcurl -X GET -u elastic:123456 -k &#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27; \\ -H &#x27;Content-Type: application/json&#x27; \\ -d &#x27;&#123; &quot;query&quot;:&#123; &quot;query_string&quot;:&#123; &quot;fields&quot;:[&quot;category&quot;,&quot;address&quot;], &quot;query&quot;:&quot;ç™½äº‘å±± OR (electronics AND shirt)&quot; &#125; &#125; &#125;&#x27; simple_query_string: ç±»ä¼¼ query_stringï¼Œä½†æ˜¯ä¼šå¿½ç•¥é”™è¯¯çš„è¯­æ³•ï¼ŒåŒæ—¶åªæ”¯æŒéƒ¨åˆ†æŸ¥è¯¢è¯­æ³• 1234567891011curl -X GET -u elastic:123456 -k &#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27; \\ -H &#x27;Content-Type: application/json&#x27; \\ -d &#x27;&#123; &quot;query&quot;:&#123; &quot;simple_query_string&quot;:&#123; &quot;query&quot;:&quot;å¹¿å·å…¬å›­&quot;, &quot;default_operator&quot;:&quot;AND&quot; &#125; &#125; &#125;&#x27;# default_operator: é»˜è®¤ä¸º ORï¼Œè®¾ç½®ä¸º AND åˆ™å¿…é¡»åŒæ—¶åŒ¹é… ESæŸ¥è¯¢ç»“æœå±æ€§å«ä¹‰ 123456789101112131415161718&#123; &quot;took&quot;:16, # è¡¨ç¤ºæŸ¥è¯¢ä»è¯·æ±‚åˆ°å®Œæˆè€—æ—¶ 16 æ¯«ç§’ã€‚ &quot;timed_out&quot;:false, # è¡¨ç¤ºæŸ¥è¯¢åœ¨è§„å®šçš„æ—¶é—´å†…å®Œæˆï¼Œæ²¡æœ‰å‘ç”Ÿè¶…æ—¶ã€‚å¦‚æœä¸º trueï¼Œåˆ™è¡¨ç¤ºæŸ¥è¯¢è¶…æ—¶ã€‚ &quot;_shards&quot;:&#123; # æ¶‰åŠåˆ°æŸ¥è¯¢è¿‡ç¨‹ä¸­ä½¿ç”¨çš„åˆ†ç‰‡ä¿¡æ¯ &quot;total&quot;:1, # è¡¨ç¤ºæŸ¥è¯¢æ¶‰åŠåˆ°çš„æ€»åˆ†ç‰‡æ•°ä¸º 1 &quot;successful&quot;:1, # è¡¨ç¤ºæŸ¥è¯¢æˆåŠŸå®Œæˆçš„åˆ†ç‰‡æ•°ä¸º 1 &quot;skipped&quot;:0, # è¡¨ç¤ºæŸ¥è¯¢è¿‡ç¨‹ä¸­è¢«è·³è¿‡çš„åˆ†ç‰‡æ•°ä¸º 0 &quot;failed&quot;:0 # è¡¨ç¤ºæŸ¥è¯¢è¿‡ç¨‹ä¸­å¤±è´¥çš„åˆ†ç‰‡æ•°ä¸º 0 &#125;, &quot;hits&quot;:&#123; # åŒ…å«æŸ¥è¯¢ç»“æœçš„è¯¦ç»†ä¿¡æ¯ &quot;total&quot;:&#123; # åŒ…å«æŸ¥è¯¢ç»“æœçš„æ€»æ•° &quot;value&quot;:4, # è¡¨ç¤ºæŸ¥è¯¢ç»“æœçš„æ€»æ•°ä¸º 4 &quot;relation&quot;:&quot;eq&quot; # è¡¨ç¤ºè¿”å›çš„æ€»æ•° value æ˜¯ç¡®åˆ‡çš„ï¼ˆequalï¼‰ã€‚å¦‚æœä¸º gteï¼Œåˆ™è¡¨ç¤ºè¿”å›çš„æ€»æ•°æ˜¯ä¸€ä¸ªä¸‹é™å€¼ã€‚ &#125;, &quot;max_score&quot;:0.0, # è¡¨ç¤ºåŒ¹é…åˆ°çš„æ–‡æ¡£ä¸­æœ€é«˜çš„å¾—åˆ†ã€‚å¦‚æœæ˜¯æ’åºæŸ¥è¯¢ï¼Œè¿™ä¸ªå€¼ä¼šæœ‰æ„ä¹‰ã€‚å½“å‰ç»“æœå› ä¸º size: 0ï¼Œæ²¡æœ‰å®é™…è¿”å›æ–‡æ¡£ï¼Œæ‰€ä»¥å¾—åˆ†ä¸º 0.0 &quot;hits&quot;:[ ] # åŒ…å«æŸ¥è¯¢ç»“æœçš„åˆ—è¡¨ï¼Œæ¯ä¸ªç»“æœéƒ½æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼ŒåŒ…å«æ–‡æ¡£çš„å…ƒæ•°æ®ï¼Œå¦‚ idã€åˆ†æ•°ç­‰ã€‚ &#125;&#125; bool æŸ¥è¯¢ å¸ƒå°”æŸ¥è¯¢å¯ä»¥æŒ‰ç…§å¸ƒå°”é€»è¾‘æ¡ä»¶ç»„ç»‡å¤šæ¡æŸ¥è¯¢è¯­å¥ï¼Œåªæœ‰ç¬¦åˆæ•´ä¸ªå¸ƒå°”æ¡ä»¶çš„æ–‡æ¡£æ‰ä¼šè¢«æœç´¢å‡ºæ¥ã€‚ åœ¨å¸ƒå°”æ¡ä»¶ä¸­ï¼Œå¯ä»¥åŒ…å«ä¸¤ç§ä¸åŒçš„ä¸Šä¸‹æ–‡ã€‚ 1.æœç´¢ä¸Šä¸‹æ–‡(query context)ï¼šä½¿ç”¨æœç´¢ä¸Šä¸‹æ–‡æ—¶ï¼ŒElasticsearchéœ€è¦è®¡ç®—æ¯ä¸ªæ–‡æ¡£ä¸æœç´¢æ¡ä»¶çš„ç›¸å…³åº¦å¾—åˆ†ï¼Œè¿™ä¸ªå¾—åˆ†çš„è®¡ç®—éœ€ä½¿ç”¨ä¸€å¥—å¤æ‚çš„è®¡ç®—å…¬å¼ï¼Œæœ‰ä¸€å®šçš„æ€§èƒ½å¼€é”€ï¼Œå¸¦æ–‡æœ¬åˆ†æçš„å…¨æ–‡æ£€ç´¢çš„æŸ¥è¯¢è¯­å¥å¾ˆé€‚åˆæ”¾åœ¨æœç´¢ä¸Šä¸‹æ–‡ä¸­ã€‚ 2.è¿‡æ»¤ä¸Šä¸‹æ–‡(filter context)ï¼šä½¿ç”¨è¿‡æ»¤ä¸Šä¸‹æ–‡æ—¶ï¼ŒElasticsearchåªéœ€è¦åˆ¤æ–­æœç´¢æ¡ä»¶è·Ÿæ–‡æ¡£æ•°æ®æ˜¯å¦åŒ¹é…ï¼Œä¾‹å¦‚ä½¿ç”¨Term queryåˆ¤æ–­ä¸€ä¸ªå€¼æ˜¯å¦è·Ÿæœç´¢å†…å®¹ä¸€è‡´ï¼Œä½¿ç”¨Range queryåˆ¤æ–­æŸæ•°æ®æ˜¯å¦ä½äºæŸä¸ªåŒºé—´ç­‰ã€‚è¿‡æ»¤ä¸Šä¸‹æ–‡çš„æŸ¥è¯¢ä¸éœ€è¦è¿›è¡Œç›¸å…³åº¦å¾—åˆ†è®¡ç®—ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ç¼“å­˜åŠ å¿«å“åº”é€Ÿåº¦ï¼Œå¾ˆå¤šæœ¯è¯­çº§æŸ¥è¯¢è¯­å¥éƒ½é€‚åˆæ”¾åœ¨è¿‡æ»¤ä¸Šä¸‹æ–‡ä¸­ã€‚ bool æŸ¥è¯¢åŒ…å« mustã€must_notã€shouldã€filter å››ç§å­å¥ã€‚ ç±»å‹ è¯´æ˜ must å¯åŒ…å«å¤šä¸ªæŸ¥è¯¢æ¡ä»¶ï¼Œæ¯ä¸ªæ¡ä»¶å‡æ»¡è¶³çš„æ–‡æ¡£æ‰èƒ½è¢«æœç´¢åˆ°ï¼Œæ¯æ¬¡æŸ¥è¯¢éœ€è¦è®¡ç®—ç›¸å…³åº¦å¾—åˆ†ï¼Œå±äºæœç´¢ä¸Šä¸‹æ–‡ should å¯åŒ…å«å¤šä¸ªæŸ¥è¯¢æ¡ä»¶ï¼Œä¸å­˜åœ¨mustå’Œfiteræ¡ä»¶æ—¶ï¼Œè‡³å°‘è¦æ»¡è¶³å¤šä¸ªæŸ¥è¯¢æ¡ä»¶ä¸­çš„ä¸€ä¸ªï¼Œæ–‡æ¡£æ‰èƒ½è¢«æœç´¢åˆ°ï¼Œå¦åˆ™éœ€æ»¡è¶³çš„æ¡ä»¶æ•°é‡ä¸å—é™åˆ¶,åŒ¹é…åˆ°çš„æŸ¥è¯¢è¶Šå¤šç›¸å…³åº¦è¶Šé«˜ï¼Œä¹Ÿå±äºæœç´¢ä¸Šä¸‹æ–‡ filter å¯åŒ…å«å¤šä¸ªè¿‡æ»¤æ¡ä»¶ï¼Œæ¯ä¸ªæ¡ä»¶å‡æ»¡è¶³çš„æ–‡æ¡£æ‰èƒ½è¢«æœç´¢åˆ°ï¼Œæ¯ä¸ªè¿‡æ»¤æ¡ä»¶ä¸è®¡ç®—ç›¸å…³åº¦å¾—åˆ†ï¼Œç»“æœåœ¨ä¸€å®šæ¡ä»¶ä¸‹ä¼šè¢«ç¼“å­˜ï¼Œ å±äºè¿‡æ»¤ä¸Šä¸‹æ–‡ must_not å¯åŒ…å«å¤šä¸ªè¿‡æ»¤æ¡ä»¶ï¼Œæ¯ä¸ªæ¡ä»¶å‡ä¸æ»¡è¶³çš„æ–‡æ¡£æ‰èƒ½è¢«æœç´¢åˆ°ï¼Œæ¯ä¸ªè¿‡æ»¤æ¡ä»¶ä¸è®¡ç®—ç›¸å…³åº¦å¾—åˆ†ï¼Œç»“æœåœ¨ä¸€å®šæ¡ä»¶ä¸‹ä¼šè¢«ç¼“å­˜ï¼Œ å±äºè¿‡æ»¤ä¸Šä¸‹æ–‡ must 12345678910111213# ä¸¤ä¸ªæ¡ä»¶éƒ½éœ€è¦æ»¡è¶³curl -X GET -u elastic:123456 -k &#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27; \\ -H &#x27;Content-Type: application/json&#x27; \\ -d &#x27;&#123; &quot;query&quot;:&#123; &quot;bool&quot;:&#123; &quot;must&quot;:[ &#123;&quot;match&quot;:&#123;&quot;category&quot;:&quot;electronics&quot;&#125;&#125;, &#123;&quot;match&quot;:&#123;&quot;desc&quot;:&quot;å…¬å›­&quot;&#125;&#125; ] &#125; &#125; &#125;&#x27; must_not 12345678910111213# ä¸¤ä¸ªæ¡ä»¶éƒ½ä¸æ»¡è¶³curl -X GET -u elastic:123456 -k &#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27; \\ -H &#x27;Content-Type: application/json&#x27; \\ -d &#x27;&#123; &quot;query&quot;:&#123; &quot;bool&quot;:&#123; &quot;must_not&quot;:[ &#123;&quot;match&quot;:&#123;&quot;category&quot;:&quot;electronics&quot;&#125;&#125;, &#123;&quot;match&quot;:&#123;&quot;desc&quot;:&quot;å…¬å›­&quot;&#125;&#125; ] &#125; &#125; &#125;&#x27; should 12345678910111213# ä¸¤ä¸ªæ¡ä»¶æ»¡è¶³ä¸€ä¸ªå³å¯curl -X GET -u elastic:123456 -k &#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27; \\ -H &#x27;Content-Type: application/json&#x27; \\ -d &#x27;&#123; &quot;query&quot;:&#123; &quot;bool&quot;:&#123; &quot;should&quot;:[ &#123;&quot;match&quot;:&#123;&quot;category&quot;:&quot;electronics&quot;&#125;&#125;, &#123;&quot;match&quot;:&#123;&quot;desc&quot;:&quot;å…¬å›­&quot;&#125;&#125; ] &#125; &#125; &#125;&#x27; filter 12345678910111213# filterä¸­çš„æ¡ä»¶ä¸ºé matchï¼Œå³ä¸èƒ½æ˜¯å…¨æ–‡æ£€ç´¢curl -X GET -u elastic:123456 -k &#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27; \\ -H &#x27;Content-Type: application/json&#x27; \\ -d &#x27;&#123; &quot;query&quot;:&#123; &quot;bool&quot;:&#123; &quot;filter&quot;:[ &#123;&quot;term&quot;:&#123;&quot;category&quot;:&quot;electronics&quot;&#125;&#125;, &#123;&quot;range&quot;:&#123;&quot;price&quot;:&#123;&quot;gte&quot;:20&#125;&#125;&#125; ] &#125; &#125; &#125;&#x27; åˆ†é¡µä¸æ’åº 1234567891011# from: ä»ç¬¬å‡ æ¡å¼€å§‹ï¼Œé»˜è®¤0# size: å–å¤šå°‘æ¡# sort: æ’åºï¼Œé»˜è®¤ä¸ºæŒ‰æ–‡æ¡£idå‡åºcurl -X GET -u elastic:123456 -k &#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27; \\ -H &#x27;Content-Type: application/json&#x27; \\ -d &#x27;&#123; &quot;query&quot;:&#123;&quot;range&quot;:&#123;&quot;price&quot;:&#123;&quot;gte&quot;:20,&quot;lte&quot;:30&#125;&#125;&#125;, &quot;sort&quot;:[&#123;&quot;price&quot;:&quot;address&quot;&#125;], &quot;from&quot;:0, &quot;size&quot;:5 &#125;&#x27; åªè¿”å›éƒ¨åˆ†å­—æ®µ 1234567# _source: æŒ‡å®šè¦è¿”å›çš„å­—æ®µåˆ—è¡¨curl -X GET -u elastic:123456 -k &#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27; \\ -H &#x27;Content-Type: application/json&#x27; \\ -d &#x27; &#123;&quot;query&quot;:&#123;&quot;range&quot;:&#123;&quot;price&quot;:&#123;&quot;gte&quot;:20,&quot;lte&quot;:30&#125;&#125;&#125;, &quot;_source&quot;:[&quot;category&quot;,&quot;title&quot;,&quot;price&quot;] &#125;&#x27; é«˜äº®æ˜¾ç¤º 123456789101112131415161718# é«˜äº®æ˜¾ç¤ºä»…æ”¯æŒå…¨æ–‡æ£€ç´¢å­—æ®µcurl -X GET -u elastic:123456 -k &#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27; \\ -H &#x27;Content-Type: application/json&#x27; \\ -d &#x27;&#123; &quot;query&quot;: &#123; &quot;multi_match&quot;: &#123; &quot;fields&quot;: [&quot;title&quot;,&quot;address&quot;], &quot;query&quot;: &quot;å…¬å›­shirt&quot; &#125; &#125;, &quot;highlight&quot;: &#123; &quot;post_tags&quot;: [&quot;&lt;/span&gt;&quot;], &quot;pre_tags&quot;: [&quot;&lt;span style=&#x27;color:red&#x27;&gt;&quot;], &quot;fields&quot;: &#123; &quot;*&quot;:&#123;&#125; &#125; &#125; &#125;&#x27; åœ°ç†ç©ºé—´ä½ç½®æŸ¥è¯¢ åœ°ç†ç©ºé—´ä½ç½®æŸ¥è¯¢æ˜¯æ•°æ®åº“å’Œæœç´¢ç³»ç»Ÿä¸­çš„ä¸€ä¸ªé‡è¦ç‰¹æ€§ï¼Œç‰¹åˆ«æ˜¯åœ¨åœ°ç†ä¿¡æ¯ç³»ç»Ÿï¼ˆGISï¼‰å’Œä½ç½®æœåŠ¡ä¸­ã€‚å®ƒå…è®¸ç”¨æˆ·åŸºäºåœ°ç†ä½ç½®ä¿¡æ¯æ¥æœç´¢å’Œè¿‡æ»¤æ•°æ®ã€‚åœ¨Elasticsearchè¿™æ ·çš„å…¨æ–‡æœç´¢å¼•æ“ä¸­ï¼Œåœ°ç†ç©ºé—´ä½ç½®æŸ¥è¯¢è¢«å¹¿æ³›åº”ç”¨ï¼Œä¾‹å¦‚åœ¨æ—…è¡Œã€æˆ¿åœ°äº§ã€ç‰©æµå’Œé›¶å”®ç­‰è¡Œä¸šï¼Œç”¨äºæä¾›åŸºäºä½ç½®çš„æœç´¢åŠŸèƒ½ã€‚ åœ¨Elasticsearchä¸­ï¼Œåœ°ç†ç©ºé—´æ•°æ®é€šå¸¸å­˜å‚¨åœ¨geo_pointå­—æ®µç±»å‹ä¸­ã€‚è¿™ç§å­—æ®µç±»å‹å¯ä»¥å­˜å‚¨çº¬åº¦å’Œç»åº¦åæ ‡ï¼Œç”¨äºè¡¨ç¤ºåœ°çƒä¸Šçš„ä¸€ä¸ªç‚¹ã€‚ ç¤ºä¾‹ åˆ›å»ºä¸€ä¸ªç´¢å¼•ï¼Œå¹¶æ·»åŠ ä¸€ä¸ªgeo_pointå­—æ®µï¼š 12345678910111213141516curl -X PUT -u elastic:123456 -k &#x27;https://127.0.0.1:9200/tourist_spots&#x27; \\ -H &#x27;Content-Type: application/json&#x27; \\ -d &#x27;&#123; &quot;mappings&quot;: &#123; &quot;properties&quot;: &#123; &quot;name&quot;: &#123; &quot;type&quot;: &quot;text&quot;, &quot;analyzer&quot;: &quot;ik_max_word&quot;, &quot;search_analyzer&quot;: &quot;ik_max_word&quot; &#125;, &quot;location&quot;: &#123; &quot;type&quot;: &quot;geo_point&quot; &#125; &#125; &#125; &#125;&#x27; æ’å…¥æ•°æ® 1234567891011curl -X POST -u elastic:123456 -k &#x27;https://127.0.0.1:9200/tourist_spots/_bulk&#x27; \\ -H &#x27;Content-Type: application/json&#x27; \\ -d &#x27;&#123;&quot;index&quot;:&#123;&#125;&#125;&#123;&quot;name&quot;:&quot;é›·å³°å¡”&quot;,&quot;location&quot;:&#123;&quot;lat&quot;:30.2615,&quot;lon&quot;:120.1480&#125;&#125;&#123;&quot;index&quot;:&#123;&#125;&#125;&#123;&quot;name&quot;:&quot;è¥¿æ¹–&quot;,&quot;location&quot;:&#123;&quot;lat&quot;:30.2614,&quot;lon&quot;:120.1479&#125;&#125;&#123;&quot;index&quot;:&#123;&#125;&#125;&#123;&quot;name&quot;:&quot;è‹å ¤æ˜¥æ™“&quot;,&quot;location&quot;:&#123;&quot;lat&quot;:30.2624,&quot;lon&quot;:120.1708&#125;&#125;&#x27;# lat: çº¬åº¦# lon: ç»åº¦ æŸ¥è¯¢æ•°æ® 12345678910111213141516171819202122232425262728293031# æŸ¥è¯¢æ­å·è¥¿æ¹–5kmé™„è¿‘çš„æ™¯ç‚¹# é›·å³°å¡” - ä½äºè¥¿æ¹–é™„è¿‘ï¼Œè·ç¦»çº¦2.8å…¬é‡Œã€‚# è‹å ¤æ˜¥æ™“ - ä½äºè¥¿æ¹–è¾¹ï¼Œè·ç¦»è¥¿æ¹–ä¸­å¿ƒçº¦1å…¬é‡Œã€‚curl -X GET -u elastic:123456 -k &#x27;https://127.0.0.1:9200/tourist_spots/_search?pretty&#x27; \\ -H &#x27;Content-Type: application/json&#x27; \\ -d &#x27;&#123; &quot;query&quot;: &#123; &quot;bool&quot;: &#123; &quot;must&quot;: &#123; &quot;match_all&quot;: &#123;&#125; &#125;, &quot;filter&quot;: &#123; &quot;geo_distance&quot;: &#123; &quot;distance&quot;: &quot;5km&quot;, &quot;distance_type&quot;: &quot;arc&quot;, &quot;location&quot;: &#123; &quot;lat&quot;: 30.2614, &quot;lon&quot;: 120.1479 &#125; &#125; &#125; &#125; &#125; &#125;&#x27;# distance: 5km è¡¨ç¤ºè·ç¦»ä¸º5å…¬é‡Œ# distance_type: arc, plane, sloppy_arc, # arc: é»˜è®¤å€¼ï¼Œä½¿ç”¨haversineå…¬å¼è®¡ç®—è·ç¦»ï¼Œç»“æœæ˜¯ç²¾ç¡®çš„ï¼Œä½†è®¡ç®—é€Ÿåº¦è¾ƒæ…¢ã€‚ # plane: ä½¿ç”¨å¹³é¢ç›´è§’åæ ‡ç³»è®¡ç®—è·ç¦»ï¼Œç»“æœæ˜¯ç²—ç•¥çš„ï¼Œä½†è®¡ç®—é€Ÿåº¦æ›´å¿«ã€‚ # sloppy_arc: ä½¿ç”¨haversineå…¬å¼è®¡ç®—è·ç¦»ï¼Œä½†å…è®¸è¯¯å·®ã€‚# location: æœç´¢æ¡ä»¶ å‘é‡æœç´¢ Elasticsearch 8.x å¼•å…¥äº†ä¸€ä¸ªé‡è¦çš„æ–°ç‰¹æ€§ï¼šå‘é‡æ£€ç´¢ï¼ˆVector Searchï¼‰ï¼Œç‰¹åˆ«æ˜¯é€šè¿‡KNNï¼ˆK-Nearest Neighborsï¼‰ç®—æ³•æ”¯æŒå‘é‡è¿‘é‚»æ£€ç´¢ã€‚è¿™ä¸€ç‰¹æ€§ä½¿å¾—Elasticsearchåœ¨æœºå™¨å­¦ä¹ ã€æ•°æ®åˆ†æå’Œæ¨èç³»ç»Ÿç­‰é¢†åŸŸçš„åº”ç”¨å˜å¾—æ›´åŠ å¹¿æ³›å’Œå¼ºå¤§ã€‚ å‘é‡æ£€ç´¢çš„åŸºæœ¬æ€è·¯æ˜¯ï¼Œå°†æ–‡æ¡£ï¼ˆæˆ–æ•°æ®é¡¹ï¼‰è¡¨ç¤ºä¸ºé«˜ç»´å‘é‡ï¼Œå¹¶ä½¿ç”¨è¿™äº›å‘é‡æ¥æ‰§è¡Œç›¸ä¼¼æ€§æœç´¢ã€‚åœ¨Elasticsearchä¸­ï¼Œè¿™äº›å‘é‡è¢«å­˜å‚¨åœ¨dense_vectorç±»å‹çš„å­—æ®µä¸­ï¼Œç„¶åä½¿ç”¨KNNç®—æ³•æ¥æ‰¾åˆ°ä¸ç»™å®šå‘é‡æœ€ç›¸ä¼¼çš„å…¶ä»–å‘é‡ã€‚ ç¤ºä¾‹ åˆ›å»ºç´¢å¼• 12345678910111213141516171819202122curl -X PUT -u elastic:123456 -k &#x27;https://127.0.0.1:9200/image-index&#x27; \\ -H &#x27;Content-Type: application/json&#x27; \\ -d &#x27;&#123; &quot;mappings&quot;: &#123; &quot;properties&quot;: &#123; &quot;image-vector&quot;: &#123; &quot;type&quot;: &quot;dense_vector&quot;, &quot;dims&quot;: 3 &#125;, &quot;title&quot;: &#123; &quot;type&quot;: &quot;text&quot; &#125;, &quot;file-type&quot;: &#123; &quot;type&quot;: &quot;keyword&quot; &#125;, &quot;my_label&quot;: &#123; &quot;type&quot;: &quot;text&quot; &#125; &#125; &#125; &#125;&#x27;# dims: 3 è¡¨ç¤º3ç»´å‘é‡ï¼Œæœ€é«˜æ”¯æŒ2048 æ·»åŠ æ•°æ® 123456789curl -X POST -u elastic:123456 -k &#x27;https://127.0.0.1:9200/image-index/_bulk&#x27; \\ -H &#x27;Content-Type: application/json&#x27; \\ -d &#x27;&#123; &quot;index&quot;: &#123;&#125; &#125;&#123; &quot;image-vector&quot;: [-5, 9, -12], &quot;title&quot;: &quot;Image A&quot;, &quot;file-type&quot;: &quot;jpeg&quot;, &quot;my_label&quot;: &quot;red&quot; &#125;&#123; &quot;index&quot;: &#123;&#125; &#125;&#123; &quot;image-vector&quot;: [10, -2, 3], &quot;title&quot;: &quot;Image B&quot;, &quot;file-type&quot;: &quot;png&quot;, &quot;my_label&quot;: &quot;blue&quot; &#125;&#123; &quot;index&quot;: &#123;&#125; &#125;&#123; &quot;image-vector&quot;: [4, 0, -1], &quot;title&quot;: &quot;Image C&quot;, &quot;file-type&quot;: &quot;gif&quot;, &quot;my_label&quot;: &quot;red&quot; &#125;&#x27; å‘é‡æ£€ç´¢ 1234567891011121314151617181920curl -X POST -u elastic:123456 -k &#x27;https://127.0.0.1:9200/image-index/_search?pretty&#x27; \\ -H &#x27;Content-Type: application/json&#x27; \\ -d &#x27;&#123; &quot;query&quot;:&#123; &quot;match_all&quot;: &#123;&#125; &#125;, &quot;knn&quot;: &#123; &quot;field&quot;: &quot;image-vector&quot;, &quot;query_vector&quot;: [-5, 10, -12], &quot;k&quot;: 10, &quot;num_candidates&quot;: 100 &#125;, &quot;fields&quot;: [ &quot;title&quot;, &quot;file-type&quot; ] &#125;&#x27;# query: æœç´¢æ¡ä»¶ï¼Œè¿™é‡Œå¯ä»¥ä¸åŠ è¿™ä¸ª# knn: 8.8.1 ç‰ˆæœ¬å¼€å§‹é»˜è®¤æ”¯æŒ# field: æœç´¢å‘é‡å­—æ®µ# query_vector: æœç´¢å‘é‡# k: æœç´¢ç»“æœæ•°é‡# num_candidates: æœç´¢å€™é€‰æ•°é‡ï¼Œç”¨äºä¼˜åŒ–æ€§èƒ½# fields: æœç´¢ç»“æœè¿”å›å­—æ®µ","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» Elasticsearch çš„ REST APIs Elasticsearchç‰ˆæœ¬8.17.3 å®˜æ–¹æ–‡æ¡£:REST APIs Elasticsearch çš„ REST APIs:èšåˆæŸ¥è¯¢","date_published":"2025-04-17T13:30:05.000Z","tags":["æŠ€æœ¯","elastic","elasticsearch","elasticsearch"]},{"id":"https://blog.hanqunfeng.com/2025/04/16/elasticsearch-04-cert/","url":"https://blog.hanqunfeng.com/2025/04/16/elasticsearch-04-cert/","title":"Elasticsearchçš„è¯ä¹¦è¿‡æœŸå¤„ç†æ–¹æ³•","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç»Elasticsearchè¯ä¹¦è¿‡æœŸæ—¶çš„å¤„ç†æ–¹æ³•</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://www.elastic.co/guide/en/elasticsearch/reference/8.17/index.html\">Elasticsearch</a>ç‰ˆæœ¬8.17.3</p>\n</li>\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡åŸºäº <a href=\"/2025/03/20/elasticsearch-01-install/\" title=\"linuxä¸‹å®‰è£…Elasticsearch\">linuxä¸‹å®‰è£…Elasticsearch</a></p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://www.elastic.co/guide/en/elasticsearch/reference/8.17/update-node-certs.html\">å®˜æ–¹æ–‡æ¡£:Updating node security certificates</a></p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"ESè¯ä¹¦ç®€ä»‹\">ESè¯ä¹¦ç®€ä»‹</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Elasticsearch 8 é»˜è®¤æƒ…å†µä¸‹åˆ›å»ºçš„è¯ä¹¦åªæœ‰3å¹´æœ‰æ•ˆæœŸï¼Œè¿‡æœŸæ—¶éœ€è¦åˆ›å»ºæ–°çš„è¯ä¹¦ï¼Œä¸ºäº†ä¸å¿…è¦çš„éº»çƒ¦ï¼Œä¹Ÿå¯ä»¥ä¸€å¼€å§‹å°±åˆ›å»ºä¸€ä¸ªæœ‰æ•ˆæœŸæ¯”è¾ƒé•¿çš„è¯ä¹¦ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>åœ¨ Elasticsearch 8 çš„é…ç½®ä¸‹ï¼Œ<code>config/certs</code> ç›®å½•é€šå¸¸å­˜æ”¾çš„æ˜¯ç”¨äºå®‰å…¨é€šä¿¡çš„è¯ä¹¦å’Œå¯†é’¥æ–‡ä»¶ã€‚è¿™äº›æ–‡ä»¶ç¡®ä¿äº† Elasticsearch å®ä¾‹ä¹‹é—´çš„é€šè®¯ä»¥åŠä¸å¤–éƒ¨å®¢æˆ·ç«¯çš„é€šè®¯èƒ½å¤Ÿè¢«åŠ å¯†ä¸”ç»è¿‡è®¤è¯ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><code>config/certs</code> ç›®å½•åŒ…å«ä¸‰ä¸ªæ–‡ä»¶åˆ†åˆ«æ˜¯ï¼š</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\"><code>http.p12</code>: è¿™æ˜¯ä¸€ä¸ª PKCS#12 æ ¼å¼çš„æ–‡ä»¶ï¼ˆé€šå¸¸å¸¦æœ‰.p12æˆ–.pfxæ‰©å±•åï¼‰ï¼ŒåŒ…å«äº† Elasticsearch HTTP å±‚ç”¨æ¥è¿›è¡Œ TLS/SSL é€šä¿¡æ‰€éœ€çš„ä¸€åˆ‡ï¼ŒåŒ…æ‹¬ä¸€ä¸ªç§é’¥ã€ç›¸åº”çš„å…¬é’¥è¯ä¹¦ï¼ˆæœåŠ¡å™¨è¯ä¹¦ï¼‰åŠ CA è¯ä¹¦é“¾ã€‚å®¢æˆ·ç«¯ä½¿ç”¨è¿™ä¸ªæ–‡ä»¶æ¥éªŒè¯å®ƒä»¬æ­£åœ¨ä¸æ­£ç¡®çš„æœåŠ¡å™¨è¿›è¡Œé€šä¿¡ï¼Œå¹¶ä¸”æ­¤æœåŠ¡å™¨ä¹Ÿä¿¡ä»»è¯¥å®¢æˆ·ç«¯ã€‚</li>\n<li class=\"lvl-4\"><code>http_ca.crt</code>: CA (Certificate Authority) æ ¹è¯ä¹¦æˆ–ä¸­é—´è¯ä¹¦ï¼Œç”¨äºéªŒè¯é€šè¿‡ HTTP åè®®è¿æ¥è‡³ Elasticsearch æœåŠ¡ç«¯ç‚¹çš„èº«ä»½ã€‚å½“å®¢æˆ·ç«¯å°è¯•å»ºç«‹ HTTPS è¿æ¥æ—¶ï¼Œå®ƒä¼šæ£€æŸ¥æ¥è‡ª Elasticsearch çš„è¯ä¹¦æ˜¯å¦ç”±è¿™ä¸ª CA ç­¾åï¼›è¿™æ˜¯ç¡®ä¿åŒæ–¹é€šä¿¡å®‰å…¨çš„é‡è¦æ­¥éª¤ä¹‹ä¸€ã€‚</li>\n<li class=\"lvl-4\"><code>transport.p12</code>: åŒæ ·ä¸º PKCS#12 æ ¼å¼ï¼Œä½†è¿™ä¸ªç‰¹å®šçš„æ–‡ä»¶æ˜¯ç»™ Elasticsearch èŠ‚ç‚¹ä¹‹é—´å†…éƒ¨ä¼ è¾“å±‚ä½¿ç”¨çš„ã€‚åœ¨é›†ç¾¤å†…ï¼ŒèŠ‚ç‚¹é—´éœ€<br>\nè¦ç›¸äº’è®¤è¯ï¼Œtransport.p12å°±åŒ…å«ç€è®©ä¸åŒ Elasticsearch å®ä¾‹èƒ½äº’ç›¸è¯†åˆ«æ‰€éœ€çš„ç§é’¥å’Œè¯ä¹¦ã€‚</li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<p>æ€»ä¹‹ï¼Œ<code>http.p12</code>æœåŠ¡äºé¢å‘ Web çš„æ¥å£ï¼Œè€Œ<code>transport.p12</code>åˆ™å¤„ç† Elasticsearch ç¾¤é›†å†…çš„äº¤äº’ï¼›ä¸¤è€…éƒ½ä¾èµ–äº<code>http_ca.crt</code>æ¥è¿›è¡Œèº«ä»½éªŒè¯è¿‡ç¨‹çš„ä¸€éƒ¨åˆ†ã€‚</p>\n</li>\n</ul>\n<h2 id=\"ESè¯ä¹¦è¿‡æœŸçš„å½±å“\">ESè¯ä¹¦è¿‡æœŸçš„å½±å“</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>â€Œé›†ç¾¤æ— æ³•å¢åŠ æ–°èŠ‚ç‚¹â€Œï¼šç‰¹åˆ«æ˜¯åœ¨é‡å¯é›†ç¾¤æ—¶ï¼ŒèŠ‚ç‚¹æ— æ³•åŠ å…¥é›†ç¾¤ï¼Œå¯¼è‡´æ— æ³•æ­£å¸¸é‡å¯ã€‚â€Œ</p>\n</li>\n<li class=\"lvl-2\">\n<p>â€Œè®¿é—®å¼‚å¸¸â€Œï¼šå¦‚æœä½¿ç”¨è¯ä¹¦è¿æ¥ESé›†ç¾¤ï¼Œä¼šå¯¼è‡´æ— æ³•æ­£å¸¸è®¿é—®é›†ç¾¤ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>â€Œå®‰å…¨é£é™©â€Œï¼šè¯ä¹¦è¿‡æœŸä¼šç ´åè¯ä¹¦é“¾çš„ä¿¡ä»»ï¼Œå¯èƒ½å¼•å‘å®‰å…¨æ¼æ´ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>â€Œæ—¥å¿—å¹²æ‰°â€Œï¼šä¼šæŒç»­å‡ºç°è¯ä¹¦è¿‡æœŸçš„é”™è¯¯æ—¥å¿—ï¼Œå¹²æ‰°é—®é¢˜æ’æŸ¥å’Œè¯Šæ–­ã€‚</p>\n</li>\n</ul>\n<h2 id=\"æŸ¥çœ‹è¯ä¹¦çš„è¿‡æœŸæ—¶é—´\">æŸ¥çœ‹è¯ä¹¦çš„è¿‡æœŸæ—¶é—´</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>é€šè¿‡opensslæŸ¥çœ‹è¯ä¹¦çš„è¿‡æœŸæ—¶é—´</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹crtè¯ä¹¦åˆ°æœŸæ—¶é—´</span></span><br><span class=\"line\"><span class=\"comment\"># -dates: æ˜¾ç¤ºè¯ä¹¦çš„å¼€å§‹æ—¶é—´å’Œç»“æŸæ—¶é—´</span></span><br><span class=\"line\"><span class=\"comment\"># -noout: ä¸è¾“å‡ºè¯ä¹¦çš„è¯¦ç»†ä¿¡æ¯</span></span><br><span class=\"line\">openssl x509 -<span class=\"keyword\">in</span> config/certs/http_ca.crt -dates -noout</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹p12è¯ä¹¦åˆ°æœŸæ—¶é—´</span></span><br><span class=\"line\"><span class=\"comment\"># -clcerts: åªæ˜¾ç¤ºè¯ä¹¦ï¼Œä¸æ˜¾ç¤ºç§é’¥</span></span><br><span class=\"line\"><span class=\"comment\"># -nokeys: ä¸è¾“å‡ºç§é’¥</span></span><br><span class=\"line\"><span class=\"comment\"># -password pass: æŒ‡å®šç§é’¥çš„å¯†ç ï¼Œè¿™é‡Œä¸ºç©º(å› ä¸ºåœ¨åˆ›å»ºè¯ä¹¦æ—¶æ²¡æœ‰è®¾ç½®å¯†ç )ï¼Œæ³¨æ„å¯†ç å¿…é¡»å†™åœ¨pass:çš„åé¢ï¼Œä¸åŠ è¿™ä¸ªå‚æ•°ä¼šæç¤ºä½ è¾“å…¥å¯†ç ï¼Œç›´æ¥å›è½¦å³å¯</span></span><br><span class=\"line\">openssl pkcs12 -<span class=\"keyword\">in</span> ca.p12 -password pass: -clcerts -nokeys | openssl x509 -dates -noout</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>é€šè¿‡ESçš„APIæŸ¥çœ‹è¯ä¹¦è¿‡æœŸæ—¶é—´</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -XGET -k -u <span class=\"string\">&#x27;elastic:123456&#x27;</span> <span class=\"string\">&#x27;https://127.0.0.1:9200/_ssl/certificates?pretty&#x27;</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"è¯ä¹¦è¿‡æœŸå¤„ç†\">è¯ä¹¦è¿‡æœŸå¤„ç†</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Elasticsearch 8 çš„è¯ä¹¦åˆ›å»ºéœ€è¦ä½¿ç”¨å‘½ä»¤è¡Œå·¥å…· <code>elasticsearch-certutil</code>ï¼Œè¿™éƒ¨åˆ†çš„è¯¦ç»†ä¿¡æ¯å¯ä»¥å‚è€ƒ<a href=\"https://www.elastic.co/guide/en/elasticsearch/reference/8.17/certutil.html\">å®˜æ–¹æ–‡æ¡£:elasticsearch-certutil</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>å½“è¯ä¹¦è¿‡æœŸæ—¶ï¼Œéœ€è¦é‡æ–°ç”Ÿæˆè¯ä¹¦ï¼Œå¹¶æ›´æ–°<code>config/certs</code>ç›®å½•ä¸‹çš„æ–‡ä»¶ï¼Œæ›´æ–°å‰è¦å¤‡ä»½åŸè¯ä¹¦ã€‚</p>\n</li>\n</ul>\n<h3 id=\"å¤‡ä»½åŸè¯ä¹¦\">å¤‡ä»½åŸè¯ä¹¦</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ <span class=\"built_in\">cp</span> -r config/certs config/certs.bak</span><br><span class=\"line\">$ <span class=\"built_in\">rm</span> -rf config/certs/*</span><br></pre></td></tr></table></figure>\n<h3 id=\"ç”Ÿæˆæ–°è¯ä¹¦\">ç”Ÿæˆæ–°è¯ä¹¦</h3>\n<h4 id=\"ç”ŸæˆCAè¯ä¹¦\">ç”ŸæˆCAè¯ä¹¦</h4>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç”Ÿæˆcrtè¯ä¹¦</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># --days 36500: æŒ‡å®šè¯ä¹¦çš„æœ‰æ•ˆæœŸï¼Œå•ä½ä¸ºå¤©ï¼Œè¿™é‡Œè®¾ç½®ä¸º 36500 å¤©ï¼Œå¤§çº¦ 10 å¹´</span></span><br><span class=\"line\">$ bin/elasticsearch-certutil ca --pem --out new-ca.zip --days 36500</span><br><span class=\"line\"><span class=\"comment\"># è§£å‹</span></span><br><span class=\"line\">$ unzip new-ca.zip</span><br><span class=\"line\"><span class=\"comment\"># å°†åˆ›å»ºçš„è¯ä¹¦ç§»åŠ¨åˆ°æŒ‡å®šç›®å½•</span></span><br><span class=\"line\">$ <span class=\"built_in\">mv</span> ca/ca.crt config/certs/http_ca.crt</span><br><span class=\"line\">$ <span class=\"built_in\">mv</span> ca/ca.key config/certs/http_ca.key</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¹Ÿå¯ä»¥ç”ŸæˆPKCS#12æ ¼å¼çš„è¯ä¹¦</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ bin/elasticsearch-certutil ca --out config/certs/ca.p12 --days 36500</span><br></pre></td></tr></table></figure>\n<h4 id=\"ç”Ÿæˆtransportè¯ä¹¦\">ç”Ÿæˆtransportè¯ä¹¦</h4>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åŸºäºcrtè¯ä¹¦</span></span><br><span class=\"line\">$ bin/elasticsearch-certutil cert --ca-cert config/certs/http_ca.crt --ca-key config/certs/http_ca.key --out config/certs/transport.p12 --days 36500</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åŸºäºPKCS#12æ ¼å¼çš„è¯ä¹¦</span></span><br><span class=\"line\">$ bin/elasticsearch-certutil cert --ca config/certs/ca.p12 --out config/certs/transport.p12 --days 36500</span><br></pre></td></tr></table></figure>\n<h4 id=\"ç”Ÿæˆhttpè¯ä¹¦\">ç”Ÿæˆhttpè¯ä¹¦</h4>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># è¿™é‡Œæ˜¯äº¤äº’å¼å‘½ä»¤è¡Œ</span></span><br><span class=\"line\">$ bin/elasticsearch-certutil http</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¾“å‡ºè¯´æ˜</p>\n</li>\n</ul>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Generate a CSR? [y/N]n # ä¸ç”ŸæˆCSR</span><br><span class=\"line\">Use an existing CA? [y/N]y # ä½¿ç”¨å·²æœ‰çš„CA</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">ä»¥ä¸‹åŒºåˆ†crtè¯ä¹¦å’ŒPKCS#12æ ¼å¼çš„è¯ä¹¦</span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">crt è¯ä¹¦</span></span><br><span class=\"line\">CA Path: certs/http_ca.crt # CAè¯ä¹¦ï¼Œè¿™é‡Œç›¸å¯¹è·¯å¾„æ˜¯ç›¸å¯¹åº” config ç›®å½•ï¼Œä¹Ÿå¯ä»¥æ˜¯ç»å¯¹è·¯å¾„</span><br><span class=\"line\">CA Key: certs/http_ca.key # CAå¯†é’¥ï¼Œè¿™é‡Œç›¸å¯¹è·¯å¾„æ˜¯ç›¸å¯¹åº” config ç›®å½•ï¼Œä¹Ÿå¯ä»¥æ˜¯ç»å¯¹è·¯å¾„</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">PKCS#12æ ¼å¼çš„è¯ä¹¦</span></span><br><span class=\"line\">CA Path: certs/ca.p12 # CAè¯ä¹¦ï¼Œè¿™é‡Œç›¸å¯¹è·¯å¾„æ˜¯ç›¸å¯¹åº” config ç›®å½•ï¼Œä¹Ÿå¯ä»¥æ˜¯ç»å¯¹è·¯å¾„</span><br><span class=\"line\">Password for ca.p12: # CAå¯†ç ï¼Œå› ä¸ºæ²¡æœ‰è®¾ç½®å¯†ç ï¼Œæ‰€ä»¥è¿™é‡Œç›´æ¥å›è½¦</span><br><span class=\"line\"></span><br><span class=\"line\">For how long should your certificate be valid? [5y] 100y # è¯ä¹¦æœ‰æ•ˆæœŸï¼Œå•ä½ä¸ºå¹´ï¼Œé»˜è®¤æ˜¯ 5 å¹´ï¼Œè¿™é‡Œè®¾ç½®ä¸º 100 å¹´</span><br><span class=\"line\">Generate a certificate per node? [y/N]n # ä¸ä¸ºæ¯ä¸ªèŠ‚ç‚¹åˆ›å»ºç‹¬ç«‹çš„è¯ä¹¦ï¼Œå³æ‰€æœ‰èŠ‚ç‚¹éƒ½ä½¿ç”¨åŒä¸€ä¸ªè¯ä¹¦</span><br><span class=\"line\">Enter all the hostnames that you need, one per line.</span><br><span class=\"line\">When you are done, press &lt;ENTER&gt; once more to move on to the next step.</span><br><span class=\"line\"></span><br><span class=\"line\">localhost # ä¸»æœºåï¼Œè¿™é‡Œå¯ä»¥æ·»åŠ å¤šä¸ªï¼Œå›è½¦ä¸€è¡Œä¸€ä¸ªï¼Œè¿™é‡Œåº”è¯¥å¡«å†™é›†ç¾¤å†…æ‰€æœ‰èŠ‚ç‚¹æœåŠ¡å™¨çš„hostnameï¼Œå¯ä»¥é€šè¿‡ hostname å‘½ä»¤æŸ¥çœ‹</span><br><span class=\"line\">ip-10-250-0-17.cn-northwest-1.compute.internal</span><br><span class=\"line\">ip-10-250-0-173.cn-northwest-1.compute.internal</span><br><span class=\"line\">ip-10-250-0-239.cn-northwest-1.compute.internal</span><br><span class=\"line\"></span><br><span class=\"line\">You entered the following hostnames.</span><br><span class=\"line\"></span><br><span class=\"line\"> - localhost</span><br><span class=\"line\"> - ip-10-250-0-17.cn-northwest-1.compute.internal</span><br><span class=\"line\"> - ip-10-250-0-173.cn-northwest-1.compute.internal</span><br><span class=\"line\"> - ip-10-250-0-239.cn-northwest-1.compute.internal</span><br><span class=\"line\"></span><br><span class=\"line\">Is this correct [Y/n]y # ç¡®è®¤ä¸»æœºåæ˜¯å¦æ­£ç¡®</span><br><span class=\"line\"></span><br><span class=\"line\">Enter all the IP addresses that you need, one per line.</span><br><span class=\"line\">When you are done, press &lt;ENTER&gt; once more to move on to the next step.</span><br><span class=\"line\"></span><br><span class=\"line\">127.0.0.1 # ä¸»æœºIPï¼Œè¿™é‡Œå¯ä»¥æ·»åŠ å¤šä¸ªï¼Œå›è½¦ä¸€è¡Œä¸€ä¸ªï¼Œè¿™é‡Œåº”è¯¥å¡«å†™é›†ç¾¤å†…æ‰€æœ‰èŠ‚ç‚¹æœåŠ¡å™¨çš„IPåœ°å€</span><br><span class=\"line\">10.250.0.17</span><br><span class=\"line\">10.250.0.173</span><br><span class=\"line\">10.250.0.239</span><br><span class=\"line\"></span><br><span class=\"line\">You entered the following IP addresses.</span><br><span class=\"line\"></span><br><span class=\"line\"> - 127.0.0.1</span><br><span class=\"line\"> - 10.250.0.17</span><br><span class=\"line\"> - 10.250.0.173</span><br><span class=\"line\"> - 10.250.0.239</span><br><span class=\"line\"></span><br><span class=\"line\">Is this correct [Y/n]y # ç¡®è®¤IPæ˜¯å¦æ­£ç¡®</span><br><span class=\"line\"></span><br><span class=\"line\">Do you wish to change any of these options? [y/N]n # ä¸ä¿®æ”¹ä»»ä½•é€‰é¡¹</span><br><span class=\"line\"></span><br><span class=\"line\">If you wish to use a blank password, simply press &lt;enter&gt; at the prompt below.</span><br><span class=\"line\">Provide a password for the &quot;http.p12&quot; file:  [&lt;ENTER&gt; for none] # ç›´æ¥å›è½¦ä¸è®¾ç½®å¯†ç </span><br><span class=\"line\"></span><br><span class=\"line\">What filename should be used for the output zip file? [/usr/local/elasticsearch/elasticsearch-8.17.3/elasticsearch-ssl-http.zip] # è¾“å‡ºæ–‡ä»¶åï¼Œè¿™é‡Œå¯ä»¥è‡ªå®šä¹‰ï¼Œé»˜è®¤æ˜¯ elasticsearch-ssl-http.zip</span><br><span class=\"line\"></span><br><span class=\"line\">Zip file written to /usr/local/elasticsearch/elasticsearch-8.17.3/elasticsearch-ssl-http.zip</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è§£å‹å¹¶å°†httpè¯ä¹¦æ‹·è´åˆ°config/certsç›®å½•ä¸‹</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ unzip elasticsearch-ssl-http.zip</span><br><span class=\"line\">Archive:  elasticsearch-ssl-http.zip</span><br><span class=\"line\">   creating: elasticsearch/</span><br><span class=\"line\">  inflating: elasticsearch/README.txt <span class=\"comment\"># è¯´æ˜æ–‡ä»¶</span></span><br><span class=\"line\">  inflating: elasticsearch/http.p12  <span class=\"comment\"># httpè¯ä¹¦</span></span><br><span class=\"line\">  inflating: elasticsearch/sample-elasticsearch.yml <span class=\"comment\"># ç¤ºä¾‹elasticsearché…ç½®æ–‡ä»¶</span></span><br><span class=\"line\">   creating: kibana/</span><br><span class=\"line\">  inflating: kibana/README.txt <span class=\"comment\"># è¯´æ˜æ–‡ä»¶</span></span><br><span class=\"line\">  inflating: kibana/elasticsearch-ca.pem  <span class=\"comment\"># kibanaç”¨äºéªŒè¯ESçš„è¯ä¹¦ï¼Œå³ elasticsearch.ssl.certificateAuthorities ä¸­çš„é…ç½®</span></span><br><span class=\"line\">  inflating: kibana/sample-kibana.yml <span class=\"comment\"># ç¤ºä¾‹kibanaé…ç½®æ–‡ä»¶</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å°†httpè¯ä¹¦æ‹·è´åˆ°config/certsç›®å½•ä¸‹</span></span><br><span class=\"line\">$ <span class=\"built_in\">cp</span> elasticsearch/http.p12 config/certs/http.p12</span><br></pre></td></tr></table></figure>\n<h3 id=\"åˆ†å‘åˆ°ESé›†ç¾¤ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹\">åˆ†å‘åˆ°ESé›†ç¾¤ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¸Šé¢åˆ›å»ºæ–°çš„è¯ä¹¦æ—¶æˆ‘ä»¬åªåœ¨ä¸€ä¸ªèŠ‚ç‚¹ä¸Šè¿›è¡Œå³å¯ï¼Œä¹‹åå°†ç”Ÿæˆå¥½çš„è¯ä¹¦åˆ†å‘åˆ°ESé›†ç¾¤ä¸­çš„å…¶å®ƒèŠ‚ç‚¹ï¼Œè¿™é‡Œå°±æ˜¯ <code>http.p12</code> å’Œ <code>transport.p12</code>ï¼Œå°†å…¶æ‹·è´åˆ°æ¯ä¸ªèŠ‚ç‚¹çš„ <code>config/certs</code> ç›®å½•ä¸‹ï¼Œæ‹·è´å‰åšå¥½åŸè¯ä¹¦çš„å¤‡ä»½ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å¦‚æœ‰å¿…è¦ä¹Ÿå¯ä»¥æ‹·è´ <code>ca.p12</code> æˆ–è€… <code>http_ca.crt</code> å’Œ <code>http_ca.key</code> åˆ°æ¯ä¸ªèŠ‚ç‚¹çš„ <code>config/certs</code> ç›®å½•ä¸‹</p>\n</li>\n</ul>\n<h3 id=\"é‡å¯ESæœåŠ¡\">é‡å¯ESæœåŠ¡</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>é›†ç¾¤ä¸­çš„èŠ‚ç‚¹ä¾æ¬¡é‡å¯</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ bin/elasticsearch -d</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>é‡å¯æ—¶å¯èƒ½ä¼šæŠ¥é”™</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">org.elasticsearch.ElasticsearchSecurityException: failed to load SSL configuration [xpack.security.transport.ssl] - cannot <span class=\"built_in\">read</span> configured [PKCS12] keystore (as a truststore) [/usr/local/elasticsearch/elasticsearch-8.17.3/config/certs/transport.p12] - this is usually caused by an incorrect password; (a keystore password was provided)</span><br><span class=\"line\"><span class=\"comment\"># è™½ç„¶æˆ‘ä»¬æ²¡æœ‰ç»™transport.p12è®¾ç½®å¯†ç ï¼Œä½†è¿™é‡Œä¾æ—§æç¤ºæä¾›çš„å¯†ç ä¸æ­£ç¡®ï¼Œå®é™…ä¸Šè¿™é‡Œä½¿ç”¨çš„æ˜¯ secure_password</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è§£å†³æ–¹æ³•</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ä½¿ç”¨bin/elasticsearch-keystore listæŸ¥çœ‹ç°æœ‰çš„å¯†é’¥åˆ—è¡¨</span></span><br><span class=\"line\">$ bin/elasticsearch-keystore list</span><br><span class=\"line\">keystore.seed</span><br><span class=\"line\">xpack.security.http.ssl.keystore.secure_password</span><br><span class=\"line\">xpack.security.transport.ssl.keystore.secure_password</span><br><span class=\"line\">xpack.security.transport.ssl.truststore.secure_password</span><br><span class=\"line\"><span class=\"comment\"># åˆ é™¤secure_passwordåå†æ¬¡é‡å¯ESæœåŠ¡å°±ä¼šæ­£å¸¸äº†</span></span><br><span class=\"line\">$ bin/elasticsearch-keystore remove xpack.security.http.ssl.keystore.secure_password</span><br><span class=\"line\">$ bin/elasticsearch-keystore remove xpack.security.transport.ssl.keystore.secure_password</span><br><span class=\"line\">$ bin/elasticsearch-keystore remove xpack.security.transport.ssl.truststore.secure_password</span><br></pre></td></tr></table></figure>\n<h3 id=\"æ›¿æ¢Kibanaçš„è¯ä¹¦\">æ›¿æ¢Kibanaçš„è¯ä¹¦</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å°†ä¸Šé¢åˆ›å»ºå¥½çš„ <code>kibana/elasticsearch-ca.pem</code> æ‹·è´åˆ°KibanaæœåŠ¡å™¨ï¼Œæ¯”å¦‚ <code>/usr/local/kibana/kibana-8.17.3/config/certs/elasticsearch-ca.pem</code></p>\n</li>\n<li class=\"lvl-2\">\n<p>ä¿®æ”¹Kibanaé…ç½®æ–‡ä»¶ <code>config/kibana.yml</code> ä¸­çš„ <code>elasticsearch.ssl.certificateAuthorities</code> é…ç½®ï¼Œä½¿å…¶æŒ‡å‘ <code>/usr/local/kibana/kibana-8.17.3/config/certs/elasticsearch-ca.pem</code></p>\n</li>\n</ul>\n<figure class=\"highlight yml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">elasticsearch.ssl.certificateAuthorities:</span> [<span class=\"string\">&quot;/usr/local/kibana/kibana-8.17.3/config/certs/elasticsearch-ca.pem&quot;</span>]</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>é‡å¯KibanaæœåŠ¡</p>\n</li>\n</ul>\n<h2 id=\"è¯ä¹¦æ ¼å¼è½¬æ¢\">è¯ä¹¦æ ¼å¼è½¬æ¢</h2>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># p12è½¬æ¢ä¸ºcrtæ ¼å¼</span></span><br><span class=\"line\">$ openssl pkcs12 -<span class=\"keyword\">in</span> config/certs/ca.p12 -out config/certs/http_ca.crt -nokeys</span><br><span class=\"line\"><span class=\"comment\"># p12è½¬æ¢ä¸ºkeyæ ¼å¼</span></span><br><span class=\"line\">$ openssl pkcs12 -<span class=\"keyword\">in</span> config/certs/ca.p12 -out config/certs/http_ca.key -nocerts -nodes</span><br><span class=\"line\"><span class=\"comment\"># p12è½¬æ¢ä¸ºpemæ ¼å¼</span></span><br><span class=\"line\">$ openssl pkcs12 -<span class=\"keyword\">in</span> config/certs/ca.p12 -out config/certs/http_ca.pem -nodes</span><br><span class=\"line\"><span class=\"comment\"># crtè½¬æ¢å›PKCS12æ ¼å¼</span></span><br><span class=\"line\">$ openssl pkcs12 -<span class=\"built_in\">export</span> -out config/certs/http_ca.p12 -inkey config/certs/http_ca.key -<span class=\"keyword\">in</span> config/certs/http_ca.crt -name <span class=\"string\">&quot;My CA&quot;</span></span><br></pre></td></tr></table></figure>\n<div class=\"tips\">\n<p><em><strong>ç”Ÿæˆhttpè¯ä¹¦æ—¶ä¸ºæ¯ä¸ªèŠ‚ç‚¹å•ç‹¬é…ç½®è¯ä¹¦</strong></em></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Generate a certificate per node? [y/N]y <span class=\"comment\"># æ˜¯å¦ä¸ºæ¯ä¸ªèŠ‚ç‚¹å•ç‹¬é…ç½®è¯ä¹¦ï¼Œè¿™é‡Œé€‰æ‹©æ˜¯</span></span><br><span class=\"line\">node <span class=\"comment\">#1 name: node-1 # èŠ‚ç‚¹åç§°ï¼Œå¿…é¡»ä¸ESé…ç½®æ–‡ä»¶ä¸­çš„node.nameä¸€è‡´</span></span><br><span class=\"line\"></span><br><span class=\"line\">Enter all the hostnames that you need, one per line. <span class=\"comment\"># è¾“å…¥ node-1 èŠ‚ç‚¹çš„hostname</span></span><br><span class=\"line\">When you are <span class=\"keyword\">done</span>, press &lt;ENTER&gt; once more to move on to the next step.</span><br><span class=\"line\"></span><br><span class=\"line\">localhost                                         <span class=\"comment\"># ä¹ æƒ¯åŠ ä¸Š localhost</span></span><br><span class=\"line\">ip-10-250-0-239.cn-northwest-1.compute.internal   <span class=\"comment\"># node-1 çš„ hostname</span></span><br><span class=\"line\"></span><br><span class=\"line\">You entered the following hostnames.</span><br><span class=\"line\"></span><br><span class=\"line\"> - localhost</span><br><span class=\"line\"> - ip-10-250-0-239.cn-northwest-1.compute.internal</span><br><span class=\"line\"></span><br><span class=\"line\">Is this correct [Y/n]y <span class=\"comment\"># ç¡®è®¤æ˜¯å¦æ­£ç¡®</span></span><br><span class=\"line\"></span><br><span class=\"line\">Enter all the IP addresses that you need, one per line. <span class=\"comment\"># è¾“å…¥ node-1 èŠ‚ç‚¹çš„IPåœ°å€</span></span><br><span class=\"line\">When you are <span class=\"keyword\">done</span>, press &lt;ENTER&gt; once more to move on to the next step.</span><br><span class=\"line\"></span><br><span class=\"line\">127.0.0.1                                         <span class=\"comment\"># ä¹ æƒ¯åŠ ä¸Š 127.0.0.1</span></span><br><span class=\"line\">10.250.0.239                                      <span class=\"comment\"># node-1 çš„ IP</span></span><br><span class=\"line\"></span><br><span class=\"line\">You entered the following IP addresses.</span><br><span class=\"line\"></span><br><span class=\"line\"> - 127.0.0.1</span><br><span class=\"line\"> - 10.250.0.239</span><br><span class=\"line\"></span><br><span class=\"line\">Is this correct [Y/n]y <span class=\"comment\"># ç¡®è®¤æ˜¯å¦æ­£ç¡®</span></span><br><span class=\"line\"></span><br><span class=\"line\">Do you wish to change any of these options? [y/N]n <span class=\"comment\"># ä¸ä¿®æ”¹ä»»ä½•é€‰é¡¹</span></span><br><span class=\"line\">Generate additional certificates? [Y/n]y  <span class=\"comment\"># æ˜¯å¦ç”Ÿæˆå…¶ä»–è¯ä¹¦ï¼Œè¿™é‡Œé€‰æ‹©æ˜¯ï¼Œæ¥ç€ä¸ºå…¶å®ƒèŠ‚ç‚¹åˆ›å»ºè¯ä¹¦</span></span><br><span class=\"line\">node <span class=\"comment\">#2 name: node-2 # èŠ‚ç‚¹åç§°ï¼Œå¿…é¡»ä¸ESé…ç½®æ–‡ä»¶ä¸­çš„node.nameä¸€è‡´</span></span><br><span class=\"line\"><span class=\"comment\"># ä¾æ¬¡ä¸ºæ¯ä¸ªèŠ‚ç‚¹åˆ›å»ºè¯ä¹¦</span></span><br><span class=\"line\">â€¦â€¦â€¦â€¦â€¦â€¦</span><br><span class=\"line\"></span><br><span class=\"line\">Generate additional certificates? [Y/n]n <span class=\"comment\"># åˆ›å»ºå¥½æ‰€æœ‰èŠ‚ç‚¹çš„è¯ä¹¦åï¼Œé€‰æ‹©nï¼Œä¸å†åˆ›å»ºæ–°çš„è¯ä¹¦</span></span><br><span class=\"line\"></span><br><span class=\"line\">If you wish to use a blank password, simply press &lt;enter&gt; at the prompt below.</span><br><span class=\"line\">Provide a password <span class=\"keyword\">for</span> the <span class=\"string\">&quot;http.p12&quot;</span> file:  [&lt;ENTER&gt; <span class=\"keyword\">for</span> none] <span class=\"comment\"># ç›´æ¥å›è½¦ä¸è®¾ç½®å¯†ç </span></span><br><span class=\"line\"></span><br><span class=\"line\">What filename should be used <span class=\"keyword\">for</span> the output zip file? [/usr/local/elasticsearch/elasticsearch-8.17.3/elasticsearch-ssl-http.zip] <span class=\"comment\"># è¾“å‡ºæ–‡ä»¶åï¼Œè¿™é‡Œå¯ä»¥è‡ªå®šä¹‰ï¼Œé»˜è®¤æ˜¯ elasticsearch-ssl-http.zip</span></span><br><span class=\"line\"></span><br><span class=\"line\">Zip file written to /usr/local/elasticsearch/elasticsearch-8.17.3/elasticsearch-ssl-http.zip</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-1\">\n<li class=\"lvl-2\">æ­¤æ—¶è§£å‹æŸ¥çœ‹æ–‡ä»¶ç»“æ„</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">unzip elasticsearch-ssl-http.zip</span><br><span class=\"line\">Archive:  elasticsearch-ssl-http.zip</span><br><span class=\"line\">   creating: elasticsearch/</span><br><span class=\"line\">   creating: elasticsearch/node-1/</span><br><span class=\"line\">  inflating: elasticsearch/node-1/README.txt</span><br><span class=\"line\">  inflating: elasticsearch/node-1/http.p12  <span class=\"comment\"># node-1 çš„è¯ä¹¦</span></span><br><span class=\"line\">  inflating: elasticsearch/node-1/sample-elasticsearch.yml</span><br><span class=\"line\">   creating: elasticsearch/node-2/</span><br><span class=\"line\">  inflating: elasticsearch/node-2/README.txt</span><br><span class=\"line\">  inflating: elasticsearch/node-2/http.p12 <span class=\"comment\"># node-2 çš„è¯ä¹¦</span></span><br><span class=\"line\">  inflating: elasticsearch/node-2/sample-elasticsearch.yml</span><br><span class=\"line\">  creating: elasticsearch/node-3/</span><br><span class=\"line\">  inflating: elasticsearch/node-3/README.txt</span><br><span class=\"line\">  inflating: elasticsearch/node-3/http.p12 <span class=\"comment\"># node-3 çš„è¯ä¹¦</span></span><br><span class=\"line\">  inflating: elasticsearch/node-3/sample-elasticsearch.yml</span><br><span class=\"line\">   creating: kibana/</span><br><span class=\"line\">  inflating: kibana/README.txt</span><br><span class=\"line\">  inflating: kibana/elasticsearch-ca.pem <span class=\"comment\"># kibana çš„è¯ä¹¦</span></span><br><span class=\"line\">  inflating: kibana/sample-kibana.yml</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-1\">\n<li class=\"lvl-2\">\n<p>å°†å¯¹åº”çš„è¯ä¹¦æ‹·è´åˆ°å¯¹åº”èŠ‚ç‚¹çš„ <code>config/certs</code> ç›®å½•ä¸‹</p>\n</li>\n</ul>\n</div>\n","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç»Elasticsearchè¯ä¹¦è¿‡æœŸæ—¶çš„å¤„ç†æ–¹æ³• Elasticsearchç‰ˆæœ¬8.17.3 æœ¬æ–‡åŸºäº linuxä¸‹å®‰è£…Elasticsearch å®˜æ–¹æ–‡æ¡£:Updating node security certificates ESè¯ä¹¦ç®€ä»‹ Elasticsearch 8 é»˜è®¤æƒ…å†µä¸‹åˆ›å»ºçš„è¯ä¹¦åªæœ‰3å¹´æœ‰æ•ˆæœŸï¼Œè¿‡æœŸæ—¶éœ€è¦åˆ›å»ºæ–°çš„è¯ä¹¦ï¼Œä¸ºäº†ä¸å¿…è¦çš„éº»çƒ¦ï¼Œä¹Ÿå¯ä»¥ä¸€å¼€å§‹å°±åˆ›å»ºä¸€ä¸ªæœ‰æ•ˆæœŸæ¯”è¾ƒé•¿çš„è¯ä¹¦ã€‚ åœ¨ Elasticsearch 8 çš„é…ç½®ä¸‹ï¼Œconfig/certs ç›®å½•é€šå¸¸å­˜æ”¾çš„æ˜¯ç”¨äºå®‰å…¨é€šä¿¡çš„è¯ä¹¦å’Œå¯†é’¥æ–‡ä»¶ã€‚è¿™äº›æ–‡ä»¶ç¡®ä¿äº† Elasticsearch å®ä¾‹ä¹‹é—´çš„é€šè®¯ä»¥åŠä¸å¤–éƒ¨å®¢æˆ·ç«¯çš„é€šè®¯èƒ½å¤Ÿè¢«åŠ å¯†ä¸”ç»è¿‡è®¤è¯ã€‚ config/certs ç›®å½•åŒ…å«ä¸‰ä¸ªæ–‡ä»¶åˆ†åˆ«æ˜¯ï¼š http.p12: è¿™æ˜¯ä¸€ä¸ª PKCS#12 æ ¼å¼çš„æ–‡ä»¶ï¼ˆé€šå¸¸å¸¦æœ‰.p12æˆ–.pfxæ‰©å±•åï¼‰ï¼ŒåŒ…å«äº† Elasticsearch HTTP å±‚ç”¨æ¥è¿›è¡Œ TLS/SSL é€šä¿¡æ‰€éœ€çš„ä¸€åˆ‡ï¼ŒåŒ…æ‹¬ä¸€ä¸ªç§é’¥ã€ç›¸åº”çš„å…¬é’¥è¯ä¹¦ï¼ˆæœåŠ¡å™¨è¯ä¹¦ï¼‰åŠ CA è¯ä¹¦é“¾ã€‚å®¢æˆ·ç«¯ä½¿ç”¨è¿™ä¸ªæ–‡ä»¶æ¥éªŒè¯å®ƒä»¬æ­£åœ¨ä¸æ­£ç¡®çš„æœåŠ¡å™¨è¿›è¡Œé€šä¿¡ï¼Œå¹¶ä¸”æ­¤æœåŠ¡å™¨ä¹Ÿä¿¡ä»»è¯¥å®¢æˆ·ç«¯ã€‚ http_ca.crt: CA (Certificate Authority) æ ¹è¯ä¹¦æˆ–ä¸­é—´è¯ä¹¦ï¼Œç”¨äºéªŒè¯é€šè¿‡ HTTP åè®®è¿æ¥è‡³ Elasticsearch æœåŠ¡ç«¯ç‚¹çš„èº«ä»½ã€‚å½“å®¢æˆ·ç«¯å°è¯•å»ºç«‹ HTTPS è¿æ¥æ—¶ï¼Œå®ƒä¼šæ£€æŸ¥æ¥è‡ª Elasticsearch çš„è¯ä¹¦æ˜¯å¦ç”±è¿™ä¸ª CA ç­¾åï¼›è¿™æ˜¯ç¡®ä¿åŒæ–¹é€šä¿¡å®‰å…¨çš„é‡è¦æ­¥éª¤ä¹‹ä¸€ã€‚ transport.p12: åŒæ ·ä¸º PKCS#12 æ ¼å¼ï¼Œä½†è¿™ä¸ªç‰¹å®šçš„æ–‡ä»¶æ˜¯ç»™ Elasticsearch èŠ‚ç‚¹ä¹‹é—´å†…éƒ¨ä¼ è¾“å±‚ä½¿ç”¨çš„ã€‚åœ¨é›†ç¾¤å†…ï¼ŒèŠ‚ç‚¹é—´éœ€ è¦ç›¸äº’è®¤è¯ï¼Œtransport.p12å°±åŒ…å«ç€è®©ä¸åŒ Elasticsearch å®ä¾‹èƒ½äº’ç›¸è¯†åˆ«æ‰€éœ€çš„ç§é’¥å’Œè¯ä¹¦ã€‚ æ€»ä¹‹ï¼Œhttp.p12æœåŠ¡äºé¢å‘ Web çš„æ¥å£ï¼Œè€Œtransport.p12åˆ™å¤„ç† Elasticsearch ç¾¤é›†å†…çš„äº¤äº’ï¼›ä¸¤è€…éƒ½ä¾èµ–äºhttp_ca.crtæ¥è¿›è¡Œèº«ä»½éªŒè¯è¿‡ç¨‹çš„ä¸€éƒ¨åˆ†ã€‚ ESè¯ä¹¦è¿‡æœŸçš„å½±å“ â€Œé›†ç¾¤æ— æ³•å¢åŠ æ–°èŠ‚ç‚¹â€Œï¼šç‰¹åˆ«æ˜¯åœ¨é‡å¯é›†ç¾¤æ—¶ï¼ŒèŠ‚ç‚¹æ— æ³•åŠ å…¥é›†ç¾¤ï¼Œå¯¼è‡´æ— æ³•æ­£å¸¸é‡å¯ã€‚â€Œ â€Œè®¿é—®å¼‚å¸¸â€Œï¼šå¦‚æœä½¿ç”¨è¯ä¹¦è¿æ¥ESé›†ç¾¤ï¼Œä¼šå¯¼è‡´æ— æ³•æ­£å¸¸è®¿é—®é›†ç¾¤ã€‚ â€Œå®‰å…¨é£é™©â€Œï¼šè¯ä¹¦è¿‡æœŸä¼šç ´åè¯ä¹¦é“¾çš„ä¿¡ä»»ï¼Œå¯èƒ½å¼•å‘å®‰å…¨æ¼æ´ã€‚ â€Œæ—¥å¿—å¹²æ‰°â€Œï¼šä¼šæŒç»­å‡ºç°è¯ä¹¦è¿‡æœŸçš„é”™è¯¯æ—¥å¿—ï¼Œå¹²æ‰°é—®é¢˜æ’æŸ¥å’Œè¯Šæ–­ã€‚ æŸ¥çœ‹è¯ä¹¦çš„è¿‡æœŸæ—¶é—´ é€šè¿‡opensslæŸ¥çœ‹è¯ä¹¦çš„è¿‡æœŸæ—¶é—´ 12345678910# æŸ¥çœ‹crtè¯ä¹¦åˆ°æœŸæ—¶é—´# -dates: æ˜¾ç¤ºè¯ä¹¦çš„å¼€å§‹æ—¶é—´å’Œç»“æŸæ—¶é—´# -noout: ä¸è¾“å‡ºè¯ä¹¦çš„è¯¦ç»†ä¿¡æ¯openssl x509 -in config/certs/http_ca.crt -dates -noout# æŸ¥çœ‹p12è¯ä¹¦åˆ°æœŸæ—¶é—´# -clcerts: åªæ˜¾ç¤ºè¯ä¹¦ï¼Œä¸æ˜¾ç¤ºç§é’¥# -nokeys: ä¸è¾“å‡ºç§é’¥# -password pass: æŒ‡å®šç§é’¥çš„å¯†ç ï¼Œè¿™é‡Œä¸ºç©º(å› ä¸ºåœ¨åˆ›å»ºè¯ä¹¦æ—¶æ²¡æœ‰è®¾ç½®å¯†ç )ï¼Œæ³¨æ„å¯†ç å¿…é¡»å†™åœ¨pass:çš„åé¢ï¼Œä¸åŠ è¿™ä¸ªå‚æ•°ä¼šæç¤ºä½ è¾“å…¥å¯†ç ï¼Œç›´æ¥å›è½¦å³å¯openssl pkcs12 -in ca.p12 -password pass: -clcerts -nokeys | openssl x509 -dates -noout é€šè¿‡ESçš„APIæŸ¥çœ‹è¯ä¹¦è¿‡æœŸæ—¶é—´ 1curl -XGET -k -u &#x27;elastic:123456&#x27; &#x27;https://127.0.0.1:9200/_ssl/certificates?pretty&#x27; è¯ä¹¦è¿‡æœŸå¤„ç† Elasticsearch 8 çš„è¯ä¹¦åˆ›å»ºéœ€è¦ä½¿ç”¨å‘½ä»¤è¡Œå·¥å…· elasticsearch-certutilï¼Œè¿™éƒ¨åˆ†çš„è¯¦ç»†ä¿¡æ¯å¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£:elasticsearch-certutil å½“è¯ä¹¦è¿‡æœŸæ—¶ï¼Œéœ€è¦é‡æ–°ç”Ÿæˆè¯ä¹¦ï¼Œå¹¶æ›´æ–°config/certsç›®å½•ä¸‹çš„æ–‡ä»¶ï¼Œæ›´æ–°å‰è¦å¤‡ä»½åŸè¯ä¹¦ã€‚ å¤‡ä»½åŸè¯ä¹¦ 12$ cp -r config/certs config/certs.bak$ rm -rf config/certs/* ç”Ÿæˆæ–°è¯ä¹¦ ç”ŸæˆCAè¯ä¹¦ ç”Ÿæˆcrtè¯ä¹¦ 1234567# --days 36500: æŒ‡å®šè¯ä¹¦çš„æœ‰æ•ˆæœŸï¼Œå•ä½ä¸ºå¤©ï¼Œè¿™é‡Œè®¾ç½®ä¸º 36500 å¤©ï¼Œå¤§çº¦ 10 å¹´$ bin/elasticsearch-certutil ca --pem --out new-ca.zip --days 36500# è§£å‹$ unzip new-ca.zip# å°†åˆ›å»ºçš„è¯ä¹¦ç§»åŠ¨åˆ°æŒ‡å®šç›®å½•$ mv ca/ca.crt config/certs/http_ca.crt$ mv ca/ca.key config/certs/http_ca.key ä¹Ÿå¯ä»¥ç”ŸæˆPKCS#12æ ¼å¼çš„è¯ä¹¦ 1$ bin/elasticsearch-certutil ca --out config/certs/ca.p12 --days 36500 ç”Ÿæˆtransportè¯ä¹¦ 12345# åŸºäºcrtè¯ä¹¦$ bin/elasticsearch-certutil cert --ca-cert config/certs/http_ca.crt --ca-key config/certs/http_ca.key --out config/certs/transport.p12 --days 36500# åŸºäºPKCS#12æ ¼å¼çš„è¯ä¹¦$ bin/elasticsearch-certutil cert --ca config/certs/ca.p12 --out config/certs/transport.p12 --days 36500 ç”Ÿæˆhttpè¯ä¹¦ 12# è¿™é‡Œæ˜¯äº¤äº’å¼å‘½ä»¤è¡Œ$ bin/elasticsearch-certutil http è¾“å‡ºè¯´æ˜ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556Generate a CSR? [y/N]n # ä¸ç”ŸæˆCSRUse an existing CA? [y/N]y # ä½¿ç”¨å·²æœ‰çš„CA# ä»¥ä¸‹åŒºåˆ†crtè¯ä¹¦å’ŒPKCS#12æ ¼å¼çš„è¯ä¹¦# crt è¯ä¹¦CA Path: certs/http_ca.crt # CAè¯ä¹¦ï¼Œè¿™é‡Œç›¸å¯¹è·¯å¾„æ˜¯ç›¸å¯¹åº” config ç›®å½•ï¼Œä¹Ÿå¯ä»¥æ˜¯ç»å¯¹è·¯å¾„CA Key: certs/http_ca.key # CAå¯†é’¥ï¼Œè¿™é‡Œç›¸å¯¹è·¯å¾„æ˜¯ç›¸å¯¹åº” config ç›®å½•ï¼Œä¹Ÿå¯ä»¥æ˜¯ç»å¯¹è·¯å¾„# PKCS#12æ ¼å¼çš„è¯ä¹¦CA Path: certs/ca.p12 # CAè¯ä¹¦ï¼Œè¿™é‡Œç›¸å¯¹è·¯å¾„æ˜¯ç›¸å¯¹åº” config ç›®å½•ï¼Œä¹Ÿå¯ä»¥æ˜¯ç»å¯¹è·¯å¾„Password for ca.p12: # CAå¯†ç ï¼Œå› ä¸ºæ²¡æœ‰è®¾ç½®å¯†ç ï¼Œæ‰€ä»¥è¿™é‡Œç›´æ¥å›è½¦For how long should your certificate be valid? [5y] 100y # è¯ä¹¦æœ‰æ•ˆæœŸï¼Œå•ä½ä¸ºå¹´ï¼Œé»˜è®¤æ˜¯ 5 å¹´ï¼Œè¿™é‡Œè®¾ç½®ä¸º 100 å¹´Generate a certificate per node? [y/N]n # ä¸ä¸ºæ¯ä¸ªèŠ‚ç‚¹åˆ›å»ºç‹¬ç«‹çš„è¯ä¹¦ï¼Œå³æ‰€æœ‰èŠ‚ç‚¹éƒ½ä½¿ç”¨åŒä¸€ä¸ªè¯ä¹¦Enter all the hostnames that you need, one per line.When you are done, press &lt;ENTER&gt; once more to move on to the next step.localhost # ä¸»æœºåï¼Œè¿™é‡Œå¯ä»¥æ·»åŠ å¤šä¸ªï¼Œå›è½¦ä¸€è¡Œä¸€ä¸ªï¼Œè¿™é‡Œåº”è¯¥å¡«å†™é›†ç¾¤å†…æ‰€æœ‰èŠ‚ç‚¹æœåŠ¡å™¨çš„hostnameï¼Œå¯ä»¥é€šè¿‡ hostname å‘½ä»¤æŸ¥çœ‹ip-10-250-0-17.cn-northwest-1.compute.internalip-10-250-0-173.cn-northwest-1.compute.internalip-10-250-0-239.cn-northwest-1.compute.internalYou entered the following hostnames. - localhost - ip-10-250-0-17.cn-northwest-1.compute.internal - ip-10-250-0-173.cn-northwest-1.compute.internal - ip-10-250-0-239.cn-northwest-1.compute.internalIs this correct [Y/n]y # ç¡®è®¤ä¸»æœºåæ˜¯å¦æ­£ç¡®Enter all the IP addresses that you need, one per line.When you are done, press &lt;ENTER&gt; once more to move on to the next step.127.0.0.1 # ä¸»æœºIPï¼Œè¿™é‡Œå¯ä»¥æ·»åŠ å¤šä¸ªï¼Œå›è½¦ä¸€è¡Œä¸€ä¸ªï¼Œè¿™é‡Œåº”è¯¥å¡«å†™é›†ç¾¤å†…æ‰€æœ‰èŠ‚ç‚¹æœåŠ¡å™¨çš„IPåœ°å€10.250.0.1710.250.0.17310.250.0.239You entered the following IP addresses. - 127.0.0.1 - 10.250.0.17 - 10.250.0.173 - 10.250.0.239Is this correct [Y/n]y # ç¡®è®¤IPæ˜¯å¦æ­£ç¡®Do you wish to change any of these options? [y/N]n # ä¸ä¿®æ”¹ä»»ä½•é€‰é¡¹If you wish to use a blank password, simply press &lt;enter&gt; at the prompt below.Provide a password for the &quot;http.p12&quot; file: [&lt;ENTER&gt; for none] # ç›´æ¥å›è½¦ä¸è®¾ç½®å¯†ç What filename should be used for the output zip file? [/usr/local/elasticsearch/elasticsearch-8.17.3/elasticsearch-ssl-http.zip] # è¾“å‡ºæ–‡ä»¶åï¼Œè¿™é‡Œå¯ä»¥è‡ªå®šä¹‰ï¼Œé»˜è®¤æ˜¯ elasticsearch-ssl-http.zipZip file written to /usr/local/elasticsearch/elasticsearch-8.17.3/elasticsearch-ssl-http.zip è§£å‹å¹¶å°†httpè¯ä¹¦æ‹·è´åˆ°config/certsç›®å½•ä¸‹ 12345678910111213$ unzip elasticsearch-ssl-http.zipArchive: elasticsearch-ssl-http.zip creating: elasticsearch/ inflating: elasticsearch/README.txt # è¯´æ˜æ–‡ä»¶ inflating: elasticsearch/http.p12 # httpè¯ä¹¦ inflating: elasticsearch/sample-elasticsearch.yml # ç¤ºä¾‹elasticsearché…ç½®æ–‡ä»¶ creating: kibana/ inflating: kibana/README.txt # è¯´æ˜æ–‡ä»¶ inflating: kibana/elasticsearch-ca.pem # kibanaç”¨äºéªŒè¯ESçš„è¯ä¹¦ï¼Œå³ elasticsearch.ssl.certificateAuthorities ä¸­çš„é…ç½® inflating: kibana/sample-kibana.yml # ç¤ºä¾‹kibanaé…ç½®æ–‡ä»¶# å°†httpè¯ä¹¦æ‹·è´åˆ°config/certsç›®å½•ä¸‹$ cp elasticsearch/http.p12 config/certs/http.p12 åˆ†å‘åˆ°ESé›†ç¾¤ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹ ä¸Šé¢åˆ›å»ºæ–°çš„è¯ä¹¦æ—¶æˆ‘ä»¬åªåœ¨ä¸€ä¸ªèŠ‚ç‚¹ä¸Šè¿›è¡Œå³å¯ï¼Œä¹‹åå°†ç”Ÿæˆå¥½çš„è¯ä¹¦åˆ†å‘åˆ°ESé›†ç¾¤ä¸­çš„å…¶å®ƒèŠ‚ç‚¹ï¼Œè¿™é‡Œå°±æ˜¯ http.p12 å’Œ transport.p12ï¼Œå°†å…¶æ‹·è´åˆ°æ¯ä¸ªèŠ‚ç‚¹çš„ config/certs ç›®å½•ä¸‹ï¼Œæ‹·è´å‰åšå¥½åŸè¯ä¹¦çš„å¤‡ä»½ã€‚ å¦‚æœ‰å¿…è¦ä¹Ÿå¯ä»¥æ‹·è´ ca.p12 æˆ–è€… http_ca.crt å’Œ http_ca.key åˆ°æ¯ä¸ªèŠ‚ç‚¹çš„ config/certs ç›®å½•ä¸‹ é‡å¯ESæœåŠ¡ é›†ç¾¤ä¸­çš„èŠ‚ç‚¹ä¾æ¬¡é‡å¯ 1$ bin/elasticsearch -d é‡å¯æ—¶å¯èƒ½ä¼šæŠ¥é”™ 12org.elasticsearch.ElasticsearchSecurityException: failed to load SSL configuration [xpack.security.transport.ssl] - cannot read configured [PKCS12] keystore (as a truststore) [/usr/local/elasticsearch/elasticsearch-8.17.3/config/certs/transport.p12] - this is usually caused by an incorrect password; (a keystore password was provided)# è™½ç„¶æˆ‘ä»¬æ²¡æœ‰ç»™transport.p12è®¾ç½®å¯†ç ï¼Œä½†è¿™é‡Œä¾æ—§æç¤ºæä¾›çš„å¯†ç ä¸æ­£ç¡®ï¼Œå®é™…ä¸Šè¿™é‡Œä½¿ç”¨çš„æ˜¯ secure_password è§£å†³æ–¹æ³• 12345678910# ä½¿ç”¨bin/elasticsearch-keystore listæŸ¥çœ‹ç°æœ‰çš„å¯†é’¥åˆ—è¡¨$ bin/elasticsearch-keystore listkeystore.seedxpack.security.http.ssl.keystore.secure_passwordxpack.security.transport.ssl.keystore.secure_passwordxpack.security.transport.ssl.truststore.secure_password# åˆ é™¤secure_passwordåå†æ¬¡é‡å¯ESæœåŠ¡å°±ä¼šæ­£å¸¸äº†$ bin/elasticsearch-keystore remove xpack.security.http.ssl.keystore.secure_password$ bin/elasticsearch-keystore remove xpack.security.transport.ssl.keystore.secure_password$ bin/elasticsearch-keystore remove xpack.security.transport.ssl.truststore.secure_password æ›¿æ¢Kibanaçš„è¯ä¹¦ å°†ä¸Šé¢åˆ›å»ºå¥½çš„ kibana/elasticsearch-ca.pem æ‹·è´åˆ°KibanaæœåŠ¡å™¨ï¼Œæ¯”å¦‚ /usr/local/kibana/kibana-8.17.3/config/certs/elasticsearch-ca.pem ä¿®æ”¹Kibanaé…ç½®æ–‡ä»¶ config/kibana.yml ä¸­çš„ elasticsearch.ssl.certificateAuthorities é…ç½®ï¼Œä½¿å…¶æŒ‡å‘ /usr/local/kibana/kibana-8.17.3/config/certs/elasticsearch-ca.pem 1elasticsearch.ssl.certificateAuthorities: [&quot;/usr/local/kibana/kibana-8.17.3/config/certs/elasticsearch-ca.pem&quot;] é‡å¯KibanaæœåŠ¡ è¯ä¹¦æ ¼å¼è½¬æ¢ 12345678# p12è½¬æ¢ä¸ºcrtæ ¼å¼$ openssl pkcs12 -in config/certs/ca.p12 -out config/certs/http_ca.crt -nokeys# p12è½¬æ¢ä¸ºkeyæ ¼å¼$ openssl pkcs12 -in config/certs/ca.p12 -out config/certs/http_ca.key -nocerts -nodes# p12è½¬æ¢ä¸ºpemæ ¼å¼$ openssl pkcs12 -in config/certs/ca.p12 -out config/certs/http_ca.pem -nodes# crtè½¬æ¢å›PKCS12æ ¼å¼$ openssl pkcs12 -export -out config/certs/http_ca.p12 -inkey config/certs/http_ca.key -in config/certs/http_ca.crt -name &quot;My CA&quot; ç”Ÿæˆhttpè¯ä¹¦æ—¶ä¸ºæ¯ä¸ªèŠ‚ç‚¹å•ç‹¬é…ç½®è¯ä¹¦ 12345678910111213141516171819202122232425262728293031323334353637383940414243Generate a certificate per node? [y/N]y # æ˜¯å¦ä¸ºæ¯ä¸ªèŠ‚ç‚¹å•ç‹¬é…ç½®è¯ä¹¦ï¼Œè¿™é‡Œé€‰æ‹©æ˜¯node #1 name: node-1 # èŠ‚ç‚¹åç§°ï¼Œå¿…é¡»ä¸ESé…ç½®æ–‡ä»¶ä¸­çš„node.nameä¸€è‡´Enter all the hostnames that you need, one per line. # è¾“å…¥ node-1 èŠ‚ç‚¹çš„hostnameWhen you are done, press &lt;ENTER&gt; once more to move on to the next step.localhost # ä¹ æƒ¯åŠ ä¸Š localhostip-10-250-0-239.cn-northwest-1.compute.internal # node-1 çš„ hostnameYou entered the following hostnames. - localhost - ip-10-250-0-239.cn-northwest-1.compute.internalIs this correct [Y/n]y # ç¡®è®¤æ˜¯å¦æ­£ç¡®Enter all the IP addresses that you need, one per line. # è¾“å…¥ node-1 èŠ‚ç‚¹çš„IPåœ°å€When you are done, press &lt;ENTER&gt; once more to move on to the next step.127.0.0.1 # ä¹ æƒ¯åŠ ä¸Š 127.0.0.110.250.0.239 # node-1 çš„ IPYou entered the following IP addresses. - 127.0.0.1 - 10.250.0.239Is this correct [Y/n]y # ç¡®è®¤æ˜¯å¦æ­£ç¡®Do you wish to change any of these options? [y/N]n # ä¸ä¿®æ”¹ä»»ä½•é€‰é¡¹Generate additional certificates? [Y/n]y # æ˜¯å¦ç”Ÿæˆå…¶ä»–è¯ä¹¦ï¼Œè¿™é‡Œé€‰æ‹©æ˜¯ï¼Œæ¥ç€ä¸ºå…¶å®ƒèŠ‚ç‚¹åˆ›å»ºè¯ä¹¦node #2 name: node-2 # èŠ‚ç‚¹åç§°ï¼Œå¿…é¡»ä¸ESé…ç½®æ–‡ä»¶ä¸­çš„node.nameä¸€è‡´# ä¾æ¬¡ä¸ºæ¯ä¸ªèŠ‚ç‚¹åˆ›å»ºè¯ä¹¦â€¦â€¦â€¦â€¦â€¦â€¦Generate additional certificates? [Y/n]n # åˆ›å»ºå¥½æ‰€æœ‰èŠ‚ç‚¹çš„è¯ä¹¦åï¼Œé€‰æ‹©nï¼Œä¸å†åˆ›å»ºæ–°çš„è¯ä¹¦If you wish to use a blank password, simply press &lt;enter&gt; at the prompt below.Provide a password for the &quot;http.p12&quot; file: [&lt;ENTER&gt; for none] # ç›´æ¥å›è½¦ä¸è®¾ç½®å¯†ç What filename should be used for the output zip file? [/usr/local/elasticsearch/elasticsearch-8.17.3/elasticsearch-ssl-http.zip] # è¾“å‡ºæ–‡ä»¶åï¼Œè¿™é‡Œå¯ä»¥è‡ªå®šä¹‰ï¼Œé»˜è®¤æ˜¯ elasticsearch-ssl-http.zipZip file written to /usr/local/elasticsearch/elasticsearch-8.17.3/elasticsearch-ssl-http.zip æ­¤æ—¶è§£å‹æŸ¥çœ‹æ–‡ä»¶ç»“æ„ 12345678910111213141516171819unzip elasticsearch-ssl-http.zipArchive: elasticsearch-ssl-http.zip creating: elasticsearch/ creating: elasticsearch/node-1/ inflating: elasticsearch/node-1/README.txt inflating: elasticsearch/node-1/http.p12 # node-1 çš„è¯ä¹¦ inflating: elasticsearch/node-1/sample-elasticsearch.yml creating: elasticsearch/node-2/ inflating: elasticsearch/node-2/README.txt inflating: elasticsearch/node-2/http.p12 # node-2 çš„è¯ä¹¦ inflating: elasticsearch/node-2/sample-elasticsearch.yml creating: elasticsearch/node-3/ inflating: elasticsearch/node-3/README.txt inflating: elasticsearch/node-3/http.p12 # node-3 çš„è¯ä¹¦ inflating: elasticsearch/node-3/sample-elasticsearch.yml creating: kibana/ inflating: kibana/README.txt inflating: kibana/elasticsearch-ca.pem # kibana çš„è¯ä¹¦ inflating: kibana/sample-kibana.yml å°†å¯¹åº”çš„è¯ä¹¦æ‹·è´åˆ°å¯¹åº”èŠ‚ç‚¹çš„ config/certs ç›®å½•ä¸‹","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç»Elasticsearchè¯ä¹¦è¿‡æœŸæ—¶çš„å¤„ç†æ–¹æ³• Elasticsearchç‰ˆæœ¬8.17.3 æœ¬æ–‡åŸºäº linuxä¸‹å®‰è£…Elasticsearch å®˜æ–¹æ–‡æ¡£:Updating node security certificates","date_published":"2025-04-16T13:30:05.000Z","tags":["æŠ€æœ¯","elastic","elasticsearch","elasticsearch"]},{"id":"https://blog.hanqunfeng.com/2025/04/07/elk-02-springboot/","url":"https://blog.hanqunfeng.com/2025/04/07/elk-02-springboot/","title":"Springbootæ•´åˆLogstashå®ç°æ—¥å¿—é‡‡é›†","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç»å¦‚ä½•åœ¨Springbooté¡¹ç›®ä¸­æ•´åˆLogStashå®ç°æ—¥å¿—é‡‡é›†</p>\n</li>\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡åŸºäºSpringboot2.7.xç‰ˆæœ¬è¿›è¡Œæµ‹è¯•ï¼ŒLogstashç‰ˆæœ¬ä¸º8.17.3</p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"ä½¿ç”¨logstashæ—¥å¿—æ’ä»¶\">ä½¿ç”¨logstashæ—¥å¿—æ’ä»¶</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><a href=\"https://github.com/logfellow/logstash-logback-encoder\">SpringBootçš„Logstashæ—¥å¿—æ’ä»¶</a>ï¼Œæœ¬æ–‡åªè¿›è¡Œç®€å•ä»‹ç»ï¼Œæ›´å¤šè¯¦ç»†é…ç½®å¯ä»¥å‚è€ƒ<a href=\"https://github.com/logfellow/logstash-logback-encoder\">å®˜æ–¹æ–‡æ¡£</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>å¼•å…¥ä¾èµ–ï¼Œè¿™é‡Œéœ€è¦æ³¨æ„8.xä»¥ä¸Šçš„ç‰ˆæœ¬éœ€è¦jdk11ï¼Œå¦‚æœæ˜¯jdk8çš„è¯å¯ä»¥ä½¿ç”¨6.xæˆ–7.xç‰ˆæœ¬</p>\n</li>\n</ul>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">   <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>net.logstash.logback<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">   <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>logstash-logback-encoder<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">   <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>7.3<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span> <span class=\"comment\">&lt;!-- ç‰ˆæœ¬å·æ ¹æ®å®é™…æƒ…å†µä¿®æ”¹ --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>æ³¨æ„ï¼š<br>\nspringboot2.7.xä»¥ä¸‹ç‰ˆæœ¬ï¼Œå»ºè®®ä½¿ç”¨logstash-logback-encoderçš„7.3ä»¥ä¸‹ç‰ˆæœ¬ã€‚<br>\nspringboot3.x.xä»¥ä¸Šç‰ˆæœ¬ï¼Œå»ºè®®ä½¿ç”¨logstash-logback-encoderçš„7.4åŠä»¥ä¸Šç‰ˆæœ¬ã€‚</p>\n</blockquote>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><code>logback-spring.xml</code>ä¸­æ·»åŠ logstashé…ç½®</p>\n</li>\n</ul>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?xml version=<span class=\"string\">&quot;1.0&quot;</span> encoding=<span class=\"string\">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">configuration</span> <span class=\"attr\">debug</span>=<span class=\"string\">&quot;false&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- æ§åˆ¶å°è¾“å‡º --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">appender</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;STDOUT&quot;</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;ch.qos.logback.core.ConsoleAppender&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">encoder</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;ch.qos.logback.classic.encoder.PatternLayoutEncoder&quot;</span>&gt;</span></span><br><span class=\"line\">            <span class=\"comment\">&lt;!--æ ¼å¼åŒ–è¾“å‡ºï¼š%dè¡¨ç¤ºæ—¥æœŸï¼Œ%threadè¡¨ç¤ºçº¿ç¨‹åï¼Œ%-5levelï¼šçº§åˆ«ä»å·¦æ˜¾ç¤º5ä¸ªå­—ç¬¦å®½åº¦ %logger&#123;50&#125;ï¼šç±»è·¯å¾„ï¼Œæœ€å¤§æ˜¾ç¤º50ä¸ªå­—ç¬¦ %Mï¼šæ–¹æ³•åç§° %Lï¼šè¡Œå· %msgï¼šæ—¥å¿—æ¶ˆæ¯ï¼Œ%næ˜¯æ¢è¡Œç¬¦--&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">pattern</span>&gt;</span>[%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125;] [%thread] %-5level [%X&#123;userName&#125;][%X&#123;userLocale&#125;] %logger&#123;50&#125; - %M - %L - %msg%n<span class=\"tag\">&lt;/<span class=\"name\">pattern</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">encoder</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">appender</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- logstashè¾“å‡º --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">appender</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;LOGSTASH&quot;</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;net.logstash.logback.appender.LogstashTcpSocketAppender&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">destination</span>&gt;</span>161.189.78.202:4560<span class=\"tag\">&lt;/<span class=\"name\">destination</span>&gt;</span> <span class=\"comment\">&lt;!-- logstashåœ°å€å’Œç«¯å£ --&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">encoder</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;net.logstash.logback.encoder.LogstashEncoder&quot;</span> &gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">timestampPattern</span>&gt;</span>yyyy-MM-dd&#x27;T&#x27;HH:mm:ss.SSS<span class=\"tag\">&lt;/<span class=\"name\">timestampPattern</span>&gt;</span> <span class=\"comment\">&lt;!-- æ—¶é—´æ ¼å¼ï¼Œè¿™ä¸ªæ˜¯é»˜è®¤å€¼ --&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">includeMdc</span>&gt;</span>true<span class=\"tag\">&lt;/<span class=\"name\">includeMdc</span>&gt;</span>   <span class=\"comment\">&lt;!-- é»˜è®¤true, trueè¡¨ç¤ºè¾“å‡ºMDCä¿¡æ¯ --&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">includeCallerData</span>&gt;</span>true<span class=\"tag\">&lt;/<span class=\"name\">includeCallerData</span>&gt;</span> <span class=\"comment\">&lt;!-- é»˜è®¤false, trueè¡¨ç¤ºè¾“å‡ºæ‰“å°æ—¥å¿—çš„ç±»åã€æ–¹æ³•åã€è¡Œå·ç­‰ä¿¡æ¯ --&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">customFields</span>&gt;</span>&#123;&quot;appname&quot;: &quot;springboot-logstash-demo&quot;&#125;<span class=\"tag\">&lt;/<span class=\"name\">customFields</span>&gt;</span> <span class=\"comment\">&lt;!-- è‡ªå®šä¹‰å­—æ®µ --&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">encoder</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">appender</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- æ—¥å¿—è¾“å‡ºçº§åˆ« --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">root</span> <span class=\"attr\">level</span>=<span class=\"string\">&quot;info&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">appender-ref</span> <span class=\"attr\">ref</span>=<span class=\"string\">&quot;STDOUT&quot;</span>/&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">appender-ref</span> <span class=\"attr\">ref</span>=<span class=\"string\">&quot;LOGSTASH&quot;</span>/&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">root</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ·»åŠ <code>config/springboot-demo.conf</code>é…ç½®</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">input &#123;</span><br><span class=\"line\">  tcp &#123;</span><br><span class=\"line\">    host =&gt; <span class=\"string\">&quot;0.0.0.0&quot;</span> <span class=\"comment\"># ç›‘å¬ä»»æ„åœ°å€</span></span><br><span class=\"line\">    port =&gt; <span class=\"string\">&quot;4560&quot;</span> <span class=\"comment\"># ç›‘å¬ç«¯å£</span></span><br><span class=\"line\">    mode =&gt; <span class=\"string\">&quot;server&quot;</span> <span class=\"comment\"># serveræ¨¡å¼</span></span><br><span class=\"line\">    codec =&gt; json_lines <span class=\"comment\"># ä½¿ç”¨json_linesæ ¼å¼</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">output &#123;</span><br><span class=\"line\">  stdout &#123;</span><br><span class=\"line\">    codec =&gt; rubydebug</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  elasticsearch &#123; <span class=\"comment\"># è¾“å‡ºåˆ°ES</span></span><br><span class=\"line\">        index =&gt; <span class=\"string\">&quot;%&#123;[appname]&#125;-%&#123;+YYYY-MM-DD&#125;&quot;</span> <span class=\"comment\"># ç´¢å¼•å,æŒ‰å¤©åˆ†éš”ï¼Œè¿™é‡Œä½¿ç”¨å˜é‡appnameä½œä¸ºç´¢å¼•å</span></span><br><span class=\"line\">        hosts =&gt; [<span class=\"string\">&quot;https://10.250.0.239:9200&quot;</span>] <span class=\"comment\"># ESåœ°å€</span></span><br><span class=\"line\">        user =&gt; <span class=\"string\">&quot;elastic&quot;</span>                   <span class=\"comment\"># ESç”¨æˆ·å</span></span><br><span class=\"line\">        password =&gt; <span class=\"string\">&quot;123456&quot;</span>                <span class=\"comment\"># ESå¯†ç </span></span><br><span class=\"line\">        ssl =&gt; <span class=\"literal\">true</span>                         <span class=\"comment\"># æ˜¯å¦å¯ç”¨SSLï¼Œå› ä¸ºè¿™é‡Œæ˜¯httpsè®¿é—®ES</span></span><br><span class=\"line\">        ssl_certificate_verification =&gt; <span class=\"literal\">false</span> <span class=\"comment\"># ç¦ç”¨è¯ä¹¦éªŒè¯</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¯åŠ¨logstash</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">bin/logstash -f config/springboot-demo.conf --config.reload.automatic</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>logstashå¯åŠ¨æˆåŠŸåï¼Œä¼šè¾“å‡ºç±»ä¼¼å¦‚ä¸‹ä¿¡æ¯</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">            <span class=\"string\">&quot;message&quot;</span> =&gt; <span class=\"string\">&quot;Tomcat started on port(s): 8088 (http) with context path &#x27;/springboot-logstash&#x27;&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;level_value&quot;</span> =&gt; 20000,</span><br><span class=\"line\">            <span class=\"string\">&quot;appname&quot;</span> =&gt; <span class=\"string\">&quot;springboot-logstash-demo&quot;</span>,</span><br><span class=\"line\">              <span class=\"string\">&quot;level&quot;</span> =&gt; <span class=\"string\">&quot;INFO&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;logger_name&quot;</span> =&gt; <span class=\"string\">&quot;org.springframework.boot.web.embedded.tomcat.TomcatWebServer&quot;</span>,</span><br><span class=\"line\">         <span class=\"string\">&quot;@timestamp&quot;</span> =&gt; 2025-04-07T09:39:43.569Z,</span><br><span class=\"line\">           <span class=\"string\">&quot;@version&quot;</span> =&gt; <span class=\"string\">&quot;1&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;thread_name&quot;</span> =&gt; <span class=\"string\">&quot;restartedMain&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;caller_class_name&quot;</span> =&gt; <span class=\"string\">&quot;org.springframework.boot.web.embedded.tomcat.TomcatWebServer&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;caller_file_name&quot;</span> =&gt; <span class=\"string\">&quot;TomcatWebServer.java&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;caller_method_name&quot;</span> =&gt; <span class=\"string\">&quot;start&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;caller_line_number&quot;</span> =&gt; 220,</span><br><span class=\"line\">        <span class=\"string\">&quot;userName&quot;</span> =&gt; <span class=\"string\">&quot;admin&quot;</span>, <span class=\"comment\"># MDCä¿¡æ¯é»˜è®¤ä¼šæ‰“å°</span></span><br><span class=\"line\">        <span class=\"string\">&quot;userLocale&quot;</span> =&gt; <span class=\"string\">&quot;zh_CN&quot;</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¯ä»¥è®¿é—®ESæˆ–è€…KibanaæŸ¥çœ‹ç´¢å¼•ä¿¡æ¯ï¼Œè¿™é‡Œä¸å†èµ˜è¿°ã€‚</p>\n</li>\n</ul>\n","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç»å¦‚ä½•åœ¨Springbooté¡¹ç›®ä¸­æ•´åˆLogStashå®ç°æ—¥å¿—é‡‡é›† æœ¬æ–‡åŸºäºSpringboot2.7.xç‰ˆæœ¬è¿›è¡Œæµ‹è¯•ï¼ŒLogstashç‰ˆæœ¬ä¸º8.17.3 ä½¿ç”¨logstashæ—¥å¿—æ’ä»¶ SpringBootçš„Logstashæ—¥å¿—æ’ä»¶ï¼Œæœ¬æ–‡åªè¿›è¡Œç®€å•ä»‹ç»ï¼Œæ›´å¤šè¯¦ç»†é…ç½®å¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£ å¼•å…¥ä¾èµ–ï¼Œè¿™é‡Œéœ€è¦æ³¨æ„8.xä»¥ä¸Šçš„ç‰ˆæœ¬éœ€è¦jdk11ï¼Œå¦‚æœæ˜¯jdk8çš„è¯å¯ä»¥ä½¿ç”¨6.xæˆ–7.xç‰ˆæœ¬ 12345&lt;dependency&gt; &lt;groupId&gt;net.logstash.logback&lt;/groupId&gt; &lt;artifactId&gt;logstash-logback-encoder&lt;/artifactId&gt; &lt;version&gt;7.3&lt;/version&gt; &lt;!-- ç‰ˆæœ¬å·æ ¹æ®å®é™…æƒ…å†µä¿®æ”¹ --&gt;&lt;/dependency&gt; æ³¨æ„ï¼š springboot2.7.xä»¥ä¸‹ç‰ˆæœ¬ï¼Œå»ºè®®ä½¿ç”¨logstash-logback-encoderçš„7.3ä»¥ä¸‹ç‰ˆæœ¬ã€‚ springboot3.x.xä»¥ä¸Šç‰ˆæœ¬ï¼Œå»ºè®®ä½¿ç”¨logstash-logback-encoderçš„7.4åŠä»¥ä¸Šç‰ˆæœ¬ã€‚ logback-spring.xmlä¸­æ·»åŠ logstashé…ç½® 123456789101112131415161718192021222324252627&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;configuration debug=&quot;false&quot;&gt; &lt;!-- æ§åˆ¶å°è¾“å‡º --&gt; &lt;appender name=&quot;STDOUT&quot; class=&quot;ch.qos.logback.core.ConsoleAppender&quot;&gt; &lt;encoder class=&quot;ch.qos.logback.classic.encoder.PatternLayoutEncoder&quot;&gt; &lt;!--æ ¼å¼åŒ–è¾“å‡ºï¼š%dè¡¨ç¤ºæ—¥æœŸï¼Œ%threadè¡¨ç¤ºçº¿ç¨‹åï¼Œ%-5levelï¼šçº§åˆ«ä»å·¦æ˜¾ç¤º5ä¸ªå­—ç¬¦å®½åº¦ %logger&#123;50&#125;ï¼šç±»è·¯å¾„ï¼Œæœ€å¤§æ˜¾ç¤º50ä¸ªå­—ç¬¦ %Mï¼šæ–¹æ³•åç§° %Lï¼šè¡Œå· %msgï¼šæ—¥å¿—æ¶ˆæ¯ï¼Œ%næ˜¯æ¢è¡Œç¬¦--&gt; &lt;pattern&gt;[%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125;] [%thread] %-5level [%X&#123;userName&#125;][%X&#123;userLocale&#125;] %logger&#123;50&#125; - %M - %L - %msg%n&lt;/pattern&gt; &lt;/encoder&gt; &lt;/appender&gt; &lt;!-- logstashè¾“å‡º --&gt; &lt;appender name=&quot;LOGSTASH&quot; class=&quot;net.logstash.logback.appender.LogstashTcpSocketAppender&quot;&gt; &lt;destination&gt;161.189.78.202:4560&lt;/destination&gt; &lt;!-- logstashåœ°å€å’Œç«¯å£ --&gt; &lt;encoder class=&quot;net.logstash.logback.encoder.LogstashEncoder&quot; &gt; &lt;timestampPattern&gt;yyyy-MM-dd&#x27;T&#x27;HH:mm:ss.SSS&lt;/timestampPattern&gt; &lt;!-- æ—¶é—´æ ¼å¼ï¼Œè¿™ä¸ªæ˜¯é»˜è®¤å€¼ --&gt; &lt;includeMdc&gt;true&lt;/includeMdc&gt; &lt;!-- é»˜è®¤true, trueè¡¨ç¤ºè¾“å‡ºMDCä¿¡æ¯ --&gt; &lt;includeCallerData&gt;true&lt;/includeCallerData&gt; &lt;!-- é»˜è®¤false, trueè¡¨ç¤ºè¾“å‡ºæ‰“å°æ—¥å¿—çš„ç±»åã€æ–¹æ³•åã€è¡Œå·ç­‰ä¿¡æ¯ --&gt; &lt;customFields&gt;&#123;&quot;appname&quot;: &quot;springboot-logstash-demo&quot;&#125;&lt;/customFields&gt; &lt;!-- è‡ªå®šä¹‰å­—æ®µ --&gt; &lt;/encoder&gt; &lt;/appender&gt; &lt;!-- æ—¥å¿—è¾“å‡ºçº§åˆ« --&gt; &lt;root level=&quot;info&quot;&gt; &lt;appender-ref ref=&quot;STDOUT&quot;/&gt; &lt;appender-ref ref=&quot;LOGSTASH&quot;/&gt; &lt;/root&gt;&lt;/configuration&gt; æ·»åŠ config/springboot-demo.confé…ç½® 123456789101112131415161718192021input &#123; tcp &#123; host =&gt; &quot;0.0.0.0&quot; # ç›‘å¬ä»»æ„åœ°å€ port =&gt; &quot;4560&quot; # ç›‘å¬ç«¯å£ mode =&gt; &quot;server&quot; # serveræ¨¡å¼ codec =&gt; json_lines # ä½¿ç”¨json_linesæ ¼å¼ &#125;&#125;output &#123; stdout &#123; codec =&gt; rubydebug &#125; elasticsearch &#123; # è¾“å‡ºåˆ°ES index =&gt; &quot;%&#123;[appname]&#125;-%&#123;+YYYY-MM-DD&#125;&quot; # ç´¢å¼•å,æŒ‰å¤©åˆ†éš”ï¼Œè¿™é‡Œä½¿ç”¨å˜é‡appnameä½œä¸ºç´¢å¼•å hosts =&gt; [&quot;https://10.250.0.239:9200&quot;] # ESåœ°å€ user =&gt; &quot;elastic&quot; # ESç”¨æˆ·å password =&gt; &quot;123456&quot; # ESå¯†ç  ssl =&gt; true # æ˜¯å¦å¯ç”¨SSLï¼Œå› ä¸ºè¿™é‡Œæ˜¯httpsè®¿é—®ES ssl_certificate_verification =&gt; false # ç¦ç”¨è¯ä¹¦éªŒè¯ &#125;&#125; å¯åŠ¨logstash 1bin/logstash -f config/springboot-demo.conf --config.reload.automatic logstashå¯åŠ¨æˆåŠŸåï¼Œä¼šè¾“å‡ºç±»ä¼¼å¦‚ä¸‹ä¿¡æ¯ 12345678910111213141516&#123; &quot;message&quot; =&gt; &quot;Tomcat started on port(s): 8088 (http) with context path &#x27;/springboot-logstash&#x27;&quot;, &quot;level_value&quot; =&gt; 20000, &quot;appname&quot; =&gt; &quot;springboot-logstash-demo&quot;, &quot;level&quot; =&gt; &quot;INFO&quot;, &quot;logger_name&quot; =&gt; &quot;org.springframework.boot.web.embedded.tomcat.TomcatWebServer&quot;, &quot;@timestamp&quot; =&gt; 2025-04-07T09:39:43.569Z, &quot;@version&quot; =&gt; &quot;1&quot;, &quot;thread_name&quot; =&gt; &quot;restartedMain&quot;, &quot;caller_class_name&quot; =&gt; &quot;org.springframework.boot.web.embedded.tomcat.TomcatWebServer&quot;, &quot;caller_file_name&quot; =&gt; &quot;TomcatWebServer.java&quot;, &quot;caller_method_name&quot; =&gt; &quot;start&quot;, &quot;caller_line_number&quot; =&gt; 220, &quot;userName&quot; =&gt; &quot;admin&quot;, # MDCä¿¡æ¯é»˜è®¤ä¼šæ‰“å° &quot;userLocale&quot; =&gt; &quot;zh_CN&quot;&#125; å¯ä»¥è®¿é—®ESæˆ–è€…KibanaæŸ¥çœ‹ç´¢å¼•ä¿¡æ¯ï¼Œè¿™é‡Œä¸å†èµ˜è¿°ã€‚","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç»å¦‚ä½•åœ¨Springbooté¡¹ç›®ä¸­æ•´åˆLogStashå®ç°æ—¥å¿—é‡‡é›† æœ¬æ–‡åŸºäºSpringboot2.7.xç‰ˆæœ¬è¿›è¡Œæµ‹è¯•ï¼ŒLogstashç‰ˆæœ¬ä¸º8.17.3","date_published":"2025-04-07T13:30:05.000Z","tags":["æŠ€æœ¯","springboot","logstash","springboot","logstash"]},{"id":"https://blog.hanqunfeng.com/2025/03/27/elk-01/","url":"https://blog.hanqunfeng.com/2025/03/27/elk-01/","title":"ä¸€æ–‡ææ‡‚ELK","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç»å¦‚ä½•åœ¨linuxä¸‹å®‰è£…LogStashå’ŒFileBeat</p>\n</li>\n<li class=\"lvl-2\">\n<p>é€šè¿‡ç¤ºä¾‹è®²è§£ELKçš„ç»å…¸æ¶æ„å’Œé«˜å¹¶å‘æ¶æ„çš„å®ç°è¿‡ç¨‹</p>\n</li>\n<li class=\"lvl-2\">\n<p>LogStashç‰ˆæœ¬8.17.3ï¼ŒFileBeatç‰ˆæœ¬8.17.3</p>\n</li>\n<li class=\"lvl-2\">\n<p>Elasticsearchç‰ˆæœ¬8.17.3ï¼Œ<a href=\"/2025/03/20/elasticsearch-01-install/\" title=\"linuxä¸‹å®‰è£…Elasticsearch\">linuxä¸‹å®‰è£…Elasticsearch</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>Kibanaç‰ˆæœ¬8.17.3ï¼Œ<a href=\"/2025/03/21/kibana-01-install/\" title=\"linuxä¸‹å®‰è£…Kibana\">linuxä¸‹å®‰è£…Kibana</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>Elasticsearché›†ç¾¤æ­å»ºï¼Œ<a href=\"/2025/03/24/elasticsearch-02-install-cluster/\" title=\"linuxä¸‹å®‰è£…Elasticsearché›†ç¾¤\">linuxä¸‹å®‰è£…Elasticsearché›†ç¾¤</a></p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"Logstashæ¦‚è¿°\">Logstashæ¦‚è¿°</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><a href=\"https://www.elastic.co/cn/logstash\">Logstash</a> æ˜¯å…è´¹ä¸”å¼€æ”¾çš„æœåŠ¡å™¨ç«¯æ•°æ®å¤„ç†ç®¡é“ï¼Œèƒ½å¤Ÿä»å¤šä¸ªæ¥æºé‡‡é›†æ•°æ®ï¼Œè½¬æ¢æ•°æ®ï¼Œç„¶åå°†æ•°æ®å‘é€åˆ°æ‚¨æœ€å–œæ¬¢çš„å­˜å‚¨åº“ä¸­ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>Logstashæ•°æ®ä¼ è¾“åŸç†<br>\n<img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/uPic/image-2.png\" alt=\"\"></p>\n</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1.æ•°æ®é‡‡é›†ä¸è¾“å…¥ï¼šLogstashæ”¯æŒå„ç§è¾“å…¥é€‰æ‹©ï¼Œèƒ½å¤Ÿä»¥è¿ç»­çš„æµå¼ä¼ è¾“æ–¹å¼ï¼Œè½»æ¾åœ°ä»æ—¥å¿—ã€æŒ‡æ ‡ã€Webåº”ç”¨ä»¥åŠæ•°æ®å­˜å‚¨ä¸­é‡‡é›†æ•°æ®ã€‚</span><br><span class=\"line\">2.å®æ—¶è§£æå’Œæ•°æ®è½¬æ¢ï¼šé€šè¿‡Logstashè¿‡æ»¤å™¨è§£æå„ä¸ªäº‹ä»¶ï¼Œè¯†åˆ«å·²å‘½åçš„å­—æ®µæ¥æ„å»ºç»“æ„ï¼Œå¹¶å°†å®ƒä»¬è½¬æ¢æˆé€šç”¨æ ¼å¼ï¼Œæœ€ç»ˆå°†æ•°æ®ä»æºç«¯ä¼ è¾“åˆ°å­˜å‚¨åº“ä¸­ã€‚</span><br><span class=\"line\">3.å­˜å‚¨ä¸æ•°æ®å¯¼å‡ºï¼šLogstashæä¾›å¤šç§è¾“å‡ºé€‰æ‹©ï¼Œå¯ä»¥å°†æ•°æ®å‘é€åˆ°æŒ‡å®šçš„åœ°æ–¹ã€‚</span><br></pre></td></tr></table></figure>\n<p><img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/uPic/%E6%88%AA%E5%9B%BE-3.png\" alt=\"\"></p>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Logstashé€šè¿‡ç®¡é“å®Œæˆæ•°æ®çš„é‡‡é›†ä¸å¤„ç†ï¼Œç®¡é“é…ç½®ä¸­åŒ…å«inputã€outputå’Œfilterï¼ˆå¯é€‰ï¼‰æ’ä»¶ï¼Œinputå’Œoutputç”¨æ¥é…ç½®è¾“å…¥å’Œè¾“å‡ºæ•°æ®æºã€filterç”¨æ¥å¯¹æ•°æ®è¿›è¡Œè¿‡æ»¤æˆ–é¢„å¤„ç†ã€‚</p>\n</li>\n</ul>\n<h2 id=\"Logstashä¸‹è½½å®‰è£…\">Logstashä¸‹è½½å®‰è£…</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¸‹è½½åœ°å€ï¼š<a href=\"https://www.elastic.co/cn/downloads/past-releases#logstash\">https://www.elastic.co/cn/downloads/past-releases#logstash</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>é€‰æ‹©å¯¹åº”çš„ç‰ˆæœ¬ï¼šè¿™é‡Œé€‰æ‹©å½“å‰çš„æœ€æ–°ç‰ˆ<code>LogStash 8.17.3</code>ï¼Œä¹‹åé€‰æ‹©å¯¹åº”çš„æ“ä½œç³»ç»Ÿ<code>LINUX X86_64</code></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget https://artifacts.elastic.co/downloads/logstash/logstash-8.17.3-linux-x86_64.tar.gz</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¸‹è½½å®Œæˆåè§£å‹åˆ°<code>/usr/local/logstash</code>ç›®å½•ä¸‹ï¼Œè§£å‹å‘½ä»¤å¦‚ä¸‹ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">mkdir</span> /usr/local/logstash</span><br><span class=\"line\">tar -zxvf logstash-8.17.3-linux-x86_64.tar.gz -C /usr/local/logstash</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>elasticsearchå’Œkibanaéƒ½ä¸èƒ½ç”¨rootç”¨æˆ·å¯åŠ¨ï¼Œä¸ºäº†ç»Ÿä¸€ç®¡ç†ï¼Œlogstashä¹Ÿä½¿ç”¨è¿™ä¸ªç”¨æˆ·ï¼ˆéå¿…è¦ï¼‰</p>\n</li>\n<li class=\"lvl-2\">\n<p>åˆ›å»ºç”¨æˆ·<code>elastic</code>ï¼Œå¹¶è®¾ç½®å¯†ç ï¼Œè¿™ä¸€æ­¥æˆ‘ä»¬åœ¨å®‰è£…elasticsearchçš„æ—¶å€™å·²ç»é…ç½®è¿‡äº†ï¼Œè¿™é‡Œå°±ä¸å†èµ˜è¿°äº†</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">useradd elastic</span><br><span class=\"line\">passwd elastic</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¿®æ”¹logstashå®‰è£…ç›®å½•çš„ç”¨æˆ·æƒé™</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">chown</span> -R elastic:elastic /usr/local/logstash</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ‡æ¢åˆ°elasticç”¨æˆ·ä¸‹æ‰§è¡Œå‘½ä»¤</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åˆ‡æ¢ç”¨æˆ·</span></span><br><span class=\"line\">su - elastic</span><br><span class=\"line\"><span class=\"comment\"># è¿›å…¥logstashå®‰è£…ç›®å½•</span></span><br><span class=\"line\"><span class=\"built_in\">cd</span> /usr/local/logstash/logstash-8.17.3/</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¿è¡Œä¸€ä¸ªç®€å•çš„æµ‹è¯•</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># -e: ç›´æ¥æŠŠé…ç½®æ”¾åœ¨å‘½ä»¤ä¸­ï¼Œè¿™æ ·å¯ä»¥æœ‰æ•ˆå¿«é€Ÿè¿›è¡Œæµ‹è¯•</span></span><br><span class=\"line\"><span class=\"comment\"># input &#123; stdin &#123; &#125; &#125;: è¾“å…¥æ’ä»¶ï¼Œä»æ ‡å‡†è¾“å…¥ä¸­è¯»å–æ•°æ®</span></span><br><span class=\"line\"><span class=\"comment\"># output &#123; stdout &#123;&#125; &#125;: è¾“å‡ºæ’ä»¶ï¼Œå°†æ•°æ®è¾“å‡ºåˆ°æ ‡å‡†è¾“å‡º</span></span><br><span class=\"line\"><span class=\"comment\"># è¿™é‡ŒåªåŒ…å«äº† input å’Œ output ä¸¤ä¸ªéƒ¨åˆ†ï¼Œå®é™…ä½¿ç”¨ä¸­è¿˜éœ€è¦æ·»åŠ  filter éƒ¨åˆ†</span></span><br><span class=\"line\">./bin/logstash -e <span class=\"string\">&#x27;input &#123; stdin &#123; &#125; &#125; output &#123; stdout &#123;&#125; &#125;&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"># è¾“å‡ºï¼š</span></span><br><span class=\"line\">ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ <span class=\"comment\"># è¾“å‡ºå¯åŠ¨ä¿¡æ¯</span></span><br><span class=\"line\">The stdin plugin is now waiting <span class=\"keyword\">for</span> input: <span class=\"comment\"># è¾“å‡ºæç¤ºä¿¡æ¯ï¼Œæç¤ºä½ è¾“å…¥å†…å®¹</span></span><br><span class=\"line\">hello world  <span class=\"comment\"># æˆ‘è¾“å…¥å†…å®¹</span></span><br><span class=\"line\"><span class=\"comment\"># logstashè¾“å‡ºå†…å®¹</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">       <span class=\"string\">&quot;message&quot;</span> =&gt; <span class=\"string\">&quot;hello world&quot;</span>,</span><br><span class=\"line\">      <span class=\"string\">&quot;@version&quot;</span> =&gt; <span class=\"string\">&quot;1&quot;</span>,</span><br><span class=\"line\">         <span class=\"string\">&quot;event&quot;</span> =&gt; &#123;</span><br><span class=\"line\">        <span class=\"string\">&quot;original&quot;</span> =&gt; <span class=\"string\">&quot;hello world&quot;</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">          <span class=\"string\">&quot;host&quot;</span> =&gt; &#123;</span><br><span class=\"line\">        <span class=\"string\">&quot;hostname&quot;</span> =&gt; <span class=\"string\">&quot;ip-10-250-0-239.cn-northwest-1.compute.internal&quot;</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"string\">&quot;@timestamp&quot;</span> =&gt; 2025-03-27T06:48:12.810617855Z</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¹Ÿå¯ä»¥é€šè¿‡é…ç½®æ–‡ä»¶å¯åŠ¨logstash</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># vim test.conf</span></span><br><span class=\"line\">input &#123;</span><br><span class=\"line\">  stdin &#123; &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">output &#123;</span><br><span class=\"line\">  stdout &#123; codec =&gt; rubydebug &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># codec =&gt; rubydebug : æ˜¯æŒ‡å®šäº†ä¸€ä¸ªç¼–ç å™¨ï¼ˆCodecï¼‰ä¸º rubydebugã€‚</span></span><br><span class=\"line\"><span class=\"comment\"># ç¼–ç å™¨è´Ÿè´£å¦‚ä½•æ ¼å¼åŒ–è¾“å‡ºçš„æ•°æ®ã€‚</span></span><br><span class=\"line\"><span class=\"comment\"># Rubydebug ç¼–ç å™¨æ˜¯ä¸€ç§ç‰¹åˆ«é€‚åˆå¼€å‘å’Œè°ƒè¯•ç›®çš„çš„ç¼–ç å™¨ï¼Œå› ä¸ºå®ƒèƒ½ä»¥ç›¸å½“æ˜“è¯»çš„å½¢å¼å±•ç¤ºå¤æ‚çš„ç»“æ„åŒ–æ•°æ®ï¼Œæ¯”å¦‚åµŒå¥—çš„å“ˆå¸Œè¡¨æˆ–è€…æ•°ç»„ã€‚</span></span><br><span class=\"line\"><span class=\"comment\"># é™¤äº† Rubydebug ç¼–ç å™¨ï¼ŒLogstash è¿˜æä¾›äº†å…¶ä»–å‡ ç§ç¼–ç å™¨ï¼Œæ¯”å¦‚ jsonã€plainã€multiline ç­‰ç­‰ã€‚</span></span><br><span class=\"line\"><span class=\"comment\"># å…·ä½“å¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼šhttps://www.elastic.co/guide/en/logstash/current/codec-plugins.html</span></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">./bin/logstash -f ./test.conf</span><br></pre></td></tr></table></figure>\n<h2 id=\"Logstashæ’ä»¶\">Logstashæ’ä»¶</h2>\n<h3 id=\"Input-Plugins\">Input Plugins</h3>\n<blockquote>\n<p><a href=\"https://www.elastic.co/guide/en/logstash/8.17/input-plugins.html\">https://www.elastic.co/guide/en/logstash/8.17/input-plugins.html</a></p>\n</blockquote>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¸€ä¸ª Pipelineå¯ä»¥æœ‰å¤šä¸ªinputæ’ä»¶</p>\n</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- Stdin / File</span><br><span class=\"line\">- Beats / Log4J /Elasticsearch / JDBC / Kafka /Rabbitmq /Redis</span><br><span class=\"line\">- JMX/ HTTP / Websocket / UDP / TCP</span><br><span class=\"line\">- Google Cloud Storage / S3</span><br><span class=\"line\">- Github / Twitter</span><br></pre></td></tr></table></figure>\n<h3 id=\"Filter-Plugins\">Filter Plugins</h3>\n<blockquote>\n<p><a href=\"https://www.elastic.co/guide/en/logstash/8.17/filter-plugins.html\">https://www.elastic.co/guide/en/logstash/8.17/filter-plugins.html</a></p>\n</blockquote>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Filter Pluginå¯ä»¥å¯¹Logstash Eventè¿›è¡Œå„ç§å¤„ç†ï¼Œä¾‹å¦‚è§£æï¼Œåˆ é™¤å­—æ®µï¼Œç±»å‹è½¬æ¢</p>\n</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- Date: æ—¥æœŸè§£æ</span><br><span class=\"line\">- Dissect: åˆ†å‰²ç¬¦è§£æ</span><br><span class=\"line\">- Grok: æ­£åˆ™åŒ¹é…è§£æ</span><br><span class=\"line\">- Mutate: å¯¹å­—æ®µåšå„ç§æ“ä½œ</span><br><span class=\"line\">- Convert : ç±»å‹è½¬æ¢</span><br><span class=\"line\">- Gsub : å­—ç¬¦ä¸²æ›¿æ¢</span><br><span class=\"line\">- Split / Join /Merge:  å­—ç¬¦ä¸²åˆ‡å‰²ï¼Œæ•°ç»„åˆå¹¶å­—ç¬¦ä¸²ï¼Œæ•°ç»„åˆå¹¶æ•°ç»„</span><br><span class=\"line\">- Rename: å­—æ®µé‡å‘½å</span><br><span class=\"line\">- Update / Replace: å­—æ®µå†…å®¹æ›´æ–°æ›¿æ¢</span><br><span class=\"line\">- Remove_field: å­—æ®µåˆ é™¤</span><br><span class=\"line\">- Ruby: åˆ©ç”¨Ruby ä»£ç æ¥åŠ¨æ€ä¿®æ”¹Event</span><br></pre></td></tr></table></figure>\n<h3 id=\"Output-Plugins\">Output Plugins</h3>\n<blockquote>\n<p><a href=\"https://www.elastic.co/guide/en/logstash/8.17/output-plugins.html\">https://www.elastic.co/guide/en/logstash/8.17/output-plugins.html</a></p>\n</blockquote>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å°†Eventå‘é€åˆ°ç‰¹å®šçš„ç›®çš„åœ°ï¼Œæ˜¯ Pipeline çš„æœ€åä¸€ä¸ªé˜¶æ®µã€‚å¸¸è§ Output Pluginsï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- Elasticsearch</span><br><span class=\"line\">- Email / Pageduty</span><br><span class=\"line\">- Influxdb / Kafka / Mongodb / Opentsdb / Zabbix</span><br><span class=\"line\">- Http / TCP / Websocket</span><br></pre></td></tr></table></figure>\n<h3 id=\"Codec-Plugins\">Codec Plugins</h3>\n<blockquote>\n<p><a href=\"https://www.elastic.co/guide/en/logstash/8.17/codec-plugins.html\">https://www.elastic.co/guide/en/logstash/8.17/codec-plugins.html</a></p>\n</blockquote>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å°†åŸå§‹æ•°æ®decodeæˆEvent;å°†Event encodeæˆç›®æ ‡æ•°æ®ï¼Œå†…ç½®çš„Codec Plugins:</p>\n</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- Line / Multiline</span><br><span class=\"line\">- JSON / Avro / Cef (ArcSight Common Event Format)</span><br><span class=\"line\">- Dots / Rubydebug</span><br></pre></td></tr></table></figure>\n<h2 id=\"FileBeatæ¦‚è¿°\">FileBeatæ¦‚è¿°</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><a href=\"https://www.elastic.co/cn/beats\">Beats</a> æ˜¯ä¸€ä¸ªå…è´¹ä¸”å¼€æ”¾çš„å¹³å°ï¼Œé›†åˆäº†å¤šç§å•ä¸€ç”¨é€”çš„æ•°æ®é‡‡é›†å™¨ã€‚å®ƒä»¬ä»æˆç™¾ä¸Šåƒæˆ–æˆåƒä¸Šä¸‡å°æœºå™¨å’Œç³»ç»Ÿå‘ Logstash æˆ– Elasticsearch å‘é€æ•°æ®ã€‚<br>\n<img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/uPic/iEmI1C.png\" alt=\"\"></p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://www.elastic.co/cn/beats/filebeat\">FileBeat</a> ä¸“é—¨ç”¨äºè½¬å‘å’Œæ”¶é›†æ—¥å¿—æ•°æ®çš„è½»é‡çº§é‡‡é›†å·¥å…·ã€‚å®ƒå¯ä»¥ä½œä¸ºä»£ç†å®‰è£…åœ¨æœåŠ¡å™¨ä¸Šï¼ŒFileBeatç›‘è§†æŒ‡å®šè·¯å¾„çš„æ—¥å¿—æ–‡ä»¶ï¼Œæ”¶é›†æ—¥å¿—æ•°æ®ï¼Œå¹¶å°†æ”¶é›†åˆ°çš„æ—¥å¿—è½¬å‘åˆ°Elasticsearchæˆ–è€…Logstashã€‚</p>\n</li>\n</ul>\n<h2 id=\"logstash-vs-FileBeat\">logstash vs FileBeat</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Logstashæ˜¯åœ¨jvmä¸Šè¿è¡Œçš„ï¼Œèµ„æºæ¶ˆè€—æ¯”è¾ƒå¤§ã€‚è€ŒFileBeatæ˜¯åŸºäºgolangç¼–å†™çš„ï¼ŒåŠŸèƒ½è¾ƒå°‘ä½†èµ„æºæ¶ˆè€—ä¹Ÿæ¯”è¾ƒå°ï¼Œæ›´è½»é‡çº§ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>Logstash å’ŒFilebeatéƒ½å…·æœ‰æ—¥å¿—æ”¶é›†åŠŸèƒ½ï¼ŒFilebeatæ›´è½»é‡ï¼Œå ç”¨èµ„æºæ›´å°‘</p>\n</li>\n<li class=\"lvl-2\">\n<p>Logstash å…·æœ‰FilteråŠŸèƒ½ï¼Œèƒ½è¿‡æ»¤åˆ†ææ—¥å¿—</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä¸€èˆ¬ç»“æ„éƒ½æ˜¯Filebeaté‡‡é›†æ—¥å¿—ï¼Œç„¶åå‘é€åˆ°æ¶ˆæ¯é˜Ÿåˆ—ã€Redisã€MQä¸­ï¼Œç„¶åLogstashå»è·å–ï¼Œåˆ©ç”¨FilteråŠŸèƒ½è¿‡æ»¤åˆ†æï¼Œç„¶åå­˜å‚¨åˆ°Elasticsearchä¸­</p>\n</li>\n<li class=\"lvl-2\">\n<p>FileBeatå’ŒLogstashé…åˆï¼Œå®ç°èƒŒå‹æœºåˆ¶ã€‚å½“å°†æ•°æ®å‘é€åˆ°Logstashæˆ– Elasticsearchæ—¶ï¼ŒFilebeatä½¿ç”¨èƒŒå‹æ•æ„Ÿåè®®ï¼Œä»¥åº”å¯¹æ›´å¤šçš„æ•°æ®é‡ã€‚å¦‚æœLogstashæ­£åœ¨å¿™äºå¤„ç†æ•°æ®ï¼Œåˆ™ä¼šå‘Šè¯‰Filebeat å‡æ…¢è¯»å–é€Ÿåº¦ã€‚ä¸€æ—¦æ‹¥å µå¾—åˆ°è§£å†³ï¼ŒFilebeatå°±ä¼šæ¢å¤åˆ°åŸæ¥çš„æ­¥ä¼å¹¶ç»§ç»­ä¼ è¾“æ•°æ®ã€‚</p>\n</li>\n</ul>\n<h2 id=\"FileBeatä¸‹è½½å’Œå®‰è£…\">FileBeatä¸‹è½½å’Œå®‰è£…</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¸‹è½½åœ°å€ï¼š<a href=\"https://www.elastic.co/cn/downloads/past-releases#filebeat\">https://www.elastic.co/cn/downloads/past-releases#filebeat</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>é€‰æ‹©å¯¹åº”çš„ç‰ˆæœ¬ï¼šè¿™é‡Œé€‰æ‹©å½“å‰çš„æœ€æ–°ç‰ˆ<code>FileBeat 8.17.3</code>ï¼Œä¹‹åé€‰æ‹©å¯¹åº”çš„æ“ä½œç³»ç»Ÿ<code>LINUX X86_64</code></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget https://artifacts.elastic.co/downloads/beats/filebeat/filebeat-8.17.3-linux-x86_64.tar.gz</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¸‹è½½å®Œæˆåè§£å‹åˆ°<code>/usr/local/filebeat</code>ç›®å½•ä¸‹ï¼Œè§£å‹å‘½ä»¤å¦‚ä¸‹ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">mkdir</span> /usr/local/filebeat</span><br><span class=\"line\">tar -zxvf filebeat-8.17.3-linux-x86_64.tar.gz -C /usr/local/filebeat</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¿®æ”¹logstashå®‰è£…ç›®å½•çš„ç”¨æˆ·æƒé™</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">chown</span> -R elastic:elastic /usr/local/filebeat</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ‡æ¢åˆ°elasticç”¨æˆ·ä¸‹æ‰§è¡Œå‘½ä»¤</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åˆ‡æ¢ç”¨æˆ·</span></span><br><span class=\"line\">su - elastic</span><br><span class=\"line\"><span class=\"comment\"># è¿›å…¥ filebeat å®‰è£…ç›®å½•</span></span><br><span class=\"line\"><span class=\"built_in\">cd</span> /usr/local/filebeat/filebeat-8.17.3-linux-x86_64/</span><br></pre></td></tr></table></figure>\n<h2 id=\"ç»å…¸çš„ELKæ¶æ„\">ç»å…¸çš„ELKæ¶æ„</h2>\n<p><img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/uPic/%E6%88%AA%E5%9B%BE.png\" alt=\"\"></p>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Filebeatæ—¥å¿—æ”¶é›†ï¼šFilebeatä½œä¸ºè½»é‡çº§çš„æ—¥å¿—æ”¶é›†ä»£ç†ï¼Œéƒ¨ç½²åœ¨å®¢æˆ·ç«¯ä¸Šï¼Œæ¶ˆè€—èµ„æºå°‘ï¼Œèƒ½å¤Ÿé«˜æ•ˆåœ°æ”¶é›†æ—¥å¿—æ•°æ®ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>Logstashæ•°æ®å¤„ç†ï¼šLogstashä½œä¸ºæ•°æ®å¤„ç†ç®¡é“ï¼Œè´Ÿè´£å°†Filebeatæ”¶é›†çš„æ—¥å¿—æ•°æ®è¿›è¡Œè¿‡æ»¤ã€è½¬æ¢ç­‰æ“ä½œï¼Œç„¶åå‘é€åˆ°Elasticsearchè¿›è¡Œå­˜å‚¨ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>Elasticsearchå­˜å‚¨ä¸æœç´¢ï¼šElasticsearchæ˜¯ä¸€ä¸ªåŸºäºLuceneçš„åˆ†å¸ƒå¼æœç´¢å’Œåˆ†æå¼•æ“ï¼Œæä¾›å¼ºå¤§çš„æ•°æ®å­˜å‚¨å’Œæœç´¢èƒ½åŠ›ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>Kibanaå¯è§†åŒ–ï¼šKibanaä¸ºElasticsearchæä¾›Webå¯è§†åŒ–ç•Œé¢ï¼Œå…è®¸ç”¨æˆ·é€šè¿‡å›¾è¡¨ã€ä»ªè¡¨ç›˜ç­‰æ–¹å¼ç›´è§‚åœ°æŸ¥çœ‹å’Œåˆ†ææ—¥å¿—æ•°æ®ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>é€‚ç”¨åœºæ™¯ï¼šç»å…¸çš„ELKæ¶æ„ä¸»è¦é€‚ç”¨äºæ•°æ®é‡è¾ƒå°çš„å¼€å‘ç¯å¢ƒã€‚ç„¶è€Œï¼Œç”±äºç¼ºå°‘æ¶ˆæ¯é˜Ÿåˆ—çš„ç¼“å†²æœºåˆ¶ï¼Œå½“Logstashæˆ–Elasticsearchå‡ºç°æ•…éšœæ—¶ï¼Œå¯èƒ½å­˜åœ¨æ•°æ®ä¸¢å¤±çš„é£é™©ã€‚</p>\n</li>\n</ul>\n<h2 id=\"ä¸€ä¸ªç»å…¸ELKæ¶æ„ç¤ºä¾‹\">ä¸€ä¸ªç»å…¸ELKæ¶æ„ç¤ºä¾‹</h2>\n<h3 id=\"FileBeaté‡‡é›†NginxæœåŠ¡å™¨æ—¥å¿—å¹¶å‘é€åˆ°Logstash\">FileBeaté‡‡é›†NginxæœåŠ¡å™¨æ—¥å¿—å¹¶å‘é€åˆ°Logstash</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ›å»ºé…ç½®æ–‡ä»¶<code>filebeat-nginx.yml</code>ï¼Œå°†å…¶ä¿å­˜åˆ°Filebeatå®‰è£…ç›®å½•ä¸‹çš„confç›®å½•ä¸‹ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å› ä¸ºNginxçš„access.logæ—¥å¿—éƒ½æ˜¯ä»¥IPåœ°å€å¼€å¤´çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¿®æ”¹ä¸‹åŒ¹é…å­—æ®µã€‚</span></span><br><span class=\"line\"><span class=\"comment\"># ä¸ä»¥ipåœ°å€å¼€å¤´çš„è¡Œè¿½åŠ åˆ°ä¸Šä¸€è¡Œ</span></span><br><span class=\"line\"><span class=\"attr\">filebeat.inputs:</span> <span class=\"comment\"># è¾“å…¥æºé…ç½®</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">type:</span> <span class=\"string\">log</span> <span class=\"comment\"># æ—¥å¿—ç±»å‹</span></span><br><span class=\"line\">  <span class=\"attr\">enabled:</span> <span class=\"literal\">true</span> <span class=\"comment\"># æ˜¯å¦å¯ç”¨</span></span><br><span class=\"line\">  <span class=\"attr\">paths:</span> <span class=\"comment\"># é‡‡é›†è·¯å¾„</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">/var/log/nginx/access*.*</span></span><br><span class=\"line\">  <span class=\"attr\">exclude_files:</span> [<span class=\"string\">&quot;.gz$&quot;</span>] <span class=\"comment\"># æ’é™¤ä»¥.gz ç»“å°¾çš„æ–‡ä»¶</span></span><br><span class=\"line\">  <span class=\"attr\">multiline.pattern:</span> <span class=\"string\">&#x27;^\\\\d&#123;1,3&#125;\\\\.\\\\d&#123;1,3&#125;\\\\.\\\\d&#123;1,3&#125;\\\\.\\\\d&#123;1,3&#125;\\\\s&#x27;</span> <span class=\"comment\"># åŒ¹é…ä»¥IPåœ°å€å¼€å¤´ï¼Œå¹¶ç´§è·Ÿä¸€ä¸ªç©ºç™½å­—ç¬¦</span></span><br><span class=\"line\">  <span class=\"attr\">multiline.negate:</span> <span class=\"literal\">true</span> <span class=\"comment\"># ä¸ä»¥ipåœ°å€å¼€å¤´çš„è¡Œè¿½åŠ åˆ°ä¸Šä¸€è¡Œ</span></span><br><span class=\"line\">  <span class=\"attr\">multiline.match:</span> <span class=\"string\">after</span> <span class=\"comment\"># è¿½åŠ åˆ°ä¸Šä¸€è¡Œçš„åé¢</span></span><br><span class=\"line\">  <span class=\"comment\"># multiline: å¤šè¡Œæ—¥å¿—é…ç½®ï¼Œè¿™é‡Œå®é™…ä¸Šä¸éœ€è¦é…ç½®å¤šè¡Œè®¾ç½®ï¼Œå› ä¸ºnginxçš„accessæ—¥å¿—éƒ½æ˜¯å•è¡Œæ—¥å¿—ï¼Œè¿™é‡Œåªåšæ¼”ç¤º</span></span><br><span class=\"line\">    <span class=\"comment\"># pattern: æ­£åˆ™è¡¨è¾¾å¼</span></span><br><span class=\"line\">    <span class=\"comment\"># negate: falseï¼ŒåŒ¹é…patternçš„è¡Œåˆå¹¶åˆ°ä¸Šä¸€è¡Œï¼›trueï¼Œä¸åŒ¹é…patternçš„è¡Œåˆå¹¶åˆ°ä¸Šä¸€è¡Œ</span></span><br><span class=\"line\">    <span class=\"comment\"># match: afterï¼Œåˆå¹¶åˆ°ä¸Šä¸€è¡Œçš„æœ«å°¾ï¼›beforeï¼Œåˆå¹¶åˆ°ä¸Šä¸€è¡Œçš„å¼€å¤´</span></span><br><span class=\"line\">  <span class=\"attr\">scan_frequency:</span> <span class=\"string\">10s</span> <span class=\"comment\"># æ¯ 10 ç§’æ‰«æä¸€æ¬¡æ—¥å¿—æ–‡ä»¶</span></span><br><span class=\"line\">  <span class=\"attr\">clean_removed:</span> <span class=\"literal\">true</span> <span class=\"comment\"># åœ¨æ—¥å¿—æ–‡ä»¶è¢«åˆ é™¤åæ˜¯å¦ä»å…¶å†…éƒ¨çŠ¶æ€ä¸­ç§»é™¤è¯¥æ–‡ä»¶çš„è®°å½•</span></span><br><span class=\"line\">  <span class=\"attr\">clean_inactive:</span> <span class=\"string\">2h</span> <span class=\"comment\"># åœ¨æ—¥å¿—æ–‡ä»¶å¤„äºéæ´»åŠ¨çŠ¶æ€å¤šé•¿æ—¶é—´åå°†å…¶ä»çŠ¶æ€æ•°æ®åº“ä¸­ç§»,è®¾ç½®ä¸ºæ¯” ignore_older + scan_frequency æ›´å¤§çš„å€¼</span></span><br><span class=\"line\">  <span class=\"attr\">ignore_older:</span> <span class=\"string\">1h</span> <span class=\"comment\"># å¿½ç•¥é‚£äº›æ¯”å½“å‰æ—¶é—´æ—©äº 1 å°æ—¶çš„æ—¥å¿—æ–‡ä»¶</span></span><br><span class=\"line\"><span class=\"attr\">output.logstash:</span> <span class=\"comment\"># è¾“å‡ºé…ç½®ï¼Œè¿™é‡Œæ˜¯å‘é€åˆ°Logstash</span></span><br><span class=\"line\">  <span class=\"attr\">enabled:</span> <span class=\"literal\">true</span> <span class=\"comment\"># æ˜¯å¦å¯ç”¨</span></span><br><span class=\"line\">  <span class=\"attr\">hosts:</span> [<span class=\"string\">&quot;10.250.0.239:5044&quot;</span>] <span class=\"comment\"># LogstashæœåŠ¡åœ°å€</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¸ºFileBeatçš„ç”¨æˆ·åˆ†é…æ—¥å¿—ç›®å½•çš„è¯»å–æƒé™</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ä½¿ç”¨ setfaclå‘½ä»¤ä¸ºelasticç”¨æˆ·åˆ†é…æ—¥å¿—ç›®å½•çš„è¯»å–æƒé™</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> setfacl -d -m u:elastic:r-x -R /var/log/nginx/</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¯åŠ¨FileBeat</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">./filebeat -e -c conf/filebeat-nginx.yml</span><br><span class=\"line\"><span class=\"comment\"># åå°å¯åŠ¨</span></span><br><span class=\"line\"><span class=\"built_in\">nohup</span> ./filebeat -e -c conf/filebeat-nginx.yml &amp;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åœ¨å¯åŠ¨filebeatæ—¶å¯èƒ½ä¼šé‡åˆ°å¦‚ä¸‹é”™è¯¯</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Exiting: error loading config file: config file (<span class=\"string\">&quot;conf/filebeat-nginx.yml&quot;</span>) can only be writable by the owner but the permissions are <span class=\"string\">&quot;-rw-rw-r--&quot;</span> (to fix the permissions use: <span class=\"string\">&#x27;chmod go-w /usr/local/filebeat/filebeat-8.17.3-linux-x86_64/conf/filebeat-nginx.yml&#x27;</span>)</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-4\">\n<p>å› ä¸ºå®‰å…¨åŸå› ä¸è¦å…¶ä»–ç”¨æˆ·å†™çš„æƒé™ï¼Œå»æ‰å†™çš„æƒé™å°±å¯ä»¥äº†</p>\n</li>\n</ul>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">chmod</span> go-w conf/filebeat-nginx.yml</span><br></pre></td></tr></table></figure>\n<h3 id=\"é…ç½®Logstashæ¥æ”¶FileBeatæ”¶é›†çš„æ•°æ®å¹¶æ‰“å°\">é…ç½®Logstashæ¥æ”¶FileBeatæ”¶é›†çš„æ•°æ®å¹¶æ‰“å°</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ›å»ºé…ç½®æ–‡ä»¶<code>logstash-nginx.conf</code>ï¼Œå°†å…¶ä¿å­˜åˆ°Logstashå®‰è£…ç›®å½•ä¸‹çš„configç›®å½•ä¸‹ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># è¿›å…¥logstashå®‰è£…ç›®å½•</span></span><br><span class=\"line\"><span class=\"comment\"># vim config/logstash-nginx.conf</span></span><br><span class=\"line\"><span class=\"comment\"># é…ç½®ä»FileBeatæ¥æ”¶æ•°æ®</span></span><br><span class=\"line\">input &#123; <span class=\"comment\"># è¾“å…¥æºé…ç½®</span></span><br><span class=\"line\">    beats &#123; <span class=\"comment\"># ä»FileBeatæ¥æ”¶æ•°æ®</span></span><br><span class=\"line\">      port =&gt; 5044 <span class=\"comment\"># ç›‘å¬5044ç«¯å£</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">output &#123; <span class=\"comment\"># è¾“å‡ºé…ç½®</span></span><br><span class=\"line\">    stdout &#123; <span class=\"comment\"># æ‰“å°åˆ°æ§åˆ¶å°</span></span><br><span class=\"line\">      codec =&gt; rubydebug <span class=\"comment\"># æŒ‡å®šç¼–ç å™¨</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æµ‹è¯•logstashé…ç½®æ˜¯å¦æ­£ç¡®</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">bin/logstash -f config/logstash-nginx.conf --config.test_and_exit</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¯åŠ¨logstash</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># reload.automaticï¼šä¿®æ”¹é…ç½®æ–‡ä»¶æ—¶è‡ªåŠ¨é‡æ–°åŠ è½½</span></span><br><span class=\"line\">bin/logstash -f config/logstash-nginx.conf --config.reload.automatic</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ­¤æ—¶åœ¨æ§åˆ¶å°ä¼šçœ‹åˆ°å¦‚ä¸‹è¾“å‡ºï¼š</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">         <span class=\"string\">&quot;input&quot;</span> =&gt; &#123;</span><br><span class=\"line\">        <span class=\"string\">&quot;type&quot;</span> =&gt; <span class=\"string\">&quot;log&quot;</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">      <span class=\"string\">&quot;@version&quot;</span> =&gt; <span class=\"string\">&quot;1&quot;</span>,</span><br><span class=\"line\">       <span class=\"string\">&quot;message&quot;</span> =&gt; <span class=\"string\">&quot;1.119.161.30 - elastic [27/Mar/2025:08:52:41 +0000] \\&quot;GET /_cluster/stats HTTP/1.1\\&quot; 200 7445 \\&quot;-\\&quot; \\&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/134.0.0.0 Safari/537.36\\&quot; \\&quot;-\\&quot;&quot;</span>,</span><br><span class=\"line\">           <span class=\"string\">&quot;log&quot;</span> =&gt; &#123;</span><br><span class=\"line\">          <span class=\"string\">&quot;file&quot;</span> =&gt; &#123;</span><br><span class=\"line\">            <span class=\"string\">&quot;path&quot;</span> =&gt; <span class=\"string\">&quot;/var/log/nginx/access.log&quot;</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        <span class=\"string\">&quot;offset&quot;</span> =&gt; 42985</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">          <span class=\"string\">&quot;tags&quot;</span> =&gt; [</span><br><span class=\"line\">        [0] <span class=\"string\">&quot;beats_input_codec_plain_applied&quot;</span></span><br><span class=\"line\">    ],</span><br><span class=\"line\">    <span class=\"string\">&quot;@timestamp&quot;</span> =&gt; 2025-03-27T08:52:42.947Z,</span><br><span class=\"line\">           <span class=\"string\">&quot;ecs&quot;</span> =&gt; &#123;</span><br><span class=\"line\">        <span class=\"string\">&quot;version&quot;</span> =&gt; <span class=\"string\">&quot;8.0.0&quot;</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">         <span class=\"string\">&quot;agent&quot;</span> =&gt; &#123;</span><br><span class=\"line\">                  <span class=\"string\">&quot;id&quot;</span> =&gt; <span class=\"string\">&quot;4dbe185b-900d-4990-b841-c13bf9618fc6&quot;</span>,</span><br><span class=\"line\">                <span class=\"string\">&quot;name&quot;</span> =&gt; <span class=\"string\">&quot;ip-10-250-0-239.cn-northwest-1.compute.internal&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;ephemeral_id&quot;</span> =&gt; <span class=\"string\">&quot;6bb04808-7da7-4acb-95fd-f3f915651457&quot;</span>,</span><br><span class=\"line\">                <span class=\"string\">&quot;type&quot;</span> =&gt; <span class=\"string\">&quot;filebeat&quot;</span>,</span><br><span class=\"line\">             <span class=\"string\">&quot;version&quot;</span> =&gt; <span class=\"string\">&quot;8.17.3&quot;</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">         <span class=\"string\">&quot;event&quot;</span> =&gt; &#123;</span><br><span class=\"line\">        <span class=\"string\">&quot;original&quot;</span> =&gt; <span class=\"string\">&quot;1.119.161.30 - elastic [27/Mar/2025:08:52:41 +0000] \\&quot;GET /_cluster/stats HTTP/1.1\\&quot; 200 7445 \\&quot;-\\&quot; \\&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/134.0.0.0 Safari/537.36\\&quot; \\&quot;-\\&quot;&quot;</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">          <span class=\"string\">&quot;host&quot;</span> =&gt; &#123;</span><br><span class=\"line\">        <span class=\"string\">&quot;name&quot;</span> =&gt; <span class=\"string\">&quot;ip-10-250-0-239.cn-northwest-1.compute.internal&quot;</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"åˆ©ç”¨Logstashè¿‡æ»¤å™¨è§£ææ—¥å¿—\">åˆ©ç”¨Logstashè¿‡æ»¤å™¨è§£ææ—¥å¿—</h4>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä»æ‰“å°ç»“æœçœ‹åˆ°åŒ…å«äº†å¤§é‡çš„æ— å…³æ•°æ®ï¼Œæ­¤æ—¶å¯ä»¥åˆ©ç”¨Logstashè¿‡æ»¤å™¨è§£ææ—¥å¿—ï¼Œè¿™é‡Œä½¿ç”¨<code>Grok</code>æ’ä»¶</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://www.elastic.co/guide/en/logstash/8.17/plugins-filters-grok.html\">Grok</a>æ˜¯ä¸€ç§å°†éç»“æ„åŒ–æ—¥å¿—è§£æä¸ºç»“æ„åŒ–çš„æ’ä»¶ã€‚è¿™ä¸ªå·¥å…·éå¸¸é€‚åˆç”¨æ¥è§£æç³»ç»Ÿæ—¥å¿—ã€WebæœåŠ¡å™¨æ—¥å¿—ã€MySQLæˆ–è€…æ˜¯ä»»æ„å…¶ä»–çš„æ—¥å¿—æ ¼å¼ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>Grokæ˜¯é€šè¿‡æ¨¡å¼åŒ¹é…çš„æ–¹å¼æ¥è¯†åˆ«æ—¥å¿—ä¸­çš„æ•°æ®,å¯ä»¥æŠŠGrokæ’ä»¶ç®€å•ç†è§£ä¸ºå‡çº§ç‰ˆæœ¬çš„æ­£åˆ™è¡¨è¾¾å¼ã€‚å®ƒæ‹¥æœ‰æ›´å¤šçš„æ¨¡å¼ï¼Œé»˜è®¤Logstashæ‹¥æœ‰120ä¸ªæ¨¡å¼ã€‚å¦‚æœè¿™äº›æ¨¡å¼ä¸æ»¡è¶³æˆ‘ä»¬è§£ææ—¥å¿—çš„éœ€æ±‚ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æ¥è¿›è¡ŒåŒ¹é…ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://help.aliyun.com/zh/sls/user-guide/grok-patterns\">GROKæ¨¡å¼å‚è€ƒ</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>grokæ¨¡å¼çš„è¯­æ³•æ˜¯:</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">%&#123;SYNTAX:SEMANTIC&#125;</span><br><span class=\"line\"><span class=\"comment\"># SYNTAXï¼ˆè¯­æ³•ï¼‰æŒ‡çš„æ˜¯Grokæ¨¡å¼åç§°ï¼ŒSEMANTICï¼ˆè¯­ä¹‰ï¼‰æ˜¯ç»™æ¨¡å¼åŒ¹é…åˆ°çš„æ–‡æœ¬å­—æ®µåã€‚ä¾‹å¦‚ï¼š</span></span><br><span class=\"line\">%&#123;NUMBER:duration&#125; %&#123;IP:client&#125;</span><br><span class=\"line\"><span class=\"comment\"># durationè¡¨ç¤ºï¼šåŒ¹é…ä¸€ä¸ªæ•°å­—ï¼Œclientè¡¨ç¤ºåŒ¹é…ä¸€ä¸ªIPåœ°å€ã€‚</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åŒ¹é…nginxæ—¥å¿—</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># nginx accessæ—¥å¿—æ ¼å¼</span></span><br><span class=\"line\">1.119.161.30 - elastic [27/Mar/2025:03:05:36 +0000] <span class=\"string\">&quot;GET /_cluster/stats HTTP/1.1&quot;</span> 200 7446 <span class=\"string\">&quot;-&quot;</span> <span class=\"string\">&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/134.0.0.0 Safari/537.36&quot;</span> <span class=\"string\">&quot;-&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># grok</span></span><br><span class=\"line\">%&#123;IP:client_ip&#125; - %&#123;USER:remote_user&#125; \\[%&#123;HTTPDATE:timestamp&#125;\\] \\&quot;%&#123;WORD:verb&#125; %&#123;URIPATHPARAM:request&#125; HTTP/%&#123;NUMBER:httpversion&#125;\\&quot; %&#123;INT:http_status&#125; %&#123;INT:body_bytes_sent&#125; \\&quot;%&#123;NOTSPACE:referrer&#125;\\&quot; \\&quot;%&#123;GREEDYDATA:agent&#125;\\&quot; %&#123;QUOTEDSTRING:x_forwarded_for&#125;</span><br><span class=\"line\"><span class=\"comment\"># è§£é‡Šæ¯ä¸ªéƒ¨åˆ†çš„ä½œç”¨ï¼š</span></span><br><span class=\"line\"><span class=\"comment\"># %&#123;IP:client_ip&#125;ï¼šåŒ¹é…å®¢æˆ·ç«¯ IP åœ°å€ã€‚</span></span><br><span class=\"line\"><span class=\"comment\"># -ï¼šåŒ¹é…ä¸€ä¸ªç ´æŠ˜å·ï¼ˆ-ï¼‰ï¼Œè¡¨ç¤ºåŒ¿åç”¨æˆ·æˆ–æœªè®¤è¯ç”¨æˆ·ã€‚</span></span><br><span class=\"line\"><span class=\"comment\"># %&#123;USER:remote_user&#125;ï¼šåŒ¹é…è¿œç¨‹ç”¨æˆ·åï¼Œ - è¡¨ç¤ºåŒ¿åç”¨æˆ·ã€‚</span></span><br><span class=\"line\"><span class=\"comment\"># \\[%&#123;HTTPDATE:timestamp&#125;\\]ï¼šåŒ¹é…è¯·æ±‚çš„æ—¶é—´æˆ³ï¼Œæ ¼å¼ä¸º [27/Mar/2025:03:05:36 +0000]ã€‚</span></span><br><span class=\"line\"><span class=\"comment\"># \\&quot;%&#123;WORD:verb&#125; : åŒ¹é…è¯·æ±‚æ–¹æ³• (GET)</span></span><br><span class=\"line\"><span class=\"comment\"># %&#123;URIPATHPARAM:request&#125; : åŒ¹é…è¯·æ±‚è·¯å¾„ (/_cluster/stats)</span></span><br><span class=\"line\"><span class=\"comment\"># HTTP/%&#123;NUMBER:httpversion&#125;\\\\\\&quot;ï¼šåŒ¹é… HTTP ç‰ˆæœ¬ (HTTP/1.1)ã€‚</span></span><br><span class=\"line\"><span class=\"comment\"># %&#123;INT:http_status&#125;ï¼šåŒ¹é… HTTP å“åº”çŠ¶æ€ç  (200)ã€‚</span></span><br><span class=\"line\"><span class=\"comment\"># %&#123;INT:body_bytes_sent&#125;ï¼šåŒ¹é…å“åº”ä½“çš„å­—èŠ‚æ•° (7446)ã€‚</span></span><br><span class=\"line\"><span class=\"comment\"># \\&quot;%&#123;NOTSPACE:referrer&#125;\\&quot;ï¼šåŒ¹é…å¼•ç”¨é¡µ (Referer) å­—æ®µï¼Œè¿™é‡Œä¸ºç©º (&quot;-&quot;)ã€‚</span></span><br><span class=\"line\"><span class=\"comment\"># \\&quot;%&#123;GREEDYDATA:agent&#125;\\&quot;ï¼šåŒ¹é…ç”¨æˆ·ä»£ç† (User-Agent) å­—æ®µã€‚GREEDYDATA ä¼šåŒ¹é…å°½å¯èƒ½å¤šçš„æ•°æ®ï¼Œç›´åˆ°é‡åˆ°ä¸‹ä¸€ä¸ªåˆ†éš”ç¬¦ã€‚</span></span><br><span class=\"line\"><span class=\"comment\"># %&#123;QUOTEDSTRING:x_forwarded_for&#125;ï¼šåŒ¹é… X-Forwarded-For å¤´å­—æ®µï¼Œè¿™é‡Œä¸ºç©º (&quot;-&quot;)ã€‚</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åŒ¹é…ç»“æœ</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">&quot;request&quot;</span>: <span class=\"string\">&quot;/_cluster/stats&quot;</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;agent&quot;</span>: <span class=\"string\">&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/134.0.0.0 Safari/537.36&quot;</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;body_bytes_sent&quot;</span>: <span class=\"string\">&quot;7446&quot;</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;verb&quot;</span>: <span class=\"string\">&quot;GET&quot;</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;x_forwarded_for&quot;</span>: <span class=\"string\">&quot;\\&quot;-\\&quot;&quot;</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;remote_user&quot;</span>: <span class=\"string\">&quot;elastic&quot;</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;referrer&quot;</span>: <span class=\"string\">&quot;-&quot;</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;client_ip&quot;</span>: <span class=\"string\">&quot;1.119.161.30&quot;</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;httpversion&quot;</span>: <span class=\"string\">&quot;1.1&quot;</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;http_status&quot;</span>: <span class=\"string\">&quot;200&quot;</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;timestamp&quot;</span>: <span class=\"string\">&quot;27/Mar/2025:03:05:36 +0000&quot;</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åŒ¹é…Grokæ¨¡å¼æ˜¯ä¸ªéå¸¸ç¹ççš„è¿‡ç¨‹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨Kibanaæ¥è¿›è¡Œå¯è§†åŒ–çš„Grokè°ƒè¯•<br>\n<img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/uPic/nhgnKY.png\" alt=\"\"></p>\n</li>\n<li class=\"lvl-2\">\n<p>groké…ç½®</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">grok &#123;</span><br><span class=\"line\">    match =&gt; &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;message&quot;</span> =&gt; <span class=\"string\">&quot;%&#123;IP:client_ip&#125; - %&#123;USER:remote_user&#125; \\[%&#123;HTTPDATE:timestamp&#125;\\] \\&quot;%&#123;WORD:verb&#125; %&#123;URIPATHPARAM:request&#125; HTTP/%&#123;NUMBER:httpversion&#125;\\&quot; %&#123;INT:http_status&#125; %&#123;INT:body_bytes_sent&#125; \\&quot;%&#123;NOTSPACE:referrer&#125;\\&quot; \\&quot;%&#123;GREEDYDATA:agent&#125;\\&quot; %&#123;QUOTEDSTRING:x_forwarded_for&#125;&quot;</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"ä½¿ç”¨mutateæ’ä»¶è¿‡æ»¤æ‰ä¸éœ€è¦çš„å­—æ®µ\">ä½¿ç”¨mutateæ’ä»¶è¿‡æ»¤æ‰ä¸éœ€è¦çš„å­—æ®µ</h4>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>é™¤äº†nginxæ—¥å¿—æœ¬èº«çš„æ ¼å¼å¤–ï¼Œlogstashè¿˜ä¼šæ‰“å°è®¸å¤šæˆ‘ä»¬ä¸éœ€è¦çš„å­—æ®µï¼Œæ­¤æ—¶å¯ä»¥ä½¿ç”¨<code>mutate</code>æ’ä»¶æ¥è¿‡æ»¤æ‰ä¸éœ€è¦çš„å­—æ®µã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mutate &#123;</span><br><span class=\"line\">    enable_metric =&gt; <span class=\"string\">&quot;false&quot;</span> <span class=\"comment\"># ç¦ç”¨æŒ‡æ ‡ä¸ŠæŠ¥</span></span><br><span class=\"line\">    remove_field =&gt; [<span class=\"string\">&quot;message&quot;</span>, <span class=\"string\">&quot;log&quot;</span>, <span class=\"string\">&quot;tags&quot;</span>, <span class=\"string\">&quot;input&quot;</span>, <span class=\"string\">&quot;agent&quot;</span>, <span class=\"string\">&quot;host&quot;</span>, <span class=\"string\">&quot;ecs&quot;</span>, <span class=\"string\">&quot;@version&quot;</span>] <span class=\"comment\"># ç§»é™¤ä¸éœ€è¦çš„å­—æ®µ</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"ä½¿ç”¨Dateæ’ä»¶å¯¹æ—¶é—´è¿›è¡Œæ ¼å¼è½¬æ¢\">ä½¿ç”¨Dateæ’ä»¶å¯¹æ—¶é—´è¿›è¡Œæ ¼å¼è½¬æ¢</h4>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">date</span> &#123;</span><br><span class=\"line\">    match =&gt; [<span class=\"string\">&quot;timestamp&quot;</span>,<span class=\"string\">&quot;dd/MMM/yyyy:HH:mm:ss Z&quot;</span>,<span class=\"string\">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>] <span class=\"comment\"># æ—¶é—´æ ¼å¼è½¬æ¢</span></span><br><span class=\"line\">    target =&gt; <span class=\"string\">&quot;timestamp&quot;</span> <span class=\"comment\"># ç›®æ ‡å­—æ®µ</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"å®Œæ•´çš„Logstashé…ç½®\">å®Œæ•´çš„Logstashé…ç½®</h4>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># è¿›å…¥logstashå®‰è£…ç›®å½•</span></span><br><span class=\"line\"><span class=\"comment\"># vim config/logstsh-nginx.conf</span></span><br><span class=\"line\"><span class=\"comment\"># é…ç½®ä»FileBeatæ¥æ”¶æ•°æ®</span></span><br><span class=\"line\">input &#123; <span class=\"comment\"># è¾“å…¥æºé…ç½®</span></span><br><span class=\"line\">    beats &#123; <span class=\"comment\"># ä»FileBeatæ¥æ”¶æ•°æ®</span></span><br><span class=\"line\">      port =&gt; 5044 <span class=\"comment\"># ç›‘å¬5044ç«¯å£</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">filter &#123; <span class=\"comment\"># è¿‡æ»¤å™¨é…ç½®</span></span><br><span class=\"line\">    grok &#123;</span><br><span class=\"line\">        match =&gt; &#123;</span><br><span class=\"line\">        <span class=\"string\">&quot;message&quot;</span> =&gt; <span class=\"string\">&quot;%&#123;IP:client_ip&#125; - %&#123;USER:remote_user&#125; \\[%&#123;HTTPDATE:timestamp&#125;\\] \\&quot;%&#123;WORD:verb&#125; %&#123;URIPATHPARAM:request&#125; HTTP/%&#123;NUMBER:httpversion&#125;\\&quot; %&#123;INT:http_status&#125; %&#123;INT:body_bytes_sent&#125; \\&quot;%&#123;NOTSPACE:referrer&#125;\\&quot; \\&quot;%&#123;GREEDYDATA:agent&#125;\\&quot; %&#123;QUOTEDSTRING:x_forwarded_for&#125;&quot;</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    mutate &#123;</span><br><span class=\"line\">        enable_metric =&gt; <span class=\"string\">&quot;false&quot;</span> <span class=\"comment\"># ç¦ç”¨æŒ‡æ ‡ä¸ŠæŠ¥</span></span><br><span class=\"line\">        remove_field =&gt; [<span class=\"string\">&quot;message&quot;</span>, <span class=\"string\">&quot;log&quot;</span>, <span class=\"string\">&quot;tags&quot;</span>, <span class=\"string\">&quot;input&quot;</span>, <span class=\"string\">&quot;agent&quot;</span>, <span class=\"string\">&quot;host&quot;</span>, <span class=\"string\">&quot;ecs&quot;</span>, <span class=\"string\">&quot;@version&quot;</span>] <span class=\"comment\"># ç§»é™¤ä¸éœ€è¦çš„å­—æ®µ</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">date</span> &#123;</span><br><span class=\"line\">        match =&gt; [<span class=\"string\">&quot;timestamp&quot;</span>,<span class=\"string\">&quot;dd/MMM/yyyy:HH:mm:ss Z&quot;</span>,<span class=\"string\">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>] <span class=\"comment\"># æ—¶é—´æ ¼å¼è½¬æ¢</span></span><br><span class=\"line\">        target =&gt; <span class=\"string\">&quot;timestamp&quot;</span> <span class=\"comment\"># ç›®æ ‡å­—æ®µ</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">output &#123; <span class=\"comment\"># è¾“å‡ºé…ç½®</span></span><br><span class=\"line\">    stdout &#123; <span class=\"comment\"># æ‰“å°åˆ°æ§åˆ¶å°</span></span><br><span class=\"line\">      codec =&gt; rubydebug <span class=\"comment\"># æŒ‡å®šç¼–ç å™¨</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>é‡æ–°å¯åŠ¨logstashåå¾—åˆ°å¦‚ä¸‹ç»“æœï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">              <span class=\"string\">&quot;event&quot;</span> =&gt; &#123;</span><br><span class=\"line\">        <span class=\"string\">&quot;original&quot;</span> =&gt; <span class=\"string\">&quot;1.119.161.30 - elastic [27/Mar/2025:09:49:41 +0000] \\&quot;GET /_cluster/stats HTTP/1.1\\&quot; 200 7445 \\&quot;-\\&quot; \\&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/134.0.0.0 Safari/537.36\\&quot; \\&quot;-\\&quot;&quot;</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">          <span class=\"string\">&quot;client_ip&quot;</span> =&gt; <span class=\"string\">&quot;1.119.161.30&quot;</span>,</span><br><span class=\"line\">            <span class=\"string\">&quot;request&quot;</span> =&gt; <span class=\"string\">&quot;/_cluster/stats&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;http_status&quot;</span> =&gt; <span class=\"string\">&quot;200&quot;</span>,</span><br><span class=\"line\">         <span class=\"string\">&quot;@timestamp&quot;</span> =&gt; 2025-03-27T09:49:45.751Z,</span><br><span class=\"line\">    <span class=\"string\">&quot;body_bytes_sent&quot;</span> =&gt; <span class=\"string\">&quot;7445&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;x_forwarded_for&quot;</span> =&gt; <span class=\"string\">&quot;\\&quot;-\\&quot;&quot;</span>,</span><br><span class=\"line\">          <span class=\"string\">&quot;timestamp&quot;</span> =&gt; 2025-03-27T09:49:41.000Z,</span><br><span class=\"line\">           <span class=\"string\">&quot;referrer&quot;</span> =&gt; <span class=\"string\">&quot;-&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;remote_user&quot;</span> =&gt; <span class=\"string\">&quot;elastic&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;httpversion&quot;</span> =&gt; <span class=\"string\">&quot;1.1&quot;</span>,</span><br><span class=\"line\">               <span class=\"string\">&quot;verb&quot;</span> =&gt; <span class=\"string\">&quot;GET&quot;</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"å°†ç»“æœè¾“å‡ºåˆ°ES\">å°†ç»“æœè¾“å‡ºåˆ°ES</h4>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åœ¨è¾“å‡ºé…ç½®ä¸­æ·»åŠ ESè¾“å‡ºé…ç½®</span></span><br><span class=\"line\">output &#123; <span class=\"comment\"># è¾“å‡ºé…ç½®</span></span><br><span class=\"line\">    stdout &#123; <span class=\"comment\"># æ‰“å°åˆ°æ§åˆ¶å°</span></span><br><span class=\"line\">      codec =&gt; rubydebug <span class=\"comment\"># æŒ‡å®šç¼–ç å™¨</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    elasticsearch &#123; <span class=\"comment\"># è¾“å‡ºåˆ°ES</span></span><br><span class=\"line\">        index =&gt; <span class=\"string\">&quot;nginx_access_log_%&#123;+YYYY-MM&#125;&quot;</span> <span class=\"comment\"># ç´¢å¼•å,æŒ‰æœˆåˆ†éš”</span></span><br><span class=\"line\">        hosts =&gt; [<span class=\"string\">&quot;https://10.250.0.239:9200&quot;</span>] <span class=\"comment\"># ESåœ°å€</span></span><br><span class=\"line\">        user =&gt; <span class=\"string\">&quot;elastic&quot;</span>                   <span class=\"comment\"># ESç”¨æˆ·å</span></span><br><span class=\"line\">        password =&gt; <span class=\"string\">&quot;123456&quot;</span>                <span class=\"comment\"># ESå¯†ç </span></span><br><span class=\"line\">        ssl =&gt; <span class=\"literal\">true</span>                         <span class=\"comment\"># æ˜¯å¦å¯ç”¨SSLï¼Œå› ä¸ºè¿™é‡Œæ˜¯httpsè®¿é—®ES</span></span><br><span class=\"line\">        ssl_certificate_verification =&gt; <span class=\"literal\">false</span> <span class=\"comment\"># ç¦ç”¨è¯ä¹¦éªŒè¯</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¦‚æœéœ€è¦å¼€å¯è¯ä¹¦æ ¡éªŒï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹æ³•è¿›è¡Œé…ç½®</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-6\">è·å– Elasticsearch çš„ SSL è¯ä¹¦ï¼š</li>\n</ul>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ä» Elasticsearch çš„é…ç½®æ–‡ä»¶æˆ–è¯ä¹¦æ–‡ä»¶è·¯å¾„ä¸­è·å–è¯ä¹¦ï¼ˆé€šå¸¸æ˜¯ .pem æˆ– .crt æ–‡ä»¶ï¼‰ã€‚</span></span><br><span class=\"line\">/usr/local/elasticsearch/elasticsearch-8.17.3/config/certs/http_ca.crt</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-2\">\n<li class=\"lvl-6\">å¯¼å…¥è¯ä¹¦åˆ° Java ä¿¡ä»»åº“ï¼šæ³¨æ„è¿™é‡Œè¦å¯¼å…¥åˆ°å¯åŠ¨Logstashçš„JAVAè¿›ç¨‹çš„ä¿¡ä»»åº“</li>\n</ul>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># logstashçš„jdkè·¯å¾„ï¼Œé»˜è®¤åœ¨logstashçš„å®‰è£…ç›®å½•ä¸‹</span></span><br><span class=\"line\"><span class=\"built_in\">cd</span> /usr/local/logstash/logstash-8.17.3/jdk</span><br><span class=\"line\"></span><br><span class=\"line\">bin/keytool -importcert -<span class=\"built_in\">alias</span> es-cert -keystore /usr/local/logstash/logstash-8.17.3/logstash.keystore -file /usr/local/elasticsearch/elasticsearch-8.17.3/config/certs/http_ca.crt</span><br><span class=\"line\"><span class=\"comment\"># è¾“å‡º</span></span><br><span class=\"line\">Enter keystore password:  <span class=\"comment\"># è¾“å…¥å¯†ç  è¿™é‡Œæ˜¯123456</span></span><br><span class=\"line\">Re-enter new password:</span><br><span class=\"line\">Owner: CN=Elasticsearch security auto-configuration HTTP CA</span><br><span class=\"line\">Issuer: CN=Elasticsearch security auto-configuration HTTP CA</span><br><span class=\"line\">Serial number: 89d5c501a2efd5d45a6ee5e08daa16bd605d8c28</span><br><span class=\"line\">Valid from: Thu Mar 20 08:53:26 UTC 2025 <span class=\"keyword\">until</span>: Sun Mar 19 08:53:26 UTC 2028</span><br><span class=\"line\">Certificate fingerprints:</span><br><span class=\"line\">    SHA1: DE:73:0C:EC:46:59:69:83:52:7C:C4:CC:6B:65:EC:B6:31:BE:10:22</span><br><span class=\"line\">    SHA256: 3F:14:1C:16:DF:C6:E1:65:89:4B:C1:67:20:84:B2:20:DC:DD:22:FF:E0:21:16:D5:1A:C1:80:03:CF:AA:5A:1D</span><br><span class=\"line\">Signature algorithm name: SHA256withRSA</span><br><span class=\"line\">Subject Public Key Algorithm: 4096-bit RSA key</span><br><span class=\"line\">Version: 3</span><br><span class=\"line\"></span><br><span class=\"line\">Extensions:</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#1: ObjectId: 2.5.29.35 Criticality=false</span></span><br><span class=\"line\">AuthorityKeyIdentifier [</span><br><span class=\"line\">KeyIdentifier [</span><br><span class=\"line\">0000: 25 EF BA 81 AE 5E 14 1C   7E FF A1 87 12 F8 D0 2E  %....^..........</span><br><span class=\"line\">0010: 3A D7 54 5F                                        :.T_</span><br><span class=\"line\">]</span><br><span class=\"line\">]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#2: ObjectId: 2.5.29.19 Criticality=true</span></span><br><span class=\"line\">BasicConstraints:[</span><br><span class=\"line\">CA:<span class=\"literal\">true</span></span><br><span class=\"line\">PathLen: no <span class=\"built_in\">limit</span></span><br><span class=\"line\">]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#3: ObjectId: 2.5.29.14 Criticality=false</span></span><br><span class=\"line\">SubjectKeyIdentifier [</span><br><span class=\"line\">KeyIdentifier [</span><br><span class=\"line\">0000: 25 EF BA 81 AE 5E 14 1C   7E FF A1 87 12 F8 D0 2E  %....^..........</span><br><span class=\"line\">0010: 3A D7 54 5F                                        :.T_</span><br><span class=\"line\">]</span><br><span class=\"line\">]</span><br><span class=\"line\"></span><br><span class=\"line\">Trust this certificate? [no]:  <span class=\"built_in\">yes</span> <span class=\"comment\"># yesç¡®è®¤</span></span><br><span class=\"line\">Certificate was added to keystore</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-2\">\n<li class=\"lvl-6\">\n<p>é…ç½® Logstash ä½¿ç”¨ä¿¡ä»»åº“</p>\n</li>\n</ul>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">output &#123;</span><br><span class=\"line\">    elasticsearch &#123;</span><br><span class=\"line\">        index =&gt; <span class=\"string\">&quot;nginx_access_log_%&#123;+YYYY-MM&#125;&quot;</span> <span class=\"comment\"># ç´¢å¼•å,æŒ‰æœˆåˆ†éš”</span></span><br><span class=\"line\">        hosts =&gt; [<span class=\"string\">&quot;https://10.250.0.239:9200&quot;</span>] <span class=\"comment\"># ESåœ°å€</span></span><br><span class=\"line\">        user =&gt; <span class=\"string\">&quot;elastic&quot;</span>                     <span class=\"comment\"># ESç”¨æˆ·å</span></span><br><span class=\"line\">        password =&gt; <span class=\"string\">&quot;123456&quot;</span>                  <span class=\"comment\"># ESå¯†ç </span></span><br><span class=\"line\">        ssl =&gt; <span class=\"literal\">true</span>                           <span class=\"comment\"># æ˜¯å¦å¯ç”¨SSLï¼Œå› ä¸ºè¿™é‡Œæ˜¯httpsè®¿é—®ES</span></span><br><span class=\"line\">        ssl_certificate_verification =&gt; <span class=\"literal\">true</span>  <span class=\"comment\"># å¯ç”¨è¯ä¹¦æ ¡éªŒ</span></span><br><span class=\"line\">        ssl_truststore_path =&gt; <span class=\"string\">&quot;/usr/local/logstash/logstash-8.17.3/logstash.keystore&quot;</span> <span class=\"comment\"># æŒ‡å®šä¿¡ä»»åº“è·¯å¾„</span></span><br><span class=\"line\">        ssl_truststore_password =&gt; <span class=\"string\">&quot;123456&quot;</span>   <span class=\"comment\"># ä¿¡ä»»åº“å¯†ç </span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<h2 id=\"æ•´åˆæ¶ˆæ¯é˜Ÿåˆ—-Nginxçš„ELKæ¶æ„\">æ•´åˆæ¶ˆæ¯é˜Ÿåˆ—+Nginxçš„ELKæ¶æ„</h2>\n<p><img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/uPic/%E6%88%AA%E5%9B%BE-2.png\" alt=\"\"></p>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ¶ˆæ¯é˜Ÿåˆ—ï¼šå¼•å…¥æ¶ˆæ¯é˜Ÿåˆ—ä½œä¸ºç¼“å†²æœºåˆ¶ï¼Œç¡®ä¿å³ä½¿åœ¨Logstashæˆ–Elasticsearchå‡ºç°æ•…éšœæ—¶ï¼Œæ—¥å¿—æ•°æ®ä¹Ÿä¸ä¼šä¸¢å¤±ã€‚æ¶ˆæ¯é˜Ÿåˆ—èƒ½å¤Ÿå‡è¡¡ç½‘ç»œä¼ è¾“ï¼Œé™ä½æ•°æ®ä¸¢å¤±çš„å¯èƒ½æ€§ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>Nginxï¼šNginxä½œä¸ºé«˜æ€§èƒ½çš„Webå’Œåå‘ä»£ç†æœåŠ¡å™¨ï¼Œå¯ä»¥è¿›ä¸€æ­¥ä¼˜åŒ–æ•´ä¸ªç³»ç»Ÿçš„æ€§èƒ½å’Œå¯ç”¨æ€§ã€‚å®ƒå¯ä»¥åœ¨è´Ÿè½½å‡è¡¡ã€ç¼“å­˜ç­‰æ–¹é¢å‘æŒ¥ä½œç”¨ï¼Œæå‡ç”¨æˆ·è®¿é—®ä½“éªŒã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>æ‰©å±•æ€§ï¼šç”±äºå¼•å…¥äº†æ¶ˆæ¯é˜Ÿåˆ—å’ŒNginxç­‰ç»„ä»¶ï¼Œæ•´ä¸ªæ¶æ„çš„æ‰©å±•æ€§å¾—åˆ°å¢å¼ºã€‚å¯ä»¥æ ¹æ®å®é™…éœ€æ±‚åŠ¨æ€è°ƒæ•´å„ç»„ä»¶çš„èµ„æºåˆ†é…å’Œéƒ¨ç½²è§„æ¨¡ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>é€‚ç”¨åœºæ™¯ï¼šæ•´åˆæ¶ˆæ¯é˜Ÿåˆ—+Nginxçš„æ¶æ„ä¸»è¦é€‚ç”¨äºç”Ÿäº§ç¯å¢ƒï¼Œç‰¹åˆ«æ˜¯éœ€è¦å¤„ç†å¤§æ•°æ®é‡çš„åœºæ™¯ã€‚å®ƒèƒ½å¤Ÿç¡®ä¿æ•°æ®çš„å®‰å…¨æ€§å’Œå®Œæ•´æ€§ï¼ŒåŒæ—¶æä¾›é«˜æ€§èƒ½çš„æ—¥å¿—å¤„ç†å’Œå¯è§†åŒ–åˆ†ææœåŠ¡ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>æ€»ç»“æ¥è¯´å°±æ˜¯</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">filebeatå°†é‡‡é›†çš„æ—¥å¿—å‘é€åˆ°Redis\\RabbitMQ\\Kafkaç­‰</li>\n<li class=\"lvl-4\">Logstashå†ä»Redis\\RabbitMQ\\Kafkaä¸­è¯»å–æ—¥å¿—æ•°æ®ï¼Œå¹¶è¿›è¡Œè§£æåå‘é€åˆ°ESä¸­ã€‚</li>\n<li class=\"lvl-4\">ESé›†ç¾¤ä½¿ç”¨nginxè¿›è¡Œè´Ÿè½½å‡è¡¡ï¼Œä»¥å®ç°é«˜å¯ç”¨å’Œé«˜æ€§èƒ½ã€‚å…·ä½“å®ç°æ–¹æ³•æŸ¥çœ‹ï¼š<a href=\"/2025/03/24/elasticsearch-02-install-cluster/\" title=\"linuxä¸‹å®‰è£…Elasticsearché›†ç¾¤\">linuxä¸‹å®‰è£…Elasticsearché›†ç¾¤</a></li>\n</ul>\n</li>\n</ul>\n<h2 id=\"åŸºäºRedisçš„ELKæ¶æ„ç¤ºä¾‹\">åŸºäºRedisçš„ELKæ¶æ„ç¤ºä¾‹</h2>\n<h3 id=\"filebeatå°†é‡‡é›†çš„æ—¥å¿—å‘é€åˆ°Redis\">filebeatå°†é‡‡é›†çš„æ—¥å¿—å‘é€åˆ°Redis</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ›å»ºé…ç½®æ–‡ä»¶<code>filebeat-nginx-to-redis.yml</code>ï¼Œå°†å…¶ä¿å­˜åˆ°Filebeatå®‰è£…ç›®å½•ä¸‹çš„confç›®å½•ä¸‹ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å› ä¸ºNginxçš„access.logæ—¥å¿—éƒ½æ˜¯ä»¥IPåœ°å€å¼€å¤´çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¿®æ”¹ä¸‹åŒ¹é…å­—æ®µã€‚</span></span><br><span class=\"line\"><span class=\"comment\"># ä¸ä»¥ipåœ°å€å¼€å¤´çš„è¡Œè¿½åŠ åˆ°ä¸Šä¸€è¡Œ</span></span><br><span class=\"line\"><span class=\"attr\">filebeat.inputs:</span> <span class=\"comment\"># è¾“å…¥æºé…ç½®</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">type:</span> <span class=\"string\">log</span> <span class=\"comment\"># æ—¥å¿—ç±»å‹</span></span><br><span class=\"line\">  <span class=\"attr\">enabled:</span> <span class=\"literal\">true</span> <span class=\"comment\"># æ˜¯å¦å¯ç”¨</span></span><br><span class=\"line\">  <span class=\"attr\">paths:</span> <span class=\"comment\"># é‡‡é›†è·¯å¾„</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">/var/log/nginx/access*.*</span></span><br><span class=\"line\">  <span class=\"attr\">exclude_files:</span> [<span class=\"string\">&quot;.gz$&quot;</span>] <span class=\"comment\"># æ’é™¤ä»¥.gz ç»“å°¾çš„æ–‡ä»¶</span></span><br><span class=\"line\">  <span class=\"attr\">multiline.pattern:</span> <span class=\"string\">&#x27;^\\\\d&#123;1,3&#125;\\\\.\\\\d&#123;1,3&#125;\\\\.\\\\d&#123;1,3&#125;\\\\.\\\\d&#123;1,3&#125;\\\\s&#x27;</span> <span class=\"comment\"># åŒ¹é…ä»¥IPåœ°å€å¼€å¤´ï¼Œå¹¶ç´§è·Ÿä¸€ä¸ªç©ºç™½å­—ç¬¦</span></span><br><span class=\"line\">  <span class=\"attr\">multiline.negate:</span> <span class=\"literal\">true</span> <span class=\"comment\"># ä¸ä»¥ipåœ°å€å¼€å¤´çš„è¡Œè¿½åŠ åˆ°ä¸Šä¸€è¡Œ</span></span><br><span class=\"line\">  <span class=\"attr\">multiline.match:</span> <span class=\"string\">after</span> <span class=\"comment\"># è¿½åŠ åˆ°ä¸Šä¸€è¡Œçš„åé¢</span></span><br><span class=\"line\">  <span class=\"comment\"># multiline: å¤šè¡Œæ—¥å¿—é…ç½®ï¼Œè¿™é‡Œå®é™…ä¸Šä¸éœ€è¦é…ç½®å¤šè¡Œè®¾ç½®ï¼Œå› ä¸ºnginxçš„accessæ—¥å¿—éƒ½æ˜¯å•è¡Œæ—¥å¿—ï¼Œè¿™é‡Œåªåšæ¼”ç¤º</span></span><br><span class=\"line\">    <span class=\"comment\"># pattern: æ­£åˆ™è¡¨è¾¾å¼</span></span><br><span class=\"line\">    <span class=\"comment\"># negate: falseï¼ŒåŒ¹é…patternçš„è¡Œåˆå¹¶åˆ°ä¸Šä¸€è¡Œï¼›trueï¼Œä¸åŒ¹é…patternçš„è¡Œåˆå¹¶åˆ°ä¸Šä¸€è¡Œ</span></span><br><span class=\"line\">    <span class=\"comment\"># match: afterï¼Œåˆå¹¶åˆ°ä¸Šä¸€è¡Œçš„æœ«å°¾ï¼›beforeï¼Œåˆå¹¶åˆ°ä¸Šä¸€è¡Œçš„å¼€å¤´</span></span><br><span class=\"line\">  <span class=\"attr\">scan_frequency:</span> <span class=\"string\">10s</span> <span class=\"comment\"># æ¯ 10 ç§’æ‰«æä¸€æ¬¡æ—¥å¿—æ–‡ä»¶</span></span><br><span class=\"line\">  <span class=\"attr\">clean_removed:</span> <span class=\"literal\">true</span> <span class=\"comment\"># åœ¨æ—¥å¿—æ–‡ä»¶è¢«åˆ é™¤åæ˜¯å¦ä»å…¶å†…éƒ¨çŠ¶æ€ä¸­ç§»é™¤è¯¥æ–‡ä»¶çš„è®°å½•</span></span><br><span class=\"line\">  <span class=\"attr\">clean_inactive:</span> <span class=\"string\">2h</span> <span class=\"comment\"># åœ¨æ—¥å¿—æ–‡ä»¶å¤„äºéæ´»åŠ¨çŠ¶æ€å¤šé•¿æ—¶é—´åå°†å…¶ä»çŠ¶æ€æ•°æ®åº“ä¸­ç§»,è®¾ç½®ä¸ºæ¯” ignore_older + scan_frequency æ›´å¤§çš„å€¼</span></span><br><span class=\"line\">  <span class=\"attr\">ignore_older:</span> <span class=\"string\">1h</span> <span class=\"comment\"># å¿½ç•¥é‚£äº›æ¯”å½“å‰æ—¶é—´æ—©äº 1 å°æ—¶çš„æ—¥å¿—æ–‡ä»¶</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">output.redis:</span> <span class=\"comment\"># Redisè¾“å‡ºé…ç½®</span></span><br><span class=\"line\">  <span class=\"attr\">hosts:</span> [<span class=\"string\">&quot;10.250.0.214:6379&quot;</span>] <span class=\"comment\"># RedisæœåŠ¡å™¨åœ°å€</span></span><br><span class=\"line\">  <span class=\"attr\">password:</span> <span class=\"string\">&quot;123456&quot;</span> <span class=\"comment\"># Rediså¯†ç </span></span><br><span class=\"line\">  <span class=\"attr\">key:</span> <span class=\"string\">&quot;filebeat_nginx&quot;</span> <span class=\"comment\"># Redisçš„keyï¼Œç±»å‹ä¸º list</span></span><br><span class=\"line\">  <span class=\"attr\">db:</span> <span class=\"number\">3</span> <span class=\"comment\"># Redisæ•°æ®åº“</span></span><br><span class=\"line\">  <span class=\"attr\">timeout:</span> <span class=\"number\">3</span> <span class=\"comment\"># Redisè¿æ¥è¶…æ—¶æ—¶é—´ï¼Œå•ä½ç§’</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¯åŠ¨Filebeatï¼Œå¹¶æŸ¥çœ‹æ—¥å¿—è¾“å‡ºã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">./filebeat -e -c conf/filebeat-nginx-to-redis.yml</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æŸ¥çœ‹Redisä¸­çš„æ•°æ®</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ redis-cli -h 10.250.0.214 -p 6379 -a 123456</span><br><span class=\"line\">10.250.0.214:6379&gt; <span class=\"keyword\">select</span> 3</span><br><span class=\"line\">OK</span><br><span class=\"line\">10.250.0.214:6379[3]&gt; keys filebeat*</span><br><span class=\"line\">1) <span class=\"string\">&quot;filebeat_nginx&quot;</span></span><br><span class=\"line\">10.250.0.214:6379[3]&gt; <span class=\"built_in\">type</span> filebeat_nginx</span><br><span class=\"line\">list</span><br><span class=\"line\">10.250.0.214:6379[3]&gt; LLEN filebeat_nginx</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 14</span><br><span class=\"line\">10.250.0.214:6379[3]&gt; LINDEX filebeat_nginx 1</span><br><span class=\"line\"><span class=\"string\">&quot;&#123;\\&quot;@timestamp\\&quot;:\\&quot;2025-03-28T09:15:23.402Z\\&quot;,\\&quot;@metadata\\&quot;:&#123;\\&quot;beat\\&quot;:\\&quot;filebeat\\&quot;,\\&quot;type\\&quot;:\\&quot;_doc\\&quot;,\\&quot;version\\&quot;:\\&quot;8.17.3\\&quot;&#125;,\\&quot;host\\&quot;:&#123;\\&quot;name\\&quot;:\\&quot;ip-10-250-0-239.cn-northwest-1.compute.internal\\&quot;&#125;,\\&quot;agent\\&quot;:&#123;\\&quot;version\\&quot;:\\&quot;8.17.3\\&quot;,\\&quot;ephemeral_id\\&quot;:\\&quot;c0a521fe-690b-46b1-aadc-bbe16ef1db9a\\&quot;,\\&quot;id\\&quot;:\\&quot;4dbe185b-900d-4990-b841-c13bf9618fc6\\&quot;,\\&quot;name\\&quot;:\\&quot;ip-10-250-0-239.cn-northwest-1.compute.internal\\&quot;,\\&quot;type\\&quot;:\\&quot;filebeat\\&quot;&#125;,\\&quot;log\\&quot;:&#123;\\&quot;offset\\&quot;:46745,\\&quot;file\\&quot;:&#123;\\&quot;path\\&quot;:\\&quot;/var/log/nginx/access.log\\&quot;&#125;&#125;,\\&quot;message\\&quot;:\\&quot;1.119.161.30 - elastic [28/Mar/2025:09:15:13 +0000] \\\\\\&quot;GET /_cluster/stats HTTP/1.1\\\\\\&quot; 200 7457 \\\\\\&quot;-\\\\\\&quot; \\\\\\&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/134.0.0.0 Safari/537.36\\\\\\&quot; \\\\\\&quot;-\\\\\\&quot;\\&quot;,\\&quot;input\\&quot;:&#123;\\&quot;type\\&quot;:\\&quot;log\\&quot;&#125;,\\&quot;ecs\\&quot;:&#123;\\&quot;version\\&quot;:\\&quot;8.0.0\\&quot;&#125;&#125;&quot;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"Logstashä»Redisä¸­è¯»å–æ—¥å¿—å¹¶å†™å…¥Elasticsearch\">Logstashä»Redisä¸­è¯»å–æ—¥å¿—å¹¶å†™å…¥Elasticsearch</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ›å»ºé…ç½®æ–‡ä»¶<code>logstash-nginx-redis-to-es.conf</code>ï¼Œå°†å…¶ä¿å­˜åˆ°Logstashå®‰è£…ç›®å½•ä¸‹çš„confç›®å½•ä¸‹ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># è¿›å…¥logstashå®‰è£…ç›®å½•</span></span><br><span class=\"line\"><span class=\"comment\"># vim logstash-nginx-redis-to-es.conf</span></span><br><span class=\"line\"><span class=\"comment\"># é…ç½®ä» redis æ¥æ”¶æ•°æ®</span></span><br><span class=\"line\">input &#123; <span class=\"comment\"># è¾“å…¥æºé…ç½®</span></span><br><span class=\"line\">    redis &#123; <span class=\"comment\"># Redisè¾“å…¥é…ç½®</span></span><br><span class=\"line\">        host =&gt; <span class=\"string\">&#x27;10.250.0.214&#x27;</span> <span class=\"comment\"># RedisæœåŠ¡å™¨åœ°å€</span></span><br><span class=\"line\">        port =&gt; <span class=\"string\">&quot;6379&quot;</span> <span class=\"comment\"># RedisæœåŠ¡å™¨ç«¯å£</span></span><br><span class=\"line\">        password =&gt; <span class=\"string\">&quot;123456&quot;</span> <span class=\"comment\"># Rediså¯†ç </span></span><br><span class=\"line\">        db =&gt; <span class=\"string\">&quot;3&quot;</span>           <span class=\"comment\"># Redisæ•°æ®åº“</span></span><br><span class=\"line\">        data_type =&gt; <span class=\"string\">&#x27;list&#x27;</span> <span class=\"comment\"># æ•°æ®ç±»å‹ä¸ºlist</span></span><br><span class=\"line\">        key =&gt; <span class=\"string\">&quot;filebeat_nginx&quot;</span>   <span class=\"comment\"># Redisçš„key</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">filter &#123; <span class=\"comment\"># è¿‡æ»¤å™¨é…ç½®</span></span><br><span class=\"line\">    grok &#123;</span><br><span class=\"line\">        match =&gt; &#123;</span><br><span class=\"line\">        <span class=\"string\">&quot;message&quot;</span> =&gt; <span class=\"string\">&quot;%&#123;IP:client_ip&#125; - %&#123;USER:remote_user&#125; \\[%&#123;HTTPDATE:timestamp&#125;\\] \\&quot;%&#123;WORD:verb&#125; %&#123;URIPATHPARAM:request&#125; HTTP/%&#123;NUMBER:httpversion&#125;\\&quot; %&#123;INT:http_status&#125; %&#123;INT:body_bytes_sent&#125; \\&quot;%&#123;NOTSPACE:referrer&#125;\\&quot; \\&quot;%&#123;GREEDYDATA:agent&#125;\\&quot; %&#123;QUOTEDSTRING:x_forwarded_for&#125;&quot;</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    mutate &#123;</span><br><span class=\"line\">        enable_metric =&gt; <span class=\"string\">&quot;false&quot;</span> <span class=\"comment\"># ç¦ç”¨æŒ‡æ ‡ä¸ŠæŠ¥</span></span><br><span class=\"line\">        remove_field =&gt; [<span class=\"string\">&quot;message&quot;</span>, <span class=\"string\">&quot;log&quot;</span>, <span class=\"string\">&quot;tags&quot;</span>, <span class=\"string\">&quot;input&quot;</span>, <span class=\"string\">&quot;agent&quot;</span>, <span class=\"string\">&quot;host&quot;</span>, <span class=\"string\">&quot;ecs&quot;</span>, <span class=\"string\">&quot;@version&quot;</span>] <span class=\"comment\"># ç§»é™¤ä¸éœ€è¦çš„å­—æ®µ</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">date</span> &#123;</span><br><span class=\"line\">        match =&gt; [<span class=\"string\">&quot;timestamp&quot;</span>,<span class=\"string\">&quot;dd/MMM/yyyy:HH:mm:ss Z&quot;</span>,<span class=\"string\">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>] <span class=\"comment\"># æ—¶é—´æ ¼å¼è½¬æ¢</span></span><br><span class=\"line\">        target =&gt; <span class=\"string\">&quot;timestamp&quot;</span> <span class=\"comment\"># ç›®æ ‡å­—æ®µ</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åœ¨è¾“å‡ºé…ç½®ä¸­æ·»åŠ ESè¾“å‡ºé…ç½®</span></span><br><span class=\"line\">output &#123; <span class=\"comment\"># è¾“å‡ºé…ç½®</span></span><br><span class=\"line\">    stdout &#123; <span class=\"comment\"># æ‰“å°åˆ°æ§åˆ¶å°</span></span><br><span class=\"line\">      codec =&gt; rubydebug <span class=\"comment\"># æŒ‡å®šç¼–ç å™¨</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    elasticsearch &#123; <span class=\"comment\"># è¾“å‡ºåˆ°ES</span></span><br><span class=\"line\">        index =&gt; <span class=\"string\">&quot;redis_nginx_access_log_%&#123;+YYYY-MM&#125;&quot;</span> <span class=\"comment\"># ç´¢å¼•å,æŒ‰æœˆåˆ†éš”</span></span><br><span class=\"line\">        hosts =&gt; [<span class=\"string\">&quot;https://10.250.0.239:9200&quot;</span>] <span class=\"comment\"># ESåœ°å€</span></span><br><span class=\"line\">        user =&gt; <span class=\"string\">&quot;elastic&quot;</span>                   <span class=\"comment\"># ESç”¨æˆ·å</span></span><br><span class=\"line\">        password =&gt; <span class=\"string\">&quot;123456&quot;</span>                <span class=\"comment\"># ESå¯†ç </span></span><br><span class=\"line\">        ssl =&gt; <span class=\"literal\">true</span>                         <span class=\"comment\"># æ˜¯å¦å¯ç”¨SSLï¼Œå› ä¸ºè¿™é‡Œæ˜¯httpsè®¿é—®ES</span></span><br><span class=\"line\">        ssl_certificate_verification =&gt; <span class=\"literal\">false</span> <span class=\"comment\"># ç¦ç”¨è¯ä¹¦éªŒè¯</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æµ‹è¯•logstashé…ç½®æ˜¯å¦æ­£ç¡®</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">bin/logstash -f config/logstash-nginx-redis-to-es.conf --config.test_and_exit</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¯åŠ¨logstash</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># reload.automaticï¼šä¿®æ”¹é…ç½®æ–‡ä»¶æ—¶è‡ªåŠ¨é‡æ–°åŠ è½½</span></span><br><span class=\"line\">bin/logstash -f config/logstash-nginx-redis-to-es.conf --config.reload.automatic</span><br></pre></td></tr></table></figure>","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç»å¦‚ä½•åœ¨linuxä¸‹å®‰è£…LogStashå’ŒFileBeat é€šè¿‡ç¤ºä¾‹è®²è§£ELKçš„ç»å…¸æ¶æ„å’Œé«˜å¹¶å‘æ¶æ„çš„å®ç°è¿‡ç¨‹ LogStashç‰ˆæœ¬8.17.3ï¼ŒFileBeatç‰ˆæœ¬8.17.3 Elasticsearchç‰ˆæœ¬8.17.3ï¼Œlinuxä¸‹å®‰è£…Elasticsearch Kibanaç‰ˆæœ¬8.17.3ï¼Œlinuxä¸‹å®‰è£…Kibana Elasticsearché›†ç¾¤æ­å»ºï¼Œlinuxä¸‹å®‰è£…Elasticsearché›†ç¾¤ Logstashæ¦‚è¿° Logstash æ˜¯å…è´¹ä¸”å¼€æ”¾çš„æœåŠ¡å™¨ç«¯æ•°æ®å¤„ç†ç®¡é“ï¼Œèƒ½å¤Ÿä»å¤šä¸ªæ¥æºé‡‡é›†æ•°æ®ï¼Œè½¬æ¢æ•°æ®ï¼Œç„¶åå°†æ•°æ®å‘é€åˆ°æ‚¨æœ€å–œæ¬¢çš„å­˜å‚¨åº“ä¸­ã€‚ Logstashæ•°æ®ä¼ è¾“åŸç† 1231.æ•°æ®é‡‡é›†ä¸è¾“å…¥ï¼šLogstashæ”¯æŒå„ç§è¾“å…¥é€‰æ‹©ï¼Œèƒ½å¤Ÿä»¥è¿ç»­çš„æµå¼ä¼ è¾“æ–¹å¼ï¼Œè½»æ¾åœ°ä»æ—¥å¿—ã€æŒ‡æ ‡ã€Webåº”ç”¨ä»¥åŠæ•°æ®å­˜å‚¨ä¸­é‡‡é›†æ•°æ®ã€‚2.å®æ—¶è§£æå’Œæ•°æ®è½¬æ¢ï¼šé€šè¿‡Logstashè¿‡æ»¤å™¨è§£æå„ä¸ªäº‹ä»¶ï¼Œè¯†åˆ«å·²å‘½åçš„å­—æ®µæ¥æ„å»ºç»“æ„ï¼Œå¹¶å°†å®ƒä»¬è½¬æ¢æˆé€šç”¨æ ¼å¼ï¼Œæœ€ç»ˆå°†æ•°æ®ä»æºç«¯ä¼ è¾“åˆ°å­˜å‚¨åº“ä¸­ã€‚3.å­˜å‚¨ä¸æ•°æ®å¯¼å‡ºï¼šLogstashæä¾›å¤šç§è¾“å‡ºé€‰æ‹©ï¼Œå¯ä»¥å°†æ•°æ®å‘é€åˆ°æŒ‡å®šçš„åœ°æ–¹ã€‚ Logstashé€šè¿‡ç®¡é“å®Œæˆæ•°æ®çš„é‡‡é›†ä¸å¤„ç†ï¼Œç®¡é“é…ç½®ä¸­åŒ…å«inputã€outputå’Œfilterï¼ˆå¯é€‰ï¼‰æ’ä»¶ï¼Œinputå’Œoutputç”¨æ¥é…ç½®è¾“å…¥å’Œè¾“å‡ºæ•°æ®æºã€filterç”¨æ¥å¯¹æ•°æ®è¿›è¡Œè¿‡æ»¤æˆ–é¢„å¤„ç†ã€‚ Logstashä¸‹è½½å®‰è£… ä¸‹è½½åœ°å€ï¼šhttps://www.elastic.co/cn/downloads/past-releases#logstash é€‰æ‹©å¯¹åº”çš„ç‰ˆæœ¬ï¼šè¿™é‡Œé€‰æ‹©å½“å‰çš„æœ€æ–°ç‰ˆLogStash 8.17.3ï¼Œä¹‹åé€‰æ‹©å¯¹åº”çš„æ“ä½œç³»ç»ŸLINUX X86_64 1wget https://artifacts.elastic.co/downloads/logstash/logstash-8.17.3-linux-x86_64.tar.gz ä¸‹è½½å®Œæˆåè§£å‹åˆ°/usr/local/logstashç›®å½•ä¸‹ï¼Œè§£å‹å‘½ä»¤å¦‚ä¸‹ï¼š 12mkdir /usr/local/logstashtar -zxvf logstash-8.17.3-linux-x86_64.tar.gz -C /usr/local/logstash elasticsearchå’Œkibanaéƒ½ä¸èƒ½ç”¨rootç”¨æˆ·å¯åŠ¨ï¼Œä¸ºäº†ç»Ÿä¸€ç®¡ç†ï¼Œlogstashä¹Ÿä½¿ç”¨è¿™ä¸ªç”¨æˆ·ï¼ˆéå¿…è¦ï¼‰ åˆ›å»ºç”¨æˆ·elasticï¼Œå¹¶è®¾ç½®å¯†ç ï¼Œè¿™ä¸€æ­¥æˆ‘ä»¬åœ¨å®‰è£…elasticsearchçš„æ—¶å€™å·²ç»é…ç½®è¿‡äº†ï¼Œè¿™é‡Œå°±ä¸å†èµ˜è¿°äº† 12useradd elasticpasswd elastic ä¿®æ”¹logstashå®‰è£…ç›®å½•çš„ç”¨æˆ·æƒé™ 1chown -R elastic:elastic /usr/local/logstash åˆ‡æ¢åˆ°elasticç”¨æˆ·ä¸‹æ‰§è¡Œå‘½ä»¤ 1234# åˆ‡æ¢ç”¨æˆ·su - elastic# è¿›å…¥logstashå®‰è£…ç›®å½•cd /usr/local/logstash/logstash-8.17.3/ è¿è¡Œä¸€ä¸ªç®€å•çš„æµ‹è¯• 123456789101112131415161718192021# -e: ç›´æ¥æŠŠé…ç½®æ”¾åœ¨å‘½ä»¤ä¸­ï¼Œè¿™æ ·å¯ä»¥æœ‰æ•ˆå¿«é€Ÿè¿›è¡Œæµ‹è¯•# input &#123; stdin &#123; &#125; &#125;: è¾“å…¥æ’ä»¶ï¼Œä»æ ‡å‡†è¾“å…¥ä¸­è¯»å–æ•°æ®# output &#123; stdout &#123;&#125; &#125;: è¾“å‡ºæ’ä»¶ï¼Œå°†æ•°æ®è¾“å‡ºåˆ°æ ‡å‡†è¾“å‡º# è¿™é‡ŒåªåŒ…å«äº† input å’Œ output ä¸¤ä¸ªéƒ¨åˆ†ï¼Œå®é™…ä½¿ç”¨ä¸­è¿˜éœ€è¦æ·»åŠ  filter éƒ¨åˆ†./bin/logstash -e &#x27;input &#123; stdin &#123; &#125; &#125; output &#123; stdout &#123;&#125; &#125;&#x27;# è¾“å‡ºï¼šã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ # è¾“å‡ºå¯åŠ¨ä¿¡æ¯The stdin plugin is now waiting for input: # è¾“å‡ºæç¤ºä¿¡æ¯ï¼Œæç¤ºä½ è¾“å…¥å†…å®¹hello world # æˆ‘è¾“å…¥å†…å®¹# logstashè¾“å‡ºå†…å®¹&#123; &quot;message&quot; =&gt; &quot;hello world&quot;, &quot;@version&quot; =&gt; &quot;1&quot;, &quot;event&quot; =&gt; &#123; &quot;original&quot; =&gt; &quot;hello world&quot; &#125;, &quot;host&quot; =&gt; &#123; &quot;hostname&quot; =&gt; &quot;ip-10-250-0-239.cn-northwest-1.compute.internal&quot; &#125;, &quot;@timestamp&quot; =&gt; 2025-03-27T06:48:12.810617855Z&#125; ä¹Ÿå¯ä»¥é€šè¿‡é…ç½®æ–‡ä»¶å¯åŠ¨logstash 1234567891011121314# vim test.confinput &#123; stdin &#123; &#125;&#125;output &#123; stdout &#123; codec =&gt; rubydebug &#125;&#125;# codec =&gt; rubydebug : æ˜¯æŒ‡å®šäº†ä¸€ä¸ªç¼–ç å™¨ï¼ˆCodecï¼‰ä¸º rubydebugã€‚# ç¼–ç å™¨è´Ÿè´£å¦‚ä½•æ ¼å¼åŒ–è¾“å‡ºçš„æ•°æ®ã€‚# Rubydebug ç¼–ç å™¨æ˜¯ä¸€ç§ç‰¹åˆ«é€‚åˆå¼€å‘å’Œè°ƒè¯•ç›®çš„çš„ç¼–ç å™¨ï¼Œå› ä¸ºå®ƒèƒ½ä»¥ç›¸å½“æ˜“è¯»çš„å½¢å¼å±•ç¤ºå¤æ‚çš„ç»“æ„åŒ–æ•°æ®ï¼Œæ¯”å¦‚åµŒå¥—çš„å“ˆå¸Œè¡¨æˆ–è€…æ•°ç»„ã€‚# é™¤äº† Rubydebug ç¼–ç å™¨ï¼ŒLogstash è¿˜æä¾›äº†å…¶ä»–å‡ ç§ç¼–ç å™¨ï¼Œæ¯”å¦‚ jsonã€plainã€multiline ç­‰ç­‰ã€‚# å…·ä½“å¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼šhttps://www.elastic.co/guide/en/logstash/current/codec-plugins.html 1./bin/logstash -f ./test.conf Logstashæ’ä»¶ Input Plugins https://www.elastic.co/guide/en/logstash/8.17/input-plugins.html ä¸€ä¸ª Pipelineå¯ä»¥æœ‰å¤šä¸ªinputæ’ä»¶ 12345- Stdin / File- Beats / Log4J /Elasticsearch / JDBC / Kafka /Rabbitmq /Redis- JMX/ HTTP / Websocket / UDP / TCP- Google Cloud Storage / S3- Github / Twitter Filter Plugins https://www.elastic.co/guide/en/logstash/8.17/filter-plugins.html Filter Pluginå¯ä»¥å¯¹Logstash Eventè¿›è¡Œå„ç§å¤„ç†ï¼Œä¾‹å¦‚è§£æï¼Œåˆ é™¤å­—æ®µï¼Œç±»å‹è½¬æ¢ 1234567891011- Date: æ—¥æœŸè§£æ- Dissect: åˆ†å‰²ç¬¦è§£æ- Grok: æ­£åˆ™åŒ¹é…è§£æ- Mutate: å¯¹å­—æ®µåšå„ç§æ“ä½œ- Convert : ç±»å‹è½¬æ¢- Gsub : å­—ç¬¦ä¸²æ›¿æ¢- Split / Join /Merge: å­—ç¬¦ä¸²åˆ‡å‰²ï¼Œæ•°ç»„åˆå¹¶å­—ç¬¦ä¸²ï¼Œæ•°ç»„åˆå¹¶æ•°ç»„- Rename: å­—æ®µé‡å‘½å- Update / Replace: å­—æ®µå†…å®¹æ›´æ–°æ›¿æ¢- Remove_field: å­—æ®µåˆ é™¤- Ruby: åˆ©ç”¨Ruby ä»£ç æ¥åŠ¨æ€ä¿®æ”¹Event Output Plugins https://www.elastic.co/guide/en/logstash/8.17/output-plugins.html å°†Eventå‘é€åˆ°ç‰¹å®šçš„ç›®çš„åœ°ï¼Œæ˜¯ Pipeline çš„æœ€åä¸€ä¸ªé˜¶æ®µã€‚å¸¸è§ Output Pluginsï¼š 1234- Elasticsearch- Email / Pageduty- Influxdb / Kafka / Mongodb / Opentsdb / Zabbix- Http / TCP / Websocket Codec Plugins https://www.elastic.co/guide/en/logstash/8.17/codec-plugins.html å°†åŸå§‹æ•°æ®decodeæˆEvent;å°†Event encodeæˆç›®æ ‡æ•°æ®ï¼Œå†…ç½®çš„Codec Plugins: 123- Line / Multiline- JSON / Avro / Cef (ArcSight Common Event Format)- Dots / Rubydebug FileBeatæ¦‚è¿° Beats æ˜¯ä¸€ä¸ªå…è´¹ä¸”å¼€æ”¾çš„å¹³å°ï¼Œé›†åˆäº†å¤šç§å•ä¸€ç”¨é€”çš„æ•°æ®é‡‡é›†å™¨ã€‚å®ƒä»¬ä»æˆç™¾ä¸Šåƒæˆ–æˆåƒä¸Šä¸‡å°æœºå™¨å’Œç³»ç»Ÿå‘ Logstash æˆ– Elasticsearch å‘é€æ•°æ®ã€‚ FileBeat ä¸“é—¨ç”¨äºè½¬å‘å’Œæ”¶é›†æ—¥å¿—æ•°æ®çš„è½»é‡çº§é‡‡é›†å·¥å…·ã€‚å®ƒå¯ä»¥ä½œä¸ºä»£ç†å®‰è£…åœ¨æœåŠ¡å™¨ä¸Šï¼ŒFileBeatç›‘è§†æŒ‡å®šè·¯å¾„çš„æ—¥å¿—æ–‡ä»¶ï¼Œæ”¶é›†æ—¥å¿—æ•°æ®ï¼Œå¹¶å°†æ”¶é›†åˆ°çš„æ—¥å¿—è½¬å‘åˆ°Elasticsearchæˆ–è€…Logstashã€‚ logstash vs FileBeat Logstashæ˜¯åœ¨jvmä¸Šè¿è¡Œçš„ï¼Œèµ„æºæ¶ˆè€—æ¯”è¾ƒå¤§ã€‚è€ŒFileBeatæ˜¯åŸºäºgolangç¼–å†™çš„ï¼ŒåŠŸèƒ½è¾ƒå°‘ä½†èµ„æºæ¶ˆè€—ä¹Ÿæ¯”è¾ƒå°ï¼Œæ›´è½»é‡çº§ã€‚ Logstash å’ŒFilebeatéƒ½å…·æœ‰æ—¥å¿—æ”¶é›†åŠŸèƒ½ï¼ŒFilebeatæ›´è½»é‡ï¼Œå ç”¨èµ„æºæ›´å°‘ Logstash å…·æœ‰FilteråŠŸèƒ½ï¼Œèƒ½è¿‡æ»¤åˆ†ææ—¥å¿— ä¸€èˆ¬ç»“æ„éƒ½æ˜¯Filebeaté‡‡é›†æ—¥å¿—ï¼Œç„¶åå‘é€åˆ°æ¶ˆæ¯é˜Ÿåˆ—ã€Redisã€MQä¸­ï¼Œç„¶åLogstashå»è·å–ï¼Œåˆ©ç”¨FilteråŠŸèƒ½è¿‡æ»¤åˆ†æï¼Œç„¶åå­˜å‚¨åˆ°Elasticsearchä¸­ FileBeatå’ŒLogstashé…åˆï¼Œå®ç°èƒŒå‹æœºåˆ¶ã€‚å½“å°†æ•°æ®å‘é€åˆ°Logstashæˆ– Elasticsearchæ—¶ï¼ŒFilebeatä½¿ç”¨èƒŒå‹æ•æ„Ÿåè®®ï¼Œä»¥åº”å¯¹æ›´å¤šçš„æ•°æ®é‡ã€‚å¦‚æœLogstashæ­£åœ¨å¿™äºå¤„ç†æ•°æ®ï¼Œåˆ™ä¼šå‘Šè¯‰Filebeat å‡æ…¢è¯»å–é€Ÿåº¦ã€‚ä¸€æ—¦æ‹¥å µå¾—åˆ°è§£å†³ï¼ŒFilebeatå°±ä¼šæ¢å¤åˆ°åŸæ¥çš„æ­¥ä¼å¹¶ç»§ç»­ä¼ è¾“æ•°æ®ã€‚ FileBeatä¸‹è½½å’Œå®‰è£… ä¸‹è½½åœ°å€ï¼šhttps://www.elastic.co/cn/downloads/past-releases#filebeat é€‰æ‹©å¯¹åº”çš„ç‰ˆæœ¬ï¼šè¿™é‡Œé€‰æ‹©å½“å‰çš„æœ€æ–°ç‰ˆFileBeat 8.17.3ï¼Œä¹‹åé€‰æ‹©å¯¹åº”çš„æ“ä½œç³»ç»ŸLINUX X86_64 1wget https://artifacts.elastic.co/downloads/beats/filebeat/filebeat-8.17.3-linux-x86_64.tar.gz ä¸‹è½½å®Œæˆåè§£å‹åˆ°/usr/local/filebeatç›®å½•ä¸‹ï¼Œè§£å‹å‘½ä»¤å¦‚ä¸‹ï¼š 12mkdir /usr/local/filebeattar -zxvf filebeat-8.17.3-linux-x86_64.tar.gz -C /usr/local/filebeat ä¿®æ”¹logstashå®‰è£…ç›®å½•çš„ç”¨æˆ·æƒé™ 1chown -R elastic:elastic /usr/local/filebeat åˆ‡æ¢åˆ°elasticç”¨æˆ·ä¸‹æ‰§è¡Œå‘½ä»¤ 1234# åˆ‡æ¢ç”¨æˆ·su - elastic# è¿›å…¥ filebeat å®‰è£…ç›®å½•cd /usr/local/filebeat/filebeat-8.17.3-linux-x86_64/ ç»å…¸çš„ELKæ¶æ„ Filebeatæ—¥å¿—æ”¶é›†ï¼šFilebeatä½œä¸ºè½»é‡çº§çš„æ—¥å¿—æ”¶é›†ä»£ç†ï¼Œéƒ¨ç½²åœ¨å®¢æˆ·ç«¯ä¸Šï¼Œæ¶ˆè€—èµ„æºå°‘ï¼Œèƒ½å¤Ÿé«˜æ•ˆåœ°æ”¶é›†æ—¥å¿—æ•°æ®ã€‚ Logstashæ•°æ®å¤„ç†ï¼šLogstashä½œä¸ºæ•°æ®å¤„ç†ç®¡é“ï¼Œè´Ÿè´£å°†Filebeatæ”¶é›†çš„æ—¥å¿—æ•°æ®è¿›è¡Œè¿‡æ»¤ã€è½¬æ¢ç­‰æ“ä½œï¼Œç„¶åå‘é€åˆ°Elasticsearchè¿›è¡Œå­˜å‚¨ã€‚ Elasticsearchå­˜å‚¨ä¸æœç´¢ï¼šElasticsearchæ˜¯ä¸€ä¸ªåŸºäºLuceneçš„åˆ†å¸ƒå¼æœç´¢å’Œåˆ†æå¼•æ“ï¼Œæä¾›å¼ºå¤§çš„æ•°æ®å­˜å‚¨å’Œæœç´¢èƒ½åŠ›ã€‚ Kibanaå¯è§†åŒ–ï¼šKibanaä¸ºElasticsearchæä¾›Webå¯è§†åŒ–ç•Œé¢ï¼Œå…è®¸ç”¨æˆ·é€šè¿‡å›¾è¡¨ã€ä»ªè¡¨ç›˜ç­‰æ–¹å¼ç›´è§‚åœ°æŸ¥çœ‹å’Œåˆ†ææ—¥å¿—æ•°æ®ã€‚ é€‚ç”¨åœºæ™¯ï¼šç»å…¸çš„ELKæ¶æ„ä¸»è¦é€‚ç”¨äºæ•°æ®é‡è¾ƒå°çš„å¼€å‘ç¯å¢ƒã€‚ç„¶è€Œï¼Œç”±äºç¼ºå°‘æ¶ˆæ¯é˜Ÿåˆ—çš„ç¼“å†²æœºåˆ¶ï¼Œå½“Logstashæˆ–Elasticsearchå‡ºç°æ•…éšœæ—¶ï¼Œå¯èƒ½å­˜åœ¨æ•°æ®ä¸¢å¤±çš„é£é™©ã€‚ ä¸€ä¸ªç»å…¸ELKæ¶æ„ç¤ºä¾‹ FileBeaté‡‡é›†NginxæœåŠ¡å™¨æ—¥å¿—å¹¶å‘é€åˆ°Logstash åˆ›å»ºé…ç½®æ–‡ä»¶filebeat-nginx.ymlï¼Œå°†å…¶ä¿å­˜åˆ°Filebeatå®‰è£…ç›®å½•ä¸‹çš„confç›®å½•ä¸‹ã€‚ 12345678910111213141516171819202122# å› ä¸ºNginxçš„access.logæ—¥å¿—éƒ½æ˜¯ä»¥IPåœ°å€å¼€å¤´çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¿®æ”¹ä¸‹åŒ¹é…å­—æ®µã€‚# ä¸ä»¥ipåœ°å€å¼€å¤´çš„è¡Œè¿½åŠ åˆ°ä¸Šä¸€è¡Œfilebeat.inputs: # è¾“å…¥æºé…ç½®- type: log # æ—¥å¿—ç±»å‹ enabled: true # æ˜¯å¦å¯ç”¨ paths: # é‡‡é›†è·¯å¾„ - /var/log/nginx/access*.* exclude_files: [&quot;.gz$&quot;] # æ’é™¤ä»¥.gz ç»“å°¾çš„æ–‡ä»¶ multiline.pattern: &#x27;^\\\\d&#123;1,3&#125;\\\\.\\\\d&#123;1,3&#125;\\\\.\\\\d&#123;1,3&#125;\\\\.\\\\d&#123;1,3&#125;\\\\s&#x27; # åŒ¹é…ä»¥IPåœ°å€å¼€å¤´ï¼Œå¹¶ç´§è·Ÿä¸€ä¸ªç©ºç™½å­—ç¬¦ multiline.negate: true # ä¸ä»¥ipåœ°å€å¼€å¤´çš„è¡Œè¿½åŠ åˆ°ä¸Šä¸€è¡Œ multiline.match: after # è¿½åŠ åˆ°ä¸Šä¸€è¡Œçš„åé¢ # multiline: å¤šè¡Œæ—¥å¿—é…ç½®ï¼Œè¿™é‡Œå®é™…ä¸Šä¸éœ€è¦é…ç½®å¤šè¡Œè®¾ç½®ï¼Œå› ä¸ºnginxçš„accessæ—¥å¿—éƒ½æ˜¯å•è¡Œæ—¥å¿—ï¼Œè¿™é‡Œåªåšæ¼”ç¤º # pattern: æ­£åˆ™è¡¨è¾¾å¼ # negate: falseï¼ŒåŒ¹é…patternçš„è¡Œåˆå¹¶åˆ°ä¸Šä¸€è¡Œï¼›trueï¼Œä¸åŒ¹é…patternçš„è¡Œåˆå¹¶åˆ°ä¸Šä¸€è¡Œ # match: afterï¼Œåˆå¹¶åˆ°ä¸Šä¸€è¡Œçš„æœ«å°¾ï¼›beforeï¼Œåˆå¹¶åˆ°ä¸Šä¸€è¡Œçš„å¼€å¤´ scan_frequency: 10s # æ¯ 10 ç§’æ‰«æä¸€æ¬¡æ—¥å¿—æ–‡ä»¶ clean_removed: true # åœ¨æ—¥å¿—æ–‡ä»¶è¢«åˆ é™¤åæ˜¯å¦ä»å…¶å†…éƒ¨çŠ¶æ€ä¸­ç§»é™¤è¯¥æ–‡ä»¶çš„è®°å½• clean_inactive: 2h # åœ¨æ—¥å¿—æ–‡ä»¶å¤„äºéæ´»åŠ¨çŠ¶æ€å¤šé•¿æ—¶é—´åå°†å…¶ä»çŠ¶æ€æ•°æ®åº“ä¸­ç§»,è®¾ç½®ä¸ºæ¯” ignore_older + scan_frequency æ›´å¤§çš„å€¼ ignore_older: 1h # å¿½ç•¥é‚£äº›æ¯”å½“å‰æ—¶é—´æ—©äº 1 å°æ—¶çš„æ—¥å¿—æ–‡ä»¶output.logstash: # è¾“å‡ºé…ç½®ï¼Œè¿™é‡Œæ˜¯å‘é€åˆ°Logstash enabled: true # æ˜¯å¦å¯ç”¨ hosts: [&quot;10.250.0.239:5044&quot;] # LogstashæœåŠ¡åœ°å€ ä¸ºFileBeatçš„ç”¨æˆ·åˆ†é…æ—¥å¿—ç›®å½•çš„è¯»å–æƒé™ 12# ä½¿ç”¨ setfaclå‘½ä»¤ä¸ºelasticç”¨æˆ·åˆ†é…æ—¥å¿—ç›®å½•çš„è¯»å–æƒé™sudo setfacl -d -m u:elastic:r-x -R /var/log/nginx/ å¯åŠ¨FileBeat 123./filebeat -e -c conf/filebeat-nginx.yml# åå°å¯åŠ¨nohup ./filebeat -e -c conf/filebeat-nginx.yml &amp; åœ¨å¯åŠ¨filebeatæ—¶å¯èƒ½ä¼šé‡åˆ°å¦‚ä¸‹é”™è¯¯ 1Exiting: error loading config file: config file (&quot;conf/filebeat-nginx.yml&quot;) can only be writable by the owner but the permissions are &quot;-rw-rw-r--&quot; (to fix the permissions use: &#x27;chmod go-w /usr/local/filebeat/filebeat-8.17.3-linux-x86_64/conf/filebeat-nginx.yml&#x27;) å› ä¸ºå®‰å…¨åŸå› ä¸è¦å…¶ä»–ç”¨æˆ·å†™çš„æƒé™ï¼Œå»æ‰å†™çš„æƒé™å°±å¯ä»¥äº† 1chmod go-w conf/filebeat-nginx.yml é…ç½®Logstashæ¥æ”¶FileBeatæ”¶é›†çš„æ•°æ®å¹¶æ‰“å° åˆ›å»ºé…ç½®æ–‡ä»¶logstash-nginx.confï¼Œå°†å…¶ä¿å­˜åˆ°Logstashå®‰è£…ç›®å½•ä¸‹çš„configç›®å½•ä¸‹ã€‚ 1234567891011121314# è¿›å…¥logstashå®‰è£…ç›®å½•# vim config/logstash-nginx.conf# é…ç½®ä»FileBeatæ¥æ”¶æ•°æ®input &#123; # è¾“å…¥æºé…ç½® beats &#123; # ä»FileBeatæ¥æ”¶æ•°æ® port =&gt; 5044 # ç›‘å¬5044ç«¯å£ &#125;&#125;output &#123; # è¾“å‡ºé…ç½® stdout &#123; # æ‰“å°åˆ°æ§åˆ¶å° codec =&gt; rubydebug # æŒ‡å®šç¼–ç å™¨ &#125;&#125; æµ‹è¯•logstashé…ç½®æ˜¯å¦æ­£ç¡® 1bin/logstash -f config/logstash-nginx.conf --config.test_and_exit å¯åŠ¨logstash 12345678910111213141516171819202122232425262728293031323334353637# reload.automaticï¼šä¿®æ”¹é…ç½®æ–‡ä»¶æ—¶è‡ªåŠ¨é‡æ–°åŠ è½½bin/logstash -f config/logstash-nginx.conf --config.reload.automatic# æ­¤æ—¶åœ¨æ§åˆ¶å°ä¼šçœ‹åˆ°å¦‚ä¸‹è¾“å‡ºï¼š&#123; &quot;input&quot; =&gt; &#123; &quot;type&quot; =&gt; &quot;log&quot; &#125;, &quot;@version&quot; =&gt; &quot;1&quot;, &quot;message&quot; =&gt; &quot;1.119.161.30 - elastic [27/Mar/2025:08:52:41 +0000] \\&quot;GET /_cluster/stats HTTP/1.1\\&quot; 200 7445 \\&quot;-\\&quot; \\&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/134.0.0.0 Safari/537.36\\&quot; \\&quot;-\\&quot;&quot;, &quot;log&quot; =&gt; &#123; &quot;file&quot; =&gt; &#123; &quot;path&quot; =&gt; &quot;/var/log/nginx/access.log&quot; &#125;, &quot;offset&quot; =&gt; 42985 &#125;, &quot;tags&quot; =&gt; [ [0] &quot;beats_input_codec_plain_applied&quot; ], &quot;@timestamp&quot; =&gt; 2025-03-27T08:52:42.947Z, &quot;ecs&quot; =&gt; &#123; &quot;version&quot; =&gt; &quot;8.0.0&quot; &#125;, &quot;agent&quot; =&gt; &#123; &quot;id&quot; =&gt; &quot;4dbe185b-900d-4990-b841-c13bf9618fc6&quot;, &quot;name&quot; =&gt; &quot;ip-10-250-0-239.cn-northwest-1.compute.internal&quot;, &quot;ephemeral_id&quot; =&gt; &quot;6bb04808-7da7-4acb-95fd-f3f915651457&quot;, &quot;type&quot; =&gt; &quot;filebeat&quot;, &quot;version&quot; =&gt; &quot;8.17.3&quot; &#125;, &quot;event&quot; =&gt; &#123; &quot;original&quot; =&gt; &quot;1.119.161.30 - elastic [27/Mar/2025:08:52:41 +0000] \\&quot;GET /_cluster/stats HTTP/1.1\\&quot; 200 7445 \\&quot;-\\&quot; \\&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/134.0.0.0 Safari/537.36\\&quot; \\&quot;-\\&quot;&quot; &#125;, &quot;host&quot; =&gt; &#123; &quot;name&quot; =&gt; &quot;ip-10-250-0-239.cn-northwest-1.compute.internal&quot; &#125;&#125; åˆ©ç”¨Logstashè¿‡æ»¤å™¨è§£ææ—¥å¿— ä»æ‰“å°ç»“æœçœ‹åˆ°åŒ…å«äº†å¤§é‡çš„æ— å…³æ•°æ®ï¼Œæ­¤æ—¶å¯ä»¥åˆ©ç”¨Logstashè¿‡æ»¤å™¨è§£ææ—¥å¿—ï¼Œè¿™é‡Œä½¿ç”¨Grokæ’ä»¶ Grokæ˜¯ä¸€ç§å°†éç»“æ„åŒ–æ—¥å¿—è§£æä¸ºç»“æ„åŒ–çš„æ’ä»¶ã€‚è¿™ä¸ªå·¥å…·éå¸¸é€‚åˆç”¨æ¥è§£æç³»ç»Ÿæ—¥å¿—ã€WebæœåŠ¡å™¨æ—¥å¿—ã€MySQLæˆ–è€…æ˜¯ä»»æ„å…¶ä»–çš„æ—¥å¿—æ ¼å¼ã€‚ Grokæ˜¯é€šè¿‡æ¨¡å¼åŒ¹é…çš„æ–¹å¼æ¥è¯†åˆ«æ—¥å¿—ä¸­çš„æ•°æ®,å¯ä»¥æŠŠGrokæ’ä»¶ç®€å•ç†è§£ä¸ºå‡çº§ç‰ˆæœ¬çš„æ­£åˆ™è¡¨è¾¾å¼ã€‚å®ƒæ‹¥æœ‰æ›´å¤šçš„æ¨¡å¼ï¼Œé»˜è®¤Logstashæ‹¥æœ‰120ä¸ªæ¨¡å¼ã€‚å¦‚æœè¿™äº›æ¨¡å¼ä¸æ»¡è¶³æˆ‘ä»¬è§£ææ—¥å¿—çš„éœ€æ±‚ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æ¥è¿›è¡ŒåŒ¹é…ã€‚ GROKæ¨¡å¼å‚è€ƒ grokæ¨¡å¼çš„è¯­æ³•æ˜¯: 1234%&#123;SYNTAX:SEMANTIC&#125;# SYNTAXï¼ˆè¯­æ³•ï¼‰æŒ‡çš„æ˜¯Grokæ¨¡å¼åç§°ï¼ŒSEMANTICï¼ˆè¯­ä¹‰ï¼‰æ˜¯ç»™æ¨¡å¼åŒ¹é…åˆ°çš„æ–‡æœ¬å­—æ®µåã€‚ä¾‹å¦‚ï¼š%&#123;NUMBER:duration&#125; %&#123;IP:client&#125;# durationè¡¨ç¤ºï¼šåŒ¹é…ä¸€ä¸ªæ•°å­—ï¼Œclientè¡¨ç¤ºåŒ¹é…ä¸€ä¸ªIPåœ°å€ã€‚ åŒ¹é…nginxæ—¥å¿— 123456789101112131415161718192021222324252627282930313233# nginx accessæ—¥å¿—æ ¼å¼1.119.161.30 - elastic [27/Mar/2025:03:05:36 +0000] &quot;GET /_cluster/stats HTTP/1.1&quot; 200 7446 &quot;-&quot; &quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/134.0.0.0 Safari/537.36&quot; &quot;-&quot;# grok%&#123;IP:client_ip&#125; - %&#123;USER:remote_user&#125; \\[%&#123;HTTPDATE:timestamp&#125;\\] \\&quot;%&#123;WORD:verb&#125; %&#123;URIPATHPARAM:request&#125; HTTP/%&#123;NUMBER:httpversion&#125;\\&quot; %&#123;INT:http_status&#125; %&#123;INT:body_bytes_sent&#125; \\&quot;%&#123;NOTSPACE:referrer&#125;\\&quot; \\&quot;%&#123;GREEDYDATA:agent&#125;\\&quot; %&#123;QUOTEDSTRING:x_forwarded_for&#125;# è§£é‡Šæ¯ä¸ªéƒ¨åˆ†çš„ä½œç”¨ï¼š# %&#123;IP:client_ip&#125;ï¼šåŒ¹é…å®¢æˆ·ç«¯ IP åœ°å€ã€‚# -ï¼šåŒ¹é…ä¸€ä¸ªç ´æŠ˜å·ï¼ˆ-ï¼‰ï¼Œè¡¨ç¤ºåŒ¿åç”¨æˆ·æˆ–æœªè®¤è¯ç”¨æˆ·ã€‚# %&#123;USER:remote_user&#125;ï¼šåŒ¹é…è¿œç¨‹ç”¨æˆ·åï¼Œ - è¡¨ç¤ºåŒ¿åç”¨æˆ·ã€‚# \\[%&#123;HTTPDATE:timestamp&#125;\\]ï¼šåŒ¹é…è¯·æ±‚çš„æ—¶é—´æˆ³ï¼Œæ ¼å¼ä¸º [27/Mar/2025:03:05:36 +0000]ã€‚# \\&quot;%&#123;WORD:verb&#125; : åŒ¹é…è¯·æ±‚æ–¹æ³• (GET)# %&#123;URIPATHPARAM:request&#125; : åŒ¹é…è¯·æ±‚è·¯å¾„ (/_cluster/stats)# HTTP/%&#123;NUMBER:httpversion&#125;\\\\\\&quot;ï¼šåŒ¹é… HTTP ç‰ˆæœ¬ (HTTP/1.1)ã€‚# %&#123;INT:http_status&#125;ï¼šåŒ¹é… HTTP å“åº”çŠ¶æ€ç  (200)ã€‚# %&#123;INT:body_bytes_sent&#125;ï¼šåŒ¹é…å“åº”ä½“çš„å­—èŠ‚æ•° (7446)ã€‚# \\&quot;%&#123;NOTSPACE:referrer&#125;\\&quot;ï¼šåŒ¹é…å¼•ç”¨é¡µ (Referer) å­—æ®µï¼Œè¿™é‡Œä¸ºç©º (&quot;-&quot;)ã€‚# \\&quot;%&#123;GREEDYDATA:agent&#125;\\&quot;ï¼šåŒ¹é…ç”¨æˆ·ä»£ç† (User-Agent) å­—æ®µã€‚GREEDYDATA ä¼šåŒ¹é…å°½å¯èƒ½å¤šçš„æ•°æ®ï¼Œç›´åˆ°é‡åˆ°ä¸‹ä¸€ä¸ªåˆ†éš”ç¬¦ã€‚# %&#123;QUOTEDSTRING:x_forwarded_for&#125;ï¼šåŒ¹é… X-Forwarded-For å¤´å­—æ®µï¼Œè¿™é‡Œä¸ºç©º (&quot;-&quot;)ã€‚# åŒ¹é…ç»“æœ&#123; &quot;request&quot;: &quot;/_cluster/stats&quot;, &quot;agent&quot;: &quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/134.0.0.0 Safari/537.36&quot;, &quot;body_bytes_sent&quot;: &quot;7446&quot;, &quot;verb&quot;: &quot;GET&quot;, &quot;x_forwarded_for&quot;: &quot;\\&quot;-\\&quot;&quot;, &quot;remote_user&quot;: &quot;elastic&quot;, &quot;referrer&quot;: &quot;-&quot;, &quot;client_ip&quot;: &quot;1.119.161.30&quot;, &quot;httpversion&quot;: &quot;1.1&quot;, &quot;http_status&quot;: &quot;200&quot;, &quot;timestamp&quot;: &quot;27/Mar/2025:03:05:36 +0000&quot;&#125; åŒ¹é…Grokæ¨¡å¼æ˜¯ä¸ªéå¸¸ç¹ççš„è¿‡ç¨‹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨Kibanaæ¥è¿›è¡Œå¯è§†åŒ–çš„Grokè°ƒè¯• groké…ç½® 12345grok &#123; match =&gt; &#123; &quot;message&quot; =&gt; &quot;%&#123;IP:client_ip&#125; - %&#123;USER:remote_user&#125; \\[%&#123;HTTPDATE:timestamp&#125;\\] \\&quot;%&#123;WORD:verb&#125; %&#123;URIPATHPARAM:request&#125; HTTP/%&#123;NUMBER:httpversion&#125;\\&quot; %&#123;INT:http_status&#125; %&#123;INT:body_bytes_sent&#125; \\&quot;%&#123;NOTSPACE:referrer&#125;\\&quot; \\&quot;%&#123;GREEDYDATA:agent&#125;\\&quot; %&#123;QUOTEDSTRING:x_forwarded_for&#125;&quot; &#125;&#125; ä½¿ç”¨mutateæ’ä»¶è¿‡æ»¤æ‰ä¸éœ€è¦çš„å­—æ®µ é™¤äº†nginxæ—¥å¿—æœ¬èº«çš„æ ¼å¼å¤–ï¼Œlogstashè¿˜ä¼šæ‰“å°è®¸å¤šæˆ‘ä»¬ä¸éœ€è¦çš„å­—æ®µï¼Œæ­¤æ—¶å¯ä»¥ä½¿ç”¨mutateæ’ä»¶æ¥è¿‡æ»¤æ‰ä¸éœ€è¦çš„å­—æ®µã€‚ 1234mutate &#123; enable_metric =&gt; &quot;false&quot; # ç¦ç”¨æŒ‡æ ‡ä¸ŠæŠ¥ remove_field =&gt; [&quot;message&quot;, &quot;log&quot;, &quot;tags&quot;, &quot;input&quot;, &quot;agent&quot;, &quot;host&quot;, &quot;ecs&quot;, &quot;@version&quot;] # ç§»é™¤ä¸éœ€è¦çš„å­—æ®µ&#125; ä½¿ç”¨Dateæ’ä»¶å¯¹æ—¶é—´è¿›è¡Œæ ¼å¼è½¬æ¢ 1234date &#123; match =&gt; [&quot;timestamp&quot;,&quot;dd/MMM/yyyy:HH:mm:ss Z&quot;,&quot;yyyy-MM-dd HH:mm:ss&quot;] # æ—¶é—´æ ¼å¼è½¬æ¢ target =&gt; &quot;timestamp&quot; # ç›®æ ‡å­—æ®µ&#125; å®Œæ•´çš„Logstashé…ç½® 1234567891011121314151617181920212223242526272829303132# è¿›å…¥logstashå®‰è£…ç›®å½•# vim config/logstsh-nginx.conf# é…ç½®ä»FileBeatæ¥æ”¶æ•°æ®input &#123; # è¾“å…¥æºé…ç½® beats &#123; # ä»FileBeatæ¥æ”¶æ•°æ® port =&gt; 5044 # ç›‘å¬5044ç«¯å£ &#125;&#125;filter &#123; # è¿‡æ»¤å™¨é…ç½® grok &#123; match =&gt; &#123; &quot;message&quot; =&gt; &quot;%&#123;IP:client_ip&#125; - %&#123;USER:remote_user&#125; \\[%&#123;HTTPDATE:timestamp&#125;\\] \\&quot;%&#123;WORD:verb&#125; %&#123;URIPATHPARAM:request&#125; HTTP/%&#123;NUMBER:httpversion&#125;\\&quot; %&#123;INT:http_status&#125; %&#123;INT:body_bytes_sent&#125; \\&quot;%&#123;NOTSPACE:referrer&#125;\\&quot; \\&quot;%&#123;GREEDYDATA:agent&#125;\\&quot; %&#123;QUOTEDSTRING:x_forwarded_for&#125;&quot; &#125; &#125; mutate &#123; enable_metric =&gt; &quot;false&quot; # ç¦ç”¨æŒ‡æ ‡ä¸ŠæŠ¥ remove_field =&gt; [&quot;message&quot;, &quot;log&quot;, &quot;tags&quot;, &quot;input&quot;, &quot;agent&quot;, &quot;host&quot;, &quot;ecs&quot;, &quot;@version&quot;] # ç§»é™¤ä¸éœ€è¦çš„å­—æ®µ &#125; date &#123; match =&gt; [&quot;timestamp&quot;,&quot;dd/MMM/yyyy:HH:mm:ss Z&quot;,&quot;yyyy-MM-dd HH:mm:ss&quot;] # æ—¶é—´æ ¼å¼è½¬æ¢ target =&gt; &quot;timestamp&quot; # ç›®æ ‡å­—æ®µ &#125;&#125;output &#123; # è¾“å‡ºé…ç½® stdout &#123; # æ‰“å°åˆ°æ§åˆ¶å° codec =&gt; rubydebug # æŒ‡å®šç¼–ç å™¨ &#125;&#125; é‡æ–°å¯åŠ¨logstashåå¾—åˆ°å¦‚ä¸‹ç»“æœï¼š 12345678910111213141516&#123; &quot;event&quot; =&gt; &#123; &quot;original&quot; =&gt; &quot;1.119.161.30 - elastic [27/Mar/2025:09:49:41 +0000] \\&quot;GET /_cluster/stats HTTP/1.1\\&quot; 200 7445 \\&quot;-\\&quot; \\&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/134.0.0.0 Safari/537.36\\&quot; \\&quot;-\\&quot;&quot; &#125;, &quot;client_ip&quot; =&gt; &quot;1.119.161.30&quot;, &quot;request&quot; =&gt; &quot;/_cluster/stats&quot;, &quot;http_status&quot; =&gt; &quot;200&quot;, &quot;@timestamp&quot; =&gt; 2025-03-27T09:49:45.751Z, &quot;body_bytes_sent&quot; =&gt; &quot;7445&quot;, &quot;x_forwarded_for&quot; =&gt; &quot;\\&quot;-\\&quot;&quot;, &quot;timestamp&quot; =&gt; 2025-03-27T09:49:41.000Z, &quot;referrer&quot; =&gt; &quot;-&quot;, &quot;remote_user&quot; =&gt; &quot;elastic&quot;, &quot;httpversion&quot; =&gt; &quot;1.1&quot;, &quot;verb&quot; =&gt; &quot;GET&quot;&#125; å°†ç»“æœè¾“å‡ºåˆ°ES 1234567891011121314# åœ¨è¾“å‡ºé…ç½®ä¸­æ·»åŠ ESè¾“å‡ºé…ç½®output &#123; # è¾“å‡ºé…ç½® stdout &#123; # æ‰“å°åˆ°æ§åˆ¶å° codec =&gt; rubydebug # æŒ‡å®šç¼–ç å™¨ &#125; elasticsearch &#123; # è¾“å‡ºåˆ°ES index =&gt; &quot;nginx_access_log_%&#123;+YYYY-MM&#125;&quot; # ç´¢å¼•å,æŒ‰æœˆåˆ†éš” hosts =&gt; [&quot;https://10.250.0.239:9200&quot;] # ESåœ°å€ user =&gt; &quot;elastic&quot; # ESç”¨æˆ·å password =&gt; &quot;123456&quot; # ESå¯†ç  ssl =&gt; true # æ˜¯å¦å¯ç”¨SSLï¼Œå› ä¸ºè¿™é‡Œæ˜¯httpsè®¿é—®ES ssl_certificate_verification =&gt; false # ç¦ç”¨è¯ä¹¦éªŒè¯ &#125;&#125; å¦‚æœéœ€è¦å¼€å¯è¯ä¹¦æ ¡éªŒï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹æ³•è¿›è¡Œé…ç½® è·å– Elasticsearch çš„ SSL è¯ä¹¦ï¼š 12# ä» Elasticsearch çš„é…ç½®æ–‡ä»¶æˆ–è¯ä¹¦æ–‡ä»¶è·¯å¾„ä¸­è·å–è¯ä¹¦ï¼ˆé€šå¸¸æ˜¯ .pem æˆ– .crt æ–‡ä»¶ï¼‰ã€‚/usr/local/elasticsearch/elasticsearch-8.17.3/config/certs/http_ca.crt å¯¼å…¥è¯ä¹¦åˆ° Java ä¿¡ä»»åº“ï¼šæ³¨æ„è¿™é‡Œè¦å¯¼å…¥åˆ°å¯åŠ¨Logstashçš„JAVAè¿›ç¨‹çš„ä¿¡ä»»åº“ 1234567891011121314151617181920212223242526272829303132333435363738394041424344# logstashçš„jdkè·¯å¾„ï¼Œé»˜è®¤åœ¨logstashçš„å®‰è£…ç›®å½•ä¸‹cd /usr/local/logstash/logstash-8.17.3/jdkbin/keytool -importcert -alias es-cert -keystore /usr/local/logstash/logstash-8.17.3/logstash.keystore -file /usr/local/elasticsearch/elasticsearch-8.17.3/config/certs/http_ca.crt# è¾“å‡ºEnter keystore password: # è¾“å…¥å¯†ç  è¿™é‡Œæ˜¯123456Re-enter new password:Owner: CN=Elasticsearch security auto-configuration HTTP CAIssuer: CN=Elasticsearch security auto-configuration HTTP CASerial number: 89d5c501a2efd5d45a6ee5e08daa16bd605d8c28Valid from: Thu Mar 20 08:53:26 UTC 2025 until: Sun Mar 19 08:53:26 UTC 2028Certificate fingerprints: SHA1: DE:73:0C:EC:46:59:69:83:52:7C:C4:CC:6B:65:EC:B6:31:BE:10:22 SHA256: 3F:14:1C:16:DF:C6:E1:65:89:4B:C1:67:20:84:B2:20:DC:DD:22:FF:E0:21:16:D5:1A:C1:80:03:CF:AA:5A:1DSignature algorithm name: SHA256withRSASubject Public Key Algorithm: 4096-bit RSA keyVersion: 3Extensions:#1: ObjectId: 2.5.29.35 Criticality=falseAuthorityKeyIdentifier [KeyIdentifier [0000: 25 EF BA 81 AE 5E 14 1C 7E FF A1 87 12 F8 D0 2E %....^..........0010: 3A D7 54 5F :.T_]]#2: ObjectId: 2.5.29.19 Criticality=trueBasicConstraints:[CA:truePathLen: no limit]#3: ObjectId: 2.5.29.14 Criticality=falseSubjectKeyIdentifier [KeyIdentifier [0000: 25 EF BA 81 AE 5E 14 1C 7E FF A1 87 12 F8 D0 2E %....^..........0010: 3A D7 54 5F :.T_]]Trust this certificate? [no]: yes # yesç¡®è®¤Certificate was added to keystore é…ç½® Logstash ä½¿ç”¨ä¿¡ä»»åº“ 123456789101112output &#123; elasticsearch &#123; index =&gt; &quot;nginx_access_log_%&#123;+YYYY-MM&#125;&quot; # ç´¢å¼•å,æŒ‰æœˆåˆ†éš” hosts =&gt; [&quot;https://10.250.0.239:9200&quot;] # ESåœ°å€ user =&gt; &quot;elastic&quot; # ESç”¨æˆ·å password =&gt; &quot;123456&quot; # ESå¯†ç  ssl =&gt; true # æ˜¯å¦å¯ç”¨SSLï¼Œå› ä¸ºè¿™é‡Œæ˜¯httpsè®¿é—®ES ssl_certificate_verification =&gt; true # å¯ç”¨è¯ä¹¦æ ¡éªŒ ssl_truststore_path =&gt; &quot;/usr/local/logstash/logstash-8.17.3/logstash.keystore&quot; # æŒ‡å®šä¿¡ä»»åº“è·¯å¾„ ssl_truststore_password =&gt; &quot;123456&quot; # ä¿¡ä»»åº“å¯†ç  &#125;&#125; æ•´åˆæ¶ˆæ¯é˜Ÿåˆ—+Nginxçš„ELKæ¶æ„ æ¶ˆæ¯é˜Ÿåˆ—ï¼šå¼•å…¥æ¶ˆæ¯é˜Ÿåˆ—ä½œä¸ºç¼“å†²æœºåˆ¶ï¼Œç¡®ä¿å³ä½¿åœ¨Logstashæˆ–Elasticsearchå‡ºç°æ•…éšœæ—¶ï¼Œæ—¥å¿—æ•°æ®ä¹Ÿä¸ä¼šä¸¢å¤±ã€‚æ¶ˆæ¯é˜Ÿåˆ—èƒ½å¤Ÿå‡è¡¡ç½‘ç»œä¼ è¾“ï¼Œé™ä½æ•°æ®ä¸¢å¤±çš„å¯èƒ½æ€§ã€‚ Nginxï¼šNginxä½œä¸ºé«˜æ€§èƒ½çš„Webå’Œåå‘ä»£ç†æœåŠ¡å™¨ï¼Œå¯ä»¥è¿›ä¸€æ­¥ä¼˜åŒ–æ•´ä¸ªç³»ç»Ÿçš„æ€§èƒ½å’Œå¯ç”¨æ€§ã€‚å®ƒå¯ä»¥åœ¨è´Ÿè½½å‡è¡¡ã€ç¼“å­˜ç­‰æ–¹é¢å‘æŒ¥ä½œç”¨ï¼Œæå‡ç”¨æˆ·è®¿é—®ä½“éªŒã€‚ æ‰©å±•æ€§ï¼šç”±äºå¼•å…¥äº†æ¶ˆæ¯é˜Ÿåˆ—å’ŒNginxç­‰ç»„ä»¶ï¼Œæ•´ä¸ªæ¶æ„çš„æ‰©å±•æ€§å¾—åˆ°å¢å¼ºã€‚å¯ä»¥æ ¹æ®å®é™…éœ€æ±‚åŠ¨æ€è°ƒæ•´å„ç»„ä»¶çš„èµ„æºåˆ†é…å’Œéƒ¨ç½²è§„æ¨¡ã€‚ é€‚ç”¨åœºæ™¯ï¼šæ•´åˆæ¶ˆæ¯é˜Ÿåˆ—+Nginxçš„æ¶æ„ä¸»è¦é€‚ç”¨äºç”Ÿäº§ç¯å¢ƒï¼Œç‰¹åˆ«æ˜¯éœ€è¦å¤„ç†å¤§æ•°æ®é‡çš„åœºæ™¯ã€‚å®ƒèƒ½å¤Ÿç¡®ä¿æ•°æ®çš„å®‰å…¨æ€§å’Œå®Œæ•´æ€§ï¼ŒåŒæ—¶æä¾›é«˜æ€§èƒ½çš„æ—¥å¿—å¤„ç†å’Œå¯è§†åŒ–åˆ†ææœåŠ¡ã€‚ æ€»ç»“æ¥è¯´å°±æ˜¯ filebeatå°†é‡‡é›†çš„æ—¥å¿—å‘é€åˆ°Redis\\RabbitMQ\\Kafkaç­‰ Logstashå†ä»Redis\\RabbitMQ\\Kafkaä¸­è¯»å–æ—¥å¿—æ•°æ®ï¼Œå¹¶è¿›è¡Œè§£æåå‘é€åˆ°ESä¸­ã€‚ ESé›†ç¾¤ä½¿ç”¨nginxè¿›è¡Œè´Ÿè½½å‡è¡¡ï¼Œä»¥å®ç°é«˜å¯ç”¨å’Œé«˜æ€§èƒ½ã€‚å…·ä½“å®ç°æ–¹æ³•æŸ¥çœ‹ï¼šlinuxä¸‹å®‰è£…Elasticsearché›†ç¾¤ åŸºäºRedisçš„ELKæ¶æ„ç¤ºä¾‹ filebeatå°†é‡‡é›†çš„æ—¥å¿—å‘é€åˆ°Redis åˆ›å»ºé…ç½®æ–‡ä»¶filebeat-nginx-to-redis.ymlï¼Œå°†å…¶ä¿å­˜åˆ°Filebeatå®‰è£…ç›®å½•ä¸‹çš„confç›®å½•ä¸‹ã€‚ 1234567891011121314151617181920212223242526# å› ä¸ºNginxçš„access.logæ—¥å¿—éƒ½æ˜¯ä»¥IPåœ°å€å¼€å¤´çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¿®æ”¹ä¸‹åŒ¹é…å­—æ®µã€‚# ä¸ä»¥ipåœ°å€å¼€å¤´çš„è¡Œè¿½åŠ åˆ°ä¸Šä¸€è¡Œfilebeat.inputs: # è¾“å…¥æºé…ç½®- type: log # æ—¥å¿—ç±»å‹ enabled: true # æ˜¯å¦å¯ç”¨ paths: # é‡‡é›†è·¯å¾„ - /var/log/nginx/access*.* exclude_files: [&quot;.gz$&quot;] # æ’é™¤ä»¥.gz ç»“å°¾çš„æ–‡ä»¶ multiline.pattern: &#x27;^\\\\d&#123;1,3&#125;\\\\.\\\\d&#123;1,3&#125;\\\\.\\\\d&#123;1,3&#125;\\\\.\\\\d&#123;1,3&#125;\\\\s&#x27; # åŒ¹é…ä»¥IPåœ°å€å¼€å¤´ï¼Œå¹¶ç´§è·Ÿä¸€ä¸ªç©ºç™½å­—ç¬¦ multiline.negate: true # ä¸ä»¥ipåœ°å€å¼€å¤´çš„è¡Œè¿½åŠ åˆ°ä¸Šä¸€è¡Œ multiline.match: after # è¿½åŠ åˆ°ä¸Šä¸€è¡Œçš„åé¢ # multiline: å¤šè¡Œæ—¥å¿—é…ç½®ï¼Œè¿™é‡Œå®é™…ä¸Šä¸éœ€è¦é…ç½®å¤šè¡Œè®¾ç½®ï¼Œå› ä¸ºnginxçš„accessæ—¥å¿—éƒ½æ˜¯å•è¡Œæ—¥å¿—ï¼Œè¿™é‡Œåªåšæ¼”ç¤º # pattern: æ­£åˆ™è¡¨è¾¾å¼ # negate: falseï¼ŒåŒ¹é…patternçš„è¡Œåˆå¹¶åˆ°ä¸Šä¸€è¡Œï¼›trueï¼Œä¸åŒ¹é…patternçš„è¡Œåˆå¹¶åˆ°ä¸Šä¸€è¡Œ # match: afterï¼Œåˆå¹¶åˆ°ä¸Šä¸€è¡Œçš„æœ«å°¾ï¼›beforeï¼Œåˆå¹¶åˆ°ä¸Šä¸€è¡Œçš„å¼€å¤´ scan_frequency: 10s # æ¯ 10 ç§’æ‰«æä¸€æ¬¡æ—¥å¿—æ–‡ä»¶ clean_removed: true # åœ¨æ—¥å¿—æ–‡ä»¶è¢«åˆ é™¤åæ˜¯å¦ä»å…¶å†…éƒ¨çŠ¶æ€ä¸­ç§»é™¤è¯¥æ–‡ä»¶çš„è®°å½• clean_inactive: 2h # åœ¨æ—¥å¿—æ–‡ä»¶å¤„äºéæ´»åŠ¨çŠ¶æ€å¤šé•¿æ—¶é—´åå°†å…¶ä»çŠ¶æ€æ•°æ®åº“ä¸­ç§»,è®¾ç½®ä¸ºæ¯” ignore_older + scan_frequency æ›´å¤§çš„å€¼ ignore_older: 1h # å¿½ç•¥é‚£äº›æ¯”å½“å‰æ—¶é—´æ—©äº 1 å°æ—¶çš„æ—¥å¿—æ–‡ä»¶output.redis: # Redisè¾“å‡ºé…ç½® hosts: [&quot;10.250.0.214:6379&quot;] # RedisæœåŠ¡å™¨åœ°å€ password: &quot;123456&quot; # Rediså¯†ç  key: &quot;filebeat_nginx&quot; # Redisçš„keyï¼Œç±»å‹ä¸º list db: 3 # Redisæ•°æ®åº“ timeout: 3 # Redisè¿æ¥è¶…æ—¶æ—¶é—´ï¼Œå•ä½ç§’ å¯åŠ¨Filebeatï¼Œå¹¶æŸ¥çœ‹æ—¥å¿—è¾“å‡ºã€‚ 1./filebeat -e -c conf/filebeat-nginx-to-redis.yml æŸ¥çœ‹Redisä¸­çš„æ•°æ® 1234567891011$ redis-cli -h 10.250.0.214 -p 6379 -a 12345610.250.0.214:6379&gt; select 3OK10.250.0.214:6379[3]&gt; keys filebeat*1) &quot;filebeat_nginx&quot;10.250.0.214:6379[3]&gt; type filebeat_nginxlist10.250.0.214:6379[3]&gt; LLEN filebeat_nginx(integer) 1410.250.0.214:6379[3]&gt; LINDEX filebeat_nginx 1&quot;&#123;\\&quot;@timestamp\\&quot;:\\&quot;2025-03-28T09:15:23.402Z\\&quot;,\\&quot;@metadata\\&quot;:&#123;\\&quot;beat\\&quot;:\\&quot;filebeat\\&quot;,\\&quot;type\\&quot;:\\&quot;_doc\\&quot;,\\&quot;version\\&quot;:\\&quot;8.17.3\\&quot;&#125;,\\&quot;host\\&quot;:&#123;\\&quot;name\\&quot;:\\&quot;ip-10-250-0-239.cn-northwest-1.compute.internal\\&quot;&#125;,\\&quot;agent\\&quot;:&#123;\\&quot;version\\&quot;:\\&quot;8.17.3\\&quot;,\\&quot;ephemeral_id\\&quot;:\\&quot;c0a521fe-690b-46b1-aadc-bbe16ef1db9a\\&quot;,\\&quot;id\\&quot;:\\&quot;4dbe185b-900d-4990-b841-c13bf9618fc6\\&quot;,\\&quot;name\\&quot;:\\&quot;ip-10-250-0-239.cn-northwest-1.compute.internal\\&quot;,\\&quot;type\\&quot;:\\&quot;filebeat\\&quot;&#125;,\\&quot;log\\&quot;:&#123;\\&quot;offset\\&quot;:46745,\\&quot;file\\&quot;:&#123;\\&quot;path\\&quot;:\\&quot;/var/log/nginx/access.log\\&quot;&#125;&#125;,\\&quot;message\\&quot;:\\&quot;1.119.161.30 - elastic [28/Mar/2025:09:15:13 +0000] \\\\\\&quot;GET /_cluster/stats HTTP/1.1\\\\\\&quot; 200 7457 \\\\\\&quot;-\\\\\\&quot; \\\\\\&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/134.0.0.0 Safari/537.36\\\\\\&quot; \\\\\\&quot;-\\\\\\&quot;\\&quot;,\\&quot;input\\&quot;:&#123;\\&quot;type\\&quot;:\\&quot;log\\&quot;&#125;,\\&quot;ecs\\&quot;:&#123;\\&quot;version\\&quot;:\\&quot;8.0.0\\&quot;&#125;&#125;&quot; Logstashä»Redisä¸­è¯»å–æ—¥å¿—å¹¶å†™å…¥Elasticsearch åˆ›å»ºé…ç½®æ–‡ä»¶logstash-nginx-redis-to-es.confï¼Œå°†å…¶ä¿å­˜åˆ°Logstashå®‰è£…ç›®å½•ä¸‹çš„confç›®å½•ä¸‹ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546# è¿›å…¥logstashå®‰è£…ç›®å½•# vim logstash-nginx-redis-to-es.conf# é…ç½®ä» redis æ¥æ”¶æ•°æ®input &#123; # è¾“å…¥æºé…ç½® redis &#123; # Redisè¾“å…¥é…ç½® host =&gt; &#x27;10.250.0.214&#x27; # RedisæœåŠ¡å™¨åœ°å€ port =&gt; &quot;6379&quot; # RedisæœåŠ¡å™¨ç«¯å£ password =&gt; &quot;123456&quot; # Rediså¯†ç  db =&gt; &quot;3&quot; # Redisæ•°æ®åº“ data_type =&gt; &#x27;list&#x27; # æ•°æ®ç±»å‹ä¸ºlist key =&gt; &quot;filebeat_nginx&quot; # Redisçš„key &#125;&#125;filter &#123; # è¿‡æ»¤å™¨é…ç½® grok &#123; match =&gt; &#123; &quot;message&quot; =&gt; &quot;%&#123;IP:client_ip&#125; - %&#123;USER:remote_user&#125; \\[%&#123;HTTPDATE:timestamp&#125;\\] \\&quot;%&#123;WORD:verb&#125; %&#123;URIPATHPARAM:request&#125; HTTP/%&#123;NUMBER:httpversion&#125;\\&quot; %&#123;INT:http_status&#125; %&#123;INT:body_bytes_sent&#125; \\&quot;%&#123;NOTSPACE:referrer&#125;\\&quot; \\&quot;%&#123;GREEDYDATA:agent&#125;\\&quot; %&#123;QUOTEDSTRING:x_forwarded_for&#125;&quot; &#125; &#125; mutate &#123; enable_metric =&gt; &quot;false&quot; # ç¦ç”¨æŒ‡æ ‡ä¸ŠæŠ¥ remove_field =&gt; [&quot;message&quot;, &quot;log&quot;, &quot;tags&quot;, &quot;input&quot;, &quot;agent&quot;, &quot;host&quot;, &quot;ecs&quot;, &quot;@version&quot;] # ç§»é™¤ä¸éœ€è¦çš„å­—æ®µ &#125; date &#123; match =&gt; [&quot;timestamp&quot;,&quot;dd/MMM/yyyy:HH:mm:ss Z&quot;,&quot;yyyy-MM-dd HH:mm:ss&quot;] # æ—¶é—´æ ¼å¼è½¬æ¢ target =&gt; &quot;timestamp&quot; # ç›®æ ‡å­—æ®µ &#125;&#125;# åœ¨è¾“å‡ºé…ç½®ä¸­æ·»åŠ ESè¾“å‡ºé…ç½®output &#123; # è¾“å‡ºé…ç½® stdout &#123; # æ‰“å°åˆ°æ§åˆ¶å° codec =&gt; rubydebug # æŒ‡å®šç¼–ç å™¨ &#125; elasticsearch &#123; # è¾“å‡ºåˆ°ES index =&gt; &quot;redis_nginx_access_log_%&#123;+YYYY-MM&#125;&quot; # ç´¢å¼•å,æŒ‰æœˆåˆ†éš” hosts =&gt; [&quot;https://10.250.0.239:9200&quot;] # ESåœ°å€ user =&gt; &quot;elastic&quot; # ESç”¨æˆ·å password =&gt; &quot;123456&quot; # ESå¯†ç  ssl =&gt; true # æ˜¯å¦å¯ç”¨SSLï¼Œå› ä¸ºè¿™é‡Œæ˜¯httpsè®¿é—®ES ssl_certificate_verification =&gt; false # ç¦ç”¨è¯ä¹¦éªŒè¯ &#125;&#125; æµ‹è¯•logstashé…ç½®æ˜¯å¦æ­£ç¡® 1bin/logstash -f config/logstash-nginx-redis-to-es.conf --config.test_and_exit å¯åŠ¨logstash 12# reload.automaticï¼šä¿®æ”¹é…ç½®æ–‡ä»¶æ—¶è‡ªåŠ¨é‡æ–°åŠ è½½bin/logstash -f config/logstash-nginx-redis-to-es.conf --config.reload.automatic","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç»å¦‚ä½•åœ¨linuxä¸‹å®‰è£…LogStashå’ŒFileBeat é€šè¿‡ç¤ºä¾‹è®²è§£ELKçš„ç»å…¸æ¶æ„å’Œé«˜å¹¶å‘æ¶æ„çš„å®ç°è¿‡ç¨‹ LogStashç‰ˆæœ¬8.17.3ï¼ŒFileBeatç‰ˆæœ¬8.17.3 Elasticsearchç‰ˆæœ¬8.17.3ï¼Œlinuxä¸‹å®‰è£…Elasticsearch Kibanaç‰ˆæœ¬8.17.3ï¼Œlinuxä¸‹å®‰è£…Kibana Elasticsearché›†ç¾¤æ­å»ºï¼Œlinuxä¸‹å®‰è£…Elasticsearché›†ç¾¤","date_published":"2025-03-27T13:30:05.000Z","tags":["æŠ€æœ¯","elastic","kibana","logstash","elasticsearch","kibana","logstash"]},{"id":"https://blog.hanqunfeng.com/2025/03/25/elasticsearch-03-plugins/","url":"https://blog.hanqunfeng.com/2025/03/25/elasticsearch-03-plugins/","title":"linuxä¸‹Elasticsearchæ’ä»¶å®‰è£…","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç»å¦‚ä½•åœ¨linuxä¸ºElasticsearchå®‰è£…æ’ä»¶</p>\n</li>\n<li class=\"lvl-2\">\n<p>Elasticsearchç‰ˆæœ¬8.17.3</p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"å®‰è£…Elasticsearchæ ¸å¿ƒåº“æ’ä»¶\">å®‰è£…Elasticsearchæ ¸å¿ƒåº“æ’ä»¶</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä»¥å®‰è£… <code>analysis-icu</code> è¿™ä¸ªåˆ†è¯æ’ä»¶ä¸ºä¾‹</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># è¿›å…¥Elasticsearchå®‰è£…ç›®å½•ï¼Œæ’ä»¶çš„å®‰è£…è·¯å¾„åœ¨ plugins ç›®å½•ä¸‹</span></span><br><span class=\"line\"><span class=\"comment\"># å®‰è£…æ’ä»¶</span></span><br><span class=\"line\">bin/elasticsearch-plugin install analysis-icu</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å®‰è£…æˆ–å¸è½½æ’ä»¶åï¼Œéœ€è¦é‡å¯ElasticsearchæœåŠ¡</p>\n</li>\n</ul>\n<h2 id=\"å®‰è£…å…¶å®ƒæ¥æºçš„æ’ä»¶\">å®‰è£…å…¶å®ƒæ¥æºçš„æ’ä»¶</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä»¥å®‰è£… <code>analysis-ik</code> è¿™ä¸ªä¸­æ–‡åˆ†è¯æ’ä»¶ä¸ºä¾‹</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä»<a href=\"https://release.infinilabs.com/analysis-ik/stable/\">https://release.infinilabs.com/analysis-ik/stable/</a>æ‰¾åˆ°å¯¹åº”ç‰ˆæœ¬çš„æ’ä»¶è¿æ¥ï¼Œè¿™é‡Œä»¥<code>8.17.3</code>ä¸ºä¾‹</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 1.åŸºäºurlå®‰è£…æ’ä»¶</span></span><br><span class=\"line\">bin/elasticsearch-plugin install https://release.infinilabs.com/analysis-ik/stable/elasticsearch-analysis-ik-8.17.3.zip</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 2.åŸºäºæœ¬åœ°æ–‡ä»¶å®‰è£…æ’ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆå°†æ’ä»¶ä¸‹è½½çš„æœ¬åœ°ç›®å½•</span></span><br><span class=\"line\">wget https://release.infinilabs.com/analysis-ik/stable/elasticsearch-analysis-ik-8.17.3.zip -P /tmp/</span><br><span class=\"line\">bin/elasticsearch-plugin install file:///tmp/elasticsearch-analysis-ik-8.17.3.zip</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 3.å¯ä»¥å°†ä¸‹è½½å¥½çš„åŒ…è§£å‹åˆ°pluginsç›®å½•ä¸‹ï¼Œç„¶åé‡å¯ElasticsearchæœåŠ¡</span></span><br><span class=\"line\"><span class=\"built_in\">mkdir</span> /usr/local/elasticsearch/elasticsearch-8.17.3/plugins/analysis-ik</span><br><span class=\"line\">unzip elasticsearch-analysis-ik-8.17.3.zip -d /usr/local/elasticsearch/elasticsearch-8.17.3/plugins/analysis-ik</span><br></pre></td></tr></table></figure>\n<h2 id=\"æŸ¥çœ‹å’Œå¸è½½æ’ä»¶\">æŸ¥çœ‹å’Œå¸è½½æ’ä»¶</h2>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åˆ—å‡ºæ‰€æœ‰æ’ä»¶</span></span><br><span class=\"line\">bin/elasticsearch-plugin list</span><br><span class=\"line\"><span class=\"comment\"># å¸è½½æ’ä»¶</span></span><br><span class=\"line\">bin/elasticsearch-plugin remove analysis-ik</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># é€šè¿‡curlå‘½ä»¤æŸ¥çœ‹æ’ä»¶ä¿¡æ¯</span></span><br><span class=\"line\">curl -u elastic:123456 -k https://localhost:9200/_cat/plugins?v</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å®‰è£…æˆ–å¸è½½æ’ä»¶åï¼Œéœ€è¦é‡å¯ElasticsearchæœåŠ¡</p>\n</li>\n</ul>\n<h2 id=\"analysis-ik-ä¸­æ–‡åˆ†è¯æ’ä»¶çš„ä½¿ç”¨\"><code>analysis-ik</code> ä¸­æ–‡åˆ†è¯æ’ä»¶çš„ä½¿ç”¨</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æµ‹è¯•åˆ†è¯æ•ˆæœ</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#ESçš„é»˜è®¤åˆ†è¯å™¨æ˜¯standardï¼Œä¼šå•å­—æ‹†åˆ†</span></span><br><span class=\"line\">POST _analyze</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;analyzer&quot;</span>: <span class=\"string\">&quot;standard&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;text&quot;</span>: <span class=\"string\">&quot;ä¸­åäººæ°‘å…±å’Œå›½&quot;</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#analysis-ikçš„ik_smartåˆ†è¯å™¨:ä¼šåšæœ€ç²—ç²’åº¦çš„æ‹†</span></span><br><span class=\"line\">POST _analyze</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;analyzer&quot;</span>: <span class=\"string\">&quot;ik_smart&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;text&quot;</span>: <span class=\"string\">&quot;ä¸­åäººæ°‘å…±å’Œå›½&quot;</span></span><br><span class=\"line\"> &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#analysis-ikçš„ik_max_wordåˆ†è¯å™¨:ä¼šå°†æ–‡æœ¬åšæœ€ç»†ç²’åº¦çš„æ‹†åˆ†</span></span><br><span class=\"line\">POST _analyze</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;analyzer&quot;</span>: <span class=\"string\">&quot;ik_max_word&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;text&quot;</span>: <span class=\"string\">&quot;ä¸­åäººæ°‘å…±å’Œå›½&quot;</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>é…ç½®ç´¢å¼•çš„åˆ†è¯å™¨</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åˆ›å»ºç´¢å¼•ï¼Œå¹¶æŒ‡å®šé»˜è®¤åˆ†è¯å™¨ä¸ºik_max_word</span></span><br><span class=\"line\">PUT /test_index</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;settings&quot;</span> : &#123;</span><br><span class=\"line\">        <span class=\"string\">&quot;index&quot;</span> : &#123;</span><br><span class=\"line\">            <span class=\"string\">&quot;analysis.analyzer.default.type&quot;</span>: <span class=\"string\">&quot;ik_max_word&quot;</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹ç´¢å¼•settingä¿¡æ¯</span></span><br><span class=\"line\">GET /test_index/_settings</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>é…ç½®ç´¢å¼•å­—æ®µçš„åˆ†è¯å™¨</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#åˆ›å»ºç´¢å¼•</span></span><br><span class=\"line\">PUT /index</span><br><span class=\"line\"><span class=\"comment\"># æŒ‡å®šcontentå­—æ®µä½¿ç”¨ikåˆ†è¯å™¨</span></span><br><span class=\"line\">POST /index/_mapping</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">&quot;properties&quot;</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;content&quot;</span>: &#123;</span><br><span class=\"line\">      <span class=\"string\">&quot;type&quot;</span>: <span class=\"string\">&quot;text&quot;</span>,</span><br><span class=\"line\">      <span class=\"string\">&quot;analyzer&quot;</span>: <span class=\"string\">&quot;ik_max_word&quot;</span>,</span><br><span class=\"line\">      <span class=\"string\">&quot;search_analyzer&quot;</span>: <span class=\"string\">&quot;ik_smart&quot;</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#ç´¢å¼•æ–‡æ¡£ï¼Œä¹Ÿå°±æ˜¯æ’å…¥æ–‡æ¡£</span></span><br><span class=\"line\">POST /index/_create/1</span><br><span class=\"line\">&#123;<span class=\"string\">&quot;content&quot;</span>:<span class=\"string\">&quot;ç¾å›½ç•™ç»™ä¼Šæ‹‰å…‹çš„æ˜¯ä¸ªçƒ‚æ‘Šå­å—&quot;</span>&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">POST /index/_create/2</span><br><span class=\"line\">&#123;<span class=\"string\">&quot;content&quot;</span>:<span class=\"string\">&quot;å…¬å®‰éƒ¨ï¼šå„åœ°æ ¡è½¦å°†äº«æœ€é«˜è·¯æƒ&quot;</span>&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">POST /index/_create/3</span><br><span class=\"line\">&#123;<span class=\"string\">&quot;content&quot;</span>:<span class=\"string\">&quot;ä¸­éŸ©æ¸”è­¦å†²çªè°ƒæŸ¥ï¼šéŸ©è­¦å¹³å‡æ¯å¤©æ‰£1è‰˜ä¸­å›½æ¸”èˆ¹&quot;</span>&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">POST /index/_create/4</span><br><span class=\"line\">&#123;<span class=\"string\">&quot;content&quot;</span>:<span class=\"string\">&quot;ä¸­å›½é©»æ´›æ‰çŸ¶é¢†äº‹é¦†é­äºšè£”ç”·å­æªå‡» å«ŒçŠ¯å·²è‡ªé¦–&quot;</span>&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#å¸¦é«˜äº®çš„æŸ¥è¯¢</span></span><br><span class=\"line\">POST /index/_search</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">&quot;query&quot;</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;match&quot;</span>: &#123;</span><br><span class=\"line\">      <span class=\"string\">&quot;content&quot;</span>: <span class=\"string\">&quot;ä¸­å›½&quot;</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"string\">&quot;highlight&quot;</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;pre_tags&quot;</span>: [</span><br><span class=\"line\">      <span class=\"string\">&quot;&lt;tag1&gt;&quot;</span>,</span><br><span class=\"line\">      <span class=\"string\">&quot;&lt;tag2&gt;&quot;</span></span><br><span class=\"line\">    ],</span><br><span class=\"line\">    <span class=\"string\">&quot;post_tags&quot;</span>: [</span><br><span class=\"line\">      <span class=\"string\">&quot;&lt;/tag1&gt;&quot;</span>,</span><br><span class=\"line\">      <span class=\"string\">&quot;&lt;/tag2&gt;&quot;</span></span><br><span class=\"line\">    ],</span><br><span class=\"line\">    <span class=\"string\">&quot;fields&quot;</span>: &#123;</span><br><span class=\"line\">      <span class=\"string\">&quot;content&quot;</span>: &#123;&#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç»å¦‚ä½•åœ¨linuxä¸ºElasticsearchå®‰è£…æ’ä»¶ Elasticsearchç‰ˆæœ¬8.17.3 å®‰è£…Elasticsearchæ ¸å¿ƒåº“æ’ä»¶ ä»¥å®‰è£… analysis-icu è¿™ä¸ªåˆ†è¯æ’ä»¶ä¸ºä¾‹ 123# è¿›å…¥Elasticsearchå®‰è£…ç›®å½•ï¼Œæ’ä»¶çš„å®‰è£…è·¯å¾„åœ¨ plugins ç›®å½•ä¸‹# å®‰è£…æ’ä»¶bin/elasticsearch-plugin install analysis-icu å®‰è£…æˆ–å¸è½½æ’ä»¶åï¼Œéœ€è¦é‡å¯ElasticsearchæœåŠ¡ å®‰è£…å…¶å®ƒæ¥æºçš„æ’ä»¶ ä»¥å®‰è£… analysis-ik è¿™ä¸ªä¸­æ–‡åˆ†è¯æ’ä»¶ä¸ºä¾‹ ä»https://release.infinilabs.com/analysis-ik/stable/æ‰¾åˆ°å¯¹åº”ç‰ˆæœ¬çš„æ’ä»¶è¿æ¥ï¼Œè¿™é‡Œä»¥8.17.3ä¸ºä¾‹ 12345678910# 1.åŸºäºurlå®‰è£…æ’ä»¶bin/elasticsearch-plugin install https://release.infinilabs.com/analysis-ik/stable/elasticsearch-analysis-ik-8.17.3.zip# 2.åŸºäºæœ¬åœ°æ–‡ä»¶å®‰è£…æ’ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆå°†æ’ä»¶ä¸‹è½½çš„æœ¬åœ°ç›®å½•wget https://release.infinilabs.com/analysis-ik/stable/elasticsearch-analysis-ik-8.17.3.zip -P /tmp/bin/elasticsearch-plugin install file:///tmp/elasticsearch-analysis-ik-8.17.3.zip# 3.å¯ä»¥å°†ä¸‹è½½å¥½çš„åŒ…è§£å‹åˆ°pluginsç›®å½•ä¸‹ï¼Œç„¶åé‡å¯ElasticsearchæœåŠ¡mkdir /usr/local/elasticsearch/elasticsearch-8.17.3/plugins/analysis-ikunzip elasticsearch-analysis-ik-8.17.3.zip -d /usr/local/elasticsearch/elasticsearch-8.17.3/plugins/analysis-ik æŸ¥çœ‹å’Œå¸è½½æ’ä»¶ 1234567# åˆ—å‡ºæ‰€æœ‰æ’ä»¶bin/elasticsearch-plugin list# å¸è½½æ’ä»¶bin/elasticsearch-plugin remove analysis-ik# é€šè¿‡curlå‘½ä»¤æŸ¥çœ‹æ’ä»¶ä¿¡æ¯curl -u elastic:123456 -k https://localhost:9200/_cat/plugins?v å®‰è£…æˆ–å¸è½½æ’ä»¶åï¼Œéœ€è¦é‡å¯ElasticsearchæœåŠ¡ analysis-ik ä¸­æ–‡åˆ†è¯æ’ä»¶çš„ä½¿ç”¨ æµ‹è¯•åˆ†è¯æ•ˆæœ 1234567891011121314151617181920#ESçš„é»˜è®¤åˆ†è¯å™¨æ˜¯standardï¼Œä¼šå•å­—æ‹†åˆ†POST _analyze&#123; &quot;analyzer&quot;: &quot;standard&quot;, &quot;text&quot;: &quot;ä¸­åäººæ°‘å…±å’Œå›½&quot;&#125;#analysis-ikçš„ik_smartåˆ†è¯å™¨:ä¼šåšæœ€ç²—ç²’åº¦çš„æ‹†POST _analyze&#123; &quot;analyzer&quot;: &quot;ik_smart&quot;, &quot;text&quot;: &quot;ä¸­åäººæ°‘å…±å’Œå›½&quot; &#125;#analysis-ikçš„ik_max_wordåˆ†è¯å™¨:ä¼šå°†æ–‡æœ¬åšæœ€ç»†ç²’åº¦çš„æ‹†åˆ†POST _analyze&#123; &quot;analyzer&quot;: &quot;ik_max_word&quot;, &quot;text&quot;: &quot;ä¸­åäººæ°‘å…±å’Œå›½&quot;&#125; é…ç½®ç´¢å¼•çš„åˆ†è¯å™¨ 1234567891011# åˆ›å»ºç´¢å¼•ï¼Œå¹¶æŒ‡å®šé»˜è®¤åˆ†è¯å™¨ä¸ºik_max_wordPUT /test_index&#123; &quot;settings&quot; : &#123; &quot;index&quot; : &#123; &quot;analysis.analyzer.default.type&quot;: &quot;ik_max_word&quot; &#125; &#125;&#125;# æŸ¥çœ‹ç´¢å¼•settingä¿¡æ¯GET /test_index/_settings é…ç½®ç´¢å¼•å­—æ®µçš„åˆ†è¯å™¨ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849#åˆ›å»ºç´¢å¼•PUT /index# æŒ‡å®šcontentå­—æ®µä½¿ç”¨ikåˆ†è¯å™¨POST /index/_mapping&#123; &quot;properties&quot;: &#123; &quot;content&quot;: &#123; &quot;type&quot;: &quot;text&quot;, &quot;analyzer&quot;: &quot;ik_max_word&quot;, &quot;search_analyzer&quot;: &quot;ik_smart&quot; &#125; &#125;&#125;#ç´¢å¼•æ–‡æ¡£ï¼Œä¹Ÿå°±æ˜¯æ’å…¥æ–‡æ¡£POST /index/_create/1&#123;&quot;content&quot;:&quot;ç¾å›½ç•™ç»™ä¼Šæ‹‰å…‹çš„æ˜¯ä¸ªçƒ‚æ‘Šå­å—&quot;&#125;POST /index/_create/2&#123;&quot;content&quot;:&quot;å…¬å®‰éƒ¨ï¼šå„åœ°æ ¡è½¦å°†äº«æœ€é«˜è·¯æƒ&quot;&#125;POST /index/_create/3&#123;&quot;content&quot;:&quot;ä¸­éŸ©æ¸”è­¦å†²çªè°ƒæŸ¥ï¼šéŸ©è­¦å¹³å‡æ¯å¤©æ‰£1è‰˜ä¸­å›½æ¸”èˆ¹&quot;&#125;POST /index/_create/4&#123;&quot;content&quot;:&quot;ä¸­å›½é©»æ´›æ‰çŸ¶é¢†äº‹é¦†é­äºšè£”ç”·å­æªå‡» å«ŒçŠ¯å·²è‡ªé¦–&quot;&#125;#å¸¦é«˜äº®çš„æŸ¥è¯¢POST /index/_search&#123; &quot;query&quot;: &#123; &quot;match&quot;: &#123; &quot;content&quot;: &quot;ä¸­å›½&quot; &#125; &#125;, &quot;highlight&quot;: &#123; &quot;pre_tags&quot;: [ &quot;&lt;tag1&gt;&quot;, &quot;&lt;tag2&gt;&quot; ], &quot;post_tags&quot;: [ &quot;&lt;/tag1&gt;&quot;, &quot;&lt;/tag2&gt;&quot; ], &quot;fields&quot;: &#123; &quot;content&quot;: &#123;&#125; &#125; &#125;&#125;","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç»å¦‚ä½•åœ¨linuxä¸ºElasticsearchå®‰è£…æ’ä»¶ Elasticsearchç‰ˆæœ¬8.17.3","date_published":"2025-03-25T13:30:05.000Z","tags":["æŠ€æœ¯","elastic","elasticsearch","elasticsearch"]},{"id":"https://blog.hanqunfeng.com/2025/03/24/elasticsearch-02-install-cluster/","url":"https://blog.hanqunfeng.com/2025/03/24/elasticsearch-02-install-cluster/","title":"linuxä¸‹å®‰è£…Elasticsearché›†ç¾¤","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç»å¦‚ä½•åœ¨linuxä¸‹å®‰è£…Elasticsearché›†ç¾¤(ä¸‰èŠ‚ç‚¹)</p>\n</li>\n<li class=\"lvl-2\">\n<p>Elasticsearchç‰ˆæœ¬8.17.3</p>\n</li>\n<li class=\"lvl-2\">\n<p>å•èŠ‚ç‚¹å®‰è£…å‚è€ƒ<a href=\"/2025/03/20/elasticsearch-01-install/\" title=\"linuxä¸‹å®‰è£…Elasticsearch\">linuxä¸‹å®‰è£…Elasticsearch</a>ï¼Œæœ¬æ–‡åœ¨æ­¤åŸºç¡€ä¸Šå®Œæˆé›†ç¾¤å®‰è£…</p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"é›†ç¾¤å®‰è£…\">é›†ç¾¤å®‰è£…</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¸‰ä¸ªèŠ‚ç‚¹åˆ†åˆ«å®‰ç…§å•èŠ‚ç‚¹çš„å®‰è£…æ–¹å¼å®Œæˆä¸‹è½½ï¼Œç”¨æˆ·é…ç½®ï¼Œç¯å¢ƒå˜é‡é…ç½®ï¼Œç³»ç»Ÿå‚æ•°é…ç½®ï¼Œç­‰ç­‰ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä»»é€‰ä¸€ä¸ªèŠ‚ç‚¹ä½œä¸ºé›†ç¾¤çš„masterèŠ‚ç‚¹ï¼Œæˆ‘ä»¬å‘½åä¸º<code>node-1</code>ï¼Œå…¶å®ƒèŠ‚ç‚¹å‘½åä¸º<code>node-2</code>å’Œ<code>node-3</code></p>\n</li>\n<li class=\"lvl-2\">\n<p>å…ˆé…ç½®<code>node-1</code>èŠ‚ç‚¹çš„é…ç½®æ–‡ä»¶</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># é›†ç¾¤åç§°</span></span><br><span class=\"line\">cluster.name: test-elk</span><br><span class=\"line\"><span class=\"comment\"># èŠ‚ç‚¹åç§°</span></span><br><span class=\"line\">node.name: node-1</span><br><span class=\"line\"><span class=\"comment\"># æ•°æ®å­˜å‚¨è·¯å¾„ï¼Œé»˜è®¤å€¼ $ES_HOME/data</span></span><br><span class=\"line\">path.data: /usr/local/elasticsearch/data</span><br><span class=\"line\"><span class=\"comment\"># æ—¥å¿—å­˜å‚¨è·¯å¾„ï¼Œé»˜è®¤å€¼ $ES_HOME/logs</span></span><br><span class=\"line\">path.logs: /usr/local/elasticsearch/logs</span><br><span class=\"line\"><span class=\"comment\"># é…ç½®ESå¯åŠ¨æ—¶æ˜¯å¦è¿›è¡Œå†…å­˜é”å®šæ£€æŸ¥ï¼Œé»˜è®¤å€¼trueï¼Œæœ¬æœºå†…å­˜æ¯”è¾ƒå°æ—¶è®¾ç½®ä¸ºfalse</span></span><br><span class=\"line\">bootstrap.memory_lock: <span class=\"literal\">false</span></span><br><span class=\"line\"><span class=\"comment\"># å…è®¸é€šè¿‡ä»»ä½•åœ°å€è®¿é—®ï¼Œå¼€å¯è¿œç¨‹è®¿é—®</span></span><br><span class=\"line\">network.host: 0.0.0.0</span><br><span class=\"line\"><span class=\"comment\"># é…ç½®å½“å‰ESèŠ‚ç‚¹å¯¹å¤–æä¾›æœåŠ¡çš„httpç«¯å£ï¼Œé»˜è®¤ 9200</span></span><br><span class=\"line\">http.port: 9200</span><br><span class=\"line\"><span class=\"comment\"># é…ç½®å½“å‰ESèŠ‚ç‚¹å¯¹å¤–æä¾›æœåŠ¡çš„tcpç«¯å£ï¼Œé»˜è®¤ 9300</span></span><br><span class=\"line\">transport.port: 9300</span><br><span class=\"line\"><span class=\"comment\"># é›†ç¾¤å†…çš„ä¸»æœºåˆ—è¡¨ï¼Œå¼€å¯å®‰å…¨è®¤è¯æ—¶æ— éœ€é…ç½®ï¼Œæ³¨æ„è¿™é‡Œä¸è¦è¿›è¡Œé…ç½®</span></span><br><span class=\"line\"><span class=\"comment\"># discovery.seed_hosts: [&quot;127.0.0.1&quot;]</span></span><br><span class=\"line\"><span class=\"comment\"># ç¬¬ä¸€æ¬¡å¯åŠ¨æ—¶éœ€è¦å‚ä¸é€‰ä¸»çš„èŠ‚ç‚¹åç§°ï¼Œè¿™é‡Œåªé…ç½®node-1</span></span><br><span class=\"line\">cluster.initial_master_nodes: [<span class=\"string\">&quot;node-1&quot;</span>]</span><br><span class=\"line\"><span class=\"comment\">#è§£å†³è·¨åŸŸé—®é¢˜</span></span><br><span class=\"line\">http.cors.enabled: <span class=\"literal\">true</span></span><br><span class=\"line\">http.cors.allow-origin: <span class=\"string\">&quot;*&quot;</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>é…ç½®<code>node-2</code>èŠ‚ç‚¹çš„é…ç½®æ–‡ä»¶</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># é›†ç¾¤åç§°</span></span><br><span class=\"line\">cluster.name: test-elk</span><br><span class=\"line\"><span class=\"comment\"># èŠ‚ç‚¹åç§°</span></span><br><span class=\"line\">node.name: node-2</span><br><span class=\"line\"><span class=\"comment\"># æ•°æ®å­˜å‚¨è·¯å¾„ï¼Œé»˜è®¤å€¼ $ES_HOME/data</span></span><br><span class=\"line\">path.data: /usr/local/elasticsearch/data</span><br><span class=\"line\"><span class=\"comment\"># æ—¥å¿—å­˜å‚¨è·¯å¾„ï¼Œé»˜è®¤å€¼ $ES_HOME/logs</span></span><br><span class=\"line\">path.logs: /usr/local/elasticsearch/logs</span><br><span class=\"line\"><span class=\"comment\"># é…ç½®ESå¯åŠ¨æ—¶æ˜¯å¦è¿›è¡Œå†…å­˜é”å®šæ£€æŸ¥ï¼Œé»˜è®¤å€¼trueï¼Œæœ¬æœºå†…å­˜æ¯”è¾ƒå°æ—¶è®¾ç½®ä¸ºfalse</span></span><br><span class=\"line\">bootstrap.memory_lock: <span class=\"literal\">false</span></span><br><span class=\"line\"><span class=\"comment\"># å…è®¸é€šè¿‡ä»»ä½•åœ°å€è®¿é—®ï¼Œå¼€å¯è¿œç¨‹è®¿é—®</span></span><br><span class=\"line\">network.host: 0.0.0.0</span><br><span class=\"line\"><span class=\"comment\"># é…ç½®å½“å‰ESèŠ‚ç‚¹å¯¹å¤–æä¾›æœåŠ¡çš„httpç«¯å£ï¼Œé»˜è®¤ 9200</span></span><br><span class=\"line\">http.port: 9200</span><br><span class=\"line\"><span class=\"comment\"># é…ç½®å½“å‰ESèŠ‚ç‚¹å¯¹å¤–æä¾›æœåŠ¡çš„tcpç«¯å£ï¼Œé»˜è®¤ 9300</span></span><br><span class=\"line\">transport.port: 9300</span><br><span class=\"line\"><span class=\"comment\">#è§£å†³è·¨åŸŸé—®é¢˜</span></span><br><span class=\"line\">http.cors.enabled: <span class=\"literal\">true</span></span><br><span class=\"line\">http.cors.allow-origin: <span class=\"string\">&quot;*&quot;</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>é…ç½®<code>node-3</code>èŠ‚ç‚¹çš„é…ç½®æ–‡ä»¶</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># é›†ç¾¤åç§°</span></span><br><span class=\"line\">cluster.name: test-elk</span><br><span class=\"line\"><span class=\"comment\"># èŠ‚ç‚¹åç§°</span></span><br><span class=\"line\">node.name: node-3</span><br><span class=\"line\"><span class=\"comment\"># æ•°æ®å­˜å‚¨è·¯å¾„ï¼Œé»˜è®¤å€¼ $ES_HOME/data</span></span><br><span class=\"line\">path.data: /usr/local/elasticsearch/data</span><br><span class=\"line\"><span class=\"comment\"># æ—¥å¿—å­˜å‚¨è·¯å¾„ï¼Œé»˜è®¤å€¼ $ES_HOME/logs</span></span><br><span class=\"line\">path.logs: /usr/local/elasticsearch/logs</span><br><span class=\"line\"><span class=\"comment\"># é…ç½®ESå¯åŠ¨æ—¶æ˜¯å¦è¿›è¡Œå†…å­˜é”å®šæ£€æŸ¥ï¼Œé»˜è®¤å€¼trueï¼Œæœ¬æœºå†…å­˜æ¯”è¾ƒå°æ—¶è®¾ç½®ä¸ºfalse</span></span><br><span class=\"line\">bootstrap.memory_lock: <span class=\"literal\">false</span></span><br><span class=\"line\"><span class=\"comment\"># å…è®¸é€šè¿‡ä»»ä½•åœ°å€è®¿é—®ï¼Œå¼€å¯è¿œç¨‹è®¿é—®</span></span><br><span class=\"line\">network.host: 0.0.0.0</span><br><span class=\"line\"><span class=\"comment\"># é…ç½®å½“å‰ESèŠ‚ç‚¹å¯¹å¤–æä¾›æœåŠ¡çš„httpç«¯å£ï¼Œé»˜è®¤ 9200</span></span><br><span class=\"line\">http.port: 9200</span><br><span class=\"line\"><span class=\"comment\"># é…ç½®å½“å‰ESèŠ‚ç‚¹å¯¹å¤–æä¾›æœåŠ¡çš„tcpç«¯å£ï¼Œé»˜è®¤ 9300</span></span><br><span class=\"line\">transport.port: 9300</span><br><span class=\"line\"><span class=\"comment\">#è§£å†³è·¨åŸŸé—®é¢˜</span></span><br><span class=\"line\">http.cors.enabled: <span class=\"literal\">true</span></span><br><span class=\"line\">http.cors.allow-origin: <span class=\"string\">&quot;*&quot;</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¯åŠ¨<code>node-1</code>ï¼Œå¯åŠ¨æˆåŠŸåæˆ‘ä»¬ä¼šåœ¨æ—¥å¿—ä¸­çœ‹åˆ°å¦‚ä¸‹å®‰å…¨è®¤è¯ä¿¡æ¯ä¿¡æ¯ï¼Œè®°å½•å…¶ä¸­çš„åŠ å…¥é›†ç¾¤çš„èŠ‚ç‚¹çš„tokenä¿¡æ¯</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span><br><span class=\"line\"><span class=\"comment\"># è¿™äº›æ—¥å¿—ä¿¡æ¯æä¾›äº† Elasticsearch 8 åœ¨é¦–æ¬¡å¯åŠ¨æ—¶è‡ªåŠ¨é…ç½®çš„å®‰å…¨ç‰¹æ€§ã€ç”Ÿæˆçš„é»˜è®¤å¯†ç ã€è¯ä¹¦æŒ‡çº¹ä»¥åŠå¦‚ä½•é…ç½® Kibana å’Œå…¶ä»–èŠ‚ç‚¹åŠ å…¥é›†ç¾¤çš„è¯¦ç»†è¯´æ˜ã€‚</span></span><br><span class=\"line\">âœ… Elasticsearch security features have been automatically configured!</span><br><span class=\"line\">âœ… Authentication is enabled and cluster connections are encrypted.</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># è¿™æ˜¯ elastic ç”¨æˆ·çš„é»˜è®¤å¯†ç ã€‚ç³»ç»Ÿå»ºè®®ä½ ä½¿ç”¨ bin/elasticsearch-reset-password -u elastic å‘½ä»¤æ¥é‡ç½®æ­¤å¯†ç ã€‚</span></span><br><span class=\"line\">â„¹ï¸  Password <span class=\"keyword\">for</span> the elastic user (reset with `bin/elasticsearch-reset-password -u elastic`):</span><br><span class=\"line\">  BNb=*qz6_M*mXL9uZiSP <span class=\"comment\"># è¿™é‡Œä¼šæ‰“å°å‡ºESè‡ªåŠ¨ç”Ÿæˆçš„å¯†ç </span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># è¿™æ˜¯ HTTP CA è¯ä¹¦çš„ SHA-256 æŒ‡çº¹ã€‚CA è¯ä¹¦ç”¨äºéªŒè¯ HTTPS è¿æ¥çš„èº«ä»½ã€‚</span></span><br><span class=\"line\">â„¹ï¸  HTTP CA certificate SHA-256 fingerprint:</span><br><span class=\"line\">  3f141c16dfc6e165894bc1672084b220dcdd22ffe02116d51ac18003cfaa5a1d</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æä¾›äº†å°† Kibana é…ç½®ä¸ºä½¿ç”¨æ­¤ Elasticsearch é›†ç¾¤çš„æ­¥éª¤ã€‚</span></span><br><span class=\"line\">â„¹ï¸  Configure Kibana to use this cluster:</span><br><span class=\"line\"><span class=\"comment\"># å¯åŠ¨ Kibana å¹¶æŒ‰ç…§ç»ˆç«¯ä¸­æ˜¾ç¤ºçš„é…ç½®é“¾æ¥è¿›è¡Œæ“ä½œã€‚</span></span><br><span class=\"line\">â€¢ Run Kibana and click the configuration <span class=\"built_in\">link</span> <span class=\"keyword\">in</span> the terminal when Kibana starts.</span><br><span class=\"line\"><span class=\"comment\"># å¤åˆ¶æä¾›çš„æ³¨å†Œä»¤ç‰Œï¼Œå¹¶åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ Kibana æ—¶ç²˜è´´æ­¤ä»¤ç‰Œã€‚ä»¤ç‰Œåœ¨æ¥ä¸‹æ¥çš„ 30 åˆ†é’Ÿå†…æœ‰æ•ˆã€‚</span></span><br><span class=\"line\"><span class=\"comment\"># è¡¥å……è¯´æ˜ï¼šç”Ÿæˆæ–°çš„kibanaæ³¨å†Œä»¤ç‰Œï¼šbin/elasticsearch-create-enrollment-token -s kibana</span></span><br><span class=\"line\">â€¢ Copy the following enrollment token and <span class=\"built_in\">paste</span> it into Kibana <span class=\"keyword\">in</span> your browser (valid <span class=\"keyword\">for</span> the next 30 minutes):</span><br><span class=\"line\">  eyJ2ZXIiOiI4LjE0LjAiLCJhZHIiOlsiMTAuMjUwLjAuMjM5OjkyMDAiXSwiZmdyIjoiM2YxNDFjMTZkZmM2ZTE2NTg5NGJjMTY3MjA4NGIyMjBkY2RkMjJmZmUwMjExNmQ1MWFjMTgwMDNjZmFhNWExZCIsImtleSI6ImFSWFBzcFVCTVVmc1d5aUJnbjBtOmRzbVBLQV95UXhDZkJpXzQyWDNEMVEifQ==</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æä¾›äº†å°†æ–°çš„ Elasticsearch èŠ‚ç‚¹åŠ å…¥ç°æœ‰é›†ç¾¤çš„æ­¥éª¤ã€‚</span></span><br><span class=\"line\">â„¹ï¸ Configure other nodes to <span class=\"built_in\">join</span> this cluster:</span><br><span class=\"line\"><span class=\"comment\"># ä½¿ç”¨ bin/elasticsearch --enrollment-token &lt;token&gt; å‘½ä»¤å¯åŠ¨æ–°çš„ Elasticsearch èŠ‚ç‚¹ã€‚ä»¤ç‰Œåœ¨æ¥ä¸‹æ¥çš„ 30 åˆ†é’Ÿå†…æœ‰æ•ˆã€‚</span></span><br><span class=\"line\"><span class=\"comment\"># è¡¥å……è¯´æ˜ï¼šç”Ÿæˆæ–°çš„èŠ‚ç‚¹æ³¨å†Œä»¤ç‰Œï¼šbin/elasticsearch-create-enrollment-token -s node</span></span><br><span class=\"line\">â€¢ Copy the following enrollment token and start new Elasticsearch nodes with `bin/elasticsearch --enrollment-token &lt;token&gt;` (valid <span class=\"keyword\">for</span> the next 30 minutes):</span><br><span class=\"line\">  eyJ2ZXIiOiI4LjE0LjAiLCJhZHIiOlsiMTAuMjUwLjAuMjM5OjkyMDAiXSwiZmdyIjoiM2YxNDFjMTZkZmM2ZTE2NTg5NGJjMTY3MjA4NGIyMjBkY2RkMjJmZmUwMjExNmQ1MWFjMTgwMDNjZmFhNWExZCIsImtleSI6ImF4WFBzcFVCTVVmc1d5aUJnbjFtOkFEallPdnpzUzh1MGJqOFpfVFE4a3cifQ==</span><br><span class=\"line\"><span class=\"comment\"># å¦‚æœä½ åœ¨ Docker ä¸­è¿è¡Œ Elasticsearchï¼Œå¯ä»¥ä½¿ç”¨ docker run -e &quot;ENROLLMENT_TOKEN=&lt;token&gt;&quot; docker.elastic.co/elasticsearch/elasticsearch:8.17.3 å‘½ä»¤å¯åŠ¨æ–°èŠ‚ç‚¹ã€‚</span></span><br><span class=\"line\">  If you<span class=\"string\">&#x27;re running in Docker, copy the enrollment token and run:</span></span><br><span class=\"line\"><span class=\"string\">  `docker run -e &quot;ENROLLMENT_TOKEN=&lt;token&gt;&quot; docker.elastic.co/elasticsearch/elasticsearch:8.17.3`</span></span><br><span class=\"line\"><span class=\"string\">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>tokenä¿¡æ¯æœ‰æ•ˆæ—¶é—´åªæœ‰30åˆ†é’Ÿï¼Œè¶…æ—¶åå¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤é‡æ–°ç”Ÿæˆæ–°çš„token</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># è¿›å…¥node-1èŠ‚ç‚¹çš„ESå®‰è£…ç›®å½•ï¼Œæ­¤å‘½ä»¤ä¼šç”Ÿæˆæ–°çš„èŠ‚ç‚¹æ³¨å†Œä»¤ç‰Œ</span></span><br><span class=\"line\">bin/elasticsearch-create-enrollment-token -s node</span><br><span class=\"line\">eyJ2ZXIiOiI4LjE0LjAiLCJhZHIiOlsiMTAuMjUwLjAuMjM5OjkyMDAiXSwiZmdyIjoiM2YxNDFjMTZkZmM2ZTE2NTg5NGJjMTY3MjA4NGIyMjBkY2RkMjJmZmUwMjExNmQ1MWFjMTgwMDNjZmFhNWExZCIsImtleSI6IlpoRVZ4NVVCeXRPajdLeTBqb3BvOmdHRW44ZW5mU0RDZHA2Yy1uSDF4eGcifQ==</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¯åŠ¨<code>node-2</code>èŠ‚ç‚¹ï¼Œå¯åŠ¨æ—¶è¦å¸¦ä¸Štokenä¿¡æ¯ï¼Œ<code>node-3</code>ä¸æ­¤ä¸€æ ·ã€‚è¿™é‡Œè¦æ³¨æ„ï¼Œåªæœ‰ç¬¬ä¸€æ¬¡åŠ å…¥é›†ç¾¤æ—¶å¯åŠ¨æ‰éœ€è¦å¸¦ä¸Šæ³¨å†Œä»¤ç‰Œï¼Œåç»­å¯åŠ¨ä¸éœ€è¦tokenä¿¡æ¯</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># è¿›å…¥node-2èŠ‚ç‚¹çš„ESå®‰è£…ç›®å½•ï¼Œæ­¤å‘½ä»¤ä¼šå¯åŠ¨ESèŠ‚ç‚¹ï¼Œå¹¶åŠ å…¥åˆ°é›†ç¾¤ä¸­</span></span><br><span class=\"line\"><span class=\"comment\"># bin/elasticsearch --enrollment-token &lt;token&gt;</span></span><br><span class=\"line\">bin/elasticsearch --enrollment-token eyJ2ZXIiOiI4LjE0LjAiLCJhZHIiOlsiMTAuMjUwLjAuMjM5OjkyMDAiXSwiZmdyIjoiM2YxNDFjMTZkZmM2ZTE2NTg5NGJjMTY3MjA4NGIyMjBkY2RkMjJmZmUwMjExNmQ1MWFjMTgwMDNjZmFhNWExZCIsImtleSI6IlpoRVZ4NVVCeXRPajdLeTBqb3BvOmdHRW44ZW5mU0RDZHA2Yy1uSDF4eGcifQ==</span><br></pre></td></tr></table></figure>\n<div class=\"tips\">\n<p><em><strong>åŠ å…¥é›†ç¾¤å¤±è´¥</strong></em></p>\n<ul class=\"lvl-1\">\n<li class=\"lvl-2\">åœ¨æ‰§è¡Œ<code>bin/elasticsearch --enrollment-token &lt;token&gt;</code>æ—¶æœ‰å¯èƒ½ä¼šé‡åˆ°å¦‚ä¸‹å¼‚å¸¸ï¼š</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ERROR: Aborting auto configuration because the node keystore contains password settings already, with <span class=\"built_in\">exit</span> code 78</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-1\">\n<li class=\"lvl-2\">è¿™é€šå¸¸æ„å‘³ç€èŠ‚ç‚¹çš„ <code>keystore</code> å·²ç»åŒ…å«äº†å¯†ç è®¾ç½®ï¼Œå› æ­¤è‡ªåŠ¨é…ç½®è¿‡ç¨‹è¢«ä¸­æ­¢ã€‚</li>\n<li class=\"lvl-2\">äº§ç”Ÿè¿™ç§é”™è¯¯çš„åŸå› å¤§æ¦‚ç‡æ˜¯å½“å‰ESæ˜¯ä»å·²ç»å®‰è£…å¥½çš„æœåŠ¡å™¨ä¸Šæ‹·è´è¿‡æ¥çš„ï¼Œè€Œä¸æ˜¯å…¨æ–°å®‰è£…çš„ï¼Œæ­¤æ—¶æˆ‘ä»¬é™¤äº†éœ€è¦æ¸…ç©º<code>data</code>ç›®å½•å¤–ï¼Œè¿˜éœ€è¦åˆ é™¤ <code>keystore</code> ä¸­çš„å¯†ç </li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹keystoreä¸­çš„å¯†ç </span></span><br><span class=\"line\">$ bin/elasticsearch-keystore list</span><br><span class=\"line\">keystore.seed</span><br><span class=\"line\">xpack.security.http.ssl.keystore.secure_password</span><br><span class=\"line\">xpack.security.transport.ssl.keystore.secure_password</span><br><span class=\"line\">xpack.security.transport.ssl.truststore.secure_password</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åˆ é™¤keystoreä¸­çš„å¯†ç </span></span><br><span class=\"line\">$ bin/elasticsearch-keystore remove xpack.security.http.ssl.keystore.secure_password</span><br><span class=\"line\">$ bin/elasticsearch-keystore remove xpack.security.transport.ssl.keystore.secure_password</span><br><span class=\"line\">$ bin/elasticsearch-keystore remove xpack.security.transport.ssl.truststore.secure_password</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-1\">\n<li class=\"lvl-2\">\n<p>å†æ¬¡æ‰§è¡Œ<code>bin/elasticsearch --enrollment-token &lt;token&gt;</code>å³å¯ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å¦å¤–è¿˜å¯èƒ½é‡åˆ°å¦‚ä¸‹æŠ¥é”™ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ERROR: Aborting enrolling to cluster. Could not communicate with the node on any of the addresses from the enrollment token. All of [10.250.0.239:9200] were attempted., with <span class=\"built_in\">exit</span> code 69</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-1\">\n<li class=\"lvl-2\">è¿™æ˜¯ç”±äºtokenè¿‡æœŸäº†ï¼Œé‡æ–°ç”Ÿæˆæ–°çš„tokenå³å¯</li>\n</ul>\n</div>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¯åŠ¨æˆåŠŸåä¼šåœ¨<code>node-2</code>çš„é…ç½®æ–‡ä»¶ä¸­çœ‹åˆ°å¦‚ä¸‹é…ç½®ä¿¡æ¯</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#----------------------- BEGIN SECURITY AUTO CONFIGURATION -----------------------</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\"># The following settings, TLS certificates, and keys have been automatically</span></span><br><span class=\"line\"><span class=\"comment\"># generated to configure Elasticsearch security features on 24-03-2025 07:45:11</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\"># --------------------------------------------------------------------------------</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Enable security features</span></span><br><span class=\"line\">xpack.security.enabled: <span class=\"literal\">true</span></span><br><span class=\"line\"></span><br><span class=\"line\">xpack.security.enrollment.enabled: <span class=\"literal\">true</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Enable encryption for HTTP API client connections, such as Kibana, Logstash, and Agents</span></span><br><span class=\"line\">xpack.security.http.ssl:</span><br><span class=\"line\">  enabled: <span class=\"literal\">true</span></span><br><span class=\"line\">  keystore.path: certs/http.p12</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Enable encryption and mutual authentication between cluster nodes</span></span><br><span class=\"line\">xpack.security.transport.ssl:</span><br><span class=\"line\">  enabled: <span class=\"literal\">true</span></span><br><span class=\"line\">  verification_mode: certificate</span><br><span class=\"line\">  keystore.path: certs/transport.p12</span><br><span class=\"line\">  truststore.path: certs/transport.p12</span><br><span class=\"line\"><span class=\"comment\"># Discover existing nodes in the cluster</span></span><br><span class=\"line\">discovery.seed_hosts: [<span class=\"string\">&quot;10.250.0.239:9300&quot;</span>] <span class=\"comment\"># è¿™é‡Œæ˜¯node-1èŠ‚ç‚¹çš„IPåœ°å€å’Œç«¯å£å·</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">## è€Œnode-3è¿™é‡Œä¼šæ˜¾ç¤ºå¦‚ä¸‹ä¿¡æ¯ï¼Œä¹Ÿå°±æ˜¯è¶Šæ˜¯åæ¥åŠ å…¥è¿›æ¥çš„ï¼Œè¿™é‡Œå°±ä¼šåŠ ä¸Šä¹‹å‰æ‰€æœ‰èŠ‚ç‚¹çš„IPåœ°å€å’Œç«¯å£å·</span></span><br><span class=\"line\">discovery.seed_hosts: [<span class=\"string\">&quot;10.250.0.239:9300&quot;</span>, <span class=\"string\">&quot;10.250.0.17:9300&quot;</span>] <span class=\"comment\"># è¿™é‡Œæ˜¯node-1å’Œnode-2èŠ‚ç‚¹çš„IPåœ°å€å’Œç«¯å£å·</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#----------------------- END SECURITY AUTO CONFIGURATION -------------------------</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"éªŒè¯é›†ç¾¤çŠ¶æ€\">éªŒè¯é›†ç¾¤çŠ¶æ€</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¯åŠ¨å®Œæˆåï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹é›†ç¾¤çŠ¶æ€ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹é›†ç¾¤çŠ¶æ€</span></span><br><span class=\"line\">$ curl -u elastic:123456 --cacert /usr/local/elasticsearch/elasticsearch-8.17.3/config/certs/http_ca.crt  https://127.0.0.1:9200/_cluster/health?pretty</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">&quot;cluster_name&quot;</span> : <span class=\"string\">&quot;test-elk&quot;</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;status&quot;</span> : <span class=\"string\">&quot;green&quot;</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;timed_out&quot;</span> : <span class=\"literal\">false</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;number_of_nodes&quot;</span> : 3,</span><br><span class=\"line\">  <span class=\"string\">&quot;number_of_data_nodes&quot;</span> : 3,</span><br><span class=\"line\">  <span class=\"string\">&quot;active_primary_shards&quot;</span> : 31,</span><br><span class=\"line\">  <span class=\"string\">&quot;active_shards&quot;</span> : 62,</span><br><span class=\"line\">  <span class=\"string\">&quot;relocating_shards&quot;</span> : 0,</span><br><span class=\"line\">  <span class=\"string\">&quot;initializing_shards&quot;</span> : 0,</span><br><span class=\"line\">  <span class=\"string\">&quot;unassigned_shards&quot;</span> : 0,</span><br><span class=\"line\">  <span class=\"string\">&quot;unassigned_primary_shards&quot;</span> : 0,</span><br><span class=\"line\">  <span class=\"string\">&quot;delayed_unassigned_shards&quot;</span> : 0,</span><br><span class=\"line\">  <span class=\"string\">&quot;number_of_pending_tasks&quot;</span> : 0,</span><br><span class=\"line\">  <span class=\"string\">&quot;number_of_in_flight_fetch&quot;</span> : 0,</span><br><span class=\"line\">  <span class=\"string\">&quot;task_max_waiting_in_queue_millis&quot;</span> : 0,</span><br><span class=\"line\">  <span class=\"string\">&quot;active_shards_percent_as_number&quot;</span> : 100.0</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹èŠ‚ç‚¹ä¿¡æ¯ï¼Œå…¶ä¸­ * è¡¨ç¤ºå½“å‰èŠ‚ç‚¹ä¸ºmasterèŠ‚ç‚¹</span></span><br><span class=\"line\">$ curl -u elastic:123456 --cacert /usr/local/elasticsearch/elasticsearch-8.17.3/config/certs/http_ca.crt  https://127.0.0.1:9200/_cat/nodes?v</span><br><span class=\"line\">ip           heap.percent ram.percent cpu load_1m load_5m load_15m node.role   master name</span><br><span class=\"line\">10.250.0.17             8          63  28    1.03    0.38     0.14 cdfhilmrstw -      node-2</span><br><span class=\"line\">10.250.0.173            9          63  22    0.86    0.37     0.19 cdfhilmrstw -      node-3</span><br><span class=\"line\">10.250.0.239            9          78   6    0.38    0.22     0.16 cdfhilmrstw *      node-1</span><br></pre></td></tr></table></figure>\n<h2 id=\"é‡è¦è¯´æ˜\">é‡è¦è¯´æ˜</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>é›†ç¾¤ä¸€æ—¦åˆ›å»ºå®Œæˆï¼Œåˆ™è‡³å°‘éœ€è¦ä¸¤ä¸ªèŠ‚ç‚¹è¿è¡Œæ‰èƒ½ä¿è¯é›†ç¾¤å¯ç”¨æ€§ï¼Œå¦åˆ™é›†ç¾¤å°†æ— æ³•è¿è¡Œã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å¦‚æœ<code>node-1</code>èŠ‚ç‚¹æŒ‚äº†ï¼Œé›†ç¾¤ä¸­å‰©ä¸‹çš„ä¸¤ä¸ªèŠ‚ç‚¹ä¼šé‡æ–°é€‰æ‹©ä¸€ä¸ªæ–°çš„<code>master</code>èŠ‚ç‚¹ï¼Œä¸ä¼šå½±å“é›†ç¾¤çš„å¯ç”¨æ€§ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä¸€æ—¦å…³é—­<code>node-1</code>ï¼Œåˆ™é‡æ–°å¯åŠ¨<code>node-1</code>èŠ‚ç‚¹å‰è¦ä¿®æ”¹å…¶é…ç½®æ–‡ä»¶ï¼Œå¦åˆ™æ— æ³•å¯åŠ¨æˆåŠŸã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æ³¨é‡Šæ‰è¯¥é…ç½®</span></span><br><span class=\"line\"><span class=\"comment\"># cluster.initial_master_nodes: [&quot;node-1&quot;]</span></span><br><span class=\"line\"><span class=\"comment\"># åŠ å…¥è¯¥é…ç½®ï¼Œå®é™…ä¸Šæœ€å¥½åœ¨é‡å¯æ¯ä¸ªèŠ‚ç‚¹å‰ï¼Œå°†æ¯ä¸ªèŠ‚ç‚¹éƒ½é…ç½®ä¸ºè¿™æ ·</span></span><br><span class=\"line\">discovery.seed_hosts: [<span class=\"string\">&quot;10.250.0.239:9300&quot;</span>, <span class=\"string\">&quot;10.250.0.17:9300&quot;</span>, <span class=\"string\">&quot;10.250.0.173:9300&quot;</span>]</span><br></pre></td></tr></table></figure>\n<h2 id=\"Kibanaå…³è”ESé›†ç¾¤\">Kibanaå…³è”ESé›†ç¾¤</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Kibana å…³è”å•èŠ‚ç‚¹ESå‚è€ƒ <a href=\"/2025/03/21/kibana-01-install/\" title=\"linuxä¸‹å®‰è£…Kibana\">linuxä¸‹å®‰è£…Kibana</a>ï¼Œåœ¨æ­¤åŸºç¡€ä¸Šå¯¹é…ç½®æ–‡ä»¶è¿›è¡Œå¦‚ä¸‹ä¿®æ”¹ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å…³è”é›†ç¾¤çš„èŠ‚ç‚¹åœ°å€ï¼Œå°†é›†ç¾¤å†…æ‰€æœ‰èŠ‚ç‚¹çš„åœ°å€éƒ½é…ç½®åˆ°è¯¥å­—æ®µä¸­</span></span><br><span class=\"line\">elasticsearch.hosts: [<span class=\"string\">&#x27;https://10.250.0.239:9200&#x27;</span>, <span class=\"string\">&#x27;https://10.250.0.173:9200&#x27;</span>, <span class=\"string\">&#x27;https://10.250.0.17:9200&#x27;</span>]</span><br><span class=\"line\"><span class=\"comment\"># å…³è”é›†ç¾¤çš„è¾“å‡ºåœ°å€ï¼Œå°†é›†ç¾¤å†…æ‰€æœ‰èŠ‚ç‚¹çš„åœ°å€éƒ½é…ç½®åˆ°è¯¥å­—æ®µä¸­</span></span><br><span class=\"line\">xpack.fleet.outputs: [&#123;<span class=\"built_in\">id</span>: fleet-default-output, name: default, is_default: <span class=\"literal\">true</span>, is_default_monitoring: <span class=\"literal\">true</span>, <span class=\"built_in\">type</span>: elasticsearch, hosts: [<span class=\"string\">&#x27;https://10.250.0.239:9200&#x27;</span>, <span class=\"string\">&#x27;https://10.250.0.173:9200&#x27;</span>, <span class=\"string\">&#x27;https://10.250.0.17:9200&#x27;</span>], ca_trusted_fingerprint: 3f141c16dfc6e165894bc1672084b220dcdd22ffe02116d51ac18003cfaa5a1d&#125;]</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>é‡å¯Kibana</p>\n</li>\n<li class=\"lvl-2\">\n<p>åªè¦ä¿è¯é›†ç¾¤å†…è‡³å°‘æœ‰ä¸¤ä¸ªESèŠ‚ç‚¹å·¥ä½œæ­£å¸¸ï¼Œå³å¯æ­£å¸¸è®¿é—®Kibana</p>\n</li>\n</ul>\n<h2 id=\"nginxåå‘ä»£ç†ESé›†ç¾¤\">nginxåå‘ä»£ç†ESé›†ç¾¤</h2>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim /etc/nginx/conf.d/es.conf <span class=\"comment\"># æ·»åŠ å¦‚ä¸‹å†…å®¹</span></span><br><span class=\"line\">upstream es &#123;</span><br><span class=\"line\">    server 10.250.0.239:9200;</span><br><span class=\"line\">    server 10.250.0.173:9200;</span><br><span class=\"line\">    server 10.250.0.17:9200;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">server &#123;</span><br><span class=\"line\">        listen       8888;</span><br><span class=\"line\">        server_name  localhost es.domain;</span><br><span class=\"line\"></span><br><span class=\"line\">        location / &#123;</span><br><span class=\"line\">            proxy_pass https://es; <span class=\"comment\">#è¿™ä¸ªåç§°å’Œè¦ä¸Šé¢ upstream es å¯¹åº”ï¼Œæ³¨æ„è¿™é‡Œæ˜¯ https åè®®</span></span><br><span class=\"line\">            proxy_redirect     default;</span><br><span class=\"line\">            proxy_http_version 1.1;</span><br><span class=\"line\"></span><br><span class=\"line\">            proxy_set_header   Host              <span class=\"variable\">$host</span>;</span><br><span class=\"line\">            proxy_set_header   X-Real-IP         <span class=\"variable\">$remote_addr</span>;</span><br><span class=\"line\">            proxy_set_header   X-Forwarded-For   <span class=\"variable\">$proxy_add_x_forwarded_for</span>;</span><br><span class=\"line\">            proxy_set_header   X-Forwarded-Proto <span class=\"variable\">$scheme</span>;</span><br><span class=\"line\">            proxy_max_temp_file_size 0;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">#this is the maximum upload size</span></span><br><span class=\"line\">            client_max_body_size       10m;</span><br><span class=\"line\">            client_body_buffer_size    128k;</span><br><span class=\"line\"></span><br><span class=\"line\">            proxy_connect_timeout      90;</span><br><span class=\"line\">            proxy_send_timeout         90;</span><br><span class=\"line\">            proxy_read_timeout         90;</span><br><span class=\"line\">            proxy_buffering            off;</span><br><span class=\"line\">            proxy_request_buffering    off; <span class=\"comment\"># Required for HTTP CLI commands</span></span><br><span class=\"line\">            proxy_set_header Connection <span class=\"string\">&quot;&quot;</span>; <span class=\"comment\"># Clear for keepalive</span></span><br><span class=\"line\"></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># é‡å¯nginx</span></span><br><span class=\"line\">systemctl restart nginx</span><br><span class=\"line\"><span class=\"comment\"># è®¿é—®ESé›†ç¾¤</span></span><br><span class=\"line\">curl -u elastic:123456 http://127.0.0.1:8888/_cluster/health?pretty</span><br></pre></td></tr></table></figure>","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç»å¦‚ä½•åœ¨linuxä¸‹å®‰è£…Elasticsearché›†ç¾¤(ä¸‰èŠ‚ç‚¹) Elasticsearchç‰ˆæœ¬8.17.3 å•èŠ‚ç‚¹å®‰è£…å‚è€ƒlinuxä¸‹å®‰è£…Elasticsearchï¼Œæœ¬æ–‡åœ¨æ­¤åŸºç¡€ä¸Šå®Œæˆé›†ç¾¤å®‰è£… é›†ç¾¤å®‰è£… ä¸‰ä¸ªèŠ‚ç‚¹åˆ†åˆ«å®‰ç…§å•èŠ‚ç‚¹çš„å®‰è£…æ–¹å¼å®Œæˆä¸‹è½½ï¼Œç”¨æˆ·é…ç½®ï¼Œç¯å¢ƒå˜é‡é…ç½®ï¼Œç³»ç»Ÿå‚æ•°é…ç½®ï¼Œç­‰ç­‰ã€‚ ä»»é€‰ä¸€ä¸ªèŠ‚ç‚¹ä½œä¸ºé›†ç¾¤çš„masterèŠ‚ç‚¹ï¼Œæˆ‘ä»¬å‘½åä¸ºnode-1ï¼Œå…¶å®ƒèŠ‚ç‚¹å‘½åä¸ºnode-2å’Œnode-3 å…ˆé…ç½®node-1èŠ‚ç‚¹çš„é…ç½®æ–‡ä»¶ 1234567891011121314151617181920212223# é›†ç¾¤åç§°cluster.name: test-elk# èŠ‚ç‚¹åç§°node.name: node-1# æ•°æ®å­˜å‚¨è·¯å¾„ï¼Œé»˜è®¤å€¼ $ES_HOME/datapath.data: /usr/local/elasticsearch/data# æ—¥å¿—å­˜å‚¨è·¯å¾„ï¼Œé»˜è®¤å€¼ $ES_HOME/logspath.logs: /usr/local/elasticsearch/logs# é…ç½®ESå¯åŠ¨æ—¶æ˜¯å¦è¿›è¡Œå†…å­˜é”å®šæ£€æŸ¥ï¼Œé»˜è®¤å€¼trueï¼Œæœ¬æœºå†…å­˜æ¯”è¾ƒå°æ—¶è®¾ç½®ä¸ºfalsebootstrap.memory_lock: false# å…è®¸é€šè¿‡ä»»ä½•åœ°å€è®¿é—®ï¼Œå¼€å¯è¿œç¨‹è®¿é—®network.host: 0.0.0.0# é…ç½®å½“å‰ESèŠ‚ç‚¹å¯¹å¤–æä¾›æœåŠ¡çš„httpç«¯å£ï¼Œé»˜è®¤ 9200http.port: 9200# é…ç½®å½“å‰ESèŠ‚ç‚¹å¯¹å¤–æä¾›æœåŠ¡çš„tcpç«¯å£ï¼Œé»˜è®¤ 9300transport.port: 9300# é›†ç¾¤å†…çš„ä¸»æœºåˆ—è¡¨ï¼Œå¼€å¯å®‰å…¨è®¤è¯æ—¶æ— éœ€é…ç½®ï¼Œæ³¨æ„è¿™é‡Œä¸è¦è¿›è¡Œé…ç½®# discovery.seed_hosts: [&quot;127.0.0.1&quot;]# ç¬¬ä¸€æ¬¡å¯åŠ¨æ—¶éœ€è¦å‚ä¸é€‰ä¸»çš„èŠ‚ç‚¹åç§°ï¼Œè¿™é‡Œåªé…ç½®node-1cluster.initial_master_nodes: [&quot;node-1&quot;]#è§£å†³è·¨åŸŸé—®é¢˜http.cors.enabled: truehttp.cors.allow-origin: &quot;*&quot; é…ç½®node-2èŠ‚ç‚¹çš„é…ç½®æ–‡ä»¶ 12345678910111213141516171819# é›†ç¾¤åç§°cluster.name: test-elk# èŠ‚ç‚¹åç§°node.name: node-2# æ•°æ®å­˜å‚¨è·¯å¾„ï¼Œé»˜è®¤å€¼ $ES_HOME/datapath.data: /usr/local/elasticsearch/data# æ—¥å¿—å­˜å‚¨è·¯å¾„ï¼Œé»˜è®¤å€¼ $ES_HOME/logspath.logs: /usr/local/elasticsearch/logs# é…ç½®ESå¯åŠ¨æ—¶æ˜¯å¦è¿›è¡Œå†…å­˜é”å®šæ£€æŸ¥ï¼Œé»˜è®¤å€¼trueï¼Œæœ¬æœºå†…å­˜æ¯”è¾ƒå°æ—¶è®¾ç½®ä¸ºfalsebootstrap.memory_lock: false# å…è®¸é€šè¿‡ä»»ä½•åœ°å€è®¿é—®ï¼Œå¼€å¯è¿œç¨‹è®¿é—®network.host: 0.0.0.0# é…ç½®å½“å‰ESèŠ‚ç‚¹å¯¹å¤–æä¾›æœåŠ¡çš„httpç«¯å£ï¼Œé»˜è®¤ 9200http.port: 9200# é…ç½®å½“å‰ESèŠ‚ç‚¹å¯¹å¤–æä¾›æœåŠ¡çš„tcpç«¯å£ï¼Œé»˜è®¤ 9300transport.port: 9300#è§£å†³è·¨åŸŸé—®é¢˜http.cors.enabled: truehttp.cors.allow-origin: &quot;*&quot; é…ç½®node-3èŠ‚ç‚¹çš„é…ç½®æ–‡ä»¶ 12345678910111213141516171819# é›†ç¾¤åç§°cluster.name: test-elk# èŠ‚ç‚¹åç§°node.name: node-3# æ•°æ®å­˜å‚¨è·¯å¾„ï¼Œé»˜è®¤å€¼ $ES_HOME/datapath.data: /usr/local/elasticsearch/data# æ—¥å¿—å­˜å‚¨è·¯å¾„ï¼Œé»˜è®¤å€¼ $ES_HOME/logspath.logs: /usr/local/elasticsearch/logs# é…ç½®ESå¯åŠ¨æ—¶æ˜¯å¦è¿›è¡Œå†…å­˜é”å®šæ£€æŸ¥ï¼Œé»˜è®¤å€¼trueï¼Œæœ¬æœºå†…å­˜æ¯”è¾ƒå°æ—¶è®¾ç½®ä¸ºfalsebootstrap.memory_lock: false# å…è®¸é€šè¿‡ä»»ä½•åœ°å€è®¿é—®ï¼Œå¼€å¯è¿œç¨‹è®¿é—®network.host: 0.0.0.0# é…ç½®å½“å‰ESèŠ‚ç‚¹å¯¹å¤–æä¾›æœåŠ¡çš„httpç«¯å£ï¼Œé»˜è®¤ 9200http.port: 9200# é…ç½®å½“å‰ESèŠ‚ç‚¹å¯¹å¤–æä¾›æœåŠ¡çš„tcpç«¯å£ï¼Œé»˜è®¤ 9300transport.port: 9300#è§£å†³è·¨åŸŸé—®é¢˜http.cors.enabled: truehttp.cors.allow-origin: &quot;*&quot; å¯åŠ¨node-1ï¼Œå¯åŠ¨æˆåŠŸåæˆ‘ä»¬ä¼šåœ¨æ—¥å¿—ä¸­çœ‹åˆ°å¦‚ä¸‹å®‰å…¨è®¤è¯ä¿¡æ¯ä¿¡æ¯ï¼Œè®°å½•å…¶ä¸­çš„åŠ å…¥é›†ç¾¤çš„èŠ‚ç‚¹çš„tokenä¿¡æ¯ 1234567891011121314151617181920212223242526272829303132â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”# è¿™äº›æ—¥å¿—ä¿¡æ¯æä¾›äº† Elasticsearch 8 åœ¨é¦–æ¬¡å¯åŠ¨æ—¶è‡ªåŠ¨é…ç½®çš„å®‰å…¨ç‰¹æ€§ã€ç”Ÿæˆçš„é»˜è®¤å¯†ç ã€è¯ä¹¦æŒ‡çº¹ä»¥åŠå¦‚ä½•é…ç½® Kibana å’Œå…¶ä»–èŠ‚ç‚¹åŠ å…¥é›†ç¾¤çš„è¯¦ç»†è¯´æ˜ã€‚âœ… Elasticsearch security features have been automatically configured!âœ… Authentication is enabled and cluster connections are encrypted.# è¿™æ˜¯ elastic ç”¨æˆ·çš„é»˜è®¤å¯†ç ã€‚ç³»ç»Ÿå»ºè®®ä½ ä½¿ç”¨ bin/elasticsearch-reset-password -u elastic å‘½ä»¤æ¥é‡ç½®æ­¤å¯†ç ã€‚â„¹ï¸ Password for the elastic user (reset with `bin/elasticsearch-reset-password -u elastic`): BNb=*qz6_M*mXL9uZiSP # è¿™é‡Œä¼šæ‰“å°å‡ºESè‡ªåŠ¨ç”Ÿæˆçš„å¯†ç # è¿™æ˜¯ HTTP CA è¯ä¹¦çš„ SHA-256 æŒ‡çº¹ã€‚CA è¯ä¹¦ç”¨äºéªŒè¯ HTTPS è¿æ¥çš„èº«ä»½ã€‚â„¹ï¸ HTTP CA certificate SHA-256 fingerprint: 3f141c16dfc6e165894bc1672084b220dcdd22ffe02116d51ac18003cfaa5a1d# æä¾›äº†å°† Kibana é…ç½®ä¸ºä½¿ç”¨æ­¤ Elasticsearch é›†ç¾¤çš„æ­¥éª¤ã€‚â„¹ï¸ Configure Kibana to use this cluster:# å¯åŠ¨ Kibana å¹¶æŒ‰ç…§ç»ˆç«¯ä¸­æ˜¾ç¤ºçš„é…ç½®é“¾æ¥è¿›è¡Œæ“ä½œã€‚â€¢ Run Kibana and click the configuration link in the terminal when Kibana starts.# å¤åˆ¶æä¾›çš„æ³¨å†Œä»¤ç‰Œï¼Œå¹¶åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ Kibana æ—¶ç²˜è´´æ­¤ä»¤ç‰Œã€‚ä»¤ç‰Œåœ¨æ¥ä¸‹æ¥çš„ 30 åˆ†é’Ÿå†…æœ‰æ•ˆã€‚# è¡¥å……è¯´æ˜ï¼šç”Ÿæˆæ–°çš„kibanaæ³¨å†Œä»¤ç‰Œï¼šbin/elasticsearch-create-enrollment-token -s kibanaâ€¢ Copy the following enrollment token and paste it into Kibana in your browser (valid for the next 30 minutes): eyJ2ZXIiOiI4LjE0LjAiLCJhZHIiOlsiMTAuMjUwLjAuMjM5OjkyMDAiXSwiZmdyIjoiM2YxNDFjMTZkZmM2ZTE2NTg5NGJjMTY3MjA4NGIyMjBkY2RkMjJmZmUwMjExNmQ1MWFjMTgwMDNjZmFhNWExZCIsImtleSI6ImFSWFBzcFVCTVVmc1d5aUJnbjBtOmRzbVBLQV95UXhDZkJpXzQyWDNEMVEifQ==# æä¾›äº†å°†æ–°çš„ Elasticsearch èŠ‚ç‚¹åŠ å…¥ç°æœ‰é›†ç¾¤çš„æ­¥éª¤ã€‚â„¹ï¸ Configure other nodes to join this cluster:# ä½¿ç”¨ bin/elasticsearch --enrollment-token &lt;token&gt; å‘½ä»¤å¯åŠ¨æ–°çš„ Elasticsearch èŠ‚ç‚¹ã€‚ä»¤ç‰Œåœ¨æ¥ä¸‹æ¥çš„ 30 åˆ†é’Ÿå†…æœ‰æ•ˆã€‚# è¡¥å……è¯´æ˜ï¼šç”Ÿæˆæ–°çš„èŠ‚ç‚¹æ³¨å†Œä»¤ç‰Œï¼šbin/elasticsearch-create-enrollment-token -s nodeâ€¢ Copy the following enrollment token and start new Elasticsearch nodes with `bin/elasticsearch --enrollment-token &lt;token&gt;` (valid for the next 30 minutes): eyJ2ZXIiOiI4LjE0LjAiLCJhZHIiOlsiMTAuMjUwLjAuMjM5OjkyMDAiXSwiZmdyIjoiM2YxNDFjMTZkZmM2ZTE2NTg5NGJjMTY3MjA4NGIyMjBkY2RkMjJmZmUwMjExNmQ1MWFjMTgwMDNjZmFhNWExZCIsImtleSI6ImF4WFBzcFVCTVVmc1d5aUJnbjFtOkFEallPdnpzUzh1MGJqOFpfVFE4a3cifQ==# å¦‚æœä½ åœ¨ Docker ä¸­è¿è¡Œ Elasticsearchï¼Œå¯ä»¥ä½¿ç”¨ docker run -e &quot;ENROLLMENT_TOKEN=&lt;token&gt;&quot; docker.elastic.co/elasticsearch/elasticsearch:8.17.3 å‘½ä»¤å¯åŠ¨æ–°èŠ‚ç‚¹ã€‚ If you&#x27;re running in Docker, copy the enrollment token and run: `docker run -e &quot;ENROLLMENT_TOKEN=&lt;token&gt;&quot; docker.elastic.co/elasticsearch/elasticsearch:8.17.3`â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” tokenä¿¡æ¯æœ‰æ•ˆæ—¶é—´åªæœ‰30åˆ†é’Ÿï¼Œè¶…æ—¶åå¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤é‡æ–°ç”Ÿæˆæ–°çš„token 123# è¿›å…¥node-1èŠ‚ç‚¹çš„ESå®‰è£…ç›®å½•ï¼Œæ­¤å‘½ä»¤ä¼šç”Ÿæˆæ–°çš„èŠ‚ç‚¹æ³¨å†Œä»¤ç‰Œbin/elasticsearch-create-enrollment-token -s nodeeyJ2ZXIiOiI4LjE0LjAiLCJhZHIiOlsiMTAuMjUwLjAuMjM5OjkyMDAiXSwiZmdyIjoiM2YxNDFjMTZkZmM2ZTE2NTg5NGJjMTY3MjA4NGIyMjBkY2RkMjJmZmUwMjExNmQ1MWFjMTgwMDNjZmFhNWExZCIsImtleSI6IlpoRVZ4NVVCeXRPajdLeTBqb3BvOmdHRW44ZW5mU0RDZHA2Yy1uSDF4eGcifQ== å¯åŠ¨node-2èŠ‚ç‚¹ï¼Œå¯åŠ¨æ—¶è¦å¸¦ä¸Štokenä¿¡æ¯ï¼Œnode-3ä¸æ­¤ä¸€æ ·ã€‚è¿™é‡Œè¦æ³¨æ„ï¼Œåªæœ‰ç¬¬ä¸€æ¬¡åŠ å…¥é›†ç¾¤æ—¶å¯åŠ¨æ‰éœ€è¦å¸¦ä¸Šæ³¨å†Œä»¤ç‰Œï¼Œåç»­å¯åŠ¨ä¸éœ€è¦tokenä¿¡æ¯ 123# è¿›å…¥node-2èŠ‚ç‚¹çš„ESå®‰è£…ç›®å½•ï¼Œæ­¤å‘½ä»¤ä¼šå¯åŠ¨ESèŠ‚ç‚¹ï¼Œå¹¶åŠ å…¥åˆ°é›†ç¾¤ä¸­# bin/elasticsearch --enrollment-token &lt;token&gt;bin/elasticsearch --enrollment-token eyJ2ZXIiOiI4LjE0LjAiLCJhZHIiOlsiMTAuMjUwLjAuMjM5OjkyMDAiXSwiZmdyIjoiM2YxNDFjMTZkZmM2ZTE2NTg5NGJjMTY3MjA4NGIyMjBkY2RkMjJmZmUwMjExNmQ1MWFjMTgwMDNjZmFhNWExZCIsImtleSI6IlpoRVZ4NVVCeXRPajdLeTBqb3BvOmdHRW44ZW5mU0RDZHA2Yy1uSDF4eGcifQ== åŠ å…¥é›†ç¾¤å¤±è´¥ åœ¨æ‰§è¡Œbin/elasticsearch --enrollment-token &lt;token&gt;æ—¶æœ‰å¯èƒ½ä¼šé‡åˆ°å¦‚ä¸‹å¼‚å¸¸ï¼š 1ERROR: Aborting auto configuration because the node keystore contains password settings already, with exit code 78 è¿™é€šå¸¸æ„å‘³ç€èŠ‚ç‚¹çš„ keystore å·²ç»åŒ…å«äº†å¯†ç è®¾ç½®ï¼Œå› æ­¤è‡ªåŠ¨é…ç½®è¿‡ç¨‹è¢«ä¸­æ­¢ã€‚ äº§ç”Ÿè¿™ç§é”™è¯¯çš„åŸå› å¤§æ¦‚ç‡æ˜¯å½“å‰ESæ˜¯ä»å·²ç»å®‰è£…å¥½çš„æœåŠ¡å™¨ä¸Šæ‹·è´è¿‡æ¥çš„ï¼Œè€Œä¸æ˜¯å…¨æ–°å®‰è£…çš„ï¼Œæ­¤æ—¶æˆ‘ä»¬é™¤äº†éœ€è¦æ¸…ç©ºdataç›®å½•å¤–ï¼Œè¿˜éœ€è¦åˆ é™¤ keystore ä¸­çš„å¯†ç  1234567891011# æŸ¥çœ‹keystoreä¸­çš„å¯†ç $ bin/elasticsearch-keystore listkeystore.seedxpack.security.http.ssl.keystore.secure_passwordxpack.security.transport.ssl.keystore.secure_passwordxpack.security.transport.ssl.truststore.secure_password# åˆ é™¤keystoreä¸­çš„å¯†ç $ bin/elasticsearch-keystore remove xpack.security.http.ssl.keystore.secure_password$ bin/elasticsearch-keystore remove xpack.security.transport.ssl.keystore.secure_password$ bin/elasticsearch-keystore remove xpack.security.transport.ssl.truststore.secure_password å†æ¬¡æ‰§è¡Œbin/elasticsearch --enrollment-token &lt;token&gt;å³å¯ã€‚ å¦å¤–è¿˜å¯èƒ½é‡åˆ°å¦‚ä¸‹æŠ¥é”™ï¼š 1ERROR: Aborting enrolling to cluster. Could not communicate with the node on any of the addresses from the enrollment token. All of [10.250.0.239:9200] were attempted., with exit code 69 è¿™æ˜¯ç”±äºtokenè¿‡æœŸäº†ï¼Œé‡æ–°ç”Ÿæˆæ–°çš„tokenå³å¯ å¯åŠ¨æˆåŠŸåä¼šåœ¨node-2çš„é…ç½®æ–‡ä»¶ä¸­çœ‹åˆ°å¦‚ä¸‹é…ç½®ä¿¡æ¯ 123456789101112131415161718192021222324252627282930#----------------------- BEGIN SECURITY AUTO CONFIGURATION -----------------------## The following settings, TLS certificates, and keys have been automatically# generated to configure Elasticsearch security features on 24-03-2025 07:45:11## --------------------------------------------------------------------------------# Enable security featuresxpack.security.enabled: truexpack.security.enrollment.enabled: true# Enable encryption for HTTP API client connections, such as Kibana, Logstash, and Agentsxpack.security.http.ssl: enabled: true keystore.path: certs/http.p12# Enable encryption and mutual authentication between cluster nodesxpack.security.transport.ssl: enabled: true verification_mode: certificate keystore.path: certs/transport.p12 truststore.path: certs/transport.p12# Discover existing nodes in the clusterdiscovery.seed_hosts: [&quot;10.250.0.239:9300&quot;] # è¿™é‡Œæ˜¯node-1èŠ‚ç‚¹çš„IPåœ°å€å’Œç«¯å£å·## è€Œnode-3è¿™é‡Œä¼šæ˜¾ç¤ºå¦‚ä¸‹ä¿¡æ¯ï¼Œä¹Ÿå°±æ˜¯è¶Šæ˜¯åæ¥åŠ å…¥è¿›æ¥çš„ï¼Œè¿™é‡Œå°±ä¼šåŠ ä¸Šä¹‹å‰æ‰€æœ‰èŠ‚ç‚¹çš„IPåœ°å€å’Œç«¯å£å·discovery.seed_hosts: [&quot;10.250.0.239:9300&quot;, &quot;10.250.0.17:9300&quot;] # è¿™é‡Œæ˜¯node-1å’Œnode-2èŠ‚ç‚¹çš„IPåœ°å€å’Œç«¯å£å·#----------------------- END SECURITY AUTO CONFIGURATION ------------------------- éªŒè¯é›†ç¾¤çŠ¶æ€ å¯åŠ¨å®Œæˆåï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹é›†ç¾¤çŠ¶æ€ï¼š 1234567891011121314151617181920212223242526# æŸ¥çœ‹é›†ç¾¤çŠ¶æ€$ curl -u elastic:123456 --cacert /usr/local/elasticsearch/elasticsearch-8.17.3/config/certs/http_ca.crt https://127.0.0.1:9200/_cluster/health?pretty&#123; &quot;cluster_name&quot; : &quot;test-elk&quot;, &quot;status&quot; : &quot;green&quot;, &quot;timed_out&quot; : false, &quot;number_of_nodes&quot; : 3, &quot;number_of_data_nodes&quot; : 3, &quot;active_primary_shards&quot; : 31, &quot;active_shards&quot; : 62, &quot;relocating_shards&quot; : 0, &quot;initializing_shards&quot; : 0, &quot;unassigned_shards&quot; : 0, &quot;unassigned_primary_shards&quot; : 0, &quot;delayed_unassigned_shards&quot; : 0, &quot;number_of_pending_tasks&quot; : 0, &quot;number_of_in_flight_fetch&quot; : 0, &quot;task_max_waiting_in_queue_millis&quot; : 0, &quot;active_shards_percent_as_number&quot; : 100.0&#125;# æŸ¥çœ‹èŠ‚ç‚¹ä¿¡æ¯ï¼Œå…¶ä¸­ * è¡¨ç¤ºå½“å‰èŠ‚ç‚¹ä¸ºmasterèŠ‚ç‚¹$ curl -u elastic:123456 --cacert /usr/local/elasticsearch/elasticsearch-8.17.3/config/certs/http_ca.crt https://127.0.0.1:9200/_cat/nodes?vip heap.percent ram.percent cpu load_1m load_5m load_15m node.role master name10.250.0.17 8 63 28 1.03 0.38 0.14 cdfhilmrstw - node-210.250.0.173 9 63 22 0.86 0.37 0.19 cdfhilmrstw - node-310.250.0.239 9 78 6 0.38 0.22 0.16 cdfhilmrstw * node-1 é‡è¦è¯´æ˜ é›†ç¾¤ä¸€æ—¦åˆ›å»ºå®Œæˆï¼Œåˆ™è‡³å°‘éœ€è¦ä¸¤ä¸ªèŠ‚ç‚¹è¿è¡Œæ‰èƒ½ä¿è¯é›†ç¾¤å¯ç”¨æ€§ï¼Œå¦åˆ™é›†ç¾¤å°†æ— æ³•è¿è¡Œã€‚ å¦‚æœnode-1èŠ‚ç‚¹æŒ‚äº†ï¼Œé›†ç¾¤ä¸­å‰©ä¸‹çš„ä¸¤ä¸ªèŠ‚ç‚¹ä¼šé‡æ–°é€‰æ‹©ä¸€ä¸ªæ–°çš„masterèŠ‚ç‚¹ï¼Œä¸ä¼šå½±å“é›†ç¾¤çš„å¯ç”¨æ€§ã€‚ ä¸€æ—¦å…³é—­node-1ï¼Œåˆ™é‡æ–°å¯åŠ¨node-1èŠ‚ç‚¹å‰è¦ä¿®æ”¹å…¶é…ç½®æ–‡ä»¶ï¼Œå¦åˆ™æ— æ³•å¯åŠ¨æˆåŠŸã€‚ 1234# æ³¨é‡Šæ‰è¯¥é…ç½®# cluster.initial_master_nodes: [&quot;node-1&quot;]# åŠ å…¥è¯¥é…ç½®ï¼Œå®é™…ä¸Šæœ€å¥½åœ¨é‡å¯æ¯ä¸ªèŠ‚ç‚¹å‰ï¼Œå°†æ¯ä¸ªèŠ‚ç‚¹éƒ½é…ç½®ä¸ºè¿™æ ·discovery.seed_hosts: [&quot;10.250.0.239:9300&quot;, &quot;10.250.0.17:9300&quot;, &quot;10.250.0.173:9300&quot;] Kibanaå…³è”ESé›†ç¾¤ Kibana å…³è”å•èŠ‚ç‚¹ESå‚è€ƒ linuxä¸‹å®‰è£…Kibanaï¼Œåœ¨æ­¤åŸºç¡€ä¸Šå¯¹é…ç½®æ–‡ä»¶è¿›è¡Œå¦‚ä¸‹ä¿®æ”¹ï¼š 1234# å…³è”é›†ç¾¤çš„èŠ‚ç‚¹åœ°å€ï¼Œå°†é›†ç¾¤å†…æ‰€æœ‰èŠ‚ç‚¹çš„åœ°å€éƒ½é…ç½®åˆ°è¯¥å­—æ®µä¸­elasticsearch.hosts: [&#x27;https://10.250.0.239:9200&#x27;, &#x27;https://10.250.0.173:9200&#x27;, &#x27;https://10.250.0.17:9200&#x27;]# å…³è”é›†ç¾¤çš„è¾“å‡ºåœ°å€ï¼Œå°†é›†ç¾¤å†…æ‰€æœ‰èŠ‚ç‚¹çš„åœ°å€éƒ½é…ç½®åˆ°è¯¥å­—æ®µä¸­xpack.fleet.outputs: [&#123;id: fleet-default-output, name: default, is_default: true, is_default_monitoring: true, type: elasticsearch, hosts: [&#x27;https://10.250.0.239:9200&#x27;, &#x27;https://10.250.0.173:9200&#x27;, &#x27;https://10.250.0.17:9200&#x27;], ca_trusted_fingerprint: 3f141c16dfc6e165894bc1672084b220dcdd22ffe02116d51ac18003cfaa5a1d&#125;] é‡å¯Kibana åªè¦ä¿è¯é›†ç¾¤å†…è‡³å°‘æœ‰ä¸¤ä¸ªESèŠ‚ç‚¹å·¥ä½œæ­£å¸¸ï¼Œå³å¯æ­£å¸¸è®¿é—®Kibana nginxåå‘ä»£ç†ESé›†ç¾¤ 123456789101112131415161718192021222324252627282930313233343536373839vim /etc/nginx/conf.d/es.conf # æ·»åŠ å¦‚ä¸‹å†…å®¹upstream es &#123; server 10.250.0.239:9200; server 10.250.0.173:9200; server 10.250.0.17:9200;&#125;server &#123; listen 8888; server_name localhost es.domain; location / &#123; proxy_pass https://es; #è¿™ä¸ªåç§°å’Œè¦ä¸Šé¢ upstream es å¯¹åº”ï¼Œæ³¨æ„è¿™é‡Œæ˜¯ https åè®® proxy_redirect default; proxy_http_version 1.1; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto $scheme; proxy_max_temp_file_size 0; #this is the maximum upload size client_max_body_size 10m; client_body_buffer_size 128k; proxy_connect_timeout 90; proxy_send_timeout 90; proxy_read_timeout 90; proxy_buffering off; proxy_request_buffering off; # Required for HTTP CLI commands proxy_set_header Connection &quot;&quot;; # Clear for keepalive &#125;&#125;# é‡å¯nginxsystemctl restart nginx# è®¿é—®ESé›†ç¾¤curl -u elastic:123456 http://127.0.0.1:8888/_cluster/health?pretty","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç»å¦‚ä½•åœ¨linuxä¸‹å®‰è£…Elasticsearché›†ç¾¤(ä¸‰èŠ‚ç‚¹) Elasticsearchç‰ˆæœ¬8.17.3 å•èŠ‚ç‚¹å®‰è£…å‚è€ƒlinuxä¸‹å®‰è£…Elasticsearchï¼Œæœ¬æ–‡åœ¨æ­¤åŸºç¡€ä¸Šå®Œæˆé›†ç¾¤å®‰è£…","date_published":"2025-03-24T13:30:05.000Z","tags":["æŠ€æœ¯","elastic","elasticsearch","elasticsearch"]},{"id":"https://blog.hanqunfeng.com/2025/03/21/kibana-01-install/","url":"https://blog.hanqunfeng.com/2025/03/21/kibana-01-install/","title":"linuxä¸‹å®‰è£…Kibana","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç»å¦‚ä½•åœ¨linuxä¸‹å®‰è£…Kibana</p>\n</li>\n<li class=\"lvl-2\">\n<p>Kibanaç‰ˆæœ¬8.17.3</p>\n</li>\n<li class=\"lvl-2\">\n<p>Elasticsearchç‰ˆæœ¬8.17.3ï¼Œ<a href=\"/2025/03/20/elasticsearch-01-install/\" title=\"linuxä¸‹å®‰è£…Elasticsearch\">linuxä¸‹å®‰è£…Elasticsearch</a></p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"ä¸‹è½½\">ä¸‹è½½</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¸‹è½½åœ°å€ï¼š<a href=\"https://www.elastic.co/cn/downloads/past-releases#kibana\">https://www.elastic.co/cn/downloads/past-releases#kibana</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>é€‰æ‹©å¯¹åº”çš„ç‰ˆæœ¬ï¼šè¿™é‡Œé€‰æ‹©å½“å‰çš„æœ€æ–°ç‰ˆ<code>Kibana 8.17.3</code>ï¼Œä¹‹åé€‰æ‹©å¯¹åº”çš„æ“ä½œç³»ç»Ÿ<code>LINUX X86_64</code></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget https://artifacts.elastic.co/downloads/kibana/kibana-8.17.3-linux-x86_64.tar.gz</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¸‹è½½å®Œæˆåè§£å‹åˆ°<code>/usr/local/kibana</code>ç›®å½•ä¸‹ï¼Œè§£å‹å‘½ä»¤å¦‚ä¸‹ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">mkdir</span> /usr/local/kibana</span><br><span class=\"line\">tar -zxvf kibana-8.17.3-linux-x86_64.tar.gz -C /usr/local/kibana</span><br></pre></td></tr></table></figure>\n<h2 id=\"åˆ›å»ºå¯åŠ¨ç”¨æˆ·\">åˆ›å»ºå¯åŠ¨ç”¨æˆ·</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>elasticsearchå’Œkibanaéƒ½ä¸èƒ½ç”¨rootç”¨æˆ·å¯åŠ¨</p>\n</li>\n<li class=\"lvl-2\">\n<p>åˆ›å»ºç”¨æˆ·<code>elastic</code>ï¼Œå¹¶è®¾ç½®å¯†ç ï¼Œè¿™ä¸€æ­¥æˆ‘ä»¬åœ¨å®‰è£…elasticsearchçš„æ—¶å€™å·²ç»é…ç½®è¿‡äº†ï¼Œè¿™é‡Œå°±ä¸å†èµ˜è¿°äº†</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">useradd elastic</span><br><span class=\"line\">passwd elastic</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¿®æ”¹kibanaå®‰è£…ç›®å½•çš„ç”¨æˆ·æƒé™</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">chown</span> -R elastic:elastic /usr/local/kibana</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ‡æ¢åˆ°elasticç”¨æˆ·ä¸‹æ‰§è¡Œå‘½ä»¤</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">su - elastic</span><br></pre></td></tr></table></figure>\n<h2 id=\"å…³è”Kibanaå’ŒElasticsearch\">å…³è”Kibanaå’ŒElasticsearch</h2>\n<h3 id=\"æ–¹æ³•1ï¼šæ³¨å†Œä»¤ç‰ŒTokenå…³è”-å®˜æ–¹æ¨è\">æ–¹æ³•1ï¼šæ³¨å†Œä»¤ç‰ŒTokenå…³è”[å®˜æ–¹æ¨è]</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ³¨æ„æ­¤æ–¹æ³•è¦æ±‚<code>elasticsearch</code>å¿…é¡»å¼€å¯å®‰å…¨è®¤è¯ï¼Œè€Œä¸”<code>xpack.security.http.ssl.enabled</code> å¿…é¡»è®¾ç½®ä¸º true</p>\n</li>\n<li class=\"lvl-2\">\n<p>é…ç½®å¯åŠ¨æ–‡ä»¶ï¼Œè¿›å…¥<code>/usr/local/kibana/kibana-8.17.3/config</code>ç›®å½•ï¼Œæ ¹æ®éœ€è¦ä¿®æ”¹<code>kibana.yml</code>æ–‡ä»¶</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ç«¯å£ï¼Œé»˜è®¤5601</span></span><br><span class=\"line\">server.port: 5601</span><br><span class=\"line\"><span class=\"comment\"># kibanaæœåŠ¡å™¨çš„ipï¼Œ4ä¸ª0è¡¨ç¤ºä»»ä½•ä¸€ä¸ªç½‘å¡éƒ½å¯ä»¥è®¿é—®ï¼Œé»˜è®¤ä¸ºlocalhost</span></span><br><span class=\"line\">server.host: <span class=\"string\">&quot;0.0.0.0&quot;</span></span><br><span class=\"line\"><span class=\"comment\"># ä¸­æ–‡ï¼Œé»˜è®¤ä¸º en</span></span><br><span class=\"line\">i18n.locale: <span class=\"string\">&quot;zh-CN&quot;</span></span><br><span class=\"line\"><span class=\"comment\"># é…ç½®httpsï¼Œé»˜è®¤å€¼ä¸º certificate</span></span><br><span class=\"line\">elasticsearch.ssl.verificationMode: <span class=\"string\">&#x27;certificate&#x27;</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¿˜è®°å¾—æˆ‘ä»¬ç¬¬ä¸€æ¬¡å¯åŠ¨ESæ—¶æ—¥å¿—ä¿¡æ¯ä¸­çš„æœ‰å…³kibanaæ³¨å†Œä»¤ç‰Œçš„ä¿¡æ¯å—ï¼Ÿé‚£ä¸ªä»¤ç‰Œåªæœ‰30åˆ†é’Ÿæœ‰æ•ˆæœŸï¼Œè¿‡æœŸåå¯ä»¥è¿›å…¥elasticsearchå®‰è£…ç›®å½•ï¼Œé‡æ–°åˆ›å»ºkibanaæ³¨å†Œä»¤ç‰Œ</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">bin/elasticsearch-create-enrollment-token -s kibana</span><br><span class=\"line\"><span class=\"comment\"># è¾“å‡ºç»“æœå¦‚ä¸‹</span></span><br><span class=\"line\">eyJ2ZXIiOiI4LjE0LjAiLCJhZHIiOlsiMTAuMjUwLjAuMjM5OjkyMDAiXSwiZmdyIjoiM2YxNDFjMTZkZmM2ZTE2NTg5NGJjMTY3MjA4NGIyMjBkY2RkMjJmZmUwMjExNmQ1MWFjMTgwMDNjZmFhNWExZCIsImtleSI6ImxlTWh1SlVCcVJWQUw4WGFjMk1HOkVHYTYxcWlfVEotQWQ1Y3dQdXcyckEifQ==</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¿›å…¥kibanaå®‰è£…ç›®å½•ï¼Œé€šè¿‡ä¸‹é¢çš„å‘½ä»¤æ³¨å†Œ Kibana</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># bin/kibana-setup --enrollment-token &lt;enrollment-token&gt;</span></span><br><span class=\"line\">bin/kibana-setup --enrollment-token eyJ2ZXIiOiI4LjE0LjAiLCJhZHIiOlsiMTAuMjUwLjAuMjM5OjkyMDAiXSwiZmdyIjoiM2YxNDFjMTZkZmM2ZTE2NTg5NGJjMTY3MjA4NGIyMjBkY2RkMjJmZmUwMjExNmQ1MWFjMTgwMDNjZmFhNWExZCIsImtleSI6ImxlTWh1SlVCcVJWQUw4WGFjMk1HOkVHYTYxcWlfVEotQWQ1Y3dQdXcyckEifQ==</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ³¨å†ŒæˆåŠŸä¼šè¾“å‡º</span></span><br><span class=\"line\">âœ” Kibana configured successfully.</span><br></pre></td></tr></table></figure>\n<div class=\"tips\">\n<ul class=\"lvl-1\">\n<li class=\"lvl-2\">\n<p>å¦‚æœESçš„<code>xpack.security.http.ssl.enabled</code> è®¾ç½®ä¸º falseï¼Œæ³¨å†ŒKibanaæ—¶ä¼šæŠ¥é”™ï¼ŒæŠ¥é”™ä¿¡æ¯å¦‚ä¸‹ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">âœ– Unable to connect to Elasticsearch with the provided enrollment token: Unable to connect to any of the provided hosts.</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-1\">\n<li class=\"lvl-2\">æ³¨å†ŒæˆåŠŸåä¼šåœ¨<code>/usr/local/kibana/kibana-8.17.3/config/kibana.yml</code>æ–‡ä»¶ä¸­æ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># This section was automatically generated during setup.</span></span><br><span class=\"line\"><span class=\"comment\"># ESæœåŠ¡URL</span></span><br><span class=\"line\">elasticsearch.hosts: [<span class=\"string\">&#x27;https://10.250.0.239:9200&#x27;</span>] <span class=\"comment\"># 10.250.0.239æ˜¯æœ¬æœºçš„å†…ç½‘IP</span></span><br><span class=\"line\"><span class=\"comment\"># æŒ‡å®šç”¨äºè®¤è¯çš„æœåŠ¡è´¦æˆ·ä»¤ç‰Œ</span></span><br><span class=\"line\">elasticsearch.serviceAccountToken: AAEAAWVsYXN0aWMva2liYW5hL2Vucm9sbC1wcm9jZXNzLXRva2VuLTE3NDI1NTA5ODU0MTg6Z2lJUERGaG1TR3VNcC1sb0RyMnMydw</span><br><span class=\"line\"><span class=\"comment\"># æŒ‡å®šç”¨æ¥éªŒè¯ Elasticsearch æœåŠ¡å™¨ SSL è¯ä¹¦çš„ CA è¯ä¹¦è·¯å¾„</span></span><br><span class=\"line\">elasticsearch.ssl.certificateAuthorities: [/usr/local/kibana/kibana-8.17.3/data/ca_1742550986498.crt]</span><br><span class=\"line\"><span class=\"comment\"># é…ç½® Fleet çš„è¾“å‡ºç›®æ ‡ã€‚Fleet æ˜¯ Elastic çš„ä¸€ä¸ªç®¡ç†å·¥å…·ï¼Œç”¨äºç®¡ç†å’Œç›‘æ§å¼¹æ€§æ ˆï¼ˆElastic Stackï¼‰ã€‚è¿™ä¸ªé…ç½®å®šä¹‰äº† Fleet é»˜è®¤è¾“å‡ºçš„ç›®æ ‡ï¼Œå³ Elasticsearchã€‚</span></span><br><span class=\"line\">xpack.fleet.outputs: [&#123;<span class=\"built_in\">id</span>: fleet-default-output, name: default, is_default: <span class=\"literal\">true</span>, is_default_monitoring: <span class=\"literal\">true</span>, <span class=\"built_in\">type</span>: elasticsearch, hosts: [<span class=\"string\">&#x27;https://10.250.0.239:9200&#x27;</span>], ca_trusted_fingerprint: 3f141c16dfc6e165894bc1672084b220dcdd22ffe02116d51ac18003cfaa5a1d&#125;]</span><br><span class=\"line\">  <span class=\"comment\"># id: fleet-default-outputï¼šè¾“å‡ºçš„å”¯ä¸€æ ‡è¯†ç¬¦ã€‚</span></span><br><span class=\"line\">  <span class=\"comment\"># name: defaultï¼šè¾“å‡ºçš„åç§°ã€‚</span></span><br><span class=\"line\">  <span class=\"comment\"># is_default: trueï¼šè¡¨ç¤ºè¿™æ˜¯é»˜è®¤è¾“å‡ºã€‚</span></span><br><span class=\"line\">  <span class=\"comment\"># is_default_monitoring: trueï¼šè¡¨ç¤ºè¿™æ˜¯é»˜è®¤çš„ç›‘æ§è¾“å‡ºã€‚</span></span><br><span class=\"line\">  <span class=\"comment\"># type: elasticsearchï¼šè¾“å‡ºç±»å‹æ˜¯ Elasticsearchã€‚</span></span><br><span class=\"line\">  <span class=\"comment\"># hosts: [&#x27;https://10.250.0.239:9200&#x27;]ï¼šè¿æ¥åˆ°çš„ Elasticsearch ä¸»æœºåœ°å€ã€‚</span></span><br><span class=\"line\">  <span class=\"comment\"># ca_trusted_fingerprint: 3f141c16dfc6e165894bc1672084b220dcdd22ffe02116d51ac18003cfaa5a1dï¼šCA è¯ä¹¦çš„ä¿¡ä»»æŒ‡çº¹ï¼Œç”¨äºéªŒè¯ CA è¯ä¹¦çš„èº«ä»½ã€‚</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"æ–¹æ³•2ï¼šç”¨æˆ·åå¯†ç å…³è”\">æ–¹æ³•2ï¼šç”¨æˆ·åå¯†ç å…³è”</h3>\n<ul class=\"lvl-1\">\n<li class=\"lvl-2\">\n<p>åˆ›å»ºkibanaè¿æ¥elasticsearchçš„ç”¨æˆ·å¯†ç ï¼Œä¸èƒ½ç”¨ <code>elastic</code> è¿™ä¸ªç”¨æˆ·ï¼Œå› ä¸ºè¿™ä¸ªæ˜¯è¶…çº§ç”¨æˆ·ï¼Œè¦ä½¿ç”¨ kibana_system ç”¨æˆ·</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># è¿›å…¥elasticsearchå®‰è£…ç›®å½•ï¼Œæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤é‡ç½® kibana_system ç”¨æˆ·çš„å¯†ç </span></span><br><span class=\"line\">bin/elasticsearch-reset-password -u kibana_system -i</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-1\">\n<li class=\"lvl-2\">\n<p>é…ç½®å¯åŠ¨æ–‡ä»¶ï¼Œè¿›å…¥<code>/usr/local/kibana/kibana-8.17.3/config</code>ç›®å½•ï¼Œä¿®æ”¹<code>kibana.yml</code>æ–‡ä»¶</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ç«¯å£ï¼Œé»˜è®¤5601</span></span><br><span class=\"line\">server.port: 5601</span><br><span class=\"line\"><span class=\"comment\"># kibanaæœåŠ¡å™¨çš„ipï¼Œ4ä¸ª0è¡¨ç¤ºä»»ä½•ä¸€ä¸ªç½‘å¡éƒ½å¯ä»¥è®¿é—®</span></span><br><span class=\"line\">server.host: <span class=\"string\">&quot;0.0.0.0&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># elasctisearchå…³è”</span></span><br><span class=\"line\"><span class=\"comment\"># ESæœåŠ¡åœ°å€ï¼Œæ³¨æ„è¿™é‡Œæ˜¯https</span></span><br><span class=\"line\">elasticsearch.hosts: [<span class=\"string\">&quot;https://10.250.0.239:9200&quot;</span>]</span><br><span class=\"line\"><span class=\"comment\"># æŒ‡å®šhttpsè¯ä¹¦è·¯å¾„ï¼Œå¯ä»¥ä»ESçš„è¯ä¹¦ç›®å½•ä¸­è·å–</span></span><br><span class=\"line\">elasticsearch.ssl.certificateAuthorities: [<span class=\"string\">&quot;/usr/local/elasticsearch/elasticsearch-8.17.3/config/certs/http_ca.crt&quot;</span>]</span><br><span class=\"line\"><span class=\"comment\"># ç”¨æˆ·åå¯†ç </span></span><br><span class=\"line\">elasticsearch.username: <span class=\"string\">&quot;kibana_system&quot;</span></span><br><span class=\"line\">elasticsearch.password: <span class=\"string\">&quot;123456&quot;</span></span><br><span class=\"line\"><span class=\"comment\"># ä¸­æ–‡</span></span><br><span class=\"line\">i18n.locale: <span class=\"string\">&quot;zh-CN&quot;</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-1\">\n<li class=\"lvl-2\">\n<p>å¦‚æœESæ²¡æœ‰å¼€å¯å®‰å…¨è®¤è¯ï¼Œåˆ™åªéœ€è¦è¿›è¡Œå¦‚ä¸‹é…ç½®å³å¯ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ç«¯å£ï¼Œé»˜è®¤5601</span></span><br><span class=\"line\">server.port: 5601</span><br><span class=\"line\"><span class=\"comment\"># kibanaæœåŠ¡å™¨çš„ipï¼Œ4ä¸ª0è¡¨ç¤ºä»»ä½•ä¸€ä¸ªç½‘å¡éƒ½å¯ä»¥è®¿é—®</span></span><br><span class=\"line\">server.host: <span class=\"string\">&quot;0.0.0.0&quot;</span></span><br><span class=\"line\"><span class=\"comment\"># ESæœåŠ¡åœ°å€ï¼Œæ³¨æ„è¿™é‡Œæ˜¯http</span></span><br><span class=\"line\">elasticsearch.hosts: [<span class=\"string\">&quot;http://10.250.0.239:9200&quot;</span>]</span><br><span class=\"line\"><span class=\"comment\"># ä¸­æ–‡</span></span><br><span class=\"line\">i18n.locale: <span class=\"string\">&quot;zh-CN&quot;</span></span><br></pre></td></tr></table></figure>\n</div>\n<h2 id=\"å¯åŠ¨KibanaæœåŠ¡\">å¯åŠ¨KibanaæœåŠ¡</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¿›å…¥<code>/usr/local/kibana/kibana-8.17.3</code>ç›®å½•ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤å¯åŠ¨æœåŠ¡</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">./bin/kibana</span><br><span class=\"line\"><span class=\"comment\"># åå°å¯åŠ¨ï¼Œå¹¶å°†æ—¥å¿—å†™å…¥åˆ°logs/kibana.log</span></span><br><span class=\"line\"><span class=\"built_in\">nohup</span> bin/kibana &gt; logs/kibana.log 2&gt;&amp;1 &amp;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è®¿é—®åœ°å€ï¼š<a href=\"http://localhost:5601\">http://localhost:5601</a>ï¼Œè¿™é‡Œæ³¨æ„ç™»å½•ç”¨æˆ·éœ€è¦ä½¿ç”¨ï¼š<code>elastic</code>ï¼Œè€Œä¸æ˜¯<code>kibana_system</code>ã€‚</p>\n</li>\n</ul>\n<h2 id=\"å¯åŠ¨KibanaæœåŠ¡åçš„æ—¥å¿—å‘Šè­¦\">å¯åŠ¨KibanaæœåŠ¡åçš„æ—¥å¿—å‘Šè­¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>KibanaæœåŠ¡å¯åŠ¨åï¼Œä¼šåœ¨<code>/usr/local/kibana/kibana-8.17.3/logs/kibana.log</code>æ–‡ä»¶ä¸­è®°å½•ä¸€äº›é”™è¯¯æ—¥å¿—ï¼Œå¦‚æœå‡ºç°é”™è¯¯ï¼Œå¯ä»¥æŸ¥çœ‹æ—¥å¿—ï¼Œè§£å†³é”™è¯¯ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[WARN ][plugins.fleet] xpack.encryptedSavedObjects.encryptionKey is not configured, private key passphrase is being stored <span class=\"keyword\">in</span> plain text</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¿™ä¸ªè­¦å‘Šä¿¡æ¯è¡¨æ˜ Kibana çš„æŸäº›æ’ä»¶ï¼ˆå¦‚ Fleetï¼‰åœ¨ç¼ºå°‘ <code>xpack.encryptedSavedObjects.encryptionKey</code> é…ç½®çš„æƒ…å†µä¸‹è¿è¡Œï¼Œå¯¼è‡´ç§é’¥å¯†ç å’Œä»£ç†å¸è½½ä»¤ç‰Œä»¥æ˜æ–‡å½¢å¼å­˜å‚¨ã€‚ä¸ºäº†æé«˜å®‰å…¨æ€§ï¼Œå»ºè®®é…ç½®ä¸€ä¸ªåŠ å¯†å¯†é’¥ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ç”ŸæˆåŠ å¯†å¯†é’¥</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ bin/kibana-encryption-keys generate</span><br><span class=\"line\">Kibana is currently running with legacy OpenSSL providers enabled! For details and instructions on how to <span class=\"built_in\">disable</span> see https://www.elastic.co/guide/en/kibana/8.17/production.html#openssl-legacy-provider</span><br><span class=\"line\"><span class=\"comment\">## Kibana Encryption Key Generation Utility</span></span><br><span class=\"line\"></span><br><span class=\"line\">The <span class=\"string\">&#x27;generate&#x27;</span> <span class=\"built_in\">command</span> guides you through the process of setting encryption keys <span class=\"keyword\">for</span>:</span><br><span class=\"line\"></span><br><span class=\"line\">xpack.encryptedSavedObjects.encryptionKey</span><br><span class=\"line\">    Used to encrypt stored objects such as dashboards and visualizations</span><br><span class=\"line\">    https://www.elastic.co/guide/en/kibana/current/xpack-security-secure-saved-objects.html#xpack-security-secure-saved-objects</span><br><span class=\"line\"></span><br><span class=\"line\">xpack.reporting.encryptionKey</span><br><span class=\"line\">    Used to encrypt saved reports</span><br><span class=\"line\">    https://www.elastic.co/guide/en/kibana/current/reporting-settings-kb.html#general-reporting-settings</span><br><span class=\"line\"></span><br><span class=\"line\">xpack.security.encryptionKey</span><br><span class=\"line\">    Used to encrypt session information</span><br><span class=\"line\">    https://www.elastic.co/guide/en/kibana/current/security-settings-kb.html#security-session-and-cookie-settings</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">Already defined settings are ignored and can be regenerated using the --force flag.  Check the documentation links <span class=\"keyword\">for</span> instructions on how to rotate encryption keys.</span><br><span class=\"line\">Definitions should be <span class=\"built_in\">set</span> <span class=\"keyword\">in</span> the kibana.yml used configure Kibana.</span><br><span class=\"line\"></span><br><span class=\"line\">Settings:</span><br><span class=\"line\">xpack.encryptedSavedObjects.encryptionKey: 47967e4b78bd26decb622b78f0ddd324</span><br><span class=\"line\">xpack.reporting.encryptionKey: 78b5f603f3b0e6ad76c13a0f5d00cde0</span><br><span class=\"line\">xpack.security.encryptionKey: 8aa7f4dfbc4e734a2a9f92a2730b36af</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>é…ç½® Kibana ä»¥ä½¿ç”¨åŠ å¯†å¯†é’¥ï¼Œæ·»åŠ åˆ° kibana.yml æ–‡ä»¶ä¸­ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">xpack.encryptedSavedObjects.encryptionKey: 47967e4b78bd26decb622b78f0ddd324</span><br><span class=\"line\">xpack.reporting.encryptionKey: 78b5f603f3b0e6ad76c13a0f5d00cde0</span><br><span class=\"line\">xpack.security.encryptionKey: 8aa7f4dfbc4e734a2a9f92a2730b36af</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>é‡å¯ Kibana æœåŠ¡ ä»¥åº”ç”¨æ›´æ”¹ã€‚</p>\n</li>\n</ul>\n<h2 id=\"Kibana-è‡ªå¯åŠ¨è„šæœ¬\">Kibana è‡ªå¯åŠ¨è„šæœ¬</h2>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åˆ›å»ºæœåŠ¡æ–‡ä»¶</span></span><br><span class=\"line\">$ vim /usr/lib/systemd/system/kibana.service</span><br><span class=\"line\">[Unit]</span><br><span class=\"line\">Description=kibana</span><br><span class=\"line\">Documentation=https://www.elastic.co</span><br><span class=\"line\">After=es.service</span><br><span class=\"line\"></span><br><span class=\"line\">[Service]</span><br><span class=\"line\">Type=simple</span><br><span class=\"line\">PrivateTmp=<span class=\"literal\">true</span></span><br><span class=\"line\"><span class=\"comment\"># æŒ‡å®šESç”¨æˆ·</span></span><br><span class=\"line\">User=elastic</span><br><span class=\"line\">Group=elastic</span><br><span class=\"line\">LimitNOFILE=100000</span><br><span class=\"line\">LimitNPROC=100000</span><br><span class=\"line\">Restart=<span class=\"built_in\">yes</span></span><br><span class=\"line\"><span class=\"comment\"># å¯åŠ¨å‘½ä»¤</span></span><br><span class=\"line\">ExecStart=/usr/local/kibana/kibana-8.17.3/bin/kibana</span><br><span class=\"line\">ExecRestart=/bin/kill -s HUP <span class=\"variable\">$MAINPID</span></span><br><span class=\"line\">ExecStop=/bin/kill -s QUIT <span class=\"variable\">$MAINPID</span></span><br><span class=\"line\"></span><br><span class=\"line\">[Install]</span><br><span class=\"line\">WantedBy=multi-user.target</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># é‡æ–°åŠ è½½</span></span><br><span class=\"line\">$ systemctl daemon-reload</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å¯åŠ¨</span></span><br><span class=\"line\">$ systemctl start kibana</span><br><span class=\"line\"><span class=\"comment\"># åœæ­¢</span></span><br><span class=\"line\">$ systemctl stop kibana</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹çŠ¶æ€</span></span><br><span class=\"line\">$ systemctl status kibana</span><br><span class=\"line\"><span class=\"comment\"># è®¾ç½®å¼€æœºå¯åŠ¨</span></span><br><span class=\"line\">$ systemctl <span class=\"built_in\">enable</span> kibana</span><br></pre></td></tr></table></figure>","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç»å¦‚ä½•åœ¨linuxä¸‹å®‰è£…Kibana Kibanaç‰ˆæœ¬8.17.3 Elasticsearchç‰ˆæœ¬8.17.3ï¼Œlinuxä¸‹å®‰è£…Elasticsearch ä¸‹è½½ ä¸‹è½½åœ°å€ï¼šhttps://www.elastic.co/cn/downloads/past-releases#kibana é€‰æ‹©å¯¹åº”çš„ç‰ˆæœ¬ï¼šè¿™é‡Œé€‰æ‹©å½“å‰çš„æœ€æ–°ç‰ˆKibana 8.17.3ï¼Œä¹‹åé€‰æ‹©å¯¹åº”çš„æ“ä½œç³»ç»ŸLINUX X86_64 1wget https://artifacts.elastic.co/downloads/kibana/kibana-8.17.3-linux-x86_64.tar.gz ä¸‹è½½å®Œæˆåè§£å‹åˆ°/usr/local/kibanaç›®å½•ä¸‹ï¼Œè§£å‹å‘½ä»¤å¦‚ä¸‹ï¼š 12mkdir /usr/local/kibanatar -zxvf kibana-8.17.3-linux-x86_64.tar.gz -C /usr/local/kibana åˆ›å»ºå¯åŠ¨ç”¨æˆ· elasticsearchå’Œkibanaéƒ½ä¸èƒ½ç”¨rootç”¨æˆ·å¯åŠ¨ åˆ›å»ºç”¨æˆ·elasticï¼Œå¹¶è®¾ç½®å¯†ç ï¼Œè¿™ä¸€æ­¥æˆ‘ä»¬åœ¨å®‰è£…elasticsearchçš„æ—¶å€™å·²ç»é…ç½®è¿‡äº†ï¼Œè¿™é‡Œå°±ä¸å†èµ˜è¿°äº† 12useradd elasticpasswd elastic ä¿®æ”¹kibanaå®‰è£…ç›®å½•çš„ç”¨æˆ·æƒé™ 1chown -R elastic:elastic /usr/local/kibana åˆ‡æ¢åˆ°elasticç”¨æˆ·ä¸‹æ‰§è¡Œå‘½ä»¤ 1su - elastic å…³è”Kibanaå’ŒElasticsearch æ–¹æ³•1ï¼šæ³¨å†Œä»¤ç‰ŒTokenå…³è”[å®˜æ–¹æ¨è] æ³¨æ„æ­¤æ–¹æ³•è¦æ±‚elasticsearchå¿…é¡»å¼€å¯å®‰å…¨è®¤è¯ï¼Œè€Œä¸”xpack.security.http.ssl.enabled å¿…é¡»è®¾ç½®ä¸º true é…ç½®å¯åŠ¨æ–‡ä»¶ï¼Œè¿›å…¥/usr/local/kibana/kibana-8.17.3/configç›®å½•ï¼Œæ ¹æ®éœ€è¦ä¿®æ”¹kibana.ymlæ–‡ä»¶ 12345678# ç«¯å£ï¼Œé»˜è®¤5601server.port: 5601# kibanaæœåŠ¡å™¨çš„ipï¼Œ4ä¸ª0è¡¨ç¤ºä»»ä½•ä¸€ä¸ªç½‘å¡éƒ½å¯ä»¥è®¿é—®ï¼Œé»˜è®¤ä¸ºlocalhostserver.host: &quot;0.0.0.0&quot;# ä¸­æ–‡ï¼Œé»˜è®¤ä¸º eni18n.locale: &quot;zh-CN&quot;# é…ç½®httpsï¼Œé»˜è®¤å€¼ä¸º certificateelasticsearch.ssl.verificationMode: &#x27;certificate&#x27; è¿˜è®°å¾—æˆ‘ä»¬ç¬¬ä¸€æ¬¡å¯åŠ¨ESæ—¶æ—¥å¿—ä¿¡æ¯ä¸­çš„æœ‰å…³kibanaæ³¨å†Œä»¤ç‰Œçš„ä¿¡æ¯å—ï¼Ÿé‚£ä¸ªä»¤ç‰Œåªæœ‰30åˆ†é’Ÿæœ‰æ•ˆæœŸï¼Œè¿‡æœŸåå¯ä»¥è¿›å…¥elasticsearchå®‰è£…ç›®å½•ï¼Œé‡æ–°åˆ›å»ºkibanaæ³¨å†Œä»¤ç‰Œ 123bin/elasticsearch-create-enrollment-token -s kibana# è¾“å‡ºç»“æœå¦‚ä¸‹eyJ2ZXIiOiI4LjE0LjAiLCJhZHIiOlsiMTAuMjUwLjAuMjM5OjkyMDAiXSwiZmdyIjoiM2YxNDFjMTZkZmM2ZTE2NTg5NGJjMTY3MjA4NGIyMjBkY2RkMjJmZmUwMjExNmQ1MWFjMTgwMDNjZmFhNWExZCIsImtleSI6ImxlTWh1SlVCcVJWQUw4WGFjMk1HOkVHYTYxcWlfVEotQWQ1Y3dQdXcyckEifQ== è¿›å…¥kibanaå®‰è£…ç›®å½•ï¼Œé€šè¿‡ä¸‹é¢çš„å‘½ä»¤æ³¨å†Œ Kibana 12345# bin/kibana-setup --enrollment-token &lt;enrollment-token&gt;bin/kibana-setup --enrollment-token eyJ2ZXIiOiI4LjE0LjAiLCJhZHIiOlsiMTAuMjUwLjAuMjM5OjkyMDAiXSwiZmdyIjoiM2YxNDFjMTZkZmM2ZTE2NTg5NGJjMTY3MjA4NGIyMjBkY2RkMjJmZmUwMjExNmQ1MWFjMTgwMDNjZmFhNWExZCIsImtleSI6ImxlTWh1SlVCcVJWQUw4WGFjMk1HOkVHYTYxcWlfVEotQWQ1Y3dQdXcyckEifQ==# æ³¨å†ŒæˆåŠŸä¼šè¾“å‡ºâœ” Kibana configured successfully. å¦‚æœESçš„xpack.security.http.ssl.enabled è®¾ç½®ä¸º falseï¼Œæ³¨å†ŒKibanaæ—¶ä¼šæŠ¥é”™ï¼ŒæŠ¥é”™ä¿¡æ¯å¦‚ä¸‹ï¼š 1âœ– Unable to connect to Elasticsearch with the provided enrollment token: Unable to connect to any of the provided hosts. æ³¨å†ŒæˆåŠŸåä¼šåœ¨/usr/local/kibana/kibana-8.17.3/config/kibana.ymlæ–‡ä»¶ä¸­æ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š 12345678910111213141516# This section was automatically generated during setup.# ESæœåŠ¡URLelasticsearch.hosts: [&#x27;https://10.250.0.239:9200&#x27;] # 10.250.0.239æ˜¯æœ¬æœºçš„å†…ç½‘IP# æŒ‡å®šç”¨äºè®¤è¯çš„æœåŠ¡è´¦æˆ·ä»¤ç‰Œelasticsearch.serviceAccountToken: AAEAAWVsYXN0aWMva2liYW5hL2Vucm9sbC1wcm9jZXNzLXRva2VuLTE3NDI1NTA5ODU0MTg6Z2lJUERGaG1TR3VNcC1sb0RyMnMydw# æŒ‡å®šç”¨æ¥éªŒè¯ Elasticsearch æœåŠ¡å™¨ SSL è¯ä¹¦çš„ CA è¯ä¹¦è·¯å¾„elasticsearch.ssl.certificateAuthorities: [/usr/local/kibana/kibana-8.17.3/data/ca_1742550986498.crt]# é…ç½® Fleet çš„è¾“å‡ºç›®æ ‡ã€‚Fleet æ˜¯ Elastic çš„ä¸€ä¸ªç®¡ç†å·¥å…·ï¼Œç”¨äºç®¡ç†å’Œç›‘æ§å¼¹æ€§æ ˆï¼ˆElastic Stackï¼‰ã€‚è¿™ä¸ªé…ç½®å®šä¹‰äº† Fleet é»˜è®¤è¾“å‡ºçš„ç›®æ ‡ï¼Œå³ Elasticsearchã€‚xpack.fleet.outputs: [&#123;id: fleet-default-output, name: default, is_default: true, is_default_monitoring: true, type: elasticsearch, hosts: [&#x27;https://10.250.0.239:9200&#x27;], ca_trusted_fingerprint: 3f141c16dfc6e165894bc1672084b220dcdd22ffe02116d51ac18003cfaa5a1d&#125;] # id: fleet-default-outputï¼šè¾“å‡ºçš„å”¯ä¸€æ ‡è¯†ç¬¦ã€‚ # name: defaultï¼šè¾“å‡ºçš„åç§°ã€‚ # is_default: trueï¼šè¡¨ç¤ºè¿™æ˜¯é»˜è®¤è¾“å‡ºã€‚ # is_default_monitoring: trueï¼šè¡¨ç¤ºè¿™æ˜¯é»˜è®¤çš„ç›‘æ§è¾“å‡ºã€‚ # type: elasticsearchï¼šè¾“å‡ºç±»å‹æ˜¯ Elasticsearchã€‚ # hosts: [&#x27;https://10.250.0.239:9200&#x27;]ï¼šè¿æ¥åˆ°çš„ Elasticsearch ä¸»æœºåœ°å€ã€‚ # ca_trusted_fingerprint: 3f141c16dfc6e165894bc1672084b220dcdd22ffe02116d51ac18003cfaa5a1dï¼šCA è¯ä¹¦çš„ä¿¡ä»»æŒ‡çº¹ï¼Œç”¨äºéªŒè¯ CA è¯ä¹¦çš„èº«ä»½ã€‚ æ–¹æ³•2ï¼šç”¨æˆ·åå¯†ç å…³è” åˆ›å»ºkibanaè¿æ¥elasticsearchçš„ç”¨æˆ·å¯†ç ï¼Œä¸èƒ½ç”¨ elastic è¿™ä¸ªç”¨æˆ·ï¼Œå› ä¸ºè¿™ä¸ªæ˜¯è¶…çº§ç”¨æˆ·ï¼Œè¦ä½¿ç”¨ kibana_system ç”¨æˆ· 12# è¿›å…¥elasticsearchå®‰è£…ç›®å½•ï¼Œæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤é‡ç½® kibana_system ç”¨æˆ·çš„å¯†ç bin/elasticsearch-reset-password -u kibana_system -i é…ç½®å¯åŠ¨æ–‡ä»¶ï¼Œè¿›å…¥/usr/local/kibana/kibana-8.17.3/configç›®å½•ï¼Œä¿®æ”¹kibana.ymlæ–‡ä»¶ 123456789101112131415# ç«¯å£ï¼Œé»˜è®¤5601server.port: 5601# kibanaæœåŠ¡å™¨çš„ipï¼Œ4ä¸ª0è¡¨ç¤ºä»»ä½•ä¸€ä¸ªç½‘å¡éƒ½å¯ä»¥è®¿é—®server.host: &quot;0.0.0.0&quot;# elasctisearchå…³è”# ESæœåŠ¡åœ°å€ï¼Œæ³¨æ„è¿™é‡Œæ˜¯httpselasticsearch.hosts: [&quot;https://10.250.0.239:9200&quot;]# æŒ‡å®šhttpsè¯ä¹¦è·¯å¾„ï¼Œå¯ä»¥ä»ESçš„è¯ä¹¦ç›®å½•ä¸­è·å–elasticsearch.ssl.certificateAuthorities: [&quot;/usr/local/elasticsearch/elasticsearch-8.17.3/config/certs/http_ca.crt&quot;]# ç”¨æˆ·åå¯†ç elasticsearch.username: &quot;kibana_system&quot;elasticsearch.password: &quot;123456&quot;# ä¸­æ–‡i18n.locale: &quot;zh-CN&quot; å¦‚æœESæ²¡æœ‰å¼€å¯å®‰å…¨è®¤è¯ï¼Œåˆ™åªéœ€è¦è¿›è¡Œå¦‚ä¸‹é…ç½®å³å¯ï¼š 12345678# ç«¯å£ï¼Œé»˜è®¤5601server.port: 5601# kibanaæœåŠ¡å™¨çš„ipï¼Œ4ä¸ª0è¡¨ç¤ºä»»ä½•ä¸€ä¸ªç½‘å¡éƒ½å¯ä»¥è®¿é—®server.host: &quot;0.0.0.0&quot;# ESæœåŠ¡åœ°å€ï¼Œæ³¨æ„è¿™é‡Œæ˜¯httpelasticsearch.hosts: [&quot;http://10.250.0.239:9200&quot;]# ä¸­æ–‡i18n.locale: &quot;zh-CN&quot; å¯åŠ¨KibanaæœåŠ¡ è¿›å…¥/usr/local/kibana/kibana-8.17.3ç›®å½•ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤å¯åŠ¨æœåŠ¡ 123./bin/kibana# åå°å¯åŠ¨ï¼Œå¹¶å°†æ—¥å¿—å†™å…¥åˆ°logs/kibana.lognohup bin/kibana &gt; logs/kibana.log 2&gt;&amp;1 &amp; è®¿é—®åœ°å€ï¼šhttp://localhost:5601ï¼Œè¿™é‡Œæ³¨æ„ç™»å½•ç”¨æˆ·éœ€è¦ä½¿ç”¨ï¼šelasticï¼Œè€Œä¸æ˜¯kibana_systemã€‚ å¯åŠ¨KibanaæœåŠ¡åçš„æ—¥å¿—å‘Šè­¦ KibanaæœåŠ¡å¯åŠ¨åï¼Œä¼šåœ¨/usr/local/kibana/kibana-8.17.3/logs/kibana.logæ–‡ä»¶ä¸­è®°å½•ä¸€äº›é”™è¯¯æ—¥å¿—ï¼Œå¦‚æœå‡ºç°é”™è¯¯ï¼Œå¯ä»¥æŸ¥çœ‹æ—¥å¿—ï¼Œè§£å†³é”™è¯¯ã€‚ 1[WARN ][plugins.fleet] xpack.encryptedSavedObjects.encryptionKey is not configured, private key passphrase is being stored in plain text è¿™ä¸ªè­¦å‘Šä¿¡æ¯è¡¨æ˜ Kibana çš„æŸäº›æ’ä»¶ï¼ˆå¦‚ Fleetï¼‰åœ¨ç¼ºå°‘ xpack.encryptedSavedObjects.encryptionKey é…ç½®çš„æƒ…å†µä¸‹è¿è¡Œï¼Œå¯¼è‡´ç§é’¥å¯†ç å’Œä»£ç†å¸è½½ä»¤ç‰Œä»¥æ˜æ–‡å½¢å¼å­˜å‚¨ã€‚ä¸ºäº†æé«˜å®‰å…¨æ€§ï¼Œå»ºè®®é…ç½®ä¸€ä¸ªåŠ å¯†å¯†é’¥ã€‚ ç”ŸæˆåŠ å¯†å¯†é’¥ 1234567891011121314151617181920212223242526$ bin/kibana-encryption-keys generateKibana is currently running with legacy OpenSSL providers enabled! For details and instructions on how to disable see https://www.elastic.co/guide/en/kibana/8.17/production.html#openssl-legacy-provider## Kibana Encryption Key Generation UtilityThe &#x27;generate&#x27; command guides you through the process of setting encryption keys for:xpack.encryptedSavedObjects.encryptionKey Used to encrypt stored objects such as dashboards and visualizations https://www.elastic.co/guide/en/kibana/current/xpack-security-secure-saved-objects.html#xpack-security-secure-saved-objectsxpack.reporting.encryptionKey Used to encrypt saved reports https://www.elastic.co/guide/en/kibana/current/reporting-settings-kb.html#general-reporting-settingsxpack.security.encryptionKey Used to encrypt session information https://www.elastic.co/guide/en/kibana/current/security-settings-kb.html#security-session-and-cookie-settingsAlready defined settings are ignored and can be regenerated using the --force flag. Check the documentation links for instructions on how to rotate encryption keys.Definitions should be set in the kibana.yml used configure Kibana.Settings:xpack.encryptedSavedObjects.encryptionKey: 47967e4b78bd26decb622b78f0ddd324xpack.reporting.encryptionKey: 78b5f603f3b0e6ad76c13a0f5d00cde0xpack.security.encryptionKey: 8aa7f4dfbc4e734a2a9f92a2730b36af é…ç½® Kibana ä»¥ä½¿ç”¨åŠ å¯†å¯†é’¥ï¼Œæ·»åŠ åˆ° kibana.yml æ–‡ä»¶ä¸­ï¼š 123xpack.encryptedSavedObjects.encryptionKey: 47967e4b78bd26decb622b78f0ddd324xpack.reporting.encryptionKey: 78b5f603f3b0e6ad76c13a0f5d00cde0xpack.security.encryptionKey: 8aa7f4dfbc4e734a2a9f92a2730b36af é‡å¯ Kibana æœåŠ¡ ä»¥åº”ç”¨æ›´æ”¹ã€‚ Kibana è‡ªå¯åŠ¨è„šæœ¬ 1234567891011121314151617181920212223242526272829303132333435# åˆ›å»ºæœåŠ¡æ–‡ä»¶$ vim /usr/lib/systemd/system/kibana.service[Unit]Description=kibanaDocumentation=https://www.elastic.coAfter=es.service[Service]Type=simplePrivateTmp=true# æŒ‡å®šESç”¨æˆ·User=elasticGroup=elasticLimitNOFILE=100000LimitNPROC=100000Restart=yes# å¯åŠ¨å‘½ä»¤ExecStart=/usr/local/kibana/kibana-8.17.3/bin/kibanaExecRestart=/bin/kill -s HUP $MAINPIDExecStop=/bin/kill -s QUIT $MAINPID[Install]WantedBy=multi-user.target# é‡æ–°åŠ è½½$ systemctl daemon-reload# å¯åŠ¨$ systemctl start kibana# åœæ­¢$ systemctl stop kibana# æŸ¥çœ‹çŠ¶æ€$ systemctl status kibana# è®¾ç½®å¼€æœºå¯åŠ¨$ systemctl enable kibana","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç»å¦‚ä½•åœ¨linuxä¸‹å®‰è£…Kibana Kibanaç‰ˆæœ¬8.17.3 Elasticsearchç‰ˆæœ¬8.17.3ï¼Œlinuxä¸‹å®‰è£…Elasticsearch","date_published":"2025-03-21T13:30:05.000Z","tags":["æŠ€æœ¯","elastic","kibana","elasticsearch","kibana"]},{"id":"https://blog.hanqunfeng.com/2025/03/20/elasticsearch-01-install/","url":"https://blog.hanqunfeng.com/2025/03/20/elasticsearch-01-install/","title":"linuxä¸‹å®‰è£…Elasticsearch","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç»å¦‚ä½•åœ¨linuxä¸‹å®‰è£…Elasticsearch</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://www.elastic.co/guide/en/elasticsearch/reference/8.17/index.html\">Elasticsearch</a>ç‰ˆæœ¬8.17.3</p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"ä¸‹è½½\">ä¸‹è½½</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¸‹è½½åœ°å€ï¼š<a href=\"https://www.elastic.co/cn/downloads/past-releases#elasticsearch\">https://www.elastic.co/cn/downloads/past-releases#elasticsearch</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>é€‰æ‹©å¯¹åº”çš„ç‰ˆæœ¬ï¼šè¿™é‡Œé€‰æ‹©å½“å‰çš„æœ€æ–°ç‰ˆ<code>Elasticsearch 8.17.3</code>ï¼Œä¹‹åé€‰æ‹©å¯¹åº”çš„æ“ä½œç³»ç»Ÿ<code>LINUX X86_64</code></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-8.17.3-linux-x86_64.tar.gz</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¸‹è½½å®Œæˆåè§£å‹åˆ°<code>/usr/local/elasticsearch</code>ç›®å½•ä¸‹ï¼Œè§£å‹å‘½ä»¤å¦‚ä¸‹ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">mkdir</span> /usr/local/elasticsearch</span><br><span class=\"line\">tar -zxvf elasticsearch-8.17.3-linux-x86_64.tar.gz -C /usr/local/elasticsearch</span><br></pre></td></tr></table></figure>\n<h2 id=\"ElasticSearchç›®å½•ç»“æ„\">ElasticSearchç›®å½•ç»“æ„</h2>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">bin        <span class=\"comment\"># è„šæœ¬æ–‡ä»¶ï¼ŒåŒ…æ‹¬å¯åŠ¨elasticsearchï¼Œå®‰è£…æ’ä»¶ï¼Œè¿è¡Œç»Ÿè®¡æ•°æ®ç­‰</span></span><br><span class=\"line\">config     <span class=\"comment\"># é…ç½®æ–‡ä»¶ç›®å½•ï¼Œå¦‚elasticsearché…ç½®ã€è§’è‰²é…ç½®ã€jvmé…ç½®ã€è¯ä¹¦ç­‰ã€‚</span></span><br><span class=\"line\">data       <span class=\"comment\"># æ•°æ®ç›®å½•ï¼Œé»˜è®¤å€¼ $ES_HOME/dataï¼ŒåŒ…å«èŠ‚ç‚¹ã€åˆ†ç‰‡ã€ç´¢å¼•ã€æ–‡æ¡£çš„æ‰€æœ‰æ•°æ®ï¼Œç”Ÿäº§ç¯å¢ƒå»ºè®®ä¿®æ”¹</span></span><br><span class=\"line\">jdk        <span class=\"comment\"># JDKç›®å½•ï¼Œç”¨äºè¿è¡ŒElasticsearchï¼Œ7.xä»¥åè‡ªå¸¦</span></span><br><span class=\"line\">lib        <span class=\"comment\"># Elasticsearchä¾èµ–çš„JARåŒ…</span></span><br><span class=\"line\">logs       <span class=\"comment\"># æ—¥å¿—ç›®å½•ï¼Œé»˜è®¤å€¼ $ES_HOME/logsï¼Œç”Ÿäº§ç¯å¢ƒå»ºè®®ä¿®æ”¹</span></span><br><span class=\"line\">modules    <span class=\"comment\"># åŒ…å«æ‰€æœ‰çš„Elasticsearchæ¨¡å—ï¼Œå¦‚Clusterã€Discoveryã€Indicesç­‰</span></span><br><span class=\"line\">plugins    <span class=\"comment\"># å·²å®‰è£…æ’ä»¶ç›®å½•</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"åˆ›å»ºå¯åŠ¨ç”¨æˆ·\">åˆ›å»ºå¯åŠ¨ç”¨æˆ·</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>elasticsearchå’Œkibanaéƒ½ä¸èƒ½ç”¨rootç”¨æˆ·å¯åŠ¨</p>\n</li>\n<li class=\"lvl-2\">\n<p>åˆ›å»ºç”¨æˆ·<code>elastic</code>ï¼Œå¹¶è®¾ç½®å¯†ç </p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">useradd elastic</span><br><span class=\"line\">passwd elastic</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¿®æ”¹elasticsearchå®‰è£…ç›®å½•çš„ç”¨æˆ·æƒé™</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">chown</span> -R elastic:elastic /usr/local/elasticsearch</span><br></pre></td></tr></table></figure>\n<h2 id=\"é…ç½®ç¯å¢ƒå˜é‡\">é…ç½®ç¯å¢ƒå˜é‡</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¿›å…¥elasticç”¨æˆ·ä¸»ç›®å½•ï¼Œ/home/elasticç›®å½•ä¸‹ï¼Œè®¾ç½®ç”¨æˆ·çº§åˆ«çš„ç¯å¢ƒå˜é‡</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åˆ‡æ¢åˆ°elasticç”¨æˆ·</span></span><br><span class=\"line\">su - elastic</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>vim .bash_profile</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Elasticsearchå®‰è£…ç›®å½•ï¼Œå®ƒç”¨äºå®šä½Elasticsearchçš„é…ç½®æ–‡ä»¶ã€æ’ä»¶å’Œå…¶ä»–ç›¸å…³èµ„æºã€‚</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> ES_HOME=/usr/local/elasticsearch/elasticsearch-8.17.3</span><br><span class=\"line\"><span class=\"comment\"># Elasticsearchä½¿ç”¨çš„JDKå®‰è£…ç›®å½•ï¼Œåœ¨å¯åŠ¨Elasticsearchæ—¶ï¼Œå®ƒä¼šæ£€æŸ¥ES_JAVA_HOMEç¯å¢ƒå˜é‡å¹¶ä½¿ç”¨å…¶ä¸­çš„Javaè·¯å¾„ã€‚</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> ES_JAVA_HOME=/usr/local/elasticsearch/elasticsearch-8.17.3/jdk/</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ä½¿é…ç½®ç”Ÿæ•ˆ</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">source</span> .bash_profile</span><br></pre></td></tr></table></figure>\n<h2 id=\"é…ç½®JVMå‚æ•°ï¼ˆå¯é€‰ï¼‰\">é…ç½®JVMå‚æ•°ï¼ˆå¯é€‰ï¼‰</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ESæ¯”è¾ƒè€—å†…å­˜ï¼Œå»ºè®®è™šæ‹Ÿæœº4Gæˆ–ä»¥ä¸Šå†…å­˜ï¼Œjvm1gä»¥ä¸Šçš„å†…å­˜åˆ†é…</p>\n</li>\n<li class=\"lvl-2\">\n<p>è¿›å…¥<code>/usr/local/elasticsearch/elasticsearch-8.17.3/config</code>ç›®å½•ï¼Œä¿®æ”¹<code>jvm.options</code>æ–‡ä»¶ï¼Œè°ƒæ•´jvmå †å†…å­˜å¤§å°</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">-Xms4g <span class=\"comment\"># è®¾ç½®æœ€å°å †å†…å­˜ï¼Œé»˜è®¤4gï¼Œä¸èƒ½å°äº1g</span></span><br><span class=\"line\">-Xmx4g <span class=\"comment\"># è®¾ç½®æœ€å¤§å †å†…å­˜ï¼Œé»˜è®¤4gï¼ŒXmxä¸è¦è¶…è¿‡æœºå™¨å†…å­˜çš„50%ï¼Œä¸è¦è¶…è¿‡30g</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"åˆ›å»ºæ•°æ®å’Œæ—¥å¿—å­˜å‚¨ç›®å½•\">åˆ›å»ºæ•°æ®å’Œæ—¥å¿—å­˜å‚¨ç›®å½•</h2>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åˆ‡æ¢åˆ°elasticç”¨æˆ·</span></span><br><span class=\"line\">su - elastic</span><br><span class=\"line\"><span class=\"comment\"># åˆ›å»ºç›®å½•</span></span><br><span class=\"line\"><span class=\"built_in\">mkdir</span> /usr/local/elasticsearch/data /usr/local/elasticsearch/log</span><br></pre></td></tr></table></figure>\n<h2 id=\"é…ç½®å¯åŠ¨æ–‡ä»¶\">é…ç½®å¯åŠ¨æ–‡ä»¶</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¦‚æœæ˜¯æœ¬åœ°å¼€å‘ç¯å¢ƒï¼Œä¹Ÿå¯ä»¥ä¸åšä»»ä½•ä¿®æ”¹ç›´æ¥å¯åŠ¨ï¼Œå› ä¸ºå¤§éƒ¨åˆ†é…ç½®é¡¹éƒ½æœ‰é»˜è®¤å€¼ï¼Œä½†ä¸ºäº†æ›´å¥½çš„æ§åˆ¶ESï¼Œæ¨èæŒ‰å¦‚ä¸‹æ–¹å¼è¿›è¡Œé…ç½®</p>\n</li>\n<li class=\"lvl-2\">\n<p>è¿›å…¥<code>/usr/local/elasticsearch/elasticsearch-8.17.3/config</code>ç›®å½•ï¼Œä¿®æ”¹<code>elasticsearch.yml</code>æ–‡ä»¶</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># é›†ç¾¤åç§°ï¼Œå¤šä¸ªèŠ‚ç‚¹å¦‚æœè¦ç»„æˆåŒä¸€ä¸ªé›†ç¾¤ï¼Œé‚£ä¹ˆé›†ç¾¤åç§°ä¸€å®šè¦é…ç½®æˆç›¸åŒï¼Œé»˜è®¤å€¼elasticsearch</span></span><br><span class=\"line\">cluster.name: test-elk</span><br><span class=\"line\"><span class=\"comment\"># èŠ‚ç‚¹åç§°ï¼Œé»˜è®¤å€¼å½“å‰èŠ‚ç‚¹éƒ¨ç½²æ‰€åœ¨æœºå™¨çš„ä¸»æœºå</span></span><br><span class=\"line\">node.name: node-1</span><br><span class=\"line\"><span class=\"comment\"># æ•°æ®å­˜å‚¨è·¯å¾„ï¼Œé»˜è®¤å€¼ $ES_HOME/data</span></span><br><span class=\"line\">path.data: /usr/local/elasticsearch/data</span><br><span class=\"line\"><span class=\"comment\"># æ—¥å¿—å­˜å‚¨è·¯å¾„ï¼Œé»˜è®¤å€¼ $ES_HOME/logs</span></span><br><span class=\"line\">path.logs: /usr/local/elasticsearch/logs</span><br><span class=\"line\"><span class=\"comment\"># é…ç½®ESå¯åŠ¨æ—¶æ˜¯å¦è¿›è¡Œå†…å­˜é”å®šæ£€æŸ¥ï¼Œé»˜è®¤å€¼trueï¼Œæœ¬æœºå†…å­˜æ¯”è¾ƒå°æ—¶è®¾ç½®ä¸ºfalse</span></span><br><span class=\"line\">bootstrap.memory_lock: <span class=\"literal\">false</span></span><br><span class=\"line\"><span class=\"comment\"># å…è®¸é€šè¿‡ä»»ä½•åœ°å€è®¿é—®ï¼Œå¼€å¯è¿œç¨‹è®¿é—®</span></span><br><span class=\"line\">network.host: 0.0.0.0</span><br><span class=\"line\"><span class=\"comment\"># é…ç½®å½“å‰ESèŠ‚ç‚¹å¯¹å¤–æä¾›æœåŠ¡çš„httpç«¯å£ï¼Œé»˜è®¤ 9200</span></span><br><span class=\"line\">http.port: 9200</span><br><span class=\"line\"><span class=\"comment\"># é…ç½®å½“å‰ESèŠ‚ç‚¹å¯¹å¤–æä¾›æœåŠ¡çš„tcpç«¯å£ï¼Œé»˜è®¤ 9300</span></span><br><span class=\"line\">transport.port: 9300</span><br><span class=\"line\"><span class=\"comment\"># é›†ç¾¤å†…çš„ä¸»æœºåˆ—è¡¨ï¼Œå•èŠ‚ç‚¹å¯åŠ¨æ—¶å¯ä»¥ä¸é…ç½®</span></span><br><span class=\"line\"><span class=\"comment\"># discovery.seed_hosts: [&quot;127.0.0.1&quot;]</span></span><br><span class=\"line\"><span class=\"comment\"># ç¬¬ä¸€æ¬¡å¯åŠ¨æ—¶éœ€è¦å‚ä¸é€‰ä¸»çš„èŠ‚ç‚¹åç§°</span></span><br><span class=\"line\">cluster.initial_master_nodes: [<span class=\"string\">&quot;node-1&quot;</span>]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#è§£å†³è·¨åŸŸé—®é¢˜</span></span><br><span class=\"line\">http.cors.enabled: <span class=\"literal\">true</span></span><br><span class=\"line\">http.cors.allow-origin: <span class=\"string\">&quot;*&quot;</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"å¯åŠ¨ElasticSearchæœåŠ¡\">å¯åŠ¨ElasticSearchæœåŠ¡</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¿›å…¥<code>/usr/local/elasticsearch/elasticsearch-8.17.3</code>ç›®å½•ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤å¯åŠ¨æœåŠ¡</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">./bin/elasticsearch</span><br><span class=\"line\"><span class=\"comment\"># åå°å¯åŠ¨</span></span><br><span class=\"line\">./bin/elasticsearch -d</span><br></pre></td></tr></table></figure>\n<h2 id=\"ESå¯åŠ¨å‰çš„å¼•å¯¼æ£€æŸ¥\">ESå¯åŠ¨å‰çš„å¼•å¯¼æ£€æŸ¥</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ESå¯åŠ¨æ—¶ï¼Œé»˜è®¤ä¼šè¿›è¡Œå¼•å¯¼æ£€æŸ¥ï¼Œæ‰€è°“å¼•å¯¼æ£€æŸ¥å°±æ˜¯åœ¨æœåŠ¡å¯åŠ¨ä¹‹å‰å¯¹ä¸€äº›é‡è¦çš„é…ç½®é¡¹è¿›è¡Œæ£€æŸ¥ï¼Œæ£€æŸ¥å…¶é…ç½®å€¼æ˜¯å¦æ˜¯åˆç†çš„ã€‚å¼•å¯¼æ£€æŸ¥åŒ…æ‹¬å¯¹JVMå¤§å°ã€å†…å­˜é”ã€è™šæ‹Ÿå†…å­˜ã€æœ€å¤§çº¿ç¨‹æ•°ã€é›†ç¾¤å‘ç°ç›¸å…³é…ç½®ç­‰ç›¸å…³çš„æ£€æŸ¥ï¼Œå¦‚æœæŸä¸€é¡¹æˆ–è€…å‡ é¡¹çš„é…ç½®ä¸åˆç†ï¼ŒESä¼šæ‹’ç»å¯åŠ¨æœåŠ¡ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å¦‚æœå¯åŠ¨æœåŠ¡æ—¶ï¼ŒæŠ¥ä»¥ä¸‹é”™è¯¯ï¼Œåˆ™éœ€è¦è§£å†³å¼•å¯¼æ£€æŸ¥ä¸­çš„é—®é¢˜</p>\n</li>\n<li class=\"lvl-2\">\n<p>1.max virtual memory areas vm.max_map_count [65530] is too low, increase to at least [262144];</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-6\">åŸå› ï¼šæœ€å¤§è™šæ‹Ÿå†…å­˜å¤ªå°,è°ƒå¤§ç³»ç»Ÿçš„è™šæ‹Ÿå†…å­˜</li>\n<li class=\"lvl-6\">è§£å†³åŠæ³•ï¼š</li>\n</ul>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># rootç”¨æˆ·ä¸‹è¿è¡Œ</span></span><br><span class=\"line\">vim /etc/sysctl.conf</span><br><span class=\"line\"><span class=\"comment\"># è¿½åŠ ä»¥ä¸‹å†…å®¹ï¼š</span></span><br><span class=\"line\">vm.max_map_count=262144</span><br><span class=\"line\"><span class=\"comment\"># ä¿å­˜é€€å‡ºä¹‹åæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š</span></span><br><span class=\"line\">sysctl -p</span><br></pre></td></tr></table></figure>\n</li>\n<li class=\"lvl-2\">\n<p>2.max file descriptors [4096] for elasticsearch process is too low, increase to at least [65536]</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-6\">åŸå› ï¼šæ–‡ä»¶æè¿°ç¬¦å¤ªå°ï¼Œè°ƒå¤§ç³»ç»Ÿçš„æ–‡ä»¶æè¿°ç¬¦</li>\n<li class=\"lvl-6\">è§£å†³åŠæ³•ï¼š</li>\n</ul>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># rootç”¨æˆ·ä¸‹è¿è¡Œ</span></span><br><span class=\"line\">vim /etc/security/limits.conf</span><br><span class=\"line\"><span class=\"comment\"># æœ«å°¾æ·»åŠ å¦‚ä¸‹é…ç½®ï¼š</span></span><br><span class=\"line\">* soft nofile 65536</span><br><span class=\"line\">* hard nofile 65536</span><br><span class=\"line\">* soft <span class=\"built_in\">nproc</span> 4096</span><br><span class=\"line\">* hard <span class=\"built_in\">nproc</span> 4096</span><br></pre></td></tr></table></figure>\n</li>\n<li class=\"lvl-2\">\n<p>å¦‚æœåªæ˜¯å•èŠ‚ç‚¹çš„å¼€å‘ç¯å¢ƒï¼Œåˆ™å¯ä»¥å…³é—­å¼•å¯¼æ£€æŸ¥ï¼Œç”Ÿæˆç¯å¢ƒä¸å»ºè®®è¿™æ ·åšï¼Œå› ä¸ºå…³é—­å¼•å¯¼æ£€æŸ¥åï¼ŒESæœåŠ¡å°†æ— æ³•ä¿è¯é›†ç¾¤çš„é«˜å¯ç”¨æ€§ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># è¿›å…¥elasticsearchå®‰è£…ç›®å½•</span></span><br><span class=\"line\">vim config/elasticsearch.yml</span><br><span class=\"line\"><span class=\"comment\"># æ·»åŠ å¦‚ä¸‹é…ç½®ï¼š</span></span><br><span class=\"line\"><span class=\"comment\"># æŒ‡å®šèŠ‚ç‚¹ä¸ºå•èŠ‚ç‚¹ï¼Œå¯ä»¥ç»•è¿‡å¼•å¯¼æ£€æŸ¥</span></span><br><span class=\"line\">discovery.type: single-node</span><br></pre></td></tr></table></figure>\n<h2 id=\"æœåŠ¡æ­£å¸¸å¯åŠ¨åä»ç„¶ä¸èƒ½æ­£å¸¸è®¿é—®\">æœåŠ¡æ­£å¸¸å¯åŠ¨åä»ç„¶ä¸èƒ½æ­£å¸¸è®¿é—®</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è®¿é—®æœåŠ¡</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl http://127.0.0.1:9200</span><br><span class=\"line\">curl: (52) Empty reply from server</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æŸ¥çœ‹æ—¥å¿—<code>/usr/local/elasticsearch/elasticsearch-8.17.3/logs/test-elk.log</code>ï¼Œå‘ç°æŠ¥å¦‚ä¸‹è­¦å‘Šï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[WARN ][o.e.h.n.Netty4HttpServerTransport] [node-1] received plaintext http traffic on an https channel, closing connection Netty4HttpChannel&#123;localAddress=/127.0.0.1:9200, remoteAddress=/127.0.0.1:38426&#125;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åŸå› æ˜¯ESåœ¨å¯åŠ¨æœåŠ¡æ—¶é»˜è®¤å¼€å¯äº† <code>X-Pack å®‰å…¨åŠŸèƒ½</code>ï¼ŒæŸ¥çœ‹é…ç½®æ–‡ä»¶<code>/usr/local/elasticsearch/elasticsearch-8.17.3/config/elasticsearch.yml</code>ï¼Œå‘ç°é…ç½®é¡¹<code>xpack.security.xxx</code>ç›¸å…³é…ç½®é¡¹è¢«è‡ªåŠ¨æ·»åŠ äº†ï¼Œå¦‚ä¸‹ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#----------------------- BEGIN SECURITY AUTO CONFIGURATION -----------------------</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\"># The following settings, TLS certificates, and keys have been automatically</span></span><br><span class=\"line\"><span class=\"comment\"># generated to configure Elasticsearch security features on 20-03-2025 08:53:20</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\"># --------------------------------------------------------------------------------</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Enable security features</span></span><br><span class=\"line\"><span class=\"comment\"># å¯ç”¨ Elasticsearch çš„å®‰å…¨ç‰¹æ€§ï¼ŒåŒ…æ‹¬ç”¨æˆ·è®¤è¯ã€è§’è‰²ç®¡ç†ã€åŠ å¯†ç­‰ã€‚</span></span><br><span class=\"line\"><span class=\"comment\"># å¼€å¯äº† X-Pack å®‰å…¨åŠŸèƒ½ï¼Œè¿™æ„å‘³ç€ä½ éœ€è¦è¿›è¡Œç”¨æˆ·è®¤è¯æ‰èƒ½è®¿é—® Elasticsearchã€‚</span></span><br><span class=\"line\"><span class=\"comment\"># å¦‚æœéœ€è¦å…³é—­ X-Pack å®‰å…¨åŠŸèƒ½ï¼Œä½ å¯ä»¥å°† xpack.security.enabled è®¾ç½®ä¸º falseã€‚</span></span><br><span class=\"line\">xpack.security.enabled: <span class=\"literal\">true</span></span><br><span class=\"line\"><span class=\"comment\"># å¯ç”¨å®‰å…¨æ³¨å†ŒåŠŸèƒ½ï¼Œå…è®¸é€šè¿‡äº¤äº’å¼å‘å¯¼æ¥é…ç½®å®‰å…¨è®¾ç½®ã€‚</span></span><br><span class=\"line\"><span class=\"comment\"># è¿™ä½¿å¾—ä½ å¯ä»¥é€šè¿‡ Kibana æˆ–å‘½ä»¤è¡Œå·¥å…·æ¥è‡ªåŠ¨é…ç½® SSL è¯ä¹¦å’Œå…¶ä»–å®‰å…¨è®¾ç½®ã€‚</span></span><br><span class=\"line\">xpack.security.enrollment.enabled: <span class=\"literal\">true</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Enable encryption for HTTP API client connections, such as Kibana, Logstash, and Agents</span></span><br><span class=\"line\"><span class=\"comment\"># å¯ç”¨ HTTP API å®¢æˆ·ç«¯è¿æ¥çš„åŠ å¯†</span></span><br><span class=\"line\"><span class=\"comment\"># Kibanaã€Logstash å’Œå…¶ä»–é€šè¿‡ HTTP API è¿æ¥åˆ° Elasticsearch çš„å®¢æˆ·ç«¯å°†ä½¿ç”¨ HTTPS è¿›è¡Œé€šä¿¡ï¼Œå¢å¼ºå®‰å…¨æ€§ã€‚</span></span><br><span class=\"line\">xpack.security.http.ssl:</span><br><span class=\"line\">  enabled: <span class=\"literal\">true</span> <span class=\"comment\"># å¯ç”¨ HTTP å±‚çš„ SSL åŠ å¯†ï¼Œå³httpsè®¿é—®ï¼Œç¡®ä¿å®¢æˆ·ç«¯ä¸ Elasticsearch ä¹‹é—´çš„é€šä¿¡æ˜¯åŠ å¯†çš„ã€‚è®¾ç½®ä¸ºfalseæ—¶ï¼Œå…³é—­åŠ å¯†ï¼Œå³httpè®¿é—®</span></span><br><span class=\"line\">  keystore.path: certs/http.p12 <span class=\"comment\"># æŒ‡å®šç”¨äº HTTP å±‚åŠ å¯†çš„å¯†é’¥åº“æ–‡ä»¶è·¯å¾„ã€‚è¿™æ˜¯ä¸€ä¸ª PKCS12 æ–‡ä»¶ï¼ŒåŒ…å«ç”¨äºåŠ å¯†å’ŒéªŒè¯çš„å…¬é’¥å’Œç§é’¥ã€‚</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Enable encryption and mutual authentication between cluster nodes</span></span><br><span class=\"line\"><span class=\"comment\"># å¯ç”¨èŠ‚ç‚¹é—´çš„åŠ å¯†å’ŒåŒå‘è®¤è¯</span></span><br><span class=\"line\"><span class=\"comment\"># Elasticsearch é›†ç¾¤ä¸­çš„èŠ‚ç‚¹ä¹‹é—´çš„é€šä¿¡å°†ä½¿ç”¨ SSL åŠ å¯†ï¼Œå¹¶ä¸”æ¯ä¸ªèŠ‚ç‚¹éƒ½ä¼šéªŒè¯å…¶ä»–èŠ‚ç‚¹çš„èº«ä»½ï¼Œä»è€Œå¢å¼ºé›†ç¾¤çš„å®‰å…¨æ€§ã€‚</span></span><br><span class=\"line\"><span class=\"comment\"># æ‰€æœ‰èŠ‚ç‚¹è¦é…ç½®ç›¸åŒçš„è¯ä¹¦</span></span><br><span class=\"line\">xpack.security.transport.ssl:</span><br><span class=\"line\">  enabled: <span class=\"literal\">true</span> <span class=\"comment\"># å¯ç”¨ä¼ è¾“å±‚çš„ SSL åŠ å¯†ï¼Œç¡®ä¿èŠ‚ç‚¹ä¹‹é—´çš„å†…éƒ¨é€šä¿¡æ˜¯åŠ å¯†çš„ã€‚</span></span><br><span class=\"line\">  verification_mode: certificate <span class=\"comment\"># è®¾ç½®éªŒè¯æ¨¡å¼ä¸º certificateï¼Œè¿™æ„å‘³ç€èŠ‚ç‚¹ä¹‹é—´éœ€è¦åŒå‘è®¤è¯ï¼ˆå³æ¯ä¸ªèŠ‚ç‚¹éƒ½éœ€è¦éªŒè¯å¯¹æ–¹çš„èº«ä»½ï¼‰ã€‚</span></span><br><span class=\"line\">  keystore.path: certs/transport.p12 <span class=\"comment\"># æŒ‡å®šç”¨äºä¼ è¾“å±‚åŠ å¯†çš„å¯†é’¥åº“æ–‡ä»¶è·¯å¾„ã€‚è¿™æ˜¯å¦ä¸€ä¸ª PKCS12 æ–‡ä»¶ï¼ŒåŒ…å«ç”¨äºåŠ å¯†å’ŒéªŒè¯çš„å…¬é’¥å’Œç§é’¥ã€‚</span></span><br><span class=\"line\">  truststore.path: certs/transport.p12 <span class=\"comment\"># æŒ‡å®šç”¨äºå­˜å‚¨ä¿¡ä»»è¯ä¹¦çš„ä¿¡ä»»åº“æ–‡ä»¶è·¯å¾„ã€‚è¿™é€šå¸¸ä¸å¯†é’¥åº“ç›¸åŒï¼Œä½†å¯ä»¥ä¸åŒã€‚</span></span><br><span class=\"line\"><span class=\"comment\">#----------------------- END SECURITY AUTO CONFIGURATION -------------------------</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è§£å†³æ–¹æ³•ï¼š</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-6\">1.ä¸æƒ³å¼€å¯å®‰å…¨è®¤è¯ï¼Œå°† <code>xpack.security.enabled</code> è®¾ç½®ä¸º falseï¼Œè¿™æ ·å³ä¾¿ä¸‹é¢çš„é…ç½®éƒ½è®¾ç½®ä¸ºtrueä¹Ÿä¸ä¼šæœ‰æ•ˆã€‚</li>\n<li class=\"lvl-6\">2.ä¸æƒ³httpsè®¿é—®ï¼Œå°† <code>xpack.security.http.ssl.enabled</code> è®¾ç½®ä¸º falseï¼Œä½†è¿™æ ·ä¼šå¯¼è‡´æ— æ³•é€šè¿‡è®¤è¯Tokenæ·»åŠ å…¶å®ƒèŠ‚ç‚¹æˆ–Kibanaã€‚</li>\n<li class=\"lvl-6\">3.ä¸æƒ³èŠ‚ç‚¹é—´é€šä¿¡åŠ å¯†ï¼Œå°† <code>xpack.security.transport.ssl.enabled</code> è®¾ç½®ä¸º false</li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<p>ä¸ºäº†ä¿è¯ESçš„å®‰å…¨ï¼Œæˆ‘è¿™é‡Œå°±å¼€å¯å®‰å…¨è®¤è¯ï¼Œå¹¶ä¸”é€šè¿‡httpsè®¿é—®ESï¼Œä½†æ­¤æ—¶æˆ‘ä»¬è®¿é—®ESçš„APIå°±éœ€è¦å¸¦ä¸Šè®¤è¯ç”¨æˆ·ï¼Œé‚£ä¹ˆç”¨æˆ·åå’Œå¯†ç æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p>\n</li>\n<li class=\"lvl-2\">\n<p>å®é™…ä¸Šåœ¨ESç¬¬ä¸€æ¬¡æ­£å¸¸å¯åŠ¨æ—¶å…¶æ—¥å¿—ä¸­å°±æ‰“å°äº†è‡ªåŠ¨é…ç½®çš„å®‰å…¨ç›¸å…³çš„ä¿¡æ¯æç¤ºï¼Œé‡Œé¢å°±ç»™å‡ºäº†ç™»å½•ç”¨æˆ·å’Œåˆå§‹çš„å¯†ç ï¼Œå¦‚ä¸‹ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span><br><span class=\"line\"><span class=\"comment\"># è¿™äº›æ—¥å¿—ä¿¡æ¯æä¾›äº† Elasticsearch 8 åœ¨é¦–æ¬¡å¯åŠ¨æ—¶è‡ªåŠ¨é…ç½®çš„å®‰å…¨ç‰¹æ€§ã€ç”Ÿæˆçš„é»˜è®¤å¯†ç ã€è¯ä¹¦æŒ‡çº¹ä»¥åŠå¦‚ä½•é…ç½® Kibana å’Œå…¶ä»–èŠ‚ç‚¹åŠ å…¥é›†ç¾¤çš„è¯¦ç»†è¯´æ˜ã€‚</span></span><br><span class=\"line\">âœ… Elasticsearch security features have been automatically configured!</span><br><span class=\"line\">âœ… Authentication is enabled and cluster connections are encrypted.</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># è¿™æ˜¯ elastic ç”¨æˆ·çš„é»˜è®¤å¯†ç ã€‚ç³»ç»Ÿå»ºè®®ä½ ä½¿ç”¨ bin/elasticsearch-reset-password -u elastic å‘½ä»¤æ¥é‡ç½®æ­¤å¯†ç ã€‚</span></span><br><span class=\"line\">â„¹ï¸  Password <span class=\"keyword\">for</span> the elastic user (reset with `bin/elasticsearch-reset-password -u elastic`):</span><br><span class=\"line\">  BNb=*qz6_M*mXL9uZiSP <span class=\"comment\"># è¿™é‡Œä¼šæ‰“å°å‡ºESè‡ªåŠ¨ç”Ÿæˆçš„å¯†ç </span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># è¿™æ˜¯ HTTP CA è¯ä¹¦çš„ SHA-256 æŒ‡çº¹ã€‚CA è¯ä¹¦ç”¨äºéªŒè¯ HTTPS è¿æ¥çš„èº«ä»½ã€‚</span></span><br><span class=\"line\">â„¹ï¸  HTTP CA certificate SHA-256 fingerprint:</span><br><span class=\"line\">  3f141c16dfc6e165894bc1672084b220dcdd22ffe02116d51ac18003cfaa5a1d</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æä¾›äº†å°† Kibana é…ç½®ä¸ºä½¿ç”¨æ­¤ Elasticsearch é›†ç¾¤çš„æ­¥éª¤ã€‚</span></span><br><span class=\"line\">â„¹ï¸  Configure Kibana to use this cluster:</span><br><span class=\"line\"><span class=\"comment\"># å¯åŠ¨ Kibana å¹¶æŒ‰ç…§ç»ˆç«¯ä¸­æ˜¾ç¤ºçš„é…ç½®é“¾æ¥è¿›è¡Œæ“ä½œã€‚</span></span><br><span class=\"line\">â€¢ Run Kibana and click the configuration <span class=\"built_in\">link</span> <span class=\"keyword\">in</span> the terminal when Kibana starts.</span><br><span class=\"line\"><span class=\"comment\"># å¤åˆ¶æä¾›çš„æ³¨å†Œä»¤ç‰Œï¼Œå¹¶åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ Kibana æ—¶ç²˜è´´æ­¤ä»¤ç‰Œã€‚ä»¤ç‰Œåœ¨æ¥ä¸‹æ¥çš„ 30 åˆ†é’Ÿå†…æœ‰æ•ˆã€‚</span></span><br><span class=\"line\"><span class=\"comment\"># è¡¥å……è¯´æ˜ï¼šç”Ÿæˆæ–°çš„kibanaæ³¨å†Œä»¤ç‰Œï¼šbin/elasticsearch-create-enrollment-token -s kibana</span></span><br><span class=\"line\">â€¢ Copy the following enrollment token and <span class=\"built_in\">paste</span> it into Kibana <span class=\"keyword\">in</span> your browser (valid <span class=\"keyword\">for</span> the next 30 minutes):</span><br><span class=\"line\">  eyJ2ZXIiOiI4LjE0LjAiLCJhZHIiOlsiMTAuMjUwLjAuMjM5OjkyMDAiXSwiZmdyIjoiM2YxNDFjMTZkZmM2ZTE2NTg5NGJjMTY3MjA4NGIyMjBkY2RkMjJmZmUwMjExNmQ1MWFjMTgwMDNjZmFhNWExZCIsImtleSI6ImFSWFBzcFVCTVVmc1d5aUJnbjBtOmRzbVBLQV95UXhDZkJpXzQyWDNEMVEifQ==</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æä¾›äº†å°†æ–°çš„ Elasticsearch èŠ‚ç‚¹åŠ å…¥ç°æœ‰é›†ç¾¤çš„æ­¥éª¤ã€‚</span></span><br><span class=\"line\">â„¹ï¸ Configure other nodes to <span class=\"built_in\">join</span> this cluster:</span><br><span class=\"line\"><span class=\"comment\"># ä½¿ç”¨ bin/elasticsearch --enrollment-token &lt;token&gt; å‘½ä»¤å¯åŠ¨æ–°çš„ Elasticsearch èŠ‚ç‚¹ã€‚ä»¤ç‰Œåœ¨æ¥ä¸‹æ¥çš„ 30 åˆ†é’Ÿå†…æœ‰æ•ˆã€‚</span></span><br><span class=\"line\"><span class=\"comment\"># è¡¥å……è¯´æ˜ï¼šç”Ÿæˆæ–°çš„èŠ‚ç‚¹æ³¨å†Œä»¤ç‰Œï¼šbin/elasticsearch-create-enrollment-token -s node</span></span><br><span class=\"line\">â€¢ Copy the following enrollment token and start new Elasticsearch nodes with `bin/elasticsearch --enrollment-token &lt;token&gt;` (valid <span class=\"keyword\">for</span> the next 30 minutes):</span><br><span class=\"line\">  eyJ2ZXIiOiI4LjE0LjAiLCJhZHIiOlsiMTAuMjUwLjAuMjM5OjkyMDAiXSwiZmdyIjoiM2YxNDFjMTZkZmM2ZTE2NTg5NGJjMTY3MjA4NGIyMjBkY2RkMjJmZmUwMjExNmQ1MWFjMTgwMDNjZmFhNWExZCIsImtleSI6ImF4WFBzcFVCTVVmc1d5aUJnbjFtOkFEallPdnpzUzh1MGJqOFpfVFE4a3cifQ==</span><br><span class=\"line\"><span class=\"comment\"># å¦‚æœä½ åœ¨ Docker ä¸­è¿è¡Œ Elasticsearchï¼Œå¯ä»¥ä½¿ç”¨ docker run -e &quot;ENROLLMENT_TOKEN=&lt;token&gt;&quot; docker.elastic.co/elasticsearch/elasticsearch:8.17.3 å‘½ä»¤å¯åŠ¨æ–°èŠ‚ç‚¹ã€‚</span></span><br><span class=\"line\">  If you<span class=\"string\">&#x27;re running in Docker, copy the enrollment token and run:</span></span><br><span class=\"line\"><span class=\"string\">  `docker run -e &quot;ENROLLMENT_TOKEN=&lt;token&gt;&quot; docker.elastic.co/elasticsearch/elasticsearch:8.17.3`</span></span><br><span class=\"line\"><span class=\"string\">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç™»å½•ç”¨æˆ·ä¸º<code>elastic</code>[å…¶è§’è‰²ä¸ºè¶…çº§ç”¨æˆ·]ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ—¥å¿—æŸ¥çœ‹åˆå§‹çš„å¯†ç ï¼Œä¹Ÿå¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤é‡ç½®å¯†ç </p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># é‡ç½®å¯†ç ï¼Œå¯†ç è‡ªåŠ¨ç”Ÿæˆ</span></span><br><span class=\"line\">bin/elasticsearch-reset-password -u elastic</span><br><span class=\"line\"><span class=\"comment\"># é‡ç½®å¯†ç ï¼Œè‡ªå·±è¾“å…¥è¦è®¾ç½®çš„å¯†ç ï¼Œæ¯”å¦‚æˆ‘è¿™é‡Œè¿™æ˜¯ä¸º 123456</span></span><br><span class=\"line\">bin/elasticsearch-reset-password -u elastic -i</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># é€šè¿‡curlé‡ç½®å¯†ç </span></span><br><span class=\"line\">curl -X PUT -u elastic:old_password -k <span class=\"string\">&#x27;https://127.0.0.1:9200/_security/user/elastic/_password&#x27;</span> \\</span><br><span class=\"line\">  -H <span class=\"string\">&#x27;Content-Type: application/json&#x27;</span> \\</span><br><span class=\"line\">  -d <span class=\"string\">&#x27;&#123;</span></span><br><span class=\"line\"><span class=\"string\">      &quot;password&quot;: &quot;new_password&quot;</span></span><br><span class=\"line\"><span class=\"string\">    &#125;&#x27;</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>curl è®¿é—®ESæœåŠ¡</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># -k å¿½ç•¥è¯ä¹¦æ ¡éªŒ</span></span><br><span class=\"line\">curl -u elastic:123456 -k https://127.0.0.1:9200</span><br><span class=\"line\"><span class=\"comment\"># æˆ–è€… å°†è®¤è¯ä¿¡æ¯é€šè¿‡headerä¼ é€’ï¼Œelastic:123456 é€šè¿‡base64åŠ å¯†</span></span><br><span class=\"line\">curl -k https://127.0.0.1:9200 -H <span class=\"string\">&#x27;Authorization: Basic ZWxhc3RpYzoxMjM0NTY=&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"># ä¹Ÿå¯ä»¥é€šè¿‡è¯ä¹¦è®¿é—®httpsæœåŠ¡ï¼Œè¿™ä¸ªè¯ä¹¦å°±æ˜¯ESåœ¨å¼€å¯å®‰å…¨è®¤è¯å¯åŠ¨æ—¶è‡ªåŠ¨ç”Ÿæˆçš„</span></span><br><span class=\"line\">curl -u elastic:123456 --cacert /usr/local/elasticsearch/elasticsearch-8.17.3/config/certs/http_ca.crt  https://127.0.0.1:9200</span><br><span class=\"line\"><span class=\"comment\"># è¾“å‡ºå¦‚ä¸‹ï¼š</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">&quot;name&quot;</span> : <span class=\"string\">&quot;node-1&quot;</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;cluster_name&quot;</span> : <span class=\"string\">&quot;test-elk&quot;</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;cluster_uuid&quot;</span> : <span class=\"string\">&quot;RykjCSPnSCi4Hsi37uziWw&quot;</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;version&quot;</span> : &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;number&quot;</span> : <span class=\"string\">&quot;8.17.3&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;build_flavor&quot;</span> : <span class=\"string\">&quot;default&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;build_type&quot;</span> : <span class=\"string\">&quot;tar&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;build_hash&quot;</span> : <span class=\"string\">&quot;a091390de485bd4b127884f7e565c0cad59b10d2&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;build_date&quot;</span> : <span class=\"string\">&quot;2025-02-28T10:07:26.089129809Z&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;build_snapshot&quot;</span> : <span class=\"literal\">false</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;lucene_version&quot;</span> : <span class=\"string\">&quot;9.12.0&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;minimum_wire_compatibility_version&quot;</span> : <span class=\"string\">&quot;7.17.0&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;minimum_index_compatibility_version&quot;</span> : <span class=\"string\">&quot;7.0.0&quot;</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"string\">&quot;tagline&quot;</span> : <span class=\"string\">&quot;You Know, for Search&quot;</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<div class=\"tips\">\n<p><em><strong>å¼€å‘æ¨¡å¼å’Œç”Ÿäº§æ¨¡å¼</strong></em></p>\n<ul class=\"lvl-1\">\n<li class=\"lvl-2\">å¼€å‘æ¨¡å¼ï¼šå¦‚æœç”¨æˆ·åªæ˜¯å‡ºäºå­¦ä¹ ç›®çš„ï¼Œå¯ä»¥åœ¨é…ç½®æ–‡ä»¶ä¸­æ·»åŠ  <code>discovery.type=single-node</code> ï¼Œè¡¨ç¤ºå•èŠ‚ç‚¹æ¨¡å¼ï¼Œå³å¼€å‘æ¨¡å¼ã€‚æ­¤æ¨¡å¼å¯ä»¥ç»•è¿‡å¼•å¯¼æ£€æŸ¥ã€‚</li>\n<li class=\"lvl-2\">ç”Ÿäº§æ¨¡å¼ï¼šå½“ç”¨æˆ·é…ç½®äº†æœ‰å…³é›†ç¾¤çš„ç›¸å…³é…ç½®é¡¹æ—¶å°±ä¼šè§¦å‘ç”Ÿäº§æ¨¡å¼ï¼Œåœ¨ç”Ÿäº§æ¨¡å¼ä¸‹ï¼ŒæœåŠ¡å¯åŠ¨ä¼šè§¦å‘ESçš„å¼•å¯¼æ£€æŸ¥æˆ–è€…å«å¯åŠ¨æ£€æŸ¥ï¼ˆbootstrap checksï¼‰ï¼Œå¼•å¯¼æ£€æŸ¥ååˆ†ä¸¥æ ¼ï¼Œå³æŸäº›æ£€æŸ¥é¡¹ä¸é€šè¿‡åˆ™ESæœåŠ¡å°†æ— æ³•å¯åŠ¨ã€‚\n<ul class=\"lvl-3\">\n<li class=\"lvl-4\">å¼•å¯¼æ£€æŸ¥ï¼šåœ¨æœåŠ¡å¯åŠ¨ä¹‹å‰å¯¹ä¸€äº›é‡è¦çš„é…ç½®é¡¹è¿›è¡Œæ£€æŸ¥ï¼Œæ£€æŸ¥å…¶é…ç½®å€¼æ˜¯å¦æ˜¯åˆç†çš„ã€‚å¼•å¯¼æ£€æŸ¥åŒ…æ‹¬å¯¹JVMå¤§å°ã€å†…å­˜é”ã€è™šæ‹Ÿå†…å­˜ã€æœ€å¤§çº¿ç¨‹æ•°ã€é›†ç¾¤å‘ç°ç›¸å…³é…ç½®ç­‰ç›¸å…³çš„æ£€æŸ¥ï¼Œå¦‚æœæŸä¸€é¡¹æˆ–è€…å‡ é¡¹çš„é…ç½®ä¸åˆç†ï¼ŒESä¼šæ‹’ç»å¯åŠ¨æœåŠ¡ï¼Œå¹¶ä¸”åœ¨å¼€å‘æ¨¡å¼ä¸‹çš„æŸäº›è­¦å‘Šä¿¡æ¯ä¼šå‡çº§æˆé”™è¯¯ä¿¡æ¯è¾“å‡ºã€‚å¼•å¯¼æ£€æŸ¥ååˆ†ä¸¥æ ¼ï¼Œä¹‹æ‰€ä»¥å®å¯æ‹’ç»æœåŠ¡ä¹Ÿè¦é˜»æ­¢ç”¨æˆ·å¯åŠ¨æœåŠ¡æ˜¯ä¸ºäº†é˜²æ­¢ç”¨æˆ·åœ¨å¯¹ESçš„åŸºæœ¬ä½¿ç”¨ä¸äº†è§£çš„å‰æä¸‹å¯åŠ¨æœåŠ¡è€Œå¯¼è‡´çš„åæœŸæ€§èƒ½é—®é¢˜æ— æ³•è§£å†³æˆ–è€…è§£å†³èµ·æ¥å¾ˆéº»çƒ¦ã€‚å› ä¸ºä¸€æ—¦æœåŠ¡ä»¥æŸç§ä¸åˆç†çš„é…ç½®å¯åŠ¨ï¼Œæ—¶é—´ä¹…äº†ä¹‹åå¯èƒ½ä¼šäº§ç”Ÿè¾ƒå¤§çš„æ€§èƒ½é—®é¢˜ï¼Œä½†æ­¤æ—¶é›†ç¾¤å·²ç»å˜å¾—éš¾ä»¥ç»´æŠ¤å’Œæ‰©å±•ï¼ŒESä¸ºäº†é¿å…è¿™ç§æƒ…å†µè€Œåšå‡ºäº†å¼•å¯¼æ£€æŸ¥çš„è®¾ç½®ï¼Œæœ¬æ¥åœ¨å¼€å‘æ¨¡å¼ä¸‹ä¸ºè­¦å‘Šçš„å¯åŠ¨æ—¥å¿—ä¼šå‡çº§ä¸ºæŠ¥é”™ï¼ˆErrorï¼‰ã€‚è¿™ç§è®¾å®šè™½ç„¶å¢åŠ äº†ç”¨æˆ·çš„ä½¿ç”¨é—¨æ§›ï¼Œä½†æ˜¯é¿å…äº†æ—¥åäº§ç”Ÿæ›´å¤§çš„é—®é¢˜ã€‚</li>\n</ul>\n</li>\n</ul>\n</div>\n<h2 id=\"ESæµè§ˆå™¨æ’ä»¶\">ESæµè§ˆå™¨æ’ä»¶</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><a href=\"https://elasticvue.com/\">Elasticvue</a> : chrome/edge æ’ä»¶ï¼Œç”¨äºåœ¨æµè§ˆå™¨ä¸­æŸ¥çœ‹ESé›†ç¾¤ä¿¡æ¯ï¼ŒåŠŸèƒ½éå¸¸å¼ºå¤§</p>\n</li>\n</ul>\n<h2 id=\"ESè‡ªå¯åŠ¨è„šæœ¬\">ESè‡ªå¯åŠ¨è„šæœ¬</h2>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åˆ›å»ºæœåŠ¡æ–‡ä»¶</span></span><br><span class=\"line\">$ vim /usr/lib/systemd/system/es.service</span><br><span class=\"line\">[Unit]</span><br><span class=\"line\">Description=elasticsearch</span><br><span class=\"line\">Documentation=https://www.elastic.co</span><br><span class=\"line\">After=network.target</span><br><span class=\"line\"></span><br><span class=\"line\">[Service]</span><br><span class=\"line\">Type=simple</span><br><span class=\"line\">PrivateTmp=<span class=\"literal\">true</span></span><br><span class=\"line\"><span class=\"comment\"># æŒ‡å®šESç”¨æˆ·</span></span><br><span class=\"line\">User=elastic</span><br><span class=\"line\">Group=elastic</span><br><span class=\"line\">LimitNOFILE=100000</span><br><span class=\"line\">LimitNPROC=100000</span><br><span class=\"line\">Restart=<span class=\"built_in\">yes</span></span><br><span class=\"line\"><span class=\"comment\"># å¯åŠ¨å‘½ä»¤</span></span><br><span class=\"line\">ExecStart=/usr/local/elasticsearch/elasticsearch-8.17.3/bin/elasticsearch</span><br><span class=\"line\">ExecRestart=/bin/kill -s HUP <span class=\"variable\">$MAINPID</span></span><br><span class=\"line\">ExecStop=/bin/kill -s QUIT <span class=\"variable\">$MAINPID</span></span><br><span class=\"line\"></span><br><span class=\"line\">[Install]</span><br><span class=\"line\">WantedBy=multi-user.target</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># é‡æ–°åŠ è½½</span></span><br><span class=\"line\">$ systemctl daemon-reload</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å¯åŠ¨</span></span><br><span class=\"line\">$ systemctl start es</span><br><span class=\"line\"><span class=\"comment\"># åœæ­¢</span></span><br><span class=\"line\">$ systemctl stop es</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹çŠ¶æ€</span></span><br><span class=\"line\">$ systemctl status es</span><br><span class=\"line\"><span class=\"comment\"># è®¾ç½®å¼€æœºå¯åŠ¨</span></span><br><span class=\"line\">$ systemctl <span class=\"built_in\">enable</span> es</span><br></pre></td></tr></table></figure>\n<h2 id=\"é€šè¿‡ApiKeyè®¿é—®ES\">é€šè¿‡ApiKeyè®¿é—®ES</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å…³äºApiKeyçš„è¯¦ç»†ä»‹ç»ï¼Œå¯ä»¥å‚è€ƒ<a href=\"https://www.elastic.co/guide/en/elasticsearch/reference/current/security-api-create-api-key.html\">å®˜æ–¹æ–‡æ¡£</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>åˆ›å»ºApiKey</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -k <span class=\"string\">&#x27;https://127.0.0.1:9200/_security/api_key?pretty&#x27;</span> \\</span><br><span class=\"line\">-u elastic:123456 \\</span><br><span class=\"line\">--header <span class=\"string\">&#x27;Content-Type: application/json&#x27;</span> \\</span><br><span class=\"line\">--data <span class=\"string\">&#x27;&#123;</span></span><br><span class=\"line\"><span class=\"string\">    &quot;name&quot;: &quot;elastic_api_key&quot;,</span></span><br><span class=\"line\"><span class=\"string\">    &quot;expiration&quot;: &quot;1d&quot;</span></span><br><span class=\"line\"><span class=\"string\">&#125;&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"># è¯·æ±‚å‚æ•°è¯´æ˜ï¼š</span></span><br><span class=\"line\"><span class=\"comment\"># name: ApiKeyçš„åç§°</span></span><br><span class=\"line\"><span class=\"comment\"># expiration: ApiKeyçš„è¿‡æœŸæ—¶é—´ï¼Œè¿™é‡Œè®¾ç½®ä¸ºä¸€å¤©ï¼Œå¦‚æœä¸è®¾ç½®ï¼Œåˆ™æ°¸ä¸è¿‡æœŸ</span></span><br><span class=\"line\"><span class=\"comment\"># è¯·æ±‚å‚æ•°ä¸­è¿˜æœ‰ä¸€ä¸ªé‡è¦çš„å‚æ•° `role_descriptors`ï¼Œå…¶å«ä¹‰æ˜¯ï¼ŒæŒ‡å®šApiKeyæ‰€æ‹¥æœ‰çš„æƒé™ï¼Œå³è§’è‰²ã€‚å¦‚æœä¸è¿›è¡Œè®¾ç½®ï¼Œåˆ™é»˜è®¤ä½¿ç”¨å½“å‰è®¤è¯ç”¨æˆ·çš„çš„è§’è‰²</span></span><br><span class=\"line\"><span class=\"comment\"># metadata: ApiKeyçš„å…ƒæ•°æ®ï¼Œå³è‡ªå®šä¹‰çš„é”®å€¼å¯¹ï¼Œè¿™é‡Œå¯ä»¥ä¸è®¾ç½®</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># è¾“å‡ºï¼š</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">&quot;id&quot;</span>:<span class=\"string\">&quot;70It0ZUBrL2GcOxX0d1L&quot;</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;name&quot;</span>:<span class=\"string\">&quot;elastic_api_key&quot;</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;expiration&quot;</span>:1743057595723,</span><br><span class=\"line\">  <span class=\"string\">&quot;api_key&quot;</span>:<span class=\"string\">&quot;s85lqVkmQISkBlgXCTJmDQ&quot;</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;encoded&quot;</span>:<span class=\"string\">&quot;NzBJdDBaVUJyTDJHY094WDBkMUw6czg1bHFWa21RSVNrQmxnWENUSm1EUQ==&quot;</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\"># è¾“å‡ºå‚æ•°è¯´æ˜ï¼š</span></span><br><span class=\"line\"><span class=\"comment\"># id: ApiKeyçš„id</span></span><br><span class=\"line\"><span class=\"comment\"># name: ApiKeyçš„åç§°</span></span><br><span class=\"line\"><span class=\"comment\"># expiration: ApiKeyçš„è¿‡æœŸæ—¶é—´ï¼Œå•ä½ä¸ºæ¯«ç§’</span></span><br><span class=\"line\"><span class=\"comment\"># api_key: ApiKeyçš„å¯†é’¥</span></span><br><span class=\"line\"><span class=\"comment\"># encoded: å¯¹ `id:api_key` è¿›è¡Œbase64ç¼–ç ï¼Œå³å¯å¾—åˆ° `encoded`</span></span><br><span class=\"line\">    <span class=\"comment\"># echo -n &#x27;70It0ZUBrL2GcOxX0d1L:s85lqVkmQISkBlgXCTJmDQ&#x27; | base64</span></span><br><span class=\"line\">    <span class=\"comment\"># è¾“å‡ºï¼š</span></span><br><span class=\"line\">    <span class=\"comment\"># NzBJdDBaVUJyTDJHY094WDBkMUw6czg1bHFWa21RSVNrQmxnWENUSm1EUQ==</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä½¿ç”¨ApiKeyè®¿é—®ES</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># è¿™é‡Œçš„ApiKeyï¼Œå°±æ˜¯ä¸Šé¢è¾“å‡ºçš„encoded</span></span><br><span class=\"line\">curl -k <span class=\"string\">&#x27;https://127.0.0.1:9200?pretty&#x27;</span> \\</span><br><span class=\"line\">-H <span class=\"string\">&#x27;Authorization: ApiKey NzBJdDBaVUJyTDJHY094WDBkMUw6czg1bHFWa21RSVNrQmxnWENUSm1EUQ==&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"># è¾“å‡º</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">&quot;name&quot;</span> : <span class=\"string\">&quot;node-1&quot;</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;cluster_name&quot;</span> : <span class=\"string\">&quot;test-elk&quot;</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;cluster_uuid&quot;</span> : <span class=\"string\">&quot;RykjCSPnSCi4Hsi37uziWw&quot;</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;version&quot;</span> : &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;number&quot;</span> : <span class=\"string\">&quot;8.17.3&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;build_flavor&quot;</span> : <span class=\"string\">&quot;default&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;build_type&quot;</span> : <span class=\"string\">&quot;tar&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;build_hash&quot;</span> : <span class=\"string\">&quot;a091390de485bd4b127884f7e565c0cad59b10d2&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;build_date&quot;</span> : <span class=\"string\">&quot;2025-02-28T10:07:26.089129809Z&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;build_snapshot&quot;</span> : <span class=\"literal\">false</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;lucene_version&quot;</span> : <span class=\"string\">&quot;9.12.0&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;minimum_wire_compatibility_version&quot;</span> : <span class=\"string\">&quot;7.17.0&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;minimum_index_compatibility_version&quot;</span> : <span class=\"string\">&quot;7.0.0&quot;</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"string\">&quot;tagline&quot;</span> : <span class=\"string\">&quot;You Know, for Search&quot;</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æŸ¥çœ‹ApiKeyä¿¡æ¯ï¼Œå‚è€ƒ<a href=\"https://www.elastic.co/guide/en/elasticsearch/reference/current/security-api-get-api-key.html\">å®˜æ–¹æ–‡æ¡£</a></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/_security/api_key?name=elastic_api_key&amp;pretty&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"># è¯·æ±‚å‚æ•°è¯´æ˜ï¼š</span></span><br><span class=\"line\"><span class=\"comment\"># name: ApiKeyçš„åç§°ï¼Œä¸åŒçš„ApiKeyå¯ä»¥æ‹¥æœ‰ç›¸åŒçš„åç§°ï¼Œä½†idä¸åŒï¼Œæ‰€ä»¥é€šè¿‡nameè¿›è¡ŒæŸ¥è¯¢å¯èƒ½ä¼šè¿”å›å¤šä¸ªç»“æœ</span></span><br><span class=\"line\"><span class=\"comment\"># æˆ–è€… id: ApiKeyçš„idï¼Œå»ºè®®é€šè¿‡idè¿›è¡ŒæŸ¥è¯¢ï¼Œidå”¯ä¸€ï¼Œæ‰€ä»¥é€šè¿‡idè¿›è¡ŒæŸ¥è¯¢åªä¼šè¿”å›ä¸€ä¸ªç»“æœ</span></span><br><span class=\"line\"><span class=\"comment\"># username: æŸ¥è¯¢æŒ‡å®šç”¨æˆ·çš„ApiKey</span></span><br><span class=\"line\"><span class=\"comment\"># owner: æ˜¯å¦åªæŸ¥è¯¢å½“å‰è®¤è¯ç”¨æˆ·åä¸‹çš„ApiKeyï¼Œé»˜è®¤ä¸ºfalseï¼Œä¸ºfalseæ—¶å¿…é¡»è‡³å°‘è®¾ç½®name\\ids\\usernameä¸­çš„ä¸€ä¸ªå‚æ•°</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ä¸åŠ ä»»ä½•å‚æ•°è¿›è¡ŒæŸ¥è¯¢ï¼Œåˆ™è¿”å›æ‰€æœ‰ApiKeyçš„ä¿¡æ¯</span></span><br><span class=\"line\">curl -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/_security/api_key?pretty&#x27;</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ›´æ–°ApiKeyï¼Œå‚è€ƒ<a href=\"https://www.elastic.co/guide/en/elasticsearch/reference/current/security-api-update-api-key.html\">å®˜æ–¹æ–‡æ¡£</a></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -u elastic:123456 -X PUT -k <span class=\"string\">&#x27;https://127.0.0.1:9200/_security/api_key/&#123;ApiKeyId&#125;?pretty&#x27;</span> \\</span><br><span class=\"line\">--header <span class=\"string\">&#x27;Content-Type: application/json&#x27;</span> \\</span><br><span class=\"line\">--data <span class=\"string\">&#x27;&#123;</span></span><br><span class=\"line\"><span class=\"string\">    &quot;expiration&quot;: &quot;1h&quot;,</span></span><br><span class=\"line\"><span class=\"string\">    &quot;role_descriptors&quot;: &#123;</span></span><br><span class=\"line\"><span class=\"string\">        &quot;role-a&quot;: &#123;</span></span><br><span class=\"line\"><span class=\"string\">        &quot;indices&quot;: [</span></span><br><span class=\"line\"><span class=\"string\">            &#123;</span></span><br><span class=\"line\"><span class=\"string\">                &quot;names&quot;: [&quot;*&quot;],</span></span><br><span class=\"line\"><span class=\"string\">                &quot;privileges&quot;: [&quot;write&quot;]</span></span><br><span class=\"line\"><span class=\"string\">            &#125;</span></span><br><span class=\"line\"><span class=\"string\">        ]</span></span><br><span class=\"line\"><span class=\"string\">        &#125;</span></span><br><span class=\"line\"><span class=\"string\">    &#125;,</span></span><br><span class=\"line\"><span class=\"string\">    &quot;metadata&quot;: &#123;</span></span><br><span class=\"line\"><span class=\"string\">        &quot;environment&quot;: &#123;</span></span><br><span class=\"line\"><span class=\"string\">            &quot;level&quot;: 2,</span></span><br><span class=\"line\"><span class=\"string\">            &quot;trusted&quot;: true,</span></span><br><span class=\"line\"><span class=\"string\">            &quot;tags&quot;: [&quot;production&quot;]</span></span><br><span class=\"line\"><span class=\"string\">        &#125;</span></span><br><span class=\"line\"><span class=\"string\">    &#125;</span></span><br><span class=\"line\"><span class=\"string\">&#125;&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å¯ä»¥æ›´æ–°çš„å‚æ•°æœ‰ï¼š</span></span><br><span class=\"line\"><span class=\"comment\"># expiration: ApiKeyçš„è¿‡æœŸæ—¶é—´ï¼Œå¦‚æœå·²ç»è®¾ç½®è¿‡expirationï¼Œæ­¤æ—¶å¸Œæœ›ä½¿å…¶æ°¸ä¸è¿‡æœŸï¼Œåˆ™åªèƒ½å°†å…¶è®¾ç½®ä¸ºä¸€ä¸ªæ¯”è¾ƒå¤§çš„æ—¶é—´ï¼Œæ¯”å¦‚ &quot;expiration&quot;: &quot;100y&quot;</span></span><br><span class=\"line\"><span class=\"comment\"># role_descriptors: ApiKeyæ‰€æ‹¥æœ‰çš„è§’è‰²ï¼ŒåŸå…ˆè®¾ç½®äº†role_descriptorsï¼Œæ›´æ–°æ—¶å¸Œæœ›å…¶ä½¿ç”¨è®¤è¯ç”¨æˆ·çš„è§’è‰²ï¼Œåˆ™æ­¤æ—¶å¯ä»¥å°†å…¶è®¾ç½®ä¸º &quot;role_descriptors&quot;: &#123;&#125;</span></span><br><span class=\"line\"><span class=\"comment\"># metadata: ApiKeyçš„å…ƒæ•°æ®ï¼ŒåŸå…ˆè®¾ç½®äº† metadata ï¼Œæ›´æ–°æ—¶å¸Œæœ›å»é™¤æ‰€æœ‰ metadata ä¿¡æ¯ï¼Œåˆ™æ­¤æ—¶å¯ä»¥å°†å…¶è®¾ç½®ä¸º &quot;metadata&quot;: &#123;&#125;</span></span><br><span class=\"line\"><span class=\"comment\"># æ³¨æ„ï¼šä¸‰ä¸ªå‚æ•°å¯ä»¥åªæ›´æ–°å…¶ä¸­ä»»ä½•ä¸€ä¸ªï¼Œæ›´æ–°å“ªä¸ªå°±åªæ›¿æ¢å“ªä¸ªï¼Œæ²¡æœ‰è¢«æ›´æ–°çš„å‚æ•°ä¸ä¼šå—åˆ°ä¿®æ”¹ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥åŒæ—¶æ›´æ–°å…¨éƒ¨</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç½®ApiKeyæ— æ•ˆï¼Œå‚è€ƒ<a href=\"https://www.elastic.co/guide/en/elasticsearch/reference/current/security-api-invalidate-api-key.html\">å®˜æ–¹æ–‡æ¡£</a>ï¼Œå®˜æ–¹æ²¡æœ‰æä¾›åˆ é™¤ApiKeyçš„æ¥å£ï¼Œåªæœ‰ç½®æ— æ•ˆçš„æ¥å£</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -u elastic:123456 -X DELETE -k <span class=\"string\">&#x27;https://127.0.0.1:9200/_security/api_key?pretty&#x27;</span> \\</span><br><span class=\"line\">--header <span class=\"string\">&#x27;Content-Type: application/json&#x27;</span> \\</span><br><span class=\"line\">--data <span class=\"string\">&#x27;&#123;</span></span><br><span class=\"line\"><span class=\"string\">    &quot;name&quot;: &quot;elastic_api_key&quot;</span></span><br><span class=\"line\"><span class=\"string\">&#125;&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"># è¯·æ±‚å‚æ•°è¯´æ˜ï¼š</span></span><br><span class=\"line\"><span class=\"comment\"># name: ApiKeyçš„åç§°ï¼Œä¼š</span></span><br><span class=\"line\"><span class=\"comment\"># æˆ–è€…ä½¿ç”¨  &quot;ids&quot; : [ &quot;70It0ZUBrL2GcOxX0d1L&quot; ] ï¼Œé€šè¿‡idè¿›è¡Œåˆ é™¤ï¼Œæ­¤æ—¶å¯ä»¥ä¸€æ¬¡åˆ é™¤å¤šä¸ªApiKey</span></span><br><span class=\"line\"><span class=\"comment\"># username: åˆ é™¤æŒ‡å®šç”¨æˆ·çš„ApiKey</span></span><br><span class=\"line\"><span class=\"comment\"># owner: æ˜¯å¦åªåˆ é™¤å½“å‰è®¤è¯ç”¨æˆ·åä¸‹çš„ApiKeyï¼Œé»˜è®¤ä¸ºfalseï¼Œä¸ºfalseæ—¶å¿…é¡»è‡³å°‘è®¾ç½®name\\ids\\usernameä¸­çš„ä¸€ä¸ªå‚æ•°</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># è¾“å‡ºï¼š</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">&quot;invalidated_api_keys&quot;</span>:[</span><br><span class=\"line\">    <span class=\"string\">&quot;70It0ZUBrL2GcOxX0d1L&quot;</span></span><br><span class=\"line\">  ],</span><br><span class=\"line\">  <span class=\"string\">&quot;previously_invalidated_api_keys&quot;</span>:[ ],</span><br><span class=\"line\">  <span class=\"string\">&quot;error_count&quot;</span>:0</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\"># è¾“å‡ºå‚æ•°è¯´æ˜ï¼š</span></span><br><span class=\"line\"><span class=\"comment\"># invalidated_api_keys: è¢«åˆ é™¤çš„ApiKeyçš„idåˆ—è¡¨</span></span><br><span class=\"line\"><span class=\"comment\"># previously_invalidated_api_keys: ä¹‹å‰è¢«åˆ é™¤çš„ApiKeyçš„idåˆ—è¡¨</span></span><br><span class=\"line\"><span class=\"comment\"># error_count: é”™è¯¯æ•°é‡ï¼Œå¦‚æœä¸º0ï¼Œåˆ™è¡¨ç¤ºæˆåŠŸ</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä½¿ç”¨ApiKeyçš„ä¼˜ç¼ºç‚¹</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-6\">ä¼˜ç‚¹</li>\n</ul>\n  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">å®‰å…¨æ€§:</span><br><span class=\"line\">    ç»†ç²’åº¦æ§åˆ¶: API Key å¯ä»¥ä¸ç‰¹å®šçš„è§’è‰²æè¿°ç¬¦å…³è”ï¼Œå…è®¸éå¸¸ç»†åŒ–çš„æƒé™æ§åˆ¶ã€‚è¿™æœ‰åŠ©äºéµå¾ªæœ€å°æƒé™åŸåˆ™ï¼Œåªæˆäºˆå¿…è¦çš„è®¿é—®æƒé™ã€‚</span><br><span class=\"line\">    æ—¶é—´é™åˆ¶: å¯ä»¥ä¸º API Key è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œç¡®ä¿å¯†é’¥ä¸ä¼šæ°¸è¿œæœ‰æ•ˆï¼Œå‡å°‘é•¿æœŸæ³„éœ²çš„é£é™©ã€‚</span><br><span class=\"line\">    å¯æ’¤é”€æ€§: å¦‚æœæ€€ç–‘æŸä¸ª API Key è¢«æ³„éœ²æˆ–ä¸å†éœ€è¦ï¼Œå¯ä»¥éšæ—¶æ’¤é”€è¯¥å¯†é’¥ï¼Œæé«˜å®‰å…¨æ€§ã€‚</span><br><span class=\"line\">æ–¹ä¾¿æ€§:</span><br><span class=\"line\">    æ˜“äºç”Ÿæˆå’Œç®¡ç†: åˆ›å»ºå’Œç®¡ç† API Key çš„è¿‡ç¨‹é€šå¸¸å¾ˆç®€å•ï¼Œå¯ä»¥é€šè¿‡ REST API æˆ– Kibana ç•Œé¢è¿›è¡Œã€‚</span><br><span class=\"line\">    æ— éœ€ç”¨æˆ·äº¤äº’: ä¸€æ—¦ç”Ÿæˆï¼ŒAPI Key å¯ä»¥ç›´æ¥ç”¨äºè‡ªåŠ¨åŒ–è„šæœ¬æˆ–åº”ç”¨ç¨‹åºï¼Œæ— éœ€ç”¨æˆ·æ‰‹åŠ¨ç™»å½•æˆ–æä¾›å‡­æ®ã€‚</span><br><span class=\"line\">å®¡è®¡å’Œç›‘æ§:</span><br><span class=\"line\">    è·Ÿè¸ªä½¿ç”¨æƒ…å†µ: é€šè¿‡æ—¥å¿—è®°å½•å’Œå®¡è®¡åŠŸèƒ½ï¼Œå¯ä»¥è·Ÿè¸ªå“ªä¸ª API Key è¿›è¡Œäº†å“ªäº›æ“ä½œï¼Œä¾¿äºå®‰å…¨å®¡è®¡å’Œé—®é¢˜æ’æŸ¥ã€‚</span><br><span class=\"line\">    æ´»åŠ¨ç›‘æ§: å¯ä»¥ç›‘æ§ API Key çš„æ´»åŠ¨ï¼ŒåŠæ—¶å‘ç°å¼‚å¸¸è¡Œä¸ºï¼Œå¹¶é‡‡å–ç›¸åº”çš„æªæ–½ã€‚</span><br><span class=\"line\">çµæ´»æ€§:</span><br><span class=\"line\">    å¤šç§ç”¨é€”: API Key å¯ä»¥ç”¨äºå„ç§ç”¨é€”ï¼Œå¦‚åº”ç”¨ç¨‹åºé›†æˆã€æ•°æ®å¯¼å…¥å¯¼å‡ºã€ç›‘æ§å·¥å…·ç­‰ã€‚</span><br><span class=\"line\">    å¤šç¯å¢ƒæ”¯æŒ: å¯ä»¥ä¸ºä¸åŒçš„ç¯å¢ƒï¼ˆå¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ï¼‰ç”Ÿæˆç‹¬ç«‹çš„ API Keyï¼Œç¡®ä¿å„ç¯å¢ƒä¹‹é—´çš„éš”ç¦»ã€‚</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-2\">\n<li class=\"lvl-6\">ç¼ºç‚¹</li>\n</ul>\n  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">å®‰å…¨æ€§é£é™©:</span><br><span class=\"line\">    å¯†é’¥å­˜å‚¨: API Key éœ€è¦å®‰å…¨åœ°å­˜å‚¨å’Œä¼ è¾“ï¼Œå¦‚æœå¯†é’¥è¢«æ³„éœ²ï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨å®ƒè¿›è¡Œæœªæˆæƒçš„æ“ä½œã€‚</span><br><span class=\"line\">    é™æ€å‡­è¯: ä¸åŠ¨æ€çš„èº«ä»½éªŒè¯æœºåˆ¶ï¼ˆå¦‚ OAuth ä»¤ç‰Œï¼‰ç›¸æ¯”ï¼ŒAPI Key æ˜¯é™æ€çš„ï¼Œä¸€æ—¦æ³„éœ²å¯èƒ½ä¼šå¯¼è‡´é•¿æœŸçš„å®‰å…¨é£é™©ã€‚</span><br><span class=\"line\">ç®¡ç†å¤æ‚æ€§:</span><br><span class=\"line\">    å¯†é’¥ç®¡ç†: éšç€æ—¶é—´å’Œä½¿ç”¨è§„æ¨¡çš„å¢é•¿ï¼Œç®¡ç†å’Œç»´æŠ¤å¤§é‡ API Key å¯èƒ½ä¼šå˜å¾—å¤æ‚ã€‚éœ€è¦å®šæœŸæ›´æ–°å’Œæ’¤é”€è€æ—§çš„å¯†é’¥ã€‚</span><br><span class=\"line\">    è§’è‰²åˆ†é…: ç»†ç²’åº¦çš„æƒé™æ§åˆ¶è™½ç„¶æä¾›äº†å®‰å…¨æ€§ï¼Œä½†ä¹Ÿå¢åŠ äº†é…ç½®å’Œç®¡ç†çš„å¤æ‚æ€§ã€‚</span><br><span class=\"line\">ç¼ºä¹ç”¨æˆ·ä¸Šä¸‹æ–‡:</span><br><span class=\"line\">    åŒ¿åæ€§: API Key é€šå¸¸æ²¡æœ‰ç”¨æˆ·ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œä¸åƒåŸºäºç”¨æˆ·çš„è®¤è¯æœºåˆ¶ï¼ˆå¦‚ Basic Auth æˆ– OAuthï¼‰ï¼Œè¿™å¯èƒ½ä¸åˆ©äºæŸäº›ä¾èµ–ç”¨æˆ·èº«ä»½çš„åŠŸèƒ½ã€‚</span><br><span class=\"line\">ä¾èµ–å®¢æˆ·ç«¯é…ç½®:</span><br><span class=\"line\">    æ˜“é”™æ€§: å¦‚æœå®¢æˆ·ç«¯é…ç½®ä¸å½“ï¼Œå¦‚é”™è¯¯åœ°å¤„ç†æˆ–æš´éœ² API Keyï¼Œå¯èƒ½ä¼šå¯¼è‡´å®‰å…¨æ¼æ´ã€‚</span><br><span class=\"line\">    æ›´æ–°æŒ‘æˆ˜: æ›´æ–° API Key åï¼Œæ‰€æœ‰ä½¿ç”¨è¯¥å¯†é’¥çš„å®¢æˆ·ç«¯éƒ½éœ€è¦åŒæ­¥æ›´æ–°ï¼Œè¿™åœ¨å¤§è§„æ¨¡ç¯å¢ƒä¸­å¯èƒ½æ˜¯ä¸€ä¸ªæŒ‘æˆ˜ã€‚</span><br></pre></td></tr></table></figure>\n</li>\n<li class=\"lvl-2\">\n<p>ä½•æ—¶ä½¿ç”¨ API Key</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-6\">å½“æ‚¨éœ€è¦ä¸ºè‡ªåŠ¨åŒ–è„šæœ¬ã€ç¬¬ä¸‰æ–¹æœåŠ¡æˆ–åº”ç”¨ç¨‹åºæä¾›è®¿é—®æƒé™æ—¶ã€‚</li>\n<li class=\"lvl-6\">å½“æ‚¨å¸Œæœ›å®ç°ç»†ç²’åº¦çš„æƒé™æ§åˆ¶å¹¶èƒ½å¤Ÿè½»æ¾ç®¡ç†å¯†é’¥çš„ç”Ÿå‘½å‘¨æœŸæ—¶ã€‚</li>\n<li class=\"lvl-6\">å½“ä¸éœ€è¦ç”¨æˆ·ä¸Šä¸‹æ–‡æˆ–å¤æ‚çš„ç”¨æˆ·ä¼šè¯ç®¡ç†æ—¶ã€‚</li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<p>ç¤ºä¾‹</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åˆ›å»ºApiKey</span></span><br><span class=\"line\">curl -X POST -k <span class=\"string\">&#x27;https://127.0.0.1:9200/_security/api_key?pretty&#x27;</span> \\</span><br><span class=\"line\">-u elastic:123456 \\</span><br><span class=\"line\">--header <span class=\"string\">&#x27;Content-Type: application/json&#x27;</span> \\</span><br><span class=\"line\">--data <span class=\"string\">&#x27;&#123;</span></span><br><span class=\"line\"><span class=\"string\">  &quot;name&quot;: &quot;my-api-key&quot;,</span></span><br><span class=\"line\"><span class=\"string\">  &quot;expiration&quot;: &quot;1d&quot;,</span></span><br><span class=\"line\"><span class=\"string\">  &quot;role_descriptors&quot;: &#123;</span></span><br><span class=\"line\"><span class=\"string\">    &quot;role-a&quot;: &#123;</span></span><br><span class=\"line\"><span class=\"string\">      &quot;cluster&quot;: [&quot;all&quot;],</span></span><br><span class=\"line\"><span class=\"string\">      &quot;indices&quot;: [</span></span><br><span class=\"line\"><span class=\"string\">        &#123;</span></span><br><span class=\"line\"><span class=\"string\">          &quot;names&quot;: [&quot;index-a*&quot;],</span></span><br><span class=\"line\"><span class=\"string\">          &quot;privileges&quot;: [&quot;read&quot;]</span></span><br><span class=\"line\"><span class=\"string\">        &#125;</span></span><br><span class=\"line\"><span class=\"string\">      ]</span></span><br><span class=\"line\"><span class=\"string\">    &#125;,</span></span><br><span class=\"line\"><span class=\"string\">    &quot;role-b&quot;: &#123;</span></span><br><span class=\"line\"><span class=\"string\">      &quot;cluster&quot;: [&quot;all&quot;],</span></span><br><span class=\"line\"><span class=\"string\">      &quot;indices&quot;: [</span></span><br><span class=\"line\"><span class=\"string\">        &#123;</span></span><br><span class=\"line\"><span class=\"string\">          &quot;names&quot;: [&quot;index-b*&quot;],</span></span><br><span class=\"line\"><span class=\"string\">          &quot;privileges&quot;: [&quot;all&quot;]</span></span><br><span class=\"line\"><span class=\"string\">        &#125;</span></span><br><span class=\"line\"><span class=\"string\">      ]</span></span><br><span class=\"line\"><span class=\"string\">    &#125;</span></span><br><span class=\"line\"><span class=\"string\">  &#125;,</span></span><br><span class=\"line\"><span class=\"string\">  &quot;metadata&quot;: &#123;</span></span><br><span class=\"line\"><span class=\"string\">    &quot;application&quot;: &quot;my-application&quot;,</span></span><br><span class=\"line\"><span class=\"string\">    &quot;environment&quot;: &#123;</span></span><br><span class=\"line\"><span class=\"string\">       &quot;level&quot;: 1,</span></span><br><span class=\"line\"><span class=\"string\">       &quot;trusted&quot;: true,</span></span><br><span class=\"line\"><span class=\"string\">       &quot;tags&quot;: [&quot;dev&quot;, &quot;staging&quot;]</span></span><br><span class=\"line\"><span class=\"string\">    &#125;</span></span><br><span class=\"line\"><span class=\"string\">  &#125;</span></span><br><span class=\"line\"><span class=\"string\">&#125;&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"># name: ApiKeyçš„åç§°</span></span><br><span class=\"line\"><span class=\"comment\"># expiration: ApiKeyçš„è¿‡æœŸæ—¶é—´ï¼Œæ”¯æŒçš„æ—¶é—´å•ä½ä¸ºï¼šsï¼ˆç§’ï¼‰ï¼Œmï¼ˆåˆ†é’Ÿï¼‰ï¼Œhï¼ˆå°æ—¶ï¼‰ï¼Œdï¼ˆå¤©ï¼‰ï¼Œwï¼ˆå‘¨ï¼‰ï¼ŒMï¼ˆæœˆï¼‰ï¼Œyï¼ˆå¹´ï¼‰</span></span><br><span class=\"line\">    <span class=\"comment\"># expirationä¸èƒ½è®¾ç½®å°äº1åˆ†é’Ÿçš„æ—¶é—´ï¼Œå¦‚æœçœç•¥expirationï¼Œåˆ™è¡¨ç¤ºæ— è¿‡æœŸæ—¶é—´</span></span><br><span class=\"line\"><span class=\"comment\"># role_descriptors: è§’è‰²æè¿°ç¬¦ï¼ŒåŒ…å«å¤šä¸ªè§’è‰²</span></span><br><span class=\"line\">    <span class=\"comment\"># role-a: è§’è‰²æè¿°ç¬¦åç§°ï¼ŒåŒ…å«é›†ç¾¤å’Œç´¢å¼•çš„æƒé™æè¿°</span></span><br><span class=\"line\">        <span class=\"comment\"># cluster: é›†ç¾¤æƒé™</span></span><br><span class=\"line\">            <span class=\"comment\"># all: è¡¨ç¤ºæ‹¥æœ‰å…¨éƒ¨é›†ç¾¤æƒé™</span></span><br><span class=\"line\">            <span class=\"comment\"># manage: å¯ä»¥ç®¡ç†é›†ç¾¤è®¾ç½®ã€æ¨¡æ¿å’ŒèŠ‚ç‚¹ä¸Šçš„åˆ†ç‰‡åˆ†é…ã€‚</span></span><br><span class=\"line\">            <span class=\"comment\"># monitor: å¯ä»¥ç›‘è§†é›†ç¾¤çš„çŠ¶æ€ã€‚</span></span><br><span class=\"line\">            <span class=\"comment\"># manage_security: å¯ä»¥ç®¡ç†å®‰å…¨è®¾ç½®ï¼Œå¦‚ç”¨æˆ·ã€è§’è‰²å’Œè§’è‰²æ˜ å°„ã€‚</span></span><br><span class=\"line\">            <span class=\"comment\"># manage_api_key: ç®¡ç† API Key</span></span><br><span class=\"line\">        <span class=\"comment\"># indices: ç´¢å¼•æƒé™ï¼ŒåŒ…å«nameså’Œprivilegesï¼Œ</span></span><br><span class=\"line\">            <span class=\"comment\"># names: è¡¨ç¤ºç´¢å¼•åç§°ï¼Œindex-a*è¡¨ç¤ºæ‰€æœ‰ä»¥index-aå¼€å¤´çš„ç´¢å¼•ï¼Œallè¡¨ç¤ºæ‰€æœ‰ç´¢å¼•</span></span><br><span class=\"line\">            <span class=\"comment\"># privileges: è¡¨ç¤ºç´¢å¼•æƒé™</span></span><br><span class=\"line\">                <span class=\"comment\"># read: è¡¨ç¤ºæ‹¥æœ‰ç´¢å¼•çš„è¯»å–æƒé™</span></span><br><span class=\"line\">                <span class=\"comment\"># write: è¡¨ç¤ºæ‹¥æœ‰ç´¢å¼•çš„å†™å…¥æƒé™</span></span><br><span class=\"line\">                <span class=\"comment\"># delete: è¡¨ç¤ºæ‹¥æœ‰ç´¢å¼•çš„åˆ é™¤æƒé™</span></span><br><span class=\"line\">                <span class=\"comment\"># index: è¡¨ç¤ºæ‹¥æœ‰ç´¢å¼•çš„ç´¢å¼•æƒé™</span></span><br><span class=\"line\">                <span class=\"comment\"># manage: è¡¨ç¤ºæ‹¥æœ‰ç´¢å¼•çš„è®¾ç½®å’Œæ˜ å°„æƒé™</span></span><br><span class=\"line\">                <span class=\"comment\"># monitor: è¡¨ç¤ºæ‹¥æœ‰ç´¢å¼•çš„ç›‘æ§æƒé™</span></span><br><span class=\"line\">                <span class=\"comment\"># create_index: è¡¨ç¤ºå…è®¸åˆ›å»ºç´¢å¼•</span></span><br><span class=\"line\">                <span class=\"comment\"># crud: ç»„åˆäº† read, index, delete æƒé™</span></span><br><span class=\"line\">                <span class=\"comment\"># all: è¡¨ç¤ºæ‹¥æœ‰å…¨éƒ¨ç´¢å¼•æƒé™</span></span><br><span class=\"line\">            <span class=\"comment\"># allow_restricted_indices: è¡¨ç¤ºæ˜¯å¦å…è®¸å¯¹ restricted indices(å—é™åˆ¶ç´¢å¼•ï¼Œæ¯”å¦‚ä»¥.å¼€å¤´çš„ç´¢å¼•) è¿›è¡Œæ“ä½œï¼Œtrueè¡¨ç¤ºå…è®¸ï¼Œfalseè¡¨ç¤ºä¸å…è®¸</span></span><br><span class=\"line\"><span class=\"comment\"># metadata: å…ƒæ•°æ®</span></span><br><span class=\"line\">    <span class=\"comment\"># application: è¡¨ç¤ºåº”ç”¨ç¨‹åºåç§°</span></span><br><span class=\"line\">    <span class=\"comment\"># environment: è¡¨ç¤ºç¯å¢ƒä¿¡æ¯</span></span><br><span class=\"line\">        <span class=\"comment\"># level: è¡¨ç¤ºç¯å¢ƒçº§åˆ«</span></span><br><span class=\"line\">        <span class=\"comment\"># trusted: è¡¨ç¤ºæ˜¯å¦å—ä¿¡ä»»</span></span><br><span class=\"line\">        <span class=\"comment\"># tags: è¡¨ç¤ºç¯å¢ƒæ ‡ç­¾</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># è¾“å‡ºï¼š</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">&quot;id&quot;</span> : <span class=\"string\">&quot;-kKu0ZUBrL2GcOxX0t1R&quot;</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;name&quot;</span> : <span class=\"string\">&quot;my-api-key&quot;</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;expiration&quot;</span> : 1743066050130,</span><br><span class=\"line\">  <span class=\"string\">&quot;api_key&quot;</span> : <span class=\"string\">&quot;03eNOYg_SCCHdzc0orsRvw&quot;</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;encoded&quot;</span> : <span class=\"string\">&quot;LWtLdTBaVUJyTDJHY094WDB0MVI6MDNlTk9ZZ19TQ0NIZHpjMG9yc1J2dw==&quot;</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹ApiKeyä¿¡æ¯ï¼Œæ ¹æ®idæŸ¥è¯¢åªä¼šè¿”å›ä¸€ä¸ªApiKeyï¼Œæ ¹æ®nameæŸ¥è¯¢ä¼šè¿”å›å¤šä¸ªApiKey</span></span><br><span class=\"line\">curl -u elastic:123456 -k <span class=\"string\">&#x27;https://127.0.0.1:9200/_security/api_key?id=-kKu0ZUBrL2GcOxX0t1R&amp;pretty&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"># è¾“å‡ºï¼š</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">&quot;api_keys&quot;</span> : [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      <span class=\"string\">&quot;id&quot;</span> : <span class=\"string\">&quot;-kKu0ZUBrL2GcOxX0t1R&quot;</span>,</span><br><span class=\"line\">      <span class=\"string\">&quot;name&quot;</span> : <span class=\"string\">&quot;my-api-key&quot;</span>,</span><br><span class=\"line\">      <span class=\"string\">&quot;type&quot;</span> : <span class=\"string\">&quot;rest&quot;</span>,</span><br><span class=\"line\">      <span class=\"string\">&quot;creation&quot;</span> : 1742979650130,</span><br><span class=\"line\">      <span class=\"string\">&quot;expiration&quot;</span> : 1743066050130,</span><br><span class=\"line\">      <span class=\"string\">&quot;invalidated&quot;</span> : <span class=\"literal\">false</span>,</span><br><span class=\"line\">      <span class=\"string\">&quot;username&quot;</span> : <span class=\"string\">&quot;elastic&quot;</span>,</span><br><span class=\"line\">      <span class=\"string\">&quot;realm&quot;</span> : <span class=\"string\">&quot;reserved&quot;</span>,</span><br><span class=\"line\">      <span class=\"string\">&quot;realm_type&quot;</span> : <span class=\"string\">&quot;reserved&quot;</span>,</span><br><span class=\"line\">      <span class=\"string\">&quot;metadata&quot;</span> : &#123;</span><br><span class=\"line\">        <span class=\"string\">&quot;environment&quot;</span> : &#123;</span><br><span class=\"line\">          <span class=\"string\">&quot;level&quot;</span> : 1,</span><br><span class=\"line\">          <span class=\"string\">&quot;trusted&quot;</span> : <span class=\"literal\">true</span>,</span><br><span class=\"line\">          <span class=\"string\">&quot;tags&quot;</span> : [</span><br><span class=\"line\">            <span class=\"string\">&quot;dev&quot;</span>,</span><br><span class=\"line\">            <span class=\"string\">&quot;staging&quot;</span></span><br><span class=\"line\">          ]</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        <span class=\"string\">&quot;application&quot;</span> : <span class=\"string\">&quot;my-application&quot;</span></span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      <span class=\"string\">&quot;role_descriptors&quot;</span> : &#123;</span><br><span class=\"line\">        <span class=\"string\">&quot;role-a&quot;</span> : &#123;</span><br><span class=\"line\">          <span class=\"string\">&quot;cluster&quot;</span> : [</span><br><span class=\"line\">            <span class=\"string\">&quot;all&quot;</span></span><br><span class=\"line\">          ],</span><br><span class=\"line\">          <span class=\"string\">&quot;indices&quot;</span> : [</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">              <span class=\"string\">&quot;names&quot;</span> : [</span><br><span class=\"line\">                <span class=\"string\">&quot;index-a*&quot;</span></span><br><span class=\"line\">              ],</span><br><span class=\"line\">              <span class=\"string\">&quot;privileges&quot;</span> : [</span><br><span class=\"line\">                <span class=\"string\">&quot;read&quot;</span></span><br><span class=\"line\">              ],</span><br><span class=\"line\">              <span class=\"string\">&quot;allow_restricted_indices&quot;</span> : <span class=\"literal\">false</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">          ],</span><br><span class=\"line\">          <span class=\"string\">&quot;applications&quot;</span> : [ ],</span><br><span class=\"line\">          <span class=\"string\">&quot;run_as&quot;</span> : [ ],</span><br><span class=\"line\">          <span class=\"string\">&quot;metadata&quot;</span> : &#123; &#125;,</span><br><span class=\"line\">          <span class=\"string\">&quot;transient_metadata&quot;</span> : &#123;</span><br><span class=\"line\">            <span class=\"string\">&quot;enabled&quot;</span> : <span class=\"literal\">true</span></span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        <span class=\"string\">&quot;role-b&quot;</span> : &#123;</span><br><span class=\"line\">          <span class=\"string\">&quot;cluster&quot;</span> : [</span><br><span class=\"line\">            <span class=\"string\">&quot;all&quot;</span></span><br><span class=\"line\">          ],</span><br><span class=\"line\">          <span class=\"string\">&quot;indices&quot;</span> : [</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">              <span class=\"string\">&quot;names&quot;</span> : [</span><br><span class=\"line\">                <span class=\"string\">&quot;index-b*&quot;</span></span><br><span class=\"line\">              ],</span><br><span class=\"line\">              <span class=\"string\">&quot;privileges&quot;</span> : [</span><br><span class=\"line\">                <span class=\"string\">&quot;all&quot;</span></span><br><span class=\"line\">              ],</span><br><span class=\"line\">              <span class=\"string\">&quot;allow_restricted_indices&quot;</span> : <span class=\"literal\">false</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">          ],</span><br><span class=\"line\">          <span class=\"string\">&quot;applications&quot;</span> : [ ],</span><br><span class=\"line\">          <span class=\"string\">&quot;run_as&quot;</span> : [ ],</span><br><span class=\"line\">          <span class=\"string\">&quot;metadata&quot;</span> : &#123; &#125;,</span><br><span class=\"line\">          <span class=\"string\">&quot;transient_metadata&quot;</span> : &#123;</span><br><span class=\"line\">            <span class=\"string\">&quot;enabled&quot;</span> : <span class=\"literal\">true</span></span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ›´æ–°ApiKey</span></span><br><span class=\"line\">curl -u elastic:123456 -X PUT -k <span class=\"string\">&#x27;https://127.0.0.1:9200/_security/api_key/-kKu0ZUBrL2GcOxX0t1R?pretty&#x27;</span> \\</span><br><span class=\"line\">--header <span class=\"string\">&#x27;Content-Type: application/json&#x27;</span> \\</span><br><span class=\"line\">--data <span class=\"string\">&#x27;&#123;</span></span><br><span class=\"line\"><span class=\"string\">    &quot;metadata&quot;: &#123;&#125;</span></span><br><span class=\"line\"><span class=\"string\">&#125;&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"># è¾“å‡ºï¼š</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">&quot;updated&quot;</span> : <span class=\"literal\">true</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ç½®ApiKeyæ— æ•ˆ</span></span><br><span class=\"line\">curl -u elastic:123456 -X DELETE -k <span class=\"string\">&#x27;https://127.0.0.1:9200/_security/api_key?pretty&#x27;</span> \\</span><br><span class=\"line\">--header <span class=\"string\">&#x27;Content-Type: application/json&#x27;</span> \\</span><br><span class=\"line\">--data <span class=\"string\">&#x27;&#123;</span></span><br><span class=\"line\"><span class=\"string\">   &quot;ids&quot; : [ &quot;-kKu0ZUBrL2GcOxX0t1R&quot; ]</span></span><br><span class=\"line\"><span class=\"string\">&#125;&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"># è¾“å‡ºï¼š</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">&quot;invalidated_api_keys&quot;</span> : [</span><br><span class=\"line\">    <span class=\"string\">&quot;-kKu0ZUBrL2GcOxX0t1R&quot;</span></span><br><span class=\"line\">  ],</span><br><span class=\"line\">  <span class=\"string\">&quot;previously_invalidated_api_keys&quot;</span> : [ ],</span><br><span class=\"line\">  <span class=\"string\">&quot;error_count&quot;</span> : 0</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç»å¦‚ä½•åœ¨linuxä¸‹å®‰è£…Elasticsearch Elasticsearchç‰ˆæœ¬8.17.3 ä¸‹è½½ ä¸‹è½½åœ°å€ï¼šhttps://www.elastic.co/cn/downloads/past-releases#elasticsearch é€‰æ‹©å¯¹åº”çš„ç‰ˆæœ¬ï¼šè¿™é‡Œé€‰æ‹©å½“å‰çš„æœ€æ–°ç‰ˆElasticsearch 8.17.3ï¼Œä¹‹åé€‰æ‹©å¯¹åº”çš„æ“ä½œç³»ç»ŸLINUX X86_64 1wget https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-8.17.3-linux-x86_64.tar.gz ä¸‹è½½å®Œæˆåè§£å‹åˆ°/usr/local/elasticsearchç›®å½•ä¸‹ï¼Œè§£å‹å‘½ä»¤å¦‚ä¸‹ï¼š 12mkdir /usr/local/elasticsearchtar -zxvf elasticsearch-8.17.3-linux-x86_64.tar.gz -C /usr/local/elasticsearch ElasticSearchç›®å½•ç»“æ„ 12345678bin # è„šæœ¬æ–‡ä»¶ï¼ŒåŒ…æ‹¬å¯åŠ¨elasticsearchï¼Œå®‰è£…æ’ä»¶ï¼Œè¿è¡Œç»Ÿè®¡æ•°æ®ç­‰config # é…ç½®æ–‡ä»¶ç›®å½•ï¼Œå¦‚elasticsearché…ç½®ã€è§’è‰²é…ç½®ã€jvmé…ç½®ã€è¯ä¹¦ç­‰ã€‚data # æ•°æ®ç›®å½•ï¼Œé»˜è®¤å€¼ $ES_HOME/dataï¼ŒåŒ…å«èŠ‚ç‚¹ã€åˆ†ç‰‡ã€ç´¢å¼•ã€æ–‡æ¡£çš„æ‰€æœ‰æ•°æ®ï¼Œç”Ÿäº§ç¯å¢ƒå»ºè®®ä¿®æ”¹jdk # JDKç›®å½•ï¼Œç”¨äºè¿è¡ŒElasticsearchï¼Œ7.xä»¥åè‡ªå¸¦lib # Elasticsearchä¾èµ–çš„JARåŒ…logs # æ—¥å¿—ç›®å½•ï¼Œé»˜è®¤å€¼ $ES_HOME/logsï¼Œç”Ÿäº§ç¯å¢ƒå»ºè®®ä¿®æ”¹modules # åŒ…å«æ‰€æœ‰çš„Elasticsearchæ¨¡å—ï¼Œå¦‚Clusterã€Discoveryã€Indicesç­‰plugins # å·²å®‰è£…æ’ä»¶ç›®å½• åˆ›å»ºå¯åŠ¨ç”¨æˆ· elasticsearchå’Œkibanaéƒ½ä¸èƒ½ç”¨rootç”¨æˆ·å¯åŠ¨ åˆ›å»ºç”¨æˆ·elasticï¼Œå¹¶è®¾ç½®å¯†ç  12useradd elasticpasswd elastic ä¿®æ”¹elasticsearchå®‰è£…ç›®å½•çš„ç”¨æˆ·æƒé™ 1chown -R elastic:elastic /usr/local/elasticsearch é…ç½®ç¯å¢ƒå˜é‡ è¿›å…¥elasticç”¨æˆ·ä¸»ç›®å½•ï¼Œ/home/elasticç›®å½•ä¸‹ï¼Œè®¾ç½®ç”¨æˆ·çº§åˆ«çš„ç¯å¢ƒå˜é‡ 12# åˆ‡æ¢åˆ°elasticç”¨æˆ·su - elastic vim .bash_profile 1234# Elasticsearchå®‰è£…ç›®å½•ï¼Œå®ƒç”¨äºå®šä½Elasticsearchçš„é…ç½®æ–‡ä»¶ã€æ’ä»¶å’Œå…¶ä»–ç›¸å…³èµ„æºã€‚export ES_HOME=/usr/local/elasticsearch/elasticsearch-8.17.3# Elasticsearchä½¿ç”¨çš„JDKå®‰è£…ç›®å½•ï¼Œåœ¨å¯åŠ¨Elasticsearchæ—¶ï¼Œå®ƒä¼šæ£€æŸ¥ES_JAVA_HOMEç¯å¢ƒå˜é‡å¹¶ä½¿ç”¨å…¶ä¸­çš„Javaè·¯å¾„ã€‚export ES_JAVA_HOME=/usr/local/elasticsearch/elasticsearch-8.17.3/jdk/ æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ä½¿é…ç½®ç”Ÿæ•ˆ 1source .bash_profile é…ç½®JVMå‚æ•°ï¼ˆå¯é€‰ï¼‰ ESæ¯”è¾ƒè€—å†…å­˜ï¼Œå»ºè®®è™šæ‹Ÿæœº4Gæˆ–ä»¥ä¸Šå†…å­˜ï¼Œjvm1gä»¥ä¸Šçš„å†…å­˜åˆ†é… è¿›å…¥/usr/local/elasticsearch/elasticsearch-8.17.3/configç›®å½•ï¼Œä¿®æ”¹jvm.optionsæ–‡ä»¶ï¼Œè°ƒæ•´jvmå †å†…å­˜å¤§å° 12-Xms4g # è®¾ç½®æœ€å°å †å†…å­˜ï¼Œé»˜è®¤4gï¼Œä¸èƒ½å°äº1g-Xmx4g # è®¾ç½®æœ€å¤§å †å†…å­˜ï¼Œé»˜è®¤4gï¼ŒXmxä¸è¦è¶…è¿‡æœºå™¨å†…å­˜çš„50%ï¼Œä¸è¦è¶…è¿‡30g åˆ›å»ºæ•°æ®å’Œæ—¥å¿—å­˜å‚¨ç›®å½• 1234# åˆ‡æ¢åˆ°elasticç”¨æˆ·su - elastic# åˆ›å»ºç›®å½•mkdir /usr/local/elasticsearch/data /usr/local/elasticsearch/log é…ç½®å¯åŠ¨æ–‡ä»¶ å¦‚æœæ˜¯æœ¬åœ°å¼€å‘ç¯å¢ƒï¼Œä¹Ÿå¯ä»¥ä¸åšä»»ä½•ä¿®æ”¹ç›´æ¥å¯åŠ¨ï¼Œå› ä¸ºå¤§éƒ¨åˆ†é…ç½®é¡¹éƒ½æœ‰é»˜è®¤å€¼ï¼Œä½†ä¸ºäº†æ›´å¥½çš„æ§åˆ¶ESï¼Œæ¨èæŒ‰å¦‚ä¸‹æ–¹å¼è¿›è¡Œé…ç½® è¿›å…¥/usr/local/elasticsearch/elasticsearch-8.17.3/configç›®å½•ï¼Œä¿®æ”¹elasticsearch.ymlæ–‡ä»¶ 123456789101112131415161718192021222324# é›†ç¾¤åç§°ï¼Œå¤šä¸ªèŠ‚ç‚¹å¦‚æœè¦ç»„æˆåŒä¸€ä¸ªé›†ç¾¤ï¼Œé‚£ä¹ˆé›†ç¾¤åç§°ä¸€å®šè¦é…ç½®æˆç›¸åŒï¼Œé»˜è®¤å€¼elasticsearchcluster.name: test-elk# èŠ‚ç‚¹åç§°ï¼Œé»˜è®¤å€¼å½“å‰èŠ‚ç‚¹éƒ¨ç½²æ‰€åœ¨æœºå™¨çš„ä¸»æœºånode.name: node-1# æ•°æ®å­˜å‚¨è·¯å¾„ï¼Œé»˜è®¤å€¼ $ES_HOME/datapath.data: /usr/local/elasticsearch/data# æ—¥å¿—å­˜å‚¨è·¯å¾„ï¼Œé»˜è®¤å€¼ $ES_HOME/logspath.logs: /usr/local/elasticsearch/logs# é…ç½®ESå¯åŠ¨æ—¶æ˜¯å¦è¿›è¡Œå†…å­˜é”å®šæ£€æŸ¥ï¼Œé»˜è®¤å€¼trueï¼Œæœ¬æœºå†…å­˜æ¯”è¾ƒå°æ—¶è®¾ç½®ä¸ºfalsebootstrap.memory_lock: false# å…è®¸é€šè¿‡ä»»ä½•åœ°å€è®¿é—®ï¼Œå¼€å¯è¿œç¨‹è®¿é—®network.host: 0.0.0.0# é…ç½®å½“å‰ESèŠ‚ç‚¹å¯¹å¤–æä¾›æœåŠ¡çš„httpç«¯å£ï¼Œé»˜è®¤ 9200http.port: 9200# é…ç½®å½“å‰ESèŠ‚ç‚¹å¯¹å¤–æä¾›æœåŠ¡çš„tcpç«¯å£ï¼Œé»˜è®¤ 9300transport.port: 9300# é›†ç¾¤å†…çš„ä¸»æœºåˆ—è¡¨ï¼Œå•èŠ‚ç‚¹å¯åŠ¨æ—¶å¯ä»¥ä¸é…ç½®# discovery.seed_hosts: [&quot;127.0.0.1&quot;]# ç¬¬ä¸€æ¬¡å¯åŠ¨æ—¶éœ€è¦å‚ä¸é€‰ä¸»çš„èŠ‚ç‚¹åç§°cluster.initial_master_nodes: [&quot;node-1&quot;]#è§£å†³è·¨åŸŸé—®é¢˜http.cors.enabled: truehttp.cors.allow-origin: &quot;*&quot; å¯åŠ¨ElasticSearchæœåŠ¡ è¿›å…¥/usr/local/elasticsearch/elasticsearch-8.17.3ç›®å½•ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤å¯åŠ¨æœåŠ¡ 123./bin/elasticsearch# åå°å¯åŠ¨./bin/elasticsearch -d ESå¯åŠ¨å‰çš„å¼•å¯¼æ£€æŸ¥ ESå¯åŠ¨æ—¶ï¼Œé»˜è®¤ä¼šè¿›è¡Œå¼•å¯¼æ£€æŸ¥ï¼Œæ‰€è°“å¼•å¯¼æ£€æŸ¥å°±æ˜¯åœ¨æœåŠ¡å¯åŠ¨ä¹‹å‰å¯¹ä¸€äº›é‡è¦çš„é…ç½®é¡¹è¿›è¡Œæ£€æŸ¥ï¼Œæ£€æŸ¥å…¶é…ç½®å€¼æ˜¯å¦æ˜¯åˆç†çš„ã€‚å¼•å¯¼æ£€æŸ¥åŒ…æ‹¬å¯¹JVMå¤§å°ã€å†…å­˜é”ã€è™šæ‹Ÿå†…å­˜ã€æœ€å¤§çº¿ç¨‹æ•°ã€é›†ç¾¤å‘ç°ç›¸å…³é…ç½®ç­‰ç›¸å…³çš„æ£€æŸ¥ï¼Œå¦‚æœæŸä¸€é¡¹æˆ–è€…å‡ é¡¹çš„é…ç½®ä¸åˆç†ï¼ŒESä¼šæ‹’ç»å¯åŠ¨æœåŠ¡ã€‚ å¦‚æœå¯åŠ¨æœåŠ¡æ—¶ï¼ŒæŠ¥ä»¥ä¸‹é”™è¯¯ï¼Œåˆ™éœ€è¦è§£å†³å¼•å¯¼æ£€æŸ¥ä¸­çš„é—®é¢˜ 1.max virtual memory areas vm.max_map_count [65530] is too low, increase to at least [262144]; åŸå› ï¼šæœ€å¤§è™šæ‹Ÿå†…å­˜å¤ªå°,è°ƒå¤§ç³»ç»Ÿçš„è™šæ‹Ÿå†…å­˜ è§£å†³åŠæ³•ï¼š 123456# rootç”¨æˆ·ä¸‹è¿è¡Œvim /etc/sysctl.conf# è¿½åŠ ä»¥ä¸‹å†…å®¹ï¼švm.max_map_count=262144# ä¿å­˜é€€å‡ºä¹‹åæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼šsysctl -p 2.max file descriptors [4096] for elasticsearch process is too low, increase to at least [65536] åŸå› ï¼šæ–‡ä»¶æè¿°ç¬¦å¤ªå°ï¼Œè°ƒå¤§ç³»ç»Ÿçš„æ–‡ä»¶æè¿°ç¬¦ è§£å†³åŠæ³•ï¼š 1234567# rootç”¨æˆ·ä¸‹è¿è¡Œvim /etc/security/limits.conf# æœ«å°¾æ·»åŠ å¦‚ä¸‹é…ç½®ï¼š* soft nofile 65536* hard nofile 65536* soft nproc 4096* hard nproc 4096 å¦‚æœåªæ˜¯å•èŠ‚ç‚¹çš„å¼€å‘ç¯å¢ƒï¼Œåˆ™å¯ä»¥å…³é—­å¼•å¯¼æ£€æŸ¥ï¼Œç”Ÿæˆç¯å¢ƒä¸å»ºè®®è¿™æ ·åšï¼Œå› ä¸ºå…³é—­å¼•å¯¼æ£€æŸ¥åï¼ŒESæœåŠ¡å°†æ— æ³•ä¿è¯é›†ç¾¤çš„é«˜å¯ç”¨æ€§ã€‚ 12345# è¿›å…¥elasticsearchå®‰è£…ç›®å½•vim config/elasticsearch.yml# æ·»åŠ å¦‚ä¸‹é…ç½®ï¼š# æŒ‡å®šèŠ‚ç‚¹ä¸ºå•èŠ‚ç‚¹ï¼Œå¯ä»¥ç»•è¿‡å¼•å¯¼æ£€æŸ¥discovery.type: single-node æœåŠ¡æ­£å¸¸å¯åŠ¨åä»ç„¶ä¸èƒ½æ­£å¸¸è®¿é—® è®¿é—®æœåŠ¡ 12curl http://127.0.0.1:9200curl: (52) Empty reply from server æŸ¥çœ‹æ—¥å¿—/usr/local/elasticsearch/elasticsearch-8.17.3/logs/test-elk.logï¼Œå‘ç°æŠ¥å¦‚ä¸‹è­¦å‘Šï¼š 1[WARN ][o.e.h.n.Netty4HttpServerTransport] [node-1] received plaintext http traffic on an https channel, closing connection Netty4HttpChannel&#123;localAddress=/127.0.0.1:9200, remoteAddress=/127.0.0.1:38426&#125; åŸå› æ˜¯ESåœ¨å¯åŠ¨æœåŠ¡æ—¶é»˜è®¤å¼€å¯äº† X-Pack å®‰å…¨åŠŸèƒ½ï¼ŒæŸ¥çœ‹é…ç½®æ–‡ä»¶/usr/local/elasticsearch/elasticsearch-8.17.3/config/elasticsearch.ymlï¼Œå‘ç°é…ç½®é¡¹xpack.security.xxxç›¸å…³é…ç½®é¡¹è¢«è‡ªåŠ¨æ·»åŠ äº†ï¼Œå¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930313233#----------------------- BEGIN SECURITY AUTO CONFIGURATION -----------------------## The following settings, TLS certificates, and keys have been automatically# generated to configure Elasticsearch security features on 20-03-2025 08:53:20## --------------------------------------------------------------------------------# Enable security features# å¯ç”¨ Elasticsearch çš„å®‰å…¨ç‰¹æ€§ï¼ŒåŒ…æ‹¬ç”¨æˆ·è®¤è¯ã€è§’è‰²ç®¡ç†ã€åŠ å¯†ç­‰ã€‚# å¼€å¯äº† X-Pack å®‰å…¨åŠŸèƒ½ï¼Œè¿™æ„å‘³ç€ä½ éœ€è¦è¿›è¡Œç”¨æˆ·è®¤è¯æ‰èƒ½è®¿é—® Elasticsearchã€‚# å¦‚æœéœ€è¦å…³é—­ X-Pack å®‰å…¨åŠŸèƒ½ï¼Œä½ å¯ä»¥å°† xpack.security.enabled è®¾ç½®ä¸º falseã€‚xpack.security.enabled: true# å¯ç”¨å®‰å…¨æ³¨å†ŒåŠŸèƒ½ï¼Œå…è®¸é€šè¿‡äº¤äº’å¼å‘å¯¼æ¥é…ç½®å®‰å…¨è®¾ç½®ã€‚# è¿™ä½¿å¾—ä½ å¯ä»¥é€šè¿‡ Kibana æˆ–å‘½ä»¤è¡Œå·¥å…·æ¥è‡ªåŠ¨é…ç½® SSL è¯ä¹¦å’Œå…¶ä»–å®‰å…¨è®¾ç½®ã€‚xpack.security.enrollment.enabled: true# Enable encryption for HTTP API client connections, such as Kibana, Logstash, and Agents# å¯ç”¨ HTTP API å®¢æˆ·ç«¯è¿æ¥çš„åŠ å¯†# Kibanaã€Logstash å’Œå…¶ä»–é€šè¿‡ HTTP API è¿æ¥åˆ° Elasticsearch çš„å®¢æˆ·ç«¯å°†ä½¿ç”¨ HTTPS è¿›è¡Œé€šä¿¡ï¼Œå¢å¼ºå®‰å…¨æ€§ã€‚xpack.security.http.ssl: enabled: true # å¯ç”¨ HTTP å±‚çš„ SSL åŠ å¯†ï¼Œå³httpsè®¿é—®ï¼Œç¡®ä¿å®¢æˆ·ç«¯ä¸ Elasticsearch ä¹‹é—´çš„é€šä¿¡æ˜¯åŠ å¯†çš„ã€‚è®¾ç½®ä¸ºfalseæ—¶ï¼Œå…³é—­åŠ å¯†ï¼Œå³httpè®¿é—® keystore.path: certs/http.p12 # æŒ‡å®šç”¨äº HTTP å±‚åŠ å¯†çš„å¯†é’¥åº“æ–‡ä»¶è·¯å¾„ã€‚è¿™æ˜¯ä¸€ä¸ª PKCS12 æ–‡ä»¶ï¼ŒåŒ…å«ç”¨äºåŠ å¯†å’ŒéªŒè¯çš„å…¬é’¥å’Œç§é’¥ã€‚# Enable encryption and mutual authentication between cluster nodes# å¯ç”¨èŠ‚ç‚¹é—´çš„åŠ å¯†å’ŒåŒå‘è®¤è¯# Elasticsearch é›†ç¾¤ä¸­çš„èŠ‚ç‚¹ä¹‹é—´çš„é€šä¿¡å°†ä½¿ç”¨ SSL åŠ å¯†ï¼Œå¹¶ä¸”æ¯ä¸ªèŠ‚ç‚¹éƒ½ä¼šéªŒè¯å…¶ä»–èŠ‚ç‚¹çš„èº«ä»½ï¼Œä»è€Œå¢å¼ºé›†ç¾¤çš„å®‰å…¨æ€§ã€‚# æ‰€æœ‰èŠ‚ç‚¹è¦é…ç½®ç›¸åŒçš„è¯ä¹¦xpack.security.transport.ssl: enabled: true # å¯ç”¨ä¼ è¾“å±‚çš„ SSL åŠ å¯†ï¼Œç¡®ä¿èŠ‚ç‚¹ä¹‹é—´çš„å†…éƒ¨é€šä¿¡æ˜¯åŠ å¯†çš„ã€‚ verification_mode: certificate # è®¾ç½®éªŒè¯æ¨¡å¼ä¸º certificateï¼Œè¿™æ„å‘³ç€èŠ‚ç‚¹ä¹‹é—´éœ€è¦åŒå‘è®¤è¯ï¼ˆå³æ¯ä¸ªèŠ‚ç‚¹éƒ½éœ€è¦éªŒè¯å¯¹æ–¹çš„èº«ä»½ï¼‰ã€‚ keystore.path: certs/transport.p12 # æŒ‡å®šç”¨äºä¼ è¾“å±‚åŠ å¯†çš„å¯†é’¥åº“æ–‡ä»¶è·¯å¾„ã€‚è¿™æ˜¯å¦ä¸€ä¸ª PKCS12 æ–‡ä»¶ï¼ŒåŒ…å«ç”¨äºåŠ å¯†å’ŒéªŒè¯çš„å…¬é’¥å’Œç§é’¥ã€‚ truststore.path: certs/transport.p12 # æŒ‡å®šç”¨äºå­˜å‚¨ä¿¡ä»»è¯ä¹¦çš„ä¿¡ä»»åº“æ–‡ä»¶è·¯å¾„ã€‚è¿™é€šå¸¸ä¸å¯†é’¥åº“ç›¸åŒï¼Œä½†å¯ä»¥ä¸åŒã€‚#----------------------- END SECURITY AUTO CONFIGURATION ------------------------- è§£å†³æ–¹æ³•ï¼š 1.ä¸æƒ³å¼€å¯å®‰å…¨è®¤è¯ï¼Œå°† xpack.security.enabled è®¾ç½®ä¸º falseï¼Œè¿™æ ·å³ä¾¿ä¸‹é¢çš„é…ç½®éƒ½è®¾ç½®ä¸ºtrueä¹Ÿä¸ä¼šæœ‰æ•ˆã€‚ 2.ä¸æƒ³httpsè®¿é—®ï¼Œå°† xpack.security.http.ssl.enabled è®¾ç½®ä¸º falseï¼Œä½†è¿™æ ·ä¼šå¯¼è‡´æ— æ³•é€šè¿‡è®¤è¯Tokenæ·»åŠ å…¶å®ƒèŠ‚ç‚¹æˆ–Kibanaã€‚ 3.ä¸æƒ³èŠ‚ç‚¹é—´é€šä¿¡åŠ å¯†ï¼Œå°† xpack.security.transport.ssl.enabled è®¾ç½®ä¸º false ä¸ºäº†ä¿è¯ESçš„å®‰å…¨ï¼Œæˆ‘è¿™é‡Œå°±å¼€å¯å®‰å…¨è®¤è¯ï¼Œå¹¶ä¸”é€šè¿‡httpsè®¿é—®ESï¼Œä½†æ­¤æ—¶æˆ‘ä»¬è®¿é—®ESçš„APIå°±éœ€è¦å¸¦ä¸Šè®¤è¯ç”¨æˆ·ï¼Œé‚£ä¹ˆç”¨æˆ·åå’Œå¯†ç æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ å®é™…ä¸Šåœ¨ESç¬¬ä¸€æ¬¡æ­£å¸¸å¯åŠ¨æ—¶å…¶æ—¥å¿—ä¸­å°±æ‰“å°äº†è‡ªåŠ¨é…ç½®çš„å®‰å…¨ç›¸å…³çš„ä¿¡æ¯æç¤ºï¼Œé‡Œé¢å°±ç»™å‡ºäº†ç™»å½•ç”¨æˆ·å’Œåˆå§‹çš„å¯†ç ï¼Œå¦‚ä¸‹ï¼š 1234567891011121314151617181920212223242526272829303132â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”# è¿™äº›æ—¥å¿—ä¿¡æ¯æä¾›äº† Elasticsearch 8 åœ¨é¦–æ¬¡å¯åŠ¨æ—¶è‡ªåŠ¨é…ç½®çš„å®‰å…¨ç‰¹æ€§ã€ç”Ÿæˆçš„é»˜è®¤å¯†ç ã€è¯ä¹¦æŒ‡çº¹ä»¥åŠå¦‚ä½•é…ç½® Kibana å’Œå…¶ä»–èŠ‚ç‚¹åŠ å…¥é›†ç¾¤çš„è¯¦ç»†è¯´æ˜ã€‚âœ… Elasticsearch security features have been automatically configured!âœ… Authentication is enabled and cluster connections are encrypted.# è¿™æ˜¯ elastic ç”¨æˆ·çš„é»˜è®¤å¯†ç ã€‚ç³»ç»Ÿå»ºè®®ä½ ä½¿ç”¨ bin/elasticsearch-reset-password -u elastic å‘½ä»¤æ¥é‡ç½®æ­¤å¯†ç ã€‚â„¹ï¸ Password for the elastic user (reset with `bin/elasticsearch-reset-password -u elastic`): BNb=*qz6_M*mXL9uZiSP # è¿™é‡Œä¼šæ‰“å°å‡ºESè‡ªåŠ¨ç”Ÿæˆçš„å¯†ç # è¿™æ˜¯ HTTP CA è¯ä¹¦çš„ SHA-256 æŒ‡çº¹ã€‚CA è¯ä¹¦ç”¨äºéªŒè¯ HTTPS è¿æ¥çš„èº«ä»½ã€‚â„¹ï¸ HTTP CA certificate SHA-256 fingerprint: 3f141c16dfc6e165894bc1672084b220dcdd22ffe02116d51ac18003cfaa5a1d# æä¾›äº†å°† Kibana é…ç½®ä¸ºä½¿ç”¨æ­¤ Elasticsearch é›†ç¾¤çš„æ­¥éª¤ã€‚â„¹ï¸ Configure Kibana to use this cluster:# å¯åŠ¨ Kibana å¹¶æŒ‰ç…§ç»ˆç«¯ä¸­æ˜¾ç¤ºçš„é…ç½®é“¾æ¥è¿›è¡Œæ“ä½œã€‚â€¢ Run Kibana and click the configuration link in the terminal when Kibana starts.# å¤åˆ¶æä¾›çš„æ³¨å†Œä»¤ç‰Œï¼Œå¹¶åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ Kibana æ—¶ç²˜è´´æ­¤ä»¤ç‰Œã€‚ä»¤ç‰Œåœ¨æ¥ä¸‹æ¥çš„ 30 åˆ†é’Ÿå†…æœ‰æ•ˆã€‚# è¡¥å……è¯´æ˜ï¼šç”Ÿæˆæ–°çš„kibanaæ³¨å†Œä»¤ç‰Œï¼šbin/elasticsearch-create-enrollment-token -s kibanaâ€¢ Copy the following enrollment token and paste it into Kibana in your browser (valid for the next 30 minutes): eyJ2ZXIiOiI4LjE0LjAiLCJhZHIiOlsiMTAuMjUwLjAuMjM5OjkyMDAiXSwiZmdyIjoiM2YxNDFjMTZkZmM2ZTE2NTg5NGJjMTY3MjA4NGIyMjBkY2RkMjJmZmUwMjExNmQ1MWFjMTgwMDNjZmFhNWExZCIsImtleSI6ImFSWFBzcFVCTVVmc1d5aUJnbjBtOmRzbVBLQV95UXhDZkJpXzQyWDNEMVEifQ==# æä¾›äº†å°†æ–°çš„ Elasticsearch èŠ‚ç‚¹åŠ å…¥ç°æœ‰é›†ç¾¤çš„æ­¥éª¤ã€‚â„¹ï¸ Configure other nodes to join this cluster:# ä½¿ç”¨ bin/elasticsearch --enrollment-token &lt;token&gt; å‘½ä»¤å¯åŠ¨æ–°çš„ Elasticsearch èŠ‚ç‚¹ã€‚ä»¤ç‰Œåœ¨æ¥ä¸‹æ¥çš„ 30 åˆ†é’Ÿå†…æœ‰æ•ˆã€‚# è¡¥å……è¯´æ˜ï¼šç”Ÿæˆæ–°çš„èŠ‚ç‚¹æ³¨å†Œä»¤ç‰Œï¼šbin/elasticsearch-create-enrollment-token -s nodeâ€¢ Copy the following enrollment token and start new Elasticsearch nodes with `bin/elasticsearch --enrollment-token &lt;token&gt;` (valid for the next 30 minutes): eyJ2ZXIiOiI4LjE0LjAiLCJhZHIiOlsiMTAuMjUwLjAuMjM5OjkyMDAiXSwiZmdyIjoiM2YxNDFjMTZkZmM2ZTE2NTg5NGJjMTY3MjA4NGIyMjBkY2RkMjJmZmUwMjExNmQ1MWFjMTgwMDNjZmFhNWExZCIsImtleSI6ImF4WFBzcFVCTVVmc1d5aUJnbjFtOkFEallPdnpzUzh1MGJqOFpfVFE4a3cifQ==# å¦‚æœä½ åœ¨ Docker ä¸­è¿è¡Œ Elasticsearchï¼Œå¯ä»¥ä½¿ç”¨ docker run -e &quot;ENROLLMENT_TOKEN=&lt;token&gt;&quot; docker.elastic.co/elasticsearch/elasticsearch:8.17.3 å‘½ä»¤å¯åŠ¨æ–°èŠ‚ç‚¹ã€‚ If you&#x27;re running in Docker, copy the enrollment token and run: `docker run -e &quot;ENROLLMENT_TOKEN=&lt;token&gt;&quot; docker.elastic.co/elasticsearch/elasticsearch:8.17.3`â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” ç™»å½•ç”¨æˆ·ä¸ºelastic[å…¶è§’è‰²ä¸ºè¶…çº§ç”¨æˆ·]ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ—¥å¿—æŸ¥çœ‹åˆå§‹çš„å¯†ç ï¼Œä¹Ÿå¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤é‡ç½®å¯†ç  1234567891011# é‡ç½®å¯†ç ï¼Œå¯†ç è‡ªåŠ¨ç”Ÿæˆbin/elasticsearch-reset-password -u elastic# é‡ç½®å¯†ç ï¼Œè‡ªå·±è¾“å…¥è¦è®¾ç½®çš„å¯†ç ï¼Œæ¯”å¦‚æˆ‘è¿™é‡Œè¿™æ˜¯ä¸º 123456bin/elasticsearch-reset-password -u elastic -i# é€šè¿‡curlé‡ç½®å¯†ç curl -X PUT -u elastic:old_password -k &#x27;https://127.0.0.1:9200/_security/user/elastic/_password&#x27; \\ -H &#x27;Content-Type: application/json&#x27; \\ -d &#x27;&#123; &quot;password&quot;: &quot;new_password&quot; &#125;&#x27; curl è®¿é—®ESæœåŠ¡ 123456789101112131415161718192021222324# -k å¿½ç•¥è¯ä¹¦æ ¡éªŒcurl -u elastic:123456 -k https://127.0.0.1:9200# æˆ–è€… å°†è®¤è¯ä¿¡æ¯é€šè¿‡headerä¼ é€’ï¼Œelastic:123456 é€šè¿‡base64åŠ å¯†curl -k https://127.0.0.1:9200 -H &#x27;Authorization: Basic ZWxhc3RpYzoxMjM0NTY=&#x27;# ä¹Ÿå¯ä»¥é€šè¿‡è¯ä¹¦è®¿é—®httpsæœåŠ¡ï¼Œè¿™ä¸ªè¯ä¹¦å°±æ˜¯ESåœ¨å¼€å¯å®‰å…¨è®¤è¯å¯åŠ¨æ—¶è‡ªåŠ¨ç”Ÿæˆçš„curl -u elastic:123456 --cacert /usr/local/elasticsearch/elasticsearch-8.17.3/config/certs/http_ca.crt https://127.0.0.1:9200# è¾“å‡ºå¦‚ä¸‹ï¼š&#123; &quot;name&quot; : &quot;node-1&quot;, &quot;cluster_name&quot; : &quot;test-elk&quot;, &quot;cluster_uuid&quot; : &quot;RykjCSPnSCi4Hsi37uziWw&quot;, &quot;version&quot; : &#123; &quot;number&quot; : &quot;8.17.3&quot;, &quot;build_flavor&quot; : &quot;default&quot;, &quot;build_type&quot; : &quot;tar&quot;, &quot;build_hash&quot; : &quot;a091390de485bd4b127884f7e565c0cad59b10d2&quot;, &quot;build_date&quot; : &quot;2025-02-28T10:07:26.089129809Z&quot;, &quot;build_snapshot&quot; : false, &quot;lucene_version&quot; : &quot;9.12.0&quot;, &quot;minimum_wire_compatibility_version&quot; : &quot;7.17.0&quot;, &quot;minimum_index_compatibility_version&quot; : &quot;7.0.0&quot; &#125;, &quot;tagline&quot; : &quot;You Know, for Search&quot;&#125; å¼€å‘æ¨¡å¼å’Œç”Ÿäº§æ¨¡å¼ å¼€å‘æ¨¡å¼ï¼šå¦‚æœç”¨æˆ·åªæ˜¯å‡ºäºå­¦ä¹ ç›®çš„ï¼Œå¯ä»¥åœ¨é…ç½®æ–‡ä»¶ä¸­æ·»åŠ  discovery.type=single-node ï¼Œè¡¨ç¤ºå•èŠ‚ç‚¹æ¨¡å¼ï¼Œå³å¼€å‘æ¨¡å¼ã€‚æ­¤æ¨¡å¼å¯ä»¥ç»•è¿‡å¼•å¯¼æ£€æŸ¥ã€‚ ç”Ÿäº§æ¨¡å¼ï¼šå½“ç”¨æˆ·é…ç½®äº†æœ‰å…³é›†ç¾¤çš„ç›¸å…³é…ç½®é¡¹æ—¶å°±ä¼šè§¦å‘ç”Ÿäº§æ¨¡å¼ï¼Œåœ¨ç”Ÿäº§æ¨¡å¼ä¸‹ï¼ŒæœåŠ¡å¯åŠ¨ä¼šè§¦å‘ESçš„å¼•å¯¼æ£€æŸ¥æˆ–è€…å«å¯åŠ¨æ£€æŸ¥ï¼ˆbootstrap checksï¼‰ï¼Œå¼•å¯¼æ£€æŸ¥ååˆ†ä¸¥æ ¼ï¼Œå³æŸäº›æ£€æŸ¥é¡¹ä¸é€šè¿‡åˆ™ESæœåŠ¡å°†æ— æ³•å¯åŠ¨ã€‚ å¼•å¯¼æ£€æŸ¥ï¼šåœ¨æœåŠ¡å¯åŠ¨ä¹‹å‰å¯¹ä¸€äº›é‡è¦çš„é…ç½®é¡¹è¿›è¡Œæ£€æŸ¥ï¼Œæ£€æŸ¥å…¶é…ç½®å€¼æ˜¯å¦æ˜¯åˆç†çš„ã€‚å¼•å¯¼æ£€æŸ¥åŒ…æ‹¬å¯¹JVMå¤§å°ã€å†…å­˜é”ã€è™šæ‹Ÿå†…å­˜ã€æœ€å¤§çº¿ç¨‹æ•°ã€é›†ç¾¤å‘ç°ç›¸å…³é…ç½®ç­‰ç›¸å…³çš„æ£€æŸ¥ï¼Œå¦‚æœæŸä¸€é¡¹æˆ–è€…å‡ é¡¹çš„é…ç½®ä¸åˆç†ï¼ŒESä¼šæ‹’ç»å¯åŠ¨æœåŠ¡ï¼Œå¹¶ä¸”åœ¨å¼€å‘æ¨¡å¼ä¸‹çš„æŸäº›è­¦å‘Šä¿¡æ¯ä¼šå‡çº§æˆé”™è¯¯ä¿¡æ¯è¾“å‡ºã€‚å¼•å¯¼æ£€æŸ¥ååˆ†ä¸¥æ ¼ï¼Œä¹‹æ‰€ä»¥å®å¯æ‹’ç»æœåŠ¡ä¹Ÿè¦é˜»æ­¢ç”¨æˆ·å¯åŠ¨æœåŠ¡æ˜¯ä¸ºäº†é˜²æ­¢ç”¨æˆ·åœ¨å¯¹ESçš„åŸºæœ¬ä½¿ç”¨ä¸äº†è§£çš„å‰æä¸‹å¯åŠ¨æœåŠ¡è€Œå¯¼è‡´çš„åæœŸæ€§èƒ½é—®é¢˜æ— æ³•è§£å†³æˆ–è€…è§£å†³èµ·æ¥å¾ˆéº»çƒ¦ã€‚å› ä¸ºä¸€æ—¦æœåŠ¡ä»¥æŸç§ä¸åˆç†çš„é…ç½®å¯åŠ¨ï¼Œæ—¶é—´ä¹…äº†ä¹‹åå¯èƒ½ä¼šäº§ç”Ÿè¾ƒå¤§çš„æ€§èƒ½é—®é¢˜ï¼Œä½†æ­¤æ—¶é›†ç¾¤å·²ç»å˜å¾—éš¾ä»¥ç»´æŠ¤å’Œæ‰©å±•ï¼ŒESä¸ºäº†é¿å…è¿™ç§æƒ…å†µè€Œåšå‡ºäº†å¼•å¯¼æ£€æŸ¥çš„è®¾ç½®ï¼Œæœ¬æ¥åœ¨å¼€å‘æ¨¡å¼ä¸‹ä¸ºè­¦å‘Šçš„å¯åŠ¨æ—¥å¿—ä¼šå‡çº§ä¸ºæŠ¥é”™ï¼ˆErrorï¼‰ã€‚è¿™ç§è®¾å®šè™½ç„¶å¢åŠ äº†ç”¨æˆ·çš„ä½¿ç”¨é—¨æ§›ï¼Œä½†æ˜¯é¿å…äº†æ—¥åäº§ç”Ÿæ›´å¤§çš„é—®é¢˜ã€‚ ESæµè§ˆå™¨æ’ä»¶ Elasticvue : chrome/edge æ’ä»¶ï¼Œç”¨äºåœ¨æµè§ˆå™¨ä¸­æŸ¥çœ‹ESé›†ç¾¤ä¿¡æ¯ï¼ŒåŠŸèƒ½éå¸¸å¼ºå¤§ ESè‡ªå¯åŠ¨è„šæœ¬ 1234567891011121314151617181920212223242526272829303132333435# åˆ›å»ºæœåŠ¡æ–‡ä»¶$ vim /usr/lib/systemd/system/es.service[Unit]Description=elasticsearchDocumentation=https://www.elastic.coAfter=network.target[Service]Type=simplePrivateTmp=true# æŒ‡å®šESç”¨æˆ·User=elasticGroup=elasticLimitNOFILE=100000LimitNPROC=100000Restart=yes# å¯åŠ¨å‘½ä»¤ExecStart=/usr/local/elasticsearch/elasticsearch-8.17.3/bin/elasticsearchExecRestart=/bin/kill -s HUP $MAINPIDExecStop=/bin/kill -s QUIT $MAINPID[Install]WantedBy=multi-user.target# é‡æ–°åŠ è½½$ systemctl daemon-reload# å¯åŠ¨$ systemctl start es# åœæ­¢$ systemctl stop es# æŸ¥çœ‹çŠ¶æ€$ systemctl status es# è®¾ç½®å¼€æœºå¯åŠ¨$ systemctl enable es é€šè¿‡ApiKeyè®¿é—®ES å…³äºApiKeyçš„è¯¦ç»†ä»‹ç»ï¼Œå¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£ åˆ›å»ºApiKey 123456789101112131415161718192021222324252627282930curl -k &#x27;https://127.0.0.1:9200/_security/api_key?pretty&#x27; \\-u elastic:123456 \\--header &#x27;Content-Type: application/json&#x27; \\--data &#x27;&#123; &quot;name&quot;: &quot;elastic_api_key&quot;, &quot;expiration&quot;: &quot;1d&quot;&#125;&#x27;# è¯·æ±‚å‚æ•°è¯´æ˜ï¼š# name: ApiKeyçš„åç§°# expiration: ApiKeyçš„è¿‡æœŸæ—¶é—´ï¼Œè¿™é‡Œè®¾ç½®ä¸ºä¸€å¤©ï¼Œå¦‚æœä¸è®¾ç½®ï¼Œåˆ™æ°¸ä¸è¿‡æœŸ# è¯·æ±‚å‚æ•°ä¸­è¿˜æœ‰ä¸€ä¸ªé‡è¦çš„å‚æ•° `role_descriptors`ï¼Œå…¶å«ä¹‰æ˜¯ï¼ŒæŒ‡å®šApiKeyæ‰€æ‹¥æœ‰çš„æƒé™ï¼Œå³è§’è‰²ã€‚å¦‚æœä¸è¿›è¡Œè®¾ç½®ï¼Œåˆ™é»˜è®¤ä½¿ç”¨å½“å‰è®¤è¯ç”¨æˆ·çš„çš„è§’è‰²# metadata: ApiKeyçš„å…ƒæ•°æ®ï¼Œå³è‡ªå®šä¹‰çš„é”®å€¼å¯¹ï¼Œè¿™é‡Œå¯ä»¥ä¸è®¾ç½®# è¾“å‡ºï¼š&#123; &quot;id&quot;:&quot;70It0ZUBrL2GcOxX0d1L&quot;, &quot;name&quot;:&quot;elastic_api_key&quot;, &quot;expiration&quot;:1743057595723, &quot;api_key&quot;:&quot;s85lqVkmQISkBlgXCTJmDQ&quot;, &quot;encoded&quot;:&quot;NzBJdDBaVUJyTDJHY094WDBkMUw6czg1bHFWa21RSVNrQmxnWENUSm1EUQ==&quot;&#125;# è¾“å‡ºå‚æ•°è¯´æ˜ï¼š# id: ApiKeyçš„id# name: ApiKeyçš„åç§°# expiration: ApiKeyçš„è¿‡æœŸæ—¶é—´ï¼Œå•ä½ä¸ºæ¯«ç§’# api_key: ApiKeyçš„å¯†é’¥# encoded: å¯¹ `id:api_key` è¿›è¡Œbase64ç¼–ç ï¼Œå³å¯å¾—åˆ° `encoded` # echo -n &#x27;70It0ZUBrL2GcOxX0d1L:s85lqVkmQISkBlgXCTJmDQ&#x27; | base64 # è¾“å‡ºï¼š # NzBJdDBaVUJyTDJHY094WDBkMUw6czg1bHFWa21RSVNrQmxnWENUSm1EUQ== ä½¿ç”¨ApiKeyè®¿é—®ES 123456789101112131415161718192021# è¿™é‡Œçš„ApiKeyï¼Œå°±æ˜¯ä¸Šé¢è¾“å‡ºçš„encodedcurl -k &#x27;https://127.0.0.1:9200?pretty&#x27; \\-H &#x27;Authorization: ApiKey NzBJdDBaVUJyTDJHY094WDBkMUw6czg1bHFWa21RSVNrQmxnWENUSm1EUQ==&#x27;# è¾“å‡º&#123; &quot;name&quot; : &quot;node-1&quot;, &quot;cluster_name&quot; : &quot;test-elk&quot;, &quot;cluster_uuid&quot; : &quot;RykjCSPnSCi4Hsi37uziWw&quot;, &quot;version&quot; : &#123; &quot;number&quot; : &quot;8.17.3&quot;, &quot;build_flavor&quot; : &quot;default&quot;, &quot;build_type&quot; : &quot;tar&quot;, &quot;build_hash&quot; : &quot;a091390de485bd4b127884f7e565c0cad59b10d2&quot;, &quot;build_date&quot; : &quot;2025-02-28T10:07:26.089129809Z&quot;, &quot;build_snapshot&quot; : false, &quot;lucene_version&quot; : &quot;9.12.0&quot;, &quot;minimum_wire_compatibility_version&quot; : &quot;7.17.0&quot;, &quot;minimum_index_compatibility_version&quot; : &quot;7.0.0&quot; &#125;, &quot;tagline&quot; : &quot;You Know, for Search&quot;&#125; æŸ¥çœ‹ApiKeyä¿¡æ¯ï¼Œå‚è€ƒå®˜æ–¹æ–‡æ¡£ 123456789curl -u elastic:123456 -k &#x27;https://127.0.0.1:9200/_security/api_key?name=elastic_api_key&amp;pretty&#x27;# è¯·æ±‚å‚æ•°è¯´æ˜ï¼š# name: ApiKeyçš„åç§°ï¼Œä¸åŒçš„ApiKeyå¯ä»¥æ‹¥æœ‰ç›¸åŒçš„åç§°ï¼Œä½†idä¸åŒï¼Œæ‰€ä»¥é€šè¿‡nameè¿›è¡ŒæŸ¥è¯¢å¯èƒ½ä¼šè¿”å›å¤šä¸ªç»“æœ# æˆ–è€… id: ApiKeyçš„idï¼Œå»ºè®®é€šè¿‡idè¿›è¡ŒæŸ¥è¯¢ï¼Œidå”¯ä¸€ï¼Œæ‰€ä»¥é€šè¿‡idè¿›è¡ŒæŸ¥è¯¢åªä¼šè¿”å›ä¸€ä¸ªç»“æœ# username: æŸ¥è¯¢æŒ‡å®šç”¨æˆ·çš„ApiKey# owner: æ˜¯å¦åªæŸ¥è¯¢å½“å‰è®¤è¯ç”¨æˆ·åä¸‹çš„ApiKeyï¼Œé»˜è®¤ä¸ºfalseï¼Œä¸ºfalseæ—¶å¿…é¡»è‡³å°‘è®¾ç½®name\\ids\\usernameä¸­çš„ä¸€ä¸ªå‚æ•°# ä¸åŠ ä»»ä½•å‚æ•°è¿›è¡ŒæŸ¥è¯¢ï¼Œåˆ™è¿”å›æ‰€æœ‰ApiKeyçš„ä¿¡æ¯curl -u elastic:123456 -k &#x27;https://127.0.0.1:9200/_security/api_key?pretty&#x27; æ›´æ–°ApiKeyï¼Œå‚è€ƒå®˜æ–¹æ–‡æ¡£ 12345678910111213141516171819202122232425262728curl -u elastic:123456 -X PUT -k &#x27;https://127.0.0.1:9200/_security/api_key/&#123;ApiKeyId&#125;?pretty&#x27; \\--header &#x27;Content-Type: application/json&#x27; \\--data &#x27;&#123; &quot;expiration&quot;: &quot;1h&quot;, &quot;role_descriptors&quot;: &#123; &quot;role-a&quot;: &#123; &quot;indices&quot;: [ &#123; &quot;names&quot;: [&quot;*&quot;], &quot;privileges&quot;: [&quot;write&quot;] &#125; ] &#125; &#125;, &quot;metadata&quot;: &#123; &quot;environment&quot;: &#123; &quot;level&quot;: 2, &quot;trusted&quot;: true, &quot;tags&quot;: [&quot;production&quot;] &#125; &#125;&#125;&#x27;# å¯ä»¥æ›´æ–°çš„å‚æ•°æœ‰ï¼š# expiration: ApiKeyçš„è¿‡æœŸæ—¶é—´ï¼Œå¦‚æœå·²ç»è®¾ç½®è¿‡expirationï¼Œæ­¤æ—¶å¸Œæœ›ä½¿å…¶æ°¸ä¸è¿‡æœŸï¼Œåˆ™åªèƒ½å°†å…¶è®¾ç½®ä¸ºä¸€ä¸ªæ¯”è¾ƒå¤§çš„æ—¶é—´ï¼Œæ¯”å¦‚ &quot;expiration&quot;: &quot;100y&quot;# role_descriptors: ApiKeyæ‰€æ‹¥æœ‰çš„è§’è‰²ï¼ŒåŸå…ˆè®¾ç½®äº†role_descriptorsï¼Œæ›´æ–°æ—¶å¸Œæœ›å…¶ä½¿ç”¨è®¤è¯ç”¨æˆ·çš„è§’è‰²ï¼Œåˆ™æ­¤æ—¶å¯ä»¥å°†å…¶è®¾ç½®ä¸º &quot;role_descriptors&quot;: &#123;&#125;# metadata: ApiKeyçš„å…ƒæ•°æ®ï¼ŒåŸå…ˆè®¾ç½®äº† metadata ï¼Œæ›´æ–°æ—¶å¸Œæœ›å»é™¤æ‰€æœ‰ metadata ä¿¡æ¯ï¼Œåˆ™æ­¤æ—¶å¯ä»¥å°†å…¶è®¾ç½®ä¸º &quot;metadata&quot;: &#123;&#125;# æ³¨æ„ï¼šä¸‰ä¸ªå‚æ•°å¯ä»¥åªæ›´æ–°å…¶ä¸­ä»»ä½•ä¸€ä¸ªï¼Œæ›´æ–°å“ªä¸ªå°±åªæ›¿æ¢å“ªä¸ªï¼Œæ²¡æœ‰è¢«æ›´æ–°çš„å‚æ•°ä¸ä¼šå—åˆ°ä¿®æ”¹ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥åŒæ—¶æ›´æ–°å…¨éƒ¨ ç½®ApiKeyæ— æ•ˆï¼Œå‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼Œå®˜æ–¹æ²¡æœ‰æä¾›åˆ é™¤ApiKeyçš„æ¥å£ï¼Œåªæœ‰ç½®æ— æ•ˆçš„æ¥å£ 1234567891011121314151617181920212223curl -u elastic:123456 -X DELETE -k &#x27;https://127.0.0.1:9200/_security/api_key?pretty&#x27; \\--header &#x27;Content-Type: application/json&#x27; \\--data &#x27;&#123; &quot;name&quot;: &quot;elastic_api_key&quot;&#125;&#x27;# è¯·æ±‚å‚æ•°è¯´æ˜ï¼š# name: ApiKeyçš„åç§°ï¼Œä¼š# æˆ–è€…ä½¿ç”¨ &quot;ids&quot; : [ &quot;70It0ZUBrL2GcOxX0d1L&quot; ] ï¼Œé€šè¿‡idè¿›è¡Œåˆ é™¤ï¼Œæ­¤æ—¶å¯ä»¥ä¸€æ¬¡åˆ é™¤å¤šä¸ªApiKey# username: åˆ é™¤æŒ‡å®šç”¨æˆ·çš„ApiKey# owner: æ˜¯å¦åªåˆ é™¤å½“å‰è®¤è¯ç”¨æˆ·åä¸‹çš„ApiKeyï¼Œé»˜è®¤ä¸ºfalseï¼Œä¸ºfalseæ—¶å¿…é¡»è‡³å°‘è®¾ç½®name\\ids\\usernameä¸­çš„ä¸€ä¸ªå‚æ•°# è¾“å‡ºï¼š&#123; &quot;invalidated_api_keys&quot;:[ &quot;70It0ZUBrL2GcOxX0d1L&quot; ], &quot;previously_invalidated_api_keys&quot;:[ ], &quot;error_count&quot;:0&#125;# è¾“å‡ºå‚æ•°è¯´æ˜ï¼š# invalidated_api_keys: è¢«åˆ é™¤çš„ApiKeyçš„idåˆ—è¡¨# previously_invalidated_api_keys: ä¹‹å‰è¢«åˆ é™¤çš„ApiKeyçš„idåˆ—è¡¨# error_count: é”™è¯¯æ•°é‡ï¼Œå¦‚æœä¸º0ï¼Œåˆ™è¡¨ç¤ºæˆåŠŸ ä½¿ç”¨ApiKeyçš„ä¼˜ç¼ºç‚¹ ä¼˜ç‚¹ 12345678910111213å®‰å…¨æ€§: ç»†ç²’åº¦æ§åˆ¶: API Key å¯ä»¥ä¸ç‰¹å®šçš„è§’è‰²æè¿°ç¬¦å…³è”ï¼Œå…è®¸éå¸¸ç»†åŒ–çš„æƒé™æ§åˆ¶ã€‚è¿™æœ‰åŠ©äºéµå¾ªæœ€å°æƒé™åŸåˆ™ï¼Œåªæˆäºˆå¿…è¦çš„è®¿é—®æƒé™ã€‚ æ—¶é—´é™åˆ¶: å¯ä»¥ä¸º API Key è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œç¡®ä¿å¯†é’¥ä¸ä¼šæ°¸è¿œæœ‰æ•ˆï¼Œå‡å°‘é•¿æœŸæ³„éœ²çš„é£é™©ã€‚ å¯æ’¤é”€æ€§: å¦‚æœæ€€ç–‘æŸä¸ª API Key è¢«æ³„éœ²æˆ–ä¸å†éœ€è¦ï¼Œå¯ä»¥éšæ—¶æ’¤é”€è¯¥å¯†é’¥ï¼Œæé«˜å®‰å…¨æ€§ã€‚æ–¹ä¾¿æ€§: æ˜“äºç”Ÿæˆå’Œç®¡ç†: åˆ›å»ºå’Œç®¡ç† API Key çš„è¿‡ç¨‹é€šå¸¸å¾ˆç®€å•ï¼Œå¯ä»¥é€šè¿‡ REST API æˆ– Kibana ç•Œé¢è¿›è¡Œã€‚ æ— éœ€ç”¨æˆ·äº¤äº’: ä¸€æ—¦ç”Ÿæˆï¼ŒAPI Key å¯ä»¥ç›´æ¥ç”¨äºè‡ªåŠ¨åŒ–è„šæœ¬æˆ–åº”ç”¨ç¨‹åºï¼Œæ— éœ€ç”¨æˆ·æ‰‹åŠ¨ç™»å½•æˆ–æä¾›å‡­æ®ã€‚å®¡è®¡å’Œç›‘æ§: è·Ÿè¸ªä½¿ç”¨æƒ…å†µ: é€šè¿‡æ—¥å¿—è®°å½•å’Œå®¡è®¡åŠŸèƒ½ï¼Œå¯ä»¥è·Ÿè¸ªå“ªä¸ª API Key è¿›è¡Œäº†å“ªäº›æ“ä½œï¼Œä¾¿äºå®‰å…¨å®¡è®¡å’Œé—®é¢˜æ’æŸ¥ã€‚ æ´»åŠ¨ç›‘æ§: å¯ä»¥ç›‘æ§ API Key çš„æ´»åŠ¨ï¼ŒåŠæ—¶å‘ç°å¼‚å¸¸è¡Œä¸ºï¼Œå¹¶é‡‡å–ç›¸åº”çš„æªæ–½ã€‚çµæ´»æ€§: å¤šç§ç”¨é€”: API Key å¯ä»¥ç”¨äºå„ç§ç”¨é€”ï¼Œå¦‚åº”ç”¨ç¨‹åºé›†æˆã€æ•°æ®å¯¼å…¥å¯¼å‡ºã€ç›‘æ§å·¥å…·ç­‰ã€‚ å¤šç¯å¢ƒæ”¯æŒ: å¯ä»¥ä¸ºä¸åŒçš„ç¯å¢ƒï¼ˆå¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ï¼‰ç”Ÿæˆç‹¬ç«‹çš„ API Keyï¼Œç¡®ä¿å„ç¯å¢ƒä¹‹é—´çš„éš”ç¦»ã€‚ ç¼ºç‚¹ 1234567891011å®‰å…¨æ€§é£é™©: å¯†é’¥å­˜å‚¨: API Key éœ€è¦å®‰å…¨åœ°å­˜å‚¨å’Œä¼ è¾“ï¼Œå¦‚æœå¯†é’¥è¢«æ³„éœ²ï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨å®ƒè¿›è¡Œæœªæˆæƒçš„æ“ä½œã€‚ é™æ€å‡­è¯: ä¸åŠ¨æ€çš„èº«ä»½éªŒè¯æœºåˆ¶ï¼ˆå¦‚ OAuth ä»¤ç‰Œï¼‰ç›¸æ¯”ï¼ŒAPI Key æ˜¯é™æ€çš„ï¼Œä¸€æ—¦æ³„éœ²å¯èƒ½ä¼šå¯¼è‡´é•¿æœŸçš„å®‰å…¨é£é™©ã€‚ç®¡ç†å¤æ‚æ€§: å¯†é’¥ç®¡ç†: éšç€æ—¶é—´å’Œä½¿ç”¨è§„æ¨¡çš„å¢é•¿ï¼Œç®¡ç†å’Œç»´æŠ¤å¤§é‡ API Key å¯èƒ½ä¼šå˜å¾—å¤æ‚ã€‚éœ€è¦å®šæœŸæ›´æ–°å’Œæ’¤é”€è€æ—§çš„å¯†é’¥ã€‚ è§’è‰²åˆ†é…: ç»†ç²’åº¦çš„æƒé™æ§åˆ¶è™½ç„¶æä¾›äº†å®‰å…¨æ€§ï¼Œä½†ä¹Ÿå¢åŠ äº†é…ç½®å’Œç®¡ç†çš„å¤æ‚æ€§ã€‚ç¼ºä¹ç”¨æˆ·ä¸Šä¸‹æ–‡: åŒ¿åæ€§: API Key é€šå¸¸æ²¡æœ‰ç”¨æˆ·ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œä¸åƒåŸºäºç”¨æˆ·çš„è®¤è¯æœºåˆ¶ï¼ˆå¦‚ Basic Auth æˆ– OAuthï¼‰ï¼Œè¿™å¯èƒ½ä¸åˆ©äºæŸäº›ä¾èµ–ç”¨æˆ·èº«ä»½çš„åŠŸèƒ½ã€‚ä¾èµ–å®¢æˆ·ç«¯é…ç½®: æ˜“é”™æ€§: å¦‚æœå®¢æˆ·ç«¯é…ç½®ä¸å½“ï¼Œå¦‚é”™è¯¯åœ°å¤„ç†æˆ–æš´éœ² API Keyï¼Œå¯èƒ½ä¼šå¯¼è‡´å®‰å…¨æ¼æ´ã€‚ æ›´æ–°æŒ‘æˆ˜: æ›´æ–° API Key åï¼Œæ‰€æœ‰ä½¿ç”¨è¯¥å¯†é’¥çš„å®¢æˆ·ç«¯éƒ½éœ€è¦åŒæ­¥æ›´æ–°ï¼Œè¿™åœ¨å¤§è§„æ¨¡ç¯å¢ƒä¸­å¯èƒ½æ˜¯ä¸€ä¸ªæŒ‘æˆ˜ã€‚ ä½•æ—¶ä½¿ç”¨ API Key å½“æ‚¨éœ€è¦ä¸ºè‡ªåŠ¨åŒ–è„šæœ¬ã€ç¬¬ä¸‰æ–¹æœåŠ¡æˆ–åº”ç”¨ç¨‹åºæä¾›è®¿é—®æƒé™æ—¶ã€‚ å½“æ‚¨å¸Œæœ›å®ç°ç»†ç²’åº¦çš„æƒé™æ§åˆ¶å¹¶èƒ½å¤Ÿè½»æ¾ç®¡ç†å¯†é’¥çš„ç”Ÿå‘½å‘¨æœŸæ—¶ã€‚ å½“ä¸éœ€è¦ç”¨æˆ·ä¸Šä¸‹æ–‡æˆ–å¤æ‚çš„ç”¨æˆ·ä¼šè¯ç®¡ç†æ—¶ã€‚ ç¤ºä¾‹ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177# åˆ›å»ºApiKeycurl -X POST -k &#x27;https://127.0.0.1:9200/_security/api_key?pretty&#x27; \\-u elastic:123456 \\--header &#x27;Content-Type: application/json&#x27; \\--data &#x27;&#123; &quot;name&quot;: &quot;my-api-key&quot;, &quot;expiration&quot;: &quot;1d&quot;, &quot;role_descriptors&quot;: &#123; &quot;role-a&quot;: &#123; &quot;cluster&quot;: [&quot;all&quot;], &quot;indices&quot;: [ &#123; &quot;names&quot;: [&quot;index-a*&quot;], &quot;privileges&quot;: [&quot;read&quot;] &#125; ] &#125;, &quot;role-b&quot;: &#123; &quot;cluster&quot;: [&quot;all&quot;], &quot;indices&quot;: [ &#123; &quot;names&quot;: [&quot;index-b*&quot;], &quot;privileges&quot;: [&quot;all&quot;] &#125; ] &#125; &#125;, &quot;metadata&quot;: &#123; &quot;application&quot;: &quot;my-application&quot;, &quot;environment&quot;: &#123; &quot;level&quot;: 1, &quot;trusted&quot;: true, &quot;tags&quot;: [&quot;dev&quot;, &quot;staging&quot;] &#125; &#125;&#125;&#x27;# name: ApiKeyçš„åç§°# expiration: ApiKeyçš„è¿‡æœŸæ—¶é—´ï¼Œæ”¯æŒçš„æ—¶é—´å•ä½ä¸ºï¼šsï¼ˆç§’ï¼‰ï¼Œmï¼ˆåˆ†é’Ÿï¼‰ï¼Œhï¼ˆå°æ—¶ï¼‰ï¼Œdï¼ˆå¤©ï¼‰ï¼Œwï¼ˆå‘¨ï¼‰ï¼ŒMï¼ˆæœˆï¼‰ï¼Œyï¼ˆå¹´ï¼‰ # expirationä¸èƒ½è®¾ç½®å°äº1åˆ†é’Ÿçš„æ—¶é—´ï¼Œå¦‚æœçœç•¥expirationï¼Œåˆ™è¡¨ç¤ºæ— è¿‡æœŸæ—¶é—´# role_descriptors: è§’è‰²æè¿°ç¬¦ï¼ŒåŒ…å«å¤šä¸ªè§’è‰² # role-a: è§’è‰²æè¿°ç¬¦åç§°ï¼ŒåŒ…å«é›†ç¾¤å’Œç´¢å¼•çš„æƒé™æè¿° # cluster: é›†ç¾¤æƒé™ # all: è¡¨ç¤ºæ‹¥æœ‰å…¨éƒ¨é›†ç¾¤æƒé™ # manage: å¯ä»¥ç®¡ç†é›†ç¾¤è®¾ç½®ã€æ¨¡æ¿å’ŒèŠ‚ç‚¹ä¸Šçš„åˆ†ç‰‡åˆ†é…ã€‚ # monitor: å¯ä»¥ç›‘è§†é›†ç¾¤çš„çŠ¶æ€ã€‚ # manage_security: å¯ä»¥ç®¡ç†å®‰å…¨è®¾ç½®ï¼Œå¦‚ç”¨æˆ·ã€è§’è‰²å’Œè§’è‰²æ˜ å°„ã€‚ # manage_api_key: ç®¡ç† API Key # indices: ç´¢å¼•æƒé™ï¼ŒåŒ…å«nameså’Œprivilegesï¼Œ # names: è¡¨ç¤ºç´¢å¼•åç§°ï¼Œindex-a*è¡¨ç¤ºæ‰€æœ‰ä»¥index-aå¼€å¤´çš„ç´¢å¼•ï¼Œallè¡¨ç¤ºæ‰€æœ‰ç´¢å¼• # privileges: è¡¨ç¤ºç´¢å¼•æƒé™ # read: è¡¨ç¤ºæ‹¥æœ‰ç´¢å¼•çš„è¯»å–æƒé™ # write: è¡¨ç¤ºæ‹¥æœ‰ç´¢å¼•çš„å†™å…¥æƒé™ # delete: è¡¨ç¤ºæ‹¥æœ‰ç´¢å¼•çš„åˆ é™¤æƒé™ # index: è¡¨ç¤ºæ‹¥æœ‰ç´¢å¼•çš„ç´¢å¼•æƒé™ # manage: è¡¨ç¤ºæ‹¥æœ‰ç´¢å¼•çš„è®¾ç½®å’Œæ˜ å°„æƒé™ # monitor: è¡¨ç¤ºæ‹¥æœ‰ç´¢å¼•çš„ç›‘æ§æƒé™ # create_index: è¡¨ç¤ºå…è®¸åˆ›å»ºç´¢å¼• # crud: ç»„åˆäº† read, index, delete æƒé™ # all: è¡¨ç¤ºæ‹¥æœ‰å…¨éƒ¨ç´¢å¼•æƒé™ # allow_restricted_indices: è¡¨ç¤ºæ˜¯å¦å…è®¸å¯¹ restricted indices(å—é™åˆ¶ç´¢å¼•ï¼Œæ¯”å¦‚ä»¥.å¼€å¤´çš„ç´¢å¼•) è¿›è¡Œæ“ä½œï¼Œtrueè¡¨ç¤ºå…è®¸ï¼Œfalseè¡¨ç¤ºä¸å…è®¸# metadata: å…ƒæ•°æ® # application: è¡¨ç¤ºåº”ç”¨ç¨‹åºåç§° # environment: è¡¨ç¤ºç¯å¢ƒä¿¡æ¯ # level: è¡¨ç¤ºç¯å¢ƒçº§åˆ« # trusted: è¡¨ç¤ºæ˜¯å¦å—ä¿¡ä»» # tags: è¡¨ç¤ºç¯å¢ƒæ ‡ç­¾# è¾“å‡ºï¼š&#123; &quot;id&quot; : &quot;-kKu0ZUBrL2GcOxX0t1R&quot;, &quot;name&quot; : &quot;my-api-key&quot;, &quot;expiration&quot; : 1743066050130, &quot;api_key&quot; : &quot;03eNOYg_SCCHdzc0orsRvw&quot;, &quot;encoded&quot; : &quot;LWtLdTBaVUJyTDJHY094WDB0MVI6MDNlTk9ZZ19TQ0NIZHpjMG9yc1J2dw==&quot;&#125;# æŸ¥çœ‹ApiKeyä¿¡æ¯ï¼Œæ ¹æ®idæŸ¥è¯¢åªä¼šè¿”å›ä¸€ä¸ªApiKeyï¼Œæ ¹æ®nameæŸ¥è¯¢ä¼šè¿”å›å¤šä¸ªApiKeycurl -u elastic:123456 -k &#x27;https://127.0.0.1:9200/_security/api_key?id=-kKu0ZUBrL2GcOxX0t1R&amp;pretty&#x27;# è¾“å‡ºï¼š&#123; &quot;api_keys&quot; : [ &#123; &quot;id&quot; : &quot;-kKu0ZUBrL2GcOxX0t1R&quot;, &quot;name&quot; : &quot;my-api-key&quot;, &quot;type&quot; : &quot;rest&quot;, &quot;creation&quot; : 1742979650130, &quot;expiration&quot; : 1743066050130, &quot;invalidated&quot; : false, &quot;username&quot; : &quot;elastic&quot;, &quot;realm&quot; : &quot;reserved&quot;, &quot;realm_type&quot; : &quot;reserved&quot;, &quot;metadata&quot; : &#123; &quot;environment&quot; : &#123; &quot;level&quot; : 1, &quot;trusted&quot; : true, &quot;tags&quot; : [ &quot;dev&quot;, &quot;staging&quot; ] &#125;, &quot;application&quot; : &quot;my-application&quot; &#125;, &quot;role_descriptors&quot; : &#123; &quot;role-a&quot; : &#123; &quot;cluster&quot; : [ &quot;all&quot; ], &quot;indices&quot; : [ &#123; &quot;names&quot; : [ &quot;index-a*&quot; ], &quot;privileges&quot; : [ &quot;read&quot; ], &quot;allow_restricted_indices&quot; : false &#125; ], &quot;applications&quot; : [ ], &quot;run_as&quot; : [ ], &quot;metadata&quot; : &#123; &#125;, &quot;transient_metadata&quot; : &#123; &quot;enabled&quot; : true &#125; &#125;, &quot;role-b&quot; : &#123; &quot;cluster&quot; : [ &quot;all&quot; ], &quot;indices&quot; : [ &#123; &quot;names&quot; : [ &quot;index-b*&quot; ], &quot;privileges&quot; : [ &quot;all&quot; ], &quot;allow_restricted_indices&quot; : false &#125; ], &quot;applications&quot; : [ ], &quot;run_as&quot; : [ ], &quot;metadata&quot; : &#123; &#125;, &quot;transient_metadata&quot; : &#123; &quot;enabled&quot; : true &#125; &#125; &#125; &#125; ]&#125;# æ›´æ–°ApiKeycurl -u elastic:123456 -X PUT -k &#x27;https://127.0.0.1:9200/_security/api_key/-kKu0ZUBrL2GcOxX0t1R?pretty&#x27; \\--header &#x27;Content-Type: application/json&#x27; \\--data &#x27;&#123; &quot;metadata&quot;: &#123;&#125;&#125;&#x27;# è¾“å‡ºï¼š&#123; &quot;updated&quot; : true&#125;# ç½®ApiKeyæ— æ•ˆcurl -u elastic:123456 -X DELETE -k &#x27;https://127.0.0.1:9200/_security/api_key?pretty&#x27; \\--header &#x27;Content-Type: application/json&#x27; \\--data &#x27;&#123; &quot;ids&quot; : [ &quot;-kKu0ZUBrL2GcOxX0t1R&quot; ]&#125;&#x27;# è¾“å‡ºï¼š&#123; &quot;invalidated_api_keys&quot; : [ &quot;-kKu0ZUBrL2GcOxX0t1R&quot; ], &quot;previously_invalidated_api_keys&quot; : [ ], &quot;error_count&quot; : 0&#125;","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç»å¦‚ä½•åœ¨linuxä¸‹å®‰è£…Elasticsearch Elasticsearchç‰ˆæœ¬8.17.3","date_published":"2025-03-20T13:30:05.000Z","tags":["æŠ€æœ¯","elastic","elasticsearch","elasticsearch"]},{"id":"https://blog.hanqunfeng.com/2025/03/13/npm-study/","url":"https://blog.hanqunfeng.com/2025/03/13/npm-study/","title":"npmä½¿ç”¨æ‰‹å†Œ","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç»å¦‚ä½•ä½¿ç”¨npm</p>\n</li>\n<li class=\"lvl-2\">\n<p>npmç‰ˆæœ¬10.5.0</p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"npmç®€ä»‹\">npmç®€ä»‹</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>npmï¼ˆNode Package Managerï¼‰æ˜¯ Node.js çš„åŒ…ç®¡ç†å·¥å…·ï¼Œä¹Ÿæ˜¯ JavaScript ç¼–ç¨‹ç¤¾åŒºä¸­æœ€å¸¸ç”¨çš„ç®¡ç†å’Œåˆ†äº«ä»£ç çš„å·¥å…·ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å®ƒå…è®¸å¼€å‘è€…è½»æ¾åœ°å®‰è£…ã€å…±äº«ã€å’Œç®¡ç†åœ¨é¡¹ç›®ä¸­ä½¿ç”¨çš„ JavaScript åŒ…ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>npm åˆ†ä¸ºä¸¤ä¸ªä¸»è¦éƒ¨åˆ†ï¼šå‘½ä»¤è¡Œå·¥å…·ï¼ˆCLIï¼‰å’Œ npm æ³¨å†Œè¡¨ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å‘½ä»¤è¡Œå·¥å…·ï¼ˆCLIï¼‰ï¼šç”¨äºä¸æ³¨å†Œè¡¨è¿›è¡Œäº¤äº’ï¼Œå®‰è£…å’Œç®¡ç†é¡¹ç›®ä¸­çš„ä¾èµ–ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>npm æ³¨å†Œè¡¨ï¼šä¸€ä¸ªåœ¨çº¿çš„æ•°æ®åº“ï¼Œå­˜å‚¨äº†æ•°ç™¾ä¸‡ä¸ªå¼€æºçš„ Node.js åŒ…ï¼Œå¼€å‘è€…å¯ä»¥åœ¨è‡ªå·±çš„é¡¹ç›®ä¸­ä½¿ç”¨è¿™äº›åŒ…ã€‚</p>\n</li>\n</ul>\n<h2 id=\"npm-çš„å®‰è£…ä¸é…ç½®\">npm çš„å®‰è£…ä¸é…ç½®</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>npm é€šå¸¸ä¸ Node.js ä¸€èµ·å®‰è£…ï¼Œå› æ­¤å®‰è£… Node.js ä¼šè‡ªåŠ¨å®‰è£… npmã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä» <a href=\"https://nodejs.org/zh-cn\">Node.js å®˜ç½‘</a>ä¸‹è½½å¹¶å®‰è£… Node.jsã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>è·Ÿéš<a href=\"https://nodejs.org/zh-cn/download\">Node.js å®˜ç½‘â€“Download</a>çš„æç¤ºå®Œæˆ Node.js çš„å®‰è£…ï¼Œ</p>\n</li>\n<li class=\"lvl-2\">\n<p>ç°åœ¨å®˜æ–¹æ›´æ¨èä½¿ç”¨<a href=\"https://github.com/nvm-sh/nvm\">nvm</a>çš„æ–¹å¼è¿›è¡Œå®‰è£…ï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥é€‰æ‹©å¯¹åº”ç³»ç»Ÿçš„äºŒè¿›åˆ¶åŒ…è¿›è¡Œå®‰è£…ï¼ˆæ­¤ç§æ–¹æ³•è¦å°†nodeçš„binç›®å½•é…ç½®åˆ°PATHç¯å¢ƒå˜é‡ï¼‰ï¼Œnode.jså®‰è£…å®Œæˆåï¼Œnpm ä¹Ÿä¼šä¸€èµ·å®‰è£…ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>æ‰“å¼€å‘½ä»¤è¡Œæˆ–ç»ˆç«¯å·¥å…·ï¼Œè¾“å…¥ä»¥ä¸‹å‘½ä»¤æ¥éªŒè¯æ˜¯å¦æˆåŠŸå®‰è£…</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm -v</span><br><span class=\"line\">node -v</span><br></pre></td></tr></table></figure>\n<h2 id=\"npm-å¸¸ç”¨å‘½ä»¤\">npm å¸¸ç”¨å‘½ä»¤</h2>\n<h3 id=\"npm-initï¼šåˆå§‹åŒ–é¡¹ç›®\">npm initï¼šåˆå§‹åŒ–é¡¹ç›®</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>npm initå‘½ä»¤ç”¨äºåˆå§‹åŒ–ä¸€ä¸ªæ–°çš„ Node.js é¡¹ç›®ï¼Œç”Ÿæˆä¸€ä¸ªpackage.jsonæ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«é¡¹ç›®çš„å…ƒæ•°æ®å’Œé…ç½®ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">mkdir</span> my-project</span><br><span class=\"line\"><span class=\"built_in\">cd</span> my-project</span><br><span class=\"line\">npm init</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ‰§è¡Œè¯¥å‘½ä»¤åï¼Œä¼šæŒ‰ç…§æç¤ºè¾“å…¥ä¸€äº›é¡¹ç›®ç›¸å…³çš„ä¿¡æ¯ï¼Œå¦‚åç§°ã€ç‰ˆæœ¬ã€æè¿°ç­‰ã€‚ä¹Ÿå¯ä»¥ä½¿ç”¨ <code>npm init -y</code> è·³è¿‡æç¤ºï¼Œç”Ÿæˆä¸€ä¸ªé»˜è®¤çš„package.jsonæ–‡ä»¶ã€‚</p>\n</li>\n</ul>\n<h3 id=\"npm-createï¼šåŸºäºæ¨¡æ¿åˆ›å»ºé¡¹ç›®\">npm createï¼šåŸºäºæ¨¡æ¿åˆ›å»ºé¡¹ç›®</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>npm createå‘½ä»¤ç”¨äºåŸºäºæ¨¡æ¿åˆ›å»ºä¸€ä¸ªæ–°çš„ Node.js é¡¹ç›®ï¼Œæ¯”å¦‚æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªåŸºäºVueçš„Webé¡¹ç›®ï¼Œå¯ä»¥æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm create vue@latest</span><br></pre></td></tr></table></figure>\n<h3 id=\"npm-installï¼šå®‰è£…ä¾èµ–åŒ…\">npm installï¼šå®‰è£…ä¾èµ–åŒ…</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>npm installå‘½ä»¤ç”¨äºå®‰è£…é¡¹ç›®ä¸­æ‰€éœ€çš„ä¾èµ–åŒ…ï¼Œæ¯”å¦‚åœ¨package.jsonæ–‡ä»¶ä¸­æŒ‡å®šäº†ä¾èµ–åŒ…ï¼Œå¯ä»¥æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å®‰è£…å®Œæˆåï¼Œä¼šåœ¨node_modulesç›®å½•ä¸‹ç”Ÿæˆä¾èµ–åŒ…ï¼Œå¹¶æ›´æ–°package-lock.jsonæ–‡ä»¶ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å®‰è£…æŒ‡å®šä¾èµ–åŒ…ï¼Œé»˜è®¤å®‰è£…æœ€æ–°ç‰ˆï¼Œè‡ªåŠ¨å°†ä¾èµ–åŒ…æ·»åŠ åˆ° package.json çš„ â€œdependenciesâ€ éƒ¨åˆ†ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install express</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¦‚æœéœ€è¦å®‰è£…ç‰¹å®šçš„ç‰ˆæœ¬ï¼Œå¯ä»¥æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install express@4.17.1</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å®‰è£…å¼€å‘ä¾èµ–åŒ…ï¼Œå®‰è£…å¹¶å†™å…¥package.jsonçš„&quot;devDependencies&quot;ä¸­</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install express -D</span><br><span class=\"line\"><span class=\"comment\"># ç­‰ä»·äº</span></span><br><span class=\"line\">npm install express --save-dev</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å®‰è£…å…¨å±€ä¾èµ–åŒ…</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å…¨å±€å®‰è£…çš„åŒ…ä¼šè¢«å®‰è£…åˆ°å…¨å±€çš„node_modulesç›®å½•ä¸‹ï¼Œä¸ä¼šè¢«å®‰è£…åˆ°é¡¹ç›®ç›®å½•ä¸‹ï¼Œä¹Ÿä¸ä¼šå‡ºç°åœ¨package.jsonä¸­</span></span><br><span class=\"line\">npm install express -g</span><br><span class=\"line\"><span class=\"comment\"># ç­‰ä»·äº</span></span><br><span class=\"line\">npm install express --global</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å…¨å±€node_modulesç›®å½•è·¯å¾„æŸ¥çœ‹</span></span><br><span class=\"line\">npm root -g</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä»æœ¬åœ°å®‰è£…ä¾èµ–åŒ…</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ä»æœ¬åœ°å®‰è£…</span></span><br><span class=\"line\">npm install ./path/to/local_project</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä»è¿œç¨‹Gitä»“åº“å®‰è£…ä¾èµ–åŒ…</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å®‰è£…å…¬å…±é¡¹ç›®ï¼š</span></span><br><span class=\"line\"><span class=\"comment\"># npm install https://github.com/user_name/node_project</span></span><br><span class=\"line\">npm install https://github.com/trentm/json.git</span><br><span class=\"line\"><span class=\"comment\"># ç¼©å†™ï¼Œå¦‚æœæ˜¯gitlabä»“åº“ï¼Œåˆ™éœ€è¦ä½¿ç”¨gitlabå‰ç¼€ï¼Œæ¨èä½¿ç”¨ä¸Šé¢çš„å®Œæ•´è¯­ä¹‰ç‰ˆæœ¬</span></span><br><span class=\"line\">npm install github:trentm/json</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å®‰è£…ç‰¹å®šæäº¤ï¼š</span></span><br><span class=\"line\"><span class=\"comment\"># npm install https://github.com/user_name/node_project#commit</span></span><br><span class=\"line\">npm install https://github.com/trentm/json.git\\#6912b25272312d0f13ad32e98ebc1b4deb6334cc</span><br><span class=\"line\"><span class=\"comment\"># å®‰è£…ç‰¹å®šåˆ†æ”¯ï¼š</span></span><br><span class=\"line\"><span class=\"comment\"># npm install https://github.com/user_name/node_project#branchName</span></span><br><span class=\"line\">npm install https://github.com/trentm/json.git\\#streaming</span><br><span class=\"line\"><span class=\"comment\"># é€šè¿‡æ ‡ç­¾å®‰è£…ï¼š</span></span><br><span class=\"line\"><span class=\"comment\"># npm install https://github.com/user_name/node_project#tag</span></span><br><span class=\"line\">npm install https://github.com/trentm/json.git\\#10.0.0</span><br><span class=\"line\"><span class=\"comment\"># å®‰è£…ç‰¹å®šç‰ˆæœ¬ï¼š</span></span><br><span class=\"line\"><span class=\"comment\"># npm install https://github.com/user_name/node_project#version</span></span><br><span class=\"line\">npm install https://github.com/trentm/json.git\\#10.0.0</span><br><span class=\"line\"><span class=\"comment\"># å®Œæ•´çš„è¯­ä¹‰ç‰ˆæœ¬ï¼š</span></span><br><span class=\"line\">npm install https://github.com/trentm/json.git\\#semver:v10.0.0</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ä½¿ç”¨gitçš„ssh repo link å®‰è£…ç§æœ‰åº“ï¼šåé¢åŒæ ·å¯ä»¥æ¥ commitã€branchNameã€tagã€versionç­‰</span></span><br><span class=\"line\"><span class=\"comment\"># npm install git+ssh://git@github.com:user_name/node_project.git</span></span><br><span class=\"line\">npm install git+ssh://git@github.com/trentm/json.git</span><br></pre></td></tr></table></figure>\n<h3 id=\"npm-updateï¼šæ›´æ–°ä¾èµ–åŒ…\">npm updateï¼šæ›´æ–°ä¾èµ–åŒ…</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>npm updateå‘½ä»¤ç”¨äºæ›´æ–°é¡¹ç›®ä¸­çš„ä¾èµ–åŒ…ï¼Œæ¯”å¦‚è¦æ›´æ–°expressä¾èµ–åŒ…åˆ°æœ€æ–°ç‰ˆæœ¬ï¼Œå¯ä»¥æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æ›´æ–°ç”Ÿäº§ç¯å¢ƒä¾èµ–åŒ…</span></span><br><span class=\"line\">npm update express</span><br><span class=\"line\"><span class=\"comment\"># æ›´æ–°å¼€å‘ç¯å¢ƒä¾èµ–åŒ…</span></span><br><span class=\"line\">npm update express -D</span><br><span class=\"line\"><span class=\"comment\"># å…¨å±€æ›´æ–°</span></span><br><span class=\"line\">npm update express -g</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¿®æ”¹äº†package.jsonæ–‡ä»¶ï¼Œå¹¶å¸Œæœ›æ›´æ–°ä¾èµ–åŒ…ï¼Œå¯ä»¥æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># #ä¸ºäº†é¿å…ä¸å¿…è¦çš„éº»çƒ¦ï¼Œå¯ä»¥å…ˆåˆ é™¤é¡¹ç›®ä¸­çš„node_modulesæ–‡ä»¶å¤¹åœ¨æ‰§è¡Œï¼Œæ­¤æ—¶å’Œ npm install ä¸€æ ·</span></span><br><span class=\"line\">npm update</span><br></pre></td></tr></table></figure>\n<h3 id=\"npm-outdateï¼šæ£€æŸ¥å“ªäº›åŒ…å¯ä»¥å‡çº§\">npm outdateï¼šæ£€æŸ¥å“ªäº›åŒ…å¯ä»¥å‡çº§</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>npm outdateå‘½ä»¤ç”¨äºæ£€æŸ¥å“ªäº›åŒ…å¯ä»¥å‡çº§</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æ£€æŸ¥å½“å‰é¡¹ç›®ä¸‹å“ªäº›åŒ…å¯ä»¥å‡çº§</span></span><br><span class=\"line\">npm outdate</span><br><span class=\"line\"><span class=\"comment\"># æ£€æŸ¥æŒ‡å®šåŒ…</span></span><br><span class=\"line\">npm outdated express</span><br><span class=\"line\"><span class=\"comment\"># æ£€æŸ¥å…¨å±€æ¨¡å—</span></span><br><span class=\"line\">npm outdate -g</span><br><span class=\"line\">npm outdated -g express</span><br></pre></td></tr></table></figure>\n<h3 id=\"npm-upgradeï¼šåˆ¤æ–­package-jsonå“ªäº›åŒ…éœ€è¦å‡çº§\">npm-upgradeï¼šåˆ¤æ–­package.jsonå“ªäº›åŒ…éœ€è¦å‡çº§</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å®‰è£…</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install -g npm-upgrade</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä½¿ç”¨</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åˆ¤æ–­package.jsonå“ªäº›åŒ…éœ€è¦å‡çº§ï¼Œç”¨æˆ·ç¡®è®¤åä¼šè‡ªåŠ¨æ›´æ–°package.jsonæ–‡ä»¶ï¼Œæ­¤æ—¶åªæ˜¯æ›´æ–°æ–‡ä»¶ï¼Œå¹¶æ²¡æœ‰çœŸæ­£å‡çº§</span></span><br><span class=\"line\">npm-upgrade</span><br><span class=\"line\"><span class=\"comment\"># åŸºäºpackage.jsonä¸­çš„é…ç½®è¿›è¡Œå‡çº§ï¼Œå¯ä»¥å…ˆåˆ é™¤node_moduleså†æ‰§è¡Œï¼Œæ­¤æ—¶å’Œ npm install ä¸€æ ·</span></span><br><span class=\"line\">npm update</span><br></pre></td></tr></table></figure>\n<h3 id=\"npm-listï¼šåˆ—å‡ºä¾èµ–åŒ…\">npm listï¼šåˆ—å‡ºä¾èµ–åŒ…</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>npm listå‘½ä»¤ç”¨äºåˆ—å‡ºé¡¹ç›®ä¸­çš„ä¾èµ–åŒ…ï¼Œæ¯”å¦‚è¦åˆ—å‡ºå½“å‰é¡¹ç›®ä¸‹çš„ä¾èµ–åŒ…ï¼Œå¯ä»¥æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æ­¤æ—¶åˆ—å‡ºçš„æ˜¯package.jsonä¸­çš„dependenciesä¾èµ–åŒ…</span></span><br><span class=\"line\">npm list</span><br><span class=\"line\"><span class=\"comment\"># åˆ—å‡ºå¼€å‘ä¾èµ–åŒ…ï¼Œæ­¤æ—¶ä¼šåˆ—å‡ºpackage.jsonä¸­çš„devDependencieså’Œdependenciesä¾èµ–åŒ…</span></span><br><span class=\"line\">npm list -D</span><br><span class=\"line\"><span class=\"comment\"># åˆ—å‡ºæŒ‡å®šåŒ…</span></span><br><span class=\"line\">npm list express</span><br><span class=\"line\"><span class=\"comment\"># åˆ—å‡ºå…¨å±€æ¨¡å—</span></span><br><span class=\"line\">npm list -g</span><br><span class=\"line\">npm list -g express</span><br></pre></td></tr></table></figure>\n<h3 id=\"npm-uninstallï¼šå¸è½½ä¾èµ–åŒ…\">npm uninstallï¼šå¸è½½ä¾èµ–åŒ…</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>npm uninstallå‘½ä»¤ç”¨äºå¸è½½é¡¹ç›®ä¸­çš„ä¾èµ–åŒ…ï¼Œæ¯”å¦‚è¦å¸è½½expressä¾èµ–åŒ…ï¼Œå¯ä»¥æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm uninstall express</span><br><span class=\"line\"><span class=\"comment\"># åˆ é™¤å…¨å±€æ¨¡å—</span></span><br><span class=\"line\">npm uninstall -g express</span><br></pre></td></tr></table></figure>\n<h3 id=\"npm-searchï¼šæœç´¢ä¾èµ–åŒ…\">npm searchï¼šæœç´¢ä¾èµ–åŒ…</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>npm searchå‘½ä»¤ç”¨äºæœç´¢ä¾èµ–åŒ…ï¼Œæ¯”å¦‚è¦æœç´¢expressä¾èµ–åŒ…ï¼Œå¯ä»¥æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm search express</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¯ä»¥ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æœç´¢ä¾èµ–åŒ…ï¼Œæ¯”å¦‚è¦æœç´¢ä»¥expresså¼€å¤´çš„ä¾èµ–åŒ…ï¼Œå¯ä»¥æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm search /^express/</span><br></pre></td></tr></table></figure>\n<h3 id=\"npm-view-npm-infoï¼šæŸ¥çœ‹åŒ…ä¿¡æ¯\">npm view == npm infoï¼šæŸ¥çœ‹åŒ…ä¿¡æ¯</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>npm viewå‘½ä»¤ç”¨äºæŸ¥çœ‹åŒ…çš„ä¿¡æ¯ï¼Œæ¯”å¦‚è¦æŸ¥çœ‹expressä¾èµ–åŒ…çš„ä¿¡æ¯ï¼Œå¯ä»¥æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm view express</span><br><span class=\"line\"><span class=\"comment\"># æˆ–è€…ï¼Œviewä¸infoå‘½ä»¤å¯ä»¥äº’æ¢ä½¿ç”¨</span></span><br><span class=\"line\">npm info express</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>npm viewå‘½ä»¤è¿˜å¯ä»¥æŸ¥çœ‹åŒ…çš„æ‰€æœ‰ç‰ˆæœ¬ä¿¡æ¯ï¼Œæ¯”å¦‚è¦æŸ¥çœ‹expressä¾èµ–åŒ…çš„æ‰€æœ‰ç‰ˆæœ¬ä¿¡æ¯ï¼Œå¯ä»¥æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æ­¤æ—¶æˆ‘ä»¬ä»ç»“æœä¸­é€‰æ‹©ä¸€ä¸ªç‰ˆæœ¬è¿›è¡Œå®‰è£…å³å¯</span></span><br><span class=\"line\">npm view express versions</span><br></pre></td></tr></table></figure>\n<h3 id=\"npm-homeï¼šæ‰“å¼€åŒ…çš„ä¸»é¡µ\">npm homeï¼šæ‰“å¼€åŒ…çš„ä¸»é¡µ</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ‰“å¼€æŸä¸ª npm åŒ…çš„ä¸»é¡µï¼ˆé€šå¸¸æ˜¯ GitHub ä¸»é¡µæˆ– npm é¡µé¢ï¼‰ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm home express</span><br></pre></td></tr></table></figure>\n<h2 id=\"npm-é•œåƒæº\">npm é•œåƒæº</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>npm é»˜è®¤ä½¿ç”¨å®˜æ–¹çš„é•œåƒæºï¼Œä½†æ˜¯å®˜æ–¹çš„é•œåƒæºé€Ÿåº¦å¾ˆæ…¢ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç¬¬ä¸‰æ–¹çš„é•œåƒæºæ¥åŠ é€Ÿä¸‹è½½ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm å®˜æ–¹åŸå§‹é•œåƒç½‘å€æ˜¯ï¼šhttps://registry.npmjs.org/</span><br><span class=\"line\">æ·˜å® NPM é•œåƒï¼šhttp://registry.npmmirror.com</span><br><span class=\"line\">é˜¿é‡Œäº‘ NPM é•œåƒï¼šhttps://npm.aliyun.com</span><br><span class=\"line\">è…¾è®¯äº‘ NPM é•œåƒï¼šhttps://mirrors.cloud.tencent.com/npm/</span><br><span class=\"line\">åä¸ºäº‘ NPM é•œåƒï¼šhttps://mirrors.huaweicloud.com/repository/npm/</span><br><span class=\"line\">ç½‘æ˜“ NPM é•œåƒï¼šhttps://mirrors.163.com/npm/</span><br><span class=\"line\">ä¸­å›½ç§‘å­¦æŠ€æœ¯å¤§å­¦å¼€æºé•œåƒç«™ï¼šhttp://mirrors.ustc.edu.cn/</span><br><span class=\"line\">æ¸…åå¤§å­¦å¼€æºé•œåƒç«™ï¼šhttps://mirrors.tuna.tsinghua.edu.cn/</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤æ¥æŸ¥çœ‹å½“å‰ä½¿ç”¨çš„é•œåƒæºï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm config get registry</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤æ¥è®¾ç½®é•œåƒæºï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm config <span class=\"built_in\">set</span> registry https://registry.npmmirror.com</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤æ¥åˆ é™¤ç”¨æˆ·é…ç½®çš„é•œåƒæºï¼Œåˆ é™¤åæ¢å¤ä¸ºé»˜è®¤é•œåƒæºï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm config delete registry</span><br></pre></td></tr></table></figure>\n<h2 id=\"npm-é…ç½®\">npm é…ç½®</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤æ¥æŸ¥çœ‹npmçš„é…ç½®ä¿¡æ¯ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹å…¨å±€é…ç½®ä¿¡æ¯ï¼Œåªæ˜¾ç¤ºç”¨æˆ·è‡ªå®šä¹‰çš„é…ç½®ä¿¡æ¯</span></span><br><span class=\"line\">npm config list</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹å…¨å±€é…ç½®ä¿¡æ¯ï¼Œæ˜¾ç¤ºæ‰€æœ‰é…ç½®ä¿¡æ¯åŠå…¶é»˜è®¤ç¼ºçœå€¼</span></span><br><span class=\"line\">npm config <span class=\"built_in\">ls</span> -l</span><br><span class=\"line\"><span class=\"comment\"># json æ ¼å¼ æ˜¾ç¤ºå…¨éƒ¨é…ç½®ä¿¡æ¯</span></span><br><span class=\"line\">npm config list --json</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>é»˜è®¤å…¨å±€é…ç½®åœ¨å½“å‰ç”¨æˆ·HOMEç›®å½•ä¸‹çš„.npmrcæ–‡ä»¶ä¸­ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤æ¥æŸ¥çœ‹å…¨å±€é…ç½®ä¿¡æ¯ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cat</span> ~/.npmrc</span><br><span class=\"line\"><span class=\"built_in\">cat</span> ~/.npmrc | grep registry</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»ºä¸€ä¸ª.npmrc æ–‡ä»¶å¯ä»¥ä¸ºè¯¥é¡¹ç›®å•ç‹¬è®¾ç½® npm é…ç½®ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>npm config å…è®¸ä½ æ§åˆ¶ npm çš„è¡Œä¸ºï¼ŒåŒ…æ‹¬ å®‰è£…ç›®å½•ã€ä»£ç†ã€æ—¥å¿—çº§åˆ«ã€ä¾èµ–ç®¡ç† ç­‰ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä½ å¯ä»¥ä½¿ç”¨ <code>npm config get &lt;key&gt;</code> æŸ¥çœ‹å€¼ï¼Œ<code>npm config set &lt;key&gt; &lt;value&gt;</code> è¿›è¡Œä¿®æ”¹ï¼Œ<code>npm config delete &lt;key&gt;</code> åˆ é™¤è®¾ç½®ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>npmå¸¸ç”¨é…ç½®</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>é…ç½®é¡¹</th>\n<th>ä½œç”¨</th>\n<th>é»˜è®¤å€¼</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>prefix</td>\n<td>è®¾ç½® npm å…¨å±€å®‰è£…çš„è·¯å¾„ï¼ˆnpm install -g å½±å“çš„ç›®å½•ï¼‰</td>\n<td>ç¯å¢ƒå˜é‡ NODE_HOME æˆ– /usr/localï¼ˆç³»ç»Ÿï¼‰</td>\n</tr>\n<tr>\n<td>cache</td>\n<td>npm çš„ç¼“å­˜ç›®å½•</td>\n<td>~/.npm</td>\n</tr>\n<tr>\n<td>registry</td>\n<td>æŒ‡å®š npm çš„åŒ…ç®¡ç†ä»“åº“åœ°å€ï¼ˆå¦‚å®˜æ–¹ã€æ·˜å®é•œåƒï¼‰</td>\n<td><a href=\"https://registry.npmjs.org/\">https://registry.npmjs.org/</a></td>\n</tr>\n<tr>\n<td>strict-ssl</td>\n<td>æ˜¯å¦å¼ºåˆ¶ä½¿ç”¨ HTTPS è¿›è¡Œ npm æ“ä½œ</td>\n<td>true</td>\n</tr>\n<tr>\n<td>proxy</td>\n<td>é…ç½® HTTP ä»£ç†</td>\n<td>null</td>\n</tr>\n<tr>\n<td>https-proxy</td>\n<td>é…ç½® HTTPS ä»£ç†</td>\n<td>null</td>\n</tr>\n<tr>\n<td>init-author-name</td>\n<td>è®¾ç½® package.json é»˜è®¤ä½œè€…åç§°</td>\n<td>â€œâ€</td>\n</tr>\n<tr>\n<td>init-author-email</td>\n<td>è®¾ç½® package.json é»˜è®¤ä½œè€…é‚®ç®±</td>\n<td>â€œâ€</td>\n</tr>\n<tr>\n<td>init-author-url</td>\n<td>è®¾ç½® package.json é»˜è®¤ä½œè€…ç½‘ç«™</td>\n<td>â€œâ€</td>\n</tr>\n<tr>\n<td>init-license</td>\n<td>è®¾ç½® package.json é»˜è®¤è®¸å¯è¯</td>\n<td>â€œISCâ€</td>\n</tr>\n<tr>\n<td>init-version</td>\n<td>package.json é»˜è®¤ç‰ˆæœ¬å·</td>\n<td>â€œ1.0.0â€</td>\n</tr>\n<tr>\n<td>save-exact</td>\n<td>true æ—¶ï¼Œå®‰è£…ä¾èµ–æ—¶ä¸ä½¿ç”¨ ^ æˆ– ~ï¼Œç›´æ¥é”å®šç‰ˆæœ¬</td>\n<td>false</td>\n</tr>\n<tr>\n<td>engine-strict</td>\n<td>æ˜¯å¦å¼ºåˆ¶åŒ¹é… package.json çš„ engines å­—æ®µ</td>\n<td>false</td>\n</tr>\n<tr>\n<td>loglevel</td>\n<td>è®¾ç½®æ—¥å¿—è¾“å‡ºçº§åˆ«ï¼ˆsilent, error, warn, notice, info, verbose, sillyï¼‰</td>\n<td>notice</td>\n</tr>\n<tr>\n<td>fund</td>\n<td>æ˜¯å¦æ˜¾ç¤º package çš„èµ„é‡‘æ”¯æŒä¿¡æ¯</td>\n<td>true</td>\n</tr>\n<tr>\n<td>audit</td>\n<td>æ˜¯å¦å¯ç”¨å®‰å…¨å®¡è®¡</td>\n<td>true</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"npm-config-save-exact\">npm config save-exact</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ¨èé…ç½®ä¸º trueï¼Œé¿å…å› ä¸ºç‰ˆæœ¬æ›´æ–°å¯¼è‡´ä¾èµ–åŒ…ç‰ˆæœ¬ä¸åŒ¹é…</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm config <span class=\"built_in\">set</span> save-exact <span class=\"literal\">true</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"npm-config-loglevel\">npm config loglevel</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>loglevel å¯é€‰å€¼</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>çº§åˆ«</th>\n<th>è¯´æ˜</th>\n<th>é€‚ç”¨åœºæ™¯</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>silent</td>\n<td>ä¸è¾“å‡ºä»»ä½•æ—¥å¿—ï¼ˆé™¤éå‘ç”Ÿé”™è¯¯ï¼‰</td>\n<td>é€‚ç”¨äº CI/CD éœ€è¦æœ€å°‘æ—¥å¿—çš„ç¯å¢ƒ</td>\n</tr>\n<tr>\n<td>error</td>\n<td>ä»…æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯</td>\n<td>åªå…³å¿ƒ npm è¿è¡Œæ˜¯å¦å‡ºé”™</td>\n</tr>\n<tr>\n<td>warn</td>\n<td>æ˜¾ç¤ºè­¦å‘Šå’Œé”™è¯¯</td>\n<td>å‘ç°æ½œåœ¨é—®é¢˜ä½†ä¸å½±å“ä½¿ç”¨</td>\n</tr>\n<tr>\n<td>notice (é»˜è®¤)</td>\n<td>æ˜¾ç¤ºå…³é”®ä¿¡æ¯ã€è­¦å‘Šå’Œé”™è¯¯</td>\n<td>npm é»˜è®¤å€¼ï¼Œé€‚åˆå¤§å¤šæ•°åœºæ™¯</td>\n</tr>\n<tr>\n<td>http</td>\n<td>è®°å½• HTTP è¯·æ±‚çš„è¯¦ç»†ä¿¡æ¯</td>\n<td>ç”¨äºè°ƒè¯• npm ä¸‹è½½é€Ÿåº¦é—®é¢˜</td>\n</tr>\n<tr>\n<td>info</td>\n<td>æ˜¾ç¤ºä¸€èˆ¬ä¿¡æ¯ã€ä¾èµ–å®‰è£…æƒ…å†µç­‰</td>\n<td>é€‚ç”¨äºä¸€èˆ¬å¼€å‘è€…è°ƒè¯•</td>\n</tr>\n<tr>\n<td>verbose</td>\n<td>è¯¦ç»†çš„è°ƒè¯•ä¿¡æ¯</td>\n<td>é€‚ç”¨äºæ·±å…¥åˆ†æ npm è¿è¡Œæƒ…å†µ</td>\n</tr>\n<tr>\n<td>silly</td>\n<td>æœ€è¯¦ç»†çš„æ—¥å¿—ï¼ŒåŒ…å«æ‰€æœ‰è°ƒè¯•ä¿¡æ¯</td>\n<td>é€‚ç”¨äº npm å¼€å‘è€…æˆ–æç«¯è°ƒè¯•éœ€æ±‚</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è®¾ç½®æ–¹æ³•</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm config <span class=\"built_in\">set</span> loglevel verbose</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¸´æ—¶ä½¿ç”¨</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm --loglevel verbose install</span><br><span class=\"line\"><span class=\"comment\"># æˆ–è€…</span></span><br><span class=\"line\">npm -<span class=\"built_in\">dd</span> install</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#  æ”¯æŒå¿«æ·æ–¹å¼çš„å€¼ï¼š</span></span><br><span class=\"line\"><span class=\"comment\"># â€¢ -s, --silent: --loglevel silent</span></span><br><span class=\"line\"><span class=\"comment\"># â€¢ -q, --quiet: --loglevel warn</span></span><br><span class=\"line\"><span class=\"comment\"># â€¢ -d: --loglevel info</span></span><br><span class=\"line\"><span class=\"comment\"># â€¢ -dd, --verbose: --loglevel verbose</span></span><br><span class=\"line\"><span class=\"comment\"># â€¢ -ddd: --loglevel silly</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"npm-config-timing\">npm config timing</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>timing æ˜¯ npm çš„ä¸€ä¸ª æ—¥å¿—è¾“å‡ºé…ç½®é¡¹ï¼Œç”¨äºæ§åˆ¶æ˜¯å¦åœ¨å‘½ä»¤æ‰§è¡Œæ—¶æ˜¾ç¤ºè¯¦ç»†çš„æ—¶é—´ä¿¡æ¯ï¼Œé»˜è®¤å€¼ä¸º falseã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å½“ timing è®¾ä¸º true æ—¶ï¼Œnpm ä¼šåœ¨å‘½ä»¤æ‰§è¡Œç»“æŸå æ‰“å°è¯¦ç»†çš„æ—¶é—´ç»Ÿè®¡ä¿¡æ¯ï¼ŒåŒ…æ‹¬ï¼š</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-6\">æ¯ä¸ªå­ä»»åŠ¡çš„æ‰§è¡Œæ—¶é—´ï¼ˆå¦‚è§£æ package.jsonã€è§£æ node_modulesã€ä¸‹è½½ä¾èµ–ç­‰ï¼‰</li>\n<li class=\"lvl-6\">ç½‘ç»œè¯·æ±‚çš„è€—æ—¶</li>\n<li class=\"lvl-6\">ä¾èµ–è§£æå’Œå®‰è£…çš„è€—æ—¶</li>\n<li class=\"lvl-6\">æ•´ä½“æ‰§è¡Œçš„æ—¶é—´å¼€é”€</li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<p>è¿™å¯¹åˆ†æ npm æ€§èƒ½ã€ä¼˜åŒ–ä¾èµ–å®‰è£…é€Ÿåº¦éå¸¸æœ‰ç”¨ï¼Œç‰¹åˆ«æ˜¯åœ¨å¤§é¡¹ç›®æˆ– CI/CD ç¯å¢ƒä¸­ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å¯ç”¨ timing</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm config <span class=\"built_in\">set</span> timing <span class=\"literal\">true</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¸´æ—¶å¯ç”¨</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm --timing install</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>é€‚ç”¨åœºæ™¯</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-6\">åˆ†æ npm å‘½ä»¤æ‰§è¡Œæ—¶é—´ï¼Œä¼˜åŒ–æ„å»ºé€Ÿåº¦</li>\n<li class=\"lvl-6\">CI/CD ç¯å¢ƒä¸­æ’æŸ¥ npm å®‰è£…å˜æ…¢çš„åŸå› </li>\n<li class=\"lvl-6\">æ’æŸ¥ npm ä¾èµ–è§£æã€å®‰è£…æˆ–ä¸‹è½½è¿‡ç¨‹çš„æ€§èƒ½ç“¶é¢ˆ</li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<p>ä¸€èˆ¬æ—¥å¸¸å¼€å‘ï¼šæ—¥å¿—ä¼šå˜é•¿ï¼Œå¯èƒ½å½±å“å¯è¯»æ€§ï¼Œæ‰€ä»¥å†æ²¡æœ‰é‡åˆ°é—®é¢˜æ—¶ä¸å»ºè®®å¼€å¯</p>\n</li>\n</ul>\n<h2 id=\"npmã€pnpmã€yarn-ä¹‹é—´çš„è”ç³»å’ŒåŒºåˆ«\">npmã€pnpmã€yarn ä¹‹é—´çš„è”ç³»å’ŒåŒºåˆ«</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¿™ä¸‰è€…éƒ½æ˜¯ JavaScript ç”Ÿæ€ä¸­çš„åŒ…ç®¡ç†å·¥å…·ï¼Œä¸»è¦ç”¨äºå®‰è£…ã€ç®¡ç†å’Œè¿è¡Œ Node.js é¡¹ç›®çš„ä¾èµ–ã€‚å®ƒä»¬çš„å…³ç³»å¦‚ä¸‹ï¼š</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-6\">npmï¼ˆNode Package Managerï¼‰æ˜¯ Node.js å®˜æ–¹è‡ªå¸¦çš„åŒ…ç®¡ç†å·¥å…·ã€‚</li>\n<li class=\"lvl-6\"><a href=\"https://classic.yarnpkg.com/en/docs\">yarnï¼ˆYet Another Resource Negotiatorï¼‰</a>æ˜¯ Facebook å¼€å‘çš„æ›¿ä»£ npm çš„å·¥å…·ï¼Œæä¾›æ›´å¿«ã€æ›´å®‰å…¨çš„ä¾èµ–ç®¡ç†ã€‚</li>\n<li class=\"lvl-6\"><a href=\"https://pnpm.io/zh/\">pnpmï¼ˆPerformant npmï¼‰</a>æ˜¯ä¸€ä¸ªæ›´é«˜æ•ˆçš„ npm æ›¿ä»£å“ï¼Œä½¿ç”¨ç¡¬é“¾æ¥å’Œå»é‡æœºåˆ¶æ¥å‡å°‘ç£ç›˜å ç”¨å¹¶åŠ å¿«å®‰è£…é€Ÿåº¦ã€‚</li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<p>npmã€pnpmã€yarn çš„ä¸»è¦åŒºåˆ«</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>ç‰¹æ€§</th>\n<th>npm</th>\n<th>yarn</th>\n<th>pnpm</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>é»˜è®¤åŒ…ç®¡ç†æ–¹å¼</td>\n<td>ç›´æ¥å®‰è£…åˆ° node_modules/</td>\n<td>ç›´æ¥å®‰è£…åˆ° node_modules/</td>\n<td>ä½¿ç”¨ ç¡¬é“¾æ¥ + å…±äº«ä¾èµ–ï¼Œå ç”¨æ›´å°‘ç£ç›˜</td>\n</tr>\n<tr>\n<td>å®‰è£…é€Ÿåº¦</td>\n<td>5+ ç‰ˆæœ¬åé€Ÿåº¦è¾ƒå¿«ï¼Œä½†ä¾èµ–è§£æä»æœ‰æ€§èƒ½é—®é¢˜</td>\n<td>é€Ÿåº¦è¾ƒå¿«ï¼Œæ”¯æŒå¹¶è¡Œä¸‹è½½</td>\n<td>æœ€å¿«ï¼Œå»é‡èƒ½åŠ›å¼º</td>\n</tr>\n<tr>\n<td>ç£ç›˜å ç”¨</td>\n<td>è¾ƒå¤§ï¼ˆæ¯ä¸ªé¡¹ç›®éƒ½ä¼šå­˜ä¸€ä»½å®Œæ•´çš„ä¾èµ–ï¼‰</td>\n<td>è¾ƒå¤§ï¼ˆå’Œ npm ç±»ä¼¼ï¼‰</td>\n<td>æœ€å°ï¼ˆå…±äº«å…¨å±€ç¼“å­˜ï¼Œå¤šä¸ªé¡¹ç›®å…±ç”¨ä¾èµ–ï¼‰</td>\n</tr>\n<tr>\n<td>é”æ–‡ä»¶</td>\n<td>package-lock.json</td>\n<td>yarn.lock</td>\n<td>pnpm-lock.yaml</td>\n</tr>\n<tr>\n<td>å¹¶å‘å®‰è£…</td>\n<td>æ”¯æŒï¼ˆnpm 5+ ä¼˜åŒ–ï¼‰</td>\n<td>æ”¯æŒï¼ˆæ›´å¿«ï¼‰</td>\n<td>æ”¯æŒï¼ˆæœ€ä¼˜åŒ–ï¼‰</td>\n</tr>\n<tr>\n<td>å…¨å±€ç¼“å­˜</td>\n<td>æ”¯æŒï¼ˆä½†é¡¹ç›®ä»ä¼šå­˜å‰¯æœ¬ï¼‰</td>\n<td>æ”¯æŒï¼ˆä»ä¼šæ‹·è´åˆ° node_modules/ï¼‰</td>\n<td>å¼ºåˆ¶å¯ç”¨ï¼ˆå¤šä¸ªé¡¹ç›®å…±ç”¨ä¾èµ–ï¼ŒèŠ‚çœç©ºé—´ï¼‰</td>\n</tr>\n<tr>\n<td>monorepoï¼ˆå¤šåŒ…ç®¡ç†ï¼‰</td>\n<td>éœ€è¦æ‰‹åŠ¨é…ç½®</td>\n<td>æ”¯æŒ Workspaces</td>\n<td>åŸç”Ÿæ”¯æŒ Workspacesï¼ˆæœ€å¼ºå¤§ï¼‰</td>\n</tr>\n<tr>\n<td>å‘½ä»¤å…¼å®¹æ€§</td>\n<td>æ ‡å‡†</td>\n<td>å…¼å®¹ npmï¼Œéƒ¨åˆ†ä¸åŒ</td>\n<td>å…¼å®¹ npmï¼Œå¤§éƒ¨åˆ†å‘½ä»¤ç›¸åŒ</td>\n</tr>\n<tr>\n<td>è‡ªåŠ¨ä¿®å¤ package.json</td>\n<td>æ˜¯</td>\n<td>æ˜¯</td>\n<td>æ˜¯</td>\n</tr>\n<tr>\n<td>ç”Ÿæ€å…¼å®¹æ€§</td>\n<td>å®˜æ–¹æ ‡å‡†ï¼Œå…¼å®¹æ€§æœ€å¥½</td>\n<td>å…¼å®¹ npmï¼Œä½†éƒ¨åˆ†ç‰¹æ€§ä¸åŒ</td>\n<td>å…¼å®¹ npmï¼Œä½†é‡‡ç”¨ä¸åŒçš„ä¾èµ–ç®¡ç†æ–¹å¼</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¸¸è§å‘½ä»¤å¯¹æ¯”</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>ä»»åŠ¡</th>\n<th>npm</th>\n<th>yarn</th>\n<th>pnpm</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>åˆå§‹åŒ–é¡¹ç›®</td>\n<td>npm init</td>\n<td>yarn init</td>\n<td>pnpm init</td>\n</tr>\n<tr>\n<td>å®‰è£…ä¾èµ–</td>\n<td>npm install</td>\n<td>yarn install</td>\n<td>pnpm install</td>\n</tr>\n<tr>\n<td>å®‰è£…ç‰¹å®šä¾èµ–</td>\n<td>npm install lodash</td>\n<td>yarn add lodash</td>\n<td>pnpm add lodash</td>\n</tr>\n<tr>\n<td>å®‰è£…å¼€å‘ä¾èµ–</td>\n<td>npm install lodash -D</td>\n<td>yarn add lodash -D</td>\n<td>pnpm add lodash -D</td>\n</tr>\n<tr>\n<td>åˆ é™¤ä¾èµ–</td>\n<td>npm uninstall lodash</td>\n<td>yarn remove lodash</td>\n<td>pnpm remove lodash</td>\n</tr>\n<tr>\n<td>æ›´æ–°ä¾èµ–</td>\n<td>npm update lodash</td>\n<td>yarn upgrade lodash</td>\n<td>pnpm update lodash</td>\n</tr>\n<tr>\n<td>å…¨å±€å®‰è£…</td>\n<td>npm install -g serve</td>\n<td>yarn global add serve</td>\n<td>pnpm add -g serve</td>\n</tr>\n<tr>\n<td>è¿è¡Œè„šæœ¬</td>\n<td>npm run dev</td>\n<td>yarn dev</td>\n<td>pnpm dev</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä»€ä¹ˆæ—¶å€™ä½¿ç”¨ npmã€yarnã€pnpmï¼Ÿ</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-6\">\n<p>âœ… ä½¿ç”¨ pnpmï¼ˆæ¨èï¼‰ï¼š<br>\n1.ä½ å¸Œæœ›å‡å°‘ç£ç›˜å ç”¨ã€åŠ å¿«å®‰è£…é€Ÿåº¦<br>\n2.ä½ æ­£åœ¨å¼€å‘ monorepoï¼ˆå¤šåŒ…ï¼‰é¡¹ç›®<br>\n3.ä½ å¸Œæœ›æ›´é«˜æ•ˆåœ°ç®¡ç†ä¾èµ–</p>\n</li>\n<li class=\"lvl-6\">\n<p>âœ… ä½¿ç”¨ yarnï¼š<br>\n1.ä½ å¸Œæœ›æ›´å¿«çš„å®‰è£…é€Ÿåº¦ï¼Œä½†åˆä¸æƒ³æ”¹å˜ npm ä¼ ç»Ÿç»“æ„<br>\n2.ä½ çš„å›¢é˜Ÿä¹ æƒ¯ä½¿ç”¨ yarn.lock æ–‡ä»¶<br>\n3.ä½ åœ¨ç”¨ React Nativeï¼ˆå®˜æ–¹æ¨è yarnï¼‰</p>\n</li>\n<li class=\"lvl-6\">\n<p>âœ… ä½¿ç”¨ npmï¼ˆé€‚åˆç®€å•é¡¹ç›®ï¼‰ï¼š<br>\n1.ä½ å¸Œæœ›ä½¿ç”¨ Node.js å®˜æ–¹çš„é»˜è®¤å·¥å…·<br>\n2.ä½ ä¸æƒ³å®‰è£…é¢å¤–çš„åŒ…ç®¡ç†å·¥å…·<br>\n3.ä½ åœ¨å¼€å‘å°å‹é¡¹ç›®ï¼Œä¸éœ€è¦ workspaces</p>\n</li>\n</ul>\n</li>\n</ul>\n","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç»å¦‚ä½•ä½¿ç”¨npm npmç‰ˆæœ¬10.5.0 npmç®€ä»‹ npmï¼ˆNode Package Managerï¼‰æ˜¯ Node.js çš„åŒ…ç®¡ç†å·¥å…·ï¼Œä¹Ÿæ˜¯ JavaScript ç¼–ç¨‹ç¤¾åŒºä¸­æœ€å¸¸ç”¨çš„ç®¡ç†å’Œåˆ†äº«ä»£ç çš„å·¥å…·ã€‚ å®ƒå…è®¸å¼€å‘è€…è½»æ¾åœ°å®‰è£…ã€å…±äº«ã€å’Œç®¡ç†åœ¨é¡¹ç›®ä¸­ä½¿ç”¨çš„ JavaScript åŒ…ã€‚ npm åˆ†ä¸ºä¸¤ä¸ªä¸»è¦éƒ¨åˆ†ï¼šå‘½ä»¤è¡Œå·¥å…·ï¼ˆCLIï¼‰å’Œ npm æ³¨å†Œè¡¨ã€‚ å‘½ä»¤è¡Œå·¥å…·ï¼ˆCLIï¼‰ï¼šç”¨äºä¸æ³¨å†Œè¡¨è¿›è¡Œäº¤äº’ï¼Œå®‰è£…å’Œç®¡ç†é¡¹ç›®ä¸­çš„ä¾èµ–ã€‚ npm æ³¨å†Œè¡¨ï¼šä¸€ä¸ªåœ¨çº¿çš„æ•°æ®åº“ï¼Œå­˜å‚¨äº†æ•°ç™¾ä¸‡ä¸ªå¼€æºçš„ Node.js åŒ…ï¼Œå¼€å‘è€…å¯ä»¥åœ¨è‡ªå·±çš„é¡¹ç›®ä¸­ä½¿ç”¨è¿™äº›åŒ…ã€‚ npm çš„å®‰è£…ä¸é…ç½® npm é€šå¸¸ä¸ Node.js ä¸€èµ·å®‰è£…ï¼Œå› æ­¤å®‰è£… Node.js ä¼šè‡ªåŠ¨å®‰è£… npmã€‚ ä» Node.js å®˜ç½‘ä¸‹è½½å¹¶å®‰è£… Node.jsã€‚ è·ŸéšNode.js å®˜ç½‘â€“Downloadçš„æç¤ºå®Œæˆ Node.js çš„å®‰è£…ï¼Œ ç°åœ¨å®˜æ–¹æ›´æ¨èä½¿ç”¨nvmçš„æ–¹å¼è¿›è¡Œå®‰è£…ï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥é€‰æ‹©å¯¹åº”ç³»ç»Ÿçš„äºŒè¿›åˆ¶åŒ…è¿›è¡Œå®‰è£…ï¼ˆæ­¤ç§æ–¹æ³•è¦å°†nodeçš„binç›®å½•é…ç½®åˆ°PATHç¯å¢ƒå˜é‡ï¼‰ï¼Œnode.jså®‰è£…å®Œæˆåï¼Œnpm ä¹Ÿä¼šä¸€èµ·å®‰è£…ã€‚ æ‰“å¼€å‘½ä»¤è¡Œæˆ–ç»ˆç«¯å·¥å…·ï¼Œè¾“å…¥ä»¥ä¸‹å‘½ä»¤æ¥éªŒè¯æ˜¯å¦æˆåŠŸå®‰è£… 12npm -vnode -v npm å¸¸ç”¨å‘½ä»¤ npm initï¼šåˆå§‹åŒ–é¡¹ç›® npm initå‘½ä»¤ç”¨äºåˆå§‹åŒ–ä¸€ä¸ªæ–°çš„ Node.js é¡¹ç›®ï¼Œç”Ÿæˆä¸€ä¸ªpackage.jsonæ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«é¡¹ç›®çš„å…ƒæ•°æ®å’Œé…ç½®ã€‚ 123mkdir my-projectcd my-projectnpm init æ‰§è¡Œè¯¥å‘½ä»¤åï¼Œä¼šæŒ‰ç…§æç¤ºè¾“å…¥ä¸€äº›é¡¹ç›®ç›¸å…³çš„ä¿¡æ¯ï¼Œå¦‚åç§°ã€ç‰ˆæœ¬ã€æè¿°ç­‰ã€‚ä¹Ÿå¯ä»¥ä½¿ç”¨ npm init -y è·³è¿‡æç¤ºï¼Œç”Ÿæˆä¸€ä¸ªé»˜è®¤çš„package.jsonæ–‡ä»¶ã€‚ npm createï¼šåŸºäºæ¨¡æ¿åˆ›å»ºé¡¹ç›® npm createå‘½ä»¤ç”¨äºåŸºäºæ¨¡æ¿åˆ›å»ºä¸€ä¸ªæ–°çš„ Node.js é¡¹ç›®ï¼Œæ¯”å¦‚æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªåŸºäºVueçš„Webé¡¹ç›®ï¼Œå¯ä»¥æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š 1npm create vue@latest npm installï¼šå®‰è£…ä¾èµ–åŒ… npm installå‘½ä»¤ç”¨äºå®‰è£…é¡¹ç›®ä¸­æ‰€éœ€çš„ä¾èµ–åŒ…ï¼Œæ¯”å¦‚åœ¨package.jsonæ–‡ä»¶ä¸­æŒ‡å®šäº†ä¾èµ–åŒ…ï¼Œå¯ä»¥æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š 1npm install å®‰è£…å®Œæˆåï¼Œä¼šåœ¨node_modulesç›®å½•ä¸‹ç”Ÿæˆä¾èµ–åŒ…ï¼Œå¹¶æ›´æ–°package-lock.jsonæ–‡ä»¶ã€‚ å®‰è£…æŒ‡å®šä¾èµ–åŒ…ï¼Œé»˜è®¤å®‰è£…æœ€æ–°ç‰ˆï¼Œè‡ªåŠ¨å°†ä¾èµ–åŒ…æ·»åŠ åˆ° package.json çš„ â€œdependenciesâ€ éƒ¨åˆ†ã€‚ 1npm install express å¦‚æœéœ€è¦å®‰è£…ç‰¹å®šçš„ç‰ˆæœ¬ï¼Œå¯ä»¥æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š 1npm install express@4.17.1 å®‰è£…å¼€å‘ä¾èµ–åŒ…ï¼Œå®‰è£…å¹¶å†™å…¥package.jsonçš„&quot;devDependencies&quot;ä¸­ 123npm install express -D# ç­‰ä»·äºnpm install express --save-dev å®‰è£…å…¨å±€ä¾èµ–åŒ… 1234567# å…¨å±€å®‰è£…çš„åŒ…ä¼šè¢«å®‰è£…åˆ°å…¨å±€çš„node_modulesç›®å½•ä¸‹ï¼Œä¸ä¼šè¢«å®‰è£…åˆ°é¡¹ç›®ç›®å½•ä¸‹ï¼Œä¹Ÿä¸ä¼šå‡ºç°åœ¨package.jsonä¸­npm install express -g# ç­‰ä»·äºnpm install express --global# å…¨å±€node_modulesç›®å½•è·¯å¾„æŸ¥çœ‹npm root -g ä»æœ¬åœ°å®‰è£…ä¾èµ–åŒ… 12# ä»æœ¬åœ°å®‰è£…npm install ./path/to/local_project ä»è¿œç¨‹Gitä»“åº“å®‰è£…ä¾èµ–åŒ… 123456789101112131415161718192021222324# å®‰è£…å…¬å…±é¡¹ç›®ï¼š# npm install https://github.com/user_name/node_projectnpm install https://github.com/trentm/json.git# ç¼©å†™ï¼Œå¦‚æœæ˜¯gitlabä»“åº“ï¼Œåˆ™éœ€è¦ä½¿ç”¨gitlabå‰ç¼€ï¼Œæ¨èä½¿ç”¨ä¸Šé¢çš„å®Œæ•´è¯­ä¹‰ç‰ˆæœ¬npm install github:trentm/json# å®‰è£…ç‰¹å®šæäº¤ï¼š# npm install https://github.com/user_name/node_project#commitnpm install https://github.com/trentm/json.git\\#6912b25272312d0f13ad32e98ebc1b4deb6334cc# å®‰è£…ç‰¹å®šåˆ†æ”¯ï¼š# npm install https://github.com/user_name/node_project#branchNamenpm install https://github.com/trentm/json.git\\#streaming# é€šè¿‡æ ‡ç­¾å®‰è£…ï¼š# npm install https://github.com/user_name/node_project#tagnpm install https://github.com/trentm/json.git\\#10.0.0# å®‰è£…ç‰¹å®šç‰ˆæœ¬ï¼š# npm install https://github.com/user_name/node_project#versionnpm install https://github.com/trentm/json.git\\#10.0.0# å®Œæ•´çš„è¯­ä¹‰ç‰ˆæœ¬ï¼šnpm install https://github.com/trentm/json.git\\#semver:v10.0.0# ä½¿ç”¨gitçš„ssh repo link å®‰è£…ç§æœ‰åº“ï¼šåé¢åŒæ ·å¯ä»¥æ¥ commitã€branchNameã€tagã€versionç­‰# npm install git+ssh://git@github.com:user_name/node_project.gitnpm install git+ssh://git@github.com/trentm/json.git npm updateï¼šæ›´æ–°ä¾èµ–åŒ… npm updateå‘½ä»¤ç”¨äºæ›´æ–°é¡¹ç›®ä¸­çš„ä¾èµ–åŒ…ï¼Œæ¯”å¦‚è¦æ›´æ–°expressä¾èµ–åŒ…åˆ°æœ€æ–°ç‰ˆæœ¬ï¼Œå¯ä»¥æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š 123456# æ›´æ–°ç”Ÿäº§ç¯å¢ƒä¾èµ–åŒ…npm update express# æ›´æ–°å¼€å‘ç¯å¢ƒä¾èµ–åŒ…npm update express -D# å…¨å±€æ›´æ–°npm update express -g ä¿®æ”¹äº†package.jsonæ–‡ä»¶ï¼Œå¹¶å¸Œæœ›æ›´æ–°ä¾èµ–åŒ…ï¼Œå¯ä»¥æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š 12# #ä¸ºäº†é¿å…ä¸å¿…è¦çš„éº»çƒ¦ï¼Œå¯ä»¥å…ˆåˆ é™¤é¡¹ç›®ä¸­çš„node_modulesæ–‡ä»¶å¤¹åœ¨æ‰§è¡Œï¼Œæ­¤æ—¶å’Œ npm install ä¸€æ ·npm update npm outdateï¼šæ£€æŸ¥å“ªäº›åŒ…å¯ä»¥å‡çº§ npm outdateå‘½ä»¤ç”¨äºæ£€æŸ¥å“ªäº›åŒ…å¯ä»¥å‡çº§ 1234567# æ£€æŸ¥å½“å‰é¡¹ç›®ä¸‹å“ªäº›åŒ…å¯ä»¥å‡çº§npm outdate# æ£€æŸ¥æŒ‡å®šåŒ…npm outdated express# æ£€æŸ¥å…¨å±€æ¨¡å—npm outdate -gnpm outdated -g express npm-upgradeï¼šåˆ¤æ–­package.jsonå“ªäº›åŒ…éœ€è¦å‡çº§ å®‰è£… 1npm install -g npm-upgrade ä½¿ç”¨ 1234# åˆ¤æ–­package.jsonå“ªäº›åŒ…éœ€è¦å‡çº§ï¼Œç”¨æˆ·ç¡®è®¤åä¼šè‡ªåŠ¨æ›´æ–°package.jsonæ–‡ä»¶ï¼Œæ­¤æ—¶åªæ˜¯æ›´æ–°æ–‡ä»¶ï¼Œå¹¶æ²¡æœ‰çœŸæ­£å‡çº§npm-upgrade# åŸºäºpackage.jsonä¸­çš„é…ç½®è¿›è¡Œå‡çº§ï¼Œå¯ä»¥å…ˆåˆ é™¤node_moduleså†æ‰§è¡Œï¼Œæ­¤æ—¶å’Œ npm install ä¸€æ ·npm update npm listï¼šåˆ—å‡ºä¾èµ–åŒ… npm listå‘½ä»¤ç”¨äºåˆ—å‡ºé¡¹ç›®ä¸­çš„ä¾èµ–åŒ…ï¼Œæ¯”å¦‚è¦åˆ—å‡ºå½“å‰é¡¹ç›®ä¸‹çš„ä¾èµ–åŒ…ï¼Œå¯ä»¥æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š 123456789# æ­¤æ—¶åˆ—å‡ºçš„æ˜¯package.jsonä¸­çš„dependenciesä¾èµ–åŒ…npm list# åˆ—å‡ºå¼€å‘ä¾èµ–åŒ…ï¼Œæ­¤æ—¶ä¼šåˆ—å‡ºpackage.jsonä¸­çš„devDependencieså’Œdependenciesä¾èµ–åŒ…npm list -D# åˆ—å‡ºæŒ‡å®šåŒ…npm list express# åˆ—å‡ºå…¨å±€æ¨¡å—npm list -gnpm list -g express npm uninstallï¼šå¸è½½ä¾èµ–åŒ… npm uninstallå‘½ä»¤ç”¨äºå¸è½½é¡¹ç›®ä¸­çš„ä¾èµ–åŒ…ï¼Œæ¯”å¦‚è¦å¸è½½expressä¾èµ–åŒ…ï¼Œå¯ä»¥æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š 123npm uninstall express# åˆ é™¤å…¨å±€æ¨¡å—npm uninstall -g express npm searchï¼šæœç´¢ä¾èµ–åŒ… npm searchå‘½ä»¤ç”¨äºæœç´¢ä¾èµ–åŒ…ï¼Œæ¯”å¦‚è¦æœç´¢expressä¾èµ–åŒ…ï¼Œå¯ä»¥æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š 1npm search express å¯ä»¥ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æœç´¢ä¾èµ–åŒ…ï¼Œæ¯”å¦‚è¦æœç´¢ä»¥expresså¼€å¤´çš„ä¾èµ–åŒ…ï¼Œå¯ä»¥æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š 1npm search /^express/ npm view == npm infoï¼šæŸ¥çœ‹åŒ…ä¿¡æ¯ npm viewå‘½ä»¤ç”¨äºæŸ¥çœ‹åŒ…çš„ä¿¡æ¯ï¼Œæ¯”å¦‚è¦æŸ¥çœ‹expressä¾èµ–åŒ…çš„ä¿¡æ¯ï¼Œå¯ä»¥æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š 123npm view express# æˆ–è€…ï¼Œviewä¸infoå‘½ä»¤å¯ä»¥äº’æ¢ä½¿ç”¨npm info express npm viewå‘½ä»¤è¿˜å¯ä»¥æŸ¥çœ‹åŒ…çš„æ‰€æœ‰ç‰ˆæœ¬ä¿¡æ¯ï¼Œæ¯”å¦‚è¦æŸ¥çœ‹expressä¾èµ–åŒ…çš„æ‰€æœ‰ç‰ˆæœ¬ä¿¡æ¯ï¼Œå¯ä»¥æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š 12# æ­¤æ—¶æˆ‘ä»¬ä»ç»“æœä¸­é€‰æ‹©ä¸€ä¸ªç‰ˆæœ¬è¿›è¡Œå®‰è£…å³å¯npm view express versions npm homeï¼šæ‰“å¼€åŒ…çš„ä¸»é¡µ æ‰“å¼€æŸä¸ª npm åŒ…çš„ä¸»é¡µï¼ˆé€šå¸¸æ˜¯ GitHub ä¸»é¡µæˆ– npm é¡µé¢ï¼‰ã€‚ 1npm home express npm é•œåƒæº npm é»˜è®¤ä½¿ç”¨å®˜æ–¹çš„é•œåƒæºï¼Œä½†æ˜¯å®˜æ–¹çš„é•œåƒæºé€Ÿåº¦å¾ˆæ…¢ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç¬¬ä¸‰æ–¹çš„é•œåƒæºæ¥åŠ é€Ÿä¸‹è½½ã€‚ 12345678npm å®˜æ–¹åŸå§‹é•œåƒç½‘å€æ˜¯ï¼šhttps://registry.npmjs.org/æ·˜å® NPM é•œåƒï¼šhttp://registry.npmmirror.comé˜¿é‡Œäº‘ NPM é•œåƒï¼šhttps://npm.aliyun.comè…¾è®¯äº‘ NPM é•œåƒï¼šhttps://mirrors.cloud.tencent.com/npm/åä¸ºäº‘ NPM é•œåƒï¼šhttps://mirrors.huaweicloud.com/repository/npm/ç½‘æ˜“ NPM é•œåƒï¼šhttps://mirrors.163.com/npm/ä¸­å›½ç§‘å­¦æŠ€æœ¯å¤§å­¦å¼€æºé•œåƒç«™ï¼šhttp://mirrors.ustc.edu.cn/æ¸…åå¤§å­¦å¼€æºé•œåƒç«™ï¼šhttps://mirrors.tuna.tsinghua.edu.cn/ å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤æ¥æŸ¥çœ‹å½“å‰ä½¿ç”¨çš„é•œåƒæºï¼š 1npm config get registry å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤æ¥è®¾ç½®é•œåƒæºï¼š 1npm config set registry https://registry.npmmirror.com å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤æ¥åˆ é™¤ç”¨æˆ·é…ç½®çš„é•œåƒæºï¼Œåˆ é™¤åæ¢å¤ä¸ºé»˜è®¤é•œåƒæºï¼š 1npm config delete registry npm é…ç½® å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤æ¥æŸ¥çœ‹npmçš„é…ç½®ä¿¡æ¯ï¼š 123456# æŸ¥çœ‹å…¨å±€é…ç½®ä¿¡æ¯ï¼Œåªæ˜¾ç¤ºç”¨æˆ·è‡ªå®šä¹‰çš„é…ç½®ä¿¡æ¯npm config list# æŸ¥çœ‹å…¨å±€é…ç½®ä¿¡æ¯ï¼Œæ˜¾ç¤ºæ‰€æœ‰é…ç½®ä¿¡æ¯åŠå…¶é»˜è®¤ç¼ºçœå€¼npm config ls -l# json æ ¼å¼ æ˜¾ç¤ºå…¨éƒ¨é…ç½®ä¿¡æ¯npm config list --json é»˜è®¤å…¨å±€é…ç½®åœ¨å½“å‰ç”¨æˆ·HOMEç›®å½•ä¸‹çš„.npmrcæ–‡ä»¶ä¸­ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤æ¥æŸ¥çœ‹å…¨å±€é…ç½®ä¿¡æ¯ï¼š 12cat ~/.npmrccat ~/.npmrc | grep registry åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»ºä¸€ä¸ª.npmrc æ–‡ä»¶å¯ä»¥ä¸ºè¯¥é¡¹ç›®å•ç‹¬è®¾ç½® npm é…ç½®ã€‚ npm config å…è®¸ä½ æ§åˆ¶ npm çš„è¡Œä¸ºï¼ŒåŒ…æ‹¬ å®‰è£…ç›®å½•ã€ä»£ç†ã€æ—¥å¿—çº§åˆ«ã€ä¾èµ–ç®¡ç† ç­‰ã€‚ ä½ å¯ä»¥ä½¿ç”¨ npm config get &lt;key&gt; æŸ¥çœ‹å€¼ï¼Œnpm config set &lt;key&gt; &lt;value&gt; è¿›è¡Œä¿®æ”¹ï¼Œnpm config delete &lt;key&gt; åˆ é™¤è®¾ç½®ã€‚ npmå¸¸ç”¨é…ç½® é…ç½®é¡¹ ä½œç”¨ é»˜è®¤å€¼ prefix è®¾ç½® npm å…¨å±€å®‰è£…çš„è·¯å¾„ï¼ˆnpm install -g å½±å“çš„ç›®å½•ï¼‰ ç¯å¢ƒå˜é‡ NODE_HOME æˆ– /usr/localï¼ˆç³»ç»Ÿï¼‰ cache npm çš„ç¼“å­˜ç›®å½• ~/.npm registry æŒ‡å®š npm çš„åŒ…ç®¡ç†ä»“åº“åœ°å€ï¼ˆå¦‚å®˜æ–¹ã€æ·˜å®é•œåƒï¼‰ https://registry.npmjs.org/ strict-ssl æ˜¯å¦å¼ºåˆ¶ä½¿ç”¨ HTTPS è¿›è¡Œ npm æ“ä½œ true proxy é…ç½® HTTP ä»£ç† null https-proxy é…ç½® HTTPS ä»£ç† null init-author-name è®¾ç½® package.json é»˜è®¤ä½œè€…åç§° â€œâ€ init-author-email è®¾ç½® package.json é»˜è®¤ä½œè€…é‚®ç®± â€œâ€ init-author-url è®¾ç½® package.json é»˜è®¤ä½œè€…ç½‘ç«™ â€œâ€ init-license è®¾ç½® package.json é»˜è®¤è®¸å¯è¯ â€œISCâ€ init-version package.json é»˜è®¤ç‰ˆæœ¬å· â€œ1.0.0â€ save-exact true æ—¶ï¼Œå®‰è£…ä¾èµ–æ—¶ä¸ä½¿ç”¨ ^ æˆ– ~ï¼Œç›´æ¥é”å®šç‰ˆæœ¬ false engine-strict æ˜¯å¦å¼ºåˆ¶åŒ¹é… package.json çš„ engines å­—æ®µ false loglevel è®¾ç½®æ—¥å¿—è¾“å‡ºçº§åˆ«ï¼ˆsilent, error, warn, notice, info, verbose, sillyï¼‰ notice fund æ˜¯å¦æ˜¾ç¤º package çš„èµ„é‡‘æ”¯æŒä¿¡æ¯ true audit æ˜¯å¦å¯ç”¨å®‰å…¨å®¡è®¡ true npm config save-exact æ¨èé…ç½®ä¸º trueï¼Œé¿å…å› ä¸ºç‰ˆæœ¬æ›´æ–°å¯¼è‡´ä¾èµ–åŒ…ç‰ˆæœ¬ä¸åŒ¹é… 1npm config set save-exact true npm config loglevel loglevel å¯é€‰å€¼ çº§åˆ« è¯´æ˜ é€‚ç”¨åœºæ™¯ silent ä¸è¾“å‡ºä»»ä½•æ—¥å¿—ï¼ˆé™¤éå‘ç”Ÿé”™è¯¯ï¼‰ é€‚ç”¨äº CI/CD éœ€è¦æœ€å°‘æ—¥å¿—çš„ç¯å¢ƒ error ä»…æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯ åªå…³å¿ƒ npm è¿è¡Œæ˜¯å¦å‡ºé”™ warn æ˜¾ç¤ºè­¦å‘Šå’Œé”™è¯¯ å‘ç°æ½œåœ¨é—®é¢˜ä½†ä¸å½±å“ä½¿ç”¨ notice (é»˜è®¤) æ˜¾ç¤ºå…³é”®ä¿¡æ¯ã€è­¦å‘Šå’Œé”™è¯¯ npm é»˜è®¤å€¼ï¼Œé€‚åˆå¤§å¤šæ•°åœºæ™¯ http è®°å½• HTTP è¯·æ±‚çš„è¯¦ç»†ä¿¡æ¯ ç”¨äºè°ƒè¯• npm ä¸‹è½½é€Ÿåº¦é—®é¢˜ info æ˜¾ç¤ºä¸€èˆ¬ä¿¡æ¯ã€ä¾èµ–å®‰è£…æƒ…å†µç­‰ é€‚ç”¨äºä¸€èˆ¬å¼€å‘è€…è°ƒè¯• verbose è¯¦ç»†çš„è°ƒè¯•ä¿¡æ¯ é€‚ç”¨äºæ·±å…¥åˆ†æ npm è¿è¡Œæƒ…å†µ silly æœ€è¯¦ç»†çš„æ—¥å¿—ï¼ŒåŒ…å«æ‰€æœ‰è°ƒè¯•ä¿¡æ¯ é€‚ç”¨äº npm å¼€å‘è€…æˆ–æç«¯è°ƒè¯•éœ€æ±‚ è®¾ç½®æ–¹æ³• 1npm config set loglevel verbose ä¸´æ—¶ä½¿ç”¨ 12345678910npm --loglevel verbose install# æˆ–è€…npm -dd install# æ”¯æŒå¿«æ·æ–¹å¼çš„å€¼ï¼š# â€¢ -s, --silent: --loglevel silent# â€¢ -q, --quiet: --loglevel warn# â€¢ -d: --loglevel info# â€¢ -dd, --verbose: --loglevel verbose# â€¢ -ddd: --loglevel silly npm config timing timing æ˜¯ npm çš„ä¸€ä¸ª æ—¥å¿—è¾“å‡ºé…ç½®é¡¹ï¼Œç”¨äºæ§åˆ¶æ˜¯å¦åœ¨å‘½ä»¤æ‰§è¡Œæ—¶æ˜¾ç¤ºè¯¦ç»†çš„æ—¶é—´ä¿¡æ¯ï¼Œé»˜è®¤å€¼ä¸º falseã€‚ å½“ timing è®¾ä¸º true æ—¶ï¼Œnpm ä¼šåœ¨å‘½ä»¤æ‰§è¡Œç»“æŸå æ‰“å°è¯¦ç»†çš„æ—¶é—´ç»Ÿè®¡ä¿¡æ¯ï¼ŒåŒ…æ‹¬ï¼š æ¯ä¸ªå­ä»»åŠ¡çš„æ‰§è¡Œæ—¶é—´ï¼ˆå¦‚è§£æ package.jsonã€è§£æ node_modulesã€ä¸‹è½½ä¾èµ–ç­‰ï¼‰ ç½‘ç»œè¯·æ±‚çš„è€—æ—¶ ä¾èµ–è§£æå’Œå®‰è£…çš„è€—æ—¶ æ•´ä½“æ‰§è¡Œçš„æ—¶é—´å¼€é”€ è¿™å¯¹åˆ†æ npm æ€§èƒ½ã€ä¼˜åŒ–ä¾èµ–å®‰è£…é€Ÿåº¦éå¸¸æœ‰ç”¨ï¼Œç‰¹åˆ«æ˜¯åœ¨å¤§é¡¹ç›®æˆ– CI/CD ç¯å¢ƒä¸­ã€‚ å¯ç”¨ timing 1npm config set timing true ä¸´æ—¶å¯ç”¨ 1npm --timing install é€‚ç”¨åœºæ™¯ åˆ†æ npm å‘½ä»¤æ‰§è¡Œæ—¶é—´ï¼Œä¼˜åŒ–æ„å»ºé€Ÿåº¦ CI/CD ç¯å¢ƒä¸­æ’æŸ¥ npm å®‰è£…å˜æ…¢çš„åŸå›  æ’æŸ¥ npm ä¾èµ–è§£æã€å®‰è£…æˆ–ä¸‹è½½è¿‡ç¨‹çš„æ€§èƒ½ç“¶é¢ˆ ä¸€èˆ¬æ—¥å¸¸å¼€å‘ï¼šæ—¥å¿—ä¼šå˜é•¿ï¼Œå¯èƒ½å½±å“å¯è¯»æ€§ï¼Œæ‰€ä»¥å†æ²¡æœ‰é‡åˆ°é—®é¢˜æ—¶ä¸å»ºè®®å¼€å¯ npmã€pnpmã€yarn ä¹‹é—´çš„è”ç³»å’ŒåŒºåˆ« è¿™ä¸‰è€…éƒ½æ˜¯ JavaScript ç”Ÿæ€ä¸­çš„åŒ…ç®¡ç†å·¥å…·ï¼Œä¸»è¦ç”¨äºå®‰è£…ã€ç®¡ç†å’Œè¿è¡Œ Node.js é¡¹ç›®çš„ä¾èµ–ã€‚å®ƒä»¬çš„å…³ç³»å¦‚ä¸‹ï¼š npmï¼ˆNode Package Managerï¼‰æ˜¯ Node.js å®˜æ–¹è‡ªå¸¦çš„åŒ…ç®¡ç†å·¥å…·ã€‚ yarnï¼ˆYet Another Resource Negotiatorï¼‰æ˜¯ Facebook å¼€å‘çš„æ›¿ä»£ npm çš„å·¥å…·ï¼Œæä¾›æ›´å¿«ã€æ›´å®‰å…¨çš„ä¾èµ–ç®¡ç†ã€‚ pnpmï¼ˆPerformant npmï¼‰æ˜¯ä¸€ä¸ªæ›´é«˜æ•ˆçš„ npm æ›¿ä»£å“ï¼Œä½¿ç”¨ç¡¬é“¾æ¥å’Œå»é‡æœºåˆ¶æ¥å‡å°‘ç£ç›˜å ç”¨å¹¶åŠ å¿«å®‰è£…é€Ÿåº¦ã€‚ npmã€pnpmã€yarn çš„ä¸»è¦åŒºåˆ« ç‰¹æ€§ npm yarn pnpm é»˜è®¤åŒ…ç®¡ç†æ–¹å¼ ç›´æ¥å®‰è£…åˆ° node_modules/ ç›´æ¥å®‰è£…åˆ° node_modules/ ä½¿ç”¨ ç¡¬é“¾æ¥ + å…±äº«ä¾èµ–ï¼Œå ç”¨æ›´å°‘ç£ç›˜ å®‰è£…é€Ÿåº¦ 5+ ç‰ˆæœ¬åé€Ÿåº¦è¾ƒå¿«ï¼Œä½†ä¾èµ–è§£æä»æœ‰æ€§èƒ½é—®é¢˜ é€Ÿåº¦è¾ƒå¿«ï¼Œæ”¯æŒå¹¶è¡Œä¸‹è½½ æœ€å¿«ï¼Œå»é‡èƒ½åŠ›å¼º ç£ç›˜å ç”¨ è¾ƒå¤§ï¼ˆæ¯ä¸ªé¡¹ç›®éƒ½ä¼šå­˜ä¸€ä»½å®Œæ•´çš„ä¾èµ–ï¼‰ è¾ƒå¤§ï¼ˆå’Œ npm ç±»ä¼¼ï¼‰ æœ€å°ï¼ˆå…±äº«å…¨å±€ç¼“å­˜ï¼Œå¤šä¸ªé¡¹ç›®å…±ç”¨ä¾èµ–ï¼‰ é”æ–‡ä»¶ package-lock.json yarn.lock pnpm-lock.yaml å¹¶å‘å®‰è£… æ”¯æŒï¼ˆnpm 5+ ä¼˜åŒ–ï¼‰ æ”¯æŒï¼ˆæ›´å¿«ï¼‰ æ”¯æŒï¼ˆæœ€ä¼˜åŒ–ï¼‰ å…¨å±€ç¼“å­˜ æ”¯æŒï¼ˆä½†é¡¹ç›®ä»ä¼šå­˜å‰¯æœ¬ï¼‰ æ”¯æŒï¼ˆä»ä¼šæ‹·è´åˆ° node_modules/ï¼‰ å¼ºåˆ¶å¯ç”¨ï¼ˆå¤šä¸ªé¡¹ç›®å…±ç”¨ä¾èµ–ï¼ŒèŠ‚çœç©ºé—´ï¼‰ monorepoï¼ˆå¤šåŒ…ç®¡ç†ï¼‰ éœ€è¦æ‰‹åŠ¨é…ç½® æ”¯æŒ Workspaces åŸç”Ÿæ”¯æŒ Workspacesï¼ˆæœ€å¼ºå¤§ï¼‰ å‘½ä»¤å…¼å®¹æ€§ æ ‡å‡† å…¼å®¹ npmï¼Œéƒ¨åˆ†ä¸åŒ å…¼å®¹ npmï¼Œå¤§éƒ¨åˆ†å‘½ä»¤ç›¸åŒ è‡ªåŠ¨ä¿®å¤ package.json æ˜¯ æ˜¯ æ˜¯ ç”Ÿæ€å…¼å®¹æ€§ å®˜æ–¹æ ‡å‡†ï¼Œå…¼å®¹æ€§æœ€å¥½ å…¼å®¹ npmï¼Œä½†éƒ¨åˆ†ç‰¹æ€§ä¸åŒ å…¼å®¹ npmï¼Œä½†é‡‡ç”¨ä¸åŒçš„ä¾èµ–ç®¡ç†æ–¹å¼ å¸¸è§å‘½ä»¤å¯¹æ¯” ä»»åŠ¡ npm yarn pnpm åˆå§‹åŒ–é¡¹ç›® npm init yarn init pnpm init å®‰è£…ä¾èµ– npm install yarn install pnpm install å®‰è£…ç‰¹å®šä¾èµ– npm install lodash yarn add lodash pnpm add lodash å®‰è£…å¼€å‘ä¾èµ– npm install lodash -D yarn add lodash -D pnpm add lodash -D åˆ é™¤ä¾èµ– npm uninstall lodash yarn remove lodash pnpm remove lodash æ›´æ–°ä¾èµ– npm update lodash yarn upgrade lodash pnpm update lodash å…¨å±€å®‰è£… npm install -g serve yarn global add serve pnpm add -g serve è¿è¡Œè„šæœ¬ npm run dev yarn dev pnpm dev ä»€ä¹ˆæ—¶å€™ä½¿ç”¨ npmã€yarnã€pnpmï¼Ÿ âœ… ä½¿ç”¨ pnpmï¼ˆæ¨èï¼‰ï¼š 1.ä½ å¸Œæœ›å‡å°‘ç£ç›˜å ç”¨ã€åŠ å¿«å®‰è£…é€Ÿåº¦ 2.ä½ æ­£åœ¨å¼€å‘ monorepoï¼ˆå¤šåŒ…ï¼‰é¡¹ç›® 3.ä½ å¸Œæœ›æ›´é«˜æ•ˆåœ°ç®¡ç†ä¾èµ– âœ… ä½¿ç”¨ yarnï¼š 1.ä½ å¸Œæœ›æ›´å¿«çš„å®‰è£…é€Ÿåº¦ï¼Œä½†åˆä¸æƒ³æ”¹å˜ npm ä¼ ç»Ÿç»“æ„ 2.ä½ çš„å›¢é˜Ÿä¹ æƒ¯ä½¿ç”¨ yarn.lock æ–‡ä»¶ 3.ä½ åœ¨ç”¨ React Nativeï¼ˆå®˜æ–¹æ¨è yarnï¼‰ âœ… ä½¿ç”¨ npmï¼ˆé€‚åˆç®€å•é¡¹ç›®ï¼‰ï¼š 1.ä½ å¸Œæœ›ä½¿ç”¨ Node.js å®˜æ–¹çš„é»˜è®¤å·¥å…· 2.ä½ ä¸æƒ³å®‰è£…é¢å¤–çš„åŒ…ç®¡ç†å·¥å…· 3.ä½ åœ¨å¼€å‘å°å‹é¡¹ç›®ï¼Œä¸éœ€è¦ workspaces","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç»å¦‚ä½•ä½¿ç”¨npm npmç‰ˆæœ¬10.5.0","date_published":"2025-03-13T13:30:05.000Z","tags":["æŠ€æœ¯","npm","nodejs","npm"]},{"id":"https://blog.hanqunfeng.com/2025/01/02/mermaid/","url":"https://blog.hanqunfeng.com/2025/01/02/mermaid/","title":"Hexo-Next ä¸»é¢˜çš„å›¾å½¢å·¥å…· -- Mermaid","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\n-->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><a href=\"https://mermaid.js.org/intro/\">Mermaid</a> æ˜¯ä¸€ä¸ªæ”¯æŒåœ¨Markdownæ–‡æ¡£ä¸­ç»˜åˆ¶æµç¨‹å›¾ã€ç”˜ç‰¹å›¾ã€åºåˆ—å›¾ç­‰å›¾å½¢çš„å·¥å…·ã€‚å®ƒåŸºäºJavaScriptå®ç°ï¼Œèƒ½å¤Ÿå°†Markdownä¸­çš„å…ƒç´ æ¸²æŸ“æˆHTMLå…ƒç´ ï¼Œä»è€Œåœ¨ç½‘é¡µä¸Šç›´è§‚åœ°å±•ç¤ºå„ç§å›¾è¡¨â€Œ</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://theme-next.js.org/docs/tag-plugins/mermaid\">Nextä¸»é¢˜ä¸­ä½¿ç”¨Mermaidè¯´æ˜</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç»å¦‚ä½•åœ¨ <code>Hexo-Next</code> ä¸»é¢˜ä¸­ä½¿ç”¨ <code>Mermaid</code></p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"é…ç½®å’Œä½¿ç”¨æ–¹æ³•\">é…ç½®å’Œä½¿ç”¨æ–¹æ³•</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>NexT config file ä¸­æ‰¾åˆ°<code>mermaid</code>é…ç½®ï¼Œå¹¶è®¾ç½®ä¸º<code>true</code>ï¼Œ<code>theme</code> å¯ä»¥è®¾ç½®æµ…è‰²å’Œæ·±è‰²èƒŒæ™¯çš„æ ·å¼ï¼Œå…±æœ‰4ä¸ªå¯ç”¨é€‰é¡¹</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">mermaid:</span></span><br><span class=\"line\">  <span class=\"attr\">enable:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">  <span class=\"comment\"># Available themes: default | dark | forest | neutral</span></span><br><span class=\"line\">  <span class=\"attr\">theme:</span></span><br><span class=\"line\">    <span class=\"attr\">light:</span> <span class=\"string\">dark</span></span><br><span class=\"line\">    <span class=\"attr\">dark:</span> <span class=\"string\">dark</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä½¿ç”¨æ–¹æ³•ï¼Œå…¶ä¸­mermaidä¸endmermaidæ˜¯å›ºå®šæ­é…ï¼Œtype ç”¨äºè®¾ç½®å›¾å½¢çš„ç§ç±»ï¼Œå¦‚æµç¨‹å›¾ã€æ—¶åºå›¾ã€ç”˜ç‰¹å›¾ç­‰ï¼Œä¸‹é¢ç¤ºä¾‹ä¸­ä¼šä»‹ç»</p>\n</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;% mermaid type %&#125;</span><br><span class=\"line\">&#123;% endmermaid %&#125;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ‰äº›å°ä¼™ä¼´å–œæ¬¢ä½¿ç”¨ä»£ç å—çš„å½¢å¼ï¼Œä½¿ç”¨æ—¶å»æ‰å‰é¢çš„<code>#</code></p>\n</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#```mermaid</span><br><span class=\"line\">type</span><br><span class=\"line\"></span><br><span class=\"line\">#```</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä½†æ˜¯æ­¤æ—¶éœ€è¦åœ¨ Hexo config file ä¸­æ‰¾åˆ°<code>highlight</code>ï¼Œå¹¶æ·»åŠ å¦‚ä¸‹å†…å®¹ï¼Œæ‰ä¼šä½¿ä»£ç å—çš„å½¢å¼ç”Ÿæ•ˆ</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">highlight:</span></span><br><span class=\"line\">  <span class=\"attr\">exclude_languages:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">mermaid</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"å›¾å½¢ç¤ºä¾‹\">å›¾å½¢ç¤ºä¾‹</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¿™é‡Œåªä»‹ç»å¸¸ç”¨çš„ä¸€äº›å›¾è¡¨ï¼Œæ›´å¤šå›¾è¡¨çš„ä½¿ç”¨æ–¹æ³•å¯ä»¥å‚è€ƒ<a href=\"https://mermaid.js.org/intro/\">Mermaidå¸®åŠ©æ–‡æ¡£</a></p>\n</li>\n</ul>\n<h3 id=\"Flowchart\">Flowchart</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç”¨äºç»˜åˆ¶æµç¨‹å›¾ï¼Œæ”¯æŒæ–¹å‘ï¼ˆä¾‹å¦‚ä»å·¦åˆ°å³ã€ä»ä¸Šåˆ°ä¸‹ï¼‰å’ŒèŠ‚ç‚¹é—´å…³ç³»çš„å®šä¹‰ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://mermaid.js.org/syntax/flowchart.html\">Mermaid Flowchart</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>type ä¸º <code>&quot;graph TD&quot;</code>æˆ–è€…<code>&quot;graph LR&quot;</code>ï¼Œåˆ†åˆ«è¡¨ç¤ºä»ä¸Šåˆ°ä¸‹å’Œä»å·¦åˆ°å³çš„æ–¹å‘</p>\n</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- æµç¨‹å›¾æ–¹å‘:</span><br><span class=\"line\">  - TB - ä»ä¸Šåˆ°ä¸‹</span><br><span class=\"line\">  - TD - è‡ªä¸Šè€Œä¸‹ï¼Œç­‰åŒäºTB</span><br><span class=\"line\">  - BT - ä»ä¸‹åˆ°ä¸Š</span><br><span class=\"line\">  - RL - ä»å³åˆ°å·¦</span><br><span class=\"line\">  - LR - ä»å·¦åˆ°å³</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><code>&quot;graph TD&quot;</code>ï¼šä»ä¸Šåˆ°ä¸‹</p>\n</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;% mermaid graph TD %&#125;</span><br><span class=\"line\">A[Hard] --&gt;|Text| B(Round)</span><br><span class=\"line\">B --&gt; C&#123;Decision&#125;</span><br><span class=\"line\">C --&gt;|One| D[Result 1]</span><br><span class=\"line\">C --&gt;|Two| E[Result 2]</span><br><span class=\"line\">&#123;% endmermaid %&#125;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ•ˆæœ</p>\n</li>\n</ul>\n<pre><code class=\"highlight mermaid\">graph TD\nA[Hard] --&gt;|Text| B(Round)\nB --&gt; C&#123;Decision&#125;\nC --&gt;|One| D[Result 1]\nC --&gt;|Two| E[Result 2]</code></pre>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¯´æ˜</p>\n</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">graph TDï¼Œå®šä¹‰ä¸€ä¸ªä»ä¸Šåˆ°ä¸‹çš„æµç¨‹å›¾ã€‚</span><br><span class=\"line\">TD æ˜¯ Top to Down çš„ç¼©å†™ï¼Œè¡¨ç¤ºæµç¨‹å›¾ä»ä¸Šå‘ä¸‹æ’åˆ—ã€‚</span><br><span class=\"line\"></span><br><span class=\"line\">A[Hard] --&gt;|Text| B(Round)ï¼Œå®šä¹‰äº†ä¸€ä¸ªèŠ‚ç‚¹ Aï¼Œæ˜¾ç¤ºä¸º Hardã€‚</span><br><span class=\"line\">ä¸€ä¸ªå¸¦æ ‡ç­¾çš„ç®­å¤´ --&gt;|Text| æŒ‡å‘èŠ‚ç‚¹ Bï¼Œç®­å¤´ä¸Šçš„æ ‡ç­¾ä¸º Textã€‚</span><br><span class=\"line\">èŠ‚ç‚¹ B è¢«å®šä¹‰ä¸º Roundï¼Œè¿™æ˜¯ä¸€ä¸ªæ¤­åœ†å½¢èŠ‚ç‚¹ã€‚</span><br><span class=\"line\"></span><br><span class=\"line\">B --&gt; C&#123;Decision&#125;ï¼ŒèŠ‚ç‚¹ B æŒ‡å‘èŠ‚ç‚¹ Cã€‚</span><br><span class=\"line\">èŠ‚ç‚¹ C è¢«å®šä¹‰ä¸º Decisionï¼Œè¿™æ˜¯ä¸€ä¸ªå†³ç­–èŠ‚ç‚¹ï¼Œç”¨å¤§æ‹¬å· &#123;&#125; è¡¨ç¤ºã€‚</span><br><span class=\"line\"></span><br><span class=\"line\">C --&gt;|One| D[Result 1]ï¼Œå†³ç­–èŠ‚ç‚¹ C çš„ä¸€ä¸ªåˆ†æ”¯ï¼Œå¸¦æ ‡ç­¾ Oneï¼ŒæŒ‡å‘èŠ‚ç‚¹ Dã€‚</span><br><span class=\"line\">èŠ‚ç‚¹ D æ˜¾ç¤ºä¸º Result 1ï¼Œè¿™æ˜¯ä¸€ä¸ªçŸ©å½¢èŠ‚ç‚¹ã€‚</span><br><span class=\"line\"></span><br><span class=\"line\">C --&gt;|Two| E[Result 2]ï¼Œå†³ç­–èŠ‚ç‚¹ C çš„å¦ä¸€ä¸ªåˆ†æ”¯ï¼Œå¸¦æ ‡ç­¾ Twoï¼ŒæŒ‡å‘èŠ‚ç‚¹ Eã€‚</span><br><span class=\"line\">èŠ‚ç‚¹ E æ˜¾ç¤ºä¸º Result 2ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªçŸ©å½¢èŠ‚ç‚¹ã€‚</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><code>&quot;graph LR&quot;</code>ï¼šä»å·¦åˆ°å³</p>\n</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;% mermaid graph LR %&#125;</span><br><span class=\"line\">A[é•¿æ–¹å½¢] -- é“¾æ¥ --&gt; B((åœ†))</span><br><span class=\"line\">A --&gt; C(åœ†è§’é•¿æ–¹å½¢)</span><br><span class=\"line\">B --&gt; D&#123;è±å½¢&#125;</span><br><span class=\"line\">C --&gt; D</span><br><span class=\"line\">&#123;% endmermaid %&#125;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ•ˆæœ</p>\n</li>\n</ul>\n<pre><code class=\"highlight mermaid\">graph LR\nA[é•¿æ–¹å½¢] -- é“¾æ¥ --&gt; B((åœ†))\nA --&gt; C(åœ†è§’é•¿æ–¹å½¢)\nB --&gt; D&#123;è±å½¢&#125;\nC --&gt; D</code></pre>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¯´æ˜</p>\n</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">graph LRï¼Œå®šä¹‰æµç¨‹å›¾çš„æ–¹å‘æ˜¯ä»å·¦åˆ°å³ï¼ˆLeft to Rightï¼‰ã€‚</span><br><span class=\"line\">èŠ‚ç‚¹å’Œç®­å¤´ä»å·¦å‘å³æ’åˆ—ã€‚</span><br><span class=\"line\"></span><br><span class=\"line\">A[é•¿æ–¹å½¢] -- é“¾æ¥ --&gt; B((åœ†))ï¼Œå®šä¹‰äº†èŠ‚ç‚¹ A å’ŒèŠ‚ç‚¹ Bã€‚</span><br><span class=\"line\">A æ˜¯ä¸€ä¸ªé•¿æ–¹å½¢èŠ‚ç‚¹ï¼Œæ˜¾ç¤ºå†…å®¹ä¸ºâ€œé•¿æ–¹å½¢â€ã€‚</span><br><span class=\"line\">B æ˜¯ä¸€ä¸ªåœ†å½¢èŠ‚ç‚¹ï¼Œå†…å®¹ä¸ºç©ºã€‚</span><br><span class=\"line\">å®ƒä»¬ä¹‹é—´é€šè¿‡ä¸€ä¸ªå¸¦æ ‡ç­¾çš„ç®­å¤´ -- é“¾æ¥ --&gt; è¿æ¥ï¼Œç®­å¤´ä¸Šæ ‡æ³¨äº†â€œé“¾æ¥â€ã€‚</span><br><span class=\"line\"></span><br><span class=\"line\">A --&gt; C(åœ†è§’é•¿æ–¹å½¢)ï¼ŒèŠ‚ç‚¹ A æŒ‡å‘èŠ‚ç‚¹ Cã€‚</span><br><span class=\"line\">C æ˜¯ä¸€ä¸ªåœ†è§’é•¿æ–¹å½¢èŠ‚ç‚¹ï¼Œæ˜¾ç¤ºå†…å®¹ä¸ºâ€œåœ†è§’é•¿æ–¹å½¢â€ã€‚</span><br><span class=\"line\"></span><br><span class=\"line\">B --&gt; D&#123;è±å½¢&#125;ï¼ŒèŠ‚ç‚¹ B æŒ‡å‘èŠ‚ç‚¹ Dã€‚</span><br><span class=\"line\">D æ˜¯ä¸€ä¸ªè±å½¢èŠ‚ç‚¹ï¼Œæ˜¾ç¤ºå†…å®¹ä¸ºâ€œè±å½¢â€ã€‚</span><br><span class=\"line\"></span><br><span class=\"line\">C --&gt; Dï¼ŒèŠ‚ç‚¹ C ä¹ŸæŒ‡å‘èŠ‚ç‚¹ Dï¼Œç®­å¤´ä¸å¸¦æ ‡ç­¾ã€‚</span><br><span class=\"line\"></span><br><span class=\"line\">èŠ‚ç‚¹ç±»å‹å’Œå½¢çŠ¶</span><br><span class=\"line\">é•¿æ–¹å½¢ [] ï¼šå¦‚ A[é•¿æ–¹å½¢]ï¼Œæ˜¯é»˜è®¤çš„çŸ©å½¢èŠ‚ç‚¹ã€‚</span><br><span class=\"line\">åœ†å½¢ (()) ï¼šå¦‚ B((åœ†))ï¼Œç”¨äºè¡¨ç¤ºä¸€ä¸ªåœ†å½¢èŠ‚ç‚¹ã€‚</span><br><span class=\"line\">åœ†è§’é•¿æ–¹å½¢ () ï¼šå¦‚ C(åœ†è§’é•¿æ–¹å½¢)ï¼Œç”¨äºè¡¨ç¤ºåœ†è§’çŸ©å½¢èŠ‚ç‚¹ã€‚</span><br><span class=\"line\">è±å½¢ &#123;&#125; ï¼šå¦‚ D&#123;è±å½¢&#125;ï¼Œç”¨äºè¡¨ç¤ºå†³ç­–ç‚¹æˆ–æ¡ä»¶åˆ†æ”¯ã€‚</span><br></pre></td></tr></table></figure>\n<h3 id=\"Sequence-Diagram\">Sequence Diagram</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç”¨äºç»˜åˆ¶æ—¶åºå›¾ï¼Œæ˜¾ç¤ºå¤šä¸ªå®ä½“ä¹‹é—´çš„äº¤äº’å…³ç³»ï¼ŒåŒ…æ‹¬æ¶ˆæ¯ã€æ—¶é—´ã€çŠ¶æ€å’Œæ•°æ®äº¤æ¢ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://mermaid.js.org/syntax/sequenceDiagram.html\">Mermaid Sequence Diagram</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>type ä¸º <code>&quot;sequenceDiagram&quot;</code></p>\n</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;% mermaid sequenceDiagram %&#125;</span><br><span class=\"line\">Alice-&gt;&gt;John: Hello John, how are you?</span><br><span class=\"line\">loop Healthcheck</span><br><span class=\"line\">    John-&gt;&gt;John: Fight against hypochondria</span><br><span class=\"line\">end</span><br><span class=\"line\">Note right of John: Rational thoughts!</span><br><span class=\"line\">John--&gt;&gt;Alice: Great!</span><br><span class=\"line\">John-&gt;&gt;Bob: How about you?</span><br><span class=\"line\">Bob--&gt;&gt;John: Jolly good!</span><br><span class=\"line\">&#123;% endmermaid %&#125;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ•ˆæœ</p>\n</li>\n</ul>\n<pre><code class=\"highlight mermaid\">sequenceDiagram\nAlice-&gt;&gt;John: Hello John, how are you?\nloop Healthcheck\n    John-&gt;&gt;John: Fight against hypochondria\nend\nNote right of John: Rational thoughts!\nJohn--&gt;&gt;Alice: Great!\nJohn-&gt;&gt;Bob: How about you?\nBob--&gt;&gt;John: Jolly good!</code></pre>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¯´æ˜</p>\n</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">åŸºæœ¬ç»“æ„è¯´æ˜</span><br><span class=\"line\">sequenceDiagram: å®šä¹‰ä¸€ä¸ªåºåˆ—å›¾ï¼Œè¡¨ç¤ºæ¶ˆæ¯å’Œäº‹ä»¶çš„æ—¶é—´é¡ºåºã€‚</span><br><span class=\"line\">å‚ä¸è€…</span><br><span class=\"line\">    Aliceã€John å’Œ Bob æ˜¯å‚ä¸è€…ã€‚</span><br><span class=\"line\">    æ¯ä¸ªå‚ä¸è€…åœ¨å›¾ä¸­ä¼šä»¥å‚ç›´æ’åˆ—çš„å½¢å¼æ˜¾ç¤ºã€‚</span><br><span class=\"line\">æ¶ˆæ¯å’Œç®­å¤´</span><br><span class=\"line\">    -&gt;&gt; è¡¨ç¤ºä¸€ä¸ªæ¶ˆæ¯çš„å‘é€ï¼Œæ–¹å‘ç”±ç®­å¤´å†³å®šã€‚</span><br><span class=\"line\">    æ¶ˆæ¯å†…å®¹å†™åœ¨ç®­å¤´æ—è¾¹ã€‚</span><br><span class=\"line\">å¾ªç¯ï¼ˆloopï¼‰</span><br><span class=\"line\">    ä½¿ç”¨ loop å®šä¹‰ä¸€ä¸ªå¾ªç¯å—ï¼Œå¾ªç¯ä¸­çš„æ¶ˆæ¯ä¼šé‡å¤æ‰§è¡Œï¼Œè¡¨ç¤ºæŸç§æŒç»­è¡Œä¸ºã€‚</span><br><span class=\"line\">å¤‡æ³¨ï¼ˆNoteï¼‰</span><br><span class=\"line\">    Note right of John å®šä¹‰äº†ä¸€æ¡å¤‡æ³¨ï¼Œæ˜¾ç¤ºåœ¨ John çš„å³ä¾§ï¼Œç”¨æ¥è¡¥å……è¯´æ˜ã€‚</span><br><span class=\"line\"></span><br><span class=\"line\">ä»£ç é€æ­¥è§£æ</span><br><span class=\"line\">Alice-&gt;&gt;John: Hello John, how are you?</span><br><span class=\"line\">    è¡¨ç¤º Alice ç»™ John å‘é€ä¸€æ¡æ¶ˆæ¯ï¼šâ€œHello John, how are you?â€</span><br><span class=\"line\">loop Healthcheck</span><br><span class=\"line\">    å®šä¹‰ä¸€ä¸ªå¾ªç¯å—ï¼Œæ ‡é¢˜ä¸ºâ€œHealthcheckâ€ï¼ˆå¥åº·æ£€æŸ¥ï¼‰ã€‚</span><br><span class=\"line\">    å¾ªç¯å†…å®¹æ˜¯ï¼š</span><br><span class=\"line\">        John-&gt;&gt;John: Fight against hypochondria</span><br><span class=\"line\">        è¡¨ç¤º John è‡ªå·±å‘è‡ªå·±å‘é€ä¸€æ¡æ¶ˆæ¯ï¼šâ€œFight against hypochondriaâ€ï¼ˆä¸ç–‘ç—…ç—‡æŠ—äº‰ï¼‰ã€‚</span><br><span class=\"line\">Note right of John: Rational thoughts!</span><br><span class=\"line\">    å®šä¹‰äº†ä¸€æ¡å¤‡æ³¨ï¼Œæ˜¾ç¤ºåœ¨ John çš„å³ä¾§ã€‚</span><br><span class=\"line\">    å¤‡æ³¨å†…å®¹ä¸ºï¼šâ€œRational thoughts!â€ï¼ˆç†æ€§æ€è€ƒï¼ï¼‰ã€‚</span><br><span class=\"line\">John--&gt;&gt;Alice: Great!</span><br><span class=\"line\">    John å›å¤ Alice ä¸€æ¡æ¶ˆæ¯ï¼šâ€œGreat!â€ï¼ˆå¾ˆå¥½ï¼ï¼‰ã€‚</span><br><span class=\"line\">    ä½¿ç”¨ --&gt;&gt; è¡¨ç¤ºå›å¤æ¶ˆæ¯ã€‚</span><br><span class=\"line\">John-&gt;&gt;Bob: How about you?</span><br><span class=\"line\">    John è¯¢é—® Bob ä¸€æ¡æ¶ˆæ¯ï¼šâ€œHow about you?â€ï¼ˆä½ æ€ä¹ˆæ ·ï¼Ÿï¼‰ã€‚</span><br><span class=\"line\">Bob--&gt;&gt;John: Jolly good!</span><br><span class=\"line\">    Bob å›å¤ John ä¸€æ¡æ¶ˆæ¯ï¼šâ€œJolly good!â€ï¼ˆéå¸¸å¥½ï¼ï¼‰ã€‚</span><br></pre></td></tr></table></figure>\n<h3 id=\"Class-Diagram\">Class Diagram</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç”¨äºç»˜åˆ¶ç±»å›¾ï¼Œæ˜¾ç¤ºå¯¹è±¡ä¹‹é—´çš„å…³ç³»ï¼ŒåŒ…æ‹¬ç»§æ‰¿ã€å…³è”ã€ä¾èµ–ç­‰ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://mermaid.js.org/syntax/classDiagram.html\">Mermaid Class Diagram</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>type ä¸º <code>&quot;classDiagram&quot;</code></p>\n</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;% mermaid classDiagram %&#125;</span><br><span class=\"line\">Class01 &lt;|-- AveryLongClass : Cool</span><br><span class=\"line\">&lt;&lt;interface&gt;&gt; Class01</span><br><span class=\"line\">Class09 --&gt; C2 : Where am i?</span><br><span class=\"line\">Class09 --* C3</span><br><span class=\"line\">Class09 --|&gt; Class07</span><br><span class=\"line\">Class07 : equals()</span><br><span class=\"line\">Class07 : Object[] elementData</span><br><span class=\"line\">Class01 : size()</span><br><span class=\"line\">Class01 : int chimp</span><br><span class=\"line\">Class01 : int gorilla</span><br><span class=\"line\">class Class10 &#123;</span><br><span class=\"line\">  &lt;&lt;service&gt;&gt;</span><br><span class=\"line\">  int id</span><br><span class=\"line\">  size()</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">&#123;% endmermaid %&#125;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ•ˆæœ</p>\n</li>\n</ul>\n<pre><code class=\"highlight mermaid\">classDiagram\nClass01 &lt;|-- AveryLongClass : Cool\n&lt;&lt;interface&gt;&gt; Class01\nClass09 --&gt; C2 : Where am i?\nClass09 --* C3\nClass09 --|&gt; Class07\nClass07 : equals()\nClass07 : Object[] elementData\nClass01 : size()\nClass01 : int chimp\nClass01 : int gorilla\nclass Class10 &#123;\n  &lt;&lt;service&gt;&gt;\n  int id\n  size()\n&#125;</code></pre>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¯´æ˜</p>\n</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">åŸºæœ¬ç»“æ„</span><br><span class=\"line\">classDiagram</span><br><span class=\"line\">    å®šä¹‰ä¸€ä¸ªç±»å›¾ï¼Œå±•ç¤ºç±»çš„å±æ€§ã€æ–¹æ³•ä»¥åŠå®ƒä»¬ä¹‹é—´çš„å…³ç³»ã€‚</span><br><span class=\"line\">ç±»å’Œä¿®é¥°ç¬¦</span><br><span class=\"line\">    ä½¿ç”¨ class ClassName å®šä¹‰ä¸€ä¸ªç±»ã€‚</span><br><span class=\"line\">    ç±»çš„å±æ€§å’Œæ–¹æ³•å®šä¹‰åœ¨ class å—å†…ã€‚</span><br><span class=\"line\">    ç‰¹æ®Šä¿®é¥°ç¬¦å¦‚ &lt;&lt;interface&gt;&gt; å’Œ &lt;&lt;service&gt;&gt; ç”¨äºè¯´æ˜ç±»çš„è§’è‰²æˆ–ç±»å‹ã€‚</span><br><span class=\"line\">å…³ç³»ç¬¦å·</span><br><span class=\"line\">    &lt;|-- è¡¨ç¤ºç»§æ‰¿ï¼ˆextendsï¼‰ã€‚</span><br><span class=\"line\">    --|&gt; è¡¨ç¤ºå®ç°ï¼ˆimplementsï¼Œæ¥å£çš„å®ç°ï¼‰ã€‚</span><br><span class=\"line\">    --&gt; è¡¨ç¤ºå…³è”ï¼ˆæ™®é€šå¼•ç”¨ï¼‰ã€‚</span><br><span class=\"line\">    --* è¡¨ç¤ºç»„åˆå…³ç³»ï¼ˆä¸€ä¸ªç±»åŒ…å«å¦ä¸€ä¸ªç±»ï¼‰ã€‚</span><br><span class=\"line\">    : åè·Ÿå…³ç³»çš„è¯´æ˜æˆ–æ³¨é‡Šã€‚</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">ä»£ç é€æ­¥è§£æ</span><br><span class=\"line\">Class01 &lt;|-- AveryLongClass : Cool</span><br><span class=\"line\">    è¡¨ç¤º AveryLongClass ç»§æ‰¿äº† Class01ï¼Œå…³ç³»åç§°ä¸º Coolã€‚</span><br><span class=\"line\">    &lt;|-- è¡¨ç¤ºç»§æ‰¿ï¼ˆçˆ¶ç±»åˆ°å­ç±»ï¼‰ã€‚</span><br><span class=\"line\">&lt;&lt;interface&gt;&gt; Class01</span><br><span class=\"line\">    å°† Class01 æ ‡è®°ä¸ºä¸€ä¸ªæ¥å£ã€‚</span><br><span class=\"line\">Class09 --&gt; C2 : Where am i?</span><br><span class=\"line\">    è¡¨ç¤º Class09 ä¸ C2 æœ‰ä¸€ä¸ªå…³è”å…³ç³»ï¼Œæ³¨é‡Šä¸º â€œWhere am i?â€ã€‚</span><br><span class=\"line\">Class09 --* C3</span><br><span class=\"line\">    è¡¨ç¤º Class09 ä¸ C3 æœ‰ä¸€ä¸ªç»„åˆå…³ç³»ã€‚</span><br><span class=\"line\">    Class09 åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ª C3 çš„å®ä¾‹ã€‚</span><br><span class=\"line\">Class09 --|&gt; Class07</span><br><span class=\"line\">    è¡¨ç¤º Class09 å®ç°äº† Class07ã€‚</span><br><span class=\"line\">    --|&gt; é€šå¸¸ç”¨äºè¡¨ç¤ºæ¥å£å®ç°ã€‚</span><br><span class=\"line\">Class07 : equals()</span><br><span class=\"line\">    è¡¨ç¤º Class07 å®šä¹‰äº†ä¸€ä¸ªæ–¹æ³• equals()ã€‚</span><br><span class=\"line\">Class07 : Object[] elementData</span><br><span class=\"line\">    è¡¨ç¤º Class07 æœ‰ä¸€ä¸ªå±æ€§ elementDataï¼Œç±»å‹æ˜¯ Object[]ï¼ˆæ•°ç»„ï¼‰ã€‚</span><br><span class=\"line\">Class01 : size()</span><br><span class=\"line\">    è¡¨ç¤º Class01 æœ‰ä¸€ä¸ªæ–¹æ³• size()ã€‚</span><br><span class=\"line\">Class01 : int chimp å’Œ Class01 : int gorilla</span><br><span class=\"line\">    è¡¨ç¤º Class01 æœ‰ä¸¤ä¸ªæ•´å‹å±æ€§ï¼šchimp å’Œ gorillaã€‚</span><br><span class=\"line\">class Class10 &#123; ... &#125;</span><br><span class=\"line\">    å®šä¹‰äº†ä¸€ä¸ªåä¸º Class10 çš„ç±»ã€‚</span><br><span class=\"line\">    ç±»ä¸­æœ‰ä¸€ä¸ªä¿®é¥°ç¬¦ &lt;&lt;service&gt;&gt;ï¼Œè¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªæœåŠ¡ç±»ã€‚</span><br><span class=\"line\">    å±æ€§å’Œæ–¹æ³•ï¼š</span><br><span class=\"line\">        int idï¼šæ•´å‹å±æ€§ã€‚</span><br><span class=\"line\">        size()ï¼šæ–¹æ³•ã€‚</span><br></pre></td></tr></table></figure>\n<h3 id=\"State-Diagram\">State Diagram</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç”¨äºç»˜åˆ¶çŠ¶æ€å›¾ï¼Œæ˜¾ç¤ºå¯¹è±¡çš„çŠ¶æ€è½¬ç§»å’Œè¡Œä¸ºã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://mermaid.js.org/syntax/stateDiagram.html\">Mermaid State Diagram</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>type ä¸º <code>&quot;stateDiagram&quot;</code></p>\n</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;% mermaid stateDiagram %&#125;</span><br><span class=\"line\">[*] --&gt; Still</span><br><span class=\"line\">Still --&gt; [*]</span><br><span class=\"line\">Still --&gt; Moving</span><br><span class=\"line\">Moving --&gt; Still</span><br><span class=\"line\">Moving --&gt; Crash</span><br><span class=\"line\">Crash --&gt; [*]</span><br><span class=\"line\">&#123;% endmermaid %&#125;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ•ˆæœ</p>\n</li>\n</ul>\n<pre><code class=\"highlight mermaid\">stateDiagram\n[*] --&gt; Still\nStill --&gt; [*]\nStill --&gt; Moving\nMoving --&gt; Still\nMoving --&gt; Crash\nCrash --&gt; [*]</code></pre>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¯´æ˜</p>\n</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">åŸºæœ¬ç»“æ„</span><br><span class=\"line\">stateDiagram</span><br><span class=\"line\">    å®šä¹‰è¿™æ˜¯ä¸€ä¸ªçŠ¶æ€å›¾ï¼Œç”¨äºè¡¨ç¤ºçŠ¶æ€å’ŒçŠ¶æ€ä¹‹é—´çš„è½¬æ¢ã€‚</span><br><span class=\"line\">[*]</span><br><span class=\"line\">    è¡¨ç¤ºåˆå§‹çŠ¶æ€æˆ–ç»ˆæ­¢çŠ¶æ€ã€‚</span><br><span class=\"line\">    èµ·å§‹çŠ¶æ€é€šå¸¸æœ‰ç®­å¤´æŒ‡å‘ç¬¬ä¸€ä¸ªçŠ¶æ€ã€‚</span><br><span class=\"line\">    ç»ˆæ­¢çŠ¶æ€é€šå¸¸æœ‰ç®­å¤´æŒ‡å‘å®ƒã€‚</span><br><span class=\"line\">çŠ¶æ€</span><br><span class=\"line\">    ç”¨çŠ¶æ€åç§°å®šä¹‰çŠ¶æ€ï¼Œä¾‹å¦‚ Stillã€Movingã€Crashã€‚</span><br><span class=\"line\">ç®­å¤´</span><br><span class=\"line\">    --&gt; è¡¨ç¤ºçŠ¶æ€ä¹‹é—´çš„è½¬æ¢æ–¹å‘ã€‚</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">ä»£ç é€æ­¥è§£æ</span><br><span class=\"line\">[*] --&gt; Still</span><br><span class=\"line\">    ç³»ç»Ÿä»åˆå§‹çŠ¶æ€è¿›å…¥ Still çŠ¶æ€ã€‚</span><br><span class=\"line\">Still --&gt; [*]</span><br><span class=\"line\">    ç³»ç»Ÿä» Still çŠ¶æ€å¯ä»¥ç›´æ¥è¿›å…¥ç»ˆæ­¢çŠ¶æ€ï¼ˆç³»ç»Ÿç»“æŸï¼‰ã€‚</span><br><span class=\"line\">Still --&gt; Moving</span><br><span class=\"line\">    ç³»ç»Ÿä» Still çŠ¶æ€å¯ä»¥è½¬æ¢ä¸º Moving çŠ¶æ€ã€‚</span><br><span class=\"line\">Moving --&gt; Still</span><br><span class=\"line\">    ç³»ç»Ÿä» Moving çŠ¶æ€å¯ä»¥è¿”å›åˆ° Still çŠ¶æ€ã€‚</span><br><span class=\"line\">Moving --&gt; Crash</span><br><span class=\"line\">    ç³»ç»Ÿä» Moving çŠ¶æ€å¯ä»¥è¿›å…¥ Crash çŠ¶æ€ã€‚</span><br><span class=\"line\">Crash --&gt; [*]</span><br><span class=\"line\">    ç³»ç»Ÿä» Crash çŠ¶æ€å¯ä»¥è¿›å…¥ç»ˆæ­¢çŠ¶æ€ï¼ˆè¡¨ç¤ºç³»ç»Ÿå´©æºƒæˆ–ç»ˆæ­¢ï¼‰ã€‚</span><br></pre></td></tr></table></figure>\n<h3 id=\"Entity-Relationship-Diagram\">Entity Relationship Diagram</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç”¨äºç»˜åˆ¶å®ä½“å…³ç³»å›¾ï¼Œæ˜¾ç¤ºå®ä½“ä¹‹é—´çš„å…³ç³»ï¼ŒåŒ…æ‹¬å…³è”ã€ä¾èµ–ç­‰ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://mermaid.js.org/syntax/entityRelationshipDiagram.html\">Mermaid Entity Relationship Diagram</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>type ä¸º <code>&quot;erDiagram&quot;</code></p>\n</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;% mermaid erDiagram %&#125;</span><br><span class=\"line\">CUSTOMER ||--o&#123; ORDER : places</span><br><span class=\"line\">ORDER ||--|&#123; ITEM : contains</span><br><span class=\"line\">CUSTOMER &#125;|..|&#123; DELIVERY-ADDRESS : has</span><br><span class=\"line\">&#123;% endmermaid %&#125;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ•ˆæœ</p>\n</li>\n</ul>\n<pre><code class=\"highlight mermaid\">erDiagram\nCUSTOMER ||--o&#123; ORDER : places\nORDER ||--|&#123; ITEM : contains\nCUSTOMER &#125;|..|&#123; DELIVERY-ADDRESS : has</code></pre>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¯´æ˜</p>\n</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">åŸºæœ¬ç»“æ„</span><br><span class=\"line\">erDiagram</span><br><span class=\"line\">    å®šä¹‰è¿™æ˜¯ä¸€ä¸ªå®ä½“å…³ç³»å›¾ã€‚</span><br><span class=\"line\">    å±•ç¤ºæ•°æ®åº“ä¸­è¡¨ï¼ˆå®ä½“ï¼‰ä¹‹é—´çš„å…³ç³»ã€‚</span><br><span class=\"line\">å®ä½“</span><br><span class=\"line\">    ä¾‹å¦‚ CUSTOMERã€ORDER å’Œ ITEMï¼Œæ¯ä¸ªå®ä½“å¯¹åº”æ•°æ®åº“ä¸­çš„ä¸€ä¸ªè¡¨ã€‚</span><br><span class=\"line\">å…³ç³»</span><br><span class=\"line\">    ||--o&#123; è¡¨ç¤ºä¸€å¯¹å¤šå…³ç³»ï¼ˆ1:Nï¼‰ã€‚</span><br><span class=\"line\">    ||--|&#123; è¡¨ç¤ºä¸€å¯¹å¤šå…³ç³»ï¼ˆ1:Nï¼‰ï¼Œä½†å¼ºè°ƒå®ä½“çš„å”¯ä¸€æ€§ï¼ˆæ¯ä¸ªå­è®°å½•å±äºå”¯ä¸€çš„çˆ¶è®°å½•ï¼‰ã€‚</span><br><span class=\"line\">    &#125;|..|&#123; è¡¨ç¤ºå¤šå¯¹å¤šå…³ç³»ï¼ˆN:Mï¼‰ã€‚</span><br><span class=\"line\">æ³¨é‡Š</span><br><span class=\"line\">    : åçš„æ–‡å­—æ˜¯å…³ç³»çš„æè¿°ï¼Œä¾‹å¦‚ placesã€containsã€hasã€‚</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">ä»£ç é€æ­¥è§£æ</span><br><span class=\"line\">CUSTOMER ||--o&#123; ORDER : places</span><br><span class=\"line\">    è¡¨ç¤ºä¸€ä¸ªå®¢æˆ· (CUSTOMER) å¯ä»¥ä¸‹å¤šä¸ªè®¢å• (ORDER)ã€‚</span><br><span class=\"line\">    ||--o&#123; è¡¨ç¤º ä¸€å¯¹å¤šå…³ç³»ï¼ˆ1:Nï¼‰ï¼Œå³ä¸€ä¸ªå®¢æˆ·å¯¹åº”å¤šä¸ªè®¢å•ã€‚</span><br><span class=\"line\">ORDER ||--|&#123; ITEM : contains</span><br><span class=\"line\">    è¡¨ç¤ºä¸€ä¸ªè®¢å• (ORDER) åŒ…å«å¤šä¸ªå•†å“ (ITEM)ã€‚</span><br><span class=\"line\">    ||--|&#123; è¡¨ç¤º ä¸€å¯¹å¤šå…³ç³»ï¼Œä¸”æ¯ä¸ªå•†å“çš„è®°å½•ä¸æŸä¸ªè®¢å•å”¯ä¸€å¯¹åº”ã€‚</span><br><span class=\"line\">CUSTOMER &#125;|..|&#123; DELIVERY-ADDRESS : has</span><br><span class=\"line\">    è¡¨ç¤ºä¸€ä¸ªå®¢æˆ· (CUSTOMER) å¯ä»¥æœ‰å¤šä¸ªé…é€åœ°å€ (DELIVERY-ADDRESS)ï¼Œè€Œæ¯ä¸ªé…é€åœ°å€ä¹Ÿå¯èƒ½å¯¹åº”å¤šä¸ªå®¢æˆ·ã€‚</span><br><span class=\"line\">    &#125;|..|&#123; è¡¨ç¤º å¤šå¯¹å¤šå…³ç³»ï¼ˆN:Mï¼‰ã€‚</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h3 id=\"Gantt-Chart\">Gantt Chart</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç”¨äºç»˜åˆ¶ç”˜ç‰¹å›¾ï¼Œæ˜¾ç¤ºä»»åŠ¡è®¡åˆ’ã€è¿›åº¦å’Œèµ„æºåˆ†é…ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://mermaid.js.org/syntax/gantt.html\">Mermaid Gantt Chart</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>type ä¸º <code>&quot;gantt&quot;</code></p>\n</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;% mermaid gantt %&#125;</span><br><span class=\"line\">title Project Timeline</span><br><span class=\"line\">dateFormat  YYYY-MM-DD</span><br><span class=\"line\">section Section1</span><br><span class=\"line\">Completed :done,    des1, 2014-01-06,2014-01-08</span><br><span class=\"line\">Active        :active,  des2, 2014-01-07, 3d</span><br><span class=\"line\">Parallel 1   :         des3, after des1, 1d</span><br><span class=\"line\">Parallel 2   :         des4, after des1, 1d</span><br><span class=\"line\">Parallel 3   :         des5, after des3, 1d</span><br><span class=\"line\">Parallel 4   :         des6, after des4, 1d</span><br><span class=\"line\">section Section2</span><br><span class=\"line\">Task 1 :  t1,after des6,5d</span><br><span class=\"line\">Task 2 :  t2,after t1,3d</span><br><span class=\"line\">&#123;% endmermaid %&#125;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ•ˆæœ</p>\n</li>\n</ul>\n<pre><code class=\"highlight mermaid\">gantt\ntitle Project Timeline\ndateFormat  YYYY-MM-DD\nsection Section1\nCompleted :done,    des1, 2014-01-06,2014-01-08\nActive        :active,  des2, 2014-01-07, 3d\nParallel 1   :         des3, after des1, 1d\nParallel 2   :         des4, after des1, 1d\nParallel 3   :         des5, after des3, 1d\nParallel 4   :         des6, after des4, 1d\nsection Section2\nTask 1 :  t1,after des6,5d\nTask 2 :  t2,after t1,3d</code></pre>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¯´æ˜</p>\n</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">åŸºæœ¬ç»“æ„</span><br><span class=\"line\">gantt</span><br><span class=\"line\">    å®šä¹‰ä¸€ä¸ªç”˜ç‰¹å›¾ï¼Œç”¨äºè¡¨ç¤ºä»»åŠ¡çš„æ—¶é—´åˆ†å¸ƒå’Œä¾èµ–å…³ç³»ã€‚</span><br><span class=\"line\">title</span><br><span class=\"line\">    å®šä¹‰ç”˜ç‰¹å›¾çš„æ ‡é¢˜ï¼Œè¿™é‡Œæ˜¯ Project Timelineã€‚</span><br><span class=\"line\">dateFormat</span><br><span class=\"line\">    å®šä¹‰æ—¥æœŸæ ¼å¼ï¼Œè¿™é‡Œæ˜¯ YYYY-MM-DDï¼ˆå¹´-æœˆ-æ—¥ï¼‰ã€‚</span><br><span class=\"line\">section</span><br><span class=\"line\">    å®šä¹‰ä»»åŠ¡çš„åˆ†ç±»ï¼ˆéƒ¨åˆ†ï¼‰ã€‚</span><br><span class=\"line\">    æ¯ä¸ª section ä¸‹åŒ…å«ä¸€ç»„ä»»åŠ¡ï¼Œä»»åŠ¡åœ¨å›¾è¡¨ä¸­åˆ†ç»„æ˜¾ç¤ºã€‚</span><br><span class=\"line\">ä»»åŠ¡æ ¼å¼</span><br><span class=\"line\">    æ¯ä¸ªä»»åŠ¡æŒ‰ä»¥ä¸‹æ ¼å¼å®šä¹‰ï¼š</span><br><span class=\"line\">        ä»»åŠ¡åç§° : çŠ¶æ€, æ ‡è¯†ç¬¦, å¼€å§‹æ—¥æœŸæˆ–ä¾èµ–, æŒç»­æ—¶é—´</span><br><span class=\"line\">    ä»»åŠ¡åç§°ï¼šä»»åŠ¡çš„æè¿°ã€‚</span><br><span class=\"line\">    çŠ¶æ€ï¼šå¯é€‰ï¼Œè¡¨ç¤ºä»»åŠ¡çŠ¶æ€ï¼š</span><br><span class=\"line\">        doneï¼šå·²å®Œæˆã€‚</span><br><span class=\"line\">        activeï¼šæ­£åœ¨è¿›è¡Œã€‚</span><br><span class=\"line\">    æ ‡è¯†ç¬¦ï¼šä»»åŠ¡çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œç”¨äºå®šä¹‰ä¾èµ–å…³ç³»ã€‚</span><br><span class=\"line\">    æ—¶é—´ï¼šå¯ä»¥æ˜¯å¼€å§‹æ—¥æœŸã€ç»“æŸæ—¥æœŸã€æˆ–ä¾èµ–ä»»åŠ¡ã€‚</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">ä»£ç é€æ­¥è§£æ</span><br><span class=\"line\">section Section1</span><br><span class=\"line\">    å®šä¹‰ä¸€ä¸ªåä¸º Section1 çš„éƒ¨åˆ†ï¼ŒåŒ…å«ä¸€ç»„ä»»åŠ¡ã€‚</span><br><span class=\"line\">Completed :done, des1, 2014-01-06,2014-01-08</span><br><span class=\"line\">    ä»»åŠ¡åç§°ï¼šCompletedã€‚</span><br><span class=\"line\">    çŠ¶æ€ï¼šdoneï¼ˆå·²å®Œæˆï¼‰ã€‚</span><br><span class=\"line\">    æ ‡è¯†ç¬¦ï¼šdes1ã€‚</span><br><span class=\"line\">    å¼€å§‹æ—¥æœŸï¼š2014-01-06ã€‚</span><br><span class=\"line\">    ç»“æŸæ—¥æœŸï¼š2014-01-08ã€‚</span><br><span class=\"line\">Active :active, des2, 2014-01-07, 3d</span><br><span class=\"line\">    ä»»åŠ¡åç§°ï¼šActiveã€‚</span><br><span class=\"line\">    çŠ¶æ€ï¼šactiveï¼ˆæ­£åœ¨è¿›è¡Œï¼‰ã€‚</span><br><span class=\"line\">    æ ‡è¯†ç¬¦ï¼šdes2ã€‚</span><br><span class=\"line\">    å¼€å§‹æ—¥æœŸï¼š2014-01-07ã€‚</span><br><span class=\"line\">    æŒç»­æ—¶é—´ï¼š3dï¼ˆ3å¤©ï¼‰ã€‚</span><br><span class=\"line\">Parallel 1 : des3, after des1, 1d</span><br><span class=\"line\">    ä»»åŠ¡åç§°ï¼šParallel 1ã€‚</span><br><span class=\"line\">    æ— çŠ¶æ€ï¼ˆé»˜è®¤å€¼ï¼‰ã€‚</span><br><span class=\"line\">    æ ‡è¯†ç¬¦ï¼šdes3ã€‚</span><br><span class=\"line\">    å¼€å§‹æ—¶é—´ï¼šä¾èµ–ä»»åŠ¡ des1ï¼ˆåœ¨ä»»åŠ¡ Completed åå¼€å§‹ï¼‰ã€‚</span><br><span class=\"line\">    æŒç»­æ—¶é—´ï¼š1dï¼ˆ1å¤©ï¼‰ã€‚</span><br><span class=\"line\">Parallel 2 : des4, after des1, 1d</span><br><span class=\"line\">    ä»»åŠ¡åç§°ï¼šParallel 2ã€‚</span><br><span class=\"line\">    æ— çŠ¶æ€ã€‚</span><br><span class=\"line\">    æ ‡è¯†ç¬¦ï¼šdes4ã€‚</span><br><span class=\"line\">    å¼€å§‹æ—¶é—´ï¼šä¾èµ–ä»»åŠ¡ des1ï¼ˆåœ¨ä»»åŠ¡ Completed åå¼€å§‹ï¼‰ã€‚</span><br><span class=\"line\">    æŒç»­æ—¶é—´ï¼š1dï¼ˆ1å¤©ï¼‰ã€‚</span><br><span class=\"line\">Parallel 3 : des5, after des3, 1d</span><br><span class=\"line\">    ä»»åŠ¡åç§°ï¼šParallel 3ã€‚</span><br><span class=\"line\">    æ— çŠ¶æ€ã€‚</span><br><span class=\"line\">    æ ‡è¯†ç¬¦ï¼šdes5ã€‚</span><br><span class=\"line\">    å¼€å§‹æ—¶é—´ï¼šä¾èµ–ä»»åŠ¡ des3ï¼ˆåœ¨ä»»åŠ¡ Parallel 1 åå¼€å§‹ï¼‰ã€‚</span><br><span class=\"line\">    æŒç»­æ—¶é—´ï¼š1dï¼ˆ1å¤©ï¼‰ã€‚</span><br><span class=\"line\">Parallel 4 : des6, after des4, 1d</span><br><span class=\"line\">    ä»»åŠ¡åç§°ï¼šParallel 4ã€‚</span><br><span class=\"line\">    æ— çŠ¶æ€ã€‚</span><br><span class=\"line\">    æ ‡è¯†ç¬¦ï¼šdes6ã€‚</span><br><span class=\"line\">    å¼€å§‹æ—¶é—´ï¼šä¾èµ–ä»»åŠ¡ des4ï¼ˆåœ¨ä»»åŠ¡ Parallel 2 åå¼€å§‹ï¼‰ã€‚</span><br><span class=\"line\">    æŒç»­æ—¶é—´ï¼š1dï¼ˆ1å¤©ï¼‰ã€‚</span><br><span class=\"line\">section Section2</span><br><span class=\"line\">    å®šä¹‰ç”˜ç‰¹å›¾çš„ç¬¬äºŒéƒ¨åˆ†ï¼Œç”¨äºåˆ†ç»„æ˜¾ç¤ºåç»­ä»»åŠ¡ã€‚</span><br><span class=\"line\">    ä»»åŠ¡å±äºä¸åŒçš„éƒ¨åˆ†ä»¥ä¾¿åˆ†ç±»å’Œåˆ†ç»„ã€‚</span><br><span class=\"line\">Task 1 : t1, after des6, 5d</span><br><span class=\"line\">    ä»»åŠ¡åç§°ï¼šTask 1ã€‚</span><br><span class=\"line\">    æ ‡è¯†ç¬¦ï¼št1ã€‚</span><br><span class=\"line\">    å¼€å§‹æ—¶é—´ï¼šä¾èµ–ä»»åŠ¡ des6ï¼ˆParallel 4ï¼‰å®Œæˆåå¼€å§‹ã€‚</span><br><span class=\"line\">    æŒç»­æ—¶é—´ï¼š5dï¼ˆ5å¤©ï¼‰ã€‚</span><br><span class=\"line\">Task 2 : t2, after t1, 3d</span><br><span class=\"line\">    ä»»åŠ¡åç§°ï¼šTask 2ã€‚</span><br><span class=\"line\">    æ ‡è¯†ç¬¦ï¼št2ã€‚</span><br><span class=\"line\">    å¼€å§‹æ—¶é—´ï¼šä¾èµ–ä»»åŠ¡ t1ï¼ˆTask 1ï¼‰å®Œæˆåå¼€å§‹ã€‚</span><br><span class=\"line\">    æŒç»­æ—¶é—´ï¼š3dï¼ˆ3å¤©ï¼‰ã€‚</span><br></pre></td></tr></table></figure>\n<h3 id=\"Pie-Chart\">Pie Chart</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç”¨äºç»˜åˆ¶é¥¼çŠ¶å›¾ï¼Œæ˜¾ç¤ºæ•°æ®åˆ†å¸ƒæƒ…å†µã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://mermaid.js.org/syntax/pie.html\">Mermaid Pie Chart</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>type ä¸º <code>&quot;pie&quot;</code></p>\n</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;% mermaid pie showData %&#125;</span><br><span class=\"line\">%%&#123;init: &#123;&quot;pie&quot;: &#123;&quot;textPosition&quot;: 0.4&#125;, &quot;themeVariables&quot;: &#123;&quot;pieOuterStrokeWidth&quot;: &quot;5px&quot;,&quot;pie1&quot;: &quot;#ff9999&quot;,&quot;pie2&quot;: &quot;#99ccff&quot;,&quot;pie3&quot;: &quot;#99ff99&quot;&#125;&#125; &#125;%%</span><br><span class=\"line\">title Expenses</span><br><span class=\"line\">&quot;Rent&quot; : 200</span><br><span class=\"line\">&quot;Food&quot; : 200</span><br><span class=\"line\">&quot;Transport&quot; : 400</span><br><span class=\"line\">&#123;% endmermaid %&#125;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ•ˆæœ</p>\n</li>\n</ul>\n<pre><code class=\"highlight mermaid\">%%&#123;init: &#123;&quot;pie&quot;: &#123;&quot;textPosition&quot;: 0.4&#125;, &quot;themeVariables&quot;: &#123;&quot;pieOuterStrokeWidth&quot;: &quot;5px&quot;,&quot;pie1&quot;: &quot;#ff9999&quot;,&quot;pie2&quot;: &quot;#99ccff&quot;,&quot;pie3&quot;: &quot;#99ff99&quot;&#125;&#125; &#125;%%\npie showData\ntitle Expenses\n&quot;Rent&quot; : 200\n&quot;Food&quot; : 200\n&quot;Transport&quot; : 400</code></pre>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¯´æ˜</p>\n</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">åŸºæœ¬ç»“æ„</span><br><span class=\"line\">%%&#123;init: ...&#125;%%ï¼š</span><br><span class=\"line\">    Mermaid.js çš„åˆå§‹åŒ–é…ç½®ï¼Œç”¨äºå…¨å±€è®¾ç½®å›¾è¡¨å±æ€§å’Œæ ·å¼ã€‚</span><br><span class=\"line\">    pie å±æ€§</span><br><span class=\"line\">        textPosition: è®¾ç½®é¥¼å›¾æ•°æ®æ ‡ç­¾çš„ç›¸å¯¹ä½ç½®ã€‚</span><br><span class=\"line\">            å€¼èŒƒå›´ä¸º 0 åˆ° 1ï¼Œè¡¨ç¤ºæ ‡ç­¾è·ç¦»é¥¼å›¾ä¸­å¿ƒçš„æ¯”ä¾‹ã€‚0.4 è¡¨ç¤ºæ ‡ç­¾è·ç¦»ä¸­å¿ƒè¾ƒè¿‘ï¼Œæ¥è¿‘ 40% çš„åŠå¾„ä½ç½®ã€‚</span><br><span class=\"line\">    themeVariables</span><br><span class=\"line\">        pieOuterStrokeWidth: è®¾ç½®é¥¼å›¾å¤–ç¯çš„å®½åº¦ã€‚è®¾ç½®ä¸º 5pxï¼Œè¡¨ç¤ºé¥¼å›¾æœ‰æ˜æ˜¾çš„å¤–è¾¹æ¡†ã€‚</span><br><span class=\"line\">        &quot;pie1&quot;: &quot;#ff9999&quot;,&quot;pie2&quot;: &quot;#99ccff&quot;,&quot;pie3&quot;: &quot;#99ff99&quot;: é…ç½®æ¯ä¸ªåˆ†åŒºçš„é¢œè‰²ã€‚</span><br><span class=\"line\">pie</span><br><span class=\"line\">    å®šä¹‰è¿™æ˜¯ä¸€ä¸ªé¥¼å›¾ã€‚</span><br><span class=\"line\">showData</span><br><span class=\"line\">    æ˜¾ç¤ºæ•°æ®é¡¹çš„æ•°å€¼ã€‚</span><br><span class=\"line\">title Expenses</span><br><span class=\"line\">    è®¾ç½®é¥¼å›¾çš„æ ‡é¢˜ä¸º Expensesï¼ˆè´¹ç”¨ï¼‰ã€‚</span><br><span class=\"line\">æ•°æ®é¡¹</span><br><span class=\"line\">    æ•°æ®é¡¹å®šä¹‰äº†é¥¼å›¾çš„å„ä¸ªéƒ¨åˆ†ï¼š</span><br><span class=\"line\">        &quot;Rent&quot; : 200ï¼Œå æ¯”ï¼š200 / (200 + 200 + 400) = 1/4 = 25%ã€‚</span><br><span class=\"line\">        &quot;Food&quot; : 200ï¼Œå æ¯”ï¼š200 / (200 + 200 + 400) = 1/4 = 25%ã€‚</span><br><span class=\"line\">        &quot;Transport&quot; : 400ï¼Œå æ¯”ï¼š400 / (200 + 200 + 400) = 1/2 = 50%ã€‚</span><br><span class=\"line\">    æ¯ä¸ªæ•°æ®é¡¹åŒ…å«ï¼š</span><br><span class=\"line\">        æ ‡ç­¾ï¼šå¦‚ &quot;Rent&quot;ã€&quot;Food&quot;ã€&quot;Transport&quot;ã€‚</span><br><span class=\"line\">        æ•°å€¼ï¼šå¦‚ 200ã€400ï¼Œè¡¨ç¤ºè¯¥éƒ¨åˆ†çš„æƒé‡æˆ–æ•°å€¼å¤§å°ã€‚</span><br></pre></td></tr></table></figure>\n<h3 id=\"XY-Chart\">XY Chart</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç”¨äºç»˜åˆ¶ XY è½´å›¾(æŸ±çŠ¶å›¾å’ŒæŠ˜çº¿å›¾)ï¼Œæ˜¾ç¤ºæ•°æ®åˆ†å¸ƒå’Œè¶‹åŠ¿ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://mermaid.js.org/syntax/xyChart.html\">Mermaid XY Chart</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>type ä¸º <code>&quot;xychart-beta&quot;</code>ï¼Œç›®å‰ xychart-beta è¿˜å¤„åœ¨æ”¹è¿›é˜¶æ®µ</p>\n</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;% mermaid xychart-beta %&#125;</span><br><span class=\"line\">%%&#123;init: &#123;&quot;xyChart&quot;: &#123;&quot;width&quot;: 900,&quot;height&quot;:600&#125;, &quot;themeVariables&quot;: &#123;&quot;xyChart&quot;:&#123;&quot;titleColor&quot;: &quot;#ff0000&quot;&#125;&#125;&#125; &#125;%%</span><br><span class=\"line\">title &quot;Sales Revenue&quot;</span><br><span class=\"line\">x-axis [jan, feb, mar, apr, may, jun, jul, aug, sep, oct, nov, dec]</span><br><span class=\"line\">y-axis &quot;Revenue (in $)&quot; 4000 --&gt; 11000</span><br><span class=\"line\">bar [5000, 6000, 7500, 8200, 9500, 10500, 11000, 10200, 9200, 8500, 7000, 6000]</span><br><span class=\"line\">line [5000, 6000, 7500, 8200, 9500, 10500, 11000, 10200, 9200, 8500, 7000, 6000]</span><br><span class=\"line\">&#123;% endmermaid %&#125;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ•ˆæœ</p>\n</li>\n</ul>\n<pre><code class=\"highlight mermaid\">---\nconfig:\n    xyChart:\n        width: 900\n        height: 600\n    themeVariables:\n        xyChart:\n            titleColor: &quot;#ff0000&quot;\n---\nxychart-beta\ntitle &quot;Sales Revenue&quot;\nx-axis [jan, feb, mar, apr, may, jun, jul, aug, sep, oct, nov, dec]\ny-axis &quot;Revenue (in $)&quot; 4000 --&gt; 11000\nbar [5000, 6000, 7500, 8200, 9500, 10500, 11000, 10200, 9200, 8500, 7000, 6000]\nline [5000, 6000, 7500, 8200, 9500, 10500, 11000, 10200, 9200, 8500, 7000, 6000]</code></pre>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¯´æ˜</p>\n</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ä»£ç ç»“æ„è§£æ</span><br><span class=\"line\">%%&#123;init: ...&#125;%%ï¼š</span><br><span class=\"line\">    Mermaid.js çš„åˆå§‹åŒ–é…ç½®ï¼Œç”¨äºå…¨å±€è®¾ç½®å›¾è¡¨å±æ€§å’Œæ ·å¼ã€‚</span><br><span class=\"line\">    xyChart.width å’Œ xyChart.height : è®¾ç½®å›¾è¡¨çš„å®½åº¦å’Œé«˜åº¦ã€‚</span><br><span class=\"line\">    themeVariables.xyChart.titleColor: è®¾ç½®æ ‡é¢˜çš„é¢œè‰²ã€‚</span><br><span class=\"line\">title</span><br><span class=\"line\">    è®¾ç½®å›¾è¡¨çš„æ ‡é¢˜ã€‚</span><br><span class=\"line\">åæ ‡è½´å®šä¹‰</span><br><span class=\"line\">    x-axisï¼šXè½´æ ‡ç­¾ä¸ºæœˆä»½ï¼ˆä»1æœˆåˆ°12æœˆï¼‰ã€‚</span><br><span class=\"line\">    y-axisï¼šYè½´èŒƒå›´ä» $4000 åˆ° $11000ï¼Œå•ä½ä¸ºç¾å…ƒã€‚</span><br><span class=\"line\">æ•°æ®</span><br><span class=\"line\">    barï¼šæŸ±çŠ¶å›¾æ•°æ®ï¼Œè¡¨ç¤ºæ¯ä¸ªæœˆçš„é”€å”®æ”¶å…¥ã€‚</span><br><span class=\"line\">    lineï¼šæŠ˜çº¿å›¾æ•°æ®ï¼Œè¡¨ç¤ºæ¯ä¸ªæœˆçš„é”€é‡è¶‹åŠ¿ã€‚</span><br></pre></td></tr></table></figure>\n<h3 id=\"Journey-Diagram\">Journey Diagram</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç”¨äºç»˜åˆ¶æ—…ç¨‹å›¾ï¼Œæ˜¾ç¤ºç”¨æˆ·çš„ä½“éªŒæµç¨‹ï¼ŒåŒ…æ‹¬ç”¨æˆ·è¿›å…¥ç³»ç»Ÿã€æ“ä½œã€é€€å‡ºç³»ç»Ÿç­‰ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://mermaid.js.org/syntax/userJourney.html\">Mermaid Journey Diagram</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>type ä¸º <code>&quot;journey&quot;</code></p>\n</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;% mermaid journey %&#125;</span><br><span class=\"line\">title My working day</span><br><span class=\"line\">section Morning</span><br><span class=\"line\">  wake up : 5 : me</span><br><span class=\"line\">  go to work : 3 : me,you</span><br><span class=\"line\">section Lunch</span><br><span class=\"line\">  have lunch : 5 : me,you</span><br><span class=\"line\">  go to work : 1 : me,you</span><br><span class=\"line\">section Dinner</span><br><span class=\"line\">  finish your meal : 5 : me</span><br><span class=\"line\">section Go home</span><br><span class=\"line\">  go home : 5 : me</span><br><span class=\"line\">&#123;% endmermaid %&#125;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ•ˆæœ</p>\n</li>\n</ul>\n<pre><code class=\"highlight mermaid\">journey\ntitle My working day\nsection Morning\n  wake up : 5 : me\n  go to work : 3 : me,you\nsection Lunch\n  have lunch : 5 : me,you\n  go to work : 1 : me,you\nsection Dinner\n  finish your meal : 5 : me\nsection Go home\n  go home : 5 : me</code></pre>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¯´æ˜</p>\n</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">åŸºæœ¬ç»“æ„</span><br><span class=\"line\">journey</span><br><span class=\"line\">    å®šä¹‰è¿™æ˜¯ä¸€ä¸ªæ—…ç¨‹å›¾ã€‚</span><br><span class=\"line\">title My working day</span><br><span class=\"line\">    è®¾ç½®æ—…ç¨‹å›¾çš„æ ‡é¢˜ä¸º &quot;My working day&quot;ï¼ˆæˆ‘çš„å·¥ä½œæ—¥ï¼‰ã€‚</span><br><span class=\"line\">section</span><br><span class=\"line\">    å®šä¹‰æ—…ç¨‹å›¾çš„åˆ†æ®µï¼Œç”¨äºè¡¨ç¤ºä¸€å¤©ä¸­çš„ä¸åŒé˜¶æ®µï¼Œä¾‹å¦‚ï¼š</span><br><span class=\"line\">        Morningï¼ˆæ—©æ™¨ï¼‰ã€‚</span><br><span class=\"line\">        Lunchï¼ˆåˆé¤æ—¶é—´ï¼‰ã€‚</span><br><span class=\"line\">        Dinnerï¼ˆæ™šé¤ï¼‰ã€‚</span><br><span class=\"line\">        Go homeï¼ˆå›å®¶ï¼‰ã€‚</span><br><span class=\"line\">ä»»åŠ¡æ ¼å¼</span><br><span class=\"line\">    ä»»åŠ¡æè¿° : æ»¡æ„åº¦è¯„åˆ† : å‚ä¸è€…</span><br><span class=\"line\">        ä»»åŠ¡æè¿°ï¼šæè¿°å…·ä½“çš„ä»»åŠ¡æˆ–æ´»åŠ¨ã€‚</span><br><span class=\"line\">        æ»¡æ„åº¦è¯„åˆ†ï¼šä» 1 åˆ° 5ï¼Œè¡¨ç¤ºå¯¹ä»»åŠ¡æˆ–æ´»åŠ¨çš„æ»¡æ„ç¨‹åº¦ã€‚</span><br><span class=\"line\">        å‚ä¸è€…ï¼šå‚ä¸ä»»åŠ¡çš„äººï¼Œå¯ä»¥æ˜¯ meï¼ˆè‡ªå·±ï¼‰ã€youï¼ˆå…¶ä»–äººï¼‰æˆ–ä¸¤è€…ã€‚</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">ä»£ç é€æ­¥è§£æ</span><br><span class=\"line\">section Morning</span><br><span class=\"line\">    wake up : 5 : me</span><br><span class=\"line\">        æ´»åŠ¨ï¼šwake upï¼ˆèµ·åºŠï¼‰ã€‚</span><br><span class=\"line\">        æ»¡æ„åº¦ï¼š5ï¼ˆéå¸¸æ»¡æ„ï¼‰ã€‚</span><br><span class=\"line\">        å‚ä¸è€…ï¼šmeï¼ˆè‡ªå·±ï¼‰ã€‚</span><br><span class=\"line\">    go to work : 3 : me,you</span><br><span class=\"line\">        æ´»åŠ¨ï¼šgo to workï¼ˆå»å·¥ä½œï¼‰ã€‚</span><br><span class=\"line\">        æ»¡æ„åº¦ï¼š3ï¼ˆä¸­ç­‰æ»¡æ„ï¼‰ã€‚</span><br><span class=\"line\">        å‚ä¸è€…ï¼šme å’Œ youï¼ˆè‡ªå·±å’Œå…¶ä»–äººï¼‰ã€‚</span><br><span class=\"line\">section Lunch</span><br><span class=\"line\">    have lunch : 5 : me,you</span><br><span class=\"line\">        æ´»åŠ¨ï¼šhave lunchï¼ˆåƒåˆé¥­ï¼‰ã€‚</span><br><span class=\"line\">        æ»¡æ„åº¦ï¼š5ï¼ˆéå¸¸æ»¡æ„ï¼‰ã€‚</span><br><span class=\"line\">        å‚ä¸è€…ï¼šme å’Œ youï¼ˆè‡ªå·±å’Œå…¶ä»–äººï¼‰ã€‚</span><br><span class=\"line\">    go to work : 1 : me,you</span><br><span class=\"line\">        æ´»åŠ¨ï¼šgo to workï¼ˆåƒå®Œé¥­ç»§ç»­å·¥ä½œï¼‰ã€‚</span><br><span class=\"line\">        æ»¡æ„åº¦ï¼š1ï¼ˆéå¸¸ä¸æ»¡æ„ï¼‰ã€‚</span><br><span class=\"line\">        å‚ä¸è€…ï¼šme å’Œ youã€‚</span><br><span class=\"line\">section Dinner</span><br><span class=\"line\">    finish your meal : 5 : me</span><br><span class=\"line\">        æ´»åŠ¨ï¼šfinish your mealï¼ˆåƒå®Œé¥­ï¼‰ã€‚</span><br><span class=\"line\">        æ»¡æ„åº¦ï¼š5ï¼ˆéå¸¸æ»¡æ„ï¼‰ã€‚</span><br><span class=\"line\">        å‚ä¸è€…ï¼šmeï¼ˆè‡ªå·±ï¼‰ã€‚</span><br><span class=\"line\">section Go home</span><br><span class=\"line\">    go home : 5 : me</span><br><span class=\"line\">        æ´»åŠ¨ï¼šgo homeï¼ˆå›å®¶ï¼‰ã€‚</span><br><span class=\"line\">        æ»¡æ„åº¦ï¼š5ï¼ˆéå¸¸æ»¡æ„ï¼‰ã€‚</span><br><span class=\"line\">        å‚ä¸è€…ï¼šmeï¼ˆè‡ªå·±ï¼‰ã€‚</span><br></pre></td></tr></table></figure>\n<h3 id=\"Requirement-Diagram\">Requirement Diagram</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç”¨äºç»˜åˆ¶éœ€æ±‚å›¾ï¼Œæ˜¾ç¤ºç³»ç»Ÿçš„åŠŸèƒ½éœ€æ±‚å’Œä¾èµ–å…³ç³»ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://mermaid.js.org/syntax/requirementDiagram.html\">Mermaid Requirement Diagram</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>type ä¸º <code>&quot;requirementDiagram&quot;</code></p>\n</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;% mermaid requirementDiagram %&#125;</span><br><span class=\"line\">requirement &quot;æµ‹è¯•éœ€æ±‚&quot; &#123;</span><br><span class=\"line\">    id: 1</span><br><span class=\"line\">    text: &quot;æµ‹è¯•æ–‡æœ¬&quot;</span><br><span class=\"line\">    risk: High</span><br><span class=\"line\">    verifymethod: test</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">requirement &quot;æµ‹è¯•éœ€æ±‚2&quot; &#123;</span><br><span class=\"line\">    id: 2</span><br><span class=\"line\">    text: &quot;æµ‹è¯•æ–‡æœ¬&quot;</span><br><span class=\"line\">    risk: High</span><br><span class=\"line\">    verifymethod: test</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">element &quot;æµ‹è¯•å®ä½“&quot; &#123;</span><br><span class=\"line\">    type: &quot;æ¨¡æ‹Ÿ&quot;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">&quot;æµ‹è¯•å®ä½“&quot; - satisfies -&gt; &quot;æµ‹è¯•éœ€æ±‚&quot;</span><br><span class=\"line\">&quot;æµ‹è¯•å®ä½“&quot; - satisfies -&gt; &quot;æµ‹è¯•éœ€æ±‚2&quot;</span><br><span class=\"line\">&#123;% endmermaid %&#125;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ•ˆæœ</p>\n</li>\n</ul>\n<pre><code class=\"highlight mermaid\">requirementDiagram\nrequirement &quot;æµ‹è¯•éœ€æ±‚&quot; &#123;\n    id: 1\n    text: &quot;æµ‹è¯•æ–‡æœ¬&quot;\n    risk: High\n    verifymethod: test\n&#125;\nrequirement &quot;æµ‹è¯•éœ€æ±‚2&quot; &#123;\n    id: 2\n    text: &quot;æµ‹è¯•æ–‡æœ¬&quot;\n    risk: High\n    verifymethod: test\n&#125;\nelement &quot;æµ‹è¯•å®ä½“&quot; &#123;\n    type: &quot;æ¨¡æ‹Ÿ&quot;\n&#125;\n&quot;æµ‹è¯•å®ä½“&quot; - satisfies -&gt; &quot;æµ‹è¯•éœ€æ±‚&quot;\n&quot;æµ‹è¯•å®ä½“&quot; - satisfies -&gt; &quot;æµ‹è¯•éœ€æ±‚2&quot;</code></pre>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¯´æ˜</p>\n</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">åŸºæœ¬ç»“æ„</span><br><span class=\"line\">requirementDiagram</span><br><span class=\"line\">    å®šä¹‰è¿™æ˜¯ä¸€ä¸ªéœ€æ±‚å›¾ã€‚</span><br><span class=\"line\">requirement</span><br><span class=\"line\">    å®šä¹‰ä¸€ä¸ªéœ€æ±‚èŠ‚ç‚¹ï¼ŒåŒ…å«éœ€æ±‚çš„è¯¦ç»†å±æ€§ï¼Œå¦‚ï¼š</span><br><span class=\"line\">        idï¼šéœ€æ±‚ç¼–å·ã€‚</span><br><span class=\"line\">        textï¼šéœ€æ±‚çš„æè¿°ã€‚</span><br><span class=\"line\">        riskï¼šéœ€æ±‚çš„é£é™©çº§åˆ«ï¼ˆå¦‚ High è¡¨ç¤ºé«˜é£é™©ï¼‰ã€‚</span><br><span class=\"line\">        verifymethodï¼šéªŒè¯éœ€æ±‚çš„æ–¹æ³•ï¼ˆå¦‚ test è¡¨ç¤ºé€šè¿‡æµ‹è¯•éªŒè¯ï¼‰ã€‚</span><br><span class=\"line\">element</span><br><span class=\"line\">    å®šä¹‰ä¸€ä¸ªå…ƒç´ ï¼Œç”¨äºè¡¨ç¤ºç³»ç»Ÿä¸­çš„æŸä¸ªå®ä½“æˆ–å¯¹è±¡ã€‚</span><br><span class=\"line\">    åŒ…å«å±æ€§ï¼Œå¦‚ï¼š</span><br><span class=\"line\">        typeï¼šå®ä½“çš„ç±»å‹ï¼ˆå¦‚ æ¨¡æ‹Ÿ è¡¨ç¤ºæ¨¡æ‹Ÿå®ä½“ï¼‰ã€‚</span><br><span class=\"line\">å…³ç³»å®šä¹‰</span><br><span class=\"line\">    å®šä¹‰äº†ä¸¤ä¸ªå…³ç³»ï¼š</span><br><span class=\"line\">        &quot;æµ‹è¯•å®ä½“&quot; - satisfies -&gt; &quot;æµ‹è¯•éœ€æ±‚&quot;  : æµ‹è¯•å®ä½“ æ»¡è¶³äº† æµ‹è¯•éœ€æ±‚</span><br><span class=\"line\">        &quot;æµ‹è¯•å®ä½“&quot; - satisfies -&gt; &quot;æµ‹è¯•éœ€æ±‚2&quot; : æµ‹è¯•å®ä½“ æ»¡è¶³äº† æµ‹è¯•éœ€æ±‚2</span><br><span class=\"line\">    - satisfies -&gt;ï¼šsatisfies è¡¨ç¤ºæ»¡è¶³å…³ç³»ï¼Œç®­å¤´æ–¹å‘ä»å®ä½“æŒ‡å‘éœ€æ±‚</span><br><span class=\"line\"></span><br><span class=\"line\">ä»£ç é€æ­¥è§£æ</span><br><span class=\"line\">éœ€æ±‚å®šä¹‰</span><br><span class=\"line\">    requirement &quot;æµ‹è¯•éœ€æ±‚&quot;</span><br><span class=\"line\">        å®šä¹‰ç¬¬ä¸€ä¸ªéœ€æ±‚ï¼Œæ˜¾ç¤ºåç§°ä¸º æµ‹è¯•éœ€æ±‚ã€‚</span><br><span class=\"line\">        å±æ€§ï¼š</span><br><span class=\"line\">            id: 1ï¼ˆéœ€æ±‚ç¼–å·ä¸º 1ï¼‰ã€‚</span><br><span class=\"line\">            text: &quot;æµ‹è¯•æ–‡æœ¬&quot;ï¼ˆæè¿°æ–‡æœ¬ä¸º &quot;æµ‹è¯•æ–‡æœ¬&quot;ï¼‰ã€‚</span><br><span class=\"line\">            risk: Highï¼ˆé«˜é£é™©éœ€æ±‚ï¼‰ã€‚</span><br><span class=\"line\">            verifymethod: testï¼ˆéªŒè¯æ–¹æ³•ä¸ºæµ‹è¯•ï¼‰ã€‚</span><br><span class=\"line\">    requirement &quot;æµ‹è¯•éœ€æ±‚2&quot;</span><br><span class=\"line\">        å®šä¹‰ç¬¬äºŒä¸ªéœ€æ±‚ï¼Œæ˜¾ç¤ºåç§°ä¸º æµ‹è¯•éœ€æ±‚2ã€‚</span><br><span class=\"line\">        å±æ€§ï¼š</span><br><span class=\"line\">            id: 2ï¼ˆéœ€æ±‚ç¼–å·ä¸º 2ï¼‰ã€‚</span><br><span class=\"line\">            text: &quot;æµ‹è¯•æ–‡æœ¬&quot;ï¼ˆæè¿°æ–‡æœ¬ä¸ç¬¬ä¸€ä¸ªéœ€æ±‚ç›¸åŒï¼‰ã€‚</span><br><span class=\"line\">            risk: Highï¼ˆé«˜é£é™©éœ€æ±‚ï¼‰ã€‚</span><br><span class=\"line\">            verifymethod: testï¼ˆéªŒè¯æ–¹æ³•ä¸ºæµ‹è¯•ï¼‰ã€‚</span><br><span class=\"line\">å®ä½“å®šä¹‰</span><br><span class=\"line\">    element &quot;æµ‹è¯•å®ä½“&quot;</span><br><span class=\"line\">        å®šä¹‰ä¸€ä¸ªç³»ç»Ÿå®ä½“ï¼Œæ˜¾ç¤ºåç§°ä¸º æµ‹è¯•å®ä½“ã€‚</span><br><span class=\"line\">        å±æ€§ï¼š</span><br><span class=\"line\">            type: &quot;æ¨¡æ‹Ÿ&quot;ï¼ˆå®ä½“ç±»å‹ä¸º &quot;æ¨¡æ‹Ÿ&quot;ï¼‰ã€‚</span><br></pre></td></tr></table></figure>\n<h3 id=\"Gitgraph-Diagram\">Gitgraph Diagram</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç”¨äºç»˜åˆ¶Gitå›¾ï¼Œæ˜¾ç¤ºä»£ç ä»“åº“çš„æäº¤å†å²å’Œåˆ†æ”¯å…³ç³»ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://mermaid.js.org/syntax/gitgraph.html\">Mermaid Gitgraph Diagram</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>type ä¸º <code>&quot;gitgraph&quot;</code></p>\n</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;% mermaid gitGraph %&#125;</span><br><span class=\"line\">commit</span><br><span class=\"line\">commit</span><br><span class=\"line\">commit</span><br><span class=\"line\">branch newbranch</span><br><span class=\"line\">checkout newbranch</span><br><span class=\"line\">commit</span><br><span class=\"line\">commit</span><br><span class=\"line\">checkout main</span><br><span class=\"line\">merge newbranch</span><br><span class=\"line\">&#123;% endmermaid %&#125;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ•ˆæœ</p>\n</li>\n</ul>\n<pre><code class=\"highlight mermaid\">gitGraph\ncommit\ncommit\ncommit\nbranch newbranch\ncheckout newbranch\ncommit\ncommit\ncheckout main\nmerge newbranch</code></pre>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¯´æ˜</p>\n</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">åŸºæœ¬ç»“æ„</span><br><span class=\"line\">gitGraph</span><br><span class=\"line\">    å®šä¹‰è¿™æ˜¯ä¸€ä¸ª Git å›¾ã€‚</span><br><span class=\"line\">commit</span><br><span class=\"line\">    è¡¨ç¤ºä¸€æ¬¡æäº¤æ“ä½œï¼Œæ¯ä¸ª commit èŠ‚ç‚¹ä»£è¡¨ä»£ç ä»“åº“çš„æŸä¸ªæäº¤ç‚¹ã€‚</span><br><span class=\"line\">branch</span><br><span class=\"line\">    åˆ›å»ºä¸€ä¸ªæ–°åˆ†æ”¯ã€‚</span><br><span class=\"line\">    æ ¼å¼ï¼šbranch åˆ†æ”¯åç§°ã€‚</span><br><span class=\"line\">checkout</span><br><span class=\"line\">    åˆ‡æ¢åˆ°æŒ‡å®šåˆ†æ”¯ã€‚</span><br><span class=\"line\">    æ ¼å¼ï¼šcheckout åˆ†æ”¯åç§°ã€‚</span><br><span class=\"line\">merge</span><br><span class=\"line\">    å°†æŒ‡å®šåˆ†æ”¯åˆå¹¶åˆ°å½“å‰åˆ†æ”¯ã€‚</span><br><span class=\"line\">    æ ¼å¼ï¼šmerge åˆ†æ”¯åç§°ã€‚</span><br></pre></td></tr></table></figure>\n<h3 id=\"Mindmap\">Mindmap</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç”¨äºç»˜åˆ¶æ€ç»´å¯¼å›¾ï¼Œæ˜¾ç¤ºä¸»é¢˜å’Œå­ä¸»é¢˜ä¹‹é—´çš„ hierarchical å…³ç³»ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://mermaid.js.org/syntax/mindmap.html\">Mermaid Mindmap</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>type ä¸º <code>&quot;mindmap&quot;</code></p>\n</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;% mermaid mindmap %&#125;</span><br><span class=\"line\">root((mindmap))</span><br><span class=\"line\">    (origins)</span><br><span class=\"line\">        Long history</span><br><span class=\"line\">        ::icon(fa fa-book)</span><br><span class=\"line\">        Popularisation</span><br><span class=\"line\">            British popular psychology author Tony Buzan</span><br><span class=\"line\">    [Research]</span><br><span class=\"line\">        On effectivness&lt;br/&gt;and features</span><br><span class=\"line\">        On Automatic creation</span><br><span class=\"line\">            Uses</span><br><span class=\"line\">                Creative techniques</span><br><span class=\"line\">                Strategic planning</span><br><span class=\"line\">                Argument mapping</span><br><span class=\"line\">    Tools</span><br><span class=\"line\">        Pen and paper</span><br><span class=\"line\">        Mermaid</span><br><span class=\"line\">&#123;% endmermaid %&#125;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ•ˆæœ</p>\n</li>\n</ul>\n<pre><code class=\"highlight mermaid\">mindmap\nroot((mindmap))\n    (origins)\n        Long history\n        ::icon(fa fa-book)\n        Popularisation\n            British popular psychology author Tony Buzan\n    [Research]\n        On effectivness&lt;br/&gt;and features\n        On Automatic creation\n            Uses\n                Creative techniques\n                Strategic planning\n                Argument mapping\n    Tools\n        Pen and paper\n        Mermaid</code></pre>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¯´æ˜</p>\n</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">åŸºæœ¬ç»“æ„</span><br><span class=\"line\">mindmap</span><br><span class=\"line\">    å®šä¹‰è¿™æ˜¯ä¸€ä¸ªæ€ç»´å¯¼å›¾ã€‚</span><br><span class=\"line\">root((mindmap))</span><br><span class=\"line\">    å®šä¹‰æ€ç»´å¯¼å›¾çš„æ ¹èŠ‚ç‚¹ï¼Œæ˜¾ç¤ºä¸ºåœ†å½¢å¹¶æ ‡æ³¨ä¸º &quot;mindmap&quot;ã€‚</span><br><span class=\"line\">å­èŠ‚ç‚¹ä½¿ç”¨ç¼©è¿›è¡¨ç¤ºä»å±å…³ç³»ï¼š</span><br><span class=\"line\">    æ¯ä¸€çº§ç¼©è¿›ä»£è¡¨ä¸€ä¸ªå±‚çº§çš„å­èŠ‚ç‚¹ã€‚</span><br><span class=\"line\">    å­èŠ‚ç‚¹å¯ä»¥ç›´æ¥æ·»åŠ å†…å®¹æˆ–é€šè¿‡ &lt;br/&gt; æ¢è¡Œã€‚</span><br><span class=\"line\">::icon(...)</span><br><span class=\"line\">    ä¸ºèŠ‚ç‚¹æ·»åŠ å›¾æ ‡ã€‚Mermaid.js æ”¯æŒä½¿ç”¨ FontAwesome çš„å›¾æ ‡ã€‚</span><br><span class=\"line\"></span><br><span class=\"line\">èŠ‚ç‚¹å½¢çŠ¶</span><br><span class=\"line\">é•¿æ–¹å½¢ [] ï¼šå¦‚ [é•¿æ–¹å½¢]ï¼Œæ˜¯é»˜è®¤çš„çŸ©å½¢èŠ‚ç‚¹ã€‚è¿™ä¸ªæ˜¯é»˜è®¤çš„èŠ‚ç‚¹ç±»å‹ã€‚</span><br><span class=\"line\">åœ†å½¢ (()) ï¼šå¦‚ ((åœ†))ï¼Œç”¨äºè¡¨ç¤ºä¸€ä¸ªåœ†å½¢èŠ‚ç‚¹ã€‚</span><br><span class=\"line\">åœ†è§’é•¿æ–¹å½¢ () ï¼šå¦‚ (åœ†è§’é•¿æ–¹å½¢)ï¼Œç”¨äºè¡¨ç¤ºåœ†è§’çŸ©å½¢èŠ‚ç‚¹ã€‚</span><br></pre></td></tr></table></figure>\n<h3 id=\"QuadrantChart\">QuadrantChart</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç”¨äºç»˜åˆ¶è±¡é™å›¾ï¼Œæ˜¾ç¤ºä¸åŒç»´åº¦ä¹‹é—´çš„æ¯”è¾ƒå…³ç³»ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://mermaid.js.org/syntax/quadrantChart.html\">Mermaid QuadrantChart</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>type ä¸º <code>&quot;quadrantChart&quot;</code></p>\n</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;% mermaid quadrantChart %&#125;</span><br><span class=\"line\">%%&#123;init: &#123;&quot;quadrantChart&quot;: &#123;&quot;chartHeight&quot;: 600, &quot;chartWidth&quot;: 800, &quot;pointTextPadding&quot;: 10&#125;, &quot;themeVariables&quot;: &#123;&quot;quadrant1Fill&quot;: &quot;#ff0000&quot;, &quot;quadrant2Fill&quot;: &quot;#FFFF00&quot;, &quot;quadrant3Fill&quot;: &quot;#32CD32&quot;, &quot;quadrant4Fill&quot;: &quot;#800080&quot;&#125;&#125;&#125;%%</span><br><span class=\"line\">title Reach and engagement of carpaigns</span><br><span class=\"line\">x-axis Low Reach --&gt; High Reach</span><br><span class=\"line\">y-axis Low Engagement --&gt; High Engagement</span><br><span class=\"line\">quadrant-1 we should expand</span><br><span class=\"line\">quadrant-2 Need to promote</span><br><span class=\"line\">quadrant-3 Re-evaluate</span><br><span class=\"line\">quadrant-4 May be improved</span><br><span class=\"line\">Campaign A: [0.3,0.6]</span><br><span class=\"line\">Campaign B: [0.45,0.23]</span><br><span class=\"line\">Campaign C: [0.57,0.69]</span><br><span class=\"line\">Campaign D: [0.78,0.34]</span><br><span class=\"line\">Campaign E: [0.40,0.34]</span><br><span class=\"line\">Campaign F: [0.35,0.78]</span><br><span class=\"line\">&#123;% endmermaid %&#125;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ•ˆæœ</p>\n</li>\n</ul>\n<pre><code class=\"highlight mermaid\">%%&#123;init: &#123;&quot;quadrantChart&quot;: &#123;&quot;chartHeight&quot;: 600, &quot;chartWidth&quot;: 800, &quot;pointTextPadding&quot;: 10&#125;, &quot;themeVariables&quot;: &#123;&quot;quadrant1Fill&quot;: &quot;#ff0000&quot;, &quot;quadrant2Fill&quot;: &quot;#FFFF00&quot;, &quot;quadrant3Fill&quot;: &quot;#32CD32&quot;, &quot;quadrant4Fill&quot;: &quot;#800080&quot;&#125;&#125;&#125;%%\nquadrantChart\ntitle Reach and engagement of carpaigns\nx-axis Low Reach --&gt; High Reach\ny-axis Low Engagement --&gt; High Engagement\nquadrant-1 we should expand\nquadrant-2 Need to promote\nquadrant-3 Re-evaluate\nquadrant-4 May be improved\nCampaign A: [0.3,0.6]\nCampaign B: [0.45,0.23]\nCampaign C: [0.57,0.69]\nCampaign D: [0.78,0.34]\nCampaign E: [0.40,0.34]\nCampaign F: [0.35,0.78]</code></pre>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¯´æ˜</p>\n</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">åŸºæœ¬ç»“æ„</span><br><span class=\"line\">%%&#123;init: ...&#125;%%</span><br><span class=\"line\">    è¿™æ˜¯ Mermaid.js çš„åˆå§‹åŒ–é…ç½®å—ï¼Œç”¨äºè‡ªå®šä¹‰å›¾è¡¨çš„å…¨å±€å‚æ•°å’Œæ ·å¼ã€‚</span><br><span class=\"line\">    é…ç½®å†…å®¹ï¼Œè¯¦è§ä¸‹æ–‡ï¼š</span><br><span class=\"line\">        quadrantChartï¼šè‡ªå®šä¹‰è±¡é™å›¾çš„ç›¸å…³å‚æ•°ã€‚</span><br><span class=\"line\">        themeVariablesï¼š å›¾è¡¨ä¸»é¢˜é…è‰²ã€‚</span><br><span class=\"line\">quadrantChart</span><br><span class=\"line\">    å®šä¹‰è¿™æ˜¯ä¸€ä¸ªè±¡é™å›¾ã€‚</span><br><span class=\"line\">title</span><br><span class=\"line\">    æ ‡é¢˜</span><br><span class=\"line\"></span><br><span class=\"line\">åæ ‡è½´ï¼Œå®šä¹‰ X è½´å’Œ Y è½´çš„èŒƒå›´å’Œæ–¹å‘ï¼š</span><br><span class=\"line\">x-axis Low Reach --&gt; High Reach</span><br><span class=\"line\">    X è½´ ä» â€œLow Reachâ€ åˆ° â€œHigh Reachâ€ã€‚</span><br><span class=\"line\">y-axis Low Engagement --&gt; High Engagement</span><br><span class=\"line\">    Y è½´ ä» â€œLow Engagementâ€ åˆ° â€œHigh Engagementâ€ã€‚</span><br><span class=\"line\"></span><br><span class=\"line\">è±¡é™å®šä¹‰</span><br><span class=\"line\">quadrant-1 we should expand</span><br><span class=\"line\">    è±¡é™ 1ï¼ˆå³ä¸Šï¼‰ï¼š&quot;we should expand&quot;</span><br><span class=\"line\">quadrant-2 Need to promote</span><br><span class=\"line\">    è±¡é™ 2ï¼ˆå·¦ä¸Šï¼‰ï¼š&quot;Need to promote&quot;</span><br><span class=\"line\">quadrant-3 Re-evaluate</span><br><span class=\"line\">    è±¡é™ 3ï¼ˆå·¦ä¸‹ï¼‰ï¼š&quot;Re-evaluate&quot;</span><br><span class=\"line\">quadrant-4 May be improved</span><br><span class=\"line\">    è±¡é™ 4ï¼ˆå³ä¸‹ï¼‰ï¼š&quot;May be improved&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">æ•°æ®ç‚¹</span><br><span class=\"line\">Campaign A: [0.3,0.6]</span><br><span class=\"line\">Campaign B: [0.45,0.23]</span><br><span class=\"line\">Campaign C: [0.57,0.69]</span><br><span class=\"line\">Campaign D: [0.78,0.34]</span><br><span class=\"line\">Campaign E: [0.40,0.34]</span><br><span class=\"line\">Campaign F: [0.35,0.78]</span><br><span class=\"line\">å®šä¹‰äº† 6 ä¸ªæ´»åŠ¨ï¼ˆCampaignï¼‰çš„æ•°æ®ç‚¹ï¼Œä½¿ç”¨ [name]: [x, y] çš„æ ¼å¼æ¥æ·»åŠ æ•°æ®ç‚¹ï¼Œå…¶ä¸­ [name] æ˜¯æ•°æ®ç‚¹çš„åç§°ï¼Œ[x, y] æ˜¯æ•°æ®ç‚¹åœ¨ x è½´å’Œ y è½´ä¸Šçš„åæ ‡å€¼ï¼Œå¯¹äºç‚¹xå’Œyå€¼ï¼Œæœ€å°å€¼ä¸º0ï¼Œæœ€å¤§å€¼ä¸º1ã€‚</span><br><span class=\"line\">X å€¼ï¼šè¡¨ç¤ºæ´»åŠ¨çš„ Reachï¼ˆè¦†ç›–é¢ï¼‰ã€‚</span><br><span class=\"line\">Y å€¼ï¼šè¡¨ç¤ºæ´»åŠ¨çš„ Engagementï¼ˆå‚ä¸åº¦ï¼‰ã€‚</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆå§‹åŒ–é…ç½®</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-6\">quadrantChartï¼šè‡ªå®šä¹‰è±¡é™å›¾çš„ç›¸å…³å‚æ•°</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>å‚æ•°</th>\n<th>æè¿°</th>\n<th>é»˜è®¤å€¼</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>chartHeight</td>\n<td>å›¾è¡¨çš„é«˜åº¦</td>\n<td>500</td>\n</tr>\n<tr>\n<td>chartWidth</td>\n<td>å›¾è¡¨çš„å®½åº¦</td>\n<td>500</td>\n</tr>\n<tr>\n<td>pointLabelFontSize</td>\n<td>ç‚¹æ–‡æœ¬å­—ä½“å¤§å°</td>\n<td>12</td>\n</tr>\n<tr>\n<td>pointRadius</td>\n<td>è¦ç»˜åˆ¶çš„ç‚¹çš„åŠå¾„</td>\n<td>5</td>\n</tr>\n<tr>\n<td>pointTextPadding</td>\n<td>ç‚¹å’Œä¸‹é¢æ–‡æœ¬ä¹‹é—´çš„å¡«å……</td>\n<td>5</td>\n</tr>\n<tr>\n<td>quadrantExternalBorderStrokeWidth</td>\n<td>è±¡é™å¤–è¾¹æ¡†æè¾¹å®½åº¦</td>\n<td>2</td>\n</tr>\n<tr>\n<td>quadrantInternalBorderStrokeWidth</td>\n<td>è±¡é™å†…çš„è¾¹æ¡†æè¾¹å®½åº¦</td>\n<td>1</td>\n</tr>\n<tr>\n<td>quadrantLabelFontSize</td>\n<td>è±¡é™æ–‡æœ¬å­—ä½“å¤§å°</td>\n<td>16</td>\n</tr>\n<tr>\n<td>quadrantPadding</td>\n<td>æ‰€æœ‰è±¡é™å¤–çš„å¡«å……</td>\n<td>5</td>\n</tr>\n<tr>\n<td>quadrantTextTopPadding</td>\n<td>å½“æ–‡æœ¬ç»˜åˆ¶åœ¨é¡¶éƒ¨æ—¶è±¡é™æ–‡æœ¬é¡¶éƒ¨å¡«å……ï¼ˆé‚£é‡Œæ²¡æœ‰æ•°æ®ç‚¹ï¼‰</td>\n<td>5</td>\n</tr>\n<tr>\n<td>titlePadding</td>\n<td>æ ‡é¢˜çš„é¡¶éƒ¨å’Œåº•éƒ¨å¡«å……</td>\n<td>10</td>\n</tr>\n<tr>\n<td>titleFontSize</td>\n<td>æ ‡é¢˜å­—ä½“å¤§å°</td>\n<td>20</td>\n</tr>\n<tr>\n<td>xAxisLabelPadding</td>\n<td>x è½´æ–‡æœ¬çš„é¡¶éƒ¨å’Œåº•éƒ¨å¡«å……</td>\n<td>5</td>\n</tr>\n<tr>\n<td>xAxisLabelFontSize</td>\n<td>X è½´æ–‡æœ¬å­—ä½“å¤§å°</td>\n<td>16</td>\n</tr>\n<tr>\n<td>xAxisPosition</td>\n<td>x è½´çš„ä½ç½®ï¼ˆé¡¶éƒ¨ã€åº•éƒ¨ï¼‰å¦‚æœæœ‰ç‚¹ï¼Œåˆ™ x è½´å°†å§‹ç»ˆæ¸²æŸ“åœ¨åº•éƒ¨</td>\n<td>â€˜topâ€™</td>\n</tr>\n<tr>\n<td>yAxisLabelPadding</td>\n<td>y è½´æ–‡æœ¬çš„å·¦å³å¡«å……</td>\n<td>5</td>\n</tr>\n<tr>\n<td>yAxisLabelFontSize</td>\n<td>Y è½´æ–‡æœ¬å­—ä½“å¤§å°</td>\n<td>16</td>\n</tr>\n<tr>\n<td>yAxisPosition</td>\n<td>y è½´ä½ç½®ï¼ˆå·¦ã€å³ï¼‰</td>\n<td>â€˜leftâ€™</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-2\">\n<li class=\"lvl-6\">\n<p>themeVariablesï¼š å›¾è¡¨ä¸»é¢˜é…è‰²</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>å‚æ•°</th>\n<th>æè¿°</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>quadrant1Fill</td>\n<td>å³ä¸Šè±¡é™çš„å¡«å……é¢œè‰²</td>\n</tr>\n<tr>\n<td>quadrant2Fill</td>\n<td>å·¦ä¸Šè±¡é™çš„å¡«å……é¢œè‰²</td>\n</tr>\n<tr>\n<td>quadrant3Fill</td>\n<td>å·¦ä¸‹è±¡é™çš„å¡«å……é¢œè‰²</td>\n</tr>\n<tr>\n<td>quadrant4Fill</td>\n<td>å³ä¸‹è±¡é™çš„å¡«å……é¢œè‰²</td>\n</tr>\n<tr>\n<td>quadrant1TextFill</td>\n<td>å³ä¸Šè±¡é™çš„æ–‡æœ¬é¢œè‰²</td>\n</tr>\n<tr>\n<td>quadrant2TextFill</td>\n<td>å·¦ä¸Šè±¡é™çš„æ–‡æœ¬é¢œè‰²</td>\n</tr>\n<tr>\n<td>quadrant3TextFill</td>\n<td>å·¦ä¸‹è±¡é™çš„æ–‡æœ¬é¢œè‰²</td>\n</tr>\n<tr>\n<td>quadrant4TextFill</td>\n<td>å³ä¸‹è±¡é™çš„æ–‡æœ¬é¢œè‰²</td>\n</tr>\n<tr>\n<td>quadrantPointFill</td>\n<td>ç‚¹å¡«å……é¢œè‰²</td>\n</tr>\n<tr>\n<td>quadrantPointTextFill</td>\n<td>ç‚¹æ–‡æœ¬é¢œè‰²</td>\n</tr>\n<tr>\n<td>quadrantXAxisTextFill</td>\n<td>X è½´æ–‡æœ¬é¢œè‰²</td>\n</tr>\n<tr>\n<td>quadrantYAxisTextFill</td>\n<td>Y è½´æ–‡æœ¬é¢œè‰²</td>\n</tr>\n<tr>\n<td>quadrantInternalBorderStrokeFill</td>\n<td>è±¡é™å†…è¾¹æ¡†é¢œè‰²</td>\n</tr>\n<tr>\n<td>quadrantExternalBorderStrokeFill</td>\n<td>è±¡é™å¤–è¾¹æ¡†é¢œè‰²</td>\n</tr>\n<tr>\n<td>quadrantTitleFill</td>\n<td>æ ‡é¢˜é¢œè‰²</td>\n</tr>\n</tbody>\n</table>\n</li>\n</ul>\n","content_text":"æ‘˜è¦ Mermaid æ˜¯ä¸€ä¸ªæ”¯æŒåœ¨Markdownæ–‡æ¡£ä¸­ç»˜åˆ¶æµç¨‹å›¾ã€ç”˜ç‰¹å›¾ã€åºåˆ—å›¾ç­‰å›¾å½¢çš„å·¥å…·ã€‚å®ƒåŸºäºJavaScriptå®ç°ï¼Œèƒ½å¤Ÿå°†Markdownä¸­çš„å…ƒç´ æ¸²æŸ“æˆHTMLå…ƒç´ ï¼Œä»è€Œåœ¨ç½‘é¡µä¸Šç›´è§‚åœ°å±•ç¤ºå„ç§å›¾è¡¨â€Œ Nextä¸»é¢˜ä¸­ä½¿ç”¨Mermaidè¯´æ˜ æœ¬æ–‡ä»‹ç»å¦‚ä½•åœ¨ Hexo-Next ä¸»é¢˜ä¸­ä½¿ç”¨ Mermaid é…ç½®å’Œä½¿ç”¨æ–¹æ³• NexT config file ä¸­æ‰¾åˆ°mermaidé…ç½®ï¼Œå¹¶è®¾ç½®ä¸ºtrueï¼Œtheme å¯ä»¥è®¾ç½®æµ…è‰²å’Œæ·±è‰²èƒŒæ™¯çš„æ ·å¼ï¼Œå…±æœ‰4ä¸ªå¯ç”¨é€‰é¡¹ 123456mermaid: enable: true # Available themes: default | dark | forest | neutral theme: light: dark dark: dark ä½¿ç”¨æ–¹æ³•ï¼Œå…¶ä¸­mermaidä¸endmermaidæ˜¯å›ºå®šæ­é…ï¼Œtype ç”¨äºè®¾ç½®å›¾å½¢çš„ç§ç±»ï¼Œå¦‚æµç¨‹å›¾ã€æ—¶åºå›¾ã€ç”˜ç‰¹å›¾ç­‰ï¼Œä¸‹é¢ç¤ºä¾‹ä¸­ä¼šä»‹ç» 12&#123;% mermaid type %&#125;&#123;% endmermaid %&#125; æœ‰äº›å°ä¼™ä¼´å–œæ¬¢ä½¿ç”¨ä»£ç å—çš„å½¢å¼ï¼Œä½¿ç”¨æ—¶å»æ‰å‰é¢çš„# 1234#```mermaidtype#``` ä½†æ˜¯æ­¤æ—¶éœ€è¦åœ¨ Hexo config file ä¸­æ‰¾åˆ°highlightï¼Œå¹¶æ·»åŠ å¦‚ä¸‹å†…å®¹ï¼Œæ‰ä¼šä½¿ä»£ç å—çš„å½¢å¼ç”Ÿæ•ˆ 123highlight: exclude_languages: - mermaid å›¾å½¢ç¤ºä¾‹ è¿™é‡Œåªä»‹ç»å¸¸ç”¨çš„ä¸€äº›å›¾è¡¨ï¼Œæ›´å¤šå›¾è¡¨çš„ä½¿ç”¨æ–¹æ³•å¯ä»¥å‚è€ƒMermaidå¸®åŠ©æ–‡æ¡£ Flowchart ç”¨äºç»˜åˆ¶æµç¨‹å›¾ï¼Œæ”¯æŒæ–¹å‘ï¼ˆä¾‹å¦‚ä»å·¦åˆ°å³ã€ä»ä¸Šåˆ°ä¸‹ï¼‰å’ŒèŠ‚ç‚¹é—´å…³ç³»çš„å®šä¹‰ã€‚ Mermaid Flowchart type ä¸º &quot;graph TD&quot;æˆ–è€…&quot;graph LR&quot;ï¼Œåˆ†åˆ«è¡¨ç¤ºä»ä¸Šåˆ°ä¸‹å’Œä»å·¦åˆ°å³çš„æ–¹å‘ 123456- æµç¨‹å›¾æ–¹å‘: - TB - ä»ä¸Šåˆ°ä¸‹ - TD - è‡ªä¸Šè€Œä¸‹ï¼Œç­‰åŒäºTB - BT - ä»ä¸‹åˆ°ä¸Š - RL - ä»å³åˆ°å·¦ - LR - ä»å·¦åˆ°å³ &quot;graph TD&quot;ï¼šä»ä¸Šåˆ°ä¸‹ 123456&#123;% mermaid graph TD %&#125;A[Hard] --&gt;|Text| B(Round)B --&gt; C&#123;Decision&#125;C --&gt;|One| D[Result 1]C --&gt;|Two| E[Result 2]&#123;% endmermaid %&#125; æ•ˆæœ graph TD A[Hard] --&gt;|Text| B(Round) B --&gt; C&#123;Decision&#125; C --&gt;|One| D[Result 1] C --&gt;|Two| E[Result 2] è¯´æ˜ 123456789101112131415graph TDï¼Œå®šä¹‰ä¸€ä¸ªä»ä¸Šåˆ°ä¸‹çš„æµç¨‹å›¾ã€‚TD æ˜¯ Top to Down çš„ç¼©å†™ï¼Œè¡¨ç¤ºæµç¨‹å›¾ä»ä¸Šå‘ä¸‹æ’åˆ—ã€‚A[Hard] --&gt;|Text| B(Round)ï¼Œå®šä¹‰äº†ä¸€ä¸ªèŠ‚ç‚¹ Aï¼Œæ˜¾ç¤ºä¸º Hardã€‚ä¸€ä¸ªå¸¦æ ‡ç­¾çš„ç®­å¤´ --&gt;|Text| æŒ‡å‘èŠ‚ç‚¹ Bï¼Œç®­å¤´ä¸Šçš„æ ‡ç­¾ä¸º Textã€‚èŠ‚ç‚¹ B è¢«å®šä¹‰ä¸º Roundï¼Œè¿™æ˜¯ä¸€ä¸ªæ¤­åœ†å½¢èŠ‚ç‚¹ã€‚B --&gt; C&#123;Decision&#125;ï¼ŒèŠ‚ç‚¹ B æŒ‡å‘èŠ‚ç‚¹ Cã€‚èŠ‚ç‚¹ C è¢«å®šä¹‰ä¸º Decisionï¼Œè¿™æ˜¯ä¸€ä¸ªå†³ç­–èŠ‚ç‚¹ï¼Œç”¨å¤§æ‹¬å· &#123;&#125; è¡¨ç¤ºã€‚C --&gt;|One| D[Result 1]ï¼Œå†³ç­–èŠ‚ç‚¹ C çš„ä¸€ä¸ªåˆ†æ”¯ï¼Œå¸¦æ ‡ç­¾ Oneï¼ŒæŒ‡å‘èŠ‚ç‚¹ Dã€‚èŠ‚ç‚¹ D æ˜¾ç¤ºä¸º Result 1ï¼Œè¿™æ˜¯ä¸€ä¸ªçŸ©å½¢èŠ‚ç‚¹ã€‚C --&gt;|Two| E[Result 2]ï¼Œå†³ç­–èŠ‚ç‚¹ C çš„å¦ä¸€ä¸ªåˆ†æ”¯ï¼Œå¸¦æ ‡ç­¾ Twoï¼ŒæŒ‡å‘èŠ‚ç‚¹ Eã€‚èŠ‚ç‚¹ E æ˜¾ç¤ºä¸º Result 2ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªçŸ©å½¢èŠ‚ç‚¹ã€‚ &quot;graph LR&quot;ï¼šä»å·¦åˆ°å³ 123456&#123;% mermaid graph LR %&#125;A[é•¿æ–¹å½¢] -- é“¾æ¥ --&gt; B((åœ†))A --&gt; C(åœ†è§’é•¿æ–¹å½¢)B --&gt; D&#123;è±å½¢&#125;C --&gt; D&#123;% endmermaid %&#125; æ•ˆæœ graph LR A[é•¿æ–¹å½¢] -- é“¾æ¥ --&gt; B((åœ†)) A --&gt; C(åœ†è§’é•¿æ–¹å½¢) B --&gt; D&#123;è±å½¢&#125; C --&gt; D è¯´æ˜ 123456789101112131415161718192021graph LRï¼Œå®šä¹‰æµç¨‹å›¾çš„æ–¹å‘æ˜¯ä»å·¦åˆ°å³ï¼ˆLeft to Rightï¼‰ã€‚èŠ‚ç‚¹å’Œç®­å¤´ä»å·¦å‘å³æ’åˆ—ã€‚A[é•¿æ–¹å½¢] -- é“¾æ¥ --&gt; B((åœ†))ï¼Œå®šä¹‰äº†èŠ‚ç‚¹ A å’ŒèŠ‚ç‚¹ Bã€‚A æ˜¯ä¸€ä¸ªé•¿æ–¹å½¢èŠ‚ç‚¹ï¼Œæ˜¾ç¤ºå†…å®¹ä¸ºâ€œé•¿æ–¹å½¢â€ã€‚B æ˜¯ä¸€ä¸ªåœ†å½¢èŠ‚ç‚¹ï¼Œå†…å®¹ä¸ºç©ºã€‚å®ƒä»¬ä¹‹é—´é€šè¿‡ä¸€ä¸ªå¸¦æ ‡ç­¾çš„ç®­å¤´ -- é“¾æ¥ --&gt; è¿æ¥ï¼Œç®­å¤´ä¸Šæ ‡æ³¨äº†â€œé“¾æ¥â€ã€‚A --&gt; C(åœ†è§’é•¿æ–¹å½¢)ï¼ŒèŠ‚ç‚¹ A æŒ‡å‘èŠ‚ç‚¹ Cã€‚C æ˜¯ä¸€ä¸ªåœ†è§’é•¿æ–¹å½¢èŠ‚ç‚¹ï¼Œæ˜¾ç¤ºå†…å®¹ä¸ºâ€œåœ†è§’é•¿æ–¹å½¢â€ã€‚B --&gt; D&#123;è±å½¢&#125;ï¼ŒèŠ‚ç‚¹ B æŒ‡å‘èŠ‚ç‚¹ Dã€‚D æ˜¯ä¸€ä¸ªè±å½¢èŠ‚ç‚¹ï¼Œæ˜¾ç¤ºå†…å®¹ä¸ºâ€œè±å½¢â€ã€‚C --&gt; Dï¼ŒèŠ‚ç‚¹ C ä¹ŸæŒ‡å‘èŠ‚ç‚¹ Dï¼Œç®­å¤´ä¸å¸¦æ ‡ç­¾ã€‚èŠ‚ç‚¹ç±»å‹å’Œå½¢çŠ¶é•¿æ–¹å½¢ [] ï¼šå¦‚ A[é•¿æ–¹å½¢]ï¼Œæ˜¯é»˜è®¤çš„çŸ©å½¢èŠ‚ç‚¹ã€‚åœ†å½¢ (()) ï¼šå¦‚ B((åœ†))ï¼Œç”¨äºè¡¨ç¤ºä¸€ä¸ªåœ†å½¢èŠ‚ç‚¹ã€‚åœ†è§’é•¿æ–¹å½¢ () ï¼šå¦‚ C(åœ†è§’é•¿æ–¹å½¢)ï¼Œç”¨äºè¡¨ç¤ºåœ†è§’çŸ©å½¢èŠ‚ç‚¹ã€‚è±å½¢ &#123;&#125; ï¼šå¦‚ D&#123;è±å½¢&#125;ï¼Œç”¨äºè¡¨ç¤ºå†³ç­–ç‚¹æˆ–æ¡ä»¶åˆ†æ”¯ã€‚ Sequence Diagram ç”¨äºç»˜åˆ¶æ—¶åºå›¾ï¼Œæ˜¾ç¤ºå¤šä¸ªå®ä½“ä¹‹é—´çš„äº¤äº’å…³ç³»ï¼ŒåŒ…æ‹¬æ¶ˆæ¯ã€æ—¶é—´ã€çŠ¶æ€å’Œæ•°æ®äº¤æ¢ã€‚ Mermaid Sequence Diagram type ä¸º &quot;sequenceDiagram&quot; 12345678910&#123;% mermaid sequenceDiagram %&#125;Alice-&gt;&gt;John: Hello John, how are you?loop Healthcheck John-&gt;&gt;John: Fight against hypochondriaendNote right of John: Rational thoughts!John--&gt;&gt;Alice: Great!John-&gt;&gt;Bob: How about you?Bob--&gt;&gt;John: Jolly good!&#123;% endmermaid %&#125; æ•ˆæœ sequenceDiagram Alice-&gt;&gt;John: Hello John, how are you? loop Healthcheck John-&gt;&gt;John: Fight against hypochondria end Note right of John: Rational thoughts! John--&gt;&gt;Alice: Great! John-&gt;&gt;Bob: How about you? Bob--&gt;&gt;John: Jolly good! è¯´æ˜ 12345678910111213141516171819202122232425262728293031åŸºæœ¬ç»“æ„è¯´æ˜sequenceDiagram: å®šä¹‰ä¸€ä¸ªåºåˆ—å›¾ï¼Œè¡¨ç¤ºæ¶ˆæ¯å’Œäº‹ä»¶çš„æ—¶é—´é¡ºåºã€‚å‚ä¸è€… Aliceã€John å’Œ Bob æ˜¯å‚ä¸è€…ã€‚ æ¯ä¸ªå‚ä¸è€…åœ¨å›¾ä¸­ä¼šä»¥å‚ç›´æ’åˆ—çš„å½¢å¼æ˜¾ç¤ºã€‚æ¶ˆæ¯å’Œç®­å¤´ -&gt;&gt; è¡¨ç¤ºä¸€ä¸ªæ¶ˆæ¯çš„å‘é€ï¼Œæ–¹å‘ç”±ç®­å¤´å†³å®šã€‚ æ¶ˆæ¯å†…å®¹å†™åœ¨ç®­å¤´æ—è¾¹ã€‚å¾ªç¯ï¼ˆloopï¼‰ ä½¿ç”¨ loop å®šä¹‰ä¸€ä¸ªå¾ªç¯å—ï¼Œå¾ªç¯ä¸­çš„æ¶ˆæ¯ä¼šé‡å¤æ‰§è¡Œï¼Œè¡¨ç¤ºæŸç§æŒç»­è¡Œä¸ºã€‚å¤‡æ³¨ï¼ˆNoteï¼‰ Note right of John å®šä¹‰äº†ä¸€æ¡å¤‡æ³¨ï¼Œæ˜¾ç¤ºåœ¨ John çš„å³ä¾§ï¼Œç”¨æ¥è¡¥å……è¯´æ˜ã€‚ä»£ç é€æ­¥è§£æAlice-&gt;&gt;John: Hello John, how are you? è¡¨ç¤º Alice ç»™ John å‘é€ä¸€æ¡æ¶ˆæ¯ï¼šâ€œHello John, how are you?â€loop Healthcheck å®šä¹‰ä¸€ä¸ªå¾ªç¯å—ï¼Œæ ‡é¢˜ä¸ºâ€œHealthcheckâ€ï¼ˆå¥åº·æ£€æŸ¥ï¼‰ã€‚ å¾ªç¯å†…å®¹æ˜¯ï¼š John-&gt;&gt;John: Fight against hypochondria è¡¨ç¤º John è‡ªå·±å‘è‡ªå·±å‘é€ä¸€æ¡æ¶ˆæ¯ï¼šâ€œFight against hypochondriaâ€ï¼ˆä¸ç–‘ç—…ç—‡æŠ—äº‰ï¼‰ã€‚Note right of John: Rational thoughts! å®šä¹‰äº†ä¸€æ¡å¤‡æ³¨ï¼Œæ˜¾ç¤ºåœ¨ John çš„å³ä¾§ã€‚ å¤‡æ³¨å†…å®¹ä¸ºï¼šâ€œRational thoughts!â€ï¼ˆç†æ€§æ€è€ƒï¼ï¼‰ã€‚John--&gt;&gt;Alice: Great! John å›å¤ Alice ä¸€æ¡æ¶ˆæ¯ï¼šâ€œGreat!â€ï¼ˆå¾ˆå¥½ï¼ï¼‰ã€‚ ä½¿ç”¨ --&gt;&gt; è¡¨ç¤ºå›å¤æ¶ˆæ¯ã€‚John-&gt;&gt;Bob: How about you? John è¯¢é—® Bob ä¸€æ¡æ¶ˆæ¯ï¼šâ€œHow about you?â€ï¼ˆä½ æ€ä¹ˆæ ·ï¼Ÿï¼‰ã€‚Bob--&gt;&gt;John: Jolly good! Bob å›å¤ John ä¸€æ¡æ¶ˆæ¯ï¼šâ€œJolly good!â€ï¼ˆéå¸¸å¥½ï¼ï¼‰ã€‚ Class Diagram ç”¨äºç»˜åˆ¶ç±»å›¾ï¼Œæ˜¾ç¤ºå¯¹è±¡ä¹‹é—´çš„å…³ç³»ï¼ŒåŒ…æ‹¬ç»§æ‰¿ã€å…³è”ã€ä¾èµ–ç­‰ã€‚ Mermaid Class Diagram type ä¸º &quot;classDiagram&quot; 1234567891011121314151617&#123;% mermaid classDiagram %&#125;Class01 &lt;|-- AveryLongClass : Cool&lt;&lt;interface&gt;&gt; Class01Class09 --&gt; C2 : Where am i?Class09 --* C3Class09 --|&gt; Class07Class07 : equals()Class07 : Object[] elementDataClass01 : size()Class01 : int chimpClass01 : int gorillaclass Class10 &#123; &lt;&lt;service&gt;&gt; int id size()&#125;&#123;% endmermaid %&#125; æ•ˆæœ classDiagram Class01 &lt;|-- AveryLongClass : Cool &lt;&lt;interface&gt;&gt; Class01 Class09 --&gt; C2 : Where am i? Class09 --* C3 Class09 --|&gt; Class07 Class07 : equals() Class07 : Object[] elementData Class01 : size() Class01 : int chimp Class01 : int gorilla class Class10 &#123; &lt;&lt;service&gt;&gt; int id size() &#125; è¯´æ˜ 12345678910111213141516171819202122232425262728293031323334353637383940414243åŸºæœ¬ç»“æ„classDiagram å®šä¹‰ä¸€ä¸ªç±»å›¾ï¼Œå±•ç¤ºç±»çš„å±æ€§ã€æ–¹æ³•ä»¥åŠå®ƒä»¬ä¹‹é—´çš„å…³ç³»ã€‚ç±»å’Œä¿®é¥°ç¬¦ ä½¿ç”¨ class ClassName å®šä¹‰ä¸€ä¸ªç±»ã€‚ ç±»çš„å±æ€§å’Œæ–¹æ³•å®šä¹‰åœ¨ class å—å†…ã€‚ ç‰¹æ®Šä¿®é¥°ç¬¦å¦‚ &lt;&lt;interface&gt;&gt; å’Œ &lt;&lt;service&gt;&gt; ç”¨äºè¯´æ˜ç±»çš„è§’è‰²æˆ–ç±»å‹ã€‚å…³ç³»ç¬¦å· &lt;|-- è¡¨ç¤ºç»§æ‰¿ï¼ˆextendsï¼‰ã€‚ --|&gt; è¡¨ç¤ºå®ç°ï¼ˆimplementsï¼Œæ¥å£çš„å®ç°ï¼‰ã€‚ --&gt; è¡¨ç¤ºå…³è”ï¼ˆæ™®é€šå¼•ç”¨ï¼‰ã€‚ --* è¡¨ç¤ºç»„åˆå…³ç³»ï¼ˆä¸€ä¸ªç±»åŒ…å«å¦ä¸€ä¸ªç±»ï¼‰ã€‚ : åè·Ÿå…³ç³»çš„è¯´æ˜æˆ–æ³¨é‡Šã€‚ä»£ç é€æ­¥è§£æClass01 &lt;|-- AveryLongClass : Cool è¡¨ç¤º AveryLongClass ç»§æ‰¿äº† Class01ï¼Œå…³ç³»åç§°ä¸º Coolã€‚ &lt;|-- è¡¨ç¤ºç»§æ‰¿ï¼ˆçˆ¶ç±»åˆ°å­ç±»ï¼‰ã€‚&lt;&lt;interface&gt;&gt; Class01 å°† Class01 æ ‡è®°ä¸ºä¸€ä¸ªæ¥å£ã€‚Class09 --&gt; C2 : Where am i? è¡¨ç¤º Class09 ä¸ C2 æœ‰ä¸€ä¸ªå…³è”å…³ç³»ï¼Œæ³¨é‡Šä¸º â€œWhere am i?â€ã€‚Class09 --* C3 è¡¨ç¤º Class09 ä¸ C3 æœ‰ä¸€ä¸ªç»„åˆå…³ç³»ã€‚ Class09 åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ª C3 çš„å®ä¾‹ã€‚Class09 --|&gt; Class07 è¡¨ç¤º Class09 å®ç°äº† Class07ã€‚ --|&gt; é€šå¸¸ç”¨äºè¡¨ç¤ºæ¥å£å®ç°ã€‚Class07 : equals() è¡¨ç¤º Class07 å®šä¹‰äº†ä¸€ä¸ªæ–¹æ³• equals()ã€‚Class07 : Object[] elementData è¡¨ç¤º Class07 æœ‰ä¸€ä¸ªå±æ€§ elementDataï¼Œç±»å‹æ˜¯ Object[]ï¼ˆæ•°ç»„ï¼‰ã€‚Class01 : size() è¡¨ç¤º Class01 æœ‰ä¸€ä¸ªæ–¹æ³• size()ã€‚Class01 : int chimp å’Œ Class01 : int gorilla è¡¨ç¤º Class01 æœ‰ä¸¤ä¸ªæ•´å‹å±æ€§ï¼šchimp å’Œ gorillaã€‚class Class10 &#123; ... &#125; å®šä¹‰äº†ä¸€ä¸ªåä¸º Class10 çš„ç±»ã€‚ ç±»ä¸­æœ‰ä¸€ä¸ªä¿®é¥°ç¬¦ &lt;&lt;service&gt;&gt;ï¼Œè¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªæœåŠ¡ç±»ã€‚ å±æ€§å’Œæ–¹æ³•ï¼š int idï¼šæ•´å‹å±æ€§ã€‚ size()ï¼šæ–¹æ³•ã€‚ State Diagram ç”¨äºç»˜åˆ¶çŠ¶æ€å›¾ï¼Œæ˜¾ç¤ºå¯¹è±¡çš„çŠ¶æ€è½¬ç§»å’Œè¡Œä¸ºã€‚ Mermaid State Diagram type ä¸º &quot;stateDiagram&quot; 12345678&#123;% mermaid stateDiagram %&#125;[*] --&gt; StillStill --&gt; [*]Still --&gt; MovingMoving --&gt; StillMoving --&gt; CrashCrash --&gt; [*]&#123;% endmermaid %&#125; æ•ˆæœ stateDiagram [*] --&gt; Still Still --&gt; [*] Still --&gt; Moving Moving --&gt; Still Moving --&gt; Crash Crash --&gt; [*] è¯´æ˜ 123456789101112131415161718192021222324252627åŸºæœ¬ç»“æ„stateDiagram å®šä¹‰è¿™æ˜¯ä¸€ä¸ªçŠ¶æ€å›¾ï¼Œç”¨äºè¡¨ç¤ºçŠ¶æ€å’ŒçŠ¶æ€ä¹‹é—´çš„è½¬æ¢ã€‚[*] è¡¨ç¤ºåˆå§‹çŠ¶æ€æˆ–ç»ˆæ­¢çŠ¶æ€ã€‚ èµ·å§‹çŠ¶æ€é€šå¸¸æœ‰ç®­å¤´æŒ‡å‘ç¬¬ä¸€ä¸ªçŠ¶æ€ã€‚ ç»ˆæ­¢çŠ¶æ€é€šå¸¸æœ‰ç®­å¤´æŒ‡å‘å®ƒã€‚çŠ¶æ€ ç”¨çŠ¶æ€åç§°å®šä¹‰çŠ¶æ€ï¼Œä¾‹å¦‚ Stillã€Movingã€Crashã€‚ç®­å¤´ --&gt; è¡¨ç¤ºçŠ¶æ€ä¹‹é—´çš„è½¬æ¢æ–¹å‘ã€‚ä»£ç é€æ­¥è§£æ[*] --&gt; Still ç³»ç»Ÿä»åˆå§‹çŠ¶æ€è¿›å…¥ Still çŠ¶æ€ã€‚Still --&gt; [*] ç³»ç»Ÿä» Still çŠ¶æ€å¯ä»¥ç›´æ¥è¿›å…¥ç»ˆæ­¢çŠ¶æ€ï¼ˆç³»ç»Ÿç»“æŸï¼‰ã€‚Still --&gt; Moving ç³»ç»Ÿä» Still çŠ¶æ€å¯ä»¥è½¬æ¢ä¸º Moving çŠ¶æ€ã€‚Moving --&gt; Still ç³»ç»Ÿä» Moving çŠ¶æ€å¯ä»¥è¿”å›åˆ° Still çŠ¶æ€ã€‚Moving --&gt; Crash ç³»ç»Ÿä» Moving çŠ¶æ€å¯ä»¥è¿›å…¥ Crash çŠ¶æ€ã€‚Crash --&gt; [*] ç³»ç»Ÿä» Crash çŠ¶æ€å¯ä»¥è¿›å…¥ç»ˆæ­¢çŠ¶æ€ï¼ˆè¡¨ç¤ºç³»ç»Ÿå´©æºƒæˆ–ç»ˆæ­¢ï¼‰ã€‚ Entity Relationship Diagram ç”¨äºç»˜åˆ¶å®ä½“å…³ç³»å›¾ï¼Œæ˜¾ç¤ºå®ä½“ä¹‹é—´çš„å…³ç³»ï¼ŒåŒ…æ‹¬å…³è”ã€ä¾èµ–ç­‰ã€‚ Mermaid Entity Relationship Diagram type ä¸º &quot;erDiagram&quot; 12345&#123;% mermaid erDiagram %&#125;CUSTOMER ||--o&#123; ORDER : placesORDER ||--|&#123; ITEM : containsCUSTOMER &#125;|..|&#123; DELIVERY-ADDRESS : has&#123;% endmermaid %&#125; æ•ˆæœ erDiagram CUSTOMER ||--o&#123; ORDER : places ORDER ||--|&#123; ITEM : contains CUSTOMER &#125;|..|&#123; DELIVERY-ADDRESS : has è¯´æ˜ 12345678910111213141516171819202122232425åŸºæœ¬ç»“æ„erDiagram å®šä¹‰è¿™æ˜¯ä¸€ä¸ªå®ä½“å…³ç³»å›¾ã€‚ å±•ç¤ºæ•°æ®åº“ä¸­è¡¨ï¼ˆå®ä½“ï¼‰ä¹‹é—´çš„å…³ç³»ã€‚å®ä½“ ä¾‹å¦‚ CUSTOMERã€ORDER å’Œ ITEMï¼Œæ¯ä¸ªå®ä½“å¯¹åº”æ•°æ®åº“ä¸­çš„ä¸€ä¸ªè¡¨ã€‚å…³ç³» ||--o&#123; è¡¨ç¤ºä¸€å¯¹å¤šå…³ç³»ï¼ˆ1:Nï¼‰ã€‚ ||--|&#123; è¡¨ç¤ºä¸€å¯¹å¤šå…³ç³»ï¼ˆ1:Nï¼‰ï¼Œä½†å¼ºè°ƒå®ä½“çš„å”¯ä¸€æ€§ï¼ˆæ¯ä¸ªå­è®°å½•å±äºå”¯ä¸€çš„çˆ¶è®°å½•ï¼‰ã€‚ &#125;|..|&#123; è¡¨ç¤ºå¤šå¯¹å¤šå…³ç³»ï¼ˆN:Mï¼‰ã€‚æ³¨é‡Š : åçš„æ–‡å­—æ˜¯å…³ç³»çš„æè¿°ï¼Œä¾‹å¦‚ placesã€containsã€hasã€‚ä»£ç é€æ­¥è§£æCUSTOMER ||--o&#123; ORDER : places è¡¨ç¤ºä¸€ä¸ªå®¢æˆ· (CUSTOMER) å¯ä»¥ä¸‹å¤šä¸ªè®¢å• (ORDER)ã€‚ ||--o&#123; è¡¨ç¤º ä¸€å¯¹å¤šå…³ç³»ï¼ˆ1:Nï¼‰ï¼Œå³ä¸€ä¸ªå®¢æˆ·å¯¹åº”å¤šä¸ªè®¢å•ã€‚ORDER ||--|&#123; ITEM : contains è¡¨ç¤ºä¸€ä¸ªè®¢å• (ORDER) åŒ…å«å¤šä¸ªå•†å“ (ITEM)ã€‚ ||--|&#123; è¡¨ç¤º ä¸€å¯¹å¤šå…³ç³»ï¼Œä¸”æ¯ä¸ªå•†å“çš„è®°å½•ä¸æŸä¸ªè®¢å•å”¯ä¸€å¯¹åº”ã€‚CUSTOMER &#125;|..|&#123; DELIVERY-ADDRESS : has è¡¨ç¤ºä¸€ä¸ªå®¢æˆ· (CUSTOMER) å¯ä»¥æœ‰å¤šä¸ªé…é€åœ°å€ (DELIVERY-ADDRESS)ï¼Œè€Œæ¯ä¸ªé…é€åœ°å€ä¹Ÿå¯èƒ½å¯¹åº”å¤šä¸ªå®¢æˆ·ã€‚ &#125;|..|&#123; è¡¨ç¤º å¤šå¯¹å¤šå…³ç³»ï¼ˆN:Mï¼‰ã€‚ Gantt Chart ç”¨äºç»˜åˆ¶ç”˜ç‰¹å›¾ï¼Œæ˜¾ç¤ºä»»åŠ¡è®¡åˆ’ã€è¿›åº¦å’Œèµ„æºåˆ†é…ã€‚ Mermaid Gantt Chart type ä¸º &quot;gantt&quot; 1234567891011121314&#123;% mermaid gantt %&#125;title Project TimelinedateFormat YYYY-MM-DDsection Section1Completed :done, des1, 2014-01-06,2014-01-08Active :active, des2, 2014-01-07, 3dParallel 1 : des3, after des1, 1dParallel 2 : des4, after des1, 1dParallel 3 : des5, after des3, 1dParallel 4 : des6, after des4, 1dsection Section2Task 1 : t1,after des6,5dTask 2 : t2,after t1,3d&#123;% endmermaid %&#125; æ•ˆæœ gantt title Project Timeline dateFormat YYYY-MM-DD section Section1 Completed :done, des1, 2014-01-06,2014-01-08 Active :active, des2, 2014-01-07, 3d Parallel 1 : des3, after des1, 1d Parallel 2 : des4, after des1, 1d Parallel 3 : des5, after des3, 1d Parallel 4 : des6, after des4, 1d section Section2 Task 1 : t1,after des6,5d Task 2 : t2,after t1,3d è¯´æ˜ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273åŸºæœ¬ç»“æ„gantt å®šä¹‰ä¸€ä¸ªç”˜ç‰¹å›¾ï¼Œç”¨äºè¡¨ç¤ºä»»åŠ¡çš„æ—¶é—´åˆ†å¸ƒå’Œä¾èµ–å…³ç³»ã€‚title å®šä¹‰ç”˜ç‰¹å›¾çš„æ ‡é¢˜ï¼Œè¿™é‡Œæ˜¯ Project Timelineã€‚dateFormat å®šä¹‰æ—¥æœŸæ ¼å¼ï¼Œè¿™é‡Œæ˜¯ YYYY-MM-DDï¼ˆå¹´-æœˆ-æ—¥ï¼‰ã€‚section å®šä¹‰ä»»åŠ¡çš„åˆ†ç±»ï¼ˆéƒ¨åˆ†ï¼‰ã€‚ æ¯ä¸ª section ä¸‹åŒ…å«ä¸€ç»„ä»»åŠ¡ï¼Œä»»åŠ¡åœ¨å›¾è¡¨ä¸­åˆ†ç»„æ˜¾ç¤ºã€‚ä»»åŠ¡æ ¼å¼ æ¯ä¸ªä»»åŠ¡æŒ‰ä»¥ä¸‹æ ¼å¼å®šä¹‰ï¼š ä»»åŠ¡åç§° : çŠ¶æ€, æ ‡è¯†ç¬¦, å¼€å§‹æ—¥æœŸæˆ–ä¾èµ–, æŒç»­æ—¶é—´ ä»»åŠ¡åç§°ï¼šä»»åŠ¡çš„æè¿°ã€‚ çŠ¶æ€ï¼šå¯é€‰ï¼Œè¡¨ç¤ºä»»åŠ¡çŠ¶æ€ï¼š doneï¼šå·²å®Œæˆã€‚ activeï¼šæ­£åœ¨è¿›è¡Œã€‚ æ ‡è¯†ç¬¦ï¼šä»»åŠ¡çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œç”¨äºå®šä¹‰ä¾èµ–å…³ç³»ã€‚ æ—¶é—´ï¼šå¯ä»¥æ˜¯å¼€å§‹æ—¥æœŸã€ç»“æŸæ—¥æœŸã€æˆ–ä¾èµ–ä»»åŠ¡ã€‚ä»£ç é€æ­¥è§£æsection Section1 å®šä¹‰ä¸€ä¸ªåä¸º Section1 çš„éƒ¨åˆ†ï¼ŒåŒ…å«ä¸€ç»„ä»»åŠ¡ã€‚Completed :done, des1, 2014-01-06,2014-01-08 ä»»åŠ¡åç§°ï¼šCompletedã€‚ çŠ¶æ€ï¼šdoneï¼ˆå·²å®Œæˆï¼‰ã€‚ æ ‡è¯†ç¬¦ï¼šdes1ã€‚ å¼€å§‹æ—¥æœŸï¼š2014-01-06ã€‚ ç»“æŸæ—¥æœŸï¼š2014-01-08ã€‚Active :active, des2, 2014-01-07, 3d ä»»åŠ¡åç§°ï¼šActiveã€‚ çŠ¶æ€ï¼šactiveï¼ˆæ­£åœ¨è¿›è¡Œï¼‰ã€‚ æ ‡è¯†ç¬¦ï¼šdes2ã€‚ å¼€å§‹æ—¥æœŸï¼š2014-01-07ã€‚ æŒç»­æ—¶é—´ï¼š3dï¼ˆ3å¤©ï¼‰ã€‚Parallel 1 : des3, after des1, 1d ä»»åŠ¡åç§°ï¼šParallel 1ã€‚ æ— çŠ¶æ€ï¼ˆé»˜è®¤å€¼ï¼‰ã€‚ æ ‡è¯†ç¬¦ï¼šdes3ã€‚ å¼€å§‹æ—¶é—´ï¼šä¾èµ–ä»»åŠ¡ des1ï¼ˆåœ¨ä»»åŠ¡ Completed åå¼€å§‹ï¼‰ã€‚ æŒç»­æ—¶é—´ï¼š1dï¼ˆ1å¤©ï¼‰ã€‚Parallel 2 : des4, after des1, 1d ä»»åŠ¡åç§°ï¼šParallel 2ã€‚ æ— çŠ¶æ€ã€‚ æ ‡è¯†ç¬¦ï¼šdes4ã€‚ å¼€å§‹æ—¶é—´ï¼šä¾èµ–ä»»åŠ¡ des1ï¼ˆåœ¨ä»»åŠ¡ Completed åå¼€å§‹ï¼‰ã€‚ æŒç»­æ—¶é—´ï¼š1dï¼ˆ1å¤©ï¼‰ã€‚Parallel 3 : des5, after des3, 1d ä»»åŠ¡åç§°ï¼šParallel 3ã€‚ æ— çŠ¶æ€ã€‚ æ ‡è¯†ç¬¦ï¼šdes5ã€‚ å¼€å§‹æ—¶é—´ï¼šä¾èµ–ä»»åŠ¡ des3ï¼ˆåœ¨ä»»åŠ¡ Parallel 1 åå¼€å§‹ï¼‰ã€‚ æŒç»­æ—¶é—´ï¼š1dï¼ˆ1å¤©ï¼‰ã€‚Parallel 4 : des6, after des4, 1d ä»»åŠ¡åç§°ï¼šParallel 4ã€‚ æ— çŠ¶æ€ã€‚ æ ‡è¯†ç¬¦ï¼šdes6ã€‚ å¼€å§‹æ—¶é—´ï¼šä¾èµ–ä»»åŠ¡ des4ï¼ˆåœ¨ä»»åŠ¡ Parallel 2 åå¼€å§‹ï¼‰ã€‚ æŒç»­æ—¶é—´ï¼š1dï¼ˆ1å¤©ï¼‰ã€‚section Section2 å®šä¹‰ç”˜ç‰¹å›¾çš„ç¬¬äºŒéƒ¨åˆ†ï¼Œç”¨äºåˆ†ç»„æ˜¾ç¤ºåç»­ä»»åŠ¡ã€‚ ä»»åŠ¡å±äºä¸åŒçš„éƒ¨åˆ†ä»¥ä¾¿åˆ†ç±»å’Œåˆ†ç»„ã€‚Task 1 : t1, after des6, 5d ä»»åŠ¡åç§°ï¼šTask 1ã€‚ æ ‡è¯†ç¬¦ï¼št1ã€‚ å¼€å§‹æ—¶é—´ï¼šä¾èµ–ä»»åŠ¡ des6ï¼ˆParallel 4ï¼‰å®Œæˆåå¼€å§‹ã€‚ æŒç»­æ—¶é—´ï¼š5dï¼ˆ5å¤©ï¼‰ã€‚Task 2 : t2, after t1, 3d ä»»åŠ¡åç§°ï¼šTask 2ã€‚ æ ‡è¯†ç¬¦ï¼št2ã€‚ å¼€å§‹æ—¶é—´ï¼šä¾èµ–ä»»åŠ¡ t1ï¼ˆTask 1ï¼‰å®Œæˆåå¼€å§‹ã€‚ æŒç»­æ—¶é—´ï¼š3dï¼ˆ3å¤©ï¼‰ã€‚ Pie Chart ç”¨äºç»˜åˆ¶é¥¼çŠ¶å›¾ï¼Œæ˜¾ç¤ºæ•°æ®åˆ†å¸ƒæƒ…å†µã€‚ Mermaid Pie Chart type ä¸º &quot;pie&quot; 1234567&#123;% mermaid pie showData %&#125;%%&#123;init: &#123;&quot;pie&quot;: &#123;&quot;textPosition&quot;: 0.4&#125;, &quot;themeVariables&quot;: &#123;&quot;pieOuterStrokeWidth&quot;: &quot;5px&quot;,&quot;pie1&quot;: &quot;#ff9999&quot;,&quot;pie2&quot;: &quot;#99ccff&quot;,&quot;pie3&quot;: &quot;#99ff99&quot;&#125;&#125; &#125;%%title Expenses&quot;Rent&quot; : 200&quot;Food&quot; : 200&quot;Transport&quot; : 400&#123;% endmermaid %&#125; æ•ˆæœ %%&#123;init: &#123;&quot;pie&quot;: &#123;&quot;textPosition&quot;: 0.4&#125;, &quot;themeVariables&quot;: &#123;&quot;pieOuterStrokeWidth&quot;: &quot;5px&quot;,&quot;pie1&quot;: &quot;#ff9999&quot;,&quot;pie2&quot;: &quot;#99ccff&quot;,&quot;pie3&quot;: &quot;#99ff99&quot;&#125;&#125; &#125;%% pie showData title Expenses &quot;Rent&quot; : 200 &quot;Food&quot; : 200 &quot;Transport&quot; : 400 è¯´æ˜ 1234567891011121314151617181920212223åŸºæœ¬ç»“æ„%%&#123;init: ...&#125;%%ï¼š Mermaid.js çš„åˆå§‹åŒ–é…ç½®ï¼Œç”¨äºå…¨å±€è®¾ç½®å›¾è¡¨å±æ€§å’Œæ ·å¼ã€‚ pie å±æ€§ textPosition: è®¾ç½®é¥¼å›¾æ•°æ®æ ‡ç­¾çš„ç›¸å¯¹ä½ç½®ã€‚ å€¼èŒƒå›´ä¸º 0 åˆ° 1ï¼Œè¡¨ç¤ºæ ‡ç­¾è·ç¦»é¥¼å›¾ä¸­å¿ƒçš„æ¯”ä¾‹ã€‚0.4 è¡¨ç¤ºæ ‡ç­¾è·ç¦»ä¸­å¿ƒè¾ƒè¿‘ï¼Œæ¥è¿‘ 40% çš„åŠå¾„ä½ç½®ã€‚ themeVariables pieOuterStrokeWidth: è®¾ç½®é¥¼å›¾å¤–ç¯çš„å®½åº¦ã€‚è®¾ç½®ä¸º 5pxï¼Œè¡¨ç¤ºé¥¼å›¾æœ‰æ˜æ˜¾çš„å¤–è¾¹æ¡†ã€‚ &quot;pie1&quot;: &quot;#ff9999&quot;,&quot;pie2&quot;: &quot;#99ccff&quot;,&quot;pie3&quot;: &quot;#99ff99&quot;: é…ç½®æ¯ä¸ªåˆ†åŒºçš„é¢œè‰²ã€‚pie å®šä¹‰è¿™æ˜¯ä¸€ä¸ªé¥¼å›¾ã€‚showData æ˜¾ç¤ºæ•°æ®é¡¹çš„æ•°å€¼ã€‚title Expenses è®¾ç½®é¥¼å›¾çš„æ ‡é¢˜ä¸º Expensesï¼ˆè´¹ç”¨ï¼‰ã€‚æ•°æ®é¡¹ æ•°æ®é¡¹å®šä¹‰äº†é¥¼å›¾çš„å„ä¸ªéƒ¨åˆ†ï¼š &quot;Rent&quot; : 200ï¼Œå æ¯”ï¼š200 / (200 + 200 + 400) = 1/4 = 25%ã€‚ &quot;Food&quot; : 200ï¼Œå æ¯”ï¼š200 / (200 + 200 + 400) = 1/4 = 25%ã€‚ &quot;Transport&quot; : 400ï¼Œå æ¯”ï¼š400 / (200 + 200 + 400) = 1/2 = 50%ã€‚ æ¯ä¸ªæ•°æ®é¡¹åŒ…å«ï¼š æ ‡ç­¾ï¼šå¦‚ &quot;Rent&quot;ã€&quot;Food&quot;ã€&quot;Transport&quot;ã€‚ æ•°å€¼ï¼šå¦‚ 200ã€400ï¼Œè¡¨ç¤ºè¯¥éƒ¨åˆ†çš„æƒé‡æˆ–æ•°å€¼å¤§å°ã€‚ XY Chart ç”¨äºç»˜åˆ¶ XY è½´å›¾(æŸ±çŠ¶å›¾å’ŒæŠ˜çº¿å›¾)ï¼Œæ˜¾ç¤ºæ•°æ®åˆ†å¸ƒå’Œè¶‹åŠ¿ã€‚ Mermaid XY Chart type ä¸º &quot;xychart-beta&quot;ï¼Œç›®å‰ xychart-beta è¿˜å¤„åœ¨æ”¹è¿›é˜¶æ®µ 12345678&#123;% mermaid xychart-beta %&#125;%%&#123;init: &#123;&quot;xyChart&quot;: &#123;&quot;width&quot;: 900,&quot;height&quot;:600&#125;, &quot;themeVariables&quot;: &#123;&quot;xyChart&quot;:&#123;&quot;titleColor&quot;: &quot;#ff0000&quot;&#125;&#125;&#125; &#125;%%title &quot;Sales Revenue&quot;x-axis [jan, feb, mar, apr, may, jun, jul, aug, sep, oct, nov, dec]y-axis &quot;Revenue (in $)&quot; 4000 --&gt; 11000bar [5000, 6000, 7500, 8200, 9500, 10500, 11000, 10200, 9200, 8500, 7000, 6000]line [5000, 6000, 7500, 8200, 9500, 10500, 11000, 10200, 9200, 8500, 7000, 6000]&#123;% endmermaid %&#125; æ•ˆæœ --- config: xyChart: width: 900 height: 600 themeVariables: xyChart: titleColor: &quot;#ff0000&quot; --- xychart-beta title &quot;Sales Revenue&quot; x-axis [jan, feb, mar, apr, may, jun, jul, aug, sep, oct, nov, dec] y-axis &quot;Revenue (in $)&quot; 4000 --&gt; 11000 bar [5000, 6000, 7500, 8200, 9500, 10500, 11000, 10200, 9200, 8500, 7000, 6000] line [5000, 6000, 7500, 8200, 9500, 10500, 11000, 10200, 9200, 8500, 7000, 6000] è¯´æ˜ 12345678910111213ä»£ç ç»“æ„è§£æ%%&#123;init: ...&#125;%%ï¼š Mermaid.js çš„åˆå§‹åŒ–é…ç½®ï¼Œç”¨äºå…¨å±€è®¾ç½®å›¾è¡¨å±æ€§å’Œæ ·å¼ã€‚ xyChart.width å’Œ xyChart.height : è®¾ç½®å›¾è¡¨çš„å®½åº¦å’Œé«˜åº¦ã€‚ themeVariables.xyChart.titleColor: è®¾ç½®æ ‡é¢˜çš„é¢œè‰²ã€‚title è®¾ç½®å›¾è¡¨çš„æ ‡é¢˜ã€‚åæ ‡è½´å®šä¹‰ x-axisï¼šXè½´æ ‡ç­¾ä¸ºæœˆä»½ï¼ˆä»1æœˆåˆ°12æœˆï¼‰ã€‚ y-axisï¼šYè½´èŒƒå›´ä» $4000 åˆ° $11000ï¼Œå•ä½ä¸ºç¾å…ƒã€‚æ•°æ® barï¼šæŸ±çŠ¶å›¾æ•°æ®ï¼Œè¡¨ç¤ºæ¯ä¸ªæœˆçš„é”€å”®æ”¶å…¥ã€‚ lineï¼šæŠ˜çº¿å›¾æ•°æ®ï¼Œè¡¨ç¤ºæ¯ä¸ªæœˆçš„é”€é‡è¶‹åŠ¿ã€‚ Journey Diagram ç”¨äºç»˜åˆ¶æ—…ç¨‹å›¾ï¼Œæ˜¾ç¤ºç”¨æˆ·çš„ä½“éªŒæµç¨‹ï¼ŒåŒ…æ‹¬ç”¨æˆ·è¿›å…¥ç³»ç»Ÿã€æ“ä½œã€é€€å‡ºç³»ç»Ÿç­‰ã€‚ Mermaid Journey Diagram type ä¸º &quot;journey&quot; 12345678910111213&#123;% mermaid journey %&#125;title My working daysection Morning wake up : 5 : me go to work : 3 : me,yousection Lunch have lunch : 5 : me,you go to work : 1 : me,yousection Dinner finish your meal : 5 : mesection Go home go home : 5 : me&#123;% endmermaid %&#125; æ•ˆæœ journey title My working day section Morning wake up : 5 : me go to work : 3 : me,you section Lunch have lunch : 5 : me,you go to work : 1 : me,you section Dinner finish your meal : 5 : me section Go home go home : 5 : me è¯´æ˜ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748åŸºæœ¬ç»“æ„journey å®šä¹‰è¿™æ˜¯ä¸€ä¸ªæ—…ç¨‹å›¾ã€‚title My working day è®¾ç½®æ—…ç¨‹å›¾çš„æ ‡é¢˜ä¸º &quot;My working day&quot;ï¼ˆæˆ‘çš„å·¥ä½œæ—¥ï¼‰ã€‚section å®šä¹‰æ—…ç¨‹å›¾çš„åˆ†æ®µï¼Œç”¨äºè¡¨ç¤ºä¸€å¤©ä¸­çš„ä¸åŒé˜¶æ®µï¼Œä¾‹å¦‚ï¼š Morningï¼ˆæ—©æ™¨ï¼‰ã€‚ Lunchï¼ˆåˆé¤æ—¶é—´ï¼‰ã€‚ Dinnerï¼ˆæ™šé¤ï¼‰ã€‚ Go homeï¼ˆå›å®¶ï¼‰ã€‚ä»»åŠ¡æ ¼å¼ ä»»åŠ¡æè¿° : æ»¡æ„åº¦è¯„åˆ† : å‚ä¸è€… ä»»åŠ¡æè¿°ï¼šæè¿°å…·ä½“çš„ä»»åŠ¡æˆ–æ´»åŠ¨ã€‚ æ»¡æ„åº¦è¯„åˆ†ï¼šä» 1 åˆ° 5ï¼Œè¡¨ç¤ºå¯¹ä»»åŠ¡æˆ–æ´»åŠ¨çš„æ»¡æ„ç¨‹åº¦ã€‚ å‚ä¸è€…ï¼šå‚ä¸ä»»åŠ¡çš„äººï¼Œå¯ä»¥æ˜¯ meï¼ˆè‡ªå·±ï¼‰ã€youï¼ˆå…¶ä»–äººï¼‰æˆ–ä¸¤è€…ã€‚ä»£ç é€æ­¥è§£æsection Morning wake up : 5 : me æ´»åŠ¨ï¼šwake upï¼ˆèµ·åºŠï¼‰ã€‚ æ»¡æ„åº¦ï¼š5ï¼ˆéå¸¸æ»¡æ„ï¼‰ã€‚ å‚ä¸è€…ï¼šmeï¼ˆè‡ªå·±ï¼‰ã€‚ go to work : 3 : me,you æ´»åŠ¨ï¼šgo to workï¼ˆå»å·¥ä½œï¼‰ã€‚ æ»¡æ„åº¦ï¼š3ï¼ˆä¸­ç­‰æ»¡æ„ï¼‰ã€‚ å‚ä¸è€…ï¼šme å’Œ youï¼ˆè‡ªå·±å’Œå…¶ä»–äººï¼‰ã€‚section Lunch have lunch : 5 : me,you æ´»åŠ¨ï¼šhave lunchï¼ˆåƒåˆé¥­ï¼‰ã€‚ æ»¡æ„åº¦ï¼š5ï¼ˆéå¸¸æ»¡æ„ï¼‰ã€‚ å‚ä¸è€…ï¼šme å’Œ youï¼ˆè‡ªå·±å’Œå…¶ä»–äººï¼‰ã€‚ go to work : 1 : me,you æ´»åŠ¨ï¼šgo to workï¼ˆåƒå®Œé¥­ç»§ç»­å·¥ä½œï¼‰ã€‚ æ»¡æ„åº¦ï¼š1ï¼ˆéå¸¸ä¸æ»¡æ„ï¼‰ã€‚ å‚ä¸è€…ï¼šme å’Œ youã€‚section Dinner finish your meal : 5 : me æ´»åŠ¨ï¼šfinish your mealï¼ˆåƒå®Œé¥­ï¼‰ã€‚ æ»¡æ„åº¦ï¼š5ï¼ˆéå¸¸æ»¡æ„ï¼‰ã€‚ å‚ä¸è€…ï¼šmeï¼ˆè‡ªå·±ï¼‰ã€‚section Go home go home : 5 : me æ´»åŠ¨ï¼šgo homeï¼ˆå›å®¶ï¼‰ã€‚ æ»¡æ„åº¦ï¼š5ï¼ˆéå¸¸æ»¡æ„ï¼‰ã€‚ å‚ä¸è€…ï¼šmeï¼ˆè‡ªå·±ï¼‰ã€‚ Requirement Diagram ç”¨äºç»˜åˆ¶éœ€æ±‚å›¾ï¼Œæ˜¾ç¤ºç³»ç»Ÿçš„åŠŸèƒ½éœ€æ±‚å’Œä¾èµ–å…³ç³»ã€‚ Mermaid Requirement Diagram type ä¸º &quot;requirementDiagram&quot; 12345678910111213141516171819&#123;% mermaid requirementDiagram %&#125;requirement &quot;æµ‹è¯•éœ€æ±‚&quot; &#123; id: 1 text: &quot;æµ‹è¯•æ–‡æœ¬&quot; risk: High verifymethod: test&#125;requirement &quot;æµ‹è¯•éœ€æ±‚2&quot; &#123; id: 2 text: &quot;æµ‹è¯•æ–‡æœ¬&quot; risk: High verifymethod: test&#125;element &quot;æµ‹è¯•å®ä½“&quot; &#123; type: &quot;æ¨¡æ‹Ÿ&quot;&#125;&quot;æµ‹è¯•å®ä½“&quot; - satisfies -&gt; &quot;æµ‹è¯•éœ€æ±‚&quot;&quot;æµ‹è¯•å®ä½“&quot; - satisfies -&gt; &quot;æµ‹è¯•éœ€æ±‚2&quot;&#123;% endmermaid %&#125; æ•ˆæœ requirementDiagram requirement &quot;æµ‹è¯•éœ€æ±‚&quot; &#123; id: 1 text: &quot;æµ‹è¯•æ–‡æœ¬&quot; risk: High verifymethod: test &#125; requirement &quot;æµ‹è¯•éœ€æ±‚2&quot; &#123; id: 2 text: &quot;æµ‹è¯•æ–‡æœ¬&quot; risk: High verifymethod: test &#125; element &quot;æµ‹è¯•å®ä½“&quot; &#123; type: &quot;æ¨¡æ‹Ÿ&quot; &#125; &quot;æµ‹è¯•å®ä½“&quot; - satisfies -&gt; &quot;æµ‹è¯•éœ€æ±‚&quot; &quot;æµ‹è¯•å®ä½“&quot; - satisfies -&gt; &quot;æµ‹è¯•éœ€æ±‚2&quot; è¯´æ˜ 12345678910111213141516171819202122232425262728293031323334353637383940åŸºæœ¬ç»“æ„requirementDiagram å®šä¹‰è¿™æ˜¯ä¸€ä¸ªéœ€æ±‚å›¾ã€‚requirement å®šä¹‰ä¸€ä¸ªéœ€æ±‚èŠ‚ç‚¹ï¼ŒåŒ…å«éœ€æ±‚çš„è¯¦ç»†å±æ€§ï¼Œå¦‚ï¼š idï¼šéœ€æ±‚ç¼–å·ã€‚ textï¼šéœ€æ±‚çš„æè¿°ã€‚ riskï¼šéœ€æ±‚çš„é£é™©çº§åˆ«ï¼ˆå¦‚ High è¡¨ç¤ºé«˜é£é™©ï¼‰ã€‚ verifymethodï¼šéªŒè¯éœ€æ±‚çš„æ–¹æ³•ï¼ˆå¦‚ test è¡¨ç¤ºé€šè¿‡æµ‹è¯•éªŒè¯ï¼‰ã€‚element å®šä¹‰ä¸€ä¸ªå…ƒç´ ï¼Œç”¨äºè¡¨ç¤ºç³»ç»Ÿä¸­çš„æŸä¸ªå®ä½“æˆ–å¯¹è±¡ã€‚ åŒ…å«å±æ€§ï¼Œå¦‚ï¼š typeï¼šå®ä½“çš„ç±»å‹ï¼ˆå¦‚ æ¨¡æ‹Ÿ è¡¨ç¤ºæ¨¡æ‹Ÿå®ä½“ï¼‰ã€‚å…³ç³»å®šä¹‰ å®šä¹‰äº†ä¸¤ä¸ªå…³ç³»ï¼š &quot;æµ‹è¯•å®ä½“&quot; - satisfies -&gt; &quot;æµ‹è¯•éœ€æ±‚&quot; : æµ‹è¯•å®ä½“ æ»¡è¶³äº† æµ‹è¯•éœ€æ±‚ &quot;æµ‹è¯•å®ä½“&quot; - satisfies -&gt; &quot;æµ‹è¯•éœ€æ±‚2&quot; : æµ‹è¯•å®ä½“ æ»¡è¶³äº† æµ‹è¯•éœ€æ±‚2 - satisfies -&gt;ï¼šsatisfies è¡¨ç¤ºæ»¡è¶³å…³ç³»ï¼Œç®­å¤´æ–¹å‘ä»å®ä½“æŒ‡å‘éœ€æ±‚ä»£ç é€æ­¥è§£æéœ€æ±‚å®šä¹‰ requirement &quot;æµ‹è¯•éœ€æ±‚&quot; å®šä¹‰ç¬¬ä¸€ä¸ªéœ€æ±‚ï¼Œæ˜¾ç¤ºåç§°ä¸º æµ‹è¯•éœ€æ±‚ã€‚ å±æ€§ï¼š id: 1ï¼ˆéœ€æ±‚ç¼–å·ä¸º 1ï¼‰ã€‚ text: &quot;æµ‹è¯•æ–‡æœ¬&quot;ï¼ˆæè¿°æ–‡æœ¬ä¸º &quot;æµ‹è¯•æ–‡æœ¬&quot;ï¼‰ã€‚ risk: Highï¼ˆé«˜é£é™©éœ€æ±‚ï¼‰ã€‚ verifymethod: testï¼ˆéªŒè¯æ–¹æ³•ä¸ºæµ‹è¯•ï¼‰ã€‚ requirement &quot;æµ‹è¯•éœ€æ±‚2&quot; å®šä¹‰ç¬¬äºŒä¸ªéœ€æ±‚ï¼Œæ˜¾ç¤ºåç§°ä¸º æµ‹è¯•éœ€æ±‚2ã€‚ å±æ€§ï¼š id: 2ï¼ˆéœ€æ±‚ç¼–å·ä¸º 2ï¼‰ã€‚ text: &quot;æµ‹è¯•æ–‡æœ¬&quot;ï¼ˆæè¿°æ–‡æœ¬ä¸ç¬¬ä¸€ä¸ªéœ€æ±‚ç›¸åŒï¼‰ã€‚ risk: Highï¼ˆé«˜é£é™©éœ€æ±‚ï¼‰ã€‚ verifymethod: testï¼ˆéªŒè¯æ–¹æ³•ä¸ºæµ‹è¯•ï¼‰ã€‚å®ä½“å®šä¹‰ element &quot;æµ‹è¯•å®ä½“&quot; å®šä¹‰ä¸€ä¸ªç³»ç»Ÿå®ä½“ï¼Œæ˜¾ç¤ºåç§°ä¸º æµ‹è¯•å®ä½“ã€‚ å±æ€§ï¼š type: &quot;æ¨¡æ‹Ÿ&quot;ï¼ˆå®ä½“ç±»å‹ä¸º &quot;æ¨¡æ‹Ÿ&quot;ï¼‰ã€‚ Gitgraph Diagram ç”¨äºç»˜åˆ¶Gitå›¾ï¼Œæ˜¾ç¤ºä»£ç ä»“åº“çš„æäº¤å†å²å’Œåˆ†æ”¯å…³ç³»ã€‚ Mermaid Gitgraph Diagram type ä¸º &quot;gitgraph&quot; 1234567891011&#123;% mermaid gitGraph %&#125;commitcommitcommitbranch newbranchcheckout newbranchcommitcommitcheckout mainmerge newbranch&#123;% endmermaid %&#125; æ•ˆæœ gitGraph commit commit commit branch newbranch checkout newbranch commit commit checkout main merge newbranch è¯´æ˜ 1234567891011121314åŸºæœ¬ç»“æ„gitGraph å®šä¹‰è¿™æ˜¯ä¸€ä¸ª Git å›¾ã€‚commit è¡¨ç¤ºä¸€æ¬¡æäº¤æ“ä½œï¼Œæ¯ä¸ª commit èŠ‚ç‚¹ä»£è¡¨ä»£ç ä»“åº“çš„æŸä¸ªæäº¤ç‚¹ã€‚branch åˆ›å»ºä¸€ä¸ªæ–°åˆ†æ”¯ã€‚ æ ¼å¼ï¼šbranch åˆ†æ”¯åç§°ã€‚checkout åˆ‡æ¢åˆ°æŒ‡å®šåˆ†æ”¯ã€‚ æ ¼å¼ï¼šcheckout åˆ†æ”¯åç§°ã€‚merge å°†æŒ‡å®šåˆ†æ”¯åˆå¹¶åˆ°å½“å‰åˆ†æ”¯ã€‚ æ ¼å¼ï¼šmerge åˆ†æ”¯åç§°ã€‚ Mindmap ç”¨äºç»˜åˆ¶æ€ç»´å¯¼å›¾ï¼Œæ˜¾ç¤ºä¸»é¢˜å’Œå­ä¸»é¢˜ä¹‹é—´çš„ hierarchical å…³ç³»ã€‚ Mermaid Mindmap type ä¸º &quot;mindmap&quot; 123456789101112131415161718&#123;% mermaid mindmap %&#125;root((mindmap)) (origins) Long history ::icon(fa fa-book) Popularisation British popular psychology author Tony Buzan [Research] On effectivness&lt;br/&gt;and features On Automatic creation Uses Creative techniques Strategic planning Argument mapping Tools Pen and paper Mermaid&#123;% endmermaid %&#125; æ•ˆæœ mindmap root((mindmap)) (origins) Long history ::icon(fa fa-book) Popularisation British popular psychology author Tony Buzan [Research] On effectivness&lt;br/&gt;and features On Automatic creation Uses Creative techniques Strategic planning Argument mapping Tools Pen and paper Mermaid è¯´æ˜ 123456789101112131415åŸºæœ¬ç»“æ„mindmap å®šä¹‰è¿™æ˜¯ä¸€ä¸ªæ€ç»´å¯¼å›¾ã€‚root((mindmap)) å®šä¹‰æ€ç»´å¯¼å›¾çš„æ ¹èŠ‚ç‚¹ï¼Œæ˜¾ç¤ºä¸ºåœ†å½¢å¹¶æ ‡æ³¨ä¸º &quot;mindmap&quot;ã€‚å­èŠ‚ç‚¹ä½¿ç”¨ç¼©è¿›è¡¨ç¤ºä»å±å…³ç³»ï¼š æ¯ä¸€çº§ç¼©è¿›ä»£è¡¨ä¸€ä¸ªå±‚çº§çš„å­èŠ‚ç‚¹ã€‚ å­èŠ‚ç‚¹å¯ä»¥ç›´æ¥æ·»åŠ å†…å®¹æˆ–é€šè¿‡ &lt;br/&gt; æ¢è¡Œã€‚::icon(...) ä¸ºèŠ‚ç‚¹æ·»åŠ å›¾æ ‡ã€‚Mermaid.js æ”¯æŒä½¿ç”¨ FontAwesome çš„å›¾æ ‡ã€‚èŠ‚ç‚¹å½¢çŠ¶é•¿æ–¹å½¢ [] ï¼šå¦‚ [é•¿æ–¹å½¢]ï¼Œæ˜¯é»˜è®¤çš„çŸ©å½¢èŠ‚ç‚¹ã€‚è¿™ä¸ªæ˜¯é»˜è®¤çš„èŠ‚ç‚¹ç±»å‹ã€‚åœ†å½¢ (()) ï¼šå¦‚ ((åœ†))ï¼Œç”¨äºè¡¨ç¤ºä¸€ä¸ªåœ†å½¢èŠ‚ç‚¹ã€‚åœ†è§’é•¿æ–¹å½¢ () ï¼šå¦‚ (åœ†è§’é•¿æ–¹å½¢)ï¼Œç”¨äºè¡¨ç¤ºåœ†è§’çŸ©å½¢èŠ‚ç‚¹ã€‚ QuadrantChart ç”¨äºç»˜åˆ¶è±¡é™å›¾ï¼Œæ˜¾ç¤ºä¸åŒç»´åº¦ä¹‹é—´çš„æ¯”è¾ƒå…³ç³»ã€‚ Mermaid QuadrantChart type ä¸º &quot;quadrantChart&quot; 12345678910111213141516&#123;% mermaid quadrantChart %&#125;%%&#123;init: &#123;&quot;quadrantChart&quot;: &#123;&quot;chartHeight&quot;: 600, &quot;chartWidth&quot;: 800, &quot;pointTextPadding&quot;: 10&#125;, &quot;themeVariables&quot;: &#123;&quot;quadrant1Fill&quot;: &quot;#ff0000&quot;, &quot;quadrant2Fill&quot;: &quot;#FFFF00&quot;, &quot;quadrant3Fill&quot;: &quot;#32CD32&quot;, &quot;quadrant4Fill&quot;: &quot;#800080&quot;&#125;&#125;&#125;%%title Reach and engagement of carpaignsx-axis Low Reach --&gt; High Reachy-axis Low Engagement --&gt; High Engagementquadrant-1 we should expandquadrant-2 Need to promotequadrant-3 Re-evaluatequadrant-4 May be improvedCampaign A: [0.3,0.6]Campaign B: [0.45,0.23]Campaign C: [0.57,0.69]Campaign D: [0.78,0.34]Campaign E: [0.40,0.34]Campaign F: [0.35,0.78]&#123;% endmermaid %&#125; æ•ˆæœ %%&#123;init: &#123;&quot;quadrantChart&quot;: &#123;&quot;chartHeight&quot;: 600, &quot;chartWidth&quot;: 800, &quot;pointTextPadding&quot;: 10&#125;, &quot;themeVariables&quot;: &#123;&quot;quadrant1Fill&quot;: &quot;#ff0000&quot;, &quot;quadrant2Fill&quot;: &quot;#FFFF00&quot;, &quot;quadrant3Fill&quot;: &quot;#32CD32&quot;, &quot;quadrant4Fill&quot;: &quot;#800080&quot;&#125;&#125;&#125;%% quadrantChart title Reach and engagement of carpaigns x-axis Low Reach --&gt; High Reach y-axis Low Engagement --&gt; High Engagement quadrant-1 we should expand quadrant-2 Need to promote quadrant-3 Re-evaluate quadrant-4 May be improved Campaign A: [0.3,0.6] Campaign B: [0.45,0.23] Campaign C: [0.57,0.69] Campaign D: [0.78,0.34] Campaign E: [0.40,0.34] Campaign F: [0.35,0.78] è¯´æ˜ 12345678910111213141516171819202122232425262728293031323334353637åŸºæœ¬ç»“æ„%%&#123;init: ...&#125;%% è¿™æ˜¯ Mermaid.js çš„åˆå§‹åŒ–é…ç½®å—ï¼Œç”¨äºè‡ªå®šä¹‰å›¾è¡¨çš„å…¨å±€å‚æ•°å’Œæ ·å¼ã€‚ é…ç½®å†…å®¹ï¼Œè¯¦è§ä¸‹æ–‡ï¼š quadrantChartï¼šè‡ªå®šä¹‰è±¡é™å›¾çš„ç›¸å…³å‚æ•°ã€‚ themeVariablesï¼š å›¾è¡¨ä¸»é¢˜é…è‰²ã€‚quadrantChart å®šä¹‰è¿™æ˜¯ä¸€ä¸ªè±¡é™å›¾ã€‚title æ ‡é¢˜åæ ‡è½´ï¼Œå®šä¹‰ X è½´å’Œ Y è½´çš„èŒƒå›´å’Œæ–¹å‘ï¼šx-axis Low Reach --&gt; High Reach X è½´ ä» â€œLow Reachâ€ åˆ° â€œHigh Reachâ€ã€‚y-axis Low Engagement --&gt; High Engagement Y è½´ ä» â€œLow Engagementâ€ åˆ° â€œHigh Engagementâ€ã€‚è±¡é™å®šä¹‰quadrant-1 we should expand è±¡é™ 1ï¼ˆå³ä¸Šï¼‰ï¼š&quot;we should expand&quot;quadrant-2 Need to promote è±¡é™ 2ï¼ˆå·¦ä¸Šï¼‰ï¼š&quot;Need to promote&quot;quadrant-3 Re-evaluate è±¡é™ 3ï¼ˆå·¦ä¸‹ï¼‰ï¼š&quot;Re-evaluate&quot;quadrant-4 May be improved è±¡é™ 4ï¼ˆå³ä¸‹ï¼‰ï¼š&quot;May be improved&quot;æ•°æ®ç‚¹Campaign A: [0.3,0.6]Campaign B: [0.45,0.23]Campaign C: [0.57,0.69]Campaign D: [0.78,0.34]Campaign E: [0.40,0.34]Campaign F: [0.35,0.78]å®šä¹‰äº† 6 ä¸ªæ´»åŠ¨ï¼ˆCampaignï¼‰çš„æ•°æ®ç‚¹ï¼Œä½¿ç”¨ [name]: [x, y] çš„æ ¼å¼æ¥æ·»åŠ æ•°æ®ç‚¹ï¼Œå…¶ä¸­ [name] æ˜¯æ•°æ®ç‚¹çš„åç§°ï¼Œ[x, y] æ˜¯æ•°æ®ç‚¹åœ¨ x è½´å’Œ y è½´ä¸Šçš„åæ ‡å€¼ï¼Œå¯¹äºç‚¹xå’Œyå€¼ï¼Œæœ€å°å€¼ä¸º0ï¼Œæœ€å¤§å€¼ä¸º1ã€‚X å€¼ï¼šè¡¨ç¤ºæ´»åŠ¨çš„ Reachï¼ˆè¦†ç›–é¢ï¼‰ã€‚Y å€¼ï¼šè¡¨ç¤ºæ´»åŠ¨çš„ Engagementï¼ˆå‚ä¸åº¦ï¼‰ã€‚ åˆå§‹åŒ–é…ç½® quadrantChartï¼šè‡ªå®šä¹‰è±¡é™å›¾çš„ç›¸å…³å‚æ•° å‚æ•° æè¿° é»˜è®¤å€¼ chartHeight å›¾è¡¨çš„é«˜åº¦ 500 chartWidth å›¾è¡¨çš„å®½åº¦ 500 pointLabelFontSize ç‚¹æ–‡æœ¬å­—ä½“å¤§å° 12 pointRadius è¦ç»˜åˆ¶çš„ç‚¹çš„åŠå¾„ 5 pointTextPadding ç‚¹å’Œä¸‹é¢æ–‡æœ¬ä¹‹é—´çš„å¡«å…… 5 quadrantExternalBorderStrokeWidth è±¡é™å¤–è¾¹æ¡†æè¾¹å®½åº¦ 2 quadrantInternalBorderStrokeWidth è±¡é™å†…çš„è¾¹æ¡†æè¾¹å®½åº¦ 1 quadrantLabelFontSize è±¡é™æ–‡æœ¬å­—ä½“å¤§å° 16 quadrantPadding æ‰€æœ‰è±¡é™å¤–çš„å¡«å…… 5 quadrantTextTopPadding å½“æ–‡æœ¬ç»˜åˆ¶åœ¨é¡¶éƒ¨æ—¶è±¡é™æ–‡æœ¬é¡¶éƒ¨å¡«å……ï¼ˆé‚£é‡Œæ²¡æœ‰æ•°æ®ç‚¹ï¼‰ 5 titlePadding æ ‡é¢˜çš„é¡¶éƒ¨å’Œåº•éƒ¨å¡«å…… 10 titleFontSize æ ‡é¢˜å­—ä½“å¤§å° 20 xAxisLabelPadding x è½´æ–‡æœ¬çš„é¡¶éƒ¨å’Œåº•éƒ¨å¡«å…… 5 xAxisLabelFontSize X è½´æ–‡æœ¬å­—ä½“å¤§å° 16 xAxisPosition x è½´çš„ä½ç½®ï¼ˆé¡¶éƒ¨ã€åº•éƒ¨ï¼‰å¦‚æœæœ‰ç‚¹ï¼Œåˆ™ x è½´å°†å§‹ç»ˆæ¸²æŸ“åœ¨åº•éƒ¨ â€˜topâ€™ yAxisLabelPadding y è½´æ–‡æœ¬çš„å·¦å³å¡«å…… 5 yAxisLabelFontSize Y è½´æ–‡æœ¬å­—ä½“å¤§å° 16 yAxisPosition y è½´ä½ç½®ï¼ˆå·¦ã€å³ï¼‰ â€˜leftâ€™ themeVariablesï¼š å›¾è¡¨ä¸»é¢˜é…è‰² å‚æ•° æè¿° quadrant1Fill å³ä¸Šè±¡é™çš„å¡«å……é¢œè‰² quadrant2Fill å·¦ä¸Šè±¡é™çš„å¡«å……é¢œè‰² quadrant3Fill å·¦ä¸‹è±¡é™çš„å¡«å……é¢œè‰² quadrant4Fill å³ä¸‹è±¡é™çš„å¡«å……é¢œè‰² quadrant1TextFill å³ä¸Šè±¡é™çš„æ–‡æœ¬é¢œè‰² quadrant2TextFill å·¦ä¸Šè±¡é™çš„æ–‡æœ¬é¢œè‰² quadrant3TextFill å·¦ä¸‹è±¡é™çš„æ–‡æœ¬é¢œè‰² quadrant4TextFill å³ä¸‹è±¡é™çš„æ–‡æœ¬é¢œè‰² quadrantPointFill ç‚¹å¡«å……é¢œè‰² quadrantPointTextFill ç‚¹æ–‡æœ¬é¢œè‰² quadrantXAxisTextFill X è½´æ–‡æœ¬é¢œè‰² quadrantYAxisTextFill Y è½´æ–‡æœ¬é¢œè‰² quadrantInternalBorderStrokeFill è±¡é™å†…è¾¹æ¡†é¢œè‰² quadrantExternalBorderStrokeFill è±¡é™å¤–è¾¹æ¡†é¢œè‰² quadrantTitleFill æ ‡é¢˜é¢œè‰²","summary":"æ‘˜è¦ Mermaid æ˜¯ä¸€ä¸ªæ”¯æŒåœ¨Markdownæ–‡æ¡£ä¸­ç»˜åˆ¶æµç¨‹å›¾ã€ç”˜ç‰¹å›¾ã€åºåˆ—å›¾ç­‰å›¾å½¢çš„å·¥å…·ã€‚å®ƒåŸºäºJavaScriptå®ç°ï¼Œèƒ½å¤Ÿå°†Markdownä¸­çš„å…ƒç´ æ¸²æŸ“æˆHTMLå…ƒç´ ï¼Œä»è€Œåœ¨ç½‘é¡µä¸Šç›´è§‚åœ°å±•ç¤ºå„ç§å›¾è¡¨â€Œ Nextä¸»é¢˜ä¸­ä½¿ç”¨Mermaidè¯´æ˜ æœ¬æ–‡ä»‹ç»å¦‚ä½•åœ¨ Hexo-Next ä¸»é¢˜ä¸­ä½¿ç”¨ Mermaid","date_published":"2025-01-02T13:55:05.000Z","tags":["Hexo","Hexo"]},{"id":"https://blog.hanqunfeng.com/2024/11/28/brew/","url":"https://blog.hanqunfeng.com/2024/11/28/brew/","title":"MacOSè½¯ä»¶åŒ…ç®¡ç†å™¨--brew","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\n-->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><a href=\"https://brew.sh\">brew</a>æ˜¯ä¸€ä¸ªè½¯ä»¶åŒ…ç®¡ç†å™¨ï¼ŒåŒæ—¶æ”¯æŒMacOSå’ŒLinuxï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿åœ°å®‰è£…å„ç§è½¯ä»¶ï¼Œæ¯”å¦‚<code>git</code>ã€<code>node</code>ã€<code>python</code>ç­‰ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><code>brew</code>è™½ç„¶æ”¯æŒlinuxï¼Œä½†æ˜¯å®é™…ä½¿ç”¨ä¸­å¾ˆå°‘ä¼šä½¿ç”¨brewæ¥ç®¡ç†linuxçš„è½¯ä»¶åŒ…ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç»å¦‚ä½•åœ¨macosä¸‹å®‰è£…brewï¼Œä»¥åŠå¦‚ä½•ä½¿ç”¨brewç®¡ç†å„ç§è½¯ä»¶åŒ…ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡åŸºäº MacOS Intel Ventura 13.7.1ï¼Œbrew ç‰ˆæœ¬ä¸º4.4.8ã€‚</p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"å®‰è£…\">å®‰è£…</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>é¦–å…ˆè¦ç¡®ä¿ç³»ç»Ÿä¸­å®‰è£…äº† <code>git</code> å’Œ <code>curl</code>ï¼Œå¯¹äº macOS ç”¨æˆ·æ¥è¯´ï¼Œè¿™äº›ç³»ç»Ÿéƒ½è‡ªå¸¦äº†ï¼Œå”¯ä¸€éœ€é¢å¤–è¦æ±‚å®‰è£…çš„æ˜¯<code>Command Line Tools (CLT) for Xcode</code>ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æ£€æŸ¥ç³»ç»Ÿä¸­æ˜¯å¦å®‰è£…äº† Command Line Tools (CLT) for Xcode</span></span><br><span class=\"line\">xcode-select --version <span class=\"comment\"># èƒ½å¤Ÿè¾“å‡ºç‰ˆæœ¬å·è¯´æ˜å®‰è£…äº†ï¼Œå¦åˆ™éœ€è¦å®‰è£…ã€‚</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å®‰è£… Command Line Tools (CLT) for Xcode</span></span><br><span class=\"line\">xcode-select --install</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ‰“å°å½“å‰çš„ Command Line Tools (CLT) for Xcode çš„å®‰è£…è·¯å¾„</span></span><br><span class=\"line\">xcode-select -p <span class=\"comment\"># /Library/Developer/CommandLineTools</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"åœ¨MacOSä¸Šå®‰è£…brewçš„æ–¹æ³•\">åœ¨MacOSä¸Šå®‰è£…brewçš„æ–¹æ³•</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><a href=\"https://github.com/Homebrew/install\">å‚è€ƒèµ„æ–™</a></p>\n</li>\n</ul>\n<h4 id=\"æ–¹æ³•ä¸€ï¼šä½¿ç”¨è„šæœ¬å®‰è£…\">æ–¹æ³•ä¸€ï¼šä½¿ç”¨è„šæœ¬å®‰è£…</h4>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/bin/bash -c <span class=\"string\">&quot;<span class=\"subst\">$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)</span>&quot;</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å®‰è£…æ—¶å¯ä»¥æŒ‡å®šé•œåƒä¸‹è½½æºï¼Œé»˜è®¤æ˜¯<a href=\"https://github.com/Homebrew/brew.git\">Homebrewçš„GitHubä¸‹è½½æº</a>ï¼Œä¹Ÿå¯ä»¥é€‰æ‹©å›½å†…çš„é•œåƒæºï¼Œæ¯”å¦‚ä½¿ç”¨<a href=\"https://mirrors.tuna.tsinghua.edu.cn/help/homebrew/\">æ¸…åå¤§å­¦çš„Homebrew</a>é•œåƒæº</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æ§åˆ¶äº† Homebrew åœ¨å®‰è£…è½¯ä»¶åŒ…æ—¶æ˜¯å¦ä» Homebrew çš„ API æœåŠ¡å™¨è·å–ä¿¡æ¯ï¼Œbrew4.0åæ˜¯é»˜è®¤è¡Œä¸ºï¼Œæ— éœ€è®¾ç½®</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> HOMEBREW_INSTALL_FROM_API=1</span><br><span class=\"line\"><span class=\"comment\"># è®¾ç½®brewä»“åº“ä¸Šæ¸¸</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> HOMEBREW_BREW_GIT_REMOTE=<span class=\"string\">&quot;https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/brew.git&quot;</span></span><br><span class=\"line\"><span class=\"comment\"># è®¾ç½®homebrewæ ¸å¿ƒä¸Šæ¸¸</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> HOMEBREW_CORE_GIT_REMOTE=<span class=\"string\">&quot;https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/homebrew-core.git&quot;</span></span><br><span class=\"line\">/bin/bash -c <span class=\"string\">&quot;<span class=\"subst\">$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)</span>&quot;</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"æ–¹æ³•äºŒï¼šä½¿ç”¨PKGæ–‡ä»¶å®‰è£…\">æ–¹æ³•äºŒï¼šä½¿ç”¨PKGæ–‡ä»¶å®‰è£…</h4>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä»<a href=\"https://github.com/Homebrew/brew\">Homebrewçš„github</a>ä¸Šä¸‹è½½æœ€æ–°ç‰ˆçš„<a href=\"https://github.com/Homebrew/brew/releases/latest\">Homebrew-x.x.x.pkg</a></p>\n</li>\n</ul>\n<h4 id=\"æ–¹æ³•ä¸‰ï¼šå›½å†…æ— æ³•è®¿é—®githubåœ°å€æ—¶å¯ä»¥ä½¿ç”¨å›½å†…é•œåƒæº\">æ–¹æ³•ä¸‰ï¼šå›½å†…æ— æ³•è®¿é—®githubåœ°å€æ—¶å¯ä»¥ä½¿ç”¨å›½å†…é•œåƒæº</h4>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¿™é‡Œä¾æ—§ä»¥æ¸…åå¤§å­¦çš„Homebrewé•œåƒæºä¸ºä¾‹</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">export</span> HOMEBREW_BREW_GIT_REMOTE=<span class=\"string\">&quot;https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/brew.git&quot;</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> HOMEBREW_CORE_GIT_REMOTE=<span class=\"string\">&quot;https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/homebrew-core.git&quot;</span></span><br><span class=\"line\"><span class=\"comment\"># ä»é•œåƒä¸‹è½½å®‰è£…è„šæœ¬å¹¶å®‰è£… Homebrew / Linuxbrew</span></span><br><span class=\"line\">git <span class=\"built_in\">clone</span> --depth=1 https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/install.git brew-install</span><br><span class=\"line\">/bin/bash brew-install/install.sh</span><br><span class=\"line\"><span class=\"built_in\">rm</span> -rf brew-install</span><br></pre></td></tr></table></figure>\n<h4 id=\"éªŒè¯æ˜¯å¦å®‰è£…æˆåŠŸ\">éªŒè¯æ˜¯å¦å®‰è£…æˆåŠŸ</h4>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><code>brew</code> å‘½ä»¤æœ¬èº«åŠé€šè¿‡brewå®‰è£…çš„æ‰€æœ‰å‘½ä»¤éƒ½ä¼šè¢«è½¯é“¾æ¥åˆ°<code>/usr/local/bin/</code>ä¸‹ï¼Œæ‰€ä»¥éœ€è¦å°†è¯¥è·¯å¾„åŠ å…¥ç³»ç»Ÿç¯å¢ƒPATHä¸­</p>\n</li>\n<li class=\"lvl-2\">\n<p>é‡å¯ç»ˆç«¯ï¼Œç„¶åæ‰§è¡Œ<code>brew -v</code>å‘½ä»¤æŸ¥çœ‹brewçš„ç‰ˆæœ¬ï¼Œå¦‚æœå®‰è£…æˆåŠŸï¼Œä¼šè¾“å‡ºç±»ä¼¼å¦‚ä¸‹å†…å®¹</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ brew -v</span><br><span class=\"line\">Homebrew 4.4.8-40-g13c3def</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Homebrewæœ¬èº«çš„å®‰è£…ä½ç½®å¯ä»¥é€šè¿‡<code>brew --repo</code>æŸ¥çœ‹ï¼Œé»˜è®¤ä¸º<code>/usr/local/Homebrew</code></p>\n</li>\n<li class=\"lvl-2\">\n<p>é€šè¿‡brewå®‰è£…çš„è½¯ä»¶åŒ…é»˜è®¤ä¼šè¢«å®‰è£…åˆ°<code>/usr/local/Cellar/</code>ä¸‹ï¼Œæ¯”å¦‚<code>git</code>å®‰è£…åä¼šåœ¨<code>/usr/local/Cellar/git/</code>ç›®å½•ä¸‹ï¼Œå¯ä»¥é€šè¿‡<code>brew info git</code>æŸ¥çœ‹å®‰è£…ä¿¡æ¯ï¼ŒåŒ…æ‹¬ä¾èµ–åº“ç­‰ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æ˜¾ç¤º Homebrew å®‰è£…è·¯å¾„ï¼ŒmacOS ARM: /opt/homebrewï¼ŒmacOS Intel: /usr/local</span></span><br><span class=\"line\">$ brew --prefix</span><br><span class=\"line\">/usr/local</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ˜¾ç¤º Homebrew æœ¬åœ°çš„ Git ä»“åº“</span></span><br><span class=\"line\">$ brew --repo</span><br><span class=\"line\">/usr/local/Homebrew</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ˜¾ç¤º Homebrew Cellar è·¯å¾„ï¼Œå‘½ä»¤è¡Œå·¥å…·çš„å®‰è£…è·¯å¾„</span></span><br><span class=\"line\">$ brew --cellar</span><br><span class=\"line\">/usr/local/Cellar</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ˜¾ç¤º Homebrew Caskroom è·¯å¾„ï¼ŒGUIå·¥å…·çš„å®‰è£…è·¯å¾„</span></span><br><span class=\"line\">$ brew --caskroom</span><br><span class=\"line\">/usr/local/Caskroom</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ç¼“å­˜è·¯å¾„ï¼Œä¸‹è½½å®‰è£…åŒ…çš„ç¼“å­˜è·¯å¾„ï¼Œé€šè¿‡ brew cleanup æ¸…ç†</span></span><br><span class=\"line\">$ brew --cache</span><br><span class=\"line\">~/Library/Caches/Homebrew</span><br></pre></td></tr></table></figure>\n<h4 id=\"é…ç½®å‘½ä»¤è¡¥å…¨\">é…ç½®å‘½ä»¤è¡¥å…¨</h4>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å‚è€ƒå®˜ç½‘<a href=\"https://docs.brew.sh/Shell-Completion\">Homebrew Documentationâ€“brew Shell Completion</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>æˆ‘è¿™é‡Œä½¿ç”¨çš„æ˜¯<code>zsh</code>ï¼Œåœ¨<code>~/.zshrc</code>ä¸­åŠ å…¥å¦‚ä¸‹å†…å®¹å¹¶é‡å¯ç»ˆç«¯å³å¯ç”Ÿæ•ˆ</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">autoload</span> -Uz compinit</span><br><span class=\"line\">compinit</span><br></pre></td></tr></table></figure>\n<h4 id=\"å¸è½½brew\">å¸è½½brew</h4>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/bin/bash -c <span class=\"string\">&quot;<span class=\"subst\">$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/uninstall.sh)</span>&quot;</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"å¸¸ç”¨å‘½ä»¤\">å¸¸ç”¨å‘½ä»¤</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><code>brew</code>æ”¯æŒå®‰è£…<code>å‘½ä»¤è¡Œå·¥å…·(formula)</code>å’Œ<code>GUIå·¥å…·(cask)</code></p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-5\"><code>brew install xxx</code> å®‰è£…å‘½ä»¤è¡Œå·¥å…·ï¼Œè¿™ä¸ªæœ€ä¸ºå¸¸ç”¨ï¼Œæ¯”å¦‚ <code>brew install fd</code></li>\n<li class=\"lvl-5\"><code>brew install --cask xxx</code> å®‰è£…GUIå·¥å…·ï¼Œä¸€èˆ¬å¾ˆå°‘ä½¿ç”¨brewå®‰è£…GUIå·¥å…·ï¼Œæ¯”å¦‚ <code>brew install --cask firefox</code></li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<p>brewçš„å‘½ä»¤å’Œå‚æ•°éå¸¸å¤šï¼Œä½†æ—¥å¸¸ä½¿ç”¨åªéœ€è¦è®°ä½å¸¸ç”¨çš„å‡ ä¸ªå°±å¤Ÿäº†ï¼Œè¯¦ç»†çš„å‘½ä»¤åˆ—è¡¨å¯ä»¥å‚è€ƒ<a href=\"https://docs.brew.sh/Manpage\">Homebrew Documentation</a></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹brewæ”¯æŒå“ªäº›å‘½ä»¤</span></span><br><span class=\"line\">brew commands</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹å‘½ä»¤çš„å¸®åŠ©ä¿¡æ¯ï¼Œæ¯”å¦‚</span></span><br><span class=\"line\">brew install --<span class=\"built_in\">help</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"ä¸€äº›å¸¸ç”¨çš„å‘½ä»¤\">ä¸€äº›å¸¸ç”¨çš„å‘½ä»¤</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">brew update <span class=\"comment\"># æ›´æ–°brewåˆ°æœ€æ–°ç‰ˆæœ¬</span></span><br><span class=\"line\">brew --version <span class=\"comment\"># æŸ¥çœ‹brewçš„ç‰ˆæœ¬ï¼Œå¯ä»¥ç®€å†™ä¸º brew -v</span></span><br><span class=\"line\">brew config <span class=\"comment\"># æŸ¥çœ‹brewçš„é…ç½®ä¿¡æ¯ï¼Œè¿™ä¸ªå‘½ä»¤å¾ˆæœ‰ç”¨ï¼Œå¯ä»¥æŸ¥çœ‹åˆ°ä¸brewç›¸å…³çš„ç¯å¢ƒå˜é‡çš„å€¼</span></span><br><span class=\"line\">brew home <span class=\"comment\"># æµè§ˆå™¨æ‰“å¼€brewå®˜ç½‘</span></span><br><span class=\"line\">brew home xxx <span class=\"comment\"># æµè§ˆå™¨æ‰“å¼€xxxå®˜ç½‘ å¦‚ï¼šæ‰“å¼€fdå‘½ä»¤çš„å®˜ç½‘ brew home fd ,å…·ä½“çš„åç§°å¯ä»¥é€šè¿‡brew listæŸ¥çœ‹</span></span><br><span class=\"line\">brew cleanup <span class=\"comment\"># æ¸…ç†ç¼“å­˜åŠæ—¥å¿—æ–‡ä»¶ï¼Œå»ºè®®å®šæœŸæ¸…ç†ï¼Œå½“è¿è¡Œbrewæ—¶ä¼šè‡ªåŠ¨æ¸…ç†ï¼ˆ2.0ä»¥åçš„ç‰ˆæœ¬ï¼‰</span></span><br><span class=\"line\">brew cleanup -n <span class=\"comment\"># æ˜¾ç¤ºå°†è¦æ¸…ç†çš„ç¼“å­˜åŠæ—¥å¿—æ–‡ä»¶ï¼ŒåªæŸ¥çœ‹ä¸åˆ é™¤</span></span><br><span class=\"line\">brew doctor <span class=\"comment\"># æ£€æŸ¥æ˜¯å¦æœ‰ä¾èµ–é—®é¢˜ï¼Œæ¯”å¦‚æ²¡æœ‰å®‰è£…ä¾èµ–åº“ï¼Œæˆ–è€…ä¾èµ–åº“ç‰ˆæœ¬è¿‡ä½ï¼Œå½“è¿è¡ŒbrewæŠ¥é”™æ—¶å¯ä»¥é€šè¿‡è¯¥å‘½ä»¤è¿›è¡Œæ£€æŸ¥å¹¶æ ¹æ®æç¤ºè¿›è¡Œä¿®æ”¹</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æŸ¥çœ‹å·²å®‰è£…çš„åŒ…</p>\n</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹</span></span><br><span class=\"line\">brew list <span class=\"comment\"># æŸ¥çœ‹å·²å®‰è£…çš„åŒ…</span></span><br><span class=\"line\">brew list --versions <span class=\"comment\"># æŸ¥çœ‹å·²å®‰è£…çš„åŒ…åŠç‰ˆæœ¬</span></span><br><span class=\"line\">brew info xxx <span class=\"comment\"># æŸ¥çœ‹xxxçš„å®‰è£…ä¿¡æ¯</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å®‰è£…ã€å¸è½½</p>\n</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æŸ¥æ‰¾ã€å®‰è£…ã€å¸è½½</span></span><br><span class=\"line\">brew search xxx <span class=\"comment\"># æŸ¥æ‰¾è½¯ä»¶åŒ…ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ https://formulae.brew.sh ç½‘é¡µè¿›è¡Œæœç´¢</span></span><br><span class=\"line\">brew install xxx <span class=\"comment\"># å®‰è£…è½¯ä»¶åŒ…ï¼Œæ­¤å‘½ä»¤ç›¸å½“äºåŠ ä¸Šäº† --formula ï¼Œå®‰è£…æ—¶ä¼šè‡ªåŠ¨ä¸‹è½½ä¾èµ–åº“ï¼Œæ¯”å¦‚å®‰è£…`nginx`æ—¶ï¼Œä¼šè‡ªåŠ¨ä¸‹è½½`openssl@3`å’Œ`pcre2`ç­‰</span></span><br><span class=\"line\">brew install --cask xxx <span class=\"comment\"># å®‰è£…GUIå·¥å…·ï¼Œæ¯”å¦‚`firefox`</span></span><br><span class=\"line\">brew uninstall xxx <span class=\"comment\"># å¸è½½è½¯ä»¶åŒ…ï¼Œæ­¤å‘½ä»¤ç›¸å½“äºåŠ ä¸Šäº† --formula ï¼Œåªä¼šå¸è½½å½“å‰åŒ…ï¼Œä¸ä¼šå¸è½½ä¾èµ–åº“ï¼Œè¿™æ ·å°±æœ‰å¯èƒ½å­˜åœ¨å¾ˆå¤šå†—ä½™åŒ…</span></span><br><span class=\"line\">brew uninstall --cask xxx <span class=\"comment\"># å¸è½½GUIå·¥å…·</span></span><br><span class=\"line\">brew autoremove <span class=\"comment\"># åˆ é™¤æ‰€æœ‰ä»…ä½œä¸ºå¦ä¸€ä¸ªè½¯ä»¶åŒ…çš„ä¾èµ–é¡¹å®‰è£…å¹¶ä¸”ç°åœ¨ä¸å†éœ€è¦çš„åŒ…</span></span><br><span class=\"line\">brew autoremove --dry-run <span class=\"comment\"># --dry-run ä»…æŸ¥çœ‹å“ªäº›åŒ…å¯ä»¥åˆ é™¤ï¼Œå¹¶ä¸ä¼šçœŸçš„åˆ é™¤</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å‡çº§</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å‡çº§</span></span><br><span class=\"line\">brew outdated <span class=\"comment\"># æŸ¥çœ‹éœ€è¦å‡çº§çš„åŒ…</span></span><br><span class=\"line\">brew upgrade xxx <span class=\"comment\"># å‡çº§xxxåˆ°æœ€æ–°ç‰ˆ</span></span><br><span class=\"line\">brew upgrade <span class=\"comment\"># æ›´æ–°å…¨éƒ¨å‘½ä»¤åˆ°æœ€æ–°ç‰ˆ</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¾èµ–å…³ç³»</p>\n</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ä¾èµ–å…³ç³»</span></span><br><span class=\"line\">brew deps --tree xxx <span class=\"comment\"># æ ‘å½¢æ˜¾ç¤ºåŒ…çš„ä¾èµ–æ ‘</span></span><br><span class=\"line\">brew deps --installed --tree <span class=\"comment\"># æ ‘å½¢æ˜¾ç¤ºæ‰€æœ‰å®‰è£…åŒ…çš„ä¾èµ–å…³ç³»</span></span><br><span class=\"line\">brew deps --installed xxx <span class=\"comment\"># æ˜¾ç¤ºå½“å‰å®‰è£…åŒ…çš„ä¾èµ–å…³ç³»ï¼Œçºµå‘å±•ç¤º</span></span><br><span class=\"line\">brew deps --installed --for-each xxx <span class=\"comment\"># æ˜¾ç¤ºå½“å‰å®‰è£…åŒ…çš„ä¾èµ–å…³ç³»ï¼Œæ¨ªå‘å±•ç¤º</span></span><br><span class=\"line\">brew uses --installed xxx <span class=\"comment\"># æŸ¥çœ‹å·²ç»å®‰è£…çš„å“ªäº›å·¥å…·ä¾èµ–å½“å‰åŒ…</span></span><br><span class=\"line\">brew leaves <span class=\"comment\"># æŸ¥çœ‹é¡¶çº§å®‰è£…åŒ…ï¼Œå³ä½ é€šè¿‡brewç›´æ¥å®‰è£…çš„åŒ…ï¼Œè€Œä¸æ˜¯é€šè¿‡å®‰è£…å…¶ä»–è½¯ä»¶åŒ…é—´æ¥å®‰è£…çš„</span></span><br><span class=\"line\">brew leaves | xargs brew deps --installed --for-each --formula <span class=\"comment\"># æŸ¥çœ‹é¡¶çº§åŒ…ï¼Œå¹¶åˆ—å‡ºæ¯ä¸ªé¡¶çº§åŒ…çš„å·²å®‰è£…ä¾èµ–</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä»“åº“ç®¡ç†ï¼Œå‚è€ƒèµ„æ–™<a href=\"https://docs.brew.sh/Taps\">Homebrew Documentationâ€“Taps</a></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ä»“åº“ç®¡ç†</span></span><br><span class=\"line\">brew tap <span class=\"comment\"># æŸ¥çœ‹æ‰€æœ‰å·²å®‰è£…çš„ä»“åº“ï¼Œtapå®‰è£…è·¯å¾„ /usr/local/Homebrew/Library/Taps/</span></span><br><span class=\"line\">brew tap user/repo <span class=\"comment\"># æ·»åŠ ä¸€ä¸ªä»“åº“ï¼Œä»gitthubä¸‹è½½</span></span><br><span class=\"line\">brew tap repo_url <span class=\"comment\"># æ·»åŠ ä¸€ä¸ªä»“åº“ï¼Œä»ç»™å®šçš„ä»“åº“åœ°å€ä¸‹è½½</span></span><br><span class=\"line\">brew untap user/repo <span class=\"comment\"># åˆ é™¤ä¸€ä¸ªä»“åº“</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ä»ç¬¬ä¸‰æ–¹ä»“åº“å®‰è£…å·¥å…·ï¼Œæ­¤æ—¶ä¼šè‡ªåŠ¨å°† homebrew-ffmpeg/ffmpeg è¿™ä¸ªä»“åº“æ·»åŠ åˆ°æœ¬åœ°</span></span><br><span class=\"line\">brew install homebrew-ffmpeg/ffmpeg/ffmpeg</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ›´æ–°ä»“åº“ï¼Œæ— è®ºæ˜¯brewè‡ªå·±çš„ä»“åº“è¿˜æ˜¯ç¬¬ä¸‰æ–¹ä»“åº“ï¼Œéƒ½ä¼šè‡ªåŠ¨æ›´æ–°</span></span><br><span class=\"line\">brew update</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><code>brew services</code>: brewçš„æœåŠ¡ç®¡ç†å·¥å…·ï¼Œå¯ä»¥æ–¹ä¾¿çš„ç®¡ç†é€šè¿‡brewå®‰è£…çš„æœåŠ¡ï¼ŒåŒ…æ‹¬å¯åŠ¨ã€åœæ­¢ã€é‡å¯æœåŠ¡ï¼Œç­‰ç­‰ï¼Œæ¯”å¦‚<code>nginxã€redisã€mysql</code>ç­‰ï¼Œå…·ä½“å‘½ä»¤å¯ä»¥å‚è€ƒ<a href=\"https://docs.brew.sh/Manpage#services-subcommand\">Homebrew Documentation</a></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ç¬¬ä¸€æ¬¡æ‰§è¡Œ services ç›¸å…³çš„å‘½ä»¤æ—¶ä¼šè‡ªåŠ¨ä¸‹è½½ homebrew/servicesï¼Œä¹Ÿå¯ä»¥ é€šè¿‡ brew tap homebrew/services æå‰ä¸‹è½½</span></span><br><span class=\"line\">brew services list <span class=\"comment\"># æŸ¥çœ‹å·²å®‰è£…çš„æ‰€æœ‰æœåŠ¡</span></span><br><span class=\"line\">brew services start nginx <span class=\"comment\"># å¯åŠ¨æœåŠ¡ï¼Œå¹¶æ³¨å†Œåˆ°ç³»ç»Ÿå¯åŠ¨æœåŠ¡åˆ—è¡¨ï¼Œå³åˆ›å»ºç³»ç»Ÿè‡ªå¯åŠ¨æ–‡ä»¶ï¼š ~/Library/LaunchAgents/homebrew.mxcl.nginx.plist</span></span><br><span class=\"line\">brew services stop nginx <span class=\"comment\"># åœæ­¢æœåŠ¡ï¼Œå¹¶ä»ç³»ç»Ÿå¯åŠ¨æœåŠ¡åˆ—è¡¨ä¸­ç§»é™¤ï¼Œå³åˆ é™¤ç³»ç»Ÿè‡ªå¯åŠ¨æ–‡ä»¶</span></span><br><span class=\"line\">brew services <span class=\"built_in\">kill</span> nginx <span class=\"comment\"># ç«‹å³æ€æ­»æœåŠ¡ï¼Œä½†ä¸ä»ç³»ç»Ÿå¯åŠ¨æœåŠ¡åˆ—è¡¨ä¸­ç§»é™¤</span></span><br><span class=\"line\">brew services restart nginx <span class=\"comment\"># é‡å¯æœåŠ¡</span></span><br><span class=\"line\">brew services info nginx <span class=\"comment\"># æŸ¥çœ‹æœåŠ¡çš„çŠ¶æ€å’Œè¿›ç¨‹IP</span></span><br><span class=\"line\">brew services run nginx <span class=\"comment\"># è¿è¡ŒæœåŠ¡ï¼Œä½†ä¸ä¼šä¿å­˜åˆ°æœåŠ¡åˆ—è¡¨ä¸­</span></span><br><span class=\"line\">brew services cleanup <span class=\"comment\"># æ¸…ç†æ— æ•ˆçš„æœåŠ¡ï¼Œå³å·²å¸è½½åº”ç”¨çš„æ— ç”¨çš„é…ç½®</span></span><br><span class=\"line\">brew services --<span class=\"built_in\">help</span> <span class=\"comment\"># æŸ¥çœ‹å¸®åŠ©</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"é…ç½®å›½å†…é•œåƒæº\">é…ç½®å›½å†…é•œåƒæº</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¸Šé¢å®‰è£…éƒ¨åˆ†ä»‹ç»äº†å¦‚ä½•åœ¨å®‰è£…brewæ—¶å°±æŒ‡å®šé•œåƒæºï¼Œä½†æœ‰äº›æ—¶å€™å› ä¸ºæˆ‘ä»¬åœ¨å®‰è£…æ—¶å¿˜è®°é…ç½®ï¼Œæˆ–è€…åŸæ¥çš„é•œåƒæºå·²ç»å¤±æ•ˆéœ€è¦é‡æ–°é…ç½®ï¼Œæ­¤æ—¶å¯ä»¥æŒ‰ç…§ä¸‹é¢çš„æ–¹æ³•è¿›è¡Œé…ç½®ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>æ­¤å¤„ä»¥é…ç½®<a href=\"https://mirrors.tuna.tsinghua.edu.cn/help/homebrew/\">æ¸…åé•œåƒæº</a>ä¸ºä¾‹ï¼Œé˜¿é‡Œé•œåƒæºè¯·å‚è€ƒ<a href=\"https://developer.aliyun.com/mirror/homebrew/\">é˜¿é‡Œçš„å®˜ç½‘æ–‡æ¡£â€“Homebrewé•œåƒ</a>ï¼Œç§‘å¤§æºå‚è€ƒ<a href=\"https://mirrors.ustc.edu.cn/help/brew.git.html\">Homebrew</a></p>\n</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">## ä¸´æ—¶æ›¿æ¢</span></span><br><span class=\"line\"><span class=\"comment\"># é…ç½®brewå›½å†…é•œåƒæº</span></span><br><span class=\"line\">$ <span class=\"built_in\">export</span> HOMEBREW_BREW_GIT_REMOTE=<span class=\"string\">&quot;https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/brew.git&quot;</span></span><br><span class=\"line\"><span class=\"comment\"># é…ç½®brew-coreå›½å†…é•œåƒæº</span></span><br><span class=\"line\">$ <span class=\"built_in\">export</span> HOMEBREW_CORE_GIT_REMOTE=<span class=\"string\">&quot;https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/homebrew-core.git&quot;</span></span><br><span class=\"line\"><span class=\"comment\"># é…ç½®brew-bottleå›½å†…é•œåƒæº</span></span><br><span class=\"line\">$ <span class=\"built_in\">export</span> HOMEBREW_API_DOMAIN=<span class=\"string\">&quot;https://mirrors.tuna.tsinghua.edu.cn/homebrew-bottles/api&quot;</span></span><br><span class=\"line\">$ <span class=\"built_in\">export</span> HOMEBREW_BOTTLE_DOMAIN=<span class=\"string\">&quot;https://mirrors.tuna.tsinghua.edu.cn/homebrew-bottles&quot;</span></span><br><span class=\"line\"><span class=\"comment\"># æ›´æ–°é…ç½®</span></span><br><span class=\"line\">$ brew update</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">## é…ç½®æ°¸ä¹…ç”Ÿæ•ˆï¼Œzshç”¨æˆ·</span></span><br><span class=\"line\"><span class=\"comment\"># é…ç½®brewå›½å†…é•œåƒæº</span></span><br><span class=\"line\">$ <span class=\"built_in\">echo</span> <span class=\"string\">&#x27;export HOMEBREW_BREW_GIT_REMOTE=&quot;https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/brew.git&quot;&#x27;</span> &gt;&gt; ~/.zshrc</span><br><span class=\"line\"><span class=\"comment\"># é…ç½®brew-coreå›½å†…é•œåƒæº</span></span><br><span class=\"line\">$ <span class=\"built_in\">echo</span> <span class=\"string\">&#x27;export HOMEBREW_CORE_GIT_REMOTE=&quot;https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/homebrew-core.git&quot;&#x27;</span> &gt;&gt; ~/.zshrc</span><br><span class=\"line\"><span class=\"comment\"># é…ç½®brew-bottleå›½å†…é•œåƒæº</span></span><br><span class=\"line\">$ <span class=\"built_in\">echo</span> <span class=\"string\">&#x27;export HOMEBREW_API_DOMAIN=&quot;https://mirrors.tuna.tsinghua.edu.cn/homebrew-bottles/api&quot;&#x27;</span> &gt;&gt; ~/.zshrc</span><br><span class=\"line\">$ <span class=\"built_in\">echo</span> <span class=\"string\">&#x27;export HOMEBREW_BOTTLE_DOMAIN=&quot;https://mirrors.tuna.tsinghua.edu.cn/homebrew-bottles&quot;&#x27;</span> &gt;&gt; ~/.zshrc</span><br><span class=\"line\">$ <span class=\"built_in\">source</span> ~/.zshrc</span><br><span class=\"line\"><span class=\"comment\"># æ›´æ–°é…ç½®</span></span><br><span class=\"line\">$ brew update</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ­¤æ—¶æŸ¥çœ‹brewé…ç½®ä¿¡æ¯ï¼Œå¯ä»¥çœ‹åˆ°å·²ç»ç”Ÿæ•ˆäº†</span></span><br><span class=\"line\">$ brew config</span><br><span class=\"line\">HOMEBREW_VERSION: 4.4.8-38-g6089077</span><br><span class=\"line\">ORIGIN: https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/brew.git</span><br><span class=\"line\">HEAD: 60890774e0a70fe93f94973b080068cf7b0d1c93</span><br><span class=\"line\">Last commit: 9 hours ago</span><br><span class=\"line\">Branch: master</span><br><span class=\"line\">Core tap origin: https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/homebrew-core.git</span><br><span class=\"line\">Core tap HEAD: 787d1587bfa92794f7d141063a31773064ef9107</span><br><span class=\"line\">Core tap last commit: 11 minutes ago</span><br><span class=\"line\">Core tap JSON: 29 Nov 09:56 UTC</span><br><span class=\"line\">Core cask tap HEAD: 4c34bd8c418e13160fc79f1ca9312555d2edc254</span><br><span class=\"line\">Core cask tap last commit: 19 minutes ago</span><br><span class=\"line\">Core cask tap JSON: 29 Nov 09:56 UTC</span><br><span class=\"line\">HOMEBREW_PREFIX: /usr/local</span><br><span class=\"line\">HOMEBREW_API_DOMAIN: https://mirrors.tuna.tsinghua.edu.cn/homebrew-bottles/api</span><br><span class=\"line\">HOMEBREW_BOTTLE_DOMAIN: https://mirrors.tuna.tsinghua.edu.cn/homebrew-bottles</span><br><span class=\"line\">HOMEBREW_BREW_GIT_REMOTE: https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/brew.git</span><br><span class=\"line\">HOMEBREW_CASK_OPTS: []</span><br><span class=\"line\">HOMEBREW_CORE_GIT_REMOTE: https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/homebrew-core.git</span><br><span class=\"line\">HOMEBREW_GITHUB_API_TOKEN: <span class=\"built_in\">set</span></span><br><span class=\"line\">HOMEBREW_MAKE_JOBS: 12</span><br><span class=\"line\">HOMEBREW_SORBET_RUNTIME: <span class=\"built_in\">set</span></span><br><span class=\"line\">Homebrew Ruby: 3.3.6 =&gt; /usr/local/Homebrew/Library/Homebrew/vendor/portable-ruby/3.3.6/bin/ruby</span><br><span class=\"line\">CPU: dodeca-core 64-bit kabylake</span><br><span class=\"line\">Clang: 15.0.0 build 1500</span><br><span class=\"line\">Git: 2.43.0 =&gt; /usr/local/bin/git</span><br><span class=\"line\">Curl: 8.7.1 =&gt; /usr/bin/curl</span><br><span class=\"line\">macOS: 13.7.1-x86_64</span><br><span class=\"line\">CLT: 15.0.0.0.1.1694021235</span><br><span class=\"line\">Xcode: N/A</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># é€šè¿‡brewå‡çº§fdï¼Œå¯ä»¥çœ‹åˆ°ä½¿ç”¨äº†æ¸…åæº</span></span><br><span class=\"line\">$ brew upgrade fd</span><br><span class=\"line\">==&gt; Upgrading 1 outdated package:</span><br><span class=\"line\">fd 8.2.1 -&gt; 10.2.0</span><br><span class=\"line\">==&gt; Fetching fd</span><br><span class=\"line\">==&gt; Downloading https://mirrors.tuna.tsinghua.edu.cn/homebrew-bottles/fd-10.2.0.ventura.bottle.tar.gz</span><br><span class=\"line\"><span class=\"comment\">################################################################################################################################################################################### 100.0%</span></span><br><span class=\"line\">==&gt; Verifying attestation <span class=\"keyword\">for</span> fd</span><br><span class=\"line\">==&gt; Upgrading fd</span><br><span class=\"line\">  8.2.1 -&gt; 10.2.0</span><br><span class=\"line\">==&gt; Pouring fd-10.2.0.ventura.bottle.tar.gz</span><br><span class=\"line\">==&gt; Caveats</span><br><span class=\"line\">zsh completions have been installed to:</span><br><span class=\"line\">  /usr/local/share/zsh/site-functions</span><br><span class=\"line\">==&gt; Summary</span><br><span class=\"line\">ğŸº  /usr/local/Cellar/fd/10.2.0: 14 files, 2.9MB</span><br><span class=\"line\">==&gt; Running `brew cleanup fd`...</span><br><span class=\"line\">Disable this behaviour by setting HOMEBREW_NO_INSTALL_CLEANUP.</span><br><span class=\"line\">Hide these hints with HOMEBREW_NO_ENV_HINTS (see `man brew`).</span><br><span class=\"line\">Removing: /usr/local/Cellar/fd/8.2.1... (13 files, 2.4MB)</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ¢å¤ä¸ºé»˜è®¤çš„GitHubé•œåƒæº</p>\n</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ <span class=\"built_in\">unset</span> HOMEBREW_BREW_GIT_REMOTE</span><br><span class=\"line\">$ <span class=\"built_in\">unset</span> HOMEBREW_CORE_GIT_REMOTE</span><br><span class=\"line\">$ <span class=\"built_in\">unset</span> HOMEBREW_API_DOMAIN</span><br><span class=\"line\">$ <span class=\"built_in\">unset</span> HOMEBREW_BOTTLE_DOMAIN</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å¦‚æœæ‚¨ä¹‹å‰æ°¸ä¹…é…ç½®äº† HOMEBREW ç¯å¢ƒå˜é‡ï¼Œè¿˜éœ€è¦åœ¨å¯¹åº”çš„ ~/.bash_profile æˆ–è€… ~/.zshrc é…ç½®æ–‡ä»¶ä¸­ï¼Œå°†å¯¹åº”çš„ HOMEBREW ç¯å¢ƒå˜é‡é…ç½®è¡Œåˆ é™¤</span></span><br><span class=\"line\">$ <span class=\"built_in\">source</span> ~/.zshrc</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ›´æ–°brew</span></span><br><span class=\"line\">$ git -C <span class=\"string\">&quot;<span class=\"subst\">$(brew --repo)</span>&quot;</span> remote set-url origin https://github.com/Homebrew/brew</span><br><span class=\"line\"><span class=\"comment\"># æ›´æ–°brew-coreï¼Œbrew4.0åä¸ä¼šå†ä¸‹è½½brew-coreï¼Œæ‰€ä»¥å¯ä»¥å¿½ç•¥</span></span><br><span class=\"line\"><span class=\"comment\"># ä¸è¿‡ä»ä½ç‰ˆæœ¬å‡çº§ä¸Šæ¥çš„è¿˜ä¼šæœ‰è¿™ä¸ªä»“åº“ï¼Œå¯ä»¥é€šè¿‡ brew tap æŸ¥çœ‹æ˜¯å¦å­˜åœ¨ï¼Œå®é™…ä¸Šæ”¹ä¸æ”¹éƒ½ä¸ä¼šæœ‰å½±å“ï¼Œçœ‹ç€ä¸èˆ’æœå°±ä¿®æ”¹å§</span></span><br><span class=\"line\">$ git -C <span class=\"string\">&quot;<span class=\"subst\">$(brew --repo homebrew/core)</span>&quot;</span> remote set-url origin https://github.com/Homebrew/homebrew-core</span><br><span class=\"line\">$ brew update</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹brewé…ç½®ä¿¡æ¯</span></span><br><span class=\"line\">$ brew config</span><br><span class=\"line\">HOMEBREW_VERSION: 4.4.8-38-g6089077</span><br><span class=\"line\">ORIGIN: https://github.com/Homebrew/brew</span><br><span class=\"line\">HEAD: 60890774e0a70fe93f94973b080068cf7b0d1c93</span><br><span class=\"line\">Last commit: 9 hours ago</span><br><span class=\"line\">Branch: master</span><br><span class=\"line\">Core tap HEAD: 787d1587bfa92794f7d141063a31773064ef9107</span><br><span class=\"line\">Core tap last commit: 13 minutes ago</span><br><span class=\"line\">Core tap JSON: 29 Nov 10:09 UTC</span><br><span class=\"line\">Core cask tap HEAD: 871fe2e8b93aac896a1808571ff11f8b89e6d90e</span><br><span class=\"line\">Core cask tap last commit: 48 seconds ago</span><br><span class=\"line\">Core cask tap JSON: 29 Nov 10:09 UTC</span><br><span class=\"line\">HOMEBREW_PREFIX: /usr/local</span><br><span class=\"line\">HOMEBREW_CASK_OPTS: []</span><br><span class=\"line\">HOMEBREW_GITHUB_API_TOKEN: <span class=\"built_in\">set</span></span><br><span class=\"line\">HOMEBREW_MAKE_JOBS: 12</span><br><span class=\"line\">HOMEBREW_SORBET_RUNTIME: <span class=\"built_in\">set</span></span><br><span class=\"line\">Homebrew Ruby: 3.3.6 =&gt; /usr/local/Homebrew/Library/Homebrew/vendor/portable-ruby/3.3.6/bin/ruby</span><br><span class=\"line\">CPU: dodeca-core 64-bit kabylake</span><br><span class=\"line\">Clang: 15.0.0 build 1500</span><br><span class=\"line\">Git: 2.43.0 =&gt; /usr/local/bin/git</span><br><span class=\"line\">Curl: 8.7.1 =&gt; /usr/bin/curl</span><br><span class=\"line\">macOS: 13.7.1-x86_64</span><br><span class=\"line\">CLT: 15.0.0.0.1.1694021235</span><br><span class=\"line\">Xcode: N/A</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># é€šè¿‡brewå‡çº§telnetï¼Œå¯ä»¥çœ‹åˆ°ä½¿ç”¨äº†GitHubæº</span></span><br><span class=\"line\">$ brew upgrade telnet</span><br><span class=\"line\">==&gt; Upgrading 1 outdated package:</span><br><span class=\"line\">telnet 294 -&gt; 303.141.1</span><br><span class=\"line\">==&gt; Downloading https://ghcr.io/v2/homebrew/core/telnet/manifests/303.141.1</span><br><span class=\"line\"><span class=\"comment\">################################################################################################################################################################################### 100.0%</span></span><br><span class=\"line\">==&gt; Fetching telnet</span><br><span class=\"line\">==&gt; Downloading https://ghcr.io/v2/homebrew/core/telnet/blobs/sha256:1be6b7b6a17a311fb3a2f1bffe7dae52284f3239b8af03f651c4fac11362f702</span><br><span class=\"line\"><span class=\"comment\">################################################################################################################################################################################### 100.0%</span></span><br><span class=\"line\">==&gt; Verifying attestation <span class=\"keyword\">for</span> telnet</span><br><span class=\"line\">==&gt; Upgrading telnet</span><br><span class=\"line\">  294 -&gt; 303.141.1</span><br><span class=\"line\">==&gt; Pouring telnet--303.141.1.ventura.bottle.tar.gz</span><br><span class=\"line\">ğŸº  /usr/local/Cellar/telnet/303.141.1: 5 files, 207.5KB</span><br><span class=\"line\">==&gt; Running `brew cleanup telnet`...</span><br><span class=\"line\">Disable this behaviour by setting HOMEBREW_NO_INSTALL_CLEANUP.</span><br><span class=\"line\">Hide these hints with HOMEBREW_NO_ENV_HINTS (see `man brew`).</span><br><span class=\"line\">Removing: /usr/local/Cellar/telnet/294... (4 files, 208.2KB)</span><br></pre></td></tr></table></figure>\n<h2 id=\"é‡è¦çš„è¯´æ˜\">é‡è¦çš„è¯´æ˜</h2>\n<h3 id=\"ç¯å¢ƒå˜é‡\">ç¯å¢ƒå˜é‡</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>brewå®‰è£…çš„è½¯ä»¶åŒ…ä¼šè¢«è½¯è¿æ¥åˆ°<code>/usr/local/bin/</code>ä¸‹ï¼Œæ‰€ä»¥éœ€è¦å°†è¯¥è·¯å¾„åŠ å…¥ç³»ç»Ÿç¯å¢ƒPATHä¸­</p>\n</li>\n<li class=\"lvl-2\">\n<p>è¿™é‡Œè¦æ³¨æ„ä¸€ç‚¹ï¼Œå¦‚æœè¯¥è·¯å¾„åœ¨PATHä¸­å£°æ˜çš„æ¯”è¾ƒé å‰ï¼Œå°±å¯èƒ½ä¼šè¢«ä¼˜å…ˆä½¿ç”¨ï¼Œæ¯”å¦‚æˆ‘ä»¬å·²ç»æ‰‹å·¥åœ¨ç³»ç»Ÿä¸­å®‰è£…äº†<code>python</code>çš„æŸä¸ªç‰ˆæœ¬ï¼Œä½†é€šè¿‡brewå®‰è£…æŸäº›è½¯ä»¶åŒ…æ—¶å› ä¸ºå…¶ä¾èµ–pythonï¼Œå°±ä¼šé€šè¿‡brewåŒæ—¶å®‰è£…å¯¹åº”çš„pythonç‰ˆæœ¬ï¼Œæ­¤æ—¶æˆ‘ä»¬åœ¨ä½¿ç”¨pythonå‘½ä»¤æ—¶ï¼Œå°±ä¼šä¼˜å…ˆä½¿ç”¨è¿™ä¸ª</p>\n</li>\n<li class=\"lvl-2\">\n<p>æœ‰ä¸¤ç§æ–¹æ³•å¯ä»¥è§£å†³ï¼Œ1æ˜¯é€šè¿‡<code>brew unlink python</code>æ¥è§£é™¤é“¾æ¥ï¼Œæ­¤æ—¶å¹¶ä¸æ˜¯åˆ é™¤ï¼Œè€Œåªæ˜¯è§£é™¤äº†è½¯é“¾ï¼Œä¸ä¼šå½±å“ä¾èµ–å®ƒçš„å·¥å…·çš„ä½¿ç”¨ï¼Œå¦‚æœéœ€è¦æ¢å¤é“¾æ¥ï¼Œå¯ä»¥é€šè¿‡<code>brew link python</code>æ¥æ¢å¤é“¾æ¥ï¼›2æ˜¯å°†æˆ‘ä»¬çš„ç³»ç»Ÿä¸­è‡ªå·±å®‰è£…çš„ä¸€äº›å·¥å…·çš„è·¯å¾„å£°æ˜åœ¨<code>/usr/local/bin/</code>ä¹‹å‰ï¼Œè¿™æ ·å°±ä¸ä¼šæœ‰å½±å“äº†ã€‚</p>\n</li>\n</ul>\n<h3 id=\"Homebrew-4-0-å¸¦æ¥çš„æ–°å˜åŒ–\">Homebrew 4.0 å¸¦æ¥çš„æ–°å˜åŒ–</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Homebrew 4.0 è¿›è¡Œäº†ä¸€é¡¹æœ€å¤§çš„æ”¹åŠ¨ï¼Œç»„ç»‡æ–¹å¼ä»Gitä»“åº“ç®¡ç†æ”¹ä¸º<a href=\"https://formulae.brew.sh/api/formula.jws.json\">JSONæ–‡ä»¶</a>ä¸‹è½½ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>JSONæ–‡ä»¶ä¼šä»<a href=\"https://formulae.brew.sh\">formulae.brew.sh</a>ä¸‹è½½ï¼Œè€Œä¸å†ä½¿ç”¨<code>homebrew/core</code>ã€<code>homebrew/cask</code>ä¸¤ä¸ªä»“åº“ï¼Œæ‰€ä»¥å‡çº§åˆ°4.0åï¼Œæœ¬åœ°çš„<code>homebrew/core</code>ã€<code>homebrew/cask</code> ä»“åº“éƒ½å¯ä»¥åˆ é™¤ä»¥é‡Šæ”¾ç£ç›˜ç©ºé—´ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹æœ¬åœ°ä»“åº“</span></span><br><span class=\"line\">$ brew tap</span><br><span class=\"line\">homebrew/cask <span class=\"comment\"># cask ä»“åº“ï¼ŒGUIçš„å·¥å…·ä¼šä»æ­¤ä¸‹è½½ï¼Œbrew4.0åä¸å†ä½¿ç”¨</span></span><br><span class=\"line\">homebrew/core <span class=\"comment\"># core ä»“åº“ï¼Œå³ formula ä»“åº“ï¼Œå‘½ä»¤è¡Œå·¥å…·ä¼šä»æ­¤ä¸‹è½½ï¼Œbrew4.0åä¸å†ä½¿ç”¨</span></span><br><span class=\"line\">homebrew/services <span class=\"comment\"># services ä»“åº“ï¼Œservices å·¥å…·æœ¬èº«ä¼šä»æ­¤ä¸‹è½½ï¼Œbrew4.0åä¾æ—§ä½¿ç”¨</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åˆ é™¤æœ¬åœ°ä»“åº“</span></span><br><span class=\"line\">$ brew untap homebrew/core</span><br><span class=\"line\">$ brew untap homebrew/cask</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ­¤æ—¶å†æ¬¡æ‰§è¡Œ brew outdated ç­‰å‘½ä»¤æ—¶ï¼Œä¼šçœ‹åˆ°jsonæ–‡ä»¶è¢«ä¸‹è½½äº†ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œè¯¥jsonæ–‡ä»¶é—´éš”24å°æ—¶æ›´æ–°ä¸€æ¬¡</span></span><br><span class=\"line\">$ brew outdated</span><br><span class=\"line\">==&gt; Downloading https://formulae.brew.sh/api/formula.jws.json</span><br><span class=\"line\"><span class=\"comment\">##################################################################################### 100.0%</span></span><br><span class=\"line\">==&gt; Downloading https://formulae.brew.sh/api/cask.jws.json</span><br><span class=\"line\"><span class=\"comment\">##################################################################################### 100.0%</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¦‚æœè¿˜æƒ³ä½¿ç”¨æ—§çš„ä»“åº“æ¨¡å¼ï¼Œåªè¦é…ç½®ä¸‹ç¯å¢ƒå˜é‡</p>\n</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&#x27;export HOMEBREW_NO_INSTALL_FROM_API=1&#x27;</span> &gt;&gt; ~/.zshrc</span><br></pre></td></tr></table></figure>\n<h3 id=\"ä»é•œåƒæºçš„åˆ‡æ¢æ¥ç†è§£brewä¸‹è½½å®‰è£…åŒ…çš„è¿‡ç¨‹\">ä»é•œåƒæºçš„åˆ‡æ¢æ¥ç†è§£brewä¸‹è½½å®‰è£…åŒ…çš„è¿‡ç¨‹</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å‰é¢æˆ‘ä»¬ä»‹ç»è¿‡ï¼Œåˆ‡æ¢é•œåƒæºæ—¶è¦è®¾ç½®4ä¸ªç¯å¢ƒå˜é‡ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆè¦è®¾ç½®è¿™å‡ ä¸ªå˜é‡å‘¢ï¼Ÿå®ƒä»¬çš„ä½œç”¨æ˜¯ä»€ä¹ˆå‘¢ï¼Œä¸‹é¢æˆ‘å°±ä¸€ä¸ªä¸€ä¸ªè¯´æ˜ï¼š</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">\n<p>HOMEBREW_BREW_GIT_REMOTE</p>\n<ul class=\"lvl-4\">\n<li class=\"lvl-6\">è®¾ç½®brewä»“åº“ï¼Œç”¨äºæ›´æ–°brewå‘½ä»¤æœ¬èº«ï¼Œè¿™ä¸ªæ¯”è¾ƒå®¹æ˜“ç†è§£</li>\n</ul>\n</li>\n<li class=\"lvl-4\">\n<p>HOMEBREW_CORE_GIT_REMOTE</p>\n<ul class=\"lvl-4\">\n<li class=\"lvl-6\">è®¾ç½®coreä»“åº“ï¼Œç”¨äºæ›´æ–°formulaçš„å®‰è£…è„šæœ¬</li>\n<li class=\"lvl-6\">å½“é€šè¿‡<code>brew info xxx</code>æŸ¥çœ‹å®‰è£…åŒ…ä¿¡æ¯æ—¶ï¼Œå¯ä»¥çœ‹åˆ°<code>From</code>ä¿¡æ¯ï¼Œè¿™ä¸ªå°±æ˜¯å‘½ä»¤çš„å®‰è£…è„šæœ¬ï¼Œæ¯”å¦‚ä¸‹é¢çš„<code>fd.rb</code></li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ brew info fd</span><br><span class=\"line\">==&gt; fd: stable 10.2.0 (bottled), HEAD</span><br><span class=\"line\">Simple, fast and user-friendly alternative to find</span><br><span class=\"line\">https://github.com/sharkdp/fd</span><br><span class=\"line\">Conflicts with:</span><br><span class=\"line\">  fdclone (because both install `fd` binaries)</span><br><span class=\"line\">Installed</span><br><span class=\"line\">/usr/local/Cellar/fd/10.2.0 (14 files, 2.9MB) *</span><br><span class=\"line\">  Poured from bottle using the formulae.brew.sh API on 2024-11-29 at 18:02:16</span><br><span class=\"line\">From: https://github.com/Homebrew/homebrew-core/blob/HEAD/Formula/f/fd.rb</span><br><span class=\"line\">License: Apache-2.0 OR MIT</span><br><span class=\"line\">==&gt; Dependencies</span><br><span class=\"line\">Build: rust âœ˜</span><br><span class=\"line\">==&gt; Options</span><br><span class=\"line\">--HEAD</span><br><span class=\"line\">  Install HEAD version</span><br><span class=\"line\">==&gt; Caveats</span><br><span class=\"line\">zsh completions have been installed to:</span><br><span class=\"line\">  /usr/local/share/zsh/site-functions</span><br><span class=\"line\">==&gt; Analytics</span><br><span class=\"line\">install: 6,327 (30 days), 24,518 (90 days), 116,476 (365 days)</span><br><span class=\"line\">install-on-request: 6,326 (30 days), 24,515 (90 days), 116,363 (365 days)</span><br><span class=\"line\">build-error: 0 (30 days)</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-4\">\n<li class=\"lvl-6\">è¿™ä¸ªå®‰è£…è„šæœ¬ä¸­åŒ…å«<code>bottle do</code>éƒ¨åˆ†ï¼Œå…¶ä½œç”¨æ˜¯å½“å®‰è£…è„šæœ¬æ—¶ï¼Œä¼˜å…ˆä»è¯¥éƒ¨åˆ†è·å–å¯¹åº”çš„æ“ä½œç³»ç»Ÿçš„äºŒè¿›åˆ¶é¢„ç¼–è¯‘åŒ…çš„sha256æ ¡éªŒå€¼ï¼Œå¦‚æœä»å¯¹åº”çš„äºŒè¿›åˆ¶æºä¸­æ‰¾åˆ°ï¼Œåˆ™ç›´æ¥ä»äºŒè¿›åˆ¶é¢„ç¼–è¯‘åŒ…çš„åœ°å€è¿›è¡Œä¸‹è½½ï¼Œè¯¥é¢„ç¼–è¯‘ä¸‹è½½åœ°å€ç”±<code>HOMEBREW_BOTTLE_DOMAIN</code>æŒ‡å®šï¼Œé»˜è®¤ä»å®˜æ–¹æºä¸‹è½½ã€‚</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">class Fd &lt; Formula</span><br><span class=\"line\">  desc <span class=\"string\">&quot;Simple, fast and user-friendly alternative to find&quot;</span></span><br><span class=\"line\">  homepage <span class=\"string\">&quot;https://github.com/sharkdp/fd&quot;</span></span><br><span class=\"line\">  url <span class=\"string\">&quot;https://github.com/sharkdp/fd/archive/refs/tags/v10.2.0.tar.gz&quot;</span></span><br><span class=\"line\">  sha256 <span class=\"string\">&quot;73329fe24c53f0ca47cd0939256ca5c4644742cb7c14cf4114c8c9871336d342&quot;</span></span><br><span class=\"line\">  license any_of: [<span class=\"string\">&quot;Apache-2.0&quot;</span>, <span class=\"string\">&quot;MIT&quot;</span>]</span><br><span class=\"line\">  <span class=\"built_in\">head</span> <span class=\"string\">&quot;https://github.com/sharkdp/fd.git&quot;</span>, branch: <span class=\"string\">&quot;master&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">  bottle <span class=\"keyword\">do</span></span><br><span class=\"line\">    sha256 cellar: :any_skip_relocation, arm64_sequoia:  <span class=\"string\">&quot;9d17cfb029fbdc6ed31c732108f7aa746d3082dd4783ed35471ef79340615509&quot;</span></span><br><span class=\"line\">    sha256 cellar: :any_skip_relocation, arm64_sonoma:   <span class=\"string\">&quot;82d5c2ffc2e2d0d8643a7c3f620c81ed49d7b23920aa23b6a7f4c50be69abc0b&quot;</span></span><br><span class=\"line\">    sha256 cellar: :any_skip_relocation, arm64_ventura:  <span class=\"string\">&quot;354412ababb7d6c52abd9153ff96f133391406ce292b2122c76b96c2ab714f87&quot;</span></span><br><span class=\"line\">    sha256 cellar: :any_skip_relocation, arm64_monterey: <span class=\"string\">&quot;0b41f292041767fd1c3c5b92daaa6c823fb07c1d7cd11b0427a415f08463f035&quot;</span></span><br><span class=\"line\">    sha256 cellar: :any_skip_relocation, sonoma:         <span class=\"string\">&quot;4fa0fb4b3f512e45d35c569953efc7c59ebd8976caac9b2c1b1394b7e29157a0&quot;</span></span><br><span class=\"line\">    sha256 cellar: :any_skip_relocation, ventura:        <span class=\"string\">&quot;b1406e5414252b1e1b90cfad188454eb31058256ed6246baed48c4e1cfe593a1&quot;</span></span><br><span class=\"line\">    sha256 cellar: :any_skip_relocation, monterey:       <span class=\"string\">&quot;0ac060bf7d1529aa1f65e634f64b98b906df533d71f2185c883165c01f59ad53&quot;</span></span><br><span class=\"line\">    sha256 cellar: :any_skip_relocation, x86_64_linux:   <span class=\"string\">&quot;2464fb21cc981166ffa9783fa14a09265790af4d89ce3a763421ddaf29119541&quot;</span></span><br><span class=\"line\">  end</span><br><span class=\"line\"></span><br><span class=\"line\">  depends_on <span class=\"string\">&quot;rust&quot;</span> =&gt; :build</span><br><span class=\"line\"></span><br><span class=\"line\">  conflicts_with <span class=\"string\">&quot;fdclone&quot;</span>, because: <span class=\"string\">&quot;both install `fd` binaries&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">  def install</span><br><span class=\"line\">    system <span class=\"string\">&quot;cargo&quot;</span>, <span class=\"string\">&quot;install&quot;</span>, *std_cargo_args</span><br><span class=\"line\">    man1.install <span class=\"string\">&quot;doc/fd.1&quot;</span></span><br><span class=\"line\">    generate_completions_from_executable(bin/<span class=\"string\">&quot;fd&quot;</span>, <span class=\"string\">&quot;--gen-completions&quot;</span>, shells: [:bash, :fish])</span><br><span class=\"line\">    zsh_completion.install <span class=\"string\">&quot;contrib/completion/_fd&quot;</span></span><br><span class=\"line\">    <span class=\"comment\"># Bash completions are not compatible with Bash 3 so don&#x27;t use v1 directory.</span></span><br><span class=\"line\">    <span class=\"comment\"># bash: complete: nosort: invalid option name</span></span><br><span class=\"line\">    <span class=\"comment\"># Issue ref: https://github.com/clap-rs/clap/issues/5190</span></span><br><span class=\"line\">    (share/<span class=\"string\">&quot;bash-completion/completions&quot;</span>).install bash_completion.children</span><br><span class=\"line\">  end</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"built_in\">test</span> <span class=\"keyword\">do</span></span><br><span class=\"line\">    <span class=\"built_in\">touch</span> <span class=\"string\">&quot;foo_file&quot;</span></span><br><span class=\"line\">    <span class=\"built_in\">touch</span> <span class=\"string\">&quot;test_file&quot;</span></span><br><span class=\"line\">    assert_equal <span class=\"string\">&quot;test_file&quot;</span>, shell_output(<span class=\"string\">&quot;#&#123;bin&#125;/fd test&quot;</span>).chomp</span><br><span class=\"line\">  end</span><br><span class=\"line\">end</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-4\">\n<li class=\"lvl-6\">æ³¨æ„ï¼Œbrew4.0åä¸å†ä½¿ç”¨ä»è¯¥gitä»“åº“ä¸­è·å–å®‰è£…è„šæœ¬ï¼Œå› ä¸ºformulaçš„å®‰è£…æºä»£ç å·²ç»å…¨éƒ¨å­˜å‚¨åœ¨jsonæ–‡ä»¶ä¸­(è§<code>HOMEBREW_API_DOMAIN</code>è¯´æ˜)ï¼Œä¸å†éœ€è¦é€šè¿‡Gitä»“åº“ä¸‹è½½</li>\n<li class=\"lvl-6\">åˆ‡æ¢é•œåƒæºæ—¶ï¼Œbrew4.0åä¸éœ€è¦è®¾ç½®è¯¥ç¯å¢ƒå˜é‡</li>\n</ul>\n</li>\n<li class=\"lvl-4\">\n<p>HOMEBREW_API_DOMAIN</p>\n<ul class=\"lvl-4\">\n<li class=\"lvl-6\">è®¾ç½®<code>formula\\cask</code>çš„å®‰è£…è„šæœ¬ä¸‹è½½æºï¼Œé»˜è®¤<a href=\"https://formulae.brew.sh\">https://formulae.brew.sh</a></li>\n<li class=\"lvl-6\">brew4.0åä¸å†ä»gitä»“åº“è·å–å®‰è£…è„šæœ¬ï¼Œè€Œæ˜¯ä»è¿™ä¸ªjsonæ–‡ä»¶ä¸­ä¸€æ¬¡æ€§è·å–æ‰€æœ‰å·¥å…·çš„å®‰è£…è„šæœ¬ï¼Œé»˜è®¤24å°æ—¶æ›´æ–°ä¸€æ¬¡</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">å®˜æ–¹æºï¼š</span><br><span class=\"line\">  formulaæºï¼šhttps://formulae.brew.sh/api/formula.jws.json</span><br><span class=\"line\">  caskæºï¼šhttps://formulae.brew.sh/api/cask.jws.json</span><br><span class=\"line\"></span><br><span class=\"line\">æ¸…åæºï¼š</span><br><span class=\"line\">  formulaæºï¼šhttps://mirrors.tuna.tsinghua.edu.cn/homebrew-bottles/api/formula.jws.json</span><br><span class=\"line\">  caskæºï¼šhttps://mirrors.tuna.tsinghua.edu.cn/homebrew-bottles/api/cask.jws.json</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-4\">\n<li class=\"lvl-6\">å¦‚æœè¿˜æƒ³ä½¿ç”¨æ—§çš„ä»“åº“æ¨¡å¼ï¼Œåªè¦é…ç½®ä¸‹ç¯å¢ƒå˜é‡ï¼Œè¿™æ ·å³ä½¿ä½ å‡çº§åå·²ç»åˆ é™¤äº†å¯¹åº”çš„ä»“åº“ï¼Œå®ƒä¹Ÿä¼šåœ¨ç¬¬ä¸€æ¬¡ä½¿ç”¨åˆ°æ—¶è‡ªåŠ¨ä¸‹è½½</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å®˜æ–¹ä¹Ÿæåˆ°ï¼Œéå¼€å‘äººå‘˜æ²¡å¿…è¦è¿™æ ·åš</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&#x27;export HOMEBREW_NO_INSTALL_FROM_API=1&#x27;</span> &gt;&gt; ~/.zshrc</span><br></pre></td></tr></table></figure>\n</li>\n<li class=\"lvl-4\">\n<p>HOMEBREW_BOTTLE_DOMAIN</p>\n<ul class=\"lvl-4\">\n<li class=\"lvl-6\">æŒ‡å®šé¢„ç¼–è¯‘äºŒè¿›åˆ¶åŒ…ï¼ˆä¹Ÿç§°ä¸º bottlesï¼‰çš„ä¸‹è½½åœ°å€ï¼ŒHomebrew ä½¿ç”¨è¿™äº› bottles æ¥åŠ é€Ÿè½¯ä»¶å®‰è£…è¿‡ç¨‹ï¼Œé¿å…åœ¨æ¯ä¸ªç”¨æˆ·çš„è®¡ç®—æœºä¸Šéƒ½é‡æ–°ä»æºä»£ç æ„å»ºè½¯ä»¶ã€‚</li>\n<li class=\"lvl-6\">å½“æˆ‘ä»¬é€šè¿‡<code>brew install xxx</code>å®‰è£…è½¯ä»¶æ—¶ï¼Œbrewä¼šå…ˆä»è¯¥formulaçš„å®‰è£…è„šæœ¬ï¼ˆ4.0ä»¥å‰ä»HOMEBREW_CORE_GIT_REMOTEæŒ‡å®šçš„gitä»“åº“è·å–ï¼Œ4.0ä»¥åä»HOMEBREW_API_DOMAINæŒ‡å®šçš„jsonæ–‡ä»¶ä¸­è·å–ï¼‰ä¸­è·å–è¯¥è½¯ä»¶çš„å®‰è£…ä¿¡æ¯ï¼Œç„¶åæ ¹æ®å®‰è£…ä¿¡æ¯ä»bottleä¸­ä¸‹è½½å¯¹åº”çš„é¢„ç¼–è¯‘äºŒè¿›åˆ¶åŒ…ï¼Œå†å°†å…¶å®‰è£…åˆ°æœ¬åœ°ã€‚</li>\n<li class=\"lvl-6\">ä¸‹è½½åçš„äºŒè¿›åˆ¶åŒ…ä¼šè¢«ä¿å­˜åˆ°ç¼“å­˜ç›®å½•ä¸­(<code>brew --cache</code>)ï¼Œå®‰è£…åçš„è½¯ä»¶åŒ…å­˜å‚¨åˆ°Cellarç›®å½•ä¸­(<code>brew --cellar</code>)</li>\n</ul>\n</li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<p>é€šè¿‡ä¸Šé¢çš„åˆ†æï¼Œæˆ‘ä»¬å¯ä»¥å¾—å‡ºç»“è®ºï¼Œåˆ‡æ¢é•œåƒæºæ—¶ï¼Œå®é™…ä¸Šåªéœ€è¦è®¾ç½®3ä¸ªå˜é‡å°±å¤Ÿäº†</p>\n</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">HOMEBREW_BREW_GIT_REMOTE</span><br><span class=\"line\">HOMEBREW_API_DOMAIN</span><br><span class=\"line\">HOMEBREW_BOTTLE_DOMAIN</span><br></pre></td></tr></table></figure>\n","content_text":"æ‘˜è¦ brewæ˜¯ä¸€ä¸ªè½¯ä»¶åŒ…ç®¡ç†å™¨ï¼ŒåŒæ—¶æ”¯æŒMacOSå’ŒLinuxï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿åœ°å®‰è£…å„ç§è½¯ä»¶ï¼Œæ¯”å¦‚gitã€nodeã€pythonç­‰ã€‚ brewè™½ç„¶æ”¯æŒlinuxï¼Œä½†æ˜¯å®é™…ä½¿ç”¨ä¸­å¾ˆå°‘ä¼šä½¿ç”¨brewæ¥ç®¡ç†linuxçš„è½¯ä»¶åŒ…ã€‚ æœ¬æ–‡ä»‹ç»å¦‚ä½•åœ¨macosä¸‹å®‰è£…brewï¼Œä»¥åŠå¦‚ä½•ä½¿ç”¨brewç®¡ç†å„ç§è½¯ä»¶åŒ…ã€‚ æœ¬æ–‡åŸºäº MacOS Intel Ventura 13.7.1ï¼Œbrew ç‰ˆæœ¬ä¸º4.4.8ã€‚ å®‰è£… é¦–å…ˆè¦ç¡®ä¿ç³»ç»Ÿä¸­å®‰è£…äº† git å’Œ curlï¼Œå¯¹äº macOS ç”¨æˆ·æ¥è¯´ï¼Œè¿™äº›ç³»ç»Ÿéƒ½è‡ªå¸¦äº†ï¼Œå”¯ä¸€éœ€é¢å¤–è¦æ±‚å®‰è£…çš„æ˜¯Command Line Tools (CLT) for Xcodeã€‚ 12345678# æ£€æŸ¥ç³»ç»Ÿä¸­æ˜¯å¦å®‰è£…äº† Command Line Tools (CLT) for Xcodexcode-select --version # èƒ½å¤Ÿè¾“å‡ºç‰ˆæœ¬å·è¯´æ˜å®‰è£…äº†ï¼Œå¦åˆ™éœ€è¦å®‰è£…ã€‚# å®‰è£… Command Line Tools (CLT) for Xcodexcode-select --install# æ‰“å°å½“å‰çš„ Command Line Tools (CLT) for Xcode çš„å®‰è£…è·¯å¾„xcode-select -p # /Library/Developer/CommandLineTools åœ¨MacOSä¸Šå®‰è£…brewçš„æ–¹æ³• å‚è€ƒèµ„æ–™ æ–¹æ³•ä¸€ï¼šä½¿ç”¨è„šæœ¬å®‰è£… 1/bin/bash -c &quot;$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)&quot; å®‰è£…æ—¶å¯ä»¥æŒ‡å®šé•œåƒä¸‹è½½æºï¼Œé»˜è®¤æ˜¯Homebrewçš„GitHubä¸‹è½½æºï¼Œä¹Ÿå¯ä»¥é€‰æ‹©å›½å†…çš„é•œåƒæºï¼Œæ¯”å¦‚ä½¿ç”¨æ¸…åå¤§å­¦çš„Homebrewé•œåƒæº 1234567# æ§åˆ¶äº† Homebrew åœ¨å®‰è£…è½¯ä»¶åŒ…æ—¶æ˜¯å¦ä» Homebrew çš„ API æœåŠ¡å™¨è·å–ä¿¡æ¯ï¼Œbrew4.0åæ˜¯é»˜è®¤è¡Œä¸ºï¼Œæ— éœ€è®¾ç½®export HOMEBREW_INSTALL_FROM_API=1# è®¾ç½®brewä»“åº“ä¸Šæ¸¸export HOMEBREW_BREW_GIT_REMOTE=&quot;https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/brew.git&quot;# è®¾ç½®homebrewæ ¸å¿ƒä¸Šæ¸¸export HOMEBREW_CORE_GIT_REMOTE=&quot;https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/homebrew-core.git&quot;/bin/bash -c &quot;$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)&quot; æ–¹æ³•äºŒï¼šä½¿ç”¨PKGæ–‡ä»¶å®‰è£… ä»Homebrewçš„githubä¸Šä¸‹è½½æœ€æ–°ç‰ˆçš„Homebrew-x.x.x.pkg æ–¹æ³•ä¸‰ï¼šå›½å†…æ— æ³•è®¿é—®githubåœ°å€æ—¶å¯ä»¥ä½¿ç”¨å›½å†…é•œåƒæº è¿™é‡Œä¾æ—§ä»¥æ¸…åå¤§å­¦çš„Homebrewé•œåƒæºä¸ºä¾‹ 123456export HOMEBREW_BREW_GIT_REMOTE=&quot;https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/brew.git&quot;export HOMEBREW_CORE_GIT_REMOTE=&quot;https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/homebrew-core.git&quot;# ä»é•œåƒä¸‹è½½å®‰è£…è„šæœ¬å¹¶å®‰è£… Homebrew / Linuxbrewgit clone --depth=1 https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/install.git brew-install/bin/bash brew-install/install.shrm -rf brew-install éªŒè¯æ˜¯å¦å®‰è£…æˆåŠŸ brew å‘½ä»¤æœ¬èº«åŠé€šè¿‡brewå®‰è£…çš„æ‰€æœ‰å‘½ä»¤éƒ½ä¼šè¢«è½¯é“¾æ¥åˆ°/usr/local/bin/ä¸‹ï¼Œæ‰€ä»¥éœ€è¦å°†è¯¥è·¯å¾„åŠ å…¥ç³»ç»Ÿç¯å¢ƒPATHä¸­ é‡å¯ç»ˆç«¯ï¼Œç„¶åæ‰§è¡Œbrew -vå‘½ä»¤æŸ¥çœ‹brewçš„ç‰ˆæœ¬ï¼Œå¦‚æœå®‰è£…æˆåŠŸï¼Œä¼šè¾“å‡ºç±»ä¼¼å¦‚ä¸‹å†…å®¹ 12$ brew -vHomebrew 4.4.8-40-g13c3def Homebrewæœ¬èº«çš„å®‰è£…ä½ç½®å¯ä»¥é€šè¿‡brew --repoæŸ¥çœ‹ï¼Œé»˜è®¤ä¸º/usr/local/Homebrew é€šè¿‡brewå®‰è£…çš„è½¯ä»¶åŒ…é»˜è®¤ä¼šè¢«å®‰è£…åˆ°/usr/local/Cellar/ä¸‹ï¼Œæ¯”å¦‚gitå®‰è£…åä¼šåœ¨/usr/local/Cellar/git/ç›®å½•ä¸‹ï¼Œå¯ä»¥é€šè¿‡brew info gitæŸ¥çœ‹å®‰è£…ä¿¡æ¯ï¼ŒåŒ…æ‹¬ä¾èµ–åº“ç­‰ã€‚ 12345678910111213141516171819# æ˜¾ç¤º Homebrew å®‰è£…è·¯å¾„ï¼ŒmacOS ARM: /opt/homebrewï¼ŒmacOS Intel: /usr/local$ brew --prefix/usr/local# æ˜¾ç¤º Homebrew æœ¬åœ°çš„ Git ä»“åº“$ brew --repo/usr/local/Homebrew# æ˜¾ç¤º Homebrew Cellar è·¯å¾„ï¼Œå‘½ä»¤è¡Œå·¥å…·çš„å®‰è£…è·¯å¾„$ brew --cellar/usr/local/Cellar# æ˜¾ç¤º Homebrew Caskroom è·¯å¾„ï¼ŒGUIå·¥å…·çš„å®‰è£…è·¯å¾„$ brew --caskroom/usr/local/Caskroom# ç¼“å­˜è·¯å¾„ï¼Œä¸‹è½½å®‰è£…åŒ…çš„ç¼“å­˜è·¯å¾„ï¼Œé€šè¿‡ brew cleanup æ¸…ç†$ brew --cache~/Library/Caches/Homebrew é…ç½®å‘½ä»¤è¡¥å…¨ å‚è€ƒå®˜ç½‘Homebrew Documentationâ€“brew Shell Completion æˆ‘è¿™é‡Œä½¿ç”¨çš„æ˜¯zshï¼Œåœ¨~/.zshrcä¸­åŠ å…¥å¦‚ä¸‹å†…å®¹å¹¶é‡å¯ç»ˆç«¯å³å¯ç”Ÿæ•ˆ 12autoload -Uz compinitcompinit å¸è½½brew 1/bin/bash -c &quot;$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/uninstall.sh)&quot; å¸¸ç”¨å‘½ä»¤ brewæ”¯æŒå®‰è£…å‘½ä»¤è¡Œå·¥å…·(formula)å’ŒGUIå·¥å…·(cask) brew install xxx å®‰è£…å‘½ä»¤è¡Œå·¥å…·ï¼Œè¿™ä¸ªæœ€ä¸ºå¸¸ç”¨ï¼Œæ¯”å¦‚ brew install fd brew install --cask xxx å®‰è£…GUIå·¥å…·ï¼Œä¸€èˆ¬å¾ˆå°‘ä½¿ç”¨brewå®‰è£…GUIå·¥å…·ï¼Œæ¯”å¦‚ brew install --cask firefox brewçš„å‘½ä»¤å’Œå‚æ•°éå¸¸å¤šï¼Œä½†æ—¥å¸¸ä½¿ç”¨åªéœ€è¦è®°ä½å¸¸ç”¨çš„å‡ ä¸ªå°±å¤Ÿäº†ï¼Œè¯¦ç»†çš„å‘½ä»¤åˆ—è¡¨å¯ä»¥å‚è€ƒHomebrew Documentation 1234# æŸ¥çœ‹brewæ”¯æŒå“ªäº›å‘½ä»¤brew commands# æŸ¥çœ‹å‘½ä»¤çš„å¸®åŠ©ä¿¡æ¯ï¼Œæ¯”å¦‚brew install --help ä¸€äº›å¸¸ç”¨çš„å‘½ä»¤ 12345678brew update # æ›´æ–°brewåˆ°æœ€æ–°ç‰ˆæœ¬brew --version # æŸ¥çœ‹brewçš„ç‰ˆæœ¬ï¼Œå¯ä»¥ç®€å†™ä¸º brew -vbrew config # æŸ¥çœ‹brewçš„é…ç½®ä¿¡æ¯ï¼Œè¿™ä¸ªå‘½ä»¤å¾ˆæœ‰ç”¨ï¼Œå¯ä»¥æŸ¥çœ‹åˆ°ä¸brewç›¸å…³çš„ç¯å¢ƒå˜é‡çš„å€¼brew home # æµè§ˆå™¨æ‰“å¼€brewå®˜ç½‘brew home xxx # æµè§ˆå™¨æ‰“å¼€xxxå®˜ç½‘ å¦‚ï¼šæ‰“å¼€fdå‘½ä»¤çš„å®˜ç½‘ brew home fd ,å…·ä½“çš„åç§°å¯ä»¥é€šè¿‡brew listæŸ¥çœ‹brew cleanup # æ¸…ç†ç¼“å­˜åŠæ—¥å¿—æ–‡ä»¶ï¼Œå»ºè®®å®šæœŸæ¸…ç†ï¼Œå½“è¿è¡Œbrewæ—¶ä¼šè‡ªåŠ¨æ¸…ç†ï¼ˆ2.0ä»¥åçš„ç‰ˆæœ¬ï¼‰brew cleanup -n # æ˜¾ç¤ºå°†è¦æ¸…ç†çš„ç¼“å­˜åŠæ—¥å¿—æ–‡ä»¶ï¼ŒåªæŸ¥çœ‹ä¸åˆ é™¤brew doctor # æ£€æŸ¥æ˜¯å¦æœ‰ä¾èµ–é—®é¢˜ï¼Œæ¯”å¦‚æ²¡æœ‰å®‰è£…ä¾èµ–åº“ï¼Œæˆ–è€…ä¾èµ–åº“ç‰ˆæœ¬è¿‡ä½ï¼Œå½“è¿è¡ŒbrewæŠ¥é”™æ—¶å¯ä»¥é€šè¿‡è¯¥å‘½ä»¤è¿›è¡Œæ£€æŸ¥å¹¶æ ¹æ®æç¤ºè¿›è¡Œä¿®æ”¹ æŸ¥çœ‹å·²å®‰è£…çš„åŒ… 1234# æŸ¥çœ‹brew list # æŸ¥çœ‹å·²å®‰è£…çš„åŒ…brew list --versions # æŸ¥çœ‹å·²å®‰è£…çš„åŒ…åŠç‰ˆæœ¬brew info xxx # æŸ¥çœ‹xxxçš„å®‰è£…ä¿¡æ¯ å®‰è£…ã€å¸è½½ 12345678# æŸ¥æ‰¾ã€å®‰è£…ã€å¸è½½brew search xxx # æŸ¥æ‰¾è½¯ä»¶åŒ…ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ https://formulae.brew.sh ç½‘é¡µè¿›è¡Œæœç´¢brew install xxx # å®‰è£…è½¯ä»¶åŒ…ï¼Œæ­¤å‘½ä»¤ç›¸å½“äºåŠ ä¸Šäº† --formula ï¼Œå®‰è£…æ—¶ä¼šè‡ªåŠ¨ä¸‹è½½ä¾èµ–åº“ï¼Œæ¯”å¦‚å®‰è£…`nginx`æ—¶ï¼Œä¼šè‡ªåŠ¨ä¸‹è½½`openssl@3`å’Œ`pcre2`ç­‰brew install --cask xxx # å®‰è£…GUIå·¥å…·ï¼Œæ¯”å¦‚`firefox`brew uninstall xxx # å¸è½½è½¯ä»¶åŒ…ï¼Œæ­¤å‘½ä»¤ç›¸å½“äºåŠ ä¸Šäº† --formula ï¼Œåªä¼šå¸è½½å½“å‰åŒ…ï¼Œä¸ä¼šå¸è½½ä¾èµ–åº“ï¼Œè¿™æ ·å°±æœ‰å¯èƒ½å­˜åœ¨å¾ˆå¤šå†—ä½™åŒ…brew uninstall --cask xxx # å¸è½½GUIå·¥å…·brew autoremove # åˆ é™¤æ‰€æœ‰ä»…ä½œä¸ºå¦ä¸€ä¸ªè½¯ä»¶åŒ…çš„ä¾èµ–é¡¹å®‰è£…å¹¶ä¸”ç°åœ¨ä¸å†éœ€è¦çš„åŒ…brew autoremove --dry-run # --dry-run ä»…æŸ¥çœ‹å“ªäº›åŒ…å¯ä»¥åˆ é™¤ï¼Œå¹¶ä¸ä¼šçœŸçš„åˆ é™¤ å‡çº§ 1234# å‡çº§brew outdated # æŸ¥çœ‹éœ€è¦å‡çº§çš„åŒ…brew upgrade xxx # å‡çº§xxxåˆ°æœ€æ–°ç‰ˆbrew upgrade # æ›´æ–°å…¨éƒ¨å‘½ä»¤åˆ°æœ€æ–°ç‰ˆ ä¾èµ–å…³ç³» 12345678# ä¾èµ–å…³ç³»brew deps --tree xxx # æ ‘å½¢æ˜¾ç¤ºåŒ…çš„ä¾èµ–æ ‘brew deps --installed --tree # æ ‘å½¢æ˜¾ç¤ºæ‰€æœ‰å®‰è£…åŒ…çš„ä¾èµ–å…³ç³»brew deps --installed xxx # æ˜¾ç¤ºå½“å‰å®‰è£…åŒ…çš„ä¾èµ–å…³ç³»ï¼Œçºµå‘å±•ç¤ºbrew deps --installed --for-each xxx # æ˜¾ç¤ºå½“å‰å®‰è£…åŒ…çš„ä¾èµ–å…³ç³»ï¼Œæ¨ªå‘å±•ç¤ºbrew uses --installed xxx # æŸ¥çœ‹å·²ç»å®‰è£…çš„å“ªäº›å·¥å…·ä¾èµ–å½“å‰åŒ…brew leaves # æŸ¥çœ‹é¡¶çº§å®‰è£…åŒ…ï¼Œå³ä½ é€šè¿‡brewç›´æ¥å®‰è£…çš„åŒ…ï¼Œè€Œä¸æ˜¯é€šè¿‡å®‰è£…å…¶ä»–è½¯ä»¶åŒ…é—´æ¥å®‰è£…çš„brew leaves | xargs brew deps --installed --for-each --formula # æŸ¥çœ‹é¡¶çº§åŒ…ï¼Œå¹¶åˆ—å‡ºæ¯ä¸ªé¡¶çº§åŒ…çš„å·²å®‰è£…ä¾èµ– ä»“åº“ç®¡ç†ï¼Œå‚è€ƒèµ„æ–™Homebrew Documentationâ€“Taps 1234567891011# ä»“åº“ç®¡ç†brew tap # æŸ¥çœ‹æ‰€æœ‰å·²å®‰è£…çš„ä»“åº“ï¼Œtapå®‰è£…è·¯å¾„ /usr/local/Homebrew/Library/Taps/brew tap user/repo # æ·»åŠ ä¸€ä¸ªä»“åº“ï¼Œä»gitthubä¸‹è½½brew tap repo_url # æ·»åŠ ä¸€ä¸ªä»“åº“ï¼Œä»ç»™å®šçš„ä»“åº“åœ°å€ä¸‹è½½brew untap user/repo # åˆ é™¤ä¸€ä¸ªä»“åº“# ä»ç¬¬ä¸‰æ–¹ä»“åº“å®‰è£…å·¥å…·ï¼Œæ­¤æ—¶ä¼šè‡ªåŠ¨å°† homebrew-ffmpeg/ffmpeg è¿™ä¸ªä»“åº“æ·»åŠ åˆ°æœ¬åœ°brew install homebrew-ffmpeg/ffmpeg/ffmpeg# æ›´æ–°ä»“åº“ï¼Œæ— è®ºæ˜¯brewè‡ªå·±çš„ä»“åº“è¿˜æ˜¯ç¬¬ä¸‰æ–¹ä»“åº“ï¼Œéƒ½ä¼šè‡ªåŠ¨æ›´æ–°brew update brew services: brewçš„æœåŠ¡ç®¡ç†å·¥å…·ï¼Œå¯ä»¥æ–¹ä¾¿çš„ç®¡ç†é€šè¿‡brewå®‰è£…çš„æœåŠ¡ï¼ŒåŒ…æ‹¬å¯åŠ¨ã€åœæ­¢ã€é‡å¯æœåŠ¡ï¼Œç­‰ç­‰ï¼Œæ¯”å¦‚nginxã€redisã€mysqlç­‰ï¼Œå…·ä½“å‘½ä»¤å¯ä»¥å‚è€ƒHomebrew Documentation 12345678910# ç¬¬ä¸€æ¬¡æ‰§è¡Œ services ç›¸å…³çš„å‘½ä»¤æ—¶ä¼šè‡ªåŠ¨ä¸‹è½½ homebrew/servicesï¼Œä¹Ÿå¯ä»¥ é€šè¿‡ brew tap homebrew/services æå‰ä¸‹è½½brew services list # æŸ¥çœ‹å·²å®‰è£…çš„æ‰€æœ‰æœåŠ¡brew services start nginx # å¯åŠ¨æœåŠ¡ï¼Œå¹¶æ³¨å†Œåˆ°ç³»ç»Ÿå¯åŠ¨æœåŠ¡åˆ—è¡¨ï¼Œå³åˆ›å»ºç³»ç»Ÿè‡ªå¯åŠ¨æ–‡ä»¶ï¼š ~/Library/LaunchAgents/homebrew.mxcl.nginx.plistbrew services stop nginx # åœæ­¢æœåŠ¡ï¼Œå¹¶ä»ç³»ç»Ÿå¯åŠ¨æœåŠ¡åˆ—è¡¨ä¸­ç§»é™¤ï¼Œå³åˆ é™¤ç³»ç»Ÿè‡ªå¯åŠ¨æ–‡ä»¶brew services kill nginx # ç«‹å³æ€æ­»æœåŠ¡ï¼Œä½†ä¸ä»ç³»ç»Ÿå¯åŠ¨æœåŠ¡åˆ—è¡¨ä¸­ç§»é™¤brew services restart nginx # é‡å¯æœåŠ¡brew services info nginx # æŸ¥çœ‹æœåŠ¡çš„çŠ¶æ€å’Œè¿›ç¨‹IPbrew services run nginx # è¿è¡ŒæœåŠ¡ï¼Œä½†ä¸ä¼šä¿å­˜åˆ°æœåŠ¡åˆ—è¡¨ä¸­brew services cleanup # æ¸…ç†æ— æ•ˆçš„æœåŠ¡ï¼Œå³å·²å¸è½½åº”ç”¨çš„æ— ç”¨çš„é…ç½®brew services --help # æŸ¥çœ‹å¸®åŠ© é…ç½®å›½å†…é•œåƒæº ä¸Šé¢å®‰è£…éƒ¨åˆ†ä»‹ç»äº†å¦‚ä½•åœ¨å®‰è£…brewæ—¶å°±æŒ‡å®šé•œåƒæºï¼Œä½†æœ‰äº›æ—¶å€™å› ä¸ºæˆ‘ä»¬åœ¨å®‰è£…æ—¶å¿˜è®°é…ç½®ï¼Œæˆ–è€…åŸæ¥çš„é•œåƒæºå·²ç»å¤±æ•ˆéœ€è¦é‡æ–°é…ç½®ï¼Œæ­¤æ—¶å¯ä»¥æŒ‰ç…§ä¸‹é¢çš„æ–¹æ³•è¿›è¡Œé…ç½®ã€‚ æ­¤å¤„ä»¥é…ç½®æ¸…åé•œåƒæºä¸ºä¾‹ï¼Œé˜¿é‡Œé•œåƒæºè¯·å‚è€ƒé˜¿é‡Œçš„å®˜ç½‘æ–‡æ¡£â€“Homebrewé•œåƒï¼Œç§‘å¤§æºå‚è€ƒHomebrew 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475## ä¸´æ—¶æ›¿æ¢# é…ç½®brewå›½å†…é•œåƒæº$ export HOMEBREW_BREW_GIT_REMOTE=&quot;https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/brew.git&quot;# é…ç½®brew-coreå›½å†…é•œåƒæº$ export HOMEBREW_CORE_GIT_REMOTE=&quot;https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/homebrew-core.git&quot;# é…ç½®brew-bottleå›½å†…é•œåƒæº$ export HOMEBREW_API_DOMAIN=&quot;https://mirrors.tuna.tsinghua.edu.cn/homebrew-bottles/api&quot;$ export HOMEBREW_BOTTLE_DOMAIN=&quot;https://mirrors.tuna.tsinghua.edu.cn/homebrew-bottles&quot;# æ›´æ–°é…ç½®$ brew update## é…ç½®æ°¸ä¹…ç”Ÿæ•ˆï¼Œzshç”¨æˆ·# é…ç½®brewå›½å†…é•œåƒæº$ echo &#x27;export HOMEBREW_BREW_GIT_REMOTE=&quot;https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/brew.git&quot;&#x27; &gt;&gt; ~/.zshrc# é…ç½®brew-coreå›½å†…é•œåƒæº$ echo &#x27;export HOMEBREW_CORE_GIT_REMOTE=&quot;https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/homebrew-core.git&quot;&#x27; &gt;&gt; ~/.zshrc# é…ç½®brew-bottleå›½å†…é•œåƒæº$ echo &#x27;export HOMEBREW_API_DOMAIN=&quot;https://mirrors.tuna.tsinghua.edu.cn/homebrew-bottles/api&quot;&#x27; &gt;&gt; ~/.zshrc$ echo &#x27;export HOMEBREW_BOTTLE_DOMAIN=&quot;https://mirrors.tuna.tsinghua.edu.cn/homebrew-bottles&quot;&#x27; &gt;&gt; ~/.zshrc$ source ~/.zshrc# æ›´æ–°é…ç½®$ brew update# æ­¤æ—¶æŸ¥çœ‹brewé…ç½®ä¿¡æ¯ï¼Œå¯ä»¥çœ‹åˆ°å·²ç»ç”Ÿæ•ˆäº†$ brew configHOMEBREW_VERSION: 4.4.8-38-g6089077ORIGIN: https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/brew.gitHEAD: 60890774e0a70fe93f94973b080068cf7b0d1c93Last commit: 9 hours agoBranch: masterCore tap origin: https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/homebrew-core.gitCore tap HEAD: 787d1587bfa92794f7d141063a31773064ef9107Core tap last commit: 11 minutes agoCore tap JSON: 29 Nov 09:56 UTCCore cask tap HEAD: 4c34bd8c418e13160fc79f1ca9312555d2edc254Core cask tap last commit: 19 minutes agoCore cask tap JSON: 29 Nov 09:56 UTCHOMEBREW_PREFIX: /usr/localHOMEBREW_API_DOMAIN: https://mirrors.tuna.tsinghua.edu.cn/homebrew-bottles/apiHOMEBREW_BOTTLE_DOMAIN: https://mirrors.tuna.tsinghua.edu.cn/homebrew-bottlesHOMEBREW_BREW_GIT_REMOTE: https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/brew.gitHOMEBREW_CASK_OPTS: []HOMEBREW_CORE_GIT_REMOTE: https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/homebrew-core.gitHOMEBREW_GITHUB_API_TOKEN: setHOMEBREW_MAKE_JOBS: 12HOMEBREW_SORBET_RUNTIME: setHomebrew Ruby: 3.3.6 =&gt; /usr/local/Homebrew/Library/Homebrew/vendor/portable-ruby/3.3.6/bin/rubyCPU: dodeca-core 64-bit kabylakeClang: 15.0.0 build 1500Git: 2.43.0 =&gt; /usr/local/bin/gitCurl: 8.7.1 =&gt; /usr/bin/curlmacOS: 13.7.1-x86_64CLT: 15.0.0.0.1.1694021235Xcode: N/A# é€šè¿‡brewå‡çº§fdï¼Œå¯ä»¥çœ‹åˆ°ä½¿ç”¨äº†æ¸…åæº$ brew upgrade fd==&gt; Upgrading 1 outdated package:fd 8.2.1 -&gt; 10.2.0==&gt; Fetching fd==&gt; Downloading https://mirrors.tuna.tsinghua.edu.cn/homebrew-bottles/fd-10.2.0.ventura.bottle.tar.gz################################################################################################################################################################################### 100.0%==&gt; Verifying attestation for fd==&gt; Upgrading fd 8.2.1 -&gt; 10.2.0==&gt; Pouring fd-10.2.0.ventura.bottle.tar.gz==&gt; Caveatszsh completions have been installed to: /usr/local/share/zsh/site-functions==&gt; SummaryğŸº /usr/local/Cellar/fd/10.2.0: 14 files, 2.9MB==&gt; Running `brew cleanup fd`...Disable this behaviour by setting HOMEBREW_NO_INSTALL_CLEANUP.Hide these hints with HOMEBREW_NO_ENV_HINTS (see `man brew`).Removing: /usr/local/Cellar/fd/8.2.1... (13 files, 2.4MB) æ¢å¤ä¸ºé»˜è®¤çš„GitHubé•œåƒæº 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960$ unset HOMEBREW_BREW_GIT_REMOTE$ unset HOMEBREW_CORE_GIT_REMOTE$ unset HOMEBREW_API_DOMAIN$ unset HOMEBREW_BOTTLE_DOMAIN# å¦‚æœæ‚¨ä¹‹å‰æ°¸ä¹…é…ç½®äº† HOMEBREW ç¯å¢ƒå˜é‡ï¼Œè¿˜éœ€è¦åœ¨å¯¹åº”çš„ ~/.bash_profile æˆ–è€… ~/.zshrc é…ç½®æ–‡ä»¶ä¸­ï¼Œå°†å¯¹åº”çš„ HOMEBREW ç¯å¢ƒå˜é‡é…ç½®è¡Œåˆ é™¤$ source ~/.zshrc# æ›´æ–°brew$ git -C &quot;$(brew --repo)&quot; remote set-url origin https://github.com/Homebrew/brew# æ›´æ–°brew-coreï¼Œbrew4.0åä¸ä¼šå†ä¸‹è½½brew-coreï¼Œæ‰€ä»¥å¯ä»¥å¿½ç•¥# ä¸è¿‡ä»ä½ç‰ˆæœ¬å‡çº§ä¸Šæ¥çš„è¿˜ä¼šæœ‰è¿™ä¸ªä»“åº“ï¼Œå¯ä»¥é€šè¿‡ brew tap æŸ¥çœ‹æ˜¯å¦å­˜åœ¨ï¼Œå®é™…ä¸Šæ”¹ä¸æ”¹éƒ½ä¸ä¼šæœ‰å½±å“ï¼Œçœ‹ç€ä¸èˆ’æœå°±ä¿®æ”¹å§$ git -C &quot;$(brew --repo homebrew/core)&quot; remote set-url origin https://github.com/Homebrew/homebrew-core$ brew update# æŸ¥çœ‹brewé…ç½®ä¿¡æ¯$ brew configHOMEBREW_VERSION: 4.4.8-38-g6089077ORIGIN: https://github.com/Homebrew/brewHEAD: 60890774e0a70fe93f94973b080068cf7b0d1c93Last commit: 9 hours agoBranch: masterCore tap HEAD: 787d1587bfa92794f7d141063a31773064ef9107Core tap last commit: 13 minutes agoCore tap JSON: 29 Nov 10:09 UTCCore cask tap HEAD: 871fe2e8b93aac896a1808571ff11f8b89e6d90eCore cask tap last commit: 48 seconds agoCore cask tap JSON: 29 Nov 10:09 UTCHOMEBREW_PREFIX: /usr/localHOMEBREW_CASK_OPTS: []HOMEBREW_GITHUB_API_TOKEN: setHOMEBREW_MAKE_JOBS: 12HOMEBREW_SORBET_RUNTIME: setHomebrew Ruby: 3.3.6 =&gt; /usr/local/Homebrew/Library/Homebrew/vendor/portable-ruby/3.3.6/bin/rubyCPU: dodeca-core 64-bit kabylakeClang: 15.0.0 build 1500Git: 2.43.0 =&gt; /usr/local/bin/gitCurl: 8.7.1 =&gt; /usr/bin/curlmacOS: 13.7.1-x86_64CLT: 15.0.0.0.1.1694021235Xcode: N/A# é€šè¿‡brewå‡çº§telnetï¼Œå¯ä»¥çœ‹åˆ°ä½¿ç”¨äº†GitHubæº$ brew upgrade telnet==&gt; Upgrading 1 outdated package:telnet 294 -&gt; 303.141.1==&gt; Downloading https://ghcr.io/v2/homebrew/core/telnet/manifests/303.141.1################################################################################################################################################################################### 100.0%==&gt; Fetching telnet==&gt; Downloading https://ghcr.io/v2/homebrew/core/telnet/blobs/sha256:1be6b7b6a17a311fb3a2f1bffe7dae52284f3239b8af03f651c4fac11362f702################################################################################################################################################################################### 100.0%==&gt; Verifying attestation for telnet==&gt; Upgrading telnet 294 -&gt; 303.141.1==&gt; Pouring telnet--303.141.1.ventura.bottle.tar.gzğŸº /usr/local/Cellar/telnet/303.141.1: 5 files, 207.5KB==&gt; Running `brew cleanup telnet`...Disable this behaviour by setting HOMEBREW_NO_INSTALL_CLEANUP.Hide these hints with HOMEBREW_NO_ENV_HINTS (see `man brew`).Removing: /usr/local/Cellar/telnet/294... (4 files, 208.2KB) é‡è¦çš„è¯´æ˜ ç¯å¢ƒå˜é‡ brewå®‰è£…çš„è½¯ä»¶åŒ…ä¼šè¢«è½¯è¿æ¥åˆ°/usr/local/bin/ä¸‹ï¼Œæ‰€ä»¥éœ€è¦å°†è¯¥è·¯å¾„åŠ å…¥ç³»ç»Ÿç¯å¢ƒPATHä¸­ è¿™é‡Œè¦æ³¨æ„ä¸€ç‚¹ï¼Œå¦‚æœè¯¥è·¯å¾„åœ¨PATHä¸­å£°æ˜çš„æ¯”è¾ƒé å‰ï¼Œå°±å¯èƒ½ä¼šè¢«ä¼˜å…ˆä½¿ç”¨ï¼Œæ¯”å¦‚æˆ‘ä»¬å·²ç»æ‰‹å·¥åœ¨ç³»ç»Ÿä¸­å®‰è£…äº†pythonçš„æŸä¸ªç‰ˆæœ¬ï¼Œä½†é€šè¿‡brewå®‰è£…æŸäº›è½¯ä»¶åŒ…æ—¶å› ä¸ºå…¶ä¾èµ–pythonï¼Œå°±ä¼šé€šè¿‡brewåŒæ—¶å®‰è£…å¯¹åº”çš„pythonç‰ˆæœ¬ï¼Œæ­¤æ—¶æˆ‘ä»¬åœ¨ä½¿ç”¨pythonå‘½ä»¤æ—¶ï¼Œå°±ä¼šä¼˜å…ˆä½¿ç”¨è¿™ä¸ª æœ‰ä¸¤ç§æ–¹æ³•å¯ä»¥è§£å†³ï¼Œ1æ˜¯é€šè¿‡brew unlink pythonæ¥è§£é™¤é“¾æ¥ï¼Œæ­¤æ—¶å¹¶ä¸æ˜¯åˆ é™¤ï¼Œè€Œåªæ˜¯è§£é™¤äº†è½¯é“¾ï¼Œä¸ä¼šå½±å“ä¾èµ–å®ƒçš„å·¥å…·çš„ä½¿ç”¨ï¼Œå¦‚æœéœ€è¦æ¢å¤é“¾æ¥ï¼Œå¯ä»¥é€šè¿‡brew link pythonæ¥æ¢å¤é“¾æ¥ï¼›2æ˜¯å°†æˆ‘ä»¬çš„ç³»ç»Ÿä¸­è‡ªå·±å®‰è£…çš„ä¸€äº›å·¥å…·çš„è·¯å¾„å£°æ˜åœ¨/usr/local/bin/ä¹‹å‰ï¼Œè¿™æ ·å°±ä¸ä¼šæœ‰å½±å“äº†ã€‚ Homebrew 4.0 å¸¦æ¥çš„æ–°å˜åŒ– Homebrew 4.0 è¿›è¡Œäº†ä¸€é¡¹æœ€å¤§çš„æ”¹åŠ¨ï¼Œç»„ç»‡æ–¹å¼ä»Gitä»“åº“ç®¡ç†æ”¹ä¸ºJSONæ–‡ä»¶ä¸‹è½½ã€‚ JSONæ–‡ä»¶ä¼šä»formulae.brew.shä¸‹è½½ï¼Œè€Œä¸å†ä½¿ç”¨homebrew/coreã€homebrew/caskä¸¤ä¸ªä»“åº“ï¼Œæ‰€ä»¥å‡çº§åˆ°4.0åï¼Œæœ¬åœ°çš„homebrew/coreã€homebrew/cask ä»“åº“éƒ½å¯ä»¥åˆ é™¤ä»¥é‡Šæ”¾ç£ç›˜ç©ºé—´ã€‚ 12345678910111213141516# æŸ¥çœ‹æœ¬åœ°ä»“åº“$ brew taphomebrew/cask # cask ä»“åº“ï¼ŒGUIçš„å·¥å…·ä¼šä»æ­¤ä¸‹è½½ï¼Œbrew4.0åä¸å†ä½¿ç”¨homebrew/core # core ä»“åº“ï¼Œå³ formula ä»“åº“ï¼Œå‘½ä»¤è¡Œå·¥å…·ä¼šä»æ­¤ä¸‹è½½ï¼Œbrew4.0åä¸å†ä½¿ç”¨homebrew/services # services ä»“åº“ï¼Œservices å·¥å…·æœ¬èº«ä¼šä»æ­¤ä¸‹è½½ï¼Œbrew4.0åä¾æ—§ä½¿ç”¨# åˆ é™¤æœ¬åœ°ä»“åº“$ brew untap homebrew/core$ brew untap homebrew/cask# æ­¤æ—¶å†æ¬¡æ‰§è¡Œ brew outdated ç­‰å‘½ä»¤æ—¶ï¼Œä¼šçœ‹åˆ°jsonæ–‡ä»¶è¢«ä¸‹è½½äº†ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œè¯¥jsonæ–‡ä»¶é—´éš”24å°æ—¶æ›´æ–°ä¸€æ¬¡$ brew outdated==&gt; Downloading https://formulae.brew.sh/api/formula.jws.json##################################################################################### 100.0%==&gt; Downloading https://formulae.brew.sh/api/cask.jws.json##################################################################################### 100.0% å¦‚æœè¿˜æƒ³ä½¿ç”¨æ—§çš„ä»“åº“æ¨¡å¼ï¼Œåªè¦é…ç½®ä¸‹ç¯å¢ƒå˜é‡ 1echo &#x27;export HOMEBREW_NO_INSTALL_FROM_API=1&#x27; &gt;&gt; ~/.zshrc ä»é•œåƒæºçš„åˆ‡æ¢æ¥ç†è§£brewä¸‹è½½å®‰è£…åŒ…çš„è¿‡ç¨‹ å‰é¢æˆ‘ä»¬ä»‹ç»è¿‡ï¼Œåˆ‡æ¢é•œåƒæºæ—¶è¦è®¾ç½®4ä¸ªç¯å¢ƒå˜é‡ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆè¦è®¾ç½®è¿™å‡ ä¸ªå˜é‡å‘¢ï¼Ÿå®ƒä»¬çš„ä½œç”¨æ˜¯ä»€ä¹ˆå‘¢ï¼Œä¸‹é¢æˆ‘å°±ä¸€ä¸ªä¸€ä¸ªè¯´æ˜ï¼š HOMEBREW_BREW_GIT_REMOTE è®¾ç½®brewä»“åº“ï¼Œç”¨äºæ›´æ–°brewå‘½ä»¤æœ¬èº«ï¼Œè¿™ä¸ªæ¯”è¾ƒå®¹æ˜“ç†è§£ HOMEBREW_CORE_GIT_REMOTE è®¾ç½®coreä»“åº“ï¼Œç”¨äºæ›´æ–°formulaçš„å®‰è£…è„šæœ¬ å½“é€šè¿‡brew info xxxæŸ¥çœ‹å®‰è£…åŒ…ä¿¡æ¯æ—¶ï¼Œå¯ä»¥çœ‹åˆ°Fromä¿¡æ¯ï¼Œè¿™ä¸ªå°±æ˜¯å‘½ä»¤çš„å®‰è£…è„šæœ¬ï¼Œæ¯”å¦‚ä¸‹é¢çš„fd.rb 1234567891011121314151617181920212223$ brew info fd==&gt; fd: stable 10.2.0 (bottled), HEADSimple, fast and user-friendly alternative to findhttps://github.com/sharkdp/fdConflicts with: fdclone (because both install `fd` binaries)Installed/usr/local/Cellar/fd/10.2.0 (14 files, 2.9MB) * Poured from bottle using the formulae.brew.sh API on 2024-11-29 at 18:02:16From: https://github.com/Homebrew/homebrew-core/blob/HEAD/Formula/f/fd.rbLicense: Apache-2.0 OR MIT==&gt; DependenciesBuild: rust âœ˜==&gt; Options--HEAD Install HEAD version==&gt; Caveatszsh completions have been installed to: /usr/local/share/zsh/site-functions==&gt; Analyticsinstall: 6,327 (30 days), 24,518 (90 days), 116,476 (365 days)install-on-request: 6,326 (30 days), 24,515 (90 days), 116,363 (365 days)build-error: 0 (30 days) è¿™ä¸ªå®‰è£…è„šæœ¬ä¸­åŒ…å«bottle doéƒ¨åˆ†ï¼Œå…¶ä½œç”¨æ˜¯å½“å®‰è£…è„šæœ¬æ—¶ï¼Œä¼˜å…ˆä»è¯¥éƒ¨åˆ†è·å–å¯¹åº”çš„æ“ä½œç³»ç»Ÿçš„äºŒè¿›åˆ¶é¢„ç¼–è¯‘åŒ…çš„sha256æ ¡éªŒå€¼ï¼Œå¦‚æœä»å¯¹åº”çš„äºŒè¿›åˆ¶æºä¸­æ‰¾åˆ°ï¼Œåˆ™ç›´æ¥ä»äºŒè¿›åˆ¶é¢„ç¼–è¯‘åŒ…çš„åœ°å€è¿›è¡Œä¸‹è½½ï¼Œè¯¥é¢„ç¼–è¯‘ä¸‹è½½åœ°å€ç”±HOMEBREW_BOTTLE_DOMAINæŒ‡å®šï¼Œé»˜è®¤ä»å®˜æ–¹æºä¸‹è½½ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940class Fd &lt; Formula desc &quot;Simple, fast and user-friendly alternative to find&quot; homepage &quot;https://github.com/sharkdp/fd&quot; url &quot;https://github.com/sharkdp/fd/archive/refs/tags/v10.2.0.tar.gz&quot; sha256 &quot;73329fe24c53f0ca47cd0939256ca5c4644742cb7c14cf4114c8c9871336d342&quot; license any_of: [&quot;Apache-2.0&quot;, &quot;MIT&quot;] head &quot;https://github.com/sharkdp/fd.git&quot;, branch: &quot;master&quot; bottle do sha256 cellar: :any_skip_relocation, arm64_sequoia: &quot;9d17cfb029fbdc6ed31c732108f7aa746d3082dd4783ed35471ef79340615509&quot; sha256 cellar: :any_skip_relocation, arm64_sonoma: &quot;82d5c2ffc2e2d0d8643a7c3f620c81ed49d7b23920aa23b6a7f4c50be69abc0b&quot; sha256 cellar: :any_skip_relocation, arm64_ventura: &quot;354412ababb7d6c52abd9153ff96f133391406ce292b2122c76b96c2ab714f87&quot; sha256 cellar: :any_skip_relocation, arm64_monterey: &quot;0b41f292041767fd1c3c5b92daaa6c823fb07c1d7cd11b0427a415f08463f035&quot; sha256 cellar: :any_skip_relocation, sonoma: &quot;4fa0fb4b3f512e45d35c569953efc7c59ebd8976caac9b2c1b1394b7e29157a0&quot; sha256 cellar: :any_skip_relocation, ventura: &quot;b1406e5414252b1e1b90cfad188454eb31058256ed6246baed48c4e1cfe593a1&quot; sha256 cellar: :any_skip_relocation, monterey: &quot;0ac060bf7d1529aa1f65e634f64b98b906df533d71f2185c883165c01f59ad53&quot; sha256 cellar: :any_skip_relocation, x86_64_linux: &quot;2464fb21cc981166ffa9783fa14a09265790af4d89ce3a763421ddaf29119541&quot; end depends_on &quot;rust&quot; =&gt; :build conflicts_with &quot;fdclone&quot;, because: &quot;both install `fd` binaries&quot; def install system &quot;cargo&quot;, &quot;install&quot;, *std_cargo_args man1.install &quot;doc/fd.1&quot; generate_completions_from_executable(bin/&quot;fd&quot;, &quot;--gen-completions&quot;, shells: [:bash, :fish]) zsh_completion.install &quot;contrib/completion/_fd&quot; # Bash completions are not compatible with Bash 3 so don&#x27;t use v1 directory. # bash: complete: nosort: invalid option name # Issue ref: https://github.com/clap-rs/clap/issues/5190 (share/&quot;bash-completion/completions&quot;).install bash_completion.children end test do touch &quot;foo_file&quot; touch &quot;test_file&quot; assert_equal &quot;test_file&quot;, shell_output(&quot;#&#123;bin&#125;/fd test&quot;).chomp endend æ³¨æ„ï¼Œbrew4.0åä¸å†ä½¿ç”¨ä»è¯¥gitä»“åº“ä¸­è·å–å®‰è£…è„šæœ¬ï¼Œå› ä¸ºformulaçš„å®‰è£…æºä»£ç å·²ç»å…¨éƒ¨å­˜å‚¨åœ¨jsonæ–‡ä»¶ä¸­(è§HOMEBREW_API_DOMAINè¯´æ˜)ï¼Œä¸å†éœ€è¦é€šè¿‡Gitä»“åº“ä¸‹è½½ åˆ‡æ¢é•œåƒæºæ—¶ï¼Œbrew4.0åä¸éœ€è¦è®¾ç½®è¯¥ç¯å¢ƒå˜é‡ HOMEBREW_API_DOMAIN è®¾ç½®formula\\caskçš„å®‰è£…è„šæœ¬ä¸‹è½½æºï¼Œé»˜è®¤https://formulae.brew.sh brew4.0åä¸å†ä»gitä»“åº“è·å–å®‰è£…è„šæœ¬ï¼Œè€Œæ˜¯ä»è¿™ä¸ªjsonæ–‡ä»¶ä¸­ä¸€æ¬¡æ€§è·å–æ‰€æœ‰å·¥å…·çš„å®‰è£…è„šæœ¬ï¼Œé»˜è®¤24å°æ—¶æ›´æ–°ä¸€æ¬¡ 1234567å®˜æ–¹æºï¼š formulaæºï¼šhttps://formulae.brew.sh/api/formula.jws.json caskæºï¼šhttps://formulae.brew.sh/api/cask.jws.jsonæ¸…åæºï¼š formulaæºï¼šhttps://mirrors.tuna.tsinghua.edu.cn/homebrew-bottles/api/formula.jws.json caskæºï¼šhttps://mirrors.tuna.tsinghua.edu.cn/homebrew-bottles/api/cask.jws.json å¦‚æœè¿˜æƒ³ä½¿ç”¨æ—§çš„ä»“åº“æ¨¡å¼ï¼Œåªè¦é…ç½®ä¸‹ç¯å¢ƒå˜é‡ï¼Œè¿™æ ·å³ä½¿ä½ å‡çº§åå·²ç»åˆ é™¤äº†å¯¹åº”çš„ä»“åº“ï¼Œå®ƒä¹Ÿä¼šåœ¨ç¬¬ä¸€æ¬¡ä½¿ç”¨åˆ°æ—¶è‡ªåŠ¨ä¸‹è½½ 12# å®˜æ–¹ä¹Ÿæåˆ°ï¼Œéå¼€å‘äººå‘˜æ²¡å¿…è¦è¿™æ ·åšecho &#x27;export HOMEBREW_NO_INSTALL_FROM_API=1&#x27; &gt;&gt; ~/.zshrc HOMEBREW_BOTTLE_DOMAIN æŒ‡å®šé¢„ç¼–è¯‘äºŒè¿›åˆ¶åŒ…ï¼ˆä¹Ÿç§°ä¸º bottlesï¼‰çš„ä¸‹è½½åœ°å€ï¼ŒHomebrew ä½¿ç”¨è¿™äº› bottles æ¥åŠ é€Ÿè½¯ä»¶å®‰è£…è¿‡ç¨‹ï¼Œé¿å…åœ¨æ¯ä¸ªç”¨æˆ·çš„è®¡ç®—æœºä¸Šéƒ½é‡æ–°ä»æºä»£ç æ„å»ºè½¯ä»¶ã€‚ å½“æˆ‘ä»¬é€šè¿‡brew install xxxå®‰è£…è½¯ä»¶æ—¶ï¼Œbrewä¼šå…ˆä»è¯¥formulaçš„å®‰è£…è„šæœ¬ï¼ˆ4.0ä»¥å‰ä»HOMEBREW_CORE_GIT_REMOTEæŒ‡å®šçš„gitä»“åº“è·å–ï¼Œ4.0ä»¥åä»HOMEBREW_API_DOMAINæŒ‡å®šçš„jsonæ–‡ä»¶ä¸­è·å–ï¼‰ä¸­è·å–è¯¥è½¯ä»¶çš„å®‰è£…ä¿¡æ¯ï¼Œç„¶åæ ¹æ®å®‰è£…ä¿¡æ¯ä»bottleä¸­ä¸‹è½½å¯¹åº”çš„é¢„ç¼–è¯‘äºŒè¿›åˆ¶åŒ…ï¼Œå†å°†å…¶å®‰è£…åˆ°æœ¬åœ°ã€‚ ä¸‹è½½åçš„äºŒè¿›åˆ¶åŒ…ä¼šè¢«ä¿å­˜åˆ°ç¼“å­˜ç›®å½•ä¸­(brew --cache)ï¼Œå®‰è£…åçš„è½¯ä»¶åŒ…å­˜å‚¨åˆ°Cellarç›®å½•ä¸­(brew --cellar) é€šè¿‡ä¸Šé¢çš„åˆ†æï¼Œæˆ‘ä»¬å¯ä»¥å¾—å‡ºç»“è®ºï¼Œåˆ‡æ¢é•œåƒæºæ—¶ï¼Œå®é™…ä¸Šåªéœ€è¦è®¾ç½®3ä¸ªå˜é‡å°±å¤Ÿäº† 123HOMEBREW_BREW_GIT_REMOTEHOMEBREW_API_DOMAINHOMEBREW_BOTTLE_DOMAIN","summary":"æ‘˜è¦ brewæ˜¯ä¸€ä¸ªè½¯ä»¶åŒ…ç®¡ç†å™¨ï¼ŒåŒæ—¶æ”¯æŒMacOSå’ŒLinuxï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿åœ°å®‰è£…å„ç§è½¯ä»¶ï¼Œæ¯”å¦‚gitã€nodeã€pythonç­‰ã€‚ brewè™½ç„¶æ”¯æŒlinuxï¼Œä½†æ˜¯å®é™…ä½¿ç”¨ä¸­å¾ˆå°‘ä¼šä½¿ç”¨brewæ¥ç®¡ç†linuxçš„è½¯ä»¶åŒ…ã€‚ æœ¬æ–‡ä»‹ç»å¦‚ä½•åœ¨macosä¸‹å®‰è£…brewï¼Œä»¥åŠå¦‚ä½•ä½¿ç”¨brewç®¡ç†å„ç§è½¯ä»¶åŒ…ã€‚ æœ¬æ–‡åŸºäº MacOS Intel Ventura 13.7.1ï¼Œbrew ç‰ˆæœ¬ä¸º4.4.8ã€‚","date_published":"2024-11-28T13:55:05.000Z","tags":["macos","macos","brew"]},{"id":"https://blog.hanqunfeng.com/2024/11/22/python_poetry/","url":"https://blog.hanqunfeng.com/2024/11/22/python_poetry/","title":"Poetry--è½»é‡çº§çš„pythonåŒ…ç®¡ç†å™¨","content_html":"<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\"><a href=\"https://python-poetry.org/docs/\">Poetry</a>æ˜¯ä¸€ä¸ªè½»é‡çº§çš„pythonåŒ…ç®¡ç†å™¨ï¼Œå…¶ç›®æ ‡æ˜¯å¸®åŠ©å¼€å‘è€…å¿«é€Ÿã€è½»æ¾åœ°æ„å»ºã€å‘å¸ƒå’Œåˆ†äº«pythonåŒ…ã€‚è¯´å®ƒè½»é‡ï¼Œæ˜¯ä¸ <a href=\"https://docs.conda.io/projects/conda/en/stable/\">conda</a> ç›¸æ¯” poetry æ›´è½»é‡ï¼ŒåŒæ—¶ä¸ <code>venv + pip</code> <a href=\"/2018/04/28/python_virtualenv/\" title=\"Python--virtualenv\">Python--virtualenv</a> çš„æ–¹å¼ç›¸æ¯”å…·æœ‰å¦‚ä¸‹ä¼˜ç‚¹ï¼š\n<ul class=\"lvl-2\">\n<li class=\"lvl-6\">ä½¿ç”¨ç¼“å­˜æœºåˆ¶ï¼Œé¿å…é‡å¤ä¸‹è½½ä¾èµ–åŒ…</li>\n<li class=\"lvl-6\">åŒ…ç®¡ç†ä¸Šæ›´åŠ ç²¾ç¡®ï¼Œåˆ é™¤ä¸éœ€è¦çš„åŒ…æ—¶ä¼šåŒæ—¶åˆ é™¤ä¸å…¶å…³è”çš„ä¸”æ²¡æœ‰è¢«ä½¿ç”¨çš„é‚£äº›ä¾èµ–åŒ…ï¼Œé¿å…æ— ç”¨çš„ä¾èµ–åŒ…é€ æˆæ‰“åŒ…ä½“ç§¯è¿‡å¤§</li>\n<li class=\"lvl-6\">æ‰“åŒ…å’Œå‘å¸ƒæ›´åŠ ç®€å•ï¼Œåªéœ€è¦ä¸€ä¸ªå‘½ä»¤å°±å¯ä»¥æ‰“åŒ…å’Œå‘å¸ƒ</li>\n</ul>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"å®‰è£…\">å®‰è£…</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å‚è€ƒå®˜æ–¹æ–‡æ¡£<a href=\"https://python-poetry.org/docs/#installation\">Installation</a></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å®˜æ–¹æ¨èä½¿ç”¨pipxå®‰è£…ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨ pip</span></span><br><span class=\"line\">$ pipx install poetry</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹æ˜¯å¦å®‰è£…æˆåŠŸ</span></span><br><span class=\"line\">$ poetry --version</span><br><span class=\"line\">Poetry (version 1.8.4)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ·»åŠ å‘½ä»¤è‡ªåŠ¨è¡¥å…¨</span></span><br><span class=\"line\">$ <span class=\"built_in\">mkdir</span>  ~/.zfunc</span><br><span class=\"line\">$ poetry completions zsh &gt; ~/.zfunc/_poetry</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åœ¨ ~/.zshrc ä¸­æ·»åŠ ä»¥ä¸‹é…ç½®ï¼ˆæˆ‘æ˜¯ç”¨çš„æ˜¯zshï¼Œå…¶ä»–shellå¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼‰</span></span><br><span class=\"line\">fpath+=~/.zfunc</span><br><span class=\"line\"><span class=\"built_in\">autoload</span> -Uz compinit &amp;&amp; compinit</span><br></pre></td></tr></table></figure>\n<div class=\"tips\">\n<p><em><strong>pipxç®€ä»‹</strong></em></p>\n<ul class=\"lvl-1\">\n<li class=\"lvl-2\">\n<p><a href=\"https://github.com/pypa/pipx\">pipx</a> æ˜¯ä¸€ä¸ª Python åŒ…ç®¡ç†å·¥å…·ï¼Œä½¿ç”¨pipxå®‰è£…å·¥å…·åŒ…æ—¶ï¼Œæ¯ä¸ªå·¥å…·éƒ½ä¼šè¢«å®‰è£…åœ¨ä¸€ä¸ªç‹¬ç«‹çš„è™šæ‹Ÿç¯å¢ƒä¸­ï¼Œé¿å…ä¸åŒå·¥å…·ä¹‹é—´çš„ä¾èµ–å†²çªã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>åœºæ™¯ï¼šä¸¤ä¸ªå·¥å…·ä¾èµ–ä¸åŒç‰ˆæœ¬çš„åŒä¸€ä¸ªåº“<br>\nå‡è®¾æˆ‘ä»¬æœ‰ä¸¤ä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼š</p>\n<p>å·¥å…·A ä¾èµ–äº requests åº“çš„ç‰ˆæœ¬ 2.27.1ã€‚<br>\nå·¥å…·B ä¾èµ–äº requests åº“çš„ç‰ˆæœ¬ 2.31.0ã€‚</p>\n<p>å¦‚æœä½¿ç”¨ pip å®‰è£…<br>\nå·¥å…·ä¼šè¢«å®‰è£…åˆ°å…¨å±€ç¯å¢ƒï¼Œå…±äº«ç›¸åŒçš„ä¾èµ–ç‰ˆæœ¬ï¼š</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pip install toolA  <span class=\"comment\"># å®‰è£…æ—¶ä¼šå®‰è£… requests 2.27.1</span></span><br><span class=\"line\">pip install toolB  <span class=\"comment\"># å®‰è£…æ—¶ä¼šå°† requests å‡çº§åˆ° 2.31.0</span></span><br></pre></td></tr></table></figure>\n<p>ç»“æœï¼š<br>\nå½“ä½ è¿è¡Œå·¥å…·Aæ—¶ï¼Œå®ƒå¯èƒ½ä¼šæŠ¥é”™ï¼Œå› ä¸ºå®ƒä¾èµ–çš„ requests 2.27.1 å·²è¢« requests 2.31.0 æ›¿æ¢ã€‚<br>\nå…¨å±€ç¯å¢ƒä¸­çš„æ‰€æœ‰å·¥å…·éƒ½å…±äº«ä¸€ä¸ª requestsï¼Œç‰ˆæœ¬å†²çªä¸å¯é¿å…ã€‚</p>\n<p>å¦‚æœä½¿ç”¨ pipx å®‰è£…<br>\næ¯ä¸ªå·¥å…·ä¼šè¢«å®‰è£…åˆ°ç‹¬ç«‹çš„è™šæ‹Ÿç¯å¢ƒä¸­ï¼Œå„è‡ªçš„ä¾èµ–äº’ä¸å½±å“ï¼š</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pipx install toolA  <span class=\"comment\"># åœ¨è™šæ‹Ÿç¯å¢ƒAä¸­å®‰è£… toolA å’Œ requests 2.27.1</span></span><br><span class=\"line\">pipx install toolB  <span class=\"comment\"># åœ¨è™šæ‹Ÿç¯å¢ƒBä¸­å®‰è£… toolB å’Œ requests 2.31.0</span></span><br></pre></td></tr></table></figure>\n<p>ç»“æœï¼š<br>\nè™šæ‹Ÿç¯å¢ƒA åªåŒ…å« toolA å’Œå®ƒçš„ä¾èµ– requests 2.27.1ã€‚<br>\nè™šæ‹Ÿç¯å¢ƒB åªåŒ…å« toolB å’Œå®ƒçš„ä¾èµ– requests 2.31.0ã€‚<br>\nå·¥å…·ä¹‹é—´å®Œå…¨éš”ç¦»ï¼Œä¸ä¼šå› ä¸ºä¾èµ–ç‰ˆæœ¬å†²çªè€Œå¯¼è‡´é—®é¢˜ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>æ‰€ä»¥ï¼Œå½“éœ€è¦å®‰è£…å…¨å±€å‘½ä»¤è¡Œå·¥å…·æ—¶ï¼Œä½¿ç”¨pipxæ˜¯ä¸ªå¾ˆå¥½çš„é€‰æ‹©</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://github.com/pypa/pipx\">pipx</a> çš„å®‰è£…</p>\n</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å®‰è£…pipx</span></span><br><span class=\"line\">pip install pipx</span><br><span class=\"line\"><span class=\"comment\"># é…ç½®ç¯å¢ƒå˜é‡ï¼Œè¿è¡Œè¯¥å‘½ä»¤ä¼šå°†</span></span><br><span class=\"line\">pipx ensurepath</span><br><span class=\"line\"><span class=\"comment\"># è¿è¡Œä¸Šé¢çš„å‘½ä»¤ä¼šå°†å¦‚ä¸‹å†…å®¹åŠ å…¥ä½ çš„shellé…ç½®æ–‡ä»¶ä¸­ï¼Œæˆ‘çš„æ˜¯ .zshrc æ–‡ä»¶ï¼Œå®é™…ä¸Šä½ ä¹Ÿå¯ä»¥æ‰‹å·¥æ·»åŠ è¯¥é…ç½®ï¼Œå°†$HOME/.local/binæ”¾åˆ°å‰é¢æ›´å¥½ä¸€äº›ã€‚</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> PATH=<span class=\"string\">&quot;<span class=\"variable\">$PATH</span>:<span class=\"variable\">$HOME</span>/.local/bin&quot;</span></span><br><span class=\"line\"><span class=\"comment\"># æ³¨æ„æ·»åŠ å®Œæˆåè¦é‡å¯shell</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ·»åŠ pipxè‡ªåŠ¨ä»£ç è¡¥å…¨</span></span><br><span class=\"line\"><span class=\"comment\"># è¿è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œå¹¶æ ¹æ®æç¤ºå®Œæˆ</span></span><br><span class=\"line\">pipx completions</span><br><span class=\"line\"><span class=\"comment\"># æˆ‘çš„æ˜¯zshï¼Œæ‰€ä»¥åœ¨ .zshrcä¸­æ·»åŠ å¦‚ä¸‹å†…å®¹</span></span><br><span class=\"line\"><span class=\"built_in\">autoload</span> -Uz compinit &amp;&amp; compinit <span class=\"comment\"># å¦‚æœæ²¡æœ‰æ·»åŠ è¿‡å°±éœ€è¦å…ˆæ·»åŠ è¿™ä¸ª</span></span><br><span class=\"line\"><span class=\"built_in\">eval</span> <span class=\"string\">&quot;<span class=\"subst\">$(register-python-argcomplete pipx)</span>&quot;</span> <span class=\"comment\"># æ·»åŠ è‡ªåŠ¨ä»£ç è¡¥å…¨</span></span><br><span class=\"line\"><span class=\"comment\"># æ³¨æ„æ·»åŠ å®Œæˆåè¦é‡å¯shell</span></span><br></pre></td></tr></table></figure>\n</div>\n<h2 id=\"æŸ¥çœ‹æ‰€æœ‰å‘½ä»¤\">æŸ¥çœ‹æ‰€æœ‰å‘½ä»¤</h2>\n<blockquote>\n<p>æˆ‘å·²ç»å°†å…¶ç¿»è¯‘ä¸ºä¸­æ–‡</p>\n</blockquote>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ poetry list</span><br><span class=\"line\">Poetry (ç‰ˆæœ¬ 1.8.4)</span><br><span class=\"line\"></span><br><span class=\"line\">ç”¨æ³•ï¼š</span><br><span class=\"line\">  <span class=\"built_in\">command</span> [é€‰é¡¹] [å‚æ•°]</span><br><span class=\"line\"></span><br><span class=\"line\">é€‰é¡¹ï¼š</span><br><span class=\"line\">  -h, --<span class=\"built_in\">help</span>                 æ˜¾ç¤ºç»™å®šå‘½ä»¤çš„å¸®åŠ©ã€‚å¦‚æœæ²¡æœ‰æŒ‡å®šå‘½ä»¤ï¼Œåˆ™æ˜¾ç¤ºåˆ—è¡¨å‘½ä»¤çš„å¸®åŠ©ã€‚</span><br><span class=\"line\">  -q, --quiet                ä¸è¾“å‡ºä»»ä½•æ¶ˆæ¯ã€‚</span><br><span class=\"line\">  -V, --version              æ˜¾ç¤ºæ­¤åº”ç”¨ç¨‹åºç‰ˆæœ¬ã€‚</span><br><span class=\"line\">      --ansi                å¼ºåˆ¶è¾“å‡ºANSIæ ¼å¼ã€‚</span><br><span class=\"line\">      --no-ansi             ç¦ç”¨ANSIè¾“å‡ºã€‚</span><br><span class=\"line\">  -n, --no-interaction       ä¸è¦æé—®ä»»ä½•äº¤äº’æ€§é—®é¢˜ã€‚</span><br><span class=\"line\">      --no-plugins           ç¦ç”¨æ’ä»¶ã€‚</span><br><span class=\"line\">      --no-cache            ç¦ç”¨æºç¼“å­˜ã€‚</span><br><span class=\"line\">  -C, --directory=ç›®å½•      Poetryå‘½ä»¤çš„å·¥ä½œç›®å½•ï¼ˆé»˜è®¤ä¸ºå½“å‰å·¥ä½œç›®å½•ï¼‰ã€‚</span><br><span class=\"line\">  -v|vv|vvv, --verbose       å¢åŠ æ¶ˆæ¯çš„å†—é•¿åº¦ï¼š1 è¡¨ç¤ºæ­£å¸¸è¾“å‡ºï¼Œ2 è¡¨ç¤ºæ›´è¯¦ç»†çš„è¾“å‡ºï¼Œ3 è¡¨ç¤ºè°ƒè¯•ã€‚</span><br><span class=\"line\"></span><br><span class=\"line\">å¯ç”¨å‘½ä»¤ï¼š</span><br><span class=\"line\">  about              æ˜¾ç¤ºå…³äºPoetryçš„ä¿¡æ¯ã€‚</span><br><span class=\"line\">  add                å°†æ–°ä¾èµ–é¡¹æ·»åŠ åˆ°pyproject.tomlå¹¶å®‰è£…å®ƒã€‚</span><br><span class=\"line\">  build              é»˜è®¤æ„å»ºä¸€ä¸ªåŒ…ï¼Œåˆ†åˆ«æ˜¯tarballå’Œwheelã€‚</span><br><span class=\"line\">  check              éªŒè¯pyproject.tomlæ–‡ä»¶çš„å†…å®¹åŠå…¶ä¸poetry.lockæ–‡ä»¶çš„ä¸€è‡´æ€§ã€‚</span><br><span class=\"line\">  config             ç®¡ç†é…ç½®è®¾ç½®ã€‚</span><br><span class=\"line\">  <span class=\"built_in\">export</span>             å°†é”æ–‡ä»¶å¯¼å‡ºåˆ°å…¶ä»–æ ¼å¼ã€‚</span><br><span class=\"line\">  <span class=\"built_in\">help</span>               æ˜¾ç¤ºç‰¹å®šå‘½ä»¤çš„å¸®åŠ©ã€‚</span><br><span class=\"line\">  init               åœ¨å½“å‰ç›®å½•åˆ›å»ºä¸€ä¸ªåŸºç¡€çš„pyproject.tomlæ–‡ä»¶ã€‚</span><br><span class=\"line\">  install            å®‰è£…é¡¹ç›®ä¾èµ–é¡¹ã€‚</span><br><span class=\"line\">  list               åˆ—å‡ºå‘½ä»¤ã€‚</span><br><span class=\"line\">  lock              é”å®šé¡¹ç›®ä¾èµ–é¡¹ã€‚</span><br><span class=\"line\">  new               åœ¨&lt;path&gt;å¤„åˆ›å»ºä¸€ä¸ªæ–°çš„Pythoné¡¹ç›®ã€‚</span><br><span class=\"line\">  publish           å°†åŒ…å‘å¸ƒåˆ°è¿œç¨‹ä»“åº“ã€‚</span><br><span class=\"line\">  remove            ä»é¡¹ç›®ä¾èµ–é¡¹ä¸­ç§»é™¤åŒ…ã€‚</span><br><span class=\"line\">  run                åœ¨é€‚å½“çš„ç¯å¢ƒä¸­è¿è¡Œå‘½ä»¤ã€‚</span><br><span class=\"line\">  search            åœ¨è¿œç¨‹ä»“åº“ä¸­æœç´¢åŒ…ã€‚</span><br><span class=\"line\">  shell            åœ¨è™šæ‹Ÿç¯å¢ƒä¸­å¯åŠ¨shellã€‚</span><br><span class=\"line\">  show              æ˜¾ç¤ºæœ‰å…³åŒ…çš„ä¿¡æ¯ã€‚</span><br><span class=\"line\">  update            æ ¹æ®pyproject.tomlæ–‡ä»¶æ›´æ–°ä¾èµ–é¡¹ã€‚</span><br><span class=\"line\">  version           æ˜¾ç¤ºé¡¹ç›®çš„ç‰ˆæœ¬æˆ–åœ¨æä¾›æœ‰æ•ˆç‰ˆæœ¬è§„åˆ™æ—¶æ›´æ–°å®ƒã€‚</span><br><span class=\"line\"></span><br><span class=\"line\">ç¼“å­˜</span><br><span class=\"line\">  cache clear        æŒ‰åç§°æ¸…é™¤Poetryç¼“å­˜ã€‚</span><br><span class=\"line\">  cache list         åˆ—å‡ºPoetryçš„ç¼“å­˜åˆ—è¡¨ã€‚</span><br><span class=\"line\"></span><br><span class=\"line\">è°ƒè¯•</span><br><span class=\"line\">  debug info        æ˜¾ç¤ºè°ƒè¯•ä¿¡æ¯ã€‚</span><br><span class=\"line\">  debug resolve    è°ƒè¯•ä¾èµ–é¡¹è§£æã€‚</span><br><span class=\"line\"></span><br><span class=\"line\">ç¯å¢ƒ</span><br><span class=\"line\">  <span class=\"built_in\">env</span> info         æ˜¾ç¤ºå½“å‰ç¯å¢ƒçš„ä¿¡æ¯ã€‚</span><br><span class=\"line\">  <span class=\"built_in\">env</span> list          åˆ—å‡ºä¸å½“å‰é¡¹ç›®å…³è”çš„æ‰€æœ‰è™šæ‹Ÿç¯å¢ƒã€‚</span><br><span class=\"line\">  <span class=\"built_in\">env</span> remove        ç§»é™¤ä¸é¡¹ç›®å…³è”çš„è™šæ‹Ÿç¯å¢ƒã€‚</span><br><span class=\"line\">  <span class=\"built_in\">env</span> use           æ¿€æ´»æˆ–åˆ›å»ºå½“å‰é¡¹ç›®çš„æ–°çš„è™šæ‹Ÿç¯å¢ƒã€‚</span><br><span class=\"line\"></span><br><span class=\"line\">è‡ªèº«</span><br><span class=\"line\">  self add          å‘Poetryçš„è¿è¡Œæ—¶ç¯å¢ƒæ·»åŠ å…¶ä»–åŒ…ã€‚</span><br><span class=\"line\">  self install      å®‰è£…æ­¤Poetryå®‰è£…æ‰€éœ€çš„é”å®šåŒ…ï¼ˆåŒ…æ‹¬æ’ä»¶ï¼‰ã€‚</span><br><span class=\"line\">  self lock         é”å®šPoetryå®‰è£…çš„ç³»ç»Ÿè¦æ±‚ã€‚</span><br><span class=\"line\">  self remove       ä»Poetryçš„è¿è¡Œæ—¶ç¯å¢ƒä¸­ç§»é™¤å…¶ä»–åŒ…ã€‚</span><br><span class=\"line\">  self show         æ˜¾ç¤ºPoetryè¿è¡Œæ—¶ç¯å¢ƒä¸­çš„åŒ…ã€‚</span><br><span class=\"line\">  self show plugins æ˜¾ç¤ºå½“å‰å·²å®‰è£…æ’ä»¶çš„ä¿¡æ¯ã€‚</span><br><span class=\"line\">  self update       æ›´æ–°Poetryåˆ°æœ€æ–°ç‰ˆæœ¬ã€‚</span><br><span class=\"line\"></span><br><span class=\"line\">æº</span><br><span class=\"line\">  <span class=\"built_in\">source</span> add         ä¸ºé¡¹ç›®æ·»åŠ æºé…ç½®ã€‚</span><br><span class=\"line\">  <span class=\"built_in\">source</span> remove      ç§»é™¤ä¸ºé¡¹ç›®é…ç½®çš„æºã€‚</span><br><span class=\"line\">  <span class=\"built_in\">source</span> show        æ˜¾ç¤ºä¸ºé¡¹ç›®é…ç½®çš„æºä¿¡æ¯ã€‚</span><br></pre></td></tr></table></figure>\n<h2 id=\"å¸¸ç”¨å‘½ä»¤\">å¸¸ç”¨å‘½ä»¤</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¿™é‡Œåªå¯¹æ—¥å¸¸å¼€å‘ä¸­æ¯”è¾ƒå¸¸ç”¨çš„å‘½ä»¤è¿›è¡Œç®€è¦è¯´æ˜ï¼Œè¯¦ç»†ä»‹ç»å¯ä»¥å‚è€ƒ<a href=\"https://python-poetry.org/docs/\">å®˜æ–¹æ–‡æ¡£</a></p>\n</li>\n</ul>\n<h3 id=\"new-åˆ›å»ºé¡¹ç›®\">new : åˆ›å»ºé¡¹ç›®</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æŒ‰ç…§é»˜è®¤è§„åˆ™åˆ›å»ºä¸€ä¸ªåŸºäº poetry çš„é¡¹ç›®</span></span><br><span class=\"line\">$ poetry new my-project</span><br><span class=\"line\">Created package my_project <span class=\"keyword\">in</span> my-project</span><br><span class=\"line\">$ <span class=\"built_in\">cd</span> my-project</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹ç”Ÿæˆçš„ç›®å½•ç»“æ„</span></span><br><span class=\"line\">$ exa -T</span><br><span class=\"line\">.</span><br><span class=\"line\">â”œâ”€â”€ my_project</span><br><span class=\"line\">â”‚  â””â”€â”€ __init__.py</span><br><span class=\"line\">â”œâ”€â”€ pyproject.toml</span><br><span class=\"line\">â”œâ”€â”€ README.md</span><br><span class=\"line\">â””â”€â”€ tests</span><br><span class=\"line\">   â””â”€â”€ __init__.py</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹ pyproject.toml å†…å®¹ï¼Œè¯¥æ–‡ä»¶ä¸ºé¡¹ç›®çš„é…ç½®çš„é…ç½®æ–‡ä»¶</span></span><br><span class=\"line\">$ more pyproject.toml</span><br><span class=\"line\">[tool.poetry]</span><br><span class=\"line\">name = <span class=\"string\">&quot;my-project&quot;</span></span><br><span class=\"line\">version = <span class=\"string\">&quot;0.1.0&quot;</span></span><br><span class=\"line\">description = <span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\">authors = [<span class=\"string\">&quot;hanqunfeng &lt;hanqf2008@163.com&gt;&quot;</span>]</span><br><span class=\"line\">readme = <span class=\"string\">&quot;README.md&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">[tool.poetry.dependencies]</span><br><span class=\"line\">python = <span class=\"string\">&quot;^3.11&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">[build-system]</span><br><span class=\"line\">requires = [<span class=\"string\">&quot;poetry-core&quot;</span>]</span><br><span class=\"line\">build-backend = <span class=\"string\">&quot;poetry.core.masonry.api&quot;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"init-åˆå§‹åŒ–ä¸€ä¸ªå·²æœ‰çš„é¡¹ç›®ç›®å½•\">init : åˆå§‹åŒ–ä¸€ä¸ªå·²æœ‰çš„é¡¹ç›®ç›®å½•</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å‡è®¾æˆ‘ä»¬å·²ç»æœ‰ä¸ªé¡¹ç›®ç›®å½•ï¼Œç›®å½•åç§°ä¸º poetryDemo</span></span><br><span class=\"line\">$ <span class=\"built_in\">cd</span> poetryDemo</span><br><span class=\"line\"><span class=\"comment\"># åˆå§‹åŒ– poetryDemo ï¼Œåœ¨å½“å‰ç›®å½•ä¸‹åˆ›å»º pyproject.toml æ–‡ä»¶ï¼Œæ³¨æ„è¯¥æ“ä½œåªä¼šåˆ›å»ºè¯¥æ–‡ä»¶ï¼ŒåŒ…ç›®å½•ä»¥åŠreadmeæ–‡ä»¶éƒ½æ²¡æœ‰ï¼Œéœ€è¦æ‰‹å·¥åˆ›å»º</span></span><br><span class=\"line\">$ poetry init</span><br><span class=\"line\">This <span class=\"built_in\">command</span> will guide you through creating your pyproject.toml config.</span><br><span class=\"line\"></span><br><span class=\"line\">Package name [poetrydemo]:  <span class=\"comment\"># åŒ…åç§°</span></span><br><span class=\"line\">Version [0.1.0]:  <span class=\"comment\"># ç‰ˆæœ¬å·</span></span><br><span class=\"line\">Description []:   <span class=\"comment\"># æè¿°ä¿¡æ¯</span></span><br><span class=\"line\">Author [hanqunfeng &lt;hanqf2008@163.com&gt;, n to skip]:  <span class=\"comment\"># ä½œè€…</span></span><br><span class=\"line\">License []:  <span class=\"comment\"># License</span></span><br><span class=\"line\">Compatible Python versions [^3.11]:  <span class=\"comment\"># python ç‰ˆæœ¬</span></span><br><span class=\"line\"></span><br><span class=\"line\">Would you like to define your main dependencies interactively? (<span class=\"built_in\">yes</span>/no) [<span class=\"built_in\">yes</span>] <span class=\"comment\"># æ‚¨æƒ³ä»¥äº¤äº’æ–¹å¼å®šä¹‰æ‚¨çš„ä¸»ç¯å¢ƒä¾èµ–å…³ç³»å—ï¼Ÿé»˜è®¤yes</span></span><br><span class=\"line\">You can specify a package <span class=\"keyword\">in</span> the following forms:  <span class=\"comment\"># æ‚¨å¯ä»¥æŒ‰ä»¥ä¸‹å½¢å¼æŒ‡å®šåŒ…ï¼š</span></span><br><span class=\"line\">  - A single name (requests): this will search <span class=\"keyword\">for</span> matches on PyPI <span class=\"comment\"># å•ä¸ªåç§°ï¼ˆrequestsï¼‰ï¼šè¿™å°†åœ¨å®˜æ–¹ä»“åº“PyPIä¸Šæœç´¢åŒ¹é…é¡¹ï¼Œå¦‚æœæŒ‡å®šäº†å…¶å®ƒé•œåƒæºå°±ä¼šä»æŒ‡å®šçš„æºä¸‹è½½</span></span><br><span class=\"line\">  - A name and a constraint (requests@^2.23.0) <span class=\"comment\"># åç§°å’Œç‰ˆæœ¬çº¦æŸ</span></span><br><span class=\"line\">  - A git url (git+https://github.com/python-poetry/poetry.git) <span class=\"comment\"># gitåœ°å€</span></span><br><span class=\"line\">  - A git url with a revision (git+https://github.com/python-poetry/poetry.git#develop) <span class=\"comment\"># gitåœ°å€ï¼ŒæŒ‡å®šæŸä¸ªåˆ†æ”¯</span></span><br><span class=\"line\">  - A file path (../my-package/my-package.whl) <span class=\"comment\"># æ–‡ä»¶è·¯å¾„</span></span><br><span class=\"line\">  - A directory (../my-package/) <span class=\"comment\"># ç›®å½•è·¯å¾„</span></span><br><span class=\"line\">  - A url (https://example.com/packages/my-package-0.1.0.tar.gz) <span class=\"comment\"># ä¸€ä¸ªå®‰è£…åŒ…çš„åœ°å€</span></span><br><span class=\"line\"></span><br><span class=\"line\">Package to add or search <span class=\"keyword\">for</span> (leave blank to skip): <span class=\"comment\"># æ·»åŠ ä¸»ç¯å¢ƒä¾èµ–ï¼ŒæŒ‰ä¸Šé¢çš„æ ¼å¼è¦æ±‚å¡«å†™</span></span><br><span class=\"line\"></span><br><span class=\"line\">Would you like to define your development dependencies interactively? (<span class=\"built_in\">yes</span>/no) [<span class=\"built_in\">yes</span>] <span class=\"comment\"># æ‚¨æƒ³ä»¥äº¤äº’æ–¹å¼å®šä¹‰æ‚¨çš„å¼€å‘ä¾èµ–å…³ç³»å—ï¼Ÿé»˜è®¤yes</span></span><br><span class=\"line\">Package to add or search <span class=\"keyword\">for</span> (leave blank to skip): <span class=\"comment\"># æ·»åŠ å¼€å‘ç¯å¢ƒä¾èµ–ï¼ŒæŒ‰ä¸Šé¢çš„æ ¼å¼è¦æ±‚å¡«å†™</span></span><br><span class=\"line\"></span><br><span class=\"line\">Generated file</span><br><span class=\"line\"><span class=\"comment\"># è¦ç”Ÿæˆçš„ pyproject.toml å†…å®¹</span></span><br><span class=\"line\">[tool.poetry]</span><br><span class=\"line\">name = <span class=\"string\">&quot;poetrydemo&quot;</span>  <span class=\"comment\"># åŒ…åç§°</span></span><br><span class=\"line\">version = <span class=\"string\">&quot;0.1.0&quot;</span>    <span class=\"comment\"># ç‰ˆæœ¬</span></span><br><span class=\"line\">description = <span class=\"string\">&quot;&quot;</span>     <span class=\"comment\"># æè¿°ä¿¡æ¯</span></span><br><span class=\"line\">authors = [<span class=\"string\">&quot;hanqunfeng &lt;hanqf2008@163.com&gt;&quot;</span>] <span class=\"comment\"># ä½œè€…ä¿¡æ¯</span></span><br><span class=\"line\">readme = <span class=\"string\">&quot;README.md&quot;</span> <span class=\"comment\"># è¯´æ˜æ–‡ä»¶</span></span><br><span class=\"line\"></span><br><span class=\"line\">[tool.poetry.dependencies] <span class=\"comment\"># ä¸»ç¯å¢ƒä¾èµ–</span></span><br><span class=\"line\">python = <span class=\"string\">&quot;^3.11&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">[build-system]</span><br><span class=\"line\">requires = [<span class=\"string\">&quot;poetry-core&quot;</span>]</span><br><span class=\"line\">build-backend = <span class=\"string\">&quot;poetry.core.masonry.api&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">Do you confirm generation? (<span class=\"built_in\">yes</span>/no) [<span class=\"built_in\">yes</span>] <span class=\"comment\"># ç¡®è®¤æ˜¯å¦æŒ‰ç…§ä¸Šé¢çš„å†…å®¹åˆ›å»º pyproject.toml æ–‡ä»¶ï¼Œé»˜è®¤yes</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¸Šé¢çš„æ–¹å¼åœ¨åˆå§‹åŒ–æ—¶ä¼šè¯¢é—®ä½ ç›¸å…³çš„ä¿¡æ¯ï¼Œå¦‚æœä½ å¸Œæœ›éƒ½ç”¨é»˜è®¤å€¼çš„è¯ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">poetry init -n</span><br></pre></td></tr></table></figure>\n<h3 id=\"config-poetryçš„å…¨å±€é…ç½®\">config : poetryçš„å…¨å±€é…ç½®</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æŸ¥çœ‹å…¨å±€é…ç½®</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ poetry config --list</span><br><span class=\"line\">cache-dir = <span class=\"string\">&quot;/Users/hanqf/Library/Caches/pypoetry&quot;</span>  <span class=\"comment\"># ç¼“å­˜ç›®å½•,ç”¨äºå­˜å‚¨é¡¹ç›®ä¾èµ–å’Œè™šæ‹Ÿç¯å¢ƒç­‰ç¼“å­˜ä¿¡æ¯ã€‚</span></span><br><span class=\"line\">experimental.system-git-client = <span class=\"literal\">false</span>              <span class=\"comment\"># æ˜¯å¦ä½¿ç”¨ç³»ç»Ÿè‡ªå¸¦çš„gitå®¢æˆ·ç«¯,falseè¡¨ç¤ºä½¿ç”¨Poetryå†…ç½®çš„gitå®¢æˆ·ç«¯</span></span><br><span class=\"line\">installer.max-workers = null                        <span class=\"comment\"># å®‰è£…ä¾èµ–æ—¶çš„æœ€å¤§çº¿ç¨‹æ•°,nullè¡¨ç¤ºä½¿ç”¨é»˜è®¤çº¿ç¨‹æ•°ï¼Œå¯ä»¥è®¾ç½®ä¸ºcpuæ ¸æ•°+4</span></span><br><span class=\"line\">installer.modern-installation = <span class=\"literal\">true</span>                <span class=\"comment\"># æ˜¯å¦ä½¿ç”¨Poetryçš„ç°ä»£å®‰è£…æ–¹æ¡ˆ,trueè¡¨ç¤ºä½¿ç”¨</span></span><br><span class=\"line\">installer.no-binary = null                          <span class=\"comment\"># æ˜¯å¦ä¸ä½¿ç”¨é¢„ç¼–è¯‘çš„äºŒè¿›åˆ¶åŒ…,nullè¡¨ç¤ºä¸é™åˆ¶</span></span><br><span class=\"line\">installer.parallel = <span class=\"literal\">true</span>                           <span class=\"comment\"># æ˜¯å¦å¹¶è¡Œå®‰è£…ä¾èµ–,trueè¡¨ç¤ºå¹¶è¡Œå®‰è£…</span></span><br><span class=\"line\">keyring.enabled = <span class=\"literal\">true</span>                              <span class=\"comment\"># æ˜¯å¦å¯ç”¨å¯†é’¥ç¯ï¼ˆkeyringï¼‰ä»¥ä¿å­˜è®¤è¯ä¿¡æ¯ã€‚true è¡¨ç¤ºå¯ç”¨ã€‚</span></span><br><span class=\"line\">solver.lazy-wheel = <span class=\"literal\">true</span>                            <span class=\"comment\"># æ˜¯å¦å»¶è¿Ÿè§£æ wheel åŒ…ã€‚true è¡¨ç¤ºå»¶è¿Ÿè§£æã€‚</span></span><br><span class=\"line\">virtualenvs.create = <span class=\"literal\">true</span>                           <span class=\"comment\"># æ˜¯å¦è‡ªåŠ¨åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ,trueè¡¨ç¤ºåˆ›å»º</span></span><br><span class=\"line\">virtualenvs.in-project = null                       <span class=\"comment\"># æ˜¯å¦åœ¨é¡¹ç›®å†…åˆ›å»ºè™šæ‹Ÿç¯å¢ƒï¼Œnull è¡¨ç¤ºä½¿ç”¨é»˜è®¤å€¼ï¼ˆé€šå¸¸ä¸º falseï¼‰ï¼Œå³ä¸åœ¨é¡¹ç›®ä¸­åˆ›å»ºã€‚trueè¡¨ç¤ºåœ¨é¡¹ç›®ä¸­åˆ›å»º</span></span><br><span class=\"line\">virtualenvs.options.always-copy = <span class=\"literal\">false</span>             <span class=\"comment\"># å¦‚æœè®¾ç½®ä¸º trueï¼ŒPoetry ä¼šå§‹ç»ˆå¤åˆ¶æ–‡ä»¶åˆ°è™šæ‹Ÿç¯å¢ƒä¸­ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ç¬¦å·é“¾æ¥ï¼ˆsymlinksï¼‰ã€‚è¿™å¯ä»¥é¿å…æŸäº›ç³»ç»Ÿä¸Šçš„æƒé™é—®é¢˜ï¼Œä½†ä¼šå¢åŠ è™šæ‹Ÿç¯å¢ƒçš„å­˜å‚¨éœ€æ±‚ã€‚</span></span><br><span class=\"line\">virtualenvs.options.no-pip = <span class=\"literal\">false</span>                  <span class=\"comment\"># å¦‚æœè®¾ç½®ä¸º trueï¼ŒPoetry åœ¨åˆ›å»ºè™šæ‹Ÿç¯å¢ƒæ—¶ä¸ä¼šå®‰è£… pipã€‚å¦‚æœä½ çš„é¡¹ç›®ä¸éœ€è¦ç›´æ¥ä½¿ç”¨ pipï¼Œå¹¶ä¸”ä½ å¸Œæœ›é€šè¿‡ Poetry ç®¡ç†æ‰€æœ‰çš„ä¾èµ–é¡¹ï¼Œå¯ä»¥å°† no-pip è®¾ç½®ä¸º trueï¼Œä»¥å‡å°‘è™šæ‹Ÿç¯å¢ƒä¸­çš„ä¸å¿…è¦çš„ä¾èµ–é¡¹ã€‚</span></span><br><span class=\"line\">virtualenvs.options.no-setuptools = <span class=\"literal\">false</span>           <span class=\"comment\"># å¦‚æœè®¾ç½®ä¸º trueï¼ŒPoetry åœ¨åˆ›å»ºè™šæ‹Ÿç¯å¢ƒæ—¶ä¸ä¼šå®‰è£… setuptoolsã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒPoetry ä¼šå®‰è£… pip å’Œ setuptoolsï¼Œä»¥ä¾¿ä½ å¯ä»¥ä½¿ç”¨è¿™äº›å·¥å…·æ¥ç®¡ç†ä¾èµ–é¡¹ã€‚</span></span><br><span class=\"line\">virtualenvs.options.system-site-packages = <span class=\"literal\">false</span>    <span class=\"comment\"># é»˜è®¤å€¼falseï¼Œæ­¤æ—¶ Poetry åˆ›å»ºçš„è™šæ‹Ÿç¯å¢ƒå°†ä¸ä¼šåŒ…å«å…¨å±€ Python å®‰è£…çš„ site-packages ç›®å½•ä¸­çš„åŒ…ã€‚è¿™æœ‰åŠ©äºç¡®ä¿é¡¹ç›®ä¾èµ–é¡¹çš„éš”ç¦»æ€§ï¼Œé¿å…ä¸ç³»ç»Ÿä¸­çš„å…¶ä»–åŒ…å‘ç”Ÿå†²çªã€‚</span></span><br><span class=\"line\">virtualenvs.path = <span class=\"string\">&quot;&#123;cache-dir&#125;/virtualenvs&quot;</span>  <span class=\"comment\"># /Users/hanqf/Library/Caches/pypoetry/virtualenvs # è™šæ‹Ÿç¯å¢ƒå­˜æ”¾çš„è·¯å¾„ï¼Œå¦‚æœvirtualenvs.in-projectè®¾ç½®ä¸ºtrueï¼Œå°±åªä¼šåœ¨é¡¹ç›®ä¸­åˆ›å»º</span></span><br><span class=\"line\">virtualenvs.prefer-active-python = <span class=\"literal\">false</span>            <span class=\"comment\"># æ˜¯å¦ä¼˜å…ˆä½¿ç”¨ç³»ç»Ÿæ¿€æ´»çš„Pythonè§£é‡Šå™¨</span></span><br><span class=\"line\">virtualenvs.prompt = <span class=\"string\">&quot;&#123;project_name&#125;-py&#123;python_version&#125;&quot;</span>  <span class=\"comment\"># è™šæ‹Ÿç¯å¢ƒçš„å‘½ä»¤æç¤ºæ ¼å¼</span></span><br><span class=\"line\">warnings.export = <span class=\"literal\">true</span>                              <span class=\"comment\"># æ˜¯å¦åœ¨å¯¼å‡ºæ—¶æ˜¾ç¤ºè­¦å‘Šä¿¡æ¯ã€‚true è¡¨ç¤ºæ˜¾ç¤º</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¿®æ”¹å…¨å±€é…ç½®</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ä¿®æ”¹å…¨å±€é…ç½®ï¼Œæ­¤åä¼šåœ¨é¡¹ç›®ç›®å½•ä¸‹åˆ›å»º .venv ç›®å½•å­˜æ”¾è™šæ‹Ÿç¯å¢ƒ</span></span><br><span class=\"line\">$ poetry config virtualenvs.in-project <span class=\"literal\">true</span></span><br><span class=\"line\"><span class=\"comment\"># è¿›å…¥è™šæ‹Ÿç¯å¢ƒï¼Œå¦‚æœè™šæ‹Ÿç¯å¢ƒå°šæœªåˆ›å»ºä¼šè‡ªåŠ¨åˆ›å»º</span></span><br><span class=\"line\">$ poetry shell</span><br><span class=\"line\"><span class=\"comment\"># é€€å‡ºè™šæ‹Ÿç¯å¢ƒ</span></span><br><span class=\"line\">$ <span class=\"built_in\">exit</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åªå¯¹å½“å‰é¡¹ç›®æœ‰æ•ˆï¼Œæ­¤æ—¶ä¼šåœ¨å½“å‰é¡¹ç›®ç›®å½•ä¸‹åˆ›å»º poetry.toml æ¥ä¿å­˜è¿™äº›é…ç½®ä¿¡æ¯</span></span><br><span class=\"line\">$ poetry config virtualenvs.in-project <span class=\"literal\">true</span> --<span class=\"built_in\">local</span></span><br><span class=\"line\">$ poetry config virtualenvs.options.system-site-packages <span class=\"literal\">true</span> --<span class=\"built_in\">local</span></span><br><span class=\"line\">$ more poetry.toml</span><br><span class=\"line\">[virtualenvs]</span><br><span class=\"line\">in-project = <span class=\"literal\">true</span></span><br><span class=\"line\">[virtualenvs.options]</span><br><span class=\"line\">system-site-packages = <span class=\"literal\">true</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># è¿™é‡Œè¦æ³¨æ„ virtualenvs ä¸‹çš„å±æ€§å¿…é¡»åœ¨åˆ›å»ºè™šæ‹Ÿç¯å¢ƒå‰è®¾ç½®æ‰ä¼šæœ‰æ•ˆ</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"env-è™šæ‹Ÿç¯å¢ƒç®¡ç†\">env : è™šæ‹Ÿç¯å¢ƒç®¡ç†</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Poetry ä¼šåœ¨ä½ ç¬¬ä¸€æ¬¡è¿è¡ŒæŸäº›å‘½ä»¤ï¼ˆå¦‚ <code>poetry shell</code> æˆ–è€… <code>poetry add somepackage</code>ï¼‰æ—¶è‡ªåŠ¨åˆ›å»ºè™šæ‹Ÿç¯å¢ƒã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä¸è¿‡è¿™ç§æ—¶å€™éƒ½æ˜¯ä½¿ç”¨ç³»ç»Ÿé»˜è®¤çš„pythonæ¥åˆ›å»ºè™šæ‹Ÿç¯å¢ƒï¼Œå¦‚æœç³»ç»Ÿä¸­å®‰è£…äº†å¤šä¸ªpythonï¼Œåˆ™å¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹å¼è®¾ç½®è™šæ‹Ÿç¯å¢ƒè¦ä½¿ç”¨å“ªä¸ªpythonç‰ˆæœ¬</p>\n</li>\n<li class=\"lvl-2\">\n<p>åˆ›å»º/åˆ‡æ¢è™šæ‹Ÿç¯å¢ƒ</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æŒ‡å®špythonçš„ç‰ˆæœ¬ï¼Œè¿™ä¼šä»pythonçš„é»˜è®¤å®‰è£…è·¯å¾„ä¸‹æŸ¥æ‰¾å¯¹åº”çš„ç‰ˆæœ¬</span></span><br><span class=\"line\"><span class=\"comment\"># æ¯”å¦‚macOsä¼šä»è¯¥è·¯å¾„ä¸‹æŸ¥æ‰¾ï¼š/Library/Frameworks/Python.framework/Versions</span></span><br><span class=\"line\">$ poetry <span class=\"built_in\">env</span> use 3.11</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å¦‚æœå¯ä»¥ç›´æ¥åœ¨å‘½ä»¤è¡Œä½¿ç”¨pythonå‘½ä»¤,æ¯”å¦‚ï¼špython3.12 -Vï¼Œåˆ™å¯ä»¥ä½¿ç”¨å¦‚ä¸‹æ–¹å¼åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ</span></span><br><span class=\"line\">$ poetry <span class=\"built_in\">env</span> use python3.12</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å¦‚æœpythonå®‰è£…åˆ°äº†å…¶å®ƒè·¯å¾„ï¼Œå¯ä»¥æŒ‡å®špythonå®‰è£…è·¯å¾„</span></span><br><span class=\"line\">$ poetry <span class=\"built_in\">env</span> use /pythonDir/3.13/bin/python3</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æŸ¥çœ‹å½“å‰é¡¹ç›®çš„è™šæ‹Ÿç¯å¢ƒä¿¡æ¯</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åˆ›å»ºä¸€ä¸ªåŸºäº python3.13 çš„è™šæ‹Ÿç¯å¢ƒ</span></span><br><span class=\"line\">$ poetry <span class=\"built_in\">env</span> use python3.13</span><br><span class=\"line\">Creating virtualenv poetrydemo-fyqYbfje-py3.13 <span class=\"keyword\">in</span> /Users/hanqf/Library/Caches/pypoetry/virtualenvs</span><br><span class=\"line\">Using virtualenv: /Users/hanqf/Library/Caches/pypoetry/virtualenvs/poetrydemo-fyqYbfje-py3.13</span><br><span class=\"line\"><span class=\"comment\"># å†åˆ›å»ºä¸€ä¸ªåŸºäº python3.11 çš„è™šæ‹Ÿç¯å¢ƒï¼Œæœ€åè¢«useçš„å¤„äºé»˜è®¤æ¿€æ´»çŠ¶æ€</span></span><br><span class=\"line\">$ poetry <span class=\"built_in\">env</span> use python3.11</span><br><span class=\"line\">Creating virtualenv poetrydemo-fyqYbfje-py3.11 <span class=\"keyword\">in</span> /Users/hanqf/Library/Caches/pypoetry/virtualenvs</span><br><span class=\"line\">Using virtualenv: /Users/hanqf/Library/Caches/pypoetry/virtualenvs/poetrydemo-fyqYbfje-py3.11</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹å½“å‰é¡¹ç›®æœ‰å¤šå°‘ä¸ªè™šæ‹Ÿç¯å¢ƒ</span></span><br><span class=\"line\">$ poetry <span class=\"built_in\">env</span> list</span><br><span class=\"line\">poetrydemo-fyqYbfje-py3.11 (Activated) <span class=\"comment\"># poetrydemo-fyqYbfje-py3.11 è¡¨ç¤ºè™šæ‹Ÿç¯å¢ƒåç§°ï¼ŒActivatedè¡¨ç¤ºå½“å‰è™šæ‹Ÿç¯å¢ƒå·²ç»è¢«æ¿€æ´»</span></span><br><span class=\"line\">poetrydemo-fyqYbfje-py3.13</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹è™šæ‹ŸåŒ–ç¯å¢ƒè·¯å¾„</span></span><br><span class=\"line\">$ poetry <span class=\"built_in\">env</span> list  --full-path</span><br><span class=\"line\">/Users/hanqf/Library/Caches/pypoetry/virtualenvs/poetrydemo-fyqYbfje-py3.11 (Activated)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹å½“å‰æ¿€æ´»çš„è™šæ‹Ÿç¯å¢ƒä¿¡æ¯</span></span><br><span class=\"line\">$ poetry <span class=\"built_in\">env</span> info</span><br><span class=\"line\"></span><br><span class=\"line\">Virtualenv</span><br><span class=\"line\">Python:         3.11.3</span><br><span class=\"line\">Implementation: CPython</span><br><span class=\"line\">Path:           /Users/hanqf/Library/Caches/pypoetry/virtualenvs/poetrydemo-fyqYbfje-py3.11</span><br><span class=\"line\">Executable:     /Users/hanqf/Library/Caches/pypoetry/virtualenvs/poetrydemo-fyqYbfje-py3.11/bin/python</span><br><span class=\"line\">Valid:          True</span><br><span class=\"line\"></span><br><span class=\"line\">Base</span><br><span class=\"line\">Platform:   darwin</span><br><span class=\"line\">OS:         posix</span><br><span class=\"line\">Python:     3.11.3</span><br><span class=\"line\">Path:       /Library/Frameworks/Python.framework/Versions/3.11</span><br><span class=\"line\">Executable: /Library/Frameworks/Python.framework/Versions/3.11/bin/python3.11</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åˆ é™¤è™šæ‹Ÿç¯å¢ƒ</span></span><br><span class=\"line\">$ poetry <span class=\"built_in\">env</span> remove python3.13</span><br><span class=\"line\">Deleted virtualenv: /Users/hanqf/Library/Caches/pypoetry/virtualenvs/poetrydemo-fyqYbfje-py3.13</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åˆ é™¤å…¨éƒ¨è™šæ‹Ÿç¯å¢ƒ</span></span><br><span class=\"line\">$ poetry <span class=\"built_in\">env</span> remove --all</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ³¨æ„ï¼Œå½“<code>virtualenvs.in-project</code>è¢«è®¾ç½®ä¸º<code>true</code>æ—¶ï¼Œå³åªåœ¨é¡¹ç›®ç›®å½•ä¸‹åˆ›å»ºè™šæ‹Ÿç¯å¢ƒæ—¶ï¼Œåªä¼šä¿ç•™ä¸€ä¸ªç¯å¢ƒï¼Œå³<code>.venv</code></p>\n</li>\n<li class=\"lvl-2\">\n<p>åˆ‡æ¢åˆ°æ–°çš„è™šæ‹Ÿç¯å¢ƒæ—¶ä¼šå…¨æ–°åˆ›å»ºä¸€ä¸ªæ–°çš„ç¯å¢ƒï¼ŒåŸå…ˆçš„ç¯å¢ƒä¼šè¢«åˆ é™¤ï¼Œæ‰€ä»¥è¦ä½¿ç”¨<code>poetry install</code>å‘½ä»¤é‡æ–°å®‰è£…ä¾èµ–</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">$ poetry <span class=\"built_in\">env</span> use python3.11</span><br><span class=\"line\">Recreating virtualenv poetrydemo <span class=\"keyword\">in</span> /Users/hanqf/Desktop/pythonDir/poetryDir/poetryDemo/.venv</span><br><span class=\"line\">Using virtualenv: /Users/hanqf/Desktop/pythonDir/poetryDir/poetryDemo/.venv</span><br><span class=\"line\"></span><br><span class=\"line\">$ poetry <span class=\"built_in\">env</span> list <span class=\"comment\"># è™½ç„¶å¯ä»¥é€šè¿‡ poetry env use çš„æ–¹å¼æ¥åˆ›å»ºæ–°çš„è™šæ‹Ÿç¯å¢ƒï¼Œä½†å®é™…ä¸Šåªä¼šæœ‰ä¸€ä¸ªç¯å¢ƒè¢«ä¿ç•™ï¼Œæ‰€ä»¥è¿™é‡Œåªä¼šæ˜¾ç¤ºä¸€ä¸ª</span></span><br><span class=\"line\">.venv (Activated) <span class=\"comment\"># .venv è¡¨ç¤ºè™šæ‹Ÿç¯å¢ƒåç§°ï¼ŒActivatedè¡¨ç¤ºå½“å‰è™šæ‹Ÿç¯å¢ƒå·²ç»è¢«æ¿€æ´»</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹è™šæ‹Ÿç¯å¢ƒä¿¡æ¯</span></span><br><span class=\"line\">$ poetry <span class=\"built_in\">env</span> info</span><br><span class=\"line\"></span><br><span class=\"line\">Virtualenv</span><br><span class=\"line\">Python:         3.11.3</span><br><span class=\"line\">Implementation: CPython</span><br><span class=\"line\">Path:           /Users/hanqf/Desktop/pythonDir/poetryDir/poetryDemo/.venv</span><br><span class=\"line\">Executable:     /Users/hanqf/Desktop/pythonDir/poetryDir/poetryDemo/.venv/bin/python</span><br><span class=\"line\">Valid:          True</span><br><span class=\"line\"></span><br><span class=\"line\">Base</span><br><span class=\"line\">Platform:   darwin</span><br><span class=\"line\">OS:         posix</span><br><span class=\"line\">Python:     3.11.3</span><br><span class=\"line\">Path:       /Library/Frameworks/Python.framework/Versions/3.11</span><br><span class=\"line\">Executable: /Library/Frameworks/Python.framework/Versions/3.11/bin/python3.11</span><br></pre></td></tr></table></figure>\n<h3 id=\"ä¾èµ–åŒ…ç®¡ç†\">ä¾èµ–åŒ…ç®¡ç†</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>add : å®‰è£…ä¾èµ–åŒ…</p>\n</li>\n</ul>\n<blockquote>\n<p>è¿™ä¸ªå‘½ä»¤ä¼šä¿®æ”¹ pyproject.toml æ–‡ä»¶ï¼Œåœ¨ [tool.poetry.dependencies] éƒ¨åˆ†æ·»åŠ æ–°çš„ä¾èµ–é¡¹ã€‚è¿˜ä¼šè‡ªåŠ¨æ›´æ–° poetry.lock æ–‡ä»¶ï¼Œé”å®šä¾èµ–çš„ç¡®åˆ‡ç‰ˆæœ¬ã€‚</p>\n</blockquote>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å®‰è£…ä¾èµ–ï¼Œå®‰è£…åä¼šå°†ä¾èµ–ä¿¡æ¯å†™å…¥ pyproject.toml ä¸­</span></span><br><span class=\"line\"><span class=\"comment\"># ä¸æŒ‡å®šç‰ˆæœ¬åˆ™å®‰è£…æœ€æ–°ç‰ˆ</span></span><br><span class=\"line\">$ poetry add fastapi</span><br><span class=\"line\">Using version ^0.115.5 <span class=\"keyword\">for</span> fastapi</span><br><span class=\"line\"></span><br><span class=\"line\">Updating dependencies</span><br><span class=\"line\">Resolving dependencies... (1.3s)</span><br><span class=\"line\"></span><br><span class=\"line\">Package operations: 9 installs, 0 updates, 0 removals</span><br><span class=\"line\"></span><br><span class=\"line\">  - Installing idna (3.10)</span><br><span class=\"line\">  - Installing sniffio (1.3.1)</span><br><span class=\"line\">  - Installing typing-extensions (4.12.2)</span><br><span class=\"line\">  - Installing annotated-types (0.7.0)</span><br><span class=\"line\">  - Installing anyio (4.6.2.post1)</span><br><span class=\"line\">  - Installing pydantic-core (2.23.4)</span><br><span class=\"line\">  - Installing pydantic (2.9.2)</span><br><span class=\"line\">  - Installing starlette (0.41.3)</span><br><span class=\"line\">  - Installing fastapi (0.115.5)</span><br><span class=\"line\"></span><br><span class=\"line\">Writing lock file</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŒ‡å®šç‰ˆæœ¬å·å®‰è£…ä¾èµ–</span></span><br><span class=\"line\">poetry add package_name@^1.2.3</span><br><span class=\"line\">    <span class=\"comment\"># è§„åˆ™è¯´æ˜</span></span><br><span class=\"line\">    ^1.2.3 è¡¨ç¤ºå…¼å®¹ 1.2.3 åŠæ›´é«˜çš„å°ç‰ˆæœ¬ï¼Œä½†ä¸åŒ…æ‹¬ 2.0.0ã€‚    å¦‚ï¼špoetry add requests@^2.28.0</span><br><span class=\"line\">    ~1.2.3ï¼šå…è®¸å‡çº§åˆ° 1.2.xï¼Œä½†ä¸åŒ…æ‹¬ 1.3.0ã€‚               å¦‚ï¼špoetry add requests@~2.28.0</span><br><span class=\"line\">    1.2.3ï¼šå›ºå®šä¸º 1.2.3ã€‚                                   å¦‚ï¼špoetry add requests@2.28.0</span><br><span class=\"line\">    &gt;=1.2.3ï¼šå…è®¸ä½¿ç”¨ 1.2.3 åŠä»¥ä¸Šç‰ˆæœ¬ã€‚æ³¨æ„zshä¸‹è¦åŠ ä¸ŠåŒå¼•å·ï¼Œå¦‚ï¼špoetry add <span class=\"string\">&quot;requests@&gt;=2.28.0&quot;</span></span><br><span class=\"line\">    &lt;2.0.0ï¼šå…è®¸ä½¿ç”¨å°äº 2.0.0 çš„ç‰ˆæœ¬ã€‚ æ³¨æ„zshä¸‹è¦åŠ ä¸ŠåŒå¼•å·ï¼Œå¦‚ï¼špoetry add <span class=\"string\">&quot;requests@&lt;3.0.0&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å®‰è£…åˆ°æŒ‡å®šçš„åˆ†ç»„ï¼Œé»˜è®¤éƒ½æ˜¯å®‰è£…åˆ°ä¸»ç¯å¢ƒä¸­çš„ï¼Œpoetry buildé»˜è®¤åªä¼šæ‰“åŒ…ä¸»ç¯å¢ƒçš„ä¾èµ–</span></span><br><span class=\"line\">poetry add flask <span class=\"comment\"># å®‰è£…åˆ°ä¸»ç¯å¢ƒä¸­</span></span><br><span class=\"line\">poetry add flask --group=<span class=\"built_in\">test</span> <span class=\"comment\">#æ·»åŠ åˆ†ç»„å test</span></span><br><span class=\"line\">poetry add flask --dev  <span class=\"comment\">#ç›¸å½“äº--group=dev</span></span><br><span class=\"line\"><span class=\"comment\"># åˆ†åˆ«æ‰§è¡Œä¸Šé¢3ä¸ªå®‰è£…å‘½ä»¤åï¼Œè¾“å‡º pyproject.toml çš„å†…å®¹å¦‚ä¸‹</span></span><br><span class=\"line\">[tool.poetry]</span><br><span class=\"line\">name = <span class=\"string\">&quot;poetrydemo&quot;</span></span><br><span class=\"line\">version = <span class=\"string\">&quot;0.1.0&quot;</span></span><br><span class=\"line\">description = <span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\">authors = [<span class=\"string\">&quot;hanqunfeng &lt;hanqf2008@163.com&gt;&quot;</span>]</span><br><span class=\"line\">readme = <span class=\"string\">&quot;README.md&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">[tool.poetry.dependencies] <span class=\"comment\"># ä¸»ç¯å¢ƒ</span></span><br><span class=\"line\">python = <span class=\"string\">&quot;^3.11&quot;</span></span><br><span class=\"line\">flask = <span class=\"string\">&quot;^3.1.0&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">[tool.poetry.group.test.dependencies] <span class=\"comment\"># teståˆ†ç»„ä¾èµ–</span></span><br><span class=\"line\">flask = <span class=\"string\">&quot;^3.1.0&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">[tool.poetry.group.dev.dependencies] <span class=\"comment\"># devåˆ†ç»„ä¾èµ–</span></span><br><span class=\"line\">flask = <span class=\"string\">&quot;^3.1.0&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">[build-system]</span><br><span class=\"line\">requires = [<span class=\"string\">&quot;poetry-core&quot;</span>]</span><br><span class=\"line\">build-backend = <span class=\"string\">&quot;poetry.core.masonry.api&quot;</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>show : æŸ¥çœ‹ä¾èµ–åŒ…</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹å½“å‰é¡¹ç›®éƒ½éœ€è¦å“ªäº›ä¾èµ–ï¼Œè¿™äº›ä¾èµ–ä¸ä¸€å®šéƒ½å®‰è£…äº†ï¼Œå®ƒåªæ˜¯è§£æ pyproject.toml ä¸­çš„å£°æ˜æ¥è§£æä¾èµ–æ ‘</span></span><br><span class=\"line\">$ poetry show</span><br><span class=\"line\">annotated-types   0.7.0       Reusable constraint types to use with typing.Annotated</span><br><span class=\"line\">anyio             4.6.2.post1 High level compatibility layer <span class=\"keyword\">for</span> multiple asynchronous ...</span><br><span class=\"line\">fastapi           0.115.5     FastAPI framework, high performance, easy to learn, fast ...</span><br><span class=\"line\">idna              3.10        Internationalized Domain Names <span class=\"keyword\">in</span> Applications (IDNA)</span><br><span class=\"line\">pydantic          2.9.2       Data validation using Python <span class=\"built_in\">type</span> hints</span><br><span class=\"line\">pydantic-core     2.23.4      Core functionality <span class=\"keyword\">for</span> Pydantic validation and serialization</span><br><span class=\"line\">sniffio           1.3.1       Sniff out <span class=\"built_in\">which</span> async library your code is running under</span><br><span class=\"line\">starlette         0.41.3      The little ASGI library that shines.</span><br><span class=\"line\">typing-extensions 4.12.2      Backported and Experimental Type Hints <span class=\"keyword\">for</span> Python 3.8+</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åªæŸ¥çœ‹é¡¶çº§ä¾èµ–ï¼Œå³åªæŸ¥çœ‹åœ¨ pyproject.toml ä¸­å£°æ˜çš„ä¾èµ–</span></span><br><span class=\"line\">$ poetry show --top-level</span><br><span class=\"line\">fastapi           0.115.5     FastAPI framework, high performance, easy to learn, fast ...</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>remove : åˆ é™¤ä¾èµ–åŒ…</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åˆ é™¤ä¾èµ–ï¼Œæ­¤æ—¶ä¼šå°†å½“å‰åŒ…åŠå…¶æ‰€æœ‰ä¾èµ–ä¸€å—åˆ é™¤</span></span><br><span class=\"line\">$ poetry remove fastapi</span><br><span class=\"line\">Updating dependencies</span><br><span class=\"line\">Resolving dependencies... (0.1s)</span><br><span class=\"line\"></span><br><span class=\"line\">Package operations: 0 installs, 0 updates, 9 removals</span><br><span class=\"line\"></span><br><span class=\"line\">  - Removing annotated-types (0.7.0)</span><br><span class=\"line\">  - Removing anyio (4.6.2.post1)</span><br><span class=\"line\">  - Removing fastapi (0.115.5)</span><br><span class=\"line\">  - Removing idna (3.10)</span><br><span class=\"line\">  - Removing pydantic (2.9.2)</span><br><span class=\"line\">  - Removing pydantic-core (2.23.4)</span><br><span class=\"line\">  - Removing sniffio (1.3.1)</span><br><span class=\"line\">  - Removing starlette (0.41.3)</span><br><span class=\"line\">  - Removing typing-extensions (4.12.2)</span><br><span class=\"line\"></span><br><span class=\"line\">Writing lock file</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>search : æœç´¢è¿œç¨‹ä»“åº“</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æœç´¢è¿œç¨‹ä»“åº“</span></span><br><span class=\"line\">$ poetry search fastapi</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>install å’Œ update : å®‰è£…å’Œæ›´æ–°ä¾èµ–åŒ…<br>\n<em><strong>åœ¨ Poetry ä¸­ï¼Œinstall å’Œ update æ˜¯ä¸¤ä¸ªå¸¸ç”¨çš„å‘½ä»¤ï¼Œä½†å®ƒä»¬çš„ä½œç”¨å’Œä½¿ç”¨åœºæ™¯ä¸åŒ</strong></em></p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-7\">\n<p><code>poetry install</code> çš„ä½œç”¨æ˜¯æ ¹æ®ç°æœ‰çš„ poetry.lock æ–‡ä»¶æ¥å®‰è£…ä¾èµ–ï¼Œç¡®ä¿å®‰è£…çš„ä¾èµ–ç‰ˆæœ¬ä¸é”æ–‡ä»¶ä¸­è®°å½•çš„ç‰ˆæœ¬å®Œå…¨ä¸€è‡´ã€‚<br>\næ ¸å¿ƒç‰¹ç‚¹ï¼š</p>\n<ul class=\"lvl-4\">\n<li class=\"lvl-10\">å®‰è£…é”å®šçš„ç‰ˆæœ¬ï¼šå®ƒåªä¼šå®‰è£… poetry.lock æ–‡ä»¶ä¸­æŒ‡å®šçš„ç‰ˆæœ¬ï¼Œå³ä½¿ pyproject.toml æ–‡ä»¶ä¸­å®šä¹‰çš„ç‰ˆæœ¬èŒƒå›´å·²ç»æœ‰æ›´æ–°ç‰ˆæœ¬ã€‚</li>\n<li class=\"lvl-10\">é‡ç°ä¾èµ–ç¯å¢ƒï¼šé€‚ç”¨äºå›¢é˜Ÿåä½œæˆ–éƒ¨ç½²ç¯å¢ƒï¼Œç¡®ä¿æ‰€æœ‰äººæˆ–æœºå™¨å®‰è£…çš„ä¾èµ–ç‰ˆæœ¬å®Œå…¨ç›¸åŒã€‚</li>\n<li class=\"lvl-10\">é”æ–‡ä»¶å­˜åœ¨æ—¶æ›´é«˜æ•ˆï¼šå¦‚æœ poetry.lock æ–‡ä»¶å­˜åœ¨ï¼Œpoetry install ä¸ä¼šé‡æ–°è§£æä¾èµ–æ ‘ã€‚</li>\n<li class=\"lvl-10\">é¦–æ¬¡è¿è¡Œæ—¶ç”Ÿæˆé”æ–‡ä»¶ï¼šå¦‚æœæ²¡æœ‰ poetry.lock æ–‡ä»¶ï¼Œpoetry install ä¼šè§£æä¾èµ–å¹¶ç”Ÿæˆé”æ–‡ä»¶ã€‚<br>\nä½¿ç”¨åœºæ™¯ï¼š</li>\n<li class=\"lvl-10\">æ–°å…‹éš†çš„é¡¹ç›®ï¼Œéœ€è¦å®‰è£…ä¾èµ–ç¯å¢ƒã€‚</li>\n<li class=\"lvl-10\">éƒ¨ç½²ç”Ÿäº§ç¯å¢ƒï¼Œç¡®ä¿ä¾èµ–ç‰ˆæœ¬çš„ç¨³å®šæ€§ã€‚</li>\n<li class=\"lvl-10\">é‡æ–°å®‰è£…ä¹‹å‰å·²å®šä¹‰çš„ä¾èµ–ï¼ˆä¾‹å¦‚æ¸…ç©ºäº†è™šæ‹Ÿç¯å¢ƒï¼‰ã€‚</li>\n</ul>\n</li>\n<li class=\"lvl-6\">\n<p><code>poetry update</code> çš„ä½œç”¨æ˜¯æ ¹æ® pyproject.toml æ–‡ä»¶ä¸­å®šä¹‰çš„ä¾èµ–èŒƒå›´é‡æ–°è§£æä¾èµ–æ ‘ï¼Œå¹¶æ›´æ–° poetry.lock æ–‡ä»¶ä¸ºæœ€æ–°çš„ç‰ˆæœ¬ã€‚<br>\næ ¸å¿ƒç‰¹ç‚¹ï¼š</p>\n<ul class=\"lvl-4\">\n<li class=\"lvl-10\">æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬ï¼šå®ƒä¼šå°è¯•å®‰è£…ä¾èµ–èŒƒå›´å†…çš„æœ€æ–°ç‰ˆæœ¬ï¼Œå¹¶æ›´æ–° poetry.lock æ–‡ä»¶ã€‚</li>\n<li class=\"lvl-10\">è§£ææ–°çš„ä¾èµ–æ ‘ï¼šå³ä½¿ poetry.lock æ–‡ä»¶å­˜åœ¨ï¼Œpoetry update ä¹Ÿä¼šå¿½ç•¥å®ƒå¹¶é‡æ–°è§£æä¾èµ–ã€‚</li>\n<li class=\"lvl-10\">æ›´æ”¹é”æ–‡ä»¶ï¼šå®ƒä¼šè¦†ç›–ç°æœ‰çš„ poetry.lock æ–‡ä»¶ï¼Œå› æ­¤å›¢é˜Ÿå…¶ä»–æˆå‘˜éœ€è¦é‡æ–°è¿è¡Œ poetry install ä»¥åŒæ­¥ã€‚<br>\nä½¿ç”¨åœºæ™¯ï¼š</li>\n<li class=\"lvl-10\">æ›´æ–°ä¾èµ–åˆ°æœ€æ–°ç‰ˆæœ¬ï¼ˆåœ¨ä¾èµ–èŒƒå›´å†…ï¼‰ã€‚</li>\n<li class=\"lvl-10\">å½“æ·»åŠ æ–°ä¾èµ–åï¼Œæƒ³è¦å®‰è£…å¹¶æ›´æ–°é”æ–‡ä»¶ã€‚</li>\n<li class=\"lvl-10\">ä¿®å¤å¯èƒ½çš„ç‰ˆæœ¬å†²çªæˆ–ä¸å…¼å®¹é—®é¢˜ã€‚</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"lock-é”å®šä¾èµ–åŒ…\">lock : é”å®šä¾èµ–åŒ…</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><code>poetry lock</code> æ˜¯ Poetryï¼ˆä¸€ä¸ª Python åŒ…ç®¡ç†å·¥å…·ï¼‰ä¸­çš„ä¸€ä¸ªå‘½ä»¤ï¼Œç”¨äºé”å®šé¡¹ç›®çš„ä¾èµ–å…³ç³»ã€‚ä½¿ç”¨è¿™ä¸ªå‘½ä»¤å¯ä»¥åˆ›å»ºæˆ–æ›´æ–° <code>poetry.lock</code> æ–‡ä»¶ï¼Œç¡®ä¿ä½ çš„é¡¹ç›®ä¸­æ‰€ä½¿ç”¨çš„æ¯ä¸ªåŒ…çš„ç‰ˆæœ¬éƒ½è¢«æ˜ç¡®è®°å½•ä¸‹æ¥ã€‚è¿™æ ·åšå¯¹äºé¡¹ç›®çš„å¯å¤ç°æ€§å’Œç¨³å®šæ€§è‡³å…³é‡è¦ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å®é™…ä¸Šï¼Œå½“è¿è¡Œ <code>poetry install</code> ã€ <code>poetry update</code> æˆ–è€… <code>poetry add</code> ç­‰å‘½ä»¤æ—¶ï¼Œ poetry éƒ½ä¼šæ ¹æ®<br>\n<code>pyproject.toml</code> æ–‡ä»¶ä¸­çš„ä¾èµ–èŒƒå›´ï¼Œè§£æä¾èµ–æ ‘ï¼Œå¹¶åœ¨é¡¹ç›®ç›®å½•ä¸‹åˆ›å»ºæˆ–æ›´æ–° <code>poetry.lock</code> æ–‡ä»¶ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å½“æˆ‘ä»¬æ‰‹å·¥ä¿®æ”¹äº† <code>pyproject.toml</code> æ–‡ä»¶ä¸­çš„ä¾èµ–èŒƒå›´ï¼Œæ­¤æ—¶åˆä¸æƒ³ç«‹åˆ»æ›´æ–°ä¾èµ–ï¼Œè€Œæ˜¯å¸Œæœ›åœ¨æŸä¸ªæ—¶æœºå†æ›´æ–°ï¼Œæ­¤æ—¶å°±å¯ä»¥ä½¿ç”¨ <code>poetry lock</code> å‘½ä»¤ï¼Œå…ˆé”å®šè¿™äº›ä¾èµ–ï¼Œä¹‹åå†é€šè¿‡ <code>poetry install</code> å‘½ä»¤å®‰è£…ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å¯ä»¥ä½¿ç”¨ <code>poetry check</code> å‘½ä»¤æ£€æŸ¥ <code>pyproject.toml</code> æ–‡ä»¶ ä¸ <code>poetry.lock</code> æ–‡ä»¶çš„ä¸€è‡´æ€§ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æ¯”å¦‚æˆ‘æ‰‹å·¥åˆ é™¤äº† `pyproject.toml` æ–‡ä»¶ä¸­çš„æŸä¸ªä¾èµ–</span></span><br><span class=\"line\"><span class=\"comment\"># æ­¤æ—¶è¿è¡Œ check æ£€æŸ¥ä¸€è‡´æ€§ä¼šæŠ¥é”™</span></span><br><span class=\"line\">$ poetry check</span><br><span class=\"line\">Error: pyproject.toml changed significantly since poetry.lock was last generated. Run `poetry lock [--no-update]` to fix the lock file.</span><br><span class=\"line\"><span class=\"comment\"># é”å®šä¾èµ–</span></span><br><span class=\"line\">$ poetry lock</span><br><span class=\"line\">Updating dependencies</span><br><span class=\"line\">Resolving dependencies... (0.1s)</span><br><span class=\"line\"></span><br><span class=\"line\">Writing lock file</span><br><span class=\"line\"><span class=\"comment\"># æ£€æŸ¥ä¸€è‡´æ€§é€šè¿‡</span></span><br><span class=\"line\">$ poetry check</span><br><span class=\"line\">All <span class=\"built_in\">set</span>!</span><br></pre></td></tr></table></figure>\n<div class=\"tips\">\n<p><em><strong>å°è´´å£«</strong></em></p>\n<ul class=\"lvl-1\">\n<li class=\"lvl-2\">æ³¨æ„ï¼Œæ­¤æ—¶é€šè¿‡ <code>poetry show</code> æŸ¥çœ‹ä¸åˆ°é‚£ä¸ªæ‰‹å·¥åˆ é™¤çš„ä¾èµ–åŒ…ï¼Œä½†å®é™…ä¸Šä¾èµ–ä¾æ—§åœ¨äºè™šæ‹Ÿç¯å¢ƒä¸­</li>\n<li class=\"lvl-2\">æ‰€ä»¥å°½é‡é¿å…æ‰‹å·¥åˆ é™¤ä¾èµ–ï¼Œè€Œæ˜¯é€šè¿‡ <code>poetry remove</code> å‘½ä»¤æ¥åˆ é™¤ä¾èµ–</li>\n</ul>\n</div>\n<h3 id=\"source-é•œåƒæºç®¡ç†\">source : é•œåƒæºç®¡ç†</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>é»˜è®¤æƒ…å†µä¸‹éƒ½æ˜¯ä»Pypiçš„å®˜æ–¹ä»“åº“ä¸‹è½½ï¼Œå›½å†…ä¸€èˆ¬éœ€è¦æŒ‡å®šé•œåƒæºæ¥åŠ é€Ÿä¸‹è½½</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æ·»åŠ é•œåƒæºï¼Œé»˜è®¤å°±æ˜¯ä¸»è¦æºï¼Œæ³¨æ„è¯¥æ–¹å¼åªå¯¹å½“å‰é¡¹ç›®æœ‰æ•ˆ</span></span><br><span class=\"line\"><span class=\"comment\"># å‘½ä»¤æ ¼å¼ï¼špoetry source add [é€‰é¡¹] [--] &lt;name&gt; [&lt;url&gt;]ï¼Œnameï¼šæºä»“åº“çš„åç§°ï¼Œurlï¼šæºä»“åº“çš„ URL</span></span><br><span class=\"line\">$ poetry <span class=\"built_in\">source</span> add tsinghua https://pypi.tuna.tsinghua.edu.cn/simple</span><br><span class=\"line\">Adding <span class=\"built_in\">source</span> with name tsinghua.</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># --priority=PRIORITYè®¾ç½®æ­¤æºçš„ä¼˜å…ˆçº§ã€‚å¯ä»¥æ˜¯ä»¥ä¸‹å€¼ä¹‹ä¸€ï¼šdefaultï¼ˆé»˜è®¤ï¼‰ã€primaryï¼ˆä¸»è¦ï¼‰ã€supplementalï¼ˆå¤‡ç”¨ï¼‰ã€explicitï¼ˆæ˜¾å¼æºï¼Œåªæœ‰å½“åŒ…æ˜ç¡®å£°æ˜ä½¿ç”¨è¯¥æºæ—¶æ‰ä¼šè¢«ä½¿ç”¨ï¼‰ã€‚é»˜è®¤ä¸º primaryã€‚</span></span><br><span class=\"line\">$ poetry <span class=\"built_in\">source</span> add  --priority=supplemental aliyun http://mirrors.aliyun.com/pypi/simple/</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹é•œåƒæºä¿¡æ¯</span></span><br><span class=\"line\">$ poetry <span class=\"built_in\">source</span> show</span><br><span class=\"line\"> name      : tsinghua</span><br><span class=\"line\"> url       : https://pypi.tuna.tsinghua.edu.cn/simple</span><br><span class=\"line\"> priority  : primary</span><br><span class=\"line\"></span><br><span class=\"line\"> name      : aliyun</span><br><span class=\"line\"> url       : http://mirrors.aliyun.com/pypi/simple/</span><br><span class=\"line\"> priority  : supplemental</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ­¤æ—¶æŸ¥çœ‹ pyproject.toml æ–‡ä»¶å¯ä»¥çœ‹åˆ°é•œåƒæºä¿¡æ¯</span></span><br><span class=\"line\">[[tool.poetry.source]]</span><br><span class=\"line\">name = <span class=\"string\">&quot;tsinghua&quot;</span></span><br><span class=\"line\">url = <span class=\"string\">&quot;https://pypi.tuna.tsinghua.edu.cn/simple&quot;</span></span><br><span class=\"line\">priority = <span class=\"string\">&quot;primary&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">[[tool.poetry.source]]</span><br><span class=\"line\">name = <span class=\"string\">&quot;aliyun&quot;</span></span><br><span class=\"line\">url = <span class=\"string\">&quot;http://mirrors.aliyun.com/pypi/simple/&quot;</span></span><br><span class=\"line\">priority = <span class=\"string\">&quot;supplemental&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åˆ é™¤é•œåƒæº</span></span><br><span class=\"line\">$ poetry <span class=\"built_in\">source</span> remove aliyun <span class=\"comment\"># æŒ‡å®šé•œåƒæºåç§°</span></span><br><span class=\"line\">Removing <span class=\"built_in\">source</span> with name aliyun.</span><br></pre></td></tr></table></figure>\n<h3 id=\"è¿è¡Œ\">è¿è¡Œ</h3>\n<p>è¿™é‡Œä»¥ä¸€ä¸ªå°ç¤ºä¾‹æ¥è¯´æ˜è¿™ä¸ªåŠŸèƒ½</p>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ›å»ºä¸€ä¸ªæ–°çš„é¡¹ç›®</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ poetry new poetryDemo</span><br><span class=\"line\">Created package poetrydemo <span class=\"keyword\">in</span> poetryDemo</span><br><span class=\"line\"><span class=\"comment\"># è¿›å…¥é¡¹ç›®ç›®å½•</span></span><br><span class=\"line\">$ <span class=\"built_in\">cd</span> poetryDemo</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹ç”Ÿæˆçš„æ–‡ä»¶</span></span><br><span class=\"line\">$ ll</span><br><span class=\"line\">total 8</span><br><span class=\"line\">drwxr-xr-x  6 hanqf  staff  192 11 21 17:32 .</span><br><span class=\"line\">drwxr-xr-x  4 hanqf  staff  128 11 21 17:32 ..</span><br><span class=\"line\">-rw-r--r--  1 hanqf  staff    0 11 21 17:32 README.md</span><br><span class=\"line\">drwxr-xr-x  3 hanqf  staff   96 11 21 17:32 poetrydemo</span><br><span class=\"line\">-rw-r--r--  1 hanqf  staff  266 11 21 17:32 pyproject.toml</span><br><span class=\"line\">drwxr-xr-x  3 hanqf  staff   96 11 21 17:32 tests</span><br><span class=\"line\"><span class=\"comment\"># è¿›å…¥åŒ…ç›®å½•</span></span><br><span class=\"line\">$ <span class=\"built_in\">cd</span> poetrydemo</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹åŒ…ç›®å½•ä¸‹çš„æ–‡ä»¶</span></span><br><span class=\"line\">$ ll</span><br><span class=\"line\">total 0</span><br><span class=\"line\">drwxr-xr-x  3 hanqf  staff   96 11 21 17:32 .</span><br><span class=\"line\">drwxr-xr-x  6 hanqf  staff  192 11 21 17:32 ..</span><br><span class=\"line\">-rw-r--r--  1 hanqf  staff    0 11 21 17:32 __init__.py</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åœ¨åŒ…ç›®å½•ä¸‹åˆ›å»º array_util.pyï¼Œå†…å®¹å¦‚ä¸‹</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">import numpy as np</span><br><span class=\"line\"></span><br><span class=\"line\">def generate_random_array(shape, distribution=<span class=\"string\">&quot;uniform&quot;</span>, params=None, seed=None):</span><br><span class=\"line\">    <span class=\"string\">&quot;&quot;</span><span class=\"string\">&quot;</span></span><br><span class=\"line\"><span class=\"string\">    ç”Ÿæˆéšæœºæ•°ç»„çš„å·¥å…·æ–¹æ³•ã€‚</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">    :param shape: tupleï¼ŒæŒ‡å®šæ•°ç»„çš„å½¢çŠ¶ï¼Œä¾‹å¦‚ (3, 4) è¡¨ç¤º 3 è¡Œ 4 åˆ—ã€‚</span></span><br><span class=\"line\"><span class=\"string\">    :param distribution: strï¼ŒæŒ‡å®šéšæœºæ•°åˆ†å¸ƒç±»å‹ï¼Œå¯é€‰å€¼ï¼š</span></span><br><span class=\"line\"><span class=\"string\">        - &quot;</span>uniform<span class=\"string\">&quot;ï¼šå‡åŒ€åˆ†å¸ƒï¼ˆé»˜è®¤ï¼‰ã€‚</span></span><br><span class=\"line\"><span class=\"string\">        - &quot;</span>normal<span class=\"string\">&quot;ï¼šæ­£æ€åˆ†å¸ƒã€‚</span></span><br><span class=\"line\"><span class=\"string\">        - &quot;</span><span class=\"built_in\">integer</span><span class=\"string\">&quot;ï¼šéšæœºæ•´æ•°ã€‚</span></span><br><span class=\"line\"><span class=\"string\">    :param params: dictï¼Œåˆ†å¸ƒçš„å‚æ•°é…ç½®ï¼š</span></span><br><span class=\"line\"><span class=\"string\">        - å‡åŒ€åˆ†å¸ƒï¼š&#123;&quot;</span>low<span class=\"string\">&quot;: æœ€å°å€¼, &quot;</span>high<span class=\"string\">&quot;: æœ€å¤§å€¼&#125;ï¼Œé»˜è®¤ low=0, high=1ã€‚</span></span><br><span class=\"line\"><span class=\"string\">        - æ­£æ€åˆ†å¸ƒï¼š&#123;&quot;</span>mean<span class=\"string\">&quot;: å‡å€¼, &quot;</span>std<span class=\"string\">&quot;: æ ‡å‡†å·®&#125;ï¼Œé»˜è®¤ mean=0, std=1ã€‚</span></span><br><span class=\"line\"><span class=\"string\">        - éšæœºæ•´æ•°ï¼š&#123;&quot;</span>low<span class=\"string\">&quot;: æœ€å°å€¼, &quot;</span>high<span class=\"string\">&quot;: æœ€å¤§å€¼, &quot;</span>dtype<span class=\"string\">&quot;: ç±»å‹&#125;ï¼Œé»˜è®¤ low=0, high=10ã€‚</span></span><br><span class=\"line\"><span class=\"string\">    :param seed: intï¼Œéšæœºæ•°ç§å­ï¼ˆå¯é€‰ï¼‰ï¼Œç”¨äºç»“æœå¯å¤ç°ã€‚</span></span><br><span class=\"line\"><span class=\"string\">    :return: np.ndarrayï¼Œç”Ÿæˆçš„éšæœºæ•°ç»„ã€‚</span></span><br><span class=\"line\"><span class=\"string\">    &quot;</span><span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> seed is not None:</span><br><span class=\"line\">        np.random.seed(seed)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> params is None:</span><br><span class=\"line\">        params = &#123;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> distribution == <span class=\"string\">&quot;uniform&quot;</span>:</span><br><span class=\"line\">        low = params.get(<span class=\"string\">&quot;low&quot;</span>, 0)</span><br><span class=\"line\">        high = params.get(<span class=\"string\">&quot;high&quot;</span>, 1)</span><br><span class=\"line\">        <span class=\"built_in\">return</span> np.random.uniform(low, high, size=shape)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">elif</span> distribution == <span class=\"string\">&quot;normal&quot;</span>:</span><br><span class=\"line\">        mean = params.get(<span class=\"string\">&quot;mean&quot;</span>, 0)</span><br><span class=\"line\">        std = params.get(<span class=\"string\">&quot;std&quot;</span>, 1)</span><br><span class=\"line\">        <span class=\"built_in\">return</span> np.random.normal(mean, std, size=shape)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">elif</span> distribution == <span class=\"string\">&quot;integer&quot;</span>:</span><br><span class=\"line\">        low = params.get(<span class=\"string\">&quot;low&quot;</span>, 0)</span><br><span class=\"line\">        high = params.get(<span class=\"string\">&quot;high&quot;</span>, 10)</span><br><span class=\"line\">        dtype = params.get(<span class=\"string\">&quot;dtype&quot;</span>, int)</span><br><span class=\"line\">        <span class=\"built_in\">return</span> np.random.randint(low, high, size=shape, dtype=dtype)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">else</span>:</span><br><span class=\"line\">        raise ValueError(<span class=\"string\">&quot;ä¸æ”¯æŒçš„åˆ†å¸ƒç±»å‹ï¼å¯é€‰å€¼ä¸º &#x27;uniform&#x27;, &#x27;normal&#x27;, &#x27;integer&#x27;ã€‚&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ç¤ºä¾‹ç”¨æ³•</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">&quot;__main__&quot;</span>:</span><br><span class=\"line\">    array_uniform = generate_random_array((<span class=\"number\">3</span>, <span class=\"number\">4</span>), distribution=&quot;uniform&quot;, params=&#123;&quot;low&quot;: <span class=\"number\">1</span>, &quot;high&quot;: <span class=\"number\">10</span>&#125;)</span><br><span class=\"line\">    array_normal = generate_random_array((<span class=\"number\">2</span>, <span class=\"number\">3</span>), distribution=&quot;normal&quot;, params=&#123;&quot;mean&quot;: <span class=\"number\">0</span>, &quot;std&quot;: <span class=\"number\">1</span>&#125;, seed=<span class=\"number\">42</span>)</span><br><span class=\"line\">    array_integer = generate_random_array((<span class=\"number\">4</span>, <span class=\"number\">5</span>), distribution=&quot;integer&quot;, params=&#123;&quot;low&quot;: <span class=\"number\">0</span>, &quot;high&quot;: <span class=\"number\">20</span>&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">    print(&quot;å‡åŒ€åˆ†å¸ƒéšæœºæ•°ç»„ï¼š\\n&quot;, array_uniform)</span><br><span class=\"line\">    print(&quot;æ­£æ€åˆ†å¸ƒéšæœºæ•°ç»„ï¼š\\n&quot;, array_normal)</span><br><span class=\"line\">    print(&quot;éšæœºæ•´æ•°æ•°ç»„ï¼š\\n&quot;, array_integer)</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å®‰è£…ä¾èµ–</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ poetry add numpy</span><br><span class=\"line\">Using version ^2.1.3 <span class=\"keyword\">for</span> numpy</span><br><span class=\"line\"></span><br><span class=\"line\">Updating dependencies</span><br><span class=\"line\">Resolving dependencies... (1.1s)</span><br><span class=\"line\"></span><br><span class=\"line\">Package operations: 1 install, 0 updates, 0 removals</span><br><span class=\"line\"></span><br><span class=\"line\">  - Installing numpy (2.1.3)</span><br><span class=\"line\"></span><br><span class=\"line\">Writing lock file</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¿è¡Œï¼Œä¸¤ç§æ–¹æ³•</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-6\"><code>poetry run</code></li>\n</ul>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ poetry run python array_util.py</span><br><span class=\"line\">å‡åŒ€åˆ†å¸ƒéšæœºæ•°ç»„ï¼š</span><br><span class=\"line\">[[7.44623063 1.89415788 4.81008329 4.25556572]</span><br><span class=\"line\">[3.31925154 6.44037063 5.3216543  7.54950573]</span><br><span class=\"line\">[3.97160747 5.04800698 3.28299934 3.42841887]]</span><br><span class=\"line\">æ­£æ€åˆ†å¸ƒéšæœºæ•°ç»„ï¼š</span><br><span class=\"line\">[[ 0.49671415 -0.1382643   0.64768854]</span><br><span class=\"line\">[ 1.52302986 -0.23415337 -0.23413696]]</span><br><span class=\"line\">éšæœºæ•´æ•°æ•°ç»„ï¼š</span><br><span class=\"line\">[[10 10  3  7  2]</span><br><span class=\"line\">[ 1 11  5  1  0]</span><br><span class=\"line\">[11 11 16  9 15]</span><br><span class=\"line\">[14 14 18 11 19]]</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-2\">\n<li class=\"lvl-6\"><code>poetry shell</code> : æ­¤æ—¶ä¼šå¼€å¯ä¸€ä¸ªæ–°çš„shellï¼Œå¹¶å¼€å¯è™šæ‹Ÿç¯å¢ƒ</li>\n</ul>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å¼€å¯è™šæ‹Ÿç¯å¢ƒ</span></span><br><span class=\"line\">$ poetry shell</span><br><span class=\"line\">Spawning shell within /Users/hanqf/Library/Caches/pypoetry/virtualenvs/poetrydemo-fyqYbfje-py3.11</span><br><span class=\"line\">Restored session: 2024å¹´11æœˆ21æ—¥ æ˜ŸæœŸå›› 15æ—¶31åˆ†52ç§’ CST</span><br><span class=\"line\">âœ  poetrydemo <span class=\"built_in\">emulate</span> bash -c <span class=\"string\">&#x27;. /Users/hanqf/Library/Caches/pypoetry/virtualenvs/poetrydemo-fyqYbfje-py3.11/bin/activate&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"># åœ¨è™šæ‹Ÿç¯å¢ƒä¸‹è¿è¡Œ</span></span><br><span class=\"line\">$ python array_util.py</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<h3 id=\"æ‰“åŒ…å’Œå‘å¸ƒ\">æ‰“åŒ…å’Œå‘å¸ƒ</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ¥ç€ä¸Šé¢çš„é¡¹ç›®</p>\n</li>\n<li class=\"lvl-2\">\n<p>æ‰“åŒ…</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ä¼šåœ¨é¡¹ç›®ç›®å½•ä¸‹åˆ›å»º dist ç›®å½•ï¼Œå¹¶å°†æ‰“å¥½çš„åŒ…å­˜æ”¾äºæ­¤</span></span><br><span class=\"line\">$ poetry build</span><br><span class=\"line\">Building poetrydemo (0.1.0)</span><br><span class=\"line\">  - Building sdist</span><br><span class=\"line\">  - Built poetrydemo-0.1.0.tar.gz</span><br><span class=\"line\">  - Building wheel</span><br><span class=\"line\">  - Built poetrydemo-0.1.0-py3-none-any.whl</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹ç”Ÿæˆçš„æ‰“åŒ…æ–‡ä»¶</span></span><br><span class=\"line\">$ exa -1 dist</span><br><span class=\"line\">hqf_poetrydemo-0.1.0-py3-none-any.whl</span><br><span class=\"line\">hqf_poetrydemo-0.1.0.tar.gz</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å‘å¸ƒ</p>\n</li>\n<li class=\"lvl-2\">\n<p>é¦–å…ˆè¦å…ˆåœ¨<a href=\"https://pypi.org/\">PyPI</a>ä¸Šæ³¨å†Œä¸ªå¸å·ï¼Œéœ€è¦å¼€å¯â€œåŒè¦ç´ èº«ä»½éªŒè¯ ï¼ˆ2FAï¼‰â€ï¼Œå¦åˆ™ä¸èƒ½è·å–å‘å¸ƒæ—¶çš„APIä»¤ç‰Œã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>è·å–APIä»¤ç‰Œ<br>\n<img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/iShot_2024-11-21_18.00.50.png\" alt=\"\"></p>\n</li>\n<li class=\"lvl-2\">\n<p>å‘å¸ƒï¼Œä¸è¿‡è¿™æ¬¡å‘å¸ƒæç¤ºåŒ…åå·²ç»å­˜åœ¨äº†</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å‘å¸ƒæ—¶æç¤ºåŒ…åå·²ç»å­˜åœ¨äº†</span></span><br><span class=\"line\">$ poetry publish -u __token__  -p pypi-AgEIcHlwaS5vcmcCJDU0Y2Q5NjhkLWYyYTEtN</span><br><span class=\"line\">Publishing poetrydemo (0.1.0) to PyPI</span><br><span class=\"line\"> - Uploading poetrydemo-0.1.0-py3-none-any.whl FAILED</span><br><span class=\"line\"></span><br><span class=\"line\">HTTP Error 400: The name <span class=\"string\">&#x27;poetrydemo&#x27;</span> is too similar to an existing project. See https://pypi.org/help/#project-name <span class=\"keyword\">for</span> more information. | b<span class=\"string\">&quot;&lt;html&gt;\\n &lt;head&gt;\\n  &lt;title&gt;400 The name &#x27;poetrydemo&#x27; is too similar to an existing project. See https://pypi.org/help/#project-name for more information.\\n \\n &lt;body&gt;\\n  &lt;h1&gt;400 The name &#x27;poetrydemo&#x27; is too similar to an existing project. See https://pypi.org/help/#project-name for more information.\\n  The server could not comply with the request since it is either malformed or otherwise incorrect.&lt;br/&gt;&lt;br/&gt;\\nThe name &amp;#x27;poetrydemo&amp;#x27; is too similar to an existing project. See https://pypi.org/help/#project-name for more information.\\n\\n\\n \\n&quot;</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å…ˆä¿®æ”¹åŒ…åï¼Œç›´æ¥ç¼–è¾‘ pyproject.toml å³å¯ï¼Œå°†nameå±æ€§ä¿®æ”¹ä¸ºâ€œhqf_poetrydemoâ€ï¼Œç„¶åå°†åŒ…ç›®å½•çš„åç§°ä¹Ÿä¿®æ”¹ä¸ºè¿™ä¸ª<code>mv poetrydemo hqf_poetrydemo</code>ï¼Œå¹¶åˆ é™¤distç›®å½•ï¼Œä¹‹åé‡æ–°æ‰“åŒ…<code>poetry build</code>ï¼Œå†æ¬¡å‘å¸ƒ</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ vim pyproject.toml <span class=\"comment\"># å°†nameå±æ€§ä¿®æ”¹ä¸ºâ€œhqf_poetrydemoâ€</span></span><br><span class=\"line\">$ <span class=\"built_in\">mv</span> poetrydemo hqf_poetrydemo <span class=\"comment\"># å°†åŒ…ç›®å½•çš„åç§°ä¹Ÿä¿®æ”¹ä¸ºè¿™ä¸ª</span></span><br><span class=\"line\">$ <span class=\"built_in\">rm</span> -rf dist <span class=\"comment\"># åˆ é™¤distç›®å½•</span></span><br><span class=\"line\">$ poetry build    <span class=\"comment\"># é‡æ–°æ‰“åŒ…</span></span><br><span class=\"line\">Creating virtualenv hqf-poetrydemo-fyqYbfje-py3.11 <span class=\"keyword\">in</span> /Users/hanqf/Library/Caches/pypoetry/virtualenvs</span><br><span class=\"line\">Building hqf_poetrydemo (0.1.0)</span><br><span class=\"line\">  - Building sdist</span><br><span class=\"line\">  - Built hqf_poetrydemo-0.1.0.tar.gz</span><br><span class=\"line\">  - Building wheel</span><br><span class=\"line\">  - Built hqf_poetrydemo-0.1.0-py3-none-any.whl</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å†æ¬¡å‘å¸ƒ</span></span><br><span class=\"line\">$ poetry publish -u __token__  -p pypi-AgEIcHlwaS5vcmcCJDU0Y2Q5NjhkLWYyYTEtN</span><br><span class=\"line\"></span><br><span class=\"line\">Publishing hqf_poetrydemo (0.1.0) to PyPI</span><br><span class=\"line\"> - Uploading hqf_poetrydemo-0.1.0-py3-none-any.whl 100%</span><br><span class=\"line\"> - Uploading hqf_poetrydemo-0.1.0.tar.gz 100%</span><br></pre></td></tr></table></figure>\n<p><img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/iShot_2024-11-21_18.13.21.png\" alt=\"\"></p>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¹‹åå°±å¯ä»¥åœ¨å…¶å®ƒé¡¹ç›®ä¸­å®‰è£…è¿™ä¸ªåŒ…äº†</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># pip install</span></span><br><span class=\"line\">$ pip install hqf_poetrydemo</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># poetry add</span></span><br><span class=\"line\">$ poetry add hqf_poetrydemo</span><br><span class=\"line\">Using version ^0.1.0 <span class=\"keyword\">for</span> hqf-poetrydemo</span><br><span class=\"line\"></span><br><span class=\"line\">Updating dependencies</span><br><span class=\"line\">Resolving dependencies... (0.5s)</span><br><span class=\"line\"></span><br><span class=\"line\">Package operations: 2 installs, 0 updates, 0 removals</span><br><span class=\"line\"></span><br><span class=\"line\">  - Installing numpy (2.1.3)</span><br><span class=\"line\">  - Installing hqf-poetrydemo (0.1.0)</span><br><span class=\"line\"></span><br><span class=\"line\">Writing lock file</span><br></pre></td></tr></table></figure>\n<h3 id=\"self-update-å‡çº§-poetry-ç‰ˆæœ¬\"><code>self update</code> : å‡çº§ poetry ç‰ˆæœ¬</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>self ç›¸å…³å‘½ä»¤ä¸»è¦ç”¨äº poetry è‡ªèº«å®‰è£…æ’ä»¶ä½¿ç”¨</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä¼°è®¡æ’ä»¶åŠŸèƒ½ç›®å‰è¿˜ä¸æˆç†Ÿï¼Œå®˜ç½‘ä¹Ÿæ²¡æœ‰è¿›è¡Œè¯¦ç»†çš„è¯´æ˜ï¼Œå¹¶ä¸” windows ä¸‹æ— æ³•ä½¿ç”¨ï¼Œæ‰€ä»¥è¿™é‡Œä¸è®¨è®ºã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><code>self</code>å‘½ä»¤ä¸‹ç›®å‰åªéœ€è¦è®°ä½ä¸€ä¸ªå‘½ä»¤ï¼š <code>self update</code> : å‡çº§ poetry ç‰ˆæœ¬</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ poetry self update</span><br></pre></td></tr></table></figure>\n<h3 id=\"debug-resolve-æŸ¥çœ‹åŒ…çš„ä¾èµ–å…³ç³»\"><code>debug resolve</code> : æŸ¥çœ‹åŒ…çš„ä¾èµ–å…³ç³»</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åªæŸ¥çœ‹ï¼Œä¸å®‰è£…</span></span><br><span class=\"line\">$ poetry debug resolve requests</span><br><span class=\"line\">Resolving dependencies... (0.4s)</span><br><span class=\"line\"></span><br><span class=\"line\">Resolution results:</span><br><span class=\"line\"></span><br><span class=\"line\">certifi            2024.8.30</span><br><span class=\"line\">charset-normalizer 3.4.0</span><br><span class=\"line\">idna               3.10</span><br><span class=\"line\">urllib3            2.2.3</span><br><span class=\"line\">requests           2.32.3</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹æŒ‡å®šç‰ˆæœ¬çš„ä¾èµ–å…³ç³»</span></span><br><span class=\"line\">$ poetry debug resolve requests@2.32.3</span><br></pre></td></tr></table></figure>\n<h3 id=\"cache-ç¼“å­˜ç®¡ç†\">cache : ç¼“å­˜ç®¡ç†</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>poetryä¸€ä¸ªå¾ˆé‡è¦çš„åŠŸèƒ½å°±æ˜¯ç¼“å­˜å®‰è£…åŒ…ï¼Œå¯ä»¥ <code>å‡å°‘</code> ç›¸åŒçš„å®‰è£…åŒ…è¢«é‡å¤ä¸‹è½½ã€‚ä¸ºä»€ä¹ˆæ˜¯å‡å°‘è€Œä¸æ˜¯é¿å…å‘¢ï¼Ÿå› ä¸ºä¸åŒçš„é•œåƒæºçš„åŒ…æ˜¯åˆ†åˆ«ç¼“å­˜çš„ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>é€šè¿‡ <code>poetry config --list </code> å¯ä»¥çœ‹åˆ° <code>cache-dir</code> çš„åœ°å€ï¼Œè¿™é‡Œå°±æ˜¯ç¼“å­˜ä¸‹è½½åŒ…çš„ç›®å½•ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„ä½¿ç”¨åœºæ™¯</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-6\">è§£å†³ä¾èµ–å®‰è£…é—®é¢˜ï¼š<br>\nå¦‚æœä½ åœ¨å®‰è£…æˆ–æ›´æ–°ä¾èµ–æ—¶é‡åˆ°é—®é¢˜ï¼ˆä¾‹å¦‚ï¼ŒæŸä¸ªåŒ…æ— æ³•æ­£ç¡®å®‰è£…æˆ–ç‰ˆæœ¬ä¸å¯¹ï¼‰ï¼Œæ¸…ç©ºç¼“å­˜å¯ä»¥å¸®åŠ©ä½ ç¡®ä¿ Poetry é‡æ–°ä¸‹è½½æ‰€æœ‰å¿…è¦çš„æ–‡ä»¶ï¼Œä»è€Œè§£å†³é—®é¢˜ã€‚</li>\n<li class=\"lvl-6\">æ¸…ç†ç£ç›˜ç©ºé—´ï¼š<br>\nå¦‚æœä½ çš„é¡¹ç›®å¾ˆå¤šæˆ–è€…ç»å¸¸ä¿®æ”¹ä¾èµ–é¡¹ï¼Œç¼“å­˜å¯èƒ½ä¼šå˜å¾—éå¸¸å¤§ã€‚ä½¿ç”¨ poetry cache clear å¯ä»¥å¸®åŠ©é‡Šæ”¾ç£ç›˜ç©ºé—´ï¼Œç‰¹åˆ«æ˜¯å½“ä½ ä¸ç»å¸¸ä½¿ç”¨æŸäº›åŒ…æ—¶ã€‚</li>\n<li class=\"lvl-6\">æµ‹è¯•æœ€æ–°ç‰ˆæœ¬çš„ä¾èµ–ï¼š<br>\nå¦‚æœä½ æƒ³æµ‹è¯•æŸä¸ªåŒ…çš„æ–°ç‰ˆæœ¬æ˜¯å¦è§£å†³äº†æŸä¸ªé—®é¢˜ï¼Œæˆ–è€…æƒ³ç¡®ä¿ä½ ä½¿ç”¨çš„ç¡®å®æ˜¯æœ€æ–°çš„ç‰ˆæœ¬ï¼Œæ¸…é™¤ç¼“å­˜å¯ä»¥å¼ºåˆ¶ Poetry ä»è¿œç¨‹ä»“åº“é‡æ–°ä¸‹è½½æœ€æ–°çš„åŒ…ã€‚</li>\n<li class=\"lvl-6\">ç¯å¢ƒå˜åŒ–ï¼š<br>\nå¦‚æœä½ çš„å¼€å‘æˆ–ç”Ÿäº§ç¯å¢ƒå‘ç”Ÿäº†å˜åŒ–ï¼ˆä¾‹å¦‚ï¼Œåˆ‡æ¢äº†æ“ä½œç³»ç»Ÿã€æ›´æ–°äº† Python ç‰ˆæœ¬ç­‰ï¼‰ï¼Œæ¸…é™¤ç¼“å­˜å¯ä»¥å¸®åŠ©ä½ ç¡®ä¿ä¾èµ–é¡¹åœ¨æ–°ç¯å¢ƒä¸­æ­£ç¡®å®‰è£…ã€‚</li>\n<li class=\"lvl-6\">è°ƒè¯•ä¾èµ–é—®é¢˜ï¼š<br>\nåœ¨è°ƒè¯•ä¾èµ–é¡¹é—®é¢˜æ—¶ï¼Œæœ‰æ—¶å€™æ¸…é™¤ç¼“å­˜å¯ä»¥å¸®åŠ©ä½ ç¡®å®šé—®é¢˜æ˜¯å¦ä¸ç¼“å­˜ä¸­çš„æ—§ç‰ˆæœ¬æœ‰å…³ã€‚</li>\n<li class=\"lvl-6\">CI/CD ç¯å¢ƒçš„ä¸€è‡´æ€§ï¼š<br>\nåœ¨æŒç»­é›†æˆæˆ–æŒç»­éƒ¨ç½² (CI/CD) ç¯å¢ƒä¸­ï¼Œä¸ºäº†ç¡®ä¿æ¯æ¬¡æ„å»ºéƒ½åŸºäºæœ€æ–°çš„ä¾èµ–ï¼Œæœ‰æ—¶ä¼šåœ¨æ„å»ºè„šæœ¬ä¸­åŒ…å«æ¸…é™¤ç¼“å­˜çš„æ­¥éª¤ã€‚</li>\n</ul>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹ç¼“å­˜åˆ—è¡¨ï¼Œè¿™é‡Œä¼šæŒ‰é•œåƒæºè¿›è¡Œåˆ†ç»„</span></span><br><span class=\"line\">$ poetry cache list</span><br><span class=\"line\">PyPI</span><br><span class=\"line\">_default_cache</span><br><span class=\"line\">tsinghua</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ¸…é™¤æŒ‡å®šæºçš„å…¨éƒ¨ç¼“å­˜</span></span><br><span class=\"line\">$ poetry cache clear pypi --all</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ¸…é™¤æŒ‡å®šæºä¸‹æŸä¸ªåŒ…çš„ç¼“å­˜</span></span><br><span class=\"line\">$ poetry cache clear pypi:requests:2.24.0</span><br></pre></td></tr></table></figure>\n","content_text":"æ‘˜è¦ Poetryæ˜¯ä¸€ä¸ªè½»é‡çº§çš„pythonåŒ…ç®¡ç†å™¨ï¼Œå…¶ç›®æ ‡æ˜¯å¸®åŠ©å¼€å‘è€…å¿«é€Ÿã€è½»æ¾åœ°æ„å»ºã€å‘å¸ƒå’Œåˆ†äº«pythonåŒ…ã€‚è¯´å®ƒè½»é‡ï¼Œæ˜¯ä¸ conda ç›¸æ¯” poetry æ›´è½»é‡ï¼ŒåŒæ—¶ä¸ venv + pip Python--virtualenv çš„æ–¹å¼ç›¸æ¯”å…·æœ‰å¦‚ä¸‹ä¼˜ç‚¹ï¼š ä½¿ç”¨ç¼“å­˜æœºåˆ¶ï¼Œé¿å…é‡å¤ä¸‹è½½ä¾èµ–åŒ… åŒ…ç®¡ç†ä¸Šæ›´åŠ ç²¾ç¡®ï¼Œåˆ é™¤ä¸éœ€è¦çš„åŒ…æ—¶ä¼šåŒæ—¶åˆ é™¤ä¸å…¶å…³è”çš„ä¸”æ²¡æœ‰è¢«ä½¿ç”¨çš„é‚£äº›ä¾èµ–åŒ…ï¼Œé¿å…æ— ç”¨çš„ä¾èµ–åŒ…é€ æˆæ‰“åŒ…ä½“ç§¯è¿‡å¤§ æ‰“åŒ…å’Œå‘å¸ƒæ›´åŠ ç®€å•ï¼Œåªéœ€è¦ä¸€ä¸ªå‘½ä»¤å°±å¯ä»¥æ‰“åŒ…å’Œå‘å¸ƒ å®‰è£… å‚è€ƒå®˜æ–¹æ–‡æ¡£Installation 1234567891011121314# å®˜æ–¹æ¨èä½¿ç”¨pipxå®‰è£…ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨ pip$ pipx install poetry# æŸ¥çœ‹æ˜¯å¦å®‰è£…æˆåŠŸ$ poetry --versionPoetry (version 1.8.4)# æ·»åŠ å‘½ä»¤è‡ªåŠ¨è¡¥å…¨$ mkdir ~/.zfunc$ poetry completions zsh &gt; ~/.zfunc/_poetry# åœ¨ ~/.zshrc ä¸­æ·»åŠ ä»¥ä¸‹é…ç½®ï¼ˆæˆ‘æ˜¯ç”¨çš„æ˜¯zshï¼Œå…¶ä»–shellå¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼‰fpath+=~/.zfuncautoload -Uz compinit &amp;&amp; compinit pipxç®€ä»‹ pipx æ˜¯ä¸€ä¸ª Python åŒ…ç®¡ç†å·¥å…·ï¼Œä½¿ç”¨pipxå®‰è£…å·¥å…·åŒ…æ—¶ï¼Œæ¯ä¸ªå·¥å…·éƒ½ä¼šè¢«å®‰è£…åœ¨ä¸€ä¸ªç‹¬ç«‹çš„è™šæ‹Ÿç¯å¢ƒä¸­ï¼Œé¿å…ä¸åŒå·¥å…·ä¹‹é—´çš„ä¾èµ–å†²çªã€‚ åœºæ™¯ï¼šä¸¤ä¸ªå·¥å…·ä¾èµ–ä¸åŒç‰ˆæœ¬çš„åŒä¸€ä¸ªåº“ å‡è®¾æˆ‘ä»¬æœ‰ä¸¤ä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼š å·¥å…·A ä¾èµ–äº requests åº“çš„ç‰ˆæœ¬ 2.27.1ã€‚ å·¥å…·B ä¾èµ–äº requests åº“çš„ç‰ˆæœ¬ 2.31.0ã€‚ å¦‚æœä½¿ç”¨ pip å®‰è£… å·¥å…·ä¼šè¢«å®‰è£…åˆ°å…¨å±€ç¯å¢ƒï¼Œå…±äº«ç›¸åŒçš„ä¾èµ–ç‰ˆæœ¬ï¼š 12pip install toolA # å®‰è£…æ—¶ä¼šå®‰è£… requests 2.27.1pip install toolB # å®‰è£…æ—¶ä¼šå°† requests å‡çº§åˆ° 2.31.0 ç»“æœï¼š å½“ä½ è¿è¡Œå·¥å…·Aæ—¶ï¼Œå®ƒå¯èƒ½ä¼šæŠ¥é”™ï¼Œå› ä¸ºå®ƒä¾èµ–çš„ requests 2.27.1 å·²è¢« requests 2.31.0 æ›¿æ¢ã€‚ å…¨å±€ç¯å¢ƒä¸­çš„æ‰€æœ‰å·¥å…·éƒ½å…±äº«ä¸€ä¸ª requestsï¼Œç‰ˆæœ¬å†²çªä¸å¯é¿å…ã€‚ å¦‚æœä½¿ç”¨ pipx å®‰è£… æ¯ä¸ªå·¥å…·ä¼šè¢«å®‰è£…åˆ°ç‹¬ç«‹çš„è™šæ‹Ÿç¯å¢ƒä¸­ï¼Œå„è‡ªçš„ä¾èµ–äº’ä¸å½±å“ï¼š 12pipx install toolA # åœ¨è™šæ‹Ÿç¯å¢ƒAä¸­å®‰è£… toolA å’Œ requests 2.27.1pipx install toolB # åœ¨è™šæ‹Ÿç¯å¢ƒBä¸­å®‰è£… toolB å’Œ requests 2.31.0 ç»“æœï¼š è™šæ‹Ÿç¯å¢ƒA åªåŒ…å« toolA å’Œå®ƒçš„ä¾èµ– requests 2.27.1ã€‚ è™šæ‹Ÿç¯å¢ƒB åªåŒ…å« toolB å’Œå®ƒçš„ä¾èµ– requests 2.31.0ã€‚ å·¥å…·ä¹‹é—´å®Œå…¨éš”ç¦»ï¼Œä¸ä¼šå› ä¸ºä¾èµ–ç‰ˆæœ¬å†²çªè€Œå¯¼è‡´é—®é¢˜ã€‚ æ‰€ä»¥ï¼Œå½“éœ€è¦å®‰è£…å…¨å±€å‘½ä»¤è¡Œå·¥å…·æ—¶ï¼Œä½¿ç”¨pipxæ˜¯ä¸ªå¾ˆå¥½çš„é€‰æ‹© pipx çš„å®‰è£… 123456789101112131415# å®‰è£…pipxpip install pipx# é…ç½®ç¯å¢ƒå˜é‡ï¼Œè¿è¡Œè¯¥å‘½ä»¤ä¼šå°†pipx ensurepath# è¿è¡Œä¸Šé¢çš„å‘½ä»¤ä¼šå°†å¦‚ä¸‹å†…å®¹åŠ å…¥ä½ çš„shellé…ç½®æ–‡ä»¶ä¸­ï¼Œæˆ‘çš„æ˜¯ .zshrc æ–‡ä»¶ï¼Œå®é™…ä¸Šä½ ä¹Ÿå¯ä»¥æ‰‹å·¥æ·»åŠ è¯¥é…ç½®ï¼Œå°†$HOME/.local/binæ”¾åˆ°å‰é¢æ›´å¥½ä¸€äº›ã€‚export PATH=&quot;$PATH:$HOME/.local/bin&quot;# æ³¨æ„æ·»åŠ å®Œæˆåè¦é‡å¯shell# æ·»åŠ pipxè‡ªåŠ¨ä»£ç è¡¥å…¨# è¿è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œå¹¶æ ¹æ®æç¤ºå®Œæˆpipx completions# æˆ‘çš„æ˜¯zshï¼Œæ‰€ä»¥åœ¨ .zshrcä¸­æ·»åŠ å¦‚ä¸‹å†…å®¹autoload -Uz compinit &amp;&amp; compinit # å¦‚æœæ²¡æœ‰æ·»åŠ è¿‡å°±éœ€è¦å…ˆæ·»åŠ è¿™ä¸ªeval &quot;$(register-python-argcomplete pipx)&quot; # æ·»åŠ è‡ªåŠ¨ä»£ç è¡¥å…¨# æ³¨æ„æ·»åŠ å®Œæˆåè¦é‡å¯shell æŸ¥çœ‹æ‰€æœ‰å‘½ä»¤ æˆ‘å·²ç»å°†å…¶ç¿»è¯‘ä¸ºä¸­æ–‡ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667$ poetry listPoetry (ç‰ˆæœ¬ 1.8.4)ç”¨æ³•ï¼š command [é€‰é¡¹] [å‚æ•°]é€‰é¡¹ï¼š -h, --help æ˜¾ç¤ºç»™å®šå‘½ä»¤çš„å¸®åŠ©ã€‚å¦‚æœæ²¡æœ‰æŒ‡å®šå‘½ä»¤ï¼Œåˆ™æ˜¾ç¤ºåˆ—è¡¨å‘½ä»¤çš„å¸®åŠ©ã€‚ -q, --quiet ä¸è¾“å‡ºä»»ä½•æ¶ˆæ¯ã€‚ -V, --version æ˜¾ç¤ºæ­¤åº”ç”¨ç¨‹åºç‰ˆæœ¬ã€‚ --ansi å¼ºåˆ¶è¾“å‡ºANSIæ ¼å¼ã€‚ --no-ansi ç¦ç”¨ANSIè¾“å‡ºã€‚ -n, --no-interaction ä¸è¦æé—®ä»»ä½•äº¤äº’æ€§é—®é¢˜ã€‚ --no-plugins ç¦ç”¨æ’ä»¶ã€‚ --no-cache ç¦ç”¨æºç¼“å­˜ã€‚ -C, --directory=ç›®å½• Poetryå‘½ä»¤çš„å·¥ä½œç›®å½•ï¼ˆé»˜è®¤ä¸ºå½“å‰å·¥ä½œç›®å½•ï¼‰ã€‚ -v|vv|vvv, --verbose å¢åŠ æ¶ˆæ¯çš„å†—é•¿åº¦ï¼š1 è¡¨ç¤ºæ­£å¸¸è¾“å‡ºï¼Œ2 è¡¨ç¤ºæ›´è¯¦ç»†çš„è¾“å‡ºï¼Œ3 è¡¨ç¤ºè°ƒè¯•ã€‚å¯ç”¨å‘½ä»¤ï¼š about æ˜¾ç¤ºå…³äºPoetryçš„ä¿¡æ¯ã€‚ add å°†æ–°ä¾èµ–é¡¹æ·»åŠ åˆ°pyproject.tomlå¹¶å®‰è£…å®ƒã€‚ build é»˜è®¤æ„å»ºä¸€ä¸ªåŒ…ï¼Œåˆ†åˆ«æ˜¯tarballå’Œwheelã€‚ check éªŒè¯pyproject.tomlæ–‡ä»¶çš„å†…å®¹åŠå…¶ä¸poetry.lockæ–‡ä»¶çš„ä¸€è‡´æ€§ã€‚ config ç®¡ç†é…ç½®è®¾ç½®ã€‚ export å°†é”æ–‡ä»¶å¯¼å‡ºåˆ°å…¶ä»–æ ¼å¼ã€‚ help æ˜¾ç¤ºç‰¹å®šå‘½ä»¤çš„å¸®åŠ©ã€‚ init åœ¨å½“å‰ç›®å½•åˆ›å»ºä¸€ä¸ªåŸºç¡€çš„pyproject.tomlæ–‡ä»¶ã€‚ install å®‰è£…é¡¹ç›®ä¾èµ–é¡¹ã€‚ list åˆ—å‡ºå‘½ä»¤ã€‚ lock é”å®šé¡¹ç›®ä¾èµ–é¡¹ã€‚ new åœ¨&lt;path&gt;å¤„åˆ›å»ºä¸€ä¸ªæ–°çš„Pythoné¡¹ç›®ã€‚ publish å°†åŒ…å‘å¸ƒåˆ°è¿œç¨‹ä»“åº“ã€‚ remove ä»é¡¹ç›®ä¾èµ–é¡¹ä¸­ç§»é™¤åŒ…ã€‚ run åœ¨é€‚å½“çš„ç¯å¢ƒä¸­è¿è¡Œå‘½ä»¤ã€‚ search åœ¨è¿œç¨‹ä»“åº“ä¸­æœç´¢åŒ…ã€‚ shell åœ¨è™šæ‹Ÿç¯å¢ƒä¸­å¯åŠ¨shellã€‚ show æ˜¾ç¤ºæœ‰å…³åŒ…çš„ä¿¡æ¯ã€‚ update æ ¹æ®pyproject.tomlæ–‡ä»¶æ›´æ–°ä¾èµ–é¡¹ã€‚ version æ˜¾ç¤ºé¡¹ç›®çš„ç‰ˆæœ¬æˆ–åœ¨æä¾›æœ‰æ•ˆç‰ˆæœ¬è§„åˆ™æ—¶æ›´æ–°å®ƒã€‚ç¼“å­˜ cache clear æŒ‰åç§°æ¸…é™¤Poetryç¼“å­˜ã€‚ cache list åˆ—å‡ºPoetryçš„ç¼“å­˜åˆ—è¡¨ã€‚è°ƒè¯• debug info æ˜¾ç¤ºè°ƒè¯•ä¿¡æ¯ã€‚ debug resolve è°ƒè¯•ä¾èµ–é¡¹è§£æã€‚ç¯å¢ƒ env info æ˜¾ç¤ºå½“å‰ç¯å¢ƒçš„ä¿¡æ¯ã€‚ env list åˆ—å‡ºä¸å½“å‰é¡¹ç›®å…³è”çš„æ‰€æœ‰è™šæ‹Ÿç¯å¢ƒã€‚ env remove ç§»é™¤ä¸é¡¹ç›®å…³è”çš„è™šæ‹Ÿç¯å¢ƒã€‚ env use æ¿€æ´»æˆ–åˆ›å»ºå½“å‰é¡¹ç›®çš„æ–°çš„è™šæ‹Ÿç¯å¢ƒã€‚è‡ªèº« self add å‘Poetryçš„è¿è¡Œæ—¶ç¯å¢ƒæ·»åŠ å…¶ä»–åŒ…ã€‚ self install å®‰è£…æ­¤Poetryå®‰è£…æ‰€éœ€çš„é”å®šåŒ…ï¼ˆåŒ…æ‹¬æ’ä»¶ï¼‰ã€‚ self lock é”å®šPoetryå®‰è£…çš„ç³»ç»Ÿè¦æ±‚ã€‚ self remove ä»Poetryçš„è¿è¡Œæ—¶ç¯å¢ƒä¸­ç§»é™¤å…¶ä»–åŒ…ã€‚ self show æ˜¾ç¤ºPoetryè¿è¡Œæ—¶ç¯å¢ƒä¸­çš„åŒ…ã€‚ self show plugins æ˜¾ç¤ºå½“å‰å·²å®‰è£…æ’ä»¶çš„ä¿¡æ¯ã€‚ self update æ›´æ–°Poetryåˆ°æœ€æ–°ç‰ˆæœ¬ã€‚æº source add ä¸ºé¡¹ç›®æ·»åŠ æºé…ç½®ã€‚ source remove ç§»é™¤ä¸ºé¡¹ç›®é…ç½®çš„æºã€‚ source show æ˜¾ç¤ºä¸ºé¡¹ç›®é…ç½®çš„æºä¿¡æ¯ã€‚ å¸¸ç”¨å‘½ä»¤ è¿™é‡Œåªå¯¹æ—¥å¸¸å¼€å‘ä¸­æ¯”è¾ƒå¸¸ç”¨çš„å‘½ä»¤è¿›è¡Œç®€è¦è¯´æ˜ï¼Œè¯¦ç»†ä»‹ç»å¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£ new : åˆ›å»ºé¡¹ç›® 12345678910111213141516171819202122232425262728293031# æŒ‰ç…§é»˜è®¤è§„åˆ™åˆ›å»ºä¸€ä¸ªåŸºäº poetry çš„é¡¹ç›®$ poetry new my-projectCreated package my_project in my-project$ cd my-project# æŸ¥çœ‹ç”Ÿæˆçš„ç›®å½•ç»“æ„$ exa -T.â”œâ”€â”€ my_projectâ”‚ â””â”€â”€ __init__.pyâ”œâ”€â”€ pyproject.tomlâ”œâ”€â”€ README.mdâ””â”€â”€ tests â””â”€â”€ __init__.py# æŸ¥çœ‹ pyproject.toml å†…å®¹ï¼Œè¯¥æ–‡ä»¶ä¸ºé¡¹ç›®çš„é…ç½®çš„é…ç½®æ–‡ä»¶$ more pyproject.toml[tool.poetry]name = &quot;my-project&quot;version = &quot;0.1.0&quot;description = &quot;&quot;authors = [&quot;hanqunfeng &lt;hanqf2008@163.com&gt;&quot;]readme = &quot;README.md&quot;[tool.poetry.dependencies]python = &quot;^3.11&quot;[build-system]requires = [&quot;poetry-core&quot;]build-backend = &quot;poetry.core.masonry.api&quot; init : åˆå§‹åŒ–ä¸€ä¸ªå·²æœ‰çš„é¡¹ç›®ç›®å½• 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647# å‡è®¾æˆ‘ä»¬å·²ç»æœ‰ä¸ªé¡¹ç›®ç›®å½•ï¼Œç›®å½•åç§°ä¸º poetryDemo$ cd poetryDemo# åˆå§‹åŒ– poetryDemo ï¼Œåœ¨å½“å‰ç›®å½•ä¸‹åˆ›å»º pyproject.toml æ–‡ä»¶ï¼Œæ³¨æ„è¯¥æ“ä½œåªä¼šåˆ›å»ºè¯¥æ–‡ä»¶ï¼ŒåŒ…ç›®å½•ä»¥åŠreadmeæ–‡ä»¶éƒ½æ²¡æœ‰ï¼Œéœ€è¦æ‰‹å·¥åˆ›å»º$ poetry initThis command will guide you through creating your pyproject.toml config.Package name [poetrydemo]: # åŒ…åç§°Version [0.1.0]: # ç‰ˆæœ¬å·Description []: # æè¿°ä¿¡æ¯Author [hanqunfeng &lt;hanqf2008@163.com&gt;, n to skip]: # ä½œè€…License []: # LicenseCompatible Python versions [^3.11]: # python ç‰ˆæœ¬Would you like to define your main dependencies interactively? (yes/no) [yes] # æ‚¨æƒ³ä»¥äº¤äº’æ–¹å¼å®šä¹‰æ‚¨çš„ä¸»ç¯å¢ƒä¾èµ–å…³ç³»å—ï¼Ÿé»˜è®¤yesYou can specify a package in the following forms: # æ‚¨å¯ä»¥æŒ‰ä»¥ä¸‹å½¢å¼æŒ‡å®šåŒ…ï¼š - A single name (requests): this will search for matches on PyPI # å•ä¸ªåç§°ï¼ˆrequestsï¼‰ï¼šè¿™å°†åœ¨å®˜æ–¹ä»“åº“PyPIä¸Šæœç´¢åŒ¹é…é¡¹ï¼Œå¦‚æœæŒ‡å®šäº†å…¶å®ƒé•œåƒæºå°±ä¼šä»æŒ‡å®šçš„æºä¸‹è½½ - A name and a constraint (requests@^2.23.0) # åç§°å’Œç‰ˆæœ¬çº¦æŸ - A git url (git+https://github.com/python-poetry/poetry.git) # gitåœ°å€ - A git url with a revision (git+https://github.com/python-poetry/poetry.git#develop) # gitåœ°å€ï¼ŒæŒ‡å®šæŸä¸ªåˆ†æ”¯ - A file path (../my-package/my-package.whl) # æ–‡ä»¶è·¯å¾„ - A directory (../my-package/) # ç›®å½•è·¯å¾„ - A url (https://example.com/packages/my-package-0.1.0.tar.gz) # ä¸€ä¸ªå®‰è£…åŒ…çš„åœ°å€Package to add or search for (leave blank to skip): # æ·»åŠ ä¸»ç¯å¢ƒä¾èµ–ï¼ŒæŒ‰ä¸Šé¢çš„æ ¼å¼è¦æ±‚å¡«å†™Would you like to define your development dependencies interactively? (yes/no) [yes] # æ‚¨æƒ³ä»¥äº¤äº’æ–¹å¼å®šä¹‰æ‚¨çš„å¼€å‘ä¾èµ–å…³ç³»å—ï¼Ÿé»˜è®¤yesPackage to add or search for (leave blank to skip): # æ·»åŠ å¼€å‘ç¯å¢ƒä¾èµ–ï¼ŒæŒ‰ä¸Šé¢çš„æ ¼å¼è¦æ±‚å¡«å†™Generated file# è¦ç”Ÿæˆçš„ pyproject.toml å†…å®¹[tool.poetry]name = &quot;poetrydemo&quot; # åŒ…åç§°version = &quot;0.1.0&quot; # ç‰ˆæœ¬description = &quot;&quot; # æè¿°ä¿¡æ¯authors = [&quot;hanqunfeng &lt;hanqf2008@163.com&gt;&quot;] # ä½œè€…ä¿¡æ¯readme = &quot;README.md&quot; # è¯´æ˜æ–‡ä»¶[tool.poetry.dependencies] # ä¸»ç¯å¢ƒä¾èµ–python = &quot;^3.11&quot;[build-system]requires = [&quot;poetry-core&quot;]build-backend = &quot;poetry.core.masonry.api&quot;Do you confirm generation? (yes/no) [yes] # ç¡®è®¤æ˜¯å¦æŒ‰ç…§ä¸Šé¢çš„å†…å®¹åˆ›å»º pyproject.toml æ–‡ä»¶ï¼Œé»˜è®¤yes ä¸Šé¢çš„æ–¹å¼åœ¨åˆå§‹åŒ–æ—¶ä¼šè¯¢é—®ä½ ç›¸å…³çš„ä¿¡æ¯ï¼Œå¦‚æœä½ å¸Œæœ›éƒ½ç”¨é»˜è®¤å€¼çš„è¯ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ 1poetry init -n config : poetryçš„å…¨å±€é…ç½® æŸ¥çœ‹å…¨å±€é…ç½® 12345678910111213141516171819$ poetry config --listcache-dir = &quot;/Users/hanqf/Library/Caches/pypoetry&quot; # ç¼“å­˜ç›®å½•,ç”¨äºå­˜å‚¨é¡¹ç›®ä¾èµ–å’Œè™šæ‹Ÿç¯å¢ƒç­‰ç¼“å­˜ä¿¡æ¯ã€‚experimental.system-git-client = false # æ˜¯å¦ä½¿ç”¨ç³»ç»Ÿè‡ªå¸¦çš„gitå®¢æˆ·ç«¯,falseè¡¨ç¤ºä½¿ç”¨Poetryå†…ç½®çš„gitå®¢æˆ·ç«¯installer.max-workers = null # å®‰è£…ä¾èµ–æ—¶çš„æœ€å¤§çº¿ç¨‹æ•°,nullè¡¨ç¤ºä½¿ç”¨é»˜è®¤çº¿ç¨‹æ•°ï¼Œå¯ä»¥è®¾ç½®ä¸ºcpuæ ¸æ•°+4installer.modern-installation = true # æ˜¯å¦ä½¿ç”¨Poetryçš„ç°ä»£å®‰è£…æ–¹æ¡ˆ,trueè¡¨ç¤ºä½¿ç”¨installer.no-binary = null # æ˜¯å¦ä¸ä½¿ç”¨é¢„ç¼–è¯‘çš„äºŒè¿›åˆ¶åŒ…,nullè¡¨ç¤ºä¸é™åˆ¶installer.parallel = true # æ˜¯å¦å¹¶è¡Œå®‰è£…ä¾èµ–,trueè¡¨ç¤ºå¹¶è¡Œå®‰è£…keyring.enabled = true # æ˜¯å¦å¯ç”¨å¯†é’¥ç¯ï¼ˆkeyringï¼‰ä»¥ä¿å­˜è®¤è¯ä¿¡æ¯ã€‚true è¡¨ç¤ºå¯ç”¨ã€‚solver.lazy-wheel = true # æ˜¯å¦å»¶è¿Ÿè§£æ wheel åŒ…ã€‚true è¡¨ç¤ºå»¶è¿Ÿè§£æã€‚virtualenvs.create = true # æ˜¯å¦è‡ªåŠ¨åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ,trueè¡¨ç¤ºåˆ›å»ºvirtualenvs.in-project = null # æ˜¯å¦åœ¨é¡¹ç›®å†…åˆ›å»ºè™šæ‹Ÿç¯å¢ƒï¼Œnull è¡¨ç¤ºä½¿ç”¨é»˜è®¤å€¼ï¼ˆé€šå¸¸ä¸º falseï¼‰ï¼Œå³ä¸åœ¨é¡¹ç›®ä¸­åˆ›å»ºã€‚trueè¡¨ç¤ºåœ¨é¡¹ç›®ä¸­åˆ›å»ºvirtualenvs.options.always-copy = false # å¦‚æœè®¾ç½®ä¸º trueï¼ŒPoetry ä¼šå§‹ç»ˆå¤åˆ¶æ–‡ä»¶åˆ°è™šæ‹Ÿç¯å¢ƒä¸­ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ç¬¦å·é“¾æ¥ï¼ˆsymlinksï¼‰ã€‚è¿™å¯ä»¥é¿å…æŸäº›ç³»ç»Ÿä¸Šçš„æƒé™é—®é¢˜ï¼Œä½†ä¼šå¢åŠ è™šæ‹Ÿç¯å¢ƒçš„å­˜å‚¨éœ€æ±‚ã€‚virtualenvs.options.no-pip = false # å¦‚æœè®¾ç½®ä¸º trueï¼ŒPoetry åœ¨åˆ›å»ºè™šæ‹Ÿç¯å¢ƒæ—¶ä¸ä¼šå®‰è£… pipã€‚å¦‚æœä½ çš„é¡¹ç›®ä¸éœ€è¦ç›´æ¥ä½¿ç”¨ pipï¼Œå¹¶ä¸”ä½ å¸Œæœ›é€šè¿‡ Poetry ç®¡ç†æ‰€æœ‰çš„ä¾èµ–é¡¹ï¼Œå¯ä»¥å°† no-pip è®¾ç½®ä¸º trueï¼Œä»¥å‡å°‘è™šæ‹Ÿç¯å¢ƒä¸­çš„ä¸å¿…è¦çš„ä¾èµ–é¡¹ã€‚virtualenvs.options.no-setuptools = false # å¦‚æœè®¾ç½®ä¸º trueï¼ŒPoetry åœ¨åˆ›å»ºè™šæ‹Ÿç¯å¢ƒæ—¶ä¸ä¼šå®‰è£… setuptoolsã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒPoetry ä¼šå®‰è£… pip å’Œ setuptoolsï¼Œä»¥ä¾¿ä½ å¯ä»¥ä½¿ç”¨è¿™äº›å·¥å…·æ¥ç®¡ç†ä¾èµ–é¡¹ã€‚virtualenvs.options.system-site-packages = false # é»˜è®¤å€¼falseï¼Œæ­¤æ—¶ Poetry åˆ›å»ºçš„è™šæ‹Ÿç¯å¢ƒå°†ä¸ä¼šåŒ…å«å…¨å±€ Python å®‰è£…çš„ site-packages ç›®å½•ä¸­çš„åŒ…ã€‚è¿™æœ‰åŠ©äºç¡®ä¿é¡¹ç›®ä¾èµ–é¡¹çš„éš”ç¦»æ€§ï¼Œé¿å…ä¸ç³»ç»Ÿä¸­çš„å…¶ä»–åŒ…å‘ç”Ÿå†²çªã€‚virtualenvs.path = &quot;&#123;cache-dir&#125;/virtualenvs&quot; # /Users/hanqf/Library/Caches/pypoetry/virtualenvs # è™šæ‹Ÿç¯å¢ƒå­˜æ”¾çš„è·¯å¾„ï¼Œå¦‚æœvirtualenvs.in-projectè®¾ç½®ä¸ºtrueï¼Œå°±åªä¼šåœ¨é¡¹ç›®ä¸­åˆ›å»ºvirtualenvs.prefer-active-python = false # æ˜¯å¦ä¼˜å…ˆä½¿ç”¨ç³»ç»Ÿæ¿€æ´»çš„Pythonè§£é‡Šå™¨virtualenvs.prompt = &quot;&#123;project_name&#125;-py&#123;python_version&#125;&quot; # è™šæ‹Ÿç¯å¢ƒçš„å‘½ä»¤æç¤ºæ ¼å¼warnings.export = true # æ˜¯å¦åœ¨å¯¼å‡ºæ—¶æ˜¾ç¤ºè­¦å‘Šä¿¡æ¯ã€‚true è¡¨ç¤ºæ˜¾ç¤º ä¿®æ”¹å…¨å±€é…ç½® 1234567891011121314151617# ä¿®æ”¹å…¨å±€é…ç½®ï¼Œæ­¤åä¼šåœ¨é¡¹ç›®ç›®å½•ä¸‹åˆ›å»º .venv ç›®å½•å­˜æ”¾è™šæ‹Ÿç¯å¢ƒ$ poetry config virtualenvs.in-project true# è¿›å…¥è™šæ‹Ÿç¯å¢ƒï¼Œå¦‚æœè™šæ‹Ÿç¯å¢ƒå°šæœªåˆ›å»ºä¼šè‡ªåŠ¨åˆ›å»º$ poetry shell# é€€å‡ºè™šæ‹Ÿç¯å¢ƒ$ exit# åªå¯¹å½“å‰é¡¹ç›®æœ‰æ•ˆï¼Œæ­¤æ—¶ä¼šåœ¨å½“å‰é¡¹ç›®ç›®å½•ä¸‹åˆ›å»º poetry.toml æ¥ä¿å­˜è¿™äº›é…ç½®ä¿¡æ¯$ poetry config virtualenvs.in-project true --local$ poetry config virtualenvs.options.system-site-packages true --local$ more poetry.toml[virtualenvs]in-project = true[virtualenvs.options]system-site-packages = true# è¿™é‡Œè¦æ³¨æ„ virtualenvs ä¸‹çš„å±æ€§å¿…é¡»åœ¨åˆ›å»ºè™šæ‹Ÿç¯å¢ƒå‰è®¾ç½®æ‰ä¼šæœ‰æ•ˆ env : è™šæ‹Ÿç¯å¢ƒç®¡ç† Poetry ä¼šåœ¨ä½ ç¬¬ä¸€æ¬¡è¿è¡ŒæŸäº›å‘½ä»¤ï¼ˆå¦‚ poetry shell æˆ–è€… poetry add somepackageï¼‰æ—¶è‡ªåŠ¨åˆ›å»ºè™šæ‹Ÿç¯å¢ƒã€‚ ä¸è¿‡è¿™ç§æ—¶å€™éƒ½æ˜¯ä½¿ç”¨ç³»ç»Ÿé»˜è®¤çš„pythonæ¥åˆ›å»ºè™šæ‹Ÿç¯å¢ƒï¼Œå¦‚æœç³»ç»Ÿä¸­å®‰è£…äº†å¤šä¸ªpythonï¼Œåˆ™å¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹å¼è®¾ç½®è™šæ‹Ÿç¯å¢ƒè¦ä½¿ç”¨å“ªä¸ªpythonç‰ˆæœ¬ åˆ›å»º/åˆ‡æ¢è™šæ‹Ÿç¯å¢ƒ 123456789# æŒ‡å®špythonçš„ç‰ˆæœ¬ï¼Œè¿™ä¼šä»pythonçš„é»˜è®¤å®‰è£…è·¯å¾„ä¸‹æŸ¥æ‰¾å¯¹åº”çš„ç‰ˆæœ¬# æ¯”å¦‚macOsä¼šä»è¯¥è·¯å¾„ä¸‹æŸ¥æ‰¾ï¼š/Library/Frameworks/Python.framework/Versions$ poetry env use 3.11# å¦‚æœå¯ä»¥ç›´æ¥åœ¨å‘½ä»¤è¡Œä½¿ç”¨pythonå‘½ä»¤,æ¯”å¦‚ï¼špython3.12 -Vï¼Œåˆ™å¯ä»¥ä½¿ç”¨å¦‚ä¸‹æ–¹å¼åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ$ poetry env use python3.12# å¦‚æœpythonå®‰è£…åˆ°äº†å…¶å®ƒè·¯å¾„ï¼Œå¯ä»¥æŒ‡å®špythonå®‰è£…è·¯å¾„$ poetry env use /pythonDir/3.13/bin/python3 æŸ¥çœ‹å½“å‰é¡¹ç›®çš„è™šæ‹Ÿç¯å¢ƒä¿¡æ¯ 12345678910111213141516171819202122232425262728293031323334353637383940# åˆ›å»ºä¸€ä¸ªåŸºäº python3.13 çš„è™šæ‹Ÿç¯å¢ƒ$ poetry env use python3.13Creating virtualenv poetrydemo-fyqYbfje-py3.13 in /Users/hanqf/Library/Caches/pypoetry/virtualenvsUsing virtualenv: /Users/hanqf/Library/Caches/pypoetry/virtualenvs/poetrydemo-fyqYbfje-py3.13# å†åˆ›å»ºä¸€ä¸ªåŸºäº python3.11 çš„è™šæ‹Ÿç¯å¢ƒï¼Œæœ€åè¢«useçš„å¤„äºé»˜è®¤æ¿€æ´»çŠ¶æ€$ poetry env use python3.11Creating virtualenv poetrydemo-fyqYbfje-py3.11 in /Users/hanqf/Library/Caches/pypoetry/virtualenvsUsing virtualenv: /Users/hanqf/Library/Caches/pypoetry/virtualenvs/poetrydemo-fyqYbfje-py3.11# æŸ¥çœ‹å½“å‰é¡¹ç›®æœ‰å¤šå°‘ä¸ªè™šæ‹Ÿç¯å¢ƒ$ poetry env listpoetrydemo-fyqYbfje-py3.11 (Activated) # poetrydemo-fyqYbfje-py3.11 è¡¨ç¤ºè™šæ‹Ÿç¯å¢ƒåç§°ï¼ŒActivatedè¡¨ç¤ºå½“å‰è™šæ‹Ÿç¯å¢ƒå·²ç»è¢«æ¿€æ´»poetrydemo-fyqYbfje-py3.13# æŸ¥çœ‹è™šæ‹ŸåŒ–ç¯å¢ƒè·¯å¾„$ poetry env list --full-path/Users/hanqf/Library/Caches/pypoetry/virtualenvs/poetrydemo-fyqYbfje-py3.11 (Activated)# æŸ¥çœ‹å½“å‰æ¿€æ´»çš„è™šæ‹Ÿç¯å¢ƒä¿¡æ¯$ poetry env infoVirtualenvPython: 3.11.3Implementation: CPythonPath: /Users/hanqf/Library/Caches/pypoetry/virtualenvs/poetrydemo-fyqYbfje-py3.11Executable: /Users/hanqf/Library/Caches/pypoetry/virtualenvs/poetrydemo-fyqYbfje-py3.11/bin/pythonValid: TrueBasePlatform: darwinOS: posixPython: 3.11.3Path: /Library/Frameworks/Python.framework/Versions/3.11Executable: /Library/Frameworks/Python.framework/Versions/3.11/bin/python3.11# åˆ é™¤è™šæ‹Ÿç¯å¢ƒ$ poetry env remove python3.13Deleted virtualenv: /Users/hanqf/Library/Caches/pypoetry/virtualenvs/poetrydemo-fyqYbfje-py3.13# åˆ é™¤å…¨éƒ¨è™šæ‹Ÿç¯å¢ƒ$ poetry env remove --all æ³¨æ„ï¼Œå½“virtualenvs.in-projectè¢«è®¾ç½®ä¸ºtrueæ—¶ï¼Œå³åªåœ¨é¡¹ç›®ç›®å½•ä¸‹åˆ›å»ºè™šæ‹Ÿç¯å¢ƒæ—¶ï¼Œåªä¼šä¿ç•™ä¸€ä¸ªç¯å¢ƒï¼Œå³.venv åˆ‡æ¢åˆ°æ–°çš„è™šæ‹Ÿç¯å¢ƒæ—¶ä¼šå…¨æ–°åˆ›å»ºä¸€ä¸ªæ–°çš„ç¯å¢ƒï¼ŒåŸå…ˆçš„ç¯å¢ƒä¼šè¢«åˆ é™¤ï¼Œæ‰€ä»¥è¦ä½¿ç”¨poetry installå‘½ä»¤é‡æ–°å®‰è£…ä¾èµ– 123456789101112131415161718192021222324$ poetry env use python3.11Recreating virtualenv poetrydemo in /Users/hanqf/Desktop/pythonDir/poetryDir/poetryDemo/.venvUsing virtualenv: /Users/hanqf/Desktop/pythonDir/poetryDir/poetryDemo/.venv$ poetry env list # è™½ç„¶å¯ä»¥é€šè¿‡ poetry env use çš„æ–¹å¼æ¥åˆ›å»ºæ–°çš„è™šæ‹Ÿç¯å¢ƒï¼Œä½†å®é™…ä¸Šåªä¼šæœ‰ä¸€ä¸ªç¯å¢ƒè¢«ä¿ç•™ï¼Œæ‰€ä»¥è¿™é‡Œåªä¼šæ˜¾ç¤ºä¸€ä¸ª.venv (Activated) # .venv è¡¨ç¤ºè™šæ‹Ÿç¯å¢ƒåç§°ï¼ŒActivatedè¡¨ç¤ºå½“å‰è™šæ‹Ÿç¯å¢ƒå·²ç»è¢«æ¿€æ´»# æŸ¥çœ‹è™šæ‹Ÿç¯å¢ƒä¿¡æ¯$ poetry env infoVirtualenvPython: 3.11.3Implementation: CPythonPath: /Users/hanqf/Desktop/pythonDir/poetryDir/poetryDemo/.venvExecutable: /Users/hanqf/Desktop/pythonDir/poetryDir/poetryDemo/.venv/bin/pythonValid: TrueBasePlatform: darwinOS: posixPython: 3.11.3Path: /Library/Frameworks/Python.framework/Versions/3.11Executable: /Library/Frameworks/Python.framework/Versions/3.11/bin/python3.11 ä¾èµ–åŒ…ç®¡ç† add : å®‰è£…ä¾èµ–åŒ… è¿™ä¸ªå‘½ä»¤ä¼šä¿®æ”¹ pyproject.toml æ–‡ä»¶ï¼Œåœ¨ [tool.poetry.dependencies] éƒ¨åˆ†æ·»åŠ æ–°çš„ä¾èµ–é¡¹ã€‚è¿˜ä¼šè‡ªåŠ¨æ›´æ–° poetry.lock æ–‡ä»¶ï¼Œé”å®šä¾èµ–çš„ç¡®åˆ‡ç‰ˆæœ¬ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556# å®‰è£…ä¾èµ–ï¼Œå®‰è£…åä¼šå°†ä¾èµ–ä¿¡æ¯å†™å…¥ pyproject.toml ä¸­# ä¸æŒ‡å®šç‰ˆæœ¬åˆ™å®‰è£…æœ€æ–°ç‰ˆ$ poetry add fastapiUsing version ^0.115.5 for fastapiUpdating dependenciesResolving dependencies... (1.3s)Package operations: 9 installs, 0 updates, 0 removals - Installing idna (3.10) - Installing sniffio (1.3.1) - Installing typing-extensions (4.12.2) - Installing annotated-types (0.7.0) - Installing anyio (4.6.2.post1) - Installing pydantic-core (2.23.4) - Installing pydantic (2.9.2) - Installing starlette (0.41.3) - Installing fastapi (0.115.5)Writing lock file# æŒ‡å®šç‰ˆæœ¬å·å®‰è£…ä¾èµ–poetry add package_name@^1.2.3 # è§„åˆ™è¯´æ˜ ^1.2.3 è¡¨ç¤ºå…¼å®¹ 1.2.3 åŠæ›´é«˜çš„å°ç‰ˆæœ¬ï¼Œä½†ä¸åŒ…æ‹¬ 2.0.0ã€‚ å¦‚ï¼špoetry add requests@^2.28.0 ~1.2.3ï¼šå…è®¸å‡çº§åˆ° 1.2.xï¼Œä½†ä¸åŒ…æ‹¬ 1.3.0ã€‚ å¦‚ï¼špoetry add requests@~2.28.0 1.2.3ï¼šå›ºå®šä¸º 1.2.3ã€‚ å¦‚ï¼špoetry add requests@2.28.0 &gt;=1.2.3ï¼šå…è®¸ä½¿ç”¨ 1.2.3 åŠä»¥ä¸Šç‰ˆæœ¬ã€‚æ³¨æ„zshä¸‹è¦åŠ ä¸ŠåŒå¼•å·ï¼Œå¦‚ï¼špoetry add &quot;requests@&gt;=2.28.0&quot; &lt;2.0.0ï¼šå…è®¸ä½¿ç”¨å°äº 2.0.0 çš„ç‰ˆæœ¬ã€‚ æ³¨æ„zshä¸‹è¦åŠ ä¸ŠåŒå¼•å·ï¼Œå¦‚ï¼špoetry add &quot;requests@&lt;3.0.0&quot;# å®‰è£…åˆ°æŒ‡å®šçš„åˆ†ç»„ï¼Œé»˜è®¤éƒ½æ˜¯å®‰è£…åˆ°ä¸»ç¯å¢ƒä¸­çš„ï¼Œpoetry buildé»˜è®¤åªä¼šæ‰“åŒ…ä¸»ç¯å¢ƒçš„ä¾èµ–poetry add flask # å®‰è£…åˆ°ä¸»ç¯å¢ƒä¸­poetry add flask --group=test #æ·»åŠ åˆ†ç»„å testpoetry add flask --dev #ç›¸å½“äº--group=dev# åˆ†åˆ«æ‰§è¡Œä¸Šé¢3ä¸ªå®‰è£…å‘½ä»¤åï¼Œè¾“å‡º pyproject.toml çš„å†…å®¹å¦‚ä¸‹[tool.poetry]name = &quot;poetrydemo&quot;version = &quot;0.1.0&quot;description = &quot;&quot;authors = [&quot;hanqunfeng &lt;hanqf2008@163.com&gt;&quot;]readme = &quot;README.md&quot;[tool.poetry.dependencies] # ä¸»ç¯å¢ƒpython = &quot;^3.11&quot;flask = &quot;^3.1.0&quot;[tool.poetry.group.test.dependencies] # teståˆ†ç»„ä¾èµ–flask = &quot;^3.1.0&quot;[tool.poetry.group.dev.dependencies] # devåˆ†ç»„ä¾èµ–flask = &quot;^3.1.0&quot;[build-system]requires = [&quot;poetry-core&quot;]build-backend = &quot;poetry.core.masonry.api&quot; show : æŸ¥çœ‹ä¾èµ–åŒ… 123456789101112131415# æŸ¥çœ‹å½“å‰é¡¹ç›®éƒ½éœ€è¦å“ªäº›ä¾èµ–ï¼Œè¿™äº›ä¾èµ–ä¸ä¸€å®šéƒ½å®‰è£…äº†ï¼Œå®ƒåªæ˜¯è§£æ pyproject.toml ä¸­çš„å£°æ˜æ¥è§£æä¾èµ–æ ‘$ poetry showannotated-types 0.7.0 Reusable constraint types to use with typing.Annotatedanyio 4.6.2.post1 High level compatibility layer for multiple asynchronous ...fastapi 0.115.5 FastAPI framework, high performance, easy to learn, fast ...idna 3.10 Internationalized Domain Names in Applications (IDNA)pydantic 2.9.2 Data validation using Python type hintspydantic-core 2.23.4 Core functionality for Pydantic validation and serializationsniffio 1.3.1 Sniff out which async library your code is running understarlette 0.41.3 The little ASGI library that shines.typing-extensions 4.12.2 Backported and Experimental Type Hints for Python 3.8+# åªæŸ¥çœ‹é¡¶çº§ä¾èµ–ï¼Œå³åªæŸ¥çœ‹åœ¨ pyproject.toml ä¸­å£°æ˜çš„ä¾èµ–$ poetry show --top-levelfastapi 0.115.5 FastAPI framework, high performance, easy to learn, fast ... remove : åˆ é™¤ä¾èµ–åŒ… 123456789101112131415161718# åˆ é™¤ä¾èµ–ï¼Œæ­¤æ—¶ä¼šå°†å½“å‰åŒ…åŠå…¶æ‰€æœ‰ä¾èµ–ä¸€å—åˆ é™¤$ poetry remove fastapiUpdating dependenciesResolving dependencies... (0.1s)Package operations: 0 installs, 0 updates, 9 removals - Removing annotated-types (0.7.0) - Removing anyio (4.6.2.post1) - Removing fastapi (0.115.5) - Removing idna (3.10) - Removing pydantic (2.9.2) - Removing pydantic-core (2.23.4) - Removing sniffio (1.3.1) - Removing starlette (0.41.3) - Removing typing-extensions (4.12.2)Writing lock file search : æœç´¢è¿œç¨‹ä»“åº“ 12# æœç´¢è¿œç¨‹ä»“åº“$ poetry search fastapi install å’Œ update : å®‰è£…å’Œæ›´æ–°ä¾èµ–åŒ… åœ¨ Poetry ä¸­ï¼Œinstall å’Œ update æ˜¯ä¸¤ä¸ªå¸¸ç”¨çš„å‘½ä»¤ï¼Œä½†å®ƒä»¬çš„ä½œç”¨å’Œä½¿ç”¨åœºæ™¯ä¸åŒ poetry install çš„ä½œç”¨æ˜¯æ ¹æ®ç°æœ‰çš„ poetry.lock æ–‡ä»¶æ¥å®‰è£…ä¾èµ–ï¼Œç¡®ä¿å®‰è£…çš„ä¾èµ–ç‰ˆæœ¬ä¸é”æ–‡ä»¶ä¸­è®°å½•çš„ç‰ˆæœ¬å®Œå…¨ä¸€è‡´ã€‚ æ ¸å¿ƒç‰¹ç‚¹ï¼š å®‰è£…é”å®šçš„ç‰ˆæœ¬ï¼šå®ƒåªä¼šå®‰è£… poetry.lock æ–‡ä»¶ä¸­æŒ‡å®šçš„ç‰ˆæœ¬ï¼Œå³ä½¿ pyproject.toml æ–‡ä»¶ä¸­å®šä¹‰çš„ç‰ˆæœ¬èŒƒå›´å·²ç»æœ‰æ›´æ–°ç‰ˆæœ¬ã€‚ é‡ç°ä¾èµ–ç¯å¢ƒï¼šé€‚ç”¨äºå›¢é˜Ÿåä½œæˆ–éƒ¨ç½²ç¯å¢ƒï¼Œç¡®ä¿æ‰€æœ‰äººæˆ–æœºå™¨å®‰è£…çš„ä¾èµ–ç‰ˆæœ¬å®Œå…¨ç›¸åŒã€‚ é”æ–‡ä»¶å­˜åœ¨æ—¶æ›´é«˜æ•ˆï¼šå¦‚æœ poetry.lock æ–‡ä»¶å­˜åœ¨ï¼Œpoetry install ä¸ä¼šé‡æ–°è§£æä¾èµ–æ ‘ã€‚ é¦–æ¬¡è¿è¡Œæ—¶ç”Ÿæˆé”æ–‡ä»¶ï¼šå¦‚æœæ²¡æœ‰ poetry.lock æ–‡ä»¶ï¼Œpoetry install ä¼šè§£æä¾èµ–å¹¶ç”Ÿæˆé”æ–‡ä»¶ã€‚ ä½¿ç”¨åœºæ™¯ï¼š æ–°å…‹éš†çš„é¡¹ç›®ï¼Œéœ€è¦å®‰è£…ä¾èµ–ç¯å¢ƒã€‚ éƒ¨ç½²ç”Ÿäº§ç¯å¢ƒï¼Œç¡®ä¿ä¾èµ–ç‰ˆæœ¬çš„ç¨³å®šæ€§ã€‚ é‡æ–°å®‰è£…ä¹‹å‰å·²å®šä¹‰çš„ä¾èµ–ï¼ˆä¾‹å¦‚æ¸…ç©ºäº†è™šæ‹Ÿç¯å¢ƒï¼‰ã€‚ poetry update çš„ä½œç”¨æ˜¯æ ¹æ® pyproject.toml æ–‡ä»¶ä¸­å®šä¹‰çš„ä¾èµ–èŒƒå›´é‡æ–°è§£æä¾èµ–æ ‘ï¼Œå¹¶æ›´æ–° poetry.lock æ–‡ä»¶ä¸ºæœ€æ–°çš„ç‰ˆæœ¬ã€‚ æ ¸å¿ƒç‰¹ç‚¹ï¼š æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬ï¼šå®ƒä¼šå°è¯•å®‰è£…ä¾èµ–èŒƒå›´å†…çš„æœ€æ–°ç‰ˆæœ¬ï¼Œå¹¶æ›´æ–° poetry.lock æ–‡ä»¶ã€‚ è§£ææ–°çš„ä¾èµ–æ ‘ï¼šå³ä½¿ poetry.lock æ–‡ä»¶å­˜åœ¨ï¼Œpoetry update ä¹Ÿä¼šå¿½ç•¥å®ƒå¹¶é‡æ–°è§£æä¾èµ–ã€‚ æ›´æ”¹é”æ–‡ä»¶ï¼šå®ƒä¼šè¦†ç›–ç°æœ‰çš„ poetry.lock æ–‡ä»¶ï¼Œå› æ­¤å›¢é˜Ÿå…¶ä»–æˆå‘˜éœ€è¦é‡æ–°è¿è¡Œ poetry install ä»¥åŒæ­¥ã€‚ ä½¿ç”¨åœºæ™¯ï¼š æ›´æ–°ä¾èµ–åˆ°æœ€æ–°ç‰ˆæœ¬ï¼ˆåœ¨ä¾èµ–èŒƒå›´å†…ï¼‰ã€‚ å½“æ·»åŠ æ–°ä¾èµ–åï¼Œæƒ³è¦å®‰è£…å¹¶æ›´æ–°é”æ–‡ä»¶ã€‚ ä¿®å¤å¯èƒ½çš„ç‰ˆæœ¬å†²çªæˆ–ä¸å…¼å®¹é—®é¢˜ã€‚ lock : é”å®šä¾èµ–åŒ… poetry lock æ˜¯ Poetryï¼ˆä¸€ä¸ª Python åŒ…ç®¡ç†å·¥å…·ï¼‰ä¸­çš„ä¸€ä¸ªå‘½ä»¤ï¼Œç”¨äºé”å®šé¡¹ç›®çš„ä¾èµ–å…³ç³»ã€‚ä½¿ç”¨è¿™ä¸ªå‘½ä»¤å¯ä»¥åˆ›å»ºæˆ–æ›´æ–° poetry.lock æ–‡ä»¶ï¼Œç¡®ä¿ä½ çš„é¡¹ç›®ä¸­æ‰€ä½¿ç”¨çš„æ¯ä¸ªåŒ…çš„ç‰ˆæœ¬éƒ½è¢«æ˜ç¡®è®°å½•ä¸‹æ¥ã€‚è¿™æ ·åšå¯¹äºé¡¹ç›®çš„å¯å¤ç°æ€§å’Œç¨³å®šæ€§è‡³å…³é‡è¦ã€‚ å®é™…ä¸Šï¼Œå½“è¿è¡Œ poetry install ã€ poetry update æˆ–è€… poetry add ç­‰å‘½ä»¤æ—¶ï¼Œ poetry éƒ½ä¼šæ ¹æ® pyproject.toml æ–‡ä»¶ä¸­çš„ä¾èµ–èŒƒå›´ï¼Œè§£æä¾èµ–æ ‘ï¼Œå¹¶åœ¨é¡¹ç›®ç›®å½•ä¸‹åˆ›å»ºæˆ–æ›´æ–° poetry.lock æ–‡ä»¶ã€‚ å½“æˆ‘ä»¬æ‰‹å·¥ä¿®æ”¹äº† pyproject.toml æ–‡ä»¶ä¸­çš„ä¾èµ–èŒƒå›´ï¼Œæ­¤æ—¶åˆä¸æƒ³ç«‹åˆ»æ›´æ–°ä¾èµ–ï¼Œè€Œæ˜¯å¸Œæœ›åœ¨æŸä¸ªæ—¶æœºå†æ›´æ–°ï¼Œæ­¤æ—¶å°±å¯ä»¥ä½¿ç”¨ poetry lock å‘½ä»¤ï¼Œå…ˆé”å®šè¿™äº›ä¾èµ–ï¼Œä¹‹åå†é€šè¿‡ poetry install å‘½ä»¤å®‰è£…ã€‚ å¯ä»¥ä½¿ç”¨ poetry check å‘½ä»¤æ£€æŸ¥ pyproject.toml æ–‡ä»¶ ä¸ poetry.lock æ–‡ä»¶çš„ä¸€è‡´æ€§ã€‚ 12345678910111213# æ¯”å¦‚æˆ‘æ‰‹å·¥åˆ é™¤äº† `pyproject.toml` æ–‡ä»¶ä¸­çš„æŸä¸ªä¾èµ–# æ­¤æ—¶è¿è¡Œ check æ£€æŸ¥ä¸€è‡´æ€§ä¼šæŠ¥é”™$ poetry checkError: pyproject.toml changed significantly since poetry.lock was last generated. Run `poetry lock [--no-update]` to fix the lock file.# é”å®šä¾èµ–$ poetry lockUpdating dependenciesResolving dependencies... (0.1s)Writing lock file# æ£€æŸ¥ä¸€è‡´æ€§é€šè¿‡$ poetry checkAll set! å°è´´å£« æ³¨æ„ï¼Œæ­¤æ—¶é€šè¿‡ poetry show æŸ¥çœ‹ä¸åˆ°é‚£ä¸ªæ‰‹å·¥åˆ é™¤çš„ä¾èµ–åŒ…ï¼Œä½†å®é™…ä¸Šä¾èµ–ä¾æ—§åœ¨äºè™šæ‹Ÿç¯å¢ƒä¸­ æ‰€ä»¥å°½é‡é¿å…æ‰‹å·¥åˆ é™¤ä¾èµ–ï¼Œè€Œæ˜¯é€šè¿‡ poetry remove å‘½ä»¤æ¥åˆ é™¤ä¾èµ– source : é•œåƒæºç®¡ç† é»˜è®¤æƒ…å†µä¸‹éƒ½æ˜¯ä»Pypiçš„å®˜æ–¹ä»“åº“ä¸‹è½½ï¼Œå›½å†…ä¸€èˆ¬éœ€è¦æŒ‡å®šé•œåƒæºæ¥åŠ é€Ÿä¸‹è½½ 123456789101112131415161718192021222324252627282930313233# æ·»åŠ é•œåƒæºï¼Œé»˜è®¤å°±æ˜¯ä¸»è¦æºï¼Œæ³¨æ„è¯¥æ–¹å¼åªå¯¹å½“å‰é¡¹ç›®æœ‰æ•ˆ# å‘½ä»¤æ ¼å¼ï¼špoetry source add [é€‰é¡¹] [--] &lt;name&gt; [&lt;url&gt;]ï¼Œnameï¼šæºä»“åº“çš„åç§°ï¼Œurlï¼šæºä»“åº“çš„ URL$ poetry source add tsinghua https://pypi.tuna.tsinghua.edu.cn/simpleAdding source with name tsinghua.# --priority=PRIORITYè®¾ç½®æ­¤æºçš„ä¼˜å…ˆçº§ã€‚å¯ä»¥æ˜¯ä»¥ä¸‹å€¼ä¹‹ä¸€ï¼šdefaultï¼ˆé»˜è®¤ï¼‰ã€primaryï¼ˆä¸»è¦ï¼‰ã€supplementalï¼ˆå¤‡ç”¨ï¼‰ã€explicitï¼ˆæ˜¾å¼æºï¼Œåªæœ‰å½“åŒ…æ˜ç¡®å£°æ˜ä½¿ç”¨è¯¥æºæ—¶æ‰ä¼šè¢«ä½¿ç”¨ï¼‰ã€‚é»˜è®¤ä¸º primaryã€‚$ poetry source add --priority=supplemental aliyun http://mirrors.aliyun.com/pypi/simple/# æŸ¥çœ‹é•œåƒæºä¿¡æ¯$ poetry source show name : tsinghua url : https://pypi.tuna.tsinghua.edu.cn/simple priority : primary name : aliyun url : http://mirrors.aliyun.com/pypi/simple/ priority : supplemental# æ­¤æ—¶æŸ¥çœ‹ pyproject.toml æ–‡ä»¶å¯ä»¥çœ‹åˆ°é•œåƒæºä¿¡æ¯[[tool.poetry.source]]name = &quot;tsinghua&quot;url = &quot;https://pypi.tuna.tsinghua.edu.cn/simple&quot;priority = &quot;primary&quot;[[tool.poetry.source]]name = &quot;aliyun&quot;url = &quot;http://mirrors.aliyun.com/pypi/simple/&quot;priority = &quot;supplemental&quot;# åˆ é™¤é•œåƒæº$ poetry source remove aliyun # æŒ‡å®šé•œåƒæºåç§°Removing source with name aliyun. è¿è¡Œ è¿™é‡Œä»¥ä¸€ä¸ªå°ç¤ºä¾‹æ¥è¯´æ˜è¿™ä¸ªåŠŸèƒ½ åˆ›å»ºä¸€ä¸ªæ–°çš„é¡¹ç›® 123456789101112131415161718192021$ poetry new poetryDemoCreated package poetrydemo in poetryDemo# è¿›å…¥é¡¹ç›®ç›®å½•$ cd poetryDemo# æŸ¥çœ‹ç”Ÿæˆçš„æ–‡ä»¶$ lltotal 8drwxr-xr-x 6 hanqf staff 192 11 21 17:32 .drwxr-xr-x 4 hanqf staff 128 11 21 17:32 ..-rw-r--r-- 1 hanqf staff 0 11 21 17:32 README.mddrwxr-xr-x 3 hanqf staff 96 11 21 17:32 poetrydemo-rw-r--r-- 1 hanqf staff 266 11 21 17:32 pyproject.tomldrwxr-xr-x 3 hanqf staff 96 11 21 17:32 tests# è¿›å…¥åŒ…ç›®å½•$ cd poetrydemo# æŸ¥çœ‹åŒ…ç›®å½•ä¸‹çš„æ–‡ä»¶$ lltotal 0drwxr-xr-x 3 hanqf staff 96 11 21 17:32 .drwxr-xr-x 6 hanqf staff 192 11 21 17:32 ..-rw-r--r-- 1 hanqf staff 0 11 21 17:32 __init__.py åœ¨åŒ…ç›®å½•ä¸‹åˆ›å»º array_util.pyï¼Œå†…å®¹å¦‚ä¸‹ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152import numpy as npdef generate_random_array(shape, distribution=&quot;uniform&quot;, params=None, seed=None): &quot;&quot;&quot; ç”Ÿæˆéšæœºæ•°ç»„çš„å·¥å…·æ–¹æ³•ã€‚ :param shape: tupleï¼ŒæŒ‡å®šæ•°ç»„çš„å½¢çŠ¶ï¼Œä¾‹å¦‚ (3, 4) è¡¨ç¤º 3 è¡Œ 4 åˆ—ã€‚ :param distribution: strï¼ŒæŒ‡å®šéšæœºæ•°åˆ†å¸ƒç±»å‹ï¼Œå¯é€‰å€¼ï¼š - &quot;uniform&quot;ï¼šå‡åŒ€åˆ†å¸ƒï¼ˆé»˜è®¤ï¼‰ã€‚ - &quot;normal&quot;ï¼šæ­£æ€åˆ†å¸ƒã€‚ - &quot;integer&quot;ï¼šéšæœºæ•´æ•°ã€‚ :param params: dictï¼Œåˆ†å¸ƒçš„å‚æ•°é…ç½®ï¼š - å‡åŒ€åˆ†å¸ƒï¼š&#123;&quot;low&quot;: æœ€å°å€¼, &quot;high&quot;: æœ€å¤§å€¼&#125;ï¼Œé»˜è®¤ low=0, high=1ã€‚ - æ­£æ€åˆ†å¸ƒï¼š&#123;&quot;mean&quot;: å‡å€¼, &quot;std&quot;: æ ‡å‡†å·®&#125;ï¼Œé»˜è®¤ mean=0, std=1ã€‚ - éšæœºæ•´æ•°ï¼š&#123;&quot;low&quot;: æœ€å°å€¼, &quot;high&quot;: æœ€å¤§å€¼, &quot;dtype&quot;: ç±»å‹&#125;ï¼Œé»˜è®¤ low=0, high=10ã€‚ :param seed: intï¼Œéšæœºæ•°ç§å­ï¼ˆå¯é€‰ï¼‰ï¼Œç”¨äºç»“æœå¯å¤ç°ã€‚ :return: np.ndarrayï¼Œç”Ÿæˆçš„éšæœºæ•°ç»„ã€‚ &quot;&quot;&quot; if seed is not None: np.random.seed(seed) if params is None: params = &#123;&#125; if distribution == &quot;uniform&quot;: low = params.get(&quot;low&quot;, 0) high = params.get(&quot;high&quot;, 1) return np.random.uniform(low, high, size=shape) elif distribution == &quot;normal&quot;: mean = params.get(&quot;mean&quot;, 0) std = params.get(&quot;std&quot;, 1) return np.random.normal(mean, std, size=shape) elif distribution == &quot;integer&quot;: low = params.get(&quot;low&quot;, 0) high = params.get(&quot;high&quot;, 10) dtype = params.get(&quot;dtype&quot;, int) return np.random.randint(low, high, size=shape, dtype=dtype) else: raise ValueError(&quot;ä¸æ”¯æŒçš„åˆ†å¸ƒç±»å‹ï¼å¯é€‰å€¼ä¸º &#x27;uniform&#x27;, &#x27;normal&#x27;, &#x27;integer&#x27;ã€‚&quot;)# ç¤ºä¾‹ç”¨æ³•if __name__ == &quot;__main__&quot;: array_uniform = generate_random_array((3, 4), distribution=&quot;uniform&quot;, params=&#123;&quot;low&quot;: 1, &quot;high&quot;: 10&#125;) array_normal = generate_random_array((2, 3), distribution=&quot;normal&quot;, params=&#123;&quot;mean&quot;: 0, &quot;std&quot;: 1&#125;, seed=42) array_integer = generate_random_array((4, 5), distribution=&quot;integer&quot;, params=&#123;&quot;low&quot;: 0, &quot;high&quot;: 20&#125;) print(&quot;å‡åŒ€åˆ†å¸ƒéšæœºæ•°ç»„ï¼š\\n&quot;, array_uniform) print(&quot;æ­£æ€åˆ†å¸ƒéšæœºæ•°ç»„ï¼š\\n&quot;, array_normal) print(&quot;éšæœºæ•´æ•°æ•°ç»„ï¼š\\n&quot;, array_integer) å®‰è£…ä¾èµ– 1234567891011$ poetry add numpyUsing version ^2.1.3 for numpyUpdating dependenciesResolving dependencies... (1.1s)Package operations: 1 install, 0 updates, 0 removals - Installing numpy (2.1.3)Writing lock file è¿è¡Œï¼Œä¸¤ç§æ–¹æ³• poetry run 12345678910111213$ poetry run python array_util.pyå‡åŒ€åˆ†å¸ƒéšæœºæ•°ç»„ï¼š[[7.44623063 1.89415788 4.81008329 4.25556572][3.31925154 6.44037063 5.3216543 7.54950573][3.97160747 5.04800698 3.28299934 3.42841887]]æ­£æ€åˆ†å¸ƒéšæœºæ•°ç»„ï¼š[[ 0.49671415 -0.1382643 0.64768854][ 1.52302986 -0.23415337 -0.23413696]]éšæœºæ•´æ•°æ•°ç»„ï¼š[[10 10 3 7 2][ 1 11 5 1 0][11 11 16 9 15][14 14 18 11 19]] poetry shell : æ­¤æ—¶ä¼šå¼€å¯ä¸€ä¸ªæ–°çš„shellï¼Œå¹¶å¼€å¯è™šæ‹Ÿç¯å¢ƒ 1234567# å¼€å¯è™šæ‹Ÿç¯å¢ƒ$ poetry shellSpawning shell within /Users/hanqf/Library/Caches/pypoetry/virtualenvs/poetrydemo-fyqYbfje-py3.11Restored session: 2024å¹´11æœˆ21æ—¥ æ˜ŸæœŸå›› 15æ—¶31åˆ†52ç§’ CSTâœ poetrydemo emulate bash -c &#x27;. /Users/hanqf/Library/Caches/pypoetry/virtualenvs/poetrydemo-fyqYbfje-py3.11/bin/activate&#x27;# åœ¨è™šæ‹Ÿç¯å¢ƒä¸‹è¿è¡Œ$ python array_util.py æ‰“åŒ…å’Œå‘å¸ƒ æ¥ç€ä¸Šé¢çš„é¡¹ç›® æ‰“åŒ… 123456789101112# ä¼šåœ¨é¡¹ç›®ç›®å½•ä¸‹åˆ›å»º dist ç›®å½•ï¼Œå¹¶å°†æ‰“å¥½çš„åŒ…å­˜æ”¾äºæ­¤$ poetry buildBuilding poetrydemo (0.1.0) - Building sdist - Built poetrydemo-0.1.0.tar.gz - Building wheel - Built poetrydemo-0.1.0-py3-none-any.whl# æŸ¥çœ‹ç”Ÿæˆçš„æ‰“åŒ…æ–‡ä»¶$ exa -1 disthqf_poetrydemo-0.1.0-py3-none-any.whlhqf_poetrydemo-0.1.0.tar.gz å‘å¸ƒ é¦–å…ˆè¦å…ˆåœ¨PyPIä¸Šæ³¨å†Œä¸ªå¸å·ï¼Œéœ€è¦å¼€å¯â€œåŒè¦ç´ èº«ä»½éªŒè¯ ï¼ˆ2FAï¼‰â€ï¼Œå¦åˆ™ä¸èƒ½è·å–å‘å¸ƒæ—¶çš„APIä»¤ç‰Œã€‚ è·å–APIä»¤ç‰Œ å‘å¸ƒï¼Œä¸è¿‡è¿™æ¬¡å‘å¸ƒæç¤ºåŒ…åå·²ç»å­˜åœ¨äº† 123456# å‘å¸ƒæ—¶æç¤ºåŒ…åå·²ç»å­˜åœ¨äº†$ poetry publish -u __token__ -p pypi-AgEIcHlwaS5vcmcCJDU0Y2Q5NjhkLWYyYTEtNPublishing poetrydemo (0.1.0) to PyPI - Uploading poetrydemo-0.1.0-py3-none-any.whl FAILEDHTTP Error 400: The name &#x27;poetrydemo&#x27; is too similar to an existing project. See https://pypi.org/help/#project-name for more information. | b&quot;&lt;html&gt;\\n &lt;head&gt;\\n &lt;title&gt;400 The name &#x27;poetrydemo&#x27; is too similar to an existing project. See https://pypi.org/help/#project-name for more information.\\n \\n &lt;body&gt;\\n &lt;h1&gt;400 The name &#x27;poetrydemo&#x27; is too similar to an existing project. See https://pypi.org/help/#project-name for more information.\\n The server could not comply with the request since it is either malformed or otherwise incorrect.&lt;br/&gt;&lt;br/&gt;\\nThe name &amp;#x27;poetrydemo&amp;#x27; is too similar to an existing project. See https://pypi.org/help/#project-name for more information.\\n\\n\\n \\n&quot; å…ˆä¿®æ”¹åŒ…åï¼Œç›´æ¥ç¼–è¾‘ pyproject.toml å³å¯ï¼Œå°†nameå±æ€§ä¿®æ”¹ä¸ºâ€œhqf_poetrydemoâ€ï¼Œç„¶åå°†åŒ…ç›®å½•çš„åç§°ä¹Ÿä¿®æ”¹ä¸ºè¿™ä¸ªmv poetrydemo hqf_poetrydemoï¼Œå¹¶åˆ é™¤distç›®å½•ï¼Œä¹‹åé‡æ–°æ‰“åŒ…poetry buildï¼Œå†æ¬¡å‘å¸ƒ 1234567891011121314151617$ vim pyproject.toml # å°†nameå±æ€§ä¿®æ”¹ä¸ºâ€œhqf_poetrydemoâ€$ mv poetrydemo hqf_poetrydemo # å°†åŒ…ç›®å½•çš„åç§°ä¹Ÿä¿®æ”¹ä¸ºè¿™ä¸ª$ rm -rf dist # åˆ é™¤distç›®å½•$ poetry build # é‡æ–°æ‰“åŒ…Creating virtualenv hqf-poetrydemo-fyqYbfje-py3.11 in /Users/hanqf/Library/Caches/pypoetry/virtualenvsBuilding hqf_poetrydemo (0.1.0) - Building sdist - Built hqf_poetrydemo-0.1.0.tar.gz - Building wheel - Built hqf_poetrydemo-0.1.0-py3-none-any.whl# å†æ¬¡å‘å¸ƒ$ poetry publish -u __token__ -p pypi-AgEIcHlwaS5vcmcCJDU0Y2Q5NjhkLWYyYTEtNPublishing hqf_poetrydemo (0.1.0) to PyPI - Uploading hqf_poetrydemo-0.1.0-py3-none-any.whl 100% - Uploading hqf_poetrydemo-0.1.0.tar.gz 100% ä¹‹åå°±å¯ä»¥åœ¨å…¶å®ƒé¡¹ç›®ä¸­å®‰è£…è¿™ä¸ªåŒ…äº† 12345678910111213141516# pip install$ pip install hqf_poetrydemo# poetry add$ poetry add hqf_poetrydemoUsing version ^0.1.0 for hqf-poetrydemoUpdating dependenciesResolving dependencies... (0.5s)Package operations: 2 installs, 0 updates, 0 removals - Installing numpy (2.1.3) - Installing hqf-poetrydemo (0.1.0)Writing lock file self update : å‡çº§ poetry ç‰ˆæœ¬ self ç›¸å…³å‘½ä»¤ä¸»è¦ç”¨äº poetry è‡ªèº«å®‰è£…æ’ä»¶ä½¿ç”¨ ä¼°è®¡æ’ä»¶åŠŸèƒ½ç›®å‰è¿˜ä¸æˆç†Ÿï¼Œå®˜ç½‘ä¹Ÿæ²¡æœ‰è¿›è¡Œè¯¦ç»†çš„è¯´æ˜ï¼Œå¹¶ä¸” windows ä¸‹æ— æ³•ä½¿ç”¨ï¼Œæ‰€ä»¥è¿™é‡Œä¸è®¨è®ºã€‚ selfå‘½ä»¤ä¸‹ç›®å‰åªéœ€è¦è®°ä½ä¸€ä¸ªå‘½ä»¤ï¼š self update : å‡çº§ poetry ç‰ˆæœ¬ 1$ poetry self update debug resolve : æŸ¥çœ‹åŒ…çš„ä¾èµ–å…³ç³» 1234567891011121314# åªæŸ¥çœ‹ï¼Œä¸å®‰è£…$ poetry debug resolve requestsResolving dependencies... (0.4s)Resolution results:certifi 2024.8.30charset-normalizer 3.4.0idna 3.10urllib3 2.2.3requests 2.32.3# æŸ¥çœ‹æŒ‡å®šç‰ˆæœ¬çš„ä¾èµ–å…³ç³»$ poetry debug resolve requests@2.32.3 cache : ç¼“å­˜ç®¡ç† poetryä¸€ä¸ªå¾ˆé‡è¦çš„åŠŸèƒ½å°±æ˜¯ç¼“å­˜å®‰è£…åŒ…ï¼Œå¯ä»¥ å‡å°‘ ç›¸åŒçš„å®‰è£…åŒ…è¢«é‡å¤ä¸‹è½½ã€‚ä¸ºä»€ä¹ˆæ˜¯å‡å°‘è€Œä¸æ˜¯é¿å…å‘¢ï¼Ÿå› ä¸ºä¸åŒçš„é•œåƒæºçš„åŒ…æ˜¯åˆ†åˆ«ç¼“å­˜çš„ã€‚ é€šè¿‡ poetry config --list å¯ä»¥çœ‹åˆ° cache-dir çš„åœ°å€ï¼Œè¿™é‡Œå°±æ˜¯ç¼“å­˜ä¸‹è½½åŒ…çš„ç›®å½•ã€‚ ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„ä½¿ç”¨åœºæ™¯ è§£å†³ä¾èµ–å®‰è£…é—®é¢˜ï¼š å¦‚æœä½ åœ¨å®‰è£…æˆ–æ›´æ–°ä¾èµ–æ—¶é‡åˆ°é—®é¢˜ï¼ˆä¾‹å¦‚ï¼ŒæŸä¸ªåŒ…æ— æ³•æ­£ç¡®å®‰è£…æˆ–ç‰ˆæœ¬ä¸å¯¹ï¼‰ï¼Œæ¸…ç©ºç¼“å­˜å¯ä»¥å¸®åŠ©ä½ ç¡®ä¿ Poetry é‡æ–°ä¸‹è½½æ‰€æœ‰å¿…è¦çš„æ–‡ä»¶ï¼Œä»è€Œè§£å†³é—®é¢˜ã€‚ æ¸…ç†ç£ç›˜ç©ºé—´ï¼š å¦‚æœä½ çš„é¡¹ç›®å¾ˆå¤šæˆ–è€…ç»å¸¸ä¿®æ”¹ä¾èµ–é¡¹ï¼Œç¼“å­˜å¯èƒ½ä¼šå˜å¾—éå¸¸å¤§ã€‚ä½¿ç”¨ poetry cache clear å¯ä»¥å¸®åŠ©é‡Šæ”¾ç£ç›˜ç©ºé—´ï¼Œç‰¹åˆ«æ˜¯å½“ä½ ä¸ç»å¸¸ä½¿ç”¨æŸäº›åŒ…æ—¶ã€‚ æµ‹è¯•æœ€æ–°ç‰ˆæœ¬çš„ä¾èµ–ï¼š å¦‚æœä½ æƒ³æµ‹è¯•æŸä¸ªåŒ…çš„æ–°ç‰ˆæœ¬æ˜¯å¦è§£å†³äº†æŸä¸ªé—®é¢˜ï¼Œæˆ–è€…æƒ³ç¡®ä¿ä½ ä½¿ç”¨çš„ç¡®å®æ˜¯æœ€æ–°çš„ç‰ˆæœ¬ï¼Œæ¸…é™¤ç¼“å­˜å¯ä»¥å¼ºåˆ¶ Poetry ä»è¿œç¨‹ä»“åº“é‡æ–°ä¸‹è½½æœ€æ–°çš„åŒ…ã€‚ ç¯å¢ƒå˜åŒ–ï¼š å¦‚æœä½ çš„å¼€å‘æˆ–ç”Ÿäº§ç¯å¢ƒå‘ç”Ÿäº†å˜åŒ–ï¼ˆä¾‹å¦‚ï¼Œåˆ‡æ¢äº†æ“ä½œç³»ç»Ÿã€æ›´æ–°äº† Python ç‰ˆæœ¬ç­‰ï¼‰ï¼Œæ¸…é™¤ç¼“å­˜å¯ä»¥å¸®åŠ©ä½ ç¡®ä¿ä¾èµ–é¡¹åœ¨æ–°ç¯å¢ƒä¸­æ­£ç¡®å®‰è£…ã€‚ è°ƒè¯•ä¾èµ–é—®é¢˜ï¼š åœ¨è°ƒè¯•ä¾èµ–é¡¹é—®é¢˜æ—¶ï¼Œæœ‰æ—¶å€™æ¸…é™¤ç¼“å­˜å¯ä»¥å¸®åŠ©ä½ ç¡®å®šé—®é¢˜æ˜¯å¦ä¸ç¼“å­˜ä¸­çš„æ—§ç‰ˆæœ¬æœ‰å…³ã€‚ CI/CD ç¯å¢ƒçš„ä¸€è‡´æ€§ï¼š åœ¨æŒç»­é›†æˆæˆ–æŒç»­éƒ¨ç½² (CI/CD) ç¯å¢ƒä¸­ï¼Œä¸ºäº†ç¡®ä¿æ¯æ¬¡æ„å»ºéƒ½åŸºäºæœ€æ–°çš„ä¾èµ–ï¼Œæœ‰æ—¶ä¼šåœ¨æ„å»ºè„šæœ¬ä¸­åŒ…å«æ¸…é™¤ç¼“å­˜çš„æ­¥éª¤ã€‚ 1234567891011# æŸ¥çœ‹ç¼“å­˜åˆ—è¡¨ï¼Œè¿™é‡Œä¼šæŒ‰é•œåƒæºè¿›è¡Œåˆ†ç»„$ poetry cache listPyPI_default_cachetsinghua# æ¸…é™¤æŒ‡å®šæºçš„å…¨éƒ¨ç¼“å­˜$ poetry cache clear pypi --all# æ¸…é™¤æŒ‡å®šæºä¸‹æŸä¸ªåŒ…çš„ç¼“å­˜$ poetry cache clear pypi:requests:2.24.0","summary":"æ‘˜è¦ Poetryæ˜¯ä¸€ä¸ªè½»é‡çº§çš„pythonåŒ…ç®¡ç†å™¨ï¼Œå…¶ç›®æ ‡æ˜¯å¸®åŠ©å¼€å‘è€…å¿«é€Ÿã€è½»æ¾åœ°æ„å»ºã€å‘å¸ƒå’Œåˆ†äº«pythonåŒ…ã€‚è¯´å®ƒè½»é‡ï¼Œæ˜¯ä¸ conda ç›¸æ¯” poetry æ›´è½»é‡ï¼ŒåŒæ—¶ä¸ venv + pip Python--virtualenv çš„æ–¹å¼ç›¸æ¯”å…·æœ‰å¦‚ä¸‹ä¼˜ç‚¹ï¼š ä½¿ç”¨ç¼“å­˜æœºåˆ¶ï¼Œé¿å…é‡å¤ä¸‹è½½ä¾èµ–åŒ… åŒ…ç®¡ç†ä¸Šæ›´åŠ ç²¾ç¡®ï¼Œåˆ é™¤ä¸éœ€è¦çš„åŒ…æ—¶ä¼šåŒæ—¶åˆ é™¤ä¸å…¶å…³è”çš„ä¸”æ²¡æœ‰è¢«ä½¿ç”¨çš„é‚£äº›ä¾èµ–åŒ…ï¼Œé¿å…æ— ç”¨çš„ä¾èµ–åŒ…é€ æˆæ‰“åŒ…ä½“ç§¯è¿‡å¤§ æ‰“åŒ…å’Œå‘å¸ƒæ›´åŠ ç®€å•ï¼Œåªéœ€è¦ä¸€ä¸ªå‘½ä»¤å°±å¯ä»¥æ‰“åŒ…å’Œå‘å¸ƒ","date_published":"2024-11-22T15:33:15.000Z","tags":["æŠ€æœ¯","Python"]}]}