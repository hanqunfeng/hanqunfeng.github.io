{"version":"https://jsonfeed.org/version/1","name":"é£˜é€¸å³°çš„åšå®¢","home_page_url":"https://blog.hanqunfeng.com","feed_url":"https://blog.hanqunfeng.com/feed.json","author":{"name":"é£˜é€¸å³°"},"items":[{"id":"https://blog.hanqunfeng.com/2024/11/28/brew/","url":"https://blog.hanqunfeng.com/2024/11/28/brew/","title":"MacOSè½¯ä»¶åŒ…ç®¡ç†å™¨--brew","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\n-->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><a href=\"https://brew.sh\">brew</a>æ˜¯ä¸€ä¸ªè½¯ä»¶åŒ…ç®¡ç†å™¨ï¼ŒåŒæ—¶æ”¯æŒMacOSå’ŒLinuxï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿åœ°å®‰è£…å„ç§è½¯ä»¶ï¼Œæ¯”å¦‚<code>git</code>ã€<code>node</code>ã€<code>python</code>ç­‰ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><code>brew</code>è™½ç„¶æ”¯æŒlinuxï¼Œä½†æ˜¯å®é™…ä½¿ç”¨ä¸­å¾ˆå°‘ä¼šä½¿ç”¨brewæ¥ç®¡ç†linuxçš„è½¯ä»¶åŒ…ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç»å¦‚ä½•åœ¨macosä¸‹å®‰è£…brewï¼Œä»¥åŠå¦‚ä½•ä½¿ç”¨brewç®¡ç†å„ç§è½¯ä»¶åŒ…ã€‚</p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"å®‰è£…\">å®‰è£…</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>é¦–å…ˆè¦ç¡®ä¿ç³»ç»Ÿä¸­å®‰è£…äº† <code>git</code> å’Œ <code>curl</code>ï¼Œå¯¹äº macOS ç”¨æˆ·æ¥è¯´ï¼Œè¿™äº›ç³»ç»Ÿéƒ½è‡ªå¸¦äº†ï¼Œå”¯ä¸€éœ€é¢å¤–è¦æ±‚å®‰è£…çš„æ˜¯<code>Command Line Tools (CLT) for Xcode</code>ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æ£€æŸ¥ç³»ç»Ÿä¸­æ˜¯å¦å®‰è£…äº† Command Line Tools (CLT) for Xcode</span></span><br><span class=\"line\">xcode-select --version <span class=\"comment\"># èƒ½å¤Ÿè¾“å‡ºç‰ˆæœ¬å·è¯´æ˜å®‰è£…äº†ï¼Œå¦åˆ™éœ€è¦å®‰è£…ã€‚</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å®‰è£… Command Line Tools (CLT) for Xcode</span></span><br><span class=\"line\">xcode-select --install</span><br></pre></td></tr></table></figure>\n<h3 id=\"åœ¨MacOSä¸Šå®‰è£…brewæœ‰ä¸¤ç§æ–¹æ³•\">åœ¨MacOSä¸Šå®‰è£…brewæœ‰ä¸¤ç§æ–¹æ³•</h3>\n<h4 id=\"æ–¹æ³•ä¸€ï¼šä½¿ç”¨è„šæœ¬å®‰è£…\">æ–¹æ³•ä¸€ï¼šä½¿ç”¨è„šæœ¬å®‰è£…</h4>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/bin/bash -c <span class=\"string\">&quot;<span class=\"subst\">$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)</span>&quot;</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å®‰è£…æ—¶å¯ä»¥æŒ‡å®šé•œåƒä¸‹è½½æºï¼Œé»˜è®¤æ˜¯<a href=\"https://github.com/Homebrew/brew.git\">Homebrewçš„GitHubä¸‹è½½æº</a>ï¼Œä¹Ÿå¯ä»¥é€‰æ‹©å›½å†…çš„é•œåƒæºï¼Œæ¯”å¦‚ä½¿ç”¨<a href=\"https://mirrors.tuna.tsinghua.edu.cn/help/homebrew/\">æ¸…åå¤§å­¦çš„Homebrew</a>é•œåƒæº</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æ§åˆ¶äº† Homebrew åœ¨å®‰è£…è½¯ä»¶åŒ…æ—¶æ˜¯å¦ä» Homebrew çš„ API æœåŠ¡å™¨è·å–ä¿¡æ¯ï¼Œbrew4.0åæ˜¯é»˜è®¤è¡Œä¸ºï¼Œæ— éœ€è®¾ç½®</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> HOMEBREW_INSTALL_FROM_API=1</span><br><span class=\"line\"><span class=\"comment\"># è®¾ç½®brewä»“åº“ä¸Šæ¸¸</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> HOMEBREW_BREW_GIT_REMOTE=<span class=\"string\">&quot;https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/brew.git&quot;</span></span><br><span class=\"line\"><span class=\"comment\"># è®¾ç½®homebrewæ ¸å¿ƒä¸Šæ¸¸</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> HOMEBREW_CORE_GIT_REMOTE=<span class=\"string\">&quot;https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/homebrew-core.git&quot;</span></span><br><span class=\"line\">/bin/bash -c <span class=\"string\">&quot;<span class=\"subst\">$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)</span>&quot;</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"æ–¹æ³•äºŒï¼šä½¿ç”¨PKGæ–‡ä»¶å®‰è£…\">æ–¹æ³•äºŒï¼šä½¿ç”¨PKGæ–‡ä»¶å®‰è£…</h4>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä»<a href=\"https://github.com/Homebrew/brew\">Homebrewçš„github</a>ä¸Šä¸‹è½½æœ€æ–°ç‰ˆçš„<a href=\"https://github.com/Homebrew/brew/releases/latest\">Homebrew-x.x.x.pkg</a></p>\n</li>\n</ul>\n<h4 id=\"éªŒè¯æ˜¯å¦å®‰è£…æˆåŠŸ\">éªŒè¯æ˜¯å¦å®‰è£…æˆåŠŸ</h4>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><code>brew</code> å‘½ä»¤æœ¬èº«åŠé€šè¿‡brewå®‰è£…çš„æ‰€æœ‰å‘½ä»¤éƒ½ä¼šè¢«è½¯é“¾æ¥åˆ°<code>/usr/local/bin/</code>ä¸‹ï¼Œæ‰€ä»¥éœ€è¦å°†è¯¥è·¯å¾„åŠ å…¥ç³»ç»Ÿç¯å¢ƒPATHä¸­</p>\n</li>\n<li class=\"lvl-2\">\n<p>é‡å¯ç»ˆç«¯ï¼Œç„¶åæ‰§è¡Œ<code>brew</code>å‘½ä»¤</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ brew</span><br><span class=\"line\">Example usage:</span><br><span class=\"line\">  brew search TEXT|/REGEX/</span><br><span class=\"line\">  brew info [FORMULA|CASK...]</span><br><span class=\"line\">  brew install FORMULA|CASK...</span><br><span class=\"line\">  brew update</span><br><span class=\"line\">  brew upgrade [FORMULA|CASK...]</span><br><span class=\"line\">  brew uninstall FORMULA|CASK...</span><br><span class=\"line\">  brew list [FORMULA|CASK...]</span><br><span class=\"line\"></span><br><span class=\"line\">Troubleshooting:</span><br><span class=\"line\">  brew config</span><br><span class=\"line\">  brew doctor</span><br><span class=\"line\">  brew install --verbose --debug FORMULA|CASK</span><br><span class=\"line\"></span><br><span class=\"line\">Contributing:</span><br><span class=\"line\">  brew create URL [--no-fetch]</span><br><span class=\"line\">  brew edit [FORMULA|CASK...]</span><br><span class=\"line\"></span><br><span class=\"line\">Further <span class=\"built_in\">help</span>:</span><br><span class=\"line\">  brew commands</span><br><span class=\"line\">  brew <span class=\"built_in\">help</span> [COMMAND]</span><br><span class=\"line\">  man brew</span><br><span class=\"line\">  https://docs.brew.sh</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Homebrewæœ¬èº«çš„å®‰è£…ä½ç½®å¯ä»¥é€šè¿‡<code>brew --repo</code>æŸ¥çœ‹ï¼Œé»˜è®¤ä¸º<code>/usr/local/Homebrew</code></p>\n</li>\n<li class=\"lvl-2\">\n<p>é€šè¿‡brewå®‰è£…çš„è½¯ä»¶åŒ…é»˜è®¤ä¼šè¢«å®‰è£…åˆ°<code>/usr/local/Cellar/</code>ä¸‹ï¼Œæ¯”å¦‚<code>git</code>å®‰è£…åä¼šåœ¨<code>/usr/local/Cellar/git/</code>ç›®å½•ä¸‹ï¼Œå¯ä»¥é€šè¿‡<code>brew info git</code>æŸ¥çœ‹å®‰è£…ä¿¡æ¯ï¼ŒåŒ…æ‹¬ä¾èµ–åº“ç­‰ã€‚</p>\n</li>\n</ul>\n<h4 id=\"é…ç½®å‘½ä»¤è¡¥å…¨\">é…ç½®å‘½ä»¤è¡¥å…¨</h4>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å‚è€ƒå®˜ç½‘<a href=\"https://docs.brew.sh/Shell-Completion\">Homebrew Documentationâ€“brew Shell Completion</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>æˆ‘è¿™é‡Œä½¿ç”¨çš„æ˜¯<code>zsh</code>ï¼Œåœ¨<code>~/.zshrc</code>ä¸­åŠ å…¥å¦‚ä¸‹å†…å®¹å¹¶é‡å¯ç»ˆç«¯å³å¯ç”Ÿæ•ˆ</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">autoload</span> -Uz compinit</span><br><span class=\"line\">compinit</span><br></pre></td></tr></table></figure>\n<h4 id=\"å¸è½½brew\">å¸è½½brew</h4>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/bin/bash -c <span class=\"string\">&quot;<span class=\"subst\">$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/uninstall.sh)</span>&quot;</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"å¸¸ç”¨å‘½ä»¤\">å¸¸ç”¨å‘½ä»¤</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><code>brew</code>æ”¯æŒå®‰è£…<code>å‘½ä»¤è¡Œå·¥å…·(formula)</code>å’Œ<code>GUIå·¥å…·(cask)</code></p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-5\"><code>brew install xxx</code> å®‰è£…å‘½ä»¤è¡Œå·¥å…·ï¼Œè¿™ä¸ªæœ€ä¸ºå¸¸ç”¨ï¼Œæ¯”å¦‚ <code>brew install fd</code></li>\n<li class=\"lvl-5\"><code>brew install --cask xxx</code> å®‰è£…GUIå·¥å…·ï¼Œä¸€èˆ¬å¾ˆå°‘ä½¿ç”¨brewå®‰è£…GUIå·¥å…·ï¼Œæ¯”å¦‚ <code>brew install --cask firefox</code></li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<p>brewçš„å‘½ä»¤å’Œå‚æ•°éå¸¸å¤šï¼Œä½†æ—¥å¸¸ä½¿ç”¨åªéœ€è¦è®°ä½å¸¸ç”¨çš„çš„å‡ ä¸ªå°±å¤Ÿäº†ï¼Œè¯¦ç»†çš„å‘½ä»¤åˆ—è¡¨å¯ä»¥å‚è€ƒ<a href=\"https://docs.brew.sh/Manpage\">Homebrew Documentation</a></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹brewæ”¯æŒå“ªäº›å‘½ä»¤</span></span><br><span class=\"line\">brew commands</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹å‘½ä»¤çš„å¸®åŠ©ä¿¡æ¯ï¼Œæ¯”å¦‚</span></span><br><span class=\"line\">brew install --<span class=\"built_in\">help</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"ä¸€äº›å¸¸ç”¨çš„å‘½ä»¤\">ä¸€äº›å¸¸ç”¨çš„å‘½ä»¤</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">brew update <span class=\"comment\"># æ›´æ–°brewåˆ°æœ€æ–°ç‰ˆæœ¬</span></span><br><span class=\"line\">brew --version <span class=\"comment\"># æŸ¥çœ‹brewçš„ç‰ˆæœ¬</span></span><br><span class=\"line\">brew config <span class=\"comment\"># æŸ¥çœ‹brewçš„é…ç½®ä¿¡æ¯</span></span><br><span class=\"line\">brew home <span class=\"comment\"># æµè§ˆå™¨æ‰“å¼€brewå®˜ç½‘</span></span><br><span class=\"line\">brew home xxx <span class=\"comment\"># æµè§ˆå™¨æ‰“å¼€xxxå®˜ç½‘ å¦‚ï¼šæ‰“å¼€fdå‘½ä»¤çš„å®˜ç½‘ brew home fd ,å…·ä½“çš„åç§°å¯ä»¥é€šè¿‡brew listæŸ¥çœ‹</span></span><br><span class=\"line\">brew cleanup <span class=\"comment\"># æ¸…ç†ç¼“å­˜åŠæ—¥å¿—æ–‡ä»¶ï¼Œå»ºè®®å®šæœŸæ¸…ç†ï¼Œé»˜è®¤è¶…è¿‡30å¤©ï¼Œå½“è¿è¡Œbrewæ—¶ä¼šè‡ªåŠ¨æ¸…ç†ï¼ˆ2.0ä»¥åçš„ç‰ˆæœ¬ï¼‰</span></span><br><span class=\"line\">brew doctor <span class=\"comment\"># æ£€æŸ¥æ˜¯å¦æœ‰ä¾èµ–é—®é¢˜ï¼Œæ¯”å¦‚æ²¡æœ‰å®‰è£…ä¾èµ–åº“ï¼Œæˆ–è€…ä¾èµ–åº“ç‰ˆæœ¬è¿‡ä½</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æŸ¥çœ‹å·²å®‰è£…çš„åŒ…</p>\n</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹</span></span><br><span class=\"line\">brew list <span class=\"comment\"># æŸ¥çœ‹å·²å®‰è£…çš„åŒ…</span></span><br><span class=\"line\">brew list --versions <span class=\"comment\"># æŸ¥çœ‹å·²å®‰è£…çš„åŒ…åŠç‰ˆæœ¬</span></span><br><span class=\"line\">brew info xxx <span class=\"comment\"># æŸ¥çœ‹xxxçš„å®‰è£…ä¿¡æ¯</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å®‰è£…ã€å¸è½½</p>\n</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æŸ¥æ‰¾ã€å®‰è£…ã€å¸è½½</span></span><br><span class=\"line\">brew search xxx <span class=\"comment\"># æŸ¥æ‰¾è½¯ä»¶åŒ…ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ https://formulae.brew.sh ç½‘é¡µè¿›è¡Œæœç´¢</span></span><br><span class=\"line\">brew install xxx <span class=\"comment\"># å®‰è£…è½¯ä»¶åŒ…ï¼Œå®‰è£…æ—¶ä¼šè‡ªåŠ¨ä¸‹è½½ä¾èµ–åº“ï¼Œæ¯”å¦‚å®‰è£…`nginx`æ—¶ï¼Œä¼šè‡ªåŠ¨ä¸‹è½½`openssl@3`å’Œ`pcre2`ç­‰</span></span><br><span class=\"line\">brew uninstall xxx <span class=\"comment\"># å¸è½½è½¯ä»¶åŒ…ï¼Œåªä¼šå¸è½½å½“å‰åŒ…ï¼Œä¸ä¼šå¸è½½ä¾èµ–åº“ï¼Œè¿™æ ·å°±æœ‰å¯èƒ½å­˜åœ¨å¾ˆå¤šå†—ä½™åŒ…</span></span><br><span class=\"line\">brew autoremove <span class=\"comment\"># åˆ é™¤æ‰€æœ‰ä»…ä½œä¸ºå¦ä¸€ä¸ªè½¯ä»¶åŒ…çš„ä¾èµ–é¡¹å®‰è£…å¹¶ä¸”ç°åœ¨ä¸å†éœ€è¦çš„åŒ…</span></span><br><span class=\"line\">brew autoremove --dry-run <span class=\"comment\"># --dry-run ä»…æŸ¥çœ‹å“ªäº›åŒ…å¯ä»¥åˆ é™¤ï¼Œå¹¶ä¸ä¼šçœŸçš„åˆ é™¤</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å‡çº§</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å‡çº§</span></span><br><span class=\"line\">brew outdated <span class=\"comment\"># æŸ¥çœ‹éœ€è¦å‡çº§çš„åŒ…</span></span><br><span class=\"line\">brew upgrade xxx <span class=\"comment\"># å‡çº§xxxåˆ°æœ€æ–°ç‰ˆ</span></span><br><span class=\"line\">brew upgrade <span class=\"comment\"># æ›´æ–°å…¨éƒ¨å‘½ä»¤åˆ°æœ€æ–°ç‰ˆ</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¾èµ–å…³ç³»</p>\n</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ä¾èµ–å…³ç³»</span></span><br><span class=\"line\">brew deps --tree xxx <span class=\"comment\"># æ ‘å½¢æ˜¾ç¤ºåŒ…çš„ä¾èµ–æ ‘</span></span><br><span class=\"line\">brew deps --installed --tree <span class=\"comment\"># æ ‘å½¢æ˜¾ç¤ºæ‰€æœ‰å®‰è£…åŒ…çš„ä¾èµ–å…³ç³»</span></span><br><span class=\"line\">brew deps --installed xxx <span class=\"comment\"># æ˜¾ç¤ºå½“å‰å®‰è£…åŒ…çš„ä¾èµ–å…³ç³»ï¼Œçºµå‘å±•ç¤º</span></span><br><span class=\"line\">brew deps --installed --for-each xxx <span class=\"comment\"># æ˜¾ç¤ºå½“å‰å®‰è£…åŒ…çš„ä¾èµ–å…³ç³»ï¼Œæ¨ªå‘å±•ç¤º</span></span><br><span class=\"line\">brew uses --installed xxx <span class=\"comment\"># æŸ¥çœ‹å·²ç»å®‰è£…çš„å“ªäº›å·¥å…·ä¾èµ–å½“å‰åŒ…</span></span><br><span class=\"line\">brew leaves <span class=\"comment\"># æŸ¥çœ‹é¡¶çº§å®‰è£…åŒ…ï¼Œå³ä½ é€šè¿‡brewç›´æ¥å®‰è£…çš„åŒ…ï¼Œè€Œä¸æ˜¯é€šè¿‡å®‰è£…å…¶ä»–è½¯ä»¶åŒ…é—´æ¥å®‰è£…çš„</span></span><br><span class=\"line\">brew leaves | xargs brew deps --installed --for-each <span class=\"comment\"># æŸ¥çœ‹é¡¶çº§åŒ…ï¼Œå¹¶åˆ—å‡ºæ¯ä¸ªé¡¶çº§åŒ…çš„å·²å®‰è£…ä¾èµ–</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><code>brew services</code>: brewçš„æœåŠ¡ç®¡ç†å·¥å…·ï¼Œå¯ä»¥æ–¹ä¾¿çš„ç®¡ç†é€šè¿‡brewå®‰è£…çš„æœåŠ¡ï¼ŒåŒ…æ‹¬å¯åŠ¨ã€åœæ­¢ã€é‡å¯æœåŠ¡ï¼Œç­‰ç­‰ï¼Œæ¯”å¦‚<code>nginxã€redisã€mysql</code>ç­‰ï¼Œå…·ä½“å‘½ä»¤å¯ä»¥å‚è€ƒ<a href=\"https://docs.brew.sh/Manpage#services-subcommand\">Homebrew Documentation</a></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">brew services list <span class=\"comment\"># æŸ¥çœ‹å·²å®‰è£…çš„æ‰€æœ‰æœåŠ¡</span></span><br><span class=\"line\">brew services start nginx <span class=\"comment\"># å¯åŠ¨æœåŠ¡ï¼Œå¹¶æ³¨å†Œåˆ°ç³»ç»Ÿå¯åŠ¨æœåŠ¡åˆ—è¡¨ï¼Œå³åˆ›å»ºç³»ç»Ÿè‡ªå¯åŠ¨æ–‡ä»¶ï¼š ~/Library/LaunchAgents/homebrew.mxcl.nginx.plist</span></span><br><span class=\"line\">brew services stop nginx <span class=\"comment\"># åœæ­¢æœåŠ¡ï¼Œå¹¶ä»ç³»ç»Ÿå¯åŠ¨æœåŠ¡åˆ—è¡¨ä¸­ç§»é™¤ï¼Œå³åˆ é™¤ç³»ç»Ÿè‡ªå¯åŠ¨æ–‡ä»¶</span></span><br><span class=\"line\">brew services <span class=\"built_in\">kill</span> nginx <span class=\"comment\"># ç«‹å³æ€æ­»æœåŠ¡ï¼Œä½†ä¸ä»ç³»ç»Ÿå¯åŠ¨æœåŠ¡åˆ—è¡¨ä¸­ç§»é™¤</span></span><br><span class=\"line\">brew services restart nginx <span class=\"comment\"># é‡å¯æœåŠ¡</span></span><br><span class=\"line\">brew services info nginx <span class=\"comment\"># æŸ¥çœ‹æœåŠ¡çš„çŠ¶æ€å’Œè¿›ç¨‹IP</span></span><br><span class=\"line\">brew services run nginx <span class=\"comment\"># è¿è¡ŒæœåŠ¡ï¼Œä½†ä¸ä¼šä¿å­˜åˆ°æœåŠ¡åˆ—è¡¨ä¸­</span></span><br><span class=\"line\">brew services cleanup <span class=\"comment\"># æ¸…ç†æ— æ•ˆçš„æœåŠ¡ï¼Œå³å·²å¸è½½åº”ç”¨çš„æ— ç”¨çš„é…ç½®</span></span><br><span class=\"line\">brew services --<span class=\"built_in\">help</span> <span class=\"comment\"># æŸ¥çœ‹å¸®åŠ©</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"é…ç½®å›½å†…é•œåƒæº\">é…ç½®å›½å†…é•œåƒæº</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ­¤å¤„ä»¥é…ç½®<a href=\"https://mirrors.tuna.tsinghua.edu.cn/help/homebrew/\">æ¸…åæºé•œåƒ</a>ä¸ºä¾‹ï¼Œé˜¿é‡Œæºè¯·å‚è€ƒ<a href=\"https://developer.aliyun.com/mirror/homebrew/\">å®˜ç½‘æ–‡æ¡£â€“Homebrewé•œåƒ</a></p>\n</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">## ä¸´æ—¶æ›¿æ¢</span></span><br><span class=\"line\"><span class=\"comment\"># é…ç½®brewå›½å†…é•œåƒæº</span></span><br><span class=\"line\">$ <span class=\"built_in\">export</span> HOMEBREW_BREW_GIT_REMOTE=<span class=\"string\">&quot;https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/brew.git&quot;</span></span><br><span class=\"line\"><span class=\"comment\"># é…ç½®brew-coreå›½å†…é•œåƒæº</span></span><br><span class=\"line\">$ <span class=\"built_in\">export</span> HOMEBREW_CORE_GIT_REMOTE=<span class=\"string\">&quot;https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/homebrew-core.git&quot;</span></span><br><span class=\"line\"><span class=\"comment\"># é…ç½®brew-bottleå›½å†…é•œåƒæº</span></span><br><span class=\"line\">$ <span class=\"built_in\">export</span> HOMEBREW_API_DOMAIN=<span class=\"string\">&quot;https://mirrors.tuna.tsinghua.edu.cn/homebrew-bottles/api&quot;</span></span><br><span class=\"line\">$ <span class=\"built_in\">export</span> HOMEBREW_BOTTLE_DOMAIN=<span class=\"string\">&quot;https://mirrors.tuna.tsinghua.edu.cn/homebrew-bottles&quot;</span></span><br><span class=\"line\"><span class=\"comment\"># æ›´æ–°é…ç½®</span></span><br><span class=\"line\">$ brew update</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">## é…ç½®æ°¸ä¹…ç”Ÿæ•ˆï¼Œzshç”¨æˆ·</span></span><br><span class=\"line\"><span class=\"comment\"># é…ç½®brewå›½å†…é•œåƒæº</span></span><br><span class=\"line\">$ <span class=\"built_in\">echo</span> <span class=\"string\">&#x27;export HOMEBREW_BREW_GIT_REMOTE=&quot;https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/brew.git&quot;&#x27;</span> &gt;&gt; ~/.zshrc</span><br><span class=\"line\"><span class=\"comment\"># é…ç½®brew-coreå›½å†…é•œåƒæº</span></span><br><span class=\"line\">$ <span class=\"built_in\">echo</span> <span class=\"string\">&#x27;export HOMEBREW_CORE_GIT_REMOTE=&quot;https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/homebrew-core.git&quot;&#x27;</span> &gt;&gt; ~/.zshrc</span><br><span class=\"line\"><span class=\"comment\"># é…ç½®brew-bottleå›½å†…é•œåƒæº</span></span><br><span class=\"line\">$ <span class=\"built_in\">echo</span> <span class=\"string\">&#x27;export HOMEBREW_API_DOMAIN=&quot;https://mirrors.tuna.tsinghua.edu.cn/homebrew-bottles/api&quot;&#x27;</span> &gt;&gt; ~/.zshrc</span><br><span class=\"line\">$ <span class=\"built_in\">echo</span> <span class=\"string\">&#x27;export HOMEBREW_BOTTLE_DOMAIN=&quot;https://mirrors.tuna.tsinghua.edu.cn/homebrew-bottles&quot;&#x27;</span> &gt;&gt; ~/.zshrc</span><br><span class=\"line\"><span class=\"comment\"># æ›´æ–°é…ç½®</span></span><br><span class=\"line\">$ brew update</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ­¤æ—¶æŸ¥çœ‹brewé…ç½®ä¿¡æ¯ï¼Œå¯ä»¥çœ‹åˆ°å·²ç»ç”Ÿæ•ˆäº†</span></span><br><span class=\"line\">$ brew config</span><br><span class=\"line\">HOMEBREW_VERSION: 4.4.8-38-g6089077</span><br><span class=\"line\">ORIGIN: https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/brew.git</span><br><span class=\"line\">HEAD: 60890774e0a70fe93f94973b080068cf7b0d1c93</span><br><span class=\"line\">Last commit: 9 hours ago</span><br><span class=\"line\">Branch: master</span><br><span class=\"line\">Core tap origin: https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/homebrew-core.git</span><br><span class=\"line\">Core tap HEAD: 787d1587bfa92794f7d141063a31773064ef9107</span><br><span class=\"line\">Core tap last commit: 11 minutes ago</span><br><span class=\"line\">Core tap JSON: 29 Nov 09:56 UTC</span><br><span class=\"line\">Core cask tap HEAD: 4c34bd8c418e13160fc79f1ca9312555d2edc254</span><br><span class=\"line\">Core cask tap last commit: 19 minutes ago</span><br><span class=\"line\">Core cask tap JSON: 29 Nov 09:56 UTC</span><br><span class=\"line\">HOMEBREW_PREFIX: /usr/local</span><br><span class=\"line\">HOMEBREW_API_DOMAIN: https://mirrors.tuna.tsinghua.edu.cn/homebrew-bottles/api</span><br><span class=\"line\">HOMEBREW_BOTTLE_DOMAIN: https://mirrors.tuna.tsinghua.edu.cn/homebrew-bottles</span><br><span class=\"line\">HOMEBREW_BREW_GIT_REMOTE: https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/brew.git</span><br><span class=\"line\">HOMEBREW_CASK_OPTS: []</span><br><span class=\"line\">HOMEBREW_CORE_GIT_REMOTE: https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/homebrew-core.git</span><br><span class=\"line\">HOMEBREW_GITHUB_API_TOKEN: <span class=\"built_in\">set</span></span><br><span class=\"line\">HOMEBREW_MAKE_JOBS: 12</span><br><span class=\"line\">HOMEBREW_SORBET_RUNTIME: <span class=\"built_in\">set</span></span><br><span class=\"line\">Homebrew Ruby: 3.3.6 =&gt; /usr/local/Homebrew/Library/Homebrew/vendor/portable-ruby/3.3.6/bin/ruby</span><br><span class=\"line\">CPU: dodeca-core 64-bit kabylake</span><br><span class=\"line\">Clang: 15.0.0 build 1500</span><br><span class=\"line\">Git: 2.43.0 =&gt; /usr/local/bin/git</span><br><span class=\"line\">Curl: 8.7.1 =&gt; /usr/bin/curl</span><br><span class=\"line\">macOS: 13.7.1-x86_64</span><br><span class=\"line\">CLT: 15.0.0.0.1.1694021235</span><br><span class=\"line\">Xcode: N/A</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># é€šè¿‡brewå‡çº§fdï¼Œå¯ä»¥çœ‹åˆ°ä½¿ç”¨äº†æ¸…åæº</span></span><br><span class=\"line\">$ brew upgrade fd</span><br><span class=\"line\">==&gt; Upgrading 1 outdated package:</span><br><span class=\"line\">fd 8.2.1 -&gt; 10.2.0</span><br><span class=\"line\">==&gt; Fetching fd</span><br><span class=\"line\">==&gt; Downloading https://mirrors.tuna.tsinghua.edu.cn/homebrew-bottles/fd-10.2.0.ventura.bottle.tar.gz</span><br><span class=\"line\"><span class=\"comment\">################################################################################################################################################################################### 100.0%</span></span><br><span class=\"line\">==&gt; Verifying attestation <span class=\"keyword\">for</span> fd</span><br><span class=\"line\">==&gt; Upgrading fd</span><br><span class=\"line\">  8.2.1 -&gt; 10.2.0</span><br><span class=\"line\">==&gt; Pouring fd-10.2.0.ventura.bottle.tar.gz</span><br><span class=\"line\">==&gt; Caveats</span><br><span class=\"line\">zsh completions have been installed to:</span><br><span class=\"line\">  /usr/local/share/zsh/site-functions</span><br><span class=\"line\">==&gt; Summary</span><br><span class=\"line\">ğŸº  /usr/local/Cellar/fd/10.2.0: 14 files, 2.9MB</span><br><span class=\"line\">==&gt; Running `brew cleanup fd`...</span><br><span class=\"line\">Disable this behaviour by setting HOMEBREW_NO_INSTALL_CLEANUP.</span><br><span class=\"line\">Hide these hints with HOMEBREW_NO_ENV_HINTS (see `man brew`).</span><br><span class=\"line\">Removing: /usr/local/Cellar/fd/8.2.1... (13 files, 2.4MB)</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ¢å¤GitHubé•œåƒæº</p>\n</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ <span class=\"built_in\">unset</span> HOMEBREW_BREW_GIT_REMOTE</span><br><span class=\"line\">$ <span class=\"built_in\">unset</span> HOMEBREW_CORE_GIT_REMOTE</span><br><span class=\"line\">$ <span class=\"built_in\">unset</span> HOMEBREW_API_DOMAIN</span><br><span class=\"line\">$ <span class=\"built_in\">unset</span> HOMEBREW_BOTTLE_DOMAIN</span><br><span class=\"line\">$ git -C <span class=\"string\">&quot;<span class=\"subst\">$(brew --repo)</span>&quot;</span> remote set-url origin https://github.com/Homebrew/brew</span><br><span class=\"line\">$ brew update</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹brewé…ç½®ä¿¡æ¯</span></span><br><span class=\"line\">$ brew config</span><br><span class=\"line\">HOMEBREW_VERSION: 4.4.8-38-g6089077</span><br><span class=\"line\">ORIGIN: https://github.com/Homebrew/brew</span><br><span class=\"line\">HEAD: 60890774e0a70fe93f94973b080068cf7b0d1c93</span><br><span class=\"line\">Last commit: 9 hours ago</span><br><span class=\"line\">Branch: master</span><br><span class=\"line\">Core tap HEAD: 787d1587bfa92794f7d141063a31773064ef9107</span><br><span class=\"line\">Core tap last commit: 13 minutes ago</span><br><span class=\"line\">Core tap JSON: 29 Nov 10:09 UTC</span><br><span class=\"line\">Core cask tap HEAD: 871fe2e8b93aac896a1808571ff11f8b89e6d90e</span><br><span class=\"line\">Core cask tap last commit: 48 seconds ago</span><br><span class=\"line\">Core cask tap JSON: 29 Nov 10:09 UTC</span><br><span class=\"line\">HOMEBREW_PREFIX: /usr/local</span><br><span class=\"line\">HOMEBREW_CASK_OPTS: []</span><br><span class=\"line\">HOMEBREW_GITHUB_API_TOKEN: <span class=\"built_in\">set</span></span><br><span class=\"line\">HOMEBREW_MAKE_JOBS: 12</span><br><span class=\"line\">HOMEBREW_SORBET_RUNTIME: <span class=\"built_in\">set</span></span><br><span class=\"line\">Homebrew Ruby: 3.3.6 =&gt; /usr/local/Homebrew/Library/Homebrew/vendor/portable-ruby/3.3.6/bin/ruby</span><br><span class=\"line\">CPU: dodeca-core 64-bit kabylake</span><br><span class=\"line\">Clang: 15.0.0 build 1500</span><br><span class=\"line\">Git: 2.43.0 =&gt; /usr/local/bin/git</span><br><span class=\"line\">Curl: 8.7.1 =&gt; /usr/bin/curl</span><br><span class=\"line\">macOS: 13.7.1-x86_64</span><br><span class=\"line\">CLT: 15.0.0.0.1.1694021235</span><br><span class=\"line\">Xcode: N/A</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># é€šè¿‡brewå‡çº§telnetï¼Œå¯ä»¥çœ‹åˆ°ä½¿ç”¨äº†GitHubæº</span></span><br><span class=\"line\">$ brew upgrade telnet</span><br><span class=\"line\">==&gt; Upgrading 1 outdated package:</span><br><span class=\"line\">telnet 294 -&gt; 303.141.1</span><br><span class=\"line\">==&gt; Downloading https://ghcr.io/v2/homebrew/core/telnet/manifests/303.141.1</span><br><span class=\"line\"><span class=\"comment\">################################################################################################################################################################################### 100.0%</span></span><br><span class=\"line\">==&gt; Fetching telnet</span><br><span class=\"line\">==&gt; Downloading https://ghcr.io/v2/homebrew/core/telnet/blobs/sha256:1be6b7b6a17a311fb3a2f1bffe7dae52284f3239b8af03f651c4fac11362f702</span><br><span class=\"line\"><span class=\"comment\">################################################################################################################################################################################### 100.0%</span></span><br><span class=\"line\">==&gt; Verifying attestation <span class=\"keyword\">for</span> telnet</span><br><span class=\"line\">==&gt; Upgrading telnet</span><br><span class=\"line\">  294 -&gt; 303.141.1</span><br><span class=\"line\">==&gt; Pouring telnet--303.141.1.ventura.bottle.tar.gz</span><br><span class=\"line\">ğŸº  /usr/local/Cellar/telnet/303.141.1: 5 files, 207.5KB</span><br><span class=\"line\">==&gt; Running `brew cleanup telnet`...</span><br><span class=\"line\">Disable this behaviour by setting HOMEBREW_NO_INSTALL_CLEANUP.</span><br><span class=\"line\">Hide these hints with HOMEBREW_NO_ENV_HINTS (see `man brew`).</span><br><span class=\"line\">Removing: /usr/local/Cellar/telnet/294... (4 files, 208.2KB)</span><br></pre></td></tr></table></figure>\n<h2 id=\"é‡è¦çš„è¯´æ˜\">é‡è¦çš„è¯´æ˜</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>brewå®‰è£…çš„è½¯ä»¶åŒ…ä¼šè¢«è½¯è¿æ¥åˆ°<code>/usr/local/bin/</code>ä¸‹ï¼Œæ‰€ä»¥éœ€è¦å°†è¯¥è·¯å¾„åŠ å…¥ç³»ç»Ÿç¯å¢ƒPATHä¸­</p>\n</li>\n<li class=\"lvl-2\">\n<p>è¿™é‡Œè¦æ³¨æ„ä¸€ç‚¹ï¼Œå¦‚æœè¯¥è·¯å¾„åœ¨PATHä¸­å£°æ˜çš„æ¯”è¾ƒé å‰ï¼Œå°±å¯èƒ½ä¼šè¢«ä¼˜å…ˆä½¿ç”¨ï¼Œæ¯”å¦‚æˆ‘ä»¬å·²ç»æ‰‹å·¥åœ¨ç³»ç»Ÿä¸­å®‰è£…äº†<code>python</code>çš„æŸä¸ªç‰ˆæœ¬ï¼Œä½†é€šè¿‡brewå®‰è£…æŸäº›è½¯ä»¶åŒ…æ—¶å› ä¸ºå…¶ä¾èµ–pythonï¼Œå°±ä¼šé€šè¿‡brewåŒæ—¶å®‰è£…å¯¹åº”çš„pythonç‰ˆæœ¬ï¼Œæ­¤æ—¶æˆ‘ä»¬åœ¨ä½¿ç”¨pythonå‘½ä»¤æ—¶ï¼Œå°±ä¼šä¼˜å…ˆä½¿ç”¨è¿™ä¸ª</p>\n</li>\n<li class=\"lvl-2\">\n<p>æœ‰ä¸¤ç§æ–¹æ³•å¯ä»¥è§£å†³ï¼Œ1æ˜¯é€šè¿‡<code>brew unlink python</code>æ¥è§£é™¤é“¾æ¥ï¼Œæ­¤æ—¶å¹¶ä¸æ˜¯åˆ é™¤ï¼Œè€Œåªæ˜¯è§£é™¤äº†è½¯é“¾ï¼Œä¸ä¼šå½±å“ä¾èµ–å®ƒçš„å·¥å…·çš„ä½¿ç”¨ï¼Œå¦‚æœéœ€è¦æ¢å¤é“¾æ¥ï¼Œå¯ä»¥é€šè¿‡<code>brew link python</code>æ¥æ¢å¤é“¾æ¥ï¼›2æ˜¯å°†æˆ‘ä»¬çš„ç³»ç»Ÿä¸­è‡ªå·±å®‰è£…çš„ä¸€äº›å·¥å…·çš„è·¯å¾„å£°æ˜åœ¨<code>/usr/local/bin/</code>ä¹‹å‰ï¼Œè¿™æ ·å°±ä¸ä¼šæœ‰å½±å“äº†ã€‚</p>\n</li>\n</ul>\n","content_text":"æ‘˜è¦ brewæ˜¯ä¸€ä¸ªè½¯ä»¶åŒ…ç®¡ç†å™¨ï¼ŒåŒæ—¶æ”¯æŒMacOSå’ŒLinuxï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿åœ°å®‰è£…å„ç§è½¯ä»¶ï¼Œæ¯”å¦‚gitã€nodeã€pythonç­‰ã€‚ brewè™½ç„¶æ”¯æŒlinuxï¼Œä½†æ˜¯å®é™…ä½¿ç”¨ä¸­å¾ˆå°‘ä¼šä½¿ç”¨brewæ¥ç®¡ç†linuxçš„è½¯ä»¶åŒ…ã€‚ æœ¬æ–‡ä»‹ç»å¦‚ä½•åœ¨macosä¸‹å®‰è£…brewï¼Œä»¥åŠå¦‚ä½•ä½¿ç”¨brewç®¡ç†å„ç§è½¯ä»¶åŒ…ã€‚ å®‰è£… é¦–å…ˆè¦ç¡®ä¿ç³»ç»Ÿä¸­å®‰è£…äº† git å’Œ curlï¼Œå¯¹äº macOS ç”¨æˆ·æ¥è¯´ï¼Œè¿™äº›ç³»ç»Ÿéƒ½è‡ªå¸¦äº†ï¼Œå”¯ä¸€éœ€é¢å¤–è¦æ±‚å®‰è£…çš„æ˜¯Command Line Tools (CLT) for Xcodeã€‚ 12345# æ£€æŸ¥ç³»ç»Ÿä¸­æ˜¯å¦å®‰è£…äº† Command Line Tools (CLT) for Xcodexcode-select --version # èƒ½å¤Ÿè¾“å‡ºç‰ˆæœ¬å·è¯´æ˜å®‰è£…äº†ï¼Œå¦åˆ™éœ€è¦å®‰è£…ã€‚# å®‰è£… Command Line Tools (CLT) for Xcodexcode-select --install åœ¨MacOSä¸Šå®‰è£…brewæœ‰ä¸¤ç§æ–¹æ³• æ–¹æ³•ä¸€ï¼šä½¿ç”¨è„šæœ¬å®‰è£… 1/bin/bash -c &quot;$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)&quot; å®‰è£…æ—¶å¯ä»¥æŒ‡å®šé•œåƒä¸‹è½½æºï¼Œé»˜è®¤æ˜¯Homebrewçš„GitHubä¸‹è½½æºï¼Œä¹Ÿå¯ä»¥é€‰æ‹©å›½å†…çš„é•œåƒæºï¼Œæ¯”å¦‚ä½¿ç”¨æ¸…åå¤§å­¦çš„Homebrewé•œåƒæº 1234567# æ§åˆ¶äº† Homebrew åœ¨å®‰è£…è½¯ä»¶åŒ…æ—¶æ˜¯å¦ä» Homebrew çš„ API æœåŠ¡å™¨è·å–ä¿¡æ¯ï¼Œbrew4.0åæ˜¯é»˜è®¤è¡Œä¸ºï¼Œæ— éœ€è®¾ç½®export HOMEBREW_INSTALL_FROM_API=1# è®¾ç½®brewä»“åº“ä¸Šæ¸¸export HOMEBREW_BREW_GIT_REMOTE=&quot;https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/brew.git&quot;# è®¾ç½®homebrewæ ¸å¿ƒä¸Šæ¸¸export HOMEBREW_CORE_GIT_REMOTE=&quot;https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/homebrew-core.git&quot;/bin/bash -c &quot;$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)&quot; æ–¹æ³•äºŒï¼šä½¿ç”¨PKGæ–‡ä»¶å®‰è£… ä»Homebrewçš„githubä¸Šä¸‹è½½æœ€æ–°ç‰ˆçš„Homebrew-x.x.x.pkg éªŒè¯æ˜¯å¦å®‰è£…æˆåŠŸ brew å‘½ä»¤æœ¬èº«åŠé€šè¿‡brewå®‰è£…çš„æ‰€æœ‰å‘½ä»¤éƒ½ä¼šè¢«è½¯é“¾æ¥åˆ°/usr/local/bin/ä¸‹ï¼Œæ‰€ä»¥éœ€è¦å°†è¯¥è·¯å¾„åŠ å…¥ç³»ç»Ÿç¯å¢ƒPATHä¸­ é‡å¯ç»ˆç«¯ï¼Œç„¶åæ‰§è¡Œbrewå‘½ä»¤ 123456789101112131415161718192021222324$ brewExample usage: brew search TEXT|/REGEX/ brew info [FORMULA|CASK...] brew install FORMULA|CASK... brew update brew upgrade [FORMULA|CASK...] brew uninstall FORMULA|CASK... brew list [FORMULA|CASK...]Troubleshooting: brew config brew doctor brew install --verbose --debug FORMULA|CASKContributing: brew create URL [--no-fetch] brew edit [FORMULA|CASK...]Further help: brew commands brew help [COMMAND] man brew https://docs.brew.sh Homebrewæœ¬èº«çš„å®‰è£…ä½ç½®å¯ä»¥é€šè¿‡brew --repoæŸ¥çœ‹ï¼Œé»˜è®¤ä¸º/usr/local/Homebrew é€šè¿‡brewå®‰è£…çš„è½¯ä»¶åŒ…é»˜è®¤ä¼šè¢«å®‰è£…åˆ°/usr/local/Cellar/ä¸‹ï¼Œæ¯”å¦‚gitå®‰è£…åä¼šåœ¨/usr/local/Cellar/git/ç›®å½•ä¸‹ï¼Œå¯ä»¥é€šè¿‡brew info gitæŸ¥çœ‹å®‰è£…ä¿¡æ¯ï¼ŒåŒ…æ‹¬ä¾èµ–åº“ç­‰ã€‚ é…ç½®å‘½ä»¤è¡¥å…¨ å‚è€ƒå®˜ç½‘Homebrew Documentationâ€“brew Shell Completion æˆ‘è¿™é‡Œä½¿ç”¨çš„æ˜¯zshï¼Œåœ¨~/.zshrcä¸­åŠ å…¥å¦‚ä¸‹å†…å®¹å¹¶é‡å¯ç»ˆç«¯å³å¯ç”Ÿæ•ˆ 12autoload -Uz compinitcompinit å¸è½½brew 1/bin/bash -c &quot;$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/uninstall.sh)&quot; å¸¸ç”¨å‘½ä»¤ brewæ”¯æŒå®‰è£…å‘½ä»¤è¡Œå·¥å…·(formula)å’ŒGUIå·¥å…·(cask) brew install xxx å®‰è£…å‘½ä»¤è¡Œå·¥å…·ï¼Œè¿™ä¸ªæœ€ä¸ºå¸¸ç”¨ï¼Œæ¯”å¦‚ brew install fd brew install --cask xxx å®‰è£…GUIå·¥å…·ï¼Œä¸€èˆ¬å¾ˆå°‘ä½¿ç”¨brewå®‰è£…GUIå·¥å…·ï¼Œæ¯”å¦‚ brew install --cask firefox brewçš„å‘½ä»¤å’Œå‚æ•°éå¸¸å¤šï¼Œä½†æ—¥å¸¸ä½¿ç”¨åªéœ€è¦è®°ä½å¸¸ç”¨çš„çš„å‡ ä¸ªå°±å¤Ÿäº†ï¼Œè¯¦ç»†çš„å‘½ä»¤åˆ—è¡¨å¯ä»¥å‚è€ƒHomebrew Documentation 1234# æŸ¥çœ‹brewæ”¯æŒå“ªäº›å‘½ä»¤brew commands# æŸ¥çœ‹å‘½ä»¤çš„å¸®åŠ©ä¿¡æ¯ï¼Œæ¯”å¦‚brew install --help ä¸€äº›å¸¸ç”¨çš„å‘½ä»¤ 1234567brew update # æ›´æ–°brewåˆ°æœ€æ–°ç‰ˆæœ¬brew --version # æŸ¥çœ‹brewçš„ç‰ˆæœ¬brew config # æŸ¥çœ‹brewçš„é…ç½®ä¿¡æ¯brew home # æµè§ˆå™¨æ‰“å¼€brewå®˜ç½‘brew home xxx # æµè§ˆå™¨æ‰“å¼€xxxå®˜ç½‘ å¦‚ï¼šæ‰“å¼€fdå‘½ä»¤çš„å®˜ç½‘ brew home fd ,å…·ä½“çš„åç§°å¯ä»¥é€šè¿‡brew listæŸ¥çœ‹brew cleanup # æ¸…ç†ç¼“å­˜åŠæ—¥å¿—æ–‡ä»¶ï¼Œå»ºè®®å®šæœŸæ¸…ç†ï¼Œé»˜è®¤è¶…è¿‡30å¤©ï¼Œå½“è¿è¡Œbrewæ—¶ä¼šè‡ªåŠ¨æ¸…ç†ï¼ˆ2.0ä»¥åçš„ç‰ˆæœ¬ï¼‰brew doctor # æ£€æŸ¥æ˜¯å¦æœ‰ä¾èµ–é—®é¢˜ï¼Œæ¯”å¦‚æ²¡æœ‰å®‰è£…ä¾èµ–åº“ï¼Œæˆ–è€…ä¾èµ–åº“ç‰ˆæœ¬è¿‡ä½ æŸ¥çœ‹å·²å®‰è£…çš„åŒ… 1234# æŸ¥çœ‹brew list # æŸ¥çœ‹å·²å®‰è£…çš„åŒ…brew list --versions # æŸ¥çœ‹å·²å®‰è£…çš„åŒ…åŠç‰ˆæœ¬brew info xxx # æŸ¥çœ‹xxxçš„å®‰è£…ä¿¡æ¯ å®‰è£…ã€å¸è½½ 123456# æŸ¥æ‰¾ã€å®‰è£…ã€å¸è½½brew search xxx # æŸ¥æ‰¾è½¯ä»¶åŒ…ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ https://formulae.brew.sh ç½‘é¡µè¿›è¡Œæœç´¢brew install xxx # å®‰è£…è½¯ä»¶åŒ…ï¼Œå®‰è£…æ—¶ä¼šè‡ªåŠ¨ä¸‹è½½ä¾èµ–åº“ï¼Œæ¯”å¦‚å®‰è£…`nginx`æ—¶ï¼Œä¼šè‡ªåŠ¨ä¸‹è½½`openssl@3`å’Œ`pcre2`ç­‰brew uninstall xxx # å¸è½½è½¯ä»¶åŒ…ï¼Œåªä¼šå¸è½½å½“å‰åŒ…ï¼Œä¸ä¼šå¸è½½ä¾èµ–åº“ï¼Œè¿™æ ·å°±æœ‰å¯èƒ½å­˜åœ¨å¾ˆå¤šå†—ä½™åŒ…brew autoremove # åˆ é™¤æ‰€æœ‰ä»…ä½œä¸ºå¦ä¸€ä¸ªè½¯ä»¶åŒ…çš„ä¾èµ–é¡¹å®‰è£…å¹¶ä¸”ç°åœ¨ä¸å†éœ€è¦çš„åŒ…brew autoremove --dry-run # --dry-run ä»…æŸ¥çœ‹å“ªäº›åŒ…å¯ä»¥åˆ é™¤ï¼Œå¹¶ä¸ä¼šçœŸçš„åˆ é™¤ å‡çº§ 1234# å‡çº§brew outdated # æŸ¥çœ‹éœ€è¦å‡çº§çš„åŒ…brew upgrade xxx # å‡çº§xxxåˆ°æœ€æ–°ç‰ˆbrew upgrade # æ›´æ–°å…¨éƒ¨å‘½ä»¤åˆ°æœ€æ–°ç‰ˆ ä¾èµ–å…³ç³» 12345678# ä¾èµ–å…³ç³»brew deps --tree xxx # æ ‘å½¢æ˜¾ç¤ºåŒ…çš„ä¾èµ–æ ‘brew deps --installed --tree # æ ‘å½¢æ˜¾ç¤ºæ‰€æœ‰å®‰è£…åŒ…çš„ä¾èµ–å…³ç³»brew deps --installed xxx # æ˜¾ç¤ºå½“å‰å®‰è£…åŒ…çš„ä¾èµ–å…³ç³»ï¼Œçºµå‘å±•ç¤ºbrew deps --installed --for-each xxx # æ˜¾ç¤ºå½“å‰å®‰è£…åŒ…çš„ä¾èµ–å…³ç³»ï¼Œæ¨ªå‘å±•ç¤ºbrew uses --installed xxx # æŸ¥çœ‹å·²ç»å®‰è£…çš„å“ªäº›å·¥å…·ä¾èµ–å½“å‰åŒ…brew leaves # æŸ¥çœ‹é¡¶çº§å®‰è£…åŒ…ï¼Œå³ä½ é€šè¿‡brewç›´æ¥å®‰è£…çš„åŒ…ï¼Œè€Œä¸æ˜¯é€šè¿‡å®‰è£…å…¶ä»–è½¯ä»¶åŒ…é—´æ¥å®‰è£…çš„brew leaves | xargs brew deps --installed --for-each # æŸ¥çœ‹é¡¶çº§åŒ…ï¼Œå¹¶åˆ—å‡ºæ¯ä¸ªé¡¶çº§åŒ…çš„å·²å®‰è£…ä¾èµ– brew services: brewçš„æœåŠ¡ç®¡ç†å·¥å…·ï¼Œå¯ä»¥æ–¹ä¾¿çš„ç®¡ç†é€šè¿‡brewå®‰è£…çš„æœåŠ¡ï¼ŒåŒ…æ‹¬å¯åŠ¨ã€åœæ­¢ã€é‡å¯æœåŠ¡ï¼Œç­‰ç­‰ï¼Œæ¯”å¦‚nginxã€redisã€mysqlç­‰ï¼Œå…·ä½“å‘½ä»¤å¯ä»¥å‚è€ƒHomebrew Documentation 123456789brew services list # æŸ¥çœ‹å·²å®‰è£…çš„æ‰€æœ‰æœåŠ¡brew services start nginx # å¯åŠ¨æœåŠ¡ï¼Œå¹¶æ³¨å†Œåˆ°ç³»ç»Ÿå¯åŠ¨æœåŠ¡åˆ—è¡¨ï¼Œå³åˆ›å»ºç³»ç»Ÿè‡ªå¯åŠ¨æ–‡ä»¶ï¼š ~/Library/LaunchAgents/homebrew.mxcl.nginx.plistbrew services stop nginx # åœæ­¢æœåŠ¡ï¼Œå¹¶ä»ç³»ç»Ÿå¯åŠ¨æœåŠ¡åˆ—è¡¨ä¸­ç§»é™¤ï¼Œå³åˆ é™¤ç³»ç»Ÿè‡ªå¯åŠ¨æ–‡ä»¶brew services kill nginx # ç«‹å³æ€æ­»æœåŠ¡ï¼Œä½†ä¸ä»ç³»ç»Ÿå¯åŠ¨æœåŠ¡åˆ—è¡¨ä¸­ç§»é™¤brew services restart nginx # é‡å¯æœåŠ¡brew services info nginx # æŸ¥çœ‹æœåŠ¡çš„çŠ¶æ€å’Œè¿›ç¨‹IPbrew services run nginx # è¿è¡ŒæœåŠ¡ï¼Œä½†ä¸ä¼šä¿å­˜åˆ°æœåŠ¡åˆ—è¡¨ä¸­brew services cleanup # æ¸…ç†æ— æ•ˆçš„æœåŠ¡ï¼Œå³å·²å¸è½½åº”ç”¨çš„æ— ç”¨çš„é…ç½®brew services --help # æŸ¥çœ‹å¸®åŠ© é…ç½®å›½å†…é•œåƒæº æ­¤å¤„ä»¥é…ç½®æ¸…åæºé•œåƒä¸ºä¾‹ï¼Œé˜¿é‡Œæºè¯·å‚è€ƒå®˜ç½‘æ–‡æ¡£â€“Homebrewé•œåƒ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374## ä¸´æ—¶æ›¿æ¢# é…ç½®brewå›½å†…é•œåƒæº$ export HOMEBREW_BREW_GIT_REMOTE=&quot;https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/brew.git&quot;# é…ç½®brew-coreå›½å†…é•œåƒæº$ export HOMEBREW_CORE_GIT_REMOTE=&quot;https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/homebrew-core.git&quot;# é…ç½®brew-bottleå›½å†…é•œåƒæº$ export HOMEBREW_API_DOMAIN=&quot;https://mirrors.tuna.tsinghua.edu.cn/homebrew-bottles/api&quot;$ export HOMEBREW_BOTTLE_DOMAIN=&quot;https://mirrors.tuna.tsinghua.edu.cn/homebrew-bottles&quot;# æ›´æ–°é…ç½®$ brew update## é…ç½®æ°¸ä¹…ç”Ÿæ•ˆï¼Œzshç”¨æˆ·# é…ç½®brewå›½å†…é•œåƒæº$ echo &#x27;export HOMEBREW_BREW_GIT_REMOTE=&quot;https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/brew.git&quot;&#x27; &gt;&gt; ~/.zshrc# é…ç½®brew-coreå›½å†…é•œåƒæº$ echo &#x27;export HOMEBREW_CORE_GIT_REMOTE=&quot;https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/homebrew-core.git&quot;&#x27; &gt;&gt; ~/.zshrc# é…ç½®brew-bottleå›½å†…é•œåƒæº$ echo &#x27;export HOMEBREW_API_DOMAIN=&quot;https://mirrors.tuna.tsinghua.edu.cn/homebrew-bottles/api&quot;&#x27; &gt;&gt; ~/.zshrc$ echo &#x27;export HOMEBREW_BOTTLE_DOMAIN=&quot;https://mirrors.tuna.tsinghua.edu.cn/homebrew-bottles&quot;&#x27; &gt;&gt; ~/.zshrc# æ›´æ–°é…ç½®$ brew update# æ­¤æ—¶æŸ¥çœ‹brewé…ç½®ä¿¡æ¯ï¼Œå¯ä»¥çœ‹åˆ°å·²ç»ç”Ÿæ•ˆäº†$ brew configHOMEBREW_VERSION: 4.4.8-38-g6089077ORIGIN: https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/brew.gitHEAD: 60890774e0a70fe93f94973b080068cf7b0d1c93Last commit: 9 hours agoBranch: masterCore tap origin: https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/homebrew-core.gitCore tap HEAD: 787d1587bfa92794f7d141063a31773064ef9107Core tap last commit: 11 minutes agoCore tap JSON: 29 Nov 09:56 UTCCore cask tap HEAD: 4c34bd8c418e13160fc79f1ca9312555d2edc254Core cask tap last commit: 19 minutes agoCore cask tap JSON: 29 Nov 09:56 UTCHOMEBREW_PREFIX: /usr/localHOMEBREW_API_DOMAIN: https://mirrors.tuna.tsinghua.edu.cn/homebrew-bottles/apiHOMEBREW_BOTTLE_DOMAIN: https://mirrors.tuna.tsinghua.edu.cn/homebrew-bottlesHOMEBREW_BREW_GIT_REMOTE: https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/brew.gitHOMEBREW_CASK_OPTS: []HOMEBREW_CORE_GIT_REMOTE: https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/homebrew-core.gitHOMEBREW_GITHUB_API_TOKEN: setHOMEBREW_MAKE_JOBS: 12HOMEBREW_SORBET_RUNTIME: setHomebrew Ruby: 3.3.6 =&gt; /usr/local/Homebrew/Library/Homebrew/vendor/portable-ruby/3.3.6/bin/rubyCPU: dodeca-core 64-bit kabylakeClang: 15.0.0 build 1500Git: 2.43.0 =&gt; /usr/local/bin/gitCurl: 8.7.1 =&gt; /usr/bin/curlmacOS: 13.7.1-x86_64CLT: 15.0.0.0.1.1694021235Xcode: N/A# é€šè¿‡brewå‡çº§fdï¼Œå¯ä»¥çœ‹åˆ°ä½¿ç”¨äº†æ¸…åæº$ brew upgrade fd==&gt; Upgrading 1 outdated package:fd 8.2.1 -&gt; 10.2.0==&gt; Fetching fd==&gt; Downloading https://mirrors.tuna.tsinghua.edu.cn/homebrew-bottles/fd-10.2.0.ventura.bottle.tar.gz################################################################################################################################################################################### 100.0%==&gt; Verifying attestation for fd==&gt; Upgrading fd 8.2.1 -&gt; 10.2.0==&gt; Pouring fd-10.2.0.ventura.bottle.tar.gz==&gt; Caveatszsh completions have been installed to: /usr/local/share/zsh/site-functions==&gt; SummaryğŸº /usr/local/Cellar/fd/10.2.0: 14 files, 2.9MB==&gt; Running `brew cleanup fd`...Disable this behaviour by setting HOMEBREW_NO_INSTALL_CLEANUP.Hide these hints with HOMEBREW_NO_ENV_HINTS (see `man brew`).Removing: /usr/local/Cellar/fd/8.2.1... (13 files, 2.4MB) æ¢å¤GitHubé•œåƒæº 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152$ unset HOMEBREW_BREW_GIT_REMOTE$ unset HOMEBREW_CORE_GIT_REMOTE$ unset HOMEBREW_API_DOMAIN$ unset HOMEBREW_BOTTLE_DOMAIN$ git -C &quot;$(brew --repo)&quot; remote set-url origin https://github.com/Homebrew/brew$ brew update# æŸ¥çœ‹brewé…ç½®ä¿¡æ¯$ brew configHOMEBREW_VERSION: 4.4.8-38-g6089077ORIGIN: https://github.com/Homebrew/brewHEAD: 60890774e0a70fe93f94973b080068cf7b0d1c93Last commit: 9 hours agoBranch: masterCore tap HEAD: 787d1587bfa92794f7d141063a31773064ef9107Core tap last commit: 13 minutes agoCore tap JSON: 29 Nov 10:09 UTCCore cask tap HEAD: 871fe2e8b93aac896a1808571ff11f8b89e6d90eCore cask tap last commit: 48 seconds agoCore cask tap JSON: 29 Nov 10:09 UTCHOMEBREW_PREFIX: /usr/localHOMEBREW_CASK_OPTS: []HOMEBREW_GITHUB_API_TOKEN: setHOMEBREW_MAKE_JOBS: 12HOMEBREW_SORBET_RUNTIME: setHomebrew Ruby: 3.3.6 =&gt; /usr/local/Homebrew/Library/Homebrew/vendor/portable-ruby/3.3.6/bin/rubyCPU: dodeca-core 64-bit kabylakeClang: 15.0.0 build 1500Git: 2.43.0 =&gt; /usr/local/bin/gitCurl: 8.7.1 =&gt; /usr/bin/curlmacOS: 13.7.1-x86_64CLT: 15.0.0.0.1.1694021235Xcode: N/A# é€šè¿‡brewå‡çº§telnetï¼Œå¯ä»¥çœ‹åˆ°ä½¿ç”¨äº†GitHubæº$ brew upgrade telnet==&gt; Upgrading 1 outdated package:telnet 294 -&gt; 303.141.1==&gt; Downloading https://ghcr.io/v2/homebrew/core/telnet/manifests/303.141.1################################################################################################################################################################################### 100.0%==&gt; Fetching telnet==&gt; Downloading https://ghcr.io/v2/homebrew/core/telnet/blobs/sha256:1be6b7b6a17a311fb3a2f1bffe7dae52284f3239b8af03f651c4fac11362f702################################################################################################################################################################################### 100.0%==&gt; Verifying attestation for telnet==&gt; Upgrading telnet 294 -&gt; 303.141.1==&gt; Pouring telnet--303.141.1.ventura.bottle.tar.gzğŸº /usr/local/Cellar/telnet/303.141.1: 5 files, 207.5KB==&gt; Running `brew cleanup telnet`...Disable this behaviour by setting HOMEBREW_NO_INSTALL_CLEANUP.Hide these hints with HOMEBREW_NO_ENV_HINTS (see `man brew`).Removing: /usr/local/Cellar/telnet/294... (4 files, 208.2KB) é‡è¦çš„è¯´æ˜ brewå®‰è£…çš„è½¯ä»¶åŒ…ä¼šè¢«è½¯è¿æ¥åˆ°/usr/local/bin/ä¸‹ï¼Œæ‰€ä»¥éœ€è¦å°†è¯¥è·¯å¾„åŠ å…¥ç³»ç»Ÿç¯å¢ƒPATHä¸­ è¿™é‡Œè¦æ³¨æ„ä¸€ç‚¹ï¼Œå¦‚æœè¯¥è·¯å¾„åœ¨PATHä¸­å£°æ˜çš„æ¯”è¾ƒé å‰ï¼Œå°±å¯èƒ½ä¼šè¢«ä¼˜å…ˆä½¿ç”¨ï¼Œæ¯”å¦‚æˆ‘ä»¬å·²ç»æ‰‹å·¥åœ¨ç³»ç»Ÿä¸­å®‰è£…äº†pythonçš„æŸä¸ªç‰ˆæœ¬ï¼Œä½†é€šè¿‡brewå®‰è£…æŸäº›è½¯ä»¶åŒ…æ—¶å› ä¸ºå…¶ä¾èµ–pythonï¼Œå°±ä¼šé€šè¿‡brewåŒæ—¶å®‰è£…å¯¹åº”çš„pythonç‰ˆæœ¬ï¼Œæ­¤æ—¶æˆ‘ä»¬åœ¨ä½¿ç”¨pythonå‘½ä»¤æ—¶ï¼Œå°±ä¼šä¼˜å…ˆä½¿ç”¨è¿™ä¸ª æœ‰ä¸¤ç§æ–¹æ³•å¯ä»¥è§£å†³ï¼Œ1æ˜¯é€šè¿‡brew unlink pythonæ¥è§£é™¤é“¾æ¥ï¼Œæ­¤æ—¶å¹¶ä¸æ˜¯åˆ é™¤ï¼Œè€Œåªæ˜¯è§£é™¤äº†è½¯é“¾ï¼Œä¸ä¼šå½±å“ä¾èµ–å®ƒçš„å·¥å…·çš„ä½¿ç”¨ï¼Œå¦‚æœéœ€è¦æ¢å¤é“¾æ¥ï¼Œå¯ä»¥é€šè¿‡brew link pythonæ¥æ¢å¤é“¾æ¥ï¼›2æ˜¯å°†æˆ‘ä»¬çš„ç³»ç»Ÿä¸­è‡ªå·±å®‰è£…çš„ä¸€äº›å·¥å…·çš„è·¯å¾„å£°æ˜åœ¨/usr/local/bin/ä¹‹å‰ï¼Œè¿™æ ·å°±ä¸ä¼šæœ‰å½±å“äº†ã€‚","summary":"æ‘˜è¦ brewæ˜¯ä¸€ä¸ªè½¯ä»¶åŒ…ç®¡ç†å™¨ï¼ŒåŒæ—¶æ”¯æŒMacOSå’ŒLinuxï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿åœ°å®‰è£…å„ç§è½¯ä»¶ï¼Œæ¯”å¦‚gitã€nodeã€pythonç­‰ã€‚ brewè™½ç„¶æ”¯æŒlinuxï¼Œä½†æ˜¯å®é™…ä½¿ç”¨ä¸­å¾ˆå°‘ä¼šä½¿ç”¨brewæ¥ç®¡ç†linuxçš„è½¯ä»¶åŒ…ã€‚ æœ¬æ–‡ä»‹ç»å¦‚ä½•åœ¨macosä¸‹å®‰è£…brewï¼Œä»¥åŠå¦‚ä½•ä½¿ç”¨brewç®¡ç†å„ç§è½¯ä»¶åŒ…ã€‚","date_published":"2024-11-28T13:55:05.000Z","tags":["macos","macos","brew"]},{"id":"https://blog.hanqunfeng.com/2024/11/22/python_poetry/","url":"https://blog.hanqunfeng.com/2024/11/22/python_poetry/","title":"Poetry--è½»é‡çº§çš„pythonåŒ…ç®¡ç†å™¨","content_html":"<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\"><a href=\"https://python-poetry.org/docs/\">Poetry</a>æ˜¯ä¸€ä¸ªè½»é‡çº§çš„pythonåŒ…ç®¡ç†å™¨ï¼Œå…¶ç›®æ ‡æ˜¯å¸®åŠ©å¼€å‘è€…å¿«é€Ÿã€è½»æ¾åœ°æ„å»ºã€å‘å¸ƒå’Œåˆ†äº«pythonåŒ…ã€‚è¯´å®ƒè½»é‡ï¼Œæ˜¯ä¸ <a href=\"https://docs.conda.io/projects/conda/en/stable/\">conda</a> ç›¸æ¯” poetry æ›´è½»é‡ï¼ŒåŒæ—¶ä¸ <code>venv + pip</code> <a href=\"/2018/04/28/python_virtualenv/\" title=\"Python--virtualenv\">Python--virtualenv</a> çš„æ–¹å¼ç›¸æ¯”å…·æœ‰å¦‚ä¸‹ä¼˜ç‚¹ï¼š\n<ul class=\"lvl-2\">\n<li class=\"lvl-6\">ä½¿ç”¨ç¼“å­˜æœºåˆ¶ï¼Œé¿å…é‡å¤ä¸‹è½½ä¾èµ–åŒ…</li>\n<li class=\"lvl-6\">åŒ…ç®¡ç†ä¸Šæ›´åŠ ç²¾ç¡®ï¼Œåˆ é™¤ä¸éœ€è¦çš„åŒ…æ—¶ä¼šåŒæ—¶åˆ é™¤ä¸å…¶å…³è”çš„ä¸”æ²¡æœ‰è¢«ä½¿ç”¨çš„é‚£äº›ä¾èµ–åŒ…ï¼Œé¿å…æ— ç”¨çš„ä¾èµ–åŒ…é€ æˆæ‰“åŒ…ä½“ç§¯è¿‡å¤§</li>\n<li class=\"lvl-6\">æ‰“åŒ…å’Œå‘å¸ƒæ›´åŠ ç®€å•ï¼Œåªéœ€è¦ä¸€ä¸ªå‘½ä»¤å°±å¯ä»¥æ‰“åŒ…å’Œå‘å¸ƒ</li>\n</ul>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"å®‰è£…\">å®‰è£…</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å‚è€ƒå®˜æ–¹æ–‡æ¡£<a href=\"https://python-poetry.org/docs/#installation\">Installation</a></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å®˜æ–¹æ¨èä½¿ç”¨pipxå®‰è£…ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨ pip</span></span><br><span class=\"line\">$ pipx install poetry</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹æ˜¯å¦å®‰è£…æˆåŠŸ</span></span><br><span class=\"line\">$ poetry --version</span><br><span class=\"line\">Poetry (version 1.8.4)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ·»åŠ å‘½ä»¤è‡ªåŠ¨è¡¥å…¨</span></span><br><span class=\"line\">$ <span class=\"built_in\">mkdir</span>  ~/.zfunc</span><br><span class=\"line\">$ poetry completions zsh &gt; ~/.zfunc/_poetry</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åœ¨ ~/.zshrc ä¸­æ·»åŠ ä»¥ä¸‹é…ç½®ï¼ˆæˆ‘æ˜¯ç”¨çš„æ˜¯zshï¼Œå…¶ä»–shellå¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼‰</span></span><br><span class=\"line\">fpath+=~/.zfunc</span><br><span class=\"line\"><span class=\"built_in\">autoload</span> -Uz compinit &amp;&amp; compinit</span><br></pre></td></tr></table></figure>\n<div class=\"tips\">\n<p><em><strong>pipxç®€ä»‹</strong></em></p>\n<ul class=\"lvl-1\">\n<li class=\"lvl-2\">\n<p><a href=\"https://github.com/pypa/pipx\">pipx</a> æ˜¯ä¸€ä¸ª Python åŒ…ç®¡ç†å·¥å…·ï¼Œä½¿ç”¨pipxå®‰è£…å·¥å…·åŒ…æ—¶ï¼Œæ¯ä¸ªå·¥å…·éƒ½ä¼šè¢«å®‰è£…åœ¨ä¸€ä¸ªç‹¬ç«‹çš„è™šæ‹Ÿç¯å¢ƒä¸­ï¼Œé¿å…ä¸åŒå·¥å…·ä¹‹é—´çš„ä¾èµ–å†²çªã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>åœºæ™¯ï¼šä¸¤ä¸ªå·¥å…·ä¾èµ–ä¸åŒç‰ˆæœ¬çš„åŒä¸€ä¸ªåº“<br>\nå‡è®¾æˆ‘ä»¬æœ‰ä¸¤ä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼š</p>\n<p>å·¥å…·A ä¾èµ–äº requests åº“çš„ç‰ˆæœ¬ 2.27.1ã€‚<br>\nå·¥å…·B ä¾èµ–äº requests åº“çš„ç‰ˆæœ¬ 2.31.0ã€‚</p>\n<p>å¦‚æœä½¿ç”¨ pip å®‰è£…<br>\nå·¥å…·ä¼šè¢«å®‰è£…åˆ°å…¨å±€ç¯å¢ƒï¼Œå…±äº«ç›¸åŒçš„ä¾èµ–ç‰ˆæœ¬ï¼š</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pip install toolA  <span class=\"comment\"># å®‰è£…æ—¶ä¼šå®‰è£… requests 2.27.1</span></span><br><span class=\"line\">pip install toolB  <span class=\"comment\"># å®‰è£…æ—¶ä¼šå°† requests å‡çº§åˆ° 2.31.0</span></span><br></pre></td></tr></table></figure>\n<p>ç»“æœï¼š<br>\nå½“ä½ è¿è¡Œå·¥å…·Aæ—¶ï¼Œå®ƒå¯èƒ½ä¼šæŠ¥é”™ï¼Œå› ä¸ºå®ƒä¾èµ–çš„ requests 2.27.1 å·²è¢« requests 2.31.0 æ›¿æ¢ã€‚<br>\nå…¨å±€ç¯å¢ƒä¸­çš„æ‰€æœ‰å·¥å…·éƒ½å…±äº«ä¸€ä¸ª requestsï¼Œç‰ˆæœ¬å†²çªä¸å¯é¿å…ã€‚</p>\n<p>å¦‚æœä½¿ç”¨ pipx å®‰è£…<br>\næ¯ä¸ªå·¥å…·ä¼šè¢«å®‰è£…åˆ°ç‹¬ç«‹çš„è™šæ‹Ÿç¯å¢ƒä¸­ï¼Œå„è‡ªçš„ä¾èµ–äº’ä¸å½±å“ï¼š</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pipx install toolA  <span class=\"comment\"># åœ¨è™šæ‹Ÿç¯å¢ƒAä¸­å®‰è£… toolA å’Œ requests 2.27.1</span></span><br><span class=\"line\">pipx install toolB  <span class=\"comment\"># åœ¨è™šæ‹Ÿç¯å¢ƒBä¸­å®‰è£… toolB å’Œ requests 2.31.0</span></span><br></pre></td></tr></table></figure>\n<p>ç»“æœï¼š<br>\nè™šæ‹Ÿç¯å¢ƒA åªåŒ…å« toolA å’Œå®ƒçš„ä¾èµ– requests 2.27.1ã€‚<br>\nè™šæ‹Ÿç¯å¢ƒB åªåŒ…å« toolB å’Œå®ƒçš„ä¾èµ– requests 2.31.0ã€‚<br>\nå·¥å…·ä¹‹é—´å®Œå…¨éš”ç¦»ï¼Œä¸ä¼šå› ä¸ºä¾èµ–ç‰ˆæœ¬å†²çªè€Œå¯¼è‡´é—®é¢˜ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>æ‰€ä»¥ï¼Œå½“éœ€è¦å®‰è£…å…¨å±€å‘½ä»¤è¡Œå·¥å…·æ—¶ï¼Œä½¿ç”¨pipxæ˜¯ä¸ªå¾ˆå¥½çš„é€‰æ‹©</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://github.com/pypa/pipx\">pipx</a> çš„å®‰è£…</p>\n</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å®‰è£…pipx</span></span><br><span class=\"line\">pip install pipx</span><br><span class=\"line\"><span class=\"comment\"># é…ç½®ç¯å¢ƒå˜é‡ï¼Œè¿è¡Œè¯¥å‘½ä»¤ä¼šå°†</span></span><br><span class=\"line\">pipx ensurepath</span><br><span class=\"line\"><span class=\"comment\"># è¿è¡Œä¸Šé¢çš„å‘½ä»¤ä¼šå°†å¦‚ä¸‹å†…å®¹åŠ å…¥ä½ çš„shellé…ç½®æ–‡ä»¶ä¸­ï¼Œæˆ‘çš„æ˜¯ .zshrc æ–‡ä»¶ï¼Œå®é™…ä¸Šä½ ä¹Ÿå¯ä»¥æ‰‹å·¥æ·»åŠ è¯¥é…ç½®ï¼Œå°†$HOME/.local/binæ”¾åˆ°å‰é¢æ›´å¥½ä¸€äº›ã€‚</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> PATH=<span class=\"string\">&quot;<span class=\"variable\">$PATH</span>:<span class=\"variable\">$HOME</span>/.local/bin&quot;</span></span><br><span class=\"line\"><span class=\"comment\"># æ³¨æ„æ·»åŠ å®Œæˆåè¦é‡å¯shell</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ·»åŠ pipxè‡ªåŠ¨ä»£ç è¡¥å…¨</span></span><br><span class=\"line\"><span class=\"comment\"># è¿è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œå¹¶æ ¹æ®æç¤ºå®Œæˆ</span></span><br><span class=\"line\">pipx completions</span><br><span class=\"line\"><span class=\"comment\"># æˆ‘çš„æ˜¯zshï¼Œæ‰€ä»¥åœ¨ .zshrcä¸­æ·»åŠ å¦‚ä¸‹å†…å®¹</span></span><br><span class=\"line\"><span class=\"built_in\">autoload</span> -Uz compinit &amp;&amp; compinit <span class=\"comment\"># å¦‚æœæ²¡æœ‰æ·»åŠ è¿‡å°±éœ€è¦å…ˆæ·»åŠ è¿™ä¸ª</span></span><br><span class=\"line\"><span class=\"built_in\">eval</span> <span class=\"string\">&quot;<span class=\"subst\">$(register-python-argcomplete pipx)</span>&quot;</span> <span class=\"comment\"># æ·»åŠ è‡ªåŠ¨ä»£ç è¡¥å…¨</span></span><br><span class=\"line\"><span class=\"comment\"># æ³¨æ„æ·»åŠ å®Œæˆåè¦é‡å¯shell</span></span><br></pre></td></tr></table></figure>\n</div>\n<h2 id=\"æŸ¥çœ‹æ‰€æœ‰å‘½ä»¤\">æŸ¥çœ‹æ‰€æœ‰å‘½ä»¤</h2>\n<blockquote>\n<p>æˆ‘å·²ç»å°†å…¶ç¿»è¯‘ä¸ºä¸­æ–‡</p>\n</blockquote>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ poetry list</span><br><span class=\"line\">Poetry (ç‰ˆæœ¬ 1.8.4)</span><br><span class=\"line\"></span><br><span class=\"line\">ç”¨æ³•ï¼š</span><br><span class=\"line\">  <span class=\"built_in\">command</span> [é€‰é¡¹] [å‚æ•°]</span><br><span class=\"line\"></span><br><span class=\"line\">é€‰é¡¹ï¼š</span><br><span class=\"line\">  -h, --<span class=\"built_in\">help</span>                 æ˜¾ç¤ºç»™å®šå‘½ä»¤çš„å¸®åŠ©ã€‚å¦‚æœæ²¡æœ‰æŒ‡å®šå‘½ä»¤ï¼Œåˆ™æ˜¾ç¤ºåˆ—è¡¨å‘½ä»¤çš„å¸®åŠ©ã€‚</span><br><span class=\"line\">  -q, --quiet                ä¸è¾“å‡ºä»»ä½•æ¶ˆæ¯ã€‚</span><br><span class=\"line\">  -V, --version              æ˜¾ç¤ºæ­¤åº”ç”¨ç¨‹åºç‰ˆæœ¬ã€‚</span><br><span class=\"line\">      --ansi                å¼ºåˆ¶è¾“å‡ºANSIæ ¼å¼ã€‚</span><br><span class=\"line\">      --no-ansi             ç¦ç”¨ANSIè¾“å‡ºã€‚</span><br><span class=\"line\">  -n, --no-interaction       ä¸è¦æé—®ä»»ä½•äº¤äº’æ€§é—®é¢˜ã€‚</span><br><span class=\"line\">      --no-plugins           ç¦ç”¨æ’ä»¶ã€‚</span><br><span class=\"line\">      --no-cache            ç¦ç”¨æºç¼“å­˜ã€‚</span><br><span class=\"line\">  -C, --directory=ç›®å½•      Poetryå‘½ä»¤çš„å·¥ä½œç›®å½•ï¼ˆé»˜è®¤ä¸ºå½“å‰å·¥ä½œç›®å½•ï¼‰ã€‚</span><br><span class=\"line\">  -v|vv|vvv, --verbose       å¢åŠ æ¶ˆæ¯çš„å†—é•¿åº¦ï¼š1 è¡¨ç¤ºæ­£å¸¸è¾“å‡ºï¼Œ2 è¡¨ç¤ºæ›´è¯¦ç»†çš„è¾“å‡ºï¼Œ3 è¡¨ç¤ºè°ƒè¯•ã€‚</span><br><span class=\"line\"></span><br><span class=\"line\">å¯ç”¨å‘½ä»¤ï¼š</span><br><span class=\"line\">  about              æ˜¾ç¤ºå…³äºPoetryçš„ä¿¡æ¯ã€‚</span><br><span class=\"line\">  add                å°†æ–°ä¾èµ–é¡¹æ·»åŠ åˆ°pyproject.tomlå¹¶å®‰è£…å®ƒã€‚</span><br><span class=\"line\">  build              é»˜è®¤æ„å»ºä¸€ä¸ªåŒ…ï¼Œåˆ†åˆ«æ˜¯tarballå’Œwheelã€‚</span><br><span class=\"line\">  check              éªŒè¯pyproject.tomlæ–‡ä»¶çš„å†…å®¹åŠå…¶ä¸poetry.lockæ–‡ä»¶çš„ä¸€è‡´æ€§ã€‚</span><br><span class=\"line\">  config             ç®¡ç†é…ç½®è®¾ç½®ã€‚</span><br><span class=\"line\">  <span class=\"built_in\">export</span>             å°†é”æ–‡ä»¶å¯¼å‡ºåˆ°å…¶ä»–æ ¼å¼ã€‚</span><br><span class=\"line\">  <span class=\"built_in\">help</span>               æ˜¾ç¤ºç‰¹å®šå‘½ä»¤çš„å¸®åŠ©ã€‚</span><br><span class=\"line\">  init               åœ¨å½“å‰ç›®å½•åˆ›å»ºä¸€ä¸ªåŸºç¡€çš„pyproject.tomlæ–‡ä»¶ã€‚</span><br><span class=\"line\">  install            å®‰è£…é¡¹ç›®ä¾èµ–é¡¹ã€‚</span><br><span class=\"line\">  list               åˆ—å‡ºå‘½ä»¤ã€‚</span><br><span class=\"line\">  lock              é”å®šé¡¹ç›®ä¾èµ–é¡¹ã€‚</span><br><span class=\"line\">  new               åœ¨&lt;path&gt;å¤„åˆ›å»ºä¸€ä¸ªæ–°çš„Pythoné¡¹ç›®ã€‚</span><br><span class=\"line\">  publish           å°†åŒ…å‘å¸ƒåˆ°è¿œç¨‹ä»“åº“ã€‚</span><br><span class=\"line\">  remove            ä»é¡¹ç›®ä¾èµ–é¡¹ä¸­ç§»é™¤åŒ…ã€‚</span><br><span class=\"line\">  run                åœ¨é€‚å½“çš„ç¯å¢ƒä¸­è¿è¡Œå‘½ä»¤ã€‚</span><br><span class=\"line\">  search            åœ¨è¿œç¨‹ä»“åº“ä¸­æœç´¢åŒ…ã€‚</span><br><span class=\"line\">  shell            åœ¨è™šæ‹Ÿç¯å¢ƒä¸­å¯åŠ¨shellã€‚</span><br><span class=\"line\">  show              æ˜¾ç¤ºæœ‰å…³åŒ…çš„ä¿¡æ¯ã€‚</span><br><span class=\"line\">  update            æ ¹æ®pyproject.tomlæ–‡ä»¶æ›´æ–°ä¾èµ–é¡¹ã€‚</span><br><span class=\"line\">  version           æ˜¾ç¤ºé¡¹ç›®çš„ç‰ˆæœ¬æˆ–åœ¨æä¾›æœ‰æ•ˆç‰ˆæœ¬è§„åˆ™æ—¶æ›´æ–°å®ƒã€‚</span><br><span class=\"line\"></span><br><span class=\"line\">ç¼“å­˜</span><br><span class=\"line\">  cache clear        æŒ‰åç§°æ¸…é™¤Poetryç¼“å­˜ã€‚</span><br><span class=\"line\">  cache list         åˆ—å‡ºPoetryçš„ç¼“å­˜åˆ—è¡¨ã€‚</span><br><span class=\"line\"></span><br><span class=\"line\">è°ƒè¯•</span><br><span class=\"line\">  debug info        æ˜¾ç¤ºè°ƒè¯•ä¿¡æ¯ã€‚</span><br><span class=\"line\">  debug resolve    è°ƒè¯•ä¾èµ–é¡¹è§£æã€‚</span><br><span class=\"line\"></span><br><span class=\"line\">ç¯å¢ƒ</span><br><span class=\"line\">  <span class=\"built_in\">env</span> info         æ˜¾ç¤ºå½“å‰ç¯å¢ƒçš„ä¿¡æ¯ã€‚</span><br><span class=\"line\">  <span class=\"built_in\">env</span> list          åˆ—å‡ºä¸å½“å‰é¡¹ç›®å…³è”çš„æ‰€æœ‰è™šæ‹Ÿç¯å¢ƒã€‚</span><br><span class=\"line\">  <span class=\"built_in\">env</span> remove        ç§»é™¤ä¸é¡¹ç›®å…³è”çš„è™šæ‹Ÿç¯å¢ƒã€‚</span><br><span class=\"line\">  <span class=\"built_in\">env</span> use           æ¿€æ´»æˆ–åˆ›å»ºå½“å‰é¡¹ç›®çš„æ–°çš„è™šæ‹Ÿç¯å¢ƒã€‚</span><br><span class=\"line\"></span><br><span class=\"line\">è‡ªèº«</span><br><span class=\"line\">  self add          å‘Poetryçš„è¿è¡Œæ—¶ç¯å¢ƒæ·»åŠ å…¶ä»–åŒ…ã€‚</span><br><span class=\"line\">  self install      å®‰è£…æ­¤Poetryå®‰è£…æ‰€éœ€çš„é”å®šåŒ…ï¼ˆåŒ…æ‹¬æ’ä»¶ï¼‰ã€‚</span><br><span class=\"line\">  self lock         é”å®šPoetryå®‰è£…çš„ç³»ç»Ÿè¦æ±‚ã€‚</span><br><span class=\"line\">  self remove       ä»Poetryçš„è¿è¡Œæ—¶ç¯å¢ƒä¸­ç§»é™¤å…¶ä»–åŒ…ã€‚</span><br><span class=\"line\">  self show         æ˜¾ç¤ºPoetryè¿è¡Œæ—¶ç¯å¢ƒä¸­çš„åŒ…ã€‚</span><br><span class=\"line\">  self show plugins æ˜¾ç¤ºå½“å‰å·²å®‰è£…æ’ä»¶çš„ä¿¡æ¯ã€‚</span><br><span class=\"line\">  self update       æ›´æ–°Poetryåˆ°æœ€æ–°ç‰ˆæœ¬ã€‚</span><br><span class=\"line\"></span><br><span class=\"line\">æº</span><br><span class=\"line\">  <span class=\"built_in\">source</span> add         ä¸ºé¡¹ç›®æ·»åŠ æºé…ç½®ã€‚</span><br><span class=\"line\">  <span class=\"built_in\">source</span> remove      ç§»é™¤ä¸ºé¡¹ç›®é…ç½®çš„æºã€‚</span><br><span class=\"line\">  <span class=\"built_in\">source</span> show        æ˜¾ç¤ºä¸ºé¡¹ç›®é…ç½®çš„æºä¿¡æ¯ã€‚</span><br></pre></td></tr></table></figure>\n<h2 id=\"å¸¸ç”¨å‘½ä»¤\">å¸¸ç”¨å‘½ä»¤</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¿™é‡Œåªå¯¹æ—¥å¸¸å¼€å‘ä¸­æ¯”è¾ƒå¸¸ç”¨çš„å‘½ä»¤è¿›è¡Œç®€è¦è¯´æ˜ï¼Œè¯¦ç»†ä»‹ç»å¯ä»¥å‚è€ƒ<a href=\"https://python-poetry.org/docs/\">å®˜æ–¹æ–‡æ¡£</a></p>\n</li>\n</ul>\n<h3 id=\"new-åˆ›å»ºé¡¹ç›®\">new : åˆ›å»ºé¡¹ç›®</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æŒ‰ç…§é»˜è®¤è§„åˆ™åˆ›å»ºä¸€ä¸ªåŸºäº poetry çš„é¡¹ç›®</span></span><br><span class=\"line\">$ poetry new my-project</span><br><span class=\"line\">Created package my_project <span class=\"keyword\">in</span> my-project</span><br><span class=\"line\">$ <span class=\"built_in\">cd</span> my-project</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹ç”Ÿæˆçš„ç›®å½•ç»“æ„</span></span><br><span class=\"line\">$ exa -T</span><br><span class=\"line\">.</span><br><span class=\"line\">â”œâ”€â”€ my_project</span><br><span class=\"line\">â”‚  â””â”€â”€ __init__.py</span><br><span class=\"line\">â”œâ”€â”€ pyproject.toml</span><br><span class=\"line\">â”œâ”€â”€ README.md</span><br><span class=\"line\">â””â”€â”€ tests</span><br><span class=\"line\">   â””â”€â”€ __init__.py</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹ pyproject.toml å†…å®¹ï¼Œè¯¥æ–‡ä»¶ä¸ºé¡¹ç›®çš„é…ç½®çš„é…ç½®æ–‡ä»¶</span></span><br><span class=\"line\">$ more pyproject.toml</span><br><span class=\"line\">[tool.poetry]</span><br><span class=\"line\">name = <span class=\"string\">&quot;my-project&quot;</span></span><br><span class=\"line\">version = <span class=\"string\">&quot;0.1.0&quot;</span></span><br><span class=\"line\">description = <span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\">authors = [<span class=\"string\">&quot;hanqunfeng &lt;hanqf2008@163.com&gt;&quot;</span>]</span><br><span class=\"line\">readme = <span class=\"string\">&quot;README.md&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">[tool.poetry.dependencies]</span><br><span class=\"line\">python = <span class=\"string\">&quot;^3.11&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">[build-system]</span><br><span class=\"line\">requires = [<span class=\"string\">&quot;poetry-core&quot;</span>]</span><br><span class=\"line\">build-backend = <span class=\"string\">&quot;poetry.core.masonry.api&quot;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"init-åˆå§‹åŒ–ä¸€ä¸ªå·²æœ‰çš„é¡¹ç›®ç›®å½•\">init : åˆå§‹åŒ–ä¸€ä¸ªå·²æœ‰çš„é¡¹ç›®ç›®å½•</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å‡è®¾æˆ‘ä»¬å·²ç»æœ‰ä¸ªé¡¹ç›®ç›®å½•ï¼Œç›®å½•åç§°ä¸º poetryDemo</span></span><br><span class=\"line\">$ <span class=\"built_in\">cd</span> poetryDemo</span><br><span class=\"line\"><span class=\"comment\"># åˆå§‹åŒ– poetryDemo ï¼Œåœ¨å½“å‰ç›®å½•ä¸‹åˆ›å»º pyproject.toml æ–‡ä»¶ï¼Œæ³¨æ„è¯¥æ“ä½œåªä¼šåˆ›å»ºè¯¥æ–‡ä»¶ï¼ŒåŒ…ç›®å½•ä»¥åŠreadmeæ–‡ä»¶éƒ½æ²¡æœ‰ï¼Œéœ€è¦æ‰‹å·¥åˆ›å»º</span></span><br><span class=\"line\">$ poetry init</span><br><span class=\"line\">This <span class=\"built_in\">command</span> will guide you through creating your pyproject.toml config.</span><br><span class=\"line\"></span><br><span class=\"line\">Package name [poetrydemo]:  <span class=\"comment\"># åŒ…åç§°</span></span><br><span class=\"line\">Version [0.1.0]:  <span class=\"comment\"># ç‰ˆæœ¬å·</span></span><br><span class=\"line\">Description []:   <span class=\"comment\"># æè¿°ä¿¡æ¯</span></span><br><span class=\"line\">Author [hanqunfeng &lt;hanqf2008@163.com&gt;, n to skip]:  <span class=\"comment\"># ä½œè€…</span></span><br><span class=\"line\">License []:  <span class=\"comment\"># License</span></span><br><span class=\"line\">Compatible Python versions [^3.11]:  <span class=\"comment\"># python ç‰ˆæœ¬</span></span><br><span class=\"line\"></span><br><span class=\"line\">Would you like to define your main dependencies interactively? (<span class=\"built_in\">yes</span>/no) [<span class=\"built_in\">yes</span>] <span class=\"comment\"># æ‚¨æƒ³ä»¥äº¤äº’æ–¹å¼å®šä¹‰æ‚¨çš„ä¸»ç¯å¢ƒä¾èµ–å…³ç³»å—ï¼Ÿé»˜è®¤yes</span></span><br><span class=\"line\">You can specify a package <span class=\"keyword\">in</span> the following forms:  <span class=\"comment\"># æ‚¨å¯ä»¥æŒ‰ä»¥ä¸‹å½¢å¼æŒ‡å®šåŒ…ï¼š</span></span><br><span class=\"line\">  - A single name (requests): this will search <span class=\"keyword\">for</span> matches on PyPI <span class=\"comment\"># å•ä¸ªåç§°ï¼ˆrequestsï¼‰ï¼šè¿™å°†åœ¨å®˜æ–¹ä»“åº“PyPIä¸Šæœç´¢åŒ¹é…é¡¹ï¼Œå¦‚æœæŒ‡å®šäº†å…¶å®ƒé•œåƒæºå°±ä¼šä»æŒ‡å®šçš„æºä¸‹è½½</span></span><br><span class=\"line\">  - A name and a constraint (requests@^2.23.0) <span class=\"comment\"># åç§°å’Œç‰ˆæœ¬çº¦æŸ</span></span><br><span class=\"line\">  - A git url (git+https://github.com/python-poetry/poetry.git) <span class=\"comment\"># gitåœ°å€</span></span><br><span class=\"line\">  - A git url with a revision (git+https://github.com/python-poetry/poetry.git#develop) <span class=\"comment\"># gitåœ°å€ï¼ŒæŒ‡å®šæŸä¸ªåˆ†æ”¯</span></span><br><span class=\"line\">  - A file path (../my-package/my-package.whl) <span class=\"comment\"># æ–‡ä»¶è·¯å¾„</span></span><br><span class=\"line\">  - A directory (../my-package/) <span class=\"comment\"># ç›®å½•è·¯å¾„</span></span><br><span class=\"line\">  - A url (https://example.com/packages/my-package-0.1.0.tar.gz) <span class=\"comment\"># ä¸€ä¸ªå®‰è£…åŒ…çš„åœ°å€</span></span><br><span class=\"line\"></span><br><span class=\"line\">Package to add or search <span class=\"keyword\">for</span> (leave blank to skip): <span class=\"comment\"># æ·»åŠ ä¸»ç¯å¢ƒä¾èµ–ï¼ŒæŒ‰ä¸Šé¢çš„æ ¼å¼è¦æ±‚å¡«å†™</span></span><br><span class=\"line\"></span><br><span class=\"line\">Would you like to define your development dependencies interactively? (<span class=\"built_in\">yes</span>/no) [<span class=\"built_in\">yes</span>] <span class=\"comment\"># æ‚¨æƒ³ä»¥äº¤äº’æ–¹å¼å®šä¹‰æ‚¨çš„å¼€å‘ä¾èµ–å…³ç³»å—ï¼Ÿé»˜è®¤yes</span></span><br><span class=\"line\">Package to add or search <span class=\"keyword\">for</span> (leave blank to skip): <span class=\"comment\"># æ·»åŠ å¼€å‘ç¯å¢ƒä¾èµ–ï¼ŒæŒ‰ä¸Šé¢çš„æ ¼å¼è¦æ±‚å¡«å†™</span></span><br><span class=\"line\"></span><br><span class=\"line\">Generated file</span><br><span class=\"line\"><span class=\"comment\"># è¦ç”Ÿæˆçš„ pyproject.toml å†…å®¹</span></span><br><span class=\"line\">[tool.poetry]</span><br><span class=\"line\">name = <span class=\"string\">&quot;poetrydemo&quot;</span>  <span class=\"comment\"># åŒ…åç§°</span></span><br><span class=\"line\">version = <span class=\"string\">&quot;0.1.0&quot;</span>    <span class=\"comment\"># ç‰ˆæœ¬</span></span><br><span class=\"line\">description = <span class=\"string\">&quot;&quot;</span>     <span class=\"comment\"># æè¿°ä¿¡æ¯</span></span><br><span class=\"line\">authors = [<span class=\"string\">&quot;hanqunfeng &lt;hanqf2008@163.com&gt;&quot;</span>] <span class=\"comment\"># ä½œè€…ä¿¡æ¯</span></span><br><span class=\"line\">readme = <span class=\"string\">&quot;README.md&quot;</span> <span class=\"comment\"># è¯´æ˜æ–‡ä»¶</span></span><br><span class=\"line\"></span><br><span class=\"line\">[tool.poetry.dependencies] <span class=\"comment\"># ä¸»ç¯å¢ƒä¾èµ–</span></span><br><span class=\"line\">python = <span class=\"string\">&quot;^3.11&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">[build-system]</span><br><span class=\"line\">requires = [<span class=\"string\">&quot;poetry-core&quot;</span>]</span><br><span class=\"line\">build-backend = <span class=\"string\">&quot;poetry.core.masonry.api&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">Do you confirm generation? (<span class=\"built_in\">yes</span>/no) [<span class=\"built_in\">yes</span>] <span class=\"comment\"># ç¡®è®¤æ˜¯å¦æŒ‰ç…§ä¸Šé¢çš„å†…å®¹åˆ›å»º pyproject.toml æ–‡ä»¶ï¼Œé»˜è®¤yes</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¸Šé¢çš„æ–¹å¼åœ¨åˆå§‹åŒ–æ—¶ä¼šè¯¢é—®ä½ ç›¸å…³çš„ä¿¡æ¯ï¼Œå¦‚æœä½ å¸Œæœ›éƒ½ç”¨é»˜è®¤å€¼çš„è¯ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">poetry init -n</span><br></pre></td></tr></table></figure>\n<h3 id=\"config-poetryçš„å…¨å±€é…ç½®\">config : poetryçš„å…¨å±€é…ç½®</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æŸ¥çœ‹å…¨å±€é…ç½®</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ poetry config --list</span><br><span class=\"line\">cache-dir = <span class=\"string\">&quot;/Users/hanqf/Library/Caches/pypoetry&quot;</span>  <span class=\"comment\"># ç¼“å­˜ç›®å½•,ç”¨äºå­˜å‚¨é¡¹ç›®ä¾èµ–å’Œè™šæ‹Ÿç¯å¢ƒç­‰ç¼“å­˜ä¿¡æ¯ã€‚</span></span><br><span class=\"line\">experimental.system-git-client = <span class=\"literal\">false</span>              <span class=\"comment\"># æ˜¯å¦ä½¿ç”¨ç³»ç»Ÿè‡ªå¸¦çš„gitå®¢æˆ·ç«¯,falseè¡¨ç¤ºä½¿ç”¨Poetryå†…ç½®çš„gitå®¢æˆ·ç«¯</span></span><br><span class=\"line\">installer.max-workers = null                        <span class=\"comment\"># å®‰è£…ä¾èµ–æ—¶çš„æœ€å¤§çº¿ç¨‹æ•°,nullè¡¨ç¤ºä½¿ç”¨é»˜è®¤çº¿ç¨‹æ•°ï¼Œå¯ä»¥è®¾ç½®ä¸ºcpuæ ¸æ•°+4</span></span><br><span class=\"line\">installer.modern-installation = <span class=\"literal\">true</span>                <span class=\"comment\"># æ˜¯å¦ä½¿ç”¨Poetryçš„ç°ä»£å®‰è£…æ–¹æ¡ˆ,trueè¡¨ç¤ºä½¿ç”¨</span></span><br><span class=\"line\">installer.no-binary = null                          <span class=\"comment\"># æ˜¯å¦ä¸ä½¿ç”¨é¢„ç¼–è¯‘çš„äºŒè¿›åˆ¶åŒ…,nullè¡¨ç¤ºä¸é™åˆ¶</span></span><br><span class=\"line\">installer.parallel = <span class=\"literal\">true</span>                           <span class=\"comment\"># æ˜¯å¦å¹¶è¡Œå®‰è£…ä¾èµ–,trueè¡¨ç¤ºå¹¶è¡Œå®‰è£…</span></span><br><span class=\"line\">keyring.enabled = <span class=\"literal\">true</span>                              <span class=\"comment\"># æ˜¯å¦å¯ç”¨å¯†é’¥ç¯ï¼ˆkeyringï¼‰ä»¥ä¿å­˜è®¤è¯ä¿¡æ¯ã€‚true è¡¨ç¤ºå¯ç”¨ã€‚</span></span><br><span class=\"line\">solver.lazy-wheel = <span class=\"literal\">true</span>                            <span class=\"comment\"># æ˜¯å¦å»¶è¿Ÿè§£æ wheel åŒ…ã€‚true è¡¨ç¤ºå»¶è¿Ÿè§£æã€‚</span></span><br><span class=\"line\">virtualenvs.create = <span class=\"literal\">true</span>                           <span class=\"comment\"># æ˜¯å¦è‡ªåŠ¨åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ,trueè¡¨ç¤ºåˆ›å»º</span></span><br><span class=\"line\">virtualenvs.in-project = null                       <span class=\"comment\"># æ˜¯å¦åœ¨é¡¹ç›®å†…åˆ›å»ºè™šæ‹Ÿç¯å¢ƒï¼Œnull è¡¨ç¤ºä½¿ç”¨é»˜è®¤å€¼ï¼ˆé€šå¸¸ä¸º falseï¼‰ï¼Œå³ä¸åœ¨é¡¹ç›®ä¸­åˆ›å»ºã€‚trueè¡¨ç¤ºåœ¨é¡¹ç›®ä¸­åˆ›å»º</span></span><br><span class=\"line\">virtualenvs.options.always-copy = <span class=\"literal\">false</span>             <span class=\"comment\"># å¦‚æœè®¾ç½®ä¸º trueï¼ŒPoetry ä¼šå§‹ç»ˆå¤åˆ¶æ–‡ä»¶åˆ°è™šæ‹Ÿç¯å¢ƒä¸­ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ç¬¦å·é“¾æ¥ï¼ˆsymlinksï¼‰ã€‚è¿™å¯ä»¥é¿å…æŸäº›ç³»ç»Ÿä¸Šçš„æƒé™é—®é¢˜ï¼Œä½†ä¼šå¢åŠ è™šæ‹Ÿç¯å¢ƒçš„å­˜å‚¨éœ€æ±‚ã€‚</span></span><br><span class=\"line\">virtualenvs.options.no-pip = <span class=\"literal\">false</span>                  <span class=\"comment\"># å¦‚æœè®¾ç½®ä¸º trueï¼ŒPoetry åœ¨åˆ›å»ºè™šæ‹Ÿç¯å¢ƒæ—¶ä¸ä¼šå®‰è£… pipã€‚å¦‚æœä½ çš„é¡¹ç›®ä¸éœ€è¦ç›´æ¥ä½¿ç”¨ pipï¼Œå¹¶ä¸”ä½ å¸Œæœ›é€šè¿‡ Poetry ç®¡ç†æ‰€æœ‰çš„ä¾èµ–é¡¹ï¼Œå¯ä»¥å°† no-pip è®¾ç½®ä¸º trueï¼Œä»¥å‡å°‘è™šæ‹Ÿç¯å¢ƒä¸­çš„ä¸å¿…è¦çš„ä¾èµ–é¡¹ã€‚</span></span><br><span class=\"line\">virtualenvs.options.no-setuptools = <span class=\"literal\">false</span>           <span class=\"comment\"># å¦‚æœè®¾ç½®ä¸º trueï¼ŒPoetry åœ¨åˆ›å»ºè™šæ‹Ÿç¯å¢ƒæ—¶ä¸ä¼šå®‰è£… setuptoolsã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒPoetry ä¼šå®‰è£… pip å’Œ setuptoolsï¼Œä»¥ä¾¿ä½ å¯ä»¥ä½¿ç”¨è¿™äº›å·¥å…·æ¥ç®¡ç†ä¾èµ–é¡¹ã€‚</span></span><br><span class=\"line\">virtualenvs.options.system-site-packages = <span class=\"literal\">false</span>    <span class=\"comment\"># é»˜è®¤å€¼falseï¼Œæ­¤æ—¶ Poetry åˆ›å»ºçš„è™šæ‹Ÿç¯å¢ƒå°†ä¸ä¼šåŒ…å«å…¨å±€ Python å®‰è£…çš„ site-packages ç›®å½•ä¸­çš„åŒ…ã€‚è¿™æœ‰åŠ©äºç¡®ä¿é¡¹ç›®ä¾èµ–é¡¹çš„éš”ç¦»æ€§ï¼Œé¿å…ä¸ç³»ç»Ÿä¸­çš„å…¶ä»–åŒ…å‘ç”Ÿå†²çªã€‚</span></span><br><span class=\"line\">virtualenvs.path = <span class=\"string\">&quot;&#123;cache-dir&#125;/virtualenvs&quot;</span>  <span class=\"comment\"># /Users/hanqf/Library/Caches/pypoetry/virtualenvs # è™šæ‹Ÿç¯å¢ƒå­˜æ”¾çš„è·¯å¾„ï¼Œå¦‚æœvirtualenvs.in-projectè®¾ç½®ä¸ºtrueï¼Œå°±åªä¼šåœ¨é¡¹ç›®ä¸­åˆ›å»º</span></span><br><span class=\"line\">virtualenvs.prefer-active-python = <span class=\"literal\">false</span>            <span class=\"comment\"># æ˜¯å¦ä¼˜å…ˆä½¿ç”¨ç³»ç»Ÿæ¿€æ´»çš„Pythonè§£é‡Šå™¨</span></span><br><span class=\"line\">virtualenvs.prompt = <span class=\"string\">&quot;&#123;project_name&#125;-py&#123;python_version&#125;&quot;</span>  <span class=\"comment\"># è™šæ‹Ÿç¯å¢ƒçš„å‘½ä»¤æç¤ºæ ¼å¼</span></span><br><span class=\"line\">warnings.export = <span class=\"literal\">true</span>                              <span class=\"comment\"># æ˜¯å¦åœ¨å¯¼å‡ºæ—¶æ˜¾ç¤ºè­¦å‘Šä¿¡æ¯ã€‚true è¡¨ç¤ºæ˜¾ç¤º</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¿®æ”¹å…¨å±€é…ç½®</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ä¿®æ”¹å…¨å±€é…ç½®ï¼Œæ­¤åä¼šåœ¨é¡¹ç›®ç›®å½•ä¸‹åˆ›å»º .venv ç›®å½•å­˜æ”¾è™šæ‹Ÿç¯å¢ƒ</span></span><br><span class=\"line\">$ poetry config virtualenvs.in-project <span class=\"literal\">true</span></span><br><span class=\"line\"><span class=\"comment\"># è¿›å…¥è™šæ‹Ÿç¯å¢ƒï¼Œå¦‚æœè™šæ‹Ÿç¯å¢ƒå°šæœªåˆ›å»ºä¼šè‡ªåŠ¨åˆ›å»º</span></span><br><span class=\"line\">$ poetry shell</span><br><span class=\"line\"><span class=\"comment\"># é€€å‡ºè™šæ‹Ÿç¯å¢ƒ</span></span><br><span class=\"line\">$ <span class=\"built_in\">exit</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åªå¯¹å½“å‰é¡¹ç›®æœ‰æ•ˆï¼Œæ­¤æ—¶ä¼šåœ¨å½“å‰é¡¹ç›®ç›®å½•ä¸‹åˆ›å»º poetry.toml æ¥ä¿å­˜è¿™äº›é…ç½®ä¿¡æ¯</span></span><br><span class=\"line\">$ poetry config virtualenvs.in-project <span class=\"literal\">true</span> --<span class=\"built_in\">local</span></span><br><span class=\"line\">$ poetry config virtualenvs.options.system-site-packages <span class=\"literal\">true</span> --<span class=\"built_in\">local</span></span><br><span class=\"line\">$ more poetry.toml</span><br><span class=\"line\">[virtualenvs]</span><br><span class=\"line\">in-project = <span class=\"literal\">true</span></span><br><span class=\"line\">[virtualenvs.options]</span><br><span class=\"line\">system-site-packages = <span class=\"literal\">true</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># è¿™é‡Œè¦æ³¨æ„ virtualenvs ä¸‹çš„å±æ€§å¿…é¡»åœ¨åˆ›å»ºè™šæ‹Ÿç¯å¢ƒå‰è®¾ç½®æ‰ä¼šæœ‰æ•ˆ</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"env-è™šæ‹Ÿç¯å¢ƒç®¡ç†\">env : è™šæ‹Ÿç¯å¢ƒç®¡ç†</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Poetry ä¼šåœ¨ä½ ç¬¬ä¸€æ¬¡è¿è¡ŒæŸäº›å‘½ä»¤ï¼ˆå¦‚ <code>poetry shell</code> æˆ–è€… <code>poetry add somepackage</code>ï¼‰æ—¶è‡ªåŠ¨åˆ›å»ºè™šæ‹Ÿç¯å¢ƒã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä¸è¿‡è¿™ç§æ—¶å€™éƒ½æ˜¯ä½¿ç”¨ç³»ç»Ÿé»˜è®¤çš„pythonæ¥åˆ›å»ºè™šæ‹Ÿç¯å¢ƒï¼Œå¦‚æœç³»ç»Ÿä¸­å®‰è£…äº†å¤šä¸ªpythonï¼Œåˆ™å¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹å¼è®¾ç½®è™šæ‹Ÿç¯å¢ƒè¦ä½¿ç”¨å“ªä¸ªpythonç‰ˆæœ¬</p>\n</li>\n<li class=\"lvl-2\">\n<p>åˆ›å»º/åˆ‡æ¢è™šæ‹Ÿç¯å¢ƒ</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æŒ‡å®špythonçš„ç‰ˆæœ¬ï¼Œè¿™ä¼šä»pythonçš„é»˜è®¤å®‰è£…è·¯å¾„ä¸‹æŸ¥æ‰¾å¯¹åº”çš„ç‰ˆæœ¬</span></span><br><span class=\"line\"><span class=\"comment\"># æ¯”å¦‚macOsä¼šä»è¯¥è·¯å¾„ä¸‹æŸ¥æ‰¾ï¼š/Library/Frameworks/Python.framework/Versions</span></span><br><span class=\"line\">$ poetry <span class=\"built_in\">env</span> use 3.11</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å¦‚æœå¯ä»¥ç›´æ¥åœ¨å‘½ä»¤è¡Œä½¿ç”¨pythonå‘½ä»¤,æ¯”å¦‚ï¼špython3.12 -Vï¼Œåˆ™å¯ä»¥ä½¿ç”¨å¦‚ä¸‹æ–¹å¼åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ</span></span><br><span class=\"line\">$ poetry <span class=\"built_in\">env</span> use python3.12</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å¦‚æœpythonå®‰è£…åˆ°äº†å…¶å®ƒè·¯å¾„ï¼Œå¯ä»¥æŒ‡å®špythonå®‰è£…è·¯å¾„</span></span><br><span class=\"line\">$ poetry <span class=\"built_in\">env</span> use /pythonDir/3.13/bin/python3</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æŸ¥çœ‹å½“å‰é¡¹ç›®çš„è™šæ‹Ÿç¯å¢ƒä¿¡æ¯</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åˆ›å»ºä¸€ä¸ªåŸºäº python3.13 çš„è™šæ‹Ÿç¯å¢ƒ</span></span><br><span class=\"line\">$ poetry <span class=\"built_in\">env</span> use python3.13</span><br><span class=\"line\">Creating virtualenv poetrydemo-fyqYbfje-py3.13 <span class=\"keyword\">in</span> /Users/hanqf/Library/Caches/pypoetry/virtualenvs</span><br><span class=\"line\">Using virtualenv: /Users/hanqf/Library/Caches/pypoetry/virtualenvs/poetrydemo-fyqYbfje-py3.13</span><br><span class=\"line\"><span class=\"comment\"># å†åˆ›å»ºä¸€ä¸ªåŸºäº python3.11 çš„è™šæ‹Ÿç¯å¢ƒï¼Œæœ€åè¢«useçš„å¤„äºé»˜è®¤æ¿€æ´»çŠ¶æ€</span></span><br><span class=\"line\">$ poetry <span class=\"built_in\">env</span> use python3.11</span><br><span class=\"line\">Creating virtualenv poetrydemo-fyqYbfje-py3.11 <span class=\"keyword\">in</span> /Users/hanqf/Library/Caches/pypoetry/virtualenvs</span><br><span class=\"line\">Using virtualenv: /Users/hanqf/Library/Caches/pypoetry/virtualenvs/poetrydemo-fyqYbfje-py3.11</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹å½“å‰é¡¹ç›®æœ‰å¤šå°‘ä¸ªè™šæ‹Ÿç¯å¢ƒ</span></span><br><span class=\"line\">$ poetry <span class=\"built_in\">env</span> list</span><br><span class=\"line\">poetrydemo-fyqYbfje-py3.11 (Activated) <span class=\"comment\"># poetrydemo-fyqYbfje-py3.11 è¡¨ç¤ºè™šæ‹Ÿç¯å¢ƒåç§°ï¼ŒActivatedè¡¨ç¤ºå½“å‰è™šæ‹Ÿç¯å¢ƒå·²ç»è¢«æ¿€æ´»</span></span><br><span class=\"line\">poetrydemo-fyqYbfje-py3.13</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹è™šæ‹ŸåŒ–ç¯å¢ƒè·¯å¾„</span></span><br><span class=\"line\">$ poetry <span class=\"built_in\">env</span> list  --full-path</span><br><span class=\"line\">/Users/hanqf/Library/Caches/pypoetry/virtualenvs/poetrydemo-fyqYbfje-py3.11 (Activated)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹å½“å‰æ¿€æ´»çš„è™šæ‹Ÿç¯å¢ƒä¿¡æ¯</span></span><br><span class=\"line\">$ poetry <span class=\"built_in\">env</span> info</span><br><span class=\"line\"></span><br><span class=\"line\">Virtualenv</span><br><span class=\"line\">Python:         3.11.3</span><br><span class=\"line\">Implementation: CPython</span><br><span class=\"line\">Path:           /Users/hanqf/Library/Caches/pypoetry/virtualenvs/poetrydemo-fyqYbfje-py3.11</span><br><span class=\"line\">Executable:     /Users/hanqf/Library/Caches/pypoetry/virtualenvs/poetrydemo-fyqYbfje-py3.11/bin/python</span><br><span class=\"line\">Valid:          True</span><br><span class=\"line\"></span><br><span class=\"line\">Base</span><br><span class=\"line\">Platform:   darwin</span><br><span class=\"line\">OS:         posix</span><br><span class=\"line\">Python:     3.11.3</span><br><span class=\"line\">Path:       /Library/Frameworks/Python.framework/Versions/3.11</span><br><span class=\"line\">Executable: /Library/Frameworks/Python.framework/Versions/3.11/bin/python3.11</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åˆ é™¤è™šæ‹Ÿç¯å¢ƒ</span></span><br><span class=\"line\">$ poetry <span class=\"built_in\">env</span> remove python3.13</span><br><span class=\"line\">Deleted virtualenv: /Users/hanqf/Library/Caches/pypoetry/virtualenvs/poetrydemo-fyqYbfje-py3.13</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åˆ é™¤å…¨éƒ¨è™šæ‹Ÿç¯å¢ƒ</span></span><br><span class=\"line\">$ poetry <span class=\"built_in\">env</span> remove --all</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ³¨æ„ï¼Œå½“<code>virtualenvs.in-project</code>è¢«è®¾ç½®ä¸º<code>true</code>æ—¶ï¼Œå³åªåœ¨é¡¹ç›®ç›®å½•ä¸‹åˆ›å»ºè™šæ‹Ÿç¯å¢ƒæ—¶ï¼Œåªä¼šä¿ç•™ä¸€ä¸ªç¯å¢ƒï¼Œå³<code>.venv</code></p>\n</li>\n<li class=\"lvl-2\">\n<p>åˆ‡æ¢åˆ°æ–°çš„è™šæ‹Ÿç¯å¢ƒæ—¶ä¼šå…¨æ–°åˆ›å»ºä¸€ä¸ªæ–°çš„ç¯å¢ƒï¼ŒåŸå…ˆçš„ç¯å¢ƒä¼šè¢«åˆ é™¤ï¼Œæ‰€ä»¥è¦ä½¿ç”¨<code>poetry install</code>å‘½ä»¤é‡æ–°å®‰è£…ä¾èµ–</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">$ poetry <span class=\"built_in\">env</span> use python3.11</span><br><span class=\"line\">Recreating virtualenv poetrydemo <span class=\"keyword\">in</span> /Users/hanqf/Desktop/pythonDir/poetryDir/poetryDemo/.venv</span><br><span class=\"line\">Using virtualenv: /Users/hanqf/Desktop/pythonDir/poetryDir/poetryDemo/.venv</span><br><span class=\"line\"></span><br><span class=\"line\">$ poetry <span class=\"built_in\">env</span> list <span class=\"comment\"># è™½ç„¶å¯ä»¥é€šè¿‡ poetry env use çš„æ–¹å¼æ¥åˆ›å»ºæ–°çš„è™šæ‹Ÿç¯å¢ƒï¼Œä½†å®é™…ä¸Šåªä¼šæœ‰ä¸€ä¸ªç¯å¢ƒè¢«ä¿ç•™ï¼Œæ‰€ä»¥è¿™é‡Œåªä¼šæ˜¾ç¤ºä¸€ä¸ª</span></span><br><span class=\"line\">.venv (Activated) <span class=\"comment\"># .venv è¡¨ç¤ºè™šæ‹Ÿç¯å¢ƒåç§°ï¼ŒActivatedè¡¨ç¤ºå½“å‰è™šæ‹Ÿç¯å¢ƒå·²ç»è¢«æ¿€æ´»</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹è™šæ‹Ÿç¯å¢ƒä¿¡æ¯</span></span><br><span class=\"line\">$ poetry <span class=\"built_in\">env</span> info</span><br><span class=\"line\"></span><br><span class=\"line\">Virtualenv</span><br><span class=\"line\">Python:         3.11.3</span><br><span class=\"line\">Implementation: CPython</span><br><span class=\"line\">Path:           /Users/hanqf/Desktop/pythonDir/poetryDir/poetryDemo/.venv</span><br><span class=\"line\">Executable:     /Users/hanqf/Desktop/pythonDir/poetryDir/poetryDemo/.venv/bin/python</span><br><span class=\"line\">Valid:          True</span><br><span class=\"line\"></span><br><span class=\"line\">Base</span><br><span class=\"line\">Platform:   darwin</span><br><span class=\"line\">OS:         posix</span><br><span class=\"line\">Python:     3.11.3</span><br><span class=\"line\">Path:       /Library/Frameworks/Python.framework/Versions/3.11</span><br><span class=\"line\">Executable: /Library/Frameworks/Python.framework/Versions/3.11/bin/python3.11</span><br></pre></td></tr></table></figure>\n<h3 id=\"ä¾èµ–åŒ…ç®¡ç†\">ä¾èµ–åŒ…ç®¡ç†</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>add : å®‰è£…ä¾èµ–åŒ…</p>\n</li>\n</ul>\n<blockquote>\n<p>è¿™ä¸ªå‘½ä»¤ä¼šä¿®æ”¹ pyproject.toml æ–‡ä»¶ï¼Œåœ¨ [tool.poetry.dependencies] éƒ¨åˆ†æ·»åŠ æ–°çš„ä¾èµ–é¡¹ã€‚è¿˜ä¼šè‡ªåŠ¨æ›´æ–° poetry.lock æ–‡ä»¶ï¼Œé”å®šä¾èµ–çš„ç¡®åˆ‡ç‰ˆæœ¬ã€‚</p>\n</blockquote>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å®‰è£…ä¾èµ–ï¼Œå®‰è£…åä¼šå°†ä¾èµ–ä¿¡æ¯å†™å…¥ pyproject.toml ä¸­</span></span><br><span class=\"line\"><span class=\"comment\"># ä¸æŒ‡å®šç‰ˆæœ¬åˆ™å®‰è£…æœ€æ–°ç‰ˆ</span></span><br><span class=\"line\">$ poetry add fastapi</span><br><span class=\"line\">Using version ^0.115.5 <span class=\"keyword\">for</span> fastapi</span><br><span class=\"line\"></span><br><span class=\"line\">Updating dependencies</span><br><span class=\"line\">Resolving dependencies... (1.3s)</span><br><span class=\"line\"></span><br><span class=\"line\">Package operations: 9 installs, 0 updates, 0 removals</span><br><span class=\"line\"></span><br><span class=\"line\">  - Installing idna (3.10)</span><br><span class=\"line\">  - Installing sniffio (1.3.1)</span><br><span class=\"line\">  - Installing typing-extensions (4.12.2)</span><br><span class=\"line\">  - Installing annotated-types (0.7.0)</span><br><span class=\"line\">  - Installing anyio (4.6.2.post1)</span><br><span class=\"line\">  - Installing pydantic-core (2.23.4)</span><br><span class=\"line\">  - Installing pydantic (2.9.2)</span><br><span class=\"line\">  - Installing starlette (0.41.3)</span><br><span class=\"line\">  - Installing fastapi (0.115.5)</span><br><span class=\"line\"></span><br><span class=\"line\">Writing lock file</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŒ‡å®šç‰ˆæœ¬å·å®‰è£…ä¾èµ–</span></span><br><span class=\"line\">poetry add package_name@^1.2.3</span><br><span class=\"line\">    <span class=\"comment\"># è§„åˆ™è¯´æ˜</span></span><br><span class=\"line\">    ^1.2.3 è¡¨ç¤ºå…¼å®¹ 1.2.3 åŠæ›´é«˜çš„å°ç‰ˆæœ¬ï¼Œä½†ä¸åŒ…æ‹¬ 2.0.0ã€‚    å¦‚ï¼špoetry add requests@^2.28.0</span><br><span class=\"line\">    ~1.2.3ï¼šå…è®¸å‡çº§åˆ° 1.2.xï¼Œä½†ä¸åŒ…æ‹¬ 1.3.0ã€‚               å¦‚ï¼špoetry add requests@~2.28.0</span><br><span class=\"line\">    1.2.3ï¼šå›ºå®šä¸º 1.2.3ã€‚                                   å¦‚ï¼špoetry add requests@2.28.0</span><br><span class=\"line\">    &gt;=1.2.3ï¼šå…è®¸ä½¿ç”¨ 1.2.3 åŠä»¥ä¸Šç‰ˆæœ¬ã€‚æ³¨æ„zshä¸‹è¦åŠ ä¸ŠåŒå¼•å·ï¼Œå¦‚ï¼špoetry add <span class=\"string\">&quot;requests@&gt;=2.28.0&quot;</span></span><br><span class=\"line\">    &lt;2.0.0ï¼šå…è®¸ä½¿ç”¨å°äº 2.0.0 çš„ç‰ˆæœ¬ã€‚ æ³¨æ„zshä¸‹è¦åŠ ä¸ŠåŒå¼•å·ï¼Œå¦‚ï¼špoetry add <span class=\"string\">&quot;requests@&lt;3.0.0&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å®‰è£…åˆ°æŒ‡å®šçš„åˆ†ç»„ï¼Œé»˜è®¤éƒ½æ˜¯å®‰è£…åˆ°ä¸»ç¯å¢ƒä¸­çš„ï¼Œpoetry buildé»˜è®¤åªä¼šæ‰“åŒ…ä¸»ç¯å¢ƒçš„ä¾èµ–</span></span><br><span class=\"line\">poetry add flask <span class=\"comment\"># å®‰è£…åˆ°ä¸»ç¯å¢ƒä¸­</span></span><br><span class=\"line\">poetry add flask --group=<span class=\"built_in\">test</span> <span class=\"comment\">#æ·»åŠ åˆ†ç»„å test</span></span><br><span class=\"line\">poetry add flask --dev  <span class=\"comment\">#ç›¸å½“äº--group=dev</span></span><br><span class=\"line\"><span class=\"comment\"># åˆ†åˆ«æ‰§è¡Œä¸Šé¢3ä¸ªå®‰è£…å‘½ä»¤åï¼Œè¾“å‡º pyproject.toml çš„å†…å®¹å¦‚ä¸‹</span></span><br><span class=\"line\">[tool.poetry]</span><br><span class=\"line\">name = <span class=\"string\">&quot;poetrydemo&quot;</span></span><br><span class=\"line\">version = <span class=\"string\">&quot;0.1.0&quot;</span></span><br><span class=\"line\">description = <span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\">authors = [<span class=\"string\">&quot;hanqunfeng &lt;hanqf2008@163.com&gt;&quot;</span>]</span><br><span class=\"line\">readme = <span class=\"string\">&quot;README.md&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">[tool.poetry.dependencies] <span class=\"comment\"># ä¸»ç¯å¢ƒ</span></span><br><span class=\"line\">python = <span class=\"string\">&quot;^3.11&quot;</span></span><br><span class=\"line\">flask = <span class=\"string\">&quot;^3.1.0&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">[tool.poetry.group.test.dependencies] <span class=\"comment\"># teståˆ†ç»„ä¾èµ–</span></span><br><span class=\"line\">flask = <span class=\"string\">&quot;^3.1.0&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">[tool.poetry.group.dev.dependencies] <span class=\"comment\"># devåˆ†ç»„ä¾èµ–</span></span><br><span class=\"line\">flask = <span class=\"string\">&quot;^3.1.0&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">[build-system]</span><br><span class=\"line\">requires = [<span class=\"string\">&quot;poetry-core&quot;</span>]</span><br><span class=\"line\">build-backend = <span class=\"string\">&quot;poetry.core.masonry.api&quot;</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>show : æŸ¥çœ‹ä¾èµ–åŒ…</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹å½“å‰é¡¹ç›®éƒ½éœ€è¦å“ªäº›ä¾èµ–ï¼Œè¿™äº›ä¾èµ–ä¸ä¸€å®šéƒ½å®‰è£…äº†ï¼Œå®ƒåªæ˜¯è§£æ pyproject.toml ä¸­çš„å£°æ˜æ¥è§£æä¾èµ–æ ‘</span></span><br><span class=\"line\">$ poetry show</span><br><span class=\"line\">annotated-types   0.7.0       Reusable constraint types to use with typing.Annotated</span><br><span class=\"line\">anyio             4.6.2.post1 High level compatibility layer <span class=\"keyword\">for</span> multiple asynchronous ...</span><br><span class=\"line\">fastapi           0.115.5     FastAPI framework, high performance, easy to learn, fast ...</span><br><span class=\"line\">idna              3.10        Internationalized Domain Names <span class=\"keyword\">in</span> Applications (IDNA)</span><br><span class=\"line\">pydantic          2.9.2       Data validation using Python <span class=\"built_in\">type</span> hints</span><br><span class=\"line\">pydantic-core     2.23.4      Core functionality <span class=\"keyword\">for</span> Pydantic validation and serialization</span><br><span class=\"line\">sniffio           1.3.1       Sniff out <span class=\"built_in\">which</span> async library your code is running under</span><br><span class=\"line\">starlette         0.41.3      The little ASGI library that shines.</span><br><span class=\"line\">typing-extensions 4.12.2      Backported and Experimental Type Hints <span class=\"keyword\">for</span> Python 3.8+</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åªæŸ¥çœ‹é¡¶çº§ä¾èµ–ï¼Œå³åªæŸ¥çœ‹åœ¨ pyproject.toml ä¸­å£°æ˜çš„ä¾èµ–</span></span><br><span class=\"line\">$ poetry show --top-level</span><br><span class=\"line\">fastapi           0.115.5     FastAPI framework, high performance, easy to learn, fast ...</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>remove : åˆ é™¤ä¾èµ–åŒ…</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åˆ é™¤ä¾èµ–ï¼Œæ­¤æ—¶ä¼šå°†å½“å‰åŒ…åŠå…¶æ‰€æœ‰ä¾èµ–ä¸€å—åˆ é™¤</span></span><br><span class=\"line\">$ poetry remove fastapi</span><br><span class=\"line\">Updating dependencies</span><br><span class=\"line\">Resolving dependencies... (0.1s)</span><br><span class=\"line\"></span><br><span class=\"line\">Package operations: 0 installs, 0 updates, 9 removals</span><br><span class=\"line\"></span><br><span class=\"line\">  - Removing annotated-types (0.7.0)</span><br><span class=\"line\">  - Removing anyio (4.6.2.post1)</span><br><span class=\"line\">  - Removing fastapi (0.115.5)</span><br><span class=\"line\">  - Removing idna (3.10)</span><br><span class=\"line\">  - Removing pydantic (2.9.2)</span><br><span class=\"line\">  - Removing pydantic-core (2.23.4)</span><br><span class=\"line\">  - Removing sniffio (1.3.1)</span><br><span class=\"line\">  - Removing starlette (0.41.3)</span><br><span class=\"line\">  - Removing typing-extensions (4.12.2)</span><br><span class=\"line\"></span><br><span class=\"line\">Writing lock file</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>search : æœç´¢è¿œç¨‹ä»“åº“</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æœç´¢è¿œç¨‹ä»“åº“</span></span><br><span class=\"line\">$ poetry search fastapi</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>install å’Œ update : å®‰è£…å’Œæ›´æ–°ä¾èµ–åŒ…<br>\n<em><strong>åœ¨ Poetry ä¸­ï¼Œinstall å’Œ update æ˜¯ä¸¤ä¸ªå¸¸ç”¨çš„å‘½ä»¤ï¼Œä½†å®ƒä»¬çš„ä½œç”¨å’Œä½¿ç”¨åœºæ™¯ä¸åŒ</strong></em></p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-7\">\n<p><code>poetry install</code> çš„ä½œç”¨æ˜¯æ ¹æ®ç°æœ‰çš„ poetry.lock æ–‡ä»¶æ¥å®‰è£…ä¾èµ–ï¼Œç¡®ä¿å®‰è£…çš„ä¾èµ–ç‰ˆæœ¬ä¸é”æ–‡ä»¶ä¸­è®°å½•çš„ç‰ˆæœ¬å®Œå…¨ä¸€è‡´ã€‚<br>\næ ¸å¿ƒç‰¹ç‚¹ï¼š</p>\n<ul class=\"lvl-4\">\n<li class=\"lvl-10\">å®‰è£…é”å®šçš„ç‰ˆæœ¬ï¼šå®ƒåªä¼šå®‰è£… poetry.lock æ–‡ä»¶ä¸­æŒ‡å®šçš„ç‰ˆæœ¬ï¼Œå³ä½¿ pyproject.toml æ–‡ä»¶ä¸­å®šä¹‰çš„ç‰ˆæœ¬èŒƒå›´å·²ç»æœ‰æ›´æ–°ç‰ˆæœ¬ã€‚</li>\n<li class=\"lvl-10\">é‡ç°ä¾èµ–ç¯å¢ƒï¼šé€‚ç”¨äºå›¢é˜Ÿåä½œæˆ–éƒ¨ç½²ç¯å¢ƒï¼Œç¡®ä¿æ‰€æœ‰äººæˆ–æœºå™¨å®‰è£…çš„ä¾èµ–ç‰ˆæœ¬å®Œå…¨ç›¸åŒã€‚</li>\n<li class=\"lvl-10\">é”æ–‡ä»¶å­˜åœ¨æ—¶æ›´é«˜æ•ˆï¼šå¦‚æœ poetry.lock æ–‡ä»¶å­˜åœ¨ï¼Œpoetry install ä¸ä¼šé‡æ–°è§£æä¾èµ–æ ‘ã€‚</li>\n<li class=\"lvl-10\">é¦–æ¬¡è¿è¡Œæ—¶ç”Ÿæˆé”æ–‡ä»¶ï¼šå¦‚æœæ²¡æœ‰ poetry.lock æ–‡ä»¶ï¼Œpoetry install ä¼šè§£æä¾èµ–å¹¶ç”Ÿæˆé”æ–‡ä»¶ã€‚<br>\nä½¿ç”¨åœºæ™¯ï¼š</li>\n<li class=\"lvl-10\">æ–°å…‹éš†çš„é¡¹ç›®ï¼Œéœ€è¦å®‰è£…ä¾èµ–ç¯å¢ƒã€‚</li>\n<li class=\"lvl-10\">éƒ¨ç½²ç”Ÿäº§ç¯å¢ƒï¼Œç¡®ä¿ä¾èµ–ç‰ˆæœ¬çš„ç¨³å®šæ€§ã€‚</li>\n<li class=\"lvl-10\">é‡æ–°å®‰è£…ä¹‹å‰å·²å®šä¹‰çš„ä¾èµ–ï¼ˆä¾‹å¦‚æ¸…ç©ºäº†è™šæ‹Ÿç¯å¢ƒï¼‰ã€‚</li>\n</ul>\n</li>\n<li class=\"lvl-6\">\n<p><code>poetry update</code> çš„ä½œç”¨æ˜¯æ ¹æ® pyproject.toml æ–‡ä»¶ä¸­å®šä¹‰çš„ä¾èµ–èŒƒå›´é‡æ–°è§£æä¾èµ–æ ‘ï¼Œå¹¶æ›´æ–° poetry.lock æ–‡ä»¶ä¸ºæœ€æ–°çš„ç‰ˆæœ¬ã€‚<br>\næ ¸å¿ƒç‰¹ç‚¹ï¼š</p>\n<ul class=\"lvl-4\">\n<li class=\"lvl-10\">æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬ï¼šå®ƒä¼šå°è¯•å®‰è£…ä¾èµ–èŒƒå›´å†…çš„æœ€æ–°ç‰ˆæœ¬ï¼Œå¹¶æ›´æ–° poetry.lock æ–‡ä»¶ã€‚</li>\n<li class=\"lvl-10\">è§£ææ–°çš„ä¾èµ–æ ‘ï¼šå³ä½¿ poetry.lock æ–‡ä»¶å­˜åœ¨ï¼Œpoetry update ä¹Ÿä¼šå¿½ç•¥å®ƒå¹¶é‡æ–°è§£æä¾èµ–ã€‚</li>\n<li class=\"lvl-10\">æ›´æ”¹é”æ–‡ä»¶ï¼šå®ƒä¼šè¦†ç›–ç°æœ‰çš„ poetry.lock æ–‡ä»¶ï¼Œå› æ­¤å›¢é˜Ÿå…¶ä»–æˆå‘˜éœ€è¦é‡æ–°è¿è¡Œ poetry install ä»¥åŒæ­¥ã€‚<br>\nä½¿ç”¨åœºæ™¯ï¼š</li>\n<li class=\"lvl-10\">æ›´æ–°ä¾èµ–åˆ°æœ€æ–°ç‰ˆæœ¬ï¼ˆåœ¨ä¾èµ–èŒƒå›´å†…ï¼‰ã€‚</li>\n<li class=\"lvl-10\">å½“æ·»åŠ æ–°ä¾èµ–åï¼Œæƒ³è¦å®‰è£…å¹¶æ›´æ–°é”æ–‡ä»¶ã€‚</li>\n<li class=\"lvl-10\">ä¿®å¤å¯èƒ½çš„ç‰ˆæœ¬å†²çªæˆ–ä¸å…¼å®¹é—®é¢˜ã€‚</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"lock-é”å®šä¾èµ–åŒ…\">lock : é”å®šä¾èµ–åŒ…</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><code>poetry lock</code> æ˜¯ Poetryï¼ˆä¸€ä¸ª Python åŒ…ç®¡ç†å·¥å…·ï¼‰ä¸­çš„ä¸€ä¸ªå‘½ä»¤ï¼Œç”¨äºé”å®šé¡¹ç›®çš„ä¾èµ–å…³ç³»ã€‚ä½¿ç”¨è¿™ä¸ªå‘½ä»¤å¯ä»¥åˆ›å»ºæˆ–æ›´æ–° <code>poetry.lock</code> æ–‡ä»¶ï¼Œç¡®ä¿ä½ çš„é¡¹ç›®ä¸­æ‰€ä½¿ç”¨çš„æ¯ä¸ªåŒ…çš„ç‰ˆæœ¬éƒ½è¢«æ˜ç¡®è®°å½•ä¸‹æ¥ã€‚è¿™æ ·åšå¯¹äºé¡¹ç›®çš„å¯å¤ç°æ€§å’Œç¨³å®šæ€§è‡³å…³é‡è¦ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å®é™…ä¸Šï¼Œå½“è¿è¡Œ <code>poetry install</code> ã€ <code>poetry update</code> æˆ–è€… <code>poetry add</code> ç­‰å‘½ä»¤æ—¶ï¼Œ poetry éƒ½ä¼šæ ¹æ®<br>\n<code>pyproject.toml</code> æ–‡ä»¶ä¸­çš„ä¾èµ–èŒƒå›´ï¼Œè§£æä¾èµ–æ ‘ï¼Œå¹¶åœ¨é¡¹ç›®ç›®å½•ä¸‹åˆ›å»ºæˆ–æ›´æ–° <code>poetry.lock</code> æ–‡ä»¶ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å½“æˆ‘ä»¬æ‰‹å·¥ä¿®æ”¹äº† <code>pyproject.toml</code> æ–‡ä»¶ä¸­çš„ä¾èµ–èŒƒå›´ï¼Œæ­¤æ—¶åˆä¸æƒ³ç«‹åˆ»æ›´æ–°ä¾èµ–ï¼Œè€Œæ˜¯å¸Œæœ›åœ¨æŸä¸ªæ—¶æœºå†æ›´æ–°ï¼Œæ­¤æ—¶å°±å¯ä»¥ä½¿ç”¨ <code>poetry lock</code> å‘½ä»¤ï¼Œå…ˆé”å®šè¿™äº›ä¾èµ–ï¼Œä¹‹åå†é€šè¿‡ <code>poetry install</code> å‘½ä»¤å®‰è£…ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å¯ä»¥ä½¿ç”¨ <code>poetry check</code> å‘½ä»¤æ£€æŸ¥ <code>pyproject.toml</code> æ–‡ä»¶ ä¸ <code>poetry.lock</code> æ–‡ä»¶çš„ä¸€è‡´æ€§ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æ¯”å¦‚æˆ‘æ‰‹å·¥åˆ é™¤äº† `pyproject.toml` æ–‡ä»¶ä¸­çš„æŸä¸ªä¾èµ–</span></span><br><span class=\"line\"><span class=\"comment\"># æ­¤æ—¶è¿è¡Œ check æ£€æŸ¥ä¸€è‡´æ€§ä¼šæŠ¥é”™</span></span><br><span class=\"line\">$ poetry check</span><br><span class=\"line\">Error: pyproject.toml changed significantly since poetry.lock was last generated. Run `poetry lock [--no-update]` to fix the lock file.</span><br><span class=\"line\"><span class=\"comment\"># é”å®šä¾èµ–</span></span><br><span class=\"line\">$ poetry lock</span><br><span class=\"line\">Updating dependencies</span><br><span class=\"line\">Resolving dependencies... (0.1s)</span><br><span class=\"line\"></span><br><span class=\"line\">Writing lock file</span><br><span class=\"line\"><span class=\"comment\"># æ£€æŸ¥ä¸€è‡´æ€§é€šè¿‡</span></span><br><span class=\"line\">$ poetry check</span><br><span class=\"line\">All <span class=\"built_in\">set</span>!</span><br></pre></td></tr></table></figure>\n<div class=\"tips\">\n<p><em><strong>å°è´´å£«</strong></em></p>\n<ul class=\"lvl-1\">\n<li class=\"lvl-2\">æ³¨æ„ï¼Œæ­¤æ—¶é€šè¿‡ <code>poetry show</code> æŸ¥çœ‹ä¸åˆ°é‚£ä¸ªæ‰‹å·¥åˆ é™¤çš„ä¾èµ–åŒ…ï¼Œä½†å®é™…ä¸Šä¾èµ–ä¾æ—§åœ¨äºè™šæ‹Ÿç¯å¢ƒä¸­</li>\n<li class=\"lvl-2\">æ‰€ä»¥å°½é‡é¿å…æ‰‹å·¥åˆ é™¤ä¾èµ–ï¼Œè€Œæ˜¯é€šè¿‡ <code>poetry remove</code> å‘½ä»¤æ¥åˆ é™¤ä¾èµ–</li>\n</ul>\n</div>\n<h3 id=\"source-é•œåƒæºç®¡ç†\">source : é•œåƒæºç®¡ç†</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>é»˜è®¤æƒ…å†µä¸‹éƒ½æ˜¯ä»Pypiçš„å®˜æ–¹ä»“åº“ä¸‹è½½ï¼Œå›½å†…ä¸€èˆ¬éœ€è¦æŒ‡å®šé•œåƒæºæ¥åŠ é€Ÿä¸‹è½½</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æ·»åŠ é•œåƒæºï¼Œé»˜è®¤å°±æ˜¯ä¸»è¦æºï¼Œæ³¨æ„è¯¥æ–¹å¼åªå¯¹å½“å‰é¡¹ç›®æœ‰æ•ˆ</span></span><br><span class=\"line\"><span class=\"comment\"># å‘½ä»¤æ ¼å¼ï¼špoetry source add [é€‰é¡¹] [--] &lt;name&gt; [&lt;url&gt;]ï¼Œnameï¼šæºä»“åº“çš„åç§°ï¼Œurlï¼šæºä»“åº“çš„ URL</span></span><br><span class=\"line\">$ poetry <span class=\"built_in\">source</span> add tsinghua https://pypi.tuna.tsinghua.edu.cn/simple</span><br><span class=\"line\">Adding <span class=\"built_in\">source</span> with name tsinghua.</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># --priority=PRIORITYè®¾ç½®æ­¤æºçš„ä¼˜å…ˆçº§ã€‚å¯ä»¥æ˜¯ä»¥ä¸‹å€¼ä¹‹ä¸€ï¼šdefaultï¼ˆé»˜è®¤ï¼‰ã€primaryï¼ˆä¸»è¦ï¼‰ã€supplementalï¼ˆå¤‡ç”¨ï¼‰ã€explicitï¼ˆæ˜¾å¼æºï¼Œåªæœ‰å½“åŒ…æ˜ç¡®å£°æ˜ä½¿ç”¨è¯¥æºæ—¶æ‰ä¼šè¢«ä½¿ç”¨ï¼‰ã€‚é»˜è®¤ä¸º primaryã€‚</span></span><br><span class=\"line\">$ poetry <span class=\"built_in\">source</span> add  --priority=supplemental aliyun http://mirrors.aliyun.com/pypi/simple/</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹é•œåƒæºä¿¡æ¯</span></span><br><span class=\"line\">$ poetry <span class=\"built_in\">source</span> show</span><br><span class=\"line\"> name      : tsinghua</span><br><span class=\"line\"> url       : https://pypi.tuna.tsinghua.edu.cn/simple</span><br><span class=\"line\"> priority  : primary</span><br><span class=\"line\"></span><br><span class=\"line\"> name      : aliyun</span><br><span class=\"line\"> url       : http://mirrors.aliyun.com/pypi/simple/</span><br><span class=\"line\"> priority  : supplemental</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ­¤æ—¶æŸ¥çœ‹ pyproject.toml æ–‡ä»¶å¯ä»¥çœ‹åˆ°é•œåƒæºä¿¡æ¯</span></span><br><span class=\"line\">[[tool.poetry.source]]</span><br><span class=\"line\">name = <span class=\"string\">&quot;tsinghua&quot;</span></span><br><span class=\"line\">url = <span class=\"string\">&quot;https://pypi.tuna.tsinghua.edu.cn/simple&quot;</span></span><br><span class=\"line\">priority = <span class=\"string\">&quot;primary&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">[[tool.poetry.source]]</span><br><span class=\"line\">name = <span class=\"string\">&quot;aliyun&quot;</span></span><br><span class=\"line\">url = <span class=\"string\">&quot;http://mirrors.aliyun.com/pypi/simple/&quot;</span></span><br><span class=\"line\">priority = <span class=\"string\">&quot;supplemental&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åˆ é™¤é•œåƒæº</span></span><br><span class=\"line\">$ poetry <span class=\"built_in\">source</span> remove aliyun <span class=\"comment\"># æŒ‡å®šé•œåƒæºåç§°</span></span><br><span class=\"line\">Removing <span class=\"built_in\">source</span> with name aliyun.</span><br></pre></td></tr></table></figure>\n<h3 id=\"è¿è¡Œ\">è¿è¡Œ</h3>\n<p>è¿™é‡Œä»¥ä¸€ä¸ªå°ç¤ºä¾‹æ¥è¯´æ˜è¿™ä¸ªåŠŸèƒ½</p>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ›å»ºä¸€ä¸ªæ–°çš„é¡¹ç›®</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ poetry new poetryDemo</span><br><span class=\"line\">Created package poetrydemo <span class=\"keyword\">in</span> poetryDemo</span><br><span class=\"line\"><span class=\"comment\"># è¿›å…¥é¡¹ç›®ç›®å½•</span></span><br><span class=\"line\">$ <span class=\"built_in\">cd</span> poetryDemo</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹ç”Ÿæˆçš„æ–‡ä»¶</span></span><br><span class=\"line\">$ ll</span><br><span class=\"line\">total 8</span><br><span class=\"line\">drwxr-xr-x  6 hanqf  staff  192 11 21 17:32 .</span><br><span class=\"line\">drwxr-xr-x  4 hanqf  staff  128 11 21 17:32 ..</span><br><span class=\"line\">-rw-r--r--  1 hanqf  staff    0 11 21 17:32 README.md</span><br><span class=\"line\">drwxr-xr-x  3 hanqf  staff   96 11 21 17:32 poetrydemo</span><br><span class=\"line\">-rw-r--r--  1 hanqf  staff  266 11 21 17:32 pyproject.toml</span><br><span class=\"line\">drwxr-xr-x  3 hanqf  staff   96 11 21 17:32 tests</span><br><span class=\"line\"><span class=\"comment\"># è¿›å…¥åŒ…ç›®å½•</span></span><br><span class=\"line\">$ <span class=\"built_in\">cd</span> poetrydemo</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹åŒ…ç›®å½•ä¸‹çš„æ–‡ä»¶</span></span><br><span class=\"line\">$ ll</span><br><span class=\"line\">total 0</span><br><span class=\"line\">drwxr-xr-x  3 hanqf  staff   96 11 21 17:32 .</span><br><span class=\"line\">drwxr-xr-x  6 hanqf  staff  192 11 21 17:32 ..</span><br><span class=\"line\">-rw-r--r--  1 hanqf  staff    0 11 21 17:32 __init__.py</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åœ¨åŒ…ç›®å½•ä¸‹åˆ›å»º array_util.pyï¼Œå†…å®¹å¦‚ä¸‹</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">import numpy as np</span><br><span class=\"line\"></span><br><span class=\"line\">def generate_random_array(shape, distribution=<span class=\"string\">&quot;uniform&quot;</span>, params=None, seed=None):</span><br><span class=\"line\">    <span class=\"string\">&quot;&quot;</span><span class=\"string\">&quot;</span></span><br><span class=\"line\"><span class=\"string\">    ç”Ÿæˆéšæœºæ•°ç»„çš„å·¥å…·æ–¹æ³•ã€‚</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">    :param shape: tupleï¼ŒæŒ‡å®šæ•°ç»„çš„å½¢çŠ¶ï¼Œä¾‹å¦‚ (3, 4) è¡¨ç¤º 3 è¡Œ 4 åˆ—ã€‚</span></span><br><span class=\"line\"><span class=\"string\">    :param distribution: strï¼ŒæŒ‡å®šéšæœºæ•°åˆ†å¸ƒç±»å‹ï¼Œå¯é€‰å€¼ï¼š</span></span><br><span class=\"line\"><span class=\"string\">        - &quot;</span>uniform<span class=\"string\">&quot;ï¼šå‡åŒ€åˆ†å¸ƒï¼ˆé»˜è®¤ï¼‰ã€‚</span></span><br><span class=\"line\"><span class=\"string\">        - &quot;</span>normal<span class=\"string\">&quot;ï¼šæ­£æ€åˆ†å¸ƒã€‚</span></span><br><span class=\"line\"><span class=\"string\">        - &quot;</span><span class=\"built_in\">integer</span><span class=\"string\">&quot;ï¼šéšæœºæ•´æ•°ã€‚</span></span><br><span class=\"line\"><span class=\"string\">    :param params: dictï¼Œåˆ†å¸ƒçš„å‚æ•°é…ç½®ï¼š</span></span><br><span class=\"line\"><span class=\"string\">        - å‡åŒ€åˆ†å¸ƒï¼š&#123;&quot;</span>low<span class=\"string\">&quot;: æœ€å°å€¼, &quot;</span>high<span class=\"string\">&quot;: æœ€å¤§å€¼&#125;ï¼Œé»˜è®¤ low=0, high=1ã€‚</span></span><br><span class=\"line\"><span class=\"string\">        - æ­£æ€åˆ†å¸ƒï¼š&#123;&quot;</span>mean<span class=\"string\">&quot;: å‡å€¼, &quot;</span>std<span class=\"string\">&quot;: æ ‡å‡†å·®&#125;ï¼Œé»˜è®¤ mean=0, std=1ã€‚</span></span><br><span class=\"line\"><span class=\"string\">        - éšæœºæ•´æ•°ï¼š&#123;&quot;</span>low<span class=\"string\">&quot;: æœ€å°å€¼, &quot;</span>high<span class=\"string\">&quot;: æœ€å¤§å€¼, &quot;</span>dtype<span class=\"string\">&quot;: ç±»å‹&#125;ï¼Œé»˜è®¤ low=0, high=10ã€‚</span></span><br><span class=\"line\"><span class=\"string\">    :param seed: intï¼Œéšæœºæ•°ç§å­ï¼ˆå¯é€‰ï¼‰ï¼Œç”¨äºç»“æœå¯å¤ç°ã€‚</span></span><br><span class=\"line\"><span class=\"string\">    :return: np.ndarrayï¼Œç”Ÿæˆçš„éšæœºæ•°ç»„ã€‚</span></span><br><span class=\"line\"><span class=\"string\">    &quot;</span><span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> seed is not None:</span><br><span class=\"line\">        np.random.seed(seed)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> params is None:</span><br><span class=\"line\">        params = &#123;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> distribution == <span class=\"string\">&quot;uniform&quot;</span>:</span><br><span class=\"line\">        low = params.get(<span class=\"string\">&quot;low&quot;</span>, 0)</span><br><span class=\"line\">        high = params.get(<span class=\"string\">&quot;high&quot;</span>, 1)</span><br><span class=\"line\">        <span class=\"built_in\">return</span> np.random.uniform(low, high, size=shape)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">elif</span> distribution == <span class=\"string\">&quot;normal&quot;</span>:</span><br><span class=\"line\">        mean = params.get(<span class=\"string\">&quot;mean&quot;</span>, 0)</span><br><span class=\"line\">        std = params.get(<span class=\"string\">&quot;std&quot;</span>, 1)</span><br><span class=\"line\">        <span class=\"built_in\">return</span> np.random.normal(mean, std, size=shape)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">elif</span> distribution == <span class=\"string\">&quot;integer&quot;</span>:</span><br><span class=\"line\">        low = params.get(<span class=\"string\">&quot;low&quot;</span>, 0)</span><br><span class=\"line\">        high = params.get(<span class=\"string\">&quot;high&quot;</span>, 10)</span><br><span class=\"line\">        dtype = params.get(<span class=\"string\">&quot;dtype&quot;</span>, int)</span><br><span class=\"line\">        <span class=\"built_in\">return</span> np.random.randint(low, high, size=shape, dtype=dtype)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">else</span>:</span><br><span class=\"line\">        raise ValueError(<span class=\"string\">&quot;ä¸æ”¯æŒçš„åˆ†å¸ƒç±»å‹ï¼å¯é€‰å€¼ä¸º &#x27;uniform&#x27;, &#x27;normal&#x27;, &#x27;integer&#x27;ã€‚&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ç¤ºä¾‹ç”¨æ³•</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">&quot;__main__&quot;</span>:</span><br><span class=\"line\">    array_uniform = generate_random_array((<span class=\"number\">3</span>, <span class=\"number\">4</span>), distribution=&quot;uniform&quot;, params=&#123;&quot;low&quot;: <span class=\"number\">1</span>, &quot;high&quot;: <span class=\"number\">10</span>&#125;)</span><br><span class=\"line\">    array_normal = generate_random_array((<span class=\"number\">2</span>, <span class=\"number\">3</span>), distribution=&quot;normal&quot;, params=&#123;&quot;mean&quot;: <span class=\"number\">0</span>, &quot;std&quot;: <span class=\"number\">1</span>&#125;, seed=<span class=\"number\">42</span>)</span><br><span class=\"line\">    array_integer = generate_random_array((<span class=\"number\">4</span>, <span class=\"number\">5</span>), distribution=&quot;integer&quot;, params=&#123;&quot;low&quot;: <span class=\"number\">0</span>, &quot;high&quot;: <span class=\"number\">20</span>&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">    print(&quot;å‡åŒ€åˆ†å¸ƒéšæœºæ•°ç»„ï¼š\\n&quot;, array_uniform)</span><br><span class=\"line\">    print(&quot;æ­£æ€åˆ†å¸ƒéšæœºæ•°ç»„ï¼š\\n&quot;, array_normal)</span><br><span class=\"line\">    print(&quot;éšæœºæ•´æ•°æ•°ç»„ï¼š\\n&quot;, array_integer)</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å®‰è£…ä¾èµ–</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ poetry add numpy</span><br><span class=\"line\">Using version ^2.1.3 <span class=\"keyword\">for</span> numpy</span><br><span class=\"line\"></span><br><span class=\"line\">Updating dependencies</span><br><span class=\"line\">Resolving dependencies... (1.1s)</span><br><span class=\"line\"></span><br><span class=\"line\">Package operations: 1 install, 0 updates, 0 removals</span><br><span class=\"line\"></span><br><span class=\"line\">  - Installing numpy (2.1.3)</span><br><span class=\"line\"></span><br><span class=\"line\">Writing lock file</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¿è¡Œï¼Œä¸¤ç§æ–¹æ³•</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-6\"><code>poetry run</code></li>\n</ul>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ poetry run python array_util.py</span><br><span class=\"line\">å‡åŒ€åˆ†å¸ƒéšæœºæ•°ç»„ï¼š</span><br><span class=\"line\">[[7.44623063 1.89415788 4.81008329 4.25556572]</span><br><span class=\"line\">[3.31925154 6.44037063 5.3216543  7.54950573]</span><br><span class=\"line\">[3.97160747 5.04800698 3.28299934 3.42841887]]</span><br><span class=\"line\">æ­£æ€åˆ†å¸ƒéšæœºæ•°ç»„ï¼š</span><br><span class=\"line\">[[ 0.49671415 -0.1382643   0.64768854]</span><br><span class=\"line\">[ 1.52302986 -0.23415337 -0.23413696]]</span><br><span class=\"line\">éšæœºæ•´æ•°æ•°ç»„ï¼š</span><br><span class=\"line\">[[10 10  3  7  2]</span><br><span class=\"line\">[ 1 11  5  1  0]</span><br><span class=\"line\">[11 11 16  9 15]</span><br><span class=\"line\">[14 14 18 11 19]]</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-2\">\n<li class=\"lvl-6\"><code>poetry shell</code> : æ­¤æ—¶ä¼šå¼€å¯ä¸€ä¸ªæ–°çš„shellï¼Œå¹¶å¼€å¯è™šæ‹Ÿç¯å¢ƒ</li>\n</ul>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å¼€å¯è™šæ‹Ÿç¯å¢ƒ</span></span><br><span class=\"line\">$ poetry shell</span><br><span class=\"line\">Spawning shell within /Users/hanqf/Library/Caches/pypoetry/virtualenvs/poetrydemo-fyqYbfje-py3.11</span><br><span class=\"line\">Restored session: 2024å¹´11æœˆ21æ—¥ æ˜ŸæœŸå›› 15æ—¶31åˆ†52ç§’ CST</span><br><span class=\"line\">âœ  poetrydemo <span class=\"built_in\">emulate</span> bash -c <span class=\"string\">&#x27;. /Users/hanqf/Library/Caches/pypoetry/virtualenvs/poetrydemo-fyqYbfje-py3.11/bin/activate&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"># åœ¨è™šæ‹Ÿç¯å¢ƒä¸‹è¿è¡Œ</span></span><br><span class=\"line\">$ python array_util.py</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<h3 id=\"æ‰“åŒ…å’Œå‘å¸ƒ\">æ‰“åŒ…å’Œå‘å¸ƒ</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ¥ç€ä¸Šé¢çš„é¡¹ç›®</p>\n</li>\n<li class=\"lvl-2\">\n<p>æ‰“åŒ…</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ä¼šåœ¨é¡¹ç›®ç›®å½•ä¸‹åˆ›å»º dist ç›®å½•ï¼Œå¹¶å°†æ‰“å¥½çš„åŒ…å­˜æ”¾äºæ­¤</span></span><br><span class=\"line\">$ poetry build</span><br><span class=\"line\">Building poetrydemo (0.1.0)</span><br><span class=\"line\">  - Building sdist</span><br><span class=\"line\">  - Built poetrydemo-0.1.0.tar.gz</span><br><span class=\"line\">  - Building wheel</span><br><span class=\"line\">  - Built poetrydemo-0.1.0-py3-none-any.whl</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹ç”Ÿæˆçš„æ‰“åŒ…æ–‡ä»¶</span></span><br><span class=\"line\">$ exa -1 dist</span><br><span class=\"line\">hqf_poetrydemo-0.1.0-py3-none-any.whl</span><br><span class=\"line\">hqf_poetrydemo-0.1.0.tar.gz</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å‘å¸ƒ</p>\n</li>\n<li class=\"lvl-2\">\n<p>é¦–å…ˆè¦å…ˆåœ¨<a href=\"https://pypi.org/\">PyPI</a>ä¸Šæ³¨å†Œä¸ªå¸å·ï¼Œéœ€è¦å¼€å¯â€œåŒè¦ç´ èº«ä»½éªŒè¯ ï¼ˆ2FAï¼‰â€ï¼Œå¦åˆ™ä¸èƒ½è·å–å‘å¸ƒæ—¶çš„APIä»¤ç‰Œã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>è·å–APIä»¤ç‰Œ<br>\n<img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/uPic/iShot_2024-11-21_18.00.50.png\" alt=\"\"></p>\n</li>\n<li class=\"lvl-2\">\n<p>å‘å¸ƒï¼Œä¸è¿‡è¿™æ¬¡å‘å¸ƒæç¤ºåŒ…åå·²ç»å­˜åœ¨äº†</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å‘å¸ƒæ—¶æç¤ºåŒ…åå·²ç»å­˜åœ¨äº†</span></span><br><span class=\"line\">$ poetry publish -u __token__  -p pypi-AgEIcHlwaS5vcmcCJDU0Y2Q5NjhkLWYyYTEtN</span><br><span class=\"line\">Publishing poetrydemo (0.1.0) to PyPI</span><br><span class=\"line\"> - Uploading poetrydemo-0.1.0-py3-none-any.whl FAILED</span><br><span class=\"line\"></span><br><span class=\"line\">HTTP Error 400: The name <span class=\"string\">&#x27;poetrydemo&#x27;</span> is too similar to an existing project. See https://pypi.org/help/#project-name <span class=\"keyword\">for</span> more information. | b<span class=\"string\">&quot;&lt;html&gt;\\n &lt;head&gt;\\n  &lt;title&gt;400 The name &#x27;poetrydemo&#x27; is too similar to an existing project. See https://pypi.org/help/#project-name for more information.\\n \\n &lt;body&gt;\\n  &lt;h1&gt;400 The name &#x27;poetrydemo&#x27; is too similar to an existing project. See https://pypi.org/help/#project-name for more information.\\n  The server could not comply with the request since it is either malformed or otherwise incorrect.&lt;br/&gt;&lt;br/&gt;\\nThe name &amp;#x27;poetrydemo&amp;#x27; is too similar to an existing project. See https://pypi.org/help/#project-name for more information.\\n\\n\\n \\n&quot;</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å…ˆä¿®æ”¹åŒ…åï¼Œç›´æ¥ç¼–è¾‘ pyproject.toml å³å¯ï¼Œå°†nameå±æ€§ä¿®æ”¹ä¸ºâ€œhqf_poetrydemoâ€ï¼Œç„¶åå°†åŒ…ç›®å½•çš„åç§°ä¹Ÿä¿®æ”¹ä¸ºè¿™ä¸ª<code>mv poetrydemo hqf_poetrydemo</code>ï¼Œå¹¶åˆ é™¤distç›®å½•ï¼Œä¹‹åé‡æ–°æ‰“åŒ…<code>poetry build</code>ï¼Œå†æ¬¡å‘å¸ƒ</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ vim pyproject.toml <span class=\"comment\"># å°†nameå±æ€§ä¿®æ”¹ä¸ºâ€œhqf_poetrydemoâ€</span></span><br><span class=\"line\">$ <span class=\"built_in\">mv</span> poetrydemo hqf_poetrydemo <span class=\"comment\"># å°†åŒ…ç›®å½•çš„åç§°ä¹Ÿä¿®æ”¹ä¸ºè¿™ä¸ª</span></span><br><span class=\"line\">$ <span class=\"built_in\">rm</span> -rf dist <span class=\"comment\"># åˆ é™¤distç›®å½•</span></span><br><span class=\"line\">$ poetry build    <span class=\"comment\"># é‡æ–°æ‰“åŒ…</span></span><br><span class=\"line\">Creating virtualenv hqf-poetrydemo-fyqYbfje-py3.11 <span class=\"keyword\">in</span> /Users/hanqf/Library/Caches/pypoetry/virtualenvs</span><br><span class=\"line\">Building hqf_poetrydemo (0.1.0)</span><br><span class=\"line\">  - Building sdist</span><br><span class=\"line\">  - Built hqf_poetrydemo-0.1.0.tar.gz</span><br><span class=\"line\">  - Building wheel</span><br><span class=\"line\">  - Built hqf_poetrydemo-0.1.0-py3-none-any.whl</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å†æ¬¡å‘å¸ƒ</span></span><br><span class=\"line\">$ poetry publish -u __token__  -p pypi-AgEIcHlwaS5vcmcCJDU0Y2Q5NjhkLWYyYTEtN</span><br><span class=\"line\"></span><br><span class=\"line\">Publishing hqf_poetrydemo (0.1.0) to PyPI</span><br><span class=\"line\"> - Uploading hqf_poetrydemo-0.1.0-py3-none-any.whl 100%</span><br><span class=\"line\"> - Uploading hqf_poetrydemo-0.1.0.tar.gz 100%</span><br></pre></td></tr></table></figure>\n<p><img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/uPic/iShot_2024-11-21_18.13.21.png\" alt=\"\"></p>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¹‹åå°±å¯ä»¥åœ¨å…¶å®ƒé¡¹ç›®ä¸­å®‰è£…è¿™ä¸ªåŒ…äº†</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># pip install</span></span><br><span class=\"line\">$ pip install hqf_poetrydemo</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># poetry add</span></span><br><span class=\"line\">$ poetry add hqf_poetrydemo</span><br><span class=\"line\">Using version ^0.1.0 <span class=\"keyword\">for</span> hqf-poetrydemo</span><br><span class=\"line\"></span><br><span class=\"line\">Updating dependencies</span><br><span class=\"line\">Resolving dependencies... (0.5s)</span><br><span class=\"line\"></span><br><span class=\"line\">Package operations: 2 installs, 0 updates, 0 removals</span><br><span class=\"line\"></span><br><span class=\"line\">  - Installing numpy (2.1.3)</span><br><span class=\"line\">  - Installing hqf-poetrydemo (0.1.0)</span><br><span class=\"line\"></span><br><span class=\"line\">Writing lock file</span><br></pre></td></tr></table></figure>\n<h3 id=\"self-update-å‡çº§-poetry-ç‰ˆæœ¬\"><code>self update</code> : å‡çº§ poetry ç‰ˆæœ¬</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>self ç›¸å…³å‘½ä»¤ä¸»è¦ç”¨äº poetry è‡ªèº«å®‰è£…æ’ä»¶ä½¿ç”¨</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä¼°è®¡æ’ä»¶åŠŸèƒ½ç›®å‰è¿˜ä¸æˆç†Ÿï¼Œå®˜ç½‘ä¹Ÿæ²¡æœ‰è¿›è¡Œè¯¦ç»†çš„è¯´æ˜ï¼Œå¹¶ä¸” windows ä¸‹æ— æ³•ä½¿ç”¨ï¼Œæ‰€ä»¥è¿™é‡Œä¸è®¨è®ºã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><code>self</code>å‘½ä»¤ä¸‹ç›®å‰åªéœ€è¦è®°ä½ä¸€ä¸ªå‘½ä»¤ï¼š <code>self update</code> : å‡çº§ poetry ç‰ˆæœ¬</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ poetry self update</span><br></pre></td></tr></table></figure>\n<h3 id=\"debug-resolve-æŸ¥çœ‹åŒ…çš„ä¾èµ–å…³ç³»\"><code>debug resolve</code> : æŸ¥çœ‹åŒ…çš„ä¾èµ–å…³ç³»</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åªæŸ¥çœ‹ï¼Œä¸å®‰è£…</span></span><br><span class=\"line\">$ poetry debug resolve requests</span><br><span class=\"line\">Resolving dependencies... (0.4s)</span><br><span class=\"line\"></span><br><span class=\"line\">Resolution results:</span><br><span class=\"line\"></span><br><span class=\"line\">certifi            2024.8.30</span><br><span class=\"line\">charset-normalizer 3.4.0</span><br><span class=\"line\">idna               3.10</span><br><span class=\"line\">urllib3            2.2.3</span><br><span class=\"line\">requests           2.32.3</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹æŒ‡å®šç‰ˆæœ¬çš„ä¾èµ–å…³ç³»</span></span><br><span class=\"line\">$ poetry debug resolve requests@2.32.3</span><br></pre></td></tr></table></figure>\n<h3 id=\"cache-ç¼“å­˜ç®¡ç†\">cache : ç¼“å­˜ç®¡ç†</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>poetryä¸€ä¸ªå¾ˆé‡è¦çš„åŠŸèƒ½å°±æ˜¯ç¼“å­˜å®‰è£…åŒ…ï¼Œå¯ä»¥ <code>å‡å°‘</code> ç›¸åŒçš„å®‰è£…åŒ…è¢«é‡å¤ä¸‹è½½ã€‚ä¸ºä»€ä¹ˆæ˜¯å‡å°‘è€Œä¸æ˜¯é¿å…å‘¢ï¼Ÿå› ä¸ºä¸åŒçš„é•œåƒæºçš„åŒ…æ˜¯åˆ†åˆ«ç¼“å­˜çš„ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>é€šè¿‡ <code>poetry config --list </code> å¯ä»¥çœ‹åˆ° <code>cache-dir</code> çš„åœ°å€ï¼Œè¿™é‡Œå°±æ˜¯ç¼“å­˜ä¸‹è½½åŒ…çš„ç›®å½•ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„ä½¿ç”¨åœºæ™¯</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-6\">è§£å†³ä¾èµ–å®‰è£…é—®é¢˜ï¼š<br>\nå¦‚æœä½ åœ¨å®‰è£…æˆ–æ›´æ–°ä¾èµ–æ—¶é‡åˆ°é—®é¢˜ï¼ˆä¾‹å¦‚ï¼ŒæŸä¸ªåŒ…æ— æ³•æ­£ç¡®å®‰è£…æˆ–ç‰ˆæœ¬ä¸å¯¹ï¼‰ï¼Œæ¸…ç©ºç¼“å­˜å¯ä»¥å¸®åŠ©ä½ ç¡®ä¿ Poetry é‡æ–°ä¸‹è½½æ‰€æœ‰å¿…è¦çš„æ–‡ä»¶ï¼Œä»è€Œè§£å†³é—®é¢˜ã€‚</li>\n<li class=\"lvl-6\">æ¸…ç†ç£ç›˜ç©ºé—´ï¼š<br>\nå¦‚æœä½ çš„é¡¹ç›®å¾ˆå¤šæˆ–è€…ç»å¸¸ä¿®æ”¹ä¾èµ–é¡¹ï¼Œç¼“å­˜å¯èƒ½ä¼šå˜å¾—éå¸¸å¤§ã€‚ä½¿ç”¨ poetry cache clear å¯ä»¥å¸®åŠ©é‡Šæ”¾ç£ç›˜ç©ºé—´ï¼Œç‰¹åˆ«æ˜¯å½“ä½ ä¸ç»å¸¸ä½¿ç”¨æŸäº›åŒ…æ—¶ã€‚</li>\n<li class=\"lvl-6\">æµ‹è¯•æœ€æ–°ç‰ˆæœ¬çš„ä¾èµ–ï¼š<br>\nå¦‚æœä½ æƒ³æµ‹è¯•æŸä¸ªåŒ…çš„æ–°ç‰ˆæœ¬æ˜¯å¦è§£å†³äº†æŸä¸ªé—®é¢˜ï¼Œæˆ–è€…æƒ³ç¡®ä¿ä½ ä½¿ç”¨çš„ç¡®å®æ˜¯æœ€æ–°çš„ç‰ˆæœ¬ï¼Œæ¸…é™¤ç¼“å­˜å¯ä»¥å¼ºåˆ¶ Poetry ä»è¿œç¨‹ä»“åº“é‡æ–°ä¸‹è½½æœ€æ–°çš„åŒ…ã€‚</li>\n<li class=\"lvl-6\">ç¯å¢ƒå˜åŒ–ï¼š<br>\nå¦‚æœä½ çš„å¼€å‘æˆ–ç”Ÿäº§ç¯å¢ƒå‘ç”Ÿäº†å˜åŒ–ï¼ˆä¾‹å¦‚ï¼Œåˆ‡æ¢äº†æ“ä½œç³»ç»Ÿã€æ›´æ–°äº† Python ç‰ˆæœ¬ç­‰ï¼‰ï¼Œæ¸…é™¤ç¼“å­˜å¯ä»¥å¸®åŠ©ä½ ç¡®ä¿ä¾èµ–é¡¹åœ¨æ–°ç¯å¢ƒä¸­æ­£ç¡®å®‰è£…ã€‚</li>\n<li class=\"lvl-6\">è°ƒè¯•ä¾èµ–é—®é¢˜ï¼š<br>\nåœ¨è°ƒè¯•ä¾èµ–é¡¹é—®é¢˜æ—¶ï¼Œæœ‰æ—¶å€™æ¸…é™¤ç¼“å­˜å¯ä»¥å¸®åŠ©ä½ ç¡®å®šé—®é¢˜æ˜¯å¦ä¸ç¼“å­˜ä¸­çš„æ—§ç‰ˆæœ¬æœ‰å…³ã€‚</li>\n<li class=\"lvl-6\">CI/CD ç¯å¢ƒçš„ä¸€è‡´æ€§ï¼š<br>\nåœ¨æŒç»­é›†æˆæˆ–æŒç»­éƒ¨ç½² (CI/CD) ç¯å¢ƒä¸­ï¼Œä¸ºäº†ç¡®ä¿æ¯æ¬¡æ„å»ºéƒ½åŸºäºæœ€æ–°çš„ä¾èµ–ï¼Œæœ‰æ—¶ä¼šåœ¨æ„å»ºè„šæœ¬ä¸­åŒ…å«æ¸…é™¤ç¼“å­˜çš„æ­¥éª¤ã€‚</li>\n</ul>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹ç¼“å­˜åˆ—è¡¨ï¼Œè¿™é‡Œä¼šæŒ‰é•œåƒæºè¿›è¡Œåˆ†ç»„</span></span><br><span class=\"line\">$ poetry cache list</span><br><span class=\"line\">PyPI</span><br><span class=\"line\">_default_cache</span><br><span class=\"line\">tsinghua</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ¸…é™¤æŒ‡å®šæºçš„å…¨éƒ¨ç¼“å­˜</span></span><br><span class=\"line\">$ poetry cache clear pypi --all</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ¸…é™¤æŒ‡å®šæºä¸‹æŸä¸ªåŒ…çš„ç¼“å­˜</span></span><br><span class=\"line\">$ poetry cache clear pypi:requests:2.24.0</span><br></pre></td></tr></table></figure>\n","content_text":"æ‘˜è¦ Poetryæ˜¯ä¸€ä¸ªè½»é‡çº§çš„pythonåŒ…ç®¡ç†å™¨ï¼Œå…¶ç›®æ ‡æ˜¯å¸®åŠ©å¼€å‘è€…å¿«é€Ÿã€è½»æ¾åœ°æ„å»ºã€å‘å¸ƒå’Œåˆ†äº«pythonåŒ…ã€‚è¯´å®ƒè½»é‡ï¼Œæ˜¯ä¸ conda ç›¸æ¯” poetry æ›´è½»é‡ï¼ŒåŒæ—¶ä¸ venv + pip Python--virtualenv çš„æ–¹å¼ç›¸æ¯”å…·æœ‰å¦‚ä¸‹ä¼˜ç‚¹ï¼š ä½¿ç”¨ç¼“å­˜æœºåˆ¶ï¼Œé¿å…é‡å¤ä¸‹è½½ä¾èµ–åŒ… åŒ…ç®¡ç†ä¸Šæ›´åŠ ç²¾ç¡®ï¼Œåˆ é™¤ä¸éœ€è¦çš„åŒ…æ—¶ä¼šåŒæ—¶åˆ é™¤ä¸å…¶å…³è”çš„ä¸”æ²¡æœ‰è¢«ä½¿ç”¨çš„é‚£äº›ä¾èµ–åŒ…ï¼Œé¿å…æ— ç”¨çš„ä¾èµ–åŒ…é€ æˆæ‰“åŒ…ä½“ç§¯è¿‡å¤§ æ‰“åŒ…å’Œå‘å¸ƒæ›´åŠ ç®€å•ï¼Œåªéœ€è¦ä¸€ä¸ªå‘½ä»¤å°±å¯ä»¥æ‰“åŒ…å’Œå‘å¸ƒ å®‰è£… å‚è€ƒå®˜æ–¹æ–‡æ¡£Installation 1234567891011121314# å®˜æ–¹æ¨èä½¿ç”¨pipxå®‰è£…ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨ pip$ pipx install poetry# æŸ¥çœ‹æ˜¯å¦å®‰è£…æˆåŠŸ$ poetry --versionPoetry (version 1.8.4)# æ·»åŠ å‘½ä»¤è‡ªåŠ¨è¡¥å…¨$ mkdir ~/.zfunc$ poetry completions zsh &gt; ~/.zfunc/_poetry# åœ¨ ~/.zshrc ä¸­æ·»åŠ ä»¥ä¸‹é…ç½®ï¼ˆæˆ‘æ˜¯ç”¨çš„æ˜¯zshï¼Œå…¶ä»–shellå¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼‰fpath+=~/.zfuncautoload -Uz compinit &amp;&amp; compinit pipxç®€ä»‹ pipx æ˜¯ä¸€ä¸ª Python åŒ…ç®¡ç†å·¥å…·ï¼Œä½¿ç”¨pipxå®‰è£…å·¥å…·åŒ…æ—¶ï¼Œæ¯ä¸ªå·¥å…·éƒ½ä¼šè¢«å®‰è£…åœ¨ä¸€ä¸ªç‹¬ç«‹çš„è™šæ‹Ÿç¯å¢ƒä¸­ï¼Œé¿å…ä¸åŒå·¥å…·ä¹‹é—´çš„ä¾èµ–å†²çªã€‚ åœºæ™¯ï¼šä¸¤ä¸ªå·¥å…·ä¾èµ–ä¸åŒç‰ˆæœ¬çš„åŒä¸€ä¸ªåº“ å‡è®¾æˆ‘ä»¬æœ‰ä¸¤ä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼š å·¥å…·A ä¾èµ–äº requests åº“çš„ç‰ˆæœ¬ 2.27.1ã€‚ å·¥å…·B ä¾èµ–äº requests åº“çš„ç‰ˆæœ¬ 2.31.0ã€‚ å¦‚æœä½¿ç”¨ pip å®‰è£… å·¥å…·ä¼šè¢«å®‰è£…åˆ°å…¨å±€ç¯å¢ƒï¼Œå…±äº«ç›¸åŒçš„ä¾èµ–ç‰ˆæœ¬ï¼š 12pip install toolA # å®‰è£…æ—¶ä¼šå®‰è£… requests 2.27.1pip install toolB # å®‰è£…æ—¶ä¼šå°† requests å‡çº§åˆ° 2.31.0 ç»“æœï¼š å½“ä½ è¿è¡Œå·¥å…·Aæ—¶ï¼Œå®ƒå¯èƒ½ä¼šæŠ¥é”™ï¼Œå› ä¸ºå®ƒä¾èµ–çš„ requests 2.27.1 å·²è¢« requests 2.31.0 æ›¿æ¢ã€‚ å…¨å±€ç¯å¢ƒä¸­çš„æ‰€æœ‰å·¥å…·éƒ½å…±äº«ä¸€ä¸ª requestsï¼Œç‰ˆæœ¬å†²çªä¸å¯é¿å…ã€‚ å¦‚æœä½¿ç”¨ pipx å®‰è£… æ¯ä¸ªå·¥å…·ä¼šè¢«å®‰è£…åˆ°ç‹¬ç«‹çš„è™šæ‹Ÿç¯å¢ƒä¸­ï¼Œå„è‡ªçš„ä¾èµ–äº’ä¸å½±å“ï¼š 12pipx install toolA # åœ¨è™šæ‹Ÿç¯å¢ƒAä¸­å®‰è£… toolA å’Œ requests 2.27.1pipx install toolB # åœ¨è™šæ‹Ÿç¯å¢ƒBä¸­å®‰è£… toolB å’Œ requests 2.31.0 ç»“æœï¼š è™šæ‹Ÿç¯å¢ƒA åªåŒ…å« toolA å’Œå®ƒçš„ä¾èµ– requests 2.27.1ã€‚ è™šæ‹Ÿç¯å¢ƒB åªåŒ…å« toolB å’Œå®ƒçš„ä¾èµ– requests 2.31.0ã€‚ å·¥å…·ä¹‹é—´å®Œå…¨éš”ç¦»ï¼Œä¸ä¼šå› ä¸ºä¾èµ–ç‰ˆæœ¬å†²çªè€Œå¯¼è‡´é—®é¢˜ã€‚ æ‰€ä»¥ï¼Œå½“éœ€è¦å®‰è£…å…¨å±€å‘½ä»¤è¡Œå·¥å…·æ—¶ï¼Œä½¿ç”¨pipxæ˜¯ä¸ªå¾ˆå¥½çš„é€‰æ‹© pipx çš„å®‰è£… 123456789101112131415# å®‰è£…pipxpip install pipx# é…ç½®ç¯å¢ƒå˜é‡ï¼Œè¿è¡Œè¯¥å‘½ä»¤ä¼šå°†pipx ensurepath# è¿è¡Œä¸Šé¢çš„å‘½ä»¤ä¼šå°†å¦‚ä¸‹å†…å®¹åŠ å…¥ä½ çš„shellé…ç½®æ–‡ä»¶ä¸­ï¼Œæˆ‘çš„æ˜¯ .zshrc æ–‡ä»¶ï¼Œå®é™…ä¸Šä½ ä¹Ÿå¯ä»¥æ‰‹å·¥æ·»åŠ è¯¥é…ç½®ï¼Œå°†$HOME/.local/binæ”¾åˆ°å‰é¢æ›´å¥½ä¸€äº›ã€‚export PATH=&quot;$PATH:$HOME/.local/bin&quot;# æ³¨æ„æ·»åŠ å®Œæˆåè¦é‡å¯shell# æ·»åŠ pipxè‡ªåŠ¨ä»£ç è¡¥å…¨# è¿è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œå¹¶æ ¹æ®æç¤ºå®Œæˆpipx completions# æˆ‘çš„æ˜¯zshï¼Œæ‰€ä»¥åœ¨ .zshrcä¸­æ·»åŠ å¦‚ä¸‹å†…å®¹autoload -Uz compinit &amp;&amp; compinit # å¦‚æœæ²¡æœ‰æ·»åŠ è¿‡å°±éœ€è¦å…ˆæ·»åŠ è¿™ä¸ªeval &quot;$(register-python-argcomplete pipx)&quot; # æ·»åŠ è‡ªåŠ¨ä»£ç è¡¥å…¨# æ³¨æ„æ·»åŠ å®Œæˆåè¦é‡å¯shell æŸ¥çœ‹æ‰€æœ‰å‘½ä»¤ æˆ‘å·²ç»å°†å…¶ç¿»è¯‘ä¸ºä¸­æ–‡ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667$ poetry listPoetry (ç‰ˆæœ¬ 1.8.4)ç”¨æ³•ï¼š command [é€‰é¡¹] [å‚æ•°]é€‰é¡¹ï¼š -h, --help æ˜¾ç¤ºç»™å®šå‘½ä»¤çš„å¸®åŠ©ã€‚å¦‚æœæ²¡æœ‰æŒ‡å®šå‘½ä»¤ï¼Œåˆ™æ˜¾ç¤ºåˆ—è¡¨å‘½ä»¤çš„å¸®åŠ©ã€‚ -q, --quiet ä¸è¾“å‡ºä»»ä½•æ¶ˆæ¯ã€‚ -V, --version æ˜¾ç¤ºæ­¤åº”ç”¨ç¨‹åºç‰ˆæœ¬ã€‚ --ansi å¼ºåˆ¶è¾“å‡ºANSIæ ¼å¼ã€‚ --no-ansi ç¦ç”¨ANSIè¾“å‡ºã€‚ -n, --no-interaction ä¸è¦æé—®ä»»ä½•äº¤äº’æ€§é—®é¢˜ã€‚ --no-plugins ç¦ç”¨æ’ä»¶ã€‚ --no-cache ç¦ç”¨æºç¼“å­˜ã€‚ -C, --directory=ç›®å½• Poetryå‘½ä»¤çš„å·¥ä½œç›®å½•ï¼ˆé»˜è®¤ä¸ºå½“å‰å·¥ä½œç›®å½•ï¼‰ã€‚ -v|vv|vvv, --verbose å¢åŠ æ¶ˆæ¯çš„å†—é•¿åº¦ï¼š1 è¡¨ç¤ºæ­£å¸¸è¾“å‡ºï¼Œ2 è¡¨ç¤ºæ›´è¯¦ç»†çš„è¾“å‡ºï¼Œ3 è¡¨ç¤ºè°ƒè¯•ã€‚å¯ç”¨å‘½ä»¤ï¼š about æ˜¾ç¤ºå…³äºPoetryçš„ä¿¡æ¯ã€‚ add å°†æ–°ä¾èµ–é¡¹æ·»åŠ åˆ°pyproject.tomlå¹¶å®‰è£…å®ƒã€‚ build é»˜è®¤æ„å»ºä¸€ä¸ªåŒ…ï¼Œåˆ†åˆ«æ˜¯tarballå’Œwheelã€‚ check éªŒè¯pyproject.tomlæ–‡ä»¶çš„å†…å®¹åŠå…¶ä¸poetry.lockæ–‡ä»¶çš„ä¸€è‡´æ€§ã€‚ config ç®¡ç†é…ç½®è®¾ç½®ã€‚ export å°†é”æ–‡ä»¶å¯¼å‡ºåˆ°å…¶ä»–æ ¼å¼ã€‚ help æ˜¾ç¤ºç‰¹å®šå‘½ä»¤çš„å¸®åŠ©ã€‚ init åœ¨å½“å‰ç›®å½•åˆ›å»ºä¸€ä¸ªåŸºç¡€çš„pyproject.tomlæ–‡ä»¶ã€‚ install å®‰è£…é¡¹ç›®ä¾èµ–é¡¹ã€‚ list åˆ—å‡ºå‘½ä»¤ã€‚ lock é”å®šé¡¹ç›®ä¾èµ–é¡¹ã€‚ new åœ¨&lt;path&gt;å¤„åˆ›å»ºä¸€ä¸ªæ–°çš„Pythoné¡¹ç›®ã€‚ publish å°†åŒ…å‘å¸ƒåˆ°è¿œç¨‹ä»“åº“ã€‚ remove ä»é¡¹ç›®ä¾èµ–é¡¹ä¸­ç§»é™¤åŒ…ã€‚ run åœ¨é€‚å½“çš„ç¯å¢ƒä¸­è¿è¡Œå‘½ä»¤ã€‚ search åœ¨è¿œç¨‹ä»“åº“ä¸­æœç´¢åŒ…ã€‚ shell åœ¨è™šæ‹Ÿç¯å¢ƒä¸­å¯åŠ¨shellã€‚ show æ˜¾ç¤ºæœ‰å…³åŒ…çš„ä¿¡æ¯ã€‚ update æ ¹æ®pyproject.tomlæ–‡ä»¶æ›´æ–°ä¾èµ–é¡¹ã€‚ version æ˜¾ç¤ºé¡¹ç›®çš„ç‰ˆæœ¬æˆ–åœ¨æä¾›æœ‰æ•ˆç‰ˆæœ¬è§„åˆ™æ—¶æ›´æ–°å®ƒã€‚ç¼“å­˜ cache clear æŒ‰åç§°æ¸…é™¤Poetryç¼“å­˜ã€‚ cache list åˆ—å‡ºPoetryçš„ç¼“å­˜åˆ—è¡¨ã€‚è°ƒè¯• debug info æ˜¾ç¤ºè°ƒè¯•ä¿¡æ¯ã€‚ debug resolve è°ƒè¯•ä¾èµ–é¡¹è§£æã€‚ç¯å¢ƒ env info æ˜¾ç¤ºå½“å‰ç¯å¢ƒçš„ä¿¡æ¯ã€‚ env list åˆ—å‡ºä¸å½“å‰é¡¹ç›®å…³è”çš„æ‰€æœ‰è™šæ‹Ÿç¯å¢ƒã€‚ env remove ç§»é™¤ä¸é¡¹ç›®å…³è”çš„è™šæ‹Ÿç¯å¢ƒã€‚ env use æ¿€æ´»æˆ–åˆ›å»ºå½“å‰é¡¹ç›®çš„æ–°çš„è™šæ‹Ÿç¯å¢ƒã€‚è‡ªèº« self add å‘Poetryçš„è¿è¡Œæ—¶ç¯å¢ƒæ·»åŠ å…¶ä»–åŒ…ã€‚ self install å®‰è£…æ­¤Poetryå®‰è£…æ‰€éœ€çš„é”å®šåŒ…ï¼ˆåŒ…æ‹¬æ’ä»¶ï¼‰ã€‚ self lock é”å®šPoetryå®‰è£…çš„ç³»ç»Ÿè¦æ±‚ã€‚ self remove ä»Poetryçš„è¿è¡Œæ—¶ç¯å¢ƒä¸­ç§»é™¤å…¶ä»–åŒ…ã€‚ self show æ˜¾ç¤ºPoetryè¿è¡Œæ—¶ç¯å¢ƒä¸­çš„åŒ…ã€‚ self show plugins æ˜¾ç¤ºå½“å‰å·²å®‰è£…æ’ä»¶çš„ä¿¡æ¯ã€‚ self update æ›´æ–°Poetryåˆ°æœ€æ–°ç‰ˆæœ¬ã€‚æº source add ä¸ºé¡¹ç›®æ·»åŠ æºé…ç½®ã€‚ source remove ç§»é™¤ä¸ºé¡¹ç›®é…ç½®çš„æºã€‚ source show æ˜¾ç¤ºä¸ºé¡¹ç›®é…ç½®çš„æºä¿¡æ¯ã€‚ å¸¸ç”¨å‘½ä»¤ è¿™é‡Œåªå¯¹æ—¥å¸¸å¼€å‘ä¸­æ¯”è¾ƒå¸¸ç”¨çš„å‘½ä»¤è¿›è¡Œç®€è¦è¯´æ˜ï¼Œè¯¦ç»†ä»‹ç»å¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£ new : åˆ›å»ºé¡¹ç›® 12345678910111213141516171819202122232425262728293031# æŒ‰ç…§é»˜è®¤è§„åˆ™åˆ›å»ºä¸€ä¸ªåŸºäº poetry çš„é¡¹ç›®$ poetry new my-projectCreated package my_project in my-project$ cd my-project# æŸ¥çœ‹ç”Ÿæˆçš„ç›®å½•ç»“æ„$ exa -T.â”œâ”€â”€ my_projectâ”‚ â””â”€â”€ __init__.pyâ”œâ”€â”€ pyproject.tomlâ”œâ”€â”€ README.mdâ””â”€â”€ tests â””â”€â”€ __init__.py# æŸ¥çœ‹ pyproject.toml å†…å®¹ï¼Œè¯¥æ–‡ä»¶ä¸ºé¡¹ç›®çš„é…ç½®çš„é…ç½®æ–‡ä»¶$ more pyproject.toml[tool.poetry]name = &quot;my-project&quot;version = &quot;0.1.0&quot;description = &quot;&quot;authors = [&quot;hanqunfeng &lt;hanqf2008@163.com&gt;&quot;]readme = &quot;README.md&quot;[tool.poetry.dependencies]python = &quot;^3.11&quot;[build-system]requires = [&quot;poetry-core&quot;]build-backend = &quot;poetry.core.masonry.api&quot; init : åˆå§‹åŒ–ä¸€ä¸ªå·²æœ‰çš„é¡¹ç›®ç›®å½• 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647# å‡è®¾æˆ‘ä»¬å·²ç»æœ‰ä¸ªé¡¹ç›®ç›®å½•ï¼Œç›®å½•åç§°ä¸º poetryDemo$ cd poetryDemo# åˆå§‹åŒ– poetryDemo ï¼Œåœ¨å½“å‰ç›®å½•ä¸‹åˆ›å»º pyproject.toml æ–‡ä»¶ï¼Œæ³¨æ„è¯¥æ“ä½œåªä¼šåˆ›å»ºè¯¥æ–‡ä»¶ï¼ŒåŒ…ç›®å½•ä»¥åŠreadmeæ–‡ä»¶éƒ½æ²¡æœ‰ï¼Œéœ€è¦æ‰‹å·¥åˆ›å»º$ poetry initThis command will guide you through creating your pyproject.toml config.Package name [poetrydemo]: # åŒ…åç§°Version [0.1.0]: # ç‰ˆæœ¬å·Description []: # æè¿°ä¿¡æ¯Author [hanqunfeng &lt;hanqf2008@163.com&gt;, n to skip]: # ä½œè€…License []: # LicenseCompatible Python versions [^3.11]: # python ç‰ˆæœ¬Would you like to define your main dependencies interactively? (yes/no) [yes] # æ‚¨æƒ³ä»¥äº¤äº’æ–¹å¼å®šä¹‰æ‚¨çš„ä¸»ç¯å¢ƒä¾èµ–å…³ç³»å—ï¼Ÿé»˜è®¤yesYou can specify a package in the following forms: # æ‚¨å¯ä»¥æŒ‰ä»¥ä¸‹å½¢å¼æŒ‡å®šåŒ…ï¼š - A single name (requests): this will search for matches on PyPI # å•ä¸ªåç§°ï¼ˆrequestsï¼‰ï¼šè¿™å°†åœ¨å®˜æ–¹ä»“åº“PyPIä¸Šæœç´¢åŒ¹é…é¡¹ï¼Œå¦‚æœæŒ‡å®šäº†å…¶å®ƒé•œåƒæºå°±ä¼šä»æŒ‡å®šçš„æºä¸‹è½½ - A name and a constraint (requests@^2.23.0) # åç§°å’Œç‰ˆæœ¬çº¦æŸ - A git url (git+https://github.com/python-poetry/poetry.git) # gitåœ°å€ - A git url with a revision (git+https://github.com/python-poetry/poetry.git#develop) # gitåœ°å€ï¼ŒæŒ‡å®šæŸä¸ªåˆ†æ”¯ - A file path (../my-package/my-package.whl) # æ–‡ä»¶è·¯å¾„ - A directory (../my-package/) # ç›®å½•è·¯å¾„ - A url (https://example.com/packages/my-package-0.1.0.tar.gz) # ä¸€ä¸ªå®‰è£…åŒ…çš„åœ°å€Package to add or search for (leave blank to skip): # æ·»åŠ ä¸»ç¯å¢ƒä¾èµ–ï¼ŒæŒ‰ä¸Šé¢çš„æ ¼å¼è¦æ±‚å¡«å†™Would you like to define your development dependencies interactively? (yes/no) [yes] # æ‚¨æƒ³ä»¥äº¤äº’æ–¹å¼å®šä¹‰æ‚¨çš„å¼€å‘ä¾èµ–å…³ç³»å—ï¼Ÿé»˜è®¤yesPackage to add or search for (leave blank to skip): # æ·»åŠ å¼€å‘ç¯å¢ƒä¾èµ–ï¼ŒæŒ‰ä¸Šé¢çš„æ ¼å¼è¦æ±‚å¡«å†™Generated file# è¦ç”Ÿæˆçš„ pyproject.toml å†…å®¹[tool.poetry]name = &quot;poetrydemo&quot; # åŒ…åç§°version = &quot;0.1.0&quot; # ç‰ˆæœ¬description = &quot;&quot; # æè¿°ä¿¡æ¯authors = [&quot;hanqunfeng &lt;hanqf2008@163.com&gt;&quot;] # ä½œè€…ä¿¡æ¯readme = &quot;README.md&quot; # è¯´æ˜æ–‡ä»¶[tool.poetry.dependencies] # ä¸»ç¯å¢ƒä¾èµ–python = &quot;^3.11&quot;[build-system]requires = [&quot;poetry-core&quot;]build-backend = &quot;poetry.core.masonry.api&quot;Do you confirm generation? (yes/no) [yes] # ç¡®è®¤æ˜¯å¦æŒ‰ç…§ä¸Šé¢çš„å†…å®¹åˆ›å»º pyproject.toml æ–‡ä»¶ï¼Œé»˜è®¤yes ä¸Šé¢çš„æ–¹å¼åœ¨åˆå§‹åŒ–æ—¶ä¼šè¯¢é—®ä½ ç›¸å…³çš„ä¿¡æ¯ï¼Œå¦‚æœä½ å¸Œæœ›éƒ½ç”¨é»˜è®¤å€¼çš„è¯ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ 1poetry init -n config : poetryçš„å…¨å±€é…ç½® æŸ¥çœ‹å…¨å±€é…ç½® 12345678910111213141516171819$ poetry config --listcache-dir = &quot;/Users/hanqf/Library/Caches/pypoetry&quot; # ç¼“å­˜ç›®å½•,ç”¨äºå­˜å‚¨é¡¹ç›®ä¾èµ–å’Œè™šæ‹Ÿç¯å¢ƒç­‰ç¼“å­˜ä¿¡æ¯ã€‚experimental.system-git-client = false # æ˜¯å¦ä½¿ç”¨ç³»ç»Ÿè‡ªå¸¦çš„gitå®¢æˆ·ç«¯,falseè¡¨ç¤ºä½¿ç”¨Poetryå†…ç½®çš„gitå®¢æˆ·ç«¯installer.max-workers = null # å®‰è£…ä¾èµ–æ—¶çš„æœ€å¤§çº¿ç¨‹æ•°,nullè¡¨ç¤ºä½¿ç”¨é»˜è®¤çº¿ç¨‹æ•°ï¼Œå¯ä»¥è®¾ç½®ä¸ºcpuæ ¸æ•°+4installer.modern-installation = true # æ˜¯å¦ä½¿ç”¨Poetryçš„ç°ä»£å®‰è£…æ–¹æ¡ˆ,trueè¡¨ç¤ºä½¿ç”¨installer.no-binary = null # æ˜¯å¦ä¸ä½¿ç”¨é¢„ç¼–è¯‘çš„äºŒè¿›åˆ¶åŒ…,nullè¡¨ç¤ºä¸é™åˆ¶installer.parallel = true # æ˜¯å¦å¹¶è¡Œå®‰è£…ä¾èµ–,trueè¡¨ç¤ºå¹¶è¡Œå®‰è£…keyring.enabled = true # æ˜¯å¦å¯ç”¨å¯†é’¥ç¯ï¼ˆkeyringï¼‰ä»¥ä¿å­˜è®¤è¯ä¿¡æ¯ã€‚true è¡¨ç¤ºå¯ç”¨ã€‚solver.lazy-wheel = true # æ˜¯å¦å»¶è¿Ÿè§£æ wheel åŒ…ã€‚true è¡¨ç¤ºå»¶è¿Ÿè§£æã€‚virtualenvs.create = true # æ˜¯å¦è‡ªåŠ¨åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ,trueè¡¨ç¤ºåˆ›å»ºvirtualenvs.in-project = null # æ˜¯å¦åœ¨é¡¹ç›®å†…åˆ›å»ºè™šæ‹Ÿç¯å¢ƒï¼Œnull è¡¨ç¤ºä½¿ç”¨é»˜è®¤å€¼ï¼ˆé€šå¸¸ä¸º falseï¼‰ï¼Œå³ä¸åœ¨é¡¹ç›®ä¸­åˆ›å»ºã€‚trueè¡¨ç¤ºåœ¨é¡¹ç›®ä¸­åˆ›å»ºvirtualenvs.options.always-copy = false # å¦‚æœè®¾ç½®ä¸º trueï¼ŒPoetry ä¼šå§‹ç»ˆå¤åˆ¶æ–‡ä»¶åˆ°è™šæ‹Ÿç¯å¢ƒä¸­ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ç¬¦å·é“¾æ¥ï¼ˆsymlinksï¼‰ã€‚è¿™å¯ä»¥é¿å…æŸäº›ç³»ç»Ÿä¸Šçš„æƒé™é—®é¢˜ï¼Œä½†ä¼šå¢åŠ è™šæ‹Ÿç¯å¢ƒçš„å­˜å‚¨éœ€æ±‚ã€‚virtualenvs.options.no-pip = false # å¦‚æœè®¾ç½®ä¸º trueï¼ŒPoetry åœ¨åˆ›å»ºè™šæ‹Ÿç¯å¢ƒæ—¶ä¸ä¼šå®‰è£… pipã€‚å¦‚æœä½ çš„é¡¹ç›®ä¸éœ€è¦ç›´æ¥ä½¿ç”¨ pipï¼Œå¹¶ä¸”ä½ å¸Œæœ›é€šè¿‡ Poetry ç®¡ç†æ‰€æœ‰çš„ä¾èµ–é¡¹ï¼Œå¯ä»¥å°† no-pip è®¾ç½®ä¸º trueï¼Œä»¥å‡å°‘è™šæ‹Ÿç¯å¢ƒä¸­çš„ä¸å¿…è¦çš„ä¾èµ–é¡¹ã€‚virtualenvs.options.no-setuptools = false # å¦‚æœè®¾ç½®ä¸º trueï¼ŒPoetry åœ¨åˆ›å»ºè™šæ‹Ÿç¯å¢ƒæ—¶ä¸ä¼šå®‰è£… setuptoolsã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒPoetry ä¼šå®‰è£… pip å’Œ setuptoolsï¼Œä»¥ä¾¿ä½ å¯ä»¥ä½¿ç”¨è¿™äº›å·¥å…·æ¥ç®¡ç†ä¾èµ–é¡¹ã€‚virtualenvs.options.system-site-packages = false # é»˜è®¤å€¼falseï¼Œæ­¤æ—¶ Poetry åˆ›å»ºçš„è™šæ‹Ÿç¯å¢ƒå°†ä¸ä¼šåŒ…å«å…¨å±€ Python å®‰è£…çš„ site-packages ç›®å½•ä¸­çš„åŒ…ã€‚è¿™æœ‰åŠ©äºç¡®ä¿é¡¹ç›®ä¾èµ–é¡¹çš„éš”ç¦»æ€§ï¼Œé¿å…ä¸ç³»ç»Ÿä¸­çš„å…¶ä»–åŒ…å‘ç”Ÿå†²çªã€‚virtualenvs.path = &quot;&#123;cache-dir&#125;/virtualenvs&quot; # /Users/hanqf/Library/Caches/pypoetry/virtualenvs # è™šæ‹Ÿç¯å¢ƒå­˜æ”¾çš„è·¯å¾„ï¼Œå¦‚æœvirtualenvs.in-projectè®¾ç½®ä¸ºtrueï¼Œå°±åªä¼šåœ¨é¡¹ç›®ä¸­åˆ›å»ºvirtualenvs.prefer-active-python = false # æ˜¯å¦ä¼˜å…ˆä½¿ç”¨ç³»ç»Ÿæ¿€æ´»çš„Pythonè§£é‡Šå™¨virtualenvs.prompt = &quot;&#123;project_name&#125;-py&#123;python_version&#125;&quot; # è™šæ‹Ÿç¯å¢ƒçš„å‘½ä»¤æç¤ºæ ¼å¼warnings.export = true # æ˜¯å¦åœ¨å¯¼å‡ºæ—¶æ˜¾ç¤ºè­¦å‘Šä¿¡æ¯ã€‚true è¡¨ç¤ºæ˜¾ç¤º ä¿®æ”¹å…¨å±€é…ç½® 1234567891011121314151617# ä¿®æ”¹å…¨å±€é…ç½®ï¼Œæ­¤åä¼šåœ¨é¡¹ç›®ç›®å½•ä¸‹åˆ›å»º .venv ç›®å½•å­˜æ”¾è™šæ‹Ÿç¯å¢ƒ$ poetry config virtualenvs.in-project true# è¿›å…¥è™šæ‹Ÿç¯å¢ƒï¼Œå¦‚æœè™šæ‹Ÿç¯å¢ƒå°šæœªåˆ›å»ºä¼šè‡ªåŠ¨åˆ›å»º$ poetry shell# é€€å‡ºè™šæ‹Ÿç¯å¢ƒ$ exit# åªå¯¹å½“å‰é¡¹ç›®æœ‰æ•ˆï¼Œæ­¤æ—¶ä¼šåœ¨å½“å‰é¡¹ç›®ç›®å½•ä¸‹åˆ›å»º poetry.toml æ¥ä¿å­˜è¿™äº›é…ç½®ä¿¡æ¯$ poetry config virtualenvs.in-project true --local$ poetry config virtualenvs.options.system-site-packages true --local$ more poetry.toml[virtualenvs]in-project = true[virtualenvs.options]system-site-packages = true# è¿™é‡Œè¦æ³¨æ„ virtualenvs ä¸‹çš„å±æ€§å¿…é¡»åœ¨åˆ›å»ºè™šæ‹Ÿç¯å¢ƒå‰è®¾ç½®æ‰ä¼šæœ‰æ•ˆ env : è™šæ‹Ÿç¯å¢ƒç®¡ç† Poetry ä¼šåœ¨ä½ ç¬¬ä¸€æ¬¡è¿è¡ŒæŸäº›å‘½ä»¤ï¼ˆå¦‚ poetry shell æˆ–è€… poetry add somepackageï¼‰æ—¶è‡ªåŠ¨åˆ›å»ºè™šæ‹Ÿç¯å¢ƒã€‚ ä¸è¿‡è¿™ç§æ—¶å€™éƒ½æ˜¯ä½¿ç”¨ç³»ç»Ÿé»˜è®¤çš„pythonæ¥åˆ›å»ºè™šæ‹Ÿç¯å¢ƒï¼Œå¦‚æœç³»ç»Ÿä¸­å®‰è£…äº†å¤šä¸ªpythonï¼Œåˆ™å¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹å¼è®¾ç½®è™šæ‹Ÿç¯å¢ƒè¦ä½¿ç”¨å“ªä¸ªpythonç‰ˆæœ¬ åˆ›å»º/åˆ‡æ¢è™šæ‹Ÿç¯å¢ƒ 123456789# æŒ‡å®špythonçš„ç‰ˆæœ¬ï¼Œè¿™ä¼šä»pythonçš„é»˜è®¤å®‰è£…è·¯å¾„ä¸‹æŸ¥æ‰¾å¯¹åº”çš„ç‰ˆæœ¬# æ¯”å¦‚macOsä¼šä»è¯¥è·¯å¾„ä¸‹æŸ¥æ‰¾ï¼š/Library/Frameworks/Python.framework/Versions$ poetry env use 3.11# å¦‚æœå¯ä»¥ç›´æ¥åœ¨å‘½ä»¤è¡Œä½¿ç”¨pythonå‘½ä»¤,æ¯”å¦‚ï¼špython3.12 -Vï¼Œåˆ™å¯ä»¥ä½¿ç”¨å¦‚ä¸‹æ–¹å¼åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ$ poetry env use python3.12# å¦‚æœpythonå®‰è£…åˆ°äº†å…¶å®ƒè·¯å¾„ï¼Œå¯ä»¥æŒ‡å®špythonå®‰è£…è·¯å¾„$ poetry env use /pythonDir/3.13/bin/python3 æŸ¥çœ‹å½“å‰é¡¹ç›®çš„è™šæ‹Ÿç¯å¢ƒä¿¡æ¯ 12345678910111213141516171819202122232425262728293031323334353637383940# åˆ›å»ºä¸€ä¸ªåŸºäº python3.13 çš„è™šæ‹Ÿç¯å¢ƒ$ poetry env use python3.13Creating virtualenv poetrydemo-fyqYbfje-py3.13 in /Users/hanqf/Library/Caches/pypoetry/virtualenvsUsing virtualenv: /Users/hanqf/Library/Caches/pypoetry/virtualenvs/poetrydemo-fyqYbfje-py3.13# å†åˆ›å»ºä¸€ä¸ªåŸºäº python3.11 çš„è™šæ‹Ÿç¯å¢ƒï¼Œæœ€åè¢«useçš„å¤„äºé»˜è®¤æ¿€æ´»çŠ¶æ€$ poetry env use python3.11Creating virtualenv poetrydemo-fyqYbfje-py3.11 in /Users/hanqf/Library/Caches/pypoetry/virtualenvsUsing virtualenv: /Users/hanqf/Library/Caches/pypoetry/virtualenvs/poetrydemo-fyqYbfje-py3.11# æŸ¥çœ‹å½“å‰é¡¹ç›®æœ‰å¤šå°‘ä¸ªè™šæ‹Ÿç¯å¢ƒ$ poetry env listpoetrydemo-fyqYbfje-py3.11 (Activated) # poetrydemo-fyqYbfje-py3.11 è¡¨ç¤ºè™šæ‹Ÿç¯å¢ƒåç§°ï¼ŒActivatedè¡¨ç¤ºå½“å‰è™šæ‹Ÿç¯å¢ƒå·²ç»è¢«æ¿€æ´»poetrydemo-fyqYbfje-py3.13# æŸ¥çœ‹è™šæ‹ŸåŒ–ç¯å¢ƒè·¯å¾„$ poetry env list --full-path/Users/hanqf/Library/Caches/pypoetry/virtualenvs/poetrydemo-fyqYbfje-py3.11 (Activated)# æŸ¥çœ‹å½“å‰æ¿€æ´»çš„è™šæ‹Ÿç¯å¢ƒä¿¡æ¯$ poetry env infoVirtualenvPython: 3.11.3Implementation: CPythonPath: /Users/hanqf/Library/Caches/pypoetry/virtualenvs/poetrydemo-fyqYbfje-py3.11Executable: /Users/hanqf/Library/Caches/pypoetry/virtualenvs/poetrydemo-fyqYbfje-py3.11/bin/pythonValid: TrueBasePlatform: darwinOS: posixPython: 3.11.3Path: /Library/Frameworks/Python.framework/Versions/3.11Executable: /Library/Frameworks/Python.framework/Versions/3.11/bin/python3.11# åˆ é™¤è™šæ‹Ÿç¯å¢ƒ$ poetry env remove python3.13Deleted virtualenv: /Users/hanqf/Library/Caches/pypoetry/virtualenvs/poetrydemo-fyqYbfje-py3.13# åˆ é™¤å…¨éƒ¨è™šæ‹Ÿç¯å¢ƒ$ poetry env remove --all æ³¨æ„ï¼Œå½“virtualenvs.in-projectè¢«è®¾ç½®ä¸ºtrueæ—¶ï¼Œå³åªåœ¨é¡¹ç›®ç›®å½•ä¸‹åˆ›å»ºè™šæ‹Ÿç¯å¢ƒæ—¶ï¼Œåªä¼šä¿ç•™ä¸€ä¸ªç¯å¢ƒï¼Œå³.venv åˆ‡æ¢åˆ°æ–°çš„è™šæ‹Ÿç¯å¢ƒæ—¶ä¼šå…¨æ–°åˆ›å»ºä¸€ä¸ªæ–°çš„ç¯å¢ƒï¼ŒåŸå…ˆçš„ç¯å¢ƒä¼šè¢«åˆ é™¤ï¼Œæ‰€ä»¥è¦ä½¿ç”¨poetry installå‘½ä»¤é‡æ–°å®‰è£…ä¾èµ– 123456789101112131415161718192021222324$ poetry env use python3.11Recreating virtualenv poetrydemo in /Users/hanqf/Desktop/pythonDir/poetryDir/poetryDemo/.venvUsing virtualenv: /Users/hanqf/Desktop/pythonDir/poetryDir/poetryDemo/.venv$ poetry env list # è™½ç„¶å¯ä»¥é€šè¿‡ poetry env use çš„æ–¹å¼æ¥åˆ›å»ºæ–°çš„è™šæ‹Ÿç¯å¢ƒï¼Œä½†å®é™…ä¸Šåªä¼šæœ‰ä¸€ä¸ªç¯å¢ƒè¢«ä¿ç•™ï¼Œæ‰€ä»¥è¿™é‡Œåªä¼šæ˜¾ç¤ºä¸€ä¸ª.venv (Activated) # .venv è¡¨ç¤ºè™šæ‹Ÿç¯å¢ƒåç§°ï¼ŒActivatedè¡¨ç¤ºå½“å‰è™šæ‹Ÿç¯å¢ƒå·²ç»è¢«æ¿€æ´»# æŸ¥çœ‹è™šæ‹Ÿç¯å¢ƒä¿¡æ¯$ poetry env infoVirtualenvPython: 3.11.3Implementation: CPythonPath: /Users/hanqf/Desktop/pythonDir/poetryDir/poetryDemo/.venvExecutable: /Users/hanqf/Desktop/pythonDir/poetryDir/poetryDemo/.venv/bin/pythonValid: TrueBasePlatform: darwinOS: posixPython: 3.11.3Path: /Library/Frameworks/Python.framework/Versions/3.11Executable: /Library/Frameworks/Python.framework/Versions/3.11/bin/python3.11 ä¾èµ–åŒ…ç®¡ç† add : å®‰è£…ä¾èµ–åŒ… è¿™ä¸ªå‘½ä»¤ä¼šä¿®æ”¹ pyproject.toml æ–‡ä»¶ï¼Œåœ¨ [tool.poetry.dependencies] éƒ¨åˆ†æ·»åŠ æ–°çš„ä¾èµ–é¡¹ã€‚è¿˜ä¼šè‡ªåŠ¨æ›´æ–° poetry.lock æ–‡ä»¶ï¼Œé”å®šä¾èµ–çš„ç¡®åˆ‡ç‰ˆæœ¬ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556# å®‰è£…ä¾èµ–ï¼Œå®‰è£…åä¼šå°†ä¾èµ–ä¿¡æ¯å†™å…¥ pyproject.toml ä¸­# ä¸æŒ‡å®šç‰ˆæœ¬åˆ™å®‰è£…æœ€æ–°ç‰ˆ$ poetry add fastapiUsing version ^0.115.5 for fastapiUpdating dependenciesResolving dependencies... (1.3s)Package operations: 9 installs, 0 updates, 0 removals - Installing idna (3.10) - Installing sniffio (1.3.1) - Installing typing-extensions (4.12.2) - Installing annotated-types (0.7.0) - Installing anyio (4.6.2.post1) - Installing pydantic-core (2.23.4) - Installing pydantic (2.9.2) - Installing starlette (0.41.3) - Installing fastapi (0.115.5)Writing lock file# æŒ‡å®šç‰ˆæœ¬å·å®‰è£…ä¾èµ–poetry add package_name@^1.2.3 # è§„åˆ™è¯´æ˜ ^1.2.3 è¡¨ç¤ºå…¼å®¹ 1.2.3 åŠæ›´é«˜çš„å°ç‰ˆæœ¬ï¼Œä½†ä¸åŒ…æ‹¬ 2.0.0ã€‚ å¦‚ï¼špoetry add requests@^2.28.0 ~1.2.3ï¼šå…è®¸å‡çº§åˆ° 1.2.xï¼Œä½†ä¸åŒ…æ‹¬ 1.3.0ã€‚ å¦‚ï¼špoetry add requests@~2.28.0 1.2.3ï¼šå›ºå®šä¸º 1.2.3ã€‚ å¦‚ï¼špoetry add requests@2.28.0 &gt;=1.2.3ï¼šå…è®¸ä½¿ç”¨ 1.2.3 åŠä»¥ä¸Šç‰ˆæœ¬ã€‚æ³¨æ„zshä¸‹è¦åŠ ä¸ŠåŒå¼•å·ï¼Œå¦‚ï¼špoetry add &quot;requests@&gt;=2.28.0&quot; &lt;2.0.0ï¼šå…è®¸ä½¿ç”¨å°äº 2.0.0 çš„ç‰ˆæœ¬ã€‚ æ³¨æ„zshä¸‹è¦åŠ ä¸ŠåŒå¼•å·ï¼Œå¦‚ï¼špoetry add &quot;requests@&lt;3.0.0&quot;# å®‰è£…åˆ°æŒ‡å®šçš„åˆ†ç»„ï¼Œé»˜è®¤éƒ½æ˜¯å®‰è£…åˆ°ä¸»ç¯å¢ƒä¸­çš„ï¼Œpoetry buildé»˜è®¤åªä¼šæ‰“åŒ…ä¸»ç¯å¢ƒçš„ä¾èµ–poetry add flask # å®‰è£…åˆ°ä¸»ç¯å¢ƒä¸­poetry add flask --group=test #æ·»åŠ åˆ†ç»„å testpoetry add flask --dev #ç›¸å½“äº--group=dev# åˆ†åˆ«æ‰§è¡Œä¸Šé¢3ä¸ªå®‰è£…å‘½ä»¤åï¼Œè¾“å‡º pyproject.toml çš„å†…å®¹å¦‚ä¸‹[tool.poetry]name = &quot;poetrydemo&quot;version = &quot;0.1.0&quot;description = &quot;&quot;authors = [&quot;hanqunfeng &lt;hanqf2008@163.com&gt;&quot;]readme = &quot;README.md&quot;[tool.poetry.dependencies] # ä¸»ç¯å¢ƒpython = &quot;^3.11&quot;flask = &quot;^3.1.0&quot;[tool.poetry.group.test.dependencies] # teståˆ†ç»„ä¾èµ–flask = &quot;^3.1.0&quot;[tool.poetry.group.dev.dependencies] # devåˆ†ç»„ä¾èµ–flask = &quot;^3.1.0&quot;[build-system]requires = [&quot;poetry-core&quot;]build-backend = &quot;poetry.core.masonry.api&quot; show : æŸ¥çœ‹ä¾èµ–åŒ… 123456789101112131415# æŸ¥çœ‹å½“å‰é¡¹ç›®éƒ½éœ€è¦å“ªäº›ä¾èµ–ï¼Œè¿™äº›ä¾èµ–ä¸ä¸€å®šéƒ½å®‰è£…äº†ï¼Œå®ƒåªæ˜¯è§£æ pyproject.toml ä¸­çš„å£°æ˜æ¥è§£æä¾èµ–æ ‘$ poetry showannotated-types 0.7.0 Reusable constraint types to use with typing.Annotatedanyio 4.6.2.post1 High level compatibility layer for multiple asynchronous ...fastapi 0.115.5 FastAPI framework, high performance, easy to learn, fast ...idna 3.10 Internationalized Domain Names in Applications (IDNA)pydantic 2.9.2 Data validation using Python type hintspydantic-core 2.23.4 Core functionality for Pydantic validation and serializationsniffio 1.3.1 Sniff out which async library your code is running understarlette 0.41.3 The little ASGI library that shines.typing-extensions 4.12.2 Backported and Experimental Type Hints for Python 3.8+# åªæŸ¥çœ‹é¡¶çº§ä¾èµ–ï¼Œå³åªæŸ¥çœ‹åœ¨ pyproject.toml ä¸­å£°æ˜çš„ä¾èµ–$ poetry show --top-levelfastapi 0.115.5 FastAPI framework, high performance, easy to learn, fast ... remove : åˆ é™¤ä¾èµ–åŒ… 123456789101112131415161718# åˆ é™¤ä¾èµ–ï¼Œæ­¤æ—¶ä¼šå°†å½“å‰åŒ…åŠå…¶æ‰€æœ‰ä¾èµ–ä¸€å—åˆ é™¤$ poetry remove fastapiUpdating dependenciesResolving dependencies... (0.1s)Package operations: 0 installs, 0 updates, 9 removals - Removing annotated-types (0.7.0) - Removing anyio (4.6.2.post1) - Removing fastapi (0.115.5) - Removing idna (3.10) - Removing pydantic (2.9.2) - Removing pydantic-core (2.23.4) - Removing sniffio (1.3.1) - Removing starlette (0.41.3) - Removing typing-extensions (4.12.2)Writing lock file search : æœç´¢è¿œç¨‹ä»“åº“ 12# æœç´¢è¿œç¨‹ä»“åº“$ poetry search fastapi install å’Œ update : å®‰è£…å’Œæ›´æ–°ä¾èµ–åŒ… åœ¨ Poetry ä¸­ï¼Œinstall å’Œ update æ˜¯ä¸¤ä¸ªå¸¸ç”¨çš„å‘½ä»¤ï¼Œä½†å®ƒä»¬çš„ä½œç”¨å’Œä½¿ç”¨åœºæ™¯ä¸åŒ poetry install çš„ä½œç”¨æ˜¯æ ¹æ®ç°æœ‰çš„ poetry.lock æ–‡ä»¶æ¥å®‰è£…ä¾èµ–ï¼Œç¡®ä¿å®‰è£…çš„ä¾èµ–ç‰ˆæœ¬ä¸é”æ–‡ä»¶ä¸­è®°å½•çš„ç‰ˆæœ¬å®Œå…¨ä¸€è‡´ã€‚ æ ¸å¿ƒç‰¹ç‚¹ï¼š å®‰è£…é”å®šçš„ç‰ˆæœ¬ï¼šå®ƒåªä¼šå®‰è£… poetry.lock æ–‡ä»¶ä¸­æŒ‡å®šçš„ç‰ˆæœ¬ï¼Œå³ä½¿ pyproject.toml æ–‡ä»¶ä¸­å®šä¹‰çš„ç‰ˆæœ¬èŒƒå›´å·²ç»æœ‰æ›´æ–°ç‰ˆæœ¬ã€‚ é‡ç°ä¾èµ–ç¯å¢ƒï¼šé€‚ç”¨äºå›¢é˜Ÿåä½œæˆ–éƒ¨ç½²ç¯å¢ƒï¼Œç¡®ä¿æ‰€æœ‰äººæˆ–æœºå™¨å®‰è£…çš„ä¾èµ–ç‰ˆæœ¬å®Œå…¨ç›¸åŒã€‚ é”æ–‡ä»¶å­˜åœ¨æ—¶æ›´é«˜æ•ˆï¼šå¦‚æœ poetry.lock æ–‡ä»¶å­˜åœ¨ï¼Œpoetry install ä¸ä¼šé‡æ–°è§£æä¾èµ–æ ‘ã€‚ é¦–æ¬¡è¿è¡Œæ—¶ç”Ÿæˆé”æ–‡ä»¶ï¼šå¦‚æœæ²¡æœ‰ poetry.lock æ–‡ä»¶ï¼Œpoetry install ä¼šè§£æä¾èµ–å¹¶ç”Ÿæˆé”æ–‡ä»¶ã€‚ ä½¿ç”¨åœºæ™¯ï¼š æ–°å…‹éš†çš„é¡¹ç›®ï¼Œéœ€è¦å®‰è£…ä¾èµ–ç¯å¢ƒã€‚ éƒ¨ç½²ç”Ÿäº§ç¯å¢ƒï¼Œç¡®ä¿ä¾èµ–ç‰ˆæœ¬çš„ç¨³å®šæ€§ã€‚ é‡æ–°å®‰è£…ä¹‹å‰å·²å®šä¹‰çš„ä¾èµ–ï¼ˆä¾‹å¦‚æ¸…ç©ºäº†è™šæ‹Ÿç¯å¢ƒï¼‰ã€‚ poetry update çš„ä½œç”¨æ˜¯æ ¹æ® pyproject.toml æ–‡ä»¶ä¸­å®šä¹‰çš„ä¾èµ–èŒƒå›´é‡æ–°è§£æä¾èµ–æ ‘ï¼Œå¹¶æ›´æ–° poetry.lock æ–‡ä»¶ä¸ºæœ€æ–°çš„ç‰ˆæœ¬ã€‚ æ ¸å¿ƒç‰¹ç‚¹ï¼š æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬ï¼šå®ƒä¼šå°è¯•å®‰è£…ä¾èµ–èŒƒå›´å†…çš„æœ€æ–°ç‰ˆæœ¬ï¼Œå¹¶æ›´æ–° poetry.lock æ–‡ä»¶ã€‚ è§£ææ–°çš„ä¾èµ–æ ‘ï¼šå³ä½¿ poetry.lock æ–‡ä»¶å­˜åœ¨ï¼Œpoetry update ä¹Ÿä¼šå¿½ç•¥å®ƒå¹¶é‡æ–°è§£æä¾èµ–ã€‚ æ›´æ”¹é”æ–‡ä»¶ï¼šå®ƒä¼šè¦†ç›–ç°æœ‰çš„ poetry.lock æ–‡ä»¶ï¼Œå› æ­¤å›¢é˜Ÿå…¶ä»–æˆå‘˜éœ€è¦é‡æ–°è¿è¡Œ poetry install ä»¥åŒæ­¥ã€‚ ä½¿ç”¨åœºæ™¯ï¼š æ›´æ–°ä¾èµ–åˆ°æœ€æ–°ç‰ˆæœ¬ï¼ˆåœ¨ä¾èµ–èŒƒå›´å†…ï¼‰ã€‚ å½“æ·»åŠ æ–°ä¾èµ–åï¼Œæƒ³è¦å®‰è£…å¹¶æ›´æ–°é”æ–‡ä»¶ã€‚ ä¿®å¤å¯èƒ½çš„ç‰ˆæœ¬å†²çªæˆ–ä¸å…¼å®¹é—®é¢˜ã€‚ lock : é”å®šä¾èµ–åŒ… poetry lock æ˜¯ Poetryï¼ˆä¸€ä¸ª Python åŒ…ç®¡ç†å·¥å…·ï¼‰ä¸­çš„ä¸€ä¸ªå‘½ä»¤ï¼Œç”¨äºé”å®šé¡¹ç›®çš„ä¾èµ–å…³ç³»ã€‚ä½¿ç”¨è¿™ä¸ªå‘½ä»¤å¯ä»¥åˆ›å»ºæˆ–æ›´æ–° poetry.lock æ–‡ä»¶ï¼Œç¡®ä¿ä½ çš„é¡¹ç›®ä¸­æ‰€ä½¿ç”¨çš„æ¯ä¸ªåŒ…çš„ç‰ˆæœ¬éƒ½è¢«æ˜ç¡®è®°å½•ä¸‹æ¥ã€‚è¿™æ ·åšå¯¹äºé¡¹ç›®çš„å¯å¤ç°æ€§å’Œç¨³å®šæ€§è‡³å…³é‡è¦ã€‚ å®é™…ä¸Šï¼Œå½“è¿è¡Œ poetry install ã€ poetry update æˆ–è€… poetry add ç­‰å‘½ä»¤æ—¶ï¼Œ poetry éƒ½ä¼šæ ¹æ® pyproject.toml æ–‡ä»¶ä¸­çš„ä¾èµ–èŒƒå›´ï¼Œè§£æä¾èµ–æ ‘ï¼Œå¹¶åœ¨é¡¹ç›®ç›®å½•ä¸‹åˆ›å»ºæˆ–æ›´æ–° poetry.lock æ–‡ä»¶ã€‚ å½“æˆ‘ä»¬æ‰‹å·¥ä¿®æ”¹äº† pyproject.toml æ–‡ä»¶ä¸­çš„ä¾èµ–èŒƒå›´ï¼Œæ­¤æ—¶åˆä¸æƒ³ç«‹åˆ»æ›´æ–°ä¾èµ–ï¼Œè€Œæ˜¯å¸Œæœ›åœ¨æŸä¸ªæ—¶æœºå†æ›´æ–°ï¼Œæ­¤æ—¶å°±å¯ä»¥ä½¿ç”¨ poetry lock å‘½ä»¤ï¼Œå…ˆé”å®šè¿™äº›ä¾èµ–ï¼Œä¹‹åå†é€šè¿‡ poetry install å‘½ä»¤å®‰è£…ã€‚ å¯ä»¥ä½¿ç”¨ poetry check å‘½ä»¤æ£€æŸ¥ pyproject.toml æ–‡ä»¶ ä¸ poetry.lock æ–‡ä»¶çš„ä¸€è‡´æ€§ã€‚ 12345678910111213# æ¯”å¦‚æˆ‘æ‰‹å·¥åˆ é™¤äº† `pyproject.toml` æ–‡ä»¶ä¸­çš„æŸä¸ªä¾èµ–# æ­¤æ—¶è¿è¡Œ check æ£€æŸ¥ä¸€è‡´æ€§ä¼šæŠ¥é”™$ poetry checkError: pyproject.toml changed significantly since poetry.lock was last generated. Run `poetry lock [--no-update]` to fix the lock file.# é”å®šä¾èµ–$ poetry lockUpdating dependenciesResolving dependencies... (0.1s)Writing lock file# æ£€æŸ¥ä¸€è‡´æ€§é€šè¿‡$ poetry checkAll set! å°è´´å£« æ³¨æ„ï¼Œæ­¤æ—¶é€šè¿‡ poetry show æŸ¥çœ‹ä¸åˆ°é‚£ä¸ªæ‰‹å·¥åˆ é™¤çš„ä¾èµ–åŒ…ï¼Œä½†å®é™…ä¸Šä¾èµ–ä¾æ—§åœ¨äºè™šæ‹Ÿç¯å¢ƒä¸­ æ‰€ä»¥å°½é‡é¿å…æ‰‹å·¥åˆ é™¤ä¾èµ–ï¼Œè€Œæ˜¯é€šè¿‡ poetry remove å‘½ä»¤æ¥åˆ é™¤ä¾èµ– source : é•œåƒæºç®¡ç† é»˜è®¤æƒ…å†µä¸‹éƒ½æ˜¯ä»Pypiçš„å®˜æ–¹ä»“åº“ä¸‹è½½ï¼Œå›½å†…ä¸€èˆ¬éœ€è¦æŒ‡å®šé•œåƒæºæ¥åŠ é€Ÿä¸‹è½½ 123456789101112131415161718192021222324252627282930313233# æ·»åŠ é•œåƒæºï¼Œé»˜è®¤å°±æ˜¯ä¸»è¦æºï¼Œæ³¨æ„è¯¥æ–¹å¼åªå¯¹å½“å‰é¡¹ç›®æœ‰æ•ˆ# å‘½ä»¤æ ¼å¼ï¼špoetry source add [é€‰é¡¹] [--] &lt;name&gt; [&lt;url&gt;]ï¼Œnameï¼šæºä»“åº“çš„åç§°ï¼Œurlï¼šæºä»“åº“çš„ URL$ poetry source add tsinghua https://pypi.tuna.tsinghua.edu.cn/simpleAdding source with name tsinghua.# --priority=PRIORITYè®¾ç½®æ­¤æºçš„ä¼˜å…ˆçº§ã€‚å¯ä»¥æ˜¯ä»¥ä¸‹å€¼ä¹‹ä¸€ï¼šdefaultï¼ˆé»˜è®¤ï¼‰ã€primaryï¼ˆä¸»è¦ï¼‰ã€supplementalï¼ˆå¤‡ç”¨ï¼‰ã€explicitï¼ˆæ˜¾å¼æºï¼Œåªæœ‰å½“åŒ…æ˜ç¡®å£°æ˜ä½¿ç”¨è¯¥æºæ—¶æ‰ä¼šè¢«ä½¿ç”¨ï¼‰ã€‚é»˜è®¤ä¸º primaryã€‚$ poetry source add --priority=supplemental aliyun http://mirrors.aliyun.com/pypi/simple/# æŸ¥çœ‹é•œåƒæºä¿¡æ¯$ poetry source show name : tsinghua url : https://pypi.tuna.tsinghua.edu.cn/simple priority : primary name : aliyun url : http://mirrors.aliyun.com/pypi/simple/ priority : supplemental# æ­¤æ—¶æŸ¥çœ‹ pyproject.toml æ–‡ä»¶å¯ä»¥çœ‹åˆ°é•œåƒæºä¿¡æ¯[[tool.poetry.source]]name = &quot;tsinghua&quot;url = &quot;https://pypi.tuna.tsinghua.edu.cn/simple&quot;priority = &quot;primary&quot;[[tool.poetry.source]]name = &quot;aliyun&quot;url = &quot;http://mirrors.aliyun.com/pypi/simple/&quot;priority = &quot;supplemental&quot;# åˆ é™¤é•œåƒæº$ poetry source remove aliyun # æŒ‡å®šé•œåƒæºåç§°Removing source with name aliyun. è¿è¡Œ è¿™é‡Œä»¥ä¸€ä¸ªå°ç¤ºä¾‹æ¥è¯´æ˜è¿™ä¸ªåŠŸèƒ½ åˆ›å»ºä¸€ä¸ªæ–°çš„é¡¹ç›® 123456789101112131415161718192021$ poetry new poetryDemoCreated package poetrydemo in poetryDemo# è¿›å…¥é¡¹ç›®ç›®å½•$ cd poetryDemo# æŸ¥çœ‹ç”Ÿæˆçš„æ–‡ä»¶$ lltotal 8drwxr-xr-x 6 hanqf staff 192 11 21 17:32 .drwxr-xr-x 4 hanqf staff 128 11 21 17:32 ..-rw-r--r-- 1 hanqf staff 0 11 21 17:32 README.mddrwxr-xr-x 3 hanqf staff 96 11 21 17:32 poetrydemo-rw-r--r-- 1 hanqf staff 266 11 21 17:32 pyproject.tomldrwxr-xr-x 3 hanqf staff 96 11 21 17:32 tests# è¿›å…¥åŒ…ç›®å½•$ cd poetrydemo# æŸ¥çœ‹åŒ…ç›®å½•ä¸‹çš„æ–‡ä»¶$ lltotal 0drwxr-xr-x 3 hanqf staff 96 11 21 17:32 .drwxr-xr-x 6 hanqf staff 192 11 21 17:32 ..-rw-r--r-- 1 hanqf staff 0 11 21 17:32 __init__.py åœ¨åŒ…ç›®å½•ä¸‹åˆ›å»º array_util.pyï¼Œå†…å®¹å¦‚ä¸‹ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152import numpy as npdef generate_random_array(shape, distribution=&quot;uniform&quot;, params=None, seed=None): &quot;&quot;&quot; ç”Ÿæˆéšæœºæ•°ç»„çš„å·¥å…·æ–¹æ³•ã€‚ :param shape: tupleï¼ŒæŒ‡å®šæ•°ç»„çš„å½¢çŠ¶ï¼Œä¾‹å¦‚ (3, 4) è¡¨ç¤º 3 è¡Œ 4 åˆ—ã€‚ :param distribution: strï¼ŒæŒ‡å®šéšæœºæ•°åˆ†å¸ƒç±»å‹ï¼Œå¯é€‰å€¼ï¼š - &quot;uniform&quot;ï¼šå‡åŒ€åˆ†å¸ƒï¼ˆé»˜è®¤ï¼‰ã€‚ - &quot;normal&quot;ï¼šæ­£æ€åˆ†å¸ƒã€‚ - &quot;integer&quot;ï¼šéšæœºæ•´æ•°ã€‚ :param params: dictï¼Œåˆ†å¸ƒçš„å‚æ•°é…ç½®ï¼š - å‡åŒ€åˆ†å¸ƒï¼š&#123;&quot;low&quot;: æœ€å°å€¼, &quot;high&quot;: æœ€å¤§å€¼&#125;ï¼Œé»˜è®¤ low=0, high=1ã€‚ - æ­£æ€åˆ†å¸ƒï¼š&#123;&quot;mean&quot;: å‡å€¼, &quot;std&quot;: æ ‡å‡†å·®&#125;ï¼Œé»˜è®¤ mean=0, std=1ã€‚ - éšæœºæ•´æ•°ï¼š&#123;&quot;low&quot;: æœ€å°å€¼, &quot;high&quot;: æœ€å¤§å€¼, &quot;dtype&quot;: ç±»å‹&#125;ï¼Œé»˜è®¤ low=0, high=10ã€‚ :param seed: intï¼Œéšæœºæ•°ç§å­ï¼ˆå¯é€‰ï¼‰ï¼Œç”¨äºç»“æœå¯å¤ç°ã€‚ :return: np.ndarrayï¼Œç”Ÿæˆçš„éšæœºæ•°ç»„ã€‚ &quot;&quot;&quot; if seed is not None: np.random.seed(seed) if params is None: params = &#123;&#125; if distribution == &quot;uniform&quot;: low = params.get(&quot;low&quot;, 0) high = params.get(&quot;high&quot;, 1) return np.random.uniform(low, high, size=shape) elif distribution == &quot;normal&quot;: mean = params.get(&quot;mean&quot;, 0) std = params.get(&quot;std&quot;, 1) return np.random.normal(mean, std, size=shape) elif distribution == &quot;integer&quot;: low = params.get(&quot;low&quot;, 0) high = params.get(&quot;high&quot;, 10) dtype = params.get(&quot;dtype&quot;, int) return np.random.randint(low, high, size=shape, dtype=dtype) else: raise ValueError(&quot;ä¸æ”¯æŒçš„åˆ†å¸ƒç±»å‹ï¼å¯é€‰å€¼ä¸º &#x27;uniform&#x27;, &#x27;normal&#x27;, &#x27;integer&#x27;ã€‚&quot;)# ç¤ºä¾‹ç”¨æ³•if __name__ == &quot;__main__&quot;: array_uniform = generate_random_array((3, 4), distribution=&quot;uniform&quot;, params=&#123;&quot;low&quot;: 1, &quot;high&quot;: 10&#125;) array_normal = generate_random_array((2, 3), distribution=&quot;normal&quot;, params=&#123;&quot;mean&quot;: 0, &quot;std&quot;: 1&#125;, seed=42) array_integer = generate_random_array((4, 5), distribution=&quot;integer&quot;, params=&#123;&quot;low&quot;: 0, &quot;high&quot;: 20&#125;) print(&quot;å‡åŒ€åˆ†å¸ƒéšæœºæ•°ç»„ï¼š\\n&quot;, array_uniform) print(&quot;æ­£æ€åˆ†å¸ƒéšæœºæ•°ç»„ï¼š\\n&quot;, array_normal) print(&quot;éšæœºæ•´æ•°æ•°ç»„ï¼š\\n&quot;, array_integer) å®‰è£…ä¾èµ– 1234567891011$ poetry add numpyUsing version ^2.1.3 for numpyUpdating dependenciesResolving dependencies... (1.1s)Package operations: 1 install, 0 updates, 0 removals - Installing numpy (2.1.3)Writing lock file è¿è¡Œï¼Œä¸¤ç§æ–¹æ³• poetry run 12345678910111213$ poetry run python array_util.pyå‡åŒ€åˆ†å¸ƒéšæœºæ•°ç»„ï¼š[[7.44623063 1.89415788 4.81008329 4.25556572][3.31925154 6.44037063 5.3216543 7.54950573][3.97160747 5.04800698 3.28299934 3.42841887]]æ­£æ€åˆ†å¸ƒéšæœºæ•°ç»„ï¼š[[ 0.49671415 -0.1382643 0.64768854][ 1.52302986 -0.23415337 -0.23413696]]éšæœºæ•´æ•°æ•°ç»„ï¼š[[10 10 3 7 2][ 1 11 5 1 0][11 11 16 9 15][14 14 18 11 19]] poetry shell : æ­¤æ—¶ä¼šå¼€å¯ä¸€ä¸ªæ–°çš„shellï¼Œå¹¶å¼€å¯è™šæ‹Ÿç¯å¢ƒ 1234567# å¼€å¯è™šæ‹Ÿç¯å¢ƒ$ poetry shellSpawning shell within /Users/hanqf/Library/Caches/pypoetry/virtualenvs/poetrydemo-fyqYbfje-py3.11Restored session: 2024å¹´11æœˆ21æ—¥ æ˜ŸæœŸå›› 15æ—¶31åˆ†52ç§’ CSTâœ poetrydemo emulate bash -c &#x27;. /Users/hanqf/Library/Caches/pypoetry/virtualenvs/poetrydemo-fyqYbfje-py3.11/bin/activate&#x27;# åœ¨è™šæ‹Ÿç¯å¢ƒä¸‹è¿è¡Œ$ python array_util.py æ‰“åŒ…å’Œå‘å¸ƒ æ¥ç€ä¸Šé¢çš„é¡¹ç›® æ‰“åŒ… 123456789101112# ä¼šåœ¨é¡¹ç›®ç›®å½•ä¸‹åˆ›å»º dist ç›®å½•ï¼Œå¹¶å°†æ‰“å¥½çš„åŒ…å­˜æ”¾äºæ­¤$ poetry buildBuilding poetrydemo (0.1.0) - Building sdist - Built poetrydemo-0.1.0.tar.gz - Building wheel - Built poetrydemo-0.1.0-py3-none-any.whl# æŸ¥çœ‹ç”Ÿæˆçš„æ‰“åŒ…æ–‡ä»¶$ exa -1 disthqf_poetrydemo-0.1.0-py3-none-any.whlhqf_poetrydemo-0.1.0.tar.gz å‘å¸ƒ é¦–å…ˆè¦å…ˆåœ¨PyPIä¸Šæ³¨å†Œä¸ªå¸å·ï¼Œéœ€è¦å¼€å¯â€œåŒè¦ç´ èº«ä»½éªŒè¯ ï¼ˆ2FAï¼‰â€ï¼Œå¦åˆ™ä¸èƒ½è·å–å‘å¸ƒæ—¶çš„APIä»¤ç‰Œã€‚ è·å–APIä»¤ç‰Œ å‘å¸ƒï¼Œä¸è¿‡è¿™æ¬¡å‘å¸ƒæç¤ºåŒ…åå·²ç»å­˜åœ¨äº† 123456# å‘å¸ƒæ—¶æç¤ºåŒ…åå·²ç»å­˜åœ¨äº†$ poetry publish -u __token__ -p pypi-AgEIcHlwaS5vcmcCJDU0Y2Q5NjhkLWYyYTEtNPublishing poetrydemo (0.1.0) to PyPI - Uploading poetrydemo-0.1.0-py3-none-any.whl FAILEDHTTP Error 400: The name &#x27;poetrydemo&#x27; is too similar to an existing project. See https://pypi.org/help/#project-name for more information. | b&quot;&lt;html&gt;\\n &lt;head&gt;\\n &lt;title&gt;400 The name &#x27;poetrydemo&#x27; is too similar to an existing project. See https://pypi.org/help/#project-name for more information.\\n \\n &lt;body&gt;\\n &lt;h1&gt;400 The name &#x27;poetrydemo&#x27; is too similar to an existing project. See https://pypi.org/help/#project-name for more information.\\n The server could not comply with the request since it is either malformed or otherwise incorrect.&lt;br/&gt;&lt;br/&gt;\\nThe name &amp;#x27;poetrydemo&amp;#x27; is too similar to an existing project. See https://pypi.org/help/#project-name for more information.\\n\\n\\n \\n&quot; å…ˆä¿®æ”¹åŒ…åï¼Œç›´æ¥ç¼–è¾‘ pyproject.toml å³å¯ï¼Œå°†nameå±æ€§ä¿®æ”¹ä¸ºâ€œhqf_poetrydemoâ€ï¼Œç„¶åå°†åŒ…ç›®å½•çš„åç§°ä¹Ÿä¿®æ”¹ä¸ºè¿™ä¸ªmv poetrydemo hqf_poetrydemoï¼Œå¹¶åˆ é™¤distç›®å½•ï¼Œä¹‹åé‡æ–°æ‰“åŒ…poetry buildï¼Œå†æ¬¡å‘å¸ƒ 1234567891011121314151617$ vim pyproject.toml # å°†nameå±æ€§ä¿®æ”¹ä¸ºâ€œhqf_poetrydemoâ€$ mv poetrydemo hqf_poetrydemo # å°†åŒ…ç›®å½•çš„åç§°ä¹Ÿä¿®æ”¹ä¸ºè¿™ä¸ª$ rm -rf dist # åˆ é™¤distç›®å½•$ poetry build # é‡æ–°æ‰“åŒ…Creating virtualenv hqf-poetrydemo-fyqYbfje-py3.11 in /Users/hanqf/Library/Caches/pypoetry/virtualenvsBuilding hqf_poetrydemo (0.1.0) - Building sdist - Built hqf_poetrydemo-0.1.0.tar.gz - Building wheel - Built hqf_poetrydemo-0.1.0-py3-none-any.whl# å†æ¬¡å‘å¸ƒ$ poetry publish -u __token__ -p pypi-AgEIcHlwaS5vcmcCJDU0Y2Q5NjhkLWYyYTEtNPublishing hqf_poetrydemo (0.1.0) to PyPI - Uploading hqf_poetrydemo-0.1.0-py3-none-any.whl 100% - Uploading hqf_poetrydemo-0.1.0.tar.gz 100% ä¹‹åå°±å¯ä»¥åœ¨å…¶å®ƒé¡¹ç›®ä¸­å®‰è£…è¿™ä¸ªåŒ…äº† 12345678910111213141516# pip install$ pip install hqf_poetrydemo# poetry add$ poetry add hqf_poetrydemoUsing version ^0.1.0 for hqf-poetrydemoUpdating dependenciesResolving dependencies... (0.5s)Package operations: 2 installs, 0 updates, 0 removals - Installing numpy (2.1.3) - Installing hqf-poetrydemo (0.1.0)Writing lock file self update : å‡çº§ poetry ç‰ˆæœ¬ self ç›¸å…³å‘½ä»¤ä¸»è¦ç”¨äº poetry è‡ªèº«å®‰è£…æ’ä»¶ä½¿ç”¨ ä¼°è®¡æ’ä»¶åŠŸèƒ½ç›®å‰è¿˜ä¸æˆç†Ÿï¼Œå®˜ç½‘ä¹Ÿæ²¡æœ‰è¿›è¡Œè¯¦ç»†çš„è¯´æ˜ï¼Œå¹¶ä¸” windows ä¸‹æ— æ³•ä½¿ç”¨ï¼Œæ‰€ä»¥è¿™é‡Œä¸è®¨è®ºã€‚ selfå‘½ä»¤ä¸‹ç›®å‰åªéœ€è¦è®°ä½ä¸€ä¸ªå‘½ä»¤ï¼š self update : å‡çº§ poetry ç‰ˆæœ¬ 1$ poetry self update debug resolve : æŸ¥çœ‹åŒ…çš„ä¾èµ–å…³ç³» 1234567891011121314# åªæŸ¥çœ‹ï¼Œä¸å®‰è£…$ poetry debug resolve requestsResolving dependencies... (0.4s)Resolution results:certifi 2024.8.30charset-normalizer 3.4.0idna 3.10urllib3 2.2.3requests 2.32.3# æŸ¥çœ‹æŒ‡å®šç‰ˆæœ¬çš„ä¾èµ–å…³ç³»$ poetry debug resolve requests@2.32.3 cache : ç¼“å­˜ç®¡ç† poetryä¸€ä¸ªå¾ˆé‡è¦çš„åŠŸèƒ½å°±æ˜¯ç¼“å­˜å®‰è£…åŒ…ï¼Œå¯ä»¥ å‡å°‘ ç›¸åŒçš„å®‰è£…åŒ…è¢«é‡å¤ä¸‹è½½ã€‚ä¸ºä»€ä¹ˆæ˜¯å‡å°‘è€Œä¸æ˜¯é¿å…å‘¢ï¼Ÿå› ä¸ºä¸åŒçš„é•œåƒæºçš„åŒ…æ˜¯åˆ†åˆ«ç¼“å­˜çš„ã€‚ é€šè¿‡ poetry config --list å¯ä»¥çœ‹åˆ° cache-dir çš„åœ°å€ï¼Œè¿™é‡Œå°±æ˜¯ç¼“å­˜ä¸‹è½½åŒ…çš„ç›®å½•ã€‚ ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„ä½¿ç”¨åœºæ™¯ è§£å†³ä¾èµ–å®‰è£…é—®é¢˜ï¼š å¦‚æœä½ åœ¨å®‰è£…æˆ–æ›´æ–°ä¾èµ–æ—¶é‡åˆ°é—®é¢˜ï¼ˆä¾‹å¦‚ï¼ŒæŸä¸ªåŒ…æ— æ³•æ­£ç¡®å®‰è£…æˆ–ç‰ˆæœ¬ä¸å¯¹ï¼‰ï¼Œæ¸…ç©ºç¼“å­˜å¯ä»¥å¸®åŠ©ä½ ç¡®ä¿ Poetry é‡æ–°ä¸‹è½½æ‰€æœ‰å¿…è¦çš„æ–‡ä»¶ï¼Œä»è€Œè§£å†³é—®é¢˜ã€‚ æ¸…ç†ç£ç›˜ç©ºé—´ï¼š å¦‚æœä½ çš„é¡¹ç›®å¾ˆå¤šæˆ–è€…ç»å¸¸ä¿®æ”¹ä¾èµ–é¡¹ï¼Œç¼“å­˜å¯èƒ½ä¼šå˜å¾—éå¸¸å¤§ã€‚ä½¿ç”¨ poetry cache clear å¯ä»¥å¸®åŠ©é‡Šæ”¾ç£ç›˜ç©ºé—´ï¼Œç‰¹åˆ«æ˜¯å½“ä½ ä¸ç»å¸¸ä½¿ç”¨æŸäº›åŒ…æ—¶ã€‚ æµ‹è¯•æœ€æ–°ç‰ˆæœ¬çš„ä¾èµ–ï¼š å¦‚æœä½ æƒ³æµ‹è¯•æŸä¸ªåŒ…çš„æ–°ç‰ˆæœ¬æ˜¯å¦è§£å†³äº†æŸä¸ªé—®é¢˜ï¼Œæˆ–è€…æƒ³ç¡®ä¿ä½ ä½¿ç”¨çš„ç¡®å®æ˜¯æœ€æ–°çš„ç‰ˆæœ¬ï¼Œæ¸…é™¤ç¼“å­˜å¯ä»¥å¼ºåˆ¶ Poetry ä»è¿œç¨‹ä»“åº“é‡æ–°ä¸‹è½½æœ€æ–°çš„åŒ…ã€‚ ç¯å¢ƒå˜åŒ–ï¼š å¦‚æœä½ çš„å¼€å‘æˆ–ç”Ÿäº§ç¯å¢ƒå‘ç”Ÿäº†å˜åŒ–ï¼ˆä¾‹å¦‚ï¼Œåˆ‡æ¢äº†æ“ä½œç³»ç»Ÿã€æ›´æ–°äº† Python ç‰ˆæœ¬ç­‰ï¼‰ï¼Œæ¸…é™¤ç¼“å­˜å¯ä»¥å¸®åŠ©ä½ ç¡®ä¿ä¾èµ–é¡¹åœ¨æ–°ç¯å¢ƒä¸­æ­£ç¡®å®‰è£…ã€‚ è°ƒè¯•ä¾èµ–é—®é¢˜ï¼š åœ¨è°ƒè¯•ä¾èµ–é¡¹é—®é¢˜æ—¶ï¼Œæœ‰æ—¶å€™æ¸…é™¤ç¼“å­˜å¯ä»¥å¸®åŠ©ä½ ç¡®å®šé—®é¢˜æ˜¯å¦ä¸ç¼“å­˜ä¸­çš„æ—§ç‰ˆæœ¬æœ‰å…³ã€‚ CI/CD ç¯å¢ƒçš„ä¸€è‡´æ€§ï¼š åœ¨æŒç»­é›†æˆæˆ–æŒç»­éƒ¨ç½² (CI/CD) ç¯å¢ƒä¸­ï¼Œä¸ºäº†ç¡®ä¿æ¯æ¬¡æ„å»ºéƒ½åŸºäºæœ€æ–°çš„ä¾èµ–ï¼Œæœ‰æ—¶ä¼šåœ¨æ„å»ºè„šæœ¬ä¸­åŒ…å«æ¸…é™¤ç¼“å­˜çš„æ­¥éª¤ã€‚ 1234567891011# æŸ¥çœ‹ç¼“å­˜åˆ—è¡¨ï¼Œè¿™é‡Œä¼šæŒ‰é•œåƒæºè¿›è¡Œåˆ†ç»„$ poetry cache listPyPI_default_cachetsinghua# æ¸…é™¤æŒ‡å®šæºçš„å…¨éƒ¨ç¼“å­˜$ poetry cache clear pypi --all# æ¸…é™¤æŒ‡å®šæºä¸‹æŸä¸ªåŒ…çš„ç¼“å­˜$ poetry cache clear pypi:requests:2.24.0","summary":"æ‘˜è¦ Poetryæ˜¯ä¸€ä¸ªè½»é‡çº§çš„pythonåŒ…ç®¡ç†å™¨ï¼Œå…¶ç›®æ ‡æ˜¯å¸®åŠ©å¼€å‘è€…å¿«é€Ÿã€è½»æ¾åœ°æ„å»ºã€å‘å¸ƒå’Œåˆ†äº«pythonåŒ…ã€‚è¯´å®ƒè½»é‡ï¼Œæ˜¯ä¸ conda ç›¸æ¯” poetry æ›´è½»é‡ï¼ŒåŒæ—¶ä¸ venv + pip Python--virtualenv çš„æ–¹å¼ç›¸æ¯”å…·æœ‰å¦‚ä¸‹ä¼˜ç‚¹ï¼š ä½¿ç”¨ç¼“å­˜æœºåˆ¶ï¼Œé¿å…é‡å¤ä¸‹è½½ä¾èµ–åŒ… åŒ…ç®¡ç†ä¸Šæ›´åŠ ç²¾ç¡®ï¼Œåˆ é™¤ä¸éœ€è¦çš„åŒ…æ—¶ä¼šåŒæ—¶åˆ é™¤ä¸å…¶å…³è”çš„ä¸”æ²¡æœ‰è¢«ä½¿ç”¨çš„é‚£äº›ä¾èµ–åŒ…ï¼Œé¿å…æ— ç”¨çš„ä¾èµ–åŒ…é€ æˆæ‰“åŒ…ä½“ç§¯è¿‡å¤§ æ‰“åŒ…å’Œå‘å¸ƒæ›´åŠ ç®€å•ï¼Œåªéœ€è¦ä¸€ä¸ªå‘½ä»¤å°±å¯ä»¥æ‰“åŒ…å’Œå‘å¸ƒ","date_published":"2024-11-22T15:33:15.000Z","tags":["æŠ€æœ¯","Python"]},{"id":"https://blog.hanqunfeng.com/2024/11/18/python_pip/","url":"https://blog.hanqunfeng.com/2024/11/18/python_pip/","title":"pip--CERTIFICATE_VERIFY_FAILED","content_html":"<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">æµ‹è¯•ç¯å¢ƒï¼šmacOS 13.7.1ï¼ŒPython 3.11.3</li>\n<li class=\"lvl-2\">ä»Šå¤©å°†<code>pip</code>å‡çº§(<code>pip install --upgrade pip</code>)åˆ°<code>24.3.1</code>ç‰ˆæœ¬åï¼Œé€šè¿‡<code>pip install</code>å‘½ä»¤å®‰è£…ä¾èµ–æ—¶ä¼šæŠ¥é”™ï¼Œæ¯”å¦‚ï¼š</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ pip install certifi</span><br><span class=\"line\">Could not fetch URL https://pypi.org/simple/certifi/: There was a problem confirming the ssl certificate: HTTPSConnectionPool(host=<span class=\"string\">&#x27;pypi.org&#x27;</span>, port=443): Max retries exceeded with url: /simple/certifi/ (Caused by SSLError(SSLCertVerificationError(1, <span class=\"string\">&#x27;[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1002)&#x27;</span>))) - skipping</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">å¾ˆå¥‡æ€ªï¼Œä»<code>pip</code>è‡ªå·±çš„ç½‘ç«™ä¸Šä¸‹è½½ä¾èµ–éƒ½ä¼šå‡ºç°è¯ä¹¦æ— æ³•éªŒè¯çš„é”™è¯¯ã€‚æµ‹è¯•äº†ä¸€ä¸‹ï¼Œè¯¥é—®é¢˜åªåœ¨macOSä¸Šé‡åˆ°ï¼Œå…¶ä»–å¹³å°æ²¡æœ‰é‡åˆ°è¿‡ã€‚</li>\n<li class=\"lvl-2\">å…ˆè¯´ç»“è®ºï¼Œæ¨èä½¿ç”¨ç¬¬äº”ç§æ–¹æ³•ã€‚</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"è§£å†³æ–¹æ³•\">è§£å†³æ–¹æ³•</h2>\n<h3 id=\"1-trusted-host-å¿½ç•¥è¯ä¹¦éªŒè¯\">1. <code>--trusted-host</code>: å¿½ç•¥è¯ä¹¦éªŒè¯</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æŒ‡å®šä¿¡ä»»çš„è¯ä¹¦åŸŸåï¼Œä»è€Œä¸è¿›è¡ŒéªŒè¯è¯ä¹¦ï¼Œå¯ä»¥æŒ‡å®šå¤šä¸ª</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pip install certifi --trusted-host pypi.org --trusted-host files.pythonhosted.org</span><br></pre></td></tr></table></figure>\n<h3 id=\"2-cert-æŒ‡å®šè¯ä¹¦æ–‡ä»¶\">2. <code>--cert</code>: æŒ‡å®šè¯ä¹¦æ–‡ä»¶</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ­¤æ—¶éœ€è¦å…ˆä¸‹è½½è¯ä¹¦æ–‡ä»¶ï¼Œç”¨Chromeæµè§ˆå™¨æ‰“å¼€<a href=\"https://pypi.org\">https://pypi.org</a>ï¼ŒæŒ‰å¦‚ä¸‹æ­¥éª¤å¯¼å‡ºè¯ä¹¦æ–‡ä»¶<br>\n<img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/uPic/tMocyD.png\" alt=\"\" width=\"300\" height=\"300\"><br>\n<img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/uPic/uS4W2W.png\" alt=\"\" width=\"300\" height=\"300\"><br>\n<img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/uPic/OiZf9R.png\" alt=\"\" width=\"400\" height=\"500\"><br>\n<img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/uPic/JHw2ML.png\" alt=\"\" width=\"400\" height=\"300\"></p>\n</li>\n<li class=\"lvl-2\">\n<p>ç„¶åå†æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤è¿›è¡Œå®‰è£…</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pip install certifi --cert ~/Downloads/GlobalSign.pem</span><br></pre></td></tr></table></figure>\n<h3 id=\"3-pip-conf-é…ç½®å…¨å±€è¯ä¹¦æ–‡ä»¶\">3. <code>pip.conf</code>: é…ç½®å…¨å±€è¯ä¹¦æ–‡ä»¶</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¿˜æ˜¯éœ€è¦å…ˆä¸‹è½½è¯ä¹¦æ–‡ä»¶ï¼Œå‚è€ƒä¸Šé¢æ–¹æ³•</p>\n</li>\n<li class=\"lvl-2\">\n<p><code>pip</code> çš„é…ç½®æ–‡ä»¶ä½ç½®å› æ“ä½œç³»ç»Ÿè€Œå¼‚ã€‚å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤æ‰¾åˆ°é…ç½®æ–‡ä»¶è·¯å¾„ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æˆ‘ä½¿ç”¨çš„æ˜¯ macOS</span></span><br><span class=\"line\">$ pip config -v list</span><br><span class=\"line\">For variant <span class=\"string\">&#x27;global&#x27;</span>, will try loading <span class=\"string\">&#x27;/Library/Application Support/pip/pip.conf&#x27;</span></span><br><span class=\"line\">For variant <span class=\"string\">&#x27;user&#x27;</span>, will try loading <span class=\"string\">&#x27;/Users/hanqf/.pip/pip.conf&#x27;</span></span><br><span class=\"line\">For variant <span class=\"string\">&#x27;user&#x27;</span>, will try loading <span class=\"string\">&#x27;/Users/hanqf/.config/pip/pip.conf&#x27;</span></span><br><span class=\"line\">For variant <span class=\"string\">&#x27;site&#x27;</span>, will try loading <span class=\"string\">&#x27;/Library/Frameworks/Python.framework/Versions/3.11/pip.conf&#x27;</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><code>pip</code>ä¼šä»ä¸Šé¢çš„è·¯å¾„ä¸­æŸ¥æ‰¾é…ç½®ä¿¡æ¯ï¼Œæˆ‘è¿™é‡Œé€‰æ‹©ç¬¬äºŒä¸ªï¼Œå¦‚æœä¸å­˜åœ¨å°±åˆ›å»º<code>~/.pip/pip.conf</code>æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight ini\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"section\">[global]</span></span><br><span class=\"line\"><span class=\"attr\">cert</span> = ~/Downloads/GlobalSign.pem</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>é…ç½®å¥½åå¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹é…ç½®ä¿¡æ¯</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ pip config list</span><br><span class=\"line\">global.cert=<span class=\"string\">&#x27;~/.pip/GlobalSign.pem&#x27;</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç„¶åå†æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤è¿›è¡Œå®‰è£…</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pip install certifi</span><br></pre></td></tr></table></figure>\n<h3 id=\"4-å°†è¯ä¹¦æ·»åŠ åˆ°ç³»ç»Ÿä¿¡ä»»çš„è¯ä¹¦å­˜å‚¨\">4.å°†è¯ä¹¦æ·»åŠ åˆ°ç³»ç»Ÿä¿¡ä»»çš„è¯ä¹¦å­˜å‚¨</h3>\n<h4 id=\"å¯¹äº-macOSï¼š\">å¯¹äº macOSï¼š</h4>\n<div class=\"danger\">\n<p><em><strong>æˆ‘è®¾ç½®åä¾æ—§æŠ¥é”™ï¼Œæš‚ä¸æ¸…æ¥šåŸå› </strong></em></p>\n</div>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ‰“å¼€ <code>é’¥åŒ™ä¸²è®¿é—®</code> åº”ç”¨ç¨‹åºï¼Œå¹¶é€‰æ‹© <code>ç³»ç»Ÿé’¥åŒ™ä¸²</code> ä¸­çš„ <code>ç³»ç»Ÿ</code> (ä»ç½‘ä¸ŠæŸ¥è¯¢è¯´æ˜¯è¦åŠ å…¥<code>ç³»ç»Ÿæ ¹è¯ä¹¦</code>ï¼Œä½†æ˜¯æˆ‘æ²¡æœ‰åŠ å…¥æˆåŠŸ)</p>\n</li>\n<li class=\"lvl-2\">\n<p><code>æ–‡ä»¶</code> ã€‹<code>å¯¼å…¥é¡¹ç›®</code> ã€‹ <code>é€‰æ‹©è¯ä¹¦æ–‡ä»¶</code></p>\n</li>\n<li class=\"lvl-2\">\n<p>ä¼šæç¤ºä½ è¾“å…¥å¯†ç ï¼Œå¦‚æœè¯ä¹¦ä¸å—ä¿¡ä»»ï¼Œå¯ä»¥å°†è¯ä¹¦è®¾ç½®ä¸ºä¸ºå§‹ç»ˆä¿¡ä»»è¯¥è¯ä¹¦ (åŒå‡»è¯ä¹¦ ã€‹ ä¿¡ä»» ã€‹ ä½¿ç”¨æ­¤è¯ä¹¦æ—¶ ã€‹è®¾ç½®ä¸º<code>å§‹ç»ˆä¿¡ä»»</code>)ã€‚</p>\n</li>\n</ul>\n<h3 id=\"5-ä½¿ç”¨-Python-å®˜æ–¹æ¨èçš„è¯ä¹¦ä¿®å¤å·¥å…·-ï¼ˆæ¨èï¼‰\">5.ä½¿ç”¨ Python å®˜æ–¹æ¨èçš„è¯ä¹¦ä¿®å¤å·¥å…· ï¼ˆæ¨èï¼‰</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¿™ä¸ªæ–¹æ³•æœ€ç®€å•</p>\n</li>\n<li class=\"lvl-2\">\n<p>è¿è¡Œè¿™ä¸ªè„šæœ¬å‰éœ€è¦å…ˆå®‰è£… <code>certifi</code>ï¼Œå…¶ä¸»è¦ç”¨äºæä¾›æƒå¨çš„CAæ ¹è¯ä¹¦åˆ—è¡¨</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ pip install certifi --trusted-host pypi.org --trusted-host files.pythonhosted.org</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¿è¡Œè¯ä¹¦å®‰è£…è„šæœ¬ï¼ˆé€‚ç”¨äº macOS å†…ç½®çš„ Pythonï¼‰</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># é¦–æ¬¡è¿è¡Œä¾æ—§ä¼šæŠ¥é”™ï¼Œä½†å®é™…ä¸Šå·²ç»è¿›è¡Œäº†ä¿®å¤ï¼Œä¸»è¦å°±æ˜¯æœ€å4æ­¥è¿›è¡Œçš„æ“ä½œ</span></span><br><span class=\"line\"><span class=\"comment\"># æ³¨æ„æ›¿æ¢ä½ è‡ªå·±çš„Pythonç‰ˆæœ¬å·</span></span><br><span class=\"line\">$ /Applications/Python\\ 3.11/Install\\ Certificates.<span class=\"built_in\">command</span></span><br><span class=\"line\"></span><br><span class=\"line\"> -- pip install --upgrade certifi</span><br><span class=\"line\">Requirement already satisfied: certifi <span class=\"keyword\">in</span> /Library/Frameworks/Python.framework/Versions/3.11/lib/python3.11/site-packages (2024.8.30)</span><br><span class=\"line\">WARNING: Retrying (Retry(total=4, connect=None, <span class=\"built_in\">read</span>=None, redirect=None, status=None)) after connection broken by <span class=\"string\">&#x27;SSLError(SSLCertVerificationError(1, &#x27;</span>[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get <span class=\"built_in\">local</span> issuer certificate (_ssl.c:1002)<span class=\"string\">&#x27;))&#x27;</span>: /simple/certifi/</span><br><span class=\"line\">WARNING: Retrying (Retry(total=3, connect=None, <span class=\"built_in\">read</span>=None, redirect=None, status=None)) after connection broken by <span class=\"string\">&#x27;SSLError(SSLCertVerificationError(1, &#x27;</span>[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get <span class=\"built_in\">local</span> issuer certificate (_ssl.c:1002)<span class=\"string\">&#x27;))&#x27;</span>: /simple/certifi/</span><br><span class=\"line\">WARNING: Retrying (Retry(total=2, connect=None, <span class=\"built_in\">read</span>=None, redirect=None, status=None)) after connection broken by <span class=\"string\">&#x27;SSLError(SSLCertVerificationError(1, &#x27;</span>[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get <span class=\"built_in\">local</span> issuer certificate (_ssl.c:1002)<span class=\"string\">&#x27;))&#x27;</span>: /simple/certifi/</span><br><span class=\"line\">WARNING: Retrying (Retry(total=1, connect=None, <span class=\"built_in\">read</span>=None, redirect=None, status=None)) after connection broken by <span class=\"string\">&#x27;SSLError(SSLCertVerificationError(1, &#x27;</span>[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get <span class=\"built_in\">local</span> issuer certificate (_ssl.c:1002)<span class=\"string\">&#x27;))&#x27;</span>: /simple/certifi/</span><br><span class=\"line\">WARNING: Retrying (Retry(total=0, connect=None, <span class=\"built_in\">read</span>=None, redirect=None, status=None)) after connection broken by <span class=\"string\">&#x27;SSLError(SSLCertVerificationError(1, &#x27;</span>[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get <span class=\"built_in\">local</span> issuer certificate (_ssl.c:1002)<span class=\"string\">&#x27;))&#x27;</span>: /simple/certifi/</span><br><span class=\"line\">Could not fetch URL https://pypi.org/simple/certifi/: There was a problem confirming the ssl certificate: HTTPSConnectionPool(host=<span class=\"string\">&#x27;pypi.org&#x27;</span>, port=443): Max retries exceeded with url: /simple/certifi/ (Caused by SSLError(SSLCertVerificationError(1, <span class=\"string\">&#x27;[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1002)&#x27;</span>))) - skipping</span><br><span class=\"line\"> -- removing any existing file or <span class=\"built_in\">link</span></span><br><span class=\"line\"> -- creating symlink to certifi certificate bundle</span><br><span class=\"line\"> -- setting permissions</span><br><span class=\"line\"> -- update complete</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¹‹åå†è¿è¡Œ<code>pip install</code>å‘½ä»¤ï¼Œå°±ä¸ä¼šæŠ¥é”™äº†</p>\n</li>\n</ul>\n<h3 id=\"6-ä½¿ç”¨å…¶å®ƒé•œåƒæº\">6.ä½¿ç”¨å…¶å®ƒé•œåƒæº</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¯¥é—®é¢˜æ˜¯å› ä¸ºPypiè½¯ä»¶ä»“åº“å®˜ç½‘çš„è¯ä¹¦æ–‡ä»¶å­˜åœ¨é—®é¢˜å¯¼è‡´çš„ï¼Œåªè¦æˆ‘ä»¬ä¸ä»å®˜ç½‘ä¸‹è½½å°±ä¸ä¼šæœ‰é—®é¢˜ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>åœ¨å›½å†…ä¸ºäº†åŠ é€Ÿä¸‹è½½æˆ‘ä»¬ä¸€èˆ¬ä¼šä½¿ç”¨å›½å†…çš„é•œåƒæºï¼Œä¾‹å¦‚<a href=\"https://developer.aliyun.com/mirror/pypi\">é˜¿é‡Œäº‘çš„Pypié•œåƒæº</a>æˆ–è€…<a href=\"https://mirrors.tuna.tsinghua.edu.cn/help/pypi/\">æ¸…åå¤§å­¦çš„Pypié•œåƒæº</a>ï¼Œå…·ä½“ä½¿ç”¨æ–¹æ³•å‚è€ƒå„è‡ªçš„å®˜ç½‘è¯´æ˜å³å¯ã€‚</p>\n</li>\n</ul>\n","content_text":"æ‘˜è¦ æµ‹è¯•ç¯å¢ƒï¼šmacOS 13.7.1ï¼ŒPython 3.11.3 ä»Šå¤©å°†pipå‡çº§(pip install --upgrade pip)åˆ°24.3.1ç‰ˆæœ¬åï¼Œé€šè¿‡pip installå‘½ä»¤å®‰è£…ä¾èµ–æ—¶ä¼šæŠ¥é”™ï¼Œæ¯”å¦‚ï¼š 12$ pip install certifiCould not fetch URL https://pypi.org/simple/certifi/: There was a problem confirming the ssl certificate: HTTPSConnectionPool(host=&#x27;pypi.org&#x27;, port=443): Max retries exceeded with url: /simple/certifi/ (Caused by SSLError(SSLCertVerificationError(1, &#x27;[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1002)&#x27;))) - skipping å¾ˆå¥‡æ€ªï¼Œä»pipè‡ªå·±çš„ç½‘ç«™ä¸Šä¸‹è½½ä¾èµ–éƒ½ä¼šå‡ºç°è¯ä¹¦æ— æ³•éªŒè¯çš„é”™è¯¯ã€‚æµ‹è¯•äº†ä¸€ä¸‹ï¼Œè¯¥é—®é¢˜åªåœ¨macOSä¸Šé‡åˆ°ï¼Œå…¶ä»–å¹³å°æ²¡æœ‰é‡åˆ°è¿‡ã€‚ å…ˆè¯´ç»“è®ºï¼Œæ¨èä½¿ç”¨ç¬¬äº”ç§æ–¹æ³•ã€‚ è§£å†³æ–¹æ³• 1. --trusted-host: å¿½ç•¥è¯ä¹¦éªŒè¯ æŒ‡å®šä¿¡ä»»çš„è¯ä¹¦åŸŸåï¼Œä»è€Œä¸è¿›è¡ŒéªŒè¯è¯ä¹¦ï¼Œå¯ä»¥æŒ‡å®šå¤šä¸ª 1pip install certifi --trusted-host pypi.org --trusted-host files.pythonhosted.org 2. --cert: æŒ‡å®šè¯ä¹¦æ–‡ä»¶ æ­¤æ—¶éœ€è¦å…ˆä¸‹è½½è¯ä¹¦æ–‡ä»¶ï¼Œç”¨Chromeæµè§ˆå™¨æ‰“å¼€https://pypi.orgï¼ŒæŒ‰å¦‚ä¸‹æ­¥éª¤å¯¼å‡ºè¯ä¹¦æ–‡ä»¶ ç„¶åå†æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤è¿›è¡Œå®‰è£… 1pip install certifi --cert ~/Downloads/GlobalSign.pem 3. pip.conf: é…ç½®å…¨å±€è¯ä¹¦æ–‡ä»¶ è¿˜æ˜¯éœ€è¦å…ˆä¸‹è½½è¯ä¹¦æ–‡ä»¶ï¼Œå‚è€ƒä¸Šé¢æ–¹æ³• pip çš„é…ç½®æ–‡ä»¶ä½ç½®å› æ“ä½œç³»ç»Ÿè€Œå¼‚ã€‚å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤æ‰¾åˆ°é…ç½®æ–‡ä»¶è·¯å¾„ï¼š 123456# æˆ‘ä½¿ç”¨çš„æ˜¯ macOS$ pip config -v listFor variant &#x27;global&#x27;, will try loading &#x27;/Library/Application Support/pip/pip.conf&#x27;For variant &#x27;user&#x27;, will try loading &#x27;/Users/hanqf/.pip/pip.conf&#x27;For variant &#x27;user&#x27;, will try loading &#x27;/Users/hanqf/.config/pip/pip.conf&#x27;For variant &#x27;site&#x27;, will try loading &#x27;/Library/Frameworks/Python.framework/Versions/3.11/pip.conf&#x27; pipä¼šä»ä¸Šé¢çš„è·¯å¾„ä¸­æŸ¥æ‰¾é…ç½®ä¿¡æ¯ï¼Œæˆ‘è¿™é‡Œé€‰æ‹©ç¬¬äºŒä¸ªï¼Œå¦‚æœä¸å­˜åœ¨å°±åˆ›å»º~/.pip/pip.confæ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š 12[global]cert = ~/Downloads/GlobalSign.pem é…ç½®å¥½åå¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹é…ç½®ä¿¡æ¯ 12$ pip config listglobal.cert=&#x27;~/.pip/GlobalSign.pem&#x27; ç„¶åå†æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤è¿›è¡Œå®‰è£… 1pip install certifi 4.å°†è¯ä¹¦æ·»åŠ åˆ°ç³»ç»Ÿä¿¡ä»»çš„è¯ä¹¦å­˜å‚¨ å¯¹äº macOSï¼š æˆ‘è®¾ç½®åä¾æ—§æŠ¥é”™ï¼Œæš‚ä¸æ¸…æ¥šåŸå›  æ‰“å¼€ é’¥åŒ™ä¸²è®¿é—® åº”ç”¨ç¨‹åºï¼Œå¹¶é€‰æ‹© ç³»ç»Ÿé’¥åŒ™ä¸² ä¸­çš„ ç³»ç»Ÿ (ä»ç½‘ä¸ŠæŸ¥è¯¢è¯´æ˜¯è¦åŠ å…¥ç³»ç»Ÿæ ¹è¯ä¹¦ï¼Œä½†æ˜¯æˆ‘æ²¡æœ‰åŠ å…¥æˆåŠŸ) æ–‡ä»¶ ã€‹å¯¼å…¥é¡¹ç›® ã€‹ é€‰æ‹©è¯ä¹¦æ–‡ä»¶ ä¼šæç¤ºä½ è¾“å…¥å¯†ç ï¼Œå¦‚æœè¯ä¹¦ä¸å—ä¿¡ä»»ï¼Œå¯ä»¥å°†è¯ä¹¦è®¾ç½®ä¸ºä¸ºå§‹ç»ˆä¿¡ä»»è¯¥è¯ä¹¦ (åŒå‡»è¯ä¹¦ ã€‹ ä¿¡ä»» ã€‹ ä½¿ç”¨æ­¤è¯ä¹¦æ—¶ ã€‹è®¾ç½®ä¸ºå§‹ç»ˆä¿¡ä»»)ã€‚ 5.ä½¿ç”¨ Python å®˜æ–¹æ¨èçš„è¯ä¹¦ä¿®å¤å·¥å…· ï¼ˆæ¨èï¼‰ è¿™ä¸ªæ–¹æ³•æœ€ç®€å• è¿è¡Œè¿™ä¸ªè„šæœ¬å‰éœ€è¦å…ˆå®‰è£… certifiï¼Œå…¶ä¸»è¦ç”¨äºæä¾›æƒå¨çš„CAæ ¹è¯ä¹¦åˆ—è¡¨ 1$ pip install certifi --trusted-host pypi.org --trusted-host files.pythonhosted.org è¿è¡Œè¯ä¹¦å®‰è£…è„šæœ¬ï¼ˆé€‚ç”¨äº macOS å†…ç½®çš„ Pythonï¼‰ 12345678910111213141516# é¦–æ¬¡è¿è¡Œä¾æ—§ä¼šæŠ¥é”™ï¼Œä½†å®é™…ä¸Šå·²ç»è¿›è¡Œäº†ä¿®å¤ï¼Œä¸»è¦å°±æ˜¯æœ€å4æ­¥è¿›è¡Œçš„æ“ä½œ# æ³¨æ„æ›¿æ¢ä½ è‡ªå·±çš„Pythonç‰ˆæœ¬å·$ /Applications/Python\\ 3.11/Install\\ Certificates.command -- pip install --upgrade certifiRequirement already satisfied: certifi in /Library/Frameworks/Python.framework/Versions/3.11/lib/python3.11/site-packages (2024.8.30)WARNING: Retrying (Retry(total=4, connect=None, read=None, redirect=None, status=None)) after connection broken by &#x27;SSLError(SSLCertVerificationError(1, &#x27;[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1002)&#x27;))&#x27;: /simple/certifi/WARNING: Retrying (Retry(total=3, connect=None, read=None, redirect=None, status=None)) after connection broken by &#x27;SSLError(SSLCertVerificationError(1, &#x27;[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1002)&#x27;))&#x27;: /simple/certifi/WARNING: Retrying (Retry(total=2, connect=None, read=None, redirect=None, status=None)) after connection broken by &#x27;SSLError(SSLCertVerificationError(1, &#x27;[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1002)&#x27;))&#x27;: /simple/certifi/WARNING: Retrying (Retry(total=1, connect=None, read=None, redirect=None, status=None)) after connection broken by &#x27;SSLError(SSLCertVerificationError(1, &#x27;[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1002)&#x27;))&#x27;: /simple/certifi/WARNING: Retrying (Retry(total=0, connect=None, read=None, redirect=None, status=None)) after connection broken by &#x27;SSLError(SSLCertVerificationError(1, &#x27;[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1002)&#x27;))&#x27;: /simple/certifi/Could not fetch URL https://pypi.org/simple/certifi/: There was a problem confirming the ssl certificate: HTTPSConnectionPool(host=&#x27;pypi.org&#x27;, port=443): Max retries exceeded with url: /simple/certifi/ (Caused by SSLError(SSLCertVerificationError(1, &#x27;[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1002)&#x27;))) - skipping -- removing any existing file or link -- creating symlink to certifi certificate bundle -- setting permissions -- update complete ä¹‹åå†è¿è¡Œpip installå‘½ä»¤ï¼Œå°±ä¸ä¼šæŠ¥é”™äº† 6.ä½¿ç”¨å…¶å®ƒé•œåƒæº è¯¥é—®é¢˜æ˜¯å› ä¸ºPypiè½¯ä»¶ä»“åº“å®˜ç½‘çš„è¯ä¹¦æ–‡ä»¶å­˜åœ¨é—®é¢˜å¯¼è‡´çš„ï¼Œåªè¦æˆ‘ä»¬ä¸ä»å®˜ç½‘ä¸‹è½½å°±ä¸ä¼šæœ‰é—®é¢˜ã€‚ åœ¨å›½å†…ä¸ºäº†åŠ é€Ÿä¸‹è½½æˆ‘ä»¬ä¸€èˆ¬ä¼šä½¿ç”¨å›½å†…çš„é•œåƒæºï¼Œä¾‹å¦‚é˜¿é‡Œäº‘çš„Pypié•œåƒæºæˆ–è€…æ¸…åå¤§å­¦çš„Pypié•œåƒæºï¼Œå…·ä½“ä½¿ç”¨æ–¹æ³•å‚è€ƒå„è‡ªçš„å®˜ç½‘è¯´æ˜å³å¯ã€‚","summary":"æ‘˜è¦ æµ‹è¯•ç¯å¢ƒï¼šmacOS 13.7.1ï¼ŒPython 3.11.3 ä»Šå¤©å°†pipå‡çº§(pip install --upgrade pip)åˆ°24.3.1ç‰ˆæœ¬åï¼Œé€šè¿‡pip installå‘½ä»¤å®‰è£…ä¾èµ–æ—¶ä¼šæŠ¥é”™ï¼Œæ¯”å¦‚ï¼š 12$ pip install certifiCould not fetch URL https://pypi.org/simple/certifi/: There was a problem confirming the ssl certificate: HTTPSConnectionPool(host=&#x27;pypi.org&#x27;, port=443): Max retries exceeded with url: /simple/certifi/ (Caused by SSLError(SSLCertVerificationError(1, &#x27;[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1002)&#x27;))) - skipping å¾ˆå¥‡æ€ªï¼Œä»pipè‡ªå·±çš„ç½‘ç«™ä¸Šä¸‹è½½ä¾èµ–éƒ½ä¼šå‡ºç°è¯ä¹¦æ— æ³•éªŒè¯çš„é”™è¯¯ã€‚æµ‹è¯•äº†ä¸€ä¸‹ï¼Œè¯¥é—®é¢˜åªåœ¨macOSä¸Šé‡åˆ°ï¼Œå…¶ä»–å¹³å°æ²¡æœ‰é‡åˆ°è¿‡ã€‚ å…ˆè¯´ç»“è®ºï¼Œæ¨èä½¿ç”¨ç¬¬äº”ç§æ–¹æ³•ã€‚","date_published":"2024-11-18T15:33:15.000Z","tags":["æŠ€æœ¯","Python"]},{"id":"https://blog.hanqunfeng.com/2024/11/12/mathjax-demo/","url":"https://blog.hanqunfeng.com/2024/11/12/mathjax-demo/","title":"Hexo NexT -- æ•°å­¦å…¬å¼","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\n-->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Hexoæ˜¯åŸºäºmarkdownçš„ï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨LaTexè¯­æ³•æ¥ç¼–å†™æ•°å­¦å…¬å¼ï¼Œåªä¸è¿‡éœ€è¦å®‰è£…ç›¸åº”çš„å…¬å¼æ¸²æŸ“æ’ä»¶æ¥å®ç°ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>Nextä¸»é¢˜ æ”¯æŒçš„å…¬å¼æ’ä»¶ä¸º<code>MathJax</code>å’Œ<code>KaTeX</code>ï¼Œå®ƒä»¬éƒ½æ”¯æŒLaTexè¯­æ³•ï¼Œå‚è€ƒ: <a href=\"https://theme-next.js.org/docs/third-party-services/math-equations\">https://theme-next.js.org/docs/third-party-services/math-equations</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä½¿ç”¨çš„æ˜¯<a href=\"https://katex.org/docs/supported\">Katex</a>ï¼ŒåŸå› æ˜¯æˆ‘å·²ç»ä½¿ç”¨äº†<a href=\"https://github.com/hexojs/hexo-renderer-markdown-it\">hexo-renderer-markdown-it</a>æ¸²æŸ“å™¨ï¼Œå…¶ä¸ mathjax çš„ <a href=\"https://github.com/hexojs/hexo-renderer-pandoc\">hexo-renderer-pandoc</a>æ¸²æŸ“å™¨ä¸èƒ½å¹¶å­˜ï¼Œæ‰€ä»¥åªèƒ½é€‰<code>Katex</code>äº†ã€‚</p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"å®‰è£…\">å®‰è£…</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¯¦ç»†çš„å®‰è£…æ–¹æ³•è¯·å‚è€ƒ:<a href=\"https://theme-next.js.org/docs/third-party-services/math-equations\">Math Equations</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>å› ä¸ºå·²ç»ä½¿ç”¨äº†<a href=\"https://github.com/hexojs/hexo-renderer-markdown-it\">hexo-renderer-markdown-it</a>æ¸²æŸ“å™¨ï¼Œæ‰€ä»¥è¿™é‡Œå°±æ²¡æœ‰ä½¿ç”¨<a href=\"https://github.com/CHENXCHEN/hexo-renderer-markdown-it-plus\">hexo-renderer-markdown-it-plus</a>æ¸²æŸ“å™¨ï¼Œå…¶å®ä¸¤è€…ä¹Ÿæ²¡æœ‰å¤ªå¤§çš„åŒºåˆ«ï¼Œåªä¸è¿‡åè€…é»˜è®¤å°±åŠ è½½äº†ä¸€äº›æ’ä»¶ï¼Œè€Œå‰è€…éœ€è¦è‡ªå·±å®‰è£…æ’ä»¶å¹¶é…ç½®æ‰å¯ä»¥ä½¿ç”¨ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä½†æ˜¯æµ‹è¯•æ—¶å‘ç°ï¼ŒæŒ‰ç…§å®˜ç½‘çš„é…ç½®<code>hexo-renderer-markdown-it</code> + <code>markdown-it-katex</code> çš„æ–¹å¼å¹¶ä¸èƒ½å¾ˆå¥½çš„è¿›è¡Œå…¬å¼çš„æ¸²æŸ“ï¼Œæ‰€ä»¥è¿™é‡Œå‚è€ƒäº† <code>hexo-renderer-markdown-it-plus</code> æ¸²æŸ“å™¨ï¼Œå°†å…¶æ›´æ¢ä¸º<a href=\"https://github.com/iktakahiro/markdown-it-katex#readme\">@iktakahiro/markdown-it-katex</a>ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install @iktakahiro/markdown-it-katex --save</span><br></pre></td></tr></table></figure>\n<p>åœ¨<code>_config.yml</code>é…ç½®ä¸Šè¯¥æ’ä»¶</p>\n<figure class=\"highlight yml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># config of hexo-renderer-markdown-it</span></span><br><span class=\"line\"><span class=\"attr\">markdown:</span></span><br><span class=\"line\">  <span class=\"attr\">render:</span></span><br><span class=\"line\">    <span class=\"attr\">html:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">    <span class=\"attr\">xhtmlOut:</span> <span class=\"literal\">false</span></span><br><span class=\"line\">    <span class=\"attr\">breaks:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">    <span class=\"attr\">linkify:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">    <span class=\"attr\">typographer:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">    <span class=\"attr\">quotes:</span> <span class=\"string\">&#x27;â€œâ€â€˜â€™&#x27;</span></span><br><span class=\"line\">  <span class=\"attr\">plugins:</span></span><br><span class=\"line\">    <span class=\"comment\"># katexå…¬å¼</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">&quot;@iktakahiro/markdown-it-katex&quot;</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"å®‰è£…åé‡åˆ°çš„é—®é¢˜\">å®‰è£…åé‡åˆ°çš„é—®é¢˜</h2>\n<h3 id=\"1-å®‰è£…åå‘ç°é€šè¿‡hexoç¼–è¯‘æ—¶ä¼šæŠ¥ç±»ä¼¼å¦‚ä¸‹è­¦å‘Š\">1.å®‰è£…åå‘ç°é€šè¿‡hexoç¼–è¯‘æ—¶ä¼šæŠ¥ç±»ä¼¼å¦‚ä¸‹è­¦å‘Š</h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">LaTeX-incompatible input and strict mode is set to &#x27;warn&#x27;: Unicode text character &quot;å³&quot; used in math mode [unicodeTextInMathMode]</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åŸå› æ˜¯<code>@iktakahiro/markdown-it-katex</code>æ’ä»¶é»˜è®¤å¼€å¯çš„æ˜¯ä¸¥æ ¼æ¨¡å¼ï¼Œä¸èƒ½åœ¨<code>$$...$$</code>æˆ–<code>$...$</code>ä¸­åŒ…å«ä¸­æ–‡ï¼Œè™½ç„¶æˆ‘è®¾ç½®çš„æ˜¯<code>math -- every_page: false</code>ï¼Œä½†å…¶åœ¨ç¼–è¯‘é˜¶æ®µä¾æ—§ä¼šæ£€æŸ¥æ‰€æœ‰çš„é¡µé¢ï¼Œä¸è¿‡æŠ¥è¿™ä¸ªè­¦å‘Šå¹¶ä¸ä¼šæœ‰ä»€ä¹ˆå½±å“ï¼Œæ‰€ä»¥å¯ä»¥å¿½ç•¥ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å¦‚æœä¸å¸Œæœ›çœ‹åˆ°è¿™ä¸ªè­¦å‘Šï¼Œå¯ä»¥ä¸º <code>@iktakahiro/markdown-it-katex</code> æ·»åŠ æ¨¡å¼çš„æ§åˆ¶è¡Œä¸º</p>\n</li>\n</ul>\n<figure class=\"highlight yml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># config of hexo-renderer-markdown-it</span></span><br><span class=\"line\"><span class=\"attr\">markdown:</span></span><br><span class=\"line\">  <span class=\"attr\">render:</span></span><br><span class=\"line\">    <span class=\"attr\">html:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">    <span class=\"attr\">xhtmlOut:</span> <span class=\"literal\">false</span></span><br><span class=\"line\">    <span class=\"attr\">breaks:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">    <span class=\"attr\">linkify:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">    <span class=\"attr\">typographer:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">    <span class=\"attr\">quotes:</span> <span class=\"string\">&#x27;â€œâ€â€˜â€™&#x27;</span></span><br><span class=\"line\">  <span class=\"attr\">plugins:</span></span><br><span class=\"line\">    <span class=\"comment\"># katexå…¬å¼</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">&quot;@iktakahiro/markdown-it-katex&quot;</span></span><br><span class=\"line\">      <span class=\"attr\">options:</span></span><br><span class=\"line\">         <span class=\"attr\">strict:</span> <span class=\"string\">error</span> <span class=\"comment\"># é»˜è®¤ä¸ºwarnï¼Œè¿™é‡Œè®¾ç½®ä¸ºerrorï¼Œåªæœ‰å½“è§£æå™¨é‡åˆ°ä¸æ”¯æŒçš„å…¬å¼æ—¶æ‰æŠ¥é”™ï¼Œä¹Ÿå¯ä»¥è®¾ç½®ä¸º falseï¼Œè¡¨ç¤ºä¸æ£€æŸ¥</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"ä¸æ”¯æŒKatexçš„Auto-render-Extension\">ä¸æ”¯æŒ<code>Katex</code>çš„<code>Auto-render Extension</code></h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>é€šè¿‡æŸ¥çœ‹<code>Katex</code>å®˜ç½‘å¯ä»¥çŸ¥é“ï¼Œå¼€å¯<a href=\"https://katex.org/docs/autorender\">Auto-render Extension</a>åï¼Œ<code>Katex</code>å¯ä»¥æ¸²æŸ“æ›´å¤šçš„å…¬å¼è¯­æ³•ï¼Œä½†è¦æ³¨æ„è¿™å¹¶ä¸æ˜¯<code>LaTex</code>çš„æ ‡å‡†è¯­æ³•</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä½†æ˜¯<code>@iktakahiro/markdown-it-katex</code>ä¸­å¹¶æ²¡æœ‰ç›¸åº”çš„é…ç½®ï¼Œä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œç®€å•çš„æ–¹æ³•å°±æ˜¯å°†æ‰€éœ€è¦çš„èµ„æºæ·»åŠ åˆ°é¡µé¢ä¸­ï¼Œæ¯”å¦‚æˆ‘åœ¨<code>source\\_data\\post-body-start.njk</code>ä¸­æ·»åŠ äº†å¦‚ä¸‹å†…å®¹</p>\n</li>\n</ul>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;%- if page.mathjax %&#125;</span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">link</span> <span class=\"attr\">rel</span>=<span class=\"string\">&quot;stylesheet&quot;</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css&quot;</span> <span class=\"attr\">integrity</span>=<span class=\"string\">&quot;sha384-nB0miv6/jRmo5UMMR1wu3Gz6NLsoTkbqJghGIsx//Rlm+ZU03BU6SQNC66uf4l5+&quot;</span> <span class=\"attr\">crossorigin</span>=<span class=\"string\">&quot;anonymous&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">defer</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js&quot;</span> <span class=\"attr\">integrity</span>=<span class=\"string\">&quot;sha384-7zkQWkzuo3B5mTepMUcHkMB5jZaolc2xDwL6VFqjFALcbeS9Ggm/Yr2r3Dy4lfFg&quot;</span> <span class=\"attr\">crossorigin</span>=<span class=\"string\">&quot;anonymous&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">defer</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js&quot;</span> <span class=\"attr\">integrity</span>=<span class=\"string\">&quot;sha384-43gviWU0YVjaDtb/GhzOouOXtZMP/7XUzwPTstBeZFe/+rCMvRwr4yROQP43s0Xk&quot;</span> <span class=\"attr\">crossorigin</span>=<span class=\"string\">&quot;anonymous&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"variable language_\">document</span>.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&quot;DOMContentLoaded&quot;</span>, <span class=\"keyword\">function</span>(<span class=\"params\"></span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">        <span class=\"title function_\">renderMathInElement</span>(<span class=\"variable language_\">document</span>.<span class=\"property\">body</span>, &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">          <span class=\"comment\">// customised options</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">          <span class=\"comment\">// â€¢ auto-render specific keys, e.g.:</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">          <span class=\"attr\">delimiters</span>: [</span></span><br><span class=\"line\"><span class=\"language-javascript\">            &#123;<span class=\"attr\">left</span>: <span class=\"string\">&quot;$$&quot;</span>, <span class=\"attr\">right</span>: <span class=\"string\">&quot;$$&quot;</span>, <span class=\"attr\">display</span>: <span class=\"literal\">true</span>&#125;,</span></span><br><span class=\"line\"><span class=\"language-javascript\">            &#123;<span class=\"attr\">left</span>: <span class=\"string\">&quot;\\\\(&quot;</span>, <span class=\"attr\">right</span>: <span class=\"string\">&quot;\\\\)&quot;</span>, <span class=\"attr\">display</span>: <span class=\"literal\">false</span>&#125;,</span></span><br><span class=\"line\"><span class=\"language-javascript\">            &#123;<span class=\"attr\">left</span>: <span class=\"string\">&quot;\\\\begin&#123;equation&#125;&quot;</span>, <span class=\"attr\">right</span>: <span class=\"string\">&quot;\\\\end&#123;equation&#125;&quot;</span>, <span class=\"attr\">display</span>: <span class=\"literal\">true</span>&#125;,</span></span><br><span class=\"line\"><span class=\"language-javascript\">            &#123;<span class=\"attr\">left</span>: <span class=\"string\">&quot;\\\\begin&#123;align&#125;&quot;</span>, <span class=\"attr\">right</span>: <span class=\"string\">&quot;\\\\end&#123;align&#125;&quot;</span>, <span class=\"attr\">display</span>: <span class=\"literal\">true</span>&#125;,</span></span><br><span class=\"line\"><span class=\"language-javascript\">            &#123;<span class=\"attr\">left</span>: <span class=\"string\">&quot;\\\\begin&#123;alignat&#125;&quot;</span>, <span class=\"attr\">right</span>: <span class=\"string\">&quot;\\\\end&#123;alignat&#125;&quot;</span>, <span class=\"attr\">display</span>: <span class=\"literal\">true</span>&#125;,</span></span><br><span class=\"line\"><span class=\"language-javascript\">            &#123;<span class=\"attr\">left</span>: <span class=\"string\">&quot;\\\\begin&#123;gather&#125;&quot;</span>, <span class=\"attr\">right</span>: <span class=\"string\">&quot;\\\\end&#123;gather&#125;&quot;</span>, <span class=\"attr\">display</span>: <span class=\"literal\">true</span>&#125;,</span></span><br><span class=\"line\"><span class=\"language-javascript\">            &#123;<span class=\"attr\">left</span>: <span class=\"string\">&quot;\\\\begin&#123;CD&#125;&quot;</span>, <span class=\"attr\">right</span>: <span class=\"string\">&quot;\\\\end&#123;CD&#125;&quot;</span>, <span class=\"attr\">display</span>: <span class=\"literal\">true</span>&#125;,</span></span><br><span class=\"line\"><span class=\"language-javascript\">            &#123;<span class=\"attr\">left</span>: <span class=\"string\">&quot;\\\\[&quot;</span>, <span class=\"attr\">right</span>: <span class=\"string\">&quot;\\\\]&quot;</span>, <span class=\"attr\">display</span>: <span class=\"literal\">true</span>&#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\">            ],</span></span><br><span class=\"line\"><span class=\"language-javascript\">          <span class=\"comment\">// â€¢ rendering keys, e.g.:</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">          throwOnError : <span class=\"literal\">false</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">        &#125;);</span></span><br><span class=\"line\"><span class=\"language-javascript\">    &#125;);</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\">&#123;%- endif %&#125;</span><br></pre></td></tr></table></figure>\n<div class=\"tips\">\n<p><em><strong>å°è´´å£«</strong></em><br>\nå¯ä»¥é€šè¿‡nextæ¨¡æ¿çš„<code>_config.yml</code>ä¸­çš„<code>custom_file_path</code>é…ç½®é¡¹æ¥è‡ªå®šä¹‰æ¸²æŸ“é¡µé¢çš„æŸä¸ªéƒ¨åˆ†ï¼Œè¿™æ ·å¯¹åº”çš„æ¯ä¸ªé¡µé¢éƒ½ä¼šåŠ ä¸Šè¯¥æ¨¡æ¿å†…å®¹</p>\n<figure class=\"highlight yml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">custom_file_path:</span></span><br><span class=\"line\">  <span class=\"attr\">postBodyStart:</span> <span class=\"string\">source/_data/post-body-start.njk</span></span><br></pre></td></tr></table></figure>\n</div>\n<hr>\n<div class=\"warning\">\n<ul class=\"lvl-1\">\n<li class=\"lvl-2\">\n<p>ä½¿ç”¨<code>hexo-renderer-markdown-it-plus</code>æ¸²æŸ“å™¨æ—¶ï¼Œå¦‚æœä¿®æ”¹äº†é¡µé¢çš„å†…å®¹ï¼Œæ­¤æ—¶åˆ·æ–°é¡µé¢ï¼Œä¼šå‘ç°é¡µé¢ä¸­çš„å…¬å¼ä¸èƒ½è¢«æ¸²æŸ“äº†ï¼Œåªèƒ½é‡æ–°å¯åŠ¨hexoæœåŠ¡ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä½†æ˜¯ä½¿ç”¨<code>hexo-renderer-markdown-it</code>æ¸²æŸ“å™¨æ—¶ï¼Œåˆ·æ–°é¡µé¢åå…¬å¼å°±å¯ä»¥è¢«æ¸²æŸ“äº†ã€‚</p>\n</li>\n</ul>\n</div>\n<hr>\n<h2 id=\"ä½¿ç”¨\">ä½¿ç”¨</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ¯ä¸ªé¡µé¢çš„<code>front-matter</code>ä¸­è¦æ·»åŠ <code>mathjax: true</code>ï¼Œè¿™æ ·åœ¨é¡µé¢ä¸­å°±å¯ä»¥ä½¿ç”¨å…¬å¼äº†ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><code>Katex</code>å…¬å¼çš„æ¸²æŸ“æ–¹å¼æ”¯æŒ<code>$...$</code>å’Œ<code>$$...$$</code>ä¸¤ç§æ–¹å¼</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-5\"><code>$...$</code>ä¸ºè¡Œçº§å…¬å¼</li>\n</ul>\n <figure class=\"highlight latex\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">$</span>sin(<span class=\"keyword\">\\omega</span> t)=<span class=\"keyword\">\\frac</span>&#123;1&#125;&#123;2j&#125;(e<span class=\"built_in\">^</span>&#123;j<span class=\"keyword\">\\omega</span> t&#125;-e<span class=\"built_in\">^</span>&#123;-j<span class=\"keyword\">\\omega</span> t&#125;)<span class=\"built_in\">$</span></span><br></pre></td></tr></table></figure>\n<p><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>s</mi><mi>i</mi><mi>n</mi><mo stretchy=\"false\">(</mo><mi>Ï‰</mi><mi>t</mi><mo stretchy=\"false\">)</mo><mo>=</mo><mfrac><mn>1</mn><mrow><mn>2</mn><mi>j</mi></mrow></mfrac><mo stretchy=\"false\">(</mo><msup><mi>e</mi><mrow><mi>j</mi><mi>Ï‰</mi><mi>t</mi></mrow></msup><mo>âˆ’</mo><msup><mi>e</mi><mrow><mo>âˆ’</mo><mi>j</mi><mi>Ï‰</mi><mi>t</mi></mrow></msup><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">sin(\\omega t)=\\frac{1}{2j}(e^{j\\omega t}-e^{-j\\omega t})</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">s</span><span class=\"mord mathnormal\">i</span><span class=\"mord mathnormal\">n</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">Ï‰</span><span class=\"mord mathnormal\">t</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.326216em;vertical-align:-0.481108em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.845108em;\"><span style=\"top:-2.6550000000000002em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">2</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j</span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.394em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.481108em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\">e</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.824664em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">Ï‰</span><span class=\"mord mathnormal mtight\">t</span></span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">âˆ’</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.0746639999999998em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">e</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.824664em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">âˆ’</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">Ï‰</span><span class=\"mord mathnormal mtight\">t</span></span></span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span></span></p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-5\"><code>$$...$$</code>ä¸ºå—çº§å…¬å¼ï¼Œç‹¬å ä¸€è¡Œä¸”å±…ä¸­å±•ç¤º</li>\n</ul>\n <figure class=\"highlight latex\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">$</span><span class=\"built_in\">$</span></span><br><span class=\"line\">sin(<span class=\"keyword\">\\omega</span> t)=<span class=\"keyword\">\\frac</span>&#123;1&#125;&#123;2j&#125;(e<span class=\"built_in\">^</span>&#123;j<span class=\"keyword\">\\omega</span> t&#125;-e<span class=\"built_in\">^</span>&#123;-j<span class=\"keyword\">\\omega</span> t&#125;)</span><br><span class=\"line\"><span class=\"built_in\">$</span><span class=\"built_in\">$</span></span><br></pre></td></tr></table></figure>\n<p class='katex-block'><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>s</mi><mi>i</mi><mi>n</mi><mo stretchy=\"false\">(</mo><mi>Ï‰</mi><mi>t</mi><mo stretchy=\"false\">)</mo><mo>=</mo><mfrac><mn>1</mn><mrow><mn>2</mn><mi>j</mi></mrow></mfrac><mo stretchy=\"false\">(</mo><msup><mi>e</mi><mrow><mi>j</mi><mi>Ï‰</mi><mi>t</mi></mrow></msup><mo>âˆ’</mo><msup><mi>e</mi><mrow><mo>âˆ’</mo><mi>j</mi><mi>Ï‰</mi><mi>t</mi></mrow></msup><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">sin(\\omega t)=\\frac{1}{2j}(e^{j\\omega t}-e^{-j\\omega t})\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">s</span><span class=\"mord mathnormal\">i</span><span class=\"mord mathnormal\">n</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">Ï‰</span><span class=\"mord mathnormal\">t</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:2.20188em;vertical-align:-0.8804400000000001em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.32144em;\"><span style=\"top:-2.314em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">2</span><span class=\"mord mathnormal\" style=\"margin-right:0.05724em;\">j</span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">1</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8804400000000001em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\">e</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.874664em;\"><span style=\"top:-3.1130000000000004em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">Ï‰</span><span class=\"mord mathnormal mtight\">t</span></span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">âˆ’</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.124664em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">e</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.874664em;\"><span style=\"top:-3.1130000000000004em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">âˆ’</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">Ï‰</span><span class=\"mord mathnormal mtight\">t</span></span></span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span></span></span></p>\n</li>\n<li class=\"lvl-2\">\n<p><code>$$...$$</code>å’Œ<code>$...$</code>ä¸­ä¸èƒ½å‡ºç°Unicodeå­—ç¬¦ï¼Œå¦åˆ™ä¼šæŠ¥é”™ï¼Œå³ä¸æ”¯æŒä¸­æ–‡ï¼Œå¦‚æœéœ€è¦æ˜¾ç¤ºä¸­æ–‡ï¼Œåˆ™éœ€è¦ä½¿ç”¨<code>\\text&#123;ä¸­æ–‡&#125;</code></p>\n</li>\n<li class=\"lvl-2\">\n<p>å—çº§å…¬å¼ï¼Œåœ¨å¼€å¤´çš„<code>$$</code>ä¹‹å‰å’Œç»“å°¾çš„<code>$$</code>ä¹‹åï¼Œä¸å¾—æœ‰ä»»ä½•å­—ç¬¦ï¼ˆç©ºæ ¼é™¤å¤–ï¼‰</p>\n</li>\n<li class=\"lvl-2\">\n<p>è¡Œçº§å…¬å¼ï¼Œåœ¨å¼€å¤´çš„<code>$</code>ä¹‹åå’Œç»“å°¾çš„<code>$</code>ä¹‹å‰ï¼Œä¸å¾—æœ‰ç©ºæ ¼</p>\n</li>\n</ul>\n<h2 id=\"ç¤ºä¾‹\">ç¤ºä¾‹</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä½¿ç”¨æ–¹å¼å¯ä»¥å‚è€ƒ <a href=\"https://katex.org/docs/supported\">KaTeXå…¬å¼ç¬¦å·</a> ä»¥åŠ <a href=\"https://zh.wikipedia.org/wiki/Help:%E6%95%B0%E5%AD%A6%E5%85%AC%E5%BC%8F\">ç»´åŸºç™¾ç§‘ï¼šLaTeXå…¬å¼æ‰‹å†Œ</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>ä¸è¿‡è®°ä½è¿™äº›å…¬å¼ç¬¦å·è¿˜æ˜¯æ¯”è¾ƒå›°éš¾çš„ï¼Œè¿™é‡Œæ¨èä¸¤ä¸ªå·¥å…·</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-5\"><a href=\"https://webdemo.myscript.com/views/math/index.html\">MyScript</a>: æ‰‹å†™è½¬LaTeXå…¬å¼ï¼Œç›´æ¥å°†ä½ éœ€è¦çš„æ•°å­¦å…¬å¼ç”»å‡ºæ¥ï¼Œå®ƒä¼šè‡ªåŠ¨å°†å…¶è½¬æ¢ä¸ºLaTeXå…¬å¼ï¼Œç„¶åå¤åˆ¶å³å¯</li>\n<li class=\"lvl-5\"><a href=\"https://www.latexlive.com/home\">LaTeXå…¬å¼ç¼–è¾‘å™¨</a>: æä¾›å…¬å¼æ¨¡æ¿ã€å›¾ç‰‡è¯†åˆ«(æœ‰æ¬¡æ•°é™åˆ¶)ç­‰åŠŸèƒ½ï¼Œå¹¶ä¸”æ”¯æŒè¾“å‡ºå„ç§æ ¼å¼ã€‚</li>\n<li class=\"lvl-5\"><a href=\"https://simpletex.cn/ai/latex_ocr\">Simpletex</a>: æ”¯æŒLaTexå…¬å¼å›¾ç‰‡è¯†åˆ«å’Œæ‰‹å†™è½¬å…¬å¼ï¼Œä¸”æ— æ¬¡æ•°é™åˆ¶ï¼Œä½†æ˜¯éœ€è¦æ³¨å†Œè´¦å·ã€‚åŒæ—¶ä¹Ÿæä¾›äº†å®¢æˆ·ç«¯ç‰ˆæœ¬ã€‚</li>\n</ul>\n</li>\n</ul>\n<hr>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¿™é‡Œéšä¾¿ç»™å‡ ä¸ªç¤ºä¾‹ï¼Œä»¥ä¸‹æ˜¯<code>LaTeX</code>çš„æ ‡å‡†è¯­æ³•</p>\n</li>\n</ul>\n<hr>\n<figure class=\"highlight latex\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">$</span><span class=\"built_in\">$</span></span><br><span class=\"line\"><span class=\"keyword\">\\left</span>(<span class=\"keyword\">\\beta</span> m c<span class=\"built_in\">^</span>2 + c <span class=\"keyword\">\\left</span>(<span class=\"keyword\">\\sum</span><span class=\"built_in\">_</span>&#123;n=1&#125;<span class=\"built_in\">^</span>3<span class=\"keyword\">\\alpha</span><span class=\"built_in\">_</span>n p<span class=\"built_in\">_</span>n<span class=\"keyword\">\\right</span>)<span class=\"keyword\">\\right</span>) <span class=\"keyword\">\\psi</span>(x,t)</span><br><span class=\"line\">= i<span class=\"keyword\">\\hbar</span> <span class=\"keyword\">\\frac</span>&#123;<span class=\"keyword\">\\partial</span> <span class=\"keyword\">\\psi</span>(x,t)&#125;&#123;<span class=\"keyword\">\\partial</span> t&#125;</span><br><span class=\"line\"><span class=\"built_in\">$</span><span class=\"built_in\">$</span></span><br></pre></td></tr></table></figure>\n<p class='katex-block'><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mrow><mo fence=\"true\">(</mo><mi>Î²</mi><mi>m</mi><msup><mi>c</mi><mn>2</mn></msup><mo>+</mo><mi>c</mi><mrow><mo fence=\"true\">(</mo><munderover><mo>âˆ‘</mo><mrow><mi>n</mi><mo>=</mo><mn>1</mn></mrow><mn>3</mn></munderover><msub><mi>Î±</mi><mi>n</mi></msub><msub><mi>p</mi><mi>n</mi></msub><mo fence=\"true\">)</mo></mrow><mo fence=\"true\">)</mo></mrow><mi>Ïˆ</mi><mo stretchy=\"false\">(</mo><mi>x</mi><mo separator=\"true\">,</mo><mi>t</mi><mo stretchy=\"false\">)</mo><mo>=</mo><mi>i</mi><mi mathvariant=\"normal\">â„</mi><mfrac><mrow><mi mathvariant=\"normal\">âˆ‚</mi><mi>Ïˆ</mi><mo stretchy=\"false\">(</mo><mi>x</mi><mo separator=\"true\">,</mo><mi>t</mi><mo stretchy=\"false\">)</mo></mrow><mrow><mi mathvariant=\"normal\">âˆ‚</mi><mi>t</mi></mrow></mfrac></mrow><annotation encoding=\"application/x-tex\">\\left(\\beta m c^2 + c \\left(\\sum_{n=1}^3\\alpha_n p_n\\right)\\right) \\psi(x,t)\n= i\\hbar \\frac{\\partial \\psi(x,t)}{\\partial t}\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:3.068226em;vertical-align:-1.267113em;\"></span><span class=\"minner\"><span class=\"mopen delimcenter\" style=\"top:0em;\"><span class=\"delimsizing size4\">(</span></span><span class=\"mord mathnormal\" style=\"margin-right:0.05278em;\">Î²</span><span class=\"mord mathnormal\">m</span><span class=\"mord\"><span class=\"mord mathnormal\">c</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8641079999999999em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord mathnormal\">c</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"minner\"><span class=\"mopen delimcenter\" style=\"top:0em;\"><span class=\"delimsizing size4\">(</span></span><span class=\"mop op-limits\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.8011130000000004em;\"><span style=\"top:-1.882887em;margin-left:0em;\"><span class=\"pstrut\" style=\"height:3.05em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">n</span><span class=\"mrel mtight\">=</span><span class=\"mord mtight\">1</span></span></span></span><span style=\"top:-3.050005em;\"><span class=\"pstrut\" style=\"height:3.05em;\"></span><span><span class=\"mop op-symbol large-op\">âˆ‘</span></span></span><span style=\"top:-4.3000050000000005em;margin-left:0em;\"><span class=\"pstrut\" style=\"height:3.05em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">3</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.267113em;\"><span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.0037em;\">Î±</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.0037em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">n</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord mathnormal\">p</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">n</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose delimcenter\" style=\"top:0em;\"><span class=\"delimsizing size4\">)</span></span></span><span class=\"mclose delimcenter\" style=\"top:0em;\"><span class=\"delimsizing size4\">)</span></span></span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">Ïˆ</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathnormal\">t</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:2.113em;vertical-align:-0.686em;\"></span><span class=\"mord mathnormal\">i</span><span class=\"mord\">â„</span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.427em;\"><span style=\"top:-2.314em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\" style=\"margin-right:0.05556em;\">âˆ‚</span><span class=\"mord mathnormal\">t</span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\" style=\"margin-right:0.05556em;\">âˆ‚</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">Ïˆ</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathnormal\">t</span><span class=\"mclose\">)</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.686em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span></span></span></p>\n<hr>\n<figure class=\"highlight latex\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Aha! <span class=\"built_in\">$</span>E = mc<span class=\"built_in\">^</span>&#123;2&#125;<span class=\"built_in\">$</span>.</span><br></pre></td></tr></table></figure>\n<p>Aha! <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>E</mi><mo>=</mo><mi>m</mi><msup><mi>c</mi><mn>2</mn></msup></mrow><annotation encoding=\"application/x-tex\">E = mc^{2}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">E</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">m</span><span class=\"mord\"><span class=\"mord mathnormal\">c</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span></span></span></span></span>.</p>\n<hr>\n<figure class=\"highlight latex\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">$</span><span class=\"built_in\">$</span></span><br><span class=\"line\"><span class=\"keyword\">\\left</span>(<span class=\"keyword\">\\LARGE</span>&#123;AB&#125;<span class=\"keyword\">\\right</span>)</span><br><span class=\"line\"><span class=\"built_in\">$</span><span class=\"built_in\">$</span></span><br></pre></td></tr></table></figure>\n<p class='katex-block'><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mo fence=\"true\">(</mo><mstyle mathsize=\"1.728em\"><mrow><mi>A</mi><mi>B</mi></mrow></mstyle><mo fence=\"true\">)</mo></mrow><annotation encoding=\"application/x-tex\">\\left(\\LARGE{AB}\\right)\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.83081424em;vertical-align:-0.65002em;\"></span><span class=\"minner\"><span class=\"mopen delimcenter\" style=\"top:0em;\"><span class=\"delimsizing size2\">(</span></span><span class=\"mord sizing reset-size6 size9\"><span class=\"mord mathnormal\">A</span><span class=\"mord mathnormal\" style=\"margin-right:0.05017em;\">B</span></span><span class=\"mclose delimcenter\" style=\"top:0em;\"><span class=\"delimsizing size2\">)</span></span></span></span></span></span></span></p>\n<hr>\n<figure class=\"highlight latex\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">$</span><span class=\"built_in\">$</span></span><br><span class=\"line\"><span class=\"keyword\">\\begin</span>&#123;matrix&#125;</span><br><span class=\"line\">   a <span class=\"built_in\">&amp;</span> b <span class=\"keyword\">\\\\</span></span><br><span class=\"line\">   c <span class=\"built_in\">&amp;</span> d</span><br><span class=\"line\"><span class=\"keyword\">\\end</span>&#123;matrix&#125;</span><br><span class=\"line\"><span class=\"built_in\">$</span><span class=\"built_in\">$</span></span><br></pre></td></tr></table></figure>\n<p class='katex-block'><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mtable rowspacing=\"0.15999999999999992em\" columnspacing=\"1em\"><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mi>a</mi></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mi>b</mi></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mi>c</mi></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mi>d</mi></mstyle></mtd></mtr></mtable><annotation encoding=\"application/x-tex\">\\begin{matrix}\n   a &amp; b \\\\\n   c &amp; d\n\\end{matrix}\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:2.4000000000000004em;vertical-align:-0.9500000000000004em;\"></span><span class=\"mord\"><span class=\"mtable\"><span class=\"col-align-c\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.45em;\"><span style=\"top:-3.61em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span></span></span><span style=\"top:-2.4099999999999997em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">c</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.9500000000000004em;\"><span></span></span></span></span></span><span class=\"arraycolsep\" style=\"width:0.5em;\"></span><span class=\"arraycolsep\" style=\"width:0.5em;\"></span><span class=\"col-align-c\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.45em;\"><span style=\"top:-3.61em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">b</span></span></span><span style=\"top:-2.4099999999999997em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">d</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.9500000000000004em;\"><span></span></span></span></span></span></span></span></span></span></span></span></p>\n<hr>\n<figure class=\"highlight latex\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">$</span><span class=\"built_in\">$</span></span><br><span class=\"line\"><span class=\"keyword\">\\def</span><span class=\"keyword\">\\arraystretch</span>&#123;1.5&#125;</span><br><span class=\"line\">   <span class=\"keyword\">\\begin</span>&#123;array&#125;&#123;c:c:c&#125;</span><br><span class=\"line\">   a <span class=\"built_in\">&amp;</span> b <span class=\"built_in\">&amp;</span> c <span class=\"keyword\">\\\\</span> <span class=\"keyword\">\\hline</span></span><br><span class=\"line\">   d <span class=\"built_in\">&amp;</span> e <span class=\"built_in\">&amp;</span> f <span class=\"keyword\">\\\\</span></span><br><span class=\"line\">   <span class=\"keyword\">\\hdashline</span></span><br><span class=\"line\">   g <span class=\"built_in\">&amp;</span> h <span class=\"built_in\">&amp;</span> i</span><br><span class=\"line\"><span class=\"keyword\">\\end</span>&#123;array&#125;</span><br><span class=\"line\"><span class=\"built_in\">$</span><span class=\"built_in\">$</span></span><br></pre></td></tr></table></figure>\n<p class='katex-block'><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mtable rowspacing=\"0.6599999999999999em\" columnalign=\"center center center\" columnlines=\"dashed dashed\" columnspacing=\"1em\" rowlines=\"solid dashed\"><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mi>a</mi></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mi>b</mi></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mi>c</mi></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mi>d</mi></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mi>e</mi></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mi>f</mi></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mi>g</mi></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mi>h</mi></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mi>i</mi></mstyle></mtd></mtr></mtable><annotation encoding=\"application/x-tex\">\\def\\arraystretch{1.5}\n   \\begin{array}{c:c:c}\n   a &amp; b &amp; c \\\\ \\hline\n   d &amp; e &amp; f \\\\\n   \\hdashline\n   g &amp; h &amp; i\n\\end{array}\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:5.4em;vertical-align:-2.45em;\"></span><span class=\"mord\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:2.95em;\"><span style=\"top:-4.95em;\"><span class=\"pstrut\" style=\"height:4.95em;\"></span><span class=\"mtable\"><span class=\"arraycolsep\" style=\"width:0.5em;\"></span><span class=\"col-align-c\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:2.95em;\"><span style=\"top:-4.95em;\"><span class=\"pstrut\" style=\"height:3.26em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span></span></span><span style=\"top:-3.15em;\"><span class=\"pstrut\" style=\"height:3.26em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">d</span></span></span><span style=\"top:-1.3499999999999996em;\"><span class=\"pstrut\" style=\"height:3.26em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:2.45em;\"><span></span></span></span></span></span><span class=\"arraycolsep\" style=\"width:0.5em;\"></span><span class=\"vertical-separator\" style=\"height:5.4em;border-right-width:0.04em;border-right-style:dashed;margin:0 -0.02em;vertical-align:-2.45em;\"></span><span class=\"arraycolsep\" style=\"width:0.5em;\"></span><span class=\"col-align-c\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:2.95em;\"><span style=\"top:-4.95em;\"><span class=\"pstrut\" style=\"height:3.26em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">b</span></span></span><span style=\"top:-3.15em;\"><span class=\"pstrut\" style=\"height:3.26em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">e</span></span></span><span style=\"top:-1.3499999999999996em;\"><span class=\"pstrut\" style=\"height:3.26em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">h</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:2.45em;\"><span></span></span></span></span></span><span class=\"arraycolsep\" style=\"width:0.5em;\"></span><span class=\"vertical-separator\" style=\"height:5.4em;border-right-width:0.04em;border-right-style:dashed;margin:0 -0.02em;vertical-align:-2.45em;\"></span><span class=\"arraycolsep\" style=\"width:0.5em;\"></span><span class=\"col-align-c\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:2.95em;\"><span style=\"top:-4.95em;\"><span class=\"pstrut\" style=\"height:3.26em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">c</span></span></span><span style=\"top:-3.15em;\"><span class=\"pstrut\" style=\"height:3.26em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span></span></span><span style=\"top:-1.3499999999999996em;\"><span class=\"pstrut\" style=\"height:3.26em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">i</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:2.45em;\"><span></span></span></span></span></span><span class=\"arraycolsep\" style=\"width:0.5em;\"></span></span></span><span style=\"top:-4.300000000000001em;\"><span class=\"pstrut\" style=\"height:4.95em;\"></span><span class=\"hdashline\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-6.1000000000000005em;\"><span class=\"pstrut\" style=\"height:4.95em;\"></span><span class=\"hline\" style=\"border-bottom-width:0.04em;\"></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:2.45em;\"><span></span></span></span></span></span></span></span></span></span></p>\n<hr>\n<figure class=\"highlight latex\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">$</span><span class=\"keyword\">\\tilde</span>&#123;a&#125;<span class=\"built_in\">$</span>  <span class=\"built_in\">&amp;</span>nbsp;<span class=\"built_in\">&amp;</span>nbsp; <span class=\"built_in\">&amp;</span>nbsp; <span class=\"built_in\">&amp;</span>nbsp; <span class=\"built_in\">&amp;</span>nbsp; <span class=\"built_in\">$</span><span class=\"keyword\">\\underrightarrow</span>&#123;AB&#125;<span class=\"built_in\">$</span></span><br></pre></td></tr></table></figure>\n<p><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mover accent=\"true\"><mi>a</mi><mo>~</mo></mover></mrow><annotation encoding=\"application/x-tex\">\\tilde{a}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6678599999999999em;vertical-align:0em;\"></span><span class=\"mord accent\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.6678599999999999em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span></span></span><span style=\"top:-3.35em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"accent-body\" style=\"left:-0.25em;\"><span class=\"mord\">~</span></span></span></span></span></span></span></span></span></span>  Â Â  Â  Â  Â  <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><munder accentunder=\"true\"><mrow><mi>A</mi><mi>B</mi></mrow><mo stretchy=\"true\">â†’</mo></munder></mrow><annotation encoding=\"application/x-tex\">\\underrightarrow{AB}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.20533em;vertical-align:-0.522em;\"></span><span class=\"mord accentunder\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.68333em;\"><span class=\"svg-align\" style=\"top:-2.4779999999999998em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"hide-tail\" style=\"height:0.522em;min-width:0.888em;\"><svg width='400em' height='0.522em' viewBox='0 0 400000 522' preserveAspectRatio='xMaxYMin slice'><path d='M0 241v40h399891c-47.3 35.3-84 78-110 128\n-16.7 32-27.7 63.7-33 95 0 1.3-.2 2.7-.5 4-.3 1.3-.5 2.3-.5 3 0 7.3 6.7 11 20\n 11 8 0 13.2-.8 15.5-2.5 2.3-1.7 4.2-5.5 5.5-11.5 2-13.3 5.7-27 11-41 14.7-44.7\n 39-84.5 73-119.5s73.7-60.2 119-75.5c6-2 9-5.7 9-11s-3-9-9-11c-45.3-15.3-85\n-40.5-119-75.5s-58.3-74.8-73-119.5c-4.7-14-8.3-27.3-11-40-1.3-6.7-3.2-10.8-5.5\n-12.5-2.3-1.7-7.5-2.5-15.5-2.5-14 0-21 3.7-21 11 0 2 2 10.3 6 25 20.7 83.3 67\n 151.7 139 205zm0 0v40h399900v-40z'/></svg></span></span><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">A</span><span class=\"mord mathnormal\" style=\"margin-right:0.05017em;\">B</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.522em;\"><span></span></span></span></span></span></span></span></span></p>\n<hr>\n<figure class=\"highlight latex\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">$</span><span class=\"built_in\">$</span></span><br><span class=\"line\"><span class=\"keyword\">\\tilde</span>&#123;a&#125; <span class=\"keyword\">\\underrightarrow</span>&#123;AB&#125;<span class=\"keyword\">\\begin</span>&#123;array&#125;&#123;l&#125;</span><br><span class=\"line\">  a<span class=\"keyword\">\\mathop</span>&#123;x&#125;<span class=\"keyword\">\\nolimits</span><span class=\"built_in\">^</span>&#123;2&#125;+bx+c=0 <span class=\"keyword\">\\\\</span></span><br><span class=\"line\">  <span class=\"keyword\">\\Delta</span> =<span class=\"keyword\">\\mathop</span>&#123;b&#125;<span class=\"keyword\">\\nolimits</span><span class=\"built_in\">^</span>&#123;2&#125;-4ac <span class=\"keyword\">\\\\</span></span><br><span class=\"line\">  <span class=\"keyword\">\\left</span><span class=\"keyword\">\\&#123;</span><span class=\"keyword\">\\begin</span>&#123;matrix&#125;</span><br><span class=\"line\">  <span class=\"keyword\">\\Delta</span> <span class=\"keyword\">\\gt</span> 0<span class=\"keyword\">\\text</span>&#123;æ–¹ç¨‹æœ‰ä¸¤ä¸ªä¸ç›¸ç­‰çš„å®æ ¹&#125; <span class=\"keyword\">\\\\</span></span><br><span class=\"line\">  <span class=\"keyword\">\\Delta</span> = 0<span class=\"keyword\">\\text</span>&#123;æ–¹ç¨‹æœ‰ä¸¤ä¸ªç›¸ç­‰çš„å®æ ¹&#125; <span class=\"keyword\">\\\\</span></span><br><span class=\"line\">  <span class=\"keyword\">\\Delta</span> <span class=\"keyword\">\\lt</span> 0<span class=\"keyword\">\\text</span>&#123;æ–¹ç¨‹æ— å®æ ¹&#125;</span><br><span class=\"line\"><span class=\"keyword\">\\end</span>&#123;matrix&#125;<span class=\"keyword\">\\right</span>.</span><br><span class=\"line\"><span class=\"keyword\">\\end</span>&#123;array&#125;</span><br><span class=\"line\"><span class=\"built_in\">$</span><span class=\"built_in\">$</span></span><br></pre></td></tr></table></figure>\n<p class='katex-block'><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mover accent=\"true\"><mi>a</mi><mo>~</mo></mover><munder accentunder=\"true\"><mrow><mi>A</mi><mi>B</mi></mrow><mo stretchy=\"true\">â†’</mo></munder><mtable rowspacing=\"0.15999999999999992em\" columnalign=\"left\" columnspacing=\"1em\"><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mrow><mi>a</mi><msup><mo><mi>x</mi></mo><mn>2</mn></msup><mo>+</mo><mi>b</mi><mi>x</mi><mo>+</mo><mi>c</mi><mo>=</mo><mn>0</mn></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mrow><mi mathvariant=\"normal\">Î”</mi><mo>=</mo><msup><mo><mi>b</mi></mo><mn>2</mn></msup><mo>âˆ’</mo><mn>4</mn><mi>a</mi><mi>c</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mrow><mo fence=\"true\">{</mo><mtable rowspacing=\"0.15999999999999992em\" columnspacing=\"1em\"><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mrow><mi mathvariant=\"normal\">Î”</mi><mo>&gt;</mo><mn>0</mn><mtext>Â æ–¹ç¨‹æœ‰ä¸¤ä¸ªä¸ç›¸ç­‰çš„å®æ ¹</mtext></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mrow><mi mathvariant=\"normal\">Î”</mi><mo>=</mo><mn>0</mn><mtext>Â æ–¹ç¨‹æœ‰ä¸¤ä¸ªç›¸ç­‰çš„å®æ ¹</mtext></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mrow><mi mathvariant=\"normal\">Î”</mi><mo>&lt;</mo><mn>0</mn><mtext>Â æ–¹ç¨‹æ— å®æ ¹</mtext></mrow></mstyle></mtd></mtr></mtable></mrow></mstyle></mtd></mtr></mtable></mrow><annotation encoding=\"application/x-tex\">\\tilde{a} \\underrightarrow{AB}\\begin{array}{l}\n  a\\mathop{x}\\nolimits^{2}+bx+c=0 \\\\\n  \\Delta =\\mathop{b}\\nolimits^{2}-4ac \\\\\n  \\left\\{\\begin{matrix}\n  \\Delta \\gt 0\\text{ æ–¹ç¨‹æœ‰ä¸¤ä¸ªä¸ç›¸ç­‰çš„å®æ ¹} \\\\\n  \\Delta = 0\\text{ æ–¹ç¨‹æœ‰ä¸¤ä¸ªç›¸ç­‰çš„å®æ ¹} \\\\\n  \\Delta \\lt 0\\text{ æ–¹ç¨‹æ— å®æ ¹}\n\\end{matrix}\\right.\n\\end{array}\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:6.0584880000000005em;vertical-align:-2.7792439999999994em;\"></span><span class=\"mord accent\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.6678599999999999em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span></span></span><span style=\"top:-3.35em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"accent-body\" style=\"left:-0.25em;\"><span class=\"mord\">~</span></span></span></span></span></span></span><span class=\"mord accentunder\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.68333em;\"><span class=\"svg-align\" style=\"top:-2.4779999999999998em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"hide-tail\" style=\"height:0.522em;min-width:0.888em;\"><svg width='400em' height='0.522em' viewBox='0 0 400000 522' preserveAspectRatio='xMaxYMin slice'><path d='M0 241v40h399891c-47.3 35.3-84 78-110 128\n-16.7 32-27.7 63.7-33 95 0 1.3-.2 2.7-.5 4-.3 1.3-.5 2.3-.5 3 0 7.3 6.7 11 20\n 11 8 0 13.2-.8 15.5-2.5 2.3-1.7 4.2-5.5 5.5-11.5 2-13.3 5.7-27 11-41 14.7-44.7\n 39-84.5 73-119.5s73.7-60.2 119-75.5c6-2 9-5.7 9-11s-3-9-9-11c-45.3-15.3-85\n-40.5-119-75.5s-58.3-74.8-73-119.5c-4.7-14-8.3-27.3-11-40-1.3-6.7-3.2-10.8-5.5\n-12.5-2.3-1.7-7.5-2.5-15.5-2.5-14 0-21 3.7-21 11 0 2 2 10.3 6 25 20.7 83.3 67\n 151.7 139 205zm0 0v40h399900v-40z'/></svg></span></span><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">A</span><span class=\"mord mathnormal\" style=\"margin-right:0.05017em;\">B</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.522em;\"><span></span></span></span></span></span><span class=\"mord\"><span class=\"mtable\"><span class=\"arraycolsep\" style=\"width:0.5em;\"></span><span class=\"col-align-l\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:3.2792440000000007em;\"><span style=\"top:-6.489264000000001em;\"><span class=\"pstrut\" style=\"height:4.05002em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mop\"><span class=\"mop mathnormal\" style=\"position:relative;top:-0.03472em;\">x</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\">+</span><span class=\"mord mathnormal\">b</span><span class=\"mord mathnormal\">x</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord mathnormal\">c</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mord\">0</span></span></span><span style=\"top:-5.230816em;\"><span class=\"pstrut\" style=\"height:4.05002em;\"></span><span class=\"mord\"><span class=\"mord\">Î”</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mop\"><span class=\"mop mathnormal\" style=\"position:relative;top:0.09721999999999997em;\">b</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8984479999999999em;\"><span style=\"top:-3.1473400000000002em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\">âˆ’</span><span class=\"mord\">4</span><span class=\"mord mathnormal\">a</span><span class=\"mord mathnormal\">c</span></span></span><span style=\"top:-2.8207960000000005em;\"><span class=\"pstrut\" style=\"height:4.05002em;\"></span><span class=\"mord\"><span class=\"minner\"><span class=\"mopen\"><span class=\"delimsizing mult\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:2.05002em;\"><span style=\"top:-2.49999em;\"><span class=\"pstrut\" style=\"height:3.15em;\"></span><span class=\"delimsizinginner delim-size4\"><span>â©</span></span></span><span style=\"top:-2.20499em;\"><span class=\"pstrut\" style=\"height:3.15em;\"></span><span class=\"delimsizinginner delim-size4\"><span>âª</span></span></span><span style=\"top:-3.15001em;\"><span class=\"pstrut\" style=\"height:3.15em;\"></span><span class=\"delimsizinginner delim-size4\"><span>â¨</span></span></span><span style=\"top:-4.00501em;\"><span class=\"pstrut\" style=\"height:3.15em;\"></span><span class=\"delimsizinginner delim-size4\"><span>âª</span></span></span><span style=\"top:-4.30002em;\"><span class=\"pstrut\" style=\"height:3.15em;\"></span><span class=\"delimsizinginner delim-size4\"><span>â§</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.55002em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mtable\"><span class=\"col-align-c\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:2.05em;\"><span style=\"top:-4.21em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">Î”</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">&gt;</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mord\">0</span><span class=\"mord text\"><span class=\"mord\">Â </span><span class=\"mord cjk_fallback\">æ–¹ç¨‹æœ‰ä¸¤ä¸ªä¸ç›¸ç­‰çš„å®æ ¹</span></span></span></span><span style=\"top:-3.0099999999999993em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">Î”</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mord\">0</span><span class=\"mord text\"><span class=\"mord\">Â </span><span class=\"mord cjk_fallback\">æ–¹ç¨‹æœ‰ä¸¤ä¸ªç›¸ç­‰çš„å®æ ¹</span></span></span></span><span style=\"top:-1.8099999999999994em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">Î”</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">&lt;</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mord\">0</span><span class=\"mord text\"><span class=\"mord\">Â </span><span class=\"mord cjk_fallback\">æ–¹ç¨‹æ— å®æ ¹</span></span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.5500000000000007em;\"><span></span></span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:2.7792439999999994em;\"><span></span></span></span></span></span><span class=\"arraycolsep\" style=\"width:0.5em;\"></span></span></span></span></span></span></span></p>\n<hr>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä»¥ä¸‹ä¸ºå¼€å¯<code>Auto-render Extension</code>åæ”¯æŒçš„å…¬å¼è¯­æ³•ï¼Œå¹¶ä¸æ˜¯<code>LaTex</code>çš„æ ‡å‡†è¯­æ³•</p>\n</li>\n</ul>\n<hr>\n<figure class=\"highlight latex\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">$</span><span class=\"built_in\">$</span></span><br><span class=\"line\"><span class=\"keyword\">\\begin</span>&#123;equation&#125;</span><br><span class=\"line\"><span class=\"keyword\">\\begin</span>&#123;split&#125;   a <span class=\"built_in\">&amp;</span>=b+c<span class=\"keyword\">\\\\</span></span><br><span class=\"line\">      <span class=\"built_in\">&amp;</span>=e+f</span><br><span class=\"line\"><span class=\"keyword\">\\end</span>&#123;split&#125;</span><br><span class=\"line\"><span class=\"keyword\">\\end</span>&#123;equation&#125;</span><br><span class=\"line\"><span class=\"built_in\">$</span><span class=\"built_in\">$</span></span><br></pre></td></tr></table></figure>\n<p class='katex-block katex-error' title='ParseError: KaTeX parse error: No such environment: equation at position 7: \\begin{Ì²eÌ²qÌ²uÌ²aÌ²tÌ²iÌ²oÌ²nÌ²}Ì²\n\\begin{split} â€¦'>\\begin{equation}\n\\begin{split}   a &amp;=b+c\\\\\n      &amp;=e+f\n\\end{split}\n\\end{equation}\n</p>\n<hr>\n<figure class=\"highlight latex\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">$</span><span class=\"built_in\">$</span></span><br><span class=\"line\"><span class=\"keyword\">\\begin</span>&#123;align&#125;</span><br><span class=\"line\">   a<span class=\"built_in\">&amp;</span>=b+c <span class=\"keyword\">\\\\</span></span><br><span class=\"line\">   d+e<span class=\"built_in\">&amp;</span>=f</span><br><span class=\"line\"><span class=\"keyword\">\\end</span>&#123;align&#125;</span><br><span class=\"line\"><span class=\"built_in\">$</span><span class=\"built_in\">$</span></span><br></pre></td></tr></table></figure>\n<p class='katex-block katex-error' title='ParseError: KaTeX parse error: No such environment: align at position 7: \\begin{Ì²aÌ²lÌ²iÌ²gÌ²nÌ²}Ì²\n   a&amp;=b+c \\\\\n â€¦'>\\begin{align}\n   a&amp;=b+c \\\\\n   d+e&amp;=f\n\\end{align}\n</p>\n<hr>\n<figure class=\"highlight latex\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">$</span><span class=\"built_in\">$</span></span><br><span class=\"line\"><span class=\"keyword\">\\begin</span>&#123;CD&#125;</span><br><span class=\"line\">   A @&gt;a&gt;&gt; B <span class=\"keyword\">\\\\</span></span><br><span class=\"line\">@VbVV @AAcA <span class=\"keyword\">\\\\</span></span><br><span class=\"line\">   C @= D</span><br><span class=\"line\"><span class=\"keyword\">\\end</span>&#123;CD&#125;</span><br><span class=\"line\"><span class=\"built_in\">$</span><span class=\"built_in\">$</span></span><br></pre></td></tr></table></figure>\n<p class='katex-block katex-error' title='ParseError: KaTeX parse error: No such environment: CD at position 7: \\begin{Ì²CÌ²DÌ²}Ì²\n   A @&gt;a&gt;&gt; B \\â€¦'>\\begin{CD}\n   A @&gt;a&gt;&gt; B \\\\\n@VbVV @AAcA \\\\\n   C @= D\n\\end{CD}\n</p>\n","content_text":"æ‘˜è¦ Hexoæ˜¯åŸºäºmarkdownçš„ï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨LaTexè¯­æ³•æ¥ç¼–å†™æ•°å­¦å…¬å¼ï¼Œåªä¸è¿‡éœ€è¦å®‰è£…ç›¸åº”çš„å…¬å¼æ¸²æŸ“æ’ä»¶æ¥å®ç°ã€‚ Nextä¸»é¢˜ æ”¯æŒçš„å…¬å¼æ’ä»¶ä¸ºMathJaxå’ŒKaTeXï¼Œå®ƒä»¬éƒ½æ”¯æŒLaTexè¯­æ³•ï¼Œå‚è€ƒ: https://theme-next.js.org/docs/third-party-services/math-equations æœ¬æ–‡ä½¿ç”¨çš„æ˜¯Katexï¼ŒåŸå› æ˜¯æˆ‘å·²ç»ä½¿ç”¨äº†hexo-renderer-markdown-itæ¸²æŸ“å™¨ï¼Œå…¶ä¸ mathjax çš„ hexo-renderer-pandocæ¸²æŸ“å™¨ä¸èƒ½å¹¶å­˜ï¼Œæ‰€ä»¥åªèƒ½é€‰Katexäº†ã€‚ å®‰è£… è¯¦ç»†çš„å®‰è£…æ–¹æ³•è¯·å‚è€ƒ:Math Equations å› ä¸ºå·²ç»ä½¿ç”¨äº†hexo-renderer-markdown-itæ¸²æŸ“å™¨ï¼Œæ‰€ä»¥è¿™é‡Œå°±æ²¡æœ‰ä½¿ç”¨hexo-renderer-markdown-it-plusæ¸²æŸ“å™¨ï¼Œå…¶å®ä¸¤è€…ä¹Ÿæ²¡æœ‰å¤ªå¤§çš„åŒºåˆ«ï¼Œåªä¸è¿‡åè€…é»˜è®¤å°±åŠ è½½äº†ä¸€äº›æ’ä»¶ï¼Œè€Œå‰è€…éœ€è¦è‡ªå·±å®‰è£…æ’ä»¶å¹¶é…ç½®æ‰å¯ä»¥ä½¿ç”¨ã€‚ ä½†æ˜¯æµ‹è¯•æ—¶å‘ç°ï¼ŒæŒ‰ç…§å®˜ç½‘çš„é…ç½®hexo-renderer-markdown-it + markdown-it-katex çš„æ–¹å¼å¹¶ä¸èƒ½å¾ˆå¥½çš„è¿›è¡Œå…¬å¼çš„æ¸²æŸ“ï¼Œæ‰€ä»¥è¿™é‡Œå‚è€ƒäº† hexo-renderer-markdown-it-plus æ¸²æŸ“å™¨ï¼Œå°†å…¶æ›´æ¢ä¸º@iktakahiro/markdown-it-katexã€‚ 1npm install @iktakahiro/markdown-it-katex --save åœ¨_config.ymlé…ç½®ä¸Šè¯¥æ’ä»¶ 123456789101112# config of hexo-renderer-markdown-itmarkdown: render: html: true xhtmlOut: false breaks: true linkify: true typographer: true quotes: &#x27;â€œâ€â€˜â€™&#x27; plugins: # katexå…¬å¼ - &quot;@iktakahiro/markdown-it-katex&quot; å®‰è£…åé‡åˆ°çš„é—®é¢˜ 1.å®‰è£…åå‘ç°é€šè¿‡hexoç¼–è¯‘æ—¶ä¼šæŠ¥ç±»ä¼¼å¦‚ä¸‹è­¦å‘Š 1LaTeX-incompatible input and strict mode is set to &#x27;warn&#x27;: Unicode text character &quot;å³&quot; used in math mode [unicodeTextInMathMode] åŸå› æ˜¯@iktakahiro/markdown-it-katexæ’ä»¶é»˜è®¤å¼€å¯çš„æ˜¯ä¸¥æ ¼æ¨¡å¼ï¼Œä¸èƒ½åœ¨$$...$$æˆ–$...$ä¸­åŒ…å«ä¸­æ–‡ï¼Œè™½ç„¶æˆ‘è®¾ç½®çš„æ˜¯math -- every_page: falseï¼Œä½†å…¶åœ¨ç¼–è¯‘é˜¶æ®µä¾æ—§ä¼šæ£€æŸ¥æ‰€æœ‰çš„é¡µé¢ï¼Œä¸è¿‡æŠ¥è¿™ä¸ªè­¦å‘Šå¹¶ä¸ä¼šæœ‰ä»€ä¹ˆå½±å“ï¼Œæ‰€ä»¥å¯ä»¥å¿½ç•¥ã€‚ å¦‚æœä¸å¸Œæœ›çœ‹åˆ°è¿™ä¸ªè­¦å‘Šï¼Œå¯ä»¥ä¸º @iktakahiro/markdown-it-katex æ·»åŠ æ¨¡å¼çš„æ§åˆ¶è¡Œä¸º 1234567891011121314# config of hexo-renderer-markdown-itmarkdown: render: html: true xhtmlOut: false breaks: true linkify: true typographer: true quotes: &#x27;â€œâ€â€˜â€™&#x27; plugins: # katexå…¬å¼ - name: &quot;@iktakahiro/markdown-it-katex&quot; options: strict: error # é»˜è®¤ä¸ºwarnï¼Œè¿™é‡Œè®¾ç½®ä¸ºerrorï¼Œåªæœ‰å½“è§£æå™¨é‡åˆ°ä¸æ”¯æŒçš„å…¬å¼æ—¶æ‰æŠ¥é”™ï¼Œä¹Ÿå¯ä»¥è®¾ç½®ä¸º falseï¼Œè¡¨ç¤ºä¸æ£€æŸ¥ ä¸æ”¯æŒKatexçš„Auto-render Extension é€šè¿‡æŸ¥çœ‹Katexå®˜ç½‘å¯ä»¥çŸ¥é“ï¼Œå¼€å¯Auto-render Extensionåï¼ŒKatexå¯ä»¥æ¸²æŸ“æ›´å¤šçš„å…¬å¼è¯­æ³•ï¼Œä½†è¦æ³¨æ„è¿™å¹¶ä¸æ˜¯LaTexçš„æ ‡å‡†è¯­æ³• ä½†æ˜¯@iktakahiro/markdown-it-katexä¸­å¹¶æ²¡æœ‰ç›¸åº”çš„é…ç½®ï¼Œä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œç®€å•çš„æ–¹æ³•å°±æ˜¯å°†æ‰€éœ€è¦çš„èµ„æºæ·»åŠ åˆ°é¡µé¢ä¸­ï¼Œæ¯”å¦‚æˆ‘åœ¨source\\_data\\post-body-start.njkä¸­æ·»åŠ äº†å¦‚ä¸‹å†…å®¹ 1234567891011121314151617181920212223242526&#123;%- if page.mathjax %&#125;&lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css&quot; integrity=&quot;sha384-nB0miv6/jRmo5UMMR1wu3Gz6NLsoTkbqJghGIsx//Rlm+ZU03BU6SQNC66uf4l5+&quot; crossorigin=&quot;anonymous&quot;&gt;&lt;script defer src=&quot;https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js&quot; integrity=&quot;sha384-7zkQWkzuo3B5mTepMUcHkMB5jZaolc2xDwL6VFqjFALcbeS9Ggm/Yr2r3Dy4lfFg&quot; crossorigin=&quot;anonymous&quot;&gt;&lt;/script&gt;&lt;script defer src=&quot;https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js&quot; integrity=&quot;sha384-43gviWU0YVjaDtb/GhzOouOXtZMP/7XUzwPTstBeZFe/+rCMvRwr4yROQP43s0Xk&quot; crossorigin=&quot;anonymous&quot;&gt;&lt;/script&gt;&lt;script&gt; document.addEventListener(&quot;DOMContentLoaded&quot;, function() &#123; renderMathInElement(document.body, &#123; // customised options // â€¢ auto-render specific keys, e.g.: delimiters: [ &#123;left: &quot;$$&quot;, right: &quot;$$&quot;, display: true&#125;, &#123;left: &quot;\\\\(&quot;, right: &quot;\\\\)&quot;, display: false&#125;, &#123;left: &quot;\\\\begin&#123;equation&#125;&quot;, right: &quot;\\\\end&#123;equation&#125;&quot;, display: true&#125;, &#123;left: &quot;\\\\begin&#123;align&#125;&quot;, right: &quot;\\\\end&#123;align&#125;&quot;, display: true&#125;, &#123;left: &quot;\\\\begin&#123;alignat&#125;&quot;, right: &quot;\\\\end&#123;alignat&#125;&quot;, display: true&#125;, &#123;left: &quot;\\\\begin&#123;gather&#125;&quot;, right: &quot;\\\\end&#123;gather&#125;&quot;, display: true&#125;, &#123;left: &quot;\\\\begin&#123;CD&#125;&quot;, right: &quot;\\\\end&#123;CD&#125;&quot;, display: true&#125;, &#123;left: &quot;\\\\[&quot;, right: &quot;\\\\]&quot;, display: true&#125; ], // â€¢ rendering keys, e.g.: throwOnError : false &#125;); &#125;);&lt;/script&gt;&#123;%- endif %&#125; å°è´´å£« å¯ä»¥é€šè¿‡nextæ¨¡æ¿çš„_config.ymlä¸­çš„custom_file_pathé…ç½®é¡¹æ¥è‡ªå®šä¹‰æ¸²æŸ“é¡µé¢çš„æŸä¸ªéƒ¨åˆ†ï¼Œè¿™æ ·å¯¹åº”çš„æ¯ä¸ªé¡µé¢éƒ½ä¼šåŠ ä¸Šè¯¥æ¨¡æ¿å†…å®¹ 12custom_file_path: postBodyStart: source/_data/post-body-start.njk ä½¿ç”¨hexo-renderer-markdown-it-plusæ¸²æŸ“å™¨æ—¶ï¼Œå¦‚æœä¿®æ”¹äº†é¡µé¢çš„å†…å®¹ï¼Œæ­¤æ—¶åˆ·æ–°é¡µé¢ï¼Œä¼šå‘ç°é¡µé¢ä¸­çš„å…¬å¼ä¸èƒ½è¢«æ¸²æŸ“äº†ï¼Œåªèƒ½é‡æ–°å¯åŠ¨hexoæœåŠ¡ã€‚ ä½†æ˜¯ä½¿ç”¨hexo-renderer-markdown-itæ¸²æŸ“å™¨æ—¶ï¼Œåˆ·æ–°é¡µé¢åå…¬å¼å°±å¯ä»¥è¢«æ¸²æŸ“äº†ã€‚ ä½¿ç”¨ æ¯ä¸ªé¡µé¢çš„front-matterä¸­è¦æ·»åŠ mathjax: trueï¼Œè¿™æ ·åœ¨é¡µé¢ä¸­å°±å¯ä»¥ä½¿ç”¨å…¬å¼äº†ã€‚ Katexå…¬å¼çš„æ¸²æŸ“æ–¹å¼æ”¯æŒ$...$å’Œ$$...$$ä¸¤ç§æ–¹å¼ $...$ä¸ºè¡Œçº§å…¬å¼ 1$sin(\\omega t)=\\frac&#123;1&#125;&#123;2j&#125;(e^&#123;j\\omega t&#125;-e^&#123;-j\\omega t&#125;)$ sin(Ï‰t)=12j(ejÏ‰tâˆ’eâˆ’jÏ‰t)sin(\\omega t)=\\frac{1}{2j}(e^{j\\omega t}-e^{-j\\omega t})sin(Ï‰t)=2j1â€‹(ejÏ‰tâˆ’eâˆ’jÏ‰t) $$...$$ä¸ºå—çº§å…¬å¼ï¼Œç‹¬å ä¸€è¡Œä¸”å±…ä¸­å±•ç¤º 123$$sin(\\omega t)=\\frac&#123;1&#125;&#123;2j&#125;(e^&#123;j\\omega t&#125;-e^&#123;-j\\omega t&#125;)$$ sin(Ï‰t)=12j(ejÏ‰tâˆ’eâˆ’jÏ‰t)sin(\\omega t)=\\frac{1}{2j}(e^{j\\omega t}-e^{-j\\omega t}) sin(Ï‰t)=2j1â€‹(ejÏ‰tâˆ’eâˆ’jÏ‰t) $$...$$å’Œ$...$ä¸­ä¸èƒ½å‡ºç°Unicodeå­—ç¬¦ï¼Œå¦åˆ™ä¼šæŠ¥é”™ï¼Œå³ä¸æ”¯æŒä¸­æ–‡ï¼Œå¦‚æœéœ€è¦æ˜¾ç¤ºä¸­æ–‡ï¼Œåˆ™éœ€è¦ä½¿ç”¨\\text&#123;ä¸­æ–‡&#125; å—çº§å…¬å¼ï¼Œåœ¨å¼€å¤´çš„$$ä¹‹å‰å’Œç»“å°¾çš„$$ä¹‹åï¼Œä¸å¾—æœ‰ä»»ä½•å­—ç¬¦ï¼ˆç©ºæ ¼é™¤å¤–ï¼‰ è¡Œçº§å…¬å¼ï¼Œåœ¨å¼€å¤´çš„$ä¹‹åå’Œç»“å°¾çš„$ä¹‹å‰ï¼Œä¸å¾—æœ‰ç©ºæ ¼ ç¤ºä¾‹ ä½¿ç”¨æ–¹å¼å¯ä»¥å‚è€ƒ KaTeXå…¬å¼ç¬¦å· ä»¥åŠ ç»´åŸºç™¾ç§‘ï¼šLaTeXå…¬å¼æ‰‹å†Œ ä¸è¿‡è®°ä½è¿™äº›å…¬å¼ç¬¦å·è¿˜æ˜¯æ¯”è¾ƒå›°éš¾çš„ï¼Œè¿™é‡Œæ¨èä¸¤ä¸ªå·¥å…· MyScript: æ‰‹å†™è½¬LaTeXå…¬å¼ï¼Œç›´æ¥å°†ä½ éœ€è¦çš„æ•°å­¦å…¬å¼ç”»å‡ºæ¥ï¼Œå®ƒä¼šè‡ªåŠ¨å°†å…¶è½¬æ¢ä¸ºLaTeXå…¬å¼ï¼Œç„¶åå¤åˆ¶å³å¯ LaTeXå…¬å¼ç¼–è¾‘å™¨: æä¾›å…¬å¼æ¨¡æ¿ã€å›¾ç‰‡è¯†åˆ«(æœ‰æ¬¡æ•°é™åˆ¶)ç­‰åŠŸèƒ½ï¼Œå¹¶ä¸”æ”¯æŒè¾“å‡ºå„ç§æ ¼å¼ã€‚ Simpletex: æ”¯æŒLaTexå…¬å¼å›¾ç‰‡è¯†åˆ«å’Œæ‰‹å†™è½¬å…¬å¼ï¼Œä¸”æ— æ¬¡æ•°é™åˆ¶ï¼Œä½†æ˜¯éœ€è¦æ³¨å†Œè´¦å·ã€‚åŒæ—¶ä¹Ÿæä¾›äº†å®¢æˆ·ç«¯ç‰ˆæœ¬ã€‚ è¿™é‡Œéšä¾¿ç»™å‡ ä¸ªç¤ºä¾‹ï¼Œä»¥ä¸‹æ˜¯LaTeXçš„æ ‡å‡†è¯­æ³• 1234$$\\left(\\beta m c^2 + c \\left(\\sum_&#123;n=1&#125;^3\\alpha_n p_n\\right)\\right) \\psi(x,t)= i\\hbar \\frac&#123;\\partial \\psi(x,t)&#125;&#123;\\partial t&#125;$$ (Î²mc2+c(âˆ‘n=13Î±npn))Ïˆ(x,t)=iâ„âˆ‚Ïˆ(x,t)âˆ‚t\\left(\\beta m c^2 + c \\left(\\sum_{n=1}^3\\alpha_n p_n\\right)\\right) \\psi(x,t) = i\\hbar \\frac{\\partial \\psi(x,t)}{\\partial t} (Î²mc2+c(n=1âˆ‘3â€‹Î±nâ€‹pnâ€‹))Ïˆ(x,t)=iâ„âˆ‚tâˆ‚Ïˆ(x,t)â€‹ 1Aha! $E = mc^&#123;2&#125;$. Aha! E=mc2E = mc^{2}E=mc2. 123$$\\left(\\LARGE&#123;AB&#125;\\right)$$ (AB)\\left(\\LARGE{AB}\\right) (AB) 123456$$\\begin&#123;matrix&#125; a &amp; b \\\\ c &amp; d\\end&#123;matrix&#125;$$ abcd\\begin{matrix} a &amp; b \\\\ c &amp; d \\end{matrix} acâ€‹bdâ€‹ 123456789$$\\def\\arraystretch&#123;1.5&#125; \\begin&#123;array&#125;&#123;c:c:c&#125; a &amp; b &amp; c \\\\ \\hline d &amp; e &amp; f \\\\ \\hdashline g &amp; h &amp; i\\end&#123;array&#125;$$ abcdefghi\\def\\arraystretch{1.5} \\begin{array}{c:c:c} a &amp; b &amp; c \\\\ \\hline d &amp; e &amp; f \\\\ \\hdashline g &amp; h &amp; i \\end{array} adgâ€‹behâ€‹cfiâ€‹â€‹ 1$\\tilde&#123;a&#125;$ &amp;nbsp;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; $\\underrightarrow&#123;AB&#125;$ a~\\tilde{a}a~ ABâ†’\\underrightarrow{AB}ABâ€‹ 1234567891011$$\\tilde&#123;a&#125; \\underrightarrow&#123;AB&#125;\\begin&#123;array&#125;&#123;l&#125; a\\mathop&#123;x&#125;\\nolimits^&#123;2&#125;+bx+c=0 \\\\ \\Delta =\\mathop&#123;b&#125;\\nolimits^&#123;2&#125;-4ac \\\\ \\left\\&#123;\\begin&#123;matrix&#125; \\Delta \\gt 0\\text&#123;æ–¹ç¨‹æœ‰ä¸¤ä¸ªä¸ç›¸ç­‰çš„å®æ ¹&#125; \\\\ \\Delta = 0\\text&#123;æ–¹ç¨‹æœ‰ä¸¤ä¸ªç›¸ç­‰çš„å®æ ¹&#125; \\\\ \\Delta \\lt 0\\text&#123;æ–¹ç¨‹æ— å®æ ¹&#125;\\end&#123;matrix&#125;\\right.\\end&#123;array&#125;$$ a~ABâ†’ax2+bx+c=0Î”=b2âˆ’4ac{Î”&gt;0 æ–¹ç¨‹æœ‰ä¸¤ä¸ªä¸ç›¸ç­‰çš„å®æ ¹Î”=0 æ–¹ç¨‹æœ‰ä¸¤ä¸ªç›¸ç­‰çš„å®æ ¹Î”&lt;0 æ–¹ç¨‹æ— å®æ ¹\\tilde{a} \\underrightarrow{AB}\\begin{array}{l} a\\mathop{x}\\nolimits^{2}+bx+c=0 \\\\ \\Delta =\\mathop{b}\\nolimits^{2}-4ac \\\\ \\left\\{\\begin{matrix} \\Delta \\gt 0\\text{ æ–¹ç¨‹æœ‰ä¸¤ä¸ªä¸ç›¸ç­‰çš„å®æ ¹} \\\\ \\Delta = 0\\text{ æ–¹ç¨‹æœ‰ä¸¤ä¸ªç›¸ç­‰çš„å®æ ¹} \\\\ \\Delta \\lt 0\\text{ æ–¹ç¨‹æ— å®æ ¹} \\end{matrix}\\right. \\end{array} a~ABâ€‹ax2+bx+c=0Î”=b2âˆ’4acâ©âªâ¨âªâ§â€‹Î”&gt;0 æ–¹ç¨‹æœ‰ä¸¤ä¸ªä¸ç›¸ç­‰çš„å®æ ¹Î”=0 æ–¹ç¨‹æœ‰ä¸¤ä¸ªç›¸ç­‰çš„å®æ ¹Î”&lt;0 æ–¹ç¨‹æ— å®æ ¹â€‹â€‹ ä»¥ä¸‹ä¸ºå¼€å¯Auto-render Extensionåæ”¯æŒçš„å…¬å¼è¯­æ³•ï¼Œå¹¶ä¸æ˜¯LaTexçš„æ ‡å‡†è¯­æ³• 1234567$$\\begin&#123;equation&#125;\\begin&#123;split&#125; a &amp;=b+c\\\\ &amp;=e+f\\end&#123;split&#125;\\end&#123;equation&#125;$$ \\begin{equation} \\begin{split} a &amp;=b+c\\\\ &amp;=e+f \\end{split} \\end{equation} 123456$$\\begin&#123;align&#125; a&amp;=b+c \\\\ d+e&amp;=f\\end&#123;align&#125;$$ \\begin{align} a&amp;=b+c \\\\ d+e&amp;=f \\end{align} 1234567$$\\begin&#123;CD&#125; A @&gt;a&gt;&gt; B \\\\@VbVV @AAcA \\\\ C @= D\\end&#123;CD&#125;$$ \\begin{CD} A @&gt;a&gt;&gt; B \\\\ @VbVV @AAcA \\\\ C @= D \\end{CD}","summary":"æ‘˜è¦ Hexoæ˜¯åŸºäºmarkdownçš„ï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨LaTexè¯­æ³•æ¥ç¼–å†™æ•°å­¦å…¬å¼ï¼Œåªä¸è¿‡éœ€è¦å®‰è£…ç›¸åº”çš„å…¬å¼æ¸²æŸ“æ’ä»¶æ¥å®ç°ã€‚ Nextä¸»é¢˜ æ”¯æŒçš„å…¬å¼æ’ä»¶ä¸ºMathJaxå’ŒKaTeXï¼Œå®ƒä»¬éƒ½æ”¯æŒLaTexè¯­æ³•ï¼Œå‚è€ƒ: https://theme-next.js.org/docs/third-party-services/math-equations æœ¬æ–‡ä½¿ç”¨çš„æ˜¯Katexï¼ŒåŸå› æ˜¯æˆ‘å·²ç»ä½¿ç”¨äº†hexo-renderer-markdown-itæ¸²æŸ“å™¨ï¼Œå…¶ä¸ mathjax çš„ hexo-renderer-pandocæ¸²æŸ“å™¨ä¸èƒ½å¹¶å­˜ï¼Œæ‰€ä»¥åªèƒ½é€‰Katexäº†ã€‚","date_published":"2024-11-12T13:55:05.000Z","tags":["Hexo","Hexo"]},{"id":"https://blog.hanqunfeng.com/2024/09/05/linux-zabbix_vfs_fs_inode/","url":"https://blog.hanqunfeng.com/2024/09/05/linux-zabbix_vfs_fs_inode/","title":"zabbixç›‘æ§å‘Šè­¦--vfs.fs.inodeä¸è¶³5%çš„è§£å†³è¿‡ç¨‹","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è§£å†³Linuxç´¢å¼•èŠ‚ç‚¹(inode)ç”¨æ»¡å¯¼è‡´æ•…éšœçš„æ–¹æ³•</p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"zabbixå‘Šè­¦\">zabbixå‘Šè­¦</h2>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vfs.fs.inode[/,pfree]):5 %</span><br></pre></td></tr></table></figure>\n<h2 id=\"è§£å†³è¿‡ç¨‹\">è§£å†³è¿‡ç¨‹</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç™»å½•linuxç³»ç»ŸåæŸ¥çœ‹inodeä½¿ç”¨æƒ…å†µå’Œç£ç›˜ä½¿ç”¨æƒ…å†µ</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># inode ä¸è¶³äº†</span></span><br><span class=\"line\"><span class=\"built_in\">df</span> -hi</span><br><span class=\"line\">æ–‡ä»¶ç³»ç»Ÿ\t      Inode  å·²ç”¨(I)  å¯ç”¨(I) å·²ç”¨(I)%% æŒ‚è½½ç‚¹</span><br><span class=\"line\">/dev/xvda1              1.9M    1.8M     96K   96% /</span><br><span class=\"line\">tmpfs                   251K       1    251K    1% /dev/shm</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># disk å……è¶³</span></span><br><span class=\"line\"><span class=\"built_in\">df</span> -hT</span><br><span class=\"line\">æ–‡ä»¶ç³»ç»Ÿ    ç±»å‹      å®¹é‡  å·²ç”¨  å¯ç”¨ å·²ç”¨%% æŒ‚è½½ç‚¹</span><br><span class=\"line\">/dev/xvda1    ext4     30G   18G   12G  61% /</span><br><span class=\"line\">tmpfs        tmpfs   1003M     0 1003M   0% /dev/shm</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ ¹æ®ä¸Šé¢çš„æŸ¥è¯¢ç»“æœåˆæ­¥åˆ¤æ–­æ˜¯ç³»ç»Ÿäº§ç”Ÿäº†å¤§é‡çš„ä¸´æ—¶æ–‡ä»¶å¯¼è‡´inodeç”¨å°½äº†</p>\n</li>\n<li class=\"lvl-2\">\n<p>æ’æŸ¥åˆ°åº•å“ªä¸ªç›®å½•ä¸‹çš„æ–‡ä»¶æ•°è¿‡å¤š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># é€šè¿‡ä¸‹é¢çš„å‘½ä»¤ç»Ÿè®¡æ–‡ä»¶æ•°é‡å‰ååï¼Œè¿™é‡Œå‘ç°æ˜¯/varç›®å½•ä¸­æ–‡ä»¶å¼‚å¸¸çš„å¤š</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> /*; <span class=\"keyword\">do</span> <span class=\"built_in\">echo</span> <span class=\"string\">&quot;<span class=\"subst\">$(find $i |wc -l)</span>:<span class=\"variable\">$i</span>&quot;</span>; <span class=\"keyword\">done</span> | <span class=\"built_in\">sort</span> -nr | <span class=\"built_in\">head</span> -n 10</span><br><span class=\"line\">1815728:/var</span><br><span class=\"line\">52498:/usr</span><br><span class=\"line\">18804:/proc</span><br><span class=\"line\">7333:/sys</span><br><span class=\"line\">1834:/lib</span><br><span class=\"line\">1447:/opt</span><br><span class=\"line\">1047:/etc</span><br><span class=\"line\">457:/dev</span><br><span class=\"line\">411:/lib64</span><br><span class=\"line\">245:/sbin</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ¥ç€æŸ¥çœ‹/varä¸­çš„æ–‡ä»¶æ•°é‡</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> /var/*; <span class=\"keyword\">do</span> <span class=\"built_in\">echo</span> <span class=\"string\">&quot;<span class=\"subst\">$(find $i |wc -l)</span>:<span class=\"variable\">$i</span>&quot;</span>; <span class=\"keyword\">done</span> | <span class=\"built_in\">sort</span> -nr | <span class=\"built_in\">head</span> -n 10</span><br><span class=\"line\">1813442:/var/spool</span><br><span class=\"line\">2033:/var/lib</span><br><span class=\"line\">85:/var/cache</span><br><span class=\"line\">82:/var/log</span><br><span class=\"line\">39:/var/run</span><br><span class=\"line\">24:/var/lock</span><br><span class=\"line\">7:/var/db</span><br><span class=\"line\">3:/var/yp</span><br><span class=\"line\">2:/var/empty</span><br><span class=\"line\">2:/var/account</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ¥ç€æŸ¥çœ‹/var/spoolä¸­çš„æ–‡ä»¶æ•°é‡ï¼Œè¿™é‡ŒåŸºæœ¬å®šä½åˆ°æ˜¯/var/spool/clientmqueueç›®å½•</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> /var/spool/*; <span class=\"keyword\">do</span> <span class=\"built_in\">echo</span> <span class=\"string\">&quot;<span class=\"subst\">$(find $i |wc -l)</span>:<span class=\"variable\">$i</span>&quot;</span>; <span class=\"keyword\">done</span> | <span class=\"built_in\">sort</span> -nr | <span class=\"built_in\">head</span> -n 10</span><br><span class=\"line\">1812413:/var/spool/clientmqueue</span><br><span class=\"line\">7:/var/spool/mail</span><br><span class=\"line\">4:/var/spool/anacron</span><br><span class=\"line\">3:/var/spool/at</span><br><span class=\"line\">2:/var/spool/cron</span><br><span class=\"line\">1:/var/spool/mqueue</span><br><span class=\"line\">1:/var/spool/lpd</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç™¾åº¦ä¸€ä¸‹<code>/var/spool/clientmqueue</code>ç›®å½•çš„ä½œç”¨</p>\n</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">â€ŒLinuxæ–‡ä»¶ç›®å½• /var/spool/clientmqueue/ ä¸‹çš„æ–‡ä»¶ä¸»è¦æ˜¯ç”±cronä»»åŠ¡äº§ç”Ÿçš„è¾“å‡ºæ–‡ä»¶ã€‚â€Œ å½“cronä»»åŠ¡ä¸­æœ‰è¾“å‡ºå†…å®¹æ—¶ï¼Œå¦‚æœæœåŠ¡å™¨ä¸Šæ²¡æœ‰é…ç½®sendmailæœåŠ¡ï¼Œè¿™äº›è¾“å‡ºå†…å®¹å°±ä¼šè¢«ä¿å­˜åˆ° /var/spool/clientmqueue/ ç›®å½•å†…ã€‚è¿™æ˜¯å› ä¸ºcronä»»åŠ¡ä¸­çš„å‘½ä»¤å¦‚æœæœ‰è¾“å‡ºï¼ˆæ¯”å¦‚é”™è¯¯ä¿¡æ¯æˆ–è€…æ­£å¸¸çš„è¾“å‡ºä¿¡æ¯ï¼‰ï¼Œé»˜è®¤ä¼šé€šè¿‡sendmailå‘é€ï¼Œä½†å¦‚æœæœåŠ¡å™¨ä¸Šæ²¡æœ‰é…ç½®sendmailæœåŠ¡ï¼Œè¿™äº›è¾“å‡ºå†…å®¹å°±ä¼šè¢«ä¿å­˜åˆ° /var/spool/clientmqueue/ ç›®å½•ä¸­ã€‚å› æ­¤ï¼Œè¿™ä¸ªç›®å½•ä¸‹ä¸»è¦åŒ…å«çš„æ˜¯ç”±cronä»»åŠ¡äº§ç”Ÿçš„è¾“å‡ºæ–‡ä»¶ï¼Œè¿™äº›æ–‡ä»¶è®°å½•äº†cronä»»åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­çš„è¾“å‡ºä¿¡æ¯ã€‚</span><br><span class=\"line\"></span><br><span class=\"line\">å¦‚æœéœ€è¦å¤„ç†è¿™äº›æ–‡ä»¶ï¼Œå¯ä»¥é€šè¿‡ä¿®æ”¹crontabé…ç½®æ¥å®ç°ã€‚å…·ä½“æ¥è¯´ï¼Œå¯ä»¥åœ¨æ¯ä¸ªcronä»»åŠ¡å‘½ä»¤çš„æœ«å°¾æ·»åŠ é‡å®šå‘æ“ä½œï¼Œå°†è¾“å‡ºå†…å®¹æŠ›å¼ƒï¼Œä¾‹å¦‚ä½¿ç”¨å‘½ä»¤ &gt;/dev/null 2&gt;&amp;1ã€‚è¿™æ ·ï¼Œæ— è®ºæ ‡å‡†è¾“å‡ºè¿˜æ˜¯é”™è¯¯è¾“å‡ºéƒ½ä¼šè¢«é‡å®šå‘åˆ° /dev/nullï¼Œå³è¢«æŠ›å¼ƒï¼Œä»è€Œé¿å…åœ¨ /var/spool/clientmqueue/ ç›®å½•ä¸‹äº§ç”Ÿä¸å¿…è¦çš„æ–‡ä»¶ã€‚</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¸Šé¢çš„è§£é‡Šè¯´æ˜<code>/var/spool/clientmqueue</code>ç›®å½•ä¸‹çš„æ–‡ä»¶å¯ä»¥è¢«åˆ é™¤ï¼Œæ‰€ä»¥ç›´æ¥åˆ äº†å°±å¯ä»¥è§£å†³è¯¥é—®é¢˜äº†</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æ–‡ä»¶æ•°é‡è¿‡å¤šï¼Œä¸èƒ½è¿™ä¹ˆåˆ é™¤</span></span><br><span class=\"line\"><span class=\"comment\"># rm -rf /var/spool/clientmqueue/*</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ­£ç¡®æ–¹æ³•</span></span><br><span class=\"line\">find /var/spool/clientmqueue -name <span class=\"string\">&quot;*&quot;</span> -<span class=\"built_in\">type</span> f | xargs <span class=\"built_in\">rm</span> -rf</span><br></pre></td></tr></table></figure>\n<h2 id=\"è¯¦è§£inode\">è¯¦è§£inode</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>inodeæ˜¯æ–‡ä»¶ç³»ç»Ÿå†…ä¸€ä¸ªé‡è¦çš„æ•°æ®ç»“æ„ï¼Œå®ƒç”¨æ¥æè¿°ä¸€ä¸ªæ–‡ä»¶ï¼ŒåŒ…æ‹¬æ–‡ä»¶åã€æ–‡ä»¶ç±»å‹ã€æƒé™ã€æ‰€æœ‰è€…ã€åˆ›å»ºæ—¶é—´ã€ä¿®æ”¹æ—¶é—´ç­‰ã€‚åœ¨Linuxç³»ç»Ÿä¸­ï¼Œæ¯ä¸ªæ–‡ä»¶éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„inodeå·ï¼Œè¿™ä¸ªinodeå·æ˜¯åˆ†é…ç»™è¯¥æ–‡ä»¶çš„ï¼Œå¹¶ä¸”ä¸èƒ½è¢«æ”¹å˜ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹å½“å‰ç›®å½•çš„inodeå·</span></span><br><span class=\"line\"><span class=\"built_in\">ls</span> -li</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ“ä½œç³»ç»Ÿæ‰“å¼€æ–‡ä»¶æ—¶ä¼šæŒ‰å¦‚ä¸‹æ­¥éª¤æ‰§è¡Œï¼š</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-6\">æŸ¥æ‰¾æ–‡ä»¶åç§°å¯¹åº”çš„inodeå·</li>\n<li class=\"lvl-6\">æ ¹æ®inodeå·è·å–inodeä¿¡æ¯</li>\n<li class=\"lvl-6\">æ ¹æ®inodeä¿¡æ¯æ‰¾åˆ°æ–‡ä»¶å¯¹åº”çš„æ•°æ®å—ï¼Œè¯»å‡ºæ•°æ®</li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<p>inodeçš„å¤§å°æ˜¯æœ‰é™åˆ¶çš„ï¼Œé€šå¸¸å–å†³äºæ–‡ä»¶ç³»ç»Ÿå’Œæ“ä½œç³»ç»Ÿã€‚åœ¨å¤§å¤šæ•°Linuxæ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œinodeå¤§å°é€šå¸¸æ˜¯128å­—èŠ‚æˆ–256å­—èŠ‚ã€‚è¿™æ˜¯ç”±æ–‡ä»¶ç³»ç»Ÿåœ¨æ ¼å¼åŒ–æ—¶å†³å®šçš„ï¼Œå¹¶ä¸”æ ¼å¼åŒ–åä¸èƒ½æ›´æ”¹ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹inodeå¤§å°</span></span><br><span class=\"line\">dumpe2fs /dev/xvda1 | grep <span class=\"string\">&quot;Inode size&quot;</span></span><br><span class=\"line\">dumpe2fs 1.43.5 (04-Aug-2017)</span><br><span class=\"line\">Inode size:\t          256</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æŸ¥çœ‹æ–‡ä»¶ç³»ç»Ÿçš„inodeæ€»æ•°</p>\n</li>\n</ul>\n<blockquote>\n<p>ä¸€ä¸ªinodeåªå¯¹åº”ä¸€ä¸ªå®é™…æ–‡ä»¶ï¼Œæ‰€ä»¥inodesæœ€å¤§æ•°é‡å°±æ˜¯æ–‡ä»¶çš„æœ€å¤§æ•°é‡ã€‚</p>\n</blockquote>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹æ‰€æœ‰æŒ‚è½½ç£ç›˜</span></span><br><span class=\"line\"><span class=\"built_in\">df</span> -i</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹æŒ‡å®šç£ç›˜</span></span><br><span class=\"line\"><span class=\"built_in\">df</span> -i /dev/xvda1</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¸åŒçš„æ–‡ä»¶ç³»ç»Ÿé»˜è®¤çš„inodeæ•°é‡ä¸åŒï¼Œä»¥<code>1G</code>ç£ç›˜ç©ºé—´ä¸ºä¾‹ï¼Œ<code>ext4</code>æ–‡ä»¶ç³»ç»Ÿé»˜è®¤ä¸º<code>65536</code>ï¼Œ<code>xfs</code>æ–‡ä»¶ç³»ç»Ÿé»˜è®¤ä¸º<code>52ä¸‡</code>(æ¯2kè®¾ç½®ä¸€ä¸ªinode)ï¼Œå¹¶ä¸”<code>xfs</code>ä¼šåŠ¨æ€æ‰©å®¹inodeæ•°é‡ã€‚</p>\n</li>\n</ul>\n","content_text":"æ‘˜è¦ è§£å†³Linuxç´¢å¼•èŠ‚ç‚¹(inode)ç”¨æ»¡å¯¼è‡´æ•…éšœçš„æ–¹æ³• zabbixå‘Šè­¦ 1vfs.fs.inode[/,pfree]):5 % è§£å†³è¿‡ç¨‹ ç™»å½•linuxç³»ç»ŸåæŸ¥çœ‹inodeä½¿ç”¨æƒ…å†µå’Œç£ç›˜ä½¿ç”¨æƒ…å†µ 1234567891011# inode ä¸è¶³äº†df -hiæ–‡ä»¶ç³»ç»Ÿ Inode å·²ç”¨(I) å¯ç”¨(I) å·²ç”¨(I)%% æŒ‚è½½ç‚¹/dev/xvda1 1.9M 1.8M 96K 96% /tmpfs 251K 1 251K 1% /dev/shm# disk å……è¶³df -hTæ–‡ä»¶ç³»ç»Ÿ ç±»å‹ å®¹é‡ å·²ç”¨ å¯ç”¨ å·²ç”¨%% æŒ‚è½½ç‚¹/dev/xvda1 ext4 30G 18G 12G 61% /tmpfs tmpfs 1003M 0 1003M 0% /dev/shm æ ¹æ®ä¸Šé¢çš„æŸ¥è¯¢ç»“æœåˆæ­¥åˆ¤æ–­æ˜¯ç³»ç»Ÿäº§ç”Ÿäº†å¤§é‡çš„ä¸´æ—¶æ–‡ä»¶å¯¼è‡´inodeç”¨å°½äº† æ’æŸ¥åˆ°åº•å“ªä¸ªç›®å½•ä¸‹çš„æ–‡ä»¶æ•°è¿‡å¤š 1234567891011121314151617181920212223242526272829303132333435# é€šè¿‡ä¸‹é¢çš„å‘½ä»¤ç»Ÿè®¡æ–‡ä»¶æ•°é‡å‰ååï¼Œè¿™é‡Œå‘ç°æ˜¯/varç›®å½•ä¸­æ–‡ä»¶å¼‚å¸¸çš„å¤šfor i in /*; do echo &quot;$(find $i |wc -l):$i&quot;; done | sort -nr | head -n 101815728:/var52498:/usr18804:/proc7333:/sys1834:/lib1447:/opt1047:/etc457:/dev411:/lib64245:/sbin# æ¥ç€æŸ¥çœ‹/varä¸­çš„æ–‡ä»¶æ•°é‡for i in /var/*; do echo &quot;$(find $i |wc -l):$i&quot;; done | sort -nr | head -n 101813442:/var/spool2033:/var/lib85:/var/cache82:/var/log39:/var/run24:/var/lock7:/var/db3:/var/yp2:/var/empty2:/var/account# æ¥ç€æŸ¥çœ‹/var/spoolä¸­çš„æ–‡ä»¶æ•°é‡ï¼Œè¿™é‡ŒåŸºæœ¬å®šä½åˆ°æ˜¯/var/spool/clientmqueueç›®å½•for i in /var/spool/*; do echo &quot;$(find $i |wc -l):$i&quot;; done | sort -nr | head -n 101812413:/var/spool/clientmqueue7:/var/spool/mail4:/var/spool/anacron3:/var/spool/at2:/var/spool/cron1:/var/spool/mqueue1:/var/spool/lpd ç™¾åº¦ä¸€ä¸‹/var/spool/clientmqueueç›®å½•çš„ä½œç”¨ 123â€ŒLinuxæ–‡ä»¶ç›®å½• /var/spool/clientmqueue/ ä¸‹çš„æ–‡ä»¶ä¸»è¦æ˜¯ç”±cronä»»åŠ¡äº§ç”Ÿçš„è¾“å‡ºæ–‡ä»¶ã€‚â€Œ å½“cronä»»åŠ¡ä¸­æœ‰è¾“å‡ºå†…å®¹æ—¶ï¼Œå¦‚æœæœåŠ¡å™¨ä¸Šæ²¡æœ‰é…ç½®sendmailæœåŠ¡ï¼Œè¿™äº›è¾“å‡ºå†…å®¹å°±ä¼šè¢«ä¿å­˜åˆ° /var/spool/clientmqueue/ ç›®å½•å†…ã€‚è¿™æ˜¯å› ä¸ºcronä»»åŠ¡ä¸­çš„å‘½ä»¤å¦‚æœæœ‰è¾“å‡ºï¼ˆæ¯”å¦‚é”™è¯¯ä¿¡æ¯æˆ–è€…æ­£å¸¸çš„è¾“å‡ºä¿¡æ¯ï¼‰ï¼Œé»˜è®¤ä¼šé€šè¿‡sendmailå‘é€ï¼Œä½†å¦‚æœæœåŠ¡å™¨ä¸Šæ²¡æœ‰é…ç½®sendmailæœåŠ¡ï¼Œè¿™äº›è¾“å‡ºå†…å®¹å°±ä¼šè¢«ä¿å­˜åˆ° /var/spool/clientmqueue/ ç›®å½•ä¸­ã€‚å› æ­¤ï¼Œè¿™ä¸ªç›®å½•ä¸‹ä¸»è¦åŒ…å«çš„æ˜¯ç”±cronä»»åŠ¡äº§ç”Ÿçš„è¾“å‡ºæ–‡ä»¶ï¼Œè¿™äº›æ–‡ä»¶è®°å½•äº†cronä»»åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­çš„è¾“å‡ºä¿¡æ¯ã€‚å¦‚æœéœ€è¦å¤„ç†è¿™äº›æ–‡ä»¶ï¼Œå¯ä»¥é€šè¿‡ä¿®æ”¹crontabé…ç½®æ¥å®ç°ã€‚å…·ä½“æ¥è¯´ï¼Œå¯ä»¥åœ¨æ¯ä¸ªcronä»»åŠ¡å‘½ä»¤çš„æœ«å°¾æ·»åŠ é‡å®šå‘æ“ä½œï¼Œå°†è¾“å‡ºå†…å®¹æŠ›å¼ƒï¼Œä¾‹å¦‚ä½¿ç”¨å‘½ä»¤ &gt;/dev/null 2&gt;&amp;1ã€‚è¿™æ ·ï¼Œæ— è®ºæ ‡å‡†è¾“å‡ºè¿˜æ˜¯é”™è¯¯è¾“å‡ºéƒ½ä¼šè¢«é‡å®šå‘åˆ° /dev/nullï¼Œå³è¢«æŠ›å¼ƒï¼Œä»è€Œé¿å…åœ¨ /var/spool/clientmqueue/ ç›®å½•ä¸‹äº§ç”Ÿä¸å¿…è¦çš„æ–‡ä»¶ã€‚ ä¸Šé¢çš„è§£é‡Šè¯´æ˜/var/spool/clientmqueueç›®å½•ä¸‹çš„æ–‡ä»¶å¯ä»¥è¢«åˆ é™¤ï¼Œæ‰€ä»¥ç›´æ¥åˆ äº†å°±å¯ä»¥è§£å†³è¯¥é—®é¢˜äº† 12345# æ–‡ä»¶æ•°é‡è¿‡å¤šï¼Œä¸èƒ½è¿™ä¹ˆåˆ é™¤# rm -rf /var/spool/clientmqueue/*# æ­£ç¡®æ–¹æ³•find /var/spool/clientmqueue -name &quot;*&quot; -type f | xargs rm -rf è¯¦è§£inode inodeæ˜¯æ–‡ä»¶ç³»ç»Ÿå†…ä¸€ä¸ªé‡è¦çš„æ•°æ®ç»“æ„ï¼Œå®ƒç”¨æ¥æè¿°ä¸€ä¸ªæ–‡ä»¶ï¼ŒåŒ…æ‹¬æ–‡ä»¶åã€æ–‡ä»¶ç±»å‹ã€æƒé™ã€æ‰€æœ‰è€…ã€åˆ›å»ºæ—¶é—´ã€ä¿®æ”¹æ—¶é—´ç­‰ã€‚åœ¨Linuxç³»ç»Ÿä¸­ï¼Œæ¯ä¸ªæ–‡ä»¶éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„inodeå·ï¼Œè¿™ä¸ªinodeå·æ˜¯åˆ†é…ç»™è¯¥æ–‡ä»¶çš„ï¼Œå¹¶ä¸”ä¸èƒ½è¢«æ”¹å˜ã€‚ 12# æŸ¥çœ‹å½“å‰ç›®å½•çš„inodeå·ls -li æ“ä½œç³»ç»Ÿæ‰“å¼€æ–‡ä»¶æ—¶ä¼šæŒ‰å¦‚ä¸‹æ­¥éª¤æ‰§è¡Œï¼š æŸ¥æ‰¾æ–‡ä»¶åç§°å¯¹åº”çš„inodeå· æ ¹æ®inodeå·è·å–inodeä¿¡æ¯ æ ¹æ®inodeä¿¡æ¯æ‰¾åˆ°æ–‡ä»¶å¯¹åº”çš„æ•°æ®å—ï¼Œè¯»å‡ºæ•°æ® inodeçš„å¤§å°æ˜¯æœ‰é™åˆ¶çš„ï¼Œé€šå¸¸å–å†³äºæ–‡ä»¶ç³»ç»Ÿå’Œæ“ä½œç³»ç»Ÿã€‚åœ¨å¤§å¤šæ•°Linuxæ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œinodeå¤§å°é€šå¸¸æ˜¯128å­—èŠ‚æˆ–256å­—èŠ‚ã€‚è¿™æ˜¯ç”±æ–‡ä»¶ç³»ç»Ÿåœ¨æ ¼å¼åŒ–æ—¶å†³å®šçš„ï¼Œå¹¶ä¸”æ ¼å¼åŒ–åä¸èƒ½æ›´æ”¹ã€‚ 1234# æŸ¥çœ‹inodeå¤§å°dumpe2fs /dev/xvda1 | grep &quot;Inode size&quot;dumpe2fs 1.43.5 (04-Aug-2017)Inode size: 256 æŸ¥çœ‹æ–‡ä»¶ç³»ç»Ÿçš„inodeæ€»æ•° ä¸€ä¸ªinodeåªå¯¹åº”ä¸€ä¸ªå®é™…æ–‡ä»¶ï¼Œæ‰€ä»¥inodesæœ€å¤§æ•°é‡å°±æ˜¯æ–‡ä»¶çš„æœ€å¤§æ•°é‡ã€‚ 12345# æŸ¥çœ‹æ‰€æœ‰æŒ‚è½½ç£ç›˜df -i# æŸ¥çœ‹æŒ‡å®šç£ç›˜df -i /dev/xvda1 ä¸åŒçš„æ–‡ä»¶ç³»ç»Ÿé»˜è®¤çš„inodeæ•°é‡ä¸åŒï¼Œä»¥1Gç£ç›˜ç©ºé—´ä¸ºä¾‹ï¼Œext4æ–‡ä»¶ç³»ç»Ÿé»˜è®¤ä¸º65536ï¼Œxfsæ–‡ä»¶ç³»ç»Ÿé»˜è®¤ä¸º52ä¸‡(æ¯2kè®¾ç½®ä¸€ä¸ªinode)ï¼Œå¹¶ä¸”xfsä¼šåŠ¨æ€æ‰©å®¹inodeæ•°é‡ã€‚","summary":"æ‘˜è¦ è§£å†³Linuxç´¢å¼•èŠ‚ç‚¹(inode)ç”¨æ»¡å¯¼è‡´æ•…éšœçš„æ–¹æ³•","date_published":"2024-09-05T14:30:05.000Z","tags":["æŠ€æœ¯","linux","zabbix","linux","zabbix"]},{"id":"https://blog.hanqunfeng.com/2024/08/02/gradle-depoly-maven-center-repository-new/","url":"https://blog.hanqunfeng.com/2024/08/02/gradle-depoly-maven-center-repository-new/","title":"å‘å¸ƒJaråˆ°Mavenä¸­å¤®ä»“åº“--Gradleç‰ˆ(æœ€æ–°æ–¹å¼)","content_html":"<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\"><a href=\"https://oss.sonatype.org\">https://oss.sonatype.org</a>å·²ç»ä¸å†æ”¯æŒæ–°ç”¨æˆ·æ³¨å†Œï¼Œæ–°çš„æ³¨å†Œåœ°å€ä¸º<a href=\"https://central.sonatype.com\">https://central.sonatype.com</a></li>\n<li class=\"lvl-2\">é€šè¿‡æœ¬æ–‡ï¼Œä½ å°†çŸ¥é“å¦‚ä½•å°†Gradleæ„å»ºçš„é¡¹ç›®å‘å¸ƒåˆ°Mavenä¸­å¤®ä»“åº“</li>\n<li class=\"lvl-2\">Mavenæ„å»ºæ–¹å¼è¯·çœ‹ <a href=\"/2024/08/01/mvn-depoly-maven-center-repository-new/\" title=\"å‘å¸ƒJaråˆ°Mavenä¸­å¤®ä»“åº“--Mavenç‰ˆ(æœ€æ–°æ–¹å¼)\">å‘å¸ƒJaråˆ°Mavenä¸­å¤®ä»“åº“--Mavenç‰ˆ(æœ€æ–°æ–¹å¼)</a> ã€‚</li>\n<li class=\"lvl-2\">å‰ä¸‰ä¸ªæ­¥éª¤ä¸ <a href=\"/2024/08/01/mvn-depoly-maven-center-repository-new/\" title=\"å‘å¸ƒJaråˆ°Mavenä¸­å¤®ä»“åº“--Mavenç‰ˆ(æœ€æ–°æ–¹å¼)\">å‘å¸ƒJaråˆ°Mavenä¸­å¤®ä»“åº“--Mavenç‰ˆ(æœ€æ–°æ–¹å¼)</a> ç›¸åŒï¼Œä¸åœ¨èµ˜è¿°ã€‚</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"ä¸€ã€å°†é¡¹ç›®æ¨é€åˆ°è¿œç¨‹ä»“åº“ï¼Œå¦‚-Githubæˆ–è€…Gitee\">ä¸€ã€å°†é¡¹ç›®æ¨é€åˆ°è¿œç¨‹ä»“åº“ï¼Œå¦‚ <code>Github</code>æˆ–è€…<code>Gitee</code></h2>\n<h2 id=\"äºŒã€æ³¨å†Œ-Sonatype-è´¦æˆ·\">äºŒã€æ³¨å†Œ <code>Sonatype</code> è´¦æˆ·</h2>\n<h2 id=\"ä¸‰ã€ç™»å½•-Sonatype-åˆ›å»ºNamespace\">ä¸‰ã€ç™»å½• Sonatype åˆ›å»º<code>Namespace</code></h2>\n<p>å‰ä¸‰ä¸ªæ­¥éª¤ä¸ <a href=\"/2024/08/01/mvn-depoly-maven-center-repository-new/\" title=\"å‘å¸ƒJaråˆ°Mavenä¸­å¤®ä»“åº“--Mavenç‰ˆ(æœ€æ–°æ–¹å¼)\">å‘å¸ƒJaråˆ°Mavenä¸­å¤®ä»“åº“--Mavenç‰ˆ(æœ€æ–°æ–¹å¼)</a> ç›¸åŒï¼Œä¸åœ¨èµ˜è¿°ã€‚</p>\n<h2 id=\"å››ã€å‘å¸ƒ\">å››ã€å‘å¸ƒ</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç­¾å<br>\næˆ‘æ˜¯macç”µè„‘ï¼Œäºæ˜¯ç­¾åå·¥å…·ä½¿ç”¨çš„æ˜¯<a href=\"https://gpgtools.org\">https://gpgtools.org</a>ï¼Œgradleç­¾åæ—¶éœ€è¦ä½¿ç”¨åˆ°<code>.gpg</code>è¯ä¹¦æ–‡ä»¶ï¼Œè¿™ä¸ªå·¥å…·ä¸æ”¯æŒç›´æ¥å¯¼å‡º<code>.gpg</code>ï¼Œå…¶å¯¼å‡ºçš„è¯ä¹¦æ–‡ä»¶æ˜¯<code>.asc</code>æ ¼å¼çš„ï¼Œ<code>asc</code>å…¶å®å°±æ˜¯<code>å­—ç¬¦ä¸²</code>ï¼Œå¯ä»¥ç”¨è®°äº‹æœ¬æ‰“å¼€æŸ¥çœ‹ã€‚</p>\n<p>ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤å¯¼å‡º<code>.gpg</code>æ ¼å¼çš„è¯ä¹¦ï¼š</p>\n  <figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åˆ—å‡ºå½“å‰å…¨éƒ¨è¯ä¹¦</span></span><br><span class=\"line\">gpg -k</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å¯¼å‡ºç§é’¥ï¼Œqunfeng_han@126.comæ˜¯åˆ›å»ºè¯ä¹¦æ—¶ä½¿ç”¨çš„é‚®ç®±ï¼Œä¼šè¦æ±‚ä½ è¾“å…¥åˆ›å»ºè¯ä¹¦æ—¶çš„å¯†ç </span></span><br><span class=\"line\">gpg --output private.pgp --armor --export-secret-key qunfeng_han@126.com</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å¯¼å‡ºå…¬é’¥</span></span><br><span class=\"line\">gpg --output public.pgp --armor --<span class=\"built_in\">export</span> qunfeng_han@126.com</span><br></pre></td></tr></table></figure>\n</li>\n<li class=\"lvl-2\">\n<p>build.gradle<br>\nå®˜æ–¹æ²¡æœ‰å‡ºgradleå‘å¸ƒæ’ä»¶ï¼Œä½†æ˜¯<a href=\"https://central.sonatype.org/publish/publish-portal-gradle/\">å®˜ç½‘</a>æ¨èä½¿ç”¨ç¬¬ä¸‰æ–¹çš„<a href=\"https://jreleaser.org/guide/latest/examples/maven/maven-central.html#_gradle\">jreleaser</a>æ’ä»¶ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight gradle\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">plugins &#123;</span><br><span class=\"line\"><span class=\"comment\">//    id &#x27;io.spring.dependency-management&#x27; version &#x27;1.0.10.RELEASE&#x27;</span></span><br><span class=\"line\">    id <span class=\"string\">&#x27;io.spring.dependency-management&#x27;</span> version <span class=\"string\">&#x27;1.1.6&#x27;</span></span><br><span class=\"line\">    <span class=\"comment\">//æ­¤å¤„å¿…é¡»æ˜¯java-libraryï¼Œå¦‚æœæ˜¯javaåˆ™apiæ–¹æ³•ä¸å¯ç”¨ï¼Œapiå¯ä»¥ç†è§£ä¸ºå°±æ˜¯compileï¼Œæ”¯æŒä¼ é€’ä¾èµ–</span></span><br><span class=\"line\">    id <span class=\"string\">&#x27;java-library&#x27;</span></span><br><span class=\"line\">    <span class=\"comment\">//å‘å¸ƒæ’ä»¶</span></span><br><span class=\"line\">    id <span class=\"string\">&#x27;maven-publish&#x27;</span></span><br><span class=\"line\">    <span class=\"comment\">//è‡ªåŠ¨å‘å¸ƒåˆ°mavenä¸­å¤®ä»“åº“æ’ä»¶</span></span><br><span class=\"line\">    <span class=\"comment\">//https://jreleaser.org/guide/latest/examples/maven/maven-central.html#_gradle</span></span><br><span class=\"line\">    id <span class=\"string\">&#x27;org.jreleaser&#x27;</span> version <span class=\"string\">&#x27;1.13.1&#x27;</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">group</span> = <span class=\"string\">&#x27;io.github.hanqunfeng&#x27;</span></span><br><span class=\"line\"><span class=\"comment\">//version = &#x27;1.0.0-SNAPSHOT&#x27;</span></span><br><span class=\"line\">version = <span class=\"string\">&#x27;1.0.1&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">sourceCompatibility</span> = <span class=\"string\">&#x27;1.8&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">java &#123;</span><br><span class=\"line\">    withJavadocJar()</span><br><span class=\"line\">    withSourcesJar()</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">repositories</span> &#123;</span><br><span class=\"line\">    maven &#123; url <span class=\"string\">&#x27;https://maven.aliyun.com/repository/public/&#x27;</span> &#125;</span><br><span class=\"line\">    mavenLocal()</span><br><span class=\"line\">    mavenCentral()</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">dependencyManagement &#123;</span><br><span class=\"line\">    imports &#123; mavenBom(<span class=\"string\">&quot;software.amazon.awssdk:bom:2.23.10&quot;</span>) &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">dependencies</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">//lombok</span></span><br><span class=\"line\">    compileOnly <span class=\"string\">&#x27;org.projectlombok:lombok:1.18.32&#x27;</span></span><br><span class=\"line\">    annotationProcessor <span class=\"string\">&#x27;org.projectlombok:lombok:1.18.32&#x27;</span></span><br><span class=\"line\">    api <span class=\"string\">&#x27;software.amazon.awssdk:s3&#x27;</span></span><br><span class=\"line\">    api <span class=\"string\">&#x27;software.amazon.awssdk:apache-client&#x27;</span></span><br><span class=\"line\">    api <span class=\"string\">&#x27;software.amazon.awssdk:s3-transfer-manager&#x27;</span></span><br><span class=\"line\">    api <span class=\"string\">&#x27;software.amazon.awssdk:aws-crt-client&#x27;</span></span><br><span class=\"line\">    api <span class=\"string\">&#x27;org.springframework:spring-core:5.3.29&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// javaç¼–è¯‘çš„æ—¶å€™ç¼ºçœçŠ¶æ€ä¸‹ä¼šå› ä¸ºä¸­æ–‡å­—ç¬¦è€Œå¤±è´¥</span></span><br><span class=\"line\">[compileJava, compileTestJava]*.<span class=\"keyword\">options</span>*.encoding = <span class=\"string\">&#x27;UTF-8&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * å‘å¸ƒæ’ä»¶</span></span><br><span class=\"line\"><span class=\"comment\"> * å‚è€ƒï¼šhttps://docs.gradle.org/6.6.1/userguide/publishing_maven.html#publishing_maven:resolved_dependencies</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * å‘å¸ƒä¸ºbomï¼Œå‚è€ƒï¼šhttps://zhuanlan.zhihu.com/p/195678201</span></span><br><span class=\"line\"><span class=\"comment\"> * æ³¨æ„ï¼šjava-platformä¸èƒ½ä¸javaå’Œjava-libraryåŒæ—¶å­˜åœ¨</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\">publishing &#123;</span><br><span class=\"line\">    publications &#123;</span><br><span class=\"line\">        maven(MavenPublication) &#123;</span><br><span class=\"line\">            groupId = <span class=\"keyword\">project</span>.<span class=\"keyword\">group</span></span><br><span class=\"line\">            artifactId = <span class=\"keyword\">project</span>.name</span><br><span class=\"line\">            version = <span class=\"keyword\">project</span>.version</span><br><span class=\"line\">            <span class=\"comment\">//å¦‚æœä¸å®šä¹‰ï¼Œåˆ™ä¼šæŒ‰ç…§ä»¥ä¸Šé»˜è®¤å€¼æ‰§è¡Œ</span></span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">from</span> components.java</span><br><span class=\"line\"></span><br><span class=\"line\">            pom &#123;</span><br><span class=\"line\">                name = <span class=\"string\">&#x27;aws-s3-v2-tools-gradle&#x27;</span></span><br><span class=\"line\">                <span class=\"keyword\">description</span> = <span class=\"string\">&#x27;AWS S3 Tools.&#x27;</span></span><br><span class=\"line\">                url = <span class=\"string\">&#x27;https://blog.hanqunfeng.com&#x27;</span></span><br><span class=\"line\">                licenses &#123;</span><br><span class=\"line\">                    license &#123;</span><br><span class=\"line\">                        name = <span class=\"string\">&#x27;The Apache License, Version 2.0&#x27;</span></span><br><span class=\"line\">                        url = <span class=\"string\">&#x27;http://www.apache.org/licenses/LICENSE-2.0.txt&#x27;</span></span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                developers &#123;</span><br><span class=\"line\">                    developer &#123;</span><br><span class=\"line\">                        id = <span class=\"string\">&#x27;hanqf&#x27;</span></span><br><span class=\"line\">                        name = <span class=\"string\">&#x27;han qunfeng&#x27;</span></span><br><span class=\"line\">                        email = <span class=\"string\">&#x27;qunfeng_han@126.com&#x27;</span></span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                scm &#123;</span><br><span class=\"line\">                    connection = <span class=\"string\">&#x27;scm:git:https://github.com/hanqunfeng/aws-s3-v2-tools-gradle.git&#x27;</span></span><br><span class=\"line\">                    developerConnection = <span class=\"string\">&#x27;scm:git:https://github.com:hanqunfeng/aws-s3-v2-tools-gradle.git&#x27;</span></span><br><span class=\"line\">                    url = <span class=\"string\">&#x27;https://github.com/hanqunfeng/aws-s3-v2-tools-gradle&#x27;</span></span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            versionMapping &#123;</span><br><span class=\"line\">                usage(<span class=\"string\">&#x27;java-api&#x27;</span>) &#123;</span><br><span class=\"line\">                    fromResolutionOf(<span class=\"string\">&#x27;runtimeClasspath&#x27;</span>)</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                usage(<span class=\"string\">&#x27;java-runtime&#x27;</span>) &#123;</span><br><span class=\"line\">                    fromResolutionResult()</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">repositories</span> &#123;</span><br><span class=\"line\">        maven &#123;</span><br><span class=\"line\">            url = layout.buildDirectory.dir(<span class=\"string\">&#x27;staging-deploy&#x27;</span>)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">tasks.withType(JavaCompile) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">options</span>.encoding = <span class=\"string\">&#x27;UTF-8&#x27;</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//javadocï¼Œå¦‚æœç”¨jdk11ï¼Œé»˜è®¤å°±æ”¯æŒä¸­æ–‡</span></span><br><span class=\"line\"><span class=\"comment\">//æŸ¥çœ‹å¯ä»¥é…ç½®çš„å±æ€§ï¼šhttps://docs.gradle.org/current/javadoc/org/gradle/external/javadoc/StandardJavadocDocletOptions.html</span></span><br><span class=\"line\">tasks.withType(Javadoc) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">options</span>.version = <span class=\"keyword\">true</span></span><br><span class=\"line\">    <span class=\"keyword\">options</span>.author = <span class=\"keyword\">true</span></span><br><span class=\"line\">    <span class=\"keyword\">options</span>.encoding = <span class=\"string\">&quot;UTF-8&quot;</span></span><br><span class=\"line\">    <span class=\"keyword\">options</span>.charSet = <span class=\"string\">&quot;UTF-8&quot;</span>  <span class=\"comment\">//è§£å†³ä¸­æ–‡ä¹±ç </span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">javadoc &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (JavaVersion.current().isJava9Compatible()) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">options</span>.addBooleanOption(<span class=\"string\">&#x27;html5&#x27;</span>, <span class=\"keyword\">true</span>)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (JavaVersion.current().isJava8Compatible()) &#123;</span><br><span class=\"line\">        tasks.withType(Javadoc) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// disable the crazy super-strict doclint tool in Java 8</span></span><br><span class=\"line\">            <span class=\"comment\">// noinspection SpellCheckingInspection</span></span><br><span class=\"line\">            <span class=\"keyword\">options</span>.addStringOption(<span class=\"string\">&#x27;Xdoclint:none&#x27;</span>, <span class=\"string\">&#x27;-quiet&#x27;</span>)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// jreleaseré…ç½®æ–‡ä»¶ï¼š~/.jreleaser/config.toml</span></span><br><span class=\"line\"><span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">JRELEASER_MAVENCENTRAL_USERNAME = &quot;&lt;your-publisher-portal-username&gt;&quot;</span></span><br><span class=\"line\"><span class=\"comment\">JRELEASER_MAVENCENTRAL_PASSWORD = &quot;&lt;your-publisher-portal-password&gt;&quot;</span></span><br><span class=\"line\"><span class=\"comment\">JRELEASER_NEXUS2_USERNAME = &quot;&lt;your-sonatype-account-username&gt;&quot;</span></span><br><span class=\"line\"><span class=\"comment\">JRELEASER_NEXUS2_PASSWORD = &quot;&lt;your-sonatype-account-password&gt;&quot;</span></span><br><span class=\"line\"><span class=\"comment\">JRELEASER_GPG_PASSPHRASE = &quot;&lt;your-pgp-passphrase&gt;&quot;</span></span><br><span class=\"line\"><span class=\"comment\">JRELEASER_GITHUB_TOKEN = &quot;&lt;your-github-token&quot;</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\">jreleaser &#123;</span><br><span class=\"line\">    signing &#123;</span><br><span class=\"line\">        active = <span class=\"string\">&#x27;ALWAYS&#x27;</span></span><br><span class=\"line\">        armored = <span class=\"keyword\">true</span></span><br><span class=\"line\">        mode = <span class=\"string\">&#x27;FILE&#x27;</span></span><br><span class=\"line\">        publicKey = <span class=\"string\">&#x27;/Users/hanqf/develop_soft/gpg_key/hanqf/public.pgp&#x27;</span></span><br><span class=\"line\">        secretKey = <span class=\"string\">&#x27;/Users/hanqf/develop_soft/gpg_key/hanqf/private.pgp&#x27;</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    deploy &#123;</span><br><span class=\"line\">        maven &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">/* Portal Publisher API */</span></span><br><span class=\"line\">            mavenCentral &#123;</span><br><span class=\"line\">                sonatype &#123;</span><br><span class=\"line\">                    active = <span class=\"string\">&#x27;ALWAYS&#x27;</span></span><br><span class=\"line\">                    url = <span class=\"string\">&#x27;https://central.sonatype.com/api/v1/publisher&#x27;</span></span><br><span class=\"line\">                    stagingRepository(<span class=\"string\">&#x27;build/staging-deploy&#x27;</span>)</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>~/.jreleaser/config.toml ï¼šé…ç½®ç›¸å…³è®¤è¯ä¿¡æ¯</p>\n</li>\n</ul>\n<figure class=\"highlight properties\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># https://central.sonatype.com çš„è®¤è¯ä¿¡æ¯</span></span><br><span class=\"line\"><span class=\"attr\">JRELEASER_MAVENCENTRAL_USERNAME</span> = <span class=\"string\">&quot;&lt;your-publisher-portal-username&gt;&quot;</span></span><br><span class=\"line\"><span class=\"attr\">JRELEASER_MAVENCENTRAL_PASSWORD</span> = <span class=\"string\">&quot;&lt;your-publisher-portal-password&gt;&quot;</span></span><br><span class=\"line\"><span class=\"comment\"># https://oss.sonatype.org çš„è®¤è¯ä¿¡æ¯ï¼Œè¿™é‡Œæ²¡æœ‰ç”¨åˆ°ï¼Œå¯ä»¥ä¸è¿›è¡Œé…ç½®</span></span><br><span class=\"line\"><span class=\"attr\">JRELEASER_NEXUS2_USERNAME</span> = <span class=\"string\">&quot;&lt;your-sonatype-account-username&gt;&quot;</span></span><br><span class=\"line\"><span class=\"attr\">JRELEASER_NEXUS2_PASSWORD</span> = <span class=\"string\">&quot;&lt;your-sonatype-account-password&gt;&quot;</span></span><br><span class=\"line\"><span class=\"comment\"># åˆ›å»º pgp å¯†é’¥æ—¶çš„å¯†ç </span></span><br><span class=\"line\"><span class=\"attr\">JRELEASER_GPG_PASSPHRASE</span> = <span class=\"string\">&quot;&lt;your-pgp-passphrase&gt;&quot;</span></span><br><span class=\"line\"><span class=\"comment\"># github token</span></span><br><span class=\"line\"><span class=\"attr\">JRELEASER_GITHUB_TOKEN</span> = <span class=\"string\">&quot;&lt;your-github-token&quot;</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ‰§è¡Œå‘½ä»¤</p>\n</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">./gradlew jreleaserConfig <span class=\"comment\"># éªŒè¯é…ç½®æ–‡ä»¶æ˜¯å¦æ­£ç¡®</span></span><br><span class=\"line\">./gradlew clean publish <span class=\"comment\"># å‘å¸ƒåˆ°æœ¬åœ° build/staging-deploy</span></span><br><span class=\"line\">./gradlew jreleaserFullRelease <span class=\"comment\"># å‘å¸ƒåˆ°è¿œç¨‹Mavenä¸­å¤®ä»“åº“</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ›´æ–°éƒ¨ç½²<br>\nä¸ <a href=\"/2024/08/01/mvn-depoly-maven-center-repository-new/\" title=\"å‘å¸ƒJaråˆ°Mavenä¸­å¤®ä»“åº“--Mavenç‰ˆ(æœ€æ–°æ–¹å¼)\">å‘å¸ƒJaråˆ°Mavenä¸­å¤®ä»“åº“--Mavenç‰ˆ(æœ€æ–°æ–¹å¼)</a> ä¸­çš„æè¿°ç±»ä¼¼ï¼Œåªéœ€è¦ä¿®æ”¹<code>build.gradle</code>ä¸­å¯¹åº”çš„ç‰ˆæœ¬å·åé‡æ–°æ‰§è¡Œä¸Šé¢çš„å‘å¸ƒå‘½ä»¤å³å¯ï¼Œå‘å¸ƒçš„jaråŒ…å¯ä»¥åœ¨<a href=\"https://central.sonatype.com\">https://central.sonatype.com</a>ä¸­æ£€ç´¢ã€‚</p>\n</li>\n</ul>\n","content_text":"æ‘˜è¦ https://oss.sonatype.orgå·²ç»ä¸å†æ”¯æŒæ–°ç”¨æˆ·æ³¨å†Œï¼Œæ–°çš„æ³¨å†Œåœ°å€ä¸ºhttps://central.sonatype.com é€šè¿‡æœ¬æ–‡ï¼Œä½ å°†çŸ¥é“å¦‚ä½•å°†Gradleæ„å»ºçš„é¡¹ç›®å‘å¸ƒåˆ°Mavenä¸­å¤®ä»“åº“ Mavenæ„å»ºæ–¹å¼è¯·çœ‹ å‘å¸ƒJaråˆ°Mavenä¸­å¤®ä»“åº“--Mavenç‰ˆ(æœ€æ–°æ–¹å¼) ã€‚ å‰ä¸‰ä¸ªæ­¥éª¤ä¸ å‘å¸ƒJaråˆ°Mavenä¸­å¤®ä»“åº“--Mavenç‰ˆ(æœ€æ–°æ–¹å¼) ç›¸åŒï¼Œä¸åœ¨èµ˜è¿°ã€‚ ä¸€ã€å°†é¡¹ç›®æ¨é€åˆ°è¿œç¨‹ä»“åº“ï¼Œå¦‚ Githubæˆ–è€…Gitee äºŒã€æ³¨å†Œ Sonatype è´¦æˆ· ä¸‰ã€ç™»å½• Sonatype åˆ›å»ºNamespace å‰ä¸‰ä¸ªæ­¥éª¤ä¸ å‘å¸ƒJaråˆ°Mavenä¸­å¤®ä»“åº“--Mavenç‰ˆ(æœ€æ–°æ–¹å¼) ç›¸åŒï¼Œä¸åœ¨èµ˜è¿°ã€‚ å››ã€å‘å¸ƒ ç­¾å æˆ‘æ˜¯macç”µè„‘ï¼Œäºæ˜¯ç­¾åå·¥å…·ä½¿ç”¨çš„æ˜¯https://gpgtools.orgï¼Œgradleç­¾åæ—¶éœ€è¦ä½¿ç”¨åˆ°.gpgè¯ä¹¦æ–‡ä»¶ï¼Œè¿™ä¸ªå·¥å…·ä¸æ”¯æŒç›´æ¥å¯¼å‡º.gpgï¼Œå…¶å¯¼å‡ºçš„è¯ä¹¦æ–‡ä»¶æ˜¯.ascæ ¼å¼çš„ï¼Œascå…¶å®å°±æ˜¯å­—ç¬¦ä¸²ï¼Œå¯ä»¥ç”¨è®°äº‹æœ¬æ‰“å¼€æŸ¥çœ‹ã€‚ ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤å¯¼å‡º.gpgæ ¼å¼çš„è¯ä¹¦ï¼š 12345678# åˆ—å‡ºå½“å‰å…¨éƒ¨è¯ä¹¦gpg -k# å¯¼å‡ºç§é’¥ï¼Œqunfeng_han@126.comæ˜¯åˆ›å»ºè¯ä¹¦æ—¶ä½¿ç”¨çš„é‚®ç®±ï¼Œä¼šè¦æ±‚ä½ è¾“å…¥åˆ›å»ºè¯ä¹¦æ—¶çš„å¯†ç gpg --output private.pgp --armor --export-secret-key qunfeng_han@126.com# å¯¼å‡ºå…¬é’¥gpg --output public.pgp --armor --export qunfeng_han@126.com build.gradle å®˜æ–¹æ²¡æœ‰å‡ºgradleå‘å¸ƒæ’ä»¶ï¼Œä½†æ˜¯å®˜ç½‘æ¨èä½¿ç”¨ç¬¬ä¸‰æ–¹çš„jreleaseræ’ä»¶ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170plugins &#123;// id &#x27;io.spring.dependency-management&#x27; version &#x27;1.0.10.RELEASE&#x27; id &#x27;io.spring.dependency-management&#x27; version &#x27;1.1.6&#x27; //æ­¤å¤„å¿…é¡»æ˜¯java-libraryï¼Œå¦‚æœæ˜¯javaåˆ™apiæ–¹æ³•ä¸å¯ç”¨ï¼Œapiå¯ä»¥ç†è§£ä¸ºå°±æ˜¯compileï¼Œæ”¯æŒä¼ é€’ä¾èµ– id &#x27;java-library&#x27; //å‘å¸ƒæ’ä»¶ id &#x27;maven-publish&#x27; //è‡ªåŠ¨å‘å¸ƒåˆ°mavenä¸­å¤®ä»“åº“æ’ä»¶ //https://jreleaser.org/guide/latest/examples/maven/maven-central.html#_gradle id &#x27;org.jreleaser&#x27; version &#x27;1.13.1&#x27;&#125;group = &#x27;io.github.hanqunfeng&#x27;//version = &#x27;1.0.0-SNAPSHOT&#x27;version = &#x27;1.0.1&#x27;sourceCompatibility = &#x27;1.8&#x27;java &#123; withJavadocJar() withSourcesJar()&#125;repositories &#123; maven &#123; url &#x27;https://maven.aliyun.com/repository/public/&#x27; &#125; mavenLocal() mavenCentral()&#125;dependencyManagement &#123; imports &#123; mavenBom(&quot;software.amazon.awssdk:bom:2.23.10&quot;) &#125;&#125;dependencies &#123; //lombok compileOnly &#x27;org.projectlombok:lombok:1.18.32&#x27; annotationProcessor &#x27;org.projectlombok:lombok:1.18.32&#x27; api &#x27;software.amazon.awssdk:s3&#x27; api &#x27;software.amazon.awssdk:apache-client&#x27; api &#x27;software.amazon.awssdk:s3-transfer-manager&#x27; api &#x27;software.amazon.awssdk:aws-crt-client&#x27; api &#x27;org.springframework:spring-core:5.3.29&#x27;&#125;// javaç¼–è¯‘çš„æ—¶å€™ç¼ºçœçŠ¶æ€ä¸‹ä¼šå› ä¸ºä¸­æ–‡å­—ç¬¦è€Œå¤±è´¥[compileJava, compileTestJava]*.options*.encoding = &#x27;UTF-8&#x27;/** * å‘å¸ƒæ’ä»¶ * å‚è€ƒï¼šhttps://docs.gradle.org/6.6.1/userguide/publishing_maven.html#publishing_maven:resolved_dependencies * * å‘å¸ƒä¸ºbomï¼Œå‚è€ƒï¼šhttps://zhuanlan.zhihu.com/p/195678201 * æ³¨æ„ï¼šjava-platformä¸èƒ½ä¸javaå’Œjava-libraryåŒæ—¶å­˜åœ¨ */publishing &#123; publications &#123; maven(MavenPublication) &#123; groupId = project.group artifactId = project.name version = project.version //å¦‚æœä¸å®šä¹‰ï¼Œåˆ™ä¼šæŒ‰ç…§ä»¥ä¸Šé»˜è®¤å€¼æ‰§è¡Œ from components.java pom &#123; name = &#x27;aws-s3-v2-tools-gradle&#x27; description = &#x27;AWS S3 Tools.&#x27; url = &#x27;https://blog.hanqunfeng.com&#x27; licenses &#123; license &#123; name = &#x27;The Apache License, Version 2.0&#x27; url = &#x27;http://www.apache.org/licenses/LICENSE-2.0.txt&#x27; &#125; &#125; developers &#123; developer &#123; id = &#x27;hanqf&#x27; name = &#x27;han qunfeng&#x27; email = &#x27;qunfeng_han@126.com&#x27; &#125; &#125; scm &#123; connection = &#x27;scm:git:https://github.com/hanqunfeng/aws-s3-v2-tools-gradle.git&#x27; developerConnection = &#x27;scm:git:https://github.com:hanqunfeng/aws-s3-v2-tools-gradle.git&#x27; url = &#x27;https://github.com/hanqunfeng/aws-s3-v2-tools-gradle&#x27; &#125; &#125; versionMapping &#123; usage(&#x27;java-api&#x27;) &#123; fromResolutionOf(&#x27;runtimeClasspath&#x27;) &#125; usage(&#x27;java-runtime&#x27;) &#123; fromResolutionResult() &#125; &#125; &#125; &#125; repositories &#123; maven &#123; url = layout.buildDirectory.dir(&#x27;staging-deploy&#x27;) &#125; &#125;&#125;tasks.withType(JavaCompile) &#123; options.encoding = &#x27;UTF-8&#x27;&#125;//javadocï¼Œå¦‚æœç”¨jdk11ï¼Œé»˜è®¤å°±æ”¯æŒä¸­æ–‡//æŸ¥çœ‹å¯ä»¥é…ç½®çš„å±æ€§ï¼šhttps://docs.gradle.org/current/javadoc/org/gradle/external/javadoc/StandardJavadocDocletOptions.htmltasks.withType(Javadoc) &#123; options.version = true options.author = true options.encoding = &quot;UTF-8&quot; options.charSet = &quot;UTF-8&quot; //è§£å†³ä¸­æ–‡ä¹±ç &#125;javadoc &#123; if (JavaVersion.current().isJava9Compatible()) &#123; options.addBooleanOption(&#x27;html5&#x27;, true) &#125; if (JavaVersion.current().isJava8Compatible()) &#123; tasks.withType(Javadoc) &#123; // disable the crazy super-strict doclint tool in Java 8 // noinspection SpellCheckingInspection options.addStringOption(&#x27;Xdoclint:none&#x27;, &#x27;-quiet&#x27;) &#125; &#125;&#125;// jreleaseré…ç½®æ–‡ä»¶ï¼š~/.jreleaser/config.toml/*JRELEASER_MAVENCENTRAL_USERNAME = &quot;&lt;your-publisher-portal-username&gt;&quot;JRELEASER_MAVENCENTRAL_PASSWORD = &quot;&lt;your-publisher-portal-password&gt;&quot;JRELEASER_NEXUS2_USERNAME = &quot;&lt;your-sonatype-account-username&gt;&quot;JRELEASER_NEXUS2_PASSWORD = &quot;&lt;your-sonatype-account-password&gt;&quot;JRELEASER_GPG_PASSPHRASE = &quot;&lt;your-pgp-passphrase&gt;&quot;JRELEASER_GITHUB_TOKEN = &quot;&lt;your-github-token&quot; */jreleaser &#123; signing &#123; active = &#x27;ALWAYS&#x27; armored = true mode = &#x27;FILE&#x27; publicKey = &#x27;/Users/hanqf/develop_soft/gpg_key/hanqf/public.pgp&#x27; secretKey = &#x27;/Users/hanqf/develop_soft/gpg_key/hanqf/private.pgp&#x27; &#125; deploy &#123; maven &#123; /* Portal Publisher API */ mavenCentral &#123; sonatype &#123; active = &#x27;ALWAYS&#x27; url = &#x27;https://central.sonatype.com/api/v1/publisher&#x27; stagingRepository(&#x27;build/staging-deploy&#x27;) &#125; &#125; &#125; &#125;&#125; ~/.jreleaser/config.toml ï¼šé…ç½®ç›¸å…³è®¤è¯ä¿¡æ¯ 12345678910# https://central.sonatype.com çš„è®¤è¯ä¿¡æ¯JRELEASER_MAVENCENTRAL_USERNAME = &quot;&lt;your-publisher-portal-username&gt;&quot;JRELEASER_MAVENCENTRAL_PASSWORD = &quot;&lt;your-publisher-portal-password&gt;&quot;# https://oss.sonatype.org çš„è®¤è¯ä¿¡æ¯ï¼Œè¿™é‡Œæ²¡æœ‰ç”¨åˆ°ï¼Œå¯ä»¥ä¸è¿›è¡Œé…ç½®JRELEASER_NEXUS2_USERNAME = &quot;&lt;your-sonatype-account-username&gt;&quot;JRELEASER_NEXUS2_PASSWORD = &quot;&lt;your-sonatype-account-password&gt;&quot;# åˆ›å»º pgp å¯†é’¥æ—¶çš„å¯†ç JRELEASER_GPG_PASSPHRASE = &quot;&lt;your-pgp-passphrase&gt;&quot;# github tokenJRELEASER_GITHUB_TOKEN = &quot;&lt;your-github-token&quot; æ‰§è¡Œå‘½ä»¤ 123./gradlew jreleaserConfig # éªŒè¯é…ç½®æ–‡ä»¶æ˜¯å¦æ­£ç¡®./gradlew clean publish # å‘å¸ƒåˆ°æœ¬åœ° build/staging-deploy./gradlew jreleaserFullRelease # å‘å¸ƒåˆ°è¿œç¨‹Mavenä¸­å¤®ä»“åº“ æ›´æ–°éƒ¨ç½² ä¸ å‘å¸ƒJaråˆ°Mavenä¸­å¤®ä»“åº“--Mavenç‰ˆ(æœ€æ–°æ–¹å¼) ä¸­çš„æè¿°ç±»ä¼¼ï¼Œåªéœ€è¦ä¿®æ”¹build.gradleä¸­å¯¹åº”çš„ç‰ˆæœ¬å·åé‡æ–°æ‰§è¡Œä¸Šé¢çš„å‘å¸ƒå‘½ä»¤å³å¯ï¼Œå‘å¸ƒçš„jaråŒ…å¯ä»¥åœ¨https://central.sonatype.comä¸­æ£€ç´¢ã€‚","summary":"æ‘˜è¦ https://oss.sonatype.orgå·²ç»ä¸å†æ”¯æŒæ–°ç”¨æˆ·æ³¨å†Œï¼Œæ–°çš„æ³¨å†Œåœ°å€ä¸ºhttps://central.sonatype.com é€šè¿‡æœ¬æ–‡ï¼Œä½ å°†çŸ¥é“å¦‚ä½•å°†Gradleæ„å»ºçš„é¡¹ç›®å‘å¸ƒåˆ°Mavenä¸­å¤®ä»“åº“ Mavenæ„å»ºæ–¹å¼è¯·çœ‹ å‘å¸ƒJaråˆ°Mavenä¸­å¤®ä»“åº“--Mavenç‰ˆ(æœ€æ–°æ–¹å¼) ã€‚ å‰ä¸‰ä¸ªæ­¥éª¤ä¸ å‘å¸ƒJaråˆ°Mavenä¸­å¤®ä»“åº“--Mavenç‰ˆ(æœ€æ–°æ–¹å¼) ç›¸åŒï¼Œä¸åœ¨èµ˜è¿°ã€‚","date_published":"2024-08-02T13:30:05.000Z","tags":["æŠ€æœ¯","maven","gradle"]},{"id":"https://blog.hanqunfeng.com/2024/08/01/mvn-depoly-maven-center-repository-new/","url":"https://blog.hanqunfeng.com/2024/08/01/mvn-depoly-maven-center-repository-new/","title":"å‘å¸ƒJaråˆ°Mavenä¸­å¤®ä»“åº“--Mavenç‰ˆ(æœ€æ–°æ–¹å¼)","content_html":"<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\"><a href=\"https://oss.sonatype.org\">https://oss.sonatype.org</a>å·²ç»ä¸å†æ”¯æŒæ–°ç”¨æˆ·æ³¨å†Œï¼Œæ–°çš„æ³¨å†Œåœ°å€ä¸º<a href=\"https://central.sonatype.com\">https://central.sonatype.com</a></li>\n<li class=\"lvl-2\">é€šè¿‡æœ¬æ–‡ï¼Œä½ å°†çŸ¥é“å¦‚ä½•å°†Mavenæ„å»ºçš„é¡¹ç›®å‘å¸ƒåˆ°Mavenä¸­å¤®ä»“åº“</li>\n<li class=\"lvl-2\">Gradleæ„å»ºæ–¹å¼è¯·çœ‹ <a href=\"/2024/08/02/gradle-depoly-maven-center-repository-new/\" title=\"å‘å¸ƒJaråˆ°Mavenä¸­å¤®ä»“åº“--Gradleç‰ˆ(æœ€æ–°æ–¹å¼)\">å‘å¸ƒJaråˆ°Mavenä¸­å¤®ä»“åº“--Gradleç‰ˆ(æœ€æ–°æ–¹å¼)</a> ã€‚</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"ä¸€ã€å°†é¡¹ç›®æ¨é€åˆ°è¿œç¨‹ä»“åº“ï¼Œå¦‚-Githubæˆ–è€…Gitee\">ä¸€ã€å°†é¡¹ç›®æ¨é€åˆ°è¿œç¨‹ä»“åº“ï¼Œå¦‚ <code>Github</code>æˆ–è€…<code>Gitee</code></h2>\n<h2 id=\"äºŒã€æ³¨å†Œ-Sonatype-è´¦æˆ·\">äºŒã€æ³¨å†Œ <code>Sonatype</code> è´¦æˆ·</h2>\n<p>è¿›å…¥ <a href=\"https://central.sonatype.com\">https://central.sonatype.com</a> æ³¨å†Œä¸€ä¸ªè´¦å·ï¼Œé‚®ç®±è¦çœŸå®ã€‚</p>\n<h2 id=\"ä¸‰ã€ç™»å½•-Sonatype-åˆ›å»ºNamespace\">ä¸‰ã€ç™»å½• Sonatype åˆ›å»º<code>Namespace</code></h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¿›å…¥ Namespace æ¨¡å—ï¼Œç„¶åç‚¹å‡» Add Namespace æŒ‰é’®ï¼ŒNamespace å…·æœ‰å”¯ä¸€æ€§</p>\n</li>\n<li class=\"lvl-2\">\n<p>å‘å¸ƒå‰ä¸€å®šè¦åˆ›å»º<code>Namespace</code>ï¼Œå®é™…ä¸Šå°±æ˜¯é¡¹ç›®çš„<code>Group Id</code>ï¼Œå› ä¸ºè¦è¿›è¡ŒéªŒè¯ï¼Œæ‰€ä»¥è¿™é‡Œä¸èƒ½éšä¾¿å¡«å†™ï¼Œä½ å¯ä»¥é…ç½®ä¸ºä½ æ‹¥æœ‰çš„åŸŸåï¼Œæ¯”å¦‚æˆ‘çš„åŸŸåæ˜¯<code>hanqunfeng.com</code>ï¼Œè¿™é‡Œå°±å¡«å†™<code>com.hanqunfeng</code>ã€‚åŸŸåçš„éªŒè¯æ–¹æ³•æ˜¯é…ç½®DNS TXTè®°å½•ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å¦‚æœä½ æ²¡æœ‰åŸŸåï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨Githubçš„åŸŸåï¼Œæ¯”å¦‚æˆ‘çš„Githubç”¨æˆ·åæ˜¯<code>hanqunfeng</code>ï¼Œåˆ™è¿™é‡Œå¯ä»¥é…ç½®ä¸º<code>io.github.hanqunfeng</code>ã€‚Githubçš„éªŒè¯æ–¹å¼æ˜¯æ ¹æ®ç»™å®šä¸ªåç§°åˆ›å»ºä¸€ä¸ªpublic repositoryã€‚</p>\n</li>\n</ul>\n<h2 id=\"å››ã€å‘å¸ƒ\">å››ã€å‘å¸ƒ</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>1.å‡†å¤‡ç­¾å</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-6\">å¯ä»¥ä½¿ç”¨å·¥å…·åˆ›å»ºå¯†é’¥å¯¹<br>\néœ€è¦ä¸‹è½½ä¸€ä¸ªç­¾åå·¥å…·ï¼Œæˆ‘æ˜¯macç”µè„‘ï¼Œä¸‹è½½çš„æ˜¯<a href=\"https://gpgtools.org\">https://gpgtools.org</a>ã€‚<br>\nå®‰è£…åç‚¹å‡»æ–°å»ºï¼ŒæŒ‰ç…§æç¤ºåˆ›å»ºä¸€ä¸ªå¯†é’¥å¯¹å³å¯ï¼Œæ³¨æ„é«˜çº§é€‰é¡¹é‡Œæœ‰ä¸ªè¿‡æœŸæ—¶é—´ï¼Œé»˜è®¤æ˜¯<code>3å¹´</code>ã€‚åˆ›å»ºå¥½åä¼šä¸»åŠ¨æç¤ºä½ æ˜¯å¦å°†å…¬é’¥å‘å¸ƒåˆ°<code>key server</code>ï¼Œç‚¹å‡»<code>Upload Public key</code>å³å¯ã€‚ä¹Ÿå¯ä»¥åœ¨åˆ›å»ºåçš„è¯ä¹¦åˆ—è¡¨é¡µé¢é‚®ä»¶é€‰æ‹©<code>è¯ä¹¦</code>â€“&gt;<code>Send Public Key To Key Server</code>ã€‚</li>\n</ul>\n<p>å¯¼å‡ºè¯ä¹¦æ—¶ï¼Œå‹¾é€‰å¯†ç å¹¶è®¾ç½®å¯†ç å°±æ˜¯ç§é’¥å’Œå…¬é’¥è¯ä¹¦ï¼Œä¸å‹¾é€‰å¯†ç å°±æ˜¯å…¬é’¥ï¼Œçœ‹ç”Ÿæˆæ–‡ä»¶çš„åç§°å°±å¯ä»¥ï¼Œå…¬å¼€å°±æ˜¯å…¬é’¥ï¼Œç§å¯†å°±æ˜¯ç§é’¥ï¼Œæ ¼å¼éƒ½æ˜¯<code>asc</code>ï¼Œå…¶å®å°±æ˜¯<code>å­—ç¬¦ä¸²</code>ï¼Œå¯ä»¥ç”¨è®°äº‹æœ¬æ‰“å¼€æŸ¥çœ‹ã€‚</p>\n<p>å¦‚æœwindowsç³»ç»Ÿï¼Œå¯ä»¥ä¸‹è½½<a href=\"https://www.gpg4win.org/\">https://www.gpg4win.org/</a> ï¼Œä½¿ç”¨æ–¹å¼å·®ä¸å¤šï¼Œæœ€åç‚¹å‡»â€œå°†å…¬é’¥ä¸Šä¼ çš„ç›®å½•æœåŠ¡â€ã€‚</p>\n<p>å…¬é’¥å‘å¸ƒåˆ°<code>key server</code>åè¦ç¨å¾®ç­‰ä¸€ä¼šï¼Œå¤§çº¦<code>10åˆ†é’Ÿ</code>å§ï¼Œå› ä¸º<code>key server</code>æœ‰å¤šä¸ªï¼ŒåŒæ­¥éœ€è¦ä¸€äº›æ—¶é—´ã€‚<br>\nè®°ä½ä½ åˆ›å»ºå¯†é’¥å¯¹æ—¶çš„å¯†ç ï¼Œå‘å¸ƒé¡¹ç›®æ—¶è¦ä½¿ç”¨ã€‚</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-6\">\n<p>ä¹Ÿå¯ä»¥ä½¿ç”¨å‘½ä»¤è¡Œåˆ›å»ºå¯†é’¥å¯¹ï¼Œç‰ˆæœ¬<code>[gpg (GnuPG/MacGPG2) 2.2.24]</code></p>\n  <figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åˆ›å»ºå¯†é’¥å¯¹ï¼ŒæŒ‰æç¤ºè¾“å…¥ç”¨æˆ·åç§°å’Œé‚®ç®±åœ°å€</span></span><br><span class=\"line\">gpg --generate-key</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åˆ—å‡ºå¯†é’¥ï¼Œhanqunfengå°±æ˜¯åˆ›å»ºå¯†é’¥å¯¹æ˜¯çš„ç”¨æˆ·åï¼Œæ­¤å¤„ä¹Ÿå¯ä»¥ä½¿ç”¨é‚®ç®±</span></span><br><span class=\"line\"><span class=\"comment\"># ç»“æœä¸­ç¬¬äºŒè¡Œä¸€é•¿ä¸²çš„å8ä½å°±æ˜¯keyIdï¼Œæ¯”å¦‚ï¼š30FF8D58ï¼Œgradleæ„å»ºæ—¶ä¼šç”¨åˆ°</span></span><br><span class=\"line\">gpg --list-keys hanqunfeng</span><br><span class=\"line\"><span class=\"comment\"># ä¹Ÿå¯ä»¥ç›´æ¥é€šè¿‡idæŸ¥è¯¢</span></span><br><span class=\"line\">gpg --list-keys 30FF8D58</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ä¸Šä¼ å…¬é’¥åˆ°server keyï¼Œé»˜è®¤ä¸Šä¼ åˆ°hkps://keys.openpgp.orgï¼Œä½†æ˜¯æç¤ºä¸Šä¼ å¤±è´¥</span></span><br><span class=\"line\"><span class=\"comment\"># çœ‹åˆ°ç½‘ä¸Šçš„ç¤ºä¾‹å¯ä»¥é€šè¿‡--keyserveræŒ‡å®šä¸Šä¼ çš„æœåŠ¡å™¨åœ°å€ï¼Œä½†æ˜¯æˆ‘è¿™ä¸ªç‰ˆæœ¬[gpg (GnuPG/MacGPG2) 2.2.24]æ²¡æœ‰è¿™ä¸ªå‚æ•°</span></span><br><span class=\"line\"><span class=\"comment\"># ä½¿ç”¨ https://gpgtools.org ä¸Šä¼ å…¬é’¥å°±ä¼šæˆåŠŸ</span></span><br><span class=\"line\">gpg --send-keys 30FF8D58</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹æŒ‡çº¹</span></span><br><span class=\"line\">gpg --fingerprint 30FF8D58</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åˆ é™¤ç§é’¥ï¼Œè¿™é‡Œä¹Ÿå¯ä»¥ä½¿ç”¨ç”¨æˆ·åç§°æˆ–è€…é‚®ç®±ï¼Œå¦‚æœå”¯ä¸€çš„è¯</span></span><br><span class=\"line\">gpg --delete-secret-keys 30FF8D58</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åˆ é™¤å…¬é’¥</span></span><br><span class=\"line\">gpg --delete-keys 30FF8D58</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<p>2.settings.xml<br>\né…ç½® <code>maven</code> çš„ <code>settings.xml</code> æ–‡ä»¶ï¼Œè®¾ç½®ä¸€ä¸ª <code>server</code>ï¼Œé‡Œé¢æ·»åŠ  <code>User Token</code>ã€‚</p>\n</li>\n</ul>\n<blockquote>\n<p>ç™»å½•<a href=\"https://central.sonatype.com\">https://central.sonatype.com</a>åç‚¹å‡»å³ä¸Šè§’çš„ç”¨æˆ·åç§°â€“&gt; View Account --&gt; Generate User Token</p>\n</blockquote>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">settings</span>&gt;</span></span><br><span class=\"line\">    [...]</span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">servers</span>&gt;</span></span><br><span class=\"line\">       [...]</span><br><span class=\"line\">       <span class=\"tag\">&lt;<span class=\"name\">server</span>&gt;</span></span><br><span class=\"line\">          <span class=\"tag\">&lt;<span class=\"name\">id</span>&gt;</span>maven-central<span class=\"tag\">&lt;/<span class=\"name\">id</span>&gt;</span></span><br><span class=\"line\">          <span class=\"tag\">&lt;<span class=\"name\">username</span>&gt;</span>username<span class=\"tag\">&lt;/<span class=\"name\">username</span>&gt;</span></span><br><span class=\"line\">          <span class=\"tag\">&lt;<span class=\"name\">password</span>&gt;</span>token<span class=\"tag\">&lt;/<span class=\"name\">password</span>&gt;</span></span><br><span class=\"line\">       <span class=\"tag\">&lt;/<span class=\"name\">server</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">servers</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">settings</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>3.pom.xmlï¼Œé‡ç‚¹æ˜¯åé¢å‡ ä¸ªplugin<br>\nè¿™é‡Œé‡ç‚¹è¯´ä¸€ä¸‹<code>central-publishing-maven-plugin</code>è¿™ä¸ªæ’ä»¶ï¼Œè¯¥æ’ä»¶ä¼šå°†jaråŒ…æ¨é€åˆ°<code>Maven Central</code>ä»“åº“ï¼Œå¦‚æœæ’ä»¶æ²¡æœ‰é…ç½®å‚æ•°<code>autoPublish</code>ä¸º<code>true</code>ï¼Œåˆ™ä½†æ­¤æ—¶å‘å¸ƒçš„jarä¼šå¤„äº<code>VALIDATED</code>çŠ¶æ€ï¼Œéœ€è¦ç™»å½•<a href=\"https://central.sonatype.com\">https://central.sonatype.com</a>ååˆ‡æ¢åˆ°Deploymentï¼Œæ‰¾åˆ°æˆ‘ä»¬åˆšåˆšä¸Šä¼ çš„åŒ…åï¼Œç„¶åç‚¹å‡»å³ä¾§çš„<code>Publish</code>æŒ‰é’®ï¼Œå¦‚æœä¸€åˆ‡é¡ºåˆ©ï¼Œå¤§äº10åˆ†é’Ÿåå…¶çŠ¶æ€å˜ä¸º<code>PUBLISHED</code>ï¼Œè¡¨ç¤ºå‘å¸ƒæˆåŠŸã€‚å¦‚æœå‘å¸ƒå¤±è´¥ï¼Œå…¶çŠ¶æ€ä¼šå˜æ›´ä¸º<code>FAILED</code>ï¼Œå¯ä»¥åœ¨<code>Component Summary</code>ä¸­æŸ¥çœ‹å¤±è´¥åŸå› ï¼Œé‡æ–°å‘å¸ƒå³å¯ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">project</span> <span class=\"attr\">xmlns</span>=<span class=\"string\">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class=\"attr\">xmlns:xsi</span>=<span class=\"string\">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">         <span class=\"attr\">xsi:schemaLocation</span>=<span class=\"string\">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">modelVersion</span>&gt;</span>4.0.0<span class=\"tag\">&lt;/<span class=\"name\">modelVersion</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>io.github.hanqunfeng<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>aws-s3-v2-tools<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.0.1<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">packaging</span>&gt;</span>jar<span class=\"tag\">&lt;/<span class=\"name\">packaging</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">name</span>&gt;</span>aws-s3-v2-tools<span class=\"tag\">&lt;/<span class=\"name\">name</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">description</span>&gt;</span></span><br><span class=\"line\">        AWS S3 Tools.</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">description</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">url</span>&gt;</span>https://blog.hanqunfeng.com<span class=\"tag\">&lt;/<span class=\"name\">url</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">licenses</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">license</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">name</span>&gt;</span>The Apache License, Version 2.0<span class=\"tag\">&lt;/<span class=\"name\">name</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">url</span>&gt;</span>http://www.apache.org/licenses/LICENSE-2.0.txt<span class=\"tag\">&lt;/<span class=\"name\">url</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">license</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">licenses</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">developers</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">developer</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">id</span>&gt;</span>hanqf<span class=\"tag\">&lt;/<span class=\"name\">id</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">name</span>&gt;</span>hanqunfeng<span class=\"tag\">&lt;/<span class=\"name\">name</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">email</span>&gt;</span>qunfeng_han@126.com<span class=\"tag\">&lt;/<span class=\"name\">email</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">developer</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">developers</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">scm</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">connection</span>&gt;</span>scm:git:https://github.com/hanqunfeng/aws-s3-v2-tools.git</span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">connection</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">developerConnection</span>&gt;</span></span><br><span class=\"line\">            scm:git:https://github.com:hanqunfeng/aws-s3-v2-tools.git</span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">developerConnection</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">url</span>&gt;</span>https://github.com/hanqunfeng/aws-s3-v2-tools<span class=\"tag\">&lt;/<span class=\"name\">url</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">scm</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">properties</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">java.version</span>&gt;</span>1.8<span class=\"tag\">&lt;/<span class=\"name\">java.version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">maven.compiler.source</span>&gt;</span>8<span class=\"tag\">&lt;/<span class=\"name\">maven.compiler.source</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">maven.compiler.target</span>&gt;</span>8<span class=\"tag\">&lt;/<span class=\"name\">maven.compiler.target</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class=\"tag\">&lt;/<span class=\"name\">project.build.sourceEncoding</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">properties</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">dependencyManagement</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependencies</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>software.amazon.awssdk<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>bom<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.23.10<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">type</span>&gt;</span>pom<span class=\"tag\">&lt;/<span class=\"name\">type</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>import<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependencies</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">dependencyManagement</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">dependencies</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>software.amazon.awssdk<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>s3<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">&lt;!-- ä¸ºé¿å…Potential Conflictsï¼Œä½ åº”è¯¥å°†commons-logging.jarä»classpathä¸­åˆ é™¤ã€‚ä½ å¯ä»¥å°è¯•ä»é¡¹ç›®ä¾èµ–ä¸­æ’é™¤commons-loggingï¼Œè¿™æ ·ä½ çš„åº”ç”¨ç¨‹åºå°±ä¼šè¢«å¼ºåˆ¶ä½¿ç”¨Spring JCLè€Œä¸æ˜¯Commons Loggingã€‚ --&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">&lt;!-- é—®é¢˜ï¼šStandard Commons Logging discovery in action with spring-jcl: please remove commons-logging.jar from classpath in order to avoid potential conflicts --&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>software.amazon.awssdk<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>apache-client<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">exclusions</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">exclusion</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>commons-logging<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>commons-logging<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;/<span class=\"name\">exclusion</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">exclusions</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>software.amazon.awssdk<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>s3-transfer-manager<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>software.amazon.awssdk<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>aws-crt-client<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.projectlombok<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>lombok<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">optional</span>&gt;</span>true<span class=\"tag\">&lt;/<span class=\"name\">optional</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.18.32<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-core<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>5.3.29<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">dependencies</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">build</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">plugins</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.maven.plugins<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>maven-compiler-plugin<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>3.8.1<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">configuration</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">source</span>&gt;</span>$&#123;java.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">source</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">target</span>&gt;</span>$&#123;java.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">target</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;/<span class=\"name\">configuration</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.maven.plugins<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>maven-source-plugin<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>3.2.1<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">executions</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">execution</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;<span class=\"name\">id</span>&gt;</span>attach-source<span class=\"tag\">&lt;/<span class=\"name\">id</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;<span class=\"name\">phase</span>&gt;</span>verify<span class=\"tag\">&lt;/<span class=\"name\">phase</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;<span class=\"name\">goals</span>&gt;</span></span><br><span class=\"line\">                            <span class=\"comment\">&lt;!--ç”Ÿæˆæºä»£ç çš„jar --&gt;</span></span><br><span class=\"line\">                            <span class=\"tag\">&lt;<span class=\"name\">goal</span>&gt;</span>jar<span class=\"tag\">&lt;/<span class=\"name\">goal</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;/<span class=\"name\">goals</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;/<span class=\"name\">execution</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;/<span class=\"name\">executions</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.maven.plugins<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>maven-javadoc-plugin<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>3.2.0<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">executions</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">execution</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;<span class=\"name\">id</span>&gt;</span>attach-javadoc<span class=\"tag\">&lt;/<span class=\"name\">id</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;<span class=\"name\">phase</span>&gt;</span>verify<span class=\"tag\">&lt;/<span class=\"name\">phase</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;<span class=\"name\">goals</span>&gt;</span></span><br><span class=\"line\">                            <span class=\"comment\">&lt;!--ç”Ÿæˆjavadocçš„jar --&gt;</span></span><br><span class=\"line\">                            <span class=\"tag\">&lt;<span class=\"name\">goal</span>&gt;</span>jar<span class=\"tag\">&lt;/<span class=\"name\">goal</span>&gt;</span></span><br><span class=\"line\">                            <span class=\"comment\">&lt;!--ç”Ÿæˆjavadocçš„html --&gt;</span></span><br><span class=\"line\">                            <span class=\"tag\">&lt;<span class=\"name\">goal</span>&gt;</span>javadoc<span class=\"tag\">&lt;/<span class=\"name\">goal</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;/<span class=\"name\">goals</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;<span class=\"name\">configuration</span>&gt;</span></span><br><span class=\"line\">                            <span class=\"comment\">&lt;!--ä¸æ˜¾ç¤ºjavadocè­¦å‘Š--&gt;</span></span><br><span class=\"line\">                            <span class=\"tag\">&lt;<span class=\"name\">additionalOptions</span>&gt;</span>-Xdoclint:none<span class=\"tag\">&lt;/<span class=\"name\">additionalOptions</span>&gt;</span></span><br><span class=\"line\">                            <span class=\"tag\">&lt;<span class=\"name\">additionalJOption</span>&gt;</span>-Xdoclint:none<span class=\"tag\">&lt;/<span class=\"name\">additionalJOption</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;/<span class=\"name\">configuration</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;/<span class=\"name\">execution</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;/<span class=\"name\">executions</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">&lt;!-- gpg plugin,ç”¨äºç­¾åè®¤è¯ --&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.maven.plugins<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>maven-gpg-plugin<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.6<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">executions</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">execution</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;<span class=\"name\">id</span>&gt;</span>sign-artifacts<span class=\"tag\">&lt;/<span class=\"name\">id</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;<span class=\"name\">phase</span>&gt;</span>verify<span class=\"tag\">&lt;/<span class=\"name\">phase</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;<span class=\"name\">goals</span>&gt;</span></span><br><span class=\"line\">                            <span class=\"tag\">&lt;<span class=\"name\">goal</span>&gt;</span>sign<span class=\"tag\">&lt;/<span class=\"name\">goal</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;/<span class=\"name\">goals</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;/<span class=\"name\">execution</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;/<span class=\"name\">executions</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">&lt;!-- å‘å¸ƒåˆ°ç§æœæ—¶éœ€è¦æ³¨é‡Šæ‰ä¸‹é¢ä¸¤ä¸ªæ’ä»¶ --&gt;</span></span><br><span class=\"line\">            <span class=\"comment\">&lt;!--staging puglin,ç”¨äºè‡ªåŠ¨æ‰§è¡Œå‘å¸ƒé˜¶æ®µ(å…æ‰‹åŠ¨)--&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.sonatype.central<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>central-publishing-maven-plugin<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>0.5.0<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">extensions</span>&gt;</span>true<span class=\"tag\">&lt;/<span class=\"name\">extensions</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">configuration</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"comment\">&lt;!-- è¿™é‡Œçš„publishingServerIdæ˜¯åœ¨settings.xmlä¸­é…ç½®çš„serverè®¤è¯ä¿¡æ¯ --&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">publishingServerId</span>&gt;</span>maven-central<span class=\"tag\">&lt;/<span class=\"name\">publishingServerId</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"comment\">&lt;!-- è¿™é‡Œçš„autoPublishæ˜¯è‡ªåŠ¨å‘å¸ƒï¼Œè€Œä¸æ˜¯æ‰‹åŠ¨å‘å¸ƒ --&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">autoPublish</span>&gt;</span>true<span class=\"tag\">&lt;/<span class=\"name\">autoPublish</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"comment\">&lt;!-- è¿™é‡Œçš„waitUntilé…ç½®ä¸ºpublishedæ˜¯ç­‰å¾…å‘å¸ƒå®Œæˆï¼Œå› ä¸ºå‘å¸ƒå®Œæˆçš„æ—¶é—´æ¯”è¾ƒé•¿ï¼Œæ‰€ä»¥å¯ä»¥ä¸åŠ è¿™ä¸ªå‚æ•° --&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">waitUntil</span>&gt;</span>published<span class=\"tag\">&lt;/<span class=\"name\">waitUntil</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"comment\">&lt;!-- è¿™é‡Œçš„deploymentNameæ˜¯å‘å¸ƒåˆ°ä¸­å¤®ä»“åº“çš„åç§° --&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">deploymentName</span>&gt;</span>$&#123;project.groupId&#125;:$&#123;project.artifactId&#125;:$&#123;project.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">deploymentName</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;/<span class=\"name\">configuration</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">            <span class=\"comment\">&lt;!-- release plugin,ç”¨äºå‘å¸ƒåˆ°releaseä»“åº“éƒ¨ç½²æ’ä»¶ --&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.maven.plugins<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>maven-release-plugin<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.5.3<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">plugins</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">build</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">distributionManagement</span>&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">&lt;!--        &lt;repository&gt;--&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">&lt;!--            &lt;id&gt;maven-releases&lt;/id&gt;--&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">&lt;!--            &lt;name&gt;Nexus Release Repository&lt;/name&gt;--&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">&lt;!--            &lt;url&gt;http://nexus.cxzh.ltd:8081/repository/maven-releases/&lt;/url&gt;--&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">&lt;!--        &lt;/repository&gt;--&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">&lt;!--        &lt;snapshotRepository&gt;--&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">&lt;!--            &lt;id&gt;maven-snapshots&lt;/id&gt;--&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">&lt;!--            &lt;name&gt;Nexus Snapshot Repository&lt;/name&gt;--&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">&lt;!--            &lt;url&gt;http://nexus.cxzh.ltd:8081/repository/maven-snapshots/&lt;/url&gt;--&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">&lt;!--        &lt;/snapshotRepository&gt;--&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">distributionManagement</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">project</span>&gt;</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>4.æ‰§è¡Œå‘½ä»¤</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mvn clean package <span class=\"comment\"># å®Œæˆæ‰“åŒ…å’Œæµ‹è¯•</span></span><br><span class=\"line\">mvn clean verify  <span class=\"comment\"># å®Œæˆæºç æ‰“åŒ…å’Œjavadocæ‰“åŒ…ï¼ŒåŒæ—¶å®Œæˆç­¾å</span></span><br><span class=\"line\">mvn clean deploy  <span class=\"comment\"># å®Œæˆæœ¬åœ°éƒ¨ç½²å’Œmavenä¸­å¤®ä»“åº“éƒ¨ç½²</span></span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>4.1 æ‰§è¡Œè¿‡ç¨‹ä¸­ä¼šæç¤ºä½ è¾“å…¥åˆ›å»ºå¯†é’¥å¯¹æ—¶çš„å¯†ç ï¼Œå¦‚æœä¸æƒ³äººå·¥å‚ä¸ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å¦‚ä¸‹æ–¹å¼ï¼ˆå‚è€ƒï¼š<a href=\"http://maven.apache.org/plugins/maven-gpg-plugin/usage.html%EF%BC%89\">http://maven.apache.org/plugins/maven-gpg-plugin/usage.htmlï¼‰</a></p>\n</blockquote>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>a.åœ¨æ‰§è¡Œå‘½ä»¤æ—¶æŒ‡å®šå¯†ç ï¼š</p>\n  <figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mvn clean deploy -Dgpg.passphrase=thephrase</span><br></pre></td></tr></table></figure>\n</li>\n<li class=\"lvl-2\">\n<p>b.setting.xmlä¸­åˆ›å»ºä¸€ä¸ªserver</p>\n  <figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">settings</span>&gt;</span></span><br><span class=\"line\">[...]</span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">servers</span>&gt;</span></span><br><span class=\"line\">    [...]</span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">server</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">id</span>&gt;</span>gpg.passphrase<span class=\"tag\">&lt;/<span class=\"name\">id</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">passphrase</span>&gt;</span>clear or encrypted text<span class=\"tag\">&lt;/<span class=\"name\">passphrase</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">server</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">servers</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">settings</span>&gt;</span></span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>6.æ›´æ–°éƒ¨ç½²<br>\nä¿®æ”¹<code>pom.xml</code>ä¸­çš„ç‰ˆæœ¬å·ï¼Œé‡æ–°æ‰§è¡Œ<code>mvn clean deploy</code>å³å¯ã€‚å‘å¸ƒçš„jaråŒ…å¯ä»¥åœ¨<a href=\"https://central.sonatype.com\">https://central.sonatype.com</a>ä¸­æ£€ç´¢ã€‚</p>\n</li>\n</ul>\n","content_text":"æ‘˜è¦ https://oss.sonatype.orgå·²ç»ä¸å†æ”¯æŒæ–°ç”¨æˆ·æ³¨å†Œï¼Œæ–°çš„æ³¨å†Œåœ°å€ä¸ºhttps://central.sonatype.com é€šè¿‡æœ¬æ–‡ï¼Œä½ å°†çŸ¥é“å¦‚ä½•å°†Mavenæ„å»ºçš„é¡¹ç›®å‘å¸ƒåˆ°Mavenä¸­å¤®ä»“åº“ Gradleæ„å»ºæ–¹å¼è¯·çœ‹ å‘å¸ƒJaråˆ°Mavenä¸­å¤®ä»“åº“--Gradleç‰ˆ(æœ€æ–°æ–¹å¼) ã€‚ ä¸€ã€å°†é¡¹ç›®æ¨é€åˆ°è¿œç¨‹ä»“åº“ï¼Œå¦‚ Githubæˆ–è€…Gitee äºŒã€æ³¨å†Œ Sonatype è´¦æˆ· è¿›å…¥ https://central.sonatype.com æ³¨å†Œä¸€ä¸ªè´¦å·ï¼Œé‚®ç®±è¦çœŸå®ã€‚ ä¸‰ã€ç™»å½• Sonatype åˆ›å»ºNamespace è¿›å…¥ Namespace æ¨¡å—ï¼Œç„¶åç‚¹å‡» Add Namespace æŒ‰é’®ï¼ŒNamespace å…·æœ‰å”¯ä¸€æ€§ å‘å¸ƒå‰ä¸€å®šè¦åˆ›å»ºNamespaceï¼Œå®é™…ä¸Šå°±æ˜¯é¡¹ç›®çš„Group Idï¼Œå› ä¸ºè¦è¿›è¡ŒéªŒè¯ï¼Œæ‰€ä»¥è¿™é‡Œä¸èƒ½éšä¾¿å¡«å†™ï¼Œä½ å¯ä»¥é…ç½®ä¸ºä½ æ‹¥æœ‰çš„åŸŸåï¼Œæ¯”å¦‚æˆ‘çš„åŸŸåæ˜¯hanqunfeng.comï¼Œè¿™é‡Œå°±å¡«å†™com.hanqunfengã€‚åŸŸåçš„éªŒè¯æ–¹æ³•æ˜¯é…ç½®DNS TXTè®°å½•ã€‚ å¦‚æœä½ æ²¡æœ‰åŸŸåï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨Githubçš„åŸŸåï¼Œæ¯”å¦‚æˆ‘çš„Githubç”¨æˆ·åæ˜¯hanqunfengï¼Œåˆ™è¿™é‡Œå¯ä»¥é…ç½®ä¸ºio.github.hanqunfengã€‚Githubçš„éªŒè¯æ–¹å¼æ˜¯æ ¹æ®ç»™å®šä¸ªåç§°åˆ›å»ºä¸€ä¸ªpublic repositoryã€‚ å››ã€å‘å¸ƒ 1.å‡†å¤‡ç­¾å å¯ä»¥ä½¿ç”¨å·¥å…·åˆ›å»ºå¯†é’¥å¯¹ éœ€è¦ä¸‹è½½ä¸€ä¸ªç­¾åå·¥å…·ï¼Œæˆ‘æ˜¯macç”µè„‘ï¼Œä¸‹è½½çš„æ˜¯https://gpgtools.orgã€‚ å®‰è£…åç‚¹å‡»æ–°å»ºï¼ŒæŒ‰ç…§æç¤ºåˆ›å»ºä¸€ä¸ªå¯†é’¥å¯¹å³å¯ï¼Œæ³¨æ„é«˜çº§é€‰é¡¹é‡Œæœ‰ä¸ªè¿‡æœŸæ—¶é—´ï¼Œé»˜è®¤æ˜¯3å¹´ã€‚åˆ›å»ºå¥½åä¼šä¸»åŠ¨æç¤ºä½ æ˜¯å¦å°†å…¬é’¥å‘å¸ƒåˆ°key serverï¼Œç‚¹å‡»Upload Public keyå³å¯ã€‚ä¹Ÿå¯ä»¥åœ¨åˆ›å»ºåçš„è¯ä¹¦åˆ—è¡¨é¡µé¢é‚®ä»¶é€‰æ‹©è¯ä¹¦â€“&gt;Send Public Key To Key Serverã€‚ å¯¼å‡ºè¯ä¹¦æ—¶ï¼Œå‹¾é€‰å¯†ç å¹¶è®¾ç½®å¯†ç å°±æ˜¯ç§é’¥å’Œå…¬é’¥è¯ä¹¦ï¼Œä¸å‹¾é€‰å¯†ç å°±æ˜¯å…¬é’¥ï¼Œçœ‹ç”Ÿæˆæ–‡ä»¶çš„åç§°å°±å¯ä»¥ï¼Œå…¬å¼€å°±æ˜¯å…¬é’¥ï¼Œç§å¯†å°±æ˜¯ç§é’¥ï¼Œæ ¼å¼éƒ½æ˜¯ascï¼Œå…¶å®å°±æ˜¯å­—ç¬¦ä¸²ï¼Œå¯ä»¥ç”¨è®°äº‹æœ¬æ‰“å¼€æŸ¥çœ‹ã€‚ å¦‚æœwindowsç³»ç»Ÿï¼Œå¯ä»¥ä¸‹è½½https://www.gpg4win.org/ ï¼Œä½¿ç”¨æ–¹å¼å·®ä¸å¤šï¼Œæœ€åç‚¹å‡»â€œå°†å…¬é’¥ä¸Šä¼ çš„ç›®å½•æœåŠ¡â€ã€‚ å…¬é’¥å‘å¸ƒåˆ°key serveråè¦ç¨å¾®ç­‰ä¸€ä¼šï¼Œå¤§çº¦10åˆ†é’Ÿå§ï¼Œå› ä¸ºkey serveræœ‰å¤šä¸ªï¼ŒåŒæ­¥éœ€è¦ä¸€äº›æ—¶é—´ã€‚ è®°ä½ä½ åˆ›å»ºå¯†é’¥å¯¹æ—¶çš„å¯†ç ï¼Œå‘å¸ƒé¡¹ç›®æ—¶è¦ä½¿ç”¨ã€‚ ä¹Ÿå¯ä»¥ä½¿ç”¨å‘½ä»¤è¡Œåˆ›å»ºå¯†é’¥å¯¹ï¼Œç‰ˆæœ¬[gpg (GnuPG/MacGPG2) 2.2.24] 12345678910111213141516171819202122# åˆ›å»ºå¯†é’¥å¯¹ï¼ŒæŒ‰æç¤ºè¾“å…¥ç”¨æˆ·åç§°å’Œé‚®ç®±åœ°å€gpg --generate-key# åˆ—å‡ºå¯†é’¥ï¼Œhanqunfengå°±æ˜¯åˆ›å»ºå¯†é’¥å¯¹æ˜¯çš„ç”¨æˆ·åï¼Œæ­¤å¤„ä¹Ÿå¯ä»¥ä½¿ç”¨é‚®ç®±# ç»“æœä¸­ç¬¬äºŒè¡Œä¸€é•¿ä¸²çš„å8ä½å°±æ˜¯keyIdï¼Œæ¯”å¦‚ï¼š30FF8D58ï¼Œgradleæ„å»ºæ—¶ä¼šç”¨åˆ°gpg --list-keys hanqunfeng# ä¹Ÿå¯ä»¥ç›´æ¥é€šè¿‡idæŸ¥è¯¢gpg --list-keys 30FF8D58# ä¸Šä¼ å…¬é’¥åˆ°server keyï¼Œé»˜è®¤ä¸Šä¼ åˆ°hkps://keys.openpgp.orgï¼Œä½†æ˜¯æç¤ºä¸Šä¼ å¤±è´¥# çœ‹åˆ°ç½‘ä¸Šçš„ç¤ºä¾‹å¯ä»¥é€šè¿‡--keyserveræŒ‡å®šä¸Šä¼ çš„æœåŠ¡å™¨åœ°å€ï¼Œä½†æ˜¯æˆ‘è¿™ä¸ªç‰ˆæœ¬[gpg (GnuPG/MacGPG2) 2.2.24]æ²¡æœ‰è¿™ä¸ªå‚æ•°# ä½¿ç”¨ https://gpgtools.org ä¸Šä¼ å…¬é’¥å°±ä¼šæˆåŠŸgpg --send-keys 30FF8D58# æŸ¥çœ‹æŒ‡çº¹gpg --fingerprint 30FF8D58# åˆ é™¤ç§é’¥ï¼Œè¿™é‡Œä¹Ÿå¯ä»¥ä½¿ç”¨ç”¨æˆ·åç§°æˆ–è€…é‚®ç®±ï¼Œå¦‚æœå”¯ä¸€çš„è¯gpg --delete-secret-keys 30FF8D58# åˆ é™¤å…¬é’¥gpg --delete-keys 30FF8D58 2.settings.xml é…ç½® maven çš„ settings.xml æ–‡ä»¶ï¼Œè®¾ç½®ä¸€ä¸ª serverï¼Œé‡Œé¢æ·»åŠ  User Tokenã€‚ ç™»å½•https://central.sonatype.comåç‚¹å‡»å³ä¸Šè§’çš„ç”¨æˆ·åç§°â€“&gt; View Account --&gt; Generate User Token 1234567891011&lt;settings&gt; [...] &lt;servers&gt; [...] &lt;server&gt; &lt;id&gt;maven-central&lt;/id&gt; &lt;username&gt;username&lt;/username&gt; &lt;password&gt;token&lt;/password&gt; &lt;/server&gt; &lt;/servers&gt;&lt;/settings&gt; 3.pom.xmlï¼Œé‡ç‚¹æ˜¯åé¢å‡ ä¸ªplugin è¿™é‡Œé‡ç‚¹è¯´ä¸€ä¸‹central-publishing-maven-pluginè¿™ä¸ªæ’ä»¶ï¼Œè¯¥æ’ä»¶ä¼šå°†jaråŒ…æ¨é€åˆ°Maven Centralä»“åº“ï¼Œå¦‚æœæ’ä»¶æ²¡æœ‰é…ç½®å‚æ•°autoPublishä¸ºtrueï¼Œåˆ™ä½†æ­¤æ—¶å‘å¸ƒçš„jarä¼šå¤„äºVALIDATEDçŠ¶æ€ï¼Œéœ€è¦ç™»å½•https://central.sonatype.comååˆ‡æ¢åˆ°Deploymentï¼Œæ‰¾åˆ°æˆ‘ä»¬åˆšåˆšä¸Šä¼ çš„åŒ…åï¼Œç„¶åç‚¹å‡»å³ä¾§çš„PublishæŒ‰é’®ï¼Œå¦‚æœä¸€åˆ‡é¡ºåˆ©ï¼Œå¤§äº10åˆ†é’Ÿåå…¶çŠ¶æ€å˜ä¸ºPUBLISHEDï¼Œè¡¨ç¤ºå‘å¸ƒæˆåŠŸã€‚å¦‚æœå‘å¸ƒå¤±è´¥ï¼Œå…¶çŠ¶æ€ä¼šå˜æ›´ä¸ºFAILEDï¼Œå¯ä»¥åœ¨Component Summaryä¸­æŸ¥çœ‹å¤±è´¥åŸå› ï¼Œé‡æ–°å‘å¸ƒå³å¯ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;groupId&gt;io.github.hanqunfeng&lt;/groupId&gt; &lt;artifactId&gt;aws-s3-v2-tools&lt;/artifactId&gt; &lt;version&gt;1.0.1&lt;/version&gt; &lt;packaging&gt;jar&lt;/packaging&gt; &lt;name&gt;aws-s3-v2-tools&lt;/name&gt; &lt;description&gt; AWS S3 Tools. &lt;/description&gt; &lt;url&gt;https://blog.hanqunfeng.com&lt;/url&gt; &lt;licenses&gt; &lt;license&gt; &lt;name&gt;The Apache License, Version 2.0&lt;/name&gt; &lt;url&gt;http://www.apache.org/licenses/LICENSE-2.0.txt&lt;/url&gt; &lt;/license&gt; &lt;/licenses&gt; &lt;developers&gt; &lt;developer&gt; &lt;id&gt;hanqf&lt;/id&gt; &lt;name&gt;hanqunfeng&lt;/name&gt; &lt;email&gt;qunfeng_han@126.com&lt;/email&gt; &lt;/developer&gt; &lt;/developers&gt; &lt;scm&gt; &lt;connection&gt;scm:git:https://github.com/hanqunfeng/aws-s3-v2-tools.git &lt;/connection&gt; &lt;developerConnection&gt; scm:git:https://github.com:hanqunfeng/aws-s3-v2-tools.git &lt;/developerConnection&gt; &lt;url&gt;https://github.com/hanqunfeng/aws-s3-v2-tools&lt;/url&gt; &lt;/scm&gt; &lt;properties&gt; &lt;java.version&gt;1.8&lt;/java.version&gt; &lt;maven.compiler.source&gt;8&lt;/maven.compiler.source&gt; &lt;maven.compiler.target&gt;8&lt;/maven.compiler.target&gt; &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt; &lt;/properties&gt; &lt;dependencyManagement&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;software.amazon.awssdk&lt;/groupId&gt; &lt;artifactId&gt;bom&lt;/artifactId&gt; &lt;version&gt;2.23.10&lt;/version&gt; &lt;type&gt;pom&lt;/type&gt; &lt;scope&gt;import&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/dependencyManagement&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;software.amazon.awssdk&lt;/groupId&gt; &lt;artifactId&gt;s3&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!-- ä¸ºé¿å…Potential Conflictsï¼Œä½ åº”è¯¥å°†commons-logging.jarä»classpathä¸­åˆ é™¤ã€‚ä½ å¯ä»¥å°è¯•ä»é¡¹ç›®ä¾èµ–ä¸­æ’é™¤commons-loggingï¼Œè¿™æ ·ä½ çš„åº”ç”¨ç¨‹åºå°±ä¼šè¢«å¼ºåˆ¶ä½¿ç”¨Spring JCLè€Œä¸æ˜¯Commons Loggingã€‚ --&gt; &lt;!-- é—®é¢˜ï¼šStandard Commons Logging discovery in action with spring-jcl: please remove commons-logging.jar from classpath in order to avoid potential conflicts --&gt; &lt;dependency&gt; &lt;groupId&gt;software.amazon.awssdk&lt;/groupId&gt; &lt;artifactId&gt;apache-client&lt;/artifactId&gt; &lt;exclusions&gt; &lt;exclusion&gt; &lt;groupId&gt;commons-logging&lt;/groupId&gt; &lt;artifactId&gt;commons-logging&lt;/artifactId&gt; &lt;/exclusion&gt; &lt;/exclusions&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;software.amazon.awssdk&lt;/groupId&gt; &lt;artifactId&gt;s3-transfer-manager&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;software.amazon.awssdk&lt;/groupId&gt; &lt;artifactId&gt;aws-crt-client&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;version&gt;1.18.32&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework&lt;/groupId&gt; &lt;artifactId&gt;spring-core&lt;/artifactId&gt; &lt;version&gt;5.3.29&lt;/version&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;build&gt; &lt;plugins&gt; &lt;plugin&gt; &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt; &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt; &lt;version&gt;3.8.1&lt;/version&gt; &lt;configuration&gt; &lt;source&gt;$&#123;java.version&#125;&lt;/source&gt; &lt;target&gt;$&#123;java.version&#125;&lt;/target&gt; &lt;/configuration&gt; &lt;/plugin&gt; &lt;plugin&gt; &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt; &lt;artifactId&gt;maven-source-plugin&lt;/artifactId&gt; &lt;version&gt;3.2.1&lt;/version&gt; &lt;executions&gt; &lt;execution&gt; &lt;id&gt;attach-source&lt;/id&gt; &lt;phase&gt;verify&lt;/phase&gt; &lt;goals&gt; &lt;!--ç”Ÿæˆæºä»£ç çš„jar --&gt; &lt;goal&gt;jar&lt;/goal&gt; &lt;/goals&gt; &lt;/execution&gt; &lt;/executions&gt; &lt;/plugin&gt; &lt;plugin&gt; &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt; &lt;artifactId&gt;maven-javadoc-plugin&lt;/artifactId&gt; &lt;version&gt;3.2.0&lt;/version&gt; &lt;executions&gt; &lt;execution&gt; &lt;id&gt;attach-javadoc&lt;/id&gt; &lt;phase&gt;verify&lt;/phase&gt; &lt;goals&gt; &lt;!--ç”Ÿæˆjavadocçš„jar --&gt; &lt;goal&gt;jar&lt;/goal&gt; &lt;!--ç”Ÿæˆjavadocçš„html --&gt; &lt;goal&gt;javadoc&lt;/goal&gt; &lt;/goals&gt; &lt;configuration&gt; &lt;!--ä¸æ˜¾ç¤ºjavadocè­¦å‘Š--&gt; &lt;additionalOptions&gt;-Xdoclint:none&lt;/additionalOptions&gt; &lt;additionalJOption&gt;-Xdoclint:none&lt;/additionalJOption&gt; &lt;/configuration&gt; &lt;/execution&gt; &lt;/executions&gt; &lt;/plugin&gt; &lt;!-- gpg plugin,ç”¨äºç­¾åè®¤è¯ --&gt; &lt;plugin&gt; &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt; &lt;artifactId&gt;maven-gpg-plugin&lt;/artifactId&gt; &lt;version&gt;1.6&lt;/version&gt; &lt;executions&gt; &lt;execution&gt; &lt;id&gt;sign-artifacts&lt;/id&gt; &lt;phase&gt;verify&lt;/phase&gt; &lt;goals&gt; &lt;goal&gt;sign&lt;/goal&gt; &lt;/goals&gt; &lt;/execution&gt; &lt;/executions&gt; &lt;/plugin&gt; &lt;!-- å‘å¸ƒåˆ°ç§æœæ—¶éœ€è¦æ³¨é‡Šæ‰ä¸‹é¢ä¸¤ä¸ªæ’ä»¶ --&gt; &lt;!--staging puglin,ç”¨äºè‡ªåŠ¨æ‰§è¡Œå‘å¸ƒé˜¶æ®µ(å…æ‰‹åŠ¨)--&gt; &lt;plugin&gt; &lt;groupId&gt;org.sonatype.central&lt;/groupId&gt; &lt;artifactId&gt;central-publishing-maven-plugin&lt;/artifactId&gt; &lt;version&gt;0.5.0&lt;/version&gt; &lt;extensions&gt;true&lt;/extensions&gt; &lt;configuration&gt; &lt;!-- è¿™é‡Œçš„publishingServerIdæ˜¯åœ¨settings.xmlä¸­é…ç½®çš„serverè®¤è¯ä¿¡æ¯ --&gt; &lt;publishingServerId&gt;maven-central&lt;/publishingServerId&gt; &lt;!-- è¿™é‡Œçš„autoPublishæ˜¯è‡ªåŠ¨å‘å¸ƒï¼Œè€Œä¸æ˜¯æ‰‹åŠ¨å‘å¸ƒ --&gt; &lt;autoPublish&gt;true&lt;/autoPublish&gt; &lt;!-- è¿™é‡Œçš„waitUntilé…ç½®ä¸ºpublishedæ˜¯ç­‰å¾…å‘å¸ƒå®Œæˆï¼Œå› ä¸ºå‘å¸ƒå®Œæˆçš„æ—¶é—´æ¯”è¾ƒé•¿ï¼Œæ‰€ä»¥å¯ä»¥ä¸åŠ è¿™ä¸ªå‚æ•° --&gt; &lt;waitUntil&gt;published&lt;/waitUntil&gt; &lt;!-- è¿™é‡Œçš„deploymentNameæ˜¯å‘å¸ƒåˆ°ä¸­å¤®ä»“åº“çš„åç§° --&gt; &lt;deploymentName&gt;$&#123;project.groupId&#125;:$&#123;project.artifactId&#125;:$&#123;project.version&#125;&lt;/deploymentName&gt; &lt;/configuration&gt; &lt;/plugin&gt; &lt;!-- release plugin,ç”¨äºå‘å¸ƒåˆ°releaseä»“åº“éƒ¨ç½²æ’ä»¶ --&gt; &lt;plugin&gt; &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt; &lt;artifactId&gt;maven-release-plugin&lt;/artifactId&gt; &lt;version&gt;2.5.3&lt;/version&gt; &lt;/plugin&gt; &lt;/plugins&gt; &lt;/build&gt; &lt;distributionManagement&gt; &lt;!-- &lt;repository&gt;--&gt; &lt;!-- &lt;id&gt;maven-releases&lt;/id&gt;--&gt; &lt;!-- &lt;name&gt;Nexus Release Repository&lt;/name&gt;--&gt; &lt;!-- &lt;url&gt;http://nexus.cxzh.ltd:8081/repository/maven-releases/&lt;/url&gt;--&gt; &lt;!-- &lt;/repository&gt;--&gt; &lt;!-- &lt;snapshotRepository&gt;--&gt; &lt;!-- &lt;id&gt;maven-snapshots&lt;/id&gt;--&gt; &lt;!-- &lt;name&gt;Nexus Snapshot Repository&lt;/name&gt;--&gt; &lt;!-- &lt;url&gt;http://nexus.cxzh.ltd:8081/repository/maven-snapshots/&lt;/url&gt;--&gt; &lt;!-- &lt;/snapshotRepository&gt;--&gt; &lt;/distributionManagement&gt;&lt;/project&gt; 4.æ‰§è¡Œå‘½ä»¤ 123mvn clean package # å®Œæˆæ‰“åŒ…å’Œæµ‹è¯•mvn clean verify # å®Œæˆæºç æ‰“åŒ…å’Œjavadocæ‰“åŒ…ï¼ŒåŒæ—¶å®Œæˆç­¾åmvn clean deploy # å®Œæˆæœ¬åœ°éƒ¨ç½²å’Œmavenä¸­å¤®ä»“åº“éƒ¨ç½² 4.1 æ‰§è¡Œè¿‡ç¨‹ä¸­ä¼šæç¤ºä½ è¾“å…¥åˆ›å»ºå¯†é’¥å¯¹æ—¶çš„å¯†ç ï¼Œå¦‚æœä¸æƒ³äººå·¥å‚ä¸ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å¦‚ä¸‹æ–¹å¼ï¼ˆå‚è€ƒï¼šhttp://maven.apache.org/plugins/maven-gpg-plugin/usage.htmlï¼‰ a.åœ¨æ‰§è¡Œå‘½ä»¤æ—¶æŒ‡å®šå¯†ç ï¼š 1mvn clean deploy -Dgpg.passphrase=thephrase b.setting.xmlä¸­åˆ›å»ºä¸€ä¸ªserver 12345678910&lt;settings&gt;[...]&lt;servers&gt; [...] &lt;server&gt; &lt;id&gt;gpg.passphrase&lt;/id&gt; &lt;passphrase&gt;clear or encrypted text&lt;/passphrase&gt; &lt;/server&gt;&lt;/servers&gt;&lt;/settings&gt; 6.æ›´æ–°éƒ¨ç½² ä¿®æ”¹pom.xmlä¸­çš„ç‰ˆæœ¬å·ï¼Œé‡æ–°æ‰§è¡Œmvn clean deployå³å¯ã€‚å‘å¸ƒçš„jaråŒ…å¯ä»¥åœ¨https://central.sonatype.comä¸­æ£€ç´¢ã€‚","summary":"æ‘˜è¦ https://oss.sonatype.orgå·²ç»ä¸å†æ”¯æŒæ–°ç”¨æˆ·æ³¨å†Œï¼Œæ–°çš„æ³¨å†Œåœ°å€ä¸ºhttps://central.sonatype.com é€šè¿‡æœ¬æ–‡ï¼Œä½ å°†çŸ¥é“å¦‚ä½•å°†Mavenæ„å»ºçš„é¡¹ç›®å‘å¸ƒåˆ°Mavenä¸­å¤®ä»“åº“ Gradleæ„å»ºæ–¹å¼è¯·çœ‹ å‘å¸ƒJaråˆ°Mavenä¸­å¤®ä»“åº“--Gradleç‰ˆ(æœ€æ–°æ–¹å¼) ã€‚","date_published":"2024-08-01T13:30:05.000Z","tags":["æŠ€æœ¯","maven","maven"]},{"id":"https://blog.hanqunfeng.com/2024/05/08/mysql8-upgrade/","url":"https://blog.hanqunfeng.com/2024/05/08/mysql8-upgrade/","title":"MySql--ä»Mysql5.7å‡çº§åˆ°Mysql8","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>MySqlçŸ¥è¯†ç‚¹ä»‹ç»:ä»Mysql5.7å‡çº§åˆ°Mysql8</p>\n</li>\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡åŸºäº<code>mysql-8.0.30</code>ï¼Œ<a href=\"https://dev.mysql.com/doc/refman/8.0/en/\">https://dev.mysql.com/doc/refman/8.0/en/</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>2024-04-30ï¼Œ<a href=\"https://dev.mysql.com/doc/relnotes/mysql/8.4/en/news-8-4-0.html\">mysql-8.4.0 LTS</a>ç‰ˆæœ¬å‘å¸ƒï¼Œæœ¬æ–‡åœ¨å°†mysqlä»5.7.44å‡çº§åˆ°8.0.30çš„åŸºç¡€ä¸Šï¼Œå‡çº§åˆ°8.4.0 LTSç‰ˆæœ¬ã€‚<a href=\"https://dev.mysql.com/doc/refman/8.4/en/\">mysql-8.4.0 LTSå®˜æ–¹æ–‡æ¡£</a></p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"ä»Mysql5-7å‡çº§åˆ°Mysql8\">ä»Mysql5.7å‡çº§åˆ°Mysql8</h2>\n<p><em><strong>å‡çº§å‰ï¼Œè¯·å…ˆå¤‡ä»½æ•°æ®åº“ï¼Œé˜²æ­¢å‡çº§å¤±è´¥</strong></em></p>\n<h3 id=\"mysqlsh\">mysqlsh</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åœ¨mysql8ä»¥å‰ï¼Œå‡çº§mysqlè¿˜æ˜¯æ¯”è¾ƒéº»çƒ¦çš„ï¼Œé™¤äº†è¦å¤„ç†ä¸å…¼å®¹çš„å‚æ•°å’Œè¯­æ³•å¤–ï¼Œè€Œä¸”ä¸æ”¯æŒè·¨ç‰ˆæœ¬çš„å‡çº§ï¼Œæ¯”å¦‚5.5å¿…é¡»å…ˆå‡çº§åˆ°5.6ï¼Œç„¶åå†å‡çº§åˆ°5.7ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><code>mysqlsh</code>æ˜¯mysqlå®˜æ–¹æä¾›çš„ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼Œæ˜¯MySQLçš„é«˜çº§å®¢æˆ·ç«¯å’Œä»£ç ç¼–è¾‘å™¨ã€‚å…¶ä¸ä»…å¯ä»¥åƒä½¿ç”¨<code>mysql</code>å‘½ä»¤ä¸€æ ·æ‰§è¡Œsqlï¼Œè€Œä¸”è¿˜æ”¯æŒjsè„šæœ¬ã€pythonè„šæœ¬ï¼Œç­‰ç­‰ï¼Œå…·ä½“å¯ä»¥æŸ¥çœ‹<a href=\"https://dev.mysql.com/doc/mysql-shell/8.0/en/mysql-shell-commands.html\">å®˜ç½‘</a>ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><code>mysqlsh</code>çš„ä¼—å¤šåŠŸèƒ½ä¹‹ä¸€å°±æ˜¯å¯ä»¥æ£€æµ‹å½“å‰ç‰ˆæœ¬æ˜¯å¦å¯ä»¥å‡çº§åˆ°ä¸å½“å‰<code>mysqlsh</code>ç›¸åŒçš„ç‰ˆæœ¬ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å¦‚æœä½ å½“å‰çš„ç‰ˆæœ¬æ˜¯5.6ï¼Œä½ ç”šè‡³éƒ½ä¸éœ€è¦å…ˆå°†æ•°æ®åº“å‡çº§åˆ°5.7å°±å¯ä»¥ç›´æ¥å‡çº§åˆ°8.0ï¼Œå› ä¸ºmysql8.0æ”¯æŒmysql5.5åˆ°mysql8.0çš„å‡çº§ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://dev.mysql.com/doc/mysql-shell/8.0/en/\">mysqlshå®˜æ–¹æ–‡æ¡£</a></p>\n</li>\n</ul>\n<h4 id=\"å®‰è£…mysqlsh\">å®‰è£…mysqlsh</h4>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><a href=\"https://dev.mysql.com/downloads/shell/\">å®˜ç½‘ä¸‹è½½åœ°å€</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>é€‰æ‹©éœ€è¦çš„ç‰ˆæœ¬è¿›è¡Œä¸‹è½½ï¼Œæˆ‘è¿™é‡Œé€‰æ‹©ä¸‹è½½çš„ç‰ˆæœ¬æ˜¯<a href=\"https://downloads.mysql.com/archives/get/p/43/file/mysql-shell-8.0.30-linux-glibc2.12-x86-64bit.tar.gz\">linuxçš„8.0.30ç‰ˆæœ¬</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>ä¸‹è½½åè§£å‹å³å¯</p>\n</li>\n</ul>\n<h4 id=\"æ£€æŸ¥æ˜¯å¦å¯ä»¥å‡çº§\">æ£€æŸ¥æ˜¯å¦å¯ä»¥å‡çº§</h4>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><a href=\"https://dev.mysql.com/doc/mysql-shell/8.0/en/mysql-shell-utilities-upgrade.html\">å®˜ç½‘è¯´æ˜</a></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># mysqlsh8.4ä»¥å‰å¯ä»¥ä½¿ç”¨å¦‚ä¸‹æ–¹æ³•ï¼Œå› ä¸ºå…¶é»˜è®¤å°±æ˜¯æ‰§è¡Œjsä»£ç </span></span><br><span class=\"line\">./mysqlsh username:password@host -e <span class=\"string\">&quot;util.checkForServerUpgrade()&quot;</span></span><br><span class=\"line\"><span class=\"comment\"># mysqlsh8.4åé»˜è®¤æ‰§è¡Œçš„æ˜¯sqlä»£ç ï¼Œæ‰€ä»¥è¦å…ˆç™»å½•ï¼Œåˆ‡æ¢åˆ°jsç¯å¢ƒåå†è¿è¡Œä¸Šé¢çš„ä»£ç </span></span><br><span class=\"line\"><span class=\"comment\"># ç™»å½•</span></span><br><span class=\"line\">./mysqlsh username:password@host</span><br><span class=\"line\"> MySQL  localhost  SQL  &gt; \\js</span><br><span class=\"line\">Switching to JavaScript mode...</span><br><span class=\"line\"> MySQL  localhost  JS  &gt; util.checkForServerUpgrade()</span><br><span class=\"line\"> â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦</span><br><span class=\"line\"> <span class=\"comment\"># é€€å‡º</span></span><br><span class=\"line\"> MySQL  localhost  JS &gt; \\q</span><br><span class=\"line\">Bye!</span><br></pre></td></tr></table></figure>\n<h4 id=\"æ£€æŸ¥è¾“å‡ºä¿¡æ¯è¯´æ˜\">æ£€æŸ¥è¾“å‡ºä¿¡æ¯è¯´æ˜</h4>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">WARNING: Using a password on the <span class=\"built_in\">command</span> line interface can be insecure.</span><br><span class=\"line\">The MySQL server at</span><br><span class=\"line\">localhost:3306, version</span><br><span class=\"line\">5.7.44-<span class=\"built_in\">log</span> - Please upgrade to 8.0 or opt-in to the paid RDS Extended Support</span><br><span class=\"line\">service before 5.7 reaches end of standard support on 29 February, 2024:</span><br><span class=\"line\">https://a.co/hQqiIn0, will now be checked <span class=\"keyword\">for</span> compatibility issues <span class=\"keyword\">for</span> upgrade</span><br><span class=\"line\">to MySQL 8.0.30...</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ—§æ—¶é—´ç±»å‹çš„ä½¿ç”¨</span></span><br><span class=\"line\">1) Usage of old temporal <span class=\"built_in\">type</span></span><br><span class=\"line\">  No issues found</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ä½¿ç”¨ä¸æ–°ä¿ç•™å…³é”®å­—å†²çªçš„æ•°æ®åº“å¯¹è±¡åç§°</span></span><br><span class=\"line\">2) Usage of db objects with names conflicting with new reserved keywords</span><br><span class=\"line\">  No issues found</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ä½¿ç”¨utf8mb3å­—ç¬¦é›†</span></span><br><span class=\"line\">3) Usage of utf8mb3 charset</span><br><span class=\"line\">  Warning: The following objects use the utf8mb3 character <span class=\"built_in\">set</span>. It is</span><br><span class=\"line\">    recommended to convert them to use utf8mb4 instead, <span class=\"keyword\">for</span> improved Unicode</span><br><span class=\"line\">    support.</span><br><span class=\"line\">  More information:</span><br><span class=\"line\">    https://dev.mysql.com/doc/refman/8.0/en/charset-unicode-utf8mb3.html</span><br><span class=\"line\"></span><br><span class=\"line\">  mydb - schema<span class=\"string\">&#x27;s default character set: utf8</span></span><br><span class=\"line\"><span class=\"string\">  mysql - schema&#x27;</span>s default character <span class=\"built_in\">set</span>: utf8</span><br><span class=\"line\">  mydb.tbl_info_i.a_product - column<span class=\"string\">&#x27;s default character set: utf8</span></span><br><span class=\"line\"><span class=\"string\">  mydb.tbl_info_i.a_country - column&#x27;</span>s default character <span class=\"built_in\">set</span>: utf8</span><br><span class=\"line\">  mydb.tbl_info_i.a_version - column<span class=\"string\">&#x27;s default character set: utf8</span></span><br><span class=\"line\"><span class=\"string\">  mydb.tbl_info_i.a_placement - column&#x27;</span>s default character <span class=\"built_in\">set</span>: utf8</span><br><span class=\"line\">â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># MySQLæ¨¡å¼ä¸­çš„è¡¨åä¸8.0ä¸­çš„æ–°è¡¨å†²çª</span></span><br><span class=\"line\">4) Table names <span class=\"keyword\">in</span> the mysql schema conflicting with new tables <span class=\"keyword\">in</span> 8.0</span><br><span class=\"line\">  No issues found</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ä½¿ç”¨éæœ¬æœºåˆ†åŒºå¼•æ“çš„åˆ†åŒºè¡¨</span></span><br><span class=\"line\">5) Partitioned tables using engines with non native partitioning</span><br><span class=\"line\">  No issues found</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å¤–é”®çº¦æŸåç§°è¶…è¿‡64ä¸ªå­—ç¬¦</span></span><br><span class=\"line\">6) Foreign key constraint names longer than 64 characters</span><br><span class=\"line\">  No issues found</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ä½¿ç”¨è¿‡æ—¶çš„MAXDB sql_modeæ ‡å¿—</span></span><br><span class=\"line\">7) Usage of obsolete MAXDB sql_mode flag</span><br><span class=\"line\">  No issues found</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ä½¿ç”¨è¿‡æ—¶çš„sql_modeæ ‡å¿—</span></span><br><span class=\"line\">8) Usage of obsolete sql_mode flags</span><br><span class=\"line\">  No issues found</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ENUM/SETåˆ—å®šä¹‰åŒ…å«è¶…è¿‡255ä¸ªå­—ç¬¦çš„å…ƒç´ </span></span><br><span class=\"line\">9) ENUM/SET column definitions containing elements longer than 255 characters</span><br><span class=\"line\">  No issues found</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åœ¨å…±äº«è¡¨ç©ºé—´ä¸­ä½¿ç”¨åˆ†åŒºè¡¨</span></span><br><span class=\"line\">10) Usage of partitioned tables <span class=\"keyword\">in</span> shared tablespaces</span><br><span class=\"line\">  No issues found</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># è¡¨ç©ºé—´æ•°æ®æ–‡ä»¶è·¯å¾„ä¸­çš„å¾ªç¯ç›®å½•å¼•ç”¨</span></span><br><span class=\"line\">11) Circular directory references <span class=\"keyword\">in</span> tablespace data file paths</span><br><span class=\"line\">  No issues found</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ä½¿ç”¨å·²åˆ é™¤çš„å‡½æ•°</span></span><br><span class=\"line\">12) Usage of removed <span class=\"built_in\">functions</span></span><br><span class=\"line\">  No issues found</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ä½¿ç”¨å·²åˆ é™¤çš„GROUP BY ASC/DESCè¯­æ³•</span></span><br><span class=\"line\">13) Usage of removed GROUP BY ASC/DESC syntax</span><br><span class=\"line\">  No issues found</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å·²åˆ é™¤çš„ç”¨äºé”™è¯¯æ—¥å¿—è®°å½•åˆ°ç³»ç»Ÿæ—¥å¿—é…ç½®çš„ç³»ç»Ÿå˜é‡</span></span><br><span class=\"line\">14) Removed system variables <span class=\"keyword\">for</span> error logging to the system <span class=\"built_in\">log</span> configuration</span><br><span class=\"line\">  To run this check requires full path to MySQL server configuration file to be specified at <span class=\"string\">&#x27;configPath&#x27;</span> key of options dictionary</span><br><span class=\"line\">  More information:</span><br><span class=\"line\">    https://dev.mysql.com/doc/relnotes/mysql/8.0/en/news-8-0-13.html#mysqld-8-0-13-logging</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å·²åˆ é™¤çš„ç³»ç»Ÿå˜é‡</span></span><br><span class=\"line\">15) Removed system variables</span><br><span class=\"line\">  To run this check requires full path to MySQL server configuration file to be specified at <span class=\"string\">&#x27;configPath&#x27;</span> key of options dictionary</span><br><span class=\"line\">  More information:</span><br><span class=\"line\">    https://dev.mysql.com/doc/refman/8.0/en/added-deprecated-removed.html#optvars-removed</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å…·æœ‰æ–°é»˜è®¤å€¼çš„ç³»ç»Ÿå˜é‡</span></span><br><span class=\"line\">16) System variables with new default values</span><br><span class=\"line\">  To run this check requires full path to MySQL server configuration file to be specified at <span class=\"string\">&#x27;configPath&#x27;</span> key of options dictionary</span><br><span class=\"line\">  More information:</span><br><span class=\"line\">    https://mysqlserverteam.com/new-defaults-in-mysql-8-0/</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># é›¶æ—¥æœŸã€æ—¥æœŸæ—¶é—´å’Œæ—¶é—´æˆ³å€¼</span></span><br><span class=\"line\">17) Zero Date, Datetime, and Timestamp values</span><br><span class=\"line\">  Warning: By default zero <span class=\"built_in\">date</span>/datetime/timestamp values are no longer allowed</span><br><span class=\"line\">    <span class=\"keyword\">in</span> MySQL, as of 5.7.8 NO_ZERO_IN_DATE and NO_ZERO_DATE are included <span class=\"keyword\">in</span></span><br><span class=\"line\">    SQL_MODE by default. These modes should be used with strict mode as they will</span><br><span class=\"line\">    be merged with strict mode <span class=\"keyword\">in</span> a future release. If you <span class=\"keyword\">do</span> not include these</span><br><span class=\"line\">    modes <span class=\"keyword\">in</span> your SQL_MODE setting, you are able to insert</span><br><span class=\"line\">    <span class=\"built_in\">date</span>/datetime/timestamp values that contain zeros. It is strongly advised to</span><br><span class=\"line\">    replace zero values with valid ones, as they may not work correctly <span class=\"keyword\">in</span> the</span><br><span class=\"line\">    future.</span><br><span class=\"line\">  More information:</span><br><span class=\"line\">    https://lefred.be/content/mysql-8-0-and-wrong-dates/</span><br><span class=\"line\"></span><br><span class=\"line\">  global.sql_mode - does not contain either NO_ZERO_DATE or NO_ZERO_IN_DATE</span><br><span class=\"line\">    <span class=\"built_in\">which</span> allows insertion of zero dates</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ç”±æ–‡ä»¶åˆ é™¤æˆ–æŸåå¯¼è‡´çš„æ¨¡å¼ä¸ä¸€è‡´</span></span><br><span class=\"line\">18) Schema inconsistencies resulting from file removal or corruption</span><br><span class=\"line\">  No issues found</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># è¢«InnoDBè¯†åˆ«ä½†å±äºä¸åŒå¼•æ“çš„è¡¨</span></span><br><span class=\"line\">19) Tables recognized by InnoDB that belong to a different engine</span><br><span class=\"line\">  No issues found</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># &#x27;check table x for upgrade&#x27;å‘½ä»¤æŠ¥å‘Šçš„é—®é¢˜</span></span><br><span class=\"line\">20) Issues reported by <span class=\"string\">&#x27;check table x for upgrade&#x27;</span> <span class=\"built_in\">command</span></span><br><span class=\"line\">  No issues found</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ–°çš„é»˜è®¤è®¤è¯æ’ä»¶è€ƒè™‘</span></span><br><span class=\"line\">21) New default authentication plugin considerations</span><br><span class=\"line\">  Warning: The new default authentication plugin <span class=\"string\">&#x27;caching_sha2_password&#x27;</span> offers</span><br><span class=\"line\">    more secure password hashing than previously used <span class=\"string\">&#x27;mysql_native_password&#x27;</span></span><br><span class=\"line\">    (and consequent improved client connection authentication). However, it also</span><br><span class=\"line\">    has compatibility implications that may affect existing MySQL installations.</span><br><span class=\"line\">    If your MySQL installation must serve pre-8.0 clients and you encounter</span><br><span class=\"line\">    compatibility issues after upgrading, the simplest way to address those</span><br><span class=\"line\">    issues is to reconfigure the server to revert to the previous default</span><br><span class=\"line\">    authentication plugin (mysql_native_password). For example, use these lines</span><br><span class=\"line\">    <span class=\"keyword\">in</span> the server option file:</span><br><span class=\"line\"></span><br><span class=\"line\">    [mysqld]</span><br><span class=\"line\">    default_authentication_plugin=mysql_native_password</span><br><span class=\"line\"></span><br><span class=\"line\">    However, the setting should be viewed as temporary, not as a long term or</span><br><span class=\"line\">    permanent solution, because it causes new accounts created with the setting</span><br><span class=\"line\">    <span class=\"keyword\">in</span> effect to forego the improved authentication security.</span><br><span class=\"line\">    If you are using replication please take time to understand how the</span><br><span class=\"line\">    authentication plugin changes may impact you.</span><br><span class=\"line\">  More information:</span><br><span class=\"line\">    https://dev.mysql.com/doc/refman/8.0/en/upgrading-from-previous-series.html#upgrade-caching-sha2-password-compatibility-issues</span><br><span class=\"line\">    https://dev.mysql.com/doc/refman/8.0/en/upgrading-from-previous-series.html#upgrade-caching-sha2-password-replication</span><br><span class=\"line\"></span><br><span class=\"line\">Errors:   0</span><br><span class=\"line\">Warnings: 98</span><br><span class=\"line\">Notices:  0</span><br><span class=\"line\"></span><br><span class=\"line\">NOTE: No fatal errors were found that would prevent an upgrade, but some potential issues were detected. Please ensure that the reported issues are not significant before upgrading.</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¯ä»¥çœ‹åˆ°ï¼Œå…¶æ£€æŸ¥çš„æ•°æ®åº“ç‰ˆæœ¬æ˜¯5.7.44ï¼Œå…¶æ£€æŸ¥æ˜¯å¦å¯ä»¥å‡çº§åˆ°8.0.30</p>\n</li>\n<li class=\"lvl-2\">\n<p>æ£€æµ‹é¡¹å…±æœ‰21ä¸ªï¼Œå…¶ä¸­è­¦å‘Šæœ‰98ä¸ªï¼Œé”™è¯¯æœ‰0ä¸ªï¼Œæ³¨æ„ï¼Œå¦‚æœæœ‰é”™è¯¯ï¼Œåˆ™ä¸èƒ½ç›´æ¥å‡çº§ï¼Œéœ€è¦è§£å†³é”™è¯¯é—®é¢˜ï¼Œå¦åˆ™å‡çº§ä¼šå¤±è´¥ã€‚è‡³äºè­¦å‘Šæš‚æ—¶å¯ä»¥ä¸å¤„ç†ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>è­¦å‘Šé›†ä¸­ä½“ç°åœ¨å­—ç¬¦é›†ä¸Šï¼Œ5.7.44çš„å­—ç¬¦é›†æ˜¯utf8(å®é™…å°±æ˜¯utf8mb3)ï¼Œè€Œmysql8ä»¥åçš„é»˜è®¤å­—ç¬¦é›†æ˜¯utf8mb4ï¼Œè¿™ä¸ªè­¦å‘Šä¸å½±å“å‡çº§ï¼Œå¯ä»¥å¿½ç•¥ã€‚å¦‚æœéœ€è¦ä¿®æ”¹å­—ç¬¦é›†åˆ°utf8mb4ï¼Œéœ€è¦æ³¨æ„åŸæ¥çš„å­—æ®µå­—ç¬¦ä¸²é•¿åº¦æ˜¯å¦ç¬¦åˆè¦æ±‚ï¼Œå› ä¸ºutf8mb4æ˜¯4å­—èŠ‚ï¼Œè€Œutf8mb3æ˜¯3å­—èŠ‚ã€‚å¦å¤–å¦‚æœä½¿ç”¨äº†å­˜å‚¨è¿‡ç¨‹ä¹Ÿè¦æ³¨æ„å‚æ•°çš„é•¿åº¦æ˜¯å¦ç¬¦åˆè¦æ±‚ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>è¿™é‡Œè¯´ä¸€ä¸‹<code>default_authentication_plugin</code>ï¼Œmysql8.0.13å¼€å§‹ï¼Œé»˜è®¤çš„è®¤è¯æ’ä»¶æ˜¯<code>caching_sha2_password</code>ï¼Œè€Œä¹‹å‰æ˜¯<code>mysql_native_password</code>ï¼Œè¿™ä¸ªè­¦å‘Šè™½ç„¶å¯ä»¥å¿½ç•¥ï¼Œä½†æ˜¯å‡çº§åå»ºè®®å°½å¿«å°†è®¤è¯æ’ä»¶ä¿®æ”¹ä¸º<code>caching_sha2_password</code>ï¼Œå› ä¸º<code>mysql_native_password</code>çš„è®¤è¯æ–¹å¼å­˜åœ¨å®‰å…¨æ¼æ´ï¼Œå¯ä»¥å‚è€ƒ<a href=\"https://dev.mysql.com/doc/refman/8.0/en/upgrading-from-previous-series.html#upgrade-caching-sha2-password-compatibility-issues\">å®˜æ–¹æ–‡æ¡£</a>ã€‚å¦å¤–ï¼Œä»mysql8.4.0å¼€å§‹ï¼Œä¸å†æ”¯æŒ<code>default_authentication_plugin</code>ï¼Œè‹¥è¦ä½¿å…¶æ”¯æŒ<code>mysql_native_password</code>æ’ä»¶ï¼Œ8.4.0å¼€å§‹ä¸ºæˆ‘ä»¬å¢åŠ äº†ä¸€ä¸ªæ–°çš„é…ç½®é¡¹<code>mysql-native-password</code>ï¼Œåœ¨[mysqld]ä¸­é…ç½®<code>mysql-native-password=ON</code>å³å¯å¼€å¯æ”¯æŒï¼Œé»˜è®¤ä¸º<code>OFF</code>ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å¦å¤–è¿˜è¦æ³¨æ„<code>å…³é”®è¯</code>å’Œ<code>ä¿ç•™è¯</code>çš„é—®é¢˜ï¼Œmysql8.0ä»¥åï¼Œåˆå¢åŠ äº†å¾ˆå¤šä¸ª<code>å…³é”®è¯</code>å’Œ<code>ä¿ç•™è¯</code>ï¼Œå¦‚æœæ£€æŸ¥åˆ°åˆ™éœ€è¦ä¿®æ”¹ä¸€ä¸‹ï¼Œä¸ç„¶å‡çº§ä¼šå¤±è´¥ã€‚å³ä¾¿è¡¨å’Œå­—æ®µé‡Œæ²¡æœ‰ä½¿ç”¨è¿™äº›ä¿ç•™å­—ï¼Œä¹Ÿè¦æ£€æŸ¥ä¸€ä¸‹ä¸šåŠ¡ä»£ç ä¸­æ˜¯å¦æœ‰ä½¿ç”¨ã€‚å…³äº<code>å…³é”®è¯</code>å’Œ<code>ä¿ç•™è¯</code>å¯ä»¥æŸ¥çœ‹å®˜ç½‘<a href=\"https://dev.mysql.com/doc/refman/8.0/en/keywords.html\">Keywords and Reserved Words</a>ï¼Œç›¸æ¯”äºMySQL 5.7ï¼Œå¢åŠ äº†å¤§çº¦130ä¸ªï¼ŒåŒæ—¶ä¹Ÿå‡å°‘äº†6ä¸ªã€‚</p>\n<blockquote>\n<p>è¿™é‡Œå»ºè®®è®¾ç½®è¡¨åç§°å’Œå­—æ®µåç§°æ—¶ï¼Œå¯ä»¥ä¸ºå…¶è®¾ç½®å‰ç¼€ï¼Œæ¯”å¦‚ï¼šè¡¨åç§°ä¸ºï¼št_userã€å­—æ®µåç§°ä¸ºï¼šf_user_id</p>\n</blockquote>\n</li>\n<li class=\"lvl-2\">\n<p>è¿˜æœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„ï¼ŒMysql8ä¿®æ”¹äº†å¾ˆå¤šå‚æ•°çš„é»˜è®¤å€¼ï¼Œå…·ä½“å¯ä»¥æŸ¥çœ‹<a href=\"https://dev.mysql.com/blog-archive/new-defaults-in-mysql-8-0/\">å®˜æ–¹ç½‘ç«™çš„è¯´æ˜</a>ï¼Œå¦‚æœä½ ä¸å¸Œæœ›ä½¿ç”¨é»˜è®¤å€¼ï¼Œåˆ™éœ€è¦å°†å…¶é…ç½®åˆ°é…ç½®æ–‡ä»¶ä¸­ï¼Œè¿™é‡Œå¼ºè°ƒä¸€ä¸‹ï¼Œé‡ç‚¹å…³æ³¨ <code>character_set_server</code> å’Œ <code>collation_server</code> è¿™ä¸¤ä¸ªå‚æ•°ã€‚æ‰€æœ‰çš„å‚æ•°é…ç½®å‚è€ƒ<a href=\"https://dev.mysql.com/doc/refman/8.0/en/programs.html\">å®˜æ–¹æ–‡æ¡£</a></p>\n</li>\n</ul>\n<div class=\"tips\">\n<p><em><strong>å…³äºå­—ç¬¦é›†è¿˜æƒ³å¤šè¯´ä¸¤å¥</strong></em></p>\n<ul class=\"lvl-1\">\n<li class=\"lvl-2\">mysql8çš„<code>character_set_server</code>é»˜è®¤æ˜¯<code>utf8mb4</code>ï¼Œ<code>collation_server</code>é»˜è®¤æ˜¯<code>utf8mb4_0900_ai_ci</code></li>\n<li class=\"lvl-2\">å¦‚æœåˆ›å»ºæ•°æ®åº“æˆ–è€…è¡¨çš„æ—¶å€™æ²¡æœ‰æŒ‡å®šå­—ç¬¦é›†ï¼Œåˆ™é»˜è®¤ä½¿ç”¨<code>character_set_server</code>å’Œ<code>collation_server</code>çš„é»˜è®¤å€¼</li>\n<li class=\"lvl-2\">æ­¤æ—¶æ–°åˆ›å»ºçš„è¡¨å°±æœ‰å¯èƒ½ä¸æ—§è¡¨å­—ç¬¦é›†ä¸ä¸€è‡´ï¼Œå…³è”æŸ¥è¯¢æ—¶å°±æœ‰å¯èƒ½å¯¼è‡´é”™è¯¯æˆ–å› ä¸ºéœ€è¦è¿›è¡Œå­—ç¬¦é›†è½¬æ¢å¯¼è‡´æŸ¥è¯¢æ€§èƒ½ä¸‹é™ã€‚</li>\n<li class=\"lvl-2\">æœ€å¥½çš„æ–¹å¼æ˜¯åˆ›å»ºæ•°æ®åº“æˆ–è¡¨æ—¶æ˜ç¡®æŒ‡å®šå­—ç¬¦é›†ï¼Œæˆ–è€…åœ¨<code>my.cnf</code>é…ç½®æ–‡ä»¶ä¸­é…ç½®<code>character_set_server</code>å’Œ<code>collation_server</code>çš„å€¼ã€‚</li>\n</ul>\n</div>\n<h3 id=\"å‡çº§æ•°æ®åº“çš„è¿‡ç¨‹\">å‡çº§æ•°æ®åº“çš„è¿‡ç¨‹</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å› ä¸ºæˆ‘ä»¬è¦å‡çº§åˆ°mysql8.0.30ï¼Œæ‰€ä»¥éœ€è¦å…ˆä¸‹è½½å¹¶å®‰è£…mysql8.0.30</p>\n</li>\n<li class=\"lvl-2\">\n<p>å…³é—­mysql5.7çš„æ•°æ®åº“</p>\n</li>\n<li class=\"lvl-2\">\n<p>å¤‡ä»½æ•°æ®ç›®å½•(ä¸€å®šè¦åšå¥½å¤‡ä»½ï¼Œå‡çº§åä¸èƒ½é™çº§çš„)</p>\n</li>\n<li class=\"lvl-2\">\n<p>æ ¹æ®æ£€æŸ¥æç¤ºä¿®æ”¹<code>my.cnf</code>é…ç½®æ–‡ä»¶ä¸­çš„é…ç½®(ä¸»è¦æ˜¯ä¸å…¼å®¹çš„é…ç½®ï¼Œå¦‚æœæ£€æŸ¥æç¤ºæ²¡æœ‰åˆ™ä¸éœ€è¦ä¿®æ”¹)</p>\n</li>\n<li class=\"lvl-2\">\n<p>éå¸¸é‡è¦çš„ä¸€æ­¥ï¼Œå°±æ˜¯ä¿®æ”¹<code>my.cnf</code>é…ç½®æ–‡ä»¶ä¸­çš„<code>basedir</code>ï¼Œå°†å…¶æŒ‡å‘mysql8.0.30çš„å®‰è£…ç›®å½•</p>\n</li>\n<li class=\"lvl-2\">\n<p>ç›´æ¥ä½¿ç”¨mysql8.0.30çš„å‘½ä»¤å¯åŠ¨æ•°æ®åº“ï¼Œå¯åŠ¨è¿‡ç¨‹ä¸­å°±ä¼šå®Œæˆæ•°æ®åº“çš„å‡çº§ï¼Œå¯ä»¥é€šè¿‡mysqlçš„æ—¥å¿—æ–‡ä»¶(log-error)æŸ¥çœ‹å‡çº§æƒ…å†µ</p>\n</li>\n<li class=\"lvl-2\">\n<p>å‡çº§å®Œæˆåå°½å¿«ä½¿ç”¨æ–°çš„å¯†ç è®¤è¯æ’ä»¶ä¿®æ”¹å¯†ç ï¼Œæ³¨æ„è¦ä¿®æ”¹æ‰€æœ‰ç”¨æˆ·çš„å¯†ç ï¼ŒåŒ…æ‹¬rootç”¨æˆ·</p>\n</li>\n</ul>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mysql<span class=\"operator\">&gt;</span> <span class=\"keyword\">ALTER</span> <span class=\"keyword\">USER</span> <span class=\"string\">&#x27;root&#x27;</span>@<span class=\"string\">&#x27;localhost&#x27;</span> IDENTIFIED <span class=\"keyword\">WITH</span> caching_sha2_password <span class=\"keyword\">BY</span> <span class=\"string\">&#x27;123456&#x27;</span>;</span><br></pre></td></tr></table></figure>\n<div class=\"tips\">\n<p><em><strong>å°è´´å£«</strong></em></p>\n<ul class=\"lvl-1\">\n<li class=\"lvl-2\">mysql8.4.0ç›¸æ¯”äºä¹‹å‰çš„ç‰ˆæœ¬å˜åŒ–æ¯”è¾ƒå¤§ï¼Œå…·ä½“å¯ä»¥æŸ¥çœ‹<a href=\"https://dev.mysql.com/doc/refman/8.4/en/mysql-nutshell.html\">å®˜ç½‘æ–‡æ¡£</a></li>\n<li class=\"lvl-2\">mysql5.7ä¸è¦ç›´æ¥å‡çº§åˆ°8.4.0åŠä»¥åçš„ç‰ˆæœ¬ï¼Œå¯ä»¥å…ˆå‡çº§åˆ°8.0.30ï¼Œç„¶åå†å‡çº§åˆ°8.4.0</li>\n<li class=\"lvl-2\">å‡çº§åˆ°8.4.0å‰ä¾æ—§è¦å…ˆä½¿ç”¨<code>mysqlsh</code>æ£€æŸ¥æ˜¯å¦å¯ä»¥å‡çº§ï¼Œæ³¨æ„è¦ä¸‹è½½å¯¹åº”çš„<code>mysqlsh</code>ç‰ˆæœ¬</li>\n<li class=\"lvl-2\">å‡çº§å‰è¦å…ˆæ£€æŸ¥æ˜¯å¦æ‰€æœ‰ç”¨æˆ·çš„å¯†ç æ’ä»¶éƒ½æ˜¯<code>caching_sha2_password</code>ï¼Œå¦‚æœæ²¡æœ‰åˆ™éœ€è¦ä¿®æ”¹</li>\n<li class=\"lvl-2\">å‡çº§å‰è¦å…ˆæ£€æŸ¥<code>my.cnf</code>ä¸­æ˜¯å¦é…ç½®äº†default_authentication_pluginï¼Œå¦‚æœæœ‰åˆ™åˆ é™¤ï¼Œå¦‚æœå¿…é¡»è¦é…ç½®<code>mysql_native_password</code>è®¤è¯æ’ä»¶ï¼Œåˆ™éœ€è¦é…ç½®<code>mysql-native-password=ON</code></li>\n<li class=\"lvl-2\">ä¿®æ”¹<code>my.cnf</code>ä¸­çš„<code>basedir</code>ä½¿å…¶æŒ‡å‘8.4.0çš„å®‰è£…ç›®å½•</li>\n<li class=\"lvl-2\">ä½¿ç”¨8.4.0çš„å‘½ä»¤å¯åŠ¨mysqlï¼Œæ£€æŸ¥æ—¥å¿—æ˜¯å¦æœ‰é”™è¯¯ã€‚</li>\n</ul>\n</div>\n<h2 id=\"mysql5-7-44å‡çº§åˆ°8-0-30ï¼Œå†å‡çº§åˆ°8-4-0çš„å®Œæ•´è¿‡ç¨‹\">mysql5.7.44å‡çº§åˆ°8.0.30ï¼Œå†å‡çº§åˆ°8.4.0çš„å®Œæ•´è¿‡ç¨‹</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å‡†å¤‡å¥½å„ä¸ªç‰ˆæœ¬çš„mysqlå’Œmysqlsh</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ç›®å½•ç»“æ„</span></span><br><span class=\"line\">mysql5 <span class=\"comment\"># 5.7.44å®‰è£…ç›®å½•</span></span><br><span class=\"line\">mysql8.0.30 <span class=\"comment\"># 8.0.30å®‰è£…ç›®å½•</span></span><br><span class=\"line\">mysql8.4.0 <span class=\"comment\"># 8.4.0å®‰è£…ç›®å½•</span></span><br><span class=\"line\">mysqlsh8.0.30 <span class=\"comment\"># 8.0.30çš„mysqlshå®‰è£…ç›®å½•</span></span><br><span class=\"line\">mysqlsh8.4.0 <span class=\"comment\"># 8.4.0çš„mysqlshå®‰è£…ç›®å½•</span></span><br><span class=\"line\">datas/mysql <span class=\"comment\"># å­˜æ”¾æ•°æ®ç›®å½•</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><code>mysql5/my.cnf</code>é…ç½®</p>\n</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[mysql]</span><br><span class=\"line\">default-character-set=utf8mb4</span><br><span class=\"line\">local_infile=ON</span><br><span class=\"line\"></span><br><span class=\"line\">[client]</span><br><span class=\"line\">default-character-set=utf8mb4</span><br><span class=\"line\">port       = 3306</span><br><span class=\"line\">socket     = /tmp/mysql.sock</span><br><span class=\"line\"></span><br><span class=\"line\">[mysqld]</span><br><span class=\"line\">skip-name-resolve</span><br><span class=\"line\">secure_file_priv=&quot;&quot;</span><br><span class=\"line\">local_infile=ON</span><br><span class=\"line\"></span><br><span class=\"line\">default_authentication_plugin=mysql_native_password</span><br><span class=\"line\"></span><br><span class=\"line\">port       = 3306</span><br><span class=\"line\">server-id  = 1001</span><br><span class=\"line\">user       = mysql</span><br><span class=\"line\">socket     = /tmp/mysql.sock</span><br><span class=\"line\">basedir    = /usr/local/soft/mysql5</span><br><span class=\"line\">datadir    = /usr/local/soft/datas/mysql</span><br><span class=\"line\"></span><br><span class=\"line\">log-bin    = mysql-bin</span><br><span class=\"line\">binlog-format = ROW</span><br><span class=\"line\"></span><br><span class=\"line\">expire-logs-days=10</span><br><span class=\"line\"></span><br><span class=\"line\">sync-binlog=0</span><br><span class=\"line\">innodb_data_home_dir      =./</span><br><span class=\"line\">innodb_log_group_home_dir =./</span><br><span class=\"line\">log-error =mysql.log</span><br><span class=\"line\">pid-file  =mysql.pid</span><br><span class=\"line\">character-set-server=utf8mb4</span><br><span class=\"line\">lower_case_table_names=1</span><br><span class=\"line\">autocommit =1</span><br><span class=\"line\">slow_query_log=1</span><br><span class=\"line\">slow_query_log_file=db_slow.log</span><br><span class=\"line\">long_query_time=5</span><br><span class=\"line\">log_output=FILE</span><br><span class=\"line\">log_queries_not_using_indexes=1</span><br><span class=\"line\">skip-external-locking</span><br><span class=\"line\">key_buffer_size = 256M</span><br><span class=\"line\">max_allowed_packet = 64M</span><br><span class=\"line\">table_open_cache = 1024</span><br><span class=\"line\">sort_buffer_size = 4M</span><br><span class=\"line\">net_buffer_length = 8K</span><br><span class=\"line\">read_buffer_size = 4M</span><br><span class=\"line\">read_rnd_buffer_size = 512K</span><br><span class=\"line\">myisam_sort_buffer_size = 64M</span><br><span class=\"line\">thread_cache_size = 64</span><br><span class=\"line\">tmp_table_size = 128M</span><br><span class=\"line\">explicit_defaults_for_timestamp = true</span><br><span class=\"line\">max_connections = 500</span><br><span class=\"line\">max_connect_errors = 100</span><br><span class=\"line\">open_files_limit = 65535</span><br><span class=\"line\">default_storage_engine = InnoDB</span><br><span class=\"line\">innodb_data_file_path = ibdata1:10M:autoextend</span><br></pre></td></tr></table></figure>\n<h3 id=\"5-7-44å‡çº§åˆ°8-0-30\">5.7.44å‡çº§åˆ°8.0.30</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å‡çº§æ£€æŸ¥</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å‡çº§æ£€æŸ¥</span></span><br><span class=\"line\">./mysqlsh8.0.30/bin/mysqlsh --uri root:123456@localhost  -e <span class=\"string\">&quot;util.checkForServerUpgrade()&quot;</span></span><br><span class=\"line\"><span class=\"comment\"># è¾“å‡º</span></span><br><span class=\"line\">WARNING: Using a password on the <span class=\"built_in\">command</span> line interface can be insecure.</span><br><span class=\"line\">The MySQL server at /tmp%2Fmysql.sock, version 5.7.44-<span class=\"built_in\">log</span> - MySQL Community</span><br><span class=\"line\">Server (GPL), will now be checked <span class=\"keyword\">for</span> compatibility issues <span class=\"keyword\">for</span> upgrade to MySQL</span><br><span class=\"line\">8.0.30...</span><br><span class=\"line\"></span><br><span class=\"line\">1) Usage of old temporal <span class=\"built_in\">type</span></span><br><span class=\"line\">  No issues found</span><br><span class=\"line\"></span><br><span class=\"line\">2) Usage of db objects with names conflicting with new reserved keywords</span><br><span class=\"line\">  No issues found</span><br><span class=\"line\"></span><br><span class=\"line\">3) Usage of utf8mb3 charset</span><br><span class=\"line\">  Warning: The following objects use the utf8mb3 character <span class=\"built_in\">set</span>. It is</span><br><span class=\"line\">    recommended to convert them to use utf8mb4 instead, <span class=\"keyword\">for</span> improved Unicode</span><br><span class=\"line\">    support.</span><br><span class=\"line\">  More information:</span><br><span class=\"line\">    https://dev.mysql.com/doc/refman/8.0/en/charset-unicode-utf8mb3.html</span><br><span class=\"line\"></span><br><span class=\"line\">  mydb - schema<span class=\"string\">&#x27;s default character set: utf8</span></span><br><span class=\"line\"><span class=\"string\">  mysql - schema&#x27;</span>s default character <span class=\"built_in\">set</span>: utf8</span><br><span class=\"line\">  mydb.tbl_info_i.a_product - column<span class=\"string\">&#x27;s default character set: utf8</span></span><br><span class=\"line\"><span class=\"string\">  mydb.tbl_info_i.a_country - column&#x27;</span>s default character <span class=\"built_in\">set</span>: utf8</span><br><span class=\"line\">  mydb.tbl_info_i.a_version - column<span class=\"string\">&#x27;s default character set: utf8</span></span><br><span class=\"line\"><span class=\"string\">  mydb.tbl_info_i.a_placement - column&#x27;</span>s default character <span class=\"built_in\">set</span>: utf8</span><br><span class=\"line\"> â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">4) Table names <span class=\"keyword\">in</span> the mysql schema conflicting with new tables <span class=\"keyword\">in</span> 8.0</span><br><span class=\"line\">  No issues found</span><br><span class=\"line\"></span><br><span class=\"line\">5) Partitioned tables using engines with non native partitioning</span><br><span class=\"line\">  No issues found</span><br><span class=\"line\"></span><br><span class=\"line\">6) Foreign key constraint names longer than 64 characters</span><br><span class=\"line\">  No issues found</span><br><span class=\"line\"></span><br><span class=\"line\">7) Usage of obsolete MAXDB sql_mode flag</span><br><span class=\"line\">  No issues found</span><br><span class=\"line\"></span><br><span class=\"line\">8) Usage of obsolete sql_mode flags</span><br><span class=\"line\">  Notice: The following DB objects have obsolete options persisted <span class=\"keyword\">for</span></span><br><span class=\"line\">    sql_mode, <span class=\"built_in\">which</span> will be cleared during upgrade to 8.0.</span><br><span class=\"line\">  More information:</span><br><span class=\"line\">    https://dev.mysql.com/doc/refman/8.0/en/mysql-nutshell.html#mysql-nutshell-removals</span><br><span class=\"line\"></span><br><span class=\"line\">  global system variable sql_mode - defined using obsolete NO_AUTO_CREATE_USER</span><br><span class=\"line\">    option</span><br><span class=\"line\"></span><br><span class=\"line\">9) ENUM/SET column definitions containing elements longer than 255 characters</span><br><span class=\"line\">  No issues found</span><br><span class=\"line\"></span><br><span class=\"line\">10) Usage of partitioned tables <span class=\"keyword\">in</span> shared tablespaces</span><br><span class=\"line\">  No issues found</span><br><span class=\"line\"></span><br><span class=\"line\">11) Circular directory references <span class=\"keyword\">in</span> tablespace data file paths</span><br><span class=\"line\">  No issues found</span><br><span class=\"line\"></span><br><span class=\"line\">12) Usage of removed <span class=\"built_in\">functions</span></span><br><span class=\"line\">  No issues found</span><br><span class=\"line\"></span><br><span class=\"line\">13) Usage of removed GROUP BY ASC/DESC syntax</span><br><span class=\"line\">  No issues found</span><br><span class=\"line\"></span><br><span class=\"line\">14) Removed system variables <span class=\"keyword\">for</span> error logging to the system <span class=\"built_in\">log</span> configuration</span><br><span class=\"line\">  To run this check requires full path to MySQL server configuration file to be specified at <span class=\"string\">&#x27;configPath&#x27;</span> key of options dictionary</span><br><span class=\"line\">  More information:</span><br><span class=\"line\">    https://dev.mysql.com/doc/relnotes/mysql/8.0/en/news-8-0-13.html#mysqld-8-0-13-logging</span><br><span class=\"line\"></span><br><span class=\"line\">15) Removed system variables</span><br><span class=\"line\">  To run this check requires full path to MySQL server configuration file to be specified at <span class=\"string\">&#x27;configPath&#x27;</span> key of options dictionary</span><br><span class=\"line\">  More information:</span><br><span class=\"line\">    https://dev.mysql.com/doc/refman/8.0/en/added-deprecated-removed.html#optvars-removed</span><br><span class=\"line\"></span><br><span class=\"line\">16) System variables with new default values</span><br><span class=\"line\">  To run this check requires full path to MySQL server configuration file to be specified at <span class=\"string\">&#x27;configPath&#x27;</span> key of options dictionary</span><br><span class=\"line\">  More information:</span><br><span class=\"line\">    https://mysqlserverteam.com/new-defaults-in-mysql-8-0/</span><br><span class=\"line\"></span><br><span class=\"line\">17) Zero Date, Datetime, and Timestamp values</span><br><span class=\"line\">  No issues found</span><br><span class=\"line\"></span><br><span class=\"line\">18) Schema inconsistencies resulting from file removal or corruption</span><br><span class=\"line\">  No issues found</span><br><span class=\"line\"></span><br><span class=\"line\">19) Tables recognized by InnoDB that belong to a different engine</span><br><span class=\"line\">  No issues found</span><br><span class=\"line\"></span><br><span class=\"line\">20) Issues reported by <span class=\"string\">&#x27;check table x for upgrade&#x27;</span> <span class=\"built_in\">command</span></span><br><span class=\"line\">  No issues found</span><br><span class=\"line\"></span><br><span class=\"line\">21) New default authentication plugin considerations</span><br><span class=\"line\">  Warning: The new default authentication plugin <span class=\"string\">&#x27;caching_sha2_password&#x27;</span> offers</span><br><span class=\"line\">    more secure password hashing than previously used <span class=\"string\">&#x27;mysql_native_password&#x27;</span></span><br><span class=\"line\">    (and consequent improved client connection authentication). However, it also</span><br><span class=\"line\">    has compatibility implications that may affect existing MySQL installations.</span><br><span class=\"line\">    If your MySQL installation must serve pre-8.0 clients and you encounter</span><br><span class=\"line\">    compatibility issues after upgrading, the simplest way to address those</span><br><span class=\"line\">    issues is to reconfigure the server to revert to the previous default</span><br><span class=\"line\">    authentication plugin (mysql_native_password). For example, use these lines</span><br><span class=\"line\">    <span class=\"keyword\">in</span> the server option file:</span><br><span class=\"line\"></span><br><span class=\"line\">    [mysqld]</span><br><span class=\"line\">    default_authentication_plugin=mysql_native_password</span><br><span class=\"line\"></span><br><span class=\"line\">    However, the setting should be viewed as temporary, not as a long term or</span><br><span class=\"line\">    permanent solution, because it causes new accounts created with the setting</span><br><span class=\"line\">    <span class=\"keyword\">in</span> effect to forego the improved authentication security.</span><br><span class=\"line\">    If you are using replication please take time to understand how the</span><br><span class=\"line\">    authentication plugin changes may impact you.</span><br><span class=\"line\">  More information:</span><br><span class=\"line\">    https://dev.mysql.com/doc/refman/8.0/en/upgrading-from-previous-series.html#upgrade-caching-sha2-password-compatibility-issues</span><br><span class=\"line\">    https://dev.mysql.com/doc/refman/8.0/en/upgrading-from-previous-series.html#upgrade-caching-sha2-password-replication</span><br><span class=\"line\"></span><br><span class=\"line\">Errors:   0</span><br><span class=\"line\">Warnings: 98</span><br><span class=\"line\">Notices:  1</span><br><span class=\"line\"></span><br><span class=\"line\">NOTE: No fatal errors were found that would prevent an upgrade, but some potential issues were detected. Please ensure that the reported issues are not significant before upgrading.</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>çœ‹åˆ°æ²¡æœ‰errorï¼Œå¼€å§‹å‡çº§</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å…³é—­æ•°æ®åº“</span></span><br><span class=\"line\">./mysql5/bin/mysqladmin --defaults-file=./mysql5/my.cnf -uroot -p123456 shutdown</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å¤åˆ¶mysqlé…ç½®æ–‡ä»¶</span></span><br><span class=\"line\"><span class=\"built_in\">cp</span> ./mysql5/my.cnf ./mysql8.0.30/my.cnf</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ä¿®æ”¹æ–°çš„é…ç½®æ–‡ä»¶ä¸­çš„basedirï¼Œä½¿å…¶æŒ‡å‘8.0.30çš„å®‰è£…è·¯å¾„</span></span><br><span class=\"line\">basedir    = /usr/local/soft/mysql8.0.30</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ä½¿ç”¨8.0.30å¯åŠ¨</span></span><br><span class=\"line\">./mysql8.0.30/bin/mysqld_safe --defaults-file=./mysql8.0.30/my.cnf &amp;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æŸ¥çœ‹å¯åŠ¨æ—¥å¿—ï¼Œæ²¡æœ‰é”™è¯¯è¯´æ˜å‡çº§æˆåŠŸ</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">2024-05-09T06:48:50.524705Z 0 [Warning] [MY-011068] [Server] The syntax <span class=\"string\">&#x27;expire-logs-days&#x27;</span> is deprecated and will be removed <span class=\"keyword\">in</span> a future release. Please use binlog_expire_logs_seconds instead.</span><br><span class=\"line\">2024-05-09T06:48:50.524819Z 0 [Warning] [MY-010097] [Server] Insecure configuration <span class=\"keyword\">for</span> --secure-file-priv: Current value does not restrict location of generated files. Consider setting it to a valid, non-empty path.</span><br><span class=\"line\">2024-05-09T06:48:50.524917Z 0 [Warning] [MY-010918] [Server] <span class=\"string\">&#x27;default_authentication_plugin&#x27;</span> is deprecated and will be removed <span class=\"keyword\">in</span> a future release. Please use authentication_policy instead.</span><br><span class=\"line\">2024-05-09T06:48:50.524983Z 0 [System] [MY-010116] [Server] /usr/local/soft/mysql8.0.30/bin/mysqld (mysqld 8.0.30) starting as process 26696</span><br><span class=\"line\">2024-05-09T06:48:50.563366Z 1 [System] [MY-011012] [Server] Starting upgrade of data directory.</span><br><span class=\"line\">2024-05-09T06:48:50.563414Z 1 [System] [MY-013576] [InnoDB] InnoDB initialization has started.</span><br><span class=\"line\">2024-05-09T06:48:51.260298Z 1 [System] [MY-013577] [InnoDB] InnoDB initialization has ended.</span><br><span class=\"line\">2024-05-09T06:48:53.614398Z 2 [System] [MY-011003] [Server] Finished populating Data Dictionary tables with data.</span><br><span class=\"line\">2024-05-09T06:48:55.055320Z 5 [System] [MY-013381] [Server] Server upgrade from <span class=\"string\">&#x27;50700&#x27;</span> to <span class=\"string\">&#x27;80030&#x27;</span> started.</span><br><span class=\"line\">2024-05-09T06:49:02.063990Z 5 [System] [MY-013381] [Server] Server upgrade from <span class=\"string\">&#x27;50700&#x27;</span> to <span class=\"string\">&#x27;80030&#x27;</span> completed.</span><br><span class=\"line\">2024-05-09T06:49:02.237992Z 0 [Warning] [MY-010068] [Server] CA certificate ca.pem is self signed.</span><br><span class=\"line\">2024-05-09T06:49:02.238048Z 0 [System] [MY-013602] [Server] Channel mysql_main configured to support TLS. Encrypted connections are now supported <span class=\"keyword\">for</span> this channel.</span><br><span class=\"line\">2024-05-09T06:49:02.267583Z 0 [System] [MY-011323] [Server] X Plugin ready <span class=\"keyword\">for</span> connections. Bind-address: <span class=\"string\">&#x27;::&#x27;</span> port: 33060, socket: /tmp/mysqlx.sock</span><br><span class=\"line\">2024-05-09T06:49:02.267648Z 0 [System] [MY-010931] [Server] /usr/local/soft/mysql8.0.30/bin/mysqld: ready <span class=\"keyword\">for</span> connections. Version: <span class=\"string\">&#x27;8.0.30&#x27;</span>  socket: <span class=\"string\">&#x27;/tmp/mysql.sock&#x27;</span>  port: 3306  MySQL Community Server - GPL.</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>æ ¹æ®æ—¥å¿—æç¤ºæˆ‘ä»¬åº”è¯¥ä¿®æ”¹ä¸¤ä¸ªé…ç½®å‚æ•°ï¼Œæœªæ¥å°†ä¸å¯ç”¨äº†ï¼Œä¸è¿‡è¿™é‡Œæš‚ä¸”å…ˆä¸å»ç®¡å®ƒï¼Œç­‰æ£€æŸ¥é€šä¸è¿‡äº†å†è¿›è¡Œå¤„ç†å°±å¯ä»¥ã€‚</p>\n</blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1.The syntax &#x27;expire-logs-days&#x27; is deprecated and will be removed in a future release. Please use binlog_expire_logs_seconds instead.</span><br><span class=\"line\">2.&#x27;default_authentication_plugin&#x27; is deprecated and will be removed in a future release. Please use authentication_policy instead.</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¿®æ”¹å¯†ç æ’ä»¶ï¼Œè¿™ä¸ªæ­¥éª¤å¾ˆé‡è¦</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ç™»å½•</span></span><br><span class=\"line\">./mysql8.0.30/bin/mysql -uroot -p123456</span><br><span class=\"line\"><span class=\"comment\"># å‡çº§å®Œæˆåä½¿ç”¨æ–°çš„å¯†ç è®¤è¯æ’ä»¶ä¿®æ”¹å¯†ç ï¼Œ8.4ä¸å†æ¨èmysql_native_passwordè®¤è¯æ’ï¼Œæ‰€ä»¥å‡çº§åˆ°8.4ä»¥å‰ä¸€å®šè¦å…ˆä¿®æ”¹å¯†ç æ’ä»¶ï¼Œå¦‚æœå¿˜è®°äº†ä¹Ÿæ²¡å…³ç³»ï¼Œæ–‡æœ«æœ‰é‡ç½®å¯†ç çš„æ–¹æ³•</span></span><br><span class=\"line\">mysql&gt; ALTER USER <span class=\"string\">&#x27;root&#x27;</span>@<span class=\"string\">&#x27;localhost&#x27;</span> IDENTIFIED WITH caching_sha2_password BY <span class=\"string\">&#x27;123456&#x27;</span>;</span><br></pre></td></tr></table></figure>\n<h3 id=\"8-0-30å‡çº§åˆ°8-4-0\">8.0.30å‡çº§åˆ°8.4.0</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åŒæ ·å…ˆç”¨8.4.0çš„mysqlshæ£€æŸ¥ä¸€ä¸‹</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å‡çº§æ£€æŸ¥</span></span><br><span class=\"line\">./mysqlsh8.4.0/bin/mysqlsh --uri root:123456@localhost</span><br><span class=\"line\"><span class=\"comment\"># è¾“å‡º</span></span><br><span class=\"line\">MySQL Shell 8.4.0</span><br><span class=\"line\"></span><br><span class=\"line\">Copyright (c) 2016, 2024, Oracle and/or its affiliates.</span><br><span class=\"line\">Oracle is a registered trademark of Oracle Corporation and/or its affiliates.</span><br><span class=\"line\">Other names may be trademarks of their respective owners.</span><br><span class=\"line\"></span><br><span class=\"line\">Type <span class=\"string\">&#x27;\\help&#x27;</span> or <span class=\"string\">&#x27;\\?&#x27;</span> <span class=\"keyword\">for</span> <span class=\"built_in\">help</span>; <span class=\"string\">&#x27;\\quit&#x27;</span> to <span class=\"built_in\">exit</span>.</span><br><span class=\"line\">WARNING: Using a password on the <span class=\"built_in\">command</span> line interface can be insecure.</span><br><span class=\"line\">Creating a Classic session to <span class=\"string\">&#x27;root@/tmp%2Fmysql.sock&#x27;</span></span><br><span class=\"line\">Fetching global names <span class=\"keyword\">for</span> auto-completion... Press ^C to stop.</span><br><span class=\"line\">Your MySQL connection <span class=\"built_in\">id</span> is 15</span><br><span class=\"line\">Server version: 8.0.30 MySQL Community Server - GPL</span><br><span class=\"line\">No default schema selected; <span class=\"built_in\">type</span> \\use &lt;schema&gt; to <span class=\"built_in\">set</span> one.</span><br><span class=\"line\"> MySQL  localhost  SQL &gt; \\js</span><br><span class=\"line\">Switching to JavaScript mode...</span><br><span class=\"line\"> MySQL  localhost  JS &gt; util.checkForServerUpgrade()</span><br><span class=\"line\">The MySQL server at /tmp%2Fmysql.sock, version 8.0.30 - MySQL Community Server</span><br><span class=\"line\">- GPL, will now be checked <span class=\"keyword\">for</span> compatibility issues <span class=\"keyword\">for</span> upgrade to MySQL 8.4.0.</span><br><span class=\"line\">To check <span class=\"keyword\">for</span> a different target server version, use the targetVersion option.</span><br><span class=\"line\"></span><br><span class=\"line\">WARNING: Upgrading MySQL Server from version 8.0.30 to 8.4.0 is not supported.</span><br><span class=\"line\">Please consider running the check using the following option: targetVersion=8.0</span><br><span class=\"line\"></span><br><span class=\"line\">1) Usage of db objects with names conflicting with new reserved keywords</span><br><span class=\"line\">(reservedKeywords)</span><br><span class=\"line\">  No issues found</span><br><span class=\"line\"></span><br><span class=\"line\">2) Removed system variables (removedSysVars)</span><br><span class=\"line\">  Error: Following system variables that were detected as being used will be</span><br><span class=\"line\">    removed. Please update your system to not rely on them before the upgrade.</span><br><span class=\"line\">  More information:</span><br><span class=\"line\">    https://dev.mysql.com/doc/refman/8.0/en/added-deprecated-removed.html#optvars-removed</span><br><span class=\"line\"></span><br><span class=\"line\">  expire_logs_days - Error: The system variable <span class=\"string\">&#x27;expire_logs_days&#x27;</span> is <span class=\"built_in\">set</span> to 10</span><br><span class=\"line\">    (EXPLICIT) and will be removed.</span><br><span class=\"line\"></span><br><span class=\"line\">3) System variables with new default values (sysVarsNewDefaults)</span><br><span class=\"line\">  Warning: Following system variables that are not defined <span class=\"keyword\">in</span> your</span><br><span class=\"line\">    configuration file will have new default values. Please review <span class=\"keyword\">if</span> you rely on</span><br><span class=\"line\">    their current values and <span class=\"keyword\">if</span> so define them before performing upgrade.</span><br><span class=\"line\">  More information:</span><br><span class=\"line\">    https://dev.mysql.com/blog-archive/new-defaults-in-mysql-8-0/</span><br><span class=\"line\"></span><br><span class=\"line\">  binlog_transaction_dependency_tracking - default value will change from</span><br><span class=\"line\">    COMMIT_ORDER to WRITESET.</span><br><span class=\"line\">  group_replication_consistency - default value will change from EVENTUAL to</span><br><span class=\"line\">    BEFORE_ON_PRIMARY_FAILOVER.</span><br><span class=\"line\">  group_replication_exit_state_action - default value will change from</span><br><span class=\"line\">    READ_ONLY to OFFLINE_MODE.</span><br><span class=\"line\">  innodb_adaptive_hash_index - default value will change from ON to OFF.</span><br><span class=\"line\">  innodb_buffer_pool_in_core_file - default value will change from ON to OFF.</span><br><span class=\"line\">  innodb_buffer_pool_instances - default value will change from 8 (or 1 <span class=\"keyword\">if</span></span><br><span class=\"line\">    innodb_buffer_pool_size &lt; 1GB) to MAX(1, <span class=\"comment\">#vcpu/4).</span></span><br><span class=\"line\">  innodb_change_buffering - default value will change from all to none.</span><br><span class=\"line\">  innodb_doublewrite_files - default value will change from</span><br><span class=\"line\">    innodb_buffer_pool_instances * 2 to 2.</span><br><span class=\"line\">  innodb_doublewrite_pages - default value will change from</span><br><span class=\"line\">    innodb_write_io_threads to 128.</span><br><span class=\"line\">  innodb_flush_method - default value will change from fsynch (unix) or</span><br><span class=\"line\">    unbuffered (windows) to O_DIRECT.</span><br><span class=\"line\">  innodb_io_capacity - default value will change from 200 to 10000.</span><br><span class=\"line\">  innodb_io_capacity_max - default value will change from 200 to 2 x</span><br><span class=\"line\">    innodb_io_capacity.</span><br><span class=\"line\">  innodb_log_buffer_size - default value will change from 16777216 (16MB) to</span><br><span class=\"line\">    67108864 (64MB).</span><br><span class=\"line\">  innodb_log_writer_threads - default value will change from ON to OFF ( <span class=\"keyword\">if</span></span><br><span class=\"line\">    <span class=\"comment\">#vcpu &lt;= 32 ).</span></span><br><span class=\"line\">  innodb_numa_interleave - default value will change from OFF to ON.</span><br><span class=\"line\">  innodb_page_cleaners - default value will change from 4 to</span><br><span class=\"line\">    innodb_buffer_pool_instances.</span><br><span class=\"line\">  innodb_parallel_read_threads - default value will change from 4 to</span><br><span class=\"line\">    MAX(#vcpu/8, 4).</span><br><span class=\"line\">  innodb_purge_threads - default value will change from 4 to 1 ( <span class=\"keyword\">if</span> <span class=\"comment\">#vcpu &lt;= 16</span></span><br><span class=\"line\">    ).</span><br><span class=\"line\">  innodb_read_io_threads - default value will change from 4 to MAX(#vcpu/2, 4).</span><br><span class=\"line\">  innodb_redo_log_capacity - default value will change from 104857600 (100MB)</span><br><span class=\"line\">    to MIN ( <span class=\"comment\">#vcpu/2, 16 )GB.</span></span><br><span class=\"line\"></span><br><span class=\"line\">4) Issues reported by <span class=\"string\">&#x27;check table x for upgrade&#x27;</span> <span class=\"built_in\">command</span> (checkTableCommand)</span><br><span class=\"line\">  No issues found</span><br><span class=\"line\"></span><br><span class=\"line\">5) Check <span class=\"keyword\">for</span> deprecated usage of single dollar signs <span class=\"keyword\">in</span> object names</span><br><span class=\"line\">(dollarSignName)</span><br><span class=\"line\">  No issues found</span><br><span class=\"line\"></span><br><span class=\"line\">6) Check <span class=\"keyword\">for</span> deprecated or invalid user authentication methods.</span><br><span class=\"line\">(authMethodUsage)</span><br><span class=\"line\">  Warning: The following <span class=\"built_in\">users</span> are using the <span class=\"string\">&#x27;mysql_native_password&#x27;</span></span><br><span class=\"line\">  authentication method <span class=\"built_in\">which</span> is deprecated as of MySQL 8.0.0 and will be</span><br><span class=\"line\">  removed <span class=\"keyword\">in</span> a future release.</span><br><span class=\"line\">  Consider switching the <span class=\"built_in\">users</span> to a different authentication method (i.e.</span><br><span class=\"line\">  caching_sha2_password).</span><br><span class=\"line\"></span><br><span class=\"line\">  - mydb@%</span><br><span class=\"line\">  - mysql.session@localhost</span><br><span class=\"line\">  - mysql.sys@localhost</span><br><span class=\"line\">  - root@localhost</span><br><span class=\"line\"></span><br><span class=\"line\">  More information:</span><br><span class=\"line\">    https://dev.mysql.com/doc/refman/8.0/en/caching-sha2-pluggable-authentication.html</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">7) Check <span class=\"keyword\">for</span> deprecated or removed plugin usage. (pluginUsage)</span><br><span class=\"line\">  No issues found</span><br><span class=\"line\"></span><br><span class=\"line\">8) Check <span class=\"keyword\">for</span> deprecated or invalid default authentication methods <span class=\"keyword\">in</span> system</span><br><span class=\"line\">variables. (deprecatedDefaultAuth)</span><br><span class=\"line\">  The following variables have problems with their <span class=\"built_in\">set</span> authentication method:</span><br><span class=\"line\"></span><br><span class=\"line\">  Error: default_authentication_plugin - mysql_native_password authentication</span><br><span class=\"line\">    method was removed and it must be corrected before upgrading to 8.4.0 release.</span><br><span class=\"line\"></span><br><span class=\"line\">9) Check <span class=\"keyword\">for</span> deprecated or invalid authentication methods <span class=\"keyword\">in</span> use by MySQL</span><br><span class=\"line\">Router internal accounts. (deprecatedRouterAuthMethod)</span><br><span class=\"line\">  No issues found</span><br><span class=\"line\"></span><br><span class=\"line\">10) Checks <span class=\"keyword\">for</span> errors <span class=\"keyword\">in</span> column definitions (columnDefinition)</span><br><span class=\"line\">  No issues found</span><br><span class=\"line\"></span><br><span class=\"line\">11) Check <span class=\"keyword\">for</span> allowed values <span class=\"keyword\">in</span> System Variables. (sysvarAllowedValues)</span><br><span class=\"line\">  No issues found</span><br><span class=\"line\"></span><br><span class=\"line\">12) Checks <span class=\"keyword\">for</span> user privileges that will be removed (invalidPrivileges)</span><br><span class=\"line\">  Verifies <span class=\"keyword\">for</span> <span class=\"built_in\">users</span> containing grants to be removed, since privileges are</span><br><span class=\"line\">    removed as part of the upgrade, raises a NOTICE to inform the user about</span><br><span class=\"line\">    <span class=\"built_in\">users</span> that will be losing invalid privileges</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"string\">&#x27;mysql.session&#x27;</span>@<span class=\"string\">&#x27;localhost&#x27;</span> - The user <span class=\"string\">&#x27;mysql.session&#x27;</span>@<span class=\"string\">&#x27;localhost&#x27;</span> has the</span><br><span class=\"line\">    following privileges that will be removed as part of the upgrade process:</span><br><span class=\"line\">    SET_USER_ID</span><br><span class=\"line\">  <span class=\"string\">&#x27;root&#x27;</span>@<span class=\"string\">&#x27;localhost&#x27;</span> - The user <span class=\"string\">&#x27;root&#x27;</span>@<span class=\"string\">&#x27;localhost&#x27;</span> has the following privileges</span><br><span class=\"line\">    that will be removed as part of the upgrade process: SET_USER_ID</span><br><span class=\"line\"></span><br><span class=\"line\">13) Checks <span class=\"keyword\">for</span> partitions by key using columns with prefix key indexes</span><br><span class=\"line\">(partitionsWithPrefixKeys)</span><br><span class=\"line\">  No issues found</span><br><span class=\"line\"></span><br><span class=\"line\">Errors:   2</span><br><span class=\"line\">Warnings: 24</span><br><span class=\"line\">Notices:  2</span><br><span class=\"line\"></span><br><span class=\"line\">ERROR: 2 errors were found. Please correct these issues before upgrading to avoid compatibility issues.</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>çœ‹åˆ°äº†ä¸¤å¤„é”™è¯¯ï¼Œå°±æ˜¯æˆ‘ä»¬ä¸Šé¢è¯´çš„é‚£ä¸¤ä¸ªå‚æ•°éœ€è¦ä¿®æ”¹ï¼Œä¿®æ”¹<code>./mysql8.0.30/my.cnf</code></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># binlogæ—¥å¿—è¿‡æœŸæ—¶é—´ï¼Œå•ä½ç§’ï¼Œè¿‡æœŸçš„binlogæ—¥å¿—ä¼šè¢«åˆ é™¤ï¼Œä¿è¯ç£ç›˜ç©ºé—´ï¼Œè¿™é‡Œè®¾ç½®ä¸º10å¤©ï¼Œmysql8ä»¥å‰çš„ç‰ˆæœ¬è¿™ä¸ªå‚æ•°æ˜¯expire-logs-daysï¼Œå•ä½æ˜¯å¤©</span></span><br><span class=\"line\">binlog_expire_logs_seconds =864000</span><br><span class=\"line\"><span class=\"comment\">#expire-logs-days=10</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#default_authentication_plugin=mysql_native_password</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¿®æ”¹åè¦é‡å¯æ•°æ®åº“</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å…³é—­æ•°æ®åº“</span></span><br><span class=\"line\"> ./mysql8.0.30/bin/mysqladmin --defaults-file=./mysql8.0.30/my.cnf -uroot -p123456 shutdown</span><br><span class=\"line\"></span><br><span class=\"line\"> <span class=\"comment\"># ä½¿ç”¨8.0.30å¯åŠ¨</span></span><br><span class=\"line\"> ./mysql8.0.30/bin/mysqld_safe --defaults-file=./mysql8.0.30/my.cnf &amp;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å†æ¬¡è¿›ç¨‹å‡çº§æ£€æŸ¥</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å‡çº§æ£€æŸ¥</span></span><br><span class=\"line\">./mysqlsh8.4.0/bin/mysqlsh --uri root:123456@localhost</span><br><span class=\"line\"><span class=\"comment\"># è¾“å‡º</span></span><br><span class=\"line\">MySQL Shell 8.4.0</span><br><span class=\"line\"></span><br><span class=\"line\">Copyright (c) 2016, 2024, Oracle and/or its affiliates.</span><br><span class=\"line\">Oracle is a registered trademark of Oracle Corporation and/or its affiliates.</span><br><span class=\"line\">Other names may be trademarks of their respective owners.</span><br><span class=\"line\"></span><br><span class=\"line\">Type <span class=\"string\">&#x27;\\help&#x27;</span> or <span class=\"string\">&#x27;\\?&#x27;</span> <span class=\"keyword\">for</span> <span class=\"built_in\">help</span>; <span class=\"string\">&#x27;\\quit&#x27;</span> to <span class=\"built_in\">exit</span>.</span><br><span class=\"line\">WARNING: Using a password on the <span class=\"built_in\">command</span> line interface can be insecure.</span><br><span class=\"line\">Creating a Classic session to <span class=\"string\">&#x27;root@/tmp%2Fmysql.sock&#x27;</span></span><br><span class=\"line\">Fetching global names <span class=\"keyword\">for</span> auto-completion... Press ^C to stop.</span><br><span class=\"line\">Your MySQL connection <span class=\"built_in\">id</span> is 8</span><br><span class=\"line\">Server version: 8.0.30 MySQL Community Server - GPL</span><br><span class=\"line\">No default schema selected; <span class=\"built_in\">type</span> \\use &lt;schema&gt; to <span class=\"built_in\">set</span> one.</span><br><span class=\"line\"> MySQL  localhost  SQL &gt; \\js</span><br><span class=\"line\">Switching to JavaScript mode...</span><br><span class=\"line\"> MySQL  localhost  JS &gt; util.checkForServerUpgrade()</span><br><span class=\"line\">The MySQL server at /tmp%2Fmysql.sock, version 8.0.30 - MySQL Community Server</span><br><span class=\"line\">- GPL, will now be checked <span class=\"keyword\">for</span> compatibility issues <span class=\"keyword\">for</span> upgrade to MySQL 8.4.0.</span><br><span class=\"line\">To check <span class=\"keyword\">for</span> a different target server version, use the targetVersion option.</span><br><span class=\"line\"></span><br><span class=\"line\">WARNING: Upgrading MySQL Server from version 8.0.30 to 8.4.0 is not supported.</span><br><span class=\"line\">Please consider running the check using the following option: targetVersion=8.0</span><br><span class=\"line\"></span><br><span class=\"line\">1) Usage of db objects with names conflicting with new reserved keywords</span><br><span class=\"line\">(reservedKeywords)</span><br><span class=\"line\">  No issues found</span><br><span class=\"line\"></span><br><span class=\"line\">2) Removed system variables (removedSysVars)</span><br><span class=\"line\">  No issues found</span><br><span class=\"line\"></span><br><span class=\"line\">3) System variables with new default values (sysVarsNewDefaults)</span><br><span class=\"line\">  Warning: Following system variables that are not defined <span class=\"keyword\">in</span> your</span><br><span class=\"line\">    configuration file will have new default values. Please review <span class=\"keyword\">if</span> you rely on</span><br><span class=\"line\">    their current values and <span class=\"keyword\">if</span> so define them before performing upgrade.</span><br><span class=\"line\">  More information:</span><br><span class=\"line\">    https://dev.mysql.com/blog-archive/new-defaults-in-mysql-8-0/</span><br><span class=\"line\"></span><br><span class=\"line\">  binlog_transaction_dependency_tracking - default value will change from</span><br><span class=\"line\">    COMMIT_ORDER to WRITESET.</span><br><span class=\"line\">  group_replication_consistency - default value will change from EVENTUAL to</span><br><span class=\"line\">    BEFORE_ON_PRIMARY_FAILOVER.</span><br><span class=\"line\">  group_replication_exit_state_action - default value will change from</span><br><span class=\"line\">    READ_ONLY to OFFLINE_MODE.</span><br><span class=\"line\">  innodb_adaptive_hash_index - default value will change from ON to OFF.</span><br><span class=\"line\">  innodb_buffer_pool_in_core_file - default value will change from ON to OFF.</span><br><span class=\"line\">  innodb_buffer_pool_instances - default value will change from 8 (or 1 <span class=\"keyword\">if</span></span><br><span class=\"line\">    innodb_buffer_pool_size &lt; 1GB) to MAX(1, <span class=\"comment\">#vcpu/4).</span></span><br><span class=\"line\">  innodb_change_buffering - default value will change from all to none.</span><br><span class=\"line\">  innodb_doublewrite_files - default value will change from</span><br><span class=\"line\">    innodb_buffer_pool_instances * 2 to 2.</span><br><span class=\"line\">  innodb_doublewrite_pages - default value will change from</span><br><span class=\"line\">    innodb_write_io_threads to 128.</span><br><span class=\"line\">  innodb_flush_method - default value will change from fsynch (unix) or</span><br><span class=\"line\">    unbuffered (windows) to O_DIRECT.</span><br><span class=\"line\">  innodb_io_capacity - default value will change from 200 to 10000.</span><br><span class=\"line\">  innodb_io_capacity_max - default value will change from 200 to 2 x</span><br><span class=\"line\">    innodb_io_capacity.</span><br><span class=\"line\">  innodb_log_buffer_size - default value will change from 16777216 (16MB) to</span><br><span class=\"line\">    67108864 (64MB).</span><br><span class=\"line\">  innodb_log_writer_threads - default value will change from ON to OFF ( <span class=\"keyword\">if</span></span><br><span class=\"line\">    <span class=\"comment\">#vcpu &lt;= 32 ).</span></span><br><span class=\"line\">  innodb_numa_interleave - default value will change from OFF to ON.</span><br><span class=\"line\">  innodb_page_cleaners - default value will change from 4 to</span><br><span class=\"line\">    innodb_buffer_pool_instances.</span><br><span class=\"line\">  innodb_parallel_read_threads - default value will change from 4 to</span><br><span class=\"line\">    MAX(#vcpu/8, 4).</span><br><span class=\"line\">  innodb_purge_threads - default value will change from 4 to 1 ( <span class=\"keyword\">if</span> <span class=\"comment\">#vcpu &lt;= 16</span></span><br><span class=\"line\">    ).</span><br><span class=\"line\">  innodb_read_io_threads - default value will change from 4 to MAX(#vcpu/2, 4).</span><br><span class=\"line\">  innodb_redo_log_capacity - default value will change from 104857600 (100MB)</span><br><span class=\"line\">    to MIN ( <span class=\"comment\">#vcpu/2, 16 )GB.</span></span><br><span class=\"line\"></span><br><span class=\"line\">4) Issues reported by <span class=\"string\">&#x27;check table x for upgrade&#x27;</span> <span class=\"built_in\">command</span> (checkTableCommand)</span><br><span class=\"line\">  No issues found</span><br><span class=\"line\"></span><br><span class=\"line\">5) Check <span class=\"keyword\">for</span> deprecated usage of single dollar signs <span class=\"keyword\">in</span> object names</span><br><span class=\"line\">(dollarSignName)</span><br><span class=\"line\">  No issues found</span><br><span class=\"line\"></span><br><span class=\"line\">6) Check <span class=\"keyword\">for</span> deprecated or invalid user authentication methods.</span><br><span class=\"line\">(authMethodUsage)</span><br><span class=\"line\">  Warning: The following <span class=\"built_in\">users</span> are using the <span class=\"string\">&#x27;mysql_native_password&#x27;</span></span><br><span class=\"line\">  authentication method <span class=\"built_in\">which</span> is deprecated as of MySQL 8.0.0 and will be</span><br><span class=\"line\">  removed <span class=\"keyword\">in</span> a future release.</span><br><span class=\"line\">  Consider switching the <span class=\"built_in\">users</span> to a different authentication method (i.e.</span><br><span class=\"line\">  caching_sha2_password).</span><br><span class=\"line\"></span><br><span class=\"line\">  - mydb@%</span><br><span class=\"line\">  - mysql.session@localhost</span><br><span class=\"line\">  - mysql.sys@localhost</span><br><span class=\"line\">  - root@localhost</span><br><span class=\"line\"></span><br><span class=\"line\">  More information:</span><br><span class=\"line\">    https://dev.mysql.com/doc/refman/8.0/en/caching-sha2-pluggable-authentication.html</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">7) Check <span class=\"keyword\">for</span> deprecated or removed plugin usage. (pluginUsage)</span><br><span class=\"line\">  No issues found</span><br><span class=\"line\"></span><br><span class=\"line\">8) Check <span class=\"keyword\">for</span> deprecated or invalid default authentication methods <span class=\"keyword\">in</span> system</span><br><span class=\"line\">variables. (deprecatedDefaultAuth)</span><br><span class=\"line\">  No issues found</span><br><span class=\"line\"></span><br><span class=\"line\">9) Check <span class=\"keyword\">for</span> deprecated or invalid authentication methods <span class=\"keyword\">in</span> use by MySQL</span><br><span class=\"line\">Router internal accounts. (deprecatedRouterAuthMethod)</span><br><span class=\"line\">  No issues found</span><br><span class=\"line\"></span><br><span class=\"line\">10) Checks <span class=\"keyword\">for</span> errors <span class=\"keyword\">in</span> column definitions (columnDefinition)</span><br><span class=\"line\">  No issues found</span><br><span class=\"line\"></span><br><span class=\"line\">11) Check <span class=\"keyword\">for</span> allowed values <span class=\"keyword\">in</span> System Variables. (sysvarAllowedValues)</span><br><span class=\"line\">  No issues found</span><br><span class=\"line\"></span><br><span class=\"line\">12) Checks <span class=\"keyword\">for</span> user privileges that will be removed (invalidPrivileges)</span><br><span class=\"line\">  Verifies <span class=\"keyword\">for</span> <span class=\"built_in\">users</span> containing grants to be removed, since privileges are</span><br><span class=\"line\">    removed as part of the upgrade, raises a NOTICE to inform the user about</span><br><span class=\"line\">    <span class=\"built_in\">users</span> that will be losing invalid privileges</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"string\">&#x27;mysql.session&#x27;</span>@<span class=\"string\">&#x27;localhost&#x27;</span> - The user <span class=\"string\">&#x27;mysql.session&#x27;</span>@<span class=\"string\">&#x27;localhost&#x27;</span> has the</span><br><span class=\"line\">    following privileges that will be removed as part of the upgrade process:</span><br><span class=\"line\">    SET_USER_ID</span><br><span class=\"line\">  <span class=\"string\">&#x27;root&#x27;</span>@<span class=\"string\">&#x27;localhost&#x27;</span> - The user <span class=\"string\">&#x27;root&#x27;</span>@<span class=\"string\">&#x27;localhost&#x27;</span> has the following privileges</span><br><span class=\"line\">    that will be removed as part of the upgrade process: SET_USER_ID</span><br><span class=\"line\"></span><br><span class=\"line\">13) Checks <span class=\"keyword\">for</span> partitions by key using columns with prefix key indexes</span><br><span class=\"line\">(partitionsWithPrefixKeys)</span><br><span class=\"line\">  No issues found</span><br><span class=\"line\"></span><br><span class=\"line\">Errors:   0</span><br><span class=\"line\">Warnings: 24</span><br><span class=\"line\">Notices:  2</span><br><span class=\"line\"></span><br><span class=\"line\">NOTE: No fatal errors were found that would prevent an upgrade, but some potential issues were detected. Please ensure that the reported issues are not significant before upgrading.</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ­¤æ—¶çœ‹åˆ°é€šè¿‡æ£€æŸ¥ï¼Œå…³é—­æ•°æ®åº“ç›´æ¥å‡çº§å§</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å…³é—­æ•°æ®åº“</span></span><br><span class=\"line\">./mysql8.0.30/bin/mysqladmin --defaults-file=./mysql8.0.30/my.cnf -uroot -p123456 shutdown</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å¤åˆ¶mysqlé…ç½®æ–‡ä»¶</span></span><br><span class=\"line\"><span class=\"built_in\">cp</span> ./mysql8.0.30/my.cnf ./mysql8.4.0/my.cnf</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ä¿®æ”¹æ–°çš„é…ç½®æ–‡ä»¶ä¸­çš„basedirï¼Œä½¿å…¶æŒ‡å‘8.4.0çš„å®‰è£…è·¯å¾„</span></span><br><span class=\"line\">basedir    = /usr/local/soft/mysql8.4.0</span><br><span class=\"line\"></span><br><span class=\"line\"> <span class=\"comment\"># ä½¿ç”¨8.4.0å¯åŠ¨</span></span><br><span class=\"line\">./mysql8.4.0/bin/mysqld_safe --defaults-file=./mysql8.4.0/my.cnf &amp;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æŸ¥çœ‹æ—¥å¿—ï¼Œä¾æ—§æ˜¯æ²¡æœ‰é”™è¯¯ï¼Œå‡çº§å¾ˆé¡ºåˆ©</p>\n</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">2024-05-09T07:21:55.325669Z 0 [System] [MY-015015] [Server] MySQL Server - start.</span><br><span class=\"line\">2024-05-09T07:21:55.740435Z 0 [Warning] [MY-011070] [Server] &#x27;binlog_format&#x27; is deprecated and will be removed in a future release.</span><br><span class=\"line\">2024-05-09T07:21:55.740549Z 0 [Warning] [MY-010097] [Server] Insecure configuration for --secure-file-priv: Current value does not restrict location of generated files. Consider setting it to a valid, non-empty path.</span><br><span class=\"line\">2024-05-09T07:21:55.740629Z 0 [System] [MY-010116] [Server] /usr/local/soft/mysql-8.4.0-linux-glibc2.17-x86_64/bin/mysqld (mysqld 8.4.0) starting as process 28414</span><br><span class=\"line\">2024-05-09T07:21:55.796983Z 1 [System] [MY-013576] [InnoDB] InnoDB initialization has started.</span><br><span class=\"line\">2024-05-09T07:21:56.421873Z 1 [System] [MY-013577] [InnoDB] InnoDB initialization has ended.</span><br><span class=\"line\">2024-05-09T07:21:56.442008Z 1 [System] [MY-011090] [Server] Data dictionary upgrading from version &#x27;80023&#x27; to &#x27;80300&#x27;.</span><br><span class=\"line\">2024-05-09T07:21:57.106002Z 1 [System] [MY-013413] [Server] Data dictionary upgrade from version &#x27;80023&#x27; to &#x27;80300&#x27; completed.</span><br><span class=\"line\">2024-05-09T07:22:00.128935Z 4 [System] [MY-013381] [Server] Server upgrade from &#x27;80030&#x27; to &#x27;80400&#x27; started.</span><br><span class=\"line\">2024-05-09T07:22:06.850838Z 4 [System] [MY-013381] [Server] Server upgrade from &#x27;80030&#x27; to &#x27;80400&#x27; completed.</span><br><span class=\"line\">2024-05-09T07:22:07.063386Z 0 [Warning] [MY-010068] [Server] CA certificate ca.pem is self signed.</span><br><span class=\"line\">2024-05-09T07:22:07.063456Z 0 [System] [MY-013602] [Server] Channel mysql_main configured to support TLS. Encrypted connections are now supported for this channel.</span><br><span class=\"line\">2024-05-09T07:22:07.085760Z 0 [System] [MY-010931] [Server] /usr/local/soft/mysql-8.4.0-linux-glibc2.17-x86_64/bin/mysqld: ready for connections. Version: &#x27;8.4.0&#x27;  socket: &#x27;/tmp/mysql.sock&#x27;  port: 3306  MySQL Community Server - GPL.</span><br><span class=\"line\">2024-05-09T07:22:07.340333Z 0 [System] [MY-011323] [Server] X Plugin ready for connections. Bind-address: &#x27;::&#x27; port: 33060, socket: /tmp/mysqlx.sock</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>ä»æ—¥å¿—çœ‹åˆ°â€™binlog_formatâ€™ä¹Ÿè¦ä¸æ”¯æŒäº†ï¼Œä¸è¿‡å…ˆä¸ç”¨ç®¡ï¼Œç­‰åˆ°ä¸æ”¯æŒäº†å†å¤„ç†å§ã€‚</p>\n</blockquote>\n<h2 id=\"å¦‚æœå‡çº§åˆ°8-4ä¹‹å‰å¿˜è®°ä¿®æ”¹å¯†ç æ’ä»¶äº†ï¼Œåˆ™å‡çº§ä¹‹åå°±ä¸èƒ½æ­£å¸¸ç™»å½•äº†ï¼Œæ­¤æ—¶æ€ä¹ˆåŠå‘¢ï¼Ÿ\">å¦‚æœå‡çº§åˆ°8.4ä¹‹å‰å¿˜è®°ä¿®æ”¹å¯†ç æ’ä»¶äº†ï¼Œåˆ™å‡çº§ä¹‹åå°±ä¸èƒ½æ­£å¸¸ç™»å½•äº†ï¼Œæ­¤æ—¶æ€ä¹ˆåŠå‘¢ï¼Ÿ</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å‡çº§åˆ°8.4ä¹‹å‰å¿˜è®°ä¿®æ”¹å¯†ç æ’ä»¶äº†ï¼Œåˆ™å‡çº§ä¹‹åç™»å½•æ•°æ®åº“ä¼šæŠ¥å‘Šå¦‚ä¸‹é”™è¯¯</p>\n</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ERROR 1524 (HY000): Plugin &#x27;mysql_native_password&#x27; is not loaded</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è§£å†³æ–¹æ¡ˆ<br>\nåœ¨mysqlçš„é…ç½®æ–‡ä»¶ä¸­å¢åŠ <code>mysql-native-password=ON</code>ï¼Œç„¶åé‡å¯æ•°æ®åº“å³å¯ï¼Œä½†è¿˜æ˜¯å»ºè®®å°½å¿«ä¿®æ”¹ç”¨æˆ·çš„è®¤è¯æ’ä»¶ä¸º<code>caching_sha2_password</code>å§ï¼Œæ¯•ç«Ÿè¿™ä¸ªè®¤è¯æ–¹å¼å­˜åœ¨å®‰å…¨æ¼æ´ã€‚</p>\n</li>\n</ul>\n<div class=\"tips\">\n<p><em><strong>å°è´´å£«</strong></em><br>\nç¬”è€…ä¹‹å‰æ²¡æœ‰æ³¨æ„åˆ°8.4.0æ–°å¢çš„<code>mysql-native-password=ON</code>è¿™ä¸ªé…ç½®ï¼Œæ‰€ä»¥é‡‡ç”¨äº†å¦‚ä¸‹é‡ç½®å¯†ç çš„æ–¹å¼è¿›è¡Œæ’ä»¶ä¿®æ”¹ï¼Œç•™ä¸ªçºªå¿µå§ã€‚</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># killæ‰mysqlæœåŠ¡</span></span><br><span class=\"line\">killall mysqld</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ— æƒé™æ¨¡å¼å¯åŠ¨</span></span><br><span class=\"line\">./mysql8.4.0/bin/mysqld_safe --defaults-file=./mysql8.4.0/my.cnf --skip-grant-tables &amp;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ç™»å½•ï¼Œæ­¤æ—¶ä¸éœ€è¦å¯†ç </span></span><br><span class=\"line\">./mysql8.4.0/bin/mysql -uroot</span><br><span class=\"line\"></span><br><span class=\"line\">mysql&gt; USE mysql;</span><br><span class=\"line\"><span class=\"comment\"># ä¿®æ”¹å¯†ç æ’ä»¶ä¸º caching_sha2_password</span></span><br><span class=\"line\">mysql&gt; UPDATE user SET plugin=<span class=\"string\">&#x27;caching_sha2_password&#x27;</span> WHERE User=<span class=\"string\">&#x27;root&#x27;</span>;</span><br><span class=\"line\"><span class=\"comment\"># å°†å¯†ç è®¾ç½®ä¸ºç©º</span></span><br><span class=\"line\">mysql&gt; UPDATE user SET authentication_string=null WHERE User=<span class=\"string\">&#x27;root&#x27;</span>;</span><br><span class=\"line\"><span class=\"comment\"># åˆ·æ–°æƒé™ï¼š</span></span><br><span class=\"line\">mysql&gt; FLUSH PRIVILEGES;</span><br><span class=\"line\"><span class=\"comment\"># é€€å‡ºMySQL</span></span><br><span class=\"line\">mysql&gt; <span class=\"built_in\">exit</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å…³é—­æ•°æ®åº“ï¼Œæ­¤æ—¶ä¸éœ€è¦å¯†ç å³å¯å…³é—­</span></span><br><span class=\"line\">./mysql8.4.0/bin/mysqladmin --defaults-file=./mysql8.4.0/my.cnf -uroot -p shutdown</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># é‡å¯å¯åŠ¨mysqlæœåŠ¡</span></span><br><span class=\"line\">./mysql8.4.0/bin/mysqld_safe --defaults-file=./mysql8.4.0/my.cnf &amp;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ç™»å½•ï¼Œæ­¤æ—¶ä¾æ—§ä¸éœ€è¦å¯†ç </span></span><br><span class=\"line\">./mysql8.4.0/bin/mysql -uroot</span><br><span class=\"line\"><span class=\"comment\"># è®¾ç½®å¯†ç </span></span><br><span class=\"line\">mysql&gt; ALTER USER <span class=\"string\">&#x27;root&#x27;</span>@<span class=\"string\">&#x27;localhost&#x27;</span> IDENTIFIED BY <span class=\"string\">&#x27;123456&#x27;</span>;</span><br><span class=\"line\"><span class=\"comment\"># åˆ·æ–°æƒé™ï¼š</span></span><br><span class=\"line\">mysql&gt; FLUSH PRIVILEGES;</span><br><span class=\"line\"><span class=\"comment\"># é€€å‡ºMySQL</span></span><br><span class=\"line\">mysql&gt; <span class=\"built_in\">exit</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ç™»å½•ï¼Œæ­¤æ—¶ä½¿ç”¨å¯†ç å°±å¯ä»¥æ­£å¸¸ç™»å½•äº†</span></span><br><span class=\"line\">./mysql8.4.0/bin/mysql -uroot -p123456</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ä¹‹åå†ä¿®æ”¹å…¶ä»–ç”¨æˆ·çš„å¯†ç å³å¯ï¼Œæ¯”å¦‚</span></span><br><span class=\"line\">mysql&gt; ALTER USER <span class=\"string\">&#x27;other&#x27;</span>@<span class=\"string\">&#x27;%&#x27;</span> IDENTIFIED WITH caching_sha2_password BY <span class=\"string\">&#x27;otherpass&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹ä¿®æ”¹åçš„userä¿¡æ¯</span></span><br><span class=\"line\">mysql&gt; use mysql;</span><br><span class=\"line\">mysql&gt; <span class=\"keyword\">select</span> user,host,plugin from user;</span><br></pre></td></tr></table></figure>\n</div>\n","content_text":"æ‘˜è¦ MySqlçŸ¥è¯†ç‚¹ä»‹ç»:ä»Mysql5.7å‡çº§åˆ°Mysql8 æœ¬æ–‡åŸºäºmysql-8.0.30ï¼Œhttps://dev.mysql.com/doc/refman/8.0/en/ 2024-04-30ï¼Œmysql-8.4.0 LTSç‰ˆæœ¬å‘å¸ƒï¼Œæœ¬æ–‡åœ¨å°†mysqlä»5.7.44å‡çº§åˆ°8.0.30çš„åŸºç¡€ä¸Šï¼Œå‡çº§åˆ°8.4.0 LTSç‰ˆæœ¬ã€‚mysql-8.4.0 LTSå®˜æ–¹æ–‡æ¡£ ä»Mysql5.7å‡çº§åˆ°Mysql8 å‡çº§å‰ï¼Œè¯·å…ˆå¤‡ä»½æ•°æ®åº“ï¼Œé˜²æ­¢å‡çº§å¤±è´¥ mysqlsh åœ¨mysql8ä»¥å‰ï¼Œå‡çº§mysqlè¿˜æ˜¯æ¯”è¾ƒéº»çƒ¦çš„ï¼Œé™¤äº†è¦å¤„ç†ä¸å…¼å®¹çš„å‚æ•°å’Œè¯­æ³•å¤–ï¼Œè€Œä¸”ä¸æ”¯æŒè·¨ç‰ˆæœ¬çš„å‡çº§ï¼Œæ¯”å¦‚5.5å¿…é¡»å…ˆå‡çº§åˆ°5.6ï¼Œç„¶åå†å‡çº§åˆ°5.7ã€‚ mysqlshæ˜¯mysqlå®˜æ–¹æä¾›çš„ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼Œæ˜¯MySQLçš„é«˜çº§å®¢æˆ·ç«¯å’Œä»£ç ç¼–è¾‘å™¨ã€‚å…¶ä¸ä»…å¯ä»¥åƒä½¿ç”¨mysqlå‘½ä»¤ä¸€æ ·æ‰§è¡Œsqlï¼Œè€Œä¸”è¿˜æ”¯æŒjsè„šæœ¬ã€pythonè„šæœ¬ï¼Œç­‰ç­‰ï¼Œå…·ä½“å¯ä»¥æŸ¥çœ‹å®˜ç½‘ã€‚ mysqlshçš„ä¼—å¤šåŠŸèƒ½ä¹‹ä¸€å°±æ˜¯å¯ä»¥æ£€æµ‹å½“å‰ç‰ˆæœ¬æ˜¯å¦å¯ä»¥å‡çº§åˆ°ä¸å½“å‰mysqlshç›¸åŒçš„ç‰ˆæœ¬ã€‚ å¦‚æœä½ å½“å‰çš„ç‰ˆæœ¬æ˜¯5.6ï¼Œä½ ç”šè‡³éƒ½ä¸éœ€è¦å…ˆå°†æ•°æ®åº“å‡çº§åˆ°5.7å°±å¯ä»¥ç›´æ¥å‡çº§åˆ°8.0ï¼Œå› ä¸ºmysql8.0æ”¯æŒmysql5.5åˆ°mysql8.0çš„å‡çº§ã€‚ mysqlshå®˜æ–¹æ–‡æ¡£ å®‰è£…mysqlsh å®˜ç½‘ä¸‹è½½åœ°å€ é€‰æ‹©éœ€è¦çš„ç‰ˆæœ¬è¿›è¡Œä¸‹è½½ï¼Œæˆ‘è¿™é‡Œé€‰æ‹©ä¸‹è½½çš„ç‰ˆæœ¬æ˜¯linuxçš„8.0.30ç‰ˆæœ¬ ä¸‹è½½åè§£å‹å³å¯ æ£€æŸ¥æ˜¯å¦å¯ä»¥å‡çº§ å®˜ç½‘è¯´æ˜ 123456789101112# mysqlsh8.4ä»¥å‰å¯ä»¥ä½¿ç”¨å¦‚ä¸‹æ–¹æ³•ï¼Œå› ä¸ºå…¶é»˜è®¤å°±æ˜¯æ‰§è¡Œjsä»£ç ./mysqlsh username:password@host -e &quot;util.checkForServerUpgrade()&quot;# mysqlsh8.4åé»˜è®¤æ‰§è¡Œçš„æ˜¯sqlä»£ç ï¼Œæ‰€ä»¥è¦å…ˆç™»å½•ï¼Œåˆ‡æ¢åˆ°jsç¯å¢ƒåå†è¿è¡Œä¸Šé¢çš„ä»£ç # ç™»å½•./mysqlsh username:password@host MySQL localhost SQL &gt; \\jsSwitching to JavaScript mode... MySQL localhost JS &gt; util.checkForServerUpgrade() â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦ # é€€å‡º MySQL localhost JS &gt; \\qBye! æ£€æŸ¥è¾“å‡ºä¿¡æ¯è¯´æ˜ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148WARNING: Using a password on the command line interface can be insecure.The MySQL server atlocalhost:3306, version5.7.44-log - Please upgrade to 8.0 or opt-in to the paid RDS Extended Supportservice before 5.7 reaches end of standard support on 29 February, 2024:https://a.co/hQqiIn0, will now be checked for compatibility issues for upgradeto MySQL 8.0.30...# æ—§æ—¶é—´ç±»å‹çš„ä½¿ç”¨1) Usage of old temporal type No issues found# ä½¿ç”¨ä¸æ–°ä¿ç•™å…³é”®å­—å†²çªçš„æ•°æ®åº“å¯¹è±¡åç§°2) Usage of db objects with names conflicting with new reserved keywords No issues found# ä½¿ç”¨utf8mb3å­—ç¬¦é›†3) Usage of utf8mb3 charset Warning: The following objects use the utf8mb3 character set. It is recommended to convert them to use utf8mb4 instead, for improved Unicode support. More information: https://dev.mysql.com/doc/refman/8.0/en/charset-unicode-utf8mb3.html mydb - schema&#x27;s default character set: utf8 mysql - schema&#x27;s default character set: utf8 mydb.tbl_info_i.a_product - column&#x27;s default character set: utf8 mydb.tbl_info_i.a_country - column&#x27;s default character set: utf8 mydb.tbl_info_i.a_version - column&#x27;s default character set: utf8 mydb.tbl_info_i.a_placement - column&#x27;s default character set: utf8â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦# MySQLæ¨¡å¼ä¸­çš„è¡¨åä¸8.0ä¸­çš„æ–°è¡¨å†²çª4) Table names in the mysql schema conflicting with new tables in 8.0 No issues found# ä½¿ç”¨éæœ¬æœºåˆ†åŒºå¼•æ“çš„åˆ†åŒºè¡¨5) Partitioned tables using engines with non native partitioning No issues found# å¤–é”®çº¦æŸåç§°è¶…è¿‡64ä¸ªå­—ç¬¦6) Foreign key constraint names longer than 64 characters No issues found# ä½¿ç”¨è¿‡æ—¶çš„MAXDB sql_modeæ ‡å¿—7) Usage of obsolete MAXDB sql_mode flag No issues found# ä½¿ç”¨è¿‡æ—¶çš„sql_modeæ ‡å¿—8) Usage of obsolete sql_mode flags No issues found# ENUM/SETåˆ—å®šä¹‰åŒ…å«è¶…è¿‡255ä¸ªå­—ç¬¦çš„å…ƒç´ 9) ENUM/SET column definitions containing elements longer than 255 characters No issues found# åœ¨å…±äº«è¡¨ç©ºé—´ä¸­ä½¿ç”¨åˆ†åŒºè¡¨10) Usage of partitioned tables in shared tablespaces No issues found# è¡¨ç©ºé—´æ•°æ®æ–‡ä»¶è·¯å¾„ä¸­çš„å¾ªç¯ç›®å½•å¼•ç”¨11) Circular directory references in tablespace data file paths No issues found# ä½¿ç”¨å·²åˆ é™¤çš„å‡½æ•°12) Usage of removed functions No issues found# ä½¿ç”¨å·²åˆ é™¤çš„GROUP BY ASC/DESCè¯­æ³•13) Usage of removed GROUP BY ASC/DESC syntax No issues found# å·²åˆ é™¤çš„ç”¨äºé”™è¯¯æ—¥å¿—è®°å½•åˆ°ç³»ç»Ÿæ—¥å¿—é…ç½®çš„ç³»ç»Ÿå˜é‡14) Removed system variables for error logging to the system log configuration To run this check requires full path to MySQL server configuration file to be specified at &#x27;configPath&#x27; key of options dictionary More information: https://dev.mysql.com/doc/relnotes/mysql/8.0/en/news-8-0-13.html#mysqld-8-0-13-logging# å·²åˆ é™¤çš„ç³»ç»Ÿå˜é‡15) Removed system variables To run this check requires full path to MySQL server configuration file to be specified at &#x27;configPath&#x27; key of options dictionary More information: https://dev.mysql.com/doc/refman/8.0/en/added-deprecated-removed.html#optvars-removed# å…·æœ‰æ–°é»˜è®¤å€¼çš„ç³»ç»Ÿå˜é‡16) System variables with new default values To run this check requires full path to MySQL server configuration file to be specified at &#x27;configPath&#x27; key of options dictionary More information: https://mysqlserverteam.com/new-defaults-in-mysql-8-0/# é›¶æ—¥æœŸã€æ—¥æœŸæ—¶é—´å’Œæ—¶é—´æˆ³å€¼17) Zero Date, Datetime, and Timestamp values Warning: By default zero date/datetime/timestamp values are no longer allowed in MySQL, as of 5.7.8 NO_ZERO_IN_DATE and NO_ZERO_DATE are included in SQL_MODE by default. These modes should be used with strict mode as they will be merged with strict mode in a future release. If you do not include these modes in your SQL_MODE setting, you are able to insert date/datetime/timestamp values that contain zeros. It is strongly advised to replace zero values with valid ones, as they may not work correctly in the future. More information: https://lefred.be/content/mysql-8-0-and-wrong-dates/ global.sql_mode - does not contain either NO_ZERO_DATE or NO_ZERO_IN_DATE which allows insertion of zero dates# ç”±æ–‡ä»¶åˆ é™¤æˆ–æŸåå¯¼è‡´çš„æ¨¡å¼ä¸ä¸€è‡´18) Schema inconsistencies resulting from file removal or corruption No issues found# è¢«InnoDBè¯†åˆ«ä½†å±äºä¸åŒå¼•æ“çš„è¡¨19) Tables recognized by InnoDB that belong to a different engine No issues found# &#x27;check table x for upgrade&#x27;å‘½ä»¤æŠ¥å‘Šçš„é—®é¢˜20) Issues reported by &#x27;check table x for upgrade&#x27; command No issues found# æ–°çš„é»˜è®¤è®¤è¯æ’ä»¶è€ƒè™‘21) New default authentication plugin considerations Warning: The new default authentication plugin &#x27;caching_sha2_password&#x27; offers more secure password hashing than previously used &#x27;mysql_native_password&#x27; (and consequent improved client connection authentication). However, it also has compatibility implications that may affect existing MySQL installations. If your MySQL installation must serve pre-8.0 clients and you encounter compatibility issues after upgrading, the simplest way to address those issues is to reconfigure the server to revert to the previous default authentication plugin (mysql_native_password). For example, use these lines in the server option file: [mysqld] default_authentication_plugin=mysql_native_password However, the setting should be viewed as temporary, not as a long term or permanent solution, because it causes new accounts created with the setting in effect to forego the improved authentication security. If you are using replication please take time to understand how the authentication plugin changes may impact you. More information: https://dev.mysql.com/doc/refman/8.0/en/upgrading-from-previous-series.html#upgrade-caching-sha2-password-compatibility-issues https://dev.mysql.com/doc/refman/8.0/en/upgrading-from-previous-series.html#upgrade-caching-sha2-password-replicationErrors: 0Warnings: 98Notices: 0NOTE: No fatal errors were found that would prevent an upgrade, but some potential issues were detected. Please ensure that the reported issues are not significant before upgrading. å¯ä»¥çœ‹åˆ°ï¼Œå…¶æ£€æŸ¥çš„æ•°æ®åº“ç‰ˆæœ¬æ˜¯5.7.44ï¼Œå…¶æ£€æŸ¥æ˜¯å¦å¯ä»¥å‡çº§åˆ°8.0.30 æ£€æµ‹é¡¹å…±æœ‰21ä¸ªï¼Œå…¶ä¸­è­¦å‘Šæœ‰98ä¸ªï¼Œé”™è¯¯æœ‰0ä¸ªï¼Œæ³¨æ„ï¼Œå¦‚æœæœ‰é”™è¯¯ï¼Œåˆ™ä¸èƒ½ç›´æ¥å‡çº§ï¼Œéœ€è¦è§£å†³é”™è¯¯é—®é¢˜ï¼Œå¦åˆ™å‡çº§ä¼šå¤±è´¥ã€‚è‡³äºè­¦å‘Šæš‚æ—¶å¯ä»¥ä¸å¤„ç†ã€‚ è­¦å‘Šé›†ä¸­ä½“ç°åœ¨å­—ç¬¦é›†ä¸Šï¼Œ5.7.44çš„å­—ç¬¦é›†æ˜¯utf8(å®é™…å°±æ˜¯utf8mb3)ï¼Œè€Œmysql8ä»¥åçš„é»˜è®¤å­—ç¬¦é›†æ˜¯utf8mb4ï¼Œè¿™ä¸ªè­¦å‘Šä¸å½±å“å‡çº§ï¼Œå¯ä»¥å¿½ç•¥ã€‚å¦‚æœéœ€è¦ä¿®æ”¹å­—ç¬¦é›†åˆ°utf8mb4ï¼Œéœ€è¦æ³¨æ„åŸæ¥çš„å­—æ®µå­—ç¬¦ä¸²é•¿åº¦æ˜¯å¦ç¬¦åˆè¦æ±‚ï¼Œå› ä¸ºutf8mb4æ˜¯4å­—èŠ‚ï¼Œè€Œutf8mb3æ˜¯3å­—èŠ‚ã€‚å¦å¤–å¦‚æœä½¿ç”¨äº†å­˜å‚¨è¿‡ç¨‹ä¹Ÿè¦æ³¨æ„å‚æ•°çš„é•¿åº¦æ˜¯å¦ç¬¦åˆè¦æ±‚ã€‚ è¿™é‡Œè¯´ä¸€ä¸‹default_authentication_pluginï¼Œmysql8.0.13å¼€å§‹ï¼Œé»˜è®¤çš„è®¤è¯æ’ä»¶æ˜¯caching_sha2_passwordï¼Œè€Œä¹‹å‰æ˜¯mysql_native_passwordï¼Œè¿™ä¸ªè­¦å‘Šè™½ç„¶å¯ä»¥å¿½ç•¥ï¼Œä½†æ˜¯å‡çº§åå»ºè®®å°½å¿«å°†è®¤è¯æ’ä»¶ä¿®æ”¹ä¸ºcaching_sha2_passwordï¼Œå› ä¸ºmysql_native_passwordçš„è®¤è¯æ–¹å¼å­˜åœ¨å®‰å…¨æ¼æ´ï¼Œå¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£ã€‚å¦å¤–ï¼Œä»mysql8.4.0å¼€å§‹ï¼Œä¸å†æ”¯æŒdefault_authentication_pluginï¼Œè‹¥è¦ä½¿å…¶æ”¯æŒmysql_native_passwordæ’ä»¶ï¼Œ8.4.0å¼€å§‹ä¸ºæˆ‘ä»¬å¢åŠ äº†ä¸€ä¸ªæ–°çš„é…ç½®é¡¹mysql-native-passwordï¼Œåœ¨[mysqld]ä¸­é…ç½®mysql-native-password=ONå³å¯å¼€å¯æ”¯æŒï¼Œé»˜è®¤ä¸ºOFFã€‚ å¦å¤–è¿˜è¦æ³¨æ„å…³é”®è¯å’Œä¿ç•™è¯çš„é—®é¢˜ï¼Œmysql8.0ä»¥åï¼Œåˆå¢åŠ äº†å¾ˆå¤šä¸ªå…³é”®è¯å’Œä¿ç•™è¯ï¼Œå¦‚æœæ£€æŸ¥åˆ°åˆ™éœ€è¦ä¿®æ”¹ä¸€ä¸‹ï¼Œä¸ç„¶å‡çº§ä¼šå¤±è´¥ã€‚å³ä¾¿è¡¨å’Œå­—æ®µé‡Œæ²¡æœ‰ä½¿ç”¨è¿™äº›ä¿ç•™å­—ï¼Œä¹Ÿè¦æ£€æŸ¥ä¸€ä¸‹ä¸šåŠ¡ä»£ç ä¸­æ˜¯å¦æœ‰ä½¿ç”¨ã€‚å…³äºå…³é”®è¯å’Œä¿ç•™è¯å¯ä»¥æŸ¥çœ‹å®˜ç½‘Keywords and Reserved Wordsï¼Œç›¸æ¯”äºMySQL 5.7ï¼Œå¢åŠ äº†å¤§çº¦130ä¸ªï¼ŒåŒæ—¶ä¹Ÿå‡å°‘äº†6ä¸ªã€‚ è¿™é‡Œå»ºè®®è®¾ç½®è¡¨åç§°å’Œå­—æ®µåç§°æ—¶ï¼Œå¯ä»¥ä¸ºå…¶è®¾ç½®å‰ç¼€ï¼Œæ¯”å¦‚ï¼šè¡¨åç§°ä¸ºï¼št_userã€å­—æ®µåç§°ä¸ºï¼šf_user_id è¿˜æœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„ï¼ŒMysql8ä¿®æ”¹äº†å¾ˆå¤šå‚æ•°çš„é»˜è®¤å€¼ï¼Œå…·ä½“å¯ä»¥æŸ¥çœ‹å®˜æ–¹ç½‘ç«™çš„è¯´æ˜ï¼Œå¦‚æœä½ ä¸å¸Œæœ›ä½¿ç”¨é»˜è®¤å€¼ï¼Œåˆ™éœ€è¦å°†å…¶é…ç½®åˆ°é…ç½®æ–‡ä»¶ä¸­ï¼Œè¿™é‡Œå¼ºè°ƒä¸€ä¸‹ï¼Œé‡ç‚¹å…³æ³¨ character_set_server å’Œ collation_server è¿™ä¸¤ä¸ªå‚æ•°ã€‚æ‰€æœ‰çš„å‚æ•°é…ç½®å‚è€ƒå®˜æ–¹æ–‡æ¡£ å…³äºå­—ç¬¦é›†è¿˜æƒ³å¤šè¯´ä¸¤å¥ mysql8çš„character_set_serveré»˜è®¤æ˜¯utf8mb4ï¼Œcollation_serveré»˜è®¤æ˜¯utf8mb4_0900_ai_ci å¦‚æœåˆ›å»ºæ•°æ®åº“æˆ–è€…è¡¨çš„æ—¶å€™æ²¡æœ‰æŒ‡å®šå­—ç¬¦é›†ï¼Œåˆ™é»˜è®¤ä½¿ç”¨character_set_serverå’Œcollation_serverçš„é»˜è®¤å€¼ æ­¤æ—¶æ–°åˆ›å»ºçš„è¡¨å°±æœ‰å¯èƒ½ä¸æ—§è¡¨å­—ç¬¦é›†ä¸ä¸€è‡´ï¼Œå…³è”æŸ¥è¯¢æ—¶å°±æœ‰å¯èƒ½å¯¼è‡´é”™è¯¯æˆ–å› ä¸ºéœ€è¦è¿›è¡Œå­—ç¬¦é›†è½¬æ¢å¯¼è‡´æŸ¥è¯¢æ€§èƒ½ä¸‹é™ã€‚ æœ€å¥½çš„æ–¹å¼æ˜¯åˆ›å»ºæ•°æ®åº“æˆ–è¡¨æ—¶æ˜ç¡®æŒ‡å®šå­—ç¬¦é›†ï¼Œæˆ–è€…åœ¨my.cnfé…ç½®æ–‡ä»¶ä¸­é…ç½®character_set_serverå’Œcollation_serverçš„å€¼ã€‚ å‡çº§æ•°æ®åº“çš„è¿‡ç¨‹ å› ä¸ºæˆ‘ä»¬è¦å‡çº§åˆ°mysql8.0.30ï¼Œæ‰€ä»¥éœ€è¦å…ˆä¸‹è½½å¹¶å®‰è£…mysql8.0.30 å…³é—­mysql5.7çš„æ•°æ®åº“ å¤‡ä»½æ•°æ®ç›®å½•(ä¸€å®šè¦åšå¥½å¤‡ä»½ï¼Œå‡çº§åä¸èƒ½é™çº§çš„) æ ¹æ®æ£€æŸ¥æç¤ºä¿®æ”¹my.cnfé…ç½®æ–‡ä»¶ä¸­çš„é…ç½®(ä¸»è¦æ˜¯ä¸å…¼å®¹çš„é…ç½®ï¼Œå¦‚æœæ£€æŸ¥æç¤ºæ²¡æœ‰åˆ™ä¸éœ€è¦ä¿®æ”¹) éå¸¸é‡è¦çš„ä¸€æ­¥ï¼Œå°±æ˜¯ä¿®æ”¹my.cnfé…ç½®æ–‡ä»¶ä¸­çš„basedirï¼Œå°†å…¶æŒ‡å‘mysql8.0.30çš„å®‰è£…ç›®å½• ç›´æ¥ä½¿ç”¨mysql8.0.30çš„å‘½ä»¤å¯åŠ¨æ•°æ®åº“ï¼Œå¯åŠ¨è¿‡ç¨‹ä¸­å°±ä¼šå®Œæˆæ•°æ®åº“çš„å‡çº§ï¼Œå¯ä»¥é€šè¿‡mysqlçš„æ—¥å¿—æ–‡ä»¶(log-error)æŸ¥çœ‹å‡çº§æƒ…å†µ å‡çº§å®Œæˆåå°½å¿«ä½¿ç”¨æ–°çš„å¯†ç è®¤è¯æ’ä»¶ä¿®æ”¹å¯†ç ï¼Œæ³¨æ„è¦ä¿®æ”¹æ‰€æœ‰ç”¨æˆ·çš„å¯†ç ï¼ŒåŒ…æ‹¬rootç”¨æˆ· 1mysql&gt; ALTER USER &#x27;root&#x27;@&#x27;localhost&#x27; IDENTIFIED WITH caching_sha2_password BY &#x27;123456&#x27;; å°è´´å£« mysql8.4.0ç›¸æ¯”äºä¹‹å‰çš„ç‰ˆæœ¬å˜åŒ–æ¯”è¾ƒå¤§ï¼Œå…·ä½“å¯ä»¥æŸ¥çœ‹å®˜ç½‘æ–‡æ¡£ mysql5.7ä¸è¦ç›´æ¥å‡çº§åˆ°8.4.0åŠä»¥åçš„ç‰ˆæœ¬ï¼Œå¯ä»¥å…ˆå‡çº§åˆ°8.0.30ï¼Œç„¶åå†å‡çº§åˆ°8.4.0 å‡çº§åˆ°8.4.0å‰ä¾æ—§è¦å…ˆä½¿ç”¨mysqlshæ£€æŸ¥æ˜¯å¦å¯ä»¥å‡çº§ï¼Œæ³¨æ„è¦ä¸‹è½½å¯¹åº”çš„mysqlshç‰ˆæœ¬ å‡çº§å‰è¦å…ˆæ£€æŸ¥æ˜¯å¦æ‰€æœ‰ç”¨æˆ·çš„å¯†ç æ’ä»¶éƒ½æ˜¯caching_sha2_passwordï¼Œå¦‚æœæ²¡æœ‰åˆ™éœ€è¦ä¿®æ”¹ å‡çº§å‰è¦å…ˆæ£€æŸ¥my.cnfä¸­æ˜¯å¦é…ç½®äº†default_authentication_pluginï¼Œå¦‚æœæœ‰åˆ™åˆ é™¤ï¼Œå¦‚æœå¿…é¡»è¦é…ç½®mysql_native_passwordè®¤è¯æ’ä»¶ï¼Œåˆ™éœ€è¦é…ç½®mysql-native-password=ON ä¿®æ”¹my.cnfä¸­çš„basedirä½¿å…¶æŒ‡å‘8.4.0çš„å®‰è£…ç›®å½• ä½¿ç”¨8.4.0çš„å‘½ä»¤å¯åŠ¨mysqlï¼Œæ£€æŸ¥æ—¥å¿—æ˜¯å¦æœ‰é”™è¯¯ã€‚ mysql5.7.44å‡çº§åˆ°8.0.30ï¼Œå†å‡çº§åˆ°8.4.0çš„å®Œæ•´è¿‡ç¨‹ å‡†å¤‡å¥½å„ä¸ªç‰ˆæœ¬çš„mysqlå’Œmysqlsh 1234567# ç›®å½•ç»“æ„mysql5 # 5.7.44å®‰è£…ç›®å½•mysql8.0.30 # 8.0.30å®‰è£…ç›®å½•mysql8.4.0 # 8.4.0å®‰è£…ç›®å½•mysqlsh8.0.30 # 8.0.30çš„mysqlshå®‰è£…ç›®å½•mysqlsh8.4.0 # 8.4.0çš„mysqlshå®‰è£…ç›®å½•datas/mysql # å­˜æ”¾æ•°æ®ç›®å½• mysql5/my.cnfé…ç½® 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758[mysql]default-character-set=utf8mb4local_infile=ON[client]default-character-set=utf8mb4port = 3306socket = /tmp/mysql.sock[mysqld]skip-name-resolvesecure_file_priv=&quot;&quot;local_infile=ONdefault_authentication_plugin=mysql_native_passwordport = 3306server-id = 1001user = mysqlsocket = /tmp/mysql.sockbasedir = /usr/local/soft/mysql5datadir = /usr/local/soft/datas/mysqllog-bin = mysql-binbinlog-format = ROWexpire-logs-days=10sync-binlog=0innodb_data_home_dir =./innodb_log_group_home_dir =./log-error =mysql.logpid-file =mysql.pidcharacter-set-server=utf8mb4lower_case_table_names=1autocommit =1slow_query_log=1slow_query_log_file=db_slow.loglong_query_time=5log_output=FILElog_queries_not_using_indexes=1skip-external-lockingkey_buffer_size = 256Mmax_allowed_packet = 64Mtable_open_cache = 1024sort_buffer_size = 4Mnet_buffer_length = 8Kread_buffer_size = 4Mread_rnd_buffer_size = 512Kmyisam_sort_buffer_size = 64Mthread_cache_size = 64tmp_table_size = 128Mexplicit_defaults_for_timestamp = truemax_connections = 500max_connect_errors = 100open_files_limit = 65535default_storage_engine = InnoDBinnodb_data_file_path = ibdata1:10M:autoextend 5.7.44å‡çº§åˆ°8.0.30 å‡çº§æ£€æŸ¥ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122# å‡çº§æ£€æŸ¥./mysqlsh8.0.30/bin/mysqlsh --uri root:123456@localhost -e &quot;util.checkForServerUpgrade()&quot;# è¾“å‡ºWARNING: Using a password on the command line interface can be insecure.The MySQL server at /tmp%2Fmysql.sock, version 5.7.44-log - MySQL CommunityServer (GPL), will now be checked for compatibility issues for upgrade to MySQL8.0.30...1) Usage of old temporal type No issues found2) Usage of db objects with names conflicting with new reserved keywords No issues found3) Usage of utf8mb3 charset Warning: The following objects use the utf8mb3 character set. It is recommended to convert them to use utf8mb4 instead, for improved Unicode support. More information: https://dev.mysql.com/doc/refman/8.0/en/charset-unicode-utf8mb3.html mydb - schema&#x27;s default character set: utf8 mysql - schema&#x27;s default character set: utf8 mydb.tbl_info_i.a_product - column&#x27;s default character set: utf8 mydb.tbl_info_i.a_country - column&#x27;s default character set: utf8 mydb.tbl_info_i.a_version - column&#x27;s default character set: utf8 mydb.tbl_info_i.a_placement - column&#x27;s default character set: utf8 â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦4) Table names in the mysql schema conflicting with new tables in 8.0 No issues found5) Partitioned tables using engines with non native partitioning No issues found6) Foreign key constraint names longer than 64 characters No issues found7) Usage of obsolete MAXDB sql_mode flag No issues found8) Usage of obsolete sql_mode flags Notice: The following DB objects have obsolete options persisted for sql_mode, which will be cleared during upgrade to 8.0. More information: https://dev.mysql.com/doc/refman/8.0/en/mysql-nutshell.html#mysql-nutshell-removals global system variable sql_mode - defined using obsolete NO_AUTO_CREATE_USER option9) ENUM/SET column definitions containing elements longer than 255 characters No issues found10) Usage of partitioned tables in shared tablespaces No issues found11) Circular directory references in tablespace data file paths No issues found12) Usage of removed functions No issues found13) Usage of removed GROUP BY ASC/DESC syntax No issues found14) Removed system variables for error logging to the system log configuration To run this check requires full path to MySQL server configuration file to be specified at &#x27;configPath&#x27; key of options dictionary More information: https://dev.mysql.com/doc/relnotes/mysql/8.0/en/news-8-0-13.html#mysqld-8-0-13-logging15) Removed system variables To run this check requires full path to MySQL server configuration file to be specified at &#x27;configPath&#x27; key of options dictionary More information: https://dev.mysql.com/doc/refman/8.0/en/added-deprecated-removed.html#optvars-removed16) System variables with new default values To run this check requires full path to MySQL server configuration file to be specified at &#x27;configPath&#x27; key of options dictionary More information: https://mysqlserverteam.com/new-defaults-in-mysql-8-0/17) Zero Date, Datetime, and Timestamp values No issues found18) Schema inconsistencies resulting from file removal or corruption No issues found19) Tables recognized by InnoDB that belong to a different engine No issues found20) Issues reported by &#x27;check table x for upgrade&#x27; command No issues found21) New default authentication plugin considerations Warning: The new default authentication plugin &#x27;caching_sha2_password&#x27; offers more secure password hashing than previously used &#x27;mysql_native_password&#x27; (and consequent improved client connection authentication). However, it also has compatibility implications that may affect existing MySQL installations. If your MySQL installation must serve pre-8.0 clients and you encounter compatibility issues after upgrading, the simplest way to address those issues is to reconfigure the server to revert to the previous default authentication plugin (mysql_native_password). For example, use these lines in the server option file: [mysqld] default_authentication_plugin=mysql_native_password However, the setting should be viewed as temporary, not as a long term or permanent solution, because it causes new accounts created with the setting in effect to forego the improved authentication security. If you are using replication please take time to understand how the authentication plugin changes may impact you. More information: https://dev.mysql.com/doc/refman/8.0/en/upgrading-from-previous-series.html#upgrade-caching-sha2-password-compatibility-issues https://dev.mysql.com/doc/refman/8.0/en/upgrading-from-previous-series.html#upgrade-caching-sha2-password-replicationErrors: 0Warnings: 98Notices: 1NOTE: No fatal errors were found that would prevent an upgrade, but some potential issues were detected. Please ensure that the reported issues are not significant before upgrading. çœ‹åˆ°æ²¡æœ‰errorï¼Œå¼€å§‹å‡çº§ 1234567891011# å…³é—­æ•°æ®åº“./mysql5/bin/mysqladmin --defaults-file=./mysql5/my.cnf -uroot -p123456 shutdown# å¤åˆ¶mysqlé…ç½®æ–‡ä»¶cp ./mysql5/my.cnf ./mysql8.0.30/my.cnf# ä¿®æ”¹æ–°çš„é…ç½®æ–‡ä»¶ä¸­çš„basedirï¼Œä½¿å…¶æŒ‡å‘8.0.30çš„å®‰è£…è·¯å¾„basedir = /usr/local/soft/mysql8.0.30# ä½¿ç”¨8.0.30å¯åŠ¨./mysql8.0.30/bin/mysqld_safe --defaults-file=./mysql8.0.30/my.cnf &amp; æŸ¥çœ‹å¯åŠ¨æ—¥å¿—ï¼Œæ²¡æœ‰é”™è¯¯è¯´æ˜å‡çº§æˆåŠŸ 12345678910111213142024-05-09T06:48:50.524705Z 0 [Warning] [MY-011068] [Server] The syntax &#x27;expire-logs-days&#x27; is deprecated and will be removed in a future release. Please use binlog_expire_logs_seconds instead.2024-05-09T06:48:50.524819Z 0 [Warning] [MY-010097] [Server] Insecure configuration for --secure-file-priv: Current value does not restrict location of generated files. Consider setting it to a valid, non-empty path.2024-05-09T06:48:50.524917Z 0 [Warning] [MY-010918] [Server] &#x27;default_authentication_plugin&#x27; is deprecated and will be removed in a future release. Please use authentication_policy instead.2024-05-09T06:48:50.524983Z 0 [System] [MY-010116] [Server] /usr/local/soft/mysql8.0.30/bin/mysqld (mysqld 8.0.30) starting as process 266962024-05-09T06:48:50.563366Z 1 [System] [MY-011012] [Server] Starting upgrade of data directory.2024-05-09T06:48:50.563414Z 1 [System] [MY-013576] [InnoDB] InnoDB initialization has started.2024-05-09T06:48:51.260298Z 1 [System] [MY-013577] [InnoDB] InnoDB initialization has ended.2024-05-09T06:48:53.614398Z 2 [System] [MY-011003] [Server] Finished populating Data Dictionary tables with data.2024-05-09T06:48:55.055320Z 5 [System] [MY-013381] [Server] Server upgrade from &#x27;50700&#x27; to &#x27;80030&#x27; started.2024-05-09T06:49:02.063990Z 5 [System] [MY-013381] [Server] Server upgrade from &#x27;50700&#x27; to &#x27;80030&#x27; completed.2024-05-09T06:49:02.237992Z 0 [Warning] [MY-010068] [Server] CA certificate ca.pem is self signed.2024-05-09T06:49:02.238048Z 0 [System] [MY-013602] [Server] Channel mysql_main configured to support TLS. Encrypted connections are now supported for this channel.2024-05-09T06:49:02.267583Z 0 [System] [MY-011323] [Server] X Plugin ready for connections. Bind-address: &#x27;::&#x27; port: 33060, socket: /tmp/mysqlx.sock2024-05-09T06:49:02.267648Z 0 [System] [MY-010931] [Server] /usr/local/soft/mysql8.0.30/bin/mysqld: ready for connections. Version: &#x27;8.0.30&#x27; socket: &#x27;/tmp/mysql.sock&#x27; port: 3306 MySQL Community Server - GPL. æ ¹æ®æ—¥å¿—æç¤ºæˆ‘ä»¬åº”è¯¥ä¿®æ”¹ä¸¤ä¸ªé…ç½®å‚æ•°ï¼Œæœªæ¥å°†ä¸å¯ç”¨äº†ï¼Œä¸è¿‡è¿™é‡Œæš‚ä¸”å…ˆä¸å»ç®¡å®ƒï¼Œç­‰æ£€æŸ¥é€šä¸è¿‡äº†å†è¿›è¡Œå¤„ç†å°±å¯ä»¥ã€‚ 121.The syntax &#x27;expire-logs-days&#x27; is deprecated and will be removed in a future release. Please use binlog_expire_logs_seconds instead.2.&#x27;default_authentication_plugin&#x27; is deprecated and will be removed in a future release. Please use authentication_policy instead. ä¿®æ”¹å¯†ç æ’ä»¶ï¼Œè¿™ä¸ªæ­¥éª¤å¾ˆé‡è¦ 1234# ç™»å½•./mysql8.0.30/bin/mysql -uroot -p123456# å‡çº§å®Œæˆåä½¿ç”¨æ–°çš„å¯†ç è®¤è¯æ’ä»¶ä¿®æ”¹å¯†ç ï¼Œ8.4ä¸å†æ¨èmysql_native_passwordè®¤è¯æ’ï¼Œæ‰€ä»¥å‡çº§åˆ°8.4ä»¥å‰ä¸€å®šè¦å…ˆä¿®æ”¹å¯†ç æ’ä»¶ï¼Œå¦‚æœå¿˜è®°äº†ä¹Ÿæ²¡å…³ç³»ï¼Œæ–‡æœ«æœ‰é‡ç½®å¯†ç çš„æ–¹æ³•mysql&gt; ALTER USER &#x27;root&#x27;@&#x27;localhost&#x27; IDENTIFIED WITH caching_sha2_password BY &#x27;123456&#x27;; 8.0.30å‡çº§åˆ°8.4.0 åŒæ ·å…ˆç”¨8.4.0çš„mysqlshæ£€æŸ¥ä¸€ä¸‹ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145# å‡çº§æ£€æŸ¥./mysqlsh8.4.0/bin/mysqlsh --uri root:123456@localhost# è¾“å‡ºMySQL Shell 8.4.0Copyright (c) 2016, 2024, Oracle and/or its affiliates.Oracle is a registered trademark of Oracle Corporation and/or its affiliates.Other names may be trademarks of their respective owners.Type &#x27;\\help&#x27; or &#x27;\\?&#x27; for help; &#x27;\\quit&#x27; to exit.WARNING: Using a password on the command line interface can be insecure.Creating a Classic session to &#x27;root@/tmp%2Fmysql.sock&#x27;Fetching global names for auto-completion... Press ^C to stop.Your MySQL connection id is 15Server version: 8.0.30 MySQL Community Server - GPLNo default schema selected; type \\use &lt;schema&gt; to set one. MySQL localhost SQL &gt; \\jsSwitching to JavaScript mode... MySQL localhost JS &gt; util.checkForServerUpgrade()The MySQL server at /tmp%2Fmysql.sock, version 8.0.30 - MySQL Community Server- GPL, will now be checked for compatibility issues for upgrade to MySQL 8.4.0.To check for a different target server version, use the targetVersion option.WARNING: Upgrading MySQL Server from version 8.0.30 to 8.4.0 is not supported.Please consider running the check using the following option: targetVersion=8.01) Usage of db objects with names conflicting with new reserved keywords(reservedKeywords) No issues found2) Removed system variables (removedSysVars) Error: Following system variables that were detected as being used will be removed. Please update your system to not rely on them before the upgrade. More information: https://dev.mysql.com/doc/refman/8.0/en/added-deprecated-removed.html#optvars-removed expire_logs_days - Error: The system variable &#x27;expire_logs_days&#x27; is set to 10 (EXPLICIT) and will be removed.3) System variables with new default values (sysVarsNewDefaults) Warning: Following system variables that are not defined in your configuration file will have new default values. Please review if you rely on their current values and if so define them before performing upgrade. More information: https://dev.mysql.com/blog-archive/new-defaults-in-mysql-8-0/ binlog_transaction_dependency_tracking - default value will change from COMMIT_ORDER to WRITESET. group_replication_consistency - default value will change from EVENTUAL to BEFORE_ON_PRIMARY_FAILOVER. group_replication_exit_state_action - default value will change from READ_ONLY to OFFLINE_MODE. innodb_adaptive_hash_index - default value will change from ON to OFF. innodb_buffer_pool_in_core_file - default value will change from ON to OFF. innodb_buffer_pool_instances - default value will change from 8 (or 1 if innodb_buffer_pool_size &lt; 1GB) to MAX(1, #vcpu/4). innodb_change_buffering - default value will change from all to none. innodb_doublewrite_files - default value will change from innodb_buffer_pool_instances * 2 to 2. innodb_doublewrite_pages - default value will change from innodb_write_io_threads to 128. innodb_flush_method - default value will change from fsynch (unix) or unbuffered (windows) to O_DIRECT. innodb_io_capacity - default value will change from 200 to 10000. innodb_io_capacity_max - default value will change from 200 to 2 x innodb_io_capacity. innodb_log_buffer_size - default value will change from 16777216 (16MB) to 67108864 (64MB). innodb_log_writer_threads - default value will change from ON to OFF ( if #vcpu &lt;= 32 ). innodb_numa_interleave - default value will change from OFF to ON. innodb_page_cleaners - default value will change from 4 to innodb_buffer_pool_instances. innodb_parallel_read_threads - default value will change from 4 to MAX(#vcpu/8, 4). innodb_purge_threads - default value will change from 4 to 1 ( if #vcpu &lt;= 16 ). innodb_read_io_threads - default value will change from 4 to MAX(#vcpu/2, 4). innodb_redo_log_capacity - default value will change from 104857600 (100MB) to MIN ( #vcpu/2, 16 )GB.4) Issues reported by &#x27;check table x for upgrade&#x27; command (checkTableCommand) No issues found5) Check for deprecated usage of single dollar signs in object names(dollarSignName) No issues found6) Check for deprecated or invalid user authentication methods.(authMethodUsage) Warning: The following users are using the &#x27;mysql_native_password&#x27; authentication method which is deprecated as of MySQL 8.0.0 and will be removed in a future release. Consider switching the users to a different authentication method (i.e. caching_sha2_password). - mydb@% - mysql.session@localhost - mysql.sys@localhost - root@localhost More information: https://dev.mysql.com/doc/refman/8.0/en/caching-sha2-pluggable-authentication.html7) Check for deprecated or removed plugin usage. (pluginUsage) No issues found8) Check for deprecated or invalid default authentication methods in systemvariables. (deprecatedDefaultAuth) The following variables have problems with their set authentication method: Error: default_authentication_plugin - mysql_native_password authentication method was removed and it must be corrected before upgrading to 8.4.0 release.9) Check for deprecated or invalid authentication methods in use by MySQLRouter internal accounts. (deprecatedRouterAuthMethod) No issues found10) Checks for errors in column definitions (columnDefinition) No issues found11) Check for allowed values in System Variables. (sysvarAllowedValues) No issues found12) Checks for user privileges that will be removed (invalidPrivileges) Verifies for users containing grants to be removed, since privileges are removed as part of the upgrade, raises a NOTICE to inform the user about users that will be losing invalid privileges &#x27;mysql.session&#x27;@&#x27;localhost&#x27; - The user &#x27;mysql.session&#x27;@&#x27;localhost&#x27; has the following privileges that will be removed as part of the upgrade process: SET_USER_ID &#x27;root&#x27;@&#x27;localhost&#x27; - The user &#x27;root&#x27;@&#x27;localhost&#x27; has the following privileges that will be removed as part of the upgrade process: SET_USER_ID13) Checks for partitions by key using columns with prefix key indexes(partitionsWithPrefixKeys) No issues foundErrors: 2Warnings: 24Notices: 2ERROR: 2 errors were found. Please correct these issues before upgrading to avoid compatibility issues. çœ‹åˆ°äº†ä¸¤å¤„é”™è¯¯ï¼Œå°±æ˜¯æˆ‘ä»¬ä¸Šé¢è¯´çš„é‚£ä¸¤ä¸ªå‚æ•°éœ€è¦ä¿®æ”¹ï¼Œä¿®æ”¹./mysql8.0.30/my.cnf 12345# binlogæ—¥å¿—è¿‡æœŸæ—¶é—´ï¼Œå•ä½ç§’ï¼Œè¿‡æœŸçš„binlogæ—¥å¿—ä¼šè¢«åˆ é™¤ï¼Œä¿è¯ç£ç›˜ç©ºé—´ï¼Œè¿™é‡Œè®¾ç½®ä¸º10å¤©ï¼Œmysql8ä»¥å‰çš„ç‰ˆæœ¬è¿™ä¸ªå‚æ•°æ˜¯expire-logs-daysï¼Œå•ä½æ˜¯å¤©binlog_expire_logs_seconds =864000#expire-logs-days=10#default_authentication_plugin=mysql_native_password ä¿®æ”¹åè¦é‡å¯æ•°æ®åº“ 12345# å…³é—­æ•°æ®åº“ ./mysql8.0.30/bin/mysqladmin --defaults-file=./mysql8.0.30/my.cnf -uroot -p123456 shutdown # ä½¿ç”¨8.0.30å¯åŠ¨ ./mysql8.0.30/bin/mysqld_safe --defaults-file=./mysql8.0.30/my.cnf &amp; å†æ¬¡è¿›ç¨‹å‡çº§æ£€æŸ¥ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136# å‡çº§æ£€æŸ¥./mysqlsh8.4.0/bin/mysqlsh --uri root:123456@localhost# è¾“å‡ºMySQL Shell 8.4.0Copyright (c) 2016, 2024, Oracle and/or its affiliates.Oracle is a registered trademark of Oracle Corporation and/or its affiliates.Other names may be trademarks of their respective owners.Type &#x27;\\help&#x27; or &#x27;\\?&#x27; for help; &#x27;\\quit&#x27; to exit.WARNING: Using a password on the command line interface can be insecure.Creating a Classic session to &#x27;root@/tmp%2Fmysql.sock&#x27;Fetching global names for auto-completion... Press ^C to stop.Your MySQL connection id is 8Server version: 8.0.30 MySQL Community Server - GPLNo default schema selected; type \\use &lt;schema&gt; to set one. MySQL localhost SQL &gt; \\jsSwitching to JavaScript mode... MySQL localhost JS &gt; util.checkForServerUpgrade()The MySQL server at /tmp%2Fmysql.sock, version 8.0.30 - MySQL Community Server- GPL, will now be checked for compatibility issues for upgrade to MySQL 8.4.0.To check for a different target server version, use the targetVersion option.WARNING: Upgrading MySQL Server from version 8.0.30 to 8.4.0 is not supported.Please consider running the check using the following option: targetVersion=8.01) Usage of db objects with names conflicting with new reserved keywords(reservedKeywords) No issues found2) Removed system variables (removedSysVars) No issues found3) System variables with new default values (sysVarsNewDefaults) Warning: Following system variables that are not defined in your configuration file will have new default values. Please review if you rely on their current values and if so define them before performing upgrade. More information: https://dev.mysql.com/blog-archive/new-defaults-in-mysql-8-0/ binlog_transaction_dependency_tracking - default value will change from COMMIT_ORDER to WRITESET. group_replication_consistency - default value will change from EVENTUAL to BEFORE_ON_PRIMARY_FAILOVER. group_replication_exit_state_action - default value will change from READ_ONLY to OFFLINE_MODE. innodb_adaptive_hash_index - default value will change from ON to OFF. innodb_buffer_pool_in_core_file - default value will change from ON to OFF. innodb_buffer_pool_instances - default value will change from 8 (or 1 if innodb_buffer_pool_size &lt; 1GB) to MAX(1, #vcpu/4). innodb_change_buffering - default value will change from all to none. innodb_doublewrite_files - default value will change from innodb_buffer_pool_instances * 2 to 2. innodb_doublewrite_pages - default value will change from innodb_write_io_threads to 128. innodb_flush_method - default value will change from fsynch (unix) or unbuffered (windows) to O_DIRECT. innodb_io_capacity - default value will change from 200 to 10000. innodb_io_capacity_max - default value will change from 200 to 2 x innodb_io_capacity. innodb_log_buffer_size - default value will change from 16777216 (16MB) to 67108864 (64MB). innodb_log_writer_threads - default value will change from ON to OFF ( if #vcpu &lt;= 32 ). innodb_numa_interleave - default value will change from OFF to ON. innodb_page_cleaners - default value will change from 4 to innodb_buffer_pool_instances. innodb_parallel_read_threads - default value will change from 4 to MAX(#vcpu/8, 4). innodb_purge_threads - default value will change from 4 to 1 ( if #vcpu &lt;= 16 ). innodb_read_io_threads - default value will change from 4 to MAX(#vcpu/2, 4). innodb_redo_log_capacity - default value will change from 104857600 (100MB) to MIN ( #vcpu/2, 16 )GB.4) Issues reported by &#x27;check table x for upgrade&#x27; command (checkTableCommand) No issues found5) Check for deprecated usage of single dollar signs in object names(dollarSignName) No issues found6) Check for deprecated or invalid user authentication methods.(authMethodUsage) Warning: The following users are using the &#x27;mysql_native_password&#x27; authentication method which is deprecated as of MySQL 8.0.0 and will be removed in a future release. Consider switching the users to a different authentication method (i.e. caching_sha2_password). - mydb@% - mysql.session@localhost - mysql.sys@localhost - root@localhost More information: https://dev.mysql.com/doc/refman/8.0/en/caching-sha2-pluggable-authentication.html7) Check for deprecated or removed plugin usage. (pluginUsage) No issues found8) Check for deprecated or invalid default authentication methods in systemvariables. (deprecatedDefaultAuth) No issues found9) Check for deprecated or invalid authentication methods in use by MySQLRouter internal accounts. (deprecatedRouterAuthMethod) No issues found10) Checks for errors in column definitions (columnDefinition) No issues found11) Check for allowed values in System Variables. (sysvarAllowedValues) No issues found12) Checks for user privileges that will be removed (invalidPrivileges) Verifies for users containing grants to be removed, since privileges are removed as part of the upgrade, raises a NOTICE to inform the user about users that will be losing invalid privileges &#x27;mysql.session&#x27;@&#x27;localhost&#x27; - The user &#x27;mysql.session&#x27;@&#x27;localhost&#x27; has the following privileges that will be removed as part of the upgrade process: SET_USER_ID &#x27;root&#x27;@&#x27;localhost&#x27; - The user &#x27;root&#x27;@&#x27;localhost&#x27; has the following privileges that will be removed as part of the upgrade process: SET_USER_ID13) Checks for partitions by key using columns with prefix key indexes(partitionsWithPrefixKeys) No issues foundErrors: 0Warnings: 24Notices: 2NOTE: No fatal errors were found that would prevent an upgrade, but some potential issues were detected. Please ensure that the reported issues are not significant before upgrading. æ­¤æ—¶çœ‹åˆ°é€šè¿‡æ£€æŸ¥ï¼Œå…³é—­æ•°æ®åº“ç›´æ¥å‡çº§å§ 1234567891011# å…³é—­æ•°æ®åº“./mysql8.0.30/bin/mysqladmin --defaults-file=./mysql8.0.30/my.cnf -uroot -p123456 shutdown# å¤åˆ¶mysqlé…ç½®æ–‡ä»¶cp ./mysql8.0.30/my.cnf ./mysql8.4.0/my.cnf# ä¿®æ”¹æ–°çš„é…ç½®æ–‡ä»¶ä¸­çš„basedirï¼Œä½¿å…¶æŒ‡å‘8.4.0çš„å®‰è£…è·¯å¾„basedir = /usr/local/soft/mysql8.4.0 # ä½¿ç”¨8.4.0å¯åŠ¨./mysql8.4.0/bin/mysqld_safe --defaults-file=./mysql8.4.0/my.cnf &amp; æŸ¥çœ‹æ—¥å¿—ï¼Œä¾æ—§æ˜¯æ²¡æœ‰é”™è¯¯ï¼Œå‡çº§å¾ˆé¡ºåˆ© 12345678910111213142024-05-09T07:21:55.325669Z 0 [System] [MY-015015] [Server] MySQL Server - start.2024-05-09T07:21:55.740435Z 0 [Warning] [MY-011070] [Server] &#x27;binlog_format&#x27; is deprecated and will be removed in a future release.2024-05-09T07:21:55.740549Z 0 [Warning] [MY-010097] [Server] Insecure configuration for --secure-file-priv: Current value does not restrict location of generated files. Consider setting it to a valid, non-empty path.2024-05-09T07:21:55.740629Z 0 [System] [MY-010116] [Server] /usr/local/soft/mysql-8.4.0-linux-glibc2.17-x86_64/bin/mysqld (mysqld 8.4.0) starting as process 284142024-05-09T07:21:55.796983Z 1 [System] [MY-013576] [InnoDB] InnoDB initialization has started.2024-05-09T07:21:56.421873Z 1 [System] [MY-013577] [InnoDB] InnoDB initialization has ended.2024-05-09T07:21:56.442008Z 1 [System] [MY-011090] [Server] Data dictionary upgrading from version &#x27;80023&#x27; to &#x27;80300&#x27;.2024-05-09T07:21:57.106002Z 1 [System] [MY-013413] [Server] Data dictionary upgrade from version &#x27;80023&#x27; to &#x27;80300&#x27; completed.2024-05-09T07:22:00.128935Z 4 [System] [MY-013381] [Server] Server upgrade from &#x27;80030&#x27; to &#x27;80400&#x27; started.2024-05-09T07:22:06.850838Z 4 [System] [MY-013381] [Server] Server upgrade from &#x27;80030&#x27; to &#x27;80400&#x27; completed.2024-05-09T07:22:07.063386Z 0 [Warning] [MY-010068] [Server] CA certificate ca.pem is self signed.2024-05-09T07:22:07.063456Z 0 [System] [MY-013602] [Server] Channel mysql_main configured to support TLS. Encrypted connections are now supported for this channel.2024-05-09T07:22:07.085760Z 0 [System] [MY-010931] [Server] /usr/local/soft/mysql-8.4.0-linux-glibc2.17-x86_64/bin/mysqld: ready for connections. Version: &#x27;8.4.0&#x27; socket: &#x27;/tmp/mysql.sock&#x27; port: 3306 MySQL Community Server - GPL.2024-05-09T07:22:07.340333Z 0 [System] [MY-011323] [Server] X Plugin ready for connections. Bind-address: &#x27;::&#x27; port: 33060, socket: /tmp/mysqlx.sock ä»æ—¥å¿—çœ‹åˆ°â€™binlog_formatâ€™ä¹Ÿè¦ä¸æ”¯æŒäº†ï¼Œä¸è¿‡å…ˆä¸ç”¨ç®¡ï¼Œç­‰åˆ°ä¸æ”¯æŒäº†å†å¤„ç†å§ã€‚ å¦‚æœå‡çº§åˆ°8.4ä¹‹å‰å¿˜è®°ä¿®æ”¹å¯†ç æ’ä»¶äº†ï¼Œåˆ™å‡çº§ä¹‹åå°±ä¸èƒ½æ­£å¸¸ç™»å½•äº†ï¼Œæ­¤æ—¶æ€ä¹ˆåŠå‘¢ï¼Ÿ å‡çº§åˆ°8.4ä¹‹å‰å¿˜è®°ä¿®æ”¹å¯†ç æ’ä»¶äº†ï¼Œåˆ™å‡çº§ä¹‹åç™»å½•æ•°æ®åº“ä¼šæŠ¥å‘Šå¦‚ä¸‹é”™è¯¯ 1ERROR 1524 (HY000): Plugin &#x27;mysql_native_password&#x27; is not loaded è§£å†³æ–¹æ¡ˆ åœ¨mysqlçš„é…ç½®æ–‡ä»¶ä¸­å¢åŠ mysql-native-password=ONï¼Œç„¶åé‡å¯æ•°æ®åº“å³å¯ï¼Œä½†è¿˜æ˜¯å»ºè®®å°½å¿«ä¿®æ”¹ç”¨æˆ·çš„è®¤è¯æ’ä»¶ä¸ºcaching_sha2_passwordå§ï¼Œæ¯•ç«Ÿè¿™ä¸ªè®¤è¯æ–¹å¼å­˜åœ¨å®‰å…¨æ¼æ´ã€‚ å°è´´å£« ç¬”è€…ä¹‹å‰æ²¡æœ‰æ³¨æ„åˆ°8.4.0æ–°å¢çš„mysql-native-password=ONè¿™ä¸ªé…ç½®ï¼Œæ‰€ä»¥é‡‡ç”¨äº†å¦‚ä¸‹é‡ç½®å¯†ç çš„æ–¹å¼è¿›è¡Œæ’ä»¶ä¿®æ”¹ï¼Œç•™ä¸ªçºªå¿µå§ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243# killæ‰mysqlæœåŠ¡killall mysqld# æ— æƒé™æ¨¡å¼å¯åŠ¨./mysql8.4.0/bin/mysqld_safe --defaults-file=./mysql8.4.0/my.cnf --skip-grant-tables &amp;# ç™»å½•ï¼Œæ­¤æ—¶ä¸éœ€è¦å¯†ç ./mysql8.4.0/bin/mysql -urootmysql&gt; USE mysql;# ä¿®æ”¹å¯†ç æ’ä»¶ä¸º caching_sha2_passwordmysql&gt; UPDATE user SET plugin=&#x27;caching_sha2_password&#x27; WHERE User=&#x27;root&#x27;;# å°†å¯†ç è®¾ç½®ä¸ºç©ºmysql&gt; UPDATE user SET authentication_string=null WHERE User=&#x27;root&#x27;;# åˆ·æ–°æƒé™ï¼šmysql&gt; FLUSH PRIVILEGES;# é€€å‡ºMySQLmysql&gt; exit;# å…³é—­æ•°æ®åº“ï¼Œæ­¤æ—¶ä¸éœ€è¦å¯†ç å³å¯å…³é—­./mysql8.4.0/bin/mysqladmin --defaults-file=./mysql8.4.0/my.cnf -uroot -p shutdown# é‡å¯å¯åŠ¨mysqlæœåŠ¡./mysql8.4.0/bin/mysqld_safe --defaults-file=./mysql8.4.0/my.cnf &amp;# ç™»å½•ï¼Œæ­¤æ—¶ä¾æ—§ä¸éœ€è¦å¯†ç ./mysql8.4.0/bin/mysql -uroot# è®¾ç½®å¯†ç mysql&gt; ALTER USER &#x27;root&#x27;@&#x27;localhost&#x27; IDENTIFIED BY &#x27;123456&#x27;;# åˆ·æ–°æƒé™ï¼šmysql&gt; FLUSH PRIVILEGES;# é€€å‡ºMySQLmysql&gt; exit;# ç™»å½•ï¼Œæ­¤æ—¶ä½¿ç”¨å¯†ç å°±å¯ä»¥æ­£å¸¸ç™»å½•äº†./mysql8.4.0/bin/mysql -uroot -p123456# ä¹‹åå†ä¿®æ”¹å…¶ä»–ç”¨æˆ·çš„å¯†ç å³å¯ï¼Œæ¯”å¦‚mysql&gt; ALTER USER &#x27;other&#x27;@&#x27;%&#x27; IDENTIFIED WITH caching_sha2_password BY &#x27;otherpass&#x27;;# æŸ¥çœ‹ä¿®æ”¹åçš„userä¿¡æ¯mysql&gt; use mysql;mysql&gt; select user,host,plugin from user;","summary":"æ‘˜è¦ MySqlçŸ¥è¯†ç‚¹ä»‹ç»:ä»Mysql5.7å‡çº§åˆ°Mysql8 æœ¬æ–‡åŸºäºmysql-8.0.30ï¼Œhttps://dev.mysql.com/doc/refman/8.0/en/ 2024-04-30ï¼Œmysql-8.4.0 LTSç‰ˆæœ¬å‘å¸ƒï¼Œæœ¬æ–‡åœ¨å°†mysqlä»5.7.44å‡çº§åˆ°8.0.30çš„åŸºç¡€ä¸Šï¼Œå‡çº§åˆ°8.4.0 LTSç‰ˆæœ¬ã€‚mysql-8.4.0 LTSå®˜æ–¹æ–‡æ¡£","date_published":"2024-05-08T13:35:05.000Z","tags":["æŠ€æœ¯","mysql","mysql"]},{"id":"https://blog.hanqunfeng.com/2024/04/08/mongodb7-pool-springboot/","url":"https://blog.hanqunfeng.com/2024/04/08/mongodb7-pool-springboot/","title":"MongoDB7.0--SpringBooté…ç½®mongodbè¿æ¥æ± ","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç»å¦‚ä½•ä½¿ç”¨SpringBooté…ç½®MongoDB7.0çš„è¿æ¥æ± </p>\n</li>\n<li class=\"lvl-2\">\n<p>SpringBootç‰ˆæœ¬3.2.4ï¼ŒMongoDBç‰ˆæœ¬7.0.6</p>\n</li>\n<li class=\"lvl-2\">\n<p>å…³äºspringbootä¸mongodbçš„é›†æˆå¯ä»¥å‚è€ƒï¼š<a href=\"/2024/03/05/mongodb7-springboot/\" title=\"MongoDB7.0--SpringBootå•é›†åˆæ“ä½œ\">MongoDB7.0--SpringBootå•é›†åˆæ“ä½œ</a>ï¼Œæœ¬æ–‡åªè®¨è®ºè¿æ¥æ± ç›¸å…³å†…å®¹ã€‚</p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"spring-boot-çš„-MongoDB-è¿æ¥æ± \">spring-boot çš„ MongoDB è¿æ¥æ± </h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å½“æˆ‘ä»¬åœ¨springbootçš„é…ç½®æ–‡ä»¶ä¸­é…ç½®mongodbçš„ç›¸å…³å±æ€§æ—¶ï¼Œå¹¶æ²¡æœ‰å‘ç°å’Œè¿æ¥æ± ç›¸å…³çš„å±æ€§ï¼ŒæŸ¥çœ‹<code>MongoProperties</code>ä¸­çš„å±æ€§ä¹Ÿå¯ä»¥è¯å®è¿™ä¸€ç‚¹ï¼Œè¿™å°±å¾ˆå¥‡æ€ªï¼ŒæŒ‰ç†è¯´springbootåº”è¯¥ä¸ä¼šè¿™ä¹ˆå¼±é¸¡ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>äºæ˜¯æˆ‘æ‰“ç®—çœ‹çœ‹springbootçš„æºç ï¼Œçœ‹çœ‹springbootä¸ºæˆ‘ä»¬è‡ªåŠ¨åˆ›å»ºçš„<code>MongoClient</code>åˆ°åº•æœ‰æ²¡æœ‰è¿æ¥æ± çš„é…ç½®ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>æˆ‘ä»¬å°±ä»mongodbçš„è‡ªåŠ¨é…ç½®ç±»<code>MongoAutoConfiguration</code>å¼€å§‹ï¼Œè¯¥ç±»ä¸­å®šä¹‰äº†<code>PropertiesMongoConnectionDetails</code>å’Œ<code>MongoClient</code></p>\n</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//è¿™ä¸ªç±»ä¸»è¦ç”¨äºConnectionStringå¯¹è±¡çš„å°è£…ï¼Œåé¢ä¼šè®²åˆ°</span></span><br><span class=\"line\"><span class=\"meta\">@Bean</span></span><br><span class=\"line\"><span class=\"meta\">@ConditionalOnMissingBean(&#123;MongoConnectionDetails.class&#125;)</span></span><br><span class=\"line\">PropertiesMongoConnectionDetails <span class=\"title function_\">mongoConnectionDetails</span><span class=\"params\">(MongoProperties properties)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">PropertiesMongoConnectionDetails</span>(properties);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Bean</span></span><br><span class=\"line\"><span class=\"meta\">@ConditionalOnMissingBean(&#123;MongoClient.class&#125;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> MongoClient <span class=\"title function_\">mongo</span><span class=\"params\">(ObjectProvider&lt;MongoClientSettingsBuilderCustomizer&gt; builderCustomizers, MongoClientSettings settings)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> (MongoClient)(<span class=\"keyword\">new</span> <span class=\"title class_\">MongoClientFactory</span>(builderCustomizers.orderedStream().toList())).createMongoClient(settings);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¯ä»¥çœ‹åˆ°ï¼Œåˆ›å»º<code>MongoClient</code>çš„beanæ—¶ï¼Œä¾èµ–ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ˜¯<code>ObjectProvider&lt;MongoClientSettingsBuilderCustomizer&gt;</code>ï¼Œä¸€ä¸ªæ˜¯<code>MongoClientSettings</code>ï¼Œå‰è€…ä¼šå°†springä¸Šä¸‹æ–‡ä¸­æ‰€æœ‰ç±»å‹ä¸º<code>MongoClientSettingsBuilderCustomizer</code>çš„beanå°è£…åˆ°è¯¥å¯¹è±¡ä¸­(springbooté»˜è®¤åªæä¾›äº†ä¸€ä¸ª<code>StandardMongoClientSettingsBuilderCustomizer</code>)</p>\n</li>\n<li class=\"lvl-2\">\n<p><code>MongoAutoConfiguration</code>ç¼ºçœä¸ºæˆ‘ä»¬æä¾›äº†<code>MongoClientSettings</code>å’Œ<code>StandardMongoClientSettingsBuilderCustomizer</code>ï¼Œè¿™ä¸¤ä¸ªç±»éƒ½å¾ˆé‡è¦ï¼Œè¿æ¥æ± å‚æ•°å°±å’Œå®ƒä»¬æœ‰å…³</p>\n</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Bean</span></span><br><span class=\"line\">MongoClientSettings <span class=\"title function_\">mongoClientSettings</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> MongoClientSettings.builder().build();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// éœ€è¦çš„å‚æ•°connectionDetailsåˆšå¥½æ˜¯ä¸Šé¢çš„PropertiesMongoConnectionDetails</span></span><br><span class=\"line\"><span class=\"meta\">@Bean</span></span><br><span class=\"line\">StandardMongoClientSettingsBuilderCustomizer <span class=\"title function_\">standardMongoSettingsCustomizer</span><span class=\"params\">(MongoProperties properties, MongoConnectionDetails connectionDetails, ObjectProvider&lt;SslBundles&gt; sslBundles)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">StandardMongoClientSettingsBuilderCustomizer</span>(connectionDetails.getConnectionString(), properties.getUuidRepresentation(), properties.getSsl(), (SslBundles)sslBundles.getIfAvailable());</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æˆ‘ä»¬å…ˆçœ‹<code>MongoClientSettings</code>ï¼Œå…¶ä¸­å°±å®šä¹‰ä¸€ä¸ªè¿æ¥æ± çš„é…ç½®å¯¹è±¡<code>ConnectionPoolSettings</code>ï¼Œè€Œ<code>ConnectionPoolSettings</code>å…¶å†…éƒ¨å°±å®šä¹‰äº†è¿æ¥æ± çš„é…ç½®å±æ€§ï¼Œ<code>MongoClientSettings</code>é€šè¿‡<code>ConnectionPoolSettings</code>çš„æ„é€ å™¨åˆ›å»ºå‡ºäº†<code>ConnectionPoolSettings</code>å¯¹è±¡ï¼Œå…¶ç¼ºçœå€¼å¦‚ä¸‹ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"type\">int</span> <span class=\"variable\">maxSize</span> <span class=\"operator\">=</span> <span class=\"number\">100</span>;</span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"type\">int</span> minSize;</span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"type\">long</span> <span class=\"variable\">maxWaitTimeMS</span> <span class=\"operator\">=</span> <span class=\"number\">1000</span> * <span class=\"number\">60</span> * <span class=\"number\">2</span>;</span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"type\">long</span> maxConnectionLifeTimeMS;</span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"type\">long</span> maxConnectionIdleTimeMS;</span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"type\">int</span> <span class=\"variable\">maxConnecting</span> <span class=\"operator\">=</span> <span class=\"number\">2</span>;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æˆ‘ä»¬çœ‹å¦ä¸€ä¸ªå’Œåˆ›å»º<code>MongoClient</code>ç›¸å…³çš„beanï¼Œè¿™ä¸ª<code>StandardMongoClientSettingsBuilderCustomizer</code>ï¼Œåˆ›å»ºè¿™ä¸ªbeanæ—¶éœ€è¦ä¸€ä¸ª<code>MongoConnectionDetails</code>å¯¹è±¡ï¼Œå¹¶è°ƒç”¨å…¶<code>getConnectionString</code>æ–¹æ³•ï¼Œè¿™ä¸ªå¯¹è±¡<code>MongoAutoConfiguration</code>ä¹Ÿä¸ºæˆ‘ä»¬æä¾›äº†(ä¸Šé¢å¯ä»¥çœ‹åˆ°)</p>\n</li>\n<li class=\"lvl-2\">\n<p>æŸ¥çœ‹<code>PropertiesMongoConnectionDetails</code>çš„æºç ï¼Œå‘ç°<code>connectionDetails.getConnectionString()</code>çš„åŠŸèƒ½å°±æ˜¯å°†<code>MongoProperties</code>çš„å±æ€§å°è£…ä¸º<code>uri</code>å¹¶ä¼ é€’ç»™<code>ConnectionString</code>çš„æ„é€ å™¨åˆ›å»ºå¯¹è±¡</p>\n</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> ConnectionString <span class=\"title function_\">getConnectionString</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"built_in\">this</span>.properties.getUri() != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ConnectionString</span>(<span class=\"built_in\">this</span>.properties.getUri());</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">StringBuilder</span> <span class=\"variable\">builder</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">StringBuilder</span>(<span class=\"string\">&quot;mongodb://&quot;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"built_in\">this</span>.properties.getUsername() != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">            builder.append(<span class=\"built_in\">this</span>.encode(<span class=\"built_in\">this</span>.properties.getUsername()));</span><br><span class=\"line\">            builder.append(<span class=\"string\">&quot;:&quot;</span>);</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (<span class=\"built_in\">this</span>.properties.getPassword() != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                builder.append(<span class=\"built_in\">this</span>.encode(<span class=\"built_in\">this</span>.properties.getPassword()));</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            builder.append(<span class=\"string\">&quot;@&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        builder.append(<span class=\"built_in\">this</span>.properties.getHost() != <span class=\"literal\">null</span> ? <span class=\"built_in\">this</span>.properties.getHost() : <span class=\"string\">&quot;localhost&quot;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"built_in\">this</span>.properties.getPort() != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">            builder.append(<span class=\"string\">&quot;:&quot;</span>);</span><br><span class=\"line\">            builder.append(<span class=\"built_in\">this</span>.properties.getPort());</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"built_in\">this</span>.properties.getAdditionalHosts() != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">            builder.append(<span class=\"string\">&quot;,&quot;</span>);</span><br><span class=\"line\">            builder.append(String.join(<span class=\"string\">&quot;,&quot;</span>, <span class=\"built_in\">this</span>.properties.getAdditionalHosts()));</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        builder.append(<span class=\"string\">&quot;/&quot;</span>);</span><br><span class=\"line\">        builder.append(<span class=\"built_in\">this</span>.properties.getMongoClientDatabase());</span><br><span class=\"line\">        List&lt;String&gt; options = <span class=\"built_in\">this</span>.getOptions();</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!options.isEmpty()) &#123;</span><br><span class=\"line\">            builder.append(<span class=\"string\">&quot;?&quot;</span>);</span><br><span class=\"line\">            builder.append(String.join(<span class=\"string\">&quot;&amp;&quot;</span>, options));</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">// å°†MongoPropertiesè½¬æ¢ä¸ºuriæ ¼å¼åè°ƒç”¨æ„é€ å™¨åˆ›å»ºConnectionString</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ConnectionString</span>(builder.toString());</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¿™ä¸ª<code>ConnectionString</code>å¯¹è±¡çš„åˆå§‹åŒ–è¿‡ç¨‹å°±å¾ˆæœ‰æ„æ€äº†ï¼Œå…¶ä¼šå¯¹è¿™ä¸ª<code>uri</code>è¿›è¡Œè§£æï¼Œè§£æè¿‡ç¨‹ä¸­ä¼šè°ƒç”¨<code>parseOptions(connectionStringQueryParameters)</code>æ–¹æ³•ï¼Œå…¶ä¼šå°†<code>uri</code>ä¸­çš„å‚æ•°è½¬æ¢ä¸º<code>Map</code>ï¼Œä¹‹åè°ƒç”¨<code>translateOptions(combinedOptionsMaps)</code>æ–¹æ³•éå†è¿™ä¸ªmapï¼Œè€Œåœ¨éå†çš„è¿‡ç¨‹ä¸­å°±ä¼šå®Œæˆå¯¹<code>ConnectionString</code>å¯¹è±¡çš„è¿æ¥æ± ç›¸å…³å±æ€§çš„åˆå§‹åŒ–</p>\n</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title function_\">translateOptions</span><span class=\"params\">(<span class=\"keyword\">final</span> Map&lt;String, List&lt;String&gt;&gt; optionsMap)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">boolean</span> <span class=\"variable\">tlsInsecureSet</span> <span class=\"operator\">=</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">        <span class=\"type\">boolean</span> <span class=\"variable\">tlsAllowInvalidHostnamesSet</span> <span class=\"operator\">=</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">final</span> String key : GENERAL_OPTIONS_KEYS) &#123;</span><br><span class=\"line\">            <span class=\"type\">String</span> <span class=\"variable\">value</span> <span class=\"operator\">=</span> getLastValue(optionsMap, key);</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (value == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">continue</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">switch</span> (key) &#123;</span><br><span class=\"line\">                <span class=\"comment\">// è¿æ¥æ± ç›¸å…³å±æ€§ï¼Œæ³¨æ„è¿™é‡Œçš„å±æ€§åç§°ï¼Œåé¢æˆ‘ä»¬é…ç½®è¿æ¥æ± æ—¶ä¼šç”¨åˆ°</span></span><br><span class=\"line\">                <span class=\"keyword\">case</span> <span class=\"string\">&quot;maxpoolsize&quot;</span>:</span><br><span class=\"line\">                    maxConnectionPoolSize = parseInteger(value, <span class=\"string\">&quot;maxpoolsize&quot;</span>);</span><br><span class=\"line\">                    <span class=\"keyword\">break</span>;</span><br><span class=\"line\">                <span class=\"keyword\">case</span> <span class=\"string\">&quot;minpoolsize&quot;</span>:</span><br><span class=\"line\">                    minConnectionPoolSize = parseInteger(value, <span class=\"string\">&quot;minpoolsize&quot;</span>);</span><br><span class=\"line\">                    <span class=\"keyword\">break</span>;</span><br><span class=\"line\">                <span class=\"keyword\">case</span> <span class=\"string\">&quot;maxidletimems&quot;</span>:</span><br><span class=\"line\">                    maxConnectionIdleTime = parseInteger(value, <span class=\"string\">&quot;maxidletimems&quot;</span>);</span><br><span class=\"line\">                    <span class=\"keyword\">break</span>;</span><br><span class=\"line\">                <span class=\"keyword\">case</span> <span class=\"string\">&quot;maxlifetimems&quot;</span>:</span><br><span class=\"line\">                    maxConnectionLifeTime = parseInteger(value, <span class=\"string\">&quot;maxlifetimems&quot;</span>);</span><br><span class=\"line\">                    <span class=\"keyword\">break</span>;</span><br><span class=\"line\">                <span class=\"keyword\">case</span> <span class=\"string\">&quot;maxconnecting&quot;</span>:</span><br><span class=\"line\">                    maxConnecting = parseInteger(value, <span class=\"string\">&quot;maxConnecting&quot;</span>);</span><br><span class=\"line\">                    <span class=\"keyword\">break</span>;</span><br><span class=\"line\">                <span class=\"keyword\">case</span> <span class=\"string\">&quot;waitqueuetimeoutms&quot;</span>:</span><br><span class=\"line\">                    maxWaitTime = parseInteger(value, <span class=\"string\">&quot;waitqueuetimeoutms&quot;</span>);</span><br><span class=\"line\">                    <span class=\"keyword\">break</span>;</span><br><span class=\"line\">                <span class=\"keyword\">case</span> <span class=\"string\">&quot;connecttimeoutms&quot;</span>:</span><br><span class=\"line\">                    connectTimeout = parseInteger(value, <span class=\"string\">&quot;connecttimeoutms&quot;</span>);</span><br><span class=\"line\">                    <span class=\"keyword\">break</span>;</span><br><span class=\"line\">           â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å…¶å®æ­¤æ—¶æˆ‘ä»¬å°±å·²ç»çŸ¥é“åº”è¯¥å¦‚ä½•é…ç½®è¿æ¥æ± å‚æ•°äº†ï¼Œå°±æ˜¯å°†è¿æ¥æ± ç›¸å…³çš„å‚æ•°è¿½åŠ åˆ°<code>uri</code>çš„å‚æ•°éƒ¨åˆ†ï¼Œä½†æ˜¯å‰é¢æˆ‘ä»¬æåˆ°è´Ÿè´£è¿æ¥æ± çš„ç±»æ˜¯<code>ConnectionPoolSettings</code>ï¼Œé‚£ä¹ˆ<code>ConnectionString</code>å¯¹è±¡ä¸­çš„è¿æ¥æ± å±æ€§æ˜¯å¦‚ä½•è¢«ä¼ é€’ç»™<code>ConnectionPoolSettings</code>çš„å‘¢ï¼Œæˆ‘ä»¬æ¥ç€å¾€ä¸‹çœ‹ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å‚æ•°å‡†å¤‡å¥½åå°±å¼€å§‹åˆ›å»º<code>MongoClient</code>äº†ï¼Œå…¶ä¼šè°ƒç”¨<code>MongoClientFactory</code>çš„<code>createMongoClient</code>æ–¹æ³•ï¼Œå…¶ä¼šå¯¹<code>MongoClientSettings</code>å¯¹è±¡åšè¿›ä¸€æ­¥çš„å°è£…ï¼Œå¹¶æœ€ç»ˆåŸºäºå°è£…åçš„<code>MongoClientSettings</code>å¯¹è±¡åˆ›å»ºå‡º<code>MongoClient</code>å¯¹è±¡</p>\n</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> T <span class=\"title function_\">createMongoClient</span><span class=\"params\">(MongoClientSettings settings)</span> &#123;</span><br><span class=\"line\">    <span class=\"type\">Builder</span> <span class=\"variable\">targetSettings</span> <span class=\"operator\">=</span> MongoClientSettings.builder(settings);</span><br><span class=\"line\">    customize(targetSettings);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>.clientCreator.apply(targetSettings.build(), driverInformation());</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title function_\">customize</span><span class=\"params\">(Builder builder)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (MongoClientSettingsBuilderCustomizer customizer : <span class=\"built_in\">this</span>.builderCustomizers) &#123;</span><br><span class=\"line\">        customizer.customize(builder);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è€Œåœ¨è¿›ä¸€æ­¥å°è£…<code>MongoClientSettings</code>å¯¹è±¡æ—¶ï¼Œä¼šè°ƒç”¨ç³»ç»Ÿä¸­æ‰€æœ‰è¢«springç®¡ç†çš„<code>MongoClientSettingsBuilderCustomizer</code>,å®é™…ä¸Šä¹Ÿå°±æ˜¯<code>StandardMongoClientSettingsBuilderCustomizer</code>çš„<code>customize</code>æ–¹æ³•ï¼Œå…¶åˆä¼šè°ƒç”¨<code>MongoClientSettings.builder()</code>çš„<code>applyConnectionSettings</code>æ–¹æ³•ï¼Œè€Œåœ¨è¯¥æ–¹æ³•ä¸­è°ƒç”¨<code>connectionPoolSettingsBuilder.applyConnectionString(connectionString);</code>å°±å®Œæˆäº†å°†<code>ConnectionString</code>å¯¹è±¡ä¸­çš„è¿æ¥æ± å±æ€§ä¼ é€’ç»™<code>ConnectionPoolSettings</code>å¯¹è±¡çš„è¿‡ç¨‹ï¼Œå½“ç„¶ï¼Œå¦‚æœå±æ€§æ²¡æœ‰è·å–åˆ°å°±ä¼šä½¿ç”¨é»˜è®¤å€¼ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åŸºäºéœ€è¦é…ç½®ç›¸å…³çš„å±æ€§ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> Builder <span class=\"title function_\">applyConnectionString</span><span class=\"params\">(<span class=\"keyword\">final</span> ConnectionString connectionString)</span> &#123;</span><br><span class=\"line\">    <span class=\"type\">Integer</span> <span class=\"variable\">maxConnectionPoolSize</span> <span class=\"operator\">=</span> connectionString.getMaxConnectionPoolSize();</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (maxConnectionPoolSize != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">        maxSize(maxConnectionPoolSize);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"type\">Integer</span> <span class=\"variable\">minConnectionPoolSize</span> <span class=\"operator\">=</span> connectionString.getMinConnectionPoolSize();</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (minConnectionPoolSize != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">        minSize(minConnectionPoolSize);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"type\">Integer</span> <span class=\"variable\">maxWaitTime</span> <span class=\"operator\">=</span> connectionString.getMaxWaitTime();</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (maxWaitTime != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">        maxWaitTime(maxWaitTime, MILLISECONDS);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"type\">Integer</span> <span class=\"variable\">maxConnectionIdleTime</span> <span class=\"operator\">=</span> connectionString.getMaxConnectionIdleTime();</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (maxConnectionIdleTime != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">        maxConnectionIdleTime(maxConnectionIdleTime, MILLISECONDS);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"type\">Integer</span> <span class=\"variable\">maxConnectionLifeTime</span> <span class=\"operator\">=</span> connectionString.getMaxConnectionLifeTime();</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (maxConnectionLifeTime != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">        maxConnectionLifeTime(maxConnectionLifeTime, MILLISECONDS);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"type\">Integer</span> <span class=\"variable\">maxConnecting</span> <span class=\"operator\">=</span> connectionString.getMaxConnecting();</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (maxConnecting != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">        maxConnecting(maxConnecting);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¤§ä½“è¿‡ç¨‹å°±æ˜¯è¿™æ ·ï¼Œå¾ˆç»•ï¼Œç®€å•ç‚¹è¯´å°±æ˜¯springbootå·²ç»ä¸ºæˆ‘ä»¬æä¾›äº†mongodbçš„è¿æ¥æ± ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åŸºäºéœ€è¦ï¼Œåœ¨é…ç½®<code>mongodb-uri</code>æ—¶ï¼Œå¢åŠ ç›¸å…³çš„è¿æ¥æ± å‚æ•°ï¼Œspringbootå°±ä¼šæŒ‰ç…§æˆ‘ä»¬é…ç½®çš„å‚æ•°ä¸ºæˆ‘ä»¬åˆ›å»ºè¿æ¥æ± ï¼Œå¹¶è‡ªåŠ¨ç®¡ç†è¿æ¥æ± ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight yml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">spring:</span></span><br><span class=\"line\">  <span class=\"attr\">data:</span></span><br><span class=\"line\">    <span class=\"attr\">mongodb:</span></span><br><span class=\"line\">      <span class=\"attr\">uri:</span> <span class=\"string\">mongodb://user:password@127.0.0.1:27040,127.0.0.1:27041,127.0.0.1:27042/mytest?authSource=admin&amp;readPreference=primaryPreferred&amp;maxpoolsize=100&amp;minpoolsize=10&amp;maxidletimems=0&amp;maxlifetimems=0&amp;maxconnecting=5&amp;waitqueuetimeoutms=60000</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å‚æ•°è¯´æ˜</p>\n</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">maxpoolsize: 100 # æ± ä¸­å…è®¸çš„æœ€å¤§è¿æ¥æ•°ã€‚ä¸€æ—¦æ± è€—å°½ï¼Œä»»ä½•éœ€è¦è¿æ¥çš„æ“ä½œéƒ½å°†åœ¨é˜»å¡é˜Ÿåˆ—ä¸­ç­‰å¾…ç›´åˆ°è·å–åˆ°è¿æ¥ï¼Œ é»˜è®¤: 100</span><br><span class=\"line\">minpoolsize: 10 # æ± ä¸­å…è®¸çš„æœ€å°è¿æ¥æ•°ã€‚è¿™äº›è¿æ¥åœ¨ç©ºé—²æ—¶å°†ä¿ç•™åœ¨æ± ä¸­ï¼Œå¹¶ä¸”æ± å°†ç¡®ä¿å®ƒè‡³å°‘åŒ…å«è¿™ä¸ªæœ€å°æ•°é‡ é»˜è®¤: 0</span><br><span class=\"line\">maxidletimems: 0 # æ± è¿æ¥çš„æœ€å¤§ç©ºé—²æ—¶é—´ã€‚é›¶å€¼è¡¨ç¤ºå¯¹ç©ºé—²æ—¶é—´æ²¡æœ‰é™åˆ¶ã€‚è¶…è¿‡å…¶ç©ºé—²æ—¶é—´çš„æ± è¿æ¥å°†è¢«å…³é—­å¹¶åœ¨å¿…è¦æ—¶ç”±æ–°è¿æ¥æ›¿æ¢ã€‚å•ä½ä¸ºæ¯«ç§’</span><br><span class=\"line\">maxlifetimems: 0 # æ± è¿æ¥å¯ä»¥å­˜æ´»çš„æœ€é•¿æ—¶é—´ã€‚é›¶å€¼è¡¨ç¤ºå¯¿å‘½æ²¡æœ‰é™åˆ¶ã€‚è¶…è¿‡å…¶ç”Ÿå‘½å‘¨æœŸçš„æ± è¿æ¥å°†è¢«å…³é—­å¹¶åœ¨å¿…è¦æ—¶ç”±æ–°è¿æ¥æ›¿æ¢ã€‚å•ä½ä¸ºæ¯«ç§’</span><br><span class=\"line\">maxconnecting: 5 # åŒä¸€æ—¶åˆ»å…è®¸çš„æœ€å¤§å¹¶è¡Œè¿æ¥æ•°ã€‚é»˜è®¤å€¼æ˜¯: 2ã€‚</span><br><span class=\"line\">waitqueuetimeoutms: 60000 # é˜»å¡é˜Ÿåˆ—ä¸­è¯·æ±‚çš„æœ€å¤§ç­‰å¾…æ—¶é—´ï¼Œè¶…è¿‡è¿™ä¸ªæ—¶é—´çš„è¯·æ±‚å°†è¢«æ‹’ç»ã€‚å•ä½ä¸ºæ¯«ç§’ï¼Œé»˜è®¤ä¸º: 120s</span><br></pre></td></tr></table></figure>\n<h2 id=\"å¦‚ä½•æŸ¥çœ‹è¿æ¥æ± æ˜¯å¦ç”Ÿæ•ˆäº†ï¼Ÿ\">å¦‚ä½•æŸ¥çœ‹è¿æ¥æ± æ˜¯å¦ç”Ÿæ•ˆäº†ï¼Ÿ</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¾ˆç®€å•ï¼Œæˆ‘ä»¬åªéœ€è¦æ³¨å…¥<code>MongoClient</code>å¹¶æŸ¥çœ‹å…¶<code>settings</code>å±æ€§ï¼Œå°±å¯ä»¥çœ‹åˆ°è¿æ¥æ± çš„é…ç½®ä¿¡æ¯äº†`</p>\n</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Autowired</span></span><br><span class=\"line\">MongoClient mongoClient;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// æ‰“å°è¿æ¥æ± é…ç½®ä¿¡æ¯</span></span><br><span class=\"line\">System.out.println(((MongoClientImpl) mongoClient).getSettings().getConnectionPoolSettings());</span><br><span class=\"line\"><span class=\"comment\">// è¾“å‡ºç»“æœ</span></span><br><span class=\"line\">ConnectionPoolSettings&#123;maxSize=<span class=\"number\">100</span>, minSize=<span class=\"number\">10</span>, maxWaitTimeMS=<span class=\"number\">60000</span>, maxConnectionLifeTimeMS=<span class=\"number\">0</span>, maxConnectionIdleTimeMS=<span class=\"number\">0</span>, maintenanceInitialDelayMS=<span class=\"number\">0</span>, maintenanceFrequencyMS=<span class=\"number\">60000</span>, connectionPoolListeners=[], maxConnecting=<span class=\"number\">5</span>&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"åè®°\">åè®°</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>springbootä¸ºä»€ä¹ˆæ²¡æœ‰å°†mongodbçš„è¿æ¥æ± å±æ€§ä¹Ÿå°è£…åˆ°<code>MongoProperties</code>ä¸­å‘¢ï¼Œä¹Ÿè®¸æ˜¯å› ä¸ºå’Œmongodbç›¸å…³çš„é“¾æ¥å‚æ•°å¤ªå¤šäº†å§ï¼Œè€Œä¸”æˆ‘ä»¬åœ¨é…ç½®mongodbæ—¶ï¼Œä¸€èˆ¬éƒ½ä¼šä½¿ç”¨<code>mongodb-uri</code>çš„æ–¹å¼ï¼Œæ‰€ä»¥springbootå°±ç›´æ¥å°†è¿æ¥æ± å‚æ•°æ”¾åˆ°<code>mongodb-uri</code>ä¸­ï¼Œè¿™æ ·é…ç½®èµ·æ¥å°±æ¯”è¾ƒæ–¹ä¾¿äº†ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å¦å¤–æˆ‘ä»¬å‘ç°ï¼Œåœ¨<code>MongoClientSettings</code>ä¸­é™¤äº†è¿æ¥æ± çš„é…ç½®ï¼Œè¿˜æœ‰å¾ˆå¤šé…ç½®é¡¹ä¹Ÿæ˜¯åŸºäº<code>mongodb-uri</code>çš„ï¼Œæˆ‘ä»¬å¯ä»¥åŸºäºéœ€è¦è¿›è¡Œé…ç½®ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">final</span> ReadPreference readPreference;</span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">final</span> WriteConcern writeConcern;</span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"type\">boolean</span> retryWrites;</span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"type\">boolean</span> retryReads;</span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">final</span> ReadConcern readConcern;</span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">final</span> MongoCredential credential;</span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">final</span> TransportSettings transportSettings;</span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">final</span> LoggerSettings loggerSettings;</span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">final</span> ClusterSettings clusterSettings;</span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">final</span> SocketSettings socketSettings;</span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">final</span> SocketSettings heartbeatSocketSettings;</span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">final</span> ConnectionPoolSettings connectionPoolSettings;</span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">final</span> ServerSettings serverSettings;</span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">final</span> SslSettings sslSettings;</span><br></pre></td></tr></table></figure>\n","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç»å¦‚ä½•ä½¿ç”¨SpringBooté…ç½®MongoDB7.0çš„è¿æ¥æ±  SpringBootç‰ˆæœ¬3.2.4ï¼ŒMongoDBç‰ˆæœ¬7.0.6 å…³äºspringbootä¸mongodbçš„é›†æˆå¯ä»¥å‚è€ƒï¼šMongoDB7.0--SpringBootå•é›†åˆæ“ä½œï¼Œæœ¬æ–‡åªè®¨è®ºè¿æ¥æ± ç›¸å…³å†…å®¹ã€‚ spring-boot çš„ MongoDB è¿æ¥æ±  å½“æˆ‘ä»¬åœ¨springbootçš„é…ç½®æ–‡ä»¶ä¸­é…ç½®mongodbçš„ç›¸å…³å±æ€§æ—¶ï¼Œå¹¶æ²¡æœ‰å‘ç°å’Œè¿æ¥æ± ç›¸å…³çš„å±æ€§ï¼ŒæŸ¥çœ‹MongoPropertiesä¸­çš„å±æ€§ä¹Ÿå¯ä»¥è¯å®è¿™ä¸€ç‚¹ï¼Œè¿™å°±å¾ˆå¥‡æ€ªï¼ŒæŒ‰ç†è¯´springbootåº”è¯¥ä¸ä¼šè¿™ä¹ˆå¼±é¸¡ã€‚ äºæ˜¯æˆ‘æ‰“ç®—çœ‹çœ‹springbootçš„æºç ï¼Œçœ‹çœ‹springbootä¸ºæˆ‘ä»¬è‡ªåŠ¨åˆ›å»ºçš„MongoClientåˆ°åº•æœ‰æ²¡æœ‰è¿æ¥æ± çš„é…ç½®ã€‚ æˆ‘ä»¬å°±ä»mongodbçš„è‡ªåŠ¨é…ç½®ç±»MongoAutoConfigurationå¼€å§‹ï¼Œè¯¥ç±»ä¸­å®šä¹‰äº†PropertiesMongoConnectionDetailså’ŒMongoClient 123456789101112//è¿™ä¸ªç±»ä¸»è¦ç”¨äºConnectionStringå¯¹è±¡çš„å°è£…ï¼Œåé¢ä¼šè®²åˆ°@Bean@ConditionalOnMissingBean(&#123;MongoConnectionDetails.class&#125;)PropertiesMongoConnectionDetails mongoConnectionDetails(MongoProperties properties) &#123; return new PropertiesMongoConnectionDetails(properties);&#125;@Bean@ConditionalOnMissingBean(&#123;MongoClient.class&#125;)public MongoClient mongo(ObjectProvider&lt;MongoClientSettingsBuilderCustomizer&gt; builderCustomizers, MongoClientSettings settings) &#123; return (MongoClient)(new MongoClientFactory(builderCustomizers.orderedStream().toList())).createMongoClient(settings);&#125; å¯ä»¥çœ‹åˆ°ï¼Œåˆ›å»ºMongoClientçš„beanæ—¶ï¼Œä¾èµ–ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ˜¯ObjectProvider&lt;MongoClientSettingsBuilderCustomizer&gt;ï¼Œä¸€ä¸ªæ˜¯MongoClientSettingsï¼Œå‰è€…ä¼šå°†springä¸Šä¸‹æ–‡ä¸­æ‰€æœ‰ç±»å‹ä¸ºMongoClientSettingsBuilderCustomizerçš„beanå°è£…åˆ°è¯¥å¯¹è±¡ä¸­(springbooté»˜è®¤åªæä¾›äº†ä¸€ä¸ªStandardMongoClientSettingsBuilderCustomizer) MongoAutoConfigurationç¼ºçœä¸ºæˆ‘ä»¬æä¾›äº†MongoClientSettingså’ŒStandardMongoClientSettingsBuilderCustomizerï¼Œè¿™ä¸¤ä¸ªç±»éƒ½å¾ˆé‡è¦ï¼Œè¿æ¥æ± å‚æ•°å°±å’Œå®ƒä»¬æœ‰å…³ 123456789@BeanMongoClientSettings mongoClientSettings() &#123; return MongoClientSettings.builder().build();&#125;// éœ€è¦çš„å‚æ•°connectionDetailsåˆšå¥½æ˜¯ä¸Šé¢çš„PropertiesMongoConnectionDetails@BeanStandardMongoClientSettingsBuilderCustomizer standardMongoSettingsCustomizer(MongoProperties properties, MongoConnectionDetails connectionDetails, ObjectProvider&lt;SslBundles&gt; sslBundles) &#123; return new StandardMongoClientSettingsBuilderCustomizer(connectionDetails.getConnectionString(), properties.getUuidRepresentation(), properties.getSsl(), (SslBundles)sslBundles.getIfAvailable());&#125; æˆ‘ä»¬å…ˆçœ‹MongoClientSettingsï¼Œå…¶ä¸­å°±å®šä¹‰ä¸€ä¸ªè¿æ¥æ± çš„é…ç½®å¯¹è±¡ConnectionPoolSettingsï¼Œè€ŒConnectionPoolSettingså…¶å†…éƒ¨å°±å®šä¹‰äº†è¿æ¥æ± çš„é…ç½®å±æ€§ï¼ŒMongoClientSettingsé€šè¿‡ConnectionPoolSettingsçš„æ„é€ å™¨åˆ›å»ºå‡ºäº†ConnectionPoolSettingså¯¹è±¡ï¼Œå…¶ç¼ºçœå€¼å¦‚ä¸‹ï¼š 123456private int maxSize = 100;private int minSize;private long maxWaitTimeMS = 1000 * 60 * 2;private long maxConnectionLifeTimeMS;private long maxConnectionIdleTimeMS;private int maxConnecting = 2; æˆ‘ä»¬çœ‹å¦ä¸€ä¸ªå’Œåˆ›å»ºMongoClientç›¸å…³çš„beanï¼Œè¿™ä¸ªStandardMongoClientSettingsBuilderCustomizerï¼Œåˆ›å»ºè¿™ä¸ªbeanæ—¶éœ€è¦ä¸€ä¸ªMongoConnectionDetailså¯¹è±¡ï¼Œå¹¶è°ƒç”¨å…¶getConnectionStringæ–¹æ³•ï¼Œè¿™ä¸ªå¯¹è±¡MongoAutoConfigurationä¹Ÿä¸ºæˆ‘ä»¬æä¾›äº†(ä¸Šé¢å¯ä»¥çœ‹åˆ°) æŸ¥çœ‹PropertiesMongoConnectionDetailsçš„æºç ï¼Œå‘ç°connectionDetails.getConnectionString()çš„åŠŸèƒ½å°±æ˜¯å°†MongoPropertiesçš„å±æ€§å°è£…ä¸ºuriå¹¶ä¼ é€’ç»™ConnectionStringçš„æ„é€ å™¨åˆ›å»ºå¯¹è±¡ 12345678910111213141516171819202122232425262728293031323334353637public ConnectionString getConnectionString() &#123; if (this.properties.getUri() != null) &#123; return new ConnectionString(this.properties.getUri()); &#125; else &#123; StringBuilder builder = new StringBuilder(&quot;mongodb://&quot;); if (this.properties.getUsername() != null) &#123; builder.append(this.encode(this.properties.getUsername())); builder.append(&quot;:&quot;); if (this.properties.getPassword() != null) &#123; builder.append(this.encode(this.properties.getPassword())); &#125; builder.append(&quot;@&quot;); &#125; builder.append(this.properties.getHost() != null ? this.properties.getHost() : &quot;localhost&quot;); if (this.properties.getPort() != null) &#123; builder.append(&quot;:&quot;); builder.append(this.properties.getPort()); &#125; if (this.properties.getAdditionalHosts() != null) &#123; builder.append(&quot;,&quot;); builder.append(String.join(&quot;,&quot;, this.properties.getAdditionalHosts())); &#125; builder.append(&quot;/&quot;); builder.append(this.properties.getMongoClientDatabase()); List&lt;String&gt; options = this.getOptions(); if (!options.isEmpty()) &#123; builder.append(&quot;?&quot;); builder.append(String.join(&quot;&amp;&quot;, options)); &#125; // å°†MongoPropertiesè½¬æ¢ä¸ºuriæ ¼å¼åè°ƒç”¨æ„é€ å™¨åˆ›å»ºConnectionString return new ConnectionString(builder.toString()); &#125;&#125; è¿™ä¸ªConnectionStringå¯¹è±¡çš„åˆå§‹åŒ–è¿‡ç¨‹å°±å¾ˆæœ‰æ„æ€äº†ï¼Œå…¶ä¼šå¯¹è¿™ä¸ªuriè¿›è¡Œè§£æï¼Œè§£æè¿‡ç¨‹ä¸­ä¼šè°ƒç”¨parseOptions(connectionStringQueryParameters)æ–¹æ³•ï¼Œå…¶ä¼šå°†uriä¸­çš„å‚æ•°è½¬æ¢ä¸ºMapï¼Œä¹‹åè°ƒç”¨translateOptions(combinedOptionsMaps)æ–¹æ³•éå†è¿™ä¸ªmapï¼Œè€Œåœ¨éå†çš„è¿‡ç¨‹ä¸­å°±ä¼šå®Œæˆå¯¹ConnectionStringå¯¹è±¡çš„è¿æ¥æ± ç›¸å…³å±æ€§çš„åˆå§‹åŒ– 123456789101112131415161718192021222324252627282930313233private void translateOptions(final Map&lt;String, List&lt;String&gt;&gt; optionsMap) &#123; boolean tlsInsecureSet = false; boolean tlsAllowInvalidHostnamesSet = false; for (final String key : GENERAL_OPTIONS_KEYS) &#123; String value = getLastValue(optionsMap, key); if (value == null) &#123; continue; &#125; switch (key) &#123; // è¿æ¥æ± ç›¸å…³å±æ€§ï¼Œæ³¨æ„è¿™é‡Œçš„å±æ€§åç§°ï¼Œåé¢æˆ‘ä»¬é…ç½®è¿æ¥æ± æ—¶ä¼šç”¨åˆ° case &quot;maxpoolsize&quot;: maxConnectionPoolSize = parseInteger(value, &quot;maxpoolsize&quot;); break; case &quot;minpoolsize&quot;: minConnectionPoolSize = parseInteger(value, &quot;minpoolsize&quot;); break; case &quot;maxidletimems&quot;: maxConnectionIdleTime = parseInteger(value, &quot;maxidletimems&quot;); break; case &quot;maxlifetimems&quot;: maxConnectionLifeTime = parseInteger(value, &quot;maxlifetimems&quot;); break; case &quot;maxconnecting&quot;: maxConnecting = parseInteger(value, &quot;maxConnecting&quot;); break; case &quot;waitqueuetimeoutms&quot;: maxWaitTime = parseInteger(value, &quot;waitqueuetimeoutms&quot;); break; case &quot;connecttimeoutms&quot;: connectTimeout = parseInteger(value, &quot;connecttimeoutms&quot;); break; â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦ å…¶å®æ­¤æ—¶æˆ‘ä»¬å°±å·²ç»çŸ¥é“åº”è¯¥å¦‚ä½•é…ç½®è¿æ¥æ± å‚æ•°äº†ï¼Œå°±æ˜¯å°†è¿æ¥æ± ç›¸å…³çš„å‚æ•°è¿½åŠ åˆ°uriçš„å‚æ•°éƒ¨åˆ†ï¼Œä½†æ˜¯å‰é¢æˆ‘ä»¬æåˆ°è´Ÿè´£è¿æ¥æ± çš„ç±»æ˜¯ConnectionPoolSettingsï¼Œé‚£ä¹ˆConnectionStringå¯¹è±¡ä¸­çš„è¿æ¥æ± å±æ€§æ˜¯å¦‚ä½•è¢«ä¼ é€’ç»™ConnectionPoolSettingsçš„å‘¢ï¼Œæˆ‘ä»¬æ¥ç€å¾€ä¸‹çœ‹ã€‚ å‚æ•°å‡†å¤‡å¥½åå°±å¼€å§‹åˆ›å»ºMongoClientäº†ï¼Œå…¶ä¼šè°ƒç”¨MongoClientFactoryçš„createMongoClientæ–¹æ³•ï¼Œå…¶ä¼šå¯¹MongoClientSettingså¯¹è±¡åšè¿›ä¸€æ­¥çš„å°è£…ï¼Œå¹¶æœ€ç»ˆåŸºäºå°è£…åçš„MongoClientSettingså¯¹è±¡åˆ›å»ºå‡ºMongoClientå¯¹è±¡ 12345678910public T createMongoClient(MongoClientSettings settings) &#123; Builder targetSettings = MongoClientSettings.builder(settings); customize(targetSettings); return this.clientCreator.apply(targetSettings.build(), driverInformation());&#125;private void customize(Builder builder) &#123; for (MongoClientSettingsBuilderCustomizer customizer : this.builderCustomizers) &#123; customizer.customize(builder); &#125;&#125; è€Œåœ¨è¿›ä¸€æ­¥å°è£…MongoClientSettingså¯¹è±¡æ—¶ï¼Œä¼šè°ƒç”¨ç³»ç»Ÿä¸­æ‰€æœ‰è¢«springç®¡ç†çš„MongoClientSettingsBuilderCustomizer,å®é™…ä¸Šä¹Ÿå°±æ˜¯StandardMongoClientSettingsBuilderCustomizerçš„customizeæ–¹æ³•ï¼Œå…¶åˆä¼šè°ƒç”¨MongoClientSettings.builder()çš„applyConnectionSettingsæ–¹æ³•ï¼Œè€Œåœ¨è¯¥æ–¹æ³•ä¸­è°ƒç”¨connectionPoolSettingsBuilder.applyConnectionString(connectionString);å°±å®Œæˆäº†å°†ConnectionStringå¯¹è±¡ä¸­çš„è¿æ¥æ± å±æ€§ä¼ é€’ç»™ConnectionPoolSettingså¯¹è±¡çš„è¿‡ç¨‹ï¼Œå½“ç„¶ï¼Œå¦‚æœå±æ€§æ²¡æœ‰è·å–åˆ°å°±ä¼šä½¿ç”¨é»˜è®¤å€¼ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åŸºäºéœ€è¦é…ç½®ç›¸å…³çš„å±æ€§ã€‚ 123456789101112131415161718192021222324252627282930313233public Builder applyConnectionString(final ConnectionString connectionString) &#123; Integer maxConnectionPoolSize = connectionString.getMaxConnectionPoolSize(); if (maxConnectionPoolSize != null) &#123; maxSize(maxConnectionPoolSize); &#125; Integer minConnectionPoolSize = connectionString.getMinConnectionPoolSize(); if (minConnectionPoolSize != null) &#123; minSize(minConnectionPoolSize); &#125; Integer maxWaitTime = connectionString.getMaxWaitTime(); if (maxWaitTime != null) &#123; maxWaitTime(maxWaitTime, MILLISECONDS); &#125; Integer maxConnectionIdleTime = connectionString.getMaxConnectionIdleTime(); if (maxConnectionIdleTime != null) &#123; maxConnectionIdleTime(maxConnectionIdleTime, MILLISECONDS); &#125; Integer maxConnectionLifeTime = connectionString.getMaxConnectionLifeTime(); if (maxConnectionLifeTime != null) &#123; maxConnectionLifeTime(maxConnectionLifeTime, MILLISECONDS); &#125; Integer maxConnecting = connectionString.getMaxConnecting(); if (maxConnecting != null) &#123; maxConnecting(maxConnecting); &#125; return this;&#125; å¤§ä½“è¿‡ç¨‹å°±æ˜¯è¿™æ ·ï¼Œå¾ˆç»•ï¼Œç®€å•ç‚¹è¯´å°±æ˜¯springbootå·²ç»ä¸ºæˆ‘ä»¬æä¾›äº†mongodbçš„è¿æ¥æ± ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åŸºäºéœ€è¦ï¼Œåœ¨é…ç½®mongodb-uriæ—¶ï¼Œå¢åŠ ç›¸å…³çš„è¿æ¥æ± å‚æ•°ï¼Œspringbootå°±ä¼šæŒ‰ç…§æˆ‘ä»¬é…ç½®çš„å‚æ•°ä¸ºæˆ‘ä»¬åˆ›å»ºè¿æ¥æ± ï¼Œå¹¶è‡ªåŠ¨ç®¡ç†è¿æ¥æ± ã€‚ 12345spring: data: mongodb: uri: mongodb://user:password@127.0.0.1:27040,127.0.0.1:27041,127.0.0.1:27042/mytest?authSource=admin&amp;readPreference=primaryPreferred&amp;maxpoolsize=100&amp;minpoolsize=10&amp;maxidletimems=0&amp;maxlifetimems=0&amp;maxconnecting=5&amp;waitqueuetimeoutms=60000 å‚æ•°è¯´æ˜ 123456maxpoolsize: 100 # æ± ä¸­å…è®¸çš„æœ€å¤§è¿æ¥æ•°ã€‚ä¸€æ—¦æ± è€—å°½ï¼Œä»»ä½•éœ€è¦è¿æ¥çš„æ“ä½œéƒ½å°†åœ¨é˜»å¡é˜Ÿåˆ—ä¸­ç­‰å¾…ç›´åˆ°è·å–åˆ°è¿æ¥ï¼Œ é»˜è®¤: 100minpoolsize: 10 # æ± ä¸­å…è®¸çš„æœ€å°è¿æ¥æ•°ã€‚è¿™äº›è¿æ¥åœ¨ç©ºé—²æ—¶å°†ä¿ç•™åœ¨æ± ä¸­ï¼Œå¹¶ä¸”æ± å°†ç¡®ä¿å®ƒè‡³å°‘åŒ…å«è¿™ä¸ªæœ€å°æ•°é‡ é»˜è®¤: 0maxidletimems: 0 # æ± è¿æ¥çš„æœ€å¤§ç©ºé—²æ—¶é—´ã€‚é›¶å€¼è¡¨ç¤ºå¯¹ç©ºé—²æ—¶é—´æ²¡æœ‰é™åˆ¶ã€‚è¶…è¿‡å…¶ç©ºé—²æ—¶é—´çš„æ± è¿æ¥å°†è¢«å…³é—­å¹¶åœ¨å¿…è¦æ—¶ç”±æ–°è¿æ¥æ›¿æ¢ã€‚å•ä½ä¸ºæ¯«ç§’maxlifetimems: 0 # æ± è¿æ¥å¯ä»¥å­˜æ´»çš„æœ€é•¿æ—¶é—´ã€‚é›¶å€¼è¡¨ç¤ºå¯¿å‘½æ²¡æœ‰é™åˆ¶ã€‚è¶…è¿‡å…¶ç”Ÿå‘½å‘¨æœŸçš„æ± è¿æ¥å°†è¢«å…³é—­å¹¶åœ¨å¿…è¦æ—¶ç”±æ–°è¿æ¥æ›¿æ¢ã€‚å•ä½ä¸ºæ¯«ç§’maxconnecting: 5 # åŒä¸€æ—¶åˆ»å…è®¸çš„æœ€å¤§å¹¶è¡Œè¿æ¥æ•°ã€‚é»˜è®¤å€¼æ˜¯: 2ã€‚waitqueuetimeoutms: 60000 # é˜»å¡é˜Ÿåˆ—ä¸­è¯·æ±‚çš„æœ€å¤§ç­‰å¾…æ—¶é—´ï¼Œè¶…è¿‡è¿™ä¸ªæ—¶é—´çš„è¯·æ±‚å°†è¢«æ‹’ç»ã€‚å•ä½ä¸ºæ¯«ç§’ï¼Œé»˜è®¤ä¸º: 120s å¦‚ä½•æŸ¥çœ‹è¿æ¥æ± æ˜¯å¦ç”Ÿæ•ˆäº†ï¼Ÿ å¾ˆç®€å•ï¼Œæˆ‘ä»¬åªéœ€è¦æ³¨å…¥MongoClientå¹¶æŸ¥çœ‹å…¶settingså±æ€§ï¼Œå°±å¯ä»¥çœ‹åˆ°è¿æ¥æ± çš„é…ç½®ä¿¡æ¯äº†` 1234567@AutowiredMongoClient mongoClient;// æ‰“å°è¿æ¥æ± é…ç½®ä¿¡æ¯System.out.println(((MongoClientImpl) mongoClient).getSettings().getConnectionPoolSettings());// è¾“å‡ºç»“æœConnectionPoolSettings&#123;maxSize=100, minSize=10, maxWaitTimeMS=60000, maxConnectionLifeTimeMS=0, maxConnectionIdleTimeMS=0, maintenanceInitialDelayMS=0, maintenanceFrequencyMS=60000, connectionPoolListeners=[], maxConnecting=5&#125; åè®° springbootä¸ºä»€ä¹ˆæ²¡æœ‰å°†mongodbçš„è¿æ¥æ± å±æ€§ä¹Ÿå°è£…åˆ°MongoPropertiesä¸­å‘¢ï¼Œä¹Ÿè®¸æ˜¯å› ä¸ºå’Œmongodbç›¸å…³çš„é“¾æ¥å‚æ•°å¤ªå¤šäº†å§ï¼Œè€Œä¸”æˆ‘ä»¬åœ¨é…ç½®mongodbæ—¶ï¼Œä¸€èˆ¬éƒ½ä¼šä½¿ç”¨mongodb-uriçš„æ–¹å¼ï¼Œæ‰€ä»¥springbootå°±ç›´æ¥å°†è¿æ¥æ± å‚æ•°æ”¾åˆ°mongodb-uriä¸­ï¼Œè¿™æ ·é…ç½®èµ·æ¥å°±æ¯”è¾ƒæ–¹ä¾¿äº†ã€‚ å¦å¤–æˆ‘ä»¬å‘ç°ï¼Œåœ¨MongoClientSettingsä¸­é™¤äº†è¿æ¥æ± çš„é…ç½®ï¼Œè¿˜æœ‰å¾ˆå¤šé…ç½®é¡¹ä¹Ÿæ˜¯åŸºäºmongodb-uriçš„ï¼Œæˆ‘ä»¬å¯ä»¥åŸºäºéœ€è¦è¿›è¡Œé…ç½®ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š 1234567891011121314private final ReadPreference readPreference;private final WriteConcern writeConcern;private final boolean retryWrites;private final boolean retryReads;private final ReadConcern readConcern;private final MongoCredential credential;private final TransportSettings transportSettings;private final LoggerSettings loggerSettings;private final ClusterSettings clusterSettings;private final SocketSettings socketSettings;private final SocketSettings heartbeatSocketSettings;private final ConnectionPoolSettings connectionPoolSettings;private final ServerSettings serverSettings;private final SslSettings sslSettings;","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç»å¦‚ä½•ä½¿ç”¨SpringBooté…ç½®MongoDB7.0çš„è¿æ¥æ±  SpringBootç‰ˆæœ¬3.2.4ï¼ŒMongoDBç‰ˆæœ¬7.0.6 å…³äºspringbootä¸mongodbçš„é›†æˆå¯ä»¥å‚è€ƒï¼šMongoDB7.0--SpringBootå•é›†åˆæ“ä½œï¼Œæœ¬æ–‡åªè®¨è®ºè¿æ¥æ± ç›¸å…³å†…å®¹ã€‚","date_published":"2024-04-08T13:30:05.000Z","tags":["æŠ€æœ¯","linux","mongodb","mongodb"]},{"id":"https://blog.hanqunfeng.com/2024/04/07/mongodb7-others/","url":"https://blog.hanqunfeng.com/2024/04/07/mongodb7-others/","title":"MongoDB7.0ä¸€äº›æœ‰ç”¨çš„åŠŸèƒ½","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç»MongoDB7.0çš„ä¸€äº›æœ‰ç”¨çš„åŠŸèƒ½ï¼Œæ¯”å¦‚è¿è¡Œjsï¼ŒæŸ¥çœ‹æ…¢æŸ¥è¯¢æ—¥å¿—ç­‰ç­‰</p>\n</li>\n<li class=\"lvl-2\">\n<p>MongoDB<a href=\"https://www.mongodb.com/docs/v7.0/\">å®˜æ–¹æ–‡æ¡£</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡åŸºäº<code>CentOS8(x86_64)</code></p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"è¿è¡Œjs\">è¿è¡Œjs</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¿è¡Œjsæ–‡ä»¶</p>\n</li>\n</ul>\n<blockquote>\n<p>insertMany.js</p>\n</blockquote>\n  <figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> tags = [<span class=\"string\">&#x27;nosql&#x27;</span>, <span class=\"string\">&#x27;mongodb&#x27;</span>, <span class=\"string\">&#x27;document&#x27;</span>, <span class=\"string\">&#x27;developer&#x27;</span>, <span class=\"string\">&#x27;popular&#x27;</span>]</span><br><span class=\"line\"><span class=\"keyword\">var</span> types = [<span class=\"string\">&#x27;technology&#x27;</span>, <span class=\"string\">&#x27;sociality&#x27;</span>, <span class=\"string\">&#x27;travel&#x27;</span>, <span class=\"string\">&#x27;novel&#x27;</span>, <span class=\"string\">&#x27;literature&#x27;</span>]</span><br><span class=\"line\"><span class=\"keyword\">var</span> books = []</span><br><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">50</span>; i++) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> typeIdx = <span class=\"title class_\">Math</span>.<span class=\"title function_\">floor</span>(<span class=\"title class_\">Math</span>.<span class=\"title function_\">random</span>() * types.<span class=\"property\">length</span>)</span><br><span class=\"line\">  <span class=\"keyword\">var</span> tagIdx = <span class=\"title class_\">Math</span>.<span class=\"title function_\">floor</span>(<span class=\"title class_\">Math</span>.<span class=\"title function_\">random</span>() * tags.<span class=\"property\">length</span>)</span><br><span class=\"line\">  <span class=\"keyword\">var</span> favCount = <span class=\"title class_\">Math</span>.<span class=\"title function_\">floor</span>(<span class=\"title class_\">Math</span>.<span class=\"title function_\">random</span>() * <span class=\"number\">100</span>)</span><br><span class=\"line\">  <span class=\"keyword\">var</span> book = &#123;</span><br><span class=\"line\">    <span class=\"attr\">title</span>: <span class=\"string\">&#x27;book-&#x27;</span> + i,</span><br><span class=\"line\">    <span class=\"attr\">type</span>: types[typeIdx],</span><br><span class=\"line\">    <span class=\"attr\">tag</span>: tags[tagIdx],</span><br><span class=\"line\">    <span class=\"attr\">favCount</span>: favCount,</span><br><span class=\"line\">    <span class=\"attr\">author</span>: <span class=\"string\">&#x27;xxx&#x27;</span> + i</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  books.<span class=\"title function_\">push</span>(book)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">db.<span class=\"property\">books</span>.<span class=\"title function_\">insertMany</span>(books)</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># -f è¿è¡Œjsæ–‡ä»¶</span></span><br><span class=\"line\">mongosh <span class=\"string\">&quot;mongodb://user:password@10.1.2.26:27017,10.1.2.142:27017,10.1.2.41:27017/test?authSource=admin&amp;replicaSet=rs0&quot;</span> -f insertMany.js</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¿è¡Œjsè¯­å¥</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ---eval è¿è¡Œjsè¯­å¥</span></span><br><span class=\"line\">mongosh <span class=\"string\">&quot;mongodb://user:password@10.1.2.26:27017,10.1.2.142:27017,10.1.2.41:27017/test?authSource=admin&amp;replicaSet=rs0&quot;</span> --<span class=\"built_in\">eval</span> <span class=\"string\">&quot;db.books.find().limit(2)&quot;</span></span><br><span class=\"line\">[</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    _id: ObjectId(<span class=\"string\">&#x27;660d0b05a8a6c09b0b1852b7&#x27;</span>),</span><br><span class=\"line\">    title: <span class=\"string\">&#x27;book-0&#x27;</span>,</span><br><span class=\"line\">    <span class=\"built_in\">type</span>: <span class=\"string\">&#x27;novel&#x27;</span>,</span><br><span class=\"line\">    tag: <span class=\"string\">&#x27;document&#x27;</span>,</span><br><span class=\"line\">    favCount: 58,</span><br><span class=\"line\">    author: <span class=\"string\">&#x27;xxx0&#x27;</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    _id: ObjectId(<span class=\"string\">&#x27;660d0b05a8a6c09b0b1852b8&#x27;</span>),</span><br><span class=\"line\">    title: <span class=\"string\">&#x27;book-1&#x27;</span>,</span><br><span class=\"line\">    <span class=\"built_in\">type</span>: <span class=\"string\">&#x27;novel&#x27;</span>,</span><br><span class=\"line\">    tag: <span class=\"string\">&#x27;popular&#x27;</span>,</span><br><span class=\"line\">    favCount: 10,</span><br><span class=\"line\">    author: <span class=\"string\">&#x27;xxx1&#x27;</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">]</span><br></pre></td></tr></table></figure>\n<h2 id=\"Profileræ¨¡å—\">Profileræ¨¡å—</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Profileræ¨¡å—å¯ä»¥ç”¨æ¥è®°å½•ã€åˆ†æMongoDBçš„è¯¦ç»†æ“ä½œæ—¥å¿—ï¼Œé»˜è®¤æƒ…å†µä¸‹è¯¥åŠŸèƒ½æ˜¯å…³é—­çš„ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>Profileræ¨¡å—å¼€å¯å¯¹äºæ¯ä¸ªä¸šåŠ¡åº“æ¥è¯´æ˜¯ç‹¬ç«‹çš„ï¼Œå¯¹æŸä¸ªä¸šåŠ¡åº“å¼€å¯Profileræ¨¡å—ä¹‹åï¼Œç¬¦åˆæ¡ä»¶çš„æ…¢æ“ä½œæ—¥å¿—ä¼šè¢«å†™å…¥è¯¥åº“çš„<code>system.profile</code>é›†åˆä¸­ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>Profileræ¨¡å—çš„è°ƒè¯•çº§åˆ«æœ‰ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">0ï¼šå…³é—­Profileræ¨¡å—ï¼›</span><br><span class=\"line\">1ï¼šéƒ¨åˆ†å¼€å¯ï¼Œä»…ç¬¦åˆæ¡ä»¶ï¼ˆæ—¶é•¿å¤§äºslowmsï¼‰çš„æ“ä½œæ—¥å¿—ä¼šè¢«è®°å½•ï¼›</span><br><span class=\"line\">2ï¼šæ—¥å¿—å…¨å¼€ï¼Œæ‰€æœ‰çš„æ“ä½œæ—¥å¿—éƒ½è¢«è®°å½•ï¼›</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è®¾ç½®Profileræ¨¡å—çš„è°ƒè¯•çº§åˆ«ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># è®¾ç½®Profileræ¨¡å—çš„è°ƒè¯•çº§åˆ«ä¸º2</span></span><br><span class=\"line\">&gt; db.setProfilingLevel(2)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹å½“çš„è°ƒè¯•çº§åˆ«ä¿¡æ¯</span></span><br><span class=\"line\">&gt; db.<span class=\"function\"><span class=\"title\">getProfilingStatus</span></span>()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  was: 2,  <span class=\"comment\"># å½“å‰çš„è°ƒè¯•çº§åˆ«</span></span><br><span class=\"line\">  slowms: 100, <span class=\"comment\"># æ…¢æŸ¥è¯¢çš„é˜ˆå€¼ï¼Œå•ä½æ˜¯æ¯«ç§’ï¼›</span></span><br><span class=\"line\">  sampleRate: 1.0, <span class=\"comment\"># æ—¥å¿—éšæœºé‡‡æ ·ç‡ï¼Œ1.0åˆ™è¡¨ç¤ºæ»¡è¶³æ¡ä»¶çš„å…¨éƒ¨è¾“å‡ºã€‚</span></span><br><span class=\"line\">  ok: 1,   <span class=\"comment\"># çŠ¶æ€</span></span><br><span class=\"line\">  <span class=\"string\">&#x27;$clusterTime&#x27;</span>: &#123; <span class=\"comment\"># æ—¶é—´æˆ³</span></span><br><span class=\"line\">    clusterTime: Timestamp(&#123; t: 1712471779, i: 1 &#125;), <span class=\"comment\"># æ—¶é—´æˆ³</span></span><br><span class=\"line\">    signature: &#123; <span class=\"comment\"># ç­¾å</span></span><br><span class=\"line\">      <span class=\"built_in\">hash</span>: Binary.createFromBase64(<span class=\"string\">&#x27;GGCAjzJrW8arhfJX0Cn0VpvC5MA=&#x27;</span>, 0), <span class=\"comment\"># ç­¾å</span></span><br><span class=\"line\">      keyId: Long(<span class=\"string\">&#x27;7346062378896719877&#x27;</span>)  <span class=\"comment\"># ç­¾å</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  operationTime: Timestamp(&#123; t: 1712471779, i: 1 &#125;) <span class=\"comment\"># æ“ä½œæ—¶é—´</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åªè®°å½•æ—¶é•¿è¶…è¿‡500msçš„æ“ä½œ</span></span><br><span class=\"line\">&gt; db.setProfilingLevel(1,500)</span><br><span class=\"line\"><span class=\"comment\"># åŒæ—¶åŠ ä¸Šé‡‡æ ·ç‡</span></span><br><span class=\"line\">&gt; db.setProfilingLevel(1,&#123;slowms:500,sampleRate:0.5&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å…³é—­Profileræ¨¡å—</span></span><br><span class=\"line\">&gt; db.setProfilingLevel(2)</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æŸ¥çœ‹æ—¥å¿—</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹æ“ä½œæ—¥å¿—</span></span><br><span class=\"line\">&gt; db.system.profile.find().<span class=\"built_in\">limit</span>(5).<span class=\"built_in\">sort</span>(&#123;ts:-1&#125;).pretty()</span><br><span class=\"line\">[</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    op: <span class=\"string\">&#x27;query&#x27;</span>, <span class=\"comment\"># æ“ä½œç±»å‹,æ¯”å¦‚æŸ¥è¯¢,æ›´æ–°,åˆ é™¤ç­‰</span></span><br><span class=\"line\">    ns: <span class=\"string\">&#x27;admin.system.profile&#x27;</span>, <span class=\"comment\"># æ“ä½œçš„é›†åˆ</span></span><br><span class=\"line\">    <span class=\"built_in\">command</span>: &#123; <span class=\"comment\"># æ“ä½œçš„å‘½ä»¤</span></span><br><span class=\"line\">      find: <span class=\"string\">&#x27;system.profile&#x27;</span>, <span class=\"comment\"># æ“ä½œçš„é›†åˆ</span></span><br><span class=\"line\">      filter: &#123;&#125;, <span class=\"comment\"># æŸ¥è¯¢æ¡ä»¶</span></span><br><span class=\"line\">      lsid: &#123; <span class=\"built_in\">id</span>: UUID(<span class=\"string\">&#x27;2285d6a5-b2df-4b46-b9d2-5e556b0a7c7d&#x27;</span>) &#125;, <span class=\"comment\"># ä¼šè¯id</span></span><br><span class=\"line\">      <span class=\"string\">&#x27;$clusterTime&#x27;</span>: &#123; <span class=\"comment\"># æ—¶é—´æˆ³</span></span><br><span class=\"line\">        clusterTime: Timestamp(&#123; t: 1712471018, i: 1 &#125;),</span><br><span class=\"line\">        signature: &#123;</span><br><span class=\"line\">          <span class=\"built_in\">hash</span>: Binary.createFromBase64(<span class=\"string\">&#x27;8YEsN+XUWO6EkoHEegKkG49eWPA=&#x27;</span>, 0),</span><br><span class=\"line\">          keyId: Long(<span class=\"string\">&#x27;7346062378896719877&#x27;</span>)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      <span class=\"string\">&#x27;$db&#x27;</span>: <span class=\"string\">&#x27;admin&#x27;</span>, <span class=\"comment\"># æ•°æ®åº“</span></span><br><span class=\"line\">      <span class=\"string\">&#x27;$readPreference&#x27;</span>: &#123; mode: <span class=\"string\">&#x27;primaryPreferred&#x27;</span> &#125; <span class=\"comment\"># è¯»åå¥½</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    keysExamined: 0, <span class=\"comment\"># æ‰«æç´¢å¼•æ¡ç›®æ•°ï¼Œå¦‚æœæ¯”nreturnedå¤§å‡ºå¾ˆå¤šï¼Œåˆ™è¯´æ˜æŸ¥è¯¢æ•ˆç‡ä¸é«˜ã€‚</span></span><br><span class=\"line\">    docsExamined: 3, <span class=\"comment\"># æ‰«ææ–‡æ¡£æ¡ç›®æ•°ï¼Œå¦‚æœæ¯”nreturnedå¤§å‡ºå¾ˆå¤šï¼Œåˆ™è¯´æ˜æŸ¥è¯¢æ•ˆç‡ä¸é«˜ã€‚</span></span><br><span class=\"line\">    nBatches: 1, <span class=\"comment\"># æ‰¹å¤„ç†æ•°é‡</span></span><br><span class=\"line\">    cursorExhausted: <span class=\"literal\">true</span>, <span class=\"comment\"># æ˜¯å¦æ¸¸æ ‡å·²è€—å°½</span></span><br><span class=\"line\">    numYield: 0, <span class=\"comment\"># æ“ä½œæ•°ï¼Œå¤§äº0è¡¨ç¤ºç­‰å¾…é”æˆ–è€…æ˜¯ç£ç›˜I/Oæ“ä½œ</span></span><br><span class=\"line\">    nreturned: 3, <span class=\"comment\"># è¿”å›çš„æ–‡æ¡£æ•°é‡</span></span><br><span class=\"line\">    queryHash: <span class=\"string\">&#x27;8880B5AF&#x27;</span>, <span class=\"comment\"># æŸ¥è¯¢å“ˆå¸Œå€¼</span></span><br><span class=\"line\">    planCacheKey: <span class=\"string\">&#x27;8880B5AF&#x27;</span>,</span><br><span class=\"line\">    queryFramework: <span class=\"string\">&#x27;classic&#x27;</span>,</span><br><span class=\"line\">    locks: &#123;       <span class=\"comment\"># é”å ç”¨çš„æƒ…å†µã€‚</span></span><br><span class=\"line\">      FeatureCompatibilityVersion: &#123; acquireCount: &#123; r: Long(<span class=\"string\">&#x27;1&#x27;</span>) &#125; &#125;,</span><br><span class=\"line\">      Global: &#123; acquireCount: &#123; r: Long(<span class=\"string\">&#x27;1&#x27;</span>) &#125; &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    flowControl: &#123;&#125;,</span><br><span class=\"line\">    readConcern: &#123; level: <span class=\"string\">&#x27;local&#x27;</span>, provenance: <span class=\"string\">&#x27;implicitDefault&#x27;</span> &#125;, <span class=\"comment\"># è¯»å…³æ³¨</span></span><br><span class=\"line\">    responseLength: 3414, <span class=\"comment\"># å“åº”æ•°æ®å¤§å°ï¼ˆå­—èŠ‚æ•°ï¼‰ï¼Œä¸€æ¬¡æ€§æŸ¥è¯¢å¤ªå¤šçš„æ•°æ®ä¼šå½±å“æ€§èƒ½ï¼Œå¯ä»¥ä½¿ç”¨limitã€batchSizeè¿›è¡Œä¸€äº›é™åˆ¶ã€‚</span></span><br><span class=\"line\">    protocol: <span class=\"string\">&#x27;op_msg&#x27;</span>, <span class=\"comment\"># åè®®ç±»å‹ï¼Œop_msgæ˜¯mongodb 4.0+çš„åè®®ï¼Œop_queryæ˜¯mongodb 3.2åŠä»¥å‰ç‰ˆæœ¬çš„åè®®ã€‚</span></span><br><span class=\"line\">    millis: 0, <span class=\"comment\"># å‘½ä»¤æ‰§è¡Œçš„æ—¶é•¿ï¼Œå•ä½æ˜¯æ¯«ç§’ã€‚</span></span><br><span class=\"line\">    planSummary: <span class=\"string\">&#x27;COLLSCAN&#x27;</span>, <span class=\"comment\"># æŸ¥è¯¢è®¡åˆ’çš„æ¦‚è¦ï¼Œå¦‚IXSCANè¡¨ç¤ºä½¿ç”¨äº†ç´¢å¼•æ‰«æã€‚</span></span><br><span class=\"line\">    planningTimeMicros: 79,</span><br><span class=\"line\">    execStats: &#123;  <span class=\"comment\"># æ‰§è¡Œè¿‡ç¨‹ç»Ÿè®¡ä¿¡æ¯ã€‚</span></span><br><span class=\"line\">      stage: <span class=\"string\">&#x27;COLLSCAN&#x27;</span>,</span><br><span class=\"line\">      nReturned: 3,</span><br><span class=\"line\">      executionTimeMillisEstimate: 0,</span><br><span class=\"line\">      works: 4,</span><br><span class=\"line\">      advanced: 3,</span><br><span class=\"line\">      needTime: 0,</span><br><span class=\"line\">      needYield: 0,</span><br><span class=\"line\">      saveState: 0,</span><br><span class=\"line\">      restoreState: 0,</span><br><span class=\"line\">      isEOF: 1,</span><br><span class=\"line\">      direction: <span class=\"string\">&#x27;forward&#x27;</span>,</span><br><span class=\"line\">      docsExamined: 3</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    ts: ISODate(<span class=\"string\">&#x27;2024-04-07T06:23:56.054Z&#x27;</span>), <span class=\"comment\"># å‘½ä»¤æ‰§è¡Œçš„æ—¶é—´ç‚¹ã€‚</span></span><br><span class=\"line\">    client: <span class=\"string\">&#x27;127.0.0.1&#x27;</span>, <span class=\"comment\"># å®¢æˆ·ç«¯åœ°å€ã€‚</span></span><br><span class=\"line\">    appName: <span class=\"string\">&#x27;mongosh 2.1.5&#x27;</span>, <span class=\"comment\"># å®¢æˆ·ç«¯åç§°ã€‚</span></span><br><span class=\"line\">    allUsers: [ &#123; user: <span class=\"string\">&#x27;user&#x27;</span>, db: <span class=\"string\">&#x27;admin&#x27;</span> &#125; ], <span class=\"comment\"># æ‰€æœ‰ç”¨æˆ·ä¿¡æ¯ã€‚</span></span><br><span class=\"line\">    user: <span class=\"string\">&#x27;user@admin&#x27;</span> <span class=\"comment\"># å½“å‰ç”¨æˆ·ä¿¡æ¯ã€‚</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦</span><br><span class=\"line\">]</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹æ‰§è¡Œæ—¶é•¿æœ€å¤§çš„10æ¡æ“ä½œè®°å½•</span></span><br><span class=\"line\">&gt; db.system.profile.find().<span class=\"built_in\">limit</span>(10).<span class=\"built_in\">sort</span>(&#123;millis:-1&#125;).pretty()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹æŸä¸ªé›†åˆä¸­çš„updateæ“ä½œæ—¥å¿—</span></span><br><span class=\"line\">&gt; db.system.profile.find(&#123;op:<span class=\"string\">&quot;update&quot;</span>,ns:<span class=\"string\">&quot;shop.user&quot;</span>&#125;)</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><code>system.profile</code>æ˜¯ä¸€ä¸ª1MBçš„å›ºå®šå¤§å°çš„é›†åˆï¼Œéšç€è®°å½•æ—¥å¿—çš„å¢å¤šï¼Œä¸€äº›æ—§çš„è®°å½•ä¼šè¢«æ»šåŠ¨åˆ é™¤ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>Profileræ¨¡å—çš„è®¾ç½®æ˜¯å†…å­˜çº§çš„ï¼Œé‡å¯æœåŠ¡å™¨åä¼šè‡ªåŠ¨æ¢å¤é»˜è®¤çŠ¶æ€ã€‚</p>\n</li>\n</ul>\n<h2 id=\"db-currentOp\">db.currentOp()</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Profileræ¨¡å—æ‰€è®°å½•çš„æ—¥å¿—éƒ½æ˜¯å·²ç»å‘ç”Ÿçš„äº‹æƒ…ï¼Œ<code>db.currentOp()</code>å‘½ä»¤åˆ™ä¸æ­¤ç›¸åï¼Œå®ƒå¯ä»¥ç”¨æ¥æŸ¥çœ‹æ•°æ®åº“å½“å‰æ­£åœ¨æ‰§è¡Œçš„ä¸€äº›æ“ä½œã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>db.currentOp()è¯»å–çš„æ˜¯å½“å‰æ•°æ®åº“çš„å‘½ä»¤å¿«ç…§ï¼Œè¯¥å‘½ä»¤å¯ä»¥è¿”å›è®¸å¤šæœ‰ç”¨çš„ä¿¡æ¯ï¼Œæ¯”å¦‚ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">æ“ä½œçš„è¿è¡Œæ—¶é•¿ï¼Œå¿«é€Ÿå‘ç°è€—æ—¶æ¼«é•¿çš„ä½æ•ˆæ‰«ææ“ä½œã€‚</span><br><span class=\"line\">æ‰§è¡Œè®¡åˆ’ä¿¡æ¯ï¼Œç”¨äºåˆ¤æ–­æ˜¯å¦å‘½ä¸­äº†ç´¢å¼•ï¼Œæˆ–è€…å­˜åœ¨é”å†²çªçš„æƒ…å†µã€‚</span><br><span class=\"line\">æ“ä½œIDã€æ—¶é—´ã€å®¢æˆ·ç«¯ç­‰ä¿¡æ¯ï¼Œæ–¹ä¾¿å®šä½å‡ºäº§ç”Ÿæ…¢æ“ä½œçš„æºå¤´</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt; db.<span class=\"function\"><span class=\"title\">currentOp</span></span>()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">inprog: [ <span class=\"comment\"># å½“å‰æ­£åœ¨æ‰§è¡Œçš„æ“ä½œ</span></span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">      <span class=\"built_in\">type</span>: <span class=\"string\">&#x27;op&#x27;</span>, <span class=\"comment\"># æ“ä½œç±»å‹ï¼Œå¯ä»¥æ˜¯opã€idleSessionã€idleCursorçš„ä¸€ç§ï¼Œä¸€èˆ¬çš„æ“ä½œä¿¡æ¯ä»¥opè¡¨ç¤ºã€‚å…¶ä¸ºMongoDB 4.2ç‰ˆæœ¬æ–°å¢åŠŸèƒ½</span></span><br><span class=\"line\">      host: <span class=\"string\">&#x27;localhost:27041&#x27;</span>, <span class=\"comment\"># æ“ä½œæ‰€åœ¨çš„ä¸»æœº</span></span><br><span class=\"line\">      desc: <span class=\"string\">&#x27;conn474&#x27;</span>, <span class=\"comment\"># æ“ä½œçš„æè¿°ä¿¡æ¯</span></span><br><span class=\"line\">      connectionId: 474, <span class=\"comment\"># æ“ä½œçš„è¿æ¥ID</span></span><br><span class=\"line\">      client: <span class=\"string\">&#x27;127.0.0.1:58103&#x27;</span>, <span class=\"comment\"># æ“ä½œçš„å®¢æˆ·ç«¯ä¿¡æ¯</span></span><br><span class=\"line\">      appName: <span class=\"string\">&#x27;mongosh 2.1.5&#x27;</span>, <span class=\"comment\"># æ“ä½œçš„å®¢æˆ·ç«¯åº”ç”¨ä¿¡æ¯</span></span><br><span class=\"line\">      clientMetadata: &#123; <span class=\"comment\"># å…³äºå®¢æˆ·ç«¯çš„é™„åŠ ä¿¡æ¯ï¼Œå¯ä»¥åŒ…å«é©±åŠ¨çš„ç‰ˆæœ¬ã€‚</span></span><br><span class=\"line\">        application: &#123; name: <span class=\"string\">&#x27;mongosh 2.1.5&#x27;</span> &#125;,</span><br><span class=\"line\">        driver: &#123; name: <span class=\"string\">&#x27;nodejs|mongosh&#x27;</span>, version: <span class=\"string\">&#x27;6.3.0|2.1.5&#x27;</span> &#125;,</span><br><span class=\"line\">        platform: <span class=\"string\">&#x27;Node.js v20.11.1, LE&#x27;</span>,</span><br><span class=\"line\">        os: &#123;</span><br><span class=\"line\">          name: <span class=\"string\">&#x27;darwin&#x27;</span>,</span><br><span class=\"line\">          architecture: <span class=\"string\">&#x27;x64&#x27;</span>,</span><br><span class=\"line\">          version: <span class=\"string\">&#x27;22.6.0&#x27;</span>,</span><br><span class=\"line\">          <span class=\"built_in\">type</span>: <span class=\"string\">&#x27;Darwin&#x27;</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      active: <span class=\"literal\">true</span>, <span class=\"comment\"># æ“ä½œæ˜¯å¦æ´»è·ƒã€‚å¦‚æœæ˜¯ç©ºé—²çŠ¶æ€åˆ™ä¸ºfalse</span></span><br><span class=\"line\">      currentOpTime: <span class=\"string\">&#x27;2024-04-07T14:54:02.994+08:00&#x27;</span>, <span class=\"comment\"># æ“ä½œçš„å¼€å§‹æ—¶é—´ã€‚MongoDB 3.6ç‰ˆæœ¬æ–°å¢åŠŸèƒ½</span></span><br><span class=\"line\">      threaded: <span class=\"literal\">true</span>,</span><br><span class=\"line\">      opid: 236247, <span class=\"comment\"># opidï¼šå½“å‰æ“ä½œåœ¨æ•°æ®åº“è¿›ç¨‹ä¸­çš„å”¯ä¸€ç¼–å·,å¦‚æœå·²ç»å‘ç°è¯¥æ“ä½œæ­£åœ¨å¯¼è‡´æ•°æ®åº“ç³»ç»Ÿå“åº”ç¼“æ…¢ï¼Œåˆ™å¯ä»¥è€ƒè™‘å°†å…¶â€œæ€â€æ­» : db.killOp(236247)</span></span><br><span class=\"line\">      secs_running: Long(<span class=\"string\">&#x27;3&#x27;</span>), <span class=\"comment\"># æ“ä½œæŒç»­æ—¶é—´,å•ä½ï¼šç§’</span></span><br><span class=\"line\">      microsecs_running: Long(<span class=\"string\">&#x27;3362378&#x27;</span>), <span class=\"comment\"># æ“ä½œæŒç»­æ—¶é—´ï¼Œå•ä½ï¼šå¾®ç§’</span></span><br><span class=\"line\">      op: <span class=\"string\">&#x27;command&#x27;</span>, <span class=\"comment\"># æ ‡è¯†æ“ä½œç±»å‹çš„å­—ç¬¦ä¸²ï¼Œå¦‚ command, insert, query, update, delete, getMore, killCursors</span></span><br><span class=\"line\">      ns: <span class=\"string\">&#x27;admin.$cmd&#x27;</span>, <span class=\"comment\"># æ“ä½œçš„å‘½åç©ºé—´ï¼Œæ ¼å¼ä¸º db.collection</span></span><br><span class=\"line\">      redacted: <span class=\"literal\">false</span>, <span class=\"comment\"># æ˜¯å¦å·²è„±æ•</span></span><br><span class=\"line\">      <span class=\"built_in\">command</span>: &#123; <span class=\"comment\"># æ“ä½œå‘½ä»¤å‚æ•°</span></span><br><span class=\"line\">        hello: 1,</span><br><span class=\"line\">        maxAwaitTimeMS: 10000,</span><br><span class=\"line\">        topologyVersion: &#123;</span><br><span class=\"line\">          processId: ObjectId(<span class=\"string\">&#x27;6611f8cd59f7cfaa5c8cd7e4&#x27;</span>),</span><br><span class=\"line\">          counter: Long(<span class=\"string\">&#x27;18&#x27;</span>)</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        <span class=\"string\">&#x27;$clusterTime&#x27;</span>: &#123;</span><br><span class=\"line\">          clusterTime: Timestamp(&#123; t: 1712470998, i: 1 &#125;),</span><br><span class=\"line\">          signature: &#123;</span><br><span class=\"line\">            <span class=\"built_in\">hash</span>: Binary.createFromBase64(<span class=\"string\">&#x27;gvgo03Wqi1AuOVqnrlhzKIK2NAU=&#x27;</span>, 0),</span><br><span class=\"line\">            keyId: Long(<span class=\"string\">&#x27;7346062378896719877&#x27;</span>)</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        <span class=\"string\">&#x27;$db&#x27;</span>: <span class=\"string\">&#x27;admin&#x27;</span></span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      numYields: 0,</span><br><span class=\"line\">      locks: &#123;&#125;, <span class=\"comment\"># å½“å‰æ“ä½œæŒæœ‰é”çš„ç±»å‹å’Œæ¨¡å¼ã€‚</span></span><br><span class=\"line\">      waitingForLock: <span class=\"literal\">false</span>, <span class=\"comment\"># æ˜¯å¦åœ¨ç­‰å¾…é”</span></span><br><span class=\"line\">      lockStats: &#123;&#125;, <span class=\"comment\"># å½“å‰æ“ä½œæŒæœ‰é”çš„ç»Ÿè®¡ã€‚</span></span><br><span class=\"line\">      waitingForFlowControl: <span class=\"literal\">false</span>,</span><br><span class=\"line\">      flowControlStats: &#123;&#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦</span><br><span class=\"line\">]</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹ç­‰å¾…é”çš„å¢åŠ ã€åˆ é™¤ã€ä¿®æ”¹ã€æŸ¥è¯¢æ“ä½œ</span></span><br><span class=\"line\">&gt; db.currentOp(&#123;</span><br><span class=\"line\"> waitingForLock:<span class=\"literal\">true</span>,</span><br><span class=\"line\"> <span class=\"variable\">$or</span>:[</span><br><span class=\"line\">  &#123;op:&#123;<span class=\"variable\">$in</span>:[<span class=\"string\">&quot;insert&quot;</span>,<span class=\"string\">&quot;update&quot;</span>,<span class=\"string\">&quot;remove&quot;</span>]&#125;&#125;,</span><br><span class=\"line\">  &#123;<span class=\"string\">&quot;query.findandmodify&quot;</span>:&#123;<span class=\"variable\">$exists</span>:<span class=\"literal\">true</span>&#125;&#125;</span><br><span class=\"line\">  ]</span><br><span class=\"line\"> &#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹æ‰§è¡Œæ—¶é—´è¶…è¿‡1sçš„æ“ä½œ</span></span><br><span class=\"line\">&gt; db.currentOp(&#123;</span><br><span class=\"line\">   secs_running:&#123;<span class=\"variable\">$gt</span>:1&#125;</span><br><span class=\"line\"> &#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹testæ•°æ®åº“ä¸­çš„æ“ä½œ</span></span><br><span class=\"line\">&gt; db.currentOp(&#123;</span><br><span class=\"line\">   ns:/test/</span><br><span class=\"line\"> &#125;)</span><br></pre></td></tr></table></figure>","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç»MongoDB7.0çš„ä¸€äº›æœ‰ç”¨çš„åŠŸèƒ½ï¼Œæ¯”å¦‚è¿è¡Œjsï¼ŒæŸ¥çœ‹æ…¢æŸ¥è¯¢æ—¥å¿—ç­‰ç­‰ MongoDBå®˜æ–¹æ–‡æ¡£ æœ¬æ–‡åŸºäºCentOS8(x86_64) è¿è¡Œjs è¿è¡Œjsæ–‡ä»¶ insertMany.js 1234567891011121314151617var tags = [&#x27;nosql&#x27;, &#x27;mongodb&#x27;, &#x27;document&#x27;, &#x27;developer&#x27;, &#x27;popular&#x27;]var types = [&#x27;technology&#x27;, &#x27;sociality&#x27;, &#x27;travel&#x27;, &#x27;novel&#x27;, &#x27;literature&#x27;]var books = []for (var i = 0; i &lt; 50; i++) &#123; var typeIdx = Math.floor(Math.random() * types.length) var tagIdx = Math.floor(Math.random() * tags.length) var favCount = Math.floor(Math.random() * 100) var book = &#123; title: &#x27;book-&#x27; + i, type: types[typeIdx], tag: tags[tagIdx], favCount: favCount, author: &#x27;xxx&#x27; + i &#125; books.push(book)&#125;db.books.insertMany(books) 12# -f è¿è¡Œjsæ–‡ä»¶mongosh &quot;mongodb://user:password@10.1.2.26:27017,10.1.2.142:27017,10.1.2.41:27017/test?authSource=admin&amp;replicaSet=rs0&quot; -f insertMany.js è¿è¡Œjsè¯­å¥ 1234567891011121314151617181920# ---eval è¿è¡Œjsè¯­å¥mongosh &quot;mongodb://user:password@10.1.2.26:27017,10.1.2.142:27017,10.1.2.41:27017/test?authSource=admin&amp;replicaSet=rs0&quot; --eval &quot;db.books.find().limit(2)&quot;[ &#123; _id: ObjectId(&#x27;660d0b05a8a6c09b0b1852b7&#x27;), title: &#x27;book-0&#x27;, type: &#x27;novel&#x27;, tag: &#x27;document&#x27;, favCount: 58, author: &#x27;xxx0&#x27; &#125;, &#123; _id: ObjectId(&#x27;660d0b05a8a6c09b0b1852b8&#x27;), title: &#x27;book-1&#x27;, type: &#x27;novel&#x27;, tag: &#x27;popular&#x27;, favCount: 10, author: &#x27;xxx1&#x27; &#125;] Profileræ¨¡å— Profileræ¨¡å—å¯ä»¥ç”¨æ¥è®°å½•ã€åˆ†æMongoDBçš„è¯¦ç»†æ“ä½œæ—¥å¿—ï¼Œé»˜è®¤æƒ…å†µä¸‹è¯¥åŠŸèƒ½æ˜¯å…³é—­çš„ã€‚ Profileræ¨¡å—å¼€å¯å¯¹äºæ¯ä¸ªä¸šåŠ¡åº“æ¥è¯´æ˜¯ç‹¬ç«‹çš„ï¼Œå¯¹æŸä¸ªä¸šåŠ¡åº“å¼€å¯Profileræ¨¡å—ä¹‹åï¼Œç¬¦åˆæ¡ä»¶çš„æ…¢æ“ä½œæ—¥å¿—ä¼šè¢«å†™å…¥è¯¥åº“çš„system.profileé›†åˆä¸­ã€‚ Profileræ¨¡å—çš„è°ƒè¯•çº§åˆ«æœ‰ï¼š 1230ï¼šå…³é—­Profileræ¨¡å—ï¼›1ï¼šéƒ¨åˆ†å¼€å¯ï¼Œä»…ç¬¦åˆæ¡ä»¶ï¼ˆæ—¶é•¿å¤§äºslowmsï¼‰çš„æ“ä½œæ—¥å¿—ä¼šè¢«è®°å½•ï¼›2ï¼šæ—¥å¿—å…¨å¼€ï¼Œæ‰€æœ‰çš„æ“ä½œæ—¥å¿—éƒ½è¢«è®°å½•ï¼› è®¾ç½®Profileræ¨¡å—çš„è°ƒè¯•çº§åˆ«ï¼š 123456789101112131415161718192021222324252627# è®¾ç½®Profileræ¨¡å—çš„è°ƒè¯•çº§åˆ«ä¸º2&gt; db.setProfilingLevel(2)# æŸ¥çœ‹å½“çš„è°ƒè¯•çº§åˆ«ä¿¡æ¯&gt; db.getProfilingStatus()&#123; was: 2, # å½“å‰çš„è°ƒè¯•çº§åˆ« slowms: 100, # æ…¢æŸ¥è¯¢çš„é˜ˆå€¼ï¼Œå•ä½æ˜¯æ¯«ç§’ï¼› sampleRate: 1.0, # æ—¥å¿—éšæœºé‡‡æ ·ç‡ï¼Œ1.0åˆ™è¡¨ç¤ºæ»¡è¶³æ¡ä»¶çš„å…¨éƒ¨è¾“å‡ºã€‚ ok: 1, # çŠ¶æ€ &#x27;$clusterTime&#x27;: &#123; # æ—¶é—´æˆ³ clusterTime: Timestamp(&#123; t: 1712471779, i: 1 &#125;), # æ—¶é—´æˆ³ signature: &#123; # ç­¾å hash: Binary.createFromBase64(&#x27;GGCAjzJrW8arhfJX0Cn0VpvC5MA=&#x27;, 0), # ç­¾å keyId: Long(&#x27;7346062378896719877&#x27;) # ç­¾å &#125; &#125;, operationTime: Timestamp(&#123; t: 1712471779, i: 1 &#125;) # æ“ä½œæ—¶é—´&#125;# åªè®°å½•æ—¶é•¿è¶…è¿‡500msçš„æ“ä½œ&gt; db.setProfilingLevel(1,500)# åŒæ—¶åŠ ä¸Šé‡‡æ ·ç‡&gt; db.setProfilingLevel(1,&#123;slowms:500,sampleRate:0.5&#125;)# å…³é—­Profileræ¨¡å—&gt; db.setProfilingLevel(2) æŸ¥çœ‹æ—¥å¿— 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869# æŸ¥çœ‹æ“ä½œæ—¥å¿—&gt; db.system.profile.find().limit(5).sort(&#123;ts:-1&#125;).pretty()[ &#123; op: &#x27;query&#x27;, # æ“ä½œç±»å‹,æ¯”å¦‚æŸ¥è¯¢,æ›´æ–°,åˆ é™¤ç­‰ ns: &#x27;admin.system.profile&#x27;, # æ“ä½œçš„é›†åˆ command: &#123; # æ“ä½œçš„å‘½ä»¤ find: &#x27;system.profile&#x27;, # æ“ä½œçš„é›†åˆ filter: &#123;&#125;, # æŸ¥è¯¢æ¡ä»¶ lsid: &#123; id: UUID(&#x27;2285d6a5-b2df-4b46-b9d2-5e556b0a7c7d&#x27;) &#125;, # ä¼šè¯id &#x27;$clusterTime&#x27;: &#123; # æ—¶é—´æˆ³ clusterTime: Timestamp(&#123; t: 1712471018, i: 1 &#125;), signature: &#123; hash: Binary.createFromBase64(&#x27;8YEsN+XUWO6EkoHEegKkG49eWPA=&#x27;, 0), keyId: Long(&#x27;7346062378896719877&#x27;) &#125; &#125;, &#x27;$db&#x27;: &#x27;admin&#x27;, # æ•°æ®åº“ &#x27;$readPreference&#x27;: &#123; mode: &#x27;primaryPreferred&#x27; &#125; # è¯»åå¥½ &#125;, keysExamined: 0, # æ‰«æç´¢å¼•æ¡ç›®æ•°ï¼Œå¦‚æœæ¯”nreturnedå¤§å‡ºå¾ˆå¤šï¼Œåˆ™è¯´æ˜æŸ¥è¯¢æ•ˆç‡ä¸é«˜ã€‚ docsExamined: 3, # æ‰«ææ–‡æ¡£æ¡ç›®æ•°ï¼Œå¦‚æœæ¯”nreturnedå¤§å‡ºå¾ˆå¤šï¼Œåˆ™è¯´æ˜æŸ¥è¯¢æ•ˆç‡ä¸é«˜ã€‚ nBatches: 1, # æ‰¹å¤„ç†æ•°é‡ cursorExhausted: true, # æ˜¯å¦æ¸¸æ ‡å·²è€—å°½ numYield: 0, # æ“ä½œæ•°ï¼Œå¤§äº0è¡¨ç¤ºç­‰å¾…é”æˆ–è€…æ˜¯ç£ç›˜I/Oæ“ä½œ nreturned: 3, # è¿”å›çš„æ–‡æ¡£æ•°é‡ queryHash: &#x27;8880B5AF&#x27;, # æŸ¥è¯¢å“ˆå¸Œå€¼ planCacheKey: &#x27;8880B5AF&#x27;, queryFramework: &#x27;classic&#x27;, locks: &#123; # é”å ç”¨çš„æƒ…å†µã€‚ FeatureCompatibilityVersion: &#123; acquireCount: &#123; r: Long(&#x27;1&#x27;) &#125; &#125;, Global: &#123; acquireCount: &#123; r: Long(&#x27;1&#x27;) &#125; &#125; &#125;, flowControl: &#123;&#125;, readConcern: &#123; level: &#x27;local&#x27;, provenance: &#x27;implicitDefault&#x27; &#125;, # è¯»å…³æ³¨ responseLength: 3414, # å“åº”æ•°æ®å¤§å°ï¼ˆå­—èŠ‚æ•°ï¼‰ï¼Œä¸€æ¬¡æ€§æŸ¥è¯¢å¤ªå¤šçš„æ•°æ®ä¼šå½±å“æ€§èƒ½ï¼Œå¯ä»¥ä½¿ç”¨limitã€batchSizeè¿›è¡Œä¸€äº›é™åˆ¶ã€‚ protocol: &#x27;op_msg&#x27;, # åè®®ç±»å‹ï¼Œop_msgæ˜¯mongodb 4.0+çš„åè®®ï¼Œop_queryæ˜¯mongodb 3.2åŠä»¥å‰ç‰ˆæœ¬çš„åè®®ã€‚ millis: 0, # å‘½ä»¤æ‰§è¡Œçš„æ—¶é•¿ï¼Œå•ä½æ˜¯æ¯«ç§’ã€‚ planSummary: &#x27;COLLSCAN&#x27;, # æŸ¥è¯¢è®¡åˆ’çš„æ¦‚è¦ï¼Œå¦‚IXSCANè¡¨ç¤ºä½¿ç”¨äº†ç´¢å¼•æ‰«æã€‚ planningTimeMicros: 79, execStats: &#123; # æ‰§è¡Œè¿‡ç¨‹ç»Ÿè®¡ä¿¡æ¯ã€‚ stage: &#x27;COLLSCAN&#x27;, nReturned: 3, executionTimeMillisEstimate: 0, works: 4, advanced: 3, needTime: 0, needYield: 0, saveState: 0, restoreState: 0, isEOF: 1, direction: &#x27;forward&#x27;, docsExamined: 3 &#125;, ts: ISODate(&#x27;2024-04-07T06:23:56.054Z&#x27;), # å‘½ä»¤æ‰§è¡Œçš„æ—¶é—´ç‚¹ã€‚ client: &#x27;127.0.0.1&#x27;, # å®¢æˆ·ç«¯åœ°å€ã€‚ appName: &#x27;mongosh 2.1.5&#x27;, # å®¢æˆ·ç«¯åç§°ã€‚ allUsers: [ &#123; user: &#x27;user&#x27;, db: &#x27;admin&#x27; &#125; ], # æ‰€æœ‰ç”¨æˆ·ä¿¡æ¯ã€‚ user: &#x27;user@admin&#x27; # å½“å‰ç”¨æˆ·ä¿¡æ¯ã€‚ &#125;â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦]# æŸ¥çœ‹æ‰§è¡Œæ—¶é•¿æœ€å¤§çš„10æ¡æ“ä½œè®°å½•&gt; db.system.profile.find().limit(10).sort(&#123;millis:-1&#125;).pretty()# æŸ¥çœ‹æŸä¸ªé›†åˆä¸­çš„updateæ“ä½œæ—¥å¿—&gt; db.system.profile.find(&#123;op:&quot;update&quot;,ns:&quot;shop.user&quot;&#125;) system.profileæ˜¯ä¸€ä¸ª1MBçš„å›ºå®šå¤§å°çš„é›†åˆï¼Œéšç€è®°å½•æ—¥å¿—çš„å¢å¤šï¼Œä¸€äº›æ—§çš„è®°å½•ä¼šè¢«æ»šåŠ¨åˆ é™¤ã€‚ Profileræ¨¡å—çš„è®¾ç½®æ˜¯å†…å­˜çº§çš„ï¼Œé‡å¯æœåŠ¡å™¨åä¼šè‡ªåŠ¨æ¢å¤é»˜è®¤çŠ¶æ€ã€‚ db.currentOp() Profileræ¨¡å—æ‰€è®°å½•çš„æ—¥å¿—éƒ½æ˜¯å·²ç»å‘ç”Ÿçš„äº‹æƒ…ï¼Œdb.currentOp()å‘½ä»¤åˆ™ä¸æ­¤ç›¸åï¼Œå®ƒå¯ä»¥ç”¨æ¥æŸ¥çœ‹æ•°æ®åº“å½“å‰æ­£åœ¨æ‰§è¡Œçš„ä¸€äº›æ“ä½œã€‚ db.currentOp()è¯»å–çš„æ˜¯å½“å‰æ•°æ®åº“çš„å‘½ä»¤å¿«ç…§ï¼Œè¯¥å‘½ä»¤å¯ä»¥è¿”å›è®¸å¤šæœ‰ç”¨çš„ä¿¡æ¯ï¼Œæ¯”å¦‚ï¼š 123æ“ä½œçš„è¿è¡Œæ—¶é•¿ï¼Œå¿«é€Ÿå‘ç°è€—æ—¶æ¼«é•¿çš„ä½æ•ˆæ‰«ææ“ä½œã€‚æ‰§è¡Œè®¡åˆ’ä¿¡æ¯ï¼Œç”¨äºåˆ¤æ–­æ˜¯å¦å‘½ä¸­äº†ç´¢å¼•ï¼Œæˆ–è€…å­˜åœ¨é”å†²çªçš„æƒ…å†µã€‚æ“ä½œIDã€æ—¶é—´ã€å®¢æˆ·ç«¯ç­‰ä¿¡æ¯ï¼Œæ–¹ä¾¿å®šä½å‡ºäº§ç”Ÿæ…¢æ“ä½œçš„æºå¤´ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677&gt; db.currentOp()&#123;inprog: [ # å½“å‰æ­£åœ¨æ‰§è¡Œçš„æ“ä½œ &#123; type: &#x27;op&#x27;, # æ“ä½œç±»å‹ï¼Œå¯ä»¥æ˜¯opã€idleSessionã€idleCursorçš„ä¸€ç§ï¼Œä¸€èˆ¬çš„æ“ä½œä¿¡æ¯ä»¥opè¡¨ç¤ºã€‚å…¶ä¸ºMongoDB 4.2ç‰ˆæœ¬æ–°å¢åŠŸèƒ½ host: &#x27;localhost:27041&#x27;, # æ“ä½œæ‰€åœ¨çš„ä¸»æœº desc: &#x27;conn474&#x27;, # æ“ä½œçš„æè¿°ä¿¡æ¯ connectionId: 474, # æ“ä½œçš„è¿æ¥ID client: &#x27;127.0.0.1:58103&#x27;, # æ“ä½œçš„å®¢æˆ·ç«¯ä¿¡æ¯ appName: &#x27;mongosh 2.1.5&#x27;, # æ“ä½œçš„å®¢æˆ·ç«¯åº”ç”¨ä¿¡æ¯ clientMetadata: &#123; # å…³äºå®¢æˆ·ç«¯çš„é™„åŠ ä¿¡æ¯ï¼Œå¯ä»¥åŒ…å«é©±åŠ¨çš„ç‰ˆæœ¬ã€‚ application: &#123; name: &#x27;mongosh 2.1.5&#x27; &#125;, driver: &#123; name: &#x27;nodejs|mongosh&#x27;, version: &#x27;6.3.0|2.1.5&#x27; &#125;, platform: &#x27;Node.js v20.11.1, LE&#x27;, os: &#123; name: &#x27;darwin&#x27;, architecture: &#x27;x64&#x27;, version: &#x27;22.6.0&#x27;, type: &#x27;Darwin&#x27; &#125; &#125;, active: true, # æ“ä½œæ˜¯å¦æ´»è·ƒã€‚å¦‚æœæ˜¯ç©ºé—²çŠ¶æ€åˆ™ä¸ºfalse currentOpTime: &#x27;2024-04-07T14:54:02.994+08:00&#x27;, # æ“ä½œçš„å¼€å§‹æ—¶é—´ã€‚MongoDB 3.6ç‰ˆæœ¬æ–°å¢åŠŸèƒ½ threaded: true, opid: 236247, # opidï¼šå½“å‰æ“ä½œåœ¨æ•°æ®åº“è¿›ç¨‹ä¸­çš„å”¯ä¸€ç¼–å·,å¦‚æœå·²ç»å‘ç°è¯¥æ“ä½œæ­£åœ¨å¯¼è‡´æ•°æ®åº“ç³»ç»Ÿå“åº”ç¼“æ…¢ï¼Œåˆ™å¯ä»¥è€ƒè™‘å°†å…¶â€œæ€â€æ­» : db.killOp(236247) secs_running: Long(&#x27;3&#x27;), # æ“ä½œæŒç»­æ—¶é—´,å•ä½ï¼šç§’ microsecs_running: Long(&#x27;3362378&#x27;), # æ“ä½œæŒç»­æ—¶é—´ï¼Œå•ä½ï¼šå¾®ç§’ op: &#x27;command&#x27;, # æ ‡è¯†æ“ä½œç±»å‹çš„å­—ç¬¦ä¸²ï¼Œå¦‚ command, insert, query, update, delete, getMore, killCursors ns: &#x27;admin.$cmd&#x27;, # æ“ä½œçš„å‘½åç©ºé—´ï¼Œæ ¼å¼ä¸º db.collection redacted: false, # æ˜¯å¦å·²è„±æ• command: &#123; # æ“ä½œå‘½ä»¤å‚æ•° hello: 1, maxAwaitTimeMS: 10000, topologyVersion: &#123; processId: ObjectId(&#x27;6611f8cd59f7cfaa5c8cd7e4&#x27;), counter: Long(&#x27;18&#x27;) &#125;, &#x27;$clusterTime&#x27;: &#123; clusterTime: Timestamp(&#123; t: 1712470998, i: 1 &#125;), signature: &#123; hash: Binary.createFromBase64(&#x27;gvgo03Wqi1AuOVqnrlhzKIK2NAU=&#x27;, 0), keyId: Long(&#x27;7346062378896719877&#x27;) &#125; &#125;, &#x27;$db&#x27;: &#x27;admin&#x27; &#125;, numYields: 0, locks: &#123;&#125;, # å½“å‰æ“ä½œæŒæœ‰é”çš„ç±»å‹å’Œæ¨¡å¼ã€‚ waitingForLock: false, # æ˜¯å¦åœ¨ç­‰å¾…é” lockStats: &#123;&#125;, # å½“å‰æ“ä½œæŒæœ‰é”çš„ç»Ÿè®¡ã€‚ waitingForFlowControl: false, flowControlStats: &#123;&#125; &#125;â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦]&#125;# æŸ¥çœ‹ç­‰å¾…é”çš„å¢åŠ ã€åˆ é™¤ã€ä¿®æ”¹ã€æŸ¥è¯¢æ“ä½œ&gt; db.currentOp(&#123; waitingForLock:true, $or:[ &#123;op:&#123;$in:[&quot;insert&quot;,&quot;update&quot;,&quot;remove&quot;]&#125;&#125;, &#123;&quot;query.findandmodify&quot;:&#123;$exists:true&#125;&#125; ] &#125;)# æŸ¥çœ‹æ‰§è¡Œæ—¶é—´è¶…è¿‡1sçš„æ“ä½œ&gt; db.currentOp(&#123; secs_running:&#123;$gt:1&#125; &#125;)# æŸ¥çœ‹testæ•°æ®åº“ä¸­çš„æ“ä½œ&gt; db.currentOp(&#123; ns:/test/ &#125;)","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç»MongoDB7.0çš„ä¸€äº›æœ‰ç”¨çš„åŠŸèƒ½ï¼Œæ¯”å¦‚è¿è¡Œjsï¼ŒæŸ¥çœ‹æ…¢æŸ¥è¯¢æ—¥å¿—ç­‰ç­‰ MongoDBå®˜æ–¹æ–‡æ¡£ æœ¬æ–‡åŸºäºCentOS8(x86_64)","date_published":"2024-04-07T13:30:05.000Z","tags":["æŠ€æœ¯","linux","mongodb","mongodb"]},{"id":"https://blog.hanqunfeng.com/2024/04/03/mongodb7-tools/","url":"https://blog.hanqunfeng.com/2024/04/03/mongodb7-tools/","title":"MongoDB Command Line Database Tools","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç»Linuxä¸‹MongoDB Command Line Database Toolsçš„å®‰è£…ä¸ä½¿ç”¨</p>\n</li>\n<li class=\"lvl-2\">\n<p>MongoDB Command Line Database Tools<a href=\"https://www.mongodb.com/docs/database-tools/\">å®˜æ–¹æ–‡æ¡£</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡åŸºäº<code>CentOS8(x86_64)</code></p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"MongoDB-Database-Tools\">MongoDB Database Tools</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>MongoDB Database Toolsæ˜¯MongoDBå®˜æ–¹æä¾›çš„æ•°æ®åº“ç®¡ç†å·¥å…·ï¼Œå¯ä»¥ç”¨äºç®¡ç†MongoDBæ•°æ®åº“ï¼ŒåŒ…æ‹¬MongoDBçš„å¤‡ä»½ã€æ¢å¤ã€ç›‘æ§ç­‰åŠŸèƒ½ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://www.mongodb.com/try/download/database-tools\">MongoDB Database Toolsçš„ä¸‹è½½åœ°å€</a></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ä¸‹è½½å®‰è£…åŒ…</span></span><br><span class=\"line\">wget https://fastdl.mongodb.org/tools/db/mongodb-database-tools-rhel80-x86_64-100.9.4.tgz</span><br><span class=\"line\"><span class=\"comment\"># è§£å‹å®‰è£…åŒ…</span></span><br><span class=\"line\">tar -xvzf mongodb-database-tools-rhel80-x86_64-100.9.4.tgz</span><br><span class=\"line\"><span class=\"comment\"># åˆ›å»ºè½¯è¿æ¥</span></span><br><span class=\"line\"><span class=\"built_in\">ln</span> -s mongodb-database-tools-rhel80-x86_64-100.9.4 /mongodb/tools</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åœ¨/etc/profileæ–‡ä»¶ä¸­é…ç½®PATHç¯å¢ƒå˜é‡</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> PATH=/mongodb/tools/bin:<span class=\"variable\">$PATH</span></span><br><span class=\"line\"><span class=\"comment\"># ä½¿é…ç½®ç”Ÿæ•ˆ</span></span><br><span class=\"line\"><span class=\"built_in\">source</span> /etc/profile</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>MongoDB Database Toolså¸¸ç”¨å‘½ä»¤ï¼Œè¯¦ç»†çš„ä½¿ç”¨æ–¹æ³•è¯·æŸ¥çœ‹<a href=\"https://www.mongodb.com/docs/database-tools/\">å®˜æ–¹æ–‡æ¡£</a></p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>æ–‡ä»¶åç§°</th>\n<th>ä½œç”¨</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>mongostat</td>\n<td>æ•°æ®åº“æ€§èƒ½ç›‘æ§å·¥å…·</td>\n</tr>\n<tr>\n<td>mongotop</td>\n<td>çƒ­ç‚¹è¡¨ç›‘æ§å·¥å…·</td>\n</tr>\n<tr>\n<td>mongodump</td>\n<td>æ•°æ®åº“é€»è¾‘å¤‡ä»½å·¥å…·</td>\n</tr>\n<tr>\n<td>mongorestore</td>\n<td>æ•°æ®åº“é€»è¾‘æ¢å¤å·¥å…·</td>\n</tr>\n<tr>\n<td>mongoexport</td>\n<td>æ•°æ®å¯¼å‡ºå·¥å…·</td>\n</tr>\n<tr>\n<td>mongoimport</td>\n<td>æ•°æ®å¯¼å…¥å·¥å…·</td>\n</tr>\n<tr>\n<td>bsondump</td>\n<td>BSONæ ¼å¼è½¬æ¢å·¥å…·</td>\n</tr>\n<tr>\n<td>mongofiles</td>\n<td>GridFSæ–‡ä»¶å·¥å…·</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"mongoexport-å¯¼å‡ºæ•°æ®\">mongoexport: å¯¼å‡ºæ•°æ®</h2>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å¯¼å‡ºcsvæ ¼å¼çš„æ•°æ®</span></span><br><span class=\"line\">mongoexport <span class=\"string\">&quot;mongodb://user:password@10.1.2.26:27017,10.1.2.142:27017,10.1.2.41:27017/?authSource=admin&amp;replicaSet=rs0&quot;</span> -d <span class=\"built_in\">test</span> -c books -f _id,title,<span class=\"built_in\">type</span>,tag --<span class=\"built_in\">type</span>=csv -o books.csv</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å¯¼å‡ºjsonæ ¼å¼çš„æ•°æ®</span></span><br><span class=\"line\">mongoexport <span class=\"string\">&quot;mongodb://user:password@10.1.2.26:27017,10.1.2.142:27017,10.1.2.41:27017/?authSource=admin&amp;replicaSet=rs0&quot;</span> -d <span class=\"built_in\">test</span> -c books -f _id,title,<span class=\"built_in\">type</span>,tag --<span class=\"built_in\">type</span>=json -o books.json</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å‚æ•°è¯´æ˜</span></span><br><span class=\"line\">-d æŒ‡å®šæ•°æ®åº“</span><br><span class=\"line\">-c æŒ‡å®šé›†åˆ</span><br><span class=\"line\">-f æŒ‡å®šå¯¼å‡ºå­—æ®µï¼Œcsvæ ¼å¼éœ€è¦æŒ‡å®šå­—æ®µï¼Œjsonæ ¼å¼å¯ä»¥ä¸æŒ‡å®šå­—æ®µï¼Œé»˜è®¤å¯¼å‡ºå…¨éƒ¨</span><br><span class=\"line\">--<span class=\"built_in\">type</span>=csv/json æŒ‡å®šå¯¼å‡ºæ ¼å¼</span><br><span class=\"line\">-o æŒ‡å®šå¯¼å‡ºæ–‡ä»¶</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å¯¼å‡ºæ—¶å¯ä»¥å¢åŠ è¿‡æ»¤æ¡ä»¶</span></span><br><span class=\"line\">mongoexport <span class=\"string\">&quot;mongodb://user:password@10.1.2.26:27017,10.1.2.142:27017,10.1.2.41:27017?authSource=admin&amp;replicaSet=rs0&quot;</span> -d mydb -c user --<span class=\"built_in\">type</span>=json -o user.json  --<span class=\"built_in\">limit</span>=10 --skip=2 --<span class=\"built_in\">sort</span>=<span class=\"string\">&#x27;&#123;&quot;name&quot;:1&#125;&#x27;</span> --query=<span class=\"string\">&#x27;&#123;&quot;age&quot;:&#123;&quot;$gt&quot;:25&#125;,&quot;name&quot;:&quot;zhangsan&quot;&#125;&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å‚æ•°è¯´æ˜</span></span><br><span class=\"line\">--<span class=\"built_in\">limit</span>=10 æŒ‡å®šå¯¼å‡ºæ¡æ•°</span><br><span class=\"line\">--skip=2 æŒ‡å®šè·³è¿‡æ¡æ•°</span><br><span class=\"line\">--<span class=\"built_in\">sort</span>=<span class=\"string\">&#x27;&#123;&quot;name&quot;:1&#125;&#x27;</span> æŒ‡å®šæ’åºå­—æ®µ</span><br><span class=\"line\">--query=<span class=\"string\">&#x27;&#123;&quot;age&quot;:&#123;&quot;$gt&quot;:25&#125;,&quot;name&quot;:&quot;zhangsan&quot;&#125;&#x27;</span> æŒ‡å®šæŸ¥è¯¢æ¡ä»¶ï¼Œæ³¨æ„è¿™é‡Œçš„æŸ¥è¯¢æ¡ä»¶æ˜¯jsonæ ¼å¼ï¼Œå­—æ®µåéœ€è¦ä½¿ç”¨åŒå¼•å·åŒ…è£¹</span><br></pre></td></tr></table></figure>\n<h2 id=\"mongoimport-å¯¼å…¥æ•°æ®\">mongoimport: å¯¼å…¥æ•°æ®</h2>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å¯¼å…¥csvæ ¼å¼çš„æ•°æ®</span></span><br><span class=\"line\"><span class=\"comment\"># æ³¨æ„æ­¤æ—¶å¯¼å…¥çš„csvæ–‡ä»¶ä¸­ç¬¬ä¸€è¡Œå¦‚æœæ˜¯å­—æ®µåï¼Œéœ€è¦å…ˆåˆ é™¤ç¬¬ä¸€è¡Œå†å¯¼å…¥ï¼Œè¿™é‡Œä½¿ç”¨äº† -f æŒ‡å®šå­—æ®µï¼Œæ¥å’Œå¯¼å…¥çš„csvæ–‡ä»¶çš„åˆ—ä¸€ä¸€å¯¹åº”</span></span><br><span class=\"line\">mongoimport <span class=\"string\">&quot;mongodb://user:password@10.1.2.26:27017,10.1.2.142:27017,10.1.2.41:27017/?authSource=admin&amp;replicaSet=rs0&quot;</span> -d <span class=\"built_in\">test</span> -c books_new -f _id,title,<span class=\"built_in\">type</span>,tag --<span class=\"built_in\">type</span>=csv --file books.csv</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ³¨æ„æ­¤æ—¶å¯¼å…¥çš„csvæ–‡ä»¶ä¸­ç¬¬ä¸€è¡Œå¦‚æœæ˜¯å­—æ®µåï¼Œéœ€è¦å…ˆåˆ é™¤ç¬¬ä¸€è¡Œå†å¯¼å…¥ï¼Œè¿™é‡Œä½¿ç”¨äº† -f æŒ‡å®šå­—æ®µï¼Œæ¥å’Œå¯¼å…¥çš„csvæ–‡ä»¶çš„åˆ—ä¸€ä¸€å¯¹åº”</span></span><br><span class=\"line\">mongoimport <span class=\"string\">&quot;mongodb://user:password@10.1.2.26:27017,10.1.2.142:27017,10.1.2.41:27017/?authSource=admin&amp;replicaSet=rs0&quot;</span> -d <span class=\"built_in\">test</span> -c books_new --headerline --<span class=\"built_in\">type</span>=csv --file books.csv</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å¯¼å…¥jsonæ ¼å¼çš„æ•°æ®</span></span><br><span class=\"line\">mongoimport <span class=\"string\">&quot;mongodb://user:password@10.1.2.26:27017,10.1.2.142:27017,10.1.2.41:27017/?authSource=admin&amp;replicaSet=rs0&quot;</span> -d <span class=\"built_in\">test</span> -c books_new --<span class=\"built_in\">type</span>=json --file books.json</span><br><span class=\"line\"></span><br><span class=\"line\">-d æŒ‡å®šæ•°æ®åº“</span><br><span class=\"line\">-c æŒ‡å®šé›†åˆ</span><br><span class=\"line\">-f æŒ‡å®šå¯¼å…¥å­—æ®µï¼Œcsvæ ¼å¼éœ€è¦æŒ‡å®šå­—æ®µ</span><br><span class=\"line\">--headerline æŒ‡å®šç¬¬ä¸€è¡Œæ˜¯å­—æ®µå</span><br><span class=\"line\">--<span class=\"built_in\">type</span>=csv/json æŒ‡å®šå¯¼å…¥æ ¼å¼</span><br><span class=\"line\">--file æŒ‡å®šå¯¼å…¥æ–‡ä»¶</span><br><span class=\"line\">--mode æŒ‡å®šå¯¼å…¥æ–¹å¼ï¼Œé»˜è®¤æ˜¯insertï¼Œè¿˜å¯ä»¥æ˜¯upsertï¼Œmergeï¼Œdelete</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>modeè¯´æ˜</p>\n</blockquote>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>insert: é»˜è®¤å€¼ï¼Œå¦‚æœæ•°æ®ä¸å­˜åœ¨ï¼Œåˆ™æ’å…¥ï¼Œå¦‚æœå­˜åœ¨ï¼Œåˆ™æŠ¥é”™</p>\n</li>\n<li class=\"lvl-2\">\n<p>upsert: å¦‚æœæ•°æ®ä¸å­˜åœ¨ï¼Œåˆ™æ’å…¥ï¼Œå¦‚æœå­˜åœ¨ï¼Œåˆ™æ›´æ–°</p>\n</li>\n<li class=\"lvl-2\">\n<p>merge: å¦‚æœæ•°æ®ä¸å­˜åœ¨ï¼Œåˆ™æ’å…¥ï¼Œå¦‚æœå­˜åœ¨ï¼Œåˆ™åˆå¹¶åæ›´æ–°</p>\n</li>\n<li class=\"lvl-2\">\n<p>delete: å¦‚æœæ•°æ®ä¸å­˜åœ¨ï¼Œä¹Ÿä¸æ‰§è¡Œæ’å…¥ï¼Œå¦‚æœå­˜åœ¨ï¼Œåˆ™åˆ é™¤</p>\n</li>\n</ul>\n<h2 id=\"mongostat-æ•°æ®åº“æ€§èƒ½ç›‘æ§\">mongostat: æ•°æ®åº“æ€§èƒ½ç›‘æ§</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>mongostatå‘½ä»¤ç”¨äºå®æ—¶ç›‘æ§MongoDBæ•°æ®åº“çš„æ€§èƒ½ï¼ŒåŒ…æ‹¬è¿æ¥æ•°ã€æ–‡æ¡£æ•°ã€ç´¢å¼•æ•°ã€å†…å­˜ä½¿ç”¨æƒ…å†µç­‰ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ç›‘æ§20æ¬¡ï¼Œé—´éš”1ç§’</span></span><br><span class=\"line\">mongostat <span class=\"string\">&quot;mongodb://user:password@10.1.2.26:27017,10.1.2.142:27017,10.1.2.41:27017/?authSource=admin&amp;replicaSet=rs0&quot;</span> -n20 1</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å‚æ•°è¯´æ˜</span></span><br><span class=\"line\">-n æŒ‡å®šç›‘æ§æ¬¡æ•°</span><br><span class=\"line\">1 æŒ‡å®šç›‘æ§é—´éš”æ—¶é—´ï¼Œå•ä½ä¸ºç§’</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ç›‘æ§å®æ—¶æ•°æ®</span></span><br><span class=\"line\">host               insert query update delete getmore <span class=\"built_in\">command</span> dirty  used flushes vsize  res qrw arw net_in net_out conn <span class=\"built_in\">set</span> repl                time</span><br><span class=\"line\">10.1.2.142:27017    *0    *0     *0     *0       0     4|0     0.4%  5.0%       0 2.95G 151M 0|0 0|0  1.13k   75.2k   24 rs0  SLV Apr  3 08:37:49.405</span><br><span class=\"line\">10.1.2.26:27017     *0    *0     *0     *0       0     2|0     0.2%  3.8%       0 2.87G 138M 0|0 0|0   710b   74.3k   14 rs0  SEC Apr  3 08:37:49.385</span><br><span class=\"line\">10.1.2.41:27017     *0    *0     *0     *0       0     5|0     0.0% 17.7%       0 2.96G 184M 0|0 0|0  1.45k   75.5k   16 rs0  SEC Apr  3 08:37:49.426</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>æŒ‡æ ‡è¯´æ˜</p>\n</blockquote>\n<table>\n<thead>\n<tr>\n<th>æŒ‡æ ‡å</th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>inserts</code></td>\n<td>æ¯ç§’æ’å…¥æ•°</td>\n</tr>\n<tr>\n<td><code>query</code></td>\n<td>æ¯ç§’æŸ¥è¯¢æ•°</td>\n</tr>\n<tr>\n<td><code>update</code></td>\n<td>æ¯ç§’æ›´æ–°æ•°</td>\n</tr>\n<tr>\n<td><code>delete</code></td>\n<td>æ¯ç§’åˆ é™¤æ•°</td>\n</tr>\n<tr>\n<td><code>getmore</code></td>\n<td>æ¯ç§’getmoreæ•°</td>\n</tr>\n<tr>\n<td><code>command</code></td>\n<td>æ¯ç§’å‘½ä»¤æ•°ï¼Œæ¶µç›–äº†å†…éƒ¨çš„ä¸€äº›æ“ä½œ</td>\n</tr>\n<tr>\n<td><code>%dirty</code></td>\n<td>WiredTigerç¼“å­˜ä¸­è„æ•°æ®ç™¾åˆ†æ¯”</td>\n</tr>\n<tr>\n<td><code>%used</code></td>\n<td>WiredTiger æ­£åœ¨ä½¿ç”¨çš„ç¼“å­˜ç™¾åˆ†æ¯”</td>\n</tr>\n<tr>\n<td><code>flushes</code></td>\n<td>WiredTigeræ‰§è¡ŒCheckPointçš„æ¬¡æ•°</td>\n</tr>\n<tr>\n<td><code>vsize</code></td>\n<td>è™šæ‹Ÿå†…å­˜ä½¿ç”¨é‡</td>\n</tr>\n<tr>\n<td><code>res</code></td>\n<td>ç‰©ç†å†…å­˜ä½¿ç”¨é‡</td>\n</tr>\n<tr>\n<td><code>qrw</code></td>\n<td>å®¢æˆ·ç«¯è¯»å†™ç­‰å¾…é˜Ÿåˆ—æ•°é‡ï¼Œé«˜å¹¶å‘æ—¶ï¼Œä¸€èˆ¬é˜Ÿåˆ—å€¼ä¼šå‡é«˜</td>\n</tr>\n<tr>\n<td><code>arw</code></td>\n<td>å®¢æˆ·ç«¯è¯»å†™æ´»è·ƒä¸ªæ•°</td>\n</tr>\n<tr>\n<td><code>netIn</code></td>\n<td>ç½‘ç»œæ¥æ”¶æ•°æ®é‡</td>\n</tr>\n<tr>\n<td><code>netOut</code></td>\n<td>ç½‘ç»œå‘é€æ•°æ®é‡</td>\n</tr>\n<tr>\n<td><code>conn</code></td>\n<td>å½“å‰è¿æ¥æ•°</td>\n</tr>\n<tr>\n<td><code>set</code></td>\n<td>æ‰€å±å¤åˆ¶é›†åç§°</td>\n</tr>\n<tr>\n<td><code>repl</code></td>\n<td>å¤åˆ¶èŠ‚ç‚¹çŠ¶æ€ï¼Œå¦‚PRI(ä¸»èŠ‚ç‚¹,æˆ‘è¿™é‡Œä¸»èŠ‚ç‚¹æ˜¾ç¤ºä¸ºSLV),SEC(ä»èŠ‚ç‚¹),ARB(ä»²è£èŠ‚ç‚¹),REC(èŠ‚ç‚¹æ­£åœ¨æ¢å¤),UNK(æœªçŸ¥çŠ¶æ€),RTR(mongos)</td>\n</tr>\n<tr>\n<td><code>time</code></td>\n<td>æ—¶é—´æˆ³</td>\n</tr>\n</tbody>\n</table>\n<blockquote>\n<p>éœ€è¦é‡ç‚¹å…³æ³¨çš„æŒ‡æ ‡<br>\n1.æ’å…¥ã€åˆ é™¤ã€ä¿®æ”¹ã€æŸ¥è¯¢çš„é€Ÿç‡æ˜¯å¦äº§ç”Ÿè¾ƒå¤§æ³¢åŠ¨ï¼Œæ˜¯å¦è¶…å‡ºé¢„æœŸã€‚<br>\n2.qrwã€arwï¼šé˜Ÿåˆ—æ˜¯å¦è¾ƒé«˜ï¼Œè‹¥é•¿æ—¶é—´å¤§äº0åˆ™è¯´æ˜æ­¤æ—¶è¯»å†™é€Ÿåº¦è¾ƒæ…¢ã€‚<br>\n3.connï¼šè¿æ¥æ•°æ˜¯å¦å¤ªå¤šã€‚<br>\n4.dirtyï¼šç™¾åˆ†æ¯”æ˜¯å¦è¾ƒé«˜ï¼Œè‹¥æŒç»­é«˜äº10%åˆ™è¯´æ˜ç£ç›˜I/Oå­˜åœ¨ç“¶é¢ˆã€‚<br>\n5.netInã€netOutï¼šæ˜¯å¦è¶…è¿‡ç½‘ç»œå¸¦å®½é˜ˆå€¼ã€‚<br>\n6.replï¼šçŠ¶æ€æ˜¯å¦å¼‚å¸¸ï¼Œå¦‚PRIã€SECã€RTRä¸ºæ­£å¸¸ï¼Œè‹¥å‡ºç°RECç­‰å¼‚å¸¸å€¼åˆ™éœ€è¦ä¿®å¤ã€‚</p>\n</blockquote>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æŒ‡å®šç›‘æ§æŒ‡æ ‡ -o</span></span><br><span class=\"line\">mongostat <span class=\"string\">&quot;mongodb://user:password@10.1.2.26:27017,10.1.2.142:27017,10.1.2.41:27017/?authSource=admin&amp;replicaSet=rs0&quot;</span> -n1 1 -o=<span class=\"string\">&#x27;host,insert,query,update,delete,qrw,arw,conn,dirty,repl,version&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\">            host insert query update delete qrw arw conn dirty repl version</span><br><span class=\"line\">10.1.2.142:27017     *0    *0     *0     *0 0|0 0|0   24  0.4%  SLV   7.0.7</span><br><span class=\"line\"> 10.1.2.26:27017     *0    *0     *0     *0 0|0 0|0   14  0.2%  SEC   7.0.7</span><br><span class=\"line\"> 10.1.2.41:27017     *0    *0     *0     *0 0|0 0|0   16  0.4%  SEC   7.0.7</span><br></pre></td></tr></table></figure>\n<h2 id=\"mongotop-æŸ¥çœ‹æ•°æ®åº“æ€§èƒ½\">mongotop: æŸ¥çœ‹æ•°æ®åº“æ€§èƒ½</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>mongotopå‘½ä»¤å¯ç”¨äºæŸ¥çœ‹æ•°æ®åº“çš„çƒ­ç‚¹è¡¨ï¼Œé€šè¿‡è§‚å¯Ÿmongotopçš„è¾“å‡ºï¼Œå¯ä»¥åˆ¤å®šæ˜¯å“ªäº›é›†åˆå ç”¨äº†å¤§éƒ¨åˆ†è¯»å†™æ—¶é—´ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ç›‘æ§20æ¬¡ï¼Œé—´éš”1ç§’</span></span><br><span class=\"line\">mongotop <span class=\"string\">&quot;mongodb://user:password@10.1.2.26:27017,10.1.2.142:27017,10.1.2.41:27017/?authSource=admin&amp;replicaSet=rs0&quot;</span> -n 20 1</span><br><span class=\"line\"></span><br><span class=\"line\">                             ns    total    <span class=\"built_in\">read</span>    write    2024-04-03T09:16:53Z</span><br><span class=\"line\">                 admin.atlascli      0ms     0ms      0ms</span><br><span class=\"line\">              admin.system.keys      0ms     0ms      0ms</span><br><span class=\"line\">             admin.system.users      0ms     0ms      0ms</span><br><span class=\"line\">           admin.system.version      0ms     0ms      0ms</span><br><span class=\"line\">config.external_validation_keys      0ms     0ms      0ms</span><br><span class=\"line\">        config.image_collection      0ms     0ms      0ms</span><br><span class=\"line\">          config.queryAnalyzers      0ms     0ms      0ms</span><br><span class=\"line\">                config.settings      0ms     0ms      0ms</span><br><span class=\"line\">    config.shardMergeRecipients      0ms     0ms      0ms</span><br><span class=\"line\">        config.shardSplitDonors      0ms     0ms      0ms</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># è¾“å‡ºè¯´æ˜</span></span><br><span class=\"line\">ns é›†åˆåç§°</span><br><span class=\"line\">total èŠ±è´¹åœ¨è¯¥é›†åˆä¸Šçš„æ—¶é•¿</span><br><span class=\"line\"><span class=\"built_in\">read</span> èŠ±è´¹åœ¨è¯¥é›†åˆä¸Šçš„è¯»æ“ä½œæ—¶é•¿</span><br><span class=\"line\">write èŠ±è´¹åœ¨è¯¥é›†åˆä¸Šçš„å†™æ“ä½œæ—¶é•¿</span><br></pre></td></tr></table></figure>\n<h2 id=\"mongodump-å¤‡ä»½æ•°æ®åº“\">mongodump: å¤‡ä»½æ•°æ®åº“</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>mongodumpå‘½ä»¤ç”¨äºå¤‡ä»½æ•°æ®åº“</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å¤‡ä»½æ‰€æœ‰åº“ï¼Œé»˜è®¤è¾“å‡ºåˆ°dumpæ–‡ä»¶å¤¹ä¸‹</span></span><br><span class=\"line\">mongodump <span class=\"string\">&quot;mongodb://user:password@10.1.2.26:27017,10.1.2.142:27017,10.1.2.41:27017/?authSource=admin&amp;replicaSet=rs0&quot;</span> --gzip</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å¤‡ä»½æŒ‡å®šåº“ï¼Œé»˜è®¤è¾“å‡ºåˆ°dumpæ–‡ä»¶å¤¹ä¸‹</span></span><br><span class=\"line\">mongodump <span class=\"string\">&quot;mongodb://user:password@10.1.2.26:27017,10.1.2.142:27017,10.1.2.41:27017/?authSource=admin&amp;replicaSet=rs0&quot;</span> -d <span class=\"built_in\">test</span> --gzip</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å¤‡ä»½æŒ‡å®šé›†åˆ</span></span><br><span class=\"line\">mongodump <span class=\"string\">&quot;mongodb://user:password@10.1.2.26:27017,10.1.2.142:27017,10.1.2.41:27017/?authSource=admin&amp;replicaSet=rs0&quot;</span> -d <span class=\"built_in\">test</span> -c books --gzip -o ./books</span><br><span class=\"line\">2024-04-03T09:36:18.980+0000\twriting test.books to books/test/books.bson.gz</span><br><span class=\"line\">2024-04-03T09:36:18.983+0000\t<span class=\"keyword\">done</span> dumping test.books (50 documents)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å‚æ•°è¯´æ˜</span></span><br><span class=\"line\">-d æŒ‡å®šæ•°æ®åº“ï¼Œä¸æŒ‡å®šåˆ™å¯¼å‡ºå…¨éƒ¨æ•°æ®åº“</span><br><span class=\"line\">-c æŒ‡å®šé›†åˆï¼Œä¸æŒ‡å®šåˆ™å¯¼å‡ºå…¨éƒ¨é›†åˆ</span><br><span class=\"line\">--gzip æŒ‡å®šå‹ç¼©æ ¼å¼ï¼Œå¯¼å‡ºçš„æ–‡ä»¶ä¼šè¢«å‹ç¼©ä¸º.gzæ ¼å¼</span><br><span class=\"line\">-o æŒ‡å®šå¤‡ä»½ç›®å½•ï¼Œä¸æŒ‡å®šåˆ™é»˜è®¤ä¸ºå½“å‰ç›®å½•ä¸‹çš„dumpæ–‡ä»¶å¤¹</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ç±»ä¼¼äº mongoexport ,å¤‡ä»½æ•°æ®æ—¶åŒæ ·æ”¯æŒè¿‡æ»¤æ¡ä»¶</span></span><br><span class=\"line\">mongodump <span class=\"string\">&quot;mongodb://user:password@10.1.2.26:27017,10.1.2.142:27017,10.1.2.41:27017/?authSource=admin&amp;replicaSet=rs0&quot;</span> -d <span class=\"built_in\">test</span> -c books --gzip -o ./books --query=<span class=\"string\">&#x27;&#123;&quot;name&quot;:&quot;hello&quot;&#125;&#x27;</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"mongorestore-æ¢å¤æ•°æ®åº“\">mongorestore: æ¢å¤æ•°æ®åº“</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>mongorestoreå‘½ä»¤ç”¨äºæ¢å¤æ•°æ®åº“</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æ¢å¤åˆ°ç›¸åŒæ•°æ®åº“çš„ç›¸åŒé›†åˆ,æ­¤æ—¶ä¼šå°†dumpç›®å½•ä¸‹çš„æ‰€æœ‰æ•°æ®åº“è¿›è¡Œæ¢å¤</span></span><br><span class=\"line\">mongorestore <span class=\"string\">&quot;mongodb://user:password@10.1.2.26:27017,10.1.2.142:27017,10.1.2.41:27017/?authSource=admin&amp;replicaSet=rs0&quot;</span> --gzip ./dump</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åªæ¢å¤æŒ‡å®šçš„åº“ä¸‹çš„æ‰€æœ‰é›†åˆ</span></span><br><span class=\"line\">mongorestore <span class=\"string\">&quot;mongodb://user:password@10.1.2.26:27017,10.1.2.142:27017,10.1.2.41:27017/?authSource=admin&amp;replicaSet=rs0&quot;</span> --nsInclude=<span class=\"string\">&quot;test.*&quot;</span> --gzip ./dump</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åªæ¢å¤æŒ‡å®šçš„é›†åˆ</span></span><br><span class=\"line\">mongorestore <span class=\"string\">&quot;mongodb://user:password@10.1.2.26:27017,10.1.2.142:27017,10.1.2.41:27017/?authSource=admin&amp;replicaSet=rs0&quot;</span> --nsInclude=<span class=\"string\">&quot;test.books&quot;</span> --gzip ./dump</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å‚æ•°è¯´æ˜</span></span><br><span class=\"line\">--nsInclude=test.books æŒ‡å®šè¦æ¢å¤çš„é›†åˆ</span><br><span class=\"line\">--gzip æŒ‡å®šå‹ç¼©æ ¼å¼</span><br></pre></td></tr></table></figure>\n<h2 id=\"bsondump-æŸ¥çœ‹BSONæ–‡ä»¶å†…å®¹\">bsondump: æŸ¥çœ‹BSONæ–‡ä»¶å†…å®¹</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>bsondumpå‘½ä»¤ç”¨äºæŸ¥çœ‹BSONæ–‡ä»¶å†…å®¹ï¼Œå¯ä»¥å°†bsonæ ¼å¼çš„æ•°æ®è½¬æ¢ä¸ºjsonæ ¼å¼ï¼Œæ–¹ä¾¿æŸ¥çœ‹ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>æˆ‘ä»¬ä½¿ç”¨mongodumpå¯¼å‡ºçš„æ•°æ®æ ¼å¼ä¸ºbsonæ ¼å¼ï¼Œå¯ä»¥ä½¿ç”¨bsondumpå‘½ä»¤å°†å…¶è½¬æ¢ä¸ºjsonæ ¼å¼ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å¦‚æœå¯¼å‡ºçš„æ˜¯å‹ç¼©æ ¼å¼éœ€è¦å…ˆè§£å‹ç¼©</span></span><br><span class=\"line\">gunzip emp.bson.gz</span><br><span class=\"line\"><span class=\"comment\"># å°†bsonæ–‡ä»¶è½¬æ¢ä¸ºjsonæ–‡ä»¶</span></span><br><span class=\"line\">bsondump emp.bson &gt; emp.json</span><br></pre></td></tr></table></figure>\n<h2 id=\"mongofiles-æ–‡ä»¶å­˜å‚¨\">mongofiles: æ–‡ä»¶å­˜å‚¨</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>mongofileså‘½ä»¤ç”¨äºæ–‡ä»¶å­˜å‚¨ï¼Œå¯ä»¥å°†æ–‡ä»¶å­˜å‚¨åˆ°MongoDBä¸­ï¼Œç„¶åé€šè¿‡mongofileså‘½ä»¤è¿›è¡ŒæŸ¥çœ‹å’Œåˆ é™¤ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä¸è¿‡ç°åœ¨æ–‡ä»¶å­˜å‚¨åŸºæœ¬éƒ½ä¼šä½¿ç”¨S3ï¼Œå¾ˆå°‘ä½¿ç”¨mongodbäº†ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ä¸Šä¼ </span></span><br><span class=\"line\">mongofiles <span class=\"string\">&quot;mongodb://user:password@10.1.2.26:27017,10.1.2.142:27017,10.1.2.41:27017/?authSource=admin&amp;replicaSet=rs0&quot;</span> -d mydb put shellä»å…¥é—¨åˆ°ç²¾é€š.docx</span><br><span class=\"line\"><span class=\"comment\"># ä¸Šä¼ åä¼šåœ¨æŒ‡å®šçš„æ•°æ®åº“ä¸­åˆ›å»ºä¸¤ä¸ªé›†åˆï¼šfs.files å’Œ fs.chunks</span></span><br><span class=\"line\"></span><br><span class=\"line\">&gt; db.fs.files.find()</span><br><span class=\"line\">[</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    _id: ObjectId(<span class=\"string\">&#x27;66120f0135b8419b3a1ca510&#x27;</span>), <span class=\"comment\"># æ–‡æ¡£IDï¼Œå”¯ä¸€æ ‡è¯†</span></span><br><span class=\"line\">    length: Long(<span class=\"string\">&#x27;486680&#x27;</span>),                    <span class=\"comment\"># æ–‡ä»¶å¤§å°</span></span><br><span class=\"line\">    chunkSize: 261120,                         <span class=\"comment\"># æ¯ä¸ªåˆ†ç‰‡çš„å¤§å°</span></span><br><span class=\"line\">    uploadDate: ISODate(<span class=\"string\">&#x27;2024-04-07T03:12:01.965Z&#x27;</span>), <span class=\"comment\"># ä¸Šä¼ æ—¶é—´</span></span><br><span class=\"line\">    filename: <span class=\"string\">&#x27;shellä»å…¥é—¨åˆ°ç²¾é€š.docx&#x27;</span>,          <span class=\"comment\"># æ–‡ä»¶å</span></span><br><span class=\"line\">    metadata: &#123;&#125;                               <span class=\"comment\"># å…ƒæ•°æ®</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">]</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&gt; db.fs.chunks.find()</span><br><span class=\"line\">[</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    _id: ObjectId(<span class=\"string\">&#x27;66120f0135b8419b3a1ca512&#x27;</span>),     <span class=\"comment\"># åˆ†ç‰‡ID</span></span><br><span class=\"line\">    files_id: ObjectId(<span class=\"string\">&#x27;66120f0135b8419b3a1ca510&#x27;</span>), <span class=\"comment\"># æ–‡æ¡£IDï¼Œå¯¹åº”fs.filesé›†åˆä¸­çš„_id</span></span><br><span class=\"line\">    n: 1,                                         <span class=\"comment\"># åˆ†ç‰‡åºå·</span></span><br><span class=\"line\">    data: &lt;Binary&gt;                                <span class=\"comment\"># åˆ†ç‰‡æ•°æ®</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹</span></span><br><span class=\"line\">mongofiles <span class=\"string\">&quot;mongodb://user:password@10.1.2.26:27017,10.1.2.142:27017,10.1.2.41:27017/?authSource=admin&amp;replicaSet=rs0&quot;</span> -d mydb list</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æœç´¢</span></span><br><span class=\"line\">mongofiles <span class=\"string\">&quot;mongodb://user:password@10.1.2.26:27017,10.1.2.142:27017,10.1.2.41:27017/?authSource=admin&amp;replicaSet=rs0&quot;</span> -d mydb search shell</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ä¸‹è½½</span></span><br><span class=\"line\">mongofiles <span class=\"string\">&quot;mongodb://user:password@10.1.2.26:27017,10.1.2.142:27017,10.1.2.41:27017/?authSource=admin&amp;replicaSet=rs0&quot;</span> -d mydb get shellä»å…¥é—¨åˆ°ç²¾é€š.docx</span><br><span class=\"line\"><span class=\"comment\"># æ ¹æ®idè·å–æ–‡ä»¶</span></span><br><span class=\"line\">mongofiles <span class=\"string\">&quot;mongodb://user:password@10.1.2.26:27017,10.1.2.142:27017,10.1.2.41:27017/?authSource=admin&amp;replicaSet=rs0&quot;</span> -d mydb get_id <span class=\"string\">&#x27;&#123;&quot;$oid&quot;: &quot;66120f0135b8419b3a1ca510&quot;&#125;&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åˆ é™¤</span></span><br><span class=\"line\">mongofiles <span class=\"string\">&quot;mongodb://user:password@10.1.2.26:27017,10.1.2.142:27017,10.1.2.41:27017/?authSource=admin&amp;replicaSet=rs0&quot;</span> -d mydb delete shellä»å…¥é—¨åˆ°ç²¾é€š.docx</span><br><span class=\"line\"><span class=\"comment\"># æ ¹æ®idåˆ é™¤æ–‡ä»¶</span></span><br><span class=\"line\">mongofiles <span class=\"string\">&quot;mongodb://user:password@10.1.2.26:27017,10.1.2.142:27017,10.1.2.41:27017/?authSource=admin&amp;replicaSet=rs0&quot;</span> -d mydb delete_id <span class=\"string\">&#x27;&#123;&quot;$oid&quot;: &quot;66120f0135b8419b3a1ca510&quot;&#125;&#x27;</span></span><br></pre></td></tr></table></figure>","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç»Linuxä¸‹MongoDB Command Line Database Toolsçš„å®‰è£…ä¸ä½¿ç”¨ MongoDB Command Line Database Toolså®˜æ–¹æ–‡æ¡£ æœ¬æ–‡åŸºäºCentOS8(x86_64) MongoDB Database Tools MongoDB Database Toolsæ˜¯MongoDBå®˜æ–¹æä¾›çš„æ•°æ®åº“ç®¡ç†å·¥å…·ï¼Œå¯ä»¥ç”¨äºç®¡ç†MongoDBæ•°æ®åº“ï¼ŒåŒ…æ‹¬MongoDBçš„å¤‡ä»½ã€æ¢å¤ã€ç›‘æ§ç­‰åŠŸèƒ½ã€‚ MongoDB Database Toolsçš„ä¸‹è½½åœ°å€ 1234567891011# ä¸‹è½½å®‰è£…åŒ…wget https://fastdl.mongodb.org/tools/db/mongodb-database-tools-rhel80-x86_64-100.9.4.tgz# è§£å‹å®‰è£…åŒ…tar -xvzf mongodb-database-tools-rhel80-x86_64-100.9.4.tgz# åˆ›å»ºè½¯è¿æ¥ln -s mongodb-database-tools-rhel80-x86_64-100.9.4 /mongodb/tools# åœ¨/etc/profileæ–‡ä»¶ä¸­é…ç½®PATHç¯å¢ƒå˜é‡export PATH=/mongodb/tools/bin:$PATH# ä½¿é…ç½®ç”Ÿæ•ˆsource /etc/profile MongoDB Database Toolså¸¸ç”¨å‘½ä»¤ï¼Œè¯¦ç»†çš„ä½¿ç”¨æ–¹æ³•è¯·æŸ¥çœ‹å®˜æ–¹æ–‡æ¡£ æ–‡ä»¶åç§° ä½œç”¨ mongostat æ•°æ®åº“æ€§èƒ½ç›‘æ§å·¥å…· mongotop çƒ­ç‚¹è¡¨ç›‘æ§å·¥å…· mongodump æ•°æ®åº“é€»è¾‘å¤‡ä»½å·¥å…· mongorestore æ•°æ®åº“é€»è¾‘æ¢å¤å·¥å…· mongoexport æ•°æ®å¯¼å‡ºå·¥å…· mongoimport æ•°æ®å¯¼å…¥å·¥å…· bsondump BSONæ ¼å¼è½¬æ¢å·¥å…· mongofiles GridFSæ–‡ä»¶å·¥å…· mongoexport: å¯¼å‡ºæ•°æ® 123456789101112131415161718192021# å¯¼å‡ºcsvæ ¼å¼çš„æ•°æ®mongoexport &quot;mongodb://user:password@10.1.2.26:27017,10.1.2.142:27017,10.1.2.41:27017/?authSource=admin&amp;replicaSet=rs0&quot; -d test -c books -f _id,title,type,tag --type=csv -o books.csv# å¯¼å‡ºjsonæ ¼å¼çš„æ•°æ®mongoexport &quot;mongodb://user:password@10.1.2.26:27017,10.1.2.142:27017,10.1.2.41:27017/?authSource=admin&amp;replicaSet=rs0&quot; -d test -c books -f _id,title,type,tag --type=json -o books.json# å‚æ•°è¯´æ˜-d æŒ‡å®šæ•°æ®åº“-c æŒ‡å®šé›†åˆ-f æŒ‡å®šå¯¼å‡ºå­—æ®µï¼Œcsvæ ¼å¼éœ€è¦æŒ‡å®šå­—æ®µï¼Œjsonæ ¼å¼å¯ä»¥ä¸æŒ‡å®šå­—æ®µï¼Œé»˜è®¤å¯¼å‡ºå…¨éƒ¨--type=csv/json æŒ‡å®šå¯¼å‡ºæ ¼å¼-o æŒ‡å®šå¯¼å‡ºæ–‡ä»¶# å¯¼å‡ºæ—¶å¯ä»¥å¢åŠ è¿‡æ»¤æ¡ä»¶mongoexport &quot;mongodb://user:password@10.1.2.26:27017,10.1.2.142:27017,10.1.2.41:27017?authSource=admin&amp;replicaSet=rs0&quot; -d mydb -c user --type=json -o user.json --limit=10 --skip=2 --sort=&#x27;&#123;&quot;name&quot;:1&#125;&#x27; --query=&#x27;&#123;&quot;age&quot;:&#123;&quot;$gt&quot;:25&#125;,&quot;name&quot;:&quot;zhangsan&quot;&#125;&#x27;# å‚æ•°è¯´æ˜--limit=10 æŒ‡å®šå¯¼å‡ºæ¡æ•°--skip=2 æŒ‡å®šè·³è¿‡æ¡æ•°--sort=&#x27;&#123;&quot;name&quot;:1&#125;&#x27; æŒ‡å®šæ’åºå­—æ®µ--query=&#x27;&#123;&quot;age&quot;:&#123;&quot;$gt&quot;:25&#125;,&quot;name&quot;:&quot;zhangsan&quot;&#125;&#x27; æŒ‡å®šæŸ¥è¯¢æ¡ä»¶ï¼Œæ³¨æ„è¿™é‡Œçš„æŸ¥è¯¢æ¡ä»¶æ˜¯jsonæ ¼å¼ï¼Œå­—æ®µåéœ€è¦ä½¿ç”¨åŒå¼•å·åŒ…è£¹ mongoimport: å¯¼å…¥æ•°æ® 1234567891011121314151617# å¯¼å…¥csvæ ¼å¼çš„æ•°æ®# æ³¨æ„æ­¤æ—¶å¯¼å…¥çš„csvæ–‡ä»¶ä¸­ç¬¬ä¸€è¡Œå¦‚æœæ˜¯å­—æ®µåï¼Œéœ€è¦å…ˆåˆ é™¤ç¬¬ä¸€è¡Œå†å¯¼å…¥ï¼Œè¿™é‡Œä½¿ç”¨äº† -f æŒ‡å®šå­—æ®µï¼Œæ¥å’Œå¯¼å…¥çš„csvæ–‡ä»¶çš„åˆ—ä¸€ä¸€å¯¹åº”mongoimport &quot;mongodb://user:password@10.1.2.26:27017,10.1.2.142:27017,10.1.2.41:27017/?authSource=admin&amp;replicaSet=rs0&quot; -d test -c books_new -f _id,title,type,tag --type=csv --file books.csv# æ³¨æ„æ­¤æ—¶å¯¼å…¥çš„csvæ–‡ä»¶ä¸­ç¬¬ä¸€è¡Œå¦‚æœæ˜¯å­—æ®µåï¼Œéœ€è¦å…ˆåˆ é™¤ç¬¬ä¸€è¡Œå†å¯¼å…¥ï¼Œè¿™é‡Œä½¿ç”¨äº† -f æŒ‡å®šå­—æ®µï¼Œæ¥å’Œå¯¼å…¥çš„csvæ–‡ä»¶çš„åˆ—ä¸€ä¸€å¯¹åº”mongoimport &quot;mongodb://user:password@10.1.2.26:27017,10.1.2.142:27017,10.1.2.41:27017/?authSource=admin&amp;replicaSet=rs0&quot; -d test -c books_new --headerline --type=csv --file books.csv# å¯¼å…¥jsonæ ¼å¼çš„æ•°æ®mongoimport &quot;mongodb://user:password@10.1.2.26:27017,10.1.2.142:27017,10.1.2.41:27017/?authSource=admin&amp;replicaSet=rs0&quot; -d test -c books_new --type=json --file books.json-d æŒ‡å®šæ•°æ®åº“-c æŒ‡å®šé›†åˆ-f æŒ‡å®šå¯¼å…¥å­—æ®µï¼Œcsvæ ¼å¼éœ€è¦æŒ‡å®šå­—æ®µ--headerline æŒ‡å®šç¬¬ä¸€è¡Œæ˜¯å­—æ®µå--type=csv/json æŒ‡å®šå¯¼å…¥æ ¼å¼--file æŒ‡å®šå¯¼å…¥æ–‡ä»¶--mode æŒ‡å®šå¯¼å…¥æ–¹å¼ï¼Œé»˜è®¤æ˜¯insertï¼Œè¿˜å¯ä»¥æ˜¯upsertï¼Œmergeï¼Œdelete modeè¯´æ˜ insert: é»˜è®¤å€¼ï¼Œå¦‚æœæ•°æ®ä¸å­˜åœ¨ï¼Œåˆ™æ’å…¥ï¼Œå¦‚æœå­˜åœ¨ï¼Œåˆ™æŠ¥é”™ upsert: å¦‚æœæ•°æ®ä¸å­˜åœ¨ï¼Œåˆ™æ’å…¥ï¼Œå¦‚æœå­˜åœ¨ï¼Œåˆ™æ›´æ–° merge: å¦‚æœæ•°æ®ä¸å­˜åœ¨ï¼Œåˆ™æ’å…¥ï¼Œå¦‚æœå­˜åœ¨ï¼Œåˆ™åˆå¹¶åæ›´æ–° delete: å¦‚æœæ•°æ®ä¸å­˜åœ¨ï¼Œä¹Ÿä¸æ‰§è¡Œæ’å…¥ï¼Œå¦‚æœå­˜åœ¨ï¼Œåˆ™åˆ é™¤ mongostat: æ•°æ®åº“æ€§èƒ½ç›‘æ§ mongostatå‘½ä»¤ç”¨äºå®æ—¶ç›‘æ§MongoDBæ•°æ®åº“çš„æ€§èƒ½ï¼ŒåŒ…æ‹¬è¿æ¥æ•°ã€æ–‡æ¡£æ•°ã€ç´¢å¼•æ•°ã€å†…å­˜ä½¿ç”¨æƒ…å†µç­‰ã€‚ 123456789101112# ç›‘æ§20æ¬¡ï¼Œé—´éš”1ç§’mongostat &quot;mongodb://user:password@10.1.2.26:27017,10.1.2.142:27017,10.1.2.41:27017/?authSource=admin&amp;replicaSet=rs0&quot; -n20 1# å‚æ•°è¯´æ˜-n æŒ‡å®šç›‘æ§æ¬¡æ•°1 æŒ‡å®šç›‘æ§é—´éš”æ—¶é—´ï¼Œå•ä½ä¸ºç§’# ç›‘æ§å®æ—¶æ•°æ®host insert query update delete getmore command dirty used flushes vsize res qrw arw net_in net_out conn set repl time10.1.2.142:27017 *0 *0 *0 *0 0 4|0 0.4% 5.0% 0 2.95G 151M 0|0 0|0 1.13k 75.2k 24 rs0 SLV Apr 3 08:37:49.40510.1.2.26:27017 *0 *0 *0 *0 0 2|0 0.2% 3.8% 0 2.87G 138M 0|0 0|0 710b 74.3k 14 rs0 SEC Apr 3 08:37:49.38510.1.2.41:27017 *0 *0 *0 *0 0 5|0 0.0% 17.7% 0 2.96G 184M 0|0 0|0 1.45k 75.5k 16 rs0 SEC Apr 3 08:37:49.426 æŒ‡æ ‡è¯´æ˜ æŒ‡æ ‡å è¯´æ˜ inserts æ¯ç§’æ’å…¥æ•° query æ¯ç§’æŸ¥è¯¢æ•° update æ¯ç§’æ›´æ–°æ•° delete æ¯ç§’åˆ é™¤æ•° getmore æ¯ç§’getmoreæ•° command æ¯ç§’å‘½ä»¤æ•°ï¼Œæ¶µç›–äº†å†…éƒ¨çš„ä¸€äº›æ“ä½œ %dirty WiredTigerç¼“å­˜ä¸­è„æ•°æ®ç™¾åˆ†æ¯” %used WiredTiger æ­£åœ¨ä½¿ç”¨çš„ç¼“å­˜ç™¾åˆ†æ¯” flushes WiredTigeræ‰§è¡ŒCheckPointçš„æ¬¡æ•° vsize è™šæ‹Ÿå†…å­˜ä½¿ç”¨é‡ res ç‰©ç†å†…å­˜ä½¿ç”¨é‡ qrw å®¢æˆ·ç«¯è¯»å†™ç­‰å¾…é˜Ÿåˆ—æ•°é‡ï¼Œé«˜å¹¶å‘æ—¶ï¼Œä¸€èˆ¬é˜Ÿåˆ—å€¼ä¼šå‡é«˜ arw å®¢æˆ·ç«¯è¯»å†™æ´»è·ƒä¸ªæ•° netIn ç½‘ç»œæ¥æ”¶æ•°æ®é‡ netOut ç½‘ç»œå‘é€æ•°æ®é‡ conn å½“å‰è¿æ¥æ•° set æ‰€å±å¤åˆ¶é›†åç§° repl å¤åˆ¶èŠ‚ç‚¹çŠ¶æ€ï¼Œå¦‚PRI(ä¸»èŠ‚ç‚¹,æˆ‘è¿™é‡Œä¸»èŠ‚ç‚¹æ˜¾ç¤ºä¸ºSLV),SEC(ä»èŠ‚ç‚¹),ARB(ä»²è£èŠ‚ç‚¹),REC(èŠ‚ç‚¹æ­£åœ¨æ¢å¤),UNK(æœªçŸ¥çŠ¶æ€),RTR(mongos) time æ—¶é—´æˆ³ éœ€è¦é‡ç‚¹å…³æ³¨çš„æŒ‡æ ‡ 1.æ’å…¥ã€åˆ é™¤ã€ä¿®æ”¹ã€æŸ¥è¯¢çš„é€Ÿç‡æ˜¯å¦äº§ç”Ÿè¾ƒå¤§æ³¢åŠ¨ï¼Œæ˜¯å¦è¶…å‡ºé¢„æœŸã€‚ 2.qrwã€arwï¼šé˜Ÿåˆ—æ˜¯å¦è¾ƒé«˜ï¼Œè‹¥é•¿æ—¶é—´å¤§äº0åˆ™è¯´æ˜æ­¤æ—¶è¯»å†™é€Ÿåº¦è¾ƒæ…¢ã€‚ 3.connï¼šè¿æ¥æ•°æ˜¯å¦å¤ªå¤šã€‚ 4.dirtyï¼šç™¾åˆ†æ¯”æ˜¯å¦è¾ƒé«˜ï¼Œè‹¥æŒç»­é«˜äº10%åˆ™è¯´æ˜ç£ç›˜I/Oå­˜åœ¨ç“¶é¢ˆã€‚ 5.netInã€netOutï¼šæ˜¯å¦è¶…è¿‡ç½‘ç»œå¸¦å®½é˜ˆå€¼ã€‚ 6.replï¼šçŠ¶æ€æ˜¯å¦å¼‚å¸¸ï¼Œå¦‚PRIã€SECã€RTRä¸ºæ­£å¸¸ï¼Œè‹¥å‡ºç°RECç­‰å¼‚å¸¸å€¼åˆ™éœ€è¦ä¿®å¤ã€‚ 1234567# æŒ‡å®šç›‘æ§æŒ‡æ ‡ -omongostat &quot;mongodb://user:password@10.1.2.26:27017,10.1.2.142:27017,10.1.2.41:27017/?authSource=admin&amp;replicaSet=rs0&quot; -n1 1 -o=&#x27;host,insert,query,update,delete,qrw,arw,conn,dirty,repl,version&#x27; host insert query update delete qrw arw conn dirty repl version10.1.2.142:27017 *0 *0 *0 *0 0|0 0|0 24 0.4% SLV 7.0.7 10.1.2.26:27017 *0 *0 *0 *0 0|0 0|0 14 0.2% SEC 7.0.7 10.1.2.41:27017 *0 *0 *0 *0 0|0 0|0 16 0.4% SEC 7.0.7 mongotop: æŸ¥çœ‹æ•°æ®åº“æ€§èƒ½ mongotopå‘½ä»¤å¯ç”¨äºæŸ¥çœ‹æ•°æ®åº“çš„çƒ­ç‚¹è¡¨ï¼Œé€šè¿‡è§‚å¯Ÿmongotopçš„è¾“å‡ºï¼Œå¯ä»¥åˆ¤å®šæ˜¯å“ªäº›é›†åˆå ç”¨äº†å¤§éƒ¨åˆ†è¯»å†™æ—¶é—´ã€‚ 1234567891011121314151617181920# ç›‘æ§20æ¬¡ï¼Œé—´éš”1ç§’mongotop &quot;mongodb://user:password@10.1.2.26:27017,10.1.2.142:27017,10.1.2.41:27017/?authSource=admin&amp;replicaSet=rs0&quot; -n 20 1 ns total read write 2024-04-03T09:16:53Z admin.atlascli 0ms 0ms 0ms admin.system.keys 0ms 0ms 0ms admin.system.users 0ms 0ms 0ms admin.system.version 0ms 0ms 0msconfig.external_validation_keys 0ms 0ms 0ms config.image_collection 0ms 0ms 0ms config.queryAnalyzers 0ms 0ms 0ms config.settings 0ms 0ms 0ms config.shardMergeRecipients 0ms 0ms 0ms config.shardSplitDonors 0ms 0ms 0ms# è¾“å‡ºè¯´æ˜ns é›†åˆåç§°total èŠ±è´¹åœ¨è¯¥é›†åˆä¸Šçš„æ—¶é•¿read èŠ±è´¹åœ¨è¯¥é›†åˆä¸Šçš„è¯»æ“ä½œæ—¶é•¿write èŠ±è´¹åœ¨è¯¥é›†åˆä¸Šçš„å†™æ“ä½œæ—¶é•¿ mongodump: å¤‡ä»½æ•°æ®åº“ mongodumpå‘½ä»¤ç”¨äºå¤‡ä»½æ•°æ®åº“ 12345678910111213141516171819# å¤‡ä»½æ‰€æœ‰åº“ï¼Œé»˜è®¤è¾“å‡ºåˆ°dumpæ–‡ä»¶å¤¹ä¸‹mongodump &quot;mongodb://user:password@10.1.2.26:27017,10.1.2.142:27017,10.1.2.41:27017/?authSource=admin&amp;replicaSet=rs0&quot; --gzip# å¤‡ä»½æŒ‡å®šåº“ï¼Œé»˜è®¤è¾“å‡ºåˆ°dumpæ–‡ä»¶å¤¹ä¸‹mongodump &quot;mongodb://user:password@10.1.2.26:27017,10.1.2.142:27017,10.1.2.41:27017/?authSource=admin&amp;replicaSet=rs0&quot; -d test --gzip# å¤‡ä»½æŒ‡å®šé›†åˆmongodump &quot;mongodb://user:password@10.1.2.26:27017,10.1.2.142:27017,10.1.2.41:27017/?authSource=admin&amp;replicaSet=rs0&quot; -d test -c books --gzip -o ./books2024-04-03T09:36:18.980+0000 writing test.books to books/test/books.bson.gz2024-04-03T09:36:18.983+0000 done dumping test.books (50 documents)# å‚æ•°è¯´æ˜-d æŒ‡å®šæ•°æ®åº“ï¼Œä¸æŒ‡å®šåˆ™å¯¼å‡ºå…¨éƒ¨æ•°æ®åº“-c æŒ‡å®šé›†åˆï¼Œä¸æŒ‡å®šåˆ™å¯¼å‡ºå…¨éƒ¨é›†åˆ--gzip æŒ‡å®šå‹ç¼©æ ¼å¼ï¼Œå¯¼å‡ºçš„æ–‡ä»¶ä¼šè¢«å‹ç¼©ä¸º.gzæ ¼å¼-o æŒ‡å®šå¤‡ä»½ç›®å½•ï¼Œä¸æŒ‡å®šåˆ™é»˜è®¤ä¸ºå½“å‰ç›®å½•ä¸‹çš„dumpæ–‡ä»¶å¤¹# ç±»ä¼¼äº mongoexport ,å¤‡ä»½æ•°æ®æ—¶åŒæ ·æ”¯æŒè¿‡æ»¤æ¡ä»¶mongodump &quot;mongodb://user:password@10.1.2.26:27017,10.1.2.142:27017,10.1.2.41:27017/?authSource=admin&amp;replicaSet=rs0&quot; -d test -c books --gzip -o ./books --query=&#x27;&#123;&quot;name&quot;:&quot;hello&quot;&#125;&#x27; mongorestore: æ¢å¤æ•°æ®åº“ mongorestoreå‘½ä»¤ç”¨äºæ¢å¤æ•°æ®åº“ 12345678910111213# æ¢å¤åˆ°ç›¸åŒæ•°æ®åº“çš„ç›¸åŒé›†åˆ,æ­¤æ—¶ä¼šå°†dumpç›®å½•ä¸‹çš„æ‰€æœ‰æ•°æ®åº“è¿›è¡Œæ¢å¤mongorestore &quot;mongodb://user:password@10.1.2.26:27017,10.1.2.142:27017,10.1.2.41:27017/?authSource=admin&amp;replicaSet=rs0&quot; --gzip ./dump# åªæ¢å¤æŒ‡å®šçš„åº“ä¸‹çš„æ‰€æœ‰é›†åˆmongorestore &quot;mongodb://user:password@10.1.2.26:27017,10.1.2.142:27017,10.1.2.41:27017/?authSource=admin&amp;replicaSet=rs0&quot; --nsInclude=&quot;test.*&quot; --gzip ./dump# åªæ¢å¤æŒ‡å®šçš„é›†åˆmongorestore &quot;mongodb://user:password@10.1.2.26:27017,10.1.2.142:27017,10.1.2.41:27017/?authSource=admin&amp;replicaSet=rs0&quot; --nsInclude=&quot;test.books&quot; --gzip ./dump# å‚æ•°è¯´æ˜--nsInclude=test.books æŒ‡å®šè¦æ¢å¤çš„é›†åˆ--gzip æŒ‡å®šå‹ç¼©æ ¼å¼ bsondump: æŸ¥çœ‹BSONæ–‡ä»¶å†…å®¹ bsondumpå‘½ä»¤ç”¨äºæŸ¥çœ‹BSONæ–‡ä»¶å†…å®¹ï¼Œå¯ä»¥å°†bsonæ ¼å¼çš„æ•°æ®è½¬æ¢ä¸ºjsonæ ¼å¼ï¼Œæ–¹ä¾¿æŸ¥çœ‹ã€‚ æˆ‘ä»¬ä½¿ç”¨mongodumpå¯¼å‡ºçš„æ•°æ®æ ¼å¼ä¸ºbsonæ ¼å¼ï¼Œå¯ä»¥ä½¿ç”¨bsondumpå‘½ä»¤å°†å…¶è½¬æ¢ä¸ºjsonæ ¼å¼ã€‚ 1234# å¦‚æœå¯¼å‡ºçš„æ˜¯å‹ç¼©æ ¼å¼éœ€è¦å…ˆè§£å‹ç¼©gunzip emp.bson.gz# å°†bsonæ–‡ä»¶è½¬æ¢ä¸ºjsonæ–‡ä»¶bsondump emp.bson &gt; emp.json mongofiles: æ–‡ä»¶å­˜å‚¨ mongofileså‘½ä»¤ç”¨äºæ–‡ä»¶å­˜å‚¨ï¼Œå¯ä»¥å°†æ–‡ä»¶å­˜å‚¨åˆ°MongoDBä¸­ï¼Œç„¶åé€šè¿‡mongofileså‘½ä»¤è¿›è¡ŒæŸ¥çœ‹å’Œåˆ é™¤ã€‚ ä¸è¿‡ç°åœ¨æ–‡ä»¶å­˜å‚¨åŸºæœ¬éƒ½ä¼šä½¿ç”¨S3ï¼Œå¾ˆå°‘ä½¿ç”¨mongodbäº†ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142# ä¸Šä¼ mongofiles &quot;mongodb://user:password@10.1.2.26:27017,10.1.2.142:27017,10.1.2.41:27017/?authSource=admin&amp;replicaSet=rs0&quot; -d mydb put shellä»å…¥é—¨åˆ°ç²¾é€š.docx# ä¸Šä¼ åä¼šåœ¨æŒ‡å®šçš„æ•°æ®åº“ä¸­åˆ›å»ºä¸¤ä¸ªé›†åˆï¼šfs.files å’Œ fs.chunks&gt; db.fs.files.find()[ &#123; _id: ObjectId(&#x27;66120f0135b8419b3a1ca510&#x27;), # æ–‡æ¡£IDï¼Œå”¯ä¸€æ ‡è¯† length: Long(&#x27;486680&#x27;), # æ–‡ä»¶å¤§å° chunkSize: 261120, # æ¯ä¸ªåˆ†ç‰‡çš„å¤§å° uploadDate: ISODate(&#x27;2024-04-07T03:12:01.965Z&#x27;), # ä¸Šä¼ æ—¶é—´ filename: &#x27;shellä»å…¥é—¨åˆ°ç²¾é€š.docx&#x27;, # æ–‡ä»¶å metadata: &#123;&#125; # å…ƒæ•°æ® &#125;]&gt; db.fs.chunks.find()[ &#123; _id: ObjectId(&#x27;66120f0135b8419b3a1ca512&#x27;), # åˆ†ç‰‡ID files_id: ObjectId(&#x27;66120f0135b8419b3a1ca510&#x27;), # æ–‡æ¡£IDï¼Œå¯¹åº”fs.filesé›†åˆä¸­çš„_id n: 1, # åˆ†ç‰‡åºå· data: &lt;Binary&gt; # åˆ†ç‰‡æ•°æ® &#125;]# æŸ¥çœ‹mongofiles &quot;mongodb://user:password@10.1.2.26:27017,10.1.2.142:27017,10.1.2.41:27017/?authSource=admin&amp;replicaSet=rs0&quot; -d mydb list# æœç´¢mongofiles &quot;mongodb://user:password@10.1.2.26:27017,10.1.2.142:27017,10.1.2.41:27017/?authSource=admin&amp;replicaSet=rs0&quot; -d mydb search shell# ä¸‹è½½mongofiles &quot;mongodb://user:password@10.1.2.26:27017,10.1.2.142:27017,10.1.2.41:27017/?authSource=admin&amp;replicaSet=rs0&quot; -d mydb get shellä»å…¥é—¨åˆ°ç²¾é€š.docx# æ ¹æ®idè·å–æ–‡ä»¶mongofiles &quot;mongodb://user:password@10.1.2.26:27017,10.1.2.142:27017,10.1.2.41:27017/?authSource=admin&amp;replicaSet=rs0&quot; -d mydb get_id &#x27;&#123;&quot;$oid&quot;: &quot;66120f0135b8419b3a1ca510&quot;&#125;&#x27;# åˆ é™¤mongofiles &quot;mongodb://user:password@10.1.2.26:27017,10.1.2.142:27017,10.1.2.41:27017/?authSource=admin&amp;replicaSet=rs0&quot; -d mydb delete shellä»å…¥é—¨åˆ°ç²¾é€š.docx# æ ¹æ®idåˆ é™¤æ–‡ä»¶mongofiles &quot;mongodb://user:password@10.1.2.26:27017,10.1.2.142:27017,10.1.2.41:27017/?authSource=admin&amp;replicaSet=rs0&quot; -d mydb delete_id &#x27;&#123;&quot;$oid&quot;: &quot;66120f0135b8419b3a1ca510&quot;&#125;&#x27;","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç»Linuxä¸‹MongoDB Command Line Database Toolsçš„å®‰è£…ä¸ä½¿ç”¨ MongoDB Command Line Database Toolså®˜æ–¹æ–‡æ¡£ æœ¬æ–‡åŸºäºCentOS8(x86_64)","date_published":"2024-04-03T13:30:05.000Z","tags":["æŠ€æœ¯","linux","mongodb","mongodb"]},{"id":"https://blog.hanqunfeng.com/2024/03/29/mongodb7-replset/","url":"https://blog.hanqunfeng.com/2024/03/29/mongodb7-replset/","title":"MongoDB7.0--å¤åˆ¶é›†","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç»Linuxä¸‹MongoDB7.0å¤åˆ¶é›†çš„å®‰è£…å’Œä½¿ç”¨</p>\n</li>\n<li class=\"lvl-2\">\n<p>MongoDB<a href=\"https://www.mongodb.com/docs/v7.0/\">å®˜æ–¹æ–‡æ¡£</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡åŸºäº<code>CentOS8(x86_64)</code></p>\n</li>\n<li class=\"lvl-2\">\n<p><code>Mongodbåˆ†ç‰‡é›†ç¾¤</code>æ­å»ºå‚çœ‹<a href=\"/2020/03/19/mongodb-mongos/\" title=\"MongoDB åˆ†ç‰‡é›†ç¾¤æ­å»º\">MongoDB åˆ†ç‰‡é›†ç¾¤æ­å»º</a>ï¼Œè™½ç„¶æ˜¯åŸºäº<code>4.4</code>ç‰ˆæœ¬çš„ï¼Œä½†æ˜¯å®‰è£…æ–¹å¼å·®åˆ«ä¸å¤§ï¼Œåªæ˜¯é…ç½®æ–‡ä»¶ä¸­ä¸ªåˆ«çš„å±æ€§åç§°å‘ç”Ÿäº†å˜åŒ–ã€‚</p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"å¤åˆ¶é›†èŠ‚ç‚¹ç±»å‹\">å¤åˆ¶é›†èŠ‚ç‚¹ç±»å‹</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¸€ä¸ªå¤åˆ¶é›†æœ€å¤šæ”¯æŒ50ä¸ªèŠ‚ç‚¹ï¼Œä¸”åšå¤šåªèƒ½æœ‰7ä¸ªèŠ‚ç‚¹å‚ä¸æŠ•ç¥¨ï¼ŒèŠ‚ç‚¹ç±»å‹åˆ†ä¸º<code>Primary</code>ã€<code>Secondary</code>ä¸<code>Arbiter</code>ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><code>Primary</code>ï¼šä¸»èŠ‚ç‚¹ï¼Œå…¶æ¥æ”¶æ‰€æœ‰çš„å†™è¯·æ±‚ï¼Œç„¶åæŠŠä¿®æ”¹åŒæ­¥åˆ°æ‰€æœ‰ <code>Secondary</code> èŠ‚ç‚¹ã€‚ä¸€ä¸ªå¤åˆ¶é›†åªèƒ½æœ‰ä¸€ä¸ªä¸»èŠ‚ç‚¹ï¼Œå½“ä¸»èŠ‚ç‚¹<em><strong>æŒ‚æ‰</strong></em>åï¼Œå…¶ä»–èŠ‚ç‚¹ä¼šé‡æ–°é€‰ä¸¾å‡ºæ¥ä¸€ä¸ªä¸»èŠ‚ç‚¹ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><code>Secondary</code>ï¼šå¤‡èŠ‚ç‚¹ï¼Œä¸ä¸»èŠ‚ç‚¹ä¿æŒåŒæ ·çš„æ•°æ®é›†ã€‚å½“ä¸»èŠ‚ç‚¹<em><strong>æŒ‚æ‰</strong></em>æ—¶ï¼Œå‚ä¸ç«é€‰ä¸»èŠ‚ç‚¹ã€‚åˆ†ä¸ºä»¥ä¸‹ä¸‰ä¸ªä¸åŒç±»å‹ï¼š</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">Hidden = falseï¼šæ­£å¸¸çš„åªè¯»èŠ‚ç‚¹ï¼Œæ˜¯å¦å¯é€‰ä¸ºä¸»ï¼Œæ˜¯å¦å¯æŠ•ç¥¨ï¼Œå–å†³äº <code>Priority</code>ï¼Œ<code>Vote</code> çš„å€¼ï¼›</li>\n<li class=\"lvl-4\">Hidden = trueï¼šéšè—èŠ‚ç‚¹ï¼Œå¯¹å®¢æˆ·ç«¯ä¸å¯è§ï¼Œ å¯ä»¥å‚ä¸é€‰ä¸¾ï¼Œä½†æ˜¯ <code>Priority</code> å¿…é¡»ä¸º 0ï¼Œå³ä¸èƒ½è¢«æå‡ä¸ºä¸»ã€‚ ç”±äºéšè—èŠ‚ç‚¹ä¸ä¼šæ¥å—ä¸šåŠ¡è®¿é—®ï¼Œå› æ­¤å¯é€šè¿‡éšè—èŠ‚ç‚¹åšä¸€äº›æ•°æ®å¤‡ä»½ã€ç¦»çº¿è®¡ç®—çš„ä»»åŠ¡ï¼Œè¿™å¹¶ä¸ä¼šå½±å“æ•´ä¸ªå¤åˆ¶é›†ã€‚</li>\n<li class=\"lvl-4\">Delayed ï¼šå»¶è¿ŸèŠ‚ç‚¹ï¼Œå¿…é¡»åŒæ—¶å…·å¤‡<code>éšè—èŠ‚ç‚¹</code>å’Œ<code>Priority=0</code>çš„ç‰¹æ€§ï¼Œä¼šå»¶è¿Ÿä¸€å®šçš„æ—¶é—´ï¼ˆsecondaryDelaySecs é…ç½®å†³å®šï¼‰ä»ä¸Šæ¸¸å¤åˆ¶å¢é‡ï¼Œå¸¸ç”¨äºå¿«é€Ÿå›æ»šåœºæ™¯ã€‚</li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<p><code>Arbiter</code>ï¼šä»²è£èŠ‚ç‚¹ï¼Œåªç”¨äºå‚ä¸é€‰ä¸¾æŠ•ç¥¨ï¼Œæœ¬èº«ä¸æ‰¿è½½ä»»ä½•æ•°æ®ï¼Œåªä½œä¸ºæŠ•ç¥¨è§’è‰²ã€‚æ¯”å¦‚ä½ éƒ¨ç½²äº†2ä¸ªèŠ‚ç‚¹çš„å¤åˆ¶é›†ï¼Œ1ä¸ª Primaryï¼Œ1ä¸ªSecondaryï¼Œä»»æ„èŠ‚ç‚¹å®•æœºï¼Œå¤åˆ¶é›†å°†ä¸èƒ½æä¾›æœåŠ¡äº†ï¼ˆæ— æ³•é€‰å‡ºPrimaryï¼‰ï¼Œè¿™æ—¶å¯ä»¥ç»™å¤åˆ¶é›†æ·»åŠ â¼€ä¸ª ArbiterèŠ‚ç‚¹ï¼Œå³ä½¿æœ‰èŠ‚ç‚¹å®•æœºï¼Œä»èƒ½é€‰å‡ºPrimaryã€‚ Arbiteræœ¬èº«ä¸å­˜å‚¨æ•°æ®ï¼Œæ˜¯éå¸¸è½»é‡çº§çš„æœåŠ¡ï¼Œå½“å¤åˆ¶é›†æˆå‘˜ä¸ºå¶æ•°æ—¶ï¼Œæœ€å¥½åŠ å…¥â¼€ä¸ªArbiterèŠ‚ç‚¹ï¼Œä»¥æå‡å¤åˆ¶é›†å¯ç”¨æ€§ã€‚</p>\n</li>\n</ul>\n<h2 id=\"æ­å»ºåŸºäº3å°æœºå™¨çš„å¤åˆ¶é›†\">æ­å»ºåŸºäº3å°æœºå™¨çš„å¤åˆ¶é›†</h2>\n<figure class=\"highlight yml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"number\">10.1</span><span class=\"number\">.2</span><span class=\"number\">.26</span></span><br><span class=\"line\"><span class=\"number\">10.1</span><span class=\"number\">.2</span><span class=\"number\">.142</span></span><br><span class=\"line\"><span class=\"number\">10.1</span><span class=\"number\">.2</span><span class=\"number\">.41</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>mongod.confé…ç½®æ–‡ä»¶ï¼Œéœ€è¦åˆ›å»ºå¥½ç›¸å…³ç›®å½•</p>\n</li>\n</ul>\n<figure class=\"highlight yml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">systemLog:</span></span><br><span class=\"line\">  <span class=\"attr\">destination:</span> <span class=\"string\">file</span></span><br><span class=\"line\">  <span class=\"attr\">path:</span> <span class=\"string\">/mongodb/log/mongodb.log</span></span><br><span class=\"line\">  <span class=\"attr\">logAppend:</span> <span class=\"literal\">true</span></span><br><span class=\"line\"><span class=\"attr\">storage:</span></span><br><span class=\"line\">  <span class=\"attr\">dbPath:</span> <span class=\"string\">/mongodb/data</span></span><br><span class=\"line\"><span class=\"attr\">net:</span></span><br><span class=\"line\">  <span class=\"attr\">bindIp:</span> <span class=\"number\">0.0</span><span class=\"number\">.0</span><span class=\"number\">.0</span></span><br><span class=\"line\">  <span class=\"attr\">port:</span> <span class=\"number\">27017</span></span><br><span class=\"line\"><span class=\"attr\">processManagement:</span></span><br><span class=\"line\">  <span class=\"attr\">fork:</span> <span class=\"literal\">true</span></span><br><span class=\"line\"><span class=\"attr\">replication:</span></span><br><span class=\"line\">  <span class=\"attr\">replSetName:</span> <span class=\"string\">rs0</span></span><br><span class=\"line\"><span class=\"attr\">security:</span></span><br><span class=\"line\">  <span class=\"attr\">keyFile:</span> <span class=\"string\">/mongodb/mongo.key</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ›å»ºkeyæ–‡ä»¶</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">openssl rand -<span class=\"built_in\">base64</span> 756 &gt; /mongodb/mongo.key</span><br><span class=\"line\"><span class=\"comment\"># ä¿®æ”¹æƒé™</span></span><br><span class=\"line\"><span class=\"built_in\">chmod</span> 600 /mongodb/mongo.key</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ†åˆ«å¯åŠ¨3ä¸ªèŠ‚ç‚¹</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mongod -f /mongodb/mongo.conf</span><br></pre></td></tr></table></figure>\n<h2 id=\"åˆå§‹åŒ–\">åˆå§‹åŒ–</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç™»å½•ä»»æ„èŠ‚ç‚¹</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mongosh 10.1.2.26:27017</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆå§‹åŒ–å¤åˆ¶é›†</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å¿…é¡»åˆ‡æ¢åˆ°adminæ•°æ®åº“</span></span><br><span class=\"line\"><span class=\"built_in\">test</span>&gt; use admin</span><br><span class=\"line\">switched to db admin</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åˆå§‹åŒ–</span></span><br><span class=\"line\">admin&gt; rs.initiate(</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    _id: <span class=\"string\">&quot;rs0&quot;</span>,</span><br><span class=\"line\">    members: [</span><br><span class=\"line\">      &#123; _id : 0, host : <span class=\"string\">&quot;10.1.2.26&quot;</span> &#125;,</span><br><span class=\"line\">      &#123; _id : 1, host : <span class=\"string\">&quot;10.1.2.142&quot;</span> &#125;,</span><br><span class=\"line\">      &#123; _id : 2, host : <span class=\"string\">&quot;10.1.2.41&quot;</span> &#125;</span><br><span class=\"line\">    ]</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">);</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æŸ¥çœ‹è°æ˜¯ä¸»èŠ‚ç‚¹</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹è°æ˜¯ä¸»èŠ‚ç‚¹ï¼Œå¯ä»¥çœ‹åˆ°æ­¤æ—¶ä¸»èŠ‚ç‚¹æ˜¯ 10.1.2.26</span></span><br><span class=\"line\">&gt; rs.<span class=\"function\"><span class=\"title\">isMaster</span></span>()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  topologyVersion: &#123;   <span class=\"comment\"># æ‹“æ‰‘ç‰ˆæœ¬ï¼ŒåŒ…å«è¿›ç¨‹ ID å’Œè®¡æ•°å™¨ã€‚</span></span><br><span class=\"line\">    processId: ObjectId(<span class=\"string\">&#x27;660a1cdf2e7a827807cac6f9&#x27;</span>),  <span class=\"comment\"># è¿›ç¨‹ ID</span></span><br><span class=\"line\">    counter: Long(<span class=\"string\">&#x27;6&#x27;</span>)   <span class=\"comment\"># è®¡æ•°å™¨ï¼Œç”¨äºæ ‡è¯†æ‹“æ‰‘ç‰ˆæœ¬</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  hosts: [ <span class=\"string\">&#x27;10.1.2.26:27017&#x27;</span>, <span class=\"string\">&#x27;10.1.2.142:27017&#x27;</span>, <span class=\"string\">&#x27;10.1.2.41:27017&#x27;</span> ], <span class=\"comment\"># å¤åˆ¶é›†ä¸­æ‰€æœ‰æˆå‘˜çš„ä¸»æœºå’Œç«¯å£å·åˆ—è¡¨ã€‚</span></span><br><span class=\"line\">  setName: <span class=\"string\">&#x27;rs0&#x27;</span>,    <span class=\"comment\"># å¤åˆ¶é›†çš„åç§°</span></span><br><span class=\"line\">  setVersion: 1,     <span class=\"comment\"># å¤åˆ¶é›†çš„ç‰ˆæœ¬å·</span></span><br><span class=\"line\">  ismaster: <span class=\"literal\">true</span>,    <span class=\"comment\"># å½“å‰èŠ‚ç‚¹æ˜¯å¦ä¸ºä¸»èŠ‚ç‚¹</span></span><br><span class=\"line\">  secondary: <span class=\"literal\">false</span>,  <span class=\"comment\"># å½“å‰èŠ‚ç‚¹æ˜¯å¦ä¸ºä»èŠ‚ç‚¹</span></span><br><span class=\"line\">  primary: <span class=\"string\">&#x27;10.1.2.26:27017&#x27;</span>, <span class=\"comment\"># ä¸»èŠ‚ç‚¹çš„ä¸»æœºåå’Œç«¯å£å·</span></span><br><span class=\"line\">  me: <span class=\"string\">&#x27;10.1.2.26:27017&#x27;</span>,      <span class=\"comment\"># å½“å‰èŠ‚ç‚¹çš„ä¸»æœºåå’Œç«¯å£å·</span></span><br><span class=\"line\">  electionId: ObjectId(<span class=\"string\">&#x27;7fffffff0000000000000001&#x27;</span>), <span class=\"comment\"># é€‰ä¸¾ ID</span></span><br><span class=\"line\">  lastWrite: &#123; <span class=\"comment\"># æœ€åä¸€æ¬¡å†™å…¥æ“ä½œçš„æ—¶é—´ä¿¡æ¯</span></span><br><span class=\"line\">    opTime: &#123; ts: Timestamp(&#123; t: 1711939636, i: 7 &#125;), t: Long(<span class=\"string\">&#x27;1&#x27;</span>) &#125;, <span class=\"comment\"># æ“ä½œæ—¶é—´æˆ³</span></span><br><span class=\"line\">    lastWriteDate: ISODate(<span class=\"string\">&#x27;2024-04-01T02:47:16.000Z&#x27;</span>),               <span class=\"comment\"># æœ€åä¸€æ¬¡å†™å…¥æ“ä½œçš„æ—¶é—´</span></span><br><span class=\"line\">    majorityOpTime: &#123; ts: Timestamp(&#123; t: 1711939636, i: 7 &#125;), t: Long(<span class=\"string\">&#x27;1&#x27;</span>) &#125;, <span class=\"comment\"># å¤§å¤šæ•°å†™æ“ä½œçš„æ—¶é—´æˆ³</span></span><br><span class=\"line\">    majorityWriteDate: ISODate(<span class=\"string\">&#x27;2024-04-01T02:47:16.000Z&#x27;</span>)                    <span class=\"comment\"># å¤§å¤šæ•°å†™æ“ä½œçš„æ—¶é—´</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  maxBsonObjectSize: 16777216,                    <span class=\"comment\"># æœ€å¤§ BSON å¯¹è±¡å¤§å°</span></span><br><span class=\"line\">  maxMessageSizeBytes: 48000000,                  <span class=\"comment\"># æœ€å¤§æ¶ˆæ¯å¤§å°(ä»¥å­—èŠ‚ä¸ºå•ä½ï¼‰)</span></span><br><span class=\"line\">  maxWriteBatchSize: 100000,                      <span class=\"comment\"># æœ€å¤§å†™æ‰¹æ¬¡å¤§å°</span></span><br><span class=\"line\">  localTime: ISODate(<span class=\"string\">&#x27;2024-04-01T02:47:20.408Z&#x27;</span>), <span class=\"comment\"># æœ¬åœ°æ—¶é—´</span></span><br><span class=\"line\">  logicalSessionTimeoutMinutes: 30,               <span class=\"comment\"># ç™»å½•è¶…æ—¶æ—¶é—´(ä»¥åˆ†é’Ÿä¸ºå•ä½)</span></span><br><span class=\"line\">  connectionId: 7,                                <span class=\"comment\"># è¿æ¥ ID</span></span><br><span class=\"line\">  minWireVersion: 0,                              <span class=\"comment\"># æœ€å°Wireç‰ˆæœ¬</span></span><br><span class=\"line\">  maxWireVersion: 21,                             <span class=\"comment\"># æœ€å¤§Wireç‰ˆæœ¬</span></span><br><span class=\"line\">  readOnly: <span class=\"literal\">false</span>,                                <span class=\"comment\"># å½“å‰èŠ‚ç‚¹æ˜¯å¦ä¸ºåªè¯»èŠ‚ç‚¹</span></span><br><span class=\"line\">  ok: 1,                                          <span class=\"comment\"># æ“ä½œæ˜¯å¦æˆåŠŸ</span></span><br><span class=\"line\">  <span class=\"string\">&#x27;$clusterTime&#x27;</span>: &#123;                               <span class=\"comment\"># é›†ç¾¤æ—¶é—´</span></span><br><span class=\"line\">    clusterTime: Timestamp(&#123; t: 1711939636, i: 7 &#125;), <span class=\"comment\"># é›†ç¾¤æ—¶é—´æˆ³</span></span><br><span class=\"line\">    signature: &#123;   <span class=\"comment\"># ç­¾åä¿¡æ¯</span></span><br><span class=\"line\">      <span class=\"built_in\">hash</span>: Binary.createFromBase64(<span class=\"string\">&#x27;OOXSWapWStZk2n4cyJ7jdBS87do=&#x27;</span>, 0), <span class=\"comment\"># ç­¾åå“ˆå¸Œ</span></span><br><span class=\"line\">      keyId: Long(<span class=\"string\">&#x27;7352724745051176965&#x27;</span>) <span class=\"comment\"># å¯†é’¥ ID</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  operationTime: Timestamp(&#123; t: 1711939636, i: 7 &#125;), <span class=\"comment\"># æ“ä½œæ—¶é—´æˆ³</span></span><br><span class=\"line\">  isWritablePrimary: <span class=\"literal\">true</span> <span class=\"comment\"># å½“å‰ä¸»èŠ‚ç‚¹æ˜¯å¦å¯å†™</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æŸ¥çœ‹é›†ç¾¤çŠ¶æ€</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt; rs.status()</span><br><span class=\"line\"><span class=\"comment\"># è¿™é‡Œåªåˆ—å‡ºèŠ‚ç‚¹çš„ä¿¡æ¯</span></span><br><span class=\"line\">â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦</span><br><span class=\"line\">members: [   <span class=\"comment\"># å¤åˆ¶é›†æˆå‘˜åˆ—è¡¨</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      _id: 0, <span class=\"comment\"># èŠ‚ç‚¹ ID</span></span><br><span class=\"line\">      name: <span class=\"string\">&#x27;10.1.2.26:27017&#x27;</span>, <span class=\"comment\"># èŠ‚ç‚¹ä¸»æœºåå’Œç«¯å£å·</span></span><br><span class=\"line\">      health: 1, <span class=\"comment\"># èŠ‚ç‚¹å¥åº·çŠ¶æ€ï¼Œè¿™é‡Œæ˜¯ 1ï¼Œè¡¨ç¤ºå¥åº·</span></span><br><span class=\"line\">      state: 1, <span class=\"comment\"># èŠ‚ç‚¹çŠ¶æ€ï¼Œè¿™é‡Œæ˜¯ 1ï¼Œè¡¨ç¤ºä¸»èŠ‚ç‚¹</span></span><br><span class=\"line\">      stateStr: <span class=\"string\">&#x27;PRIMARY&#x27;</span>, <span class=\"comment\"># èŠ‚ç‚¹çŠ¶æ€å­—ç¬¦ä¸²</span></span><br><span class=\"line\">      <span class=\"built_in\">uptime</span>: 88366, <span class=\"comment\"># èŠ‚ç‚¹è¿è¡Œæ—¶é—´</span></span><br><span class=\"line\">      optime: &#123; ts: Timestamp(&#123; t: 1712044133, i: 1 &#125;), t: Long(<span class=\"string\">&#x27;5&#x27;</span>) &#125;, <span class=\"comment\"># èŠ‚ç‚¹æ“ä½œæ—¶é—´æˆ³</span></span><br><span class=\"line\">      optimeDate: ISODate(<span class=\"string\">&#x27;2024-04-02T07:48:53.000Z&#x27;</span>), <span class=\"comment\"># èŠ‚ç‚¹æ“ä½œæ—¶é—´</span></span><br><span class=\"line\">      lastAppliedWallTime: ISODate(<span class=\"string\">&#x27;2024-04-02T07:48:53.125Z&#x27;</span>), <span class=\"comment\"># èŠ‚ç‚¹æœ€ååº”ç”¨æ—¶é—´</span></span><br><span class=\"line\">      lastDurableWallTime: ISODate(<span class=\"string\">&#x27;2024-04-02T07:48:53.125Z&#x27;</span>), <span class=\"comment\"># èŠ‚ç‚¹æœ€åæŒä¹…åŒ–æ—¶é—´</span></span><br><span class=\"line\">      syncSourceHost: <span class=\"string\">&#x27;&#x27;</span>, <span class=\"comment\"># åŒæ­¥æºä¸»æœºå</span></span><br><span class=\"line\">      syncSourceId: -1, <span class=\"comment\"># åŒæ­¥æºèŠ‚ç‚¹ ID</span></span><br><span class=\"line\">      infoMessage: <span class=\"string\">&#x27;Could not find member to sync from&#x27;</span>, <span class=\"comment\"># èŠ‚ç‚¹ä¿¡æ¯æ¶ˆæ¯</span></span><br><span class=\"line\">      electionTime: Timestamp(&#123; t: 1712044063, i: 1 &#125;), <span class=\"comment\"># é€‰ä¸¾æ—¶é—´æˆ³</span></span><br><span class=\"line\">      electionDate: ISODate(<span class=\"string\">&#x27;2024-04-02T07:47:43.000Z&#x27;</span>), <span class=\"comment\"># é€‰ä¸¾æ—¶é—´</span></span><br><span class=\"line\">      configVersion: 4, <span class=\"comment\"># é…ç½®ç‰ˆæœ¬</span></span><br><span class=\"line\">      configTerm: 5, <span class=\"comment\"># é€‰ä¸¾ä»»æœŸ</span></span><br><span class=\"line\">      self: <span class=\"literal\">true</span>, <span class=\"comment\"># æ˜¯å¦ä¸ºä¸»èŠ‚ç‚¹</span></span><br><span class=\"line\">      lastHeartbeatMessage: <span class=\"string\">&#x27;&#x27;</span> <span class=\"comment\"># èŠ‚ç‚¹å¿ƒè·³æ¶ˆæ¯</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      _id: 1,</span><br><span class=\"line\">      name: <span class=\"string\">&#x27;10.1.2.142:27017&#x27;</span>,</span><br><span class=\"line\">      health: 1,</span><br><span class=\"line\">      state: 2, <span class=\"comment\"># èŠ‚ç‚¹çŠ¶æ€ï¼Œè¿™é‡Œæ˜¯ 2ï¼Œè¡¨ç¤ºä»èŠ‚ç‚¹</span></span><br><span class=\"line\">      stateStr: <span class=\"string\">&#x27;SECONDARY&#x27;</span>,</span><br><span class=\"line\">      <span class=\"built_in\">uptime</span>: 88363,</span><br><span class=\"line\">      optime: &#123; ts: Timestamp(&#123; t: 1712044133, i: 1 &#125;), t: Long(<span class=\"string\">&#x27;5&#x27;</span>) &#125;,</span><br><span class=\"line\">      optimeDurable: &#123; ts: Timestamp(&#123; t: 1712044133, i: 1 &#125;), t: Long(<span class=\"string\">&#x27;5&#x27;</span>) &#125;,</span><br><span class=\"line\">      optimeDate: ISODate(<span class=\"string\">&#x27;2024-04-02T07:48:53.000Z&#x27;</span>),</span><br><span class=\"line\">      optimeDurableDate: ISODate(<span class=\"string\">&#x27;2024-04-02T07:48:53.000Z&#x27;</span>),</span><br><span class=\"line\">      lastAppliedWallTime: ISODate(<span class=\"string\">&#x27;2024-04-02T07:48:53.125Z&#x27;</span>),</span><br><span class=\"line\">      lastDurableWallTime: ISODate(<span class=\"string\">&#x27;2024-04-02T07:48:53.125Z&#x27;</span>),</span><br><span class=\"line\">      lastHeartbeat: ISODate(<span class=\"string\">&#x27;2024-04-02T07:48:53.140Z&#x27;</span>), <span class=\"comment\"># æœ€åä¸€æ¬¡å¿ƒè·³æ—¶é—´</span></span><br><span class=\"line\">      lastHeartbeatRecv: ISODate(<span class=\"string\">&#x27;2024-04-02T07:48:53.655Z&#x27;</span>), <span class=\"comment\"># æœ€åä¸€æ¬¡æ¥æ”¶å¿ƒè·³æ—¶é—´</span></span><br><span class=\"line\">      pingMs: Long(<span class=\"string\">&#x27;0&#x27;</span>), <span class=\"comment\"># èŠ‚ç‚¹å¿ƒè·³é—´éš”æ—¶é—´</span></span><br><span class=\"line\">      lastHeartbeatMessage: <span class=\"string\">&#x27;&#x27;</span>, <span class=\"comment\"># èŠ‚ç‚¹å¿ƒè·³æ¶ˆæ¯</span></span><br><span class=\"line\">      syncSourceHost: <span class=\"string\">&#x27;10.1.2.26:27017&#x27;</span>, <span class=\"comment\"># åŒæ­¥æºä¸»æœºå</span></span><br><span class=\"line\">      syncSourceId: 0, <span class=\"comment\"># åŒæ­¥æºèŠ‚ç‚¹ ID</span></span><br><span class=\"line\">      infoMessage: <span class=\"string\">&#x27;&#x27;</span>, <span class=\"comment\"># èŠ‚ç‚¹ä¿¡æ¯æ¶ˆæ¯</span></span><br><span class=\"line\">      configVersion: 4, <span class=\"comment\"># é…ç½®ç‰ˆæœ¬</span></span><br><span class=\"line\">      configTerm: 5 <span class=\"comment\"># é€‰ä¸¾ä»»æœŸ</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      _id: 2,</span><br><span class=\"line\">      name: <span class=\"string\">&#x27;10.1.2.41:27017&#x27;</span>,</span><br><span class=\"line\">      health: 0, <span class=\"comment\"># èŠ‚ç‚¹å¥åº·çŠ¶æ€ï¼Œè¿™é‡Œæ˜¯0ï¼Œè¡¨ç¤ºèŠ‚ç‚¹ä¸å¯è¾¾ï¼Œå› ä¸ºè¯¥èŠ‚ç‚¹çš„mongoæœåŠ¡è¢«å…³æ‰äº†ï¼Œè¿™é‡Œåªæ˜¯ä¸ºäº†å±•ç¤ºä¸åŒçš„çŠ¶æ€</span></span><br><span class=\"line\">      state: 8, <span class=\"comment\"># èŠ‚ç‚¹çŠ¶æ€ï¼Œè¿™é‡Œæ˜¯8ï¼Œè¡¨ç¤ºä¸å¯è¾¾</span></span><br><span class=\"line\">      stateStr: <span class=\"string\">&#x27;(not reachable/healthy)&#x27;</span>, <span class=\"comment\"># èŠ‚ç‚¹çŠ¶æ€å­—ç¬¦ä¸²ï¼Œæç¤ºèŠ‚ç‚¹ä¸å¯è¾¾</span></span><br><span class=\"line\">      <span class=\"built_in\">uptime</span>: 0,</span><br><span class=\"line\">      optime: &#123; ts: Timestamp(&#123; t: 0, i: 0 &#125;), t: Long(<span class=\"string\">&#x27;-1&#x27;</span>) &#125;,</span><br><span class=\"line\">      optimeDurable: &#123; ts: Timestamp(&#123; t: 0, i: 0 &#125;), t: Long(<span class=\"string\">&#x27;-1&#x27;</span>) &#125;,</span><br><span class=\"line\">      optimeDate: ISODate(<span class=\"string\">&#x27;1970-01-01T00:00:00.000Z&#x27;</span>),</span><br><span class=\"line\">      optimeDurableDate: ISODate(<span class=\"string\">&#x27;1970-01-01T00:00:00.000Z&#x27;</span>),</span><br><span class=\"line\">      lastAppliedWallTime: ISODate(<span class=\"string\">&#x27;2024-04-02T07:47:23.818Z&#x27;</span>),</span><br><span class=\"line\">      lastDurableWallTime: ISODate(<span class=\"string\">&#x27;2024-04-02T07:47:23.818Z&#x27;</span>),</span><br><span class=\"line\">      lastHeartbeat: ISODate(<span class=\"string\">&#x27;2024-04-02T07:48:53.163Z&#x27;</span>),</span><br><span class=\"line\">      lastHeartbeatRecv: ISODate(<span class=\"string\">&#x27;2024-04-02T07:47:32.215Z&#x27;</span>),</span><br><span class=\"line\">      pingMs: Long(<span class=\"string\">&#x27;0&#x27;</span>),</span><br><span class=\"line\">      lastHeartbeatMessage: <span class=\"string\">&#x27;Error connecting to 10.1.2.41:27017 :: caused by :: onInvoke :: caused by :: Connection refused&#x27;</span>, <span class=\"comment\"># èŠ‚ç‚¹å¿ƒè·³æ¶ˆæ¯ï¼Œè¿™é‡Œæ˜¯è¿æ¥å¤±è´¥</span></span><br><span class=\"line\">      syncSourceHost: <span class=\"string\">&#x27;&#x27;</span>,</span><br><span class=\"line\">      syncSourceId: -1,</span><br><span class=\"line\">      infoMessage: <span class=\"string\">&#x27;&#x27;</span>,</span><br><span class=\"line\">      configVersion: 4,</span><br><span class=\"line\">      configTerm: 4</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  ]</span><br><span class=\"line\">â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>stateçš„å€¼åŠå¯¹åº”çš„å«ä¹‰<br>\n0: Startup - æˆå‘˜æ­£åœ¨å¯åŠ¨ã€‚<br>\n1: Primary - æˆå‘˜æ˜¯ä¸»å‰¯æœ¬é›†èŠ‚ç‚¹ã€‚å¯ä»¥æ¥æ”¶å†™å…¥æ“ä½œã€‚æ¯ä¸ªå‰¯æœ¬é›†æœ‰ä¸”ä»…æœ‰ä¸€ä¸ªä¸»èŠ‚ç‚¹ã€‚<br>\n2: Secondary - æˆå‘˜æ˜¯ä»å‰¯æœ¬é›†èŠ‚ç‚¹ã€‚å¤åˆ¶ä¸»èŠ‚ç‚¹çš„æ•°æ®å˜æ›´ã€‚<br>\n3: Recovering - æˆå‘˜å·²ç»æ¥æ”¶åˆ°æ–°çš„æ•°æ®ï¼Œä½†è¿˜æ— æ³•æä¾›è¯»æˆ–æŠ•ç¥¨æœåŠ¡ã€‚æ­¤çŠ¶æ€é€šå¸¸æ˜¯çŸ­æš‚çš„ã€‚<br>\n4: Fatal - æˆå‘˜å‘ç”Ÿäº†ä¸å¯æ¢å¤çš„é”™è¯¯ï¼Œå·²åœæ­¢æ¥æ”¶å’Œå¤åˆ¶æ•°æ®ã€‚äººå·¥å¹²é¢„éœ€è¦é‡å¯æˆå‘˜æˆ–è€…å‰¯æœ¬é›†ã€‚<br>\n5: Startup2 - æˆå‘˜æ­£åœ¨åˆå§‹åŒ–å‰¯æœ¬é›†çš„å†…éƒ¨æ•°æ®ç»“æ„ã€‚<br>\n6: Unknown - å› ä¸ºä¸æ­¤æˆå‘˜çš„åŒæ­¥è¢«æ‰“æ–­ï¼Œå¯¼è‡´æ­¤æˆå‘˜çŠ¶æ€æœªçŸ¥ã€‚<br>\n7: Arbiter - æˆå‘˜æ˜¯ä»²è£è€…ã€‚<br>\n8: Down - è¿™ä¸ªæˆå‘˜ç›®å‰ä¸èƒ½åˆ°è¾¾ã€‚<br>\n9: Rollback - è¿™ä¸ªæˆå‘˜æ­£åœ¨æ»šåŠ¨å›æ•°æ®ä»¥è¾¾åˆ°ä¸€è‡´çš„çŠ¶æ€ã€‚<br>\n10: Removed - è¿™ä¸ªæˆå‘˜å·²ç»ä»å‰¯æœ¬é›†ä¸­åˆ é™¤ã€‚</p>\n</blockquote>\n<h2 id=\"æˆæƒ\">æˆæƒ</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ›å»ºç”¨æˆ·</p>\n</li>\n</ul>\n<blockquote>\n<p>æˆæƒåéœ€è¦é‡æ–°ç™»å½•æˆ–è¿›è¡Œè®¤è¯åæ‰èƒ½ç»§ç»­æ“ä½œ</p>\n</blockquote>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ç™»å½•ä¸»èŠ‚ç‚¹</span></span><br><span class=\"line\">rs0 [direct: primary] <span class=\"built_in\">test</span>&gt; use admin</span><br><span class=\"line\">switched to db admin</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åˆ›å»ºç”¨æˆ·</span></span><br><span class=\"line\">rs0 [direct: primary] admin&gt; db.createUser(&#123;</span><br><span class=\"line\"> user: <span class=\"string\">&quot;user&quot;</span>,</span><br><span class=\"line\"> <span class=\"built_in\">pwd</span>: <span class=\"string\">&quot;password&quot;</span>,</span><br><span class=\"line\"> roles: [</span><br><span class=\"line\">  &#123; role: <span class=\"string\">&quot;clusterAdmin&quot;</span>, db: <span class=\"string\">&quot;admin&quot;</span> &#125; ,</span><br><span class=\"line\">  &#123; role: <span class=\"string\">&quot;userAdminAnyDatabase&quot;</span>, db: <span class=\"string\">&quot;admin&quot;</span>&#125;,</span><br><span class=\"line\">  &#123; role: <span class=\"string\">&quot;dbAdminAnyDatabase&quot;</span>, db: <span class=\"string\">&quot;admin&quot;</span> &#125;,</span><br><span class=\"line\">  &#123; role: <span class=\"string\">&quot;readWriteAnyDatabase&quot;</span>, db: <span class=\"string\">&quot;admin&quot;</span>&#125;</span><br><span class=\"line\"> ]</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<h2 id=\"ç™»å½•\">ç™»å½•</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ–¹æ³•1ï¼Œè¿æ¥çš„åŒæ—¶è®¤è¯</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># é»˜è®¤ç™»å½•testæ•°æ®åº“</span></span><br><span class=\"line\">mongosh 10.1.2.26:27017 -u user -p password --authenticationDatabase admin</span><br><span class=\"line\"><span class=\"comment\"># æˆ–è€…</span></span><br><span class=\"line\">mongosh <span class=\"string\">&quot;mongodb://user:password@10.1.2.26:27017/test?authSource=admin&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># é›†ç¾¤è¿æ¥ï¼Œæ¨èï¼Œä¼šè‡ªåŠ¨ç™»å½•åˆ°ä¸»èŠ‚ç‚¹</span></span><br><span class=\"line\">mongosh <span class=\"string\">&quot;mongodb://user:password@10.1.2.26:27017,10.1.2.142:27017,10.1.2.41:27017/test?authSource=admin&amp;replicaSet=rs0&quot;</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ–¹æ³•2ï¼Œå…ˆè¿æ¥ï¼Œå†è®¤è¯</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mongosh 10.1.2.26:27017</span><br><span class=\"line\">&gt; use admin</span><br><span class=\"line\">switched to db admin</span><br><span class=\"line\">&gt; db.auth(<span class=\"string\">&quot;user&quot;</span>,<span class=\"string\">&quot;password&quot;</span>)</span><br><span class=\"line\">&#123; ok: 1 &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># é›†ç¾¤è¿æ¥ï¼Œæ¨èï¼Œä¼šè‡ªåŠ¨ç™»å½•åˆ°ä¸»èŠ‚ç‚¹</span></span><br><span class=\"line\">mongosh <span class=\"string\">&quot;mongodb://10.1.2.26:27017,10.1.2.142:27017,10.1.2.41:27017/test?authSource=admin&amp;replicaSet=rs0&quot;</span></span><br><span class=\"line\">&gt; use admin</span><br><span class=\"line\">switched to db admin</span><br><span class=\"line\">&gt; db.auth(<span class=\"string\">&quot;user&quot;</span>,<span class=\"string\">&quot;password&quot;</span>)</span><br><span class=\"line\">&#123; ok: 1 &#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"æŸ¥çœ‹ç”¨æˆ·ä¿¡æ¯\">æŸ¥çœ‹ç”¨æˆ·ä¿¡æ¯</h2>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å…ˆè¦åˆ‡æ¢åˆ° admin æ•°æ®åº“</span></span><br><span class=\"line\">rs0 [direct: primary] admin&gt; db.system.users.find()</span><br><span class=\"line\">[</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    _id: <span class=\"string\">&#x27;admin.user&#x27;</span>,</span><br><span class=\"line\">    userId: UUID(<span class=\"string\">&#x27;19dcd146-6872-41fe-8e39-46bb98b9db5c&#x27;</span>),</span><br><span class=\"line\">    user: <span class=\"string\">&#x27;user&#x27;</span>,</span><br><span class=\"line\">    db: <span class=\"string\">&#x27;admin&#x27;</span>,</span><br><span class=\"line\">    credentials: &#123;</span><br><span class=\"line\">      <span class=\"string\">&#x27;SCRAM-SHA-1&#x27;</span>: &#123;</span><br><span class=\"line\">        iterationCount: 10000,</span><br><span class=\"line\">        salt: <span class=\"string\">&#x27;DLOOhoEKeG2RKfW8hU4caw==&#x27;</span>,</span><br><span class=\"line\">        storedKey: <span class=\"string\">&#x27;ohQOJeAS3XWUwlFJAGduuiUJptc=&#x27;</span>,</span><br><span class=\"line\">        serverKey: <span class=\"string\">&#x27;rDjqq/nF3awasdaPr2ocJskm7p0=&#x27;</span></span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      <span class=\"string\">&#x27;SCRAM-SHA-256&#x27;</span>: &#123;</span><br><span class=\"line\">        iterationCount: 15000,</span><br><span class=\"line\">        salt: <span class=\"string\">&#x27;6YpcJH2pcL3yC726rpIq6VWSQLSV68i+oqURkw==&#x27;</span>,</span><br><span class=\"line\">        storedKey: <span class=\"string\">&#x27;1nIijUrLAL0lQZ6++O0cxM3VbsprdwRQucVFYkDQWbA=&#x27;</span>,</span><br><span class=\"line\">        serverKey: <span class=\"string\">&#x27;nk8TKbK19zLaD7wJn+991euF9ILE08iPopmJ8YAAqfQ=&#x27;</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    roles: [</span><br><span class=\"line\">      &#123; role: <span class=\"string\">&#x27;userAdminAnyDatabase&#x27;</span>, db: <span class=\"string\">&#x27;admin&#x27;</span> &#125;,</span><br><span class=\"line\">      &#123; role: <span class=\"string\">&#x27;clusterAdmin&#x27;</span>, db: <span class=\"string\">&#x27;admin&#x27;</span> &#125;,</span><br><span class=\"line\">      &#123; role: <span class=\"string\">&#x27;dbAdminAnyDatabase&#x27;</span>, db: <span class=\"string\">&#x27;admin&#x27;</span> &#125;,</span><br><span class=\"line\">      &#123; role: <span class=\"string\">&#x27;readWriteAnyDatabase&#x27;</span>, db: <span class=\"string\">&#x27;admin&#x27;</span> &#125;</span><br><span class=\"line\">    ]</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">]</span><br><span class=\"line\"></span><br><span class=\"line\">rs0 [direct: primary] admin&gt; show <span class=\"built_in\">users</span></span><br><span class=\"line\">[</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    _id: <span class=\"string\">&#x27;admin.user&#x27;</span>,</span><br><span class=\"line\">    userId: UUID(<span class=\"string\">&#x27;19dcd146-6872-41fe-8e39-46bb98b9db5c&#x27;</span>),</span><br><span class=\"line\">    user: <span class=\"string\">&#x27;user&#x27;</span>,</span><br><span class=\"line\">    db: <span class=\"string\">&#x27;admin&#x27;</span>,</span><br><span class=\"line\">    roles: [</span><br><span class=\"line\">      &#123; role: <span class=\"string\">&#x27;userAdminAnyDatabase&#x27;</span>, db: <span class=\"string\">&#x27;admin&#x27;</span> &#125;,</span><br><span class=\"line\">      &#123; role: <span class=\"string\">&#x27;clusterAdmin&#x27;</span>, db: <span class=\"string\">&#x27;admin&#x27;</span> &#125;,</span><br><span class=\"line\">      &#123; role: <span class=\"string\">&#x27;dbAdminAnyDatabase&#x27;</span>, db: <span class=\"string\">&#x27;admin&#x27;</span> &#125;,</span><br><span class=\"line\">      &#123; role: <span class=\"string\">&#x27;readWriteAnyDatabase&#x27;</span>, db: <span class=\"string\">&#x27;admin&#x27;</span> &#125;</span><br><span class=\"line\">    ],</span><br><span class=\"line\">    mechanisms: [ <span class=\"string\">&#x27;SCRAM-SHA-1&#x27;</span>, <span class=\"string\">&#x27;SCRAM-SHA-256&#x27;</span> ]</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">]</span><br></pre></td></tr></table></figure>\n<h2 id=\"å¼€å¯ä»åº“è¯»å–æ•°æ®çš„æƒé™\">å¼€å¯ä»åº“è¯»å–æ•°æ®çš„æƒé™</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä½¿ç”¨å½“å‰æœ€æ–°ç‰ˆ<code>mongosh-2.2.2</code>è¿æ¥ä»åº“æ—¶ï¼Œé»˜è®¤å°±æ”¯æŒè¯»å–æ•°æ®ï¼Œå…¶é»˜è®¤çš„<code>readPreference</code>ä¸º<code>primaryPreferred</code>ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å¦‚æœä½¿ç”¨ä¹‹å‰çš„ç‰ˆæœ¬è¿æ¥ä»åº“æ—¶ï¼Œé»˜è®¤æ˜¯ä¸èƒ½è¯»å–æ•°æ®çš„ï¼Œéœ€è¦æ‰‹å·¥å¼€å¯</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æç¤ºéä¸»èŠ‚ç‚¹ï¼Œä¸èƒ½æŸ¥è¯¢æ•°æ®ï¼Œ</span></span><br><span class=\"line\">rs0 [direct: secondary] <span class=\"built_in\">test</span>&gt; show <span class=\"built_in\">users</span></span><br><span class=\"line\">MongoServerError[NotPrimaryNoSecondaryOk]: not primary - consider using db.getMongo().setReadPref() or readPreference <span class=\"keyword\">in</span> the connection string</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ—©æœŸç‰ˆæœ¬æ˜¯è¿è¡Œ rs.secondaryOk()ï¼Œä¸è¿‡ç°åœ¨æç¤ºå·²ç»ä¸æ¨èäº†</span></span><br><span class=\"line\">rs0 [direct: secondary] <span class=\"built_in\">test</span>&gt; rs.secondaryOk()</span><br><span class=\"line\">DeprecationWarning: .setSecondaryOk() is deprecated. Use .setReadPref(<span class=\"string\">&quot;primaryPreferred&quot;</span>) instead</span><br><span class=\"line\">Setting <span class=\"built_in\">read</span> preference from <span class=\"string\">&quot;primary&quot;</span> to <span class=\"string\">&quot;primaryPreferred&quot;</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å…¨å±€è®¾ç½®<code>readPreference</code>ï¼Œå¯¹æœ¬æ¬¡é“¾æ¥éƒ½æœ‰æ•ˆ</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å¼€å¯ä»åº“è¯»å–æ•°æ®æƒé™</span></span><br><span class=\"line\">rs0 [direct: secondary] <span class=\"built_in\">test</span>&gt; db.getMongo().setReadPref(<span class=\"string\">&quot;primaryPreferred&quot;</span>)</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¹Ÿå¯ä»¥åœ¨é“¾æ¥å‚æ•°ä¸­æŒ‡å®š<code>readPreference</code></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å•èŠ‚ç‚¹è¿æ¥</span></span><br><span class=\"line\">mongosh <span class=\"string\">&quot;mongodb://user:password@10.1.2.142:27017/test?authSource=admin&amp;readPreference=primaryPreferred&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># é›†ç¾¤è¿æ¥</span></span><br><span class=\"line\">mongosh <span class=\"string\">&quot;mongodb://user:password@10.1.2.26:27017,10.1.2.142:27017,10.1.2.41:27017/test?authSource=admin&amp;replicaSet=rs0&amp;readPreference=primaryPreferred&quot;</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¯ä»¥åœ¨æŸ¥è¯¢æ—¶æŒ‡å®š<code>readPreference</code>ï¼Œåªé’ˆå¯¹å½“å‰æŸ¥è¯¢ï¼Œå¯¹åç»­æŸ¥è¯¢æ— æ•ˆ</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rs0 [direct: secondary] admin&gt; db.system.users.find().readPref(<span class=\"string\">&quot;secondary&quot;</span>)</span><br></pre></td></tr></table></figure>\n<h2 id=\"readPreference\">readPreference</h2>\n<p>readPreferenceå†³å®šä½¿ç”¨å“ªä¸€ç±»èŠ‚ç‚¹ï¼ˆä¸»æˆ–ä»èŠ‚ç‚¹ï¼‰æ¥æ»¡è¶³æ­£åœ¨å‘èµ·çš„è¯»è¯·æ±‚ã€‚å¯é€‰å€¼åŒ…æ‹¬ï¼š</p>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><code>primary</code>ï¼šé»˜è®¤å€¼ï¼Œåªè¯»ä¸»èŠ‚ç‚¹çš„æ•°æ®ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><code>primaryPreferred</code>ï¼šä¼˜å…ˆè¯»ä¸»èŠ‚ç‚¹çš„æ•°æ®ï¼Œå¦‚æœä¸»èŠ‚ç‚¹ä¸å¯ç”¨ï¼Œåˆ™è¯»ä»èŠ‚ç‚¹çš„æ•°æ®ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><code>secondary</code>ï¼šåªè¯»ä»èŠ‚ç‚¹çš„æ•°æ®ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><code>secondaryPreferred</code>ï¼šä¼˜å…ˆè¯»ä»èŠ‚ç‚¹çš„æ•°æ®ï¼Œå¦‚æœä»èŠ‚ç‚¹ä¸å¯ç”¨ï¼Œåˆ™è¯»ä¸»èŠ‚ç‚¹çš„æ•°æ®ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><code>nearest</code>ï¼šä¼˜å…ˆè¯»è·ç¦»æœ€è¿‘çš„èŠ‚ç‚¹çš„æ•°æ®ã€‚</p>\n</li>\n</ul>\n<blockquote>\n<p>æŒ‡å®š <code>readPreference</code> æ—¶åº”æ³¨æ„é«˜å¯ç”¨é—®é¢˜ã€‚ä¾‹å¦‚å°† <code>readPreference</code> æŒ‡å®š <code>primary</code>ï¼Œåˆ™å‘ç”Ÿæ•…éšœè½¬ç§»ä¸å­˜åœ¨ <code>primary</code> æœŸé—´å°†æ²¡æœ‰èŠ‚ç‚¹å¯è¯»ã€‚å¦‚æœä¸šåŠ¡å…è®¸ï¼Œåˆ™åº”é€‰æ‹© <code>primaryPreferred</code>ï¼›</p>\n</blockquote>\n<h2 id=\"Tag\">Tag</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>é›†ç¾¤ä¸­èŠ‚ç‚¹çš„æ ‡ç­¾ï¼Œç”¨äºé€‰æ‹©èŠ‚ç‚¹</p>\n</li>\n<li class=\"lvl-2\">\n<p><code>readPreference</code> åªèƒ½æ§åˆ¶ä½¿ç”¨ä¸€ç±»ï¼ˆä¸»æˆ–ä»èŠ‚ç‚¹ï¼‰èŠ‚ç‚¹ã€‚<code>Tag</code> åˆ™å¯ä»¥å°†èŠ‚ç‚¹é€‰æ‹©æ§åˆ¶åˆ°ä¸€ä¸ªæˆ–å‡ ä¸ªèŠ‚ç‚¹ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä¸ºèŠ‚ç‚¹æ·»åŠ <code>Tag</code></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å¿…é¡»åœ¨ä¸»èŠ‚ç‚¹ä¸‹æ‰èƒ½ä¿®æ”¹é…ç½®</span></span><br><span class=\"line\">conf = rs.conf()</span><br><span class=\"line\">conf.members[0].tags = &#123; purpose: <span class=\"string\">&quot;online&quot;</span> &#125;</span><br><span class=\"line\">conf.members[1].tags = &#123; purpose: <span class=\"string\">&quot;online&quot;</span> &#125;</span><br><span class=\"line\">conf.members[2].tags = &#123; purpose: <span class=\"string\">&quot;analyse&quot;</span>&#125;</span><br><span class=\"line\">rs.reconfig(conf)</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å…¨å±€æŒ‡å®š<code>Tag</code></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rs0 [direct: primary] admin&gt; db.getMongo().setReadPref(<span class=\"string\">&quot;primaryPreferred&quot;</span>, [ &#123;purpose: <span class=\"string\">&quot;online&quot;</span>&#125; ])</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åœ¨é“¾æ¥å‚æ•°ä¸­æŒ‡å®š<code>Tag</code></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mongosh <span class=\"string\">&quot;mongodb://user:password@10.1.2.26:27017,10.1.2.142:27017,10.1.2.41:27017/test?authSource=admin&amp;replicaSet=rs0&amp;readPreference=primaryPreferred&amp;readPreferenceTags=purpose:online&quot;</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åœ¨æŸ¥è¯¢æ—¶æŒ‡å®š<code>Tag</code></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rs0 [direct: secondary] admin&gt; db.system.users.find().readPref(<span class=\"string\">&quot;secondary&quot;</span>, [ &#123;purpose: <span class=\"string\">&quot;analyse&quot;</span>&#125; ])</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ³¨æ„ï¼Œ`Tag`åªèƒ½ç”¨äºä»èŠ‚ç‚¹ï¼Œä¸»èŠ‚ç‚¹ä¸æ”¯æŒã€‚</span></span><br><span class=\"line\">rs0 [direct: primary] admin&gt; db.system.users.find().readPref(<span class=\"string\">&quot;primary&quot;</span>, [ &#123;purpose: <span class=\"string\">&quot;online&quot;</span>&#125; ])</span><br><span class=\"line\">MongoInvalidArgumentError: Primary <span class=\"built_in\">read</span> preference cannot be combined with tags</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä½¿ç”¨ Tag æ—¶åº”æ³¨æ„é«˜å¯ç”¨é—®é¢˜ï¼Œå¦‚æœåªæœ‰ä¸€ä¸ªèŠ‚ç‚¹æ‹¥æœ‰ä¸€ä¸ªç‰¹å®š Tagï¼Œåˆ™åœ¨è¿™ä¸ªèŠ‚ç‚¹å¤±æ•ˆæ—¶å°†æ— èŠ‚ç‚¹å¯è¯»ã€‚è¿™åœ¨æœ‰æ—¶å€™æ˜¯æœŸæœ›çš„ç»“æœï¼Œæœ‰æ—¶å€™ä¸æ˜¯ã€‚ä¾‹å¦‚ï¼š</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">å¦‚æœæŠ¥è¡¨ä½¿ç”¨çš„èŠ‚ç‚¹å¤±æ•ˆï¼Œå³ä½¿ä¸ç”ŸæˆæŠ¥è¡¨ï¼Œé€šå¸¸ä¹Ÿä¸å¸Œæœ›å°†æŠ¥è¡¨è´Ÿè½½è½¬ç§»åˆ°å…¶ä»–èŠ‚ç‚¹ä¸Šï¼Œæ­¤æ—¶åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹æœ‰æŠ¥è¡¨ Tag æ˜¯åˆç†çš„é€‰æ‹©ï¼›</li>\n<li class=\"lvl-4\">å¦‚æœçº¿ä¸ŠèŠ‚ç‚¹å¤±æ•ˆï¼Œé€šå¸¸å¸Œæœ›æœ‰æ›¿ä»£èŠ‚ç‚¹ï¼Œæ‰€ä»¥åº”è¯¥ä¿æŒå¤šä¸ªèŠ‚ç‚¹æœ‰åŒæ ·çš„ Tagï¼›</li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<p>Tag æœ‰æ—¶éœ€è¦ä¸ä¼˜å…ˆçº§ã€é€‰ä¸¾æƒç»¼åˆè€ƒè™‘ã€‚ä¾‹å¦‚åšæŠ¥è¡¨çš„èŠ‚ç‚¹é€šå¸¸ä¸ä¼šå¸Œæœ›å®ƒæˆä¸ºä¸»èŠ‚ç‚¹ï¼Œåˆ™ä¼˜å…ˆçº§åº”ä¸º 0ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>é€šè¿‡<code>rs.conf()</code>å¯ä»¥æŸ¥çœ‹å¤åˆ¶é›†ä¸­å„ä¸ªèŠ‚ç‚¹çš„Tagä¿¡æ¯</p>\n</li>\n</ul>\n<h2 id=\"ä¼˜å…ˆçº§-priority-ä¸-é€‰ä¸¾æƒ-vote\">ä¼˜å…ˆçº§(priority) ä¸ é€‰ä¸¾æƒ(vote)</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å½“ <code>Priority</code> ç­‰äº 0 æ—¶ï¼Œå®ƒä¸å¯ä»¥è¢«å¤åˆ¶é›†é€‰ä¸¾ä¸ºä¸»ï¼Œ<code>Priority</code> çš„å€¼è¶Šé«˜ï¼Œåˆ™è¢«é€‰ä¸¾ä¸ºä¸»çš„æ¦‚ç‡æ›´å¤§ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å½“ <code>Vote</code> ç­‰äº 0 æ—¶ï¼Œå®ƒä¸å¯ä»¥å‚ä¸é€‰ä¸¾æŠ•ç¥¨ï¼Œæ­¤æ—¶è¯¥èŠ‚ç‚¹çš„ <code>Priority</code> ä¹Ÿå¿…é¡»ä¸º 0ï¼Œå³å®ƒä¹Ÿä¸èƒ½è¢«é€‰ä¸¾ä¸ºä¸»ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ç”±äºä¸€ä¸ªå¤åˆ¶é›†ä¸­æœ€å¤šåªæœ‰7ä¸ªæŠ•ç¥¨æˆå‘˜ï¼Œå› æ­¤å¤šå‡ºæ¥çš„æˆå‘˜åˆ™å¿…é¡»å°†å…¶voteå±æ€§å€¼è®¾ç½®ä¸º0ï¼Œå³è¿™äº›æˆå‘˜å°†æ— æ³•å‚ä¸æŠ•ç¥¨ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>é€šè¿‡<code>rs.conf()</code>å¯ä»¥æŸ¥çœ‹å¤åˆ¶é›†ä¸­å„ä¸ªèŠ‚ç‚¹çš„ç›¸å…³é…ç½®</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt; rs.<span class=\"function\"><span class=\"title\">conf</span></span>()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  _id: <span class=\"string\">&#x27;rs0&#x27;</span>,                <span class=\"comment\"># å¤åˆ¶é›†åç§°</span></span><br><span class=\"line\">  version: 2,                <span class=\"comment\"># é…ç½®ç‰ˆæœ¬å·ï¼Œå³confè¢«ä¿®æ”¹çš„æ¬¡æ•°ï¼Œæ¯æ¬¡æ›´æ”¹é…ç½®æ—¶ï¼Œç‰ˆæœ¬å·éƒ½ä¼šé€’å¢ã€‚</span></span><br><span class=\"line\">  term: 3,                   <span class=\"comment\"># é€‰ä¸¾è½®æ¬¡ï¼ˆelection termï¼‰ã€‚åœ¨è¿›è¡Œé€‰ä¸¾æ—¶ï¼ŒMongoDB ä½¿ç”¨ä¸€ä¸ªå•è°ƒé€’å¢çš„ term å€¼æ¥æ ‡è¯†é€‰ä¸¾çš„å‘¨æœŸã€‚è¿™ä¸ªå€¼ä¼šéšç€é€‰ä¸¾çš„è¿›è¡Œè€Œå¢åŠ ã€‚</span></span><br><span class=\"line\">  members: [                 <span class=\"comment\"># æˆå‘˜æ•°ç»„ï¼ŒåŒ…å«äº†å¤åˆ¶é›†ä¸­çš„æ‰€æœ‰æˆå‘˜çš„è¯¦ç»†é…ç½®ä¿¡æ¯ã€‚</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      _id: 0,                <span class=\"comment\"># æˆå‘˜çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œä»0å¼€å§‹é€’å¢ã€‚</span></span><br><span class=\"line\">      host: <span class=\"string\">&#x27;10.1.2.26:27017&#x27;</span>, <span class=\"comment\"># èŠ‚ç‚¹ip+port</span></span><br><span class=\"line\">      arbiterOnly: <span class=\"literal\">false</span>,    <span class=\"comment\"># æ˜¯å¦ä¸ºä»²è£èŠ‚ç‚¹</span></span><br><span class=\"line\">      buildIndexes: <span class=\"literal\">true</span>,    <span class=\"comment\"># æ˜¯å¦åœ¨æ­¤èŠ‚ç‚¹ä¸Šåˆ›å»ºç´¢å¼•</span></span><br><span class=\"line\">      hidden: <span class=\"literal\">false</span>,         <span class=\"comment\"># æ˜¯å¦ä¸ºéšè—èŠ‚ç‚¹ï¼Œå³ä¸è¢«å®¢æˆ·ç«¯å‘ç°ã€‚</span></span><br><span class=\"line\">      priority: 1,           <span class=\"comment\"># é€‰ä¸¾ä¼˜å…ˆçº§ï¼Œå€¼è¶Šå¤§ä¼˜å…ˆçº§è¶Šé«˜ï¼Œ0è¡¨ç¤ºä¸èƒ½è¢«é€‰ä¸¾ä¸ºä¸»èŠ‚ç‚¹</span></span><br><span class=\"line\">      tags: &#123; purpose: <span class=\"string\">&#x27;online&#x27;</span> &#125;, <span class=\"comment\"># Tag</span></span><br><span class=\"line\">      secondaryDelaySecs: Long(<span class=\"string\">&#x27;0&#x27;</span>), <span class=\"comment\"># å¦‚æœå­˜åœ¨å»¶è¿Ÿå¤åˆ¶ï¼Œè¡¨ç¤ºå¤åˆ¶å»¶è¿Ÿçš„æ—¶é—´é‡ï¼ˆä»¥ç§’ä¸ºå•ä½ï¼‰ï¼Œå¦‚æœä¸º0åˆ™è¡¨ç¤ºä¸æ˜¯å»¶è¿ŸèŠ‚ç‚¹ã€‚</span></span><br><span class=\"line\">      votes: 1               <span class=\"comment\"># æˆå‘˜çš„æŠ•ç¥¨æ•°ï¼Œå¤§äº0è¡¨ç¤ºå‚ä¸æŠ•ç¥¨ã€‚</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  ],</span><br><span class=\"line\">  protocolVersion: Long(<span class=\"string\">&#x27;1&#x27;</span>),                         <span class=\"comment\"># å¤åˆ¶é›†ä½¿ç”¨çš„åè®®ç‰ˆæœ¬ã€‚</span></span><br><span class=\"line\">  writeConcernMajorityJournalDefault: <span class=\"literal\">true</span>,           <span class=\"comment\"># æ˜¯å¦åœ¨å†™å…¥æ“ä½œä¸­é»˜è®¤å¯ç”¨å¤§å¤šæ•°å†™å…³æ³¨å’Œæ—¥å¿—è®°å½•</span></span><br><span class=\"line\">  settings: &#123;                                         <span class=\"comment\"># å¤åˆ¶é›†çš„å…¨å±€è®¾ç½®ï¼ŒåŒ…å«ä»¥ä¸‹å±æ€§ï¼š</span></span><br><span class=\"line\">    chainingAllowed: <span class=\"literal\">true</span>,                            <span class=\"comment\"># æ˜¯å¦å…è®¸ä»å…¶ä»–æˆå‘˜è¯»å–æ•°æ®ã€‚</span></span><br><span class=\"line\">    heartbeatIntervalMillis: 2000,                    <span class=\"comment\"># å¿ƒè·³é—´éš”ï¼Œå³æˆå‘˜ä¹‹é—´æ£€æµ‹çŠ¶æ€çš„æ—¶é—´é—´éš”ã€‚</span></span><br><span class=\"line\">    heartbeatTimeoutSecs: 10,                         <span class=\"comment\"># å¿ƒè·³è¶…æ—¶æ—¶é—´ï¼Œå¦‚æœåœ¨æ­¤æ—¶é—´å†…æœªæ”¶åˆ°å¿ƒè·³ï¼Œåˆ™è®¤ä¸ºæˆå‘˜ä¸å¯ç”¨ã€‚</span></span><br><span class=\"line\">    electionTimeoutMillis: 10000,                     <span class=\"comment\"># é€‰ä¸¾è¶…æ—¶æ—¶é—´ï¼Œå³è¿›è¡Œé€‰ä¸¾çš„æ—¶é—´é—´éš”ã€‚</span></span><br><span class=\"line\">    catchUpTimeoutMillis: -1,                         <span class=\"comment\"># æˆå‘˜åœ¨è¿½èµ¶æ“ä½œæ—¶çš„è¶…æ—¶æ—¶é—´ã€‚</span></span><br><span class=\"line\">    catchUpTakeoverDelayMillis: 30000,                <span class=\"comment\"># åœ¨è¿½èµ¶æ“ä½œæœŸé—´ï¼Œå‘ç”Ÿä¸»èŠ‚ç‚¹æ•…éšœæ—¶ï¼Œå»¶è¿ŸèŠ‚ç‚¹æ¥ç®¡ä¸»èŠ‚ç‚¹ä¹‹å‰çš„å»¶è¿Ÿæ—¶é—´ã€‚</span></span><br><span class=\"line\">    getLastErrorModes: &#123;&#125;,                            <span class=\"comment\"># æŒ‡å®šå†™æ“ä½œçš„ç¡®è®¤æ¨¡å¼ã€‚</span></span><br><span class=\"line\">    getLastErrorDefaults: &#123; w: 1, wtimeout: 0 &#125;,      <span class=\"comment\"># æŒ‡å®šå†™æ“ä½œçš„é»˜è®¤ç¡®è®¤å‚æ•°ã€‚</span></span><br><span class=\"line\">    replicaSetId: ObjectId(<span class=\"string\">&#x27;660a20282e7a827807cac803&#x27;</span>) <span class=\"comment\"># å¤åˆ¶é›†çš„å”¯ä¸€æ ‡è¯†ç¬¦ã€‚</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">    â€¦â€¦â€¦â€¦â€¦â€¦</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¿®æ”¹èŠ‚ç‚¹ä¼˜å…ˆçº§</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å¿…é¡»åœ¨ä¸»èŠ‚ç‚¹æ‰§è¡Œ</span></span><br><span class=\"line\">cfg = rs.conf()</span><br><span class=\"line\"><span class=\"comment\"># ä¿å­˜æˆåŠŸåï¼Œç”±äºå½“å‰èŠ‚ç‚¹çš„ä¼˜å…ˆçº§æœ€é«˜ï¼Œæ‰€ä»¥é›†ç¾¤ä¼šå‘èµ·é‡æ–°é€‰ä¸¾å°†å½“å‰èŠ‚ç‚¹è®¾ç½®ä¸ºä¸»èŠ‚ç‚¹</span></span><br><span class=\"line\">cfg.members[2].priority = 10</span><br><span class=\"line\">rs.reconfig(cfg)</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è®¾ç½®éšè—èŠ‚ç‚¹</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å¿…é¡»åœ¨ä¸»èŠ‚ç‚¹æ‰§è¡Œ</span></span><br><span class=\"line\">cfg = rs.conf()</span><br><span class=\"line\">cfg.members[2].priority = 0</span><br><span class=\"line\">cfg.members[2].hidden = <span class=\"literal\">true</span></span><br><span class=\"line\">rs.reconfig(cfg)</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>é…ç½®å»¶æ—¶èŠ‚ç‚¹</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cfg = rs.conf()</span><br><span class=\"line\">cfg.members[2].priority = 0</span><br><span class=\"line\">cfg.members[2].hidden = <span class=\"literal\">true</span></span><br><span class=\"line\"><span class=\"comment\">#å»¶è¿Ÿ60ç§’</span></span><br><span class=\"line\">cfg.members[2].secondaryDelaySecs = 60</span><br><span class=\"line\">rs.reconfig(cfg)</span><br></pre></td></tr></table></figure>\n<h2 id=\"è¯»å…³æ³¨-readConcern\">è¯»å…³æ³¨(readConcern)</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åœ¨ <code>readPreference</code> é€‰æ‹©äº†æŒ‡å®šçš„èŠ‚ç‚¹åï¼Œ<code>readConcern</code> å†³å®šè¿™ä¸ªèŠ‚ç‚¹ä¸Šçš„æ•°æ®å“ªäº›æ˜¯å¯è¯»çš„</p>\n</li>\n<li class=\"lvl-2\">\n<p>ç±»ä¼¼äºå…³ç³»æ•°æ®åº“çš„éš”ç¦»çº§åˆ«ï¼Œå¯é€‰å€¼åŒ…æ‹¬ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- availableï¼šè¯»å–æ‰€æœ‰å¯ç”¨çš„æ•°æ®;</span><br><span class=\"line\">- <span class=\"built_in\">local</span>ï¼šè¯»å–æ‰€æœ‰å¯ç”¨ä¸”å±äºå½“å‰åˆ†ç‰‡çš„æ•°æ®ã€‚åœ¨å¤åˆ¶é›†ä¸­ <span class=\"built_in\">local</span> å’Œ available æ˜¯æ²¡æœ‰åŒºåˆ«çš„ï¼Œä¸¤è€…ä»…åœ¨åˆ†ç‰‡é›†ç¾¤ä¸­æ‰æœ‰åŒºåˆ«;</span><br><span class=\"line\">- majorityï¼šè¯»å–åœ¨å¤§å¤šæ•°èŠ‚ç‚¹ä¸Šæäº¤å®Œæˆçš„æ•°æ®;</span><br><span class=\"line\">- linearizableï¼šå¯çº¿æ€§åŒ–è¯»å–æ–‡æ¡£ï¼Œä»…æ”¯æŒä»ä¸»èŠ‚ç‚¹è¯»ã€‚åªè¯»å–å¤§å¤šæ•°èŠ‚ç‚¹ç¡®è®¤è¿‡çš„æ•°æ®ã€‚å’Œ majority æœ€å¤§å·®åˆ«æ˜¯ä¿è¯ç»å¯¹çš„æ“ä½œçº¿æ€§é¡ºåº;</span><br><span class=\"line\">- snapshotï¼šè¯»å–æœ€è¿‘å¿«ç…§ä¸­çš„æ•°æ®ï¼Œä»…å¯ç”¨äºå¤šæ–‡æ¡£äº‹åŠ¡ï¼Œéš”ç¦»çº§åˆ«æœ€é«˜;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¸»èŠ‚ç‚¹è¯»å–æ•°æ®æ—¶é»˜è®¤ <code>readConcern</code> æ˜¯ <code>local</code>ï¼Œä»èŠ‚ç‚¹è¯»å–æ•°æ®æ—¶é»˜è®¤ <code>readConcern</code> æ˜¯ <code>available</code></p>\n</li>\n</ul>\n<div class=\"tips\">\n<p><em><strong>åˆ†ç‰‡é›†ç¾¤ä¸­ local å’Œ available çš„åŒºåˆ«</strong></em></p>\n<ul class=\"lvl-1\">\n<li class=\"lvl-2\">å¦‚æœä¸€ä¸ª chunk x æ­£åœ¨ä» shard1 å‘ shard2 è¿ç§»ï¼›</li>\n<li class=\"lvl-2\">æ•´ä¸ªè¿ç§»è¿‡ç¨‹ä¸­ chunk x ä¸­çš„éƒ¨åˆ†æ•°æ®ä¼šåœ¨ shard1 å’Œ shard2 ä¸­åŒæ—¶å­˜åœ¨ï¼Œä½†æºåˆ†ç‰‡ shard1ä»ç„¶æ˜¯chunk x çš„è´Ÿè´£æ–¹ï¼š\n<ul class=\"lvl-3\">\n<li class=\"lvl-4\">æ‰€æœ‰å¯¹ chunk x çš„è¯»å†™æ“ä½œä»ç„¶è¿›å…¥ shard1ï¼›</li>\n<li class=\"lvl-4\">config ä¸­è®°å½•çš„ä¿¡æ¯ chunk x ä»ç„¶å±äº shard1ï¼›</li>\n</ul>\n</li>\n<li class=\"lvl-2\">æ­¤æ—¶å¦‚æœè¯» shard2ï¼Œåˆ™ä¼šä½“ç°å‡º local å’Œ available çš„åŒºåˆ«ï¼š\n<ul class=\"lvl-3\">\n<li class=\"lvl-4\">localï¼šåªå–åº”è¯¥ç”± shard2 è´Ÿè´£çš„æ•°æ®ï¼ˆä¸åŒ…æ‹¬ xï¼‰ï¼›</li>\n<li class=\"lvl-4\">availableï¼šshard2 ä¸Šæœ‰ä»€ä¹ˆå°±è¯»ä»€ä¹ˆï¼ˆåŒ…æ‹¬ xï¼‰ï¼›</li>\n</ul>\n</li>\n</ul>\n</div>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç¤ºä¾‹</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">db.user.find().readConcern(<span class=\"string\">&#x27;local&#x27;</span>)</span><br><span class=\"line\">db.user.find().readConcern(<span class=\"string\">&#x27;majority&#x27;</span>)</span><br><span class=\"line\"><span class=\"comment\"># è¯»å–ä»èŠ‚ç‚¹ä¸Šå·²ç»è¢«å¤§å¤šæ•°èŠ‚ç‚¹æäº¤å®Œæˆçš„æ•°æ®</span></span><br><span class=\"line\">db.user.find().readPref(<span class=\"string\">&quot;secondary&quot;</span>).readConcern(<span class=\"string\">&quot;majority&quot;</span>)</span><br></pre></td></tr></table></figure>\n<h2 id=\"å†™å…³æ³¨-writeConcern\">å†™å…³æ³¨(writeConcern)</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><code>writeConcern</code> å†³å®šä¸€ä¸ªå†™æ“ä½œè½åˆ°å¤šå°‘ä¸ªèŠ‚ç‚¹ä¸Šæ‰ç®—æˆåŠŸã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>MongoDBæ”¯æŒå®¢æˆ·ç«¯çµæ´»é…ç½®å†™å…¥ç­–ç•¥ï¼ˆwriteConcernï¼‰ï¼Œä»¥æ»¡è¶³ä¸åŒåœºæ™¯çš„éœ€æ±‚ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123; w: &lt;value&gt;, j: &lt;boolean&gt;, wtimeout: &lt;number&gt; &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">w: æ•°æ®å†™å…¥åˆ°numberä¸ªèŠ‚ç‚¹æ‰å‘ç”¨å®¢æˆ·ç«¯ç¡®è®¤</span><br><span class=\"line\">  - &#123;w: 0&#125; å¯¹å®¢æˆ·ç«¯çš„å†™å…¥ä¸éœ€è¦å‘é€ä»»ä½•ç¡®è®¤ï¼Œé€‚ç”¨äºæ€§èƒ½è¦æ±‚é«˜ï¼Œä½†ä¸å…³æ³¨æ­£ç¡®æ€§çš„åœºæ™¯</span><br><span class=\"line\">  - &#123;w: 1&#125; é»˜è®¤çš„writeConcernï¼Œæ•°æ®å†™å…¥åˆ°Primaryå°±å‘å®¢æˆ·ç«¯å‘é€ç¡®è®¤</span><br><span class=\"line\">  - &#123;w: <span class=\"string\">&quot;majority&quot;</span>&#125; æ•°æ®å†™å…¥åˆ°å‰¯æœ¬é›†å¤§å¤šæ•°æˆå‘˜åå‘å®¢æˆ·ç«¯å‘é€ç¡®è®¤ï¼Œé€‚ç”¨äºå¯¹æ•°æ®å®‰å…¨æ€§è¦æ±‚æ¯”è¾ƒé«˜çš„åœºæ™¯ï¼Œè¯¥é€‰é¡¹ä¼šé™ä½å†™å…¥æ€§èƒ½</span><br><span class=\"line\"></span><br><span class=\"line\">j: å†™å…¥æ“ä½œçš„journalæŒä¹…åŒ–åæ‰å‘å®¢æˆ·ç«¯ç¡®è®¤</span><br><span class=\"line\">  - é»˜è®¤ä¸º&#123;j: <span class=\"literal\">false</span>&#125;ï¼Œå¦‚æœè¦æ±‚Primaryå†™å…¥æŒä¹…åŒ–äº†æ‰å‘å®¢æˆ·ç«¯ç¡®è®¤ï¼Œåˆ™æŒ‡å®šè¯¥é€‰é¡¹ä¸º<span class=\"literal\">true</span></span><br><span class=\"line\"></span><br><span class=\"line\">wtimeout: å†™å…¥è¶…æ—¶æ—¶é—´ï¼Œä»…wçš„å€¼å¤§äº1æ—¶æœ‰æ•ˆã€‚</span><br><span class=\"line\">  - å½“æŒ‡å®š&#123;w: &#125;æ—¶ï¼Œæ•°æ®éœ€è¦æˆåŠŸå†™å…¥numberä¸ªèŠ‚ç‚¹æ‰ç®—æˆåŠŸï¼Œå¦‚æœå†™å…¥è¿‡ç¨‹ä¸­æœ‰èŠ‚ç‚¹æ•…éšœï¼Œå¯èƒ½å¯¼è‡´è¿™ä¸ªæ¡ä»¶ä¸€ç›´ä¸èƒ½æ»¡è¶³ï¼Œä»è€Œä¸€ç›´ä¸èƒ½å‘å®¢æˆ·ç«¯å‘é€ç¡®è®¤ç»“æœï¼Œé’ˆå¯¹è¿™ç§æƒ…å†µï¼Œå®¢æˆ·ç«¯å¯è®¾ç½®wtimeouté€‰é¡¹æ¥æŒ‡å®šè¶…æ—¶æ—¶é—´ï¼Œå½“å†™å…¥è¿‡ç¨‹æŒç»­è¶…è¿‡è¯¥æ—¶é—´ä»æœªç»“æŸï¼Œåˆ™è®¤ä¸ºå†™å…¥å¤±è´¥ã€‚</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>é€šå¸¸é‡è¦æ•°æ®åº”ç”¨ <code>&#123;w: &quot;majority&quot;&#125;</code>ï¼Œæ™®é€šæ•°æ®å¯ä»¥åº”ç”¨ <code>&#123;w: 1&#125;</code> ä»¥ç¡®ä¿æœ€ä½³æ€§èƒ½ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ç¤ºä¾‹</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ç­‰ç­‰å¤§å¤šæ•°èŠ‚ç‚¹å†™å…¥æˆåŠŸ</span></span><br><span class=\"line\">db.user.insertOne(&#123;name:<span class=\"string\">&quot;æå››&quot;</span>&#125;,&#123;writeConcern:&#123;w:<span class=\"string\">&quot;majority&quot;</span>&#125;&#125;)</span><br><span class=\"line\"><span class=\"comment\"># ç­‰å¾…3ä¸ªèŠ‚ç‚¹å†™å…¥æˆåŠŸï¼Œè‹¥è¶…æ—¶åˆ™å†™å…¥å¤±è´¥</span></span><br><span class=\"line\">db.user.insertOne(&#123;name:<span class=\"string\">&quot;å°æ˜&quot;</span>&#125;,&#123;writeConcern:&#123;w:3,wtimeout:3000&#125;&#125;)</span><br></pre></td></tr></table></figure>\n<h2 id=\"ä¼˜é›…çš„é‡å¯å¤åˆ¶é›†\">ä¼˜é›…çš„é‡å¯å¤åˆ¶é›†</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>é€ä¸ªé‡å¯å¤åˆ¶é›†é‡Œæ‰€æœ‰çš„SecondaryèŠ‚ç‚¹</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å…³é—­æœåŠ¡</span></span><br><span class=\"line\">mongod --shutdown -f /mongodb/mongo.conf</span><br><span class=\"line\"><span class=\"comment\"># é‡å¯å¯åŠ¨</span></span><br><span class=\"line\">mongod -f /mongodb/mongo.conf</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¯¹Primaryå‘é€rs.stepDown()å‘½ä»¤ï¼Œç­‰å¾…primaryé™çº§ä¸ºSecondary</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rs0 [primary] <span class=\"built_in\">local</span>&gt; rs.<span class=\"function\"><span class=\"title\">stepDown</span></span>()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  ok: 1,</span><br><span class=\"line\">  <span class=\"string\">&#x27;$clusterTime&#x27;</span>: &#123;</span><br><span class=\"line\">    clusterTime: Timestamp(&#123; t: 1712046433, i: 1 &#125;),</span><br><span class=\"line\">    signature: &#123;</span><br><span class=\"line\">      <span class=\"built_in\">hash</span>: Binary.createFromBase64(<span class=\"string\">&#x27;dklQyCuunlYhWYkKuNtiNcGNom8=&#x27;</span>, 0),</span><br><span class=\"line\">      keyId: Long(<span class=\"string\">&#x27;7352724745051176965&#x27;</span>)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  operationTime: Timestamp(&#123; t: 1712046433, i: 1 &#125;)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>é‡å¯é™çº§åçš„Primary</p>\n</li>\n</ul>\n<h2 id=\"oplog\">oplog</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åœ¨å¤åˆ¶é›†æ¶æ„ä¸­ï¼Œä¸»èŠ‚ç‚¹ä¸å¤‡èŠ‚ç‚¹ä¹‹é—´æ˜¯é€šè¿‡oplogæ¥åŒæ­¥æ•°æ®çš„ï¼Œè¿™é‡Œçš„oplogæ˜¯ä¸€ä¸ªç‰¹æ®Šçš„å›ºå®šé›†åˆï¼Œå½“ä¸»èŠ‚ç‚¹ä¸Šçš„ä¸€ä¸ªå†™æ“ä½œå®Œæˆåï¼Œä¼šå‘oplogé›†åˆå†™å…¥ä¸€æ¡å¯¹åº”çš„æ—¥å¿—ï¼Œè€Œå¤‡èŠ‚ç‚¹åˆ™é€šè¿‡è¿™ä¸ªoplogä¸æ–­æ‹‰å–åˆ°æ–°çš„æ—¥å¿—ï¼Œåœ¨æœ¬åœ°è¿›è¡Œå›æ”¾ä»¥è¾¾åˆ°æ•°æ®åŒæ­¥çš„ç›®çš„ã€‚<br>\n<img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/d2K4tD.png\" alt=\"\"></p>\n</li>\n<li class=\"lvl-2\">\n<p>æŸ¥è¯¢oplog</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">use <span class=\"built_in\">local</span></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥è¯¢æœ€è¿‘10æ¡oplogï¼Œè¿™é‡Œ $natural:-1 æ˜¯æŒ‰ç…§æ—¶é—´é™åºæ’åˆ—</span></span><br><span class=\"line\">db.oplog.rs.find().<span class=\"built_in\">sort</span>(&#123;<span class=\"variable\">$natural</span>:-1&#125;).<span class=\"built_in\">limit</span>(10)</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥è¯¢æœ€è¿‘60åˆ†é’Ÿoplog</span></span><br><span class=\"line\">db.oplog.rs.find(&#123;</span><br><span class=\"line\">  <span class=\"string\">&quot;ts&quot;</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;<span class=\"variable\">$gt</span>&quot;</span>: Timestamp(Math.floor(new Date().getTime() / 1000) - 60*60, 1)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;).<span class=\"built_in\">sort</span>(&#123;</span><br><span class=\"line\">  <span class=\"string\">&quot;<span class=\"variable\">$natural</span>&quot;</span>: -1</span><br><span class=\"line\">&#125;).<span class=\"built_in\">limit</span>(10)</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">    op: <span class=\"string\">&#x27;u&#x27;</span>,</span><br><span class=\"line\">    ns: <span class=\"string\">&#x27;config.system.sessions&#x27;</span>,</span><br><span class=\"line\">    ui: UUID(<span class=\"string\">&#x27;4f90005d-a546-4d59-971d-7954c3acd0f8&#x27;</span>),</span><br><span class=\"line\">    o: &#123;</span><br><span class=\"line\">      <span class=\"string\">&#x27;$v&#x27;</span>: 2,</span><br><span class=\"line\">      diff: &#123; u: &#123; lastUse: ISODate(<span class=\"string\">&#x27;2024-04-02T08:31:10.148Z&#x27;</span>) &#125; &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    o2: &#123;</span><br><span class=\"line\">      _id: &#123;</span><br><span class=\"line\">        <span class=\"built_in\">id</span>: UUID(<span class=\"string\">&#x27;3f881052-ac21-4677-816c-33934322fbd6&#x27;</span>),</span><br><span class=\"line\">        uid: Binary.createFromBase64(<span class=\"string\">&#x27;eOZyqfHfiVpfviPDWgAERmzNFnUp8UBdlWKN50Fv9fo=&#x27;</span>, 0)</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    ts: Timestamp(&#123; t: 1712046670, i: 1 &#125;),</span><br><span class=\"line\">    t: Long(<span class=\"string\">&#x27;6&#x27;</span>),</span><br><span class=\"line\">    v: Long(<span class=\"string\">&#x27;2&#x27;</span>),</span><br><span class=\"line\">    wall: ISODate(<span class=\"string\">&#x27;2024-04-02T08:31:10.148Z&#x27;</span>)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">tsï¼š æ“ä½œæ—¶é—´ï¼Œå½“å‰timestamp + è®¡æ•°å™¨ï¼Œè®¡æ•°å™¨æ¯ç§’éƒ½è¢«é‡ç½®</span><br><span class=\"line\">vï¼šoplogç‰ˆæœ¬ä¿¡æ¯</span><br><span class=\"line\">opï¼šæ“ä½œç±»å‹:</span><br><span class=\"line\">    iï¼šæ’â¼Šæ“ä½œ</span><br><span class=\"line\">    uï¼šæ›´æ–°æ“ä½œ</span><br><span class=\"line\">    dï¼šåˆ é™¤æ“ä½œ</span><br><span class=\"line\">    cï¼šæ‰§è¡Œå‘½ä»¤ï¼ˆå¦‚createDatabaseï¼ŒdropDatabaseï¼‰</span><br><span class=\"line\">    nï¼šç©ºæ“ä½œï¼Œç‰¹æ®Šç”¨é€”</span><br><span class=\"line\">nsï¼šæ“ä½œé’ˆå¯¹çš„é›†åˆ</span><br><span class=\"line\">oï¼šæ“ä½œå†…å®¹</span><br><span class=\"line\">o2ï¼šæ“ä½œæŸ¥è¯¢æ¡ä»¶ï¼Œä»…updateæ“ä½œåŒ…å«è¯¥å­—æ®µ</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>oplogé›†åˆçš„å¤§å°é»˜è®¤ä¸º<code>min(ç£ç›˜å¯ç”¨ç©ºé—´*5%ï¼Œ50GB)</code>ï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤ä¿®æ”¹</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å°†å¤åˆ¶é›†æˆå‘˜çš„oplogå¤§å°ä¿®æ”¹ä¸º1Gï¼Œè¿™é‡Œå•ä½æ˜¯M</span></span><br><span class=\"line\">&gt; db.adminCommand(&#123;replSetResizeOplog: 1, size: 1024&#125;)</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹oplogå¤§å°</span></span><br><span class=\"line\">&gt; use <span class=\"built_in\">local</span></span><br><span class=\"line\">&gt; db.oplog.rs.stats().maxSize/1024/1024</span><br><span class=\"line\">1024</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¿™é‡Œè¦æ³¨æ„æ¯ä¸ªèŠ‚ç‚¹çš„oplogå¤§å°éƒ½éœ€è¦å•ç‹¬çš„é…ç½®ï¼Œå¹¶ä¸”å¿…é¡»ä¸€è‡´ï¼Œå¦åˆ™æœ‰å¯èƒ½ä¼šå‡ºç°åŒæ­¥å¤±è´¥çš„æƒ…å†µã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>æŸ¥çœ‹å½“å‰èŠ‚ç‚¹çš„oplogçš„çŠ¶æ€</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rs0 [primary] <span class=\"built_in\">test</span>&gt; rs.printReplicationInfo()</span><br><span class=\"line\">actual oplog size</span><br><span class=\"line\"><span class=\"string\">&#x27;1024 MB&#x27;</span></span><br><span class=\"line\">---</span><br><span class=\"line\">configured oplog size</span><br><span class=\"line\"><span class=\"string\">&#x27;1024 MB&#x27;</span></span><br><span class=\"line\">---</span><br><span class=\"line\"><span class=\"built_in\">log</span> length start to end</span><br><span class=\"line\"><span class=\"string\">&#x27;112923 secs (31.37 hrs)&#x27;</span></span><br><span class=\"line\">---</span><br><span class=\"line\">oplog first event time</span><br><span class=\"line\"><span class=\"string\">&#x27;Mon Apr 01 2024 02:47:04 GMT+0000 (Coordinated Universal Time)&#x27;</span></span><br><span class=\"line\">---</span><br><span class=\"line\">oplog last event time</span><br><span class=\"line\"><span class=\"string\">&#x27;Tue Apr 02 2024 10:09:07 GMT+0000 (Coordinated Universal Time)&#x27;</span></span><br><span class=\"line\">---</span><br><span class=\"line\">now</span><br><span class=\"line\"><span class=\"string\">&#x27;Tue Apr 02 2024 10:09:08 GMT+0000 (Coordinated Universal Time)&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">actual oplog sizeï¼šè¡¨ç¤ºå®é™…ä½¿ç”¨çš„ oplog å¤§å°ã€‚Oplog æ˜¯ä¸€ä¸ª circurlar bufferï¼Œç”¨äºå­˜å‚¨ä¸»èŠ‚ç‚¹ä¸Šçš„æ“ä½œæ—¥å¿—ã€‚è¿™ä¸ªå±æ€§æŒ‡ç¤ºäº† oplog çš„å½“å‰å¤§å°ã€‚åœ¨ç¤ºä¾‹ä¸­ï¼Œoplog å¤§å°ä¸º <span class=\"string\">&#x27;1024 MB&#x27;</span>ã€‚</span><br><span class=\"line\"></span><br><span class=\"line\">configured oplog sizeï¼šè¡¨ç¤ºé…ç½®çš„ oplog å¤§å°ã€‚è¿™æ˜¯åœ¨é…ç½®å¤åˆ¶é›†æ—¶æŒ‡å®šçš„ oplog å¤§å°ã€‚åœ¨ç¤ºä¾‹ä¸­ï¼Œé…ç½®çš„ oplog å¤§å°ä¹Ÿæ˜¯ <span class=\"string\">&#x27;1024 MB&#x27;</span>ï¼Œè¯´æ˜å®é™… oplog å¤§å°ä¸é…ç½®çš„ oplog å¤§å°ç›¸åŒ¹é…ã€‚</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">log</span> length start to endï¼šè¡¨ç¤º oplog çš„è®°å½•é•¿åº¦ï¼Œä»å¼€å§‹åˆ°ç»“æŸçš„æ—¶é—´è·¨åº¦ã€‚åœ¨ç¤ºä¾‹ä¸­ï¼Œoplog è®°å½•äº† <span class=\"string\">&#x27;112923 secs (31.37 hrs)&#x27;</span>ï¼Œè¡¨ç¤ºä» oplog å¼€å§‹è®°å½•åˆ°ç»“æŸçš„æ—¶é—´è·¨åº¦ä¸ºçº¦ 31.37 å°æ—¶ã€‚</span><br><span class=\"line\"></span><br><span class=\"line\">oplog first event timeï¼šè¡¨ç¤º oplog è®°å½•çš„ç¬¬ä¸€ä¸ªäº‹ä»¶çš„æ—¶é—´æˆ³ã€‚åœ¨ç¤ºä¾‹ä¸­ï¼Œç¬¬ä¸€ä¸ªäº‹ä»¶çš„æ—¶é—´ä¸º <span class=\"string\">&#x27;Mon Apr 01 2024 02:47:04 GMT+0000 (Coordinated Universal Time)&#x27;</span>ã€‚</span><br><span class=\"line\"></span><br><span class=\"line\">oplog last event timeï¼šè¡¨ç¤º oplog è®°å½•çš„æœ€åä¸€ä¸ªäº‹ä»¶çš„æ—¶é—´æˆ³ã€‚åœ¨ç¤ºä¾‹ä¸­ï¼Œæœ€åä¸€ä¸ªäº‹ä»¶çš„æ—¶é—´ä¸º <span class=\"string\">&#x27;Tue Apr 02 2024 10:09:07 GMT+0000 (Coordinated Universal Time)&#x27;</span>ã€‚</span><br><span class=\"line\"></span><br><span class=\"line\">nowï¼šè¡¨ç¤ºå½“å‰æ—¶é—´ã€‚åœ¨ç¤ºä¾‹ä¸­ï¼Œå½“å‰æ—¶é—´ä¸º <span class=\"string\">&#x27;Tue Apr 02 2024 10:09:08 GMT+0000 (Coordinated Universal Time)&#x27;</span>ã€‚</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä»¥ä»èŠ‚ç‚¹è§†è§’æŸ¥çœ‹oplogå¤åˆ¶çŠ¶æ€</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rs0 [primary] <span class=\"built_in\">local</span>&gt; rs.printSecondaryReplicationInfo()</span><br><span class=\"line\"><span class=\"built_in\">source</span>: 10.1.2.142:27017</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  syncedTo: <span class=\"string\">&#x27;Tue Apr 02 2024 10:10:07 GMT+0000 (Coordinated Universal Time)&#x27;</span>,</span><br><span class=\"line\">  replLag: <span class=\"string\">&#x27;0 secs (0 hrs) behind the primary &#x27;</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\">---</span><br><span class=\"line\"><span class=\"built_in\">source</span>: 10.1.2.41:27017</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  syncedTo: <span class=\"string\">&#x27;Tue Apr 02 2024 10:10:07 GMT+0000 (Coordinated Universal Time)&#x27;</span>,</span><br><span class=\"line\">  replLag: <span class=\"string\">&#x27;0 secs (0 hrs) behind the primary &#x27;</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">source</span>ï¼šä»èŠ‚ç‚¹çš„ä¸»æœºåå’Œç«¯å£å·ï¼Œå³å¤åˆ¶æ•°æ®çš„æ¥æºèŠ‚ç‚¹ã€‚</span><br><span class=\"line\"></span><br><span class=\"line\">syncedToï¼šè¡¨ç¤ºä»èŠ‚ç‚¹å·²ç»å¤åˆ¶åˆ°çš„æœ€æ–°æ“ä½œçš„æ—¶é—´æˆ³ã€‚å®ƒæŒ‡ç¤ºäº†ä»èŠ‚ç‚¹ä¸Šæ•°æ®çš„åŒæ­¥ç¨‹åº¦ï¼Œå³ä»èŠ‚ç‚¹å·²ç»å¤åˆ¶äº†åˆ°ä¸»èŠ‚ç‚¹çš„å“ªä¸ªæ—¶é—´ç‚¹çš„æ•°æ®ã€‚åœ¨ç¤ºä¾‹ä¸­ï¼Œä¸¤ä¸ªä»èŠ‚ç‚¹çš„ syncedTo æ—¶é—´æˆ³éƒ½æ˜¯ <span class=\"string\">&#x27;Tue Apr 02 2024 10:10:07 GMT+0000 (Coordinated Universal Time)&#x27;</span>ï¼Œè¡¨ç¤ºå®ƒä»¬éƒ½å·²ç»ä¸ä¸»èŠ‚ç‚¹åŒæ­¥åˆ°äº†ç›¸åŒçš„æ—¶é—´ç‚¹ã€‚</span><br><span class=\"line\"></span><br><span class=\"line\">replLagï¼šè¡¨ç¤ºä»èŠ‚ç‚¹ä¸ä¸»èŠ‚ç‚¹ä¹‹é—´çš„å¤åˆ¶å»¶è¿Ÿã€‚å®ƒæ˜¾ç¤ºäº†ä»èŠ‚ç‚¹å½“å‰è½åäºä¸»èŠ‚ç‚¹çš„æ—¶é—´é‡ï¼Œä»¥ç§’å’Œå°æ—¶ä¸ºå•ä½ã€‚åœ¨ç¤ºä¾‹ä¸­ï¼Œä¸¤ä¸ªä»èŠ‚ç‚¹çš„ replLag éƒ½æ˜¯ <span class=\"string\">&#x27;0 secs (0 hrs) behind the primary&#x27;</span>ï¼Œè¡¨ç¤ºå®ƒä»¬ä¸ä¸»èŠ‚ç‚¹ä¿æŒå®æ—¶åŒæ­¥ï¼Œæ²¡æœ‰ä»»ä½•å¤åˆ¶å»¶è¿Ÿã€‚</span><br></pre></td></tr></table></figure>\n<h2 id=\"æ—¢ç„¶oplogçš„å¤§å°æœ‰é™åˆ¶ï¼Œæ–°çš„æ•°æ®ä¼šè¦†ç›–æ—§çš„æ•°æ®ï¼Œé‚£ä¹ˆæ–°åŠ å…¥çš„èŠ‚ç‚¹å¦‚ä½•å…¨é‡åŒæ­¥æ•°æ®å‘¢ï¼Ÿ\">æ—¢ç„¶oplogçš„å¤§å°æœ‰é™åˆ¶ï¼Œæ–°çš„æ•°æ®ä¼šè¦†ç›–æ—§çš„æ•°æ®ï¼Œé‚£ä¹ˆæ–°åŠ å…¥çš„èŠ‚ç‚¹å¦‚ä½•å…¨é‡åŒæ­¥æ•°æ®å‘¢ï¼Ÿ</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å½“MongoDBçš„ä»åº“èŠ‚ç‚¹éœ€è¦è¿›è¡Œæ•°æ®åŒæ­¥æ—¶ï¼Œä¼šæ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼š</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">åˆå§‹åŒæ­¥ï¼š å½“ä¸€ä¸ªæ–°èŠ‚ç‚¹åŠ å…¥åˆ°å‰¯æœ¬é›†ä¸­æ—¶ï¼Œå®ƒä¼šæ‰§è¡Œåˆå§‹åŒæ­¥ä»¥è·å–é›†åˆä¸­çš„æ‰€æœ‰æ•°æ®ã€‚åˆå§‹åŒæ­¥ä¼šå¤åˆ¶æ‰€æœ‰æ•°æ®åº“çš„æ‰€æœ‰æ•°æ®ï¼ŒåŒ…æ‹¬ç³»ç»Ÿæ•°æ®åº“ã€‚ä¹‹åï¼Œæ–°èŠ‚ç‚¹ä¼šå¼€å§‹ä»oplogé‡Œè·å–æ›´æ”¹å†å²ï¼Œåº”ç”¨è¿™äº›æ›´æ”¹å†å²åˆ°æ•°æ®ï¼Œä»¥ä¿è¯ä¸å…¶ä»–ä»åº“èŠ‚ç‚¹ä¸€è‡´ã€‚æ³¨æ„ï¼Œåˆå§‹åŒæ­¥ä¸­çš„æ•°æ®åŒ…æ‹¬åœ¨æ–°åŠ å…¥èŠ‚ç‚¹ä¹‹å‰çš„æ•°æ®ä»¥åŠæ–°èŠ‚ç‚¹åŠ å…¥ä¹‹åå…¶ä»–èŠ‚ç‚¹äº§ç”Ÿçš„æ–°æ•°æ®ã€‚</li>\n<li class=\"lvl-4\">oplogè½åï¼š å¦‚æœä»åº“åœ¨åˆå§‹åŒæ­¥æ‰§è¡ŒæœŸé—´ä¸èƒ½åŠæ—¶è·å–oplogï¼ˆä¾‹å¦‚ï¼Œoplogçš„æ•°æ®è¶…å‡ºäº†å¤§å°é™åˆ¶å¹¶è¢«è¦†ç›–ï¼Œæˆ–è€…åˆæ¬¡åŒæ­¥æ—¶é—´è¿‡é•¿ï¼‰ï¼Œæ–°èŠ‚ç‚¹éœ€è¦é‡æ–°è¿›è¡Œåˆå§‹åŒæ­¥æ“ä½œã€‚</li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<p>è¿™äº›æ­¥éª¤ç¡®ä¿äº†MongoDBå‰¯æœ¬é›†çš„æ•°æ®åœ¨æ‰€æœ‰èŠ‚ç‚¹é—´çš„ä¸€è‡´æ€§ï¼Œå°½ç®¡oplogæœ‰å¤§å°é™åˆ¶å¹¶ä¸”æ—§çš„å†…å®¹ä¼šè¢«æ–°çš„æ“ä½œè¦†ç›–ã€‚</p>\n</li>\n</ul>\n<h2 id=\"å¤åˆ¶é›†ç›¸å…³æ“ä½œ\">å¤åˆ¶é›†ç›¸å…³æ“ä½œ</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><a href=\"https://www.mongodb.com/docs/manual/reference/method/js-replication/\">å®˜æ–¹æ–‡æ¡£</a></p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>å‘½ä»¤</th>\n<th>æè¿°</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>rs.add(â€œhostname:portâ€)</td>\n<td>ä¸ºå¤åˆ¶é›†æ–°å¢èŠ‚ç‚¹</td>\n</tr>\n<tr>\n<td>rs.addArb(â€œhostname:portâ€)</td>\n<td>ä¸ºå¤åˆ¶é›†æ–°å¢ä¸€ä¸ª arbiters</td>\n</tr>\n<tr>\n<td>rs.conf()</td>\n<td>è¿”å›å¤åˆ¶é›†é…ç½®ä¿¡æ¯</td>\n</tr>\n<tr>\n<td>rs.config()</td>\n<td>åŒ rs.conf()</td>\n</tr>\n<tr>\n<td>rs.freeze(3600)</td>\n<td>é˜²æ­¢å½“å‰èŠ‚ç‚¹åœ¨ä¸€æ®µæ—¶é—´å†…é€‰ä¸¾æˆä¸ºä¸»èŠ‚ç‚¹ï¼Œå¦‚è¿™é‡Œæ˜¯3600ç§’ï¼Œåˆ™å½“å‰èŠ‚ç‚¹åœ¨3600ç§’å†…ä¸ä¼šé€‰ä¸¾æˆä¸ºä¸»èŠ‚ç‚¹</td>\n</tr>\n<tr>\n<td>rs.help()</td>\n<td>è¿”å› replica set çš„å‘½ä»¤å¸®åŠ©</td>\n</tr>\n<tr>\n<td>rs.initiate()</td>\n<td>åˆå§‹åŒ–ä¸€ä¸ªæ–°çš„å¤åˆ¶é›†</td>\n</tr>\n<tr>\n<td>rs.printReplicationInfo()</td>\n<td>ä»¥å½“å‰èŠ‚ç‚¹çš„è§†è§’è¿”å›å¤åˆ¶çš„çŠ¶æ€æŠ¥å‘Š</td>\n</tr>\n<tr>\n<td>rs.printSecondaryReplicationInfo()</td>\n<td>ä»¥ä»èŠ‚ç‚¹çš„è§†è§’è¿”å›å¤åˆ¶çŠ¶æ€æŠ¥å‘Š</td>\n</tr>\n<tr>\n<td>rs.reconfig()</td>\n<td>é€šè¿‡é‡æ–°åº”ç”¨å¤åˆ¶é›†é…ç½®æ¥ä¸ºå¤åˆ¶é›†æ›´æ–°é…ç½®</td>\n</tr>\n<tr>\n<td>rs.remove(â€œhostname:portâ€)</td>\n<td>ä»å¤åˆ¶é›†ä¸­ç§»é™¤ä¸€ä¸ªèŠ‚ç‚¹</td>\n</tr>\n<tr>\n<td>rs.secondaryOk()</td>\n<td>ä¸ºå½“å‰çš„è¿æ¥è®¾ç½®ä»èŠ‚ç‚¹å¯è¯»ï¼Œè¯¥æ–¹æ³•å·²ç»è¿‡æ—¶äº†ï¼Œä½¿ç”¨ db.getMongo().setReadPref() ä»£æ›¿</td>\n</tr>\n<tr>\n<td>rs.status()</td>\n<td>è¿”å›å¤åˆ¶é›†çŠ¶æ€ä¿¡æ¯</td>\n</tr>\n<tr>\n<td>rs.stepDown()</td>\n<td>è®©å½“å‰çš„ primary å˜ä¸ºä»èŠ‚ç‚¹å¹¶è§¦å‘æ–°ä¸€è½®çš„ä¸»èŠ‚ç‚¹é€‰ä¸¾</td>\n</tr>\n<tr>\n<td>rs.syncFrom(â€œhostname:portâ€)</td>\n<td>è®¾ç½®å¤åˆ¶é›†èŠ‚ç‚¹ä»å“ªä¸ªèŠ‚ç‚¹å¤„åŒæ­¥æ•°æ®ï¼Œå°†ä¼šè¦†ç›–é»˜è®¤é€‰å–é€»è¾‘</td>\n</tr>\n<tr>\n<td>rs.reconfigForPSASet()</td>\n<td>åœ¨ä¸»-ä»-ä»²è£å™¨ï¼ˆPSAï¼‰å‰¯æœ¬é›†æˆ–æ­£åœ¨æ›´æ”¹ä¸ºPSAæ¶æ„çš„å‰¯æœ¬é›†ä¸Šå®‰å…¨åœ°æ‰§è¡Œä¸€äº›é‡æ–°é…ç½®æ›´æ”¹ã€‚</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"ç§»é™¤èŠ‚ç‚¹\">ç§»é™¤èŠ‚ç‚¹</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rs0 [primary] <span class=\"built_in\">local</span>&gt; rs.remove(<span class=\"string\">&quot;10.1.2.41:27017&quot;</span>)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  ok: 1,</span><br><span class=\"line\">  <span class=\"string\">&#x27;$clusterTime&#x27;</span>: &#123;</span><br><span class=\"line\">    clusterTime: Timestamp(&#123; t: 1712049022, i: 1 &#125;),</span><br><span class=\"line\">    signature: &#123;</span><br><span class=\"line\">      <span class=\"built_in\">hash</span>: Binary.createFromBase64(<span class=\"string\">&#x27;Qg3Ymzp3k+hhzaDo3jZQimc4WCI=&#x27;</span>, 0),</span><br><span class=\"line\">      keyId: Long(<span class=\"string\">&#x27;7352724745051176965&#x27;</span>)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  operationTime: Timestamp(&#123; t: 1712049022, i: 1 &#125;)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"æ·»åŠ ä»²è£èŠ‚ç‚¹\">æ·»åŠ ä»²è£èŠ‚ç‚¹</h3>\n<p><em><strong>å½“é›†ç¾¤ä¸­çš„èŠ‚ç‚¹æ•°<code>&gt;=3</code>æ—¶ï¼Œæ— è®ºæ˜¯æ·»åŠ ä»²è£èŠ‚ç‚¹è¿˜æ˜¯ä»èŠ‚ç‚¹éƒ½æ²¡æœ‰é—®é¢˜ã€‚</strong></em></p>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¸Šé¢åˆ é™¤äº†é›†ç¾¤ä¸­çš„ä¸€ä¸ªèŠ‚ç‚¹ï¼Œæ­¤æ—¶é›†ç¾¤ä¸­çš„èŠ‚ç‚¹è¯´æ˜¯2(ä¸€ä¸»ä¸€ä»)ï¼Œæ­¤æ—¶å¦‚æœä¸»å‘ç”Ÿæ•…éšœé›†ç¾¤å°±æ²¡åŠæ³•å·¥ä½œäº†ï¼Œæ­¤æ—¶æˆ‘ä»¬å¯ä»¥ä¸ºå…¶æ·»åŠ ä¸€ä¸ªä»²è£èŠ‚ç‚¹(åªæŠ•ç¥¨ä¸å­˜å‚¨æ•°æ®)ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æ·»åŠ ä»²è£èŠ‚ç‚¹ï¼Œä½†æ˜¯æ­¤æ—¶æ·»åŠ ä»²è£èŠ‚ç‚¹ä¼šæŠ¥é”™</span></span><br><span class=\"line\">rs0 [primary] <span class=\"built_in\">local</span>&gt; rs.addArb(<span class=\"string\">&quot;10.1.2.41:27017&quot;</span>)</span><br><span class=\"line\">MongoServerError[NewReplicaSetConfigurationIncompatible]: Reconfig attempted to install a config that would change the implicit default write concern. Use the setDefaultRWConcern <span class=\"built_in\">command</span> to <span class=\"built_in\">set</span> a cluster-wide write concern and try the reconfig again.</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŠ¥é”™åŸå› ï¼šç”±äºé»˜è®¤çš„å†™å…³æ³¨ä¸º majorityï¼Œè€Œå½“å‰èŠ‚ç‚¹ä¸­åªæœ‰2ä¸ªèŠ‚ç‚¹ï¼Œæ²¡æœ‰åŠæ³•ç¡®è®¤â€œå¤§å¤šæ•°â€æ˜¯å¤šå°‘äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¿®æ”¹å†™å…³æ³¨çš„è®¾ç½®</span></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥è¯¢é»˜è®¤çš„è¯»å†™å…³æ³¨</span></span><br><span class=\"line\">rs0 [primary] admin&gt; db.adminCommand(&#123;<span class=\"string\">&quot;getDefaultRWConcern&quot;</span> : 1&#125;)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  defaultReadConcern: &#123; level: <span class=\"string\">&#x27;local&#x27;</span> &#125;,</span><br><span class=\"line\">  defaultWriteConcern: &#123; w: <span class=\"string\">&#x27;majority&#x27;</span>, wtimeout: 0 &#125;,</span><br><span class=\"line\">  updateOpTime: Timestamp(&#123; t: 1712050437, i: 1 &#125;),</span><br><span class=\"line\">  updateWallClockTime: ISODate(<span class=\"string\">&#x27;2024-04-02T09:15:04.462Z&#x27;</span>),</span><br><span class=\"line\">  defaultWriteConcernSource: <span class=\"string\">&#x27;global&#x27;</span>,</span><br><span class=\"line\">  defaultReadConcernSource: <span class=\"string\">&#x27;implicit&#x27;</span>,</span><br><span class=\"line\">  localUpdateWallClockTime: ISODate(<span class=\"string\">&#x27;2024-04-02T09:15:04.462Z&#x27;</span>),</span><br><span class=\"line\">  ok: 1,</span><br><span class=\"line\">  <span class=\"string\">&#x27;$clusterTime&#x27;</span>: &#123;</span><br><span class=\"line\">    clusterTime: Timestamp(&#123; t: 1712109448, i: 1 &#125;),</span><br><span class=\"line\">    signature: &#123;</span><br><span class=\"line\">      <span class=\"built_in\">hash</span>: Binary.createFromBase64(<span class=\"string\">&#x27;oUiR9xdXN4mzQqdz9IXHGdCmNto=&#x27;</span>, 0),</span><br><span class=\"line\">      keyId: Long(<span class=\"string\">&#x27;7352724745051176965&#x27;</span>)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  operationTime: Timestamp(&#123; t: 1712109448, i: 1 &#125;)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ä¿®æ”¹é»˜è®¤å†™å…³æ³¨ defaultWriteConcern</span></span><br><span class=\"line\"><span class=\"comment\"># setDefaultRWConcernï¼šç”¨äºæŒ‡å®šè®¾ç½®é»˜è®¤è¯»å†™å…³æ³¨çº§åˆ«ï¼ˆRW Concernï¼‰çš„æ“ä½œã€‚å€¼ä¸º 1 è¡¨ç¤ºæ‰§è¡Œè®¾ç½®æ“ä½œã€‚</span></span><br><span class=\"line\"><span class=\"comment\"># defaultWriteConcernï¼šç”¨äºæŒ‡å®šé»˜è®¤çš„å†™å…¥å…³æ³¨çº§åˆ«ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå†™å…¥å…³æ³¨çº§åˆ«è¢«è®¾ç½®ä¸º &#123; &quot;w&quot; : 2 &#125;ï¼Œæ„å‘³ç€åœ¨å†™å…¥æ•°æ®æ—¶ï¼ŒMongoDB é©±åŠ¨ç¨‹åºä¼šç­‰å¾…è‡³å°‘ä¸¤ä¸ªèŠ‚ç‚¹ç¡®è®¤å†™å…¥æˆåŠŸåæ‰è¿”å›æˆåŠŸã€‚å…¶å®è¿™é‡Œè®¾ç½®ä¸º1ä¹Ÿå¯ä»¥ï¼Œè¡¨ç¤ºå†™å…¥ä¸»èŠ‚ç‚¹å°±è¿”å›æˆåŠŸã€‚</span></span><br><span class=\"line\">rs0 [primary] <span class=\"built_in\">local</span>&gt; db.adminCommand( &#123;<span class=\"string\">&quot;setDefaultRWConcern&quot;</span> : 1, <span class=\"string\">&quot;defaultWriteConcern&quot;</span> : &#123; <span class=\"string\">&quot;w&quot;</span> : 2 &#125; &#125; )</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  defaultReadConcern: &#123; level: <span class=\"string\">&#x27;local&#x27;</span> &#125;,</span><br><span class=\"line\">  defaultWriteConcern: &#123; w: 2, wtimeout: 0 &#125;,</span><br><span class=\"line\">  updateOpTime: Timestamp(&#123; t: 1712049370, i: 1 &#125;),</span><br><span class=\"line\">  updateWallClockTime: ISODate(<span class=\"string\">&#x27;2024-04-02T09:16:22.715Z&#x27;</span>),</span><br><span class=\"line\">  defaultWriteConcernSource: <span class=\"string\">&#x27;global&#x27;</span>,</span><br><span class=\"line\">  defaultReadConcernSource: <span class=\"string\">&#x27;implicit&#x27;</span>,</span><br><span class=\"line\">  localUpdateWallClockTime: ISODate(<span class=\"string\">&#x27;2024-04-02T09:16:22.726Z&#x27;</span>),</span><br><span class=\"line\">  ok: 1,</span><br><span class=\"line\">  <span class=\"string\">&#x27;$clusterTime&#x27;</span>: &#123;</span><br><span class=\"line\">    clusterTime: Timestamp(&#123; t: 1712049382, i: 2 &#125;),</span><br><span class=\"line\">    signature: &#123;</span><br><span class=\"line\">      <span class=\"built_in\">hash</span>: Binary.createFromBase64(<span class=\"string\">&#x27;04nzjl47CMumvguEzUq7RnY55+s=&#x27;</span>, 0),</span><br><span class=\"line\">      keyId: Long(<span class=\"string\">&#x27;7352724745051176965&#x27;</span>)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  operationTime: Timestamp(&#123; t: 1712049382, i: 2 &#125;)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å†æ¬¡æ·»åŠ ä»²è£èŠ‚ç‚¹æˆåŠŸ</span></span><br><span class=\"line\">rs0 [primary] <span class=\"built_in\">local</span>&gt; rs.addArb(<span class=\"string\">&quot;10.1.2.41:27017&quot;</span>)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  ok: 1,</span><br><span class=\"line\">  <span class=\"string\">&#x27;$clusterTime&#x27;</span>: &#123;</span><br><span class=\"line\">    clusterTime: Timestamp(&#123; t: 1712049480, i: 1 &#125;),</span><br><span class=\"line\">    signature: &#123;</span><br><span class=\"line\">      <span class=\"built_in\">hash</span>: Binary.createFromBase64(<span class=\"string\">&#x27;4q9s6mvT0boa6Q+vjKms8vnTR6Y=&#x27;</span>, 0),</span><br><span class=\"line\">      keyId: Long(<span class=\"string\">&#x27;7352724745051176965&#x27;</span>)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  operationTime: Timestamp(&#123; t: 1712049480, i: 1 &#125;)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ­¤æ—¶å…³é—­ä¸»èŠ‚ç‚¹ï¼Œå°±ä¼šçœ‹åˆ°å¦ä¸€ä¸ªä»èŠ‚ç‚¹æˆä¸ºä¸»èŠ‚ç‚¹äº†</p>\n</li>\n</ul>\n<h3 id=\"æ·»åŠ æ–°çš„èŠ‚ç‚¹\">æ·»åŠ æ–°çš„èŠ‚ç‚¹</h3>\n<p><em><strong>å½“é›†ç¾¤ä¸­çš„èŠ‚ç‚¹æ•°<code>&gt;=3</code>æ—¶ï¼Œæ— è®ºæ˜¯æ·»åŠ ä»²è£èŠ‚ç‚¹è¿˜æ˜¯ä»èŠ‚ç‚¹éƒ½æ²¡æœ‰é—®é¢˜ã€‚</strong></em></p>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¦‚æœå½“å‰é›†ç¾¤ä¸­æœ‰ä¸¤ä¸ªèŠ‚ç‚¹(ä¸€ä¸»ä¸€ä»)ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä¸æ·»åŠ ä»²è£èŠ‚ç‚¹ï¼Œè€Œæ˜¯ç›´æ¥æ·»åŠ ä¸€ä¸ªæ–°çš„ä»èŠ‚ç‚¹</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rs0 [primary] <span class=\"built_in\">test</span>&gt; rs.add(<span class=\"string\">&quot;10.1.2.41:27017&quot;</span>)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  ok: 1,</span><br><span class=\"line\">  <span class=\"string\">&#x27;$clusterTime&#x27;</span>: &#123;</span><br><span class=\"line\">    clusterTime: Timestamp(&#123; t: 1712051880, i: 1 &#125;),</span><br><span class=\"line\">    signature: &#123;</span><br><span class=\"line\">      <span class=\"built_in\">hash</span>: Binary.createFromBase64(<span class=\"string\">&#x27;DuuorhNH4MWqa4DHCifPzxcMN3I=&#x27;</span>, 0),</span><br><span class=\"line\">      keyId: Long(<span class=\"string\">&#x27;7352724745051176965&#x27;</span>)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  operationTime: Timestamp(&#123; t: 1712051880, i: 1 &#125;)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å½“é›†ç¾¤ä¸­åªæœ‰ä¸€ä¸ªä¸»èŠ‚ç‚¹å’Œä¸€ä¸ªä»²è£èŠ‚ç‚¹æ—¶ï¼Œæ­¤æ—¶è‹¥ç›´æ¥æ·»åŠ æ–°çš„èŠ‚ç‚¹ä¼šæŠ¥é”™</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rs0 [primary] <span class=\"built_in\">local</span>&gt; rs.add(<span class=\"string\">&quot;10.1.2.142:27017&quot;</span>)</span><br><span class=\"line\">MongoServerError[NewReplicaSetConfigurationIncompatible]: Rejecting reconfig <span class=\"built_in\">where</span> the new config has a PSA topology and the secondary is electable, but the old config contains only one writable node. Refer to https://docs.mongodb.com/manual/reference/method/rs.reconfigForPSASet/ <span class=\"keyword\">for</span> next steps on reconfiguring a PSA <span class=\"built_in\">set</span>.</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ ¹æ®ç»™å‡ºçš„ç½‘å€çš„æç¤ºï¼Œæ‰§è¡Œä»¥ä¸‹æ“ä½œ</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># è·å–å½“å‰é…ç½®</span></span><br><span class=\"line\">rs0 [primary] <span class=\"built_in\">test</span>&gt; cfg = rs.conf();</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  _id: <span class=\"string\">&#x27;rs0&#x27;</span>,</span><br><span class=\"line\">  version: 7,</span><br><span class=\"line\">  term: 8,</span><br><span class=\"line\">  members: [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      _id: 0,</span><br><span class=\"line\">      host: <span class=\"string\">&#x27;10.1.2.26:27017&#x27;</span>,</span><br><span class=\"line\">      arbiterOnly: <span class=\"literal\">false</span>,</span><br><span class=\"line\">      buildIndexes: <span class=\"literal\">true</span>,</span><br><span class=\"line\">      hidden: <span class=\"literal\">false</span>,</span><br><span class=\"line\">      priority: 1,</span><br><span class=\"line\">      tags: &#123; purpose: <span class=\"string\">&#x27;online&#x27;</span> &#125;,</span><br><span class=\"line\">      secondaryDelaySecs: Long(<span class=\"string\">&#x27;0&#x27;</span>),</span><br><span class=\"line\">      votes: 1</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      _id: 2,</span><br><span class=\"line\">      host: <span class=\"string\">&#x27;10.1.2.41:27017&#x27;</span>,</span><br><span class=\"line\">      arbiterOnly: <span class=\"literal\">true</span>,</span><br><span class=\"line\">      buildIndexes: <span class=\"literal\">true</span>,</span><br><span class=\"line\">      hidden: <span class=\"literal\">false</span>,</span><br><span class=\"line\">      priority: 0,</span><br><span class=\"line\">      tags: &#123;&#125;,</span><br><span class=\"line\">      secondaryDelaySecs: Long(<span class=\"string\">&#x27;0&#x27;</span>),</span><br><span class=\"line\">      votes: 1</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  ],</span><br><span class=\"line\">  protocolVersion: Long(<span class=\"string\">&#x27;1&#x27;</span>),</span><br><span class=\"line\">  writeConcernMajorityJournalDefault: <span class=\"literal\">true</span>,</span><br><span class=\"line\">  settings: &#123;</span><br><span class=\"line\">    chainingAllowed: <span class=\"literal\">true</span>,</span><br><span class=\"line\">    heartbeatIntervalMillis: 2000,</span><br><span class=\"line\">    heartbeatTimeoutSecs: 10,</span><br><span class=\"line\">    electionTimeoutMillis: 10000,</span><br><span class=\"line\">    catchUpTimeoutMillis: -1,</span><br><span class=\"line\">    catchUpTakeoverDelayMillis: 30000,</span><br><span class=\"line\">    getLastErrorModes: &#123;&#125;,</span><br><span class=\"line\">    getLastErrorDefaults: &#123; w: 1, wtimeout: 0 &#125;,</span><br><span class=\"line\">    replicaSetId: ObjectId(<span class=\"string\">&#x27;660a20282e7a827807cac803&#x27;</span>)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ä¿®æ”¹é…ç½®ï¼Œå¢åŠ æ–°çš„èŠ‚ç‚¹ä¿¡æ¯</span></span><br><span class=\"line\">rs0 [primary] <span class=\"built_in\">test</span>&gt; cfg[<span class=\"string\">&quot;members&quot;</span>] = [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      _id: 0,</span><br><span class=\"line\">      host: <span class=\"string\">&#x27;10.1.2.26:27017&#x27;</span>,</span><br><span class=\"line\">      arbiterOnly: <span class=\"literal\">false</span>,</span><br><span class=\"line\">      buildIndexes: <span class=\"literal\">true</span>,</span><br><span class=\"line\">      hidden: <span class=\"literal\">false</span>,</span><br><span class=\"line\">      priority: 1,</span><br><span class=\"line\">      tags: &#123; purpose: <span class=\"string\">&#x27;online&#x27;</span> &#125;,</span><br><span class=\"line\">      secondaryDelaySecs: Long(<span class=\"string\">&#x27;0&#x27;</span>),</span><br><span class=\"line\">      votes: 1</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      _id: 1,</span><br><span class=\"line\">      host: <span class=\"string\">&#x27;10.1.2.142:27017&#x27;</span>,   <span class=\"comment\"># æ–°çš„èŠ‚ç‚¹</span></span><br><span class=\"line\">      arbiterOnly: <span class=\"literal\">false</span>,</span><br><span class=\"line\">      buildIndexes: <span class=\"literal\">true</span>,</span><br><span class=\"line\">      hidden: <span class=\"literal\">false</span>,</span><br><span class=\"line\">      priority: 1,</span><br><span class=\"line\">      tags: &#123; purpose: <span class=\"string\">&#x27;online&#x27;</span> &#125;,</span><br><span class=\"line\">      secondaryDelaySecs: Long(<span class=\"string\">&#x27;0&#x27;</span>),</span><br><span class=\"line\">      votes: 1</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      _id: 2,</span><br><span class=\"line\">      host: <span class=\"string\">&#x27;10.1.2.41:27017&#x27;</span>,</span><br><span class=\"line\">      arbiterOnly: <span class=\"literal\">true</span>,</span><br><span class=\"line\">      buildIndexes: <span class=\"literal\">true</span>,</span><br><span class=\"line\">      hidden: <span class=\"literal\">false</span>,</span><br><span class=\"line\">      priority: 0,</span><br><span class=\"line\">      tags: &#123;&#125;,</span><br><span class=\"line\">      secondaryDelaySecs: Long(<span class=\"string\">&#x27;0&#x27;</span>),</span><br><span class=\"line\">      votes: 1</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  ]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ‰§è¡Œé…ç½®</span></span><br><span class=\"line\">rs0 [primary] <span class=\"built_in\">test</span>&gt; rs.reconfigForPSASet(1, cfg);</span><br><span class=\"line\">Running first reconfig to give member at index 1 &#123; votes: 1, priority: 0 &#125;</span><br><span class=\"line\">Running second reconfig to give member at index 1 &#123; priority: 1 &#125;</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  ok: 1,</span><br><span class=\"line\">  <span class=\"string\">&#x27;$clusterTime&#x27;</span>: &#123;</span><br><span class=\"line\">    clusterTime: Timestamp(&#123; t: 1712051518, i: 2 &#125;),</span><br><span class=\"line\">    signature: &#123;</span><br><span class=\"line\">      <span class=\"built_in\">hash</span>: Binary.createFromBase64(<span class=\"string\">&#x27;+tgYZKeeGP0KGt3YVpDCAjW3xTc=&#x27;</span>, 0),</span><br><span class=\"line\">      keyId: Long(<span class=\"string\">&#x27;7352724745051176965&#x27;</span>)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  operationTime: Timestamp(&#123; t: 1712051518, i: 2 &#125;)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹æ–°èŠ‚ç‚¹çš„çŠ¶æ€</span></span><br><span class=\"line\">rs0 [primary] <span class=\"built_in\">test</span>&gt; rs.status()</span><br><span class=\"line\">â€¦â€¦â€¦â€¦â€¦â€¦</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">      _id: 1,</span><br><span class=\"line\">      name: <span class=\"string\">&#x27;10.1.2.142:27017&#x27;</span>,</span><br><span class=\"line\">      health: 1,</span><br><span class=\"line\">      state: 2,</span><br><span class=\"line\">      stateStr: <span class=\"string\">&#x27;SECONDARY&#x27;</span>,</span><br><span class=\"line\">      <span class=\"built_in\">uptime</span>: 87,</span><br><span class=\"line\">      optime: &#123; ts: Timestamp(&#123; t: 1712051597, i: 1 &#125;), t: Long(<span class=\"string\">&#x27;8&#x27;</span>) &#125;,</span><br><span class=\"line\">      optimeDurable: &#123; ts: Timestamp(&#123; t: 1712051597, i: 1 &#125;), t: Long(<span class=\"string\">&#x27;8&#x27;</span>) &#125;,</span><br><span class=\"line\">      optimeDate: ISODate(<span class=\"string\">&#x27;2024-04-02T09:53:17.000Z&#x27;</span>),</span><br><span class=\"line\">      optimeDurableDate: ISODate(<span class=\"string\">&#x27;2024-04-02T09:53:17.000Z&#x27;</span>),</span><br><span class=\"line\">      lastAppliedWallTime: ISODate(<span class=\"string\">&#x27;2024-04-02T09:53:17.058Z&#x27;</span>),</span><br><span class=\"line\">      lastDurableWallTime: ISODate(<span class=\"string\">&#x27;2024-04-02T09:53:17.058Z&#x27;</span>),</span><br><span class=\"line\">      lastHeartbeat: ISODate(<span class=\"string\">&#x27;2024-04-02T09:53:24.535Z&#x27;</span>),</span><br><span class=\"line\">      lastHeartbeatRecv: ISODate(<span class=\"string\">&#x27;2024-04-02T09:53:24.535Z&#x27;</span>),</span><br><span class=\"line\">      pingMs: Long(<span class=\"string\">&#x27;0&#x27;</span>),</span><br><span class=\"line\">      lastHeartbeatMessage: <span class=\"string\">&#x27;&#x27;</span>,</span><br><span class=\"line\">      syncSourceHost: <span class=\"string\">&#x27;10.1.2.26:27017&#x27;</span>,</span><br><span class=\"line\">      syncSourceId: 0,</span><br><span class=\"line\">      infoMessage: <span class=\"string\">&#x27;&#x27;</span>,</span><br><span class=\"line\">      configVersion: 10,</span><br><span class=\"line\">      configTerm: 8</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">â€¦â€¦â€¦â€¦â€¦â€¦</span><br></pre></td></tr></table></figure>\n<h2 id=\"æ•…éšœè½¬ç§»\">æ•…éšœè½¬ç§»</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>é›†ç¾¤ç»„å»ºå®Œæˆåï¼Œé›†ç¾¤å†…çš„å„ä¸ªèŠ‚ç‚¹ä¼šå¼€å¯å¿ƒè·³å“åº”å®šæ—¶å™¨ï¼Œé»˜è®¤æ¯éš”2ç§’<code>(heartbeatIntervalMillis)</code>ä¼šå‘å…¶å®ƒæˆå‘˜å‘èµ·å¿ƒè·³ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>åŒæ—¶å„æˆå‘˜èŠ‚ç‚¹è¿˜ä¼šå¯åŠ¨ä¸€ä¸ªé€‰ä¸¾è¶…æ—¶æ£€æµ‹å®šæ—¶å™¨ï¼Œé»˜è®¤æ¯éš”10ç§’<code>(electionTimeoutMillis)</code>ä¼šå‘èµ·ä¸€è½®<code>é€‰ä¸¾è°ƒåº¦</code>ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å½“ä¸»èŠ‚ç‚¹å¿ƒè·³å“åº”æˆåŠŸï¼Œåˆ™å½“å‰èŠ‚ç‚¹å°±ä¼šå–æ¶ˆä¸Šä¸€æ¬¡çš„<code>é€‰ä¸¾è°ƒåº¦</code>ï¼Œå³ä¼šé‡ç½®é€‰ä¸¾è¶…æ—¶æ£€æµ‹å®šæ—¶å™¨çš„å€’è®¡æ—¶</p>\n</li>\n<li class=\"lvl-2\">\n<p>è‹¥ä¸»èŠ‚ç‚¹å¿ƒè·³å“åº”å¤±è´¥ï¼Œå¹¶ä¸”åœ¨<code>é€‰ä¸¾è¶…æ—¶æ£€æµ‹</code>çš„æ—¶é—´å†…ä»ç„¶æ²¡æœ‰å“åº”æˆåŠŸï¼Œåˆ™å½“å‰èŠ‚ç‚¹å°±ä¼šå‘èµ·ä¸€è½®<code>é€‰ä¸¾è°ƒåº¦</code></p>\n</li>\n<li class=\"lvl-2\">\n<p>MongoDBçš„å¤åˆ¶é›†é€‰ä¸¾ä½¿ç”¨<a href=\"https://raft.github.io/\">Raftç®—æ³•</a>æ¥å®ç°ï¼Œé€‰ä¸¾æˆåŠŸçš„å¿…è¦æ¡ä»¶æ˜¯å¤§å¤šæ•°æŠ•ç¥¨èŠ‚ç‚¹å­˜æ´»ã€‚ç®€å•æ¥è¯´å°±æ˜¯å¦‚æœè¶…è¿‡åŠæ•°çš„èŠ‚ç‚¹éƒ½ç»™æˆ‘æŠ•ç¥¨äº†ï¼Œé‚£ä¹ˆæˆ‘å°±ä¼šæˆä¸ºä¸»èŠ‚ç‚¹ã€‚</p>\n</li>\n</ul>\n<h3 id=\"ä¸ºä»€ä¹ˆæ¨èé›†ç¾¤è¿æ¥çš„æ–¹å¼ï¼Ÿ\">ä¸ºä»€ä¹ˆæ¨èé›†ç¾¤è¿æ¥çš„æ–¹å¼ï¼Ÿ</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è€ƒè™‘è¿™æ ·çš„åœºæ™¯ï¼Œå¦‚æœæˆ‘è¿æ¥ä¸»èŠ‚ç‚¹å¹¶ä¸”æ’å…¥10000æ¡è¯´ï¼Œè‹¥æ­¤æ—¶ä¸»èŠ‚ç‚¹å®•æœºï¼Œåˆ™å®¢æˆ·ç«¯ä¼šç«‹åˆ»åœæ­¢æ“ä½œã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åªè¿æ¥ä¸»èŠ‚ç‚¹</span></span><br><span class=\"line\">mongosh <span class=\"string\">&quot;mongodb://user:password@10.1.2.26:27017/test?authSource=admin&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ‰§è¡Œæ’å…¥</span></span><br><span class=\"line\">rs0 [direct: primary] <span class=\"built_in\">test</span>&gt; <span class=\"keyword\">for</span>(i=0;i&lt;10000;i++)&#123;db.emp.insertOne(&#123;name:<span class=\"string\">&quot;test&quot;</span>+i&#125;)&#125;</span><br><span class=\"line\"><span class=\"comment\"># æ­¤æ—¶å…³é—­ä¸»èŠ‚ç‚¹çš„mongoæœåŠ¡ï¼Œåˆ™å®¢æˆ·ç«¯ä¼šç«‹åˆ»ç»™å‡ºæŠ¥é”™ä¿¡æ¯</span></span><br><span class=\"line\">MongoServerError[NotWritablePrimary]: not primary</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è‹¥è¿æ¥é‡‡ç”¨é›†ç¾¤çš„æ–¹å¼è¿æ¥ï¼Œåˆ™ä¸ä¼šä¸­æ–­æ“ä½œï¼Œå…¶åŸå› å°±æ˜¯é›†ç¾¤è¿æ¥æ–¹å¼ä¼šè‡ªåŠ¨å®Œæˆæ•…éšœè½¬ç§»</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mongosh <span class=\"string\">&quot;mongodb://user:password@10.1.2.26:27017,10.1.2.142:27017,10.1.2.41:27017/test?authSource=admin&amp;replicaSet=rs0&quot;</span></span><br><span class=\"line\"><span class=\"comment\"># æ’å…¥æ“ä½œæ²¡æœ‰è¢«ä¸­æ–­</span></span><br><span class=\"line\">rs0 [primary] <span class=\"built_in\">test</span>&gt; <span class=\"keyword\">for</span>(i=0;i&lt;10000;i++)&#123;db.emp.insertOne(&#123;name:<span class=\"string\">&quot;test&quot;</span>+i&#125;)&#125;</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  acknowledged: <span class=\"literal\">true</span>,</span><br><span class=\"line\">  insertedId: ObjectId(<span class=\"string\">&#x27;660cce829918b823661879c6&#x27;</span>)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥è¯¢ç»“æœæ­£ç¡®</span></span><br><span class=\"line\">rs0 [primary] <span class=\"built_in\">test</span>&gt; db.emp.countDocuments()</span><br><span class=\"line\">10000</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¿™é‡Œæœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„ï¼Œå½“ä½ åˆ›å»ºé›†ç¾¤æ—¶ä½¿ç”¨çš„æ˜¯å„ä¸ªèŠ‚ç‚¹çš„å†…ç½‘ipåœ°å€ï¼Œåˆ™å®¢æˆ·ç«¯å¿…é¡»å¯ä»¥è®¿é—®è¿™äº›å†…ç½‘ipæ‰èƒ½é€šè¿‡é›†ç¾¤è¿æ¥ï¼Œå¦åˆ™ä¼šå‡ºç°è¿æ¥å¤±è´¥çš„æƒ…å†µã€‚å› ä¸ºé€šè¿‡é›†ç¾¤è¿æ¥çš„æ–¹å¼ï¼Œå®é™…ä¸Šæ˜¯ä¼šå…ˆåœ¨é›†ç¾¤å†…éƒ¨åˆ¤æ–­å‡ºä¸»èŠ‚ç‚¹çš„ipåœ°å€è¿”å›ç»™å®¢æˆ·ç«¯ï¼Œç„¶åå®¢æˆ·ç«¯å†é€šè¿‡è¿™ä¸ªä¸»èŠ‚ç‚¹ipè®¿é—®ä¸»èŠ‚ç‚¹ã€‚</p>\n</li>\n</ul>\n<div class=\"tips\">\n<p><em><strong>å°è´´å£«</strong></em></p>\n<ul class=\"lvl-1\">\n<li class=\"lvl-2\">åœ¨å¤åˆ¶é›†å‘ç”Ÿä¸»å¤‡èŠ‚ç‚¹åˆ‡æ¢çš„æƒ…å†µä¸‹ï¼Œä¼šå‡ºç°çŸ­æš‚çš„æ— ä¸»èŠ‚ç‚¹é˜¶æ®µï¼Œæ­¤æ—¶æ— æ³•æ¥å—ä¸šåŠ¡å†™æ“ä½œã€‚</li>\n<li class=\"lvl-2\">æ—©æœŸçš„ç‰ˆæœ¬ä¸­éœ€è¦æ·»åŠ <code>retryWrites</code>å‚æ•°ï¼Œç°åœ¨å·²ç»é»˜è®¤å¼€å¯äº†</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mongosh <span class=\"string\">&quot;mongodb://user:password@10.1.2.26:27017,10.1.2.142:27017,10.1.2.41:27017/test?authSource=admin&amp;replicaSet=rs0&amp;retryWrites=true&quot;</span></span><br></pre></td></tr></table></figure>\n</div>\n<h2 id=\"SpringBooté›†æˆMongoDBé›†ç¾¤\">SpringBooté›†æˆMongoDBé›†ç¾¤</h2>\n<figure class=\"highlight yml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">spring:</span></span><br><span class=\"line\">  <span class=\"attr\">data:</span></span><br><span class=\"line\">    <span class=\"attr\">mongodb:</span></span><br><span class=\"line\">      <span class=\"attr\">uri:</span> <span class=\"string\">mongodb://user:password@127.0.0.1:27040,127.0.0.1:27041,127.0.0.1:27042/mytest?authSource=admin&amp;readPreference=primaryPreferred</span></span><br></pre></td></tr></table></figure>\n","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç»Linuxä¸‹MongoDB7.0å¤åˆ¶é›†çš„å®‰è£…å’Œä½¿ç”¨ MongoDBå®˜æ–¹æ–‡æ¡£ æœ¬æ–‡åŸºäºCentOS8(x86_64) Mongodbåˆ†ç‰‡é›†ç¾¤æ­å»ºå‚çœ‹MongoDB åˆ†ç‰‡é›†ç¾¤æ­å»ºï¼Œè™½ç„¶æ˜¯åŸºäº4.4ç‰ˆæœ¬çš„ï¼Œä½†æ˜¯å®‰è£…æ–¹å¼å·®åˆ«ä¸å¤§ï¼Œåªæ˜¯é…ç½®æ–‡ä»¶ä¸­ä¸ªåˆ«çš„å±æ€§åç§°å‘ç”Ÿäº†å˜åŒ–ã€‚ å¤åˆ¶é›†èŠ‚ç‚¹ç±»å‹ ä¸€ä¸ªå¤åˆ¶é›†æœ€å¤šæ”¯æŒ50ä¸ªèŠ‚ç‚¹ï¼Œä¸”åšå¤šåªèƒ½æœ‰7ä¸ªèŠ‚ç‚¹å‚ä¸æŠ•ç¥¨ï¼ŒèŠ‚ç‚¹ç±»å‹åˆ†ä¸ºPrimaryã€Secondaryä¸Arbiterã€‚ Primaryï¼šä¸»èŠ‚ç‚¹ï¼Œå…¶æ¥æ”¶æ‰€æœ‰çš„å†™è¯·æ±‚ï¼Œç„¶åæŠŠä¿®æ”¹åŒæ­¥åˆ°æ‰€æœ‰ Secondary èŠ‚ç‚¹ã€‚ä¸€ä¸ªå¤åˆ¶é›†åªèƒ½æœ‰ä¸€ä¸ªä¸»èŠ‚ç‚¹ï¼Œå½“ä¸»èŠ‚ç‚¹æŒ‚æ‰åï¼Œå…¶ä»–èŠ‚ç‚¹ä¼šé‡æ–°é€‰ä¸¾å‡ºæ¥ä¸€ä¸ªä¸»èŠ‚ç‚¹ã€‚ Secondaryï¼šå¤‡èŠ‚ç‚¹ï¼Œä¸ä¸»èŠ‚ç‚¹ä¿æŒåŒæ ·çš„æ•°æ®é›†ã€‚å½“ä¸»èŠ‚ç‚¹æŒ‚æ‰æ—¶ï¼Œå‚ä¸ç«é€‰ä¸»èŠ‚ç‚¹ã€‚åˆ†ä¸ºä»¥ä¸‹ä¸‰ä¸ªä¸åŒç±»å‹ï¼š Hidden = falseï¼šæ­£å¸¸çš„åªè¯»èŠ‚ç‚¹ï¼Œæ˜¯å¦å¯é€‰ä¸ºä¸»ï¼Œæ˜¯å¦å¯æŠ•ç¥¨ï¼Œå–å†³äº Priorityï¼ŒVote çš„å€¼ï¼› Hidden = trueï¼šéšè—èŠ‚ç‚¹ï¼Œå¯¹å®¢æˆ·ç«¯ä¸å¯è§ï¼Œ å¯ä»¥å‚ä¸é€‰ä¸¾ï¼Œä½†æ˜¯ Priority å¿…é¡»ä¸º 0ï¼Œå³ä¸èƒ½è¢«æå‡ä¸ºä¸»ã€‚ ç”±äºéšè—èŠ‚ç‚¹ä¸ä¼šæ¥å—ä¸šåŠ¡è®¿é—®ï¼Œå› æ­¤å¯é€šè¿‡éšè—èŠ‚ç‚¹åšä¸€äº›æ•°æ®å¤‡ä»½ã€ç¦»çº¿è®¡ç®—çš„ä»»åŠ¡ï¼Œè¿™å¹¶ä¸ä¼šå½±å“æ•´ä¸ªå¤åˆ¶é›†ã€‚ Delayed ï¼šå»¶è¿ŸèŠ‚ç‚¹ï¼Œå¿…é¡»åŒæ—¶å…·å¤‡éšè—èŠ‚ç‚¹å’ŒPriority=0çš„ç‰¹æ€§ï¼Œä¼šå»¶è¿Ÿä¸€å®šçš„æ—¶é—´ï¼ˆsecondaryDelaySecs é…ç½®å†³å®šï¼‰ä»ä¸Šæ¸¸å¤åˆ¶å¢é‡ï¼Œå¸¸ç”¨äºå¿«é€Ÿå›æ»šåœºæ™¯ã€‚ Arbiterï¼šä»²è£èŠ‚ç‚¹ï¼Œåªç”¨äºå‚ä¸é€‰ä¸¾æŠ•ç¥¨ï¼Œæœ¬èº«ä¸æ‰¿è½½ä»»ä½•æ•°æ®ï¼Œåªä½œä¸ºæŠ•ç¥¨è§’è‰²ã€‚æ¯”å¦‚ä½ éƒ¨ç½²äº†2ä¸ªèŠ‚ç‚¹çš„å¤åˆ¶é›†ï¼Œ1ä¸ª Primaryï¼Œ1ä¸ªSecondaryï¼Œä»»æ„èŠ‚ç‚¹å®•æœºï¼Œå¤åˆ¶é›†å°†ä¸èƒ½æä¾›æœåŠ¡äº†ï¼ˆæ— æ³•é€‰å‡ºPrimaryï¼‰ï¼Œè¿™æ—¶å¯ä»¥ç»™å¤åˆ¶é›†æ·»åŠ â¼€ä¸ª ArbiterèŠ‚ç‚¹ï¼Œå³ä½¿æœ‰èŠ‚ç‚¹å®•æœºï¼Œä»èƒ½é€‰å‡ºPrimaryã€‚ Arbiteræœ¬èº«ä¸å­˜å‚¨æ•°æ®ï¼Œæ˜¯éå¸¸è½»é‡çº§çš„æœåŠ¡ï¼Œå½“å¤åˆ¶é›†æˆå‘˜ä¸ºå¶æ•°æ—¶ï¼Œæœ€å¥½åŠ å…¥â¼€ä¸ªArbiterèŠ‚ç‚¹ï¼Œä»¥æå‡å¤åˆ¶é›†å¯ç”¨æ€§ã€‚ æ­å»ºåŸºäº3å°æœºå™¨çš„å¤åˆ¶é›† 12310.1.2.2610.1.2.14210.1.2.41 mongod.confé…ç½®æ–‡ä»¶ï¼Œéœ€è¦åˆ›å»ºå¥½ç›¸å…³ç›®å½• 123456789101112131415systemLog: destination: file path: /mongodb/log/mongodb.log logAppend: truestorage: dbPath: /mongodb/datanet: bindIp: 0.0.0.0 port: 27017processManagement: fork: truereplication: replSetName: rs0security: keyFile: /mongodb/mongo.key åˆ›å»ºkeyæ–‡ä»¶ 123openssl rand -base64 756 &gt; /mongodb/mongo.key# ä¿®æ”¹æƒé™chmod 600 /mongodb/mongo.key åˆ†åˆ«å¯åŠ¨3ä¸ªèŠ‚ç‚¹ 1mongod -f /mongodb/mongo.conf åˆå§‹åŒ– ç™»å½•ä»»æ„èŠ‚ç‚¹ 1mongosh 10.1.2.26:27017 åˆå§‹åŒ–å¤åˆ¶é›† 123456789101112131415# å¿…é¡»åˆ‡æ¢åˆ°adminæ•°æ®åº“test&gt; use adminswitched to db admin# åˆå§‹åŒ–admin&gt; rs.initiate( &#123; _id: &quot;rs0&quot;, members: [ &#123; _id : 0, host : &quot;10.1.2.26&quot; &#125;, &#123; _id : 1, host : &quot;10.1.2.142&quot; &#125;, &#123; _id : 2, host : &quot;10.1.2.41&quot; &#125; ] &#125;); æŸ¥çœ‹è°æ˜¯ä¸»èŠ‚ç‚¹ 1234567891011121314151617181920212223242526272829303132333435363738394041# æŸ¥çœ‹è°æ˜¯ä¸»èŠ‚ç‚¹ï¼Œå¯ä»¥çœ‹åˆ°æ­¤æ—¶ä¸»èŠ‚ç‚¹æ˜¯ 10.1.2.26&gt; rs.isMaster()&#123; topologyVersion: &#123; # æ‹“æ‰‘ç‰ˆæœ¬ï¼ŒåŒ…å«è¿›ç¨‹ ID å’Œè®¡æ•°å™¨ã€‚ processId: ObjectId(&#x27;660a1cdf2e7a827807cac6f9&#x27;), # è¿›ç¨‹ ID counter: Long(&#x27;6&#x27;) # è®¡æ•°å™¨ï¼Œç”¨äºæ ‡è¯†æ‹“æ‰‘ç‰ˆæœ¬ &#125;, hosts: [ &#x27;10.1.2.26:27017&#x27;, &#x27;10.1.2.142:27017&#x27;, &#x27;10.1.2.41:27017&#x27; ], # å¤åˆ¶é›†ä¸­æ‰€æœ‰æˆå‘˜çš„ä¸»æœºå’Œç«¯å£å·åˆ—è¡¨ã€‚ setName: &#x27;rs0&#x27;, # å¤åˆ¶é›†çš„åç§° setVersion: 1, # å¤åˆ¶é›†çš„ç‰ˆæœ¬å· ismaster: true, # å½“å‰èŠ‚ç‚¹æ˜¯å¦ä¸ºä¸»èŠ‚ç‚¹ secondary: false, # å½“å‰èŠ‚ç‚¹æ˜¯å¦ä¸ºä»èŠ‚ç‚¹ primary: &#x27;10.1.2.26:27017&#x27;, # ä¸»èŠ‚ç‚¹çš„ä¸»æœºåå’Œç«¯å£å· me: &#x27;10.1.2.26:27017&#x27;, # å½“å‰èŠ‚ç‚¹çš„ä¸»æœºåå’Œç«¯å£å· electionId: ObjectId(&#x27;7fffffff0000000000000001&#x27;), # é€‰ä¸¾ ID lastWrite: &#123; # æœ€åä¸€æ¬¡å†™å…¥æ“ä½œçš„æ—¶é—´ä¿¡æ¯ opTime: &#123; ts: Timestamp(&#123; t: 1711939636, i: 7 &#125;), t: Long(&#x27;1&#x27;) &#125;, # æ“ä½œæ—¶é—´æˆ³ lastWriteDate: ISODate(&#x27;2024-04-01T02:47:16.000Z&#x27;), # æœ€åä¸€æ¬¡å†™å…¥æ“ä½œçš„æ—¶é—´ majorityOpTime: &#123; ts: Timestamp(&#123; t: 1711939636, i: 7 &#125;), t: Long(&#x27;1&#x27;) &#125;, # å¤§å¤šæ•°å†™æ“ä½œçš„æ—¶é—´æˆ³ majorityWriteDate: ISODate(&#x27;2024-04-01T02:47:16.000Z&#x27;) # å¤§å¤šæ•°å†™æ“ä½œçš„æ—¶é—´ &#125;, maxBsonObjectSize: 16777216, # æœ€å¤§ BSON å¯¹è±¡å¤§å° maxMessageSizeBytes: 48000000, # æœ€å¤§æ¶ˆæ¯å¤§å°(ä»¥å­—èŠ‚ä¸ºå•ä½ï¼‰) maxWriteBatchSize: 100000, # æœ€å¤§å†™æ‰¹æ¬¡å¤§å° localTime: ISODate(&#x27;2024-04-01T02:47:20.408Z&#x27;), # æœ¬åœ°æ—¶é—´ logicalSessionTimeoutMinutes: 30, # ç™»å½•è¶…æ—¶æ—¶é—´(ä»¥åˆ†é’Ÿä¸ºå•ä½) connectionId: 7, # è¿æ¥ ID minWireVersion: 0, # æœ€å°Wireç‰ˆæœ¬ maxWireVersion: 21, # æœ€å¤§Wireç‰ˆæœ¬ readOnly: false, # å½“å‰èŠ‚ç‚¹æ˜¯å¦ä¸ºåªè¯»èŠ‚ç‚¹ ok: 1, # æ“ä½œæ˜¯å¦æˆåŠŸ &#x27;$clusterTime&#x27;: &#123; # é›†ç¾¤æ—¶é—´ clusterTime: Timestamp(&#123; t: 1711939636, i: 7 &#125;), # é›†ç¾¤æ—¶é—´æˆ³ signature: &#123; # ç­¾åä¿¡æ¯ hash: Binary.createFromBase64(&#x27;OOXSWapWStZk2n4cyJ7jdBS87do=&#x27;, 0), # ç­¾åå“ˆå¸Œ keyId: Long(&#x27;7352724745051176965&#x27;) # å¯†é’¥ ID &#125; &#125;, operationTime: Timestamp(&#123; t: 1711939636, i: 7 &#125;), # æ“ä½œæ—¶é—´æˆ³ isWritablePrimary: true # å½“å‰ä¸»èŠ‚ç‚¹æ˜¯å¦å¯å†™&#125; æŸ¥çœ‹é›†ç¾¤çŠ¶æ€ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273&gt; rs.status()# è¿™é‡Œåªåˆ—å‡ºèŠ‚ç‚¹çš„ä¿¡æ¯â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦members: [ # å¤åˆ¶é›†æˆå‘˜åˆ—è¡¨ &#123; _id: 0, # èŠ‚ç‚¹ ID name: &#x27;10.1.2.26:27017&#x27;, # èŠ‚ç‚¹ä¸»æœºåå’Œç«¯å£å· health: 1, # èŠ‚ç‚¹å¥åº·çŠ¶æ€ï¼Œè¿™é‡Œæ˜¯ 1ï¼Œè¡¨ç¤ºå¥åº· state: 1, # èŠ‚ç‚¹çŠ¶æ€ï¼Œè¿™é‡Œæ˜¯ 1ï¼Œè¡¨ç¤ºä¸»èŠ‚ç‚¹ stateStr: &#x27;PRIMARY&#x27;, # èŠ‚ç‚¹çŠ¶æ€å­—ç¬¦ä¸² uptime: 88366, # èŠ‚ç‚¹è¿è¡Œæ—¶é—´ optime: &#123; ts: Timestamp(&#123; t: 1712044133, i: 1 &#125;), t: Long(&#x27;5&#x27;) &#125;, # èŠ‚ç‚¹æ“ä½œæ—¶é—´æˆ³ optimeDate: ISODate(&#x27;2024-04-02T07:48:53.000Z&#x27;), # èŠ‚ç‚¹æ“ä½œæ—¶é—´ lastAppliedWallTime: ISODate(&#x27;2024-04-02T07:48:53.125Z&#x27;), # èŠ‚ç‚¹æœ€ååº”ç”¨æ—¶é—´ lastDurableWallTime: ISODate(&#x27;2024-04-02T07:48:53.125Z&#x27;), # èŠ‚ç‚¹æœ€åæŒä¹…åŒ–æ—¶é—´ syncSourceHost: &#x27;&#x27;, # åŒæ­¥æºä¸»æœºå syncSourceId: -1, # åŒæ­¥æºèŠ‚ç‚¹ ID infoMessage: &#x27;Could not find member to sync from&#x27;, # èŠ‚ç‚¹ä¿¡æ¯æ¶ˆæ¯ electionTime: Timestamp(&#123; t: 1712044063, i: 1 &#125;), # é€‰ä¸¾æ—¶é—´æˆ³ electionDate: ISODate(&#x27;2024-04-02T07:47:43.000Z&#x27;), # é€‰ä¸¾æ—¶é—´ configVersion: 4, # é…ç½®ç‰ˆæœ¬ configTerm: 5, # é€‰ä¸¾ä»»æœŸ self: true, # æ˜¯å¦ä¸ºä¸»èŠ‚ç‚¹ lastHeartbeatMessage: &#x27;&#x27; # èŠ‚ç‚¹å¿ƒè·³æ¶ˆæ¯ &#125;, &#123; _id: 1, name: &#x27;10.1.2.142:27017&#x27;, health: 1, state: 2, # èŠ‚ç‚¹çŠ¶æ€ï¼Œè¿™é‡Œæ˜¯ 2ï¼Œè¡¨ç¤ºä»èŠ‚ç‚¹ stateStr: &#x27;SECONDARY&#x27;, uptime: 88363, optime: &#123; ts: Timestamp(&#123; t: 1712044133, i: 1 &#125;), t: Long(&#x27;5&#x27;) &#125;, optimeDurable: &#123; ts: Timestamp(&#123; t: 1712044133, i: 1 &#125;), t: Long(&#x27;5&#x27;) &#125;, optimeDate: ISODate(&#x27;2024-04-02T07:48:53.000Z&#x27;), optimeDurableDate: ISODate(&#x27;2024-04-02T07:48:53.000Z&#x27;), lastAppliedWallTime: ISODate(&#x27;2024-04-02T07:48:53.125Z&#x27;), lastDurableWallTime: ISODate(&#x27;2024-04-02T07:48:53.125Z&#x27;), lastHeartbeat: ISODate(&#x27;2024-04-02T07:48:53.140Z&#x27;), # æœ€åä¸€æ¬¡å¿ƒè·³æ—¶é—´ lastHeartbeatRecv: ISODate(&#x27;2024-04-02T07:48:53.655Z&#x27;), # æœ€åä¸€æ¬¡æ¥æ”¶å¿ƒè·³æ—¶é—´ pingMs: Long(&#x27;0&#x27;), # èŠ‚ç‚¹å¿ƒè·³é—´éš”æ—¶é—´ lastHeartbeatMessage: &#x27;&#x27;, # èŠ‚ç‚¹å¿ƒè·³æ¶ˆæ¯ syncSourceHost: &#x27;10.1.2.26:27017&#x27;, # åŒæ­¥æºä¸»æœºå syncSourceId: 0, # åŒæ­¥æºèŠ‚ç‚¹ ID infoMessage: &#x27;&#x27;, # èŠ‚ç‚¹ä¿¡æ¯æ¶ˆæ¯ configVersion: 4, # é…ç½®ç‰ˆæœ¬ configTerm: 5 # é€‰ä¸¾ä»»æœŸ &#125;, &#123; _id: 2, name: &#x27;10.1.2.41:27017&#x27;, health: 0, # èŠ‚ç‚¹å¥åº·çŠ¶æ€ï¼Œè¿™é‡Œæ˜¯0ï¼Œè¡¨ç¤ºèŠ‚ç‚¹ä¸å¯è¾¾ï¼Œå› ä¸ºè¯¥èŠ‚ç‚¹çš„mongoæœåŠ¡è¢«å…³æ‰äº†ï¼Œè¿™é‡Œåªæ˜¯ä¸ºäº†å±•ç¤ºä¸åŒçš„çŠ¶æ€ state: 8, # èŠ‚ç‚¹çŠ¶æ€ï¼Œè¿™é‡Œæ˜¯8ï¼Œè¡¨ç¤ºä¸å¯è¾¾ stateStr: &#x27;(not reachable/healthy)&#x27;, # èŠ‚ç‚¹çŠ¶æ€å­—ç¬¦ä¸²ï¼Œæç¤ºèŠ‚ç‚¹ä¸å¯è¾¾ uptime: 0, optime: &#123; ts: Timestamp(&#123; t: 0, i: 0 &#125;), t: Long(&#x27;-1&#x27;) &#125;, optimeDurable: &#123; ts: Timestamp(&#123; t: 0, i: 0 &#125;), t: Long(&#x27;-1&#x27;) &#125;, optimeDate: ISODate(&#x27;1970-01-01T00:00:00.000Z&#x27;), optimeDurableDate: ISODate(&#x27;1970-01-01T00:00:00.000Z&#x27;), lastAppliedWallTime: ISODate(&#x27;2024-04-02T07:47:23.818Z&#x27;), lastDurableWallTime: ISODate(&#x27;2024-04-02T07:47:23.818Z&#x27;), lastHeartbeat: ISODate(&#x27;2024-04-02T07:48:53.163Z&#x27;), lastHeartbeatRecv: ISODate(&#x27;2024-04-02T07:47:32.215Z&#x27;), pingMs: Long(&#x27;0&#x27;), lastHeartbeatMessage: &#x27;Error connecting to 10.1.2.41:27017 :: caused by :: onInvoke :: caused by :: Connection refused&#x27;, # èŠ‚ç‚¹å¿ƒè·³æ¶ˆæ¯ï¼Œè¿™é‡Œæ˜¯è¿æ¥å¤±è´¥ syncSourceHost: &#x27;&#x27;, syncSourceId: -1, infoMessage: &#x27;&#x27;, configVersion: 4, configTerm: 4 &#125; ]â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦ stateçš„å€¼åŠå¯¹åº”çš„å«ä¹‰ 0: Startup - æˆå‘˜æ­£åœ¨å¯åŠ¨ã€‚ 1: Primary - æˆå‘˜æ˜¯ä¸»å‰¯æœ¬é›†èŠ‚ç‚¹ã€‚å¯ä»¥æ¥æ”¶å†™å…¥æ“ä½œã€‚æ¯ä¸ªå‰¯æœ¬é›†æœ‰ä¸”ä»…æœ‰ä¸€ä¸ªä¸»èŠ‚ç‚¹ã€‚ 2: Secondary - æˆå‘˜æ˜¯ä»å‰¯æœ¬é›†èŠ‚ç‚¹ã€‚å¤åˆ¶ä¸»èŠ‚ç‚¹çš„æ•°æ®å˜æ›´ã€‚ 3: Recovering - æˆå‘˜å·²ç»æ¥æ”¶åˆ°æ–°çš„æ•°æ®ï¼Œä½†è¿˜æ— æ³•æä¾›è¯»æˆ–æŠ•ç¥¨æœåŠ¡ã€‚æ­¤çŠ¶æ€é€šå¸¸æ˜¯çŸ­æš‚çš„ã€‚ 4: Fatal - æˆå‘˜å‘ç”Ÿäº†ä¸å¯æ¢å¤çš„é”™è¯¯ï¼Œå·²åœæ­¢æ¥æ”¶å’Œå¤åˆ¶æ•°æ®ã€‚äººå·¥å¹²é¢„éœ€è¦é‡å¯æˆå‘˜æˆ–è€…å‰¯æœ¬é›†ã€‚ 5: Startup2 - æˆå‘˜æ­£åœ¨åˆå§‹åŒ–å‰¯æœ¬é›†çš„å†…éƒ¨æ•°æ®ç»“æ„ã€‚ 6: Unknown - å› ä¸ºä¸æ­¤æˆå‘˜çš„åŒæ­¥è¢«æ‰“æ–­ï¼Œå¯¼è‡´æ­¤æˆå‘˜çŠ¶æ€æœªçŸ¥ã€‚ 7: Arbiter - æˆå‘˜æ˜¯ä»²è£è€…ã€‚ 8: Down - è¿™ä¸ªæˆå‘˜ç›®å‰ä¸èƒ½åˆ°è¾¾ã€‚ 9: Rollback - è¿™ä¸ªæˆå‘˜æ­£åœ¨æ»šåŠ¨å›æ•°æ®ä»¥è¾¾åˆ°ä¸€è‡´çš„çŠ¶æ€ã€‚ 10: Removed - è¿™ä¸ªæˆå‘˜å·²ç»ä»å‰¯æœ¬é›†ä¸­åˆ é™¤ã€‚ æˆæƒ åˆ›å»ºç”¨æˆ· æˆæƒåéœ€è¦é‡æ–°ç™»å½•æˆ–è¿›è¡Œè®¤è¯åæ‰èƒ½ç»§ç»­æ“ä½œ 123456789101112131415# ç™»å½•ä¸»èŠ‚ç‚¹rs0 [direct: primary] test&gt; use adminswitched to db admin# åˆ›å»ºç”¨æˆ·rs0 [direct: primary] admin&gt; db.createUser(&#123; user: &quot;user&quot;, pwd: &quot;password&quot;, roles: [ &#123; role: &quot;clusterAdmin&quot;, db: &quot;admin&quot; &#125; , &#123; role: &quot;userAdminAnyDatabase&quot;, db: &quot;admin&quot;&#125;, &#123; role: &quot;dbAdminAnyDatabase&quot;, db: &quot;admin&quot; &#125;, &#123; role: &quot;readWriteAnyDatabase&quot;, db: &quot;admin&quot;&#125; ]&#125;); ç™»å½• æ–¹æ³•1ï¼Œè¿æ¥çš„åŒæ—¶è®¤è¯ 1234567# é»˜è®¤ç™»å½•testæ•°æ®åº“mongosh 10.1.2.26:27017 -u user -p password --authenticationDatabase admin# æˆ–è€…mongosh &quot;mongodb://user:password@10.1.2.26:27017/test?authSource=admin&quot;# é›†ç¾¤è¿æ¥ï¼Œæ¨èï¼Œä¼šè‡ªåŠ¨ç™»å½•åˆ°ä¸»èŠ‚ç‚¹mongosh &quot;mongodb://user:password@10.1.2.26:27017,10.1.2.142:27017,10.1.2.41:27017/test?authSource=admin&amp;replicaSet=rs0&quot; æ–¹æ³•2ï¼Œå…ˆè¿æ¥ï¼Œå†è®¤è¯ 123456789101112mongosh 10.1.2.26:27017&gt; use adminswitched to db admin&gt; db.auth(&quot;user&quot;,&quot;password&quot;)&#123; ok: 1 &#125;# é›†ç¾¤è¿æ¥ï¼Œæ¨èï¼Œä¼šè‡ªåŠ¨ç™»å½•åˆ°ä¸»èŠ‚ç‚¹mongosh &quot;mongodb://10.1.2.26:27017,10.1.2.142:27017,10.1.2.41:27017/test?authSource=admin&amp;replicaSet=rs0&quot;&gt; use adminswitched to db admin&gt; db.auth(&quot;user&quot;,&quot;password&quot;)&#123; ok: 1 &#125; æŸ¥çœ‹ç”¨æˆ·ä¿¡æ¯ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647# å…ˆè¦åˆ‡æ¢åˆ° admin æ•°æ®åº“rs0 [direct: primary] admin&gt; db.system.users.find()[ &#123; _id: &#x27;admin.user&#x27;, userId: UUID(&#x27;19dcd146-6872-41fe-8e39-46bb98b9db5c&#x27;), user: &#x27;user&#x27;, db: &#x27;admin&#x27;, credentials: &#123; &#x27;SCRAM-SHA-1&#x27;: &#123; iterationCount: 10000, salt: &#x27;DLOOhoEKeG2RKfW8hU4caw==&#x27;, storedKey: &#x27;ohQOJeAS3XWUwlFJAGduuiUJptc=&#x27;, serverKey: &#x27;rDjqq/nF3awasdaPr2ocJskm7p0=&#x27; &#125;, &#x27;SCRAM-SHA-256&#x27;: &#123; iterationCount: 15000, salt: &#x27;6YpcJH2pcL3yC726rpIq6VWSQLSV68i+oqURkw==&#x27;, storedKey: &#x27;1nIijUrLAL0lQZ6++O0cxM3VbsprdwRQucVFYkDQWbA=&#x27;, serverKey: &#x27;nk8TKbK19zLaD7wJn+991euF9ILE08iPopmJ8YAAqfQ=&#x27; &#125; &#125;, roles: [ &#123; role: &#x27;userAdminAnyDatabase&#x27;, db: &#x27;admin&#x27; &#125;, &#123; role: &#x27;clusterAdmin&#x27;, db: &#x27;admin&#x27; &#125;, &#123; role: &#x27;dbAdminAnyDatabase&#x27;, db: &#x27;admin&#x27; &#125;, &#123; role: &#x27;readWriteAnyDatabase&#x27;, db: &#x27;admin&#x27; &#125; ] &#125;]rs0 [direct: primary] admin&gt; show users[ &#123; _id: &#x27;admin.user&#x27;, userId: UUID(&#x27;19dcd146-6872-41fe-8e39-46bb98b9db5c&#x27;), user: &#x27;user&#x27;, db: &#x27;admin&#x27;, roles: [ &#123; role: &#x27;userAdminAnyDatabase&#x27;, db: &#x27;admin&#x27; &#125;, &#123; role: &#x27;clusterAdmin&#x27;, db: &#x27;admin&#x27; &#125;, &#123; role: &#x27;dbAdminAnyDatabase&#x27;, db: &#x27;admin&#x27; &#125;, &#123; role: &#x27;readWriteAnyDatabase&#x27;, db: &#x27;admin&#x27; &#125; ], mechanisms: [ &#x27;SCRAM-SHA-1&#x27;, &#x27;SCRAM-SHA-256&#x27; ] &#125;] å¼€å¯ä»åº“è¯»å–æ•°æ®çš„æƒé™ ä½¿ç”¨å½“å‰æœ€æ–°ç‰ˆmongosh-2.2.2è¿æ¥ä»åº“æ—¶ï¼Œé»˜è®¤å°±æ”¯æŒè¯»å–æ•°æ®ï¼Œå…¶é»˜è®¤çš„readPreferenceä¸ºprimaryPreferredã€‚ å¦‚æœä½¿ç”¨ä¹‹å‰çš„ç‰ˆæœ¬è¿æ¥ä»åº“æ—¶ï¼Œé»˜è®¤æ˜¯ä¸èƒ½è¯»å–æ•°æ®çš„ï¼Œéœ€è¦æ‰‹å·¥å¼€å¯ 12345678# æç¤ºéä¸»èŠ‚ç‚¹ï¼Œä¸èƒ½æŸ¥è¯¢æ•°æ®ï¼Œrs0 [direct: secondary] test&gt; show usersMongoServerError[NotPrimaryNoSecondaryOk]: not primary - consider using db.getMongo().setReadPref() or readPreference in the connection string# æ—©æœŸç‰ˆæœ¬æ˜¯è¿è¡Œ rs.secondaryOk()ï¼Œä¸è¿‡ç°åœ¨æç¤ºå·²ç»ä¸æ¨èäº†rs0 [direct: secondary] test&gt; rs.secondaryOk()DeprecationWarning: .setSecondaryOk() is deprecated. Use .setReadPref(&quot;primaryPreferred&quot;) insteadSetting read preference from &quot;primary&quot; to &quot;primaryPreferred&quot; å…¨å±€è®¾ç½®readPreferenceï¼Œå¯¹æœ¬æ¬¡é“¾æ¥éƒ½æœ‰æ•ˆ 12# å¼€å¯ä»åº“è¯»å–æ•°æ®æƒé™rs0 [direct: secondary] test&gt; db.getMongo().setReadPref(&quot;primaryPreferred&quot;) ä¹Ÿå¯ä»¥åœ¨é“¾æ¥å‚æ•°ä¸­æŒ‡å®šreadPreference 12345# å•èŠ‚ç‚¹è¿æ¥mongosh &quot;mongodb://user:password@10.1.2.142:27017/test?authSource=admin&amp;readPreference=primaryPreferred&quot;# é›†ç¾¤è¿æ¥mongosh &quot;mongodb://user:password@10.1.2.26:27017,10.1.2.142:27017,10.1.2.41:27017/test?authSource=admin&amp;replicaSet=rs0&amp;readPreference=primaryPreferred&quot; å¯ä»¥åœ¨æŸ¥è¯¢æ—¶æŒ‡å®šreadPreferenceï¼Œåªé’ˆå¯¹å½“å‰æŸ¥è¯¢ï¼Œå¯¹åç»­æŸ¥è¯¢æ— æ•ˆ 1rs0 [direct: secondary] admin&gt; db.system.users.find().readPref(&quot;secondary&quot;) readPreference readPreferenceå†³å®šä½¿ç”¨å“ªä¸€ç±»èŠ‚ç‚¹ï¼ˆä¸»æˆ–ä»èŠ‚ç‚¹ï¼‰æ¥æ»¡è¶³æ­£åœ¨å‘èµ·çš„è¯»è¯·æ±‚ã€‚å¯é€‰å€¼åŒ…æ‹¬ï¼š primaryï¼šé»˜è®¤å€¼ï¼Œåªè¯»ä¸»èŠ‚ç‚¹çš„æ•°æ®ã€‚ primaryPreferredï¼šä¼˜å…ˆè¯»ä¸»èŠ‚ç‚¹çš„æ•°æ®ï¼Œå¦‚æœä¸»èŠ‚ç‚¹ä¸å¯ç”¨ï¼Œåˆ™è¯»ä»èŠ‚ç‚¹çš„æ•°æ®ã€‚ secondaryï¼šåªè¯»ä»èŠ‚ç‚¹çš„æ•°æ®ã€‚ secondaryPreferredï¼šä¼˜å…ˆè¯»ä»èŠ‚ç‚¹çš„æ•°æ®ï¼Œå¦‚æœä»èŠ‚ç‚¹ä¸å¯ç”¨ï¼Œåˆ™è¯»ä¸»èŠ‚ç‚¹çš„æ•°æ®ã€‚ nearestï¼šä¼˜å…ˆè¯»è·ç¦»æœ€è¿‘çš„èŠ‚ç‚¹çš„æ•°æ®ã€‚ æŒ‡å®š readPreference æ—¶åº”æ³¨æ„é«˜å¯ç”¨é—®é¢˜ã€‚ä¾‹å¦‚å°† readPreference æŒ‡å®š primaryï¼Œåˆ™å‘ç”Ÿæ•…éšœè½¬ç§»ä¸å­˜åœ¨ primary æœŸé—´å°†æ²¡æœ‰èŠ‚ç‚¹å¯è¯»ã€‚å¦‚æœä¸šåŠ¡å…è®¸ï¼Œåˆ™åº”é€‰æ‹© primaryPreferredï¼› Tag é›†ç¾¤ä¸­èŠ‚ç‚¹çš„æ ‡ç­¾ï¼Œç”¨äºé€‰æ‹©èŠ‚ç‚¹ readPreference åªèƒ½æ§åˆ¶ä½¿ç”¨ä¸€ç±»ï¼ˆä¸»æˆ–ä»èŠ‚ç‚¹ï¼‰èŠ‚ç‚¹ã€‚Tag åˆ™å¯ä»¥å°†èŠ‚ç‚¹é€‰æ‹©æ§åˆ¶åˆ°ä¸€ä¸ªæˆ–å‡ ä¸ªèŠ‚ç‚¹ã€‚ ä¸ºèŠ‚ç‚¹æ·»åŠ Tag 123456# å¿…é¡»åœ¨ä¸»èŠ‚ç‚¹ä¸‹æ‰èƒ½ä¿®æ”¹é…ç½®conf = rs.conf()conf.members[0].tags = &#123; purpose: &quot;online&quot; &#125;conf.members[1].tags = &#123; purpose: &quot;online&quot; &#125;conf.members[2].tags = &#123; purpose: &quot;analyse&quot;&#125;rs.reconfig(conf) å…¨å±€æŒ‡å®šTag 1rs0 [direct: primary] admin&gt; db.getMongo().setReadPref(&quot;primaryPreferred&quot;, [ &#123;purpose: &quot;online&quot;&#125; ]) åœ¨é“¾æ¥å‚æ•°ä¸­æŒ‡å®šTag 1mongosh &quot;mongodb://user:password@10.1.2.26:27017,10.1.2.142:27017,10.1.2.41:27017/test?authSource=admin&amp;replicaSet=rs0&amp;readPreference=primaryPreferred&amp;readPreferenceTags=purpose:online&quot; åœ¨æŸ¥è¯¢æ—¶æŒ‡å®šTag 12345rs0 [direct: secondary] admin&gt; db.system.users.find().readPref(&quot;secondary&quot;, [ &#123;purpose: &quot;analyse&quot;&#125; ])# æ³¨æ„ï¼Œ`Tag`åªèƒ½ç”¨äºä»èŠ‚ç‚¹ï¼Œä¸»èŠ‚ç‚¹ä¸æ”¯æŒã€‚rs0 [direct: primary] admin&gt; db.system.users.find().readPref(&quot;primary&quot;, [ &#123;purpose: &quot;online&quot;&#125; ])MongoInvalidArgumentError: Primary read preference cannot be combined with tags ä½¿ç”¨ Tag æ—¶åº”æ³¨æ„é«˜å¯ç”¨é—®é¢˜ï¼Œå¦‚æœåªæœ‰ä¸€ä¸ªèŠ‚ç‚¹æ‹¥æœ‰ä¸€ä¸ªç‰¹å®š Tagï¼Œåˆ™åœ¨è¿™ä¸ªèŠ‚ç‚¹å¤±æ•ˆæ—¶å°†æ— èŠ‚ç‚¹å¯è¯»ã€‚è¿™åœ¨æœ‰æ—¶å€™æ˜¯æœŸæœ›çš„ç»“æœï¼Œæœ‰æ—¶å€™ä¸æ˜¯ã€‚ä¾‹å¦‚ï¼š å¦‚æœæŠ¥è¡¨ä½¿ç”¨çš„èŠ‚ç‚¹å¤±æ•ˆï¼Œå³ä½¿ä¸ç”ŸæˆæŠ¥è¡¨ï¼Œé€šå¸¸ä¹Ÿä¸å¸Œæœ›å°†æŠ¥è¡¨è´Ÿè½½è½¬ç§»åˆ°å…¶ä»–èŠ‚ç‚¹ä¸Šï¼Œæ­¤æ—¶åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹æœ‰æŠ¥è¡¨ Tag æ˜¯åˆç†çš„é€‰æ‹©ï¼› å¦‚æœçº¿ä¸ŠèŠ‚ç‚¹å¤±æ•ˆï¼Œé€šå¸¸å¸Œæœ›æœ‰æ›¿ä»£èŠ‚ç‚¹ï¼Œæ‰€ä»¥åº”è¯¥ä¿æŒå¤šä¸ªèŠ‚ç‚¹æœ‰åŒæ ·çš„ Tagï¼› Tag æœ‰æ—¶éœ€è¦ä¸ä¼˜å…ˆçº§ã€é€‰ä¸¾æƒç»¼åˆè€ƒè™‘ã€‚ä¾‹å¦‚åšæŠ¥è¡¨çš„èŠ‚ç‚¹é€šå¸¸ä¸ä¼šå¸Œæœ›å®ƒæˆä¸ºä¸»èŠ‚ç‚¹ï¼Œåˆ™ä¼˜å…ˆçº§åº”ä¸º 0ã€‚ é€šè¿‡rs.conf()å¯ä»¥æŸ¥çœ‹å¤åˆ¶é›†ä¸­å„ä¸ªèŠ‚ç‚¹çš„Tagä¿¡æ¯ ä¼˜å…ˆçº§(priority) ä¸ é€‰ä¸¾æƒ(vote) å½“ Priority ç­‰äº 0 æ—¶ï¼Œå®ƒä¸å¯ä»¥è¢«å¤åˆ¶é›†é€‰ä¸¾ä¸ºä¸»ï¼ŒPriority çš„å€¼è¶Šé«˜ï¼Œåˆ™è¢«é€‰ä¸¾ä¸ºä¸»çš„æ¦‚ç‡æ›´å¤§ã€‚ å½“ Vote ç­‰äº 0 æ—¶ï¼Œå®ƒä¸å¯ä»¥å‚ä¸é€‰ä¸¾æŠ•ç¥¨ï¼Œæ­¤æ—¶è¯¥èŠ‚ç‚¹çš„ Priority ä¹Ÿå¿…é¡»ä¸º 0ï¼Œå³å®ƒä¹Ÿä¸èƒ½è¢«é€‰ä¸¾ä¸ºä¸»ã€‚ ç”±äºä¸€ä¸ªå¤åˆ¶é›†ä¸­æœ€å¤šåªæœ‰7ä¸ªæŠ•ç¥¨æˆå‘˜ï¼Œå› æ­¤å¤šå‡ºæ¥çš„æˆå‘˜åˆ™å¿…é¡»å°†å…¶voteå±æ€§å€¼è®¾ç½®ä¸º0ï¼Œå³è¿™äº›æˆå‘˜å°†æ— æ³•å‚ä¸æŠ•ç¥¨ã€‚ é€šè¿‡rs.conf()å¯ä»¥æŸ¥çœ‹å¤åˆ¶é›†ä¸­å„ä¸ªèŠ‚ç‚¹çš„ç›¸å…³é…ç½® 123456789101112131415161718192021222324252627282930313233&gt; rs.conf()&#123; _id: &#x27;rs0&#x27;, # å¤åˆ¶é›†åç§° version: 2, # é…ç½®ç‰ˆæœ¬å·ï¼Œå³confè¢«ä¿®æ”¹çš„æ¬¡æ•°ï¼Œæ¯æ¬¡æ›´æ”¹é…ç½®æ—¶ï¼Œç‰ˆæœ¬å·éƒ½ä¼šé€’å¢ã€‚ term: 3, # é€‰ä¸¾è½®æ¬¡ï¼ˆelection termï¼‰ã€‚åœ¨è¿›è¡Œé€‰ä¸¾æ—¶ï¼ŒMongoDB ä½¿ç”¨ä¸€ä¸ªå•è°ƒé€’å¢çš„ term å€¼æ¥æ ‡è¯†é€‰ä¸¾çš„å‘¨æœŸã€‚è¿™ä¸ªå€¼ä¼šéšç€é€‰ä¸¾çš„è¿›è¡Œè€Œå¢åŠ ã€‚ members: [ # æˆå‘˜æ•°ç»„ï¼ŒåŒ…å«äº†å¤åˆ¶é›†ä¸­çš„æ‰€æœ‰æˆå‘˜çš„è¯¦ç»†é…ç½®ä¿¡æ¯ã€‚ &#123; _id: 0, # æˆå‘˜çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œä»0å¼€å§‹é€’å¢ã€‚ host: &#x27;10.1.2.26:27017&#x27;, # èŠ‚ç‚¹ip+port arbiterOnly: false, # æ˜¯å¦ä¸ºä»²è£èŠ‚ç‚¹ buildIndexes: true, # æ˜¯å¦åœ¨æ­¤èŠ‚ç‚¹ä¸Šåˆ›å»ºç´¢å¼• hidden: false, # æ˜¯å¦ä¸ºéšè—èŠ‚ç‚¹ï¼Œå³ä¸è¢«å®¢æˆ·ç«¯å‘ç°ã€‚ priority: 1, # é€‰ä¸¾ä¼˜å…ˆçº§ï¼Œå€¼è¶Šå¤§ä¼˜å…ˆçº§è¶Šé«˜ï¼Œ0è¡¨ç¤ºä¸èƒ½è¢«é€‰ä¸¾ä¸ºä¸»èŠ‚ç‚¹ tags: &#123; purpose: &#x27;online&#x27; &#125;, # Tag secondaryDelaySecs: Long(&#x27;0&#x27;), # å¦‚æœå­˜åœ¨å»¶è¿Ÿå¤åˆ¶ï¼Œè¡¨ç¤ºå¤åˆ¶å»¶è¿Ÿçš„æ—¶é—´é‡ï¼ˆä»¥ç§’ä¸ºå•ä½ï¼‰ï¼Œå¦‚æœä¸º0åˆ™è¡¨ç¤ºä¸æ˜¯å»¶è¿ŸèŠ‚ç‚¹ã€‚ votes: 1 # æˆå‘˜çš„æŠ•ç¥¨æ•°ï¼Œå¤§äº0è¡¨ç¤ºå‚ä¸æŠ•ç¥¨ã€‚ &#125;, ], protocolVersion: Long(&#x27;1&#x27;), # å¤åˆ¶é›†ä½¿ç”¨çš„åè®®ç‰ˆæœ¬ã€‚ writeConcernMajorityJournalDefault: true, # æ˜¯å¦åœ¨å†™å…¥æ“ä½œä¸­é»˜è®¤å¯ç”¨å¤§å¤šæ•°å†™å…³æ³¨å’Œæ—¥å¿—è®°å½• settings: &#123; # å¤åˆ¶é›†çš„å…¨å±€è®¾ç½®ï¼ŒåŒ…å«ä»¥ä¸‹å±æ€§ï¼š chainingAllowed: true, # æ˜¯å¦å…è®¸ä»å…¶ä»–æˆå‘˜è¯»å–æ•°æ®ã€‚ heartbeatIntervalMillis: 2000, # å¿ƒè·³é—´éš”ï¼Œå³æˆå‘˜ä¹‹é—´æ£€æµ‹çŠ¶æ€çš„æ—¶é—´é—´éš”ã€‚ heartbeatTimeoutSecs: 10, # å¿ƒè·³è¶…æ—¶æ—¶é—´ï¼Œå¦‚æœåœ¨æ­¤æ—¶é—´å†…æœªæ”¶åˆ°å¿ƒè·³ï¼Œåˆ™è®¤ä¸ºæˆå‘˜ä¸å¯ç”¨ã€‚ electionTimeoutMillis: 10000, # é€‰ä¸¾è¶…æ—¶æ—¶é—´ï¼Œå³è¿›è¡Œé€‰ä¸¾çš„æ—¶é—´é—´éš”ã€‚ catchUpTimeoutMillis: -1, # æˆå‘˜åœ¨è¿½èµ¶æ“ä½œæ—¶çš„è¶…æ—¶æ—¶é—´ã€‚ catchUpTakeoverDelayMillis: 30000, # åœ¨è¿½èµ¶æ“ä½œæœŸé—´ï¼Œå‘ç”Ÿä¸»èŠ‚ç‚¹æ•…éšœæ—¶ï¼Œå»¶è¿ŸèŠ‚ç‚¹æ¥ç®¡ä¸»èŠ‚ç‚¹ä¹‹å‰çš„å»¶è¿Ÿæ—¶é—´ã€‚ getLastErrorModes: &#123;&#125;, # æŒ‡å®šå†™æ“ä½œçš„ç¡®è®¤æ¨¡å¼ã€‚ getLastErrorDefaults: &#123; w: 1, wtimeout: 0 &#125;, # æŒ‡å®šå†™æ“ä½œçš„é»˜è®¤ç¡®è®¤å‚æ•°ã€‚ replicaSetId: ObjectId(&#x27;660a20282e7a827807cac803&#x27;) # å¤åˆ¶é›†çš„å”¯ä¸€æ ‡è¯†ç¬¦ã€‚ &#125;&#125; â€¦â€¦â€¦â€¦â€¦â€¦ ä¿®æ”¹èŠ‚ç‚¹ä¼˜å…ˆçº§ 12345# å¿…é¡»åœ¨ä¸»èŠ‚ç‚¹æ‰§è¡Œcfg = rs.conf()# ä¿å­˜æˆåŠŸåï¼Œç”±äºå½“å‰èŠ‚ç‚¹çš„ä¼˜å…ˆçº§æœ€é«˜ï¼Œæ‰€ä»¥é›†ç¾¤ä¼šå‘èµ·é‡æ–°é€‰ä¸¾å°†å½“å‰èŠ‚ç‚¹è®¾ç½®ä¸ºä¸»èŠ‚ç‚¹cfg.members[2].priority = 10rs.reconfig(cfg) è®¾ç½®éšè—èŠ‚ç‚¹ 12345# å¿…é¡»åœ¨ä¸»èŠ‚ç‚¹æ‰§è¡Œcfg = rs.conf()cfg.members[2].priority = 0cfg.members[2].hidden = truers.reconfig(cfg) é…ç½®å»¶æ—¶èŠ‚ç‚¹ 123456cfg = rs.conf()cfg.members[2].priority = 0cfg.members[2].hidden = true#å»¶è¿Ÿ60ç§’cfg.members[2].secondaryDelaySecs = 60rs.reconfig(cfg) è¯»å…³æ³¨(readConcern) åœ¨ readPreference é€‰æ‹©äº†æŒ‡å®šçš„èŠ‚ç‚¹åï¼ŒreadConcern å†³å®šè¿™ä¸ªèŠ‚ç‚¹ä¸Šçš„æ•°æ®å“ªäº›æ˜¯å¯è¯»çš„ ç±»ä¼¼äºå…³ç³»æ•°æ®åº“çš„éš”ç¦»çº§åˆ«ï¼Œå¯é€‰å€¼åŒ…æ‹¬ï¼š 12345- availableï¼šè¯»å–æ‰€æœ‰å¯ç”¨çš„æ•°æ®;- localï¼šè¯»å–æ‰€æœ‰å¯ç”¨ä¸”å±äºå½“å‰åˆ†ç‰‡çš„æ•°æ®ã€‚åœ¨å¤åˆ¶é›†ä¸­ local å’Œ available æ˜¯æ²¡æœ‰åŒºåˆ«çš„ï¼Œä¸¤è€…ä»…åœ¨åˆ†ç‰‡é›†ç¾¤ä¸­æ‰æœ‰åŒºåˆ«;- majorityï¼šè¯»å–åœ¨å¤§å¤šæ•°èŠ‚ç‚¹ä¸Šæäº¤å®Œæˆçš„æ•°æ®;- linearizableï¼šå¯çº¿æ€§åŒ–è¯»å–æ–‡æ¡£ï¼Œä»…æ”¯æŒä»ä¸»èŠ‚ç‚¹è¯»ã€‚åªè¯»å–å¤§å¤šæ•°èŠ‚ç‚¹ç¡®è®¤è¿‡çš„æ•°æ®ã€‚å’Œ majority æœ€å¤§å·®åˆ«æ˜¯ä¿è¯ç»å¯¹çš„æ“ä½œçº¿æ€§é¡ºåº;- snapshotï¼šè¯»å–æœ€è¿‘å¿«ç…§ä¸­çš„æ•°æ®ï¼Œä»…å¯ç”¨äºå¤šæ–‡æ¡£äº‹åŠ¡ï¼Œéš”ç¦»çº§åˆ«æœ€é«˜; ä¸»èŠ‚ç‚¹è¯»å–æ•°æ®æ—¶é»˜è®¤ readConcern æ˜¯ localï¼Œä»èŠ‚ç‚¹è¯»å–æ•°æ®æ—¶é»˜è®¤ readConcern æ˜¯ available åˆ†ç‰‡é›†ç¾¤ä¸­ local å’Œ available çš„åŒºåˆ« å¦‚æœä¸€ä¸ª chunk x æ­£åœ¨ä» shard1 å‘ shard2 è¿ç§»ï¼› æ•´ä¸ªè¿ç§»è¿‡ç¨‹ä¸­ chunk x ä¸­çš„éƒ¨åˆ†æ•°æ®ä¼šåœ¨ shard1 å’Œ shard2 ä¸­åŒæ—¶å­˜åœ¨ï¼Œä½†æºåˆ†ç‰‡ shard1ä»ç„¶æ˜¯chunk x çš„è´Ÿè´£æ–¹ï¼š æ‰€æœ‰å¯¹ chunk x çš„è¯»å†™æ“ä½œä»ç„¶è¿›å…¥ shard1ï¼› config ä¸­è®°å½•çš„ä¿¡æ¯ chunk x ä»ç„¶å±äº shard1ï¼› æ­¤æ—¶å¦‚æœè¯» shard2ï¼Œåˆ™ä¼šä½“ç°å‡º local å’Œ available çš„åŒºåˆ«ï¼š localï¼šåªå–åº”è¯¥ç”± shard2 è´Ÿè´£çš„æ•°æ®ï¼ˆä¸åŒ…æ‹¬ xï¼‰ï¼› availableï¼šshard2 ä¸Šæœ‰ä»€ä¹ˆå°±è¯»ä»€ä¹ˆï¼ˆåŒ…æ‹¬ xï¼‰ï¼› ç¤ºä¾‹ 1234db.user.find().readConcern(&#x27;local&#x27;)db.user.find().readConcern(&#x27;majority&#x27;)# è¯»å–ä»èŠ‚ç‚¹ä¸Šå·²ç»è¢«å¤§å¤šæ•°èŠ‚ç‚¹æäº¤å®Œæˆçš„æ•°æ®db.user.find().readPref(&quot;secondary&quot;).readConcern(&quot;majority&quot;) å†™å…³æ³¨(writeConcern) writeConcern å†³å®šä¸€ä¸ªå†™æ“ä½œè½åˆ°å¤šå°‘ä¸ªèŠ‚ç‚¹ä¸Šæ‰ç®—æˆåŠŸã€‚ MongoDBæ”¯æŒå®¢æˆ·ç«¯çµæ´»é…ç½®å†™å…¥ç­–ç•¥ï¼ˆwriteConcernï¼‰ï¼Œä»¥æ»¡è¶³ä¸åŒåœºæ™¯çš„éœ€æ±‚ã€‚ 123456789101112&#123; w: &lt;value&gt;, j: &lt;boolean&gt;, wtimeout: &lt;number&gt; &#125;w: æ•°æ®å†™å…¥åˆ°numberä¸ªèŠ‚ç‚¹æ‰å‘ç”¨å®¢æˆ·ç«¯ç¡®è®¤ - &#123;w: 0&#125; å¯¹å®¢æˆ·ç«¯çš„å†™å…¥ä¸éœ€è¦å‘é€ä»»ä½•ç¡®è®¤ï¼Œé€‚ç”¨äºæ€§èƒ½è¦æ±‚é«˜ï¼Œä½†ä¸å…³æ³¨æ­£ç¡®æ€§çš„åœºæ™¯ - &#123;w: 1&#125; é»˜è®¤çš„writeConcernï¼Œæ•°æ®å†™å…¥åˆ°Primaryå°±å‘å®¢æˆ·ç«¯å‘é€ç¡®è®¤ - &#123;w: &quot;majority&quot;&#125; æ•°æ®å†™å…¥åˆ°å‰¯æœ¬é›†å¤§å¤šæ•°æˆå‘˜åå‘å®¢æˆ·ç«¯å‘é€ç¡®è®¤ï¼Œé€‚ç”¨äºå¯¹æ•°æ®å®‰å…¨æ€§è¦æ±‚æ¯”è¾ƒé«˜çš„åœºæ™¯ï¼Œè¯¥é€‰é¡¹ä¼šé™ä½å†™å…¥æ€§èƒ½j: å†™å…¥æ“ä½œçš„journalæŒä¹…åŒ–åæ‰å‘å®¢æˆ·ç«¯ç¡®è®¤ - é»˜è®¤ä¸º&#123;j: false&#125;ï¼Œå¦‚æœè¦æ±‚Primaryå†™å…¥æŒä¹…åŒ–äº†æ‰å‘å®¢æˆ·ç«¯ç¡®è®¤ï¼Œåˆ™æŒ‡å®šè¯¥é€‰é¡¹ä¸ºtruewtimeout: å†™å…¥è¶…æ—¶æ—¶é—´ï¼Œä»…wçš„å€¼å¤§äº1æ—¶æœ‰æ•ˆã€‚ - å½“æŒ‡å®š&#123;w: &#125;æ—¶ï¼Œæ•°æ®éœ€è¦æˆåŠŸå†™å…¥numberä¸ªèŠ‚ç‚¹æ‰ç®—æˆåŠŸï¼Œå¦‚æœå†™å…¥è¿‡ç¨‹ä¸­æœ‰èŠ‚ç‚¹æ•…éšœï¼Œå¯èƒ½å¯¼è‡´è¿™ä¸ªæ¡ä»¶ä¸€ç›´ä¸èƒ½æ»¡è¶³ï¼Œä»è€Œä¸€ç›´ä¸èƒ½å‘å®¢æˆ·ç«¯å‘é€ç¡®è®¤ç»“æœï¼Œé’ˆå¯¹è¿™ç§æƒ…å†µï¼Œå®¢æˆ·ç«¯å¯è®¾ç½®wtimeouté€‰é¡¹æ¥æŒ‡å®šè¶…æ—¶æ—¶é—´ï¼Œå½“å†™å…¥è¿‡ç¨‹æŒç»­è¶…è¿‡è¯¥æ—¶é—´ä»æœªç»“æŸï¼Œåˆ™è®¤ä¸ºå†™å…¥å¤±è´¥ã€‚ é€šå¸¸é‡è¦æ•°æ®åº”ç”¨ &#123;w: &quot;majority&quot;&#125;ï¼Œæ™®é€šæ•°æ®å¯ä»¥åº”ç”¨ &#123;w: 1&#125; ä»¥ç¡®ä¿æœ€ä½³æ€§èƒ½ã€‚ ç¤ºä¾‹ 1234# ç­‰ç­‰å¤§å¤šæ•°èŠ‚ç‚¹å†™å…¥æˆåŠŸdb.user.insertOne(&#123;name:&quot;æå››&quot;&#125;,&#123;writeConcern:&#123;w:&quot;majority&quot;&#125;&#125;)# ç­‰å¾…3ä¸ªèŠ‚ç‚¹å†™å…¥æˆåŠŸï¼Œè‹¥è¶…æ—¶åˆ™å†™å…¥å¤±è´¥db.user.insertOne(&#123;name:&quot;å°æ˜&quot;&#125;,&#123;writeConcern:&#123;w:3,wtimeout:3000&#125;&#125;) ä¼˜é›…çš„é‡å¯å¤åˆ¶é›† é€ä¸ªé‡å¯å¤åˆ¶é›†é‡Œæ‰€æœ‰çš„SecondaryèŠ‚ç‚¹ 1234# å…³é—­æœåŠ¡mongod --shutdown -f /mongodb/mongo.conf# é‡å¯å¯åŠ¨mongod -f /mongodb/mongo.conf å¯¹Primaryå‘é€rs.stepDown()å‘½ä»¤ï¼Œç­‰å¾…primaryé™çº§ä¸ºSecondary 123456789101112rs0 [primary] local&gt; rs.stepDown()&#123; ok: 1, &#x27;$clusterTime&#x27;: &#123; clusterTime: Timestamp(&#123; t: 1712046433, i: 1 &#125;), signature: &#123; hash: Binary.createFromBase64(&#x27;dklQyCuunlYhWYkKuNtiNcGNom8=&#x27;, 0), keyId: Long(&#x27;7352724745051176965&#x27;) &#125; &#125;, operationTime: Timestamp(&#123; t: 1712046433, i: 1 &#125;)&#125; é‡å¯é™çº§åçš„Primary oplog åœ¨å¤åˆ¶é›†æ¶æ„ä¸­ï¼Œä¸»èŠ‚ç‚¹ä¸å¤‡èŠ‚ç‚¹ä¹‹é—´æ˜¯é€šè¿‡oplogæ¥åŒæ­¥æ•°æ®çš„ï¼Œè¿™é‡Œçš„oplogæ˜¯ä¸€ä¸ªç‰¹æ®Šçš„å›ºå®šé›†åˆï¼Œå½“ä¸»èŠ‚ç‚¹ä¸Šçš„ä¸€ä¸ªå†™æ“ä½œå®Œæˆåï¼Œä¼šå‘oplogé›†åˆå†™å…¥ä¸€æ¡å¯¹åº”çš„æ—¥å¿—ï¼Œè€Œå¤‡èŠ‚ç‚¹åˆ™é€šè¿‡è¿™ä¸ªoplogä¸æ–­æ‹‰å–åˆ°æ–°çš„æ—¥å¿—ï¼Œåœ¨æœ¬åœ°è¿›è¡Œå›æ”¾ä»¥è¾¾åˆ°æ•°æ®åŒæ­¥çš„ç›®çš„ã€‚ æŸ¥è¯¢oplog 1234567891011use local# æŸ¥è¯¢æœ€è¿‘10æ¡oplogï¼Œè¿™é‡Œ $natural:-1 æ˜¯æŒ‰ç…§æ—¶é—´é™åºæ’åˆ—db.oplog.rs.find().sort(&#123;$natural:-1&#125;).limit(10)# æŸ¥è¯¢æœ€è¿‘60åˆ†é’Ÿoplogdb.oplog.rs.find(&#123; &quot;ts&quot;: &#123; &quot;$gt&quot;: Timestamp(Math.floor(new Date().getTime() / 1000) - 60*60, 1) &#125;&#125;).sort(&#123; &quot;$natural&quot;: -1&#125;).limit(10) 12345678910111213141516171819202122232425262728293031&#123; op: &#x27;u&#x27;, ns: &#x27;config.system.sessions&#x27;, ui: UUID(&#x27;4f90005d-a546-4d59-971d-7954c3acd0f8&#x27;), o: &#123; &#x27;$v&#x27;: 2, diff: &#123; u: &#123; lastUse: ISODate(&#x27;2024-04-02T08:31:10.148Z&#x27;) &#125; &#125; &#125;, o2: &#123; _id: &#123; id: UUID(&#x27;3f881052-ac21-4677-816c-33934322fbd6&#x27;), uid: Binary.createFromBase64(&#x27;eOZyqfHfiVpfviPDWgAERmzNFnUp8UBdlWKN50Fv9fo=&#x27;, 0) &#125; &#125;, ts: Timestamp(&#123; t: 1712046670, i: 1 &#125;), t: Long(&#x27;6&#x27;), v: Long(&#x27;2&#x27;), wall: ISODate(&#x27;2024-04-02T08:31:10.148Z&#x27;)&#125;tsï¼š æ“ä½œæ—¶é—´ï¼Œå½“å‰timestamp + è®¡æ•°å™¨ï¼Œè®¡æ•°å™¨æ¯ç§’éƒ½è¢«é‡ç½®vï¼šoplogç‰ˆæœ¬ä¿¡æ¯opï¼šæ“ä½œç±»å‹: iï¼šæ’â¼Šæ“ä½œ uï¼šæ›´æ–°æ“ä½œ dï¼šåˆ é™¤æ“ä½œ cï¼šæ‰§è¡Œå‘½ä»¤ï¼ˆå¦‚createDatabaseï¼ŒdropDatabaseï¼‰ nï¼šç©ºæ“ä½œï¼Œç‰¹æ®Šç”¨é€”nsï¼šæ“ä½œé’ˆå¯¹çš„é›†åˆoï¼šæ“ä½œå†…å®¹o2ï¼šæ“ä½œæŸ¥è¯¢æ¡ä»¶ï¼Œä»…updateæ“ä½œåŒ…å«è¯¥å­—æ®µ oplogé›†åˆçš„å¤§å°é»˜è®¤ä¸ºmin(ç£ç›˜å¯ç”¨ç©ºé—´*5%ï¼Œ50GB)ï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤ä¿®æ”¹ 123456# å°†å¤åˆ¶é›†æˆå‘˜çš„oplogå¤§å°ä¿®æ”¹ä¸º1Gï¼Œè¿™é‡Œå•ä½æ˜¯M&gt; db.adminCommand(&#123;replSetResizeOplog: 1, size: 1024&#125;)# æŸ¥çœ‹oplogå¤§å°&gt; use local&gt; db.oplog.rs.stats().maxSize/1024/10241024 è¿™é‡Œè¦æ³¨æ„æ¯ä¸ªèŠ‚ç‚¹çš„oplogå¤§å°éƒ½éœ€è¦å•ç‹¬çš„é…ç½®ï¼Œå¹¶ä¸”å¿…é¡»ä¸€è‡´ï¼Œå¦åˆ™æœ‰å¯èƒ½ä¼šå‡ºç°åŒæ­¥å¤±è´¥çš„æƒ…å†µã€‚ æŸ¥çœ‹å½“å‰èŠ‚ç‚¹çš„oplogçš„çŠ¶æ€ 12345678910111213141516171819202122232425262728293031rs0 [primary] test&gt; rs.printReplicationInfo()actual oplog size&#x27;1024 MB&#x27;---configured oplog size&#x27;1024 MB&#x27;---log length start to end&#x27;112923 secs (31.37 hrs)&#x27;---oplog first event time&#x27;Mon Apr 01 2024 02:47:04 GMT+0000 (Coordinated Universal Time)&#x27;---oplog last event time&#x27;Tue Apr 02 2024 10:09:07 GMT+0000 (Coordinated Universal Time)&#x27;---now&#x27;Tue Apr 02 2024 10:09:08 GMT+0000 (Coordinated Universal Time)&#x27;actual oplog sizeï¼šè¡¨ç¤ºå®é™…ä½¿ç”¨çš„ oplog å¤§å°ã€‚Oplog æ˜¯ä¸€ä¸ª circurlar bufferï¼Œç”¨äºå­˜å‚¨ä¸»èŠ‚ç‚¹ä¸Šçš„æ“ä½œæ—¥å¿—ã€‚è¿™ä¸ªå±æ€§æŒ‡ç¤ºäº† oplog çš„å½“å‰å¤§å°ã€‚åœ¨ç¤ºä¾‹ä¸­ï¼Œoplog å¤§å°ä¸º &#x27;1024 MB&#x27;ã€‚configured oplog sizeï¼šè¡¨ç¤ºé…ç½®çš„ oplog å¤§å°ã€‚è¿™æ˜¯åœ¨é…ç½®å¤åˆ¶é›†æ—¶æŒ‡å®šçš„ oplog å¤§å°ã€‚åœ¨ç¤ºä¾‹ä¸­ï¼Œé…ç½®çš„ oplog å¤§å°ä¹Ÿæ˜¯ &#x27;1024 MB&#x27;ï¼Œè¯´æ˜å®é™… oplog å¤§å°ä¸é…ç½®çš„ oplog å¤§å°ç›¸åŒ¹é…ã€‚log length start to endï¼šè¡¨ç¤º oplog çš„è®°å½•é•¿åº¦ï¼Œä»å¼€å§‹åˆ°ç»“æŸçš„æ—¶é—´è·¨åº¦ã€‚åœ¨ç¤ºä¾‹ä¸­ï¼Œoplog è®°å½•äº† &#x27;112923 secs (31.37 hrs)&#x27;ï¼Œè¡¨ç¤ºä» oplog å¼€å§‹è®°å½•åˆ°ç»“æŸçš„æ—¶é—´è·¨åº¦ä¸ºçº¦ 31.37 å°æ—¶ã€‚oplog first event timeï¼šè¡¨ç¤º oplog è®°å½•çš„ç¬¬ä¸€ä¸ªäº‹ä»¶çš„æ—¶é—´æˆ³ã€‚åœ¨ç¤ºä¾‹ä¸­ï¼Œç¬¬ä¸€ä¸ªäº‹ä»¶çš„æ—¶é—´ä¸º &#x27;Mon Apr 01 2024 02:47:04 GMT+0000 (Coordinated Universal Time)&#x27;ã€‚oplog last event timeï¼šè¡¨ç¤º oplog è®°å½•çš„æœ€åä¸€ä¸ªäº‹ä»¶çš„æ—¶é—´æˆ³ã€‚åœ¨ç¤ºä¾‹ä¸­ï¼Œæœ€åä¸€ä¸ªäº‹ä»¶çš„æ—¶é—´ä¸º &#x27;Tue Apr 02 2024 10:09:07 GMT+0000 (Coordinated Universal Time)&#x27;ã€‚nowï¼šè¡¨ç¤ºå½“å‰æ—¶é—´ã€‚åœ¨ç¤ºä¾‹ä¸­ï¼Œå½“å‰æ—¶é—´ä¸º &#x27;Tue Apr 02 2024 10:09:08 GMT+0000 (Coordinated Universal Time)&#x27;ã€‚ ä»¥ä»èŠ‚ç‚¹è§†è§’æŸ¥çœ‹oplogå¤åˆ¶çŠ¶æ€ 123456789101112131415161718rs0 [primary] local&gt; rs.printSecondaryReplicationInfo()source: 10.1.2.142:27017&#123; syncedTo: &#x27;Tue Apr 02 2024 10:10:07 GMT+0000 (Coordinated Universal Time)&#x27;, replLag: &#x27;0 secs (0 hrs) behind the primary &#x27;&#125;---source: 10.1.2.41:27017&#123; syncedTo: &#x27;Tue Apr 02 2024 10:10:07 GMT+0000 (Coordinated Universal Time)&#x27;, replLag: &#x27;0 secs (0 hrs) behind the primary &#x27;&#125;sourceï¼šä»èŠ‚ç‚¹çš„ä¸»æœºåå’Œç«¯å£å·ï¼Œå³å¤åˆ¶æ•°æ®çš„æ¥æºèŠ‚ç‚¹ã€‚syncedToï¼šè¡¨ç¤ºä»èŠ‚ç‚¹å·²ç»å¤åˆ¶åˆ°çš„æœ€æ–°æ“ä½œçš„æ—¶é—´æˆ³ã€‚å®ƒæŒ‡ç¤ºäº†ä»èŠ‚ç‚¹ä¸Šæ•°æ®çš„åŒæ­¥ç¨‹åº¦ï¼Œå³ä»èŠ‚ç‚¹å·²ç»å¤åˆ¶äº†åˆ°ä¸»èŠ‚ç‚¹çš„å“ªä¸ªæ—¶é—´ç‚¹çš„æ•°æ®ã€‚åœ¨ç¤ºä¾‹ä¸­ï¼Œä¸¤ä¸ªä»èŠ‚ç‚¹çš„ syncedTo æ—¶é—´æˆ³éƒ½æ˜¯ &#x27;Tue Apr 02 2024 10:10:07 GMT+0000 (Coordinated Universal Time)&#x27;ï¼Œè¡¨ç¤ºå®ƒä»¬éƒ½å·²ç»ä¸ä¸»èŠ‚ç‚¹åŒæ­¥åˆ°äº†ç›¸åŒçš„æ—¶é—´ç‚¹ã€‚replLagï¼šè¡¨ç¤ºä»èŠ‚ç‚¹ä¸ä¸»èŠ‚ç‚¹ä¹‹é—´çš„å¤åˆ¶å»¶è¿Ÿã€‚å®ƒæ˜¾ç¤ºäº†ä»èŠ‚ç‚¹å½“å‰è½åäºä¸»èŠ‚ç‚¹çš„æ—¶é—´é‡ï¼Œä»¥ç§’å’Œå°æ—¶ä¸ºå•ä½ã€‚åœ¨ç¤ºä¾‹ä¸­ï¼Œä¸¤ä¸ªä»èŠ‚ç‚¹çš„ replLag éƒ½æ˜¯ &#x27;0 secs (0 hrs) behind the primary&#x27;ï¼Œè¡¨ç¤ºå®ƒä»¬ä¸ä¸»èŠ‚ç‚¹ä¿æŒå®æ—¶åŒæ­¥ï¼Œæ²¡æœ‰ä»»ä½•å¤åˆ¶å»¶è¿Ÿã€‚ æ—¢ç„¶oplogçš„å¤§å°æœ‰é™åˆ¶ï¼Œæ–°çš„æ•°æ®ä¼šè¦†ç›–æ—§çš„æ•°æ®ï¼Œé‚£ä¹ˆæ–°åŠ å…¥çš„èŠ‚ç‚¹å¦‚ä½•å…¨é‡åŒæ­¥æ•°æ®å‘¢ï¼Ÿ å½“MongoDBçš„ä»åº“èŠ‚ç‚¹éœ€è¦è¿›è¡Œæ•°æ®åŒæ­¥æ—¶ï¼Œä¼šæ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼š åˆå§‹åŒæ­¥ï¼š å½“ä¸€ä¸ªæ–°èŠ‚ç‚¹åŠ å…¥åˆ°å‰¯æœ¬é›†ä¸­æ—¶ï¼Œå®ƒä¼šæ‰§è¡Œåˆå§‹åŒæ­¥ä»¥è·å–é›†åˆä¸­çš„æ‰€æœ‰æ•°æ®ã€‚åˆå§‹åŒæ­¥ä¼šå¤åˆ¶æ‰€æœ‰æ•°æ®åº“çš„æ‰€æœ‰æ•°æ®ï¼ŒåŒ…æ‹¬ç³»ç»Ÿæ•°æ®åº“ã€‚ä¹‹åï¼Œæ–°èŠ‚ç‚¹ä¼šå¼€å§‹ä»oplogé‡Œè·å–æ›´æ”¹å†å²ï¼Œåº”ç”¨è¿™äº›æ›´æ”¹å†å²åˆ°æ•°æ®ï¼Œä»¥ä¿è¯ä¸å…¶ä»–ä»åº“èŠ‚ç‚¹ä¸€è‡´ã€‚æ³¨æ„ï¼Œåˆå§‹åŒæ­¥ä¸­çš„æ•°æ®åŒ…æ‹¬åœ¨æ–°åŠ å…¥èŠ‚ç‚¹ä¹‹å‰çš„æ•°æ®ä»¥åŠæ–°èŠ‚ç‚¹åŠ å…¥ä¹‹åå…¶ä»–èŠ‚ç‚¹äº§ç”Ÿçš„æ–°æ•°æ®ã€‚ oplogè½åï¼š å¦‚æœä»åº“åœ¨åˆå§‹åŒæ­¥æ‰§è¡ŒæœŸé—´ä¸èƒ½åŠæ—¶è·å–oplogï¼ˆä¾‹å¦‚ï¼Œoplogçš„æ•°æ®è¶…å‡ºäº†å¤§å°é™åˆ¶å¹¶è¢«è¦†ç›–ï¼Œæˆ–è€…åˆæ¬¡åŒæ­¥æ—¶é—´è¿‡é•¿ï¼‰ï¼Œæ–°èŠ‚ç‚¹éœ€è¦é‡æ–°è¿›è¡Œåˆå§‹åŒæ­¥æ“ä½œã€‚ è¿™äº›æ­¥éª¤ç¡®ä¿äº†MongoDBå‰¯æœ¬é›†çš„æ•°æ®åœ¨æ‰€æœ‰èŠ‚ç‚¹é—´çš„ä¸€è‡´æ€§ï¼Œå°½ç®¡oplogæœ‰å¤§å°é™åˆ¶å¹¶ä¸”æ—§çš„å†…å®¹ä¼šè¢«æ–°çš„æ“ä½œè¦†ç›–ã€‚ å¤åˆ¶é›†ç›¸å…³æ“ä½œ å®˜æ–¹æ–‡æ¡£ å‘½ä»¤ æè¿° rs.add(â€œhostname:portâ€) ä¸ºå¤åˆ¶é›†æ–°å¢èŠ‚ç‚¹ rs.addArb(â€œhostname:portâ€) ä¸ºå¤åˆ¶é›†æ–°å¢ä¸€ä¸ª arbiters rs.conf() è¿”å›å¤åˆ¶é›†é…ç½®ä¿¡æ¯ rs.config() åŒ rs.conf() rs.freeze(3600) é˜²æ­¢å½“å‰èŠ‚ç‚¹åœ¨ä¸€æ®µæ—¶é—´å†…é€‰ä¸¾æˆä¸ºä¸»èŠ‚ç‚¹ï¼Œå¦‚è¿™é‡Œæ˜¯3600ç§’ï¼Œåˆ™å½“å‰èŠ‚ç‚¹åœ¨3600ç§’å†…ä¸ä¼šé€‰ä¸¾æˆä¸ºä¸»èŠ‚ç‚¹ rs.help() è¿”å› replica set çš„å‘½ä»¤å¸®åŠ© rs.initiate() åˆå§‹åŒ–ä¸€ä¸ªæ–°çš„å¤åˆ¶é›† rs.printReplicationInfo() ä»¥å½“å‰èŠ‚ç‚¹çš„è§†è§’è¿”å›å¤åˆ¶çš„çŠ¶æ€æŠ¥å‘Š rs.printSecondaryReplicationInfo() ä»¥ä»èŠ‚ç‚¹çš„è§†è§’è¿”å›å¤åˆ¶çŠ¶æ€æŠ¥å‘Š rs.reconfig() é€šè¿‡é‡æ–°åº”ç”¨å¤åˆ¶é›†é…ç½®æ¥ä¸ºå¤åˆ¶é›†æ›´æ–°é…ç½® rs.remove(â€œhostname:portâ€) ä»å¤åˆ¶é›†ä¸­ç§»é™¤ä¸€ä¸ªèŠ‚ç‚¹ rs.secondaryOk() ä¸ºå½“å‰çš„è¿æ¥è®¾ç½®ä»èŠ‚ç‚¹å¯è¯»ï¼Œè¯¥æ–¹æ³•å·²ç»è¿‡æ—¶äº†ï¼Œä½¿ç”¨ db.getMongo().setReadPref() ä»£æ›¿ rs.status() è¿”å›å¤åˆ¶é›†çŠ¶æ€ä¿¡æ¯ rs.stepDown() è®©å½“å‰çš„ primary å˜ä¸ºä»èŠ‚ç‚¹å¹¶è§¦å‘æ–°ä¸€è½®çš„ä¸»èŠ‚ç‚¹é€‰ä¸¾ rs.syncFrom(â€œhostname:portâ€) è®¾ç½®å¤åˆ¶é›†èŠ‚ç‚¹ä»å“ªä¸ªèŠ‚ç‚¹å¤„åŒæ­¥æ•°æ®ï¼Œå°†ä¼šè¦†ç›–é»˜è®¤é€‰å–é€»è¾‘ rs.reconfigForPSASet() åœ¨ä¸»-ä»-ä»²è£å™¨ï¼ˆPSAï¼‰å‰¯æœ¬é›†æˆ–æ­£åœ¨æ›´æ”¹ä¸ºPSAæ¶æ„çš„å‰¯æœ¬é›†ä¸Šå®‰å…¨åœ°æ‰§è¡Œä¸€äº›é‡æ–°é…ç½®æ›´æ”¹ã€‚ ç§»é™¤èŠ‚ç‚¹ 123456789101112rs0 [primary] local&gt; rs.remove(&quot;10.1.2.41:27017&quot;)&#123; ok: 1, &#x27;$clusterTime&#x27;: &#123; clusterTime: Timestamp(&#123; t: 1712049022, i: 1 &#125;), signature: &#123; hash: Binary.createFromBase64(&#x27;Qg3Ymzp3k+hhzaDo3jZQimc4WCI=&#x27;, 0), keyId: Long(&#x27;7352724745051176965&#x27;) &#125; &#125;, operationTime: Timestamp(&#123; t: 1712049022, i: 1 &#125;)&#125; æ·»åŠ ä»²è£èŠ‚ç‚¹ å½“é›†ç¾¤ä¸­çš„èŠ‚ç‚¹æ•°&gt;=3æ—¶ï¼Œæ— è®ºæ˜¯æ·»åŠ ä»²è£èŠ‚ç‚¹è¿˜æ˜¯ä»èŠ‚ç‚¹éƒ½æ²¡æœ‰é—®é¢˜ã€‚ ä¸Šé¢åˆ é™¤äº†é›†ç¾¤ä¸­çš„ä¸€ä¸ªèŠ‚ç‚¹ï¼Œæ­¤æ—¶é›†ç¾¤ä¸­çš„èŠ‚ç‚¹è¯´æ˜¯2(ä¸€ä¸»ä¸€ä»)ï¼Œæ­¤æ—¶å¦‚æœä¸»å‘ç”Ÿæ•…éšœé›†ç¾¤å°±æ²¡åŠæ³•å·¥ä½œäº†ï¼Œæ­¤æ—¶æˆ‘ä»¬å¯ä»¥ä¸ºå…¶æ·»åŠ ä¸€ä¸ªä»²è£èŠ‚ç‚¹(åªæŠ•ç¥¨ä¸å­˜å‚¨æ•°æ®)ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263# æ·»åŠ ä»²è£èŠ‚ç‚¹ï¼Œä½†æ˜¯æ­¤æ—¶æ·»åŠ ä»²è£èŠ‚ç‚¹ä¼šæŠ¥é”™rs0 [primary] local&gt; rs.addArb(&quot;10.1.2.41:27017&quot;)MongoServerError[NewReplicaSetConfigurationIncompatible]: Reconfig attempted to install a config that would change the implicit default write concern. Use the setDefaultRWConcern command to set a cluster-wide write concern and try the reconfig again.# æŠ¥é”™åŸå› ï¼šç”±äºé»˜è®¤çš„å†™å…³æ³¨ä¸º majorityï¼Œè€Œå½“å‰èŠ‚ç‚¹ä¸­åªæœ‰2ä¸ªèŠ‚ç‚¹ï¼Œæ²¡æœ‰åŠæ³•ç¡®è®¤â€œå¤§å¤šæ•°â€æ˜¯å¤šå°‘äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¿®æ”¹å†™å…³æ³¨çš„è®¾ç½®# æŸ¥è¯¢é»˜è®¤çš„è¯»å†™å…³æ³¨rs0 [primary] admin&gt; db.adminCommand(&#123;&quot;getDefaultRWConcern&quot; : 1&#125;)&#123; defaultReadConcern: &#123; level: &#x27;local&#x27; &#125;, defaultWriteConcern: &#123; w: &#x27;majority&#x27;, wtimeout: 0 &#125;, updateOpTime: Timestamp(&#123; t: 1712050437, i: 1 &#125;), updateWallClockTime: ISODate(&#x27;2024-04-02T09:15:04.462Z&#x27;), defaultWriteConcernSource: &#x27;global&#x27;, defaultReadConcernSource: &#x27;implicit&#x27;, localUpdateWallClockTime: ISODate(&#x27;2024-04-02T09:15:04.462Z&#x27;), ok: 1, &#x27;$clusterTime&#x27;: &#123; clusterTime: Timestamp(&#123; t: 1712109448, i: 1 &#125;), signature: &#123; hash: Binary.createFromBase64(&#x27;oUiR9xdXN4mzQqdz9IXHGdCmNto=&#x27;, 0), keyId: Long(&#x27;7352724745051176965&#x27;) &#125; &#125;, operationTime: Timestamp(&#123; t: 1712109448, i: 1 &#125;)&#125;# ä¿®æ”¹é»˜è®¤å†™å…³æ³¨ defaultWriteConcern# setDefaultRWConcernï¼šç”¨äºæŒ‡å®šè®¾ç½®é»˜è®¤è¯»å†™å…³æ³¨çº§åˆ«ï¼ˆRW Concernï¼‰çš„æ“ä½œã€‚å€¼ä¸º 1 è¡¨ç¤ºæ‰§è¡Œè®¾ç½®æ“ä½œã€‚# defaultWriteConcernï¼šç”¨äºæŒ‡å®šé»˜è®¤çš„å†™å…¥å…³æ³¨çº§åˆ«ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå†™å…¥å…³æ³¨çº§åˆ«è¢«è®¾ç½®ä¸º &#123; &quot;w&quot; : 2 &#125;ï¼Œæ„å‘³ç€åœ¨å†™å…¥æ•°æ®æ—¶ï¼ŒMongoDB é©±åŠ¨ç¨‹åºä¼šç­‰å¾…è‡³å°‘ä¸¤ä¸ªèŠ‚ç‚¹ç¡®è®¤å†™å…¥æˆåŠŸåæ‰è¿”å›æˆåŠŸã€‚å…¶å®è¿™é‡Œè®¾ç½®ä¸º1ä¹Ÿå¯ä»¥ï¼Œè¡¨ç¤ºå†™å…¥ä¸»èŠ‚ç‚¹å°±è¿”å›æˆåŠŸã€‚rs0 [primary] local&gt; db.adminCommand( &#123;&quot;setDefaultRWConcern&quot; : 1, &quot;defaultWriteConcern&quot; : &#123; &quot;w&quot; : 2 &#125; &#125; )&#123; defaultReadConcern: &#123; level: &#x27;local&#x27; &#125;, defaultWriteConcern: &#123; w: 2, wtimeout: 0 &#125;, updateOpTime: Timestamp(&#123; t: 1712049370, i: 1 &#125;), updateWallClockTime: ISODate(&#x27;2024-04-02T09:16:22.715Z&#x27;), defaultWriteConcernSource: &#x27;global&#x27;, defaultReadConcernSource: &#x27;implicit&#x27;, localUpdateWallClockTime: ISODate(&#x27;2024-04-02T09:16:22.726Z&#x27;), ok: 1, &#x27;$clusterTime&#x27;: &#123; clusterTime: Timestamp(&#123; t: 1712049382, i: 2 &#125;), signature: &#123; hash: Binary.createFromBase64(&#x27;04nzjl47CMumvguEzUq7RnY55+s=&#x27;, 0), keyId: Long(&#x27;7352724745051176965&#x27;) &#125; &#125;, operationTime: Timestamp(&#123; t: 1712049382, i: 2 &#125;)&#125;# å†æ¬¡æ·»åŠ ä»²è£èŠ‚ç‚¹æˆåŠŸrs0 [primary] local&gt; rs.addArb(&quot;10.1.2.41:27017&quot;)&#123; ok: 1, &#x27;$clusterTime&#x27;: &#123; clusterTime: Timestamp(&#123; t: 1712049480, i: 1 &#125;), signature: &#123; hash: Binary.createFromBase64(&#x27;4q9s6mvT0boa6Q+vjKms8vnTR6Y=&#x27;, 0), keyId: Long(&#x27;7352724745051176965&#x27;) &#125; &#125;, operationTime: Timestamp(&#123; t: 1712049480, i: 1 &#125;)&#125; æ­¤æ—¶å…³é—­ä¸»èŠ‚ç‚¹ï¼Œå°±ä¼šçœ‹åˆ°å¦ä¸€ä¸ªä»èŠ‚ç‚¹æˆä¸ºä¸»èŠ‚ç‚¹äº† æ·»åŠ æ–°çš„èŠ‚ç‚¹ å½“é›†ç¾¤ä¸­çš„èŠ‚ç‚¹æ•°&gt;=3æ—¶ï¼Œæ— è®ºæ˜¯æ·»åŠ ä»²è£èŠ‚ç‚¹è¿˜æ˜¯ä»èŠ‚ç‚¹éƒ½æ²¡æœ‰é—®é¢˜ã€‚ å¦‚æœå½“å‰é›†ç¾¤ä¸­æœ‰ä¸¤ä¸ªèŠ‚ç‚¹(ä¸€ä¸»ä¸€ä»)ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä¸æ·»åŠ ä»²è£èŠ‚ç‚¹ï¼Œè€Œæ˜¯ç›´æ¥æ·»åŠ ä¸€ä¸ªæ–°çš„ä»èŠ‚ç‚¹ 123456789101112rs0 [primary] test&gt; rs.add(&quot;10.1.2.41:27017&quot;)&#123; ok: 1, &#x27;$clusterTime&#x27;: &#123; clusterTime: Timestamp(&#123; t: 1712051880, i: 1 &#125;), signature: &#123; hash: Binary.createFromBase64(&#x27;DuuorhNH4MWqa4DHCifPzxcMN3I=&#x27;, 0), keyId: Long(&#x27;7352724745051176965&#x27;) &#125; &#125;, operationTime: Timestamp(&#123; t: 1712051880, i: 1 &#125;)&#125; å½“é›†ç¾¤ä¸­åªæœ‰ä¸€ä¸ªä¸»èŠ‚ç‚¹å’Œä¸€ä¸ªä»²è£èŠ‚ç‚¹æ—¶ï¼Œæ­¤æ—¶è‹¥ç›´æ¥æ·»åŠ æ–°çš„èŠ‚ç‚¹ä¼šæŠ¥é”™ 12rs0 [primary] local&gt; rs.add(&quot;10.1.2.142:27017&quot;)MongoServerError[NewReplicaSetConfigurationIncompatible]: Rejecting reconfig where the new config has a PSA topology and the secondary is electable, but the old config contains only one writable node. Refer to https://docs.mongodb.com/manual/reference/method/rs.reconfigForPSASet/ for next steps on reconfiguring a PSA set. æ ¹æ®ç»™å‡ºçš„ç½‘å€çš„æç¤ºï¼Œæ‰§è¡Œä»¥ä¸‹æ“ä½œ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125# è·å–å½“å‰é…ç½®rs0 [primary] test&gt; cfg = rs.conf();&#123; _id: &#x27;rs0&#x27;, version: 7, term: 8, members: [ &#123; _id: 0, host: &#x27;10.1.2.26:27017&#x27;, arbiterOnly: false, buildIndexes: true, hidden: false, priority: 1, tags: &#123; purpose: &#x27;online&#x27; &#125;, secondaryDelaySecs: Long(&#x27;0&#x27;), votes: 1 &#125;, &#123; _id: 2, host: &#x27;10.1.2.41:27017&#x27;, arbiterOnly: true, buildIndexes: true, hidden: false, priority: 0, tags: &#123;&#125;, secondaryDelaySecs: Long(&#x27;0&#x27;), votes: 1 &#125; ], protocolVersion: Long(&#x27;1&#x27;), writeConcernMajorityJournalDefault: true, settings: &#123; chainingAllowed: true, heartbeatIntervalMillis: 2000, heartbeatTimeoutSecs: 10, electionTimeoutMillis: 10000, catchUpTimeoutMillis: -1, catchUpTakeoverDelayMillis: 30000, getLastErrorModes: &#123;&#125;, getLastErrorDefaults: &#123; w: 1, wtimeout: 0 &#125;, replicaSetId: ObjectId(&#x27;660a20282e7a827807cac803&#x27;) &#125;&#125;# ä¿®æ”¹é…ç½®ï¼Œå¢åŠ æ–°çš„èŠ‚ç‚¹ä¿¡æ¯rs0 [primary] test&gt; cfg[&quot;members&quot;] = [ &#123; _id: 0, host: &#x27;10.1.2.26:27017&#x27;, arbiterOnly: false, buildIndexes: true, hidden: false, priority: 1, tags: &#123; purpose: &#x27;online&#x27; &#125;, secondaryDelaySecs: Long(&#x27;0&#x27;), votes: 1 &#125;, &#123; _id: 1, host: &#x27;10.1.2.142:27017&#x27;, # æ–°çš„èŠ‚ç‚¹ arbiterOnly: false, buildIndexes: true, hidden: false, priority: 1, tags: &#123; purpose: &#x27;online&#x27; &#125;, secondaryDelaySecs: Long(&#x27;0&#x27;), votes: 1 &#125;, &#123; _id: 2, host: &#x27;10.1.2.41:27017&#x27;, arbiterOnly: true, buildIndexes: true, hidden: false, priority: 0, tags: &#123;&#125;, secondaryDelaySecs: Long(&#x27;0&#x27;), votes: 1 &#125; ]# æ‰§è¡Œé…ç½®rs0 [primary] test&gt; rs.reconfigForPSASet(1, cfg);Running first reconfig to give member at index 1 &#123; votes: 1, priority: 0 &#125;Running second reconfig to give member at index 1 &#123; priority: 1 &#125;&#123; ok: 1, &#x27;$clusterTime&#x27;: &#123; clusterTime: Timestamp(&#123; t: 1712051518, i: 2 &#125;), signature: &#123; hash: Binary.createFromBase64(&#x27;+tgYZKeeGP0KGt3YVpDCAjW3xTc=&#x27;, 0), keyId: Long(&#x27;7352724745051176965&#x27;) &#125; &#125;, operationTime: Timestamp(&#123; t: 1712051518, i: 2 &#125;)&#125;# æŸ¥çœ‹æ–°èŠ‚ç‚¹çš„çŠ¶æ€rs0 [primary] test&gt; rs.status()â€¦â€¦â€¦â€¦â€¦â€¦&#123; _id: 1, name: &#x27;10.1.2.142:27017&#x27;, health: 1, state: 2, stateStr: &#x27;SECONDARY&#x27;, uptime: 87, optime: &#123; ts: Timestamp(&#123; t: 1712051597, i: 1 &#125;), t: Long(&#x27;8&#x27;) &#125;, optimeDurable: &#123; ts: Timestamp(&#123; t: 1712051597, i: 1 &#125;), t: Long(&#x27;8&#x27;) &#125;, optimeDate: ISODate(&#x27;2024-04-02T09:53:17.000Z&#x27;), optimeDurableDate: ISODate(&#x27;2024-04-02T09:53:17.000Z&#x27;), lastAppliedWallTime: ISODate(&#x27;2024-04-02T09:53:17.058Z&#x27;), lastDurableWallTime: ISODate(&#x27;2024-04-02T09:53:17.058Z&#x27;), lastHeartbeat: ISODate(&#x27;2024-04-02T09:53:24.535Z&#x27;), lastHeartbeatRecv: ISODate(&#x27;2024-04-02T09:53:24.535Z&#x27;), pingMs: Long(&#x27;0&#x27;), lastHeartbeatMessage: &#x27;&#x27;, syncSourceHost: &#x27;10.1.2.26:27017&#x27;, syncSourceId: 0, infoMessage: &#x27;&#x27;, configVersion: 10, configTerm: 8 &#125;â€¦â€¦â€¦â€¦â€¦â€¦ æ•…éšœè½¬ç§» é›†ç¾¤ç»„å»ºå®Œæˆåï¼Œé›†ç¾¤å†…çš„å„ä¸ªèŠ‚ç‚¹ä¼šå¼€å¯å¿ƒè·³å“åº”å®šæ—¶å™¨ï¼Œé»˜è®¤æ¯éš”2ç§’(heartbeatIntervalMillis)ä¼šå‘å…¶å®ƒæˆå‘˜å‘èµ·å¿ƒè·³ã€‚ åŒæ—¶å„æˆå‘˜èŠ‚ç‚¹è¿˜ä¼šå¯åŠ¨ä¸€ä¸ªé€‰ä¸¾è¶…æ—¶æ£€æµ‹å®šæ—¶å™¨ï¼Œé»˜è®¤æ¯éš”10ç§’(electionTimeoutMillis)ä¼šå‘èµ·ä¸€è½®é€‰ä¸¾è°ƒåº¦ã€‚ å½“ä¸»èŠ‚ç‚¹å¿ƒè·³å“åº”æˆåŠŸï¼Œåˆ™å½“å‰èŠ‚ç‚¹å°±ä¼šå–æ¶ˆä¸Šä¸€æ¬¡çš„é€‰ä¸¾è°ƒåº¦ï¼Œå³ä¼šé‡ç½®é€‰ä¸¾è¶…æ—¶æ£€æµ‹å®šæ—¶å™¨çš„å€’è®¡æ—¶ è‹¥ä¸»èŠ‚ç‚¹å¿ƒè·³å“åº”å¤±è´¥ï¼Œå¹¶ä¸”åœ¨é€‰ä¸¾è¶…æ—¶æ£€æµ‹çš„æ—¶é—´å†…ä»ç„¶æ²¡æœ‰å“åº”æˆåŠŸï¼Œåˆ™å½“å‰èŠ‚ç‚¹å°±ä¼šå‘èµ·ä¸€è½®é€‰ä¸¾è°ƒåº¦ MongoDBçš„å¤åˆ¶é›†é€‰ä¸¾ä½¿ç”¨Raftç®—æ³•æ¥å®ç°ï¼Œé€‰ä¸¾æˆåŠŸçš„å¿…è¦æ¡ä»¶æ˜¯å¤§å¤šæ•°æŠ•ç¥¨èŠ‚ç‚¹å­˜æ´»ã€‚ç®€å•æ¥è¯´å°±æ˜¯å¦‚æœè¶…è¿‡åŠæ•°çš„èŠ‚ç‚¹éƒ½ç»™æˆ‘æŠ•ç¥¨äº†ï¼Œé‚£ä¹ˆæˆ‘å°±ä¼šæˆä¸ºä¸»èŠ‚ç‚¹ã€‚ ä¸ºä»€ä¹ˆæ¨èé›†ç¾¤è¿æ¥çš„æ–¹å¼ï¼Ÿ è€ƒè™‘è¿™æ ·çš„åœºæ™¯ï¼Œå¦‚æœæˆ‘è¿æ¥ä¸»èŠ‚ç‚¹å¹¶ä¸”æ’å…¥10000æ¡è¯´ï¼Œè‹¥æ­¤æ—¶ä¸»èŠ‚ç‚¹å®•æœºï¼Œåˆ™å®¢æˆ·ç«¯ä¼šç«‹åˆ»åœæ­¢æ“ä½œã€‚ 1234567# åªè¿æ¥ä¸»èŠ‚ç‚¹mongosh &quot;mongodb://user:password@10.1.2.26:27017/test?authSource=admin&quot;# æ‰§è¡Œæ’å…¥rs0 [direct: primary] test&gt; for(i=0;i&lt;10000;i++)&#123;db.emp.insertOne(&#123;name:&quot;test&quot;+i&#125;)&#125;# æ­¤æ—¶å…³é—­ä¸»èŠ‚ç‚¹çš„mongoæœåŠ¡ï¼Œåˆ™å®¢æˆ·ç«¯ä¼šç«‹åˆ»ç»™å‡ºæŠ¥é”™ä¿¡æ¯MongoServerError[NotWritablePrimary]: not primary è‹¥è¿æ¥é‡‡ç”¨é›†ç¾¤çš„æ–¹å¼è¿æ¥ï¼Œåˆ™ä¸ä¼šä¸­æ–­æ“ä½œï¼Œå…¶åŸå› å°±æ˜¯é›†ç¾¤è¿æ¥æ–¹å¼ä¼šè‡ªåŠ¨å®Œæˆæ•…éšœè½¬ç§» 12345678910mongosh &quot;mongodb://user:password@10.1.2.26:27017,10.1.2.142:27017,10.1.2.41:27017/test?authSource=admin&amp;replicaSet=rs0&quot;# æ’å…¥æ“ä½œæ²¡æœ‰è¢«ä¸­æ–­rs0 [primary] test&gt; for(i=0;i&lt;10000;i++)&#123;db.emp.insertOne(&#123;name:&quot;test&quot;+i&#125;)&#125;&#123; acknowledged: true, insertedId: ObjectId(&#x27;660cce829918b823661879c6&#x27;)&#125;# æŸ¥è¯¢ç»“æœæ­£ç¡®rs0 [primary] test&gt; db.emp.countDocuments()10000 è¿™é‡Œæœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„ï¼Œå½“ä½ åˆ›å»ºé›†ç¾¤æ—¶ä½¿ç”¨çš„æ˜¯å„ä¸ªèŠ‚ç‚¹çš„å†…ç½‘ipåœ°å€ï¼Œåˆ™å®¢æˆ·ç«¯å¿…é¡»å¯ä»¥è®¿é—®è¿™äº›å†…ç½‘ipæ‰èƒ½é€šè¿‡é›†ç¾¤è¿æ¥ï¼Œå¦åˆ™ä¼šå‡ºç°è¿æ¥å¤±è´¥çš„æƒ…å†µã€‚å› ä¸ºé€šè¿‡é›†ç¾¤è¿æ¥çš„æ–¹å¼ï¼Œå®é™…ä¸Šæ˜¯ä¼šå…ˆåœ¨é›†ç¾¤å†…éƒ¨åˆ¤æ–­å‡ºä¸»èŠ‚ç‚¹çš„ipåœ°å€è¿”å›ç»™å®¢æˆ·ç«¯ï¼Œç„¶åå®¢æˆ·ç«¯å†é€šè¿‡è¿™ä¸ªä¸»èŠ‚ç‚¹ipè®¿é—®ä¸»èŠ‚ç‚¹ã€‚ å°è´´å£« åœ¨å¤åˆ¶é›†å‘ç”Ÿä¸»å¤‡èŠ‚ç‚¹åˆ‡æ¢çš„æƒ…å†µä¸‹ï¼Œä¼šå‡ºç°çŸ­æš‚çš„æ— ä¸»èŠ‚ç‚¹é˜¶æ®µï¼Œæ­¤æ—¶æ— æ³•æ¥å—ä¸šåŠ¡å†™æ“ä½œã€‚ æ—©æœŸçš„ç‰ˆæœ¬ä¸­éœ€è¦æ·»åŠ retryWriteså‚æ•°ï¼Œç°åœ¨å·²ç»é»˜è®¤å¼€å¯äº† 1mongosh &quot;mongodb://user:password@10.1.2.26:27017,10.1.2.142:27017,10.1.2.41:27017/test?authSource=admin&amp;replicaSet=rs0&amp;retryWrites=true&quot; SpringBooté›†æˆMongoDBé›†ç¾¤ 1234spring: data: mongodb: uri: mongodb://user:password@127.0.0.1:27040,127.0.0.1:27041,127.0.0.1:27042/mytest?authSource=admin&amp;readPreference=primaryPreferred","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç»Linuxä¸‹MongoDB7.0å¤åˆ¶é›†çš„å®‰è£…å’Œä½¿ç”¨ MongoDBå®˜æ–¹æ–‡æ¡£ æœ¬æ–‡åŸºäºCentOS8(x86_64) Mongodbåˆ†ç‰‡é›†ç¾¤æ­å»ºå‚çœ‹MongoDB åˆ†ç‰‡é›†ç¾¤æ­å»ºï¼Œè™½ç„¶æ˜¯åŸºäº4.4ç‰ˆæœ¬çš„ï¼Œä½†æ˜¯å®‰è£…æ–¹å¼å·®åˆ«ä¸å¤§ï¼Œåªæ˜¯é…ç½®æ–‡ä»¶ä¸­ä¸ªåˆ«çš„å±æ€§åç§°å‘ç”Ÿäº†å˜åŒ–ã€‚","date_published":"2024-03-29T13:30:05.000Z","tags":["æŠ€æœ¯","linux","mongodb","mongodb"]},{"id":"https://blog.hanqunfeng.com/2024/03/28/ansible-useful-demo/","url":"https://blog.hanqunfeng.com/2024/03/28/ansible-useful-demo/","title":"Ansible ä¸€äº›æœ‰ç”¨çš„å°Demo","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç» Ansible çš„ä¸€äº›ä½¿ç”¨æŠ€å·§ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å…³äºAnsibleçš„ä»‹ç»å¯ä»¥å‚çœ‹ <a href=\"/2024/03/19/linux-command15-ansible/\" title=\"Linuxå¸¸ç”¨å‘½ä»¤--Ansible\">Linuxå¸¸ç”¨å‘½ä»¤--Ansible</a></p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"å°†åŒç»„å†…æœºå™¨åˆ«åè®¾ç½®åˆ°hostsä¸­\">å°†åŒç»„å†…æœºå™¨åˆ«åè®¾ç½®åˆ°<code>hosts</code>ä¸­</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>inventory</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[test-mongo]</span><br><span class=\"line\">10.1.2.249 hostname=mongodb.db0</span><br><span class=\"line\">10.1.2.184 hostname=mongodb.db1</span><br><span class=\"line\">10.1.2.178 hostname=mongodb.db2</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>tasks</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- name: Set static hostname <span class=\"keyword\">in</span> /etc/hosts</span><br><span class=\"line\">  lineinfile:</span><br><span class=\"line\">    path: /etc/hosts</span><br><span class=\"line\">    line: <span class=\"string\">&quot;&#123;&#123; item &#125;&#125; &#123;&#123; hostvars[item].hostname | default(&#x27;mongodb.db&#x27; ~ index)  &#125;&#125;&quot;</span></span><br><span class=\"line\">    state: present</span><br><span class=\"line\">  loop: <span class=\"string\">&quot;&#123;&#123; groups[group_names[0]] &#125;&#125;&quot;</span></span><br><span class=\"line\">  loop_control:</span><br><span class=\"line\">    index_var: index <span class=\"comment\"># å¾ªç¯ç´¢å¼•å˜é‡ï¼Œä»0å¼€å§‹ï¼Œansible&gt;2.14+</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¯´æ˜</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">10.1.2.249 hostname=mongodb.db03 : è¿™é‡Œhostnameå°±æ˜¯è¦è®¾ç½®ç»™å½“å‰ä¸»æœºçš„å˜é‡ï¼Œå¤šä¸ªå˜é‡ç©ºæ ¼åˆ†å‰²</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">groups</span>[key] : è·å–æŒ‡å®šç»„å†…çš„ipæ•°ç»„ï¼Œkeyä¸ºç»„å</span><br><span class=\"line\">group_names[0] : è·å–è¿è¡Œå½“å‰è„šæœ¬çš„ç¬¬ä¸€ä¸ªç»„å</span><br><span class=\"line\">hostvars[item].hostname : è·å–æŒ‡å®šipçš„å˜é‡åç§°ä¸ºhostnameçš„å€¼</span><br><span class=\"line\">default(<span class=\"string\">&#x27;mongodb.db&#x27;</span> ~ index) : è®¾ç½®ç¼ºçœå€¼ï¼Œå³å¦‚æœæ²¡æœ‰è®¾ç½®hostnameï¼Œåˆ™é»˜è®¤ä¸ºmongodb.db[0~2]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># è·å–é™¤äº†å½“å‰ä¸»æœºå¤–çš„ipæ•°ç»„</span></span><br><span class=\"line\">&#123;&#123; <span class=\"built_in\">groups</span>[group_names[0]] | difference([inventory_hostname]) &#125;&#125;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¿™é‡Œç”¨åˆ°äº†<code>loop</code>ï¼Œå…³äº<code>loop</code>çš„ç”¨æ³•å¯ä»¥å‚è€ƒ<a href=\"https://docs.ansible.com/ansible/latest/playbook_guide/playbooks_loops.html\">å®˜æ–¹æ–‡æ¡£</a></p>\n</li>\n</ul>\n","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» Ansible çš„ä¸€äº›ä½¿ç”¨æŠ€å·§ã€‚ å…³äºAnsibleçš„ä»‹ç»å¯ä»¥å‚çœ‹ Linuxå¸¸ç”¨å‘½ä»¤--Ansible å°†åŒç»„å†…æœºå™¨åˆ«åè®¾ç½®åˆ°hostsä¸­ inventory 1234[test-mongo]10.1.2.249 hostname=mongodb.db010.1.2.184 hostname=mongodb.db110.1.2.178 hostname=mongodb.db2 tasks 12345678- name: Set static hostname in /etc/hosts lineinfile: path: /etc/hosts line: &quot;&#123;&#123; item &#125;&#125; &#123;&#123; hostvars[item].hostname | default(&#x27;mongodb.db&#x27; ~ index) &#125;&#125;&quot; state: present loop: &quot;&#123;&#123; groups[group_names[0]] &#125;&#125;&quot; loop_control: index_var: index # å¾ªç¯ç´¢å¼•å˜é‡ï¼Œä»0å¼€å§‹ï¼Œansible&gt;2.14+ è¯´æ˜ 12345678910.1.2.249 hostname=mongodb.db03 : è¿™é‡Œhostnameå°±æ˜¯è¦è®¾ç½®ç»™å½“å‰ä¸»æœºçš„å˜é‡ï¼Œå¤šä¸ªå˜é‡ç©ºæ ¼åˆ†å‰²groups[key] : è·å–æŒ‡å®šç»„å†…çš„ipæ•°ç»„ï¼Œkeyä¸ºç»„ågroup_names[0] : è·å–è¿è¡Œå½“å‰è„šæœ¬çš„ç¬¬ä¸€ä¸ªç»„åhostvars[item].hostname : è·å–æŒ‡å®šipçš„å˜é‡åç§°ä¸ºhostnameçš„å€¼default(&#x27;mongodb.db&#x27; ~ index) : è®¾ç½®ç¼ºçœå€¼ï¼Œå³å¦‚æœæ²¡æœ‰è®¾ç½®hostnameï¼Œåˆ™é»˜è®¤ä¸ºmongodb.db[0~2]# è·å–é™¤äº†å½“å‰ä¸»æœºå¤–çš„ipæ•°ç»„&#123;&#123; groups[group_names[0]] | difference([inventory_hostname]) &#125;&#125; è¿™é‡Œç”¨åˆ°äº†loopï¼Œå…³äºloopçš„ç”¨æ³•å¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» Ansible çš„ä¸€äº›ä½¿ç”¨æŠ€å·§ã€‚ å…³äºAnsibleçš„ä»‹ç»å¯ä»¥å‚çœ‹ Linuxå¸¸ç”¨å‘½ä»¤--Ansible","date_published":"2024-03-28T13:30:05.000Z","tags":["æŠ€æœ¯","linux","linuxå¸¸ç”¨å‘½ä»¤","Ansible","linuxå¸¸ç”¨å‘½ä»¤","Ansible"]},{"id":"https://blog.hanqunfeng.com/2024/03/27/ansible-collection-publish/","url":"https://blog.hanqunfeng.com/2024/03/27/ansible-collection-publish/","title":"Ansible Collection Publish To Galaxy","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç»å¦‚ä½•å°†Ansible Collectionå‘å¸ƒåˆ°Galaxyã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å…³äºAnsibleçš„ä»‹ç»å¯ä»¥å‚çœ‹ <a href=\"/2024/03/19/linux-command15-ansible/\" title=\"Linuxå¸¸ç”¨å‘½ä»¤--Ansible\">Linuxå¸¸ç”¨å‘½ä»¤--Ansible</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>å…³äºå°†Ansible Roleå‘å¸ƒåˆ°Galaxyçš„è¯¦ç»†ä»‹ç»å¯ä»¥å‚çœ‹ <a href=\"/2024/03/26/ansible-role-publish/\" title=\"Ansible Role Publish To Galaxy\">Ansible Role Publish To Galaxy</a></p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"åˆ›å»ºCollection\">åˆ›å»ºCollection</h2>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åœ¨å½“å‰ç›®å½•ä¸‹åˆ›å»ºcollection</span></span><br><span class=\"line\"><span class=\"comment\"># æ³¨æ„è¿™é‡Œçš„collerctionåç§°æ ¼å¼ä¸º namespace.collectionï¼Œåç§°åªæ”¯æŒ [a-zA-Z0-9_]</span></span><br><span class=\"line\">$ ansible-galaxy collection init hanqunfeng.install_mongodb</span><br><span class=\"line\">- Collection hanqunfeng.install_mongodb was created successfully</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç›®å½•ç»“æ„</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hanqunfeng</span><br><span class=\"line\">â””â”€â”€ install_mongodb</span><br><span class=\"line\">   â”œâ”€â”€ docs</span><br><span class=\"line\">   â”œâ”€â”€ galaxy.yml</span><br><span class=\"line\">   â”œâ”€â”€ meta</span><br><span class=\"line\">   â”‚  â””â”€â”€ runtime.yml</span><br><span class=\"line\">   â”œâ”€â”€ plugins</span><br><span class=\"line\">   â”‚  â””â”€â”€ README.md</span><br><span class=\"line\">   â”œâ”€â”€ README.md</span><br><span class=\"line\">   â””â”€â”€ roles</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>åœ¨<code>galaxy.yml</code>ä¸­é…ç½®collectionçš„å…ƒæ•°æ®<br>\nåœ¨<code>runtime.yml</code>ä¸­é…ç½®collectionçš„è¿è¡Œæ—¶ä¾èµ–<br>\nåœ¨<code>README.md</code>ä¸­é…ç½®collectionçš„æè¿°ä¿¡æ¯<br>\nåœ¨<code>roles</code>ä¸­åˆ›å»ºroleï¼Œè¿™é‡Œå¯ä»¥åˆ›å»ºå¤šä¸ªroleï¼Œæˆ‘è¿™é‡Œå°†ä¸Šé¢åˆ›å»ºçš„roleå¤åˆ¶åˆ°<code>roles</code>ç›®å½•ä¸‹ï¼Œä¸è¿‡åç§°éœ€è¦ä¿®æ”¹ä¸€ä¸‹ï¼Œä¸æ”¯æŒä¸‹åˆ’çº¿ï¼Œæ‰€ä»¥è¿™é‡Œå°†roleçš„åç§°æ”¹ä¸º<code>centos_mongodb_install</code></p>\n</blockquote>\n<p>ç›¸å…³ä»£ç å‚è€ƒ:<a href=\"https://github.com/hanqunfeng/ansible_collections\">https://github.com/hanqunfeng/ansible_collections</a></p>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ„å»ºcollectionçš„taråŒ…</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æ„å»ºcollectionçš„taråŒ…æ—¶å…ˆè¦è¿›å…¥namespaceç›®å½•ä¸‹</span></span><br><span class=\"line\">$ <span class=\"built_in\">cd</span> hanqunfeng</span><br><span class=\"line\"><span class=\"comment\"># æŒ‡å®šcollectionçš„ç›®å½•åç§°ï¼Œä¼šåŸºäºæˆ‘ä»¬åœ¨ galaxy.ymlä¸­çš„é…ç½®ä¿¡æ¯ç”ŸæˆtaråŒ…</span></span><br><span class=\"line\">$ ansible-galaxy collection build install_mongodb</span><br><span class=\"line\">Created collection <span class=\"keyword\">for</span> hanqunfeng.install_mongodb at /Users/hanqf/ansible_workspace/collections/hanqunfeng/hanqunfeng-install_mongodb-1.0.0.tar.gz</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¸Šä¼ collectionåˆ°Galaxy<br>\n<img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/iOTd1D.png\" alt=\"\"><br>\n<img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/bl2Pkq.png\" alt=\"\"><br>\n<img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/RohfLq.png\" alt=\"\"><br>\n<img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/Mmmxcs.png\" alt=\"\"><br>\n<img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/rmsiSe.png\" alt=\"\"></p>\n</li>\n<li class=\"lvl-2\">\n<p>æœç´¢collection<br>\n<img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/KHYzXd.png\" alt=\"\"><br>\n<img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/b0KQkB.png\" alt=\"\"></p>\n</li>\n<li class=\"lvl-2\">\n<p>å®‰è£…collection</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># é»˜è®¤å®‰è£…æœ€æ–°ç‰ˆæœ¬</span></span><br><span class=\"line\">$ ansible-galaxy collection install hanqunfeng.install_mongodb</span><br><span class=\"line\">Starting galaxy collection install process</span><br><span class=\"line\">Process install dependency map</span><br><span class=\"line\">Starting collection install process</span><br><span class=\"line\">Downloading https://galaxy.ansible.com/api/v3/plugin/ansible/content/published/collections/artifacts/hanqunfeng-install_mongodb-1.0.0.tar.gz to /Users/hanqf/.ansible/tmp/ansible-local-322947_s0gv88/tmp1fbnqss_/hanqunfeng-install_mongodb-1.0.0-s2wczaen</span><br><span class=\"line\">Installing <span class=\"string\">&#x27;hanqunfeng.install_mongodb:1.0.0&#x27;</span> to <span class=\"string\">&#x27;/Users/hanqf/.ansible/collections/ansible_collections/hanqunfeng/install_mongodb&#x27;</span></span><br><span class=\"line\">hanqunfeng.install_mongodb:1.0.0 was installed successfully</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å‡çº§å®‰è£…æ—¶éœ€è¦åŠ ä¸Š --force</span></span><br><span class=\"line\">ansible-galaxy collection install --force hanqunfeng.install_mongodb</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹å·²å®‰è£…çš„role</span></span><br><span class=\"line\">ansible-galaxy collection list</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä½¿ç”¨collection</p>\n</li>\n</ul>\n<figure class=\"highlight yml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">hosts:</span> <span class=\"string\">test-mongo</span></span><br><span class=\"line\">  <span class=\"attr\">become:</span> <span class=\"literal\">yes</span>  <span class=\"comment\"># åˆ‡æ¢åˆ°rootç”¨æˆ·ä¸‹æ‰§è¡Œ</span></span><br><span class=\"line\">  <span class=\"attr\">roles:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">hanqunfeng.install_mongodb.centos_mongodb_install</span> <span class=\"comment\"># &lt;namespace&gt;.&lt;collection_name&gt;.&lt;role_name&gt;</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ é™¤collection</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æ²¡æœ‰ç°æˆçš„removeå‘½ä»¤ï¼Œåªèƒ½æ‰‹åŠ¨åˆ é™¤</span></span><br><span class=\"line\">$ <span class=\"built_in\">rm</span> -rf ~/.ansible/collections/ansible_collections/hanqunfeng/install_mongodb</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ›´æ–°collection<br>\n<img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/lZjgci.png\" alt=\"\"><br>\n<img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/7QzrmF.png\" alt=\"\"></p>\n</li>\n<li class=\"lvl-2\">\n<p>é‡æ–°å®‰è£…collection</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># é»˜è®¤å®‰è£…æœ€æ–°ç‰ˆæœ¬</span></span><br><span class=\"line\">$ ansible-galaxy collection install --force hanqunfeng.install_mongodb</span><br><span class=\"line\">Starting galaxy collection install process</span><br><span class=\"line\">Process install dependency map</span><br><span class=\"line\">Starting collection install process</span><br><span class=\"line\">Downloading https://galaxy.ansible.com/api/v3/plugin/ansible/content/published/collections/artifacts/hanqunfeng-install_mongodb-1.0.1.tar.gz to /Users/hanqf/.ansible/tmp/ansible-local-530779nbn853q/tmpiuxg6ads/hanqunfeng-install_mongodb-1.0.1-ep0cswny</span><br><span class=\"line\">Installing <span class=\"string\">&#x27;hanqunfeng.install_mongodb:1.0.1&#x27;</span> to <span class=\"string\">&#x27;/Users/hanqf/.ansible/collections/ansible_collections/hanqunfeng/install_mongodb&#x27;</span></span><br><span class=\"line\">hanqunfeng.install_mongodb:1.0.1 was installed successfully</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å®‰è£…æŒ‡å®šç‰ˆæœ¬</span></span><br><span class=\"line\">ansible-galaxy collection install  hanqunfeng.install_mongodb:1.0.1</span><br></pre></td></tr></table></figure>\n<h2 id=\"å‘½ä»¤è¡Œå‘å¸ƒcollection\">å‘½ä»¤è¡Œå‘å¸ƒcollection</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å…ˆè¦åœ¨ansible-galaxyç½‘ç«™ä¸Šè·å–<code>api-key</code><br>\n<img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/WGgnPL.png\" alt=\"\"></p>\n</li>\n<li class=\"lvl-2\">\n<p>å‘å¸ƒcollection</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æ³¨æ„æ›¿æ¢è‡ªå·±çš„ api-key</span></span><br><span class=\"line\">$ ansible-galaxy collection publish --token xxxxxxxxxxxxxxx hanqunfeng-install_mongodb-1.0.2.tar.gz</span><br><span class=\"line\">Publishing collection artifact <span class=\"string\">&#x27;/Users/hanqf/ansible_workspace/collections/hanqunfeng/hanqunfeng-install_mongodb-1.0.2.tar.gz&#x27;</span> to default https://galaxy.ansible.com/api/</span><br><span class=\"line\">Collection has been published to the Galaxy server default https://galaxy.ansible.com/api/</span><br><span class=\"line\">Waiting <span class=\"keyword\">until</span> Galaxy import task https://galaxy.ansible.com/api/v3/imports/collections/018e7f26-b771-7c47-9c92-14e671b776dc/ has completed</span><br><span class=\"line\">Collection has been successfully published and imported to the Galaxy server default https://galaxy.ansible.com/api/</span><br></pre></td></tr></table></figure>\n<h2 id=\"åè®°\">åè®°</h2>\n<p>ç›®å‰<code>2.16.4</code>è¿™ä¸ªç‰ˆæœ¬å°šä¸æ”¯æŒåœ¨å‘½ä»¤è¡Œæœç´¢collectionï¼Œåªèƒ½é€šè¿‡webç•Œé¢æœç´¢ã€‚</p>\n","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç»å¦‚ä½•å°†Ansible Collectionå‘å¸ƒåˆ°Galaxyã€‚ å…³äºAnsibleçš„ä»‹ç»å¯ä»¥å‚çœ‹ Linuxå¸¸ç”¨å‘½ä»¤--Ansible å…³äºå°†Ansible Roleå‘å¸ƒåˆ°Galaxyçš„è¯¦ç»†ä»‹ç»å¯ä»¥å‚çœ‹ Ansible Role Publish To Galaxy åˆ›å»ºCollection 1234# åœ¨å½“å‰ç›®å½•ä¸‹åˆ›å»ºcollection# æ³¨æ„è¿™é‡Œçš„collerctionåç§°æ ¼å¼ä¸º namespace.collectionï¼Œåç§°åªæ”¯æŒ [a-zA-Z0-9_]$ ansible-galaxy collection init hanqunfeng.install_mongodb- Collection hanqunfeng.install_mongodb was created successfully ç›®å½•ç»“æ„ 12345678910hanqunfengâ””â”€â”€ install_mongodb â”œâ”€â”€ docs â”œâ”€â”€ galaxy.yml â”œâ”€â”€ meta â”‚ â””â”€â”€ runtime.yml â”œâ”€â”€ plugins â”‚ â””â”€â”€ README.md â”œâ”€â”€ README.md â””â”€â”€ roles åœ¨galaxy.ymlä¸­é…ç½®collectionçš„å…ƒæ•°æ® åœ¨runtime.ymlä¸­é…ç½®collectionçš„è¿è¡Œæ—¶ä¾èµ– åœ¨README.mdä¸­é…ç½®collectionçš„æè¿°ä¿¡æ¯ åœ¨rolesä¸­åˆ›å»ºroleï¼Œè¿™é‡Œå¯ä»¥åˆ›å»ºå¤šä¸ªroleï¼Œæˆ‘è¿™é‡Œå°†ä¸Šé¢åˆ›å»ºçš„roleå¤åˆ¶åˆ°rolesç›®å½•ä¸‹ï¼Œä¸è¿‡åç§°éœ€è¦ä¿®æ”¹ä¸€ä¸‹ï¼Œä¸æ”¯æŒä¸‹åˆ’çº¿ï¼Œæ‰€ä»¥è¿™é‡Œå°†roleçš„åç§°æ”¹ä¸ºcentos_mongodb_install ç›¸å…³ä»£ç å‚è€ƒ:https://github.com/hanqunfeng/ansible_collections æ„å»ºcollectionçš„taråŒ… 12345# æ„å»ºcollectionçš„taråŒ…æ—¶å…ˆè¦è¿›å…¥namespaceç›®å½•ä¸‹$ cd hanqunfeng# æŒ‡å®šcollectionçš„ç›®å½•åç§°ï¼Œä¼šåŸºäºæˆ‘ä»¬åœ¨ galaxy.ymlä¸­çš„é…ç½®ä¿¡æ¯ç”ŸæˆtaråŒ…$ ansible-galaxy collection build install_mongodbCreated collection for hanqunfeng.install_mongodb at /Users/hanqf/ansible_workspace/collections/hanqunfeng/hanqunfeng-install_mongodb-1.0.0.tar.gz ä¸Šä¼ collectionåˆ°Galaxy æœç´¢collection å®‰è£…collection 1234567891011121314# é»˜è®¤å®‰è£…æœ€æ–°ç‰ˆæœ¬$ ansible-galaxy collection install hanqunfeng.install_mongodbStarting galaxy collection install processProcess install dependency mapStarting collection install processDownloading https://galaxy.ansible.com/api/v3/plugin/ansible/content/published/collections/artifacts/hanqunfeng-install_mongodb-1.0.0.tar.gz to /Users/hanqf/.ansible/tmp/ansible-local-322947_s0gv88/tmp1fbnqss_/hanqunfeng-install_mongodb-1.0.0-s2wczaenInstalling &#x27;hanqunfeng.install_mongodb:1.0.0&#x27; to &#x27;/Users/hanqf/.ansible/collections/ansible_collections/hanqunfeng/install_mongodb&#x27;hanqunfeng.install_mongodb:1.0.0 was installed successfully# å‡çº§å®‰è£…æ—¶éœ€è¦åŠ ä¸Š --forceansible-galaxy collection install --force hanqunfeng.install_mongodb# æŸ¥çœ‹å·²å®‰è£…çš„roleansible-galaxy collection list ä½¿ç”¨collection 12345---- hosts: test-mongo become: yes # åˆ‡æ¢åˆ°rootç”¨æˆ·ä¸‹æ‰§è¡Œ roles: - hanqunfeng.install_mongodb.centos_mongodb_install # &lt;namespace&gt;.&lt;collection_name&gt;.&lt;role_name&gt; åˆ é™¤collection 12# æ²¡æœ‰ç°æˆçš„removeå‘½ä»¤ï¼Œåªèƒ½æ‰‹åŠ¨åˆ é™¤$ rm -rf ~/.ansible/collections/ansible_collections/hanqunfeng/install_mongodb æ›´æ–°collection é‡æ–°å®‰è£…collection 123456789101112# é»˜è®¤å®‰è£…æœ€æ–°ç‰ˆæœ¬$ ansible-galaxy collection install --force hanqunfeng.install_mongodbStarting galaxy collection install processProcess install dependency mapStarting collection install processDownloading https://galaxy.ansible.com/api/v3/plugin/ansible/content/published/collections/artifacts/hanqunfeng-install_mongodb-1.0.1.tar.gz to /Users/hanqf/.ansible/tmp/ansible-local-530779nbn853q/tmpiuxg6ads/hanqunfeng-install_mongodb-1.0.1-ep0cswnyInstalling &#x27;hanqunfeng.install_mongodb:1.0.1&#x27; to &#x27;/Users/hanqf/.ansible/collections/ansible_collections/hanqunfeng/install_mongodb&#x27;hanqunfeng.install_mongodb:1.0.1 was installed successfully# å®‰è£…æŒ‡å®šç‰ˆæœ¬ansible-galaxy collection install hanqunfeng.install_mongodb:1.0.1 å‘½ä»¤è¡Œå‘å¸ƒcollection å…ˆè¦åœ¨ansible-galaxyç½‘ç«™ä¸Šè·å–api-key å‘å¸ƒcollection 123456# æ³¨æ„æ›¿æ¢è‡ªå·±çš„ api-key$ ansible-galaxy collection publish --token xxxxxxxxxxxxxxx hanqunfeng-install_mongodb-1.0.2.tar.gzPublishing collection artifact &#x27;/Users/hanqf/ansible_workspace/collections/hanqunfeng/hanqunfeng-install_mongodb-1.0.2.tar.gz&#x27; to default https://galaxy.ansible.com/api/Collection has been published to the Galaxy server default https://galaxy.ansible.com/api/Waiting until Galaxy import task https://galaxy.ansible.com/api/v3/imports/collections/018e7f26-b771-7c47-9c92-14e671b776dc/ has completedCollection has been successfully published and imported to the Galaxy server default https://galaxy.ansible.com/api/ åè®° ç›®å‰2.16.4è¿™ä¸ªç‰ˆæœ¬å°šä¸æ”¯æŒåœ¨å‘½ä»¤è¡Œæœç´¢collectionï¼Œåªèƒ½é€šè¿‡webç•Œé¢æœç´¢ã€‚","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç»å¦‚ä½•å°†Ansible Collectionå‘å¸ƒåˆ°Galaxyã€‚ å…³äºAnsibleçš„ä»‹ç»å¯ä»¥å‚çœ‹ Linuxå¸¸ç”¨å‘½ä»¤--Ansible å…³äºå°†Ansible Roleå‘å¸ƒåˆ°Galaxyçš„è¯¦ç»†ä»‹ç»å¯ä»¥å‚çœ‹ Ansible Role Publish To Galaxy","date_published":"2024-03-27T13:30:05.000Z","tags":["æŠ€æœ¯","linux","linuxå¸¸ç”¨å‘½ä»¤","Ansible","linuxå¸¸ç”¨å‘½ä»¤","Ansible"]},{"id":"https://blog.hanqunfeng.com/2024/03/26/ansible-role-publish/","url":"https://blog.hanqunfeng.com/2024/03/26/ansible-role-publish/","title":"Ansible Role Publish To Galaxy","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç»å¦‚ä½•å°†Ansible Roleå‘å¸ƒåˆ°Galaxyã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å…³äºAnsibleçš„ä»‹ç»å¯ä»¥å‚çœ‹ <a href=\"/2024/03/19/linux-command15-ansible/\" title=\"Linuxå¸¸ç”¨å‘½ä»¤--Ansible\">Linuxå¸¸ç”¨å‘½ä»¤--Ansible</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>å…³äºå°†Ansible Collectionå‘å¸ƒåˆ°Galaxyçš„è¯¦ç»†ä»‹ç»å¯ä»¥å‚çœ‹ <a href=\"/2024/03/27/ansible-collection-publish/\" title=\"Ansible Collection Publish To Galaxy\">Ansible Collection Publish To Galaxy</a></p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"åˆ›å»ºRole\">åˆ›å»ºRole</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åœ¨å½“å‰ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªåç§°ä¸º<code>mongodb-install</code>çš„roleï¼Œå®é™…ä¸Šå°±æ˜¯åˆ›å»ºä¸€ä¸ªåç§°ä¸º<code>mongodb-install</code>çš„ç›®å½•ç»“æ„</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ansible-galaxy init mongodb-install</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ›å»ºå®Œæˆåï¼Œç›®å½•ç»“æ„å¦‚ä¸‹ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mongodb-install</span><br><span class=\"line\">â”œâ”€â”€ defaults</span><br><span class=\"line\">â”‚  â””â”€â”€ main.yml</span><br><span class=\"line\">â”œâ”€â”€ files</span><br><span class=\"line\">â”œâ”€â”€ handlers</span><br><span class=\"line\">â”‚  â””â”€â”€ main.yml</span><br><span class=\"line\">â”œâ”€â”€ meta</span><br><span class=\"line\">â”‚  â””â”€â”€ main.yml</span><br><span class=\"line\">â”œâ”€â”€ README.md</span><br><span class=\"line\">â”œâ”€â”€ tasks</span><br><span class=\"line\">â”‚  â””â”€â”€ main.yml</span><br><span class=\"line\">â”œâ”€â”€ templates</span><br><span class=\"line\">â”œâ”€â”€ tests</span><br><span class=\"line\">â”‚  â”œâ”€â”€ inventory</span><br><span class=\"line\">â”‚  â””â”€â”€ test.yml</span><br><span class=\"line\">â””â”€â”€ vars</span><br><span class=\"line\">   â””â”€â”€ main.yml</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç¼–è¾‘roleï¼Œç›¸å…³ä»£ç å‚è€ƒ<a href=\"https://github.com/hanqunfeng/ansible-role-mongodb\">https://github.com/hanqunfeng/ansible-role-mongodb</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>è¿™é‡Œæˆ‘ä»¬è¦æ³¨æ„ä¸¤ä¸ªæ–‡ä»¶</p>\n</li>\n</ul>\n<blockquote>\n<p><code>README.md</code>: è¿™é‡Œé¢é…ç½®çš„æ˜¯roleçš„æè¿°ä¿¡æ¯ï¼Œå…¶ä¼šæ˜¾ç¤ºåœ¨<code>æ–‡æ¡£</code>ä¸€æ ä¸­<br>\n<code>meta/main.yml</code>ï¼Œè¿™é‡Œé¢é…ç½®çš„æ˜¯roleçš„ä½œè€…ä¿¡æ¯</p>\n</blockquote>\n<h2 id=\"ä¸Šä¼ Roleåˆ°Github\">ä¸Šä¼ Roleåˆ°Github</h2>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> mongodb-install</span><br><span class=\"line\">git init</span><br><span class=\"line\">git add .</span><br><span class=\"line\">git commit -m <span class=\"string\">&quot;init&quot;</span></span><br><span class=\"line\">git branch -M main</span><br><span class=\"line\">git remote add origin https://github.com/hanqunfeng/ansible-role-mongodb.git</span><br><span class=\"line\">git push -u origin main</span><br></pre></td></tr></table></figure>\n<h2 id=\"å‘å¸ƒRoleåˆ°Galaxy\">å‘å¸ƒRoleåˆ°Galaxy</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç™»å½•<a href=\"https://galaxy.ansible.com/\">https://galaxy.ansible.com/</a>ï¼Œç‚¹å‡»<code>ç™»å½•</code>ï¼Œä½¿ç”¨Githubè´¦å·ç™»å½•ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å¯¼å…¥Role<br>\n<img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/w1UxvL.png\" alt=\"\"></p>\n</li>\n<li class=\"lvl-2\">\n<p>å¡«å†™Roleä¿¡æ¯<br>\n<img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/OnIT3a.png\" alt=\"\"></p>\n</li>\n<li class=\"lvl-2\">\n<p>æŸ¥çœ‹å¯¼å…¥çŠ¶æ€<br>\n<img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/7Dghla.png\" alt=\"\"></p>\n</li>\n<li class=\"lvl-2\">\n<p>æœç´¢Role<br>\næ­¤æ—¶æˆ‘ä»¬åœ¨è§’è‰²åˆ—è¡¨ä¸­æœç´¢å…³é”®å­—<code>hanqunfeng</code>ï¼Œå°±å¯ä»¥æœç´¢åˆ°æˆ‘ä»¬åˆšåˆšä¸Šä¼ çš„é‚£ä¸ªroleäº†<br>\n<img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/lx7rCg.png\" alt=\"\"></p>\n</li>\n<li class=\"lvl-2\">\n<p>ç‚¹å‡»è¿›å»æˆ‘ä»¬å°±å¯ä»¥æŸ¥çœ‹è§’è‰²çš„è¯¦ç»†ä¿¡æ¯äº†</p>\n</li>\n</ul>\n<h2 id=\"ä¿®æ”¹Role\">ä¿®æ”¹Role</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¿®æ”¹äº†roleä¿¡æ¯åï¼Œé‡æ–°ä¸Šä¼ åˆ°githubå³å¯</p>\n</li>\n<li class=\"lvl-2\">\n<p>å¦‚æœåŒæ—¶ä¿®æ”¹äº†<code>README.md</code>ç­‰roleä¿¡æ¯ï¼Œå¯ä»¥åœ¨galaxyä¸­é‡æ–°ä¸Šä¼ å³å¯<br>\n<img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/PVNRGz.png\" alt=\"\"></p>\n</li>\n</ul>\n<h2 id=\"å®‰è£…Role\">å®‰è£…Role</h2>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å®‰è£…</span></span><br><span class=\"line\">$ ansible-galaxy role install hanqunfeng.mongodb-install</span><br><span class=\"line\">Starting galaxy role install process</span><br><span class=\"line\">- downloading role <span class=\"string\">&#x27;mongodb-install&#x27;</span>, owned by hanqunfeng</span><br><span class=\"line\">- downloading role from https://github.com/hanqunfeng/ansible-role-mongodb/archive/main.tar.gz</span><br><span class=\"line\">- extracting hanqunfeng.mongodb-install to /Users/hanqf/.ansible/roles/hanqunfeng.mongodb-install</span><br><span class=\"line\">- hanqunfeng.mongodb-install (main) was installed successfully</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># é‡æ–°å®‰è£…</span></span><br><span class=\"line\">ansible-galaxy role install --force hanqunfeng.mongodb-install</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹å·²å®‰è£…çš„role</span></span><br><span class=\"line\">ansible-galaxy role list</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åˆ é™¤</span></span><br><span class=\"line\">$ ansible-galaxy role remove hanqunfeng.mongodb-install</span><br><span class=\"line\">- successfully removed hanqunfeng.mongodb-install</span><br></pre></td></tr></table></figure>\n<h2 id=\"ä½¿ç”¨Role\">ä½¿ç”¨Role</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åœ¨<code>playbook</code>ä¸­å¼•ç”¨role</p>\n</li>\n</ul>\n<figure class=\"highlight yml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">hosts:</span> <span class=\"string\">test-mongo</span></span><br><span class=\"line\">  <span class=\"attr\">become:</span> <span class=\"literal\">yes</span>  <span class=\"comment\"># åˆ‡æ¢åˆ°rootç”¨æˆ·ä¸‹æ‰§è¡Œ</span></span><br><span class=\"line\">  <span class=\"attr\">roles:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">hanqunfeng.mongodb-install</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ‰§è¡Œplaybook</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ansible-playbook -i hosts playbook.yml</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ›¿æ¢é»˜è®¤çš„å˜é‡</span></span><br><span class=\"line\">ansible-playbook -i hosts --extra-vars <span class=\"string\">&quot;mongo_port=27019&quot;</span> --extra-vars <span class=\"string\">&quot;mongo_replica_set_name=rs1&quot;</span> playbook.yml</span><br></pre></td></tr></table></figure>\n<h2 id=\"å‘å¸ƒæŒ‡å®šç‰ˆæœ¬åˆ°Galaxy\">å‘å¸ƒæŒ‡å®šç‰ˆæœ¬åˆ°Galaxy</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç»™è§’è‰²ä»£ç æ‰“tag</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åˆ›å»ºtagï¼Œåç§°ä¸º v1.0.0</span></span><br><span class=\"line\">git tag -a v1.0.0 -m <span class=\"string\">&quot;v1.0.0&quot;</span></span><br><span class=\"line\"><span class=\"comment\"># æäº¤tag</span></span><br><span class=\"line\">git push origin v1.0.0</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åœ¨galaxyä¸­é‡æ–°ä¸Šä¼ ï¼Œæ³¨æ„æ­¤æ—¶åœ¨è¦æŒ‡å®štagåç§°<br>\n<img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/sESeVk.png\" alt=\"\"></p>\n</li>\n<li class=\"lvl-2\">\n<p>ä¸Šä¼ æˆåŠŸåï¼Œå°±å¯ä»¥åœ¨galaxyä¸­æŸ¥çœ‹åˆ°å¯¹åº”çš„ç‰ˆæœ¬äº†<br>\n<img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/R18rBY.png\" alt=\"\"></p>\n</li>\n</ul>\n<h2 id=\"ä¸‹è½½æŒ‡å®šç‰ˆæœ¬çš„è§’è‰²\">ä¸‹è½½æŒ‡å®šç‰ˆæœ¬çš„è§’è‰²</h2>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æ³¨æ„roleå’Œç‰ˆæœ¬å·ä¹‹é—´ç”¨é€—å·éš”å¼€ï¼Œä¸åŠ ç‰ˆæœ¬å·ï¼Œåˆ™ä¸‹è½½æœ€æ–°ç‰ˆæœ¬</span></span><br><span class=\"line\">$ ansible-galaxy role install hanqunfeng.mongodb-install,v1.0.0</span><br><span class=\"line\">Starting galaxy role install process</span><br><span class=\"line\">- downloading role <span class=\"string\">&#x27;mongodb-install&#x27;</span>, owned by hanqunfeng</span><br><span class=\"line\">- downloading role from https://github.com/hanqunfeng/ansible-role-mongodb/archive/v1.0.0.tar.gz</span><br><span class=\"line\">- extracting hanqunfeng.mongodb-install to /Users/hanqf/.ansible/roles/hanqunfeng.mongodb-install</span><br><span class=\"line\">- hanqunfeng.mongodb-install (v1.0.0) was installed successfully</span><br></pre></td></tr></table></figure>\n<h2 id=\"æœç´¢è§’è‰²\">æœç´¢è§’è‰²</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>é™¤äº†åœ¨galaxyç½‘ç«™ä¸­æœç´¢ï¼Œè¿˜å¯ä»¥é€šè¿‡å‘½ä»¤è¡Œæœç´¢</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ ansible-galaxy search hanqunfeng</span><br><span class=\"line\"></span><br><span class=\"line\">Found 1 roles matching your search:</span><br><span class=\"line\"></span><br><span class=\"line\"> Name                       Description</span><br><span class=\"line\"> ----                       -----------</span><br><span class=\"line\"> hanqunfeng.mongodb-install CentOS 7&amp;8 MongoDB install role</span><br><span class=\"line\"></span><br><span class=\"line\"> <span class=\"comment\"># æˆ–è€…</span></span><br><span class=\"line\"> ansible-galaxy role search hanqunfeng</span><br></pre></td></tr></table></figure>\n","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç»å¦‚ä½•å°†Ansible Roleå‘å¸ƒåˆ°Galaxyã€‚ å…³äºAnsibleçš„ä»‹ç»å¯ä»¥å‚çœ‹ Linuxå¸¸ç”¨å‘½ä»¤--Ansible å…³äºå°†Ansible Collectionå‘å¸ƒåˆ°Galaxyçš„è¯¦ç»†ä»‹ç»å¯ä»¥å‚çœ‹ Ansible Collection Publish To Galaxy åˆ›å»ºRole åœ¨å½“å‰ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªåç§°ä¸ºmongodb-installçš„roleï¼Œå®é™…ä¸Šå°±æ˜¯åˆ›å»ºä¸€ä¸ªåç§°ä¸ºmongodb-installçš„ç›®å½•ç»“æ„ 1ansible-galaxy init mongodb-install åˆ›å»ºå®Œæˆåï¼Œç›®å½•ç»“æ„å¦‚ä¸‹ï¼š 1234567891011121314151617mongodb-installâ”œâ”€â”€ defaultsâ”‚ â””â”€â”€ main.ymlâ”œâ”€â”€ filesâ”œâ”€â”€ handlersâ”‚ â””â”€â”€ main.ymlâ”œâ”€â”€ metaâ”‚ â””â”€â”€ main.ymlâ”œâ”€â”€ README.mdâ”œâ”€â”€ tasksâ”‚ â””â”€â”€ main.ymlâ”œâ”€â”€ templatesâ”œâ”€â”€ testsâ”‚ â”œâ”€â”€ inventoryâ”‚ â””â”€â”€ test.ymlâ””â”€â”€ vars â””â”€â”€ main.yml ç¼–è¾‘roleï¼Œç›¸å…³ä»£ç å‚è€ƒhttps://github.com/hanqunfeng/ansible-role-mongodb è¿™é‡Œæˆ‘ä»¬è¦æ³¨æ„ä¸¤ä¸ªæ–‡ä»¶ README.md: è¿™é‡Œé¢é…ç½®çš„æ˜¯roleçš„æè¿°ä¿¡æ¯ï¼Œå…¶ä¼šæ˜¾ç¤ºåœ¨æ–‡æ¡£ä¸€æ ä¸­ meta/main.ymlï¼Œè¿™é‡Œé¢é…ç½®çš„æ˜¯roleçš„ä½œè€…ä¿¡æ¯ ä¸Šä¼ Roleåˆ°Github 1234567cd mongodb-installgit initgit add .git commit -m &quot;init&quot;git branch -M maingit remote add origin https://github.com/hanqunfeng/ansible-role-mongodb.gitgit push -u origin main å‘å¸ƒRoleåˆ°Galaxy ç™»å½•https://galaxy.ansible.com/ï¼Œç‚¹å‡»ç™»å½•ï¼Œä½¿ç”¨Githubè´¦å·ç™»å½•ã€‚ å¯¼å…¥Role å¡«å†™Roleä¿¡æ¯ æŸ¥çœ‹å¯¼å…¥çŠ¶æ€ æœç´¢Role æ­¤æ—¶æˆ‘ä»¬åœ¨è§’è‰²åˆ—è¡¨ä¸­æœç´¢å…³é”®å­—hanqunfengï¼Œå°±å¯ä»¥æœç´¢åˆ°æˆ‘ä»¬åˆšåˆšä¸Šä¼ çš„é‚£ä¸ªroleäº† ç‚¹å‡»è¿›å»æˆ‘ä»¬å°±å¯ä»¥æŸ¥çœ‹è§’è‰²çš„è¯¦ç»†ä¿¡æ¯äº† ä¿®æ”¹Role ä¿®æ”¹äº†roleä¿¡æ¯åï¼Œé‡æ–°ä¸Šä¼ åˆ°githubå³å¯ å¦‚æœåŒæ—¶ä¿®æ”¹äº†README.mdç­‰roleä¿¡æ¯ï¼Œå¯ä»¥åœ¨galaxyä¸­é‡æ–°ä¸Šä¼ å³å¯ å®‰è£…Role 1234567891011121314151617# å®‰è£…$ ansible-galaxy role install hanqunfeng.mongodb-installStarting galaxy role install process- downloading role &#x27;mongodb-install&#x27;, owned by hanqunfeng- downloading role from https://github.com/hanqunfeng/ansible-role-mongodb/archive/main.tar.gz- extracting hanqunfeng.mongodb-install to /Users/hanqf/.ansible/roles/hanqunfeng.mongodb-install- hanqunfeng.mongodb-install (main) was installed successfully# é‡æ–°å®‰è£…ansible-galaxy role install --force hanqunfeng.mongodb-install# æŸ¥çœ‹å·²å®‰è£…çš„roleansible-galaxy role list# åˆ é™¤$ ansible-galaxy role remove hanqunfeng.mongodb-install- successfully removed hanqunfeng.mongodb-install ä½¿ç”¨Role åœ¨playbookä¸­å¼•ç”¨role 12345---- hosts: test-mongo become: yes # åˆ‡æ¢åˆ°rootç”¨æˆ·ä¸‹æ‰§è¡Œ roles: - hanqunfeng.mongodb-install æ‰§è¡Œplaybook 1234ansible-playbook -i hosts playbook.yml# æ›¿æ¢é»˜è®¤çš„å˜é‡ansible-playbook -i hosts --extra-vars &quot;mongo_port=27019&quot; --extra-vars &quot;mongo_replica_set_name=rs1&quot; playbook.yml å‘å¸ƒæŒ‡å®šç‰ˆæœ¬åˆ°Galaxy ç»™è§’è‰²ä»£ç æ‰“tag 1234# åˆ›å»ºtagï¼Œåç§°ä¸º v1.0.0git tag -a v1.0.0 -m &quot;v1.0.0&quot;# æäº¤taggit push origin v1.0.0 åœ¨galaxyä¸­é‡æ–°ä¸Šä¼ ï¼Œæ³¨æ„æ­¤æ—¶åœ¨è¦æŒ‡å®štagåç§° ä¸Šä¼ æˆåŠŸåï¼Œå°±å¯ä»¥åœ¨galaxyä¸­æŸ¥çœ‹åˆ°å¯¹åº”çš„ç‰ˆæœ¬äº† ä¸‹è½½æŒ‡å®šç‰ˆæœ¬çš„è§’è‰² 1234567# æ³¨æ„roleå’Œç‰ˆæœ¬å·ä¹‹é—´ç”¨é€—å·éš”å¼€ï¼Œä¸åŠ ç‰ˆæœ¬å·ï¼Œåˆ™ä¸‹è½½æœ€æ–°ç‰ˆæœ¬$ ansible-galaxy role install hanqunfeng.mongodb-install,v1.0.0Starting galaxy role install process- downloading role &#x27;mongodb-install&#x27;, owned by hanqunfeng- downloading role from https://github.com/hanqunfeng/ansible-role-mongodb/archive/v1.0.0.tar.gz- extracting hanqunfeng.mongodb-install to /Users/hanqf/.ansible/roles/hanqunfeng.mongodb-install- hanqunfeng.mongodb-install (v1.0.0) was installed successfully æœç´¢è§’è‰² é™¤äº†åœ¨galaxyç½‘ç«™ä¸­æœç´¢ï¼Œè¿˜å¯ä»¥é€šè¿‡å‘½ä»¤è¡Œæœç´¢ 12345678910$ ansible-galaxy search hanqunfengFound 1 roles matching your search: Name Description ---- ----------- hanqunfeng.mongodb-install CentOS 7&amp;8 MongoDB install role # æˆ–è€… ansible-galaxy role search hanqunfeng","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç»å¦‚ä½•å°†Ansible Roleå‘å¸ƒåˆ°Galaxyã€‚ å…³äºAnsibleçš„ä»‹ç»å¯ä»¥å‚çœ‹ Linuxå¸¸ç”¨å‘½ä»¤--Ansible å…³äºå°†Ansible Collectionå‘å¸ƒåˆ°Galaxyçš„è¯¦ç»†ä»‹ç»å¯ä»¥å‚çœ‹ Ansible Collection Publish To Galaxy","date_published":"2024-03-26T13:30:05.000Z","tags":["æŠ€æœ¯","linux","linuxå¸¸ç”¨å‘½ä»¤","Ansible","linuxå¸¸ç”¨å‘½ä»¤","Ansible"]},{"id":"https://blog.hanqunfeng.com/2024/03/19/linux-command15-ansible/","url":"https://blog.hanqunfeng.com/2024/03/19/linux-command15-ansible/","title":"Linuxå¸¸ç”¨å‘½ä»¤--Ansible","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç»Ansibleçš„å®‰è£…å’Œä½¿ç”¨ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡åŸºäºCentOS8ã€‚</p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"Ansibleç®€ä»‹\">Ansibleç®€ä»‹</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Ansible æ˜¯ä¸€ä¸ªå¼€æºçš„è‡ªåŠ¨åŒ–è¿ç»´å·¥å…·ï¼Œå®ƒåŸºäº Python è¯­è¨€å¼€å‘ï¼Œæ”¯æŒè·¨å¹³å°ï¼Œå¯ä»¥è¿è¡Œåœ¨ Linuxã€Unixã€Mac OS Xã€Windows ç­‰å¤šç§ç³»ç»Ÿç¯å¢ƒã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>Ansibleç®€å•æ˜“ç”¨ï¼Œåªéœ€è¦åœ¨æ§åˆ¶ä¸»æœºä¸Šå®‰è£… Ansible å¹¶åœ¨è¢«ç®¡ç†ä¸»æœºä¸Šå®‰è£… Python 2.6 æˆ–æ›´é«˜ç‰ˆæœ¬å³å¯ï¼ˆç°æœ‰çš„å¼€æºLinuxç³»ç»ŸåŸºæœ¬éƒ½è‡ªå¸¦äº†Python ï¼Œæ‰€ä»¥ç›¸å½“äºè¿œç¨‹ä¸»æœºä»€ä¹ˆéƒ½ä¸éœ€è¦å®‰è£…ï¼‰ï¼Œå°±å¯ä»¥ç®¡ç†è¿œç¨‹ä¸»æœºå¯¹å…¶è¿›è¡Œè‡ªåŠ¨åŒ–é…ç½®ã€ç¼–æ’é«˜çº§å·¥ä½œæµç¨‹ä»¥æ”¯æŒåº”ç”¨ç¨‹åºéƒ¨ç½²ã€ç³»ç»Ÿæ›´æ–°ç­‰ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>Ansibleå¯ä»¥ç”¨æ¥ç®¡ç†Linuxã€Unixã€Windowsã€OpenStackã€AWSã€GCPã€OpenShiftã€Kubernetesç­‰ç³»ç»Ÿç¯å¢ƒã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>Ansibleå®˜ç½‘æ–‡æ¡£ï¼š<a href=\"https://docs.ansible.com/ansible/latest/\">https://docs.ansible.com/ansible/latest/</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>Ansibleä¸­æ–‡æƒå¨æŒ‡å—ï¼š<a href=\"https://ansible-tran.readthedocs.io/en/latest/index.html\">https://ansible-tran.readthedocs.io/en/latest/index.html</a></p>\n</li>\n</ul>\n<h2 id=\"Ansibleå®‰è£…\">Ansibleå®‰è£…</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Ansibleå®‰è£…æ–¹å¼æœ‰å¤šç§ï¼Œè¿™é‡Œä»‹ç»é€šè¿‡pipå®‰è£…ï¼Œå½“å‰ç³»ç»Ÿä¸­çš„pythonç‰ˆæœ¬ä¸ºpython3.9ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">python3 -m pip install ansible</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¦‚æœå°šæœªå®‰è£…pipï¼Œå¯ä»¥é€šè¿‡ä¸‹é¢çš„æ–¹æ³•è¿›è¡Œå®‰è£…</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget https://bootstrap.pypa.io/get-pip.py</span><br><span class=\"line\">python3 get-pip.py</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å®‰è£…å®Œæˆåï¼Œå¯ä»¥æŸ¥çœ‹ä¸€ä¸‹ç‰ˆæœ¬</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ansible --version</span><br><span class=\"line\">ansible [core 2.15.9]</span><br><span class=\"line\">  config file = None</span><br><span class=\"line\">  configured module search path = [<span class=\"string\">&#x27;/root/.ansible/plugins/modules&#x27;</span>, <span class=\"string\">&#x27;/usr/share/ansible/plugins/modules&#x27;</span>]</span><br><span class=\"line\">  ansible python module location = /usr/local/lib/python3.9/site-packages/ansible</span><br><span class=\"line\">  ansible collection location = /root/.ansible/collections:/usr/share/ansible/collections</span><br><span class=\"line\">  executable location = /usr/local/bin/ansible</span><br><span class=\"line\">  python version = 3.9.16 (main, Sep  8 2023, 00:00:00) [GCC 11.4.1 20230605 (Red Hat 11.4.1-2)] (/usr/bin/python3)</span><br><span class=\"line\">  jinja version = 3.1.3</span><br><span class=\"line\">  libyaml = True</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Ansibleå¸¸ç”¨å‚æ•°ï¼š</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>å‚æ•°</th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>-u</td>\n<td>æŒ‡å®šè¿æ¥åˆ°ä¸»æœºçš„ç”¨æˆ·å</td>\n</tr>\n<tr>\n<td>-i</td>\n<td>æŒ‡å®šè¿æ¥hostsæ–‡ä»¶çš„è·¯å¾„</td>\n</tr>\n<tr>\n<td>-k</td>\n<td>æŒ‡å®šè¿æ¥åˆ°ä¸»æœºçš„å¯†ç </td>\n</tr>\n<tr>\n<td>-m</td>\n<td>æŒ‡å®šæ¨¡å—åç§°ï¼Œå¯ä»¥æŒ‡å®šæ¨¡å—çš„å‚æ•°ï¼Œæ¯”å¦‚æŒ‡å®šshellæ¨¡å—çš„å‚æ•°ï¼š-m shell -a â€˜ls -lâ€™</td>\n</tr>\n<tr>\n<td>-a</td>\n<td>æŒ‡å®šæ¨¡å—çš„å‚æ•°ï¼Œæ¯”å¦‚æŒ‡å®šshellæ¨¡å—çš„å‚æ•°ï¼š-m shell -a â€˜ls -lâ€™</td>\n</tr>\n<tr>\n<td>-e</td>\n<td>æŒ‡å®šé™„åŠ å‚æ•°ï¼Œæ¯”å¦‚æŒ‡å®šshellç«¯å£ï¼š -e â€˜ansible_port=22â€™</td>\n</tr>\n<tr>\n<td>-b</td>\n<td>åˆ‡æ¢åˆ°rootæƒé™</td>\n</tr>\n<tr>\n<td>-f</td>\n<td>æŒ‡å®šå¹¶å‘è¿æ¥æ•°ï¼Œé»˜è®¤ä¸º5ï¼Œå³å¯ä»¥åŒæ—¶ç®¡ç†5å°ä¸»æœº</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"Ansibleçš„é…ç½®æ–‡ä»¶\">Ansibleçš„é…ç½®æ–‡ä»¶</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ansibleçš„ç›¸å…³é…ç½®éƒ½æ˜¯é€šè¿‡ä¸€ä¸ªåä¸º<code>ansible.cfg</code>çš„é…ç½®æ–‡ä»¶è¿›è¡Œé…ç½®çš„ï¼Œä½†æˆ‘ä»¬é€šè¿‡pipå®‰è£…æ˜¯ä¸ä¼šé»˜è®¤åˆ›å»ºå®ƒçš„ï¼Œå®é™…ä¸Šä¸åˆ›å»ºè¿™ä¸ªé…ç½®æ–‡ä»¶ä¹Ÿä¸å½±å“ansibleçš„æ‰§è¡Œï¼Œå› ä¸ºå…¶ä¼šä½¿ç”¨ä¸€äº›é»˜è®¤çš„é…ç½®ï¼Œå¹¶ä¸”åœ¨å¤§å¤šæ•°åœºæ™¯ä¸‹é»˜è®¤çš„é…ç½®å°±èƒ½æ»¡è¶³éœ€æ±‚ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ansibleæŸ¥æ‰¾é…ç½®æ–‡ä»¶çš„é¡ºåºï¼Œä¼˜å…ˆçº§ç”±ä¸Šåˆ°ä¸‹é€æ¸é™ä½</p>\n</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">* ANSIBLE_CONFIG (ä¸€ä¸ªç¯å¢ƒå˜é‡)</span><br><span class=\"line\">* ansible.cfg (ä½äºå½“å‰ç›®å½•ä¸­)</span><br><span class=\"line\">* .ansible.cfg (ä½äºå®¶ç›®å½•ä¸­)</span><br><span class=\"line\">* /etc/ansible/ansible.cfg</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¦‚æœéœ€è¦ä¿®æ”¹é»˜è®¤é…ç½®ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤åˆ›å»ºä¸€ä»½é…ç½®æ–‡ä»¶</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æ­¤æ—¶ä¼šåˆ›å»ºä¸€ä»½æ‰€æœ‰é…ç½®é¡¹éƒ½ä»¥ ; å¼€å¤´çš„é…ç½®æ–‡ä»¶ï¼Œæˆ‘ä»¬è¦ä¿®æ”¹é‚£ä¸ªé…ç½®ï¼Œå°±åˆ é™¤å…¶å‰é¢çš„ ; ï¼Œç„¶åä¿®æ”¹å…¶å€¼å³å¯</span></span><br><span class=\"line\">ansible-config init --disabled &gt; ansible.cfg</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹å½“å‰çš„ç”Ÿæ•ˆé…ç½®ï¼Œæ³¨æ„ç»¿è‰²ä¸ºé»˜è®¤é…ç½®ï¼Œé»„è‰²ä¸ºè¢«ä¿®æ”¹çš„é…ç½®</span></span><br><span class=\"line\">ansible-config dump</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹å¸®åŠ©æ–‡ä»¶</span></span><br><span class=\"line\">ansible-config list</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹é»˜è®¤é…ç½®é¡¹çš„å€¼å’Œæ³¨é‡Šè¯´æ˜</span></span><br><span class=\"line\">ansible-config init list</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¸¸ç”¨é…ç½®è¯¦è§£</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># é€šç”¨é»˜è®¤é…ç½®æ®µï¼›</span></span><br><span class=\"line\">[defaults]</span><br><span class=\"line\"><span class=\"comment\"># è¢«æ§ç«¯IPæˆ–è€…DNSåˆ—è¡¨ï¼›</span></span><br><span class=\"line\">inventory=/etc/ansible/hosts</span><br><span class=\"line\"><span class=\"comment\"># Ansibleé»˜è®¤æœå¯»æ¨¡å—çš„ä½ç½®ï¼›</span></span><br><span class=\"line\">library=&#123;&#123; ANSIBLE_HOME ~ <span class=\"string\">&quot;/plugins/modules:/usr/share/ansible/plugins/modules&quot;</span> &#125;&#125;</span><br><span class=\"line\"><span class=\"comment\"># å¹¶è¡Œè¿›ç¨‹æ•°ï¼›</span></span><br><span class=\"line\">forks=5</span><br><span class=\"line\"><span class=\"comment\"># æ˜¯å¦å…è®¸åˆ‡æ¢ä¸ºå…¶å®ƒç”¨æˆ·</span></span><br><span class=\"line\">become=False</span><br><span class=\"line\"><span class=\"comment\"># become=Trueæ—¶ï¼Œé€šè¿‡sudoè¿›è¡Œåˆ‡æ¢</span></span><br><span class=\"line\">become_method=<span class=\"built_in\">sudo</span></span><br><span class=\"line\"><span class=\"comment\"># åˆ‡æ¢ä¸ºroot</span></span><br><span class=\"line\">become_user=root</span><br><span class=\"line\"><span class=\"comment\"># æœç´¢rolesçš„è·¯å¾„</span></span><br><span class=\"line\">roles_path=&#123;&#123; ANSIBLE_HOME ~ <span class=\"string\">&quot;/roles:/usr/share/ansible/roles:/etc/ansible/roles&quot;</span> &#125;&#125;</span><br><span class=\"line\"><span class=\"comment\"># æ—¥å¿—è·¯å¾„ï¼Œé»˜è®¤ä¸è¾“å‡º</span></span><br><span class=\"line\">log_path=</span><br><span class=\"line\"><span class=\"comment\"># Ansibleå‘½ä»¤æ‰§è¡Œé»˜è®¤çš„æ¨¡å—ï¼›</span></span><br><span class=\"line\">module_name=<span class=\"built_in\">command</span></span><br><span class=\"line\"><span class=\"comment\"># æ˜¯å¦æ£€æŸ¥è¿œç¨‹ä¸»æœºå¯†é’¥ï¼Œé»˜è®¤ä¸ºTrueï¼Œå¦‚æœå¸Œæœ›ä¸æ£€æŸ¥å¯ä»¥å°†å…¶è®¾ä¸ºFalseï¼Œå¯ä»¥åŠ å¿«è¿æ¥é€Ÿåº¦</span></span><br><span class=\"line\">host_key_checking=True</span><br></pre></td></tr></table></figure>\n<h2 id=\"Ansibleçš„hostsé…ç½®\">Ansibleçš„hostsé…ç½®</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>éœ€è¦åˆ›å»ºhostsæ–‡ä»¶ï¼Œä½¿ç”¨ansibleæ—¶ï¼Œansibleä¼šåˆ°hostsæ–‡ä»¶ä¸­æŸ¥æ‰¾å¯¹åº”çš„è¿œç¨‹ä¸»æœºé…ç½®ï¼Œé»˜è®¤çš„æŸ¥æ‰¾è·¯å¾„ä¸º<code>/etc/ansible/hosts</code>ï¼Œä¹Ÿå¯ä»¥é€šè¿‡<code>ansible.cfg</code>ä¿®æ”¹é»˜è®¤é…ç½®</p>\n</li>\n</ul>\n<h3 id=\"hostsæ–‡ä»¶æ ¼å¼1\">hostsæ–‡ä»¶æ ¼å¼1</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>hostsæ–‡ä»¶æ ¼å¼å¦‚ä¸‹ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å¯ä»¥é…ç½®ipæˆ–ä¸»æœºå</span></span><br><span class=\"line\">[webservers] <span class=\"comment\"># åˆ†ç»„åç§°</span></span><br><span class=\"line\">10.10.2.45</span><br><span class=\"line\">10.10.2.46</span><br><span class=\"line\">[dbservers]</span><br><span class=\"line\">10.10.2.47</span><br><span class=\"line\">10.10.2.48</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å‘½ä»¤è¡Œé‡ŒåŠ ä¸Šè¿æ¥å‚æ•°</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æ‰§è¡Œå‘½ä»¤ï¼Œå¤šä¸ªipé€—å·åˆ†éš”</span></span><br><span class=\"line\">ansible -u username -m ping --private-key=~/.ssh/id_rsa -e <span class=\"string\">&#x27;ansible_port=22&#x27;</span> 10.10.2.45,10.10.2.46</span><br><span class=\"line\"><span class=\"comment\"># æŒ‡å®šhostsæ–‡ä»¶è·¯å¾„</span></span><br><span class=\"line\">ansible -i hosts -u username -m ping --private-key=~/.ssh/id_rsa -e <span class=\"string\">&#x27;ansible_port=22&#x27;</span> 10.10.2.45,10.10.2.46</span><br></pre></td></tr></table></figure>\n<h3 id=\"hostsæ–‡ä»¶æ ¼å¼2\">hostsæ–‡ä»¶æ ¼å¼2</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>hostsæ–‡ä»¶é‡Œä¹Ÿå¯ä»¥é…ç½®è¿æ¥å‚æ•°</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[webservers]</span><br><span class=\"line\">10.10.2.45 ansible_ssh_user=username ansible_ssh_private_key=~/.ssh/id_rsa ansible_ssh_port=22</span><br><span class=\"line\">10.10.2.46 ansible_ssh_user=username ansible_ssh_private_key=~/.ssh/id_rsa ansible_ssh_port=22</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ­¤æ—¶å‘½ä»¤è¡Œè¿æ¥æ—¶å°±ä¸éœ€è¦æŒ‡å®šè¿æ¥å‚æ•°äº†</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ansible -i hosts -u username -m ping 10.10.2.45,10.10.2.46</span><br></pre></td></tr></table></figure>\n<h3 id=\"hostsæ–‡ä»¶æ ¼å¼3\">hostsæ–‡ä»¶æ ¼å¼3</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ansibleæ˜¯åŸºäºsshå»ºç«‹è¿æ¥çš„ï¼Œæ‰€ä»¥åªè¦sshèƒ½è¿ä¸Šè¿œç¨‹ä¸»æœºï¼Œansibleå°±å¯ä»¥ç®¡ç†è¿œç¨‹ä¸»æœºï¼Œå¦‚æœæˆ‘ä»¬ä¸ºsshé…ç½®configæ–‡ä»¶ï¼Œé‚£ä¹ˆansibleå°±å¯ä»¥ç›´æ¥å°†configé‡Œçš„Hoståç§°é…ç½®åˆ°hostsæ–‡ä»¶é‡Œï¼Œè¿™æ ·å°±ä¸éœ€è¦é…ç½®è¿æ¥å‚æ•°äº†ï¼ŒåŒæ—¶æ­¤æ—¶ä¹Ÿå¯ä»¥æ”¯æŒè·³æ¿æœºã€‚å…³äºsshçš„configè¯¦ç»†è¯´æ˜å¯ä»¥å‚è€ƒ<a href=\"/2023/02/28/linux-command02-ssh/\" title=\"Linuxå¸¸ç”¨å‘½ä»¤--sshã€scpä¸å…å¯†ç™»å½•\">Linuxå¸¸ç”¨å‘½ä»¤--sshã€scpä¸å…å¯†ç™»å½•</a></p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-6\">é…ç½®~/.ssh/config</li>\n</ul>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># è·³æ¿æœº</span></span><br><span class=\"line\">Host forward</span><br><span class=\"line\">    User ec2-user</span><br><span class=\"line\">    HostName 53.22.227.200</span><br><span class=\"line\">    Port 22</span><br><span class=\"line\">    IdentityFile ~/.ssh/id_rsa</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># è¿œç¨‹ä¸»æœº</span></span><br><span class=\"line\">Host remote-host</span><br><span class=\"line\">    User ec2-user</span><br><span class=\"line\">    HostName 10.9.5.123</span><br><span class=\"line\">    Port 22</span><br><span class=\"line\">    IdentityFile ~/.ssh/key.pem</span><br><span class=\"line\">    ProxyCommand ssh forward -W %h:%p</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># è¿œç¨‹ä¸»æœº ,10.9ç½‘æ®µçš„æ‰€æœ‰ä¸»æœº</span></span><br><span class=\"line\">Host 10.9.*</span><br><span class=\"line\">    User ec2-user</span><br><span class=\"line\">    Port 22</span><br><span class=\"line\">    IdentityFile ~/.ssh/key.pem</span><br><span class=\"line\">    ProxyCommand ssh forward -W %h:%p</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-2\">\n<li class=\"lvl-6\">hostsæ–‡ä»¶</li>\n</ul>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[webservers]</span><br><span class=\"line\">forward     <span class=\"comment\"># ä¸configä¸­é…ç½®çš„Hoståç§°ä¸€è‡´</span></span><br><span class=\"line\">remote-host <span class=\"comment\"># ä¸configä¸­é…ç½®çš„Hoståç§°ä¸€è‡´</span></span><br><span class=\"line\">10.9.5.123     <span class=\"comment\"># åŒ¹é…configä¸­çš„ç½‘æ®µ</span></span><br><span class=\"line\">10.9.5.124     <span class=\"comment\"># åŒ¹é…configä¸­çš„ç½‘æ®µ</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-2\">\n<li class=\"lvl-6\">å‘½ä»¤è¡Œ</li>\n</ul>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># é€šè¿‡æŒ‡å®šä¸»æœºåæˆ–ip</span></span><br><span class=\"line\">ansible -m ping remote-host</span><br><span class=\"line\">ansible -m ping 10.9.5.123</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># é€šé…ç¬¦åŒ¹é…ï¼Œæ­¤æ—¶åœ¨åŒ¹é…hostsä¸­123å’Œ124</span></span><br><span class=\"line\">ansible -m ping  <span class=\"string\">&quot;10.9.5.*&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># é€šè¿‡åˆ†ç»„å</span></span><br><span class=\"line\">ansible -m ping  webservers</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># é€šè¿‡allæŒ‡å®šhostsé‡Œçš„å…¨éƒ¨ä¸»æœº</span></span><br><span class=\"line\">ansible -m ping  all</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<h3 id=\"æŸ¥çœ‹hostsé…ç½®ç›¸å…³å‘½ä»¤\">æŸ¥çœ‹hostsé…ç½®ç›¸å…³å‘½ä»¤</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ—å‡ºæ‰€æœ‰ç»„çš„é…ç½®ipä¿¡æ¯</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ansible all --list-hosts</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æŸ¥çœ‹å½“å‰hostsä¸­é…ç½®æ‰€æœ‰ç»„åç§°</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ansible localhost -m debug -a <span class=\"string\">&#x27;var=groups.keys()&#x27;</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ—å‡ºæŒ‡å®šç»„çš„é…ç½®ipä¿¡æ¯</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ansible dbservers --list-hosts</span><br></pre></td></tr></table></figure>\n<h2 id=\"Ansibleæ¨¡å—\">Ansibleæ¨¡å—</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ—å‡ºæ‰€æœ‰æ¨¡å—</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ansible-doc -l</span><br><span class=\"line\"><span class=\"comment\"># ä¹Ÿå¯ä»¥æŒ‡å®šæ¨¡å—åç§°</span></span><br><span class=\"line\">ansible-doc -l | grep -i shell</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æŸ¥çœ‹æŒ‡å®šæ¨¡å—çš„å‚æ•°ä¿¡æ¯ï¼Œå¦‚ä¸‹æŸ¥çœ‹shellæ¨¡å—çš„å‚æ•°è¯´æ˜</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ansible-doc -s shell</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æŸ¥çœ‹æ¨¡å—çš„å¸®åŠ©ä¿¡æ¯ï¼Œå¦‚ä¸‹æŸ¥çœ‹shellæ¨¡å—çš„å¸®åŠ©ä¿¡æ¯ï¼Œè¿™ä¸å®˜æ–¹æ–‡æ¡£ä¸€è‡´:<a href=\"https://docs.ansible.com/ansible/latest/collections/ansible/builtin/shell_module.html#ansible-collections-ansible-builtin-shell-module\">shellæ¨¡å—</a></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ansible-doc shell</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Ansibleç®¡ç†å·¥å…·å¸¸ç”¨çš„æ¨¡å—ï¼š<code>commandã€shellã€fileã€userã€copyã€serviceã€yumã€synchronzeã€cronã€setupã€ping</code>ç­‰ã€‚å¯ä»¥åœ¨å‘½ä»¤è¡Œé‡ŒæŒ‡å®šå„ä¸ªæ¨¡å—çš„å‚æ•°(<code>ansible</code>å‘½ä»¤)ï¼Œä¹Ÿå¯ä»¥å°†å‚æ•°é…ç½®åˆ°ymlæ–‡ä»¶é‡Œï¼Œç„¶ååœ¨å‘½ä»¤è¡Œé‡ŒæŒ‡å®šymlæ–‡ä»¶(<code>ansible-playbook</code>å‘½ä»¤)ï¼Œä¸‹é¢ä¼šç»“åˆä¸¤ç§æ–¹å¼ä¸€å—ä»‹ç»ã€‚ç½‘ä¸Šæœ‰å¤§æŠŠçš„å…³äºansibleå‘½ä»¤çš„ä½¿ç”¨è¯´æ˜ï¼Œè¿™é‡Œåªç®€å•ä»‹ç»å‡ ä¸ªæ¨¡å—çš„ä½¿ç”¨æ–¹æ³•ï¼Œå…¶ä»–æ¨¡å—çš„ä½¿ç”¨æ–¹æ³•å¯ä»¥å‚è€ƒ<a href=\"https://docs.ansible.com/ansible/latest/collections/index.html#plugin-list\">ansibleæ¨¡å—</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>ä¸‹é¢ä»‹ç»çš„éƒ½æ˜¯<a href=\"https://docs.ansible.com/ansible/latest/collections/ansible/builtin/index.html#plugins-in-ansible-builtin\">ansibleæ ¸å¿ƒæ¨¡å—:ansible-core</a></p>\n</li>\n</ul>\n<h3 id=\"debugæ¨¡å—\">debugæ¨¡å—</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><a href=\"https://docs.ansible.com/ansible/latest/collections/ansible/builtin/debug_module.html#ansible-collections-ansible-builtin-debug-module\">debugæ¨¡å—</a>æ­¤æ¨¡å—åœ¨æ‰§è¡ŒæœŸé—´æ‰“å°è¯­å¥ï¼Œå¯ç”¨äºè°ƒè¯•å˜é‡æˆ–è¡¨è¾¾å¼</p>\n</li>\n<li class=\"lvl-2\">\n<p>é€šè¿‡å‘½ä»¤è¡Œæ‰§è¡Œå‘½ä»¤</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ansible webservers -m debug -a <span class=\"string\">&#x27;msg=&quot;System HostName: &#123;&#123; inventory_hostname &#125;&#125;&quot;&#x27;</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>é€šè¿‡ymlæ–‡ä»¶æ‰§è¡Œå‘½ä»¤</p>\n</li>\n</ul>\n<figure class=\"highlight yml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># debug.yml</span></span><br><span class=\"line\"><span class=\"string\">---</span>  <span class=\"comment\"># ymlæ–‡ä»¶çš„å¼€å¤´ï¼Œè§„å®šplaybookçš„ymlæ–‡ä»¶æ ¼å¼ï¼Œå¿…é¡»ä»¥---å¼€å¤´(å¿…é¡»)ï¼Œ...ç»“å°¾(éå¿…é¡»)</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">Debug</span></span><br><span class=\"line\">  <span class=\"attr\">hosts:</span> <span class=\"string\">webservers</span></span><br><span class=\"line\">  <span class=\"attr\">tasks:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">Debug</span></span><br><span class=\"line\">      <span class=\"attr\">debug:</span></span><br><span class=\"line\">        <span class=\"attr\">msg:</span> <span class=\"string\">&quot;System HostName: <span class=\"template-variable\">&#123;&#123; inventory_hostname &#125;&#125;</span>&quot;</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¸¸ç”¨å‚æ•°è¯´æ˜ï¼š<code>ansible-doc -s debug</code></p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>å‚æ•°</th>\n<th>æè¿°</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>msg</td>\n<td>æ‰“å°æ¶ˆæ¯ï¼Œæ”¯æŒå˜é‡</td>\n</tr>\n<tr>\n<td>var</td>\n<td>æ‰“å°æ¶ˆæ¯ï¼Œæ”¯æŒå˜é‡ï¼Œæ³¨å†Œå˜é‡  , ä¸msgäº’æ–¥</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"pingæ¨¡å—\">pingæ¨¡å—</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><a href=\"https://docs.ansible.com/ansible/latest/collections/ansible/builtin/ping_module.html#ansible-collections-ansible-builtin-ping-module\">pingæ¨¡å—</a>ç”¨äºæµ‹è¯•ä¸»æœºçš„è¿é€šæ€§ï¼Œå®ƒä¼šå°è¯•è¿æ¥åˆ°ä¸»æœºï¼ŒéªŒè¯å¯ç”¨çš„pythonï¼Œå¹¶åœ¨æˆåŠŸæ—¶è¿”å›â€œpongâ€ï¼Œå¯ä»¥æŒ‡å®šä¸»æœºåæˆ–ipï¼Œä¹Ÿå¯ä»¥æŒ‡å®šåˆ†ç»„åï¼Œä¹Ÿå¯ä»¥æŒ‡å®šall</p>\n</li>\n<li class=\"lvl-2\">\n<p>é€šè¿‡å‘½ä»¤è¡Œæ‰§è¡Œå‘½ä»¤</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ansible webservers -m ping</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>é€šè¿‡ymlæ–‡ä»¶æ‰§è¡Œå‘½ä»¤</p>\n</li>\n</ul>\n<figure class=\"highlight yml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ping.yml</span></span><br><span class=\"line\"><span class=\"string\">---</span>  <span class=\"comment\"># ymlæ–‡ä»¶çš„å¼€å¤´ï¼Œè§„å®šplaybookçš„ymlæ–‡ä»¶æ ¼å¼ï¼Œå¿…é¡»ä»¥---å¼€å¤´(å¿…é¡»)ï¼Œ...ç»“å°¾(éå¿…é¡»)</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">Ping</span> <span class=\"string\">web</span> <span class=\"string\">servers</span></span><br><span class=\"line\">  <span class=\"attr\">hosts:</span> <span class=\"string\">webservers</span>  <span class=\"comment\"># ipæˆ–ç»„åï¼Œä¹Ÿå¯ä»¥é…ç½®allï¼šåŒ¹é…å…¨éƒ¨ä¸»æœº</span></span><br><span class=\"line\">  <span class=\"attr\">tasks:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">Ping</span> <span class=\"string\">the</span> <span class=\"string\">servers</span></span><br><span class=\"line\">      <span class=\"attr\">ping:</span></span><br><span class=\"line\">      <span class=\"attr\">register:</span> <span class=\"string\">command_output</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">æ˜¾ç¤ºå‘½ä»¤è¾“å‡º</span></span><br><span class=\"line\">      <span class=\"attr\">debug:</span></span><br><span class=\"line\">        <span class=\"attr\">var:</span> <span class=\"string\">command_output.stdout_lines</span> <span class=\"comment\"># æ³¨å†Œå˜é‡è¾“å‡ºè¦ä½¿ç”¨ var</span></span><br></pre></td></tr></table></figure>\n<div class=\"tips\">\n<p><em><strong>ansible-playbook</strong></em></p>\n<ul class=\"lvl-1\">\n<li class=\"lvl-2\">é€šè¿‡ansible-playbookå‘½ä»¤ï¼Œå¯ä»¥æŒ‡å®šymlæ–‡ä»¶</li>\n<li class=\"lvl-2\">ansible-playbookç›¸å…³å‘½ä»¤</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æ£€æŸ¥ymlæ–‡ä»¶è¯­æ³•æ ¼å¼</span></span><br><span class=\"line\">ansible-playbook --syntax-check ping.yml</span><br><span class=\"line\"><span class=\"comment\"># åˆ—å‡ºhosts</span></span><br><span class=\"line\">ansible-playbook --list-hosts ping.yml</span><br><span class=\"line\"><span class=\"comment\"># åˆ—å‡ºtags</span></span><br><span class=\"line\">ansible-playbook --list-tags ping.yml</span><br><span class=\"line\"><span class=\"comment\"># åˆ—å‡ºtask</span></span><br><span class=\"line\">ansible-playbook --list-tasks ping.yml</span><br><span class=\"line\"><span class=\"comment\"># æŒ‡å®šæ‰§è¡Œä¸»æœºï¼š--limit æˆ– -lï¼Œå…¶å¿…é¡»æ˜¯ymlä¸­hostsæŒ‡å®šçš„å­é›†</span></span><br><span class=\"line\">ansible-playbook ping.yml --<span class=\"built_in\">limit</span> 192.168.20.23</span><br><span class=\"line\"><span class=\"comment\"># æ‰§è¡Œå‘½ä»¤</span></span><br><span class=\"line\">ansible-playbook ping.yml</span><br><span class=\"line\"><span class=\"comment\"># æ¨¡æ‹Ÿæ‰§è¡Œï¼ŒAnsible ä¼šæ¨¡æ‹Ÿæ‰§è¡Œä»»åŠ¡ï¼Œå¹¶è¾“å‡ºæ‰§è¡Œç»“æœï¼Œä½†ä¸ä¼šå¯¹ç›®æ ‡ä¸»æœºåšå‡ºä»»ä½•æ›´æ”¹</span></span><br><span class=\"line\"><span class=\"comment\"># æ³¨æ„è¿™ä¸ªå‘½ä»¤è¿è¡Œä¸æŠ¥é”™å¹¶ä¸èƒ½è¯´æ˜ä¸€å®šå¯ä»¥æ‰§è¡ŒæˆåŠŸï¼Œå› ä¸ºè¿™ä¸ªå‘½ä»¤æ˜¯æ¨¡æ‹Ÿæ‰§è¡Œçš„</span></span><br><span class=\"line\">ansible-playbook ping.yml --check</span><br></pre></td></tr></table></figure>\n</div>\n<h3 id=\"setupæ¨¡å—\">setupæ¨¡å—</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¯¥æ¨¡å—ç”¨äºé‡‡é›†è¢«ç®¡ç†è®¾å¤‡ä¿¡æ¯å¹¶è¿”å›ç»™æœåŠ¡ç«¯ï¼Œåé¢è·Ÿ<code>--tree &lt;ç›®å½•&gt;</code>ï¼Œå¯ä»¥å°†é‡‡é›†ä¿¡æ¯ä»¥ipä¸ºæ–‡ä»¶åä¿å­˜è‡³æŒ‡å®šç›®å½•ä¸‹</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹å…¨éƒ¨ä¿¡æ¯</span></span><br><span class=\"line\">ansible all -m setup</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åªæŸ¥çœ‹å†…å­˜ä¿¡æ¯</span></span><br><span class=\"line\">ansible all -m setup -a <span class=\"string\">&quot;filter=*mem*&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åªæŸ¥çœ‹ç½‘ç»œä¿¡æ¯</span></span><br><span class=\"line\">ansible all -m setup -a <span class=\"string\">&quot;gather_subset=network&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ä¿å­˜ä¿¡æ¯è‡³æŒ‡å®šç›®å½•ï¼Œè¿™æ ·ä¼šæ¯ä¸ªipå¯¹åº”ä¸€ä¸ªæ–‡ä»¶</span></span><br><span class=\"line\">ansible all -m setup --tree ./</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¸¸ç”¨å‚æ•°è¯´æ˜ï¼š<code>ansible-doc -s setup</code></p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>å‚æ•°</th>\n<th>æè¿°</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>gather_subset</td>\n<td>æŒ‡å®šè¦æ”¶é›†çš„ç³»ç»Ÿä¿¡æ¯çš„å­é›†ã€‚å¯ä»¥æ˜¯ allï¼ˆæ‰€æœ‰ä¿¡æ¯ï¼‰ã€networkï¼ˆç½‘ç»œä¿¡æ¯ï¼‰ã€hardwareï¼ˆç¡¬ä»¶ä¿¡æ¯ï¼‰ç­‰ã€‚é»˜è®¤ä¸º allã€‚</td>\n</tr>\n<tr>\n<td>gather_timeout</td>\n<td>è®¾ç½®ä¿¡æ¯æ”¶é›†çš„è¶…æ—¶æ—¶é—´ï¼Œå•ä½ä¸ºç§’ã€‚é»˜è®¤ä¸º 10 ç§’ã€‚</td>\n</tr>\n<tr>\n<td>filter</td>\n<td>æŒ‡å®šè¦æ”¶é›†çš„ç³»ç»Ÿä¿¡æ¯çš„è¿‡æ»¤æ¡ä»¶ã€‚å¯ä»¥æ˜¯ä¸€ä¸ªæˆ–å¤šä¸ªæ ‡ç­¾ï¼Œåªæ”¶é›†åŒ¹é…çš„ä¿¡æ¯ã€‚</td>\n</tr>\n<tr>\n<td>fact_path</td>\n<td>æŒ‡å®šè‡ªå®šä¹‰ facts æ–‡ä»¶çš„è·¯å¾„ã€‚</td>\n</tr>\n</tbody>\n</table>\n<blockquote>\n<p>è¿™é‡Œé‡ç‚¹ä»‹ç»ä¸€ä¸‹gather_subset</p>\n</blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">all: æ”¶é›†æ‰€æœ‰å¯ç”¨çš„ç³»ç»Ÿä¿¡æ¯ã€‚</span><br><span class=\"line\">all_ipv4_addresses: æ”¶é›†æ‰€æœ‰ IPv4 åœ°å€ä¿¡æ¯ã€‚</span><br><span class=\"line\">all_ipv6_addresses: æ”¶é›†æ‰€æœ‰ IPv6 åœ°å€ä¿¡æ¯ã€‚</span><br><span class=\"line\">apparmor: æ”¶é›† AppArmor ç›¸å…³ä¿¡æ¯ã€‚</span><br><span class=\"line\">architecture: æ”¶é›†ç³»ç»Ÿæ¶æ„ä¿¡æ¯ã€‚</span><br><span class=\"line\">caps: æ”¶é›†è¿›ç¨‹çš„ capabilities ä¿¡æ¯ã€‚</span><br><span class=\"line\">chroot: æ”¶é›† chroot ç¯å¢ƒçš„ä¿¡æ¯ã€‚</span><br><span class=\"line\">cmdline: æ”¶é›†å†…æ ¸å‘½ä»¤è¡Œå‚æ•°ä¿¡æ¯ã€‚</span><br><span class=\"line\">date_time: æ”¶é›†æ—¥æœŸå’Œæ—¶é—´ä¿¡æ¯ã€‚</span><br><span class=\"line\">default_ipv4: æ”¶é›†é»˜è®¤çš„ IPv4 åœ°å€ä¿¡æ¯ã€‚</span><br><span class=\"line\">default_ipv6: æ”¶é›†é»˜è®¤çš„ IPv6 åœ°å€ä¿¡æ¯ã€‚</span><br><span class=\"line\">devices: æ”¶é›†ç³»ç»Ÿè®¾å¤‡ä¿¡æ¯ã€‚</span><br><span class=\"line\">distribution: æ”¶é›†å‘è¡Œç‰ˆä¿¡æ¯ã€‚</span><br><span class=\"line\">distribution_major_version: æ”¶é›†å‘è¡Œç‰ˆä¸»ç‰ˆæœ¬å·ã€‚</span><br><span class=\"line\">distribution_release: æ”¶é›†å‘è¡Œç‰ˆå‘è¡Œå·ã€‚</span><br><span class=\"line\">distribution_version: æ”¶é›†å‘è¡Œç‰ˆç‰ˆæœ¬ä¿¡æ¯ã€‚</span><br><span class=\"line\">dns: æ”¶é›† DNS é…ç½®ä¿¡æ¯ã€‚</span><br><span class=\"line\">effective_group_ids: æ”¶é›†æœ‰æ•ˆç»„ ID ä¿¡æ¯ã€‚</span><br><span class=\"line\">effective_user_id: æ”¶é›†æœ‰æ•ˆç”¨æˆ· ID ä¿¡æ¯ã€‚</span><br><span class=\"line\">env: æ”¶é›†ç¯å¢ƒå˜é‡ä¿¡æ¯ã€‚</span><br><span class=\"line\">facter: æ”¶é›† Facter ä¿¡æ¯ã€‚</span><br><span class=\"line\">fips: æ”¶é›† FIPS ç›¸å…³ä¿¡æ¯ã€‚</span><br><span class=\"line\">hardware: æ”¶é›†ç¡¬ä»¶ä¿¡æ¯ã€‚</span><br><span class=\"line\">interfaces: æ”¶é›†ç½‘ç»œæ¥å£ä¿¡æ¯ã€‚</span><br><span class=\"line\">is_chroot: æ”¶é›†æ˜¯å¦å¤„äº chroot ç¯å¢ƒçš„ä¿¡æ¯ã€‚</span><br><span class=\"line\">iscsi: æ”¶é›† iSCSI é…ç½®ä¿¡æ¯ã€‚</span><br><span class=\"line\">kernel: æ”¶é›†å†…æ ¸ä¿¡æ¯ã€‚</span><br><span class=\"line\">local: æ”¶é›†æœ¬åœ°é…ç½®ä¿¡æ¯ã€‚</span><br><span class=\"line\">lsb: æ”¶é›† LSB å‘è¡Œç‰ˆä¿¡æ¯ã€‚</span><br><span class=\"line\">machine: æ”¶é›†æœºå™¨ä¿¡æ¯ã€‚</span><br><span class=\"line\">machine_id: æ”¶é›†æœºå™¨ ID ä¿¡æ¯ã€‚</span><br><span class=\"line\">mounts: æ”¶é›†æŒ‚è½½ç‚¹ä¿¡æ¯ã€‚</span><br><span class=\"line\">network: æ”¶é›†ç½‘ç»œç›¸å…³ä¿¡æ¯ã€‚</span><br><span class=\"line\">ohai: æ”¶é›† Ohai ä¿¡æ¯ã€‚</span><br><span class=\"line\">os_family: æ”¶é›†æ“ä½œç³»ç»Ÿå®¶æ—ä¿¡æ¯ã€‚</span><br><span class=\"line\">pkg_mgr: æ”¶é›†åŒ…ç®¡ç†å™¨ä¿¡æ¯ã€‚</span><br><span class=\"line\">platform: æ”¶é›†å¹³å°ä¿¡æ¯ã€‚</span><br><span class=\"line\">processor: æ”¶é›†å¤„ç†å™¨ä¿¡æ¯ã€‚</span><br><span class=\"line\">processor_cores: æ”¶é›†å¤„ç†å™¨æ ¸å¿ƒæ•°ä¿¡æ¯ã€‚</span><br><span class=\"line\">processor_count: æ”¶é›†å¤„ç†å™¨æ•°é‡ä¿¡æ¯ã€‚</span><br><span class=\"line\">python: æ”¶é›† Python ç›¸å…³ä¿¡æ¯ã€‚</span><br><span class=\"line\">python_version: æ”¶é›† Python ç‰ˆæœ¬ä¿¡æ¯ã€‚</span><br><span class=\"line\">real_user_id: æ”¶é›†çœŸå®ç”¨æˆ· ID ä¿¡æ¯ã€‚</span><br><span class=\"line\">selinux: æ”¶é›† SELinux é…ç½®ä¿¡æ¯ã€‚</span><br><span class=\"line\">service_mgr: æ”¶é›†æœåŠ¡ç®¡ç†å™¨ä¿¡æ¯ã€‚</span><br><span class=\"line\">ssh_host_key_dsa_public: æ”¶é›† SSH DSA å…¬é’¥ä¿¡æ¯ã€‚</span><br><span class=\"line\">ssh_host_key_ecdsa_public: æ”¶é›† SSH ECDSA å…¬é’¥ä¿¡æ¯ã€‚</span><br><span class=\"line\">ssh_host_key_ed25519_public: æ”¶é›† SSH ED25519 å…¬é’¥ä¿¡æ¯ã€‚</span><br><span class=\"line\">ssh_host_key_rsa_public: æ”¶é›† SSH RSA å…¬é’¥ä¿¡æ¯ã€‚</span><br><span class=\"line\">ssh_host_pub_keys: æ”¶é›† SSH ä¸»æœºå…¬é’¥ä¿¡æ¯ã€‚</span><br><span class=\"line\">ssh_pub_keys: æ”¶é›† SSH ç”¨æˆ·å…¬é’¥ä¿¡æ¯ã€‚</span><br><span class=\"line\">system: æ”¶é›†ç³»ç»Ÿç›¸å…³ä¿¡æ¯ã€‚</span><br><span class=\"line\">system_capabilities: æ”¶é›†ç³»ç»Ÿèƒ½åŠ›ä¿¡æ¯ã€‚</span><br><span class=\"line\">system_capabilities_enforced: æ”¶é›†ç³»ç»Ÿèƒ½åŠ›å¼ºåˆ¶ä¿¡æ¯ã€‚</span><br><span class=\"line\">user: æ”¶é›†ç”¨æˆ·è´¦æˆ·ä¿¡æ¯ã€‚</span><br><span class=\"line\">user_dir: æ”¶é›†ç”¨æˆ·ç›®å½•ä¿¡æ¯ã€‚</span><br><span class=\"line\">user_gecos: æ”¶é›†ç”¨æˆ· GECOS ä¿¡æ¯ã€‚</span><br><span class=\"line\">user_gid: æ”¶é›†ç”¨æˆ·ç»„ ID ä¿¡æ¯ã€‚</span><br><span class=\"line\">user_id: æ”¶é›†ç”¨æˆ· ID ä¿¡æ¯ã€‚</span><br><span class=\"line\">user_shell: æ”¶é›†ç”¨æˆ· Shell ä¿¡æ¯ã€‚</span><br><span class=\"line\">user_uid: æ”¶é›†ç”¨æˆ· UID ä¿¡æ¯ã€‚</span><br><span class=\"line\">virtual: æ”¶é›†è™šæ‹ŸåŒ–ç›¸å…³ä¿¡æ¯ã€‚</span><br><span class=\"line\">virtualization_role: æ”¶é›†è™šæ‹ŸåŒ–è§’è‰²ä¿¡æ¯ã€‚</span><br><span class=\"line\">virtualization_type: æ”¶é›†è™šæ‹ŸåŒ–ç±»å‹ä¿¡æ¯ã€‚</span><br></pre></td></tr></table></figure>\n<h3 id=\"commandæ¨¡å—\">commandæ¨¡å—</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><a href=\"https://docs.ansible.com/ansible/latest/collections/ansible/builtin/command_module.html#ansible-collections-ansible-builtin-command-module\">commandæ¨¡å—</a>ä¸ºansibleé»˜è®¤æ¨¡å—ï¼Œä¸»è¦ç”¨äºæ‰§è¡ŒLinuxåŸºç¡€å‘½ä»¤ï¼Œå¯ä»¥æ‰§è¡Œè¿œç¨‹æœåŠ¡å™¨å‘½ä»¤æ‰§è¡Œã€ä»»åŠ¡æ‰§è¡Œç­‰æ“ä½œã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>commandæ¨¡å—ä¸æ”¯æŒç®¡é“ç¬¦å·ã€å˜é‡ï¼Œåªèƒ½è¿è¡Œç®€å•å‘½ä»¤ï¼Œå¤æ‚å‘½ä»¤éœ€è¦ä½¿ç”¨shellæ¨¡å—</p>\n</li>\n<li class=\"lvl-2\">\n<p>ç¤ºä¾‹1</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ansible webservers -m <span class=\"built_in\">command</span> -a <span class=\"string\">&quot;df -hT&quot;</span></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight yml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># command.yml</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">åœ¨</span> <span class=\"string\">web</span> <span class=\"string\">æœåŠ¡å™¨ä¸Šè¿è¡Œ</span> <span class=\"string\">df</span> <span class=\"string\">-hT</span> <span class=\"string\">å‘½ä»¤</span></span><br><span class=\"line\">  <span class=\"attr\">hosts:</span> <span class=\"string\">webservers</span></span><br><span class=\"line\">  <span class=\"attr\">tasks:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">æ‰§è¡Œ</span> <span class=\"string\">df</span> <span class=\"string\">-hT</span> <span class=\"string\">å‘½ä»¤</span></span><br><span class=\"line\">      <span class=\"attr\">command:</span></span><br><span class=\"line\">        <span class=\"attr\">cmd:</span> <span class=\"string\">&quot;df -hT&quot;</span></span><br><span class=\"line\">      <span class=\"attr\">register:</span> <span class=\"string\">command_output</span> <span class=\"comment\"># ä¿å­˜å‘½ä»¤æ‰§è¡Œç»“æœ</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">æ˜¾ç¤ºå‘½ä»¤è¾“å‡º</span></span><br><span class=\"line\">      <span class=\"attr\">debug:</span></span><br><span class=\"line\">        <span class=\"attr\">var:</span> <span class=\"string\">command_output.stdout_lines</span> <span class=\"comment\"># è¾“å‡ºå‘½ä»¤æ‰§è¡Œç»“æœ</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç¤ºä¾‹2ï¼šå‚æ•°chdirï¼šåˆ‡æ¢åˆ°æŒ‡å®šç›®å½•åå†è¿è¡Œå‘½ä»¤</p>\n</li>\n</ul>\n<blockquote>\n<p>å¯ä»¥é€šè¿‡<code>ansible-doc -s command</code>æŸ¥çœ‹å…¶æ”¯æŒçš„å‚æ•°</p>\n</blockquote>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ansible webservers -m <span class=\"built_in\">command</span> -a <span class=\"string\">&quot;chdir=/tmp ls -l&quot;</span></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight yml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># command2.yml</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">åœ¨</span> <span class=\"string\">web</span> <span class=\"string\">æœåŠ¡å™¨ä¸Šåˆ—å‡º</span> <span class=\"string\">/tmp</span> <span class=\"string\">ç›®å½•çš„å†…å®¹</span></span><br><span class=\"line\">  <span class=\"attr\">hosts:</span> <span class=\"string\">webservers</span></span><br><span class=\"line\">  <span class=\"attr\">tasks:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">åˆ‡æ¢åˆ°</span> <span class=\"string\">/tmp</span> <span class=\"string\">ç›®å½•å¹¶åˆ—å‡ºå†…å®¹</span></span><br><span class=\"line\">      <span class=\"attr\">command:</span></span><br><span class=\"line\">        <span class=\"attr\">chdir:</span> <span class=\"string\">/tmp</span>       <span class=\"comment\"># åˆ‡æ¢åˆ° /tmp ç›®å½•</span></span><br><span class=\"line\">        <span class=\"attr\">cmd:</span> <span class=\"string\">ls</span> <span class=\"string\">-l</span>        <span class=\"comment\"># æ‰§è¡Œå‘½ä»¤</span></span><br><span class=\"line\">      <span class=\"attr\">register:</span> <span class=\"string\">command_output</span>  <span class=\"comment\"># ä¿å­˜å‘½ä»¤æ‰§è¡Œç»“æœ</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">æ˜¾ç¤ºå‘½ä»¤è¾“å‡º</span></span><br><span class=\"line\">      <span class=\"attr\">debug:</span></span><br><span class=\"line\">        <span class=\"attr\">var:</span> <span class=\"string\">command_output.stdout_lines</span> <span class=\"comment\"># è¾“å‡ºå‘½ä»¤æ‰§è¡Œç»“æœ</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¸¸ç”¨å‚æ•°è¯´æ˜ï¼š<code>ansible-doc -s command</code></p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>å‚æ•°</th>\n<th>æè¿°</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>argv</td>\n<td>è¦æ‰§è¡Œçš„å‘½ä»¤ï¼Œå¯ä»¥æ˜¯å­—ç¬¦ä¸²å½¢å¼æˆ–åˆ—è¡¨å½¢å¼ã€‚</td>\n</tr>\n<tr>\n<td>chdir</td>\n<td>åœ¨æ‰§è¡Œå‘½ä»¤ä¹‹å‰åˆ‡æ¢åˆ°çš„ç›®å½•ã€‚</td>\n</tr>\n<tr>\n<td>cmd</td>\n<td>è¦æ‰§è¡Œçš„å‘½ä»¤ã€‚</td>\n</tr>\n<tr>\n<td>creates</td>\n<td>æŒ‡å®šä¸€ä¸ªæ–‡ä»¶åæˆ–æ¨¡å¼ï¼Œå¦‚æœåŒ¹é…çš„æ–‡ä»¶å·²ç»å­˜åœ¨ï¼Œåˆ™ä¸æ‰§è¡Œå‘½ä»¤ã€‚</td>\n</tr>\n<tr>\n<td>expand_argument_vars</td>\n<td>æ˜¯å¦å±•å¼€ä½œä¸ºå˜é‡çš„å‚æ•°ã€‚é»˜è®¤ä¸º trueï¼Œè¡¨ç¤ºå±•å¼€å˜é‡ã€‚</td>\n</tr>\n<tr>\n<td>free_form</td>\n<td>ä»¥å­—ç¬¦ä¸²å½¢å¼æŒ‡å®šè¦æ‰§è¡Œçš„å‘½ä»¤ã€‚è¿™ä¸ªå‚æ•°å¹¶ä¸å­˜åœ¨ï¼Œä½†æ˜¯ command æ¨¡å—æ¥å—è‡ªç”±å½¢å¼çš„å­—ç¬¦ä¸²ä½œä¸ºå‘½ä»¤ã€‚</td>\n</tr>\n<tr>\n<td>removes</td>\n<td>æŒ‡å®šä¸€ä¸ªæ–‡ä»¶åæˆ–æ¨¡å¼ï¼Œå¦‚æœåŒ¹é…çš„æ–‡ä»¶å­˜åœ¨ï¼Œåˆ™æ‰§è¡Œå‘½ä»¤ã€‚</td>\n</tr>\n<tr>\n<td>stdin</td>\n<td>å°†å‘½ä»¤çš„æ ‡å‡†è¾“å…¥è®¾ç½®ä¸ºæŒ‡å®šçš„å€¼ã€‚</td>\n</tr>\n<tr>\n<td>stdin_add_newline</td>\n<td>æ˜¯å¦åœ¨æ ‡å‡†è¾“å…¥æ•°æ®åæ·»åŠ æ¢è¡Œç¬¦ã€‚</td>\n</tr>\n<tr>\n<td>strip_empty_ends</td>\n<td>æ˜¯å¦ä»æ ‡å‡†è¾“å‡ºçš„æœ«å°¾å‰¥ç¦»ç©ºè¡Œã€‚</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"shellæ¨¡å—\">shellæ¨¡å—</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><a href=\"https://docs.ansible.com/ansible/latest/collections/ansible/builtin/shell_module.html#ansible-collections-ansible-builtin-shell-module\">shellæ¨¡å—</a>ä¸commandæ¨¡å—ç±»ä¼¼ï¼Œå¯ä»¥æ‰§è¡Œè¿œç¨‹æœåŠ¡å™¨å‘½ä»¤æ‰§è¡Œã€ä»»åŠ¡æ‰§è¡Œç­‰æ“ä½œï¼Œä½†æ˜¯shellæ¨¡å—æ”¯æŒç®¡é“ç¬¦å·ã€å˜é‡ï¼Œå¯ä»¥æ‰§è¡Œå¤æ‚å‘½ä»¤</p>\n</li>\n<li class=\"lvl-2\">\n<p>ç¤ºä¾‹ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹è¿›ç¨‹</span></span><br><span class=\"line\">ansible webservers -m shell -a <span class=\"string\">&quot;ps -ef | grep java | grep -v &#x27;grep&#x27;&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ä¿®æ”¹å¯†ç </span></span><br><span class=\"line\">ansible webservers -m shell -a <span class=\"string\">&quot; echo 123456 | passwd --stdin ansible&quot;</span></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight yml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># shell.yml</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">åœ¨</span> <span class=\"string\">web</span> <span class=\"string\">æœåŠ¡å™¨ä¸ŠæŸ¥æ‰¾</span> <span class=\"string\">Java</span> <span class=\"string\">è¿›ç¨‹</span></span><br><span class=\"line\">  <span class=\"attr\">hosts:</span> <span class=\"string\">webservers</span></span><br><span class=\"line\">  <span class=\"attr\">tasks:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">æ‰§è¡Œ</span> <span class=\"string\">ps</span> <span class=\"string\">-ef</span> <span class=\"string\">|</span> <span class=\"string\">grep</span> <span class=\"string\">java</span> <span class=\"string\">|</span> <span class=\"string\">grep</span> <span class=\"string\">-v</span> <span class=\"string\">&#x27;grep&#x27;</span> <span class=\"string\">å‘½ä»¤</span></span><br><span class=\"line\">      <span class=\"attr\">shell:</span></span><br><span class=\"line\">        <span class=\"attr\">cmd:</span> <span class=\"string\">ps</span> <span class=\"string\">-ef</span> <span class=\"string\">|</span> <span class=\"string\">grep</span> <span class=\"string\">java</span> <span class=\"string\">|</span> <span class=\"string\">grep</span> <span class=\"string\">-v</span> <span class=\"string\">&#x27;grep&#x27;</span></span><br><span class=\"line\">      <span class=\"attr\">register:</span> <span class=\"string\">command_output</span>  <span class=\"comment\"># ä¿å­˜å‘½ä»¤æ‰§è¡Œç»“æœ</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">æ˜¾ç¤ºå‘½ä»¤è¾“å‡º</span></span><br><span class=\"line\">      <span class=\"attr\">debug:</span></span><br><span class=\"line\">        <span class=\"attr\">var:</span> <span class=\"string\">command_output.stdout_lines</span> <span class=\"comment\"># è¾“å‡ºå‘½ä»¤æ‰§è¡Œç»“æœ</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¸¸ç”¨å‚æ•°è¯´æ˜ï¼š<code>ansible-doc -s shell</code></p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>å‚æ•°</th>\n<th>æè¿°</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>argv</td>\n<td>è¦æ‰§è¡Œçš„å‘½ä»¤ï¼Œå¯ä»¥æ˜¯å­—ç¬¦ä¸²å½¢å¼æˆ–åˆ—è¡¨å½¢å¼ã€‚</td>\n</tr>\n<tr>\n<td>chdir</td>\n<td>åœ¨æ‰§è¡Œå‘½ä»¤ä¹‹å‰åˆ‡æ¢åˆ°çš„ç›®å½•ã€‚</td>\n</tr>\n<tr>\n<td>cmd</td>\n<td>è¦æ‰§è¡Œçš„å‘½ä»¤ã€‚</td>\n</tr>\n<tr>\n<td>creates</td>\n<td>æŒ‡å®šä¸€ä¸ªæ–‡ä»¶åæˆ–æ¨¡å¼ï¼Œå¦‚æœåŒ¹é…çš„æ–‡ä»¶å·²ç»å­˜åœ¨ï¼Œåˆ™ä¸æ‰§è¡Œå‘½ä»¤ã€‚</td>\n</tr>\n<tr>\n<td>executable</td>\n<td>ç”¨äºæ‰§è¡Œå‘½ä»¤çš„å¯æ‰§è¡Œç¨‹åºï¼Œé»˜è®¤æƒ…å†µä¸‹ä¸º /bin/shã€‚</td>\n</tr>\n<tr>\n<td>free_form</td>\n<td>ä»¥å­—ç¬¦ä¸²å½¢å¼æŒ‡å®šè¦æ‰§è¡Œçš„å‘½ä»¤ã€‚è¿™ä¸ªå‚æ•°å¹¶ä¸å­˜åœ¨ï¼Œä½†æ˜¯ shell æ¨¡å—æ¥å—è‡ªç”±å½¢å¼çš„å­—ç¬¦ä¸²ä½œä¸ºå‘½ä»¤ã€‚</td>\n</tr>\n<tr>\n<td>removes</td>\n<td>æŒ‡å®šä¸€ä¸ªæ–‡ä»¶åæˆ–æ¨¡å¼ï¼Œå¦‚æœåŒ¹é…çš„æ–‡ä»¶å­˜åœ¨ï¼Œåˆ™æ‰§è¡Œå‘½ä»¤ã€‚</td>\n</tr>\n<tr>\n<td>stdin</td>\n<td>å°†å‘½ä»¤çš„æ ‡å‡†è¾“å…¥è®¾ç½®ä¸ºæŒ‡å®šçš„å€¼ã€‚</td>\n</tr>\n<tr>\n<td>stdin_add_newline</td>\n<td>æ˜¯å¦åœ¨æ ‡å‡†è¾“å…¥æ•°æ®åæ·»åŠ æ¢è¡Œç¬¦ã€‚</td>\n</tr>\n<tr>\n<td>strip_empty_ends</td>\n<td>æ˜¯å¦ä»æ ‡å‡†è¾“å‡ºçš„æœ«å°¾å‰¥ç¦»ç©ºè¡Œã€‚</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"fileæ¨¡å—\">fileæ¨¡å—</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><a href=\"https://docs.ansible.com/ansible/latest/collections/ansible/builtin/file_module.html#ansible-collections-ansible-builtin-file-module\">fileæ¨¡å—</a>ä¸»è¦ç”¨äºæ–‡ä»¶å’Œç›®å½•çš„ç®¡ç†ï¼Œå¯ä»¥åˆ›å»ºã€åˆ é™¤ã€ä¿®æ”¹æ–‡ä»¶å’Œç›®å½•ï¼Œå¯ä»¥æŒ‡å®šæ–‡ä»¶æˆ–ç›®å½•çš„å±æ€§ï¼Œå¯ä»¥æŒ‡å®šæ–‡ä»¶æˆ–ç›®å½•çš„æƒé™ï¼Œå¯ä»¥æŒ‡å®šæ–‡ä»¶æˆ–ç›®å½•çš„ownerã€groupã€modeç­‰ä¿¡æ¯ï¼Œç­‰ç­‰</p>\n</li>\n<li class=\"lvl-2\">\n<p>ç¤ºä¾‹ï¼šåˆ›å»ºç›®å½•</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ansible webservers -m file -a <span class=\"string\">&quot;path=/tmp/`date +%F`  state=directory  mode=755&quot;</span></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight yml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># file.yml</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">åœ¨</span> <span class=\"string\">web</span> <span class=\"string\">æœåŠ¡å™¨ä¸Šåˆ›å»ºæ—¥æœŸæ ¼å¼çš„ç›®å½•</span></span><br><span class=\"line\">  <span class=\"attr\">hosts:</span> <span class=\"string\">webservers</span></span><br><span class=\"line\">  <span class=\"attr\">tasks:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">åˆ›å»ºç›®å½•</span></span><br><span class=\"line\">      <span class=\"attr\">file:</span></span><br><span class=\"line\">        <span class=\"attr\">path:</span> <span class=\"string\">&quot;/tmp/<span class=\"template-variable\">&#123;&#123; ansible_date_time.date &#125;&#125;</span>&quot;</span> <span class=\"comment\"># ansible_date_time.dateè¡¨ç¤ºå½“å‰æ—¶é—´è·å–çš„æ—¥æœŸï¼Œæ ¼å¼ä¸ºYYYY-MM-DD</span></span><br><span class=\"line\">        <span class=\"attr\">state:</span> <span class=\"string\">directory</span> <span class=\"comment\"># åˆ›å»ºç›®å½•ï¼Œå¦‚æœç›®å½•å·²ç»å­˜åœ¨åˆ™ä¸åˆ›å»º</span></span><br><span class=\"line\">        <span class=\"attr\">mode:</span> <span class=\"string\">&quot;755&quot;</span> <span class=\"comment\"># è®¾ç½®ç›®å½•æƒé™</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¸¸ç”¨å‚æ•°è¯´æ˜ï¼š<code>ansible-doc -s file</code></p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>å‚æ•°</th>\n<th>æè¿°</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>path</td>\n<td>æ–‡ä»¶æˆ–ç›®å½•çš„è·¯å¾„ã€‚</td>\n</tr>\n<tr>\n<td>state</td>\n<td>æ–‡ä»¶æˆ–ç›®å½•çš„çŠ¶æ€ã€‚å¯é€‰å€¼åŒ…æ‹¬ fileï¼ˆæ–‡ä»¶ï¼‰ã€directoryï¼ˆç›®å½•ï¼‰ã€linkï¼ˆç¬¦å·é“¾æ¥ï¼‰ã€‚é»˜è®¤ä¸º fileã€‚</td>\n</tr>\n<tr>\n<td>owner</td>\n<td>æ–‡ä»¶æˆ–ç›®å½•çš„æ‰€æœ‰è€…ã€‚</td>\n</tr>\n<tr>\n<td>group</td>\n<td>æ–‡ä»¶æˆ–ç›®å½•çš„æ‰€å±ç»„ã€‚</td>\n</tr>\n<tr>\n<td>mode</td>\n<td>æ–‡ä»¶æˆ–ç›®å½•çš„æƒé™ã€‚</td>\n</tr>\n<tr>\n<td>src</td>\n<td>æºæ–‡ä»¶è·¯å¾„ï¼Œç”¨äºå¤åˆ¶æ–‡ä»¶æˆ–åˆ›å»ºé“¾æ¥ã€‚</td>\n</tr>\n<tr>\n<td>dest</td>\n<td>ç›®æ ‡æ–‡ä»¶è·¯å¾„ï¼Œç”¨äºå¤åˆ¶æ–‡ä»¶æˆ–åˆ›å»ºé“¾æ¥ã€‚</td>\n</tr>\n<tr>\n<td>follow</td>\n<td>æ˜¯å¦éµå¾ªç¬¦å·é“¾æ¥ã€‚å¦‚æœä¸º yesï¼Œåˆ™ä¼šéµå¾ªç¬¦å·é“¾æ¥è¿›è¡Œæ“ä½œã€‚é»˜è®¤ä¸º yesã€‚</td>\n</tr>\n<tr>\n<td>selevel</td>\n<td>æ–‡ä»¶æˆ–ç›®å½•çš„ SELinux å®‰å…¨ä¸Šä¸‹æ–‡ã€‚</td>\n</tr>\n<tr>\n<td>serole</td>\n<td>æ–‡ä»¶æˆ–ç›®å½•çš„ SELinux è§’è‰²ã€‚</td>\n</tr>\n<tr>\n<td>setype</td>\n<td>æ–‡ä»¶æˆ–ç›®å½•çš„ SELinux ç±»å‹ã€‚</td>\n</tr>\n<tr>\n<td>seuser</td>\n<td>æ–‡ä»¶æˆ–ç›®å½•çš„ SELinux ç”¨æˆ·ã€‚</td>\n</tr>\n<tr>\n<td>unsafe_writes</td>\n<td>æ˜¯å¦å¯ç”¨ä¸å®‰å…¨çš„å†™å…¥æ¨¡å¼ã€‚å¦‚æœä¸º yesï¼Œåˆ™åœ¨å†™å…¥æ–‡ä»¶ä¹‹å‰ä¸ä¼šåˆ›å»ºå¤‡ä»½ã€‚é»˜è®¤ä¸º noã€‚</td>\n</tr>\n</tbody>\n</table>\n<blockquote>\n<p>è¿™é‡Œé‡ç‚¹è¯´ä¸€ä¸‹<code>state</code></p>\n</blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">fileï¼šè¡¨ç¤ºè¦æ±‚ç›®æ ‡ä¸»æœºä¸Šå­˜åœ¨æŒ‡å®šçš„æ–‡ä»¶ã€‚å¦‚æœæ–‡ä»¶å·²ç»å­˜åœ¨ï¼Œåˆ™ä¸æ‰§è¡Œä»»ä½•æ“ä½œï¼›å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ™ä¼šåˆ›å»ºå®ƒã€‚</span><br><span class=\"line\">directoryï¼šè¡¨ç¤ºè¦æ±‚ç›®æ ‡ä¸»æœºä¸Šå­˜åœ¨æŒ‡å®šçš„ç›®å½•ã€‚å¦‚æœç›®å½•å·²ç»å­˜åœ¨ï¼Œåˆ™ä¸æ‰§è¡Œä»»ä½•æ“ä½œï¼›å¦‚æœç›®å½•ä¸å­˜åœ¨ï¼Œåˆ™ä¼šåˆ›å»ºå®ƒã€‚</span><br><span class=\"line\">linkï¼šè¡¨ç¤ºè¦æ±‚ç›®æ ‡ä¸»æœºä¸Šå­˜åœ¨æŒ‡å®šçš„ç¬¦å·é“¾æ¥ã€‚å¦‚æœç¬¦å·é“¾æ¥å·²ç»å­˜åœ¨ï¼Œåˆ™ä¸æ‰§è¡Œä»»ä½•æ“ä½œï¼›å¦‚æœç¬¦å·é“¾æ¥ä¸å­˜åœ¨ï¼Œåˆ™ä¼šåˆ›å»ºå®ƒã€‚</span><br><span class=\"line\">hardï¼šåˆ›å»ºç¡¬é“¾æ¥</span><br><span class=\"line\">touchï¼šå¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ™ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„æ–‡ä»¶ï¼Œå¦‚æœæ–‡ä»¶æˆ–ç›®å½•å·²å­˜åœ¨ï¼Œåˆ™æ›´æ–°å…¶æœ€åä¿®æ”¹æ—¶é—´</span><br><span class=\"line\">absentï¼šåˆ é™¤ç›®å½•ã€æ–‡ä»¶æˆ–è€…å–æ¶ˆé“¾æ¥æ–‡ä»¶</span><br></pre></td></tr></table></figure>\n<h3 id=\"copyæ¨¡å—\">copyæ¨¡å—</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><a href=\"https://docs.ansible.com/ansible/latest/collections/ansible/builtin/copy_module.html#ansible-collections-ansible-builtin-copy-module\">copyæ¨¡å—</a>ä¸»è¦ç”¨äºå°†æ–‡ä»¶å¤åˆ¶åˆ°è¿œç¨‹æœåŠ¡å™¨ï¼Œå¯ä»¥æŒ‡å®šæ–‡ä»¶çš„æºè·¯å¾„ã€ç›®æ ‡è·¯å¾„ã€ownerã€groupã€modeç­‰ä¿¡æ¯ï¼Œç­‰ç­‰</p>\n</li>\n<li class=\"lvl-2\">\n<p>ç¤ºä¾‹ï¼šå¤åˆ¶æ–‡ä»¶åˆ°æŒ‡å®šç›®å½•</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># -b åˆ‡æ¢åˆ°rootç”¨æˆ·ä¸‹æ‰§è¡Œ</span></span><br><span class=\"line\">ansible webservers -m copy -a <span class=\"string\">&quot;src=/tmp/a.txt dest=/tmp/ owner=root group=root mode=755&quot;</span></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight yml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># copy.yml</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">åœ¨</span> <span class=\"string\">web</span> <span class=\"string\">æœåŠ¡å™¨ä¸Šå¤åˆ¶æ–‡ä»¶</span></span><br><span class=\"line\">  <span class=\"attr\">hosts:</span> <span class=\"string\">webservers</span></span><br><span class=\"line\">  <span class=\"attr\">become:</span> <span class=\"literal\">yes</span> <span class=\"comment\"># åˆ‡æ¢åˆ°rootç”¨æˆ·ä¸‹æ‰§è¡Œ</span></span><br><span class=\"line\">  <span class=\"attr\">tasks:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">å¤åˆ¶æ–‡ä»¶</span></span><br><span class=\"line\">      <span class=\"attr\">copy:</span></span><br><span class=\"line\">        <span class=\"attr\">src:</span> <span class=\"string\">&quot;/tmp/a.txt&quot;</span> <span class=\"comment\"># æºæ–‡ä»¶è·¯å¾„</span></span><br><span class=\"line\">        <span class=\"attr\">dest:</span> <span class=\"string\">&quot;/tmp/&quot;</span>     <span class=\"comment\"># ç›®æ ‡æ–‡ä»¶è·¯å¾„</span></span><br><span class=\"line\">        <span class=\"attr\">owner:</span> <span class=\"string\">root</span>       <span class=\"comment\"># æŒ‡å®šæ–‡ä»¶owner</span></span><br><span class=\"line\">        <span class=\"attr\">group:</span> <span class=\"string\">root</span>       <span class=\"comment\"># æŒ‡å®šæ–‡ä»¶group</span></span><br><span class=\"line\">        <span class=\"attr\">mode:</span> <span class=\"string\">&quot;755&quot;</span>       <span class=\"comment\"># æŒ‡å®šæ–‡ä»¶æƒé™</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¸¸ç”¨å‚æ•°è¯´æ˜ï¼š<code>ansible-doc -s copy</code></p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>å‚æ•°</th>\n<th>æè¿°</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>src</td>\n<td>æºæ–‡ä»¶çš„è·¯å¾„ã€‚</td>\n</tr>\n<tr>\n<td>dest</td>\n<td>ç›®æ ‡æ–‡ä»¶çš„è·¯å¾„ã€‚</td>\n</tr>\n<tr>\n<td>backup</td>\n<td>æ˜¯å¦å¤‡ä»½ç›®æ ‡æ–‡ä»¶ã€‚å¦‚æœä¸º yesï¼Œåˆ™åœ¨å¤åˆ¶ç›®æ ‡æ–‡ä»¶ä¹‹å‰ä¼šåˆ›å»ºä¸€ä¸ªå¤‡ä»½æ–‡ä»¶ã€‚é»˜è®¤ä¸º yesã€‚</td>\n</tr>\n<tr>\n<td>content</td>\n<td>è¦å†™å…¥ç›®æ ‡æ–‡ä»¶çš„å†…å®¹ã€‚</td>\n</tr>\n<tr>\n<td>directory_mode</td>\n<td>ç›®æ ‡ç›®å½•çš„æƒé™ã€‚åªæœ‰å½“ç›®æ ‡æ˜¯ä¸€ä¸ªç›®å½•æ—¶æ‰ä¼šç”Ÿæ•ˆã€‚</td>\n</tr>\n<tr>\n<td>follow</td>\n<td>æ˜¯å¦è·Ÿéšç¬¦å·é“¾æ¥ã€‚å¦‚æœä¸º yesï¼Œåˆ™ä¼šè·Ÿéšç¬¦å·é“¾æ¥è¿›è¡Œæ“ä½œã€‚é»˜è®¤ä¸º yesã€‚</td>\n</tr>\n<tr>\n<td>force</td>\n<td>æ˜¯å¦å¼ºåˆ¶è¦†ç›–ç›®æ ‡æ–‡ä»¶ã€‚å¦‚æœä¸º yesï¼Œåˆ™å¼ºåˆ¶å¤åˆ¶æºæ–‡ä»¶ï¼Œå³ä½¿ç›®æ ‡æ–‡ä»¶å·²ç»å­˜åœ¨ã€‚é»˜è®¤ä¸º noã€‚</td>\n</tr>\n<tr>\n<td>group</td>\n<td>ç›®æ ‡æ–‡ä»¶çš„æ‰€å±ç»„ã€‚</td>\n</tr>\n<tr>\n<td>mode</td>\n<td>ç›®æ ‡æ–‡ä»¶çš„æƒé™ã€‚</td>\n</tr>\n<tr>\n<td>owner</td>\n<td>ç›®æ ‡æ–‡ä»¶çš„æ‰€æœ‰è€…ã€‚</td>\n</tr>\n<tr>\n<td>remote_src</td>\n<td>æŒ‡å®šæºæ–‡ä»¶æ˜¯å¦åœ¨è¿œç¨‹ä¸»æœºä¸Šã€‚å¦‚æœä¸º yesï¼Œè¡¨ç¤ºæºæ–‡ä»¶åœ¨è¿œç¨‹ä¸»æœºä¸Šã€‚é»˜è®¤ä¸º noã€‚</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"fetchæ¨¡å—\">fetchæ¨¡å—</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><a href=\"https://docs.ansible.com/ansible/latest/collections/ansible/builtin/fetch_module.html#ansible-collections-ansible-builtin-fetch-module\">fetchæ¨¡å—</a>ä¸»è¦ç”¨äºå°†æ–‡ä»¶ä»è¿œç¨‹æœåŠ¡å™¨å¤åˆ¶åˆ°æœ¬åœ°ï¼Œå¯ä»¥æŒ‡å®šæ–‡ä»¶çš„æºè·¯å¾„ã€ç›®æ ‡è·¯å¾„ã€ownerã€groupã€modeç­‰ä¿¡æ¯ï¼Œç­‰ç­‰</p>\n</li>\n<li class=\"lvl-2\">\n<p>ç¤ºä¾‹ï¼šå°†æ–‡ä»¶ä»è¿œç¨‹æœåŠ¡å™¨å¤åˆ¶åˆ°æœ¬åœ°</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ansible webservers -m fetch -a <span class=\"string\">&quot;src=/tmp/a.txt dest=/tmp/ flat=yes&quot;</span></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight yml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># fetch.yml</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">åœ¨</span> <span class=\"string\">web</span> <span class=\"string\">æœåŠ¡å™¨ä¸Šå°†æ–‡ä»¶ä»è¿œç¨‹æœåŠ¡å™¨å¤åˆ¶åˆ°æœ¬åœ°</span></span><br><span class=\"line\">  <span class=\"attr\">hosts:</span> <span class=\"string\">webservers</span></span><br><span class=\"line\">  <span class=\"attr\">tasks:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">å¤åˆ¶æ–‡ä»¶</span></span><br><span class=\"line\">      <span class=\"attr\">fetch:</span></span><br><span class=\"line\">        <span class=\"attr\">src:</span> <span class=\"string\">&quot;/tmp/a.txt&quot;</span></span><br><span class=\"line\">        <span class=\"attr\">dest:</span> <span class=\"string\">&quot;/tmp/&quot;</span></span><br><span class=\"line\">        <span class=\"attr\">flat:</span> <span class=\"literal\">yes</span> <span class=\"comment\"># flat: yes  # å°†æ–‡ä»¶å¤åˆ¶åˆ°destç›®å½•ä¸‹ï¼Œä¸åˆ›å»ºç›®å½•ç»“æ„</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¸¸ç”¨å‚æ•°è¯´æ˜ï¼š<code>ansible-doc -s fetch</code></p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>å‚æ•°</th>\n<th>æè¿°</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>src</td>\n<td>è¿œç¨‹ä¸»æœºä¸Šè¦æ‹‰å–çš„æ–‡ä»¶çš„è·¯å¾„ã€‚</td>\n</tr>\n<tr>\n<td>dest</td>\n<td>æœ¬åœ°ä¸»æœºä¸Šæ–‡ä»¶çš„ç›®æ ‡è·¯å¾„ã€‚</td>\n</tr>\n<tr>\n<td>flat</td>\n<td>æ˜¯å¦å°†æ–‡ä»¶æ”¾ç½®åœ¨é¡¶å±‚ç›®å½•ä¸­ã€‚å¦‚æœä¸º yesï¼Œåˆ™æ‰€æœ‰æ–‡ä»¶éƒ½å°†æ”¾ç½®åœ¨ä¸€ä¸ªç›®å½•ä¸­ã€‚é»˜è®¤ä¸º noã€‚</td>\n</tr>\n<tr>\n<td>fail_on_missing</td>\n<td>å¦‚æœä¸º yesï¼Œåˆ™åœ¨æºæ–‡ä»¶ä¸å­˜åœ¨æ—¶å¤±è´¥ã€‚é»˜è®¤ä¸º yesã€‚</td>\n</tr>\n<tr>\n<td>validate_checksum</td>\n<td>æ˜¯å¦éªŒè¯è¿œç¨‹æ–‡ä»¶çš„æ ¡éªŒå’Œã€‚é»˜è®¤ä¸º noã€‚</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"cronæ¨¡å—\">cronæ¨¡å—</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><a href=\"https://docs.ansible.com/ansible/latest/collections/ansible/builtin/cron_module.html#ansible-collections-ansible-builtin-cron-module\">cronæ¨¡å—</a>ä¸»è¦ç”¨äºåœ¨è¿œç¨‹æœåŠ¡å™¨ä¸Šåˆ›å»ºã€ä¿®æ”¹ã€åˆ é™¤å®šæ—¶ä»»åŠ¡</p>\n</li>\n<li class=\"lvl-2\">\n<p>ç¤ºä¾‹ï¼šåˆ›å»ºå®šæ—¶ä»»åŠ¡</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ansible webservers -m cron -a <span class=\"string\">&#x27;name=&quot;restart httpd&quot; hour=*/5 job=&quot;systemctl restart httpd&quot;&#x27;</span></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight yml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># cron.yml</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">åœ¨</span> <span class=\"string\">web</span> <span class=\"string\">æœåŠ¡å™¨ä¸Šåˆ›å»ºå®šæ—¶ä»»åŠ¡</span></span><br><span class=\"line\">  <span class=\"attr\">hosts:</span> <span class=\"string\">webservers</span></span><br><span class=\"line\">  <span class=\"attr\">tasks:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">åˆ›å»ºå®šæ—¶ä»»åŠ¡</span></span><br><span class=\"line\">      <span class=\"attr\">cron:</span></span><br><span class=\"line\">        <span class=\"attr\">name:</span> <span class=\"string\">&quot;restart httpd&quot;</span></span><br><span class=\"line\">        <span class=\"attr\">hour:</span> <span class=\"string\">&quot;*/5&quot;</span></span><br><span class=\"line\">        <span class=\"attr\">job:</span> <span class=\"string\">&quot;systemctl restart httpd&quot;</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¸¸ç”¨å‚æ•°è¯´æ˜ï¼š<code>ansible-doc -s cron</code></p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>å‚æ•°</th>\n<th>æè¿°</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>name</td>\n<td>cron ä»»åŠ¡çš„åç§°ã€‚</td>\n</tr>\n<tr>\n<td>minute</td>\n<td>cron ä»»åŠ¡æ‰§è¡Œçš„åˆ†é’Ÿã€‚</td>\n</tr>\n<tr>\n<td>hour</td>\n<td>cron ä»»åŠ¡æ‰§è¡Œçš„å°æ—¶ã€‚</td>\n</tr>\n<tr>\n<td>day</td>\n<td>cron ä»»åŠ¡æ‰§è¡Œçš„æ—¥æœŸã€‚</td>\n</tr>\n<tr>\n<td>month</td>\n<td>cron ä»»åŠ¡æ‰§è¡Œçš„æœˆä»½ã€‚</td>\n</tr>\n<tr>\n<td>weekday</td>\n<td>cron ä»»åŠ¡æ‰§è¡Œçš„æ˜ŸæœŸå‡ ã€‚</td>\n</tr>\n<tr>\n<td>job</td>\n<td>è¦æ‰§è¡Œçš„å‘½ä»¤æˆ–è„šæœ¬ã€‚</td>\n</tr>\n<tr>\n<td>cron_file</td>\n<td>è¦æ“ä½œçš„ cron æ–‡ä»¶çš„è·¯å¾„ã€‚é»˜è®¤ä¸º /etc/crontabã€‚</td>\n</tr>\n<tr>\n<td>state</td>\n<td>cron ä»»åŠ¡çš„çŠ¶æ€ã€‚å¯é€‰å€¼åŒ…æ‹¬ presentï¼ˆé»˜è®¤ï¼‰å’Œ absentã€‚è¡¨ç¤ºè¦æ±‚ä»»åŠ¡å­˜åœ¨æˆ–ä¸å­˜åœ¨ã€‚</td>\n</tr>\n<tr>\n<td>user</td>\n<td>cron ä»»åŠ¡çš„æ‰§è¡Œç”¨æˆ·ã€‚é»˜è®¤ä¸º rootã€‚</td>\n</tr>\n<tr>\n<td>backup</td>\n<td>æ˜¯å¦å¤‡ä»½ cron æ–‡ä»¶ã€‚å¯é€‰å€¼åŒ…æ‹¬ true å’Œ falseã€‚</td>\n</tr>\n</tbody>\n</table>\n<blockquote>\n<p>state</p>\n</blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">presentï¼šè¡¨ç¤ºè¦æ±‚æŒ‡å®šçš„ cron ä»»åŠ¡å­˜åœ¨ã€‚å¦‚æœæŒ‡å®šçš„ cron ä»»åŠ¡ä¸å­˜åœ¨ï¼Œåˆ™ Ansible å°†ä¼šåˆ›å»ºå®ƒã€‚å¦‚æœå·²ç»å­˜åœ¨ï¼Œåˆ™ä¸æ‰§è¡Œä»»ä½•æ“ä½œã€‚</span><br><span class=\"line\">absentï¼šè¡¨ç¤ºè¦æ±‚æŒ‡å®šçš„ cron ä»»åŠ¡ä¸å­˜åœ¨ã€‚å¦‚æœæŒ‡å®šçš„ cron ä»»åŠ¡å­˜åœ¨ï¼Œåˆ™ Ansible å°†ä¼šåˆ é™¤å®ƒã€‚å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™ä¸æ‰§è¡Œä»»ä½•æ“ä½œã€‚</span><br></pre></td></tr></table></figure>\n<h3 id=\"yumæ¨¡å—\">yumæ¨¡å—</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><a href=\"https://docs.ansible.com/ansible/latest/collections/ansible/builtin/yum_module.html#ansible-collections-ansible-builtin-yum-module\">yumæ¨¡å—</a>ä¸»è¦ç”¨äºåœ¨è¿œç¨‹æœåŠ¡å™¨ä¸Šå®‰è£…ã€å¸è½½ã€æ›´æ–°è½¯ä»¶åŒ…ï¼Œå¯ä»¥æŒ‡å®šè½¯ä»¶åŒ…çš„åç§°ã€ç‰ˆæœ¬ã€repoç­‰ä¿¡æ¯ï¼Œç­‰ç­‰</p>\n</li>\n<li class=\"lvl-2\">\n<p>ç¤ºä¾‹ï¼šå®‰è£…è½¯ä»¶åŒ…</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å®‰è£…è½¯ä»¶åŒ…ï¼Œç›¸å½“äº yum install httpd</span></span><br><span class=\"line\">ansible webservers -m yum -a <span class=\"string\">&quot;name=httpd state=present&quot;</span></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight yml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># yum.yml</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">åœ¨</span> <span class=\"string\">web</span> <span class=\"string\">æœåŠ¡å™¨ä¸Šå®‰è£…</span> <span class=\"string\">httpd</span> <span class=\"string\">è½¯ä»¶åŒ…</span></span><br><span class=\"line\">  <span class=\"attr\">hosts:</span> <span class=\"string\">webservers</span></span><br><span class=\"line\">  <span class=\"attr\">tasks:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">å®‰è£…</span> <span class=\"string\">httpd</span> <span class=\"string\">è½¯ä»¶åŒ…</span></span><br><span class=\"line\">      <span class=\"attr\">yum:</span></span><br><span class=\"line\">        <span class=\"attr\">name:</span> <span class=\"string\">httpd</span> <span class=\"comment\"># è½¯ä»¶åŒ…åç§°ï¼Œç›¸å½“äº yum install httpd</span></span><br><span class=\"line\">        <span class=\"attr\">state:</span> <span class=\"string\">present</span> <span class=\"comment\"># å®‰è£…è½¯ä»¶åŒ…ï¼Œå¦‚æœè½¯ä»¶åŒ…å·²ç»å®‰è£…åˆ™ä¸å®‰è£…</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¸¸ç”¨å‚æ•°è¯´æ˜:<code>ansible-doc -s yum</code></p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>å‚æ•°</th>\n<th>è§£é‡Š</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>name</td>\n<td>æŒ‡å®šè¦æ“ä½œçš„åŒ…çš„åç§°ã€‚</td>\n</tr>\n<tr>\n<td>update_cache</td>\n<td>æŒ‡å®šæ˜¯å¦åœ¨æ‰§è¡Œæ“ä½œä¹‹å‰æ›´æ–° yum ç¼“å­˜ã€‚å¯é€‰å€¼ä¸º <code>yes</code> æˆ– <code>no</code>ã€‚é»˜è®¤ä¸º <code>yes</code>ã€‚</td>\n</tr>\n<tr>\n<td>disable_gpg_check</td>\n<td>æŒ‡å®šæ˜¯å¦ç¦ç”¨ GPG æ£€æŸ¥ã€‚å¦‚æœä¸º <code>yes</code>ï¼Œåˆ™ç¦ç”¨ GPG æ£€æŸ¥ã€‚é»˜è®¤ä¸º <code>no</code>ã€‚</td>\n</tr>\n<tr>\n<td>disable_plugin</td>\n<td>æŒ‡å®šæ˜¯å¦ç¦ç”¨æŒ‡å®šçš„ yum æ’ä»¶ã€‚å¯ä»¥æ˜¯ä¸€ä¸ªæ’ä»¶åç§°çš„åˆ—è¡¨ã€‚</td>\n</tr>\n<tr>\n<td>enablerepo</td>\n<td>æŒ‡å®šè¦å¯ç”¨çš„ä»“åº“ã€‚å¯ä»¥æ˜¯ä¸€ä¸ªä»“åº“åç§°çš„åˆ—è¡¨ã€‚</td>\n</tr>\n<tr>\n<td>disablerepo</td>\n<td>æŒ‡å®šè¦ç¦ç”¨çš„ä»“åº“ã€‚å¯ä»¥æ˜¯ä¸€ä¸ªä»“åº“åç§°çš„åˆ—è¡¨ã€‚</td>\n</tr>\n<tr>\n<td>installroot</td>\n<td>æŒ‡å®šè¦å®‰è£…è½¯ä»¶åŒ…çš„æ ¹ç›®å½•ã€‚</td>\n</tr>\n<tr>\n<td>security</td>\n<td>æŒ‡å®šæ˜¯å¦åªå®‰è£…å®‰å…¨æ›´æ–°ã€‚å¦‚æœä¸º <code>yes</code>ï¼Œåˆ™åªå®‰è£…å®‰å…¨æ›´æ–°ã€‚é»˜è®¤ä¸º <code>no</code>ã€‚</td>\n</tr>\n<tr>\n<td>list</td>\n<td>æŒ‡å®šæ˜¯å¦åˆ—å‡ºæ‰€æœ‰å·²å®‰è£…çš„åŒ…ã€‚å¦‚æœä¸º <code>yes</code>ï¼Œåˆ™åˆ—å‡ºå·²å®‰è£…çš„åŒ…ã€‚é»˜è®¤ä¸º <code>no</code>ã€‚</td>\n</tr>\n<tr>\n<td>state</td>\n<td>æŒ‡å®šè½¯ä»¶åŒ…çš„çŠ¶æ€ã€‚å¯é€‰å€¼ä¸º <code>present</code>ã€<code>latest</code>ã€<code>absent</code>ã€<code>installed</code>ã€<code>removed</code>ã€‚é»˜è®¤ä¸º <code>present</code>ã€‚</td>\n</tr>\n</tbody>\n</table>\n<blockquote>\n<p>è¿™é‡Œé‡ç‚¹è¯´ä¸€ä¸‹<code>state</code></p>\n</blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">present: è¡¨ç¤ºè¦æ±‚ç›®æ ‡ä¸»æœºä¸Šå­˜åœ¨æŒ‡å®šçš„è½¯ä»¶åŒ…ã€‚å¦‚æœè½¯ä»¶åŒ…å·²ç»å®‰è£…ï¼Œåˆ™ä¸æ‰§è¡Œä»»ä½•æ“ä½œï¼›å¦‚æœè½¯ä»¶åŒ…æœªå®‰è£…ï¼Œåˆ™ä¼šå®‰è£…å®ƒã€‚</span><br><span class=\"line\">latest: è¡¨ç¤ºè¦æ±‚ç›®æ ‡ä¸»æœºä¸Šå­˜åœ¨æŒ‡å®šçš„è½¯ä»¶åŒ…ï¼Œå¹¶ä¸”å¸Œæœ›ä¿æŒä¸ºæœ€æ–°ç‰ˆæœ¬ã€‚å¦‚æœè½¯ä»¶åŒ…å·²ç»å®‰è£…ï¼Œä½†ä¸æ˜¯æœ€æ–°ç‰ˆæœ¬ï¼Œåˆ™ä¼šæ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬ï¼›å¦‚æœè½¯ä»¶åŒ…æœªå®‰è£…ï¼Œåˆ™ä¼šå®‰è£…æœ€æ–°ç‰ˆæœ¬ã€‚</span><br><span class=\"line\">absent: è¡¨ç¤ºè¦æ±‚ç›®æ ‡ä¸»æœºä¸Šä¸å­˜åœ¨æŒ‡å®šçš„è½¯ä»¶åŒ…ã€‚å¦‚æœè½¯ä»¶åŒ…å·²å®‰è£…ï¼Œåˆ™ä¼šå°†å…¶å¸è½½ï¼›å¦‚æœè½¯ä»¶åŒ…æœªå®‰è£…ï¼Œåˆ™ä¸æ‰§è¡Œä»»ä½•æ“ä½œã€‚</span><br><span class=\"line\">installed: ä¸ present æ„ä¹‰ç›¸åŒï¼Œç”¨äºæ˜ç¡®è¡¨è¾¾å¸Œæœ›è½¯ä»¶åŒ…å·²ç»å®‰è£…åœ¨ç›®æ ‡ä¸»æœºä¸Šã€‚</span><br><span class=\"line\">removed: ä¸ absent æ„ä¹‰ç›¸åŒï¼Œç”¨äºæ˜ç¡®è¡¨è¾¾å¸Œæœ›è½¯ä»¶åŒ…å·²ä»ç›®æ ‡ä¸»æœºä¸Šå¸è½½ã€‚</span><br></pre></td></tr></table></figure>\n<h3 id=\"serviceæ¨¡å—-è°ƒç”¨çš„æ˜¯serviceå‘½ä»¤\">serviceæ¨¡å—:è°ƒç”¨çš„æ˜¯<code>service</code>å‘½ä»¤</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><a href=\"https://docs.ansible.com/ansible/latest/collections/ansible/builtin/service_module.html#ansible-collections-ansible-builtin-service-module\">serviceæ¨¡å—</a>ä¸»è¦ç”¨äºåœ¨è¿œç¨‹æœåŠ¡å™¨ä¸Šå¯åŠ¨ã€åœæ­¢ã€é‡å¯ã€é‡æ–°åŠ è½½ã€å¯ç”¨ã€ç¦ç”¨ã€æ£€æŸ¥æœåŠ¡ï¼Œå¯ä»¥æŒ‡å®šæœåŠ¡çš„åç§°ã€çŠ¶æ€ã€å¯åŠ¨æ–¹å¼ç­‰ä¿¡æ¯ï¼Œç­‰ç­‰</p>\n</li>\n<li class=\"lvl-2\">\n<p>ç¤ºä¾‹ï¼šå¯åŠ¨æœåŠ¡</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ansible webservers -m service -a <span class=\"string\">&quot;name=httpd state=started&quot;</span></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight yml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># service.yml</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">åœ¨</span> <span class=\"string\">web</span> <span class=\"string\">æœåŠ¡å™¨ä¸Šå¯åŠ¨</span> <span class=\"string\">httpd</span> <span class=\"string\">æœåŠ¡</span></span><br><span class=\"line\">  <span class=\"attr\">hosts:</span> <span class=\"string\">webservers</span></span><br><span class=\"line\">  <span class=\"attr\">tasks:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">å¯åŠ¨</span> <span class=\"string\">httpd</span> <span class=\"string\">æœåŠ¡</span></span><br><span class=\"line\">      <span class=\"attr\">service:</span></span><br><span class=\"line\">        <span class=\"attr\">name:</span> <span class=\"string\">httpd</span></span><br><span class=\"line\">        <span class=\"attr\">state:</span> <span class=\"string\">started</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¸¸ç”¨å‚æ•°è¯´æ˜:<code>ansible-doc -s service</code></p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>å‚æ•°</th>\n<th>æè¿°</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>name</td>\n<td>æœåŠ¡çš„åç§°ã€‚</td>\n</tr>\n<tr>\n<td>state</td>\n<td>æœåŠ¡çš„çŠ¶æ€ã€‚å¯é€‰å€¼åŒ…æ‹¬ startedï¼ˆå·²å¯åŠ¨ï¼‰ã€stoppedï¼ˆå·²åœæ­¢ï¼‰ã€restartedï¼ˆå·²é‡å¯ï¼‰ã€‚</td>\n</tr>\n<tr>\n<td>enabled</td>\n<td>æ˜¯å¦åœ¨å¯åŠ¨æ—¶è‡ªåŠ¨å¯ç”¨æœåŠ¡ã€‚å¦‚æœä¸º yesï¼Œåˆ™åœ¨ç³»ç»Ÿå¯åŠ¨æ—¶è‡ªåŠ¨å¯åŠ¨æœåŠ¡ã€‚é»˜è®¤ä¸º yesã€‚</td>\n</tr>\n<tr>\n<td>pattern</td>\n<td>åŒ¹é…æœåŠ¡çš„æ¨¡å¼ã€‚é»˜è®¤æƒ…å†µä¸‹ä¸ºæœåŠ¡åç§°ã€‚</td>\n</tr>\n<tr>\n<td>sleep</td>\n<td>åœ¨é‡æ–°å¯åŠ¨æœåŠ¡ä¹‹å‰ç­‰å¾…çš„ç§’æ•°ã€‚</td>\n</tr>\n<tr>\n<td>arguments</td>\n<td>å¯åŠ¨æˆ–åœæ­¢æœåŠ¡æ—¶è¦ä¼ é€’çš„å‚æ•°ã€‚</td>\n</tr>\n</tbody>\n</table>\n<blockquote>\n<p>state</p>\n</blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">startedï¼šè¡¨ç¤ºè¦æ±‚æœåŠ¡å¤„äºå·²å¯åŠ¨çŠ¶æ€ã€‚å¦‚æœæŒ‡å®šçš„æœåŠ¡æœªå¯åŠ¨ï¼Œåˆ™ Ansible å°†å°è¯•å¯åŠ¨è¯¥æœåŠ¡ã€‚å¦‚æœæœåŠ¡å·²ç»å¤„äºè¿è¡ŒçŠ¶æ€ï¼Œåˆ™ä¸æ‰§è¡Œä»»ä½•æ“ä½œã€‚</span><br><span class=\"line\">stoppedï¼šè¡¨ç¤ºè¦æ±‚æœåŠ¡å¤„äºå·²åœæ­¢çŠ¶æ€ã€‚å¦‚æœæŒ‡å®šçš„æœåŠ¡æ­£åœ¨è¿è¡Œï¼Œåˆ™ Ansible å°†å°è¯•åœæ­¢è¯¥æœåŠ¡ã€‚å¦‚æœæœåŠ¡å·²ç»åœæ­¢ï¼Œåˆ™ä¸æ‰§è¡Œä»»ä½•æ“ä½œã€‚</span><br><span class=\"line\">restartedï¼šè¡¨ç¤ºè¦æ±‚é‡å¯æœåŠ¡ã€‚æ— è®ºæœåŠ¡å½“å‰å¤„äºè¿è¡ŒçŠ¶æ€è¿˜æ˜¯åœæ­¢çŠ¶æ€ï¼ŒAnsible éƒ½ä¼šå°è¯•é‡æ–°å¯åŠ¨è¯¥æœåŠ¡ã€‚</span><br></pre></td></tr></table></figure>\n<h3 id=\"systemdæ¨¡å—-æ”¯æŒcentos7-ï¼Œè°ƒç”¨çš„æ˜¯systemctl\">systemdæ¨¡å—:æ”¯æŒ<code>centos7+</code>ï¼Œè°ƒç”¨çš„æ˜¯<code>systemctl</code></h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><a href=\"https://docs.ansible.com/ansible/latest/collections/ansible/builtin/systemd_service_module.html#ansible-collections-ansible-builtin-systemd-service-module\">systemdæ¨¡å—</a>ç”¨äºæ§åˆ¶ systemd åå°æœåŠ¡ï¼Œå…è®¸ä½ å¯åŠ¨ã€é‡æ–°å¯åŠ¨ã€åœæ­¢æˆ–è€…é‡æ–°åŠ è½½ systemd æœåŠ¡ã€‚æ­¤å¤–ï¼Œä½ ä¹Ÿå¯ä»¥ä½¿ç”¨å®ƒæ¥ä½¿æœåŠ¡åœ¨ç³»ç»Ÿå¯åŠ¨æ—¶è‡ªåŠ¨å¯åŠ¨æˆ–ç¦æ­¢è‡ªåŠ¨å¯åŠ¨ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œsystemd æ¨¡å—è¿˜å…è®¸ä½ æ£€æŸ¥æœåŠ¡çš„çŠ¶æ€ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ç¤ºä¾‹</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ansible webservers -m systemd -a <span class=\"string\">&quot;name=httpd state=restarted&quot;</span></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight yml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># systemd.yml</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">åœ¨</span> <span class=\"string\">web</span> <span class=\"string\">æœåŠ¡å™¨ä¸Šé‡æ–°å¯åŠ¨</span> <span class=\"string\">httpd</span> <span class=\"string\">æœåŠ¡</span></span><br><span class=\"line\">  <span class=\"attr\">hosts:</span> <span class=\"string\">webservers</span></span><br><span class=\"line\">  <span class=\"attr\">tasks:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">é‡æ–°å¯åŠ¨</span> <span class=\"string\">httpd</span> <span class=\"string\">æœåŠ¡</span></span><br><span class=\"line\">      <span class=\"attr\">systemd:</span></span><br><span class=\"line\">        <span class=\"attr\">name:</span> <span class=\"string\">httpd</span></span><br><span class=\"line\">        <span class=\"attr\">state:</span> <span class=\"string\">restarted</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¸»è¦å‚æ•°è¯´æ˜ï¼š<code>ansible-doc -s systemd</code></p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>å‚æ•°</th>\n<th>æè¿°</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>enabled</td>\n<td>æŒ‡å®šæœåŠ¡æ˜¯å¦åº”è¯¥åœ¨å¯åŠ¨æ—¶è‡ªåŠ¨å¯ç”¨ã€‚å¯é€‰å€¼ä¸º yes æˆ– noã€‚é»˜è®¤ä¸º yesã€‚</td>\n</tr>\n<tr>\n<td>masked</td>\n<td>æŒ‡å®šæœåŠ¡æ˜¯å¦åº”è¯¥è¢«ç½®ä¸º masked çŠ¶æ€ï¼Œç¦æ­¢æ‰‹åŠ¨å¯åŠ¨ã€‚å¯é€‰å€¼ä¸º yes æˆ– noã€‚é»˜è®¤ä¸º noã€‚</td>\n</tr>\n<tr>\n<td>name</td>\n<td>æœåŠ¡çš„åç§°ã€‚</td>\n</tr>\n<tr>\n<td>state</td>\n<td>æŒ‡å®šæœåŠ¡çš„çŠ¶æ€ã€‚å¯é€‰å€¼ä¸º startedï¼ˆå¯åŠ¨ï¼‰ã€stoppedï¼ˆåœæ­¢ï¼‰ã€restartedï¼ˆé‡æ–°å¯åŠ¨ï¼‰ã€reloadedï¼ˆé‡æ–°åŠ è½½ï¼‰</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"scriptæ¨¡å—\">scriptæ¨¡å—</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><a href=\"https://docs.ansible.com/ansible/latest/collections/ansible/builtin/script_module.html#ansible-collections-ansible-builtin-script-module\">scriptæ¨¡å—</a>ä¸»è¦ç”¨äºåœ¨è¿œç¨‹æœåŠ¡å™¨ä¸Šæ‰§è¡Œæœ¬åœ°çš„è„šæœ¬</p>\n</li>\n<li class=\"lvl-2\">\n<p>ç¤ºä¾‹ï¼šæ‰§è¡Œè„šæœ¬</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ansible webservers -m script -a <span class=\"string\">&quot;chdir=/tmp /tmp/a.sh&quot;</span></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight yml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># script.yml</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">åœ¨</span> <span class=\"string\">web</span> <span class=\"string\">æœåŠ¡å™¨ä¸Šè¿è¡Œè„šæœ¬</span></span><br><span class=\"line\">  <span class=\"attr\">hosts:</span> <span class=\"string\">webservers</span></span><br><span class=\"line\">  <span class=\"attr\">tasks:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">åœ¨</span> <span class=\"string\">/tmp</span> <span class=\"string\">ç›®å½•ä¸­è¿è¡Œè„šæœ¬</span></span><br><span class=\"line\">      <span class=\"attr\">script:</span></span><br><span class=\"line\">        <span class=\"attr\">chdir:</span> <span class=\"string\">/tmp</span> <span class=\"comment\"># æŒ‡å®šè„šæœ¬çš„æ‰§è¡Œç›®å½•</span></span><br><span class=\"line\">        <span class=\"attr\">cmd:</span> <span class=\"string\">/tmp/a.sh</span> <span class=\"comment\"># æœ¬åœ°è„šæœ¬çš„è·¯å¾„</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¸¸ç”¨å‚æ•°è¯´æ˜:<code>ansible-doc -s script</code></p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>å‚æ•°</th>\n<th>æè¿°</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>chdir</td>\n<td>åœ¨è¿œç¨‹ä¸»æœºä¸Šæ‰§è¡Œè„šæœ¬ä¹‹å‰åˆ‡æ¢åˆ°çš„ç›®å½•ã€‚</td>\n</tr>\n<tr>\n<td>free_form</td>\n<td>è¦åœ¨è¿œç¨‹ä¸»æœºä¸Šæ‰§è¡Œçš„è„šæœ¬å†…å®¹ã€‚</td>\n</tr>\n<tr>\n<td>creates</td>\n<td>å¦‚æœæŒ‡å®šçš„æ–‡ä»¶å·²ç»å­˜åœ¨ï¼Œåˆ™ä¸æ‰§è¡Œè„šæœ¬ã€‚</td>\n</tr>\n<tr>\n<td>executable</td>\n<td>æŒ‡å®šè¦ä½¿ç”¨çš„è„šæœ¬è§£é‡Šå™¨ã€‚</td>\n</tr>\n<tr>\n<td>removes</td>\n<td>åœ¨æ‰§è¡Œè„šæœ¬ä¹‹åï¼Œå¦‚æœæŒ‡å®šçš„æ–‡ä»¶å­˜åœ¨ï¼Œåˆ™åˆ é™¤è¯¥æ–‡ä»¶ã€‚</td>\n</tr>\n<tr>\n<td>cmd</td>\n<td>æŒ‡å®šè¦æ‰§è¡Œçš„å‘½ä»¤ã€‚</td>\n</tr>\n<tr>\n<td>decrypt</td>\n<td>æŒ‡å®šè¦è§£å¯†çš„æºæ–‡ä»¶ã€‚</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"useræ¨¡å—\">useræ¨¡å—</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><a href=\"https://docs.ansible.com/ansible/latest/collections/ansible/builtin/user_module.html#ansible-collections-ansible-builtin-user-module\">useræ¨¡å—</a>ä¸»è¦ç”¨äºåœ¨è¿œç¨‹æœåŠ¡å™¨ä¸Šåˆ›å»ºã€ä¿®æ”¹ã€åˆ é™¤ç”¨æˆ·ï¼Œå¯ä»¥æŒ‡å®šç”¨æˆ·çš„åç§°ã€å¯†ç ã€uidã€gidã€homeã€shellç­‰ä¿¡æ¯ï¼Œç­‰ç­‰</p>\n</li>\n<li class=\"lvl-2\">\n<p>ç¤ºä¾‹ï¼šåˆ›å»ºç”¨æˆ·</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ansible webservers -m user -a <span class=\"string\">&quot;name=nginx group=nginx shell=/sbin/nologin create_home=no&quot;</span></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight yml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># user.yml</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">åˆ›å»ºç”¨æˆ·</span> <span class=\"string\">nginx</span></span><br><span class=\"line\">  <span class=\"attr\">hosts:</span> <span class=\"string\">webservers</span></span><br><span class=\"line\">  <span class=\"attr\">tasks:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">æ·»åŠ ç”¨æˆ·</span> <span class=\"string\">nginx</span></span><br><span class=\"line\">      <span class=\"attr\">user:</span></span><br><span class=\"line\">        <span class=\"attr\">name:</span> <span class=\"string\">nginx</span> <span class=\"comment\"># ç”¨æˆ·åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">shell:</span> <span class=\"string\">/sbin/nologin</span> <span class=\"comment\"># æŒ‡å®šç”¨æˆ·shell,éç™»å½•ç”¨æˆ·</span></span><br><span class=\"line\">        <span class=\"attr\">createhome:</span> <span class=\"literal\">no</span> <span class=\"comment\"># ä¸åˆ›å»ºç”¨æˆ·ä¸»ç›®å½•</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¸¸ç”¨å‚æ•°è¯´æ˜:<code>ansible-doc -s user</code></p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>å‚æ•°</th>\n<th>æè¿°</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>append</td>\n<td>æ˜¯å¦å°†ç”¨æˆ·æ·»åŠ åˆ°ç°æœ‰ç»„ï¼Œè€Œä¸æ˜¯æ›¿æ¢ç»„ã€‚</td>\n</tr>\n<tr>\n<td>comment</td>\n<td>å¯¹ç”¨æˆ·çš„æ³¨é‡Šä¿¡æ¯ã€‚</td>\n</tr>\n<tr>\n<td>createhome</td>\n<td>æ˜¯å¦åˆ›å»ºç”¨æˆ·çš„å®¶ç›®å½•ã€‚</td>\n</tr>\n<tr>\n<td>expires</td>\n<td>ç”¨æˆ·å¸æˆ·è¿‡æœŸæ—¥æœŸã€‚</td>\n</tr>\n<tr>\n<td>force</td>\n<td>æ˜¯å¦å¼ºåˆ¶åˆ›å»ºæˆ–æ›´æ”¹ç”¨æˆ·å¸æˆ·ã€‚</td>\n</tr>\n<tr>\n<td>generate_ssh_key</td>\n<td>æ˜¯å¦ç”Ÿæˆç”¨æˆ·çš„ SSH å¯†é’¥å¯¹ã€‚</td>\n</tr>\n<tr>\n<td>group</td>\n<td>ç”¨æˆ·æ‰€å±ç»„çš„åç§°æˆ– IDã€‚</td>\n</tr>\n<tr>\n<td>groups</td>\n<td>ç”¨æˆ·æ‰€å±çš„å…¶ä»–ç»„ã€‚</td>\n</tr>\n<tr>\n<td>home</td>\n<td>ç”¨æˆ·çš„å®¶ç›®å½•è·¯å¾„ã€‚</td>\n</tr>\n<tr>\n<td>login_class</td>\n<td>ç”¨æˆ·ç™»å½•ç±»ã€‚</td>\n</tr>\n<tr>\n<td>move_home</td>\n<td>æ˜¯å¦åœ¨æ›´æ”¹ç”¨æˆ·å®¶ç›®å½•è·¯å¾„æ—¶ç§»åŠ¨å…¶å†…å®¹ã€‚</td>\n</tr>\n<tr>\n<td>name</td>\n<td>ç”¨æˆ·çš„åç§°ã€‚</td>\n</tr>\n<tr>\n<td>non_unique</td>\n<td>å…è®¸ç”¨æˆ·å…·æœ‰éå”¯ä¸€çš„æ•°å­— IDã€‚</td>\n</tr>\n<tr>\n<td>password</td>\n<td>ç”¨æˆ·çš„å¯†ç å“ˆå¸Œå€¼æˆ–åŠ å¯†åçš„å¯†ç ã€‚</td>\n</tr>\n<tr>\n<td>remove</td>\n<td>æ˜¯å¦åˆ é™¤ç”¨æˆ·ã€‚</td>\n</tr>\n<tr>\n<td>shell</td>\n<td>ç”¨æˆ·çš„ shellã€‚</td>\n</tr>\n<tr>\n<td>state</td>\n<td>ç”¨æˆ·å¸æˆ·çš„çŠ¶æ€ã€‚</td>\n</tr>\n<tr>\n<td>system</td>\n<td>æ˜¯å¦ä¸ºç³»ç»Ÿç”¨æˆ·ã€‚</td>\n</tr>\n<tr>\n<td>uid</td>\n<td>ç”¨æˆ·çš„æ•°å­— IDã€‚</td>\n</tr>\n</tbody>\n</table>\n<blockquote>\n<p>state</p>\n</blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">presentï¼šè¡¨ç¤ºè¦æ±‚æŒ‡å®šçš„ç”¨æˆ·è´¦æˆ·å­˜åœ¨ã€‚å¦‚æœæŒ‡å®šçš„ç”¨æˆ·è´¦æˆ·ä¸å­˜åœ¨ï¼Œåˆ™ Ansible å°†ä¼šåˆ›å»ºè¯¥è´¦æˆ·ã€‚å¦‚æœç”¨æˆ·è´¦æˆ·å·²ç»å­˜åœ¨ï¼Œåˆ™ä¸æ‰§è¡Œä»»ä½•æ“ä½œã€‚</span><br><span class=\"line\">absentï¼šè¡¨ç¤ºè¦æ±‚æŒ‡å®šçš„ç”¨æˆ·è´¦æˆ·ä¸å­˜åœ¨ã€‚å¦‚æœæŒ‡å®šçš„ç”¨æˆ·è´¦æˆ·å­˜åœ¨ï¼Œåˆ™ Ansible å°†ä¼šåˆ é™¤è¯¥è´¦æˆ·ã€‚å¦‚æœç”¨æˆ·è´¦æˆ·ä¸å­˜åœ¨ï¼Œåˆ™ä¸æ‰§è¡Œä»»ä½•æ“ä½œã€‚</span><br></pre></td></tr></table></figure>\n<h3 id=\"get-urlæ¨¡å—\">get_urlæ¨¡å—</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><a href=\"https://docs.ansible.com/ansible/latest/collections/ansible/builtin/get_url_module.html#ansible-collections-ansible-builtin-get-url-module\">get_urlæ¨¡å—</a>è´Ÿè´£ä¸‹è½½æ–‡ä»¶åˆ°ç›®æ ‡ä¸»æœºã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ç¤ºä¾‹</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ansible webservers -m get_url -a <span class=\"string\">&quot;url=https://www.example.com dest=/tmp&quot;</span></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight yml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># get_url.yml</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">ä¸‹è½½æ–‡ä»¶åˆ°ç›®æ ‡ä¸»æœºçš„æŒ‡å®šç›®å½•</span></span><br><span class=\"line\">  <span class=\"attr\">hosts:</span> <span class=\"string\">webservers</span></span><br><span class=\"line\">  <span class=\"attr\">tasks:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">Download</span> <span class=\"string\">files</span> <span class=\"string\">from</span> <span class=\"string\">remote</span> <span class=\"string\">host</span></span><br><span class=\"line\">      <span class=\"attr\">get_url:</span></span><br><span class=\"line\">        <span class=\"attr\">url:</span> <span class=\"string\">https://www.example.com/file.conf</span></span><br><span class=\"line\">        <span class=\"attr\">dest:</span> <span class=\"string\">/tmp</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¸»è¦å‚æ•°è¯´æ˜:<code>ansible-doc -s get_url</code></p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>å‚æ•°</th>\n<th>æè¿°</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>url</td>\n<td>è¦ä¸‹è½½çš„æ–‡ä»¶çš„ URL åœ°å€ã€‚</td>\n</tr>\n<tr>\n<td>dest</td>\n<td>ä¸‹è½½æ–‡ä»¶ä¿å­˜çš„ç›®æ ‡è·¯å¾„ã€‚</td>\n</tr>\n<tr>\n<td>force</td>\n<td>æ˜¯å¦å¼ºåˆ¶è¦†ç›–ç›®æ ‡è·¯å¾„ä¸­çš„æ–‡ä»¶ã€‚å¯é€‰å€¼ä¸º yes æˆ– noã€‚é»˜è®¤ä¸º yesã€‚</td>\n</tr>\n<tr>\n<td>timeout</td>\n<td>ä¸‹è½½è¶…æ—¶æ—¶é—´ï¼Œå•ä½ä¸ºç§’ã€‚é»˜è®¤ä¸º 10 ç§’ã€‚</td>\n</tr>\n<tr>\n<td>validate_certs</td>\n<td>æ˜¯å¦éªŒè¯ SSL è¯ä¹¦ã€‚å¯é€‰å€¼ä¸º yes æˆ– noã€‚é»˜è®¤ä¸º yesã€‚</td>\n</tr>\n<tr>\n<td>owner</td>\n<td>ä¸‹è½½åæ–‡ä»¶çš„æ‰€æœ‰è€…ã€‚</td>\n</tr>\n<tr>\n<td>group</td>\n<td>ä¸‹è½½åæ–‡ä»¶çš„æ‰€å±ç»„ã€‚</td>\n</tr>\n<tr>\n<td>mode</td>\n<td>ä¸‹è½½åæ–‡ä»¶çš„æƒé™æ¨¡å¼ã€‚</td>\n</tr>\n<tr>\n<td>backup</td>\n<td>æ˜¯å¦åˆ›å»ºå¤‡ä»½æ–‡ä»¶ã€‚å¯é€‰å€¼ä¸º yes æˆ– noã€‚é»˜è®¤ä¸º noã€‚</td>\n</tr>\n<tr>\n<td>headers</td>\n<td>é™„åŠ çš„ HTTP è¯·æ±‚å¤´ã€‚</td>\n</tr>\n<tr>\n<td>force_basic_auth</td>\n<td>æ˜¯å¦å¼ºåˆ¶ä½¿ç”¨ HTTP åŸºæœ¬èº«ä»½éªŒè¯ã€‚å¯é€‰å€¼ä¸º yes æˆ– noã€‚é»˜è®¤ä¸º yesã€‚</td>\n</tr>\n<tr>\n<td>http_agent</td>\n<td>ç”¨äº HTTP è¯·æ±‚çš„ä»£ç†ã€‚</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"lineinfileæ¨¡å—\">lineinfileæ¨¡å—</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><a href=\"https://docs.ansible.com/ansible/latest/collections/ansible/builtin/lineinfile_module.html#ansible-collections-ansible-builtin-lineinfile-module\">lineinfileæ¨¡å—</a>ä¸»è¦ç”¨äºåœ¨è¿œç¨‹ä¸»æœºä¸ŠæŸ¥æ‰¾å’Œæ›¿æ¢æ–‡ä»¶ä¸­çš„è¡Œï¼Œå¯ä»¥æŒ‡å®šè¦æŸ¥æ‰¾çš„è¡Œã€è¦æ›¿æ¢çš„è¡Œã€è¦æ·»åŠ çš„è¡Œç­‰ä¿¡æ¯ï¼Œç­‰ç­‰</p>\n</li>\n<li class=\"lvl-2\">\n<p>ç¤ºä¾‹ï¼šè®¾ç½®ç¯å¢ƒå˜é‡ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯æ­¤æ—¶ç¯å¢ƒå˜é‡åœ¨å‰§æœ¬çš„ä¸Šä¸‹æ–‡ä¸­æ˜¯ä¸ç”Ÿæ•ˆçš„ï¼Œå¦‚æœéœ€è¦åœ¨å‰§æœ¬ä¸Šä¸‹æ–‡ç”Ÿæ•ˆçš„ç¯å¢ƒå˜é‡ï¼Œå¯ä»¥ä½¿ç”¨ <code>shell</code> æ¨¡å—</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ansible webservers -m lineinfile -a <span class=\"string\">&quot;path=/etc/profile line=&#x27;PATH=/usr/local/bin:/usr/bin:/bin:/usr/local/sbin:/usr/sbin:/sbin&#x27; state=present backup=yes&quot;</span></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight yml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># lineinfile.yml</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">è®¾ç½®ç¯å¢ƒå˜é‡</span></span><br><span class=\"line\">  <span class=\"attr\">hosts:</span> <span class=\"string\">webservers</span></span><br><span class=\"line\">  <span class=\"attr\">tasks:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">è®¾ç½®ç¯å¢ƒå˜é‡</span></span><br><span class=\"line\">      <span class=\"attr\">lineinfile:</span></span><br><span class=\"line\">        <span class=\"attr\">path:</span> <span class=\"string\">/etc/profile</span></span><br><span class=\"line\">        <span class=\"attr\">line:</span> <span class=\"string\">&#x27;PATH=/usr/local/bin:/usr/bin:/bin:/usr/local/sbin:/usr/sbin:/sbin&#x27;</span></span><br><span class=\"line\">        <span class=\"attr\">state:</span> <span class=\"string\">present</span></span><br><span class=\"line\">        <span class=\"attr\">backup:</span> <span class=\"literal\">yes</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¸»è¦å‚æ•°è¯´æ˜:<code>ansible-doc -s lineinfile</code></p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>å‚æ•°</th>\n<th>æè¿°</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>path</td>\n<td>è¦ä¿®æ”¹çš„æ–‡ä»¶çš„è·¯å¾„ã€‚</td>\n</tr>\n<tr>\n<td>line</td>\n<td>è¦æ·»åŠ ã€ä¿®æ”¹æˆ–åˆ é™¤çš„è¡Œå†…å®¹ã€‚</td>\n</tr>\n<tr>\n<td>state</td>\n<td>æŒ‡å®šè¦æ‰§è¡Œçš„æ“ä½œã€‚</td>\n</tr>\n<tr>\n<td>regexp</td>\n<td>ç”¨äºåŒ¹é…è¡Œçš„æ­£åˆ™è¡¨è¾¾å¼ã€‚</td>\n</tr>\n<tr>\n<td>search_string</td>\n<td>ç”¨äºåŒ¹é…è¡Œçš„å­—ç¬¦ä¸²ã€‚</td>\n</tr>\n<tr>\n<td>backup</td>\n<td>æ˜¯å¦åˆ›å»ºå¤‡ä»½æ–‡ä»¶ã€‚å¯é€‰å€¼ä¸º yes æˆ– noã€‚é»˜è®¤ä¸º noã€‚</td>\n</tr>\n<tr>\n<td>backrefs</td>\n<td>æ˜¯å¦å…è®¸åœ¨ <code>regexp</code> ä¸­ä½¿ç”¨åå‘å¼•ç”¨ã€‚</td>\n</tr>\n<tr>\n<td>insertbefore</td>\n<td>æŒ‡å®šä¸€ä¸ªè¡Œï¼Œå°†æ–°è¡Œæ’å…¥åˆ°å®ƒä¹‹å‰ã€‚</td>\n</tr>\n<tr>\n<td>insertafter</td>\n<td>æŒ‡å®šä¸€ä¸ªè¡Œï¼Œå°†æ–°è¡Œæ’å…¥åˆ°å®ƒä¹‹åã€‚</td>\n</tr>\n<tr>\n<td>firstmatch</td>\n<td>æ˜¯å¦åªåŒ¹é…ç¬¬ä¸€ä¸ªåŒ¹é…é¡¹ã€‚</td>\n</tr>\n</tbody>\n</table>\n<blockquote>\n<p>stateè¯´æ˜</p>\n</blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">presentï¼šç¡®ä¿æŒ‡å®šçš„è¡Œå­˜åœ¨äºæ–‡ä»¶ä¸­ã€‚å¦‚æœæ–‡ä»¶ä¸­ä¸å­˜åœ¨æŒ‡å®šçš„è¡Œï¼Œåˆ™ä¼šæ·»åŠ è¯¥è¡Œã€‚å¦‚æœæ–‡ä»¶ä¸­å·²ç»å­˜åœ¨è¯¥è¡Œï¼Œåˆ™ä¸åšä»»ä½•æ”¹å˜ã€‚</span><br><span class=\"line\">absentï¼šç¡®ä¿æŒ‡å®šçš„è¡Œä¸å­˜åœ¨äºæ–‡ä»¶ä¸­ã€‚å¦‚æœæ–‡ä»¶ä¸­å­˜åœ¨æŒ‡å®šçš„è¡Œï¼Œåˆ™ä¼šå°†è¯¥è¡Œåˆ é™¤ã€‚å¦‚æœæ–‡ä»¶ä¸­ä¸å­˜åœ¨è¯¥è¡Œï¼Œåˆ™ä¸åšä»»ä½•æ”¹å˜ã€‚</span><br></pre></td></tr></table></figure>\n<h2 id=\"ansible-playbook-å‰§æœ¬\">ansible-playbook:å‰§æœ¬</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><a href=\"https://docs.ansible.com/ansible/latest/cli/ansible-playbook.html#ansible-playbook\">ansible-playbook</a>æ˜¯Ansibleçš„æ ¸å¿ƒå‘½ä»¤ï¼Œç”¨äºæ‰§è¡Œplaybookæ–‡ä»¶ï¼Œplaybookæ–‡ä»¶æ˜¯Ansibleæ‰§è¡Œä»»åŠ¡çš„æœ€å°å•å…ƒï¼Œä¸€ä¸ªplaybookæ–‡ä»¶å¯ä»¥åŒ…å«å¤šä¸ªplayï¼Œæ¯ä¸ªplayå¯ä»¥åŒ…å«å¤šä¸ªtaskï¼Œæ¯ä¸ªtaskå¯ä»¥åŒ…å«å¤šä¸ªmoduleï¼Œæ¯ä¸ªmoduleå¯ä»¥æ‰§è¡Œä¸€ä¸ªæ“ä½œï¼Œæ¯”å¦‚åˆ›å»ºç›®å½•ã€å®‰è£…è½¯ä»¶åŒ…ã€å¯åŠ¨æœåŠ¡ã€æ‰§è¡Œè„šæœ¬ç­‰</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://ansible-tran.readthedocs.io/en/latest/docs/playbooks_intro.html\">Ansibleä¸­æ–‡å…¨æ–‡æŒ‡å—â€“Playbooks</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>ä¸Šé¢åœ¨ä»‹ç»ansibleæ¨¡å—æ—¶ï¼Œæˆ‘ä»¬å·²ç»ç¼–å†™äº†ä¸€äº›playbookæ–‡ä»¶ï¼Œå°±æ˜¯é‚£äº›ymlæ–‡ä»¶ï¼Œè¿è¡Œæ—¶ä¹Ÿæ˜¯é€šè¿‡ansible-playbookå‘½ä»¤æ‰§è¡Œçš„ï¼Œä½†æ˜¯åŸºæœ¬ä¸Šéƒ½æ˜¯å•ä¸ªä»»åŠ¡å•ä¸ªæ¨¡å—ï¼Œä¸‹é¢æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªå¤æ‚ä¸€äº›çš„ç¤ºä¾‹</p>\n</li>\n<li class=\"lvl-2\">\n<p>ç¤ºä¾‹ï¼šå®‰è£…nginxå¹¶é…ç½®</p>\n</li>\n</ul>\n<figure class=\"highlight yml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># playbook.yml</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">å®‰è£…nginxå¹¶é…ç½®</span></span><br><span class=\"line\">  <span class=\"attr\">hosts:</span> <span class=\"string\">webservers</span></span><br><span class=\"line\">  <span class=\"attr\">become:</span> <span class=\"literal\">yes</span>  <span class=\"comment\"># åˆ‡æ¢åˆ°rootç”¨æˆ·ä¸‹æ‰§è¡Œ</span></span><br><span class=\"line\">  <span class=\"attr\">tasks:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">install</span> <span class=\"string\">nginx</span></span><br><span class=\"line\">      <span class=\"attr\">yum:</span></span><br><span class=\"line\">        <span class=\"attr\">name:</span> <span class=\"string\">gcc,zlib-devel,pcre-devel,openssl-devel</span></span><br><span class=\"line\">        <span class=\"attr\">state:</span> <span class=\"string\">installed</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">wget</span> <span class=\"string\">nginx</span> <span class=\"string\">tar.gz</span></span><br><span class=\"line\">      <span class=\"attr\">shell:</span></span><br><span class=\"line\">        <span class=\"attr\">cmd:</span> <span class=\"string\">wget</span> <span class=\"string\">https://nginx.org/download/nginx-1.22.1.tar.gz</span></span><br><span class=\"line\">        <span class=\"attr\">chdir:</span> <span class=\"string\">/usr/local</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">tar</span> <span class=\"string\">-zxvf</span> <span class=\"string\">nginx-1.22.1.tar.gz</span></span><br><span class=\"line\">      <span class=\"attr\">shell:</span></span><br><span class=\"line\">        <span class=\"attr\">cmd:</span> <span class=\"string\">tar</span> <span class=\"string\">-zxvf</span> <span class=\"string\">nginx-1.22.1.tar.gz</span></span><br><span class=\"line\">        <span class=\"attr\">chdir:</span> <span class=\"string\">/usr/local</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">add</span> <span class=\"string\">user</span> <span class=\"string\">nginx</span></span><br><span class=\"line\">      <span class=\"attr\">user:</span></span><br><span class=\"line\">        <span class=\"attr\">name:</span> <span class=\"string\">nginx</span></span><br><span class=\"line\">        <span class=\"attr\">state:</span> <span class=\"string\">present</span></span><br><span class=\"line\">        <span class=\"attr\">shell:</span> <span class=\"string\">/sbin/nologin</span></span><br><span class=\"line\">        <span class=\"attr\">createhome:</span> <span class=\"literal\">no</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">configure</span> <span class=\"string\">,make</span> <span class=\"string\">and</span> <span class=\"string\">make</span> <span class=\"string\">install</span></span><br><span class=\"line\">      <span class=\"attr\">shell:</span></span><br><span class=\"line\">        <span class=\"attr\">cmd:</span> <span class=\"string\">cd</span> <span class=\"string\">nginx-1.22.1;./configure</span> <span class=\"string\">--prefix=/usr/local/nginx</span> <span class=\"string\">--with-http_stub_status_module</span> <span class=\"string\">--with-http_ssl_module</span> <span class=\"string\">--user=nginx;make</span> <span class=\"string\">-j4;make</span> <span class=\"string\">-j4</span> <span class=\"string\">install;</span></span><br><span class=\"line\">        <span class=\"attr\">chdir:</span> <span class=\"string\">/usr/local</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">start</span> <span class=\"string\">nginx</span></span><br><span class=\"line\">      <span class=\"attr\">shell:</span></span><br><span class=\"line\">        <span class=\"attr\">cmd:</span> <span class=\"string\">/usr/local/nginx/sbin/nginx</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¼˜åŒ–1</p>\n</li>\n</ul>\n<blockquote>\n<p><strong>é—®é¢˜</strong>: ä¸Šé¢çš„å‰§æœ¬æœ‰ä¸ªé—®é¢˜ï¼Œå°±æ˜¯å¦‚æœç³»ç»Ÿå·²ç»å®‰è£…äº†nginxï¼Œåˆ™è¿è¡Œè¿™ä¸ªå‰§æœ¬è¿˜æ˜¯ä¼šé‡æ–°å®‰è£…<br>\n<strong>è§£å†³æ–¹æ³•</strong>: å…ˆåˆ¤æ–­nginxæ˜¯å¦å·²ç»å®‰è£…ï¼Œå¦‚æœå·²ç»å®‰è£…ï¼Œç›´æ¥è·³è¿‡å®‰è£…æ­¥éª¤ï¼Œç›´æ¥æ‰§è¡Œå¯åŠ¨å‘½ä»¤ï¼Œå¦åˆ™æ‰§è¡Œå®‰è£…æ­¥éª¤ï¼Œç„¶åå†æ‰§è¡Œå¯åŠ¨å‘½ä»¤</p>\n</blockquote>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">å®‰è£…nginxå¹¶é…ç½®</span></span><br><span class=\"line\">  <span class=\"attr\">hosts:</span> <span class=\"string\">webservers</span></span><br><span class=\"line\">  <span class=\"attr\">become:</span> <span class=\"literal\">yes</span>  <span class=\"comment\"># åˆ‡æ¢åˆ°rootç”¨æˆ·ä¸‹æ‰§è¡Œ</span></span><br><span class=\"line\">  <span class=\"attr\">tasks:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">æ£€æŸ¥ç³»ç»Ÿæ˜¯å¦å·²å®‰è£…Nginx</span></span><br><span class=\"line\">      <span class=\"attr\">shell:</span> <span class=\"string\">/usr/local/nginx/sbin/nginx</span> <span class=\"string\">-v</span></span><br><span class=\"line\">      <span class=\"attr\">register:</span> <span class=\"string\">nginx_installed</span></span><br><span class=\"line\">      <span class=\"attr\">ignore_errors:</span> <span class=\"literal\">yes</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">å®‰è£…Nginxä¾èµ–è½¯ä»¶åŒ…</span></span><br><span class=\"line\">      <span class=\"attr\">yum:</span></span><br><span class=\"line\">        <span class=\"attr\">name:</span> <span class=\"string\">&quot;<span class=\"template-variable\">&#123;&#123; item &#125;&#125;</span>&quot;</span></span><br><span class=\"line\">        <span class=\"attr\">state:</span> <span class=\"string\">present</span></span><br><span class=\"line\">      <span class=\"attr\">loop:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"string\">gcc</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"string\">zlib</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"string\">zlib-devel</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"string\">pcre-devel</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"string\">openssl</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"string\">openssl-devel</span></span><br><span class=\"line\">      <span class=\"attr\">when:</span> <span class=\"string\">nginx_installed.rc</span> <span class=\"type\">!=</span> <span class=\"number\">0</span>  <span class=\"comment\"># åªæœ‰å½“Nginxæœªå®‰è£…æ—¶æ‰§è¡Œ</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">æ£€æŸ¥ç³»ç»Ÿæ˜¯å¦å·²å¯åŠ¨Nginx</span></span><br><span class=\"line\">      <span class=\"attr\">shell:</span> <span class=\"string\">ps</span> <span class=\"string\">aux</span> <span class=\"string\">|</span> <span class=\"string\">grep</span> <span class=\"string\">nginx</span> <span class=\"string\">|</span> <span class=\"string\">grep</span> <span class=\"string\">-v</span> <span class=\"string\">grep</span></span><br><span class=\"line\">      <span class=\"attr\">register:</span> <span class=\"string\">nginx_status</span></span><br><span class=\"line\">      <span class=\"attr\">ignore_errors:</span> <span class=\"literal\">yes</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">ä¸‹è½½Nginxæºç åŒ…</span></span><br><span class=\"line\">      <span class=\"attr\">get_url:</span></span><br><span class=\"line\">        <span class=\"attr\">url:</span> <span class=\"string\">https://nginx.org/download/nginx-1.22.1.tar.gz</span></span><br><span class=\"line\">        <span class=\"attr\">dest:</span> <span class=\"string\">/usr/local</span></span><br><span class=\"line\">      <span class=\"attr\">when:</span> <span class=\"string\">nginx_installed.rc</span> <span class=\"type\">!=</span> <span class=\"number\">0</span>  <span class=\"comment\"># åªæœ‰å½“Nginxæœªå®‰è£…æ—¶æ‰§è¡Œ</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">è§£å‹Nginxæºç åŒ…</span></span><br><span class=\"line\">      <span class=\"attr\">shell:</span></span><br><span class=\"line\">        <span class=\"attr\">cmd:</span> <span class=\"string\">tar</span> <span class=\"string\">-zxvf</span> <span class=\"string\">nginx-1.22.1.tar.gz</span></span><br><span class=\"line\">        <span class=\"attr\">chdir:</span> <span class=\"string\">/usr/local</span></span><br><span class=\"line\">      <span class=\"attr\">when:</span> <span class=\"string\">nginx_installed.rc</span> <span class=\"type\">!=</span> <span class=\"number\">0</span>  <span class=\"comment\"># åªæœ‰å½“Nginxæœªå®‰è£…æ—¶æ‰§è¡Œ</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">æ·»åŠ nginxç”¨æˆ·</span></span><br><span class=\"line\">      <span class=\"attr\">user:</span></span><br><span class=\"line\">        <span class=\"attr\">name:</span> <span class=\"string\">nginx</span></span><br><span class=\"line\">        <span class=\"attr\">state:</span> <span class=\"string\">present</span></span><br><span class=\"line\">        <span class=\"attr\">shell:</span> <span class=\"string\">/sbin/nologin</span></span><br><span class=\"line\">        <span class=\"attr\">createhome:</span> <span class=\"literal\">no</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">ç¼–è¯‘Nginxå¹¶å®‰è£…</span></span><br><span class=\"line\">      <span class=\"attr\">shell:</span></span><br><span class=\"line\">        <span class=\"attr\">cmd:</span> <span class=\"string\">|</span></span><br><span class=\"line\"><span class=\"string\">          cd nginx-1.22.1</span></span><br><span class=\"line\"><span class=\"string\">          ./configure --prefix=/usr/local/nginx --with-http_stub_status_module --with-http_ssl_module --user=nginx</span></span><br><span class=\"line\"><span class=\"string\">          make -j4</span></span><br><span class=\"line\"><span class=\"string\">          make -j4 install</span></span><br><span class=\"line\"><span class=\"string\"></span>        <span class=\"attr\">chdir:</span> <span class=\"string\">/usr/local</span></span><br><span class=\"line\">      <span class=\"attr\">when:</span> <span class=\"string\">nginx_installed.rc</span> <span class=\"type\">!=</span> <span class=\"number\">0</span>  <span class=\"comment\"># åªæœ‰å½“Nginxæœªå®‰è£…æ—¶æ‰§è¡Œ</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">å¯åŠ¨NginxæœåŠ¡</span></span><br><span class=\"line\">      <span class=\"attr\">shell:</span></span><br><span class=\"line\">        <span class=\"attr\">cmd:</span> <span class=\"string\">/usr/local/nginx/sbin/nginx</span></span><br><span class=\"line\">      <span class=\"attr\">when:</span> <span class=\"string\">nginx_status.rc</span> <span class=\"type\">!=</span> <span class=\"number\">0</span>  <span class=\"comment\"># åªæœ‰å½“Nginxæœªå¯åŠ¨æ—¶æ‰§è¡Œ</span></span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>register :ç”¨äºå°†å‘½ä»¤æ‰§è¡Œçš„ç»“æœä¿å­˜åˆ°å˜é‡ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥è°ƒç”¨å˜é‡çš„å±æ€§ï¼Œæ¯”å¦‚rcè¡¨ç¤ºå‘½ä»¤è¿”å›çš„çŠ¶æ€ç ($?)ï¼Œstdoutè¡¨ç¤ºå‘½ä»¤çš„è¾“å‡ºï¼Œstderrè¡¨ç¤ºå‘½ä»¤çš„é”™è¯¯è¾“å‡º<br>\nignore_errors :ç”¨äºå¿½ç•¥é”™è¯¯<br>\nloop :ç”¨äºå¾ªç¯åˆ—è¡¨<br>\nwhen :ç”¨äºåˆ¤æ–­æ¡ä»¶ï¼Œåªæœ‰æ¡ä»¶æ»¡è¶³æ—¶æ‰æ‰§è¡Œ</p>\n</blockquote>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¼˜åŒ–2</p>\n</li>\n</ul>\n<blockquote>\n<p><strong>é—®é¢˜</strong>: ä¸Šé¢çš„æ­¥éª¤æœ‰ç‚¹å¤šï¼Œæ¯”å¦‚ä¸‹è½½ã€è§£å‹ã€ç¼–è¯‘nginxï¼Œè¿™äº›éƒ½æ˜¯åœ¨æ²¡æœ‰å®‰è£…nginxçš„æƒ…å†µä¸‹è¦è¿è¡Œçš„ä»»åŠ¡<br>\n<strong>è§£å†³æ–¹æ³•</strong>: ä½¿ç”¨shellæ¨¡å—å¯ä»¥å°†è¿™äº›æ­¥éª¤å°è£…æˆä¸€ä¸ªä»»åŠ¡</p>\n</blockquote>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">å®‰è£…nginxå¹¶é…ç½®</span></span><br><span class=\"line\">  <span class=\"attr\">hosts:</span> <span class=\"string\">webservers</span></span><br><span class=\"line\">  <span class=\"attr\">become:</span> <span class=\"literal\">yes</span>  <span class=\"comment\"># åˆ‡æ¢åˆ°rootç”¨æˆ·ä¸‹æ‰§è¡Œ</span></span><br><span class=\"line\">  <span class=\"attr\">tasks:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">æ£€æŸ¥ç³»ç»Ÿæ˜¯å¦å·²å®‰è£…Nginx</span></span><br><span class=\"line\">      <span class=\"attr\">shell:</span> <span class=\"string\">/usr/local/nginx/sbin/nginx</span> <span class=\"string\">-v</span></span><br><span class=\"line\">      <span class=\"attr\">register:</span> <span class=\"string\">nginx_installed</span></span><br><span class=\"line\">      <span class=\"attr\">ignore_errors:</span> <span class=\"literal\">yes</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">å®‰è£…Nginxä¾èµ–è½¯ä»¶åŒ…</span></span><br><span class=\"line\">      <span class=\"attr\">yum:</span></span><br><span class=\"line\">        <span class=\"attr\">name:</span> <span class=\"string\">&quot;<span class=\"template-variable\">&#123;&#123; item &#125;&#125;</span>&quot;</span></span><br><span class=\"line\">        <span class=\"attr\">state:</span> <span class=\"string\">present</span></span><br><span class=\"line\">      <span class=\"attr\">loop:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"string\">gcc</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"string\">zlib</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"string\">zlib-devel</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"string\">pcre-devel</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"string\">openssl</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"string\">openssl-devel</span></span><br><span class=\"line\">      <span class=\"attr\">when:</span> <span class=\"string\">nginx_installed.rc</span> <span class=\"type\">!=</span> <span class=\"number\">0</span>  <span class=\"comment\"># åªæœ‰å½“Nginxæœªå®‰è£…æ—¶æ‰§è¡Œ</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">æ£€æŸ¥ç³»ç»Ÿæ˜¯å¦å·²å¯åŠ¨Nginx</span></span><br><span class=\"line\">      <span class=\"attr\">shell:</span> <span class=\"string\">ps</span> <span class=\"string\">aux</span> <span class=\"string\">|</span> <span class=\"string\">grep</span> <span class=\"string\">nginx</span> <span class=\"string\">|</span> <span class=\"string\">grep</span> <span class=\"string\">-v</span> <span class=\"string\">grep</span></span><br><span class=\"line\">      <span class=\"attr\">register:</span> <span class=\"string\">nginx_status</span></span><br><span class=\"line\">      <span class=\"attr\">ignore_errors:</span> <span class=\"literal\">yes</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">æ·»åŠ nginxç”¨æˆ·</span></span><br><span class=\"line\">      <span class=\"attr\">user:</span></span><br><span class=\"line\">        <span class=\"attr\">name:</span> <span class=\"string\">nginx</span></span><br><span class=\"line\">        <span class=\"attr\">state:</span> <span class=\"string\">present</span></span><br><span class=\"line\">        <span class=\"attr\">shell:</span> <span class=\"string\">/sbin/nologin</span></span><br><span class=\"line\">        <span class=\"attr\">createhome:</span> <span class=\"literal\">no</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">Nginxå¹¶å®‰è£…</span></span><br><span class=\"line\">      <span class=\"attr\">shell:</span></span><br><span class=\"line\">        <span class=\"attr\">cmd:</span> <span class=\"string\">|</span></span><br><span class=\"line\"><span class=\"string\">          wget https://nginx.org/download/nginx-1.22.1.tar.gz</span></span><br><span class=\"line\"><span class=\"string\">          tar -zxvf nginx-1.22.1.tar.gz</span></span><br><span class=\"line\"><span class=\"string\">          cd nginx-1.22.1</span></span><br><span class=\"line\"><span class=\"string\">          ./configure --prefix=/usr/local/nginx --with-http_stub_status_module --with-http_ssl_module --user=nginx</span></span><br><span class=\"line\"><span class=\"string\">          make -j4</span></span><br><span class=\"line\"><span class=\"string\">          make -j4 install</span></span><br><span class=\"line\"><span class=\"string\"></span>        <span class=\"attr\">chdir:</span> <span class=\"string\">/usr/local</span></span><br><span class=\"line\">      <span class=\"attr\">when:</span> <span class=\"string\">nginx_installed.rc</span> <span class=\"type\">!=</span> <span class=\"number\">0</span>  <span class=\"comment\"># åªæœ‰å½“Nginxæœªå®‰è£…æ—¶æ‰§è¡Œ</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">å¯åŠ¨NginxæœåŠ¡</span></span><br><span class=\"line\">      <span class=\"attr\">shell:</span></span><br><span class=\"line\">        <span class=\"attr\">cmd:</span> <span class=\"string\">/usr/local/nginx/sbin/nginx</span></span><br><span class=\"line\">      <span class=\"attr\">when:</span> <span class=\"string\">nginx_status.rc</span> <span class=\"type\">!=</span> <span class=\"number\">0</span>  <span class=\"comment\"># åªæœ‰å½“Nginxæœªå¯åŠ¨æ—¶æ‰§è¡Œ</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¼˜åŒ–3</p>\n</li>\n</ul>\n<blockquote>\n<p><strong>é—®é¢˜</strong>: ä¸Šé¢çš„å‰§æœ¬è™½ç„¶å·²ç»æ»¡è¶³äº†æˆ‘çš„éœ€æ±‚ï¼Œä½†æ˜¯ä¸å¤Ÿç®€ç»ƒï¼Œå› ä¸ºå¾ˆå¤šä»»åŠ¡å¹¶ä¸æ˜¯ä¸»è¦ä»»åŠ¡ï¼Œæˆ‘éœ€è¦åœ¨æ¯ä¸ªä»»åŠ¡ä¸­è¿›è¡Œæ¡ä»¶åˆ¤æ–­æ¥å†³å®šæ˜¯å¦æ‰§è¡Œè¯¥ä»»åŠ¡ï¼Œèƒ½å¦åªä¿ç•™ä¸»è¦ä»»åŠ¡ï¼Œå…¶å®ƒä»»åŠ¡åªæœ‰å½“è¿™äº›ä¸»è¦ä»»åŠ¡æˆåŠŸè¿è¡Œäº†æ‰ä¼šè¢«è¿è¡Œå‘¢ï¼Ÿæ¯”å¦‚è¿™é‡Œçš„ä¸»è¦ä»»åŠ¡å°±æ˜¯ä¸¤ä¸ªï¼š1-åˆ¤æ–­æ˜¯å¦å®‰è£…äº†nginxï¼Œæ²¡å®‰è£…å°±å»å®‰è£…ï¼Œ2-åˆ¤æ–­æ˜¯å¦å¯åŠ¨äº†nginxï¼Œæ²¡å¯åŠ¨å°±å»å¯åŠ¨<br>\n<strong>è§£å†³æ–¹æ³•</strong>: ä½¿ç”¨åŸºäºhandlersçš„notifyè¯­å¥ï¼Œè¿™æ ·å¯ä»¥å‡å°‘é‡å¤æ‰§è¡Œä»»åŠ¡çš„æ¬¡æ•°</p>\n</blockquote>\n<blockquote>\n<p><strong>ä½•ä¸ºhandlers</strong><br>\nHandler æœ¬èº«æ˜¯ä¸€ç§éåŒæ­¥çš„ callback function ï¼Œåœ¨è¿™é‡Œåˆ™æ˜¯æŒ‡å…³è¿äºç‰¹å®š tasks çš„äº‹ä»¶ (event) è§¦å‘æœºåˆ¶ã€‚å½“å…³è” handler çš„ tasks çŠ¶æ€ä¸ºè¢«æ”¹å˜ (changed) ä¸”éƒ½å·²è¢«æ‰§è¡Œæ—¶ï¼Œæ‰ä¼šè§¦å‘ä¸€æ¬¡</p>\n</blockquote>\n<blockquote>\n<p><strong>ä½•ä¸º tasks çŠ¶æ€ä¸ºè¢«æ”¹å˜ (changed)</strong><br>\nåœ¨Ansibleä¸­ï¼Œtaskçš„çŠ¶æ€ä¼šæ ¹æ®ä»»åŠ¡æ‰§è¡Œçš„ç»“æœè€Œæ”¹å˜ã€‚å½“ä¸€ä¸ªä»»åŠ¡æˆåŠŸå®Œæˆå¹¶ä¸”ä½¿å¾—ç³»ç»Ÿçš„çŠ¶æ€ä¸é¢„æœŸä¸åŒï¼ˆå³æ‰§è¡Œäº†ä¸€äº›æ›´æ”¹ï¼‰ï¼Œé‚£ä¹ˆè¿™ä¸ªä»»åŠ¡çš„çŠ¶æ€å°±ä¼šè¢«æ ‡è®°ä¸º&quot;changed&quot;ã€‚<br>\nå…·ä½“æ¥è¯´ï¼ŒtaskçŠ¶æ€ä¸º&quot;changed&quot;çš„æ¡ä»¶åŒ…æ‹¬ä½†ä¸é™äºä»¥ä¸‹æƒ…å†µï¼š</p>\n</blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">æ–‡ä»¶å˜æ›´ï¼šä¾‹å¦‚å¤åˆ¶ã€åˆ›å»ºã€åˆ é™¤æ–‡ä»¶ç­‰æ“ä½œå¯¼è‡´äº†æ–‡ä»¶ç³»ç»Ÿçš„å˜æ›´ã€‚</span><br><span class=\"line\">æœåŠ¡çŠ¶æ€å˜æ›´ï¼šä¾‹å¦‚å¯åŠ¨ã€åœæ­¢ã€é‡å¯æœåŠ¡ç­‰æ“ä½œå¯¼è‡´äº†æœåŠ¡çŠ¶æ€çš„æ”¹å˜ã€‚</span><br><span class=\"line\">é…ç½®æ›´æ”¹ï¼šä¾‹å¦‚ä¿®æ”¹é…ç½®æ–‡ä»¶ã€æ·»åŠ é…ç½®é¡¹ç­‰æ“ä½œå¯¼è‡´äº†ç³»ç»Ÿé…ç½®çš„æ”¹å˜ã€‚</span><br><span class=\"line\">è½¯ä»¶åŒ…å®‰è£…/å¸è½½ï¼šä¾‹å¦‚å®‰è£…æ–°çš„è½¯ä»¶åŒ…æˆ–è€…åˆ é™¤å·²å®‰è£…çš„è½¯ä»¶åŒ…å¯¼è‡´äº†ç³»ç»Ÿè½¯ä»¶çŠ¶æ€çš„æ”¹å˜ã€‚</span><br><span class=\"line\">æƒé™å˜æ›´ï¼šä¾‹å¦‚ä¿®æ”¹æ–‡ä»¶æƒé™ã€æ›´æ”¹ç”¨æˆ·ç»„ã€æ›´æ”¹ç”¨æˆ·ç­‰æ“ä½œå¯¼è‡´äº†ç³»ç»Ÿæƒé™çš„æ”¹å˜ã€‚</span><br><span class=\"line\">å½“ä¸€ä¸ªæˆ–å¤šä¸ªä»»åŠ¡çš„çŠ¶æ€è¢«æ ‡è®°ä¸º&quot;changed&quot;æ—¶ï¼Œä¸è¿™äº›ä»»åŠ¡å…³è”çš„handlersä¼šè¢«è§¦å‘æ‰§è¡Œã€‚è¿™æ ·å¯ä»¥ç¡®ä¿åœ¨æ‰€æœ‰ç›¸å…³çš„ä»»åŠ¡éƒ½å®Œæˆå¹¶ä¸”å¯¼è‡´äº†ç³»ç»ŸçŠ¶æ€çš„æ”¹å˜æ—¶ï¼Œæ‰æ‰§è¡Œåç»­çš„å¤„ç†æ“ä½œï¼Œä»è€Œä¿è¯äº†ä»»åŠ¡çš„ä¸€è‡´æ€§å’Œå¯é æ€§ã€‚</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">å®‰è£…nginxå¹¶é…ç½®</span></span><br><span class=\"line\">  <span class=\"attr\">hosts:</span> <span class=\"string\">webservers</span></span><br><span class=\"line\">  <span class=\"attr\">become:</span> <span class=\"literal\">yes</span>  <span class=\"comment\"># åˆ‡æ¢åˆ°rootç”¨æˆ·ä¸‹æ‰§è¡Œ</span></span><br><span class=\"line\">  <span class=\"attr\">tasks:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">åˆ¤æ–­æ˜¯å¦å­˜åœ¨nginxå®‰è£…ç›®å½•ï¼Œä¸å­˜åœ¨å°±å®‰è£…nginx</span></span><br><span class=\"line\">      <span class=\"attr\">file:</span></span><br><span class=\"line\">        <span class=\"attr\">path:</span> <span class=\"string\">/usr/local/nginx</span></span><br><span class=\"line\">        <span class=\"attr\">state:</span> <span class=\"string\">directory</span></span><br><span class=\"line\">      <span class=\"attr\">notify:</span>  <span class=\"comment\"># æ‰§è¡Œé€šçŸ¥ä»»åŠ¡ï¼Œé¡ºåºä¸ºä»ä¸‹åˆ°ä¸Š</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"string\">Nginxå®‰è£…</span> <span class=\"comment\"># åŒ¹é…ä»»åŠ¡name</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"string\">å®‰è£…Nginxä¾èµ–è½¯ä»¶åŒ…</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"string\">æ·»åŠ nginxç”¨æˆ·</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">æ£€æŸ¥ç³»ç»Ÿæ˜¯å¦å·²å¯åŠ¨Nginx</span></span><br><span class=\"line\">      <span class=\"attr\">shell:</span> <span class=\"string\">ps</span> <span class=\"string\">aux</span> <span class=\"string\">|</span> <span class=\"string\">grep</span> <span class=\"string\">nginx</span> <span class=\"string\">|</span> <span class=\"string\">grep</span> <span class=\"string\">-v</span> <span class=\"string\">grep</span></span><br><span class=\"line\">      <span class=\"attr\">register:</span> <span class=\"string\">nginx_status</span></span><br><span class=\"line\">      <span class=\"attr\">ignore_errors:</span> <span class=\"literal\">yes</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">æ£€æŸ¥æ˜¯å¦éœ€è¦å¯åŠ¨nginx</span></span><br><span class=\"line\">      <span class=\"attr\">shell:</span> <span class=\"string\">echo</span> <span class=\"string\">&quot;start nginx&quot;</span></span><br><span class=\"line\">      <span class=\"attr\">when:</span> <span class=\"string\">nginx_status.rc</span> <span class=\"type\">!=</span> <span class=\"number\">0</span> <span class=\"comment\"># åªæœ‰å½“æ¡ä»¶æ»¡è¶³æ—¶æ‰ä¼šè¿è¡Œè¯¥ä»»åŠ¡</span></span><br><span class=\"line\">      <span class=\"attr\">notify:</span>  <span class=\"comment\"># è¿è¡Œä»»åŠ¡ååªæœ‰çŠ¶æ€ä¸ºchangedæ‰ä¼šå‘é€notifyç»™handler</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"string\">å¯åŠ¨NginxæœåŠ¡</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"attr\">handlers:</span>  <span class=\"comment\"># handlersæ˜¯ä¸€ç±»ç‰¹æ®Šä»»åŠ¡ï¼Œå½“æœ‰notifyæ—¶ï¼Œä¼šè‡ªåŠ¨æ‰§è¡Œè¯¥ä»»åŠ¡</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">æ·»åŠ nginxç”¨æˆ·</span></span><br><span class=\"line\">      <span class=\"attr\">user:</span></span><br><span class=\"line\">        <span class=\"attr\">name:</span> <span class=\"string\">nginx</span></span><br><span class=\"line\">        <span class=\"attr\">state:</span> <span class=\"string\">present</span></span><br><span class=\"line\">        <span class=\"attr\">shell:</span> <span class=\"string\">/sbin/nologin</span></span><br><span class=\"line\">        <span class=\"attr\">createhome:</span> <span class=\"literal\">no</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">å®‰è£…Nginxä¾èµ–è½¯ä»¶åŒ…</span></span><br><span class=\"line\">      <span class=\"attr\">yum:</span></span><br><span class=\"line\">        <span class=\"attr\">name:</span> <span class=\"string\">&quot;<span class=\"template-variable\">&#123;&#123; item &#125;&#125;</span>&quot;</span></span><br><span class=\"line\">        <span class=\"attr\">state:</span> <span class=\"string\">present</span></span><br><span class=\"line\">      <span class=\"attr\">loop:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"string\">gcc</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"string\">zlib</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"string\">zlib-devel</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"string\">pcre-devel</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"string\">openssl</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"string\">openssl-devel</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">Nginxå®‰è£…</span></span><br><span class=\"line\">      <span class=\"attr\">shell:</span></span><br><span class=\"line\">        <span class=\"attr\">cmd:</span> <span class=\"string\">|</span></span><br><span class=\"line\"><span class=\"string\">          wget https://nginx.org/download/nginx-1.22.1.tar.gz</span></span><br><span class=\"line\"><span class=\"string\">          tar -zxvf nginx-1.22.1.tar.gz</span></span><br><span class=\"line\"><span class=\"string\">          cd nginx-1.22.1</span></span><br><span class=\"line\"><span class=\"string\">          ./configure --prefix=/usr/local/nginx --with-http_stub_status_module --with-http_ssl_module --user=nginx</span></span><br><span class=\"line\"><span class=\"string\">          make -j4</span></span><br><span class=\"line\"><span class=\"string\">          make -j4 install</span></span><br><span class=\"line\"><span class=\"string\"></span>        <span class=\"attr\">chdir:</span> <span class=\"string\">/usr/local</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">å¯åŠ¨NginxæœåŠ¡</span></span><br><span class=\"line\">      <span class=\"attr\">shell:</span></span><br><span class=\"line\">        <span class=\"attr\">cmd:</span> <span class=\"string\">/usr/local/nginx/sbin/nginx</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¼˜åŒ–4</p>\n</li>\n</ul>\n<blockquote>\n<p><strong>é—®é¢˜</strong>: ä¸Šé¢çš„å‰§æœ¬ä¸­nginxçš„å®‰è£…ç‰ˆæœ¬å’Œå®‰è£…è·¯å¾„éƒ½æ˜¯å†™æ­»çš„ï¼Œèƒ½å¦åŠ¨æ€é…ç½®å‘¢ï¼Ÿ<br>\n<strong>è§£å†³æ–¹æ³•</strong>: æå–å˜é‡ï¼Œä½¿ç”¨vars</p>\n</blockquote>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">å®‰è£…nginxå¹¶é…ç½®</span></span><br><span class=\"line\">  <span class=\"attr\">hosts:</span> <span class=\"string\">webservers</span></span><br><span class=\"line\">  <span class=\"attr\">become:</span> <span class=\"literal\">yes</span>  <span class=\"comment\"># åˆ‡æ¢åˆ°rootç”¨æˆ·ä¸‹æ‰§è¡Œ</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"attr\">vars:</span> <span class=\"comment\"># å®šä¹‰å˜é‡</span></span><br><span class=\"line\">    <span class=\"attr\">nginx_version:</span> <span class=\"string\">&quot;1.22.1&quot;</span></span><br><span class=\"line\">    <span class=\"attr\">work_dir:</span> <span class=\"string\">&quot;/usr/local&quot;</span></span><br><span class=\"line\">    <span class=\"attr\">nginx_install_path:</span> <span class=\"string\">&quot;/usr/local/nginx&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"attr\">tasks:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">åˆ¤æ–­æ˜¯å¦å­˜åœ¨nginxå®‰è£…ç›®å½•ï¼Œä¸å­˜åœ¨å°±å®‰è£…nginx</span></span><br><span class=\"line\">      <span class=\"attr\">file:</span></span><br><span class=\"line\">        <span class=\"attr\">path:</span> <span class=\"string\">&quot;<span class=\"template-variable\">&#123;&#123; nginx_install_path &#125;&#125;</span>&quot;</span> <span class=\"comment\"># å˜é‡ä¸€å®šè¦åŒæ‹¬å·</span></span><br><span class=\"line\">        <span class=\"attr\">state:</span> <span class=\"string\">directory</span></span><br><span class=\"line\">      <span class=\"attr\">notify:</span>  <span class=\"comment\"># æ‰§è¡Œé€šçŸ¥ä»»åŠ¡ï¼Œé¡ºåºä¸ºä»ä¸‹åˆ°ä¸Š</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"string\">Nginxå®‰è£…</span> <span class=\"comment\"># åŒ¹é…ä»»åŠ¡name</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"string\">å®‰è£…Nginxä¾èµ–è½¯ä»¶åŒ…</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"string\">æ·»åŠ nginxç”¨æˆ·</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">æ£€æŸ¥ç³»ç»Ÿæ˜¯å¦å·²å¯åŠ¨Nginx</span></span><br><span class=\"line\">      <span class=\"attr\">shell:</span> <span class=\"string\">ps</span> <span class=\"string\">aux</span> <span class=\"string\">|</span> <span class=\"string\">grep</span> <span class=\"string\">nginx</span> <span class=\"string\">|</span> <span class=\"string\">grep</span> <span class=\"string\">-v</span> <span class=\"string\">grep</span></span><br><span class=\"line\">      <span class=\"attr\">register:</span> <span class=\"string\">nginx_status</span></span><br><span class=\"line\">      <span class=\"attr\">ignore_errors:</span> <span class=\"literal\">yes</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">æ£€æŸ¥æ˜¯å¦éœ€è¦å¯åŠ¨nginx</span></span><br><span class=\"line\">      <span class=\"attr\">shell:</span> <span class=\"string\">echo</span> <span class=\"string\">&quot;start nginx&quot;</span></span><br><span class=\"line\">      <span class=\"attr\">when:</span> <span class=\"string\">nginx_status.rc</span> <span class=\"type\">!=</span> <span class=\"number\">0</span></span><br><span class=\"line\">      <span class=\"attr\">notify:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"string\">å¯åŠ¨NginxæœåŠ¡</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"attr\">handlers:</span>  <span class=\"comment\"># handlersæ˜¯ä¸€ç±»ç‰¹æ®Šä»»åŠ¡ï¼Œå½“æœ‰notifyæ—¶ï¼Œä¼šè‡ªåŠ¨æ‰§è¡Œè¯¥ä»»åŠ¡</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">æ·»åŠ nginxç”¨æˆ·</span></span><br><span class=\"line\">      <span class=\"attr\">user:</span></span><br><span class=\"line\">        <span class=\"attr\">name:</span> <span class=\"string\">nginx</span></span><br><span class=\"line\">        <span class=\"attr\">state:</span> <span class=\"string\">present</span></span><br><span class=\"line\">        <span class=\"attr\">shell:</span> <span class=\"string\">/sbin/nologin</span></span><br><span class=\"line\">        <span class=\"attr\">createhome:</span> <span class=\"literal\">no</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">å®‰è£…Nginxä¾èµ–è½¯ä»¶åŒ…</span></span><br><span class=\"line\">      <span class=\"attr\">yum:</span></span><br><span class=\"line\">        <span class=\"attr\">name:</span> <span class=\"string\">&quot;<span class=\"template-variable\">&#123;&#123; item &#125;&#125;</span>&quot;</span></span><br><span class=\"line\">        <span class=\"attr\">state:</span> <span class=\"string\">present</span></span><br><span class=\"line\">      <span class=\"attr\">loop:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"string\">gcc</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"string\">zlib</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"string\">zlib-devel</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"string\">pcre-devel</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"string\">openssl</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"string\">openssl-devel</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">Nginxå®‰è£…</span></span><br><span class=\"line\">      <span class=\"attr\">shell:</span></span><br><span class=\"line\">        <span class=\"attr\">cmd:</span> <span class=\"string\">|</span></span><br><span class=\"line\"><span class=\"string\">          wget https://nginx.org/download/nginx-&#123;&#123; nginx_version &#125;&#125;.tar.gz</span></span><br><span class=\"line\"><span class=\"string\">          tar -zxvf nginx-&#123;&#123; nginx_version &#125;&#125;.tar.gz</span></span><br><span class=\"line\"><span class=\"string\">          cd nginx-&#123;&#123; nginx_version &#125;&#125;</span></span><br><span class=\"line\"><span class=\"string\">          ./configure --prefix=&#123;&#123; nginx_install_path &#125;&#125; --with-http_stub_status_module --with-http_ssl_module --user=nginx</span></span><br><span class=\"line\"><span class=\"string\">          make -j4</span></span><br><span class=\"line\"><span class=\"string\">          make -j4 install</span></span><br><span class=\"line\"><span class=\"string\"></span>        <span class=\"attr\">chdir:</span> <span class=\"string\">&quot;<span class=\"template-variable\">&#123;&#123; work_dir &#125;&#125;</span>&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">å¯åŠ¨NginxæœåŠ¡</span></span><br><span class=\"line\">      <span class=\"attr\">shell:</span></span><br><span class=\"line\">        <span class=\"attr\">cmd:</span> <span class=\"string\">&quot;<span class=\"template-variable\">&#123;&#123; nginx_install_path &#125;&#125;</span>/sbin/nginx&quot;</span></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># é»˜è®¤</span></span><br><span class=\"line\">ansible-playbook nginx.yml</span><br><span class=\"line\"><span class=\"comment\"># ä¿®æ”¹å˜é‡</span></span><br><span class=\"line\">ansible-playbook nginx.yml -e <span class=\"string\">&quot;nginx_version=1.24.0&quot;</span> -e <span class=\"string\">&quot;work_dir=/root&quot;</span></span><br></pre></td></tr></table></figure>\n<div class=\"tips\">\n<p><em><strong>å°è´´å£«</strong></em></p>\n<ul class=\"lvl-1\">\n<li class=\"lvl-2\">é™¤äº†æˆ‘ä»¬è‡ªå·±å®šä¹‰çš„å˜é‡ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨Ansibleå†…ç½®çš„å˜é‡ï¼ŒAnsibleå†…ç½®çš„å˜é‡å¯ä»¥å‚è€ƒ<a href=\"https://docs.ansible.com/ansible/latest/reference_appendices/special_variables.html\">å®˜æ–¹æ–‡æ¡£</a>ã€‚</li>\n<li class=\"lvl-2\">æˆ‘ä»¬ç”¨çš„æœ€å¤šçš„å°±æ˜¯<code>ansible_facts</code>å˜é‡è·å–ä¸»æœºä¿¡æ¯ï¼Œå¦‚IPåœ°å€ã€MACåœ°å€ã€æ“ä½œç³»ç»Ÿç‰ˆæœ¬ç­‰ã€‚ä¹Ÿå°±æ˜¯é€šè¿‡<code>setup</code>æ¨¡å—è·å–çš„ä¿¡æ¯ã€‚</li>\n<li class=\"lvl-2\">åœ¨ä½¿ç”¨<code>ansible_facts</code>å˜é‡æ—¶éœ€è¦å¼€å¯<code>gather_facts</code>é€‰é¡¹ï¼Œé»˜è®¤æ˜¯å¼€å¯çš„ã€‚</li>\n<li class=\"lvl-2\">å¸¸ç”¨çš„<code>ansible_facts</code>å˜é‡å¦‚ä¸‹ï¼Œæ³¨æ„è¿™é‡Œå±æ€§åç§°å‰æ˜¯ä¸åŠ <code>ansible_</code>å‰ç¼€çš„ï¼š</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ansible_facts[&#x27;distribution&#x27;]: è¿œç¨‹ä¸»æœºçš„æ“ä½œç³»ç»Ÿåˆ†å‘åç§°ã€‚</span><br><span class=\"line\">ansible_facts[&#x27;distribution_version&#x27;]: è¿œç¨‹ä¸»æœºçš„æ“ä½œç³»ç»Ÿç‰ˆæœ¬å·ã€‚</span><br><span class=\"line\">ansible_facts[&#x27;user_id&#x27;]: è¿œç¨‹ä¸»æœºä¸Šå½“å‰ç”¨æˆ·çš„ç”¨æˆ· IDã€‚</span><br></pre></td></tr></table></figure>\n</div>\n<h2 id=\"ansible-playbook-Template\">ansible-playbook:Template</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Ansible Playbook Templateæ˜¯ä¸€ç§Ansibleçš„ç‰¹æ€§ï¼Œå®ƒå…è®¸æ‚¨åœ¨Playbookä¸­ä½¿ç”¨<code>Jinja2</code>æ¨¡æ¿è¯­è¨€æ¥åŠ¨æ€ç”Ÿæˆé…ç½®æ–‡ä»¶æˆ–å…¶ä»–æ–‡æœ¬æ–‡ä»¶ã€‚é€šè¿‡ä½¿ç”¨æ¨¡æ¿ï¼Œæ‚¨å¯ä»¥æ ¹æ®å˜é‡ã€æ¡ä»¶ã€å¾ªç¯ç­‰åŠ¨æ€ä¿¡æ¯æ¥ç”Ÿæˆç›®æ ‡æ–‡ä»¶ï¼Œä»è€Œä½¿é…ç½®æ–‡ä»¶æ›´å…·å¯æ‰©å±•æ€§å’Œçµæ´»æ€§ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä¸‹é¢æ˜¯ä½¿ç”¨Ansible Playbook Templateçš„ä¸€äº›å¸¸è§ç”¨æ³•å’Œç‰¹æ€§ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Jinja2æ¨¡æ¿è¯­è¨€: Ansible Playbook Templateä½¿ç”¨Jinja2æ¨¡æ¿è¯­è¨€ï¼Œè¿™æ˜¯ä¸€ç§åŠŸèƒ½å¼ºå¤§çš„æ¨¡æ¿å¼•æ“ï¼Œæ”¯æŒå˜é‡æ›¿æ¢ã€æ¡ä»¶è¯­å¥ã€å¾ªç¯è¯­å¥ç­‰åŠŸèƒ½ã€‚</span><br><span class=\"line\">å˜é‡æ›¿æ¢: æ‚¨å¯ä»¥åœ¨æ¨¡æ¿ä¸­ä½¿ç”¨Ansibleçš„å˜é‡æ¥æ›¿æ¢æ–‡æœ¬ä¸­çš„å ä½ç¬¦ã€‚è¿™ä½¿å¾—æ‚¨å¯ä»¥æ ¹æ®ä¸åŒçš„ç¯å¢ƒæˆ–æ¡ä»¶ç”Ÿæˆä¸åŒçš„é…ç½®æ–‡ä»¶ã€‚</span><br><span class=\"line\">æ¡ä»¶è¯­å¥: æ‚¨å¯ä»¥åœ¨æ¨¡æ¿ä¸­ä½¿ç”¨æ¡ä»¶è¯­å¥æ¥æ ¹æ®ä¸åŒçš„æ¡ä»¶ç”Ÿæˆä¸åŒçš„æ–‡æœ¬ã€‚è¿™å…è®¸æ‚¨æ ¹æ®éœ€è¦çµæ´»åœ°è°ƒæ•´ç”Ÿæˆçš„é…ç½®æ–‡ä»¶ã€‚</span><br><span class=\"line\">å¾ªç¯è¯­å¥: æ‚¨å¯ä»¥åœ¨æ¨¡æ¿ä¸­ä½¿ç”¨å¾ªç¯è¯­å¥æ¥å¯¹åˆ—è¡¨æˆ–å­—å…¸ä¸­çš„å…ƒç´ è¿›è¡Œè¿­ä»£ï¼Œä»è€Œç”Ÿæˆé‡å¤çš„æ–‡æœ¬å—ã€‚</span><br><span class=\"line\">åŒ…å«å…¶ä»–æ¨¡æ¿æ–‡ä»¶: æ‚¨å¯ä»¥åœ¨ä¸€ä¸ªæ¨¡æ¿ä¸­åŒ…å«å…¶ä»–æ¨¡æ¿æ–‡ä»¶ï¼Œä»è€Œä½¿æ¨¡æ¿æ›´åŠ æ¨¡å—åŒ–å’Œæ˜“äºç®¡ç†ã€‚</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Jinja2æ¨¡æ¿æ–‡ä»¶åç¼€ä¸º<code>.j2</code>ï¼Œå¸¸ç”¨è¯­æ³•å¦‚ä¸‹ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æ‰“å°å˜é‡</span></span><br><span class=\"line\">&#123;&#123; index_title &#125;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># forå¾ªç¯</span></span><br><span class=\"line\">&#123;% <span class=\"keyword\">for</span> key <span class=\"keyword\">in</span> index_for_array %&#125;</span><br><span class=\"line\">&lt;p&gt;show &#123;&#123; key &#125;&#125;&lt;/p&gt;</span><br><span class=\"line\">&#123;% endfor %&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ifåˆ¤æ–­</span></span><br><span class=\"line\">&#123;% <span class=\"keyword\">if</span> blog_href_show %&#125;</span><br><span class=\"line\">&lt;p&gt;</span><br><span class=\"line\">&lt;a href=<span class=\"string\">&quot;&#123;&#123; blog_href &#125;&#125;&quot;</span>&gt;&#123;&#123; index_title &#125;&#125;&lt;/a&gt;.&lt;br/&gt;</span><br><span class=\"line\">&lt;/p&gt;</span><br><span class=\"line\">&lt;p&gt;&lt;em&gt;Thank you <span class=\"keyword\">for</span> using &#123;&#123; index_title &#125;&#125;.&lt;/em&gt;&lt;/p&gt;</span><br><span class=\"line\">&#123;% endif %&#125;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç»“åˆä¸Šé¢éƒ¨ç½²nginxçš„ç¤ºä¾‹ï¼Œæˆ‘è¿™é‡Œå¢åŠ ä¸€ä¸ªä»»åŠ¡ï¼Œå°±æ˜¯æ›¿æ¢nginxå‘å¸ƒç›®å½•ä¸‹çš„index.htmlï¼Œç„¶åé‡å¯nginxï¼Œè¿™é‡Œç»™å‡º<code>index.html.j2</code></p>\n</li>\n</ul>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>&#123;&#123; index_title &#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">style</span>&gt;</span><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\"><span class=\"selector-tag\">html</span> &#123; <span class=\"attribute\">color-scheme</span>: light dark; &#125;</span></span><br><span class=\"line\"><span class=\"language-css\"><span class=\"selector-tag\">body</span> &#123; <span class=\"attribute\">width</span>: <span class=\"number\">35em</span>; <span class=\"attribute\">margin</span>: <span class=\"number\">0</span> auto;</span></span><br><span class=\"line\"><span class=\"language-css\"><span class=\"attribute\">font-family</span>: Tahoma, Verdana, Arial, sans-serif; &#125;</span></span><br><span class=\"line\"><span class=\"language-css\"></span><span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">h1</span>&gt;</span>Hello World!<span class=\"tag\">&lt;/<span class=\"name\">h1</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">img</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;&#123;&#123; blog_img &#125;&#125;&quot;</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">&#123;% for key in index_for_array %&#125;</span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>show &#123;&#123; key &#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\">&#123;% endfor %&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&#123;% if blog_href_show %&#125;</span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;&#123;&#123; blog_href &#125;&#125;&quot;</span>&gt;</span>&#123;&#123; index_title &#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span>.<span class=\"tag\">&lt;<span class=\"name\">br</span>/&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">em</span>&gt;</span>Thank you for using &#123;&#123; index_title &#125;&#125;.<span class=\"tag\">&lt;/<span class=\"name\">em</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\">&#123;% endif %&#125;</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ¥ç€æˆ‘ä»¬ä¿®æ”¹å‰§æœ¬yml</p>\n</li>\n</ul>\n<figure class=\"highlight yml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">å®‰è£…nginxå¹¶é…ç½®</span></span><br><span class=\"line\">  <span class=\"attr\">hosts:</span> <span class=\"string\">webservers</span></span><br><span class=\"line\">  <span class=\"attr\">become:</span> <span class=\"literal\">yes</span>  <span class=\"comment\"># åˆ‡æ¢åˆ°rootç”¨æˆ·ä¸‹æ‰§è¡Œ</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"attr\">vars:</span> <span class=\"comment\"># å®šä¹‰å˜é‡</span></span><br><span class=\"line\">    <span class=\"attr\">nginx_version:</span> <span class=\"string\">&quot;1.22.1&quot;</span></span><br><span class=\"line\">    <span class=\"attr\">work_dir:</span> <span class=\"string\">&quot;/usr/local&quot;</span></span><br><span class=\"line\">    <span class=\"attr\">nginx_install_path:</span> <span class=\"string\">&quot;/usr/local/nginx&quot;</span></span><br><span class=\"line\">    <span class=\"attr\">index_title:</span> <span class=\"string\">&quot;hanqf&#x27;s blog&quot;</span></span><br><span class=\"line\">    <span class=\"attr\">index_for_array:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">hello</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">world</span></span><br><span class=\"line\">    <span class=\"attr\">blog_href_show:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">    <span class=\"attr\">blog_href:</span> <span class=\"string\">&quot;https://blog.hanqunfeng.com&quot;</span></span><br><span class=\"line\">    <span class=\"attr\">blog_img:</span> <span class=\"string\">&quot;me.png&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"attr\">tasks:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">åˆ¤æ–­æ˜¯å¦å­˜åœ¨nginxå®‰è£…ç›®å½•ï¼Œä¸å­˜åœ¨å°±å®‰è£…nginx</span></span><br><span class=\"line\">      <span class=\"attr\">file:</span></span><br><span class=\"line\">        <span class=\"attr\">path:</span> <span class=\"string\">&quot;<span class=\"template-variable\">&#123;&#123; nginx_install_path &#125;&#125;</span>&quot;</span> <span class=\"comment\"># å˜é‡ä¸€å®šè¦åŒæ‹¬å·</span></span><br><span class=\"line\">        <span class=\"attr\">state:</span> <span class=\"string\">directory</span></span><br><span class=\"line\">      <span class=\"attr\">notify:</span>  <span class=\"comment\"># æ‰§è¡Œé€šçŸ¥ä»»åŠ¡ï¼Œé¡ºåºä¸ºä»ä¸‹åˆ°ä¸Š</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"string\">Nginxå®‰è£…</span> <span class=\"comment\"># åŒ¹é…ä»»åŠ¡name</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"string\">å®‰è£…Nginxä¾èµ–è½¯ä»¶åŒ…</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"string\">æ·»åŠ nginxç”¨æˆ·</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">æ£€æŸ¥ç³»ç»Ÿæ˜¯å¦å·²å¯åŠ¨Nginx</span></span><br><span class=\"line\">      <span class=\"attr\">shell:</span> <span class=\"string\">ps</span> <span class=\"string\">aux</span> <span class=\"string\">|</span> <span class=\"string\">grep</span> <span class=\"string\">nginx</span> <span class=\"string\">|</span> <span class=\"string\">grep</span> <span class=\"string\">-v</span> <span class=\"string\">grep</span></span><br><span class=\"line\">      <span class=\"attr\">register:</span> <span class=\"string\">nginx_status</span></span><br><span class=\"line\">      <span class=\"attr\">ignore_errors:</span> <span class=\"literal\">yes</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">æ£€æŸ¥æ˜¯å¦éœ€è¦å¯åŠ¨nginx</span></span><br><span class=\"line\">      <span class=\"attr\">shell:</span> <span class=\"string\">echo</span> <span class=\"string\">&quot;start nginx&quot;</span></span><br><span class=\"line\">      <span class=\"attr\">when:</span> <span class=\"string\">nginx_status.rc</span> <span class=\"type\">!=</span> <span class=\"number\">0</span></span><br><span class=\"line\">      <span class=\"attr\">notify:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"string\">å¯åŠ¨NginxæœåŠ¡</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">ä¸Šä¼ å›¾ç‰‡</span></span><br><span class=\"line\">      <span class=\"attr\">copy:</span></span><br><span class=\"line\">        <span class=\"attr\">src:</span> <span class=\"string\">me.png</span> <span class=\"comment\"># ä¸ymlåœ¨åŒä¸€ç›®å½•</span></span><br><span class=\"line\">        <span class=\"attr\">dest:</span> <span class=\"string\">&quot;<span class=\"template-variable\">&#123;&#123; nginx_install_path &#125;&#125;</span>/html/me.png&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">å‘å¸ƒindex.html</span></span><br><span class=\"line\">      <span class=\"attr\">template:</span></span><br><span class=\"line\">        <span class=\"attr\">src:</span> <span class=\"string\">index.html.j2</span> <span class=\"comment\"># ä¸ymlåœ¨åŒä¸€ç›®å½•</span></span><br><span class=\"line\">        <span class=\"attr\">dest:</span> <span class=\"string\">&quot;<span class=\"template-variable\">&#123;&#123; nginx_install_path &#125;&#125;</span>/html/index.html&quot;</span></span><br><span class=\"line\">        <span class=\"attr\">force:</span> <span class=\"literal\">true</span> <span class=\"comment\"># å¼ºåˆ¶è¦†ç›–</span></span><br><span class=\"line\">        <span class=\"attr\">backup:</span> <span class=\"literal\">true</span> <span class=\"comment\"># è¦†ç›–å‰å¤‡ä»½</span></span><br><span class=\"line\">      <span class=\"attr\">notify:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"string\">é‡å¯NginxæœåŠ¡</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"attr\">handlers:</span>  <span class=\"comment\"># handlersæ˜¯ä¸€ç±»ç‰¹æ®Šä»»åŠ¡ï¼Œå½“æœ‰notifyæ—¶ï¼Œä¼šè‡ªåŠ¨æ‰§è¡Œè¯¥ä»»åŠ¡</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">æ·»åŠ nginxç”¨æˆ·</span></span><br><span class=\"line\">      <span class=\"attr\">user:</span></span><br><span class=\"line\">        <span class=\"attr\">name:</span> <span class=\"string\">nginx</span></span><br><span class=\"line\">        <span class=\"attr\">state:</span> <span class=\"string\">present</span></span><br><span class=\"line\">        <span class=\"attr\">shell:</span> <span class=\"string\">/sbin/nologin</span></span><br><span class=\"line\">        <span class=\"attr\">createhome:</span> <span class=\"literal\">no</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">å®‰è£…Nginxä¾èµ–è½¯ä»¶åŒ…</span></span><br><span class=\"line\">      <span class=\"attr\">yum:</span></span><br><span class=\"line\">        <span class=\"attr\">name:</span> <span class=\"string\">&quot;<span class=\"template-variable\">&#123;&#123; item &#125;&#125;</span>&quot;</span></span><br><span class=\"line\">        <span class=\"attr\">state:</span> <span class=\"string\">present</span></span><br><span class=\"line\">      <span class=\"attr\">loop:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"string\">gcc</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"string\">zlib</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"string\">zlib-devel</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"string\">pcre-devel</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"string\">openssl</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"string\">openssl-devel</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">Nginxå®‰è£…</span></span><br><span class=\"line\">      <span class=\"attr\">shell:</span></span><br><span class=\"line\">        <span class=\"attr\">cmd:</span> <span class=\"string\">|</span></span><br><span class=\"line\"><span class=\"string\">          wget https://nginx.org/download/nginx-&#123;&#123; nginx_version &#125;&#125;.tar.gz</span></span><br><span class=\"line\"><span class=\"string\">          tar -zxvf nginx-&#123;&#123; nginx_version &#125;&#125;.tar.gz</span></span><br><span class=\"line\"><span class=\"string\">          cd nginx-&#123;&#123; nginx_version &#125;&#125;</span></span><br><span class=\"line\"><span class=\"string\">          ./configure --prefix=&#123;&#123; nginx_install_path &#125;&#125; --with-http_stub_status_module --with-http_ssl_module --user=nginx</span></span><br><span class=\"line\"><span class=\"string\">          make -j4</span></span><br><span class=\"line\"><span class=\"string\">          make -j4 install</span></span><br><span class=\"line\"><span class=\"string\"></span>        <span class=\"attr\">chdir:</span> <span class=\"string\">&quot;<span class=\"template-variable\">&#123;&#123; work_dir &#125;&#125;</span>&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">å¯åŠ¨NginxæœåŠ¡</span></span><br><span class=\"line\">      <span class=\"attr\">shell:</span></span><br><span class=\"line\">        <span class=\"attr\">cmd:</span> <span class=\"string\">&quot;<span class=\"template-variable\">&#123;&#123; nginx_install_path &#125;&#125;</span>/sbin/nginx&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">é‡å¯NginxæœåŠ¡</span></span><br><span class=\"line\">      <span class=\"attr\">shell:</span></span><br><span class=\"line\">        <span class=\"attr\">cmd:</span> <span class=\"string\">|</span></span><br><span class=\"line\"><span class=\"string\">          pkill nginx</span></span><br><span class=\"line\"><span class=\"string\">          &quot;&#123;&#123; nginx_install_path &#125;&#125;/sbin/nginx&quot;</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ›¿æ¢ä¹‹åçš„æ•ˆæœ</p>\n</li>\n</ul>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>hanqf&#x27;s blog<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">style</span>&gt;</span><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\"><span class=\"selector-tag\">html</span> &#123; <span class=\"attribute\">color-scheme</span>: light dark; &#125;</span></span><br><span class=\"line\"><span class=\"language-css\"><span class=\"selector-tag\">body</span> &#123; <span class=\"attribute\">width</span>: <span class=\"number\">35em</span>; <span class=\"attribute\">margin</span>: <span class=\"number\">0</span> auto;</span></span><br><span class=\"line\"><span class=\"language-css\"><span class=\"attribute\">font-family</span>: Tahoma, Verdana, Arial, sans-serif; &#125;</span></span><br><span class=\"line\"><span class=\"language-css\"></span><span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">h1</span>&gt;</span>Hello World!<span class=\"tag\">&lt;/<span class=\"name\">h1</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">img</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;me.png&quot;</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>show hello<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>show world<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;https://blog.hanqunfeng.com&quot;</span>&gt;</span>hanqf&#x27;s blog<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span>.<span class=\"tag\">&lt;<span class=\"name\">br</span>/&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">em</span>&gt;</span>Thank you for using hanqf&#x27;s blog.<span class=\"tag\">&lt;/<span class=\"name\">em</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><code>templateæ¨¡å—</code>çš„å¸¸ç”¨å‚æ•°è¯´æ˜ <code>ansible-doc  -s template</code></p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>å‚æ•°</th>\n<th>å¿…éœ€</th>\n<th>é»˜è®¤å€¼</th>\n<th>æè¿°</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>src</td>\n<td>æ˜¯</td>\n<td>æ— </td>\n<td>æ¨¡æ¿æ–‡ä»¶çš„è·¯å¾„ã€‚</td>\n</tr>\n<tr>\n<td>dest</td>\n<td>æ˜¯</td>\n<td>æ— </td>\n<td>ç›®æ ‡æ–‡ä»¶çš„è·¯å¾„ã€‚</td>\n</tr>\n<tr>\n<td>force</td>\n<td>å¦</td>\n<td>false</td>\n<td>å¦‚æœç›®æ ‡æ–‡ä»¶å·²ç»å­˜åœ¨ï¼Œæ˜¯å¦å¼ºåˆ¶è¦†ç›–ã€‚</td>\n</tr>\n<tr>\n<td>backup</td>\n<td>å¦</td>\n<td>false</td>\n<td>å¦‚æœè®¾ç½®ä¸ºtrueï¼Œåˆ™åœ¨è¦†ç›–ç›®æ ‡æ–‡ä»¶ä¹‹å‰åˆ›å»ºå¤‡ä»½ã€‚</td>\n</tr>\n<tr>\n<td>unsafe_writes</td>\n<td>å¦</td>\n<td>false</td>\n<td>å¦‚æœè®¾ç½®ä¸ºtrueï¼Œåˆ™ä¼šè·³è¿‡æ–‡ä»¶çš„æš‚æ—¶æ€§å†™å…¥ä¿æŠ¤ï¼ˆå¦‚ç¡®ä¿åœ¨å†™å…¥æ–‡ä»¶ä¹‹å‰ä¸ä¼šæ›´æ”¹å…¶å†…å®¹ï¼‰ã€‚</td>\n</tr>\n<tr>\n<td>newline_sequence</td>\n<td>å¦</td>\n<td>\\n</td>\n<td>ç”¨äºç”Ÿæˆæ–‡ä»¶æ—¶çš„æ¢è¡Œç¬¦åºåˆ—ã€‚</td>\n</tr>\n<tr>\n<td>validate</td>\n<td>å¦</td>\n<td>æ— </td>\n<td>è¦åº”ç”¨äºç”Ÿæˆæ–‡ä»¶çš„éªŒè¯å™¨è„šæœ¬çš„è·¯å¾„ã€‚</td>\n</tr>\n<tr>\n<td>mode</td>\n<td>å¦</td>\n<td>æ— </td>\n<td>ç›®æ ‡æ–‡ä»¶çš„æƒé™æ¨¡å¼ã€‚</td>\n</tr>\n<tr>\n<td>owner</td>\n<td>å¦</td>\n<td>æ— </td>\n<td>ç›®æ ‡æ–‡ä»¶çš„æ‰€æœ‰è€…ã€‚</td>\n</tr>\n<tr>\n<td>group</td>\n<td>å¦</td>\n<td>æ— </td>\n<td>ç›®æ ‡æ–‡ä»¶çš„æ‰€å±ç»„ã€‚</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¿™é‡Œè¦æ³¨æ„<code>templateæ¨¡å—</code>ä¸<code>copy</code>æ¨¡å—çš„åŒºåˆ«ï¼Œå‰è€…åœ¨ä¸Šä¼ æ—¶ä¼šè¿›è¡Œå˜é‡æ›¿æ¢ã€‚</p>\n</li>\n</ul>\n<h2 id=\"ansible-playbook-Role\">ansible-playbook:Role</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Ansibleä¸­çš„Roleæ˜¯ä¸€ç§ç»„ç»‡å’Œç®¡ç†å‰§æœ¬çš„æ–¹æ³•ï¼Œå®ƒå…è®¸æ‚¨å°†ç›¸å…³çš„ä»»åŠ¡ã€å˜é‡ã€æ–‡ä»¶å’Œå¤„ç†ç¨‹åºç»„åˆåˆ°ä¸€ä¸ªå¯é‡ç”¨çš„å•å…ƒä¸­ã€‚Roleä½¿å¾—æ‚¨å¯ä»¥æ›´è½»æ¾åœ°ç®¡ç†å’Œç»„ç»‡å¤§å‹çš„Ansibleé¡¹ç›®ï¼Œå¹¶ä¿ƒè¿›äº†å¯ç»´æŠ¤æ€§å’Œå¤ç”¨æ€§ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>Roleçš„ç‰¹æ€§</p>\n</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ç»„ç»‡æ€§ï¼šRoleå…è®¸æ‚¨å°†ç›¸å…³çš„ä»»åŠ¡å’Œæ–‡ä»¶ç»„ç»‡åœ¨ä¸€èµ·ï¼Œä½¿å¾—ä»£ç æ›´æ˜“äºç†è§£å’Œç»´æŠ¤ã€‚æ¯ä¸ªRoleé€šå¸¸éƒ½æœ‰ä¸€ä¸ªç‰¹å®šçš„ç›®çš„ï¼Œä¾‹å¦‚å®‰è£…ç‰¹å®šçš„è½¯ä»¶ã€é…ç½®æœåŠ¡æˆ–æ‰§è¡Œç‰¹å®šçš„ç³»ç»Ÿç®¡ç†ä»»åŠ¡ã€‚</span><br><span class=\"line\"></span><br><span class=\"line\">å¯é‡ç”¨æ€§ï¼šRoleå¯ä»¥è¢«è®¾è®¡æˆå¯é‡ç”¨çš„ç»„ä»¶ï¼Œå¯ä»¥åœ¨ä¸åŒçš„é¡¹ç›®ä¸­å¤šæ¬¡ä½¿ç”¨ã€‚è¿™æ ·ä¸€æ¥ï¼Œæ‚¨å¯ä»¥å°†å¸¸è§çš„åŠŸèƒ½å’Œé…ç½®å°è£…åˆ°Roleä¸­ï¼Œå¹¶åœ¨éœ€è¦æ—¶è½»æ¾åœ°è°ƒç”¨å®ƒä»¬ï¼Œä»è€Œæé«˜äº†ä»£ç çš„å¤ç”¨æ€§å’Œå¯ç§»æ¤æ€§ã€‚</span><br><span class=\"line\"></span><br><span class=\"line\">ç»“æ„åŒ–å¸ƒå±€ï¼šAnsibleæ¨èä¸€ç§ç‰¹å®šçš„ç›®å½•ç»“æ„æ¥ç»„ç»‡Roleï¼ŒåŒ…æ‹¬tasksã€handlersã€templatesã€filesã€varså’Œdefaultsç­‰ç›®å½•ã€‚è¿™ç§ç»“æ„åŒ–å¸ƒå±€æœ‰åŠ©äºæ›´æ¸…æ™°åœ°åˆ†ç¦»ä»»åŠ¡ã€å˜é‡ã€æ–‡ä»¶å’Œå¤„ç†ç¨‹åºï¼Œå¹¶ä½¿Roleæ›´æ˜“äºç®¡ç†å’Œç»´æŠ¤ã€‚</span><br><span class=\"line\"></span><br><span class=\"line\">å‚æ•°åŒ–ï¼šRoleå¯ä»¥ä½¿ç”¨å˜é‡æ¥æ¥å—å¤–éƒ¨è¾“å…¥ï¼Œä»è€Œä½¿å…¶æ›´åŠ çµæ´»å’Œé€šç”¨ã€‚é€šè¿‡å‚æ•°åŒ–ï¼Œæ‚¨å¯ä»¥å®šåˆ¶Roleçš„è¡Œä¸ºï¼Œä½¿å…¶é€‚ç”¨äºä¸åŒçš„ç¯å¢ƒå’Œéœ€æ±‚ã€‚</span><br><span class=\"line\"></span><br><span class=\"line\">ä¾èµ–å…³ç³»ï¼šRoleå¯ä»¥å®šä¹‰ä¾èµ–å…³ç³»ï¼Œå³ä¸€ä¸ªRoleå¯èƒ½ä¾èµ–äºå¦ä¸€ä¸ªRoleã€‚è¿™ç§ä¾èµ–å…³ç³»ä½¿å¾—æ‚¨å¯ä»¥æ„å»ºå¤æ‚çš„ç³»ç»Ÿé…ç½®ï¼Œè€Œä¸å¿…é‡å¤ç¼–å†™ç›¸åŒçš„ä»£ç ã€‚</span><br><span class=\"line\"></span><br><span class=\"line\">å¯æµ‹è¯•æ€§ï¼šç”±äºRoleæ˜¯å¯é‡ç”¨çš„ç»„ä»¶ï¼Œå› æ­¤å®ƒä»¬ä¹Ÿæ˜¯å¯æµ‹è¯•çš„ã€‚æ‚¨å¯ä»¥ç¼–å†™æµ‹è¯•ç”¨ä¾‹æ¥éªŒè¯Roleçš„è¡Œä¸ºæ˜¯å¦ç¬¦åˆé¢„æœŸï¼Œå¹¶ç¡®ä¿åœ¨ä¿®æ”¹ä»£ç æ—¶ä¸ä¼šç ´åç°æœ‰åŠŸèƒ½ã€‚</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><a href=\"https://github.com/ansible/ansible-examples\">ansible-examples</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>åˆ›å»ºrole</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åœ¨å½“å‰ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªåç§°ä¸ºnginx-installçš„roleï¼Œå®é™…ä¸Šå°±æ˜¯åˆ›å»ºä¸€ä¸ªåç§°ä¸ºnginx-installçš„ç›®å½•ç»“æ„</span></span><br><span class=\"line\">ansible-galaxy init nginx-install</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åœ¨æŒ‡å®šç›®å½•ä¸‹åˆ›å»ºrole</span></span><br><span class=\"line\">ansible-galaxy init --init-path /usr/local nginx-install</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># nginx-installç›®å½•ç»“æ„</span></span><br><span class=\"line\">$ tree nginx-install/</span><br><span class=\"line\">nginx-install/</span><br><span class=\"line\">â”œâ”€â”€ README.md</span><br><span class=\"line\">â”œâ”€â”€ defaults</span><br><span class=\"line\">â”‚Â Â  â””â”€â”€ main.yml</span><br><span class=\"line\">â”œâ”€â”€ files</span><br><span class=\"line\">â”œâ”€â”€ handlers</span><br><span class=\"line\">â”‚Â Â  â””â”€â”€ main.yml</span><br><span class=\"line\">â”œâ”€â”€ meta</span><br><span class=\"line\">â”‚Â Â  â””â”€â”€ main.yml</span><br><span class=\"line\">â”œâ”€â”€ tasks</span><br><span class=\"line\">â”‚Â Â  â””â”€â”€ main.yml</span><br><span class=\"line\">â”œâ”€â”€ templates</span><br><span class=\"line\">â”œâ”€â”€ tests</span><br><span class=\"line\">â”‚Â Â  â”œâ”€â”€ inventory</span><br><span class=\"line\">â”‚Â Â  â””â”€â”€ test.yml</span><br><span class=\"line\">â””â”€â”€ vars</span><br><span class=\"line\">    â””â”€â”€ main.yml</span><br><span class=\"line\"></span><br><span class=\"line\">8 directories, 8 files</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">filesï¼šå­˜æ”¾ç”±copyæˆ–scriptæ¨¡å—ç­‰è°ƒç”¨çš„æ–‡ä»¶</span><br><span class=\"line\">templatesï¼štemplateæ¨¡å—æŸ¥æ‰¾æ‰€éœ€è¦æ¨¡æ¿æ–‡ä»¶çš„ç›®å½•</span><br><span class=\"line\">tasksï¼šå®šä¹‰taskã€roleçš„åŸºæœ¬å…ƒç´ ï¼Œè‡³å°‘åº”è¯¥åŒ…å«ä¸€ä¸ªåä¸ºmain.ymlçš„æ–‡ä»¶ã€‚å…¶ä»–æ–‡ä»¶éœ€è¦åœ¨æ­¤æ–‡ä»¶ä¸­é€šè¿‡includeè¿›è¡ŒåŒ…å«</span><br><span class=\"line\">handlersï¼šè‡³å°‘åº”è¯¥åŒ…å«ä¸€ä¸ªåä¸ºmain.ymlçš„æ–‡ä»¶ï¼Œå…¶ä»–æ–‡ä»¶éœ€è¦åœ¨æ­¤æ–‡ä»¶ä¸­é€šè¿‡includeè¿›è¡ŒåŒ…å«</span><br><span class=\"line\">varsï¼šå®šä¹‰å˜é‡ï¼Œè‡³å°‘åº”è¯¥åŒ…å«ä¸€ä¸ªåä¸ºmain.ymlçš„æ–‡ä»¶ï¼Œå…¶ä»–æ–‡ä»¶éœ€è¦åœ¨æ­¤æ–‡ä»¶ä¸­é€šè¿‡includeè¿›è¡ŒåŒ…å«</span><br><span class=\"line\">metaï¼šå®šä¹‰å½“å‰è§’è‰²çš„ç‰¹æ®Šè®¾å®šåŠå…¶ä¾èµ–å…³ç³»ï¼Œè‡³å°‘åº”è¯¥åŒ…å«ä¸€ä¸ªåä¸ºmain.ymlçš„æ–‡ä»¶ï¼Œå…¶ä»–æ–‡ä»¶éœ€åœ¨æ­¤æ–‡ä»¶ä¸­é€šè¿‡includeè¿›è¡ŒåŒ…å«</span><br><span class=\"line\">defaultï¼šè®¾å®šé»˜è®¤å˜é‡æ—¶ä½¿ç”¨æ­¤ç›®å½•ä¸­çš„main.ymlæ–‡ä»¶ï¼Œæ¯”varsçš„ä¼˜å…ˆçº§ä½</span><br><span class=\"line\">testsï¼šå®šä¹‰æµ‹è¯•ç”¨ä¾‹ï¼Œè‡³å°‘åº”è¯¥åŒ…å«ä¸€ä¸ªåä¸ºinventoryçš„æ–‡ä»¶ï¼Œå…¶ä»–æ–‡ä»¶éœ€è¦åœ¨æ­¤æ–‡ä»¶ä¸­é€šè¿‡includeè¿›è¡ŒåŒ…å«</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ansibleæŸ¥æ‰¾roleçš„è·¯å¾„ï¼Œæ¨èæ”¾åˆ°<code>/etc/ansible/roles</code></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$(<span class=\"built_in\">pwd</span>)/roles</span><br><span class=\"line\">/$(<span class=\"built_in\">whoami</span>)/.ansible/roles</span><br><span class=\"line\">/usr/share/ansible/roles</span><br><span class=\"line\">/etc/ansible/roles</span><br><span class=\"line\">$(<span class=\"built_in\">pwd</span>)</span><br></pre></td></tr></table></figure>\n<h3 id=\"æˆ‘ä»¬å°†ä¸Šé¢å®‰è£…nginxé‚£ä¸ªå‰§æœ¬ä¿®æ”¹ä¸ºroleçš„æ–¹å¼\">æˆ‘ä»¬å°†ä¸Šé¢å®‰è£…nginxé‚£ä¸ªå‰§æœ¬ä¿®æ”¹ä¸ºroleçš„æ–¹å¼</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>nginx-install/tasks/main.yml</p>\n</li>\n</ul>\n<figure class=\"highlight yml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"comment\"># tasks file for nginx-install</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">Check</span> <span class=\"string\">if</span> <span class=\"string\">running</span> <span class=\"string\">as</span> <span class=\"string\">root</span></span><br><span class=\"line\">  <span class=\"attr\">fail:</span></span><br><span class=\"line\">    <span class=\"attr\">msg:</span> <span class=\"string\">&quot;This role must be run as root user&quot;</span></span><br><span class=\"line\">  <span class=\"attr\">when:</span> <span class=\"string\">ansible_facts[&#x27;user_id&#x27;]</span> <span class=\"type\">!=</span> <span class=\"string\">&#x27;root&#x27;</span> <span class=\"comment\"># å› ä¸ºæˆ‘ä»¬çš„å‰§æœ¬æ˜¯éœ€è¦rootç”¨æˆ·è¿è¡Œï¼Œæ‰€ä»¥è¿™é‡ŒåŠ ä¸€ä¸ªåˆ¤æ–­ï¼Œè¿™é‡Œå°±ç”¨åˆ°äº†ansible_factsç‰¹æ®Šå˜é‡</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">åˆ¤æ–­æ˜¯å¦å­˜åœ¨nginxå®‰è£…ç›®å½•ï¼Œä¸å­˜åœ¨å°±å®‰è£…nginx</span></span><br><span class=\"line\">  <span class=\"attr\">file:</span></span><br><span class=\"line\">    <span class=\"attr\">path:</span> <span class=\"string\">&quot;<span class=\"template-variable\">&#123;&#123; nginx_install_path &#125;&#125;</span>&quot;</span></span><br><span class=\"line\">    <span class=\"attr\">state:</span> <span class=\"string\">directory</span></span><br><span class=\"line\">  <span class=\"attr\">notify:</span>  <span class=\"comment\"># æ‰§è¡Œé€šçŸ¥ä»»åŠ¡ï¼Œé¡ºåºä¸ºä»ä¸‹åˆ°ä¸Š</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">Nginxå®‰è£…</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">å®‰è£…Nginxä¾èµ–è½¯ä»¶åŒ…</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">æ·»åŠ nginxç”¨æˆ·</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">æ£€æŸ¥ç³»ç»Ÿæ˜¯å¦å·²å¯åŠ¨Nginx</span></span><br><span class=\"line\">  <span class=\"attr\">shell:</span> <span class=\"string\">ps</span> <span class=\"string\">aux</span> <span class=\"string\">|</span> <span class=\"string\">grep</span> <span class=\"string\">nginx</span> <span class=\"string\">|</span> <span class=\"string\">grep</span> <span class=\"string\">-v</span> <span class=\"string\">grep</span></span><br><span class=\"line\">  <span class=\"attr\">register:</span> <span class=\"string\">nginx_status</span></span><br><span class=\"line\">  <span class=\"attr\">ignore_errors:</span> <span class=\"literal\">yes</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">æ£€æŸ¥æ˜¯å¦éœ€è¦å¯åŠ¨nginx</span></span><br><span class=\"line\">  <span class=\"attr\">shell:</span> <span class=\"string\">echo</span> <span class=\"string\">&quot;start nginx&quot;</span></span><br><span class=\"line\">  <span class=\"attr\">when:</span> <span class=\"string\">nginx_status.rc</span> <span class=\"type\">!=</span> <span class=\"number\">0</span></span><br><span class=\"line\">  <span class=\"attr\">notify:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">å¯åŠ¨NginxæœåŠ¡</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">ä¸Šä¼ å›¾ç‰‡</span></span><br><span class=\"line\">  <span class=\"attr\">copy:</span></span><br><span class=\"line\">    <span class=\"attr\">src:</span> <span class=\"string\">me.png</span> <span class=\"comment\"># ä¸ymlåœ¨åŒä¸€ç›®å½•</span></span><br><span class=\"line\">    <span class=\"attr\">dest:</span> <span class=\"string\">&quot;<span class=\"template-variable\">&#123;&#123; nginx_install_path &#125;&#125;</span>/html/me.png&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">å‘å¸ƒindex.html</span></span><br><span class=\"line\">  <span class=\"attr\">template:</span></span><br><span class=\"line\">    <span class=\"attr\">src:</span> <span class=\"string\">index.html.j2</span> <span class=\"comment\"># ä¸ymlåœ¨åŒä¸€ç›®å½•</span></span><br><span class=\"line\">    <span class=\"attr\">dest:</span> <span class=\"string\">&quot;<span class=\"template-variable\">&#123;&#123; nginx_install_path &#125;&#125;</span>/html/index.html&quot;</span></span><br><span class=\"line\">    <span class=\"attr\">force:</span> <span class=\"literal\">true</span> <span class=\"comment\"># å¼ºåˆ¶è¦†ç›–</span></span><br><span class=\"line\">    <span class=\"attr\">backup:</span> <span class=\"literal\">true</span> <span class=\"comment\"># è¦†ç›–å‰å¤‡ä»½</span></span><br><span class=\"line\">  <span class=\"attr\">notify:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">é‡å¯NginxæœåŠ¡</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>nginx-install/handlers/main.yml</p>\n</li>\n</ul>\n<figure class=\"highlight yml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"comment\"># handlers file for nginx-install</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">æ·»åŠ nginxç”¨æˆ·</span></span><br><span class=\"line\">  <span class=\"attr\">user:</span></span><br><span class=\"line\">    <span class=\"attr\">name:</span> <span class=\"string\">nginx</span></span><br><span class=\"line\">    <span class=\"attr\">state:</span> <span class=\"string\">present</span></span><br><span class=\"line\">    <span class=\"attr\">shell:</span> <span class=\"string\">/sbin/nologin</span></span><br><span class=\"line\">    <span class=\"attr\">createhome:</span> <span class=\"literal\">no</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">å®‰è£…Nginxä¾èµ–è½¯ä»¶åŒ…</span></span><br><span class=\"line\">  <span class=\"attr\">yum:</span></span><br><span class=\"line\">    <span class=\"attr\">name:</span> <span class=\"string\">&quot;<span class=\"template-variable\">&#123;&#123; item &#125;&#125;</span>&quot;</span></span><br><span class=\"line\">    <span class=\"attr\">state:</span> <span class=\"string\">present</span></span><br><span class=\"line\">  <span class=\"attr\">loop:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">gcc</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">zlib</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">zlib-devel</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">pcre-devel</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">openssl</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">openssl-devel</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">Nginxå®‰è£…</span></span><br><span class=\"line\">  <span class=\"attr\">shell:</span></span><br><span class=\"line\">    <span class=\"attr\">cmd:</span> <span class=\"string\">|</span></span><br><span class=\"line\"><span class=\"string\">      wget https://nginx.org/download/nginx-&#123;&#123; nginx_version &#125;&#125;.tar.gz</span></span><br><span class=\"line\"><span class=\"string\">      tar -zxvf nginx-&#123;&#123; nginx_version &#125;&#125;.tar.gz</span></span><br><span class=\"line\"><span class=\"string\">      cd nginx-&#123;&#123; nginx_version &#125;&#125;</span></span><br><span class=\"line\"><span class=\"string\">      ./configure --prefix=&#123;&#123; nginx_install_path &#125;&#125; --with-http_stub_status_module --with-http_ssl_module --user=nginx</span></span><br><span class=\"line\"><span class=\"string\">      make -j4</span></span><br><span class=\"line\"><span class=\"string\">      make -j4 install</span></span><br><span class=\"line\"><span class=\"string\"></span>    <span class=\"attr\">chdir:</span> <span class=\"string\">&quot;<span class=\"template-variable\">&#123;&#123; work_dir &#125;&#125;</span>&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">å¯åŠ¨NginxæœåŠ¡</span></span><br><span class=\"line\">  <span class=\"attr\">shell:</span></span><br><span class=\"line\">    <span class=\"attr\">cmd:</span> <span class=\"string\">&quot;<span class=\"template-variable\">&#123;&#123; nginx_install_path &#125;&#125;</span>/sbin/nginx&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">é‡å¯NginxæœåŠ¡</span></span><br><span class=\"line\">  <span class=\"attr\">shell:</span></span><br><span class=\"line\">    <span class=\"attr\">cmd:</span> <span class=\"string\">|</span></span><br><span class=\"line\"><span class=\"string\">      pkill nginx</span></span><br><span class=\"line\"><span class=\"string\">      &quot;&#123;&#123; nginx_install_path &#125;&#125;/sbin/nginx&quot;</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>nginx-install/vars/main.yml</p>\n</li>\n</ul>\n<figure class=\"highlight yml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"comment\"># vars file for nginx-install</span></span><br><span class=\"line\"><span class=\"attr\">nginx_version:</span> <span class=\"string\">&quot;1.22.1&quot;</span></span><br><span class=\"line\"><span class=\"attr\">work_dir:</span> <span class=\"string\">&quot;/usr/local&quot;</span></span><br><span class=\"line\"><span class=\"attr\">nginx_install_path:</span> <span class=\"string\">&quot;/usr/local/nginx&quot;</span></span><br><span class=\"line\"><span class=\"attr\">index_title:</span> <span class=\"string\">&quot;hanqf&#x27;s blog&quot;</span></span><br><span class=\"line\"><span class=\"attr\">index_for_array:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">hello</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">world</span></span><br><span class=\"line\"><span class=\"attr\">blog_href_show:</span> <span class=\"literal\">true</span></span><br><span class=\"line\"><span class=\"attr\">blog_href:</span> <span class=\"string\">&quot;https://blog.hanqunfeng.com&quot;</span></span><br><span class=\"line\"><span class=\"attr\">blog_img:</span> <span class=\"string\">&quot;me.png&quot;</span></span><br></pre></td></tr></table></figure>\n<div class=\"tips\">\n<p><em><strong>å°è´´å£«</strong></em></p>\n<ul class=\"lvl-1\">\n<li class=\"lvl-2\">ä¸Šé¢ä»‹ç»çš„<code>tasks</code>ã€<code>handlers</code>ï¼Œå…¶ç›®å½•ä¸­éƒ½å«æœ‰ä¸€ä¸ªmain.ymlæ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶æ˜¯å¿…é¡»å­˜åœ¨çš„</li>\n<li class=\"lvl-2\">ä½†æ˜¯å¦‚æœé…ç½®çš„å†…å®¹æ¯”è¾ƒå¤šï¼Œéƒ½å†™åœ¨main.ymlæ–‡ä»¶ä¸­ï¼Œé‚£ä¹ˆè¿™ä¸ªæ–‡ä»¶å°±æ˜¾å¾—æœ‰ç‚¹è‡ƒè‚¿ï¼Œæ‰€ä»¥å¯ä»¥å°†è¿™äº›å†…å®¹æ‹†åˆ†æˆå¤šä¸ªæ–‡ä»¶ï¼Œç„¶ååœ¨main.ymlæ–‡ä»¶ä¸­é€šè¿‡<code>include</code>è¿›è¡ŒåŒ…å«</li>\n</ul>\n<figure class=\"highlight yml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">include:</span> <span class=\"string\">other1.yml</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">include:</span> <span class=\"string\">other2.yml</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-1\">\n<li class=\"lvl-2\"><code>tasks</code>æˆ–è€…<code>handlersä¸­</code>è¿˜å¯ä»¥ä½¿ç”¨<code>include_tasks</code>è¿›è¡ŒåŒ…å«</li>\n</ul>\n<figure class=\"highlight yml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">include_tasks:</span> <span class=\"string\">other1.yml</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">include_tasks:</span> <span class=\"string\">other2.yml</span></span><br><span class=\"line\"><span class=\"comment\"># æˆ–è€…</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">include_tasks:</span> <span class=\"string\">&quot;<span class=\"template-variable\">&#123;&#123; item &#125;&#125;</span>&quot;</span></span><br><span class=\"line\">  <span class=\"attr\">loop:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">other1.yml</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">other2.yml</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-1\">\n<li class=\"lvl-2\">\n<p><code>vars</code>é‡Œä¹Ÿå¯ä»¥å®šä¹‰å¤šä¸ªymlæ–‡ä»¶å­˜å‚¨å˜é‡ï¼Œç„¶ååœ¨tasksä¸­é€šè¿‡<code>include_vars</code>è¿›è¡ŒåŒ…å«ï¼Œæ³¨æ„ï¼Œå¿…é¡»æ”¾åœ¨taskçš„ymlæ–‡ä»¶ä¸­</p>\n</li>\n</ul>\n<figure class=\"highlight yml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æ­¤æ—¶ä¸éœ€è¦åŠ ä¸Švarsè·¯å¾„ï¼Œä¼šè‡ªåŠ¨ä»varsç›®å½•ä¸‹æŸ¥æ‰¾</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">include_vars:</span> <span class=\"string\">&quot;v-other1.yml&quot;</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">include_vars:</span> <span class=\"string\">&quot;v-other2.yml&quot;</span></span><br><span class=\"line\"><span class=\"comment\"># æˆ–è€…</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">include_vars:</span> <span class=\"string\">&quot;<span class=\"template-variable\">&#123;&#123; item &#125;&#125;</span>&quot;</span></span><br><span class=\"line\">  <span class=\"attr\">loop:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">v-other1.yml</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">v-other2.yml</span></span><br></pre></td></tr></table></figure>\n</div>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å°†æ¨¡æ¿æ–‡ä»¶å’Œå›¾ç‰‡æ–‡æœ¬ä¿å­˜åˆ°å¯¹åº”çš„è·¯å¾„</p>\n</li>\n</ul>\n<blockquote>\n<p>nginx-install/templates/index.html.j2<br>\nnginx-install/files/me.png</p>\n</blockquote>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ‰§è¡Œ<br>\n<em><strong>å‡è®¾æˆ‘ä»¬å°†åˆ›å»ºçš„è§’è‰²å®‰è£…åˆ°äº†<code>/etc/ansible/roles</code>ä¸‹</strong></em></p>\n</li>\n</ul>\n<blockquote>\n<p>åˆ›å»ºå¯åŠ¨å‰§æœ¬<code>nginx-install-start.yml</code>ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä¿®æ”¹<code>tests/test.yml</code></p>\n</blockquote>\n<figure class=\"highlight yml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">å®‰è£…nginxå¹¶é…ç½®</span></span><br><span class=\"line\">  <span class=\"attr\">hosts:</span> <span class=\"string\">webservers</span></span><br><span class=\"line\">  <span class=\"attr\">become:</span> <span class=\"literal\">yes</span>  <span class=\"comment\"># åˆ‡æ¢åˆ°rootç”¨æˆ·ä¸‹æ‰§è¡Œ</span></span><br><span class=\"line\">  <span class=\"attr\">roles:</span> <span class=\"comment\"># è°ƒç”¨role</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">nginx-install</span> <span class=\"comment\"># roleåç§°</span></span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>æ‰§è¡Œrole</p>\n</blockquote>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ansible-playbook nginx-install-start.yml</span><br></pre></td></tr></table></figure>\n<h2 id=\"ansible-galaxy\">ansible-galaxy</h2>\n<h3 id=\"ä»€ä¹ˆæ˜¯ansible-galaxy\">ä»€ä¹ˆæ˜¯ansible-galaxy</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç”¨äºä»<a href=\"https://galaxy.ansible.com\">ansible-galaxyå®˜ç½‘</a>ä¸ŠæŸ¥æ‰¾ï¼Œä¸‹è½½<code>role</code>å’Œ<code>collection</code>çš„å·¥å…·ï¼Œå¦‚ä½•ä¸‹è½½å’Œä½¿ç”¨ç½‘ç«™ä¸Šéƒ½æœ‰è¯´æ˜ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://ansible.readthedocs.io/projects/galaxy-ng/en/latest/community/userguide/\">ansible-galaxyç”¨æˆ·æŒ‡å—</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>æˆ‘ä»¬ä¹Ÿå¯ä»¥å°†è‡ªå·±åˆ›å»ºå¥½çš„<code>role</code>å‘å¸ƒåˆ°<code>ansible-galaxy</code>ä¸Šï¼Œå¯ä»¥å‚è€ƒ <a href=\"/2024/03/26/ansible-role-publish/\" title=\"Ansible Role Publish To Galaxy\">Ansible Role Publish To Galaxy</a></p>\n</li>\n</ul>\n<h3 id=\"role\">role</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æœç´¢role</span></span><br><span class=\"line\">ansible-galaxy search mysql</span><br><span class=\"line\"><span class=\"comment\"># æˆ–è€…</span></span><br><span class=\"line\">ansible-galaxy role search mysql</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹å·²ç»å®‰è£…çš„role</span></span><br><span class=\"line\">ansible-galaxy list</span><br><span class=\"line\"><span class=\"comment\"># æˆ–è€…</span></span><br><span class=\"line\">ansible-galaxy role list</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å®‰è£…roleï¼Œé»˜è®¤å®‰è£…åˆ° ~/.ansible/roles ä¸‹</span></span><br><span class=\"line\">ansible-galaxy role install shaneholloman.redis</span><br><span class=\"line\"><span class=\"comment\"># å®‰è£…åˆ°æŒ‡å®šè·¯å¾„</span></span><br><span class=\"line\">ansible-galaxy role install &lt;role-name&gt; -p &lt;path&gt;</span><br></pre></td></tr></table></figure>\n<h3 id=\"collection\">collection</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ansible-galaxyåŒæ—¶æ”¯æŒä¸‹è½½ collection</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹å·²ç»å®‰è£…çš„collection</span></span><br><span class=\"line\">ansible-galaxy collection list</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å®‰è£…collectionï¼Œï¼Œé»˜è®¤å®‰è£…åˆ° ~/.ansible/collections/ansible_collections ä¸‹</span></span><br><span class=\"line\">ansible-galaxy collection install saiello.kafka</span><br><span class=\"line\"><span class=\"comment\"># å®‰è£…åˆ°æŒ‡å®šè·¯å¾„</span></span><br><span class=\"line\">ansible-galaxy collection install &lt;collection-name&gt; -p &lt;path&gt;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Ansible Collection æ˜¯ Ansible ç¤¾åŒºä¸ºäº†æ›´å¥½åœ°ç®¡ç†å’Œç»„ç»‡ Ansible è§’è‰²ã€æ¨¡å—ã€æ’ä»¶ç­‰å†…å®¹è€Œå¼•å…¥çš„æ¦‚å¿µã€‚å®ƒå¯ä»¥è¢«è§†ä¸ºä¸€ç§æ‰“åŒ…æœºåˆ¶ï¼Œç”¨äºå°†ç›¸å…³çš„ Ansible å†…å®¹æ‰“åŒ…æˆå•ç‹¬çš„å•å…ƒï¼Œä½¿å¾—å…¶æ›´æ˜“äºåˆ†äº«ã€å®‰è£…å’Œç»´æŠ¤ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å…·ä½“æ¥è¯´ï¼ŒAnsible Collection å…·æœ‰ä»¥ä¸‹ä½œç”¨ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ç»„ç»‡å’Œç®¡ç†è§’è‰²ã€æ¨¡å—å’Œæ’ä»¶ï¼šé€šè¿‡ Collectionï¼Œå¯ä»¥å°†ç›¸å…³çš„è§’è‰²ã€æ¨¡å—å’Œæ’ä»¶æ‰“åŒ…åœ¨ä¸€èµ·ï¼Œå½¢æˆé€»è¾‘ä¸Šçš„å•å…ƒï¼Œæé«˜äº†å†…å®¹çš„ç»„ç»‡æ€§å’Œå¯ç®¡ç†æ€§ã€‚</span><br><span class=\"line\"></span><br><span class=\"line\">æ˜“äºåˆ†äº«å’Œåˆ†å‘ï¼šAnsible Collection å¯ä»¥è¢«è½»æ¾åœ°åˆ†äº«å’Œåˆ†å‘ç»™å…¶ä»–ç”¨æˆ·ã€‚å¼€å‘äººå‘˜å¯ä»¥å°†è‡ªå·±çš„è§’è‰²ã€æ¨¡å—æ‰“åŒ…æˆ Collectionï¼Œå¹¶å°†å…¶å‘å¸ƒåˆ° Ansible Galaxy æˆ–å…¶ä»–é›†ä¸­å¼çš„ä»“åº“ä¸­ï¼Œä¾›å…¶ä»–ç”¨æˆ·ä½¿ç”¨ã€‚</span><br><span class=\"line\"></span><br><span class=\"line\">ç‰ˆæœ¬æ§åˆ¶å’Œæ›´æ–°ï¼šä¸è§’è‰²ç›¸æ¯”ï¼ŒCollection æ›´å®¹æ˜“è¿›è¡Œç‰ˆæœ¬æ§åˆ¶å’Œæ›´æ–°ã€‚å¼€å‘äººå‘˜å¯ä»¥ä¸º Collection æŒ‡å®šç‰ˆæœ¬ï¼Œå¹¶åœ¨æ›´æ–°å†…å®¹æ—¶å‘å¸ƒæ–°çš„ç‰ˆæœ¬ï¼Œä½¿å¾—ç”¨æˆ·å¯ä»¥é€‰æ‹©ä½¿ç”¨ç‰¹å®šç‰ˆæœ¬æˆ–è€…å‡çº§åˆ°æœ€æ–°ç‰ˆæœ¬ã€‚</span><br><span class=\"line\"></span><br><span class=\"line\">ä¾èµ–ç®¡ç†ï¼šCollection æ”¯æŒä¾èµ–ç®¡ç†ï¼Œå¯ä»¥åœ¨ Collection ä¸­æŒ‡å®šä¾èµ–å…³ç³»ï¼Œç¡®ä¿ç›¸å…³çš„è§’è‰²ã€æ¨¡å—å’Œæ’ä»¶èƒ½å¤Ÿæ­£å¸¸å·¥ä½œã€‚</span><br><span class=\"line\"></span><br><span class=\"line\">æä¾›æ–‡æ¡£å’Œç¤ºä¾‹ï¼šå¼€å‘äººå‘˜å¯ä»¥å°†æ–‡æ¡£å’Œç¤ºä¾‹ä»£ç ä¸ Collection æ‰“åŒ…åœ¨ä¸€èµ·ï¼Œä½¿å¾—ç”¨æˆ·æ›´å®¹æ˜“ç†è§£å’Œä½¿ç”¨å…¶ä¸­çš„å†…å®¹ã€‚</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ€»çš„æ¥è¯´ï¼ŒAnsible Collection æä¾›äº†ä¸€ç§æ›´é«˜çº§åˆ«çš„ç»„ç»‡å’Œç®¡ç†æ–¹å¼ï¼Œä½¿å¾— Ansible å†…å®¹æ›´æ˜“äºåˆ†äº«ã€ä½¿ç”¨å’Œç»´æŠ¤ï¼Œä»è€Œæé«˜äº† Ansible çš„æ•´ä½“ç”Ÿæ€ç³»ç»Ÿçš„å¥å£®æ€§å’Œå¯ç”¨æ€§ã€‚</p>\n</li>\n</ul>\n<div class=\"tips\">\n<p><em><strong>å°è´´å£«</strong></em></p>\n<ul class=\"lvl-1\">\n<li class=\"lvl-2\">å‰é¢çš„å‰§æœ¬ä¸­æˆ‘ä»¬å¤šæ¬¡ä½¿ç”¨åˆ°äº†<code>become</code>åˆ‡æ¢ç”¨æˆ·åˆ°rootç”¨æˆ·ï¼Œå…¶å®åœ¨<code>ansible.cfg</code>ä¸­æˆ‘ä»¬å¯ä»¥é…ç½®<code>become_user</code>ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ä¸ç”¨æ¯æ¬¡éƒ½åˆ‡æ¢ç”¨æˆ·äº†</li>\n<li class=\"lvl-2\">ä½†è¿™é‡Œæœ‰ä¸ªéœ€è¦æ³¨æ„çš„ç‚¹ï¼Œå°±æ˜¯å› ä¸º <code>become</code> ä¼šä»¥ä¸€ä¸ªå…¨æ–°çš„ç¯å¢ƒæ‰§è¡Œä»»åŠ¡ï¼Œæ‰€ä»¥å…¶ä¸ä¼šåŒ…å«åŸç”¨æˆ·çš„ç¯å¢ƒå˜é‡ã€‚å¯ä»¥ç†è§£ä¸ºå…¶æ˜¯é€šè¿‡<code>sudo su</code>åˆ‡æ¢åˆ°rootï¼Œè€Œé<code>sudo -i</code>ã€‚</li>\n</ul>\n</div>\n<h2 id=\"åè®°\">åè®°</h2>\n<p>å…³äºansibleçš„çŸ¥è¯†ç‚¹è¿˜æœ‰å¾ˆå¤šæ²¡æœ‰ç ”ç©¶åˆ°ï¼Œåé¢ä¼šæ…¢æ…¢è¡¥å§â€¦â€¦</p>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å…³äºå°†Ansible Roleå‘å¸ƒåˆ°Galaxyçš„è¯¦ç»†ä»‹ç»å¯ä»¥å‚çœ‹ <a href=\"/2024/03/26/ansible-role-publish/\" title=\"Ansible Role Publish To Galaxy\">Ansible Role Publish To Galaxy</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>å…³äºå°†Ansible Collectionå‘å¸ƒåˆ°Galaxyçš„è¯¦ç»†ä»‹ç»å¯ä»¥å‚çœ‹ <a href=\"/2024/03/27/ansible-collection-publish/\" title=\"Ansible Collection Publish To Galaxy\">Ansible Collection Publish To Galaxy</a></p>\n</li>\n</ul>\n","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç»Ansibleçš„å®‰è£…å’Œä½¿ç”¨ã€‚ æœ¬æ–‡åŸºäºCentOS8ã€‚ Ansibleç®€ä»‹ Ansible æ˜¯ä¸€ä¸ªå¼€æºçš„è‡ªåŠ¨åŒ–è¿ç»´å·¥å…·ï¼Œå®ƒåŸºäº Python è¯­è¨€å¼€å‘ï¼Œæ”¯æŒè·¨å¹³å°ï¼Œå¯ä»¥è¿è¡Œåœ¨ Linuxã€Unixã€Mac OS Xã€Windows ç­‰å¤šç§ç³»ç»Ÿç¯å¢ƒã€‚ Ansibleç®€å•æ˜“ç”¨ï¼Œåªéœ€è¦åœ¨æ§åˆ¶ä¸»æœºä¸Šå®‰è£… Ansible å¹¶åœ¨è¢«ç®¡ç†ä¸»æœºä¸Šå®‰è£… Python 2.6 æˆ–æ›´é«˜ç‰ˆæœ¬å³å¯ï¼ˆç°æœ‰çš„å¼€æºLinuxç³»ç»ŸåŸºæœ¬éƒ½è‡ªå¸¦äº†Python ï¼Œæ‰€ä»¥ç›¸å½“äºè¿œç¨‹ä¸»æœºä»€ä¹ˆéƒ½ä¸éœ€è¦å®‰è£…ï¼‰ï¼Œå°±å¯ä»¥ç®¡ç†è¿œç¨‹ä¸»æœºå¯¹å…¶è¿›è¡Œè‡ªåŠ¨åŒ–é…ç½®ã€ç¼–æ’é«˜çº§å·¥ä½œæµç¨‹ä»¥æ”¯æŒåº”ç”¨ç¨‹åºéƒ¨ç½²ã€ç³»ç»Ÿæ›´æ–°ç­‰ã€‚ Ansibleå¯ä»¥ç”¨æ¥ç®¡ç†Linuxã€Unixã€Windowsã€OpenStackã€AWSã€GCPã€OpenShiftã€Kubernetesç­‰ç³»ç»Ÿç¯å¢ƒã€‚ Ansibleå®˜ç½‘æ–‡æ¡£ï¼šhttps://docs.ansible.com/ansible/latest/ Ansibleä¸­æ–‡æƒå¨æŒ‡å—ï¼šhttps://ansible-tran.readthedocs.io/en/latest/index.html Ansibleå®‰è£… Ansibleå®‰è£…æ–¹å¼æœ‰å¤šç§ï¼Œè¿™é‡Œä»‹ç»é€šè¿‡pipå®‰è£…ï¼Œå½“å‰ç³»ç»Ÿä¸­çš„pythonç‰ˆæœ¬ä¸ºpython3.9ã€‚ 1python3 -m pip install ansible å¦‚æœå°šæœªå®‰è£…pipï¼Œå¯ä»¥é€šè¿‡ä¸‹é¢çš„æ–¹æ³•è¿›è¡Œå®‰è£… 12wget https://bootstrap.pypa.io/get-pip.pypython3 get-pip.py å®‰è£…å®Œæˆåï¼Œå¯ä»¥æŸ¥çœ‹ä¸€ä¸‹ç‰ˆæœ¬ 12345678910ansible --versionansible [core 2.15.9] config file = None configured module search path = [&#x27;/root/.ansible/plugins/modules&#x27;, &#x27;/usr/share/ansible/plugins/modules&#x27;] ansible python module location = /usr/local/lib/python3.9/site-packages/ansible ansible collection location = /root/.ansible/collections:/usr/share/ansible/collections executable location = /usr/local/bin/ansible python version = 3.9.16 (main, Sep 8 2023, 00:00:00) [GCC 11.4.1 20230605 (Red Hat 11.4.1-2)] (/usr/bin/python3) jinja version = 3.1.3 libyaml = True Ansibleå¸¸ç”¨å‚æ•°ï¼š å‚æ•° è¯´æ˜ -u æŒ‡å®šè¿æ¥åˆ°ä¸»æœºçš„ç”¨æˆ·å -i æŒ‡å®šè¿æ¥hostsæ–‡ä»¶çš„è·¯å¾„ -k æŒ‡å®šè¿æ¥åˆ°ä¸»æœºçš„å¯†ç  -m æŒ‡å®šæ¨¡å—åç§°ï¼Œå¯ä»¥æŒ‡å®šæ¨¡å—çš„å‚æ•°ï¼Œæ¯”å¦‚æŒ‡å®šshellæ¨¡å—çš„å‚æ•°ï¼š-m shell -a â€˜ls -lâ€™ -a æŒ‡å®šæ¨¡å—çš„å‚æ•°ï¼Œæ¯”å¦‚æŒ‡å®šshellæ¨¡å—çš„å‚æ•°ï¼š-m shell -a â€˜ls -lâ€™ -e æŒ‡å®šé™„åŠ å‚æ•°ï¼Œæ¯”å¦‚æŒ‡å®šshellç«¯å£ï¼š -e â€˜ansible_port=22â€™ -b åˆ‡æ¢åˆ°rootæƒé™ -f æŒ‡å®šå¹¶å‘è¿æ¥æ•°ï¼Œé»˜è®¤ä¸º5ï¼Œå³å¯ä»¥åŒæ—¶ç®¡ç†5å°ä¸»æœº Ansibleçš„é…ç½®æ–‡ä»¶ ansibleçš„ç›¸å…³é…ç½®éƒ½æ˜¯é€šè¿‡ä¸€ä¸ªåä¸ºansible.cfgçš„é…ç½®æ–‡ä»¶è¿›è¡Œé…ç½®çš„ï¼Œä½†æˆ‘ä»¬é€šè¿‡pipå®‰è£…æ˜¯ä¸ä¼šé»˜è®¤åˆ›å»ºå®ƒçš„ï¼Œå®é™…ä¸Šä¸åˆ›å»ºè¿™ä¸ªé…ç½®æ–‡ä»¶ä¹Ÿä¸å½±å“ansibleçš„æ‰§è¡Œï¼Œå› ä¸ºå…¶ä¼šä½¿ç”¨ä¸€äº›é»˜è®¤çš„é…ç½®ï¼Œå¹¶ä¸”åœ¨å¤§å¤šæ•°åœºæ™¯ä¸‹é»˜è®¤çš„é…ç½®å°±èƒ½æ»¡è¶³éœ€æ±‚ã€‚ ansibleæŸ¥æ‰¾é…ç½®æ–‡ä»¶çš„é¡ºåºï¼Œä¼˜å…ˆçº§ç”±ä¸Šåˆ°ä¸‹é€æ¸é™ä½ 1234* ANSIBLE_CONFIG (ä¸€ä¸ªç¯å¢ƒå˜é‡)* ansible.cfg (ä½äºå½“å‰ç›®å½•ä¸­)* .ansible.cfg (ä½äºå®¶ç›®å½•ä¸­)* /etc/ansible/ansible.cfg å¦‚æœéœ€è¦ä¿®æ”¹é»˜è®¤é…ç½®ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤åˆ›å»ºä¸€ä»½é…ç½®æ–‡ä»¶ 1234567891011# æ­¤æ—¶ä¼šåˆ›å»ºä¸€ä»½æ‰€æœ‰é…ç½®é¡¹éƒ½ä»¥ ; å¼€å¤´çš„é…ç½®æ–‡ä»¶ï¼Œæˆ‘ä»¬è¦ä¿®æ”¹é‚£ä¸ªé…ç½®ï¼Œå°±åˆ é™¤å…¶å‰é¢çš„ ; ï¼Œç„¶åä¿®æ”¹å…¶å€¼å³å¯ansible-config init --disabled &gt; ansible.cfg# æŸ¥çœ‹å½“å‰çš„ç”Ÿæ•ˆé…ç½®ï¼Œæ³¨æ„ç»¿è‰²ä¸ºé»˜è®¤é…ç½®ï¼Œé»„è‰²ä¸ºè¢«ä¿®æ”¹çš„é…ç½®ansible-config dump# æŸ¥çœ‹å¸®åŠ©æ–‡ä»¶ansible-config list# æŸ¥çœ‹é»˜è®¤é…ç½®é¡¹çš„å€¼å’Œæ³¨é‡Šè¯´æ˜ansible-config init list å¸¸ç”¨é…ç½®è¯¦è§£ 12345678910111213141516171819202122# é€šç”¨é»˜è®¤é…ç½®æ®µï¼›[defaults]# è¢«æ§ç«¯IPæˆ–è€…DNSåˆ—è¡¨ï¼›inventory=/etc/ansible/hosts# Ansibleé»˜è®¤æœå¯»æ¨¡å—çš„ä½ç½®ï¼›library=&#123;&#123; ANSIBLE_HOME ~ &quot;/plugins/modules:/usr/share/ansible/plugins/modules&quot; &#125;&#125;# å¹¶è¡Œè¿›ç¨‹æ•°ï¼›forks=5# æ˜¯å¦å…è®¸åˆ‡æ¢ä¸ºå…¶å®ƒç”¨æˆ·become=False# become=Trueæ—¶ï¼Œé€šè¿‡sudoè¿›è¡Œåˆ‡æ¢become_method=sudo# åˆ‡æ¢ä¸ºrootbecome_user=root# æœç´¢rolesçš„è·¯å¾„roles_path=&#123;&#123; ANSIBLE_HOME ~ &quot;/roles:/usr/share/ansible/roles:/etc/ansible/roles&quot; &#125;&#125;# æ—¥å¿—è·¯å¾„ï¼Œé»˜è®¤ä¸è¾“å‡ºlog_path=# Ansibleå‘½ä»¤æ‰§è¡Œé»˜è®¤çš„æ¨¡å—ï¼›module_name=command# æ˜¯å¦æ£€æŸ¥è¿œç¨‹ä¸»æœºå¯†é’¥ï¼Œé»˜è®¤ä¸ºTrueï¼Œå¦‚æœå¸Œæœ›ä¸æ£€æŸ¥å¯ä»¥å°†å…¶è®¾ä¸ºFalseï¼Œå¯ä»¥åŠ å¿«è¿æ¥é€Ÿåº¦host_key_checking=True Ansibleçš„hostsé…ç½® éœ€è¦åˆ›å»ºhostsæ–‡ä»¶ï¼Œä½¿ç”¨ansibleæ—¶ï¼Œansibleä¼šåˆ°hostsæ–‡ä»¶ä¸­æŸ¥æ‰¾å¯¹åº”çš„è¿œç¨‹ä¸»æœºé…ç½®ï¼Œé»˜è®¤çš„æŸ¥æ‰¾è·¯å¾„ä¸º/etc/ansible/hostsï¼Œä¹Ÿå¯ä»¥é€šè¿‡ansible.cfgä¿®æ”¹é»˜è®¤é…ç½® hostsæ–‡ä»¶æ ¼å¼1 hostsæ–‡ä»¶æ ¼å¼å¦‚ä¸‹ï¼š 1234567# å¯ä»¥é…ç½®ipæˆ–ä¸»æœºå[webservers] # åˆ†ç»„åç§°10.10.2.4510.10.2.46[dbservers]10.10.2.4710.10.2.48 å‘½ä»¤è¡Œé‡ŒåŠ ä¸Šè¿æ¥å‚æ•° 1234# æ‰§è¡Œå‘½ä»¤ï¼Œå¤šä¸ªipé€—å·åˆ†éš”ansible -u username -m ping --private-key=~/.ssh/id_rsa -e &#x27;ansible_port=22&#x27; 10.10.2.45,10.10.2.46# æŒ‡å®šhostsæ–‡ä»¶è·¯å¾„ansible -i hosts -u username -m ping --private-key=~/.ssh/id_rsa -e &#x27;ansible_port=22&#x27; 10.10.2.45,10.10.2.46 hostsæ–‡ä»¶æ ¼å¼2 hostsæ–‡ä»¶é‡Œä¹Ÿå¯ä»¥é…ç½®è¿æ¥å‚æ•° 123[webservers]10.10.2.45 ansible_ssh_user=username ansible_ssh_private_key=~/.ssh/id_rsa ansible_ssh_port=2210.10.2.46 ansible_ssh_user=username ansible_ssh_private_key=~/.ssh/id_rsa ansible_ssh_port=22 æ­¤æ—¶å‘½ä»¤è¡Œè¿æ¥æ—¶å°±ä¸éœ€è¦æŒ‡å®šè¿æ¥å‚æ•°äº† 1ansible -i hosts -u username -m ping 10.10.2.45,10.10.2.46 hostsæ–‡ä»¶æ ¼å¼3 ansibleæ˜¯åŸºäºsshå»ºç«‹è¿æ¥çš„ï¼Œæ‰€ä»¥åªè¦sshèƒ½è¿ä¸Šè¿œç¨‹ä¸»æœºï¼Œansibleå°±å¯ä»¥ç®¡ç†è¿œç¨‹ä¸»æœºï¼Œå¦‚æœæˆ‘ä»¬ä¸ºsshé…ç½®configæ–‡ä»¶ï¼Œé‚£ä¹ˆansibleå°±å¯ä»¥ç›´æ¥å°†configé‡Œçš„Hoståç§°é…ç½®åˆ°hostsæ–‡ä»¶é‡Œï¼Œè¿™æ ·å°±ä¸éœ€è¦é…ç½®è¿æ¥å‚æ•°äº†ï¼ŒåŒæ—¶æ­¤æ—¶ä¹Ÿå¯ä»¥æ”¯æŒè·³æ¿æœºã€‚å…³äºsshçš„configè¯¦ç»†è¯´æ˜å¯ä»¥å‚è€ƒLinuxå¸¸ç”¨å‘½ä»¤--sshã€scpä¸å…å¯†ç™»å½• é…ç½®~/.ssh/config 123456789101112131415161718192021# è·³æ¿æœºHost forward User ec2-user HostName 53.22.227.200 Port 22 IdentityFile ~/.ssh/id_rsa# è¿œç¨‹ä¸»æœºHost remote-host User ec2-user HostName 10.9.5.123 Port 22 IdentityFile ~/.ssh/key.pem ProxyCommand ssh forward -W %h:%p# è¿œç¨‹ä¸»æœº ,10.9ç½‘æ®µçš„æ‰€æœ‰ä¸»æœºHost 10.9.* User ec2-user Port 22 IdentityFile ~/.ssh/key.pem ProxyCommand ssh forward -W %h:%p hostsæ–‡ä»¶ 12345[webservers]forward # ä¸configä¸­é…ç½®çš„Hoståç§°ä¸€è‡´remote-host # ä¸configä¸­é…ç½®çš„Hoståç§°ä¸€è‡´10.9.5.123 # åŒ¹é…configä¸­çš„ç½‘æ®µ10.9.5.124 # åŒ¹é…configä¸­çš„ç½‘æ®µ å‘½ä»¤è¡Œ 12345678910111213# é€šè¿‡æŒ‡å®šä¸»æœºåæˆ–ipansible -m ping remote-hostansible -m ping 10.9.5.123# é€šé…ç¬¦åŒ¹é…ï¼Œæ­¤æ—¶åœ¨åŒ¹é…hostsä¸­123å’Œ124ansible -m ping &quot;10.9.5.*&quot;# é€šè¿‡åˆ†ç»„åansible -m ping webservers# é€šè¿‡allæŒ‡å®šhostsé‡Œçš„å…¨éƒ¨ä¸»æœºansible -m ping all æŸ¥çœ‹hostsé…ç½®ç›¸å…³å‘½ä»¤ åˆ—å‡ºæ‰€æœ‰ç»„çš„é…ç½®ipä¿¡æ¯ 1ansible all --list-hosts æŸ¥çœ‹å½“å‰hostsä¸­é…ç½®æ‰€æœ‰ç»„åç§° 1ansible localhost -m debug -a &#x27;var=groups.keys()&#x27; åˆ—å‡ºæŒ‡å®šç»„çš„é…ç½®ipä¿¡æ¯ 1ansible dbservers --list-hosts Ansibleæ¨¡å— åˆ—å‡ºæ‰€æœ‰æ¨¡å— 123ansible-doc -l# ä¹Ÿå¯ä»¥æŒ‡å®šæ¨¡å—åç§°ansible-doc -l | grep -i shell æŸ¥çœ‹æŒ‡å®šæ¨¡å—çš„å‚æ•°ä¿¡æ¯ï¼Œå¦‚ä¸‹æŸ¥çœ‹shellæ¨¡å—çš„å‚æ•°è¯´æ˜ 1ansible-doc -s shell æŸ¥çœ‹æ¨¡å—çš„å¸®åŠ©ä¿¡æ¯ï¼Œå¦‚ä¸‹æŸ¥çœ‹shellæ¨¡å—çš„å¸®åŠ©ä¿¡æ¯ï¼Œè¿™ä¸å®˜æ–¹æ–‡æ¡£ä¸€è‡´:shellæ¨¡å— 1ansible-doc shell Ansibleç®¡ç†å·¥å…·å¸¸ç”¨çš„æ¨¡å—ï¼šcommandã€shellã€fileã€userã€copyã€serviceã€yumã€synchronzeã€cronã€setupã€pingç­‰ã€‚å¯ä»¥åœ¨å‘½ä»¤è¡Œé‡ŒæŒ‡å®šå„ä¸ªæ¨¡å—çš„å‚æ•°(ansibleå‘½ä»¤)ï¼Œä¹Ÿå¯ä»¥å°†å‚æ•°é…ç½®åˆ°ymlæ–‡ä»¶é‡Œï¼Œç„¶ååœ¨å‘½ä»¤è¡Œé‡ŒæŒ‡å®šymlæ–‡ä»¶(ansible-playbookå‘½ä»¤)ï¼Œä¸‹é¢ä¼šç»“åˆä¸¤ç§æ–¹å¼ä¸€å—ä»‹ç»ã€‚ç½‘ä¸Šæœ‰å¤§æŠŠçš„å…³äºansibleå‘½ä»¤çš„ä½¿ç”¨è¯´æ˜ï¼Œè¿™é‡Œåªç®€å•ä»‹ç»å‡ ä¸ªæ¨¡å—çš„ä½¿ç”¨æ–¹æ³•ï¼Œå…¶ä»–æ¨¡å—çš„ä½¿ç”¨æ–¹æ³•å¯ä»¥å‚è€ƒansibleæ¨¡å— ä¸‹é¢ä»‹ç»çš„éƒ½æ˜¯ansibleæ ¸å¿ƒæ¨¡å—:ansible-core debugæ¨¡å— debugæ¨¡å—æ­¤æ¨¡å—åœ¨æ‰§è¡ŒæœŸé—´æ‰“å°è¯­å¥ï¼Œå¯ç”¨äºè°ƒè¯•å˜é‡æˆ–è¡¨è¾¾å¼ é€šè¿‡å‘½ä»¤è¡Œæ‰§è¡Œå‘½ä»¤ 1ansible webservers -m debug -a &#x27;msg=&quot;System HostName: &#123;&#123; inventory_hostname &#125;&#125;&quot;&#x27; é€šè¿‡ymlæ–‡ä»¶æ‰§è¡Œå‘½ä»¤ 12345678# debug.yml--- # ymlæ–‡ä»¶çš„å¼€å¤´ï¼Œè§„å®šplaybookçš„ymlæ–‡ä»¶æ ¼å¼ï¼Œå¿…é¡»ä»¥---å¼€å¤´(å¿…é¡»)ï¼Œ...ç»“å°¾(éå¿…é¡»)- name: Debug hosts: webservers tasks: - name: Debug debug: msg: &quot;System HostName: &#123;&#123; inventory_hostname &#125;&#125;&quot; å¸¸ç”¨å‚æ•°è¯´æ˜ï¼šansible-doc -s debug å‚æ•° æè¿° msg æ‰“å°æ¶ˆæ¯ï¼Œæ”¯æŒå˜é‡ var æ‰“å°æ¶ˆæ¯ï¼Œæ”¯æŒå˜é‡ï¼Œæ³¨å†Œå˜é‡ , ä¸msgäº’æ–¥ pingæ¨¡å— pingæ¨¡å—ç”¨äºæµ‹è¯•ä¸»æœºçš„è¿é€šæ€§ï¼Œå®ƒä¼šå°è¯•è¿æ¥åˆ°ä¸»æœºï¼ŒéªŒè¯å¯ç”¨çš„pythonï¼Œå¹¶åœ¨æˆåŠŸæ—¶è¿”å›â€œpongâ€ï¼Œå¯ä»¥æŒ‡å®šä¸»æœºåæˆ–ipï¼Œä¹Ÿå¯ä»¥æŒ‡å®šåˆ†ç»„åï¼Œä¹Ÿå¯ä»¥æŒ‡å®šall é€šè¿‡å‘½ä»¤è¡Œæ‰§è¡Œå‘½ä»¤ 1ansible webservers -m ping é€šè¿‡ymlæ–‡ä»¶æ‰§è¡Œå‘½ä»¤ 123456789101112# ping.yml--- # ymlæ–‡ä»¶çš„å¼€å¤´ï¼Œè§„å®šplaybookçš„ymlæ–‡ä»¶æ ¼å¼ï¼Œå¿…é¡»ä»¥---å¼€å¤´(å¿…é¡»)ï¼Œ...ç»“å°¾(éå¿…é¡»)- name: Ping web servers hosts: webservers # ipæˆ–ç»„åï¼Œä¹Ÿå¯ä»¥é…ç½®allï¼šåŒ¹é…å…¨éƒ¨ä¸»æœº tasks: - name: Ping the servers ping: register: command_output - name: æ˜¾ç¤ºå‘½ä»¤è¾“å‡º debug: var: command_output.stdout_lines # æ³¨å†Œå˜é‡è¾“å‡ºè¦ä½¿ç”¨ var ansible-playbook é€šè¿‡ansible-playbookå‘½ä»¤ï¼Œå¯ä»¥æŒ‡å®šymlæ–‡ä»¶ ansible-playbookç›¸å…³å‘½ä»¤ 123456789101112131415# æ£€æŸ¥ymlæ–‡ä»¶è¯­æ³•æ ¼å¼ansible-playbook --syntax-check ping.yml# åˆ—å‡ºhostsansible-playbook --list-hosts ping.yml# åˆ—å‡ºtagsansible-playbook --list-tags ping.yml# åˆ—å‡ºtaskansible-playbook --list-tasks ping.yml# æŒ‡å®šæ‰§è¡Œä¸»æœºï¼š--limit æˆ– -lï¼Œå…¶å¿…é¡»æ˜¯ymlä¸­hostsæŒ‡å®šçš„å­é›†ansible-playbook ping.yml --limit 192.168.20.23# æ‰§è¡Œå‘½ä»¤ansible-playbook ping.yml# æ¨¡æ‹Ÿæ‰§è¡Œï¼ŒAnsible ä¼šæ¨¡æ‹Ÿæ‰§è¡Œä»»åŠ¡ï¼Œå¹¶è¾“å‡ºæ‰§è¡Œç»“æœï¼Œä½†ä¸ä¼šå¯¹ç›®æ ‡ä¸»æœºåšå‡ºä»»ä½•æ›´æ”¹# æ³¨æ„è¿™ä¸ªå‘½ä»¤è¿è¡Œä¸æŠ¥é”™å¹¶ä¸èƒ½è¯´æ˜ä¸€å®šå¯ä»¥æ‰§è¡ŒæˆåŠŸï¼Œå› ä¸ºè¿™ä¸ªå‘½ä»¤æ˜¯æ¨¡æ‹Ÿæ‰§è¡Œçš„ansible-playbook ping.yml --check setupæ¨¡å— è¯¥æ¨¡å—ç”¨äºé‡‡é›†è¢«ç®¡ç†è®¾å¤‡ä¿¡æ¯å¹¶è¿”å›ç»™æœåŠ¡ç«¯ï¼Œåé¢è·Ÿ--tree &lt;ç›®å½•&gt;ï¼Œå¯ä»¥å°†é‡‡é›†ä¿¡æ¯ä»¥ipä¸ºæ–‡ä»¶åä¿å­˜è‡³æŒ‡å®šç›®å½•ä¸‹ 1234567891011# æŸ¥çœ‹å…¨éƒ¨ä¿¡æ¯ansible all -m setup# åªæŸ¥çœ‹å†…å­˜ä¿¡æ¯ansible all -m setup -a &quot;filter=*mem*&quot;# åªæŸ¥çœ‹ç½‘ç»œä¿¡æ¯ansible all -m setup -a &quot;gather_subset=network&quot;# ä¿å­˜ä¿¡æ¯è‡³æŒ‡å®šç›®å½•ï¼Œè¿™æ ·ä¼šæ¯ä¸ªipå¯¹åº”ä¸€ä¸ªæ–‡ä»¶ansible all -m setup --tree ./ å¸¸ç”¨å‚æ•°è¯´æ˜ï¼šansible-doc -s setup å‚æ•° æè¿° gather_subset æŒ‡å®šè¦æ”¶é›†çš„ç³»ç»Ÿä¿¡æ¯çš„å­é›†ã€‚å¯ä»¥æ˜¯ allï¼ˆæ‰€æœ‰ä¿¡æ¯ï¼‰ã€networkï¼ˆç½‘ç»œä¿¡æ¯ï¼‰ã€hardwareï¼ˆç¡¬ä»¶ä¿¡æ¯ï¼‰ç­‰ã€‚é»˜è®¤ä¸º allã€‚ gather_timeout è®¾ç½®ä¿¡æ¯æ”¶é›†çš„è¶…æ—¶æ—¶é—´ï¼Œå•ä½ä¸ºç§’ã€‚é»˜è®¤ä¸º 10 ç§’ã€‚ filter æŒ‡å®šè¦æ”¶é›†çš„ç³»ç»Ÿä¿¡æ¯çš„è¿‡æ»¤æ¡ä»¶ã€‚å¯ä»¥æ˜¯ä¸€ä¸ªæˆ–å¤šä¸ªæ ‡ç­¾ï¼Œåªæ”¶é›†åŒ¹é…çš„ä¿¡æ¯ã€‚ fact_path æŒ‡å®šè‡ªå®šä¹‰ facts æ–‡ä»¶çš„è·¯å¾„ã€‚ è¿™é‡Œé‡ç‚¹ä»‹ç»ä¸€ä¸‹gather_subset 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364all: æ”¶é›†æ‰€æœ‰å¯ç”¨çš„ç³»ç»Ÿä¿¡æ¯ã€‚all_ipv4_addresses: æ”¶é›†æ‰€æœ‰ IPv4 åœ°å€ä¿¡æ¯ã€‚all_ipv6_addresses: æ”¶é›†æ‰€æœ‰ IPv6 åœ°å€ä¿¡æ¯ã€‚apparmor: æ”¶é›† AppArmor ç›¸å…³ä¿¡æ¯ã€‚architecture: æ”¶é›†ç³»ç»Ÿæ¶æ„ä¿¡æ¯ã€‚caps: æ”¶é›†è¿›ç¨‹çš„ capabilities ä¿¡æ¯ã€‚chroot: æ”¶é›† chroot ç¯å¢ƒçš„ä¿¡æ¯ã€‚cmdline: æ”¶é›†å†…æ ¸å‘½ä»¤è¡Œå‚æ•°ä¿¡æ¯ã€‚date_time: æ”¶é›†æ—¥æœŸå’Œæ—¶é—´ä¿¡æ¯ã€‚default_ipv4: æ”¶é›†é»˜è®¤çš„ IPv4 åœ°å€ä¿¡æ¯ã€‚default_ipv6: æ”¶é›†é»˜è®¤çš„ IPv6 åœ°å€ä¿¡æ¯ã€‚devices: æ”¶é›†ç³»ç»Ÿè®¾å¤‡ä¿¡æ¯ã€‚distribution: æ”¶é›†å‘è¡Œç‰ˆä¿¡æ¯ã€‚distribution_major_version: æ”¶é›†å‘è¡Œç‰ˆä¸»ç‰ˆæœ¬å·ã€‚distribution_release: æ”¶é›†å‘è¡Œç‰ˆå‘è¡Œå·ã€‚distribution_version: æ”¶é›†å‘è¡Œç‰ˆç‰ˆæœ¬ä¿¡æ¯ã€‚dns: æ”¶é›† DNS é…ç½®ä¿¡æ¯ã€‚effective_group_ids: æ”¶é›†æœ‰æ•ˆç»„ ID ä¿¡æ¯ã€‚effective_user_id: æ”¶é›†æœ‰æ•ˆç”¨æˆ· ID ä¿¡æ¯ã€‚env: æ”¶é›†ç¯å¢ƒå˜é‡ä¿¡æ¯ã€‚facter: æ”¶é›† Facter ä¿¡æ¯ã€‚fips: æ”¶é›† FIPS ç›¸å…³ä¿¡æ¯ã€‚hardware: æ”¶é›†ç¡¬ä»¶ä¿¡æ¯ã€‚interfaces: æ”¶é›†ç½‘ç»œæ¥å£ä¿¡æ¯ã€‚is_chroot: æ”¶é›†æ˜¯å¦å¤„äº chroot ç¯å¢ƒçš„ä¿¡æ¯ã€‚iscsi: æ”¶é›† iSCSI é…ç½®ä¿¡æ¯ã€‚kernel: æ”¶é›†å†…æ ¸ä¿¡æ¯ã€‚local: æ”¶é›†æœ¬åœ°é…ç½®ä¿¡æ¯ã€‚lsb: æ”¶é›† LSB å‘è¡Œç‰ˆä¿¡æ¯ã€‚machine: æ”¶é›†æœºå™¨ä¿¡æ¯ã€‚machine_id: æ”¶é›†æœºå™¨ ID ä¿¡æ¯ã€‚mounts: æ”¶é›†æŒ‚è½½ç‚¹ä¿¡æ¯ã€‚network: æ”¶é›†ç½‘ç»œç›¸å…³ä¿¡æ¯ã€‚ohai: æ”¶é›† Ohai ä¿¡æ¯ã€‚os_family: æ”¶é›†æ“ä½œç³»ç»Ÿå®¶æ—ä¿¡æ¯ã€‚pkg_mgr: æ”¶é›†åŒ…ç®¡ç†å™¨ä¿¡æ¯ã€‚platform: æ”¶é›†å¹³å°ä¿¡æ¯ã€‚processor: æ”¶é›†å¤„ç†å™¨ä¿¡æ¯ã€‚processor_cores: æ”¶é›†å¤„ç†å™¨æ ¸å¿ƒæ•°ä¿¡æ¯ã€‚processor_count: æ”¶é›†å¤„ç†å™¨æ•°é‡ä¿¡æ¯ã€‚python: æ”¶é›† Python ç›¸å…³ä¿¡æ¯ã€‚python_version: æ”¶é›† Python ç‰ˆæœ¬ä¿¡æ¯ã€‚real_user_id: æ”¶é›†çœŸå®ç”¨æˆ· ID ä¿¡æ¯ã€‚selinux: æ”¶é›† SELinux é…ç½®ä¿¡æ¯ã€‚service_mgr: æ”¶é›†æœåŠ¡ç®¡ç†å™¨ä¿¡æ¯ã€‚ssh_host_key_dsa_public: æ”¶é›† SSH DSA å…¬é’¥ä¿¡æ¯ã€‚ssh_host_key_ecdsa_public: æ”¶é›† SSH ECDSA å…¬é’¥ä¿¡æ¯ã€‚ssh_host_key_ed25519_public: æ”¶é›† SSH ED25519 å…¬é’¥ä¿¡æ¯ã€‚ssh_host_key_rsa_public: æ”¶é›† SSH RSA å…¬é’¥ä¿¡æ¯ã€‚ssh_host_pub_keys: æ”¶é›† SSH ä¸»æœºå…¬é’¥ä¿¡æ¯ã€‚ssh_pub_keys: æ”¶é›† SSH ç”¨æˆ·å…¬é’¥ä¿¡æ¯ã€‚system: æ”¶é›†ç³»ç»Ÿç›¸å…³ä¿¡æ¯ã€‚system_capabilities: æ”¶é›†ç³»ç»Ÿèƒ½åŠ›ä¿¡æ¯ã€‚system_capabilities_enforced: æ”¶é›†ç³»ç»Ÿèƒ½åŠ›å¼ºåˆ¶ä¿¡æ¯ã€‚user: æ”¶é›†ç”¨æˆ·è´¦æˆ·ä¿¡æ¯ã€‚user_dir: æ”¶é›†ç”¨æˆ·ç›®å½•ä¿¡æ¯ã€‚user_gecos: æ”¶é›†ç”¨æˆ· GECOS ä¿¡æ¯ã€‚user_gid: æ”¶é›†ç”¨æˆ·ç»„ ID ä¿¡æ¯ã€‚user_id: æ”¶é›†ç”¨æˆ· ID ä¿¡æ¯ã€‚user_shell: æ”¶é›†ç”¨æˆ· Shell ä¿¡æ¯ã€‚user_uid: æ”¶é›†ç”¨æˆ· UID ä¿¡æ¯ã€‚virtual: æ”¶é›†è™šæ‹ŸåŒ–ç›¸å…³ä¿¡æ¯ã€‚virtualization_role: æ”¶é›†è™šæ‹ŸåŒ–è§’è‰²ä¿¡æ¯ã€‚virtualization_type: æ”¶é›†è™šæ‹ŸåŒ–ç±»å‹ä¿¡æ¯ã€‚ commandæ¨¡å— commandæ¨¡å—ä¸ºansibleé»˜è®¤æ¨¡å—ï¼Œä¸»è¦ç”¨äºæ‰§è¡ŒLinuxåŸºç¡€å‘½ä»¤ï¼Œå¯ä»¥æ‰§è¡Œè¿œç¨‹æœåŠ¡å™¨å‘½ä»¤æ‰§è¡Œã€ä»»åŠ¡æ‰§è¡Œç­‰æ“ä½œã€‚ commandæ¨¡å—ä¸æ”¯æŒç®¡é“ç¬¦å·ã€å˜é‡ï¼Œåªèƒ½è¿è¡Œç®€å•å‘½ä»¤ï¼Œå¤æ‚å‘½ä»¤éœ€è¦ä½¿ç”¨shellæ¨¡å— ç¤ºä¾‹1 1ansible webservers -m command -a &quot;df -hT&quot; 12345678910111213# command.yml---- name: åœ¨ web æœåŠ¡å™¨ä¸Šè¿è¡Œ df -hT å‘½ä»¤ hosts: webservers tasks: - name: æ‰§è¡Œ df -hT å‘½ä»¤ command: cmd: &quot;df -hT&quot; register: command_output # ä¿å­˜å‘½ä»¤æ‰§è¡Œç»“æœ - name: æ˜¾ç¤ºå‘½ä»¤è¾“å‡º debug: var: command_output.stdout_lines # è¾“å‡ºå‘½ä»¤æ‰§è¡Œç»“æœ ç¤ºä¾‹2ï¼šå‚æ•°chdirï¼šåˆ‡æ¢åˆ°æŒ‡å®šç›®å½•åå†è¿è¡Œå‘½ä»¤ å¯ä»¥é€šè¿‡ansible-doc -s commandæŸ¥çœ‹å…¶æ”¯æŒçš„å‚æ•° 1ansible webservers -m command -a &quot;chdir=/tmp ls -l&quot; 1234567891011121314# command2.yml---- name: åœ¨ web æœåŠ¡å™¨ä¸Šåˆ—å‡º /tmp ç›®å½•çš„å†…å®¹ hosts: webservers tasks: - name: åˆ‡æ¢åˆ° /tmp ç›®å½•å¹¶åˆ—å‡ºå†…å®¹ command: chdir: /tmp # åˆ‡æ¢åˆ° /tmp ç›®å½• cmd: ls -l # æ‰§è¡Œå‘½ä»¤ register: command_output # ä¿å­˜å‘½ä»¤æ‰§è¡Œç»“æœ - name: æ˜¾ç¤ºå‘½ä»¤è¾“å‡º debug: var: command_output.stdout_lines # è¾“å‡ºå‘½ä»¤æ‰§è¡Œç»“æœ å¸¸ç”¨å‚æ•°è¯´æ˜ï¼šansible-doc -s command å‚æ•° æè¿° argv è¦æ‰§è¡Œçš„å‘½ä»¤ï¼Œå¯ä»¥æ˜¯å­—ç¬¦ä¸²å½¢å¼æˆ–åˆ—è¡¨å½¢å¼ã€‚ chdir åœ¨æ‰§è¡Œå‘½ä»¤ä¹‹å‰åˆ‡æ¢åˆ°çš„ç›®å½•ã€‚ cmd è¦æ‰§è¡Œçš„å‘½ä»¤ã€‚ creates æŒ‡å®šä¸€ä¸ªæ–‡ä»¶åæˆ–æ¨¡å¼ï¼Œå¦‚æœåŒ¹é…çš„æ–‡ä»¶å·²ç»å­˜åœ¨ï¼Œåˆ™ä¸æ‰§è¡Œå‘½ä»¤ã€‚ expand_argument_vars æ˜¯å¦å±•å¼€ä½œä¸ºå˜é‡çš„å‚æ•°ã€‚é»˜è®¤ä¸º trueï¼Œè¡¨ç¤ºå±•å¼€å˜é‡ã€‚ free_form ä»¥å­—ç¬¦ä¸²å½¢å¼æŒ‡å®šè¦æ‰§è¡Œçš„å‘½ä»¤ã€‚è¿™ä¸ªå‚æ•°å¹¶ä¸å­˜åœ¨ï¼Œä½†æ˜¯ command æ¨¡å—æ¥å—è‡ªç”±å½¢å¼çš„å­—ç¬¦ä¸²ä½œä¸ºå‘½ä»¤ã€‚ removes æŒ‡å®šä¸€ä¸ªæ–‡ä»¶åæˆ–æ¨¡å¼ï¼Œå¦‚æœåŒ¹é…çš„æ–‡ä»¶å­˜åœ¨ï¼Œåˆ™æ‰§è¡Œå‘½ä»¤ã€‚ stdin å°†å‘½ä»¤çš„æ ‡å‡†è¾“å…¥è®¾ç½®ä¸ºæŒ‡å®šçš„å€¼ã€‚ stdin_add_newline æ˜¯å¦åœ¨æ ‡å‡†è¾“å…¥æ•°æ®åæ·»åŠ æ¢è¡Œç¬¦ã€‚ strip_empty_ends æ˜¯å¦ä»æ ‡å‡†è¾“å‡ºçš„æœ«å°¾å‰¥ç¦»ç©ºè¡Œã€‚ shellæ¨¡å— shellæ¨¡å—ä¸commandæ¨¡å—ç±»ä¼¼ï¼Œå¯ä»¥æ‰§è¡Œè¿œç¨‹æœåŠ¡å™¨å‘½ä»¤æ‰§è¡Œã€ä»»åŠ¡æ‰§è¡Œç­‰æ“ä½œï¼Œä½†æ˜¯shellæ¨¡å—æ”¯æŒç®¡é“ç¬¦å·ã€å˜é‡ï¼Œå¯ä»¥æ‰§è¡Œå¤æ‚å‘½ä»¤ ç¤ºä¾‹ï¼š 12345# æŸ¥çœ‹è¿›ç¨‹ansible webservers -m shell -a &quot;ps -ef | grep java | grep -v &#x27;grep&#x27;&quot;# ä¿®æ”¹å¯†ç ansible webservers -m shell -a &quot; echo 123456 | passwd --stdin ansible&quot; 12345678910111213# shell.yml---- name: åœ¨ web æœåŠ¡å™¨ä¸ŠæŸ¥æ‰¾ Java è¿›ç¨‹ hosts: webservers tasks: - name: æ‰§è¡Œ ps -ef | grep java | grep -v &#x27;grep&#x27; å‘½ä»¤ shell: cmd: ps -ef | grep java | grep -v &#x27;grep&#x27; register: command_output # ä¿å­˜å‘½ä»¤æ‰§è¡Œç»“æœ - name: æ˜¾ç¤ºå‘½ä»¤è¾“å‡º debug: var: command_output.stdout_lines # è¾“å‡ºå‘½ä»¤æ‰§è¡Œç»“æœ å¸¸ç”¨å‚æ•°è¯´æ˜ï¼šansible-doc -s shell å‚æ•° æè¿° argv è¦æ‰§è¡Œçš„å‘½ä»¤ï¼Œå¯ä»¥æ˜¯å­—ç¬¦ä¸²å½¢å¼æˆ–åˆ—è¡¨å½¢å¼ã€‚ chdir åœ¨æ‰§è¡Œå‘½ä»¤ä¹‹å‰åˆ‡æ¢åˆ°çš„ç›®å½•ã€‚ cmd è¦æ‰§è¡Œçš„å‘½ä»¤ã€‚ creates æŒ‡å®šä¸€ä¸ªæ–‡ä»¶åæˆ–æ¨¡å¼ï¼Œå¦‚æœåŒ¹é…çš„æ–‡ä»¶å·²ç»å­˜åœ¨ï¼Œåˆ™ä¸æ‰§è¡Œå‘½ä»¤ã€‚ executable ç”¨äºæ‰§è¡Œå‘½ä»¤çš„å¯æ‰§è¡Œç¨‹åºï¼Œé»˜è®¤æƒ…å†µä¸‹ä¸º /bin/shã€‚ free_form ä»¥å­—ç¬¦ä¸²å½¢å¼æŒ‡å®šè¦æ‰§è¡Œçš„å‘½ä»¤ã€‚è¿™ä¸ªå‚æ•°å¹¶ä¸å­˜åœ¨ï¼Œä½†æ˜¯ shell æ¨¡å—æ¥å—è‡ªç”±å½¢å¼çš„å­—ç¬¦ä¸²ä½œä¸ºå‘½ä»¤ã€‚ removes æŒ‡å®šä¸€ä¸ªæ–‡ä»¶åæˆ–æ¨¡å¼ï¼Œå¦‚æœåŒ¹é…çš„æ–‡ä»¶å­˜åœ¨ï¼Œåˆ™æ‰§è¡Œå‘½ä»¤ã€‚ stdin å°†å‘½ä»¤çš„æ ‡å‡†è¾“å…¥è®¾ç½®ä¸ºæŒ‡å®šçš„å€¼ã€‚ stdin_add_newline æ˜¯å¦åœ¨æ ‡å‡†è¾“å…¥æ•°æ®åæ·»åŠ æ¢è¡Œç¬¦ã€‚ strip_empty_ends æ˜¯å¦ä»æ ‡å‡†è¾“å‡ºçš„æœ«å°¾å‰¥ç¦»ç©ºè¡Œã€‚ fileæ¨¡å— fileæ¨¡å—ä¸»è¦ç”¨äºæ–‡ä»¶å’Œç›®å½•çš„ç®¡ç†ï¼Œå¯ä»¥åˆ›å»ºã€åˆ é™¤ã€ä¿®æ”¹æ–‡ä»¶å’Œç›®å½•ï¼Œå¯ä»¥æŒ‡å®šæ–‡ä»¶æˆ–ç›®å½•çš„å±æ€§ï¼Œå¯ä»¥æŒ‡å®šæ–‡ä»¶æˆ–ç›®å½•çš„æƒé™ï¼Œå¯ä»¥æŒ‡å®šæ–‡ä»¶æˆ–ç›®å½•çš„ownerã€groupã€modeç­‰ä¿¡æ¯ï¼Œç­‰ç­‰ ç¤ºä¾‹ï¼šåˆ›å»ºç›®å½• 1ansible webservers -m file -a &quot;path=/tmp/`date +%F` state=directory mode=755&quot; 12345678910# file.yml---- name: åœ¨ web æœåŠ¡å™¨ä¸Šåˆ›å»ºæ—¥æœŸæ ¼å¼çš„ç›®å½• hosts: webservers tasks: - name: åˆ›å»ºç›®å½• file: path: &quot;/tmp/&#123;&#123; ansible_date_time.date &#125;&#125;&quot; # ansible_date_time.dateè¡¨ç¤ºå½“å‰æ—¶é—´è·å–çš„æ—¥æœŸï¼Œæ ¼å¼ä¸ºYYYY-MM-DD state: directory # åˆ›å»ºç›®å½•ï¼Œå¦‚æœç›®å½•å·²ç»å­˜åœ¨åˆ™ä¸åˆ›å»º mode: &quot;755&quot; # è®¾ç½®ç›®å½•æƒé™ å¸¸ç”¨å‚æ•°è¯´æ˜ï¼šansible-doc -s file å‚æ•° æè¿° path æ–‡ä»¶æˆ–ç›®å½•çš„è·¯å¾„ã€‚ state æ–‡ä»¶æˆ–ç›®å½•çš„çŠ¶æ€ã€‚å¯é€‰å€¼åŒ…æ‹¬ fileï¼ˆæ–‡ä»¶ï¼‰ã€directoryï¼ˆç›®å½•ï¼‰ã€linkï¼ˆç¬¦å·é“¾æ¥ï¼‰ã€‚é»˜è®¤ä¸º fileã€‚ owner æ–‡ä»¶æˆ–ç›®å½•çš„æ‰€æœ‰è€…ã€‚ group æ–‡ä»¶æˆ–ç›®å½•çš„æ‰€å±ç»„ã€‚ mode æ–‡ä»¶æˆ–ç›®å½•çš„æƒé™ã€‚ src æºæ–‡ä»¶è·¯å¾„ï¼Œç”¨äºå¤åˆ¶æ–‡ä»¶æˆ–åˆ›å»ºé“¾æ¥ã€‚ dest ç›®æ ‡æ–‡ä»¶è·¯å¾„ï¼Œç”¨äºå¤åˆ¶æ–‡ä»¶æˆ–åˆ›å»ºé“¾æ¥ã€‚ follow æ˜¯å¦éµå¾ªç¬¦å·é“¾æ¥ã€‚å¦‚æœä¸º yesï¼Œåˆ™ä¼šéµå¾ªç¬¦å·é“¾æ¥è¿›è¡Œæ“ä½œã€‚é»˜è®¤ä¸º yesã€‚ selevel æ–‡ä»¶æˆ–ç›®å½•çš„ SELinux å®‰å…¨ä¸Šä¸‹æ–‡ã€‚ serole æ–‡ä»¶æˆ–ç›®å½•çš„ SELinux è§’è‰²ã€‚ setype æ–‡ä»¶æˆ–ç›®å½•çš„ SELinux ç±»å‹ã€‚ seuser æ–‡ä»¶æˆ–ç›®å½•çš„ SELinux ç”¨æˆ·ã€‚ unsafe_writes æ˜¯å¦å¯ç”¨ä¸å®‰å…¨çš„å†™å…¥æ¨¡å¼ã€‚å¦‚æœä¸º yesï¼Œåˆ™åœ¨å†™å…¥æ–‡ä»¶ä¹‹å‰ä¸ä¼šåˆ›å»ºå¤‡ä»½ã€‚é»˜è®¤ä¸º noã€‚ è¿™é‡Œé‡ç‚¹è¯´ä¸€ä¸‹state 123456fileï¼šè¡¨ç¤ºè¦æ±‚ç›®æ ‡ä¸»æœºä¸Šå­˜åœ¨æŒ‡å®šçš„æ–‡ä»¶ã€‚å¦‚æœæ–‡ä»¶å·²ç»å­˜åœ¨ï¼Œåˆ™ä¸æ‰§è¡Œä»»ä½•æ“ä½œï¼›å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ™ä¼šåˆ›å»ºå®ƒã€‚directoryï¼šè¡¨ç¤ºè¦æ±‚ç›®æ ‡ä¸»æœºä¸Šå­˜åœ¨æŒ‡å®šçš„ç›®å½•ã€‚å¦‚æœç›®å½•å·²ç»å­˜åœ¨ï¼Œåˆ™ä¸æ‰§è¡Œä»»ä½•æ“ä½œï¼›å¦‚æœç›®å½•ä¸å­˜åœ¨ï¼Œåˆ™ä¼šåˆ›å»ºå®ƒã€‚linkï¼šè¡¨ç¤ºè¦æ±‚ç›®æ ‡ä¸»æœºä¸Šå­˜åœ¨æŒ‡å®šçš„ç¬¦å·é“¾æ¥ã€‚å¦‚æœç¬¦å·é“¾æ¥å·²ç»å­˜åœ¨ï¼Œåˆ™ä¸æ‰§è¡Œä»»ä½•æ“ä½œï¼›å¦‚æœç¬¦å·é“¾æ¥ä¸å­˜åœ¨ï¼Œåˆ™ä¼šåˆ›å»ºå®ƒã€‚hardï¼šåˆ›å»ºç¡¬é“¾æ¥touchï¼šå¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ™ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„æ–‡ä»¶ï¼Œå¦‚æœæ–‡ä»¶æˆ–ç›®å½•å·²å­˜åœ¨ï¼Œåˆ™æ›´æ–°å…¶æœ€åä¿®æ”¹æ—¶é—´absentï¼šåˆ é™¤ç›®å½•ã€æ–‡ä»¶æˆ–è€…å–æ¶ˆé“¾æ¥æ–‡ä»¶ copyæ¨¡å— copyæ¨¡å—ä¸»è¦ç”¨äºå°†æ–‡ä»¶å¤åˆ¶åˆ°è¿œç¨‹æœåŠ¡å™¨ï¼Œå¯ä»¥æŒ‡å®šæ–‡ä»¶çš„æºè·¯å¾„ã€ç›®æ ‡è·¯å¾„ã€ownerã€groupã€modeç­‰ä¿¡æ¯ï¼Œç­‰ç­‰ ç¤ºä¾‹ï¼šå¤åˆ¶æ–‡ä»¶åˆ°æŒ‡å®šç›®å½• 12# -b åˆ‡æ¢åˆ°rootç”¨æˆ·ä¸‹æ‰§è¡Œansible webservers -m copy -a &quot;src=/tmp/a.txt dest=/tmp/ owner=root group=root mode=755&quot; 12345678910111213# copy.yml---- name: åœ¨ web æœåŠ¡å™¨ä¸Šå¤åˆ¶æ–‡ä»¶ hosts: webservers become: yes # åˆ‡æ¢åˆ°rootç”¨æˆ·ä¸‹æ‰§è¡Œ tasks: - name: å¤åˆ¶æ–‡ä»¶ copy: src: &quot;/tmp/a.txt&quot; # æºæ–‡ä»¶è·¯å¾„ dest: &quot;/tmp/&quot; # ç›®æ ‡æ–‡ä»¶è·¯å¾„ owner: root # æŒ‡å®šæ–‡ä»¶owner group: root # æŒ‡å®šæ–‡ä»¶group mode: &quot;755&quot; # æŒ‡å®šæ–‡ä»¶æƒé™ å¸¸ç”¨å‚æ•°è¯´æ˜ï¼šansible-doc -s copy å‚æ•° æè¿° src æºæ–‡ä»¶çš„è·¯å¾„ã€‚ dest ç›®æ ‡æ–‡ä»¶çš„è·¯å¾„ã€‚ backup æ˜¯å¦å¤‡ä»½ç›®æ ‡æ–‡ä»¶ã€‚å¦‚æœä¸º yesï¼Œåˆ™åœ¨å¤åˆ¶ç›®æ ‡æ–‡ä»¶ä¹‹å‰ä¼šåˆ›å»ºä¸€ä¸ªå¤‡ä»½æ–‡ä»¶ã€‚é»˜è®¤ä¸º yesã€‚ content è¦å†™å…¥ç›®æ ‡æ–‡ä»¶çš„å†…å®¹ã€‚ directory_mode ç›®æ ‡ç›®å½•çš„æƒé™ã€‚åªæœ‰å½“ç›®æ ‡æ˜¯ä¸€ä¸ªç›®å½•æ—¶æ‰ä¼šç”Ÿæ•ˆã€‚ follow æ˜¯å¦è·Ÿéšç¬¦å·é“¾æ¥ã€‚å¦‚æœä¸º yesï¼Œåˆ™ä¼šè·Ÿéšç¬¦å·é“¾æ¥è¿›è¡Œæ“ä½œã€‚é»˜è®¤ä¸º yesã€‚ force æ˜¯å¦å¼ºåˆ¶è¦†ç›–ç›®æ ‡æ–‡ä»¶ã€‚å¦‚æœä¸º yesï¼Œåˆ™å¼ºåˆ¶å¤åˆ¶æºæ–‡ä»¶ï¼Œå³ä½¿ç›®æ ‡æ–‡ä»¶å·²ç»å­˜åœ¨ã€‚é»˜è®¤ä¸º noã€‚ group ç›®æ ‡æ–‡ä»¶çš„æ‰€å±ç»„ã€‚ mode ç›®æ ‡æ–‡ä»¶çš„æƒé™ã€‚ owner ç›®æ ‡æ–‡ä»¶çš„æ‰€æœ‰è€…ã€‚ remote_src æŒ‡å®šæºæ–‡ä»¶æ˜¯å¦åœ¨è¿œç¨‹ä¸»æœºä¸Šã€‚å¦‚æœä¸º yesï¼Œè¡¨ç¤ºæºæ–‡ä»¶åœ¨è¿œç¨‹ä¸»æœºä¸Šã€‚é»˜è®¤ä¸º noã€‚ fetchæ¨¡å— fetchæ¨¡å—ä¸»è¦ç”¨äºå°†æ–‡ä»¶ä»è¿œç¨‹æœåŠ¡å™¨å¤åˆ¶åˆ°æœ¬åœ°ï¼Œå¯ä»¥æŒ‡å®šæ–‡ä»¶çš„æºè·¯å¾„ã€ç›®æ ‡è·¯å¾„ã€ownerã€groupã€modeç­‰ä¿¡æ¯ï¼Œç­‰ç­‰ ç¤ºä¾‹ï¼šå°†æ–‡ä»¶ä»è¿œç¨‹æœåŠ¡å™¨å¤åˆ¶åˆ°æœ¬åœ° 1ansible webservers -m fetch -a &quot;src=/tmp/a.txt dest=/tmp/ flat=yes&quot; 12345678910# fetch.yml---- name: åœ¨ web æœåŠ¡å™¨ä¸Šå°†æ–‡ä»¶ä»è¿œç¨‹æœåŠ¡å™¨å¤åˆ¶åˆ°æœ¬åœ° hosts: webservers tasks: - name: å¤åˆ¶æ–‡ä»¶ fetch: src: &quot;/tmp/a.txt&quot; dest: &quot;/tmp/&quot; flat: yes # flat: yes # å°†æ–‡ä»¶å¤åˆ¶åˆ°destç›®å½•ä¸‹ï¼Œä¸åˆ›å»ºç›®å½•ç»“æ„ å¸¸ç”¨å‚æ•°è¯´æ˜ï¼šansible-doc -s fetch å‚æ•° æè¿° src è¿œç¨‹ä¸»æœºä¸Šè¦æ‹‰å–çš„æ–‡ä»¶çš„è·¯å¾„ã€‚ dest æœ¬åœ°ä¸»æœºä¸Šæ–‡ä»¶çš„ç›®æ ‡è·¯å¾„ã€‚ flat æ˜¯å¦å°†æ–‡ä»¶æ”¾ç½®åœ¨é¡¶å±‚ç›®å½•ä¸­ã€‚å¦‚æœä¸º yesï¼Œåˆ™æ‰€æœ‰æ–‡ä»¶éƒ½å°†æ”¾ç½®åœ¨ä¸€ä¸ªç›®å½•ä¸­ã€‚é»˜è®¤ä¸º noã€‚ fail_on_missing å¦‚æœä¸º yesï¼Œåˆ™åœ¨æºæ–‡ä»¶ä¸å­˜åœ¨æ—¶å¤±è´¥ã€‚é»˜è®¤ä¸º yesã€‚ validate_checksum æ˜¯å¦éªŒè¯è¿œç¨‹æ–‡ä»¶çš„æ ¡éªŒå’Œã€‚é»˜è®¤ä¸º noã€‚ cronæ¨¡å— cronæ¨¡å—ä¸»è¦ç”¨äºåœ¨è¿œç¨‹æœåŠ¡å™¨ä¸Šåˆ›å»ºã€ä¿®æ”¹ã€åˆ é™¤å®šæ—¶ä»»åŠ¡ ç¤ºä¾‹ï¼šåˆ›å»ºå®šæ—¶ä»»åŠ¡ 1ansible webservers -m cron -a &#x27;name=&quot;restart httpd&quot; hour=*/5 job=&quot;systemctl restart httpd&quot;&#x27; 12345678910# cron.yml---- name: åœ¨ web æœåŠ¡å™¨ä¸Šåˆ›å»ºå®šæ—¶ä»»åŠ¡ hosts: webservers tasks: - name: åˆ›å»ºå®šæ—¶ä»»åŠ¡ cron: name: &quot;restart httpd&quot; hour: &quot;*/5&quot; job: &quot;systemctl restart httpd&quot; å¸¸ç”¨å‚æ•°è¯´æ˜ï¼šansible-doc -s cron å‚æ•° æè¿° name cron ä»»åŠ¡çš„åç§°ã€‚ minute cron ä»»åŠ¡æ‰§è¡Œçš„åˆ†é’Ÿã€‚ hour cron ä»»åŠ¡æ‰§è¡Œçš„å°æ—¶ã€‚ day cron ä»»åŠ¡æ‰§è¡Œçš„æ—¥æœŸã€‚ month cron ä»»åŠ¡æ‰§è¡Œçš„æœˆä»½ã€‚ weekday cron ä»»åŠ¡æ‰§è¡Œçš„æ˜ŸæœŸå‡ ã€‚ job è¦æ‰§è¡Œçš„å‘½ä»¤æˆ–è„šæœ¬ã€‚ cron_file è¦æ“ä½œçš„ cron æ–‡ä»¶çš„è·¯å¾„ã€‚é»˜è®¤ä¸º /etc/crontabã€‚ state cron ä»»åŠ¡çš„çŠ¶æ€ã€‚å¯é€‰å€¼åŒ…æ‹¬ presentï¼ˆé»˜è®¤ï¼‰å’Œ absentã€‚è¡¨ç¤ºè¦æ±‚ä»»åŠ¡å­˜åœ¨æˆ–ä¸å­˜åœ¨ã€‚ user cron ä»»åŠ¡çš„æ‰§è¡Œç”¨æˆ·ã€‚é»˜è®¤ä¸º rootã€‚ backup æ˜¯å¦å¤‡ä»½ cron æ–‡ä»¶ã€‚å¯é€‰å€¼åŒ…æ‹¬ true å’Œ falseã€‚ state 12presentï¼šè¡¨ç¤ºè¦æ±‚æŒ‡å®šçš„ cron ä»»åŠ¡å­˜åœ¨ã€‚å¦‚æœæŒ‡å®šçš„ cron ä»»åŠ¡ä¸å­˜åœ¨ï¼Œåˆ™ Ansible å°†ä¼šåˆ›å»ºå®ƒã€‚å¦‚æœå·²ç»å­˜åœ¨ï¼Œåˆ™ä¸æ‰§è¡Œä»»ä½•æ“ä½œã€‚absentï¼šè¡¨ç¤ºè¦æ±‚æŒ‡å®šçš„ cron ä»»åŠ¡ä¸å­˜åœ¨ã€‚å¦‚æœæŒ‡å®šçš„ cron ä»»åŠ¡å­˜åœ¨ï¼Œåˆ™ Ansible å°†ä¼šåˆ é™¤å®ƒã€‚å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™ä¸æ‰§è¡Œä»»ä½•æ“ä½œã€‚ yumæ¨¡å— yumæ¨¡å—ä¸»è¦ç”¨äºåœ¨è¿œç¨‹æœåŠ¡å™¨ä¸Šå®‰è£…ã€å¸è½½ã€æ›´æ–°è½¯ä»¶åŒ…ï¼Œå¯ä»¥æŒ‡å®šè½¯ä»¶åŒ…çš„åç§°ã€ç‰ˆæœ¬ã€repoç­‰ä¿¡æ¯ï¼Œç­‰ç­‰ ç¤ºä¾‹ï¼šå®‰è£…è½¯ä»¶åŒ… 12# å®‰è£…è½¯ä»¶åŒ…ï¼Œç›¸å½“äº yum install httpdansible webservers -m yum -a &quot;name=httpd state=present&quot; 123456789# yum.yml---- name: åœ¨ web æœåŠ¡å™¨ä¸Šå®‰è£… httpd è½¯ä»¶åŒ… hosts: webservers tasks: - name: å®‰è£… httpd è½¯ä»¶åŒ… yum: name: httpd # è½¯ä»¶åŒ…åç§°ï¼Œç›¸å½“äº yum install httpd state: present # å®‰è£…è½¯ä»¶åŒ…ï¼Œå¦‚æœè½¯ä»¶åŒ…å·²ç»å®‰è£…åˆ™ä¸å®‰è£… å¸¸ç”¨å‚æ•°è¯´æ˜:ansible-doc -s yum å‚æ•° è§£é‡Š name æŒ‡å®šè¦æ“ä½œçš„åŒ…çš„åç§°ã€‚ update_cache æŒ‡å®šæ˜¯å¦åœ¨æ‰§è¡Œæ“ä½œä¹‹å‰æ›´æ–° yum ç¼“å­˜ã€‚å¯é€‰å€¼ä¸º yes æˆ– noã€‚é»˜è®¤ä¸º yesã€‚ disable_gpg_check æŒ‡å®šæ˜¯å¦ç¦ç”¨ GPG æ£€æŸ¥ã€‚å¦‚æœä¸º yesï¼Œåˆ™ç¦ç”¨ GPG æ£€æŸ¥ã€‚é»˜è®¤ä¸º noã€‚ disable_plugin æŒ‡å®šæ˜¯å¦ç¦ç”¨æŒ‡å®šçš„ yum æ’ä»¶ã€‚å¯ä»¥æ˜¯ä¸€ä¸ªæ’ä»¶åç§°çš„åˆ—è¡¨ã€‚ enablerepo æŒ‡å®šè¦å¯ç”¨çš„ä»“åº“ã€‚å¯ä»¥æ˜¯ä¸€ä¸ªä»“åº“åç§°çš„åˆ—è¡¨ã€‚ disablerepo æŒ‡å®šè¦ç¦ç”¨çš„ä»“åº“ã€‚å¯ä»¥æ˜¯ä¸€ä¸ªä»“åº“åç§°çš„åˆ—è¡¨ã€‚ installroot æŒ‡å®šè¦å®‰è£…è½¯ä»¶åŒ…çš„æ ¹ç›®å½•ã€‚ security æŒ‡å®šæ˜¯å¦åªå®‰è£…å®‰å…¨æ›´æ–°ã€‚å¦‚æœä¸º yesï¼Œåˆ™åªå®‰è£…å®‰å…¨æ›´æ–°ã€‚é»˜è®¤ä¸º noã€‚ list æŒ‡å®šæ˜¯å¦åˆ—å‡ºæ‰€æœ‰å·²å®‰è£…çš„åŒ…ã€‚å¦‚æœä¸º yesï¼Œåˆ™åˆ—å‡ºå·²å®‰è£…çš„åŒ…ã€‚é»˜è®¤ä¸º noã€‚ state æŒ‡å®šè½¯ä»¶åŒ…çš„çŠ¶æ€ã€‚å¯é€‰å€¼ä¸º presentã€latestã€absentã€installedã€removedã€‚é»˜è®¤ä¸º presentã€‚ è¿™é‡Œé‡ç‚¹è¯´ä¸€ä¸‹state 12345present: è¡¨ç¤ºè¦æ±‚ç›®æ ‡ä¸»æœºä¸Šå­˜åœ¨æŒ‡å®šçš„è½¯ä»¶åŒ…ã€‚å¦‚æœè½¯ä»¶åŒ…å·²ç»å®‰è£…ï¼Œåˆ™ä¸æ‰§è¡Œä»»ä½•æ“ä½œï¼›å¦‚æœè½¯ä»¶åŒ…æœªå®‰è£…ï¼Œåˆ™ä¼šå®‰è£…å®ƒã€‚latest: è¡¨ç¤ºè¦æ±‚ç›®æ ‡ä¸»æœºä¸Šå­˜åœ¨æŒ‡å®šçš„è½¯ä»¶åŒ…ï¼Œå¹¶ä¸”å¸Œæœ›ä¿æŒä¸ºæœ€æ–°ç‰ˆæœ¬ã€‚å¦‚æœè½¯ä»¶åŒ…å·²ç»å®‰è£…ï¼Œä½†ä¸æ˜¯æœ€æ–°ç‰ˆæœ¬ï¼Œåˆ™ä¼šæ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬ï¼›å¦‚æœè½¯ä»¶åŒ…æœªå®‰è£…ï¼Œåˆ™ä¼šå®‰è£…æœ€æ–°ç‰ˆæœ¬ã€‚absent: è¡¨ç¤ºè¦æ±‚ç›®æ ‡ä¸»æœºä¸Šä¸å­˜åœ¨æŒ‡å®šçš„è½¯ä»¶åŒ…ã€‚å¦‚æœè½¯ä»¶åŒ…å·²å®‰è£…ï¼Œåˆ™ä¼šå°†å…¶å¸è½½ï¼›å¦‚æœè½¯ä»¶åŒ…æœªå®‰è£…ï¼Œåˆ™ä¸æ‰§è¡Œä»»ä½•æ“ä½œã€‚installed: ä¸ present æ„ä¹‰ç›¸åŒï¼Œç”¨äºæ˜ç¡®è¡¨è¾¾å¸Œæœ›è½¯ä»¶åŒ…å·²ç»å®‰è£…åœ¨ç›®æ ‡ä¸»æœºä¸Šã€‚removed: ä¸ absent æ„ä¹‰ç›¸åŒï¼Œç”¨äºæ˜ç¡®è¡¨è¾¾å¸Œæœ›è½¯ä»¶åŒ…å·²ä»ç›®æ ‡ä¸»æœºä¸Šå¸è½½ã€‚ serviceæ¨¡å—:è°ƒç”¨çš„æ˜¯serviceå‘½ä»¤ serviceæ¨¡å—ä¸»è¦ç”¨äºåœ¨è¿œç¨‹æœåŠ¡å™¨ä¸Šå¯åŠ¨ã€åœæ­¢ã€é‡å¯ã€é‡æ–°åŠ è½½ã€å¯ç”¨ã€ç¦ç”¨ã€æ£€æŸ¥æœåŠ¡ï¼Œå¯ä»¥æŒ‡å®šæœåŠ¡çš„åç§°ã€çŠ¶æ€ã€å¯åŠ¨æ–¹å¼ç­‰ä¿¡æ¯ï¼Œç­‰ç­‰ ç¤ºä¾‹ï¼šå¯åŠ¨æœåŠ¡ 1ansible webservers -m service -a &quot;name=httpd state=started&quot; 123456789# service.yml---- name: åœ¨ web æœåŠ¡å™¨ä¸Šå¯åŠ¨ httpd æœåŠ¡ hosts: webservers tasks: - name: å¯åŠ¨ httpd æœåŠ¡ service: name: httpd state: started å¸¸ç”¨å‚æ•°è¯´æ˜:ansible-doc -s service å‚æ•° æè¿° name æœåŠ¡çš„åç§°ã€‚ state æœåŠ¡çš„çŠ¶æ€ã€‚å¯é€‰å€¼åŒ…æ‹¬ startedï¼ˆå·²å¯åŠ¨ï¼‰ã€stoppedï¼ˆå·²åœæ­¢ï¼‰ã€restartedï¼ˆå·²é‡å¯ï¼‰ã€‚ enabled æ˜¯å¦åœ¨å¯åŠ¨æ—¶è‡ªåŠ¨å¯ç”¨æœåŠ¡ã€‚å¦‚æœä¸º yesï¼Œåˆ™åœ¨ç³»ç»Ÿå¯åŠ¨æ—¶è‡ªåŠ¨å¯åŠ¨æœåŠ¡ã€‚é»˜è®¤ä¸º yesã€‚ pattern åŒ¹é…æœåŠ¡çš„æ¨¡å¼ã€‚é»˜è®¤æƒ…å†µä¸‹ä¸ºæœåŠ¡åç§°ã€‚ sleep åœ¨é‡æ–°å¯åŠ¨æœåŠ¡ä¹‹å‰ç­‰å¾…çš„ç§’æ•°ã€‚ arguments å¯åŠ¨æˆ–åœæ­¢æœåŠ¡æ—¶è¦ä¼ é€’çš„å‚æ•°ã€‚ state 123startedï¼šè¡¨ç¤ºè¦æ±‚æœåŠ¡å¤„äºå·²å¯åŠ¨çŠ¶æ€ã€‚å¦‚æœæŒ‡å®šçš„æœåŠ¡æœªå¯åŠ¨ï¼Œåˆ™ Ansible å°†å°è¯•å¯åŠ¨è¯¥æœåŠ¡ã€‚å¦‚æœæœåŠ¡å·²ç»å¤„äºè¿è¡ŒçŠ¶æ€ï¼Œåˆ™ä¸æ‰§è¡Œä»»ä½•æ“ä½œã€‚stoppedï¼šè¡¨ç¤ºè¦æ±‚æœåŠ¡å¤„äºå·²åœæ­¢çŠ¶æ€ã€‚å¦‚æœæŒ‡å®šçš„æœåŠ¡æ­£åœ¨è¿è¡Œï¼Œåˆ™ Ansible å°†å°è¯•åœæ­¢è¯¥æœåŠ¡ã€‚å¦‚æœæœåŠ¡å·²ç»åœæ­¢ï¼Œåˆ™ä¸æ‰§è¡Œä»»ä½•æ“ä½œã€‚restartedï¼šè¡¨ç¤ºè¦æ±‚é‡å¯æœåŠ¡ã€‚æ— è®ºæœåŠ¡å½“å‰å¤„äºè¿è¡ŒçŠ¶æ€è¿˜æ˜¯åœæ­¢çŠ¶æ€ï¼ŒAnsible éƒ½ä¼šå°è¯•é‡æ–°å¯åŠ¨è¯¥æœåŠ¡ã€‚ systemdæ¨¡å—:æ”¯æŒcentos7+ï¼Œè°ƒç”¨çš„æ˜¯systemctl systemdæ¨¡å—ç”¨äºæ§åˆ¶ systemd åå°æœåŠ¡ï¼Œå…è®¸ä½ å¯åŠ¨ã€é‡æ–°å¯åŠ¨ã€åœæ­¢æˆ–è€…é‡æ–°åŠ è½½ systemd æœåŠ¡ã€‚æ­¤å¤–ï¼Œä½ ä¹Ÿå¯ä»¥ä½¿ç”¨å®ƒæ¥ä½¿æœåŠ¡åœ¨ç³»ç»Ÿå¯åŠ¨æ—¶è‡ªåŠ¨å¯åŠ¨æˆ–ç¦æ­¢è‡ªåŠ¨å¯åŠ¨ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œsystemd æ¨¡å—è¿˜å…è®¸ä½ æ£€æŸ¥æœåŠ¡çš„çŠ¶æ€ã€‚ ç¤ºä¾‹ 1ansible webservers -m systemd -a &quot;name=httpd state=restarted&quot; 123456789# systemd.yml---- name: åœ¨ web æœåŠ¡å™¨ä¸Šé‡æ–°å¯åŠ¨ httpd æœåŠ¡ hosts: webservers tasks: - name: é‡æ–°å¯åŠ¨ httpd æœåŠ¡ systemd: name: httpd state: restarted ä¸»è¦å‚æ•°è¯´æ˜ï¼šansible-doc -s systemd å‚æ•° æè¿° enabled æŒ‡å®šæœåŠ¡æ˜¯å¦åº”è¯¥åœ¨å¯åŠ¨æ—¶è‡ªåŠ¨å¯ç”¨ã€‚å¯é€‰å€¼ä¸º yes æˆ– noã€‚é»˜è®¤ä¸º yesã€‚ masked æŒ‡å®šæœåŠ¡æ˜¯å¦åº”è¯¥è¢«ç½®ä¸º masked çŠ¶æ€ï¼Œç¦æ­¢æ‰‹åŠ¨å¯åŠ¨ã€‚å¯é€‰å€¼ä¸º yes æˆ– noã€‚é»˜è®¤ä¸º noã€‚ name æœåŠ¡çš„åç§°ã€‚ state æŒ‡å®šæœåŠ¡çš„çŠ¶æ€ã€‚å¯é€‰å€¼ä¸º startedï¼ˆå¯åŠ¨ï¼‰ã€stoppedï¼ˆåœæ­¢ï¼‰ã€restartedï¼ˆé‡æ–°å¯åŠ¨ï¼‰ã€reloadedï¼ˆé‡æ–°åŠ è½½ï¼‰ scriptæ¨¡å— scriptæ¨¡å—ä¸»è¦ç”¨äºåœ¨è¿œç¨‹æœåŠ¡å™¨ä¸Šæ‰§è¡Œæœ¬åœ°çš„è„šæœ¬ ç¤ºä¾‹ï¼šæ‰§è¡Œè„šæœ¬ 1ansible webservers -m script -a &quot;chdir=/tmp /tmp/a.sh&quot; 123456789# script.yml---- name: åœ¨ web æœåŠ¡å™¨ä¸Šè¿è¡Œè„šæœ¬ hosts: webservers tasks: - name: åœ¨ /tmp ç›®å½•ä¸­è¿è¡Œè„šæœ¬ script: chdir: /tmp # æŒ‡å®šè„šæœ¬çš„æ‰§è¡Œç›®å½• cmd: /tmp/a.sh # æœ¬åœ°è„šæœ¬çš„è·¯å¾„ å¸¸ç”¨å‚æ•°è¯´æ˜:ansible-doc -s script å‚æ•° æè¿° chdir åœ¨è¿œç¨‹ä¸»æœºä¸Šæ‰§è¡Œè„šæœ¬ä¹‹å‰åˆ‡æ¢åˆ°çš„ç›®å½•ã€‚ free_form è¦åœ¨è¿œç¨‹ä¸»æœºä¸Šæ‰§è¡Œçš„è„šæœ¬å†…å®¹ã€‚ creates å¦‚æœæŒ‡å®šçš„æ–‡ä»¶å·²ç»å­˜åœ¨ï¼Œåˆ™ä¸æ‰§è¡Œè„šæœ¬ã€‚ executable æŒ‡å®šè¦ä½¿ç”¨çš„è„šæœ¬è§£é‡Šå™¨ã€‚ removes åœ¨æ‰§è¡Œè„šæœ¬ä¹‹åï¼Œå¦‚æœæŒ‡å®šçš„æ–‡ä»¶å­˜åœ¨ï¼Œåˆ™åˆ é™¤è¯¥æ–‡ä»¶ã€‚ cmd æŒ‡å®šè¦æ‰§è¡Œçš„å‘½ä»¤ã€‚ decrypt æŒ‡å®šè¦è§£å¯†çš„æºæ–‡ä»¶ã€‚ useræ¨¡å— useræ¨¡å—ä¸»è¦ç”¨äºåœ¨è¿œç¨‹æœåŠ¡å™¨ä¸Šåˆ›å»ºã€ä¿®æ”¹ã€åˆ é™¤ç”¨æˆ·ï¼Œå¯ä»¥æŒ‡å®šç”¨æˆ·çš„åç§°ã€å¯†ç ã€uidã€gidã€homeã€shellç­‰ä¿¡æ¯ï¼Œç­‰ç­‰ ç¤ºä¾‹ï¼šåˆ›å»ºç”¨æˆ· 1ansible webservers -m user -a &quot;name=nginx group=nginx shell=/sbin/nologin create_home=no&quot; 12345678910# user.yml---- name: åˆ›å»ºç”¨æˆ· nginx hosts: webservers tasks: - name: æ·»åŠ ç”¨æˆ· nginx user: name: nginx # ç”¨æˆ·åç§° shell: /sbin/nologin # æŒ‡å®šç”¨æˆ·shell,éç™»å½•ç”¨æˆ· createhome: no # ä¸åˆ›å»ºç”¨æˆ·ä¸»ç›®å½• å¸¸ç”¨å‚æ•°è¯´æ˜:ansible-doc -s user å‚æ•° æè¿° append æ˜¯å¦å°†ç”¨æˆ·æ·»åŠ åˆ°ç°æœ‰ç»„ï¼Œè€Œä¸æ˜¯æ›¿æ¢ç»„ã€‚ comment å¯¹ç”¨æˆ·çš„æ³¨é‡Šä¿¡æ¯ã€‚ createhome æ˜¯å¦åˆ›å»ºç”¨æˆ·çš„å®¶ç›®å½•ã€‚ expires ç”¨æˆ·å¸æˆ·è¿‡æœŸæ—¥æœŸã€‚ force æ˜¯å¦å¼ºåˆ¶åˆ›å»ºæˆ–æ›´æ”¹ç”¨æˆ·å¸æˆ·ã€‚ generate_ssh_key æ˜¯å¦ç”Ÿæˆç”¨æˆ·çš„ SSH å¯†é’¥å¯¹ã€‚ group ç”¨æˆ·æ‰€å±ç»„çš„åç§°æˆ– IDã€‚ groups ç”¨æˆ·æ‰€å±çš„å…¶ä»–ç»„ã€‚ home ç”¨æˆ·çš„å®¶ç›®å½•è·¯å¾„ã€‚ login_class ç”¨æˆ·ç™»å½•ç±»ã€‚ move_home æ˜¯å¦åœ¨æ›´æ”¹ç”¨æˆ·å®¶ç›®å½•è·¯å¾„æ—¶ç§»åŠ¨å…¶å†…å®¹ã€‚ name ç”¨æˆ·çš„åç§°ã€‚ non_unique å…è®¸ç”¨æˆ·å…·æœ‰éå”¯ä¸€çš„æ•°å­— IDã€‚ password ç”¨æˆ·çš„å¯†ç å“ˆå¸Œå€¼æˆ–åŠ å¯†åçš„å¯†ç ã€‚ remove æ˜¯å¦åˆ é™¤ç”¨æˆ·ã€‚ shell ç”¨æˆ·çš„ shellã€‚ state ç”¨æˆ·å¸æˆ·çš„çŠ¶æ€ã€‚ system æ˜¯å¦ä¸ºç³»ç»Ÿç”¨æˆ·ã€‚ uid ç”¨æˆ·çš„æ•°å­— IDã€‚ state 12presentï¼šè¡¨ç¤ºè¦æ±‚æŒ‡å®šçš„ç”¨æˆ·è´¦æˆ·å­˜åœ¨ã€‚å¦‚æœæŒ‡å®šçš„ç”¨æˆ·è´¦æˆ·ä¸å­˜åœ¨ï¼Œåˆ™ Ansible å°†ä¼šåˆ›å»ºè¯¥è´¦æˆ·ã€‚å¦‚æœç”¨æˆ·è´¦æˆ·å·²ç»å­˜åœ¨ï¼Œåˆ™ä¸æ‰§è¡Œä»»ä½•æ“ä½œã€‚absentï¼šè¡¨ç¤ºè¦æ±‚æŒ‡å®šçš„ç”¨æˆ·è´¦æˆ·ä¸å­˜åœ¨ã€‚å¦‚æœæŒ‡å®šçš„ç”¨æˆ·è´¦æˆ·å­˜åœ¨ï¼Œåˆ™ Ansible å°†ä¼šåˆ é™¤è¯¥è´¦æˆ·ã€‚å¦‚æœç”¨æˆ·è´¦æˆ·ä¸å­˜åœ¨ï¼Œåˆ™ä¸æ‰§è¡Œä»»ä½•æ“ä½œã€‚ get_urlæ¨¡å— get_urlæ¨¡å—è´Ÿè´£ä¸‹è½½æ–‡ä»¶åˆ°ç›®æ ‡ä¸»æœºã€‚ ç¤ºä¾‹ 1ansible webservers -m get_url -a &quot;url=https://www.example.com dest=/tmp&quot; 123456789# get_url.yml---- name: ä¸‹è½½æ–‡ä»¶åˆ°ç›®æ ‡ä¸»æœºçš„æŒ‡å®šç›®å½• hosts: webservers tasks: - name: Download files from remote host get_url: url: https://www.example.com/file.conf dest: /tmp ä¸»è¦å‚æ•°è¯´æ˜:ansible-doc -s get_url å‚æ•° æè¿° url è¦ä¸‹è½½çš„æ–‡ä»¶çš„ URL åœ°å€ã€‚ dest ä¸‹è½½æ–‡ä»¶ä¿å­˜çš„ç›®æ ‡è·¯å¾„ã€‚ force æ˜¯å¦å¼ºåˆ¶è¦†ç›–ç›®æ ‡è·¯å¾„ä¸­çš„æ–‡ä»¶ã€‚å¯é€‰å€¼ä¸º yes æˆ– noã€‚é»˜è®¤ä¸º yesã€‚ timeout ä¸‹è½½è¶…æ—¶æ—¶é—´ï¼Œå•ä½ä¸ºç§’ã€‚é»˜è®¤ä¸º 10 ç§’ã€‚ validate_certs æ˜¯å¦éªŒè¯ SSL è¯ä¹¦ã€‚å¯é€‰å€¼ä¸º yes æˆ– noã€‚é»˜è®¤ä¸º yesã€‚ owner ä¸‹è½½åæ–‡ä»¶çš„æ‰€æœ‰è€…ã€‚ group ä¸‹è½½åæ–‡ä»¶çš„æ‰€å±ç»„ã€‚ mode ä¸‹è½½åæ–‡ä»¶çš„æƒé™æ¨¡å¼ã€‚ backup æ˜¯å¦åˆ›å»ºå¤‡ä»½æ–‡ä»¶ã€‚å¯é€‰å€¼ä¸º yes æˆ– noã€‚é»˜è®¤ä¸º noã€‚ headers é™„åŠ çš„ HTTP è¯·æ±‚å¤´ã€‚ force_basic_auth æ˜¯å¦å¼ºåˆ¶ä½¿ç”¨ HTTP åŸºæœ¬èº«ä»½éªŒè¯ã€‚å¯é€‰å€¼ä¸º yes æˆ– noã€‚é»˜è®¤ä¸º yesã€‚ http_agent ç”¨äº HTTP è¯·æ±‚çš„ä»£ç†ã€‚ lineinfileæ¨¡å— lineinfileæ¨¡å—ä¸»è¦ç”¨äºåœ¨è¿œç¨‹ä¸»æœºä¸ŠæŸ¥æ‰¾å’Œæ›¿æ¢æ–‡ä»¶ä¸­çš„è¡Œï¼Œå¯ä»¥æŒ‡å®šè¦æŸ¥æ‰¾çš„è¡Œã€è¦æ›¿æ¢çš„è¡Œã€è¦æ·»åŠ çš„è¡Œç­‰ä¿¡æ¯ï¼Œç­‰ç­‰ ç¤ºä¾‹ï¼šè®¾ç½®ç¯å¢ƒå˜é‡ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯æ­¤æ—¶ç¯å¢ƒå˜é‡åœ¨å‰§æœ¬çš„ä¸Šä¸‹æ–‡ä¸­æ˜¯ä¸ç”Ÿæ•ˆçš„ï¼Œå¦‚æœéœ€è¦åœ¨å‰§æœ¬ä¸Šä¸‹æ–‡ç”Ÿæ•ˆçš„ç¯å¢ƒå˜é‡ï¼Œå¯ä»¥ä½¿ç”¨ shell æ¨¡å— 1ansible webservers -m lineinfile -a &quot;path=/etc/profile line=&#x27;PATH=/usr/local/bin:/usr/bin:/bin:/usr/local/sbin:/usr/sbin:/sbin&#x27; state=present backup=yes&quot; 1234567891011# lineinfile.yml---- name: è®¾ç½®ç¯å¢ƒå˜é‡ hosts: webservers tasks: - name: è®¾ç½®ç¯å¢ƒå˜é‡ lineinfile: path: /etc/profile line: &#x27;PATH=/usr/local/bin:/usr/bin:/bin:/usr/local/sbin:/usr/sbin:/sbin&#x27; state: present backup: yes ä¸»è¦å‚æ•°è¯´æ˜:ansible-doc -s lineinfile å‚æ•° æè¿° path è¦ä¿®æ”¹çš„æ–‡ä»¶çš„è·¯å¾„ã€‚ line è¦æ·»åŠ ã€ä¿®æ”¹æˆ–åˆ é™¤çš„è¡Œå†…å®¹ã€‚ state æŒ‡å®šè¦æ‰§è¡Œçš„æ“ä½œã€‚ regexp ç”¨äºåŒ¹é…è¡Œçš„æ­£åˆ™è¡¨è¾¾å¼ã€‚ search_string ç”¨äºåŒ¹é…è¡Œçš„å­—ç¬¦ä¸²ã€‚ backup æ˜¯å¦åˆ›å»ºå¤‡ä»½æ–‡ä»¶ã€‚å¯é€‰å€¼ä¸º yes æˆ– noã€‚é»˜è®¤ä¸º noã€‚ backrefs æ˜¯å¦å…è®¸åœ¨ regexp ä¸­ä½¿ç”¨åå‘å¼•ç”¨ã€‚ insertbefore æŒ‡å®šä¸€ä¸ªè¡Œï¼Œå°†æ–°è¡Œæ’å…¥åˆ°å®ƒä¹‹å‰ã€‚ insertafter æŒ‡å®šä¸€ä¸ªè¡Œï¼Œå°†æ–°è¡Œæ’å…¥åˆ°å®ƒä¹‹åã€‚ firstmatch æ˜¯å¦åªåŒ¹é…ç¬¬ä¸€ä¸ªåŒ¹é…é¡¹ã€‚ stateè¯´æ˜ 12presentï¼šç¡®ä¿æŒ‡å®šçš„è¡Œå­˜åœ¨äºæ–‡ä»¶ä¸­ã€‚å¦‚æœæ–‡ä»¶ä¸­ä¸å­˜åœ¨æŒ‡å®šçš„è¡Œï¼Œåˆ™ä¼šæ·»åŠ è¯¥è¡Œã€‚å¦‚æœæ–‡ä»¶ä¸­å·²ç»å­˜åœ¨è¯¥è¡Œï¼Œåˆ™ä¸åšä»»ä½•æ”¹å˜ã€‚absentï¼šç¡®ä¿æŒ‡å®šçš„è¡Œä¸å­˜åœ¨äºæ–‡ä»¶ä¸­ã€‚å¦‚æœæ–‡ä»¶ä¸­å­˜åœ¨æŒ‡å®šçš„è¡Œï¼Œåˆ™ä¼šå°†è¯¥è¡Œåˆ é™¤ã€‚å¦‚æœæ–‡ä»¶ä¸­ä¸å­˜åœ¨è¯¥è¡Œï¼Œåˆ™ä¸åšä»»ä½•æ”¹å˜ã€‚ ansible-playbook:å‰§æœ¬ ansible-playbookæ˜¯Ansibleçš„æ ¸å¿ƒå‘½ä»¤ï¼Œç”¨äºæ‰§è¡Œplaybookæ–‡ä»¶ï¼Œplaybookæ–‡ä»¶æ˜¯Ansibleæ‰§è¡Œä»»åŠ¡çš„æœ€å°å•å…ƒï¼Œä¸€ä¸ªplaybookæ–‡ä»¶å¯ä»¥åŒ…å«å¤šä¸ªplayï¼Œæ¯ä¸ªplayå¯ä»¥åŒ…å«å¤šä¸ªtaskï¼Œæ¯ä¸ªtaskå¯ä»¥åŒ…å«å¤šä¸ªmoduleï¼Œæ¯ä¸ªmoduleå¯ä»¥æ‰§è¡Œä¸€ä¸ªæ“ä½œï¼Œæ¯”å¦‚åˆ›å»ºç›®å½•ã€å®‰è£…è½¯ä»¶åŒ…ã€å¯åŠ¨æœåŠ¡ã€æ‰§è¡Œè„šæœ¬ç­‰ Ansibleä¸­æ–‡å…¨æ–‡æŒ‡å—â€“Playbooks ä¸Šé¢åœ¨ä»‹ç»ansibleæ¨¡å—æ—¶ï¼Œæˆ‘ä»¬å·²ç»ç¼–å†™äº†ä¸€äº›playbookæ–‡ä»¶ï¼Œå°±æ˜¯é‚£äº›ymlæ–‡ä»¶ï¼Œè¿è¡Œæ—¶ä¹Ÿæ˜¯é€šè¿‡ansible-playbookå‘½ä»¤æ‰§è¡Œçš„ï¼Œä½†æ˜¯åŸºæœ¬ä¸Šéƒ½æ˜¯å•ä¸ªä»»åŠ¡å•ä¸ªæ¨¡å—ï¼Œä¸‹é¢æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªå¤æ‚ä¸€äº›çš„ç¤ºä¾‹ ç¤ºä¾‹ï¼šå®‰è£…nginxå¹¶é…ç½® 12345678910111213141516171819202122232425262728293031# playbook.yml---- name: å®‰è£…nginxå¹¶é…ç½® hosts: webservers become: yes # åˆ‡æ¢åˆ°rootç”¨æˆ·ä¸‹æ‰§è¡Œ tasks: - name: install nginx yum: name: gcc,zlib-devel,pcre-devel,openssl-devel state: installed - name: wget nginx tar.gz shell: cmd: wget https://nginx.org/download/nginx-1.22.1.tar.gz chdir: /usr/local - name: tar -zxvf nginx-1.22.1.tar.gz shell: cmd: tar -zxvf nginx-1.22.1.tar.gz chdir: /usr/local - name: add user nginx user: name: nginx state: present shell: /sbin/nologin createhome: no - name: configure ,make and make install shell: cmd: cd nginx-1.22.1;./configure --prefix=/usr/local/nginx --with-http_stub_status_module --with-http_ssl_module --user=nginx;make -j4;make -j4 install; chdir: /usr/local - name: start nginx shell: cmd: /usr/local/nginx/sbin/nginx ä¼˜åŒ–1 é—®é¢˜: ä¸Šé¢çš„å‰§æœ¬æœ‰ä¸ªé—®é¢˜ï¼Œå°±æ˜¯å¦‚æœç³»ç»Ÿå·²ç»å®‰è£…äº†nginxï¼Œåˆ™è¿è¡Œè¿™ä¸ªå‰§æœ¬è¿˜æ˜¯ä¼šé‡æ–°å®‰è£… è§£å†³æ–¹æ³•: å…ˆåˆ¤æ–­nginxæ˜¯å¦å·²ç»å®‰è£…ï¼Œå¦‚æœå·²ç»å®‰è£…ï¼Œç›´æ¥è·³è¿‡å®‰è£…æ­¥éª¤ï¼Œç›´æ¥æ‰§è¡Œå¯åŠ¨å‘½ä»¤ï¼Œå¦åˆ™æ‰§è¡Œå®‰è£…æ­¥éª¤ï¼Œç„¶åå†æ‰§è¡Œå¯åŠ¨å‘½ä»¤ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061---- name: å®‰è£…nginxå¹¶é…ç½® hosts: webservers become: yes # åˆ‡æ¢åˆ°rootç”¨æˆ·ä¸‹æ‰§è¡Œ tasks: - name: æ£€æŸ¥ç³»ç»Ÿæ˜¯å¦å·²å®‰è£…Nginx shell: /usr/local/nginx/sbin/nginx -v register: nginx_installed ignore_errors: yes - name: å®‰è£…Nginxä¾èµ–è½¯ä»¶åŒ… yum: name: &quot;&#123;&#123; item &#125;&#125;&quot; state: present loop: - gcc - zlib - zlib-devel - pcre-devel - openssl - openssl-devel when: nginx_installed.rc != 0 # åªæœ‰å½“Nginxæœªå®‰è£…æ—¶æ‰§è¡Œ - name: æ£€æŸ¥ç³»ç»Ÿæ˜¯å¦å·²å¯åŠ¨Nginx shell: ps aux | grep nginx | grep -v grep register: nginx_status ignore_errors: yes - name: ä¸‹è½½Nginxæºç åŒ… get_url: url: https://nginx.org/download/nginx-1.22.1.tar.gz dest: /usr/local when: nginx_installed.rc != 0 # åªæœ‰å½“Nginxæœªå®‰è£…æ—¶æ‰§è¡Œ - name: è§£å‹Nginxæºç åŒ… shell: cmd: tar -zxvf nginx-1.22.1.tar.gz chdir: /usr/local when: nginx_installed.rc != 0 # åªæœ‰å½“Nginxæœªå®‰è£…æ—¶æ‰§è¡Œ - name: æ·»åŠ nginxç”¨æˆ· user: name: nginx state: present shell: /sbin/nologin createhome: no - name: ç¼–è¯‘Nginxå¹¶å®‰è£… shell: cmd: | cd nginx-1.22.1 ./configure --prefix=/usr/local/nginx --with-http_stub_status_module --with-http_ssl_module --user=nginx make -j4 make -j4 install chdir: /usr/local when: nginx_installed.rc != 0 # åªæœ‰å½“Nginxæœªå®‰è£…æ—¶æ‰§è¡Œ - name: å¯åŠ¨NginxæœåŠ¡ shell: cmd: /usr/local/nginx/sbin/nginx when: nginx_status.rc != 0 # åªæœ‰å½“Nginxæœªå¯åŠ¨æ—¶æ‰§è¡Œ register :ç”¨äºå°†å‘½ä»¤æ‰§è¡Œçš„ç»“æœä¿å­˜åˆ°å˜é‡ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥è°ƒç”¨å˜é‡çš„å±æ€§ï¼Œæ¯”å¦‚rcè¡¨ç¤ºå‘½ä»¤è¿”å›çš„çŠ¶æ€ç ($?)ï¼Œstdoutè¡¨ç¤ºå‘½ä»¤çš„è¾“å‡ºï¼Œstderrè¡¨ç¤ºå‘½ä»¤çš„é”™è¯¯è¾“å‡º ignore_errors :ç”¨äºå¿½ç•¥é”™è¯¯ loop :ç”¨äºå¾ªç¯åˆ—è¡¨ when :ç”¨äºåˆ¤æ–­æ¡ä»¶ï¼Œåªæœ‰æ¡ä»¶æ»¡è¶³æ—¶æ‰æ‰§è¡Œ ä¼˜åŒ–2 é—®é¢˜: ä¸Šé¢çš„æ­¥éª¤æœ‰ç‚¹å¤šï¼Œæ¯”å¦‚ä¸‹è½½ã€è§£å‹ã€ç¼–è¯‘nginxï¼Œè¿™äº›éƒ½æ˜¯åœ¨æ²¡æœ‰å®‰è£…nginxçš„æƒ…å†µä¸‹è¦è¿è¡Œçš„ä»»åŠ¡ è§£å†³æ–¹æ³•: ä½¿ç”¨shellæ¨¡å—å¯ä»¥å°†è¿™äº›æ­¥éª¤å°è£…æˆä¸€ä¸ªä»»åŠ¡ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051---- name: å®‰è£…nginxå¹¶é…ç½® hosts: webservers become: yes # åˆ‡æ¢åˆ°rootç”¨æˆ·ä¸‹æ‰§è¡Œ tasks: - name: æ£€æŸ¥ç³»ç»Ÿæ˜¯å¦å·²å®‰è£…Nginx shell: /usr/local/nginx/sbin/nginx -v register: nginx_installed ignore_errors: yes - name: å®‰è£…Nginxä¾èµ–è½¯ä»¶åŒ… yum: name: &quot;&#123;&#123; item &#125;&#125;&quot; state: present loop: - gcc - zlib - zlib-devel - pcre-devel - openssl - openssl-devel when: nginx_installed.rc != 0 # åªæœ‰å½“Nginxæœªå®‰è£…æ—¶æ‰§è¡Œ - name: æ£€æŸ¥ç³»ç»Ÿæ˜¯å¦å·²å¯åŠ¨Nginx shell: ps aux | grep nginx | grep -v grep register: nginx_status ignore_errors: yes - name: æ·»åŠ nginxç”¨æˆ· user: name: nginx state: present shell: /sbin/nologin createhome: no - name: Nginxå¹¶å®‰è£… shell: cmd: | wget https://nginx.org/download/nginx-1.22.1.tar.gz tar -zxvf nginx-1.22.1.tar.gz cd nginx-1.22.1 ./configure --prefix=/usr/local/nginx --with-http_stub_status_module --with-http_ssl_module --user=nginx make -j4 make -j4 install chdir: /usr/local when: nginx_installed.rc != 0 # åªæœ‰å½“Nginxæœªå®‰è£…æ—¶æ‰§è¡Œ - name: å¯åŠ¨NginxæœåŠ¡ shell: cmd: /usr/local/nginx/sbin/nginx when: nginx_status.rc != 0 # åªæœ‰å½“Nginxæœªå¯åŠ¨æ—¶æ‰§è¡Œ ä¼˜åŒ–3 é—®é¢˜: ä¸Šé¢çš„å‰§æœ¬è™½ç„¶å·²ç»æ»¡è¶³äº†æˆ‘çš„éœ€æ±‚ï¼Œä½†æ˜¯ä¸å¤Ÿç®€ç»ƒï¼Œå› ä¸ºå¾ˆå¤šä»»åŠ¡å¹¶ä¸æ˜¯ä¸»è¦ä»»åŠ¡ï¼Œæˆ‘éœ€è¦åœ¨æ¯ä¸ªä»»åŠ¡ä¸­è¿›è¡Œæ¡ä»¶åˆ¤æ–­æ¥å†³å®šæ˜¯å¦æ‰§è¡Œè¯¥ä»»åŠ¡ï¼Œèƒ½å¦åªä¿ç•™ä¸»è¦ä»»åŠ¡ï¼Œå…¶å®ƒä»»åŠ¡åªæœ‰å½“è¿™äº›ä¸»è¦ä»»åŠ¡æˆåŠŸè¿è¡Œäº†æ‰ä¼šè¢«è¿è¡Œå‘¢ï¼Ÿæ¯”å¦‚è¿™é‡Œçš„ä¸»è¦ä»»åŠ¡å°±æ˜¯ä¸¤ä¸ªï¼š1-åˆ¤æ–­æ˜¯å¦å®‰è£…äº†nginxï¼Œæ²¡å®‰è£…å°±å»å®‰è£…ï¼Œ2-åˆ¤æ–­æ˜¯å¦å¯åŠ¨äº†nginxï¼Œæ²¡å¯åŠ¨å°±å»å¯åŠ¨ è§£å†³æ–¹æ³•: ä½¿ç”¨åŸºäºhandlersçš„notifyè¯­å¥ï¼Œè¿™æ ·å¯ä»¥å‡å°‘é‡å¤æ‰§è¡Œä»»åŠ¡çš„æ¬¡æ•° ä½•ä¸ºhandlers Handler æœ¬èº«æ˜¯ä¸€ç§éåŒæ­¥çš„ callback function ï¼Œåœ¨è¿™é‡Œåˆ™æ˜¯æŒ‡å…³è¿äºç‰¹å®š tasks çš„äº‹ä»¶ (event) è§¦å‘æœºåˆ¶ã€‚å½“å…³è” handler çš„ tasks çŠ¶æ€ä¸ºè¢«æ”¹å˜ (changed) ä¸”éƒ½å·²è¢«æ‰§è¡Œæ—¶ï¼Œæ‰ä¼šè§¦å‘ä¸€æ¬¡ ä½•ä¸º tasks çŠ¶æ€ä¸ºè¢«æ”¹å˜ (changed) åœ¨Ansibleä¸­ï¼Œtaskçš„çŠ¶æ€ä¼šæ ¹æ®ä»»åŠ¡æ‰§è¡Œçš„ç»“æœè€Œæ”¹å˜ã€‚å½“ä¸€ä¸ªä»»åŠ¡æˆåŠŸå®Œæˆå¹¶ä¸”ä½¿å¾—ç³»ç»Ÿçš„çŠ¶æ€ä¸é¢„æœŸä¸åŒï¼ˆå³æ‰§è¡Œäº†ä¸€äº›æ›´æ”¹ï¼‰ï¼Œé‚£ä¹ˆè¿™ä¸ªä»»åŠ¡çš„çŠ¶æ€å°±ä¼šè¢«æ ‡è®°ä¸º&quot;changed&quot;ã€‚ å…·ä½“æ¥è¯´ï¼ŒtaskçŠ¶æ€ä¸º&quot;changed&quot;çš„æ¡ä»¶åŒ…æ‹¬ä½†ä¸é™äºä»¥ä¸‹æƒ…å†µï¼š 123456æ–‡ä»¶å˜æ›´ï¼šä¾‹å¦‚å¤åˆ¶ã€åˆ›å»ºã€åˆ é™¤æ–‡ä»¶ç­‰æ“ä½œå¯¼è‡´äº†æ–‡ä»¶ç³»ç»Ÿçš„å˜æ›´ã€‚æœåŠ¡çŠ¶æ€å˜æ›´ï¼šä¾‹å¦‚å¯åŠ¨ã€åœæ­¢ã€é‡å¯æœåŠ¡ç­‰æ“ä½œå¯¼è‡´äº†æœåŠ¡çŠ¶æ€çš„æ”¹å˜ã€‚é…ç½®æ›´æ”¹ï¼šä¾‹å¦‚ä¿®æ”¹é…ç½®æ–‡ä»¶ã€æ·»åŠ é…ç½®é¡¹ç­‰æ“ä½œå¯¼è‡´äº†ç³»ç»Ÿé…ç½®çš„æ”¹å˜ã€‚è½¯ä»¶åŒ…å®‰è£…/å¸è½½ï¼šä¾‹å¦‚å®‰è£…æ–°çš„è½¯ä»¶åŒ…æˆ–è€…åˆ é™¤å·²å®‰è£…çš„è½¯ä»¶åŒ…å¯¼è‡´äº†ç³»ç»Ÿè½¯ä»¶çŠ¶æ€çš„æ”¹å˜ã€‚æƒé™å˜æ›´ï¼šä¾‹å¦‚ä¿®æ”¹æ–‡ä»¶æƒé™ã€æ›´æ”¹ç”¨æˆ·ç»„ã€æ›´æ”¹ç”¨æˆ·ç­‰æ“ä½œå¯¼è‡´äº†ç³»ç»Ÿæƒé™çš„æ”¹å˜ã€‚å½“ä¸€ä¸ªæˆ–å¤šä¸ªä»»åŠ¡çš„çŠ¶æ€è¢«æ ‡è®°ä¸º&quot;changed&quot;æ—¶ï¼Œä¸è¿™äº›ä»»åŠ¡å…³è”çš„handlersä¼šè¢«è§¦å‘æ‰§è¡Œã€‚è¿™æ ·å¯ä»¥ç¡®ä¿åœ¨æ‰€æœ‰ç›¸å…³çš„ä»»åŠ¡éƒ½å®Œæˆå¹¶ä¸”å¯¼è‡´äº†ç³»ç»ŸçŠ¶æ€çš„æ”¹å˜æ—¶ï¼Œæ‰æ‰§è¡Œåç»­çš„å¤„ç†æ“ä½œï¼Œä»è€Œä¿è¯äº†ä»»åŠ¡çš„ä¸€è‡´æ€§å’Œå¯é æ€§ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859---- name: å®‰è£…nginxå¹¶é…ç½® hosts: webservers become: yes # åˆ‡æ¢åˆ°rootç”¨æˆ·ä¸‹æ‰§è¡Œ tasks: - name: åˆ¤æ–­æ˜¯å¦å­˜åœ¨nginxå®‰è£…ç›®å½•ï¼Œä¸å­˜åœ¨å°±å®‰è£…nginx file: path: /usr/local/nginx state: directory notify: # æ‰§è¡Œé€šçŸ¥ä»»åŠ¡ï¼Œé¡ºåºä¸ºä»ä¸‹åˆ°ä¸Š - Nginxå®‰è£… # åŒ¹é…ä»»åŠ¡name - å®‰è£…Nginxä¾èµ–è½¯ä»¶åŒ… - æ·»åŠ nginxç”¨æˆ· - name: æ£€æŸ¥ç³»ç»Ÿæ˜¯å¦å·²å¯åŠ¨Nginx shell: ps aux | grep nginx | grep -v grep register: nginx_status ignore_errors: yes - name: æ£€æŸ¥æ˜¯å¦éœ€è¦å¯åŠ¨nginx shell: echo &quot;start nginx&quot; when: nginx_status.rc != 0 # åªæœ‰å½“æ¡ä»¶æ»¡è¶³æ—¶æ‰ä¼šè¿è¡Œè¯¥ä»»åŠ¡ notify: # è¿è¡Œä»»åŠ¡ååªæœ‰çŠ¶æ€ä¸ºchangedæ‰ä¼šå‘é€notifyç»™handler - å¯åŠ¨NginxæœåŠ¡ handlers: # handlersæ˜¯ä¸€ç±»ç‰¹æ®Šä»»åŠ¡ï¼Œå½“æœ‰notifyæ—¶ï¼Œä¼šè‡ªåŠ¨æ‰§è¡Œè¯¥ä»»åŠ¡ - name: æ·»åŠ nginxç”¨æˆ· user: name: nginx state: present shell: /sbin/nologin createhome: no - name: å®‰è£…Nginxä¾èµ–è½¯ä»¶åŒ… yum: name: &quot;&#123;&#123; item &#125;&#125;&quot; state: present loop: - gcc - zlib - zlib-devel - pcre-devel - openssl - openssl-devel - name: Nginxå®‰è£… shell: cmd: | wget https://nginx.org/download/nginx-1.22.1.tar.gz tar -zxvf nginx-1.22.1.tar.gz cd nginx-1.22.1 ./configure --prefix=/usr/local/nginx --with-http_stub_status_module --with-http_ssl_module --user=nginx make -j4 make -j4 install chdir: /usr/local - name: å¯åŠ¨NginxæœåŠ¡ shell: cmd: /usr/local/nginx/sbin/nginx ä¼˜åŒ–4 é—®é¢˜: ä¸Šé¢çš„å‰§æœ¬ä¸­nginxçš„å®‰è£…ç‰ˆæœ¬å’Œå®‰è£…è·¯å¾„éƒ½æ˜¯å†™æ­»çš„ï¼Œèƒ½å¦åŠ¨æ€é…ç½®å‘¢ï¼Ÿ è§£å†³æ–¹æ³•: æå–å˜é‡ï¼Œä½¿ç”¨vars 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465---- name: å®‰è£…nginxå¹¶é…ç½® hosts: webservers become: yes # åˆ‡æ¢åˆ°rootç”¨æˆ·ä¸‹æ‰§è¡Œ vars: # å®šä¹‰å˜é‡ nginx_version: &quot;1.22.1&quot; work_dir: &quot;/usr/local&quot; nginx_install_path: &quot;/usr/local/nginx&quot; tasks: - name: åˆ¤æ–­æ˜¯å¦å­˜åœ¨nginxå®‰è£…ç›®å½•ï¼Œä¸å­˜åœ¨å°±å®‰è£…nginx file: path: &quot;&#123;&#123; nginx_install_path &#125;&#125;&quot; # å˜é‡ä¸€å®šè¦åŒæ‹¬å· state: directory notify: # æ‰§è¡Œé€šçŸ¥ä»»åŠ¡ï¼Œé¡ºåºä¸ºä»ä¸‹åˆ°ä¸Š - Nginxå®‰è£… # åŒ¹é…ä»»åŠ¡name - å®‰è£…Nginxä¾èµ–è½¯ä»¶åŒ… - æ·»åŠ nginxç”¨æˆ· - name: æ£€æŸ¥ç³»ç»Ÿæ˜¯å¦å·²å¯åŠ¨Nginx shell: ps aux | grep nginx | grep -v grep register: nginx_status ignore_errors: yes - name: æ£€æŸ¥æ˜¯å¦éœ€è¦å¯åŠ¨nginx shell: echo &quot;start nginx&quot; when: nginx_status.rc != 0 notify: - å¯åŠ¨NginxæœåŠ¡ handlers: # handlersæ˜¯ä¸€ç±»ç‰¹æ®Šä»»åŠ¡ï¼Œå½“æœ‰notifyæ—¶ï¼Œä¼šè‡ªåŠ¨æ‰§è¡Œè¯¥ä»»åŠ¡ - name: æ·»åŠ nginxç”¨æˆ· user: name: nginx state: present shell: /sbin/nologin createhome: no - name: å®‰è£…Nginxä¾èµ–è½¯ä»¶åŒ… yum: name: &quot;&#123;&#123; item &#125;&#125;&quot; state: present loop: - gcc - zlib - zlib-devel - pcre-devel - openssl - openssl-devel - name: Nginxå®‰è£… shell: cmd: | wget https://nginx.org/download/nginx-&#123;&#123; nginx_version &#125;&#125;.tar.gz tar -zxvf nginx-&#123;&#123; nginx_version &#125;&#125;.tar.gz cd nginx-&#123;&#123; nginx_version &#125;&#125; ./configure --prefix=&#123;&#123; nginx_install_path &#125;&#125; --with-http_stub_status_module --with-http_ssl_module --user=nginx make -j4 make -j4 install chdir: &quot;&#123;&#123; work_dir &#125;&#125;&quot; - name: å¯åŠ¨NginxæœåŠ¡ shell: cmd: &quot;&#123;&#123; nginx_install_path &#125;&#125;/sbin/nginx&quot; 1234# é»˜è®¤ansible-playbook nginx.yml# ä¿®æ”¹å˜é‡ansible-playbook nginx.yml -e &quot;nginx_version=1.24.0&quot; -e &quot;work_dir=/root&quot; å°è´´å£« é™¤äº†æˆ‘ä»¬è‡ªå·±å®šä¹‰çš„å˜é‡ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨Ansibleå†…ç½®çš„å˜é‡ï¼ŒAnsibleå†…ç½®çš„å˜é‡å¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£ã€‚ æˆ‘ä»¬ç”¨çš„æœ€å¤šçš„å°±æ˜¯ansible_factså˜é‡è·å–ä¸»æœºä¿¡æ¯ï¼Œå¦‚IPåœ°å€ã€MACåœ°å€ã€æ“ä½œç³»ç»Ÿç‰ˆæœ¬ç­‰ã€‚ä¹Ÿå°±æ˜¯é€šè¿‡setupæ¨¡å—è·å–çš„ä¿¡æ¯ã€‚ åœ¨ä½¿ç”¨ansible_factså˜é‡æ—¶éœ€è¦å¼€å¯gather_factsé€‰é¡¹ï¼Œé»˜è®¤æ˜¯å¼€å¯çš„ã€‚ å¸¸ç”¨çš„ansible_factså˜é‡å¦‚ä¸‹ï¼Œæ³¨æ„è¿™é‡Œå±æ€§åç§°å‰æ˜¯ä¸åŠ ansible_å‰ç¼€çš„ï¼š 123ansible_facts[&#x27;distribution&#x27;]: è¿œç¨‹ä¸»æœºçš„æ“ä½œç³»ç»Ÿåˆ†å‘åç§°ã€‚ansible_facts[&#x27;distribution_version&#x27;]: è¿œç¨‹ä¸»æœºçš„æ“ä½œç³»ç»Ÿç‰ˆæœ¬å·ã€‚ansible_facts[&#x27;user_id&#x27;]: è¿œç¨‹ä¸»æœºä¸Šå½“å‰ç”¨æˆ·çš„ç”¨æˆ· IDã€‚ ansible-playbook:Template Ansible Playbook Templateæ˜¯ä¸€ç§Ansibleçš„ç‰¹æ€§ï¼Œå®ƒå…è®¸æ‚¨åœ¨Playbookä¸­ä½¿ç”¨Jinja2æ¨¡æ¿è¯­è¨€æ¥åŠ¨æ€ç”Ÿæˆé…ç½®æ–‡ä»¶æˆ–å…¶ä»–æ–‡æœ¬æ–‡ä»¶ã€‚é€šè¿‡ä½¿ç”¨æ¨¡æ¿ï¼Œæ‚¨å¯ä»¥æ ¹æ®å˜é‡ã€æ¡ä»¶ã€å¾ªç¯ç­‰åŠ¨æ€ä¿¡æ¯æ¥ç”Ÿæˆç›®æ ‡æ–‡ä»¶ï¼Œä»è€Œä½¿é…ç½®æ–‡ä»¶æ›´å…·å¯æ‰©å±•æ€§å’Œçµæ´»æ€§ã€‚ ä¸‹é¢æ˜¯ä½¿ç”¨Ansible Playbook Templateçš„ä¸€äº›å¸¸è§ç”¨æ³•å’Œç‰¹æ€§ï¼š 12345Jinja2æ¨¡æ¿è¯­è¨€: Ansible Playbook Templateä½¿ç”¨Jinja2æ¨¡æ¿è¯­è¨€ï¼Œè¿™æ˜¯ä¸€ç§åŠŸèƒ½å¼ºå¤§çš„æ¨¡æ¿å¼•æ“ï¼Œæ”¯æŒå˜é‡æ›¿æ¢ã€æ¡ä»¶è¯­å¥ã€å¾ªç¯è¯­å¥ç­‰åŠŸèƒ½ã€‚å˜é‡æ›¿æ¢: æ‚¨å¯ä»¥åœ¨æ¨¡æ¿ä¸­ä½¿ç”¨Ansibleçš„å˜é‡æ¥æ›¿æ¢æ–‡æœ¬ä¸­çš„å ä½ç¬¦ã€‚è¿™ä½¿å¾—æ‚¨å¯ä»¥æ ¹æ®ä¸åŒçš„ç¯å¢ƒæˆ–æ¡ä»¶ç”Ÿæˆä¸åŒçš„é…ç½®æ–‡ä»¶ã€‚æ¡ä»¶è¯­å¥: æ‚¨å¯ä»¥åœ¨æ¨¡æ¿ä¸­ä½¿ç”¨æ¡ä»¶è¯­å¥æ¥æ ¹æ®ä¸åŒçš„æ¡ä»¶ç”Ÿæˆä¸åŒçš„æ–‡æœ¬ã€‚è¿™å…è®¸æ‚¨æ ¹æ®éœ€è¦çµæ´»åœ°è°ƒæ•´ç”Ÿæˆçš„é…ç½®æ–‡ä»¶ã€‚å¾ªç¯è¯­å¥: æ‚¨å¯ä»¥åœ¨æ¨¡æ¿ä¸­ä½¿ç”¨å¾ªç¯è¯­å¥æ¥å¯¹åˆ—è¡¨æˆ–å­—å…¸ä¸­çš„å…ƒç´ è¿›è¡Œè¿­ä»£ï¼Œä»è€Œç”Ÿæˆé‡å¤çš„æ–‡æœ¬å—ã€‚åŒ…å«å…¶ä»–æ¨¡æ¿æ–‡ä»¶: æ‚¨å¯ä»¥åœ¨ä¸€ä¸ªæ¨¡æ¿ä¸­åŒ…å«å…¶ä»–æ¨¡æ¿æ–‡ä»¶ï¼Œä»è€Œä½¿æ¨¡æ¿æ›´åŠ æ¨¡å—åŒ–å’Œæ˜“äºç®¡ç†ã€‚ Jinja2æ¨¡æ¿æ–‡ä»¶åç¼€ä¸º.j2ï¼Œå¸¸ç”¨è¯­æ³•å¦‚ä¸‹ï¼š 123456789101112131415# æ‰“å°å˜é‡&#123;&#123; index_title &#125;&#125;# forå¾ªç¯&#123;% for key in index_for_array %&#125;&lt;p&gt;show &#123;&#123; key &#125;&#125;&lt;/p&gt;&#123;% endfor %&#125;# ifåˆ¤æ–­&#123;% if blog_href_show %&#125;&lt;p&gt;&lt;a href=&quot;&#123;&#123; blog_href &#125;&#125;&quot;&gt;&#123;&#123; index_title &#125;&#125;&lt;/a&gt;.&lt;br/&gt;&lt;/p&gt;&lt;p&gt;&lt;em&gt;Thank you for using &#123;&#123; index_title &#125;&#125;.&lt;/em&gt;&lt;/p&gt;&#123;% endif %&#125; ç»“åˆä¸Šé¢éƒ¨ç½²nginxçš„ç¤ºä¾‹ï¼Œæˆ‘è¿™é‡Œå¢åŠ ä¸€ä¸ªä»»åŠ¡ï¼Œå°±æ˜¯æ›¿æ¢nginxå‘å¸ƒç›®å½•ä¸‹çš„index.htmlï¼Œç„¶åé‡å¯nginxï¼Œè¿™é‡Œç»™å‡ºindex.html.j2 12345678910111213141516171819202122232425262728&lt;!DOCTYPE html&gt;&lt;html&gt;&lt;head&gt;&lt;title&gt;&#123;&#123; index_title &#125;&#125;&lt;/title&gt;&lt;style&gt;html &#123; color-scheme: light dark; &#125;body &#123; width: 35em; margin: 0 auto;font-family: Tahoma, Verdana, Arial, sans-serif; &#125;&lt;/style&gt;&lt;/head&gt;&lt;body&gt;&lt;h1&gt;Hello World!&lt;/h1&gt;&lt;img src=&quot;&#123;&#123; blog_img &#125;&#125;&quot;&gt;&#123;% for key in index_for_array %&#125;&lt;p&gt;show &#123;&#123; key &#125;&#125;&lt;/p&gt;&#123;% endfor %&#125;&#123;% if blog_href_show %&#125;&lt;p&gt;&lt;a href=&quot;&#123;&#123; blog_href &#125;&#125;&quot;&gt;&#123;&#123; index_title &#125;&#125;&lt;/a&gt;.&lt;br/&gt;&lt;/p&gt;&lt;p&gt;&lt;em&gt;Thank you for using &#123;&#123; index_title &#125;&#125;.&lt;/em&gt;&lt;/p&gt;&#123;% endif %&#125;&lt;/body&gt;&lt;/html&gt; æ¥ç€æˆ‘ä»¬ä¿®æ”¹å‰§æœ¬yml 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293---- name: å®‰è£…nginxå¹¶é…ç½® hosts: webservers become: yes # åˆ‡æ¢åˆ°rootç”¨æˆ·ä¸‹æ‰§è¡Œ vars: # å®šä¹‰å˜é‡ nginx_version: &quot;1.22.1&quot; work_dir: &quot;/usr/local&quot; nginx_install_path: &quot;/usr/local/nginx&quot; index_title: &quot;hanqf&#x27;s blog&quot; index_for_array: - hello - world blog_href_show: true blog_href: &quot;https://blog.hanqunfeng.com&quot; blog_img: &quot;me.png&quot; tasks: - name: åˆ¤æ–­æ˜¯å¦å­˜åœ¨nginxå®‰è£…ç›®å½•ï¼Œä¸å­˜åœ¨å°±å®‰è£…nginx file: path: &quot;&#123;&#123; nginx_install_path &#125;&#125;&quot; # å˜é‡ä¸€å®šè¦åŒæ‹¬å· state: directory notify: # æ‰§è¡Œé€šçŸ¥ä»»åŠ¡ï¼Œé¡ºåºä¸ºä»ä¸‹åˆ°ä¸Š - Nginxå®‰è£… # åŒ¹é…ä»»åŠ¡name - å®‰è£…Nginxä¾èµ–è½¯ä»¶åŒ… - æ·»åŠ nginxç”¨æˆ· - name: æ£€æŸ¥ç³»ç»Ÿæ˜¯å¦å·²å¯åŠ¨Nginx shell: ps aux | grep nginx | grep -v grep register: nginx_status ignore_errors: yes - name: æ£€æŸ¥æ˜¯å¦éœ€è¦å¯åŠ¨nginx shell: echo &quot;start nginx&quot; when: nginx_status.rc != 0 notify: - å¯åŠ¨NginxæœåŠ¡ - name: ä¸Šä¼ å›¾ç‰‡ copy: src: me.png # ä¸ymlåœ¨åŒä¸€ç›®å½• dest: &quot;&#123;&#123; nginx_install_path &#125;&#125;/html/me.png&quot; - name: å‘å¸ƒindex.html template: src: index.html.j2 # ä¸ymlåœ¨åŒä¸€ç›®å½• dest: &quot;&#123;&#123; nginx_install_path &#125;&#125;/html/index.html&quot; force: true # å¼ºåˆ¶è¦†ç›– backup: true # è¦†ç›–å‰å¤‡ä»½ notify: - é‡å¯NginxæœåŠ¡ handlers: # handlersæ˜¯ä¸€ç±»ç‰¹æ®Šä»»åŠ¡ï¼Œå½“æœ‰notifyæ—¶ï¼Œä¼šè‡ªåŠ¨æ‰§è¡Œè¯¥ä»»åŠ¡ - name: æ·»åŠ nginxç”¨æˆ· user: name: nginx state: present shell: /sbin/nologin createhome: no - name: å®‰è£…Nginxä¾èµ–è½¯ä»¶åŒ… yum: name: &quot;&#123;&#123; item &#125;&#125;&quot; state: present loop: - gcc - zlib - zlib-devel - pcre-devel - openssl - openssl-devel - name: Nginxå®‰è£… shell: cmd: | wget https://nginx.org/download/nginx-&#123;&#123; nginx_version &#125;&#125;.tar.gz tar -zxvf nginx-&#123;&#123; nginx_version &#125;&#125;.tar.gz cd nginx-&#123;&#123; nginx_version &#125;&#125; ./configure --prefix=&#123;&#123; nginx_install_path &#125;&#125; --with-http_stub_status_module --with-http_ssl_module --user=nginx make -j4 make -j4 install chdir: &quot;&#123;&#123; work_dir &#125;&#125;&quot; - name: å¯åŠ¨NginxæœåŠ¡ shell: cmd: &quot;&#123;&#123; nginx_install_path &#125;&#125;/sbin/nginx&quot; - name: é‡å¯NginxæœåŠ¡ shell: cmd: | pkill nginx &quot;&#123;&#123; nginx_install_path &#125;&#125;/sbin/nginx&quot; æ›¿æ¢ä¹‹åçš„æ•ˆæœ 12345678910111213141516171819202122232425&lt;!DOCTYPE html&gt;&lt;html&gt;&lt;head&gt;&lt;title&gt;hanqf&#x27;s blog&lt;/title&gt;&lt;style&gt;html &#123; color-scheme: light dark; &#125;body &#123; width: 35em; margin: 0 auto;font-family: Tahoma, Verdana, Arial, sans-serif; &#125;&lt;/style&gt;&lt;/head&gt;&lt;body&gt;&lt;h1&gt;Hello World!&lt;/h1&gt;&lt;img src=&quot;me.png&quot;&gt;&lt;p&gt;show hello&lt;/p&gt;&lt;p&gt;show world&lt;/p&gt;&lt;p&gt;&lt;a href=&quot;https://blog.hanqunfeng.com&quot;&gt;hanqf&#x27;s blog&lt;/a&gt;.&lt;br/&gt;&lt;/p&gt;&lt;p&gt;&lt;em&gt;Thank you for using hanqf&#x27;s blog.&lt;/em&gt;&lt;/p&gt;&lt;/body&gt;&lt;/html&gt; templateæ¨¡å—çš„å¸¸ç”¨å‚æ•°è¯´æ˜ ansible-doc -s template å‚æ•° å¿…éœ€ é»˜è®¤å€¼ æè¿° src æ˜¯ æ—  æ¨¡æ¿æ–‡ä»¶çš„è·¯å¾„ã€‚ dest æ˜¯ æ—  ç›®æ ‡æ–‡ä»¶çš„è·¯å¾„ã€‚ force å¦ false å¦‚æœç›®æ ‡æ–‡ä»¶å·²ç»å­˜åœ¨ï¼Œæ˜¯å¦å¼ºåˆ¶è¦†ç›–ã€‚ backup å¦ false å¦‚æœè®¾ç½®ä¸ºtrueï¼Œåˆ™åœ¨è¦†ç›–ç›®æ ‡æ–‡ä»¶ä¹‹å‰åˆ›å»ºå¤‡ä»½ã€‚ unsafe_writes å¦ false å¦‚æœè®¾ç½®ä¸ºtrueï¼Œåˆ™ä¼šè·³è¿‡æ–‡ä»¶çš„æš‚æ—¶æ€§å†™å…¥ä¿æŠ¤ï¼ˆå¦‚ç¡®ä¿åœ¨å†™å…¥æ–‡ä»¶ä¹‹å‰ä¸ä¼šæ›´æ”¹å…¶å†…å®¹ï¼‰ã€‚ newline_sequence å¦ \\n ç”¨äºç”Ÿæˆæ–‡ä»¶æ—¶çš„æ¢è¡Œç¬¦åºåˆ—ã€‚ validate å¦ æ—  è¦åº”ç”¨äºç”Ÿæˆæ–‡ä»¶çš„éªŒè¯å™¨è„šæœ¬çš„è·¯å¾„ã€‚ mode å¦ æ—  ç›®æ ‡æ–‡ä»¶çš„æƒé™æ¨¡å¼ã€‚ owner å¦ æ—  ç›®æ ‡æ–‡ä»¶çš„æ‰€æœ‰è€…ã€‚ group å¦ æ—  ç›®æ ‡æ–‡ä»¶çš„æ‰€å±ç»„ã€‚ è¿™é‡Œè¦æ³¨æ„templateæ¨¡å—ä¸copyæ¨¡å—çš„åŒºåˆ«ï¼Œå‰è€…åœ¨ä¸Šä¼ æ—¶ä¼šè¿›è¡Œå˜é‡æ›¿æ¢ã€‚ ansible-playbook:Role Ansibleä¸­çš„Roleæ˜¯ä¸€ç§ç»„ç»‡å’Œç®¡ç†å‰§æœ¬çš„æ–¹æ³•ï¼Œå®ƒå…è®¸æ‚¨å°†ç›¸å…³çš„ä»»åŠ¡ã€å˜é‡ã€æ–‡ä»¶å’Œå¤„ç†ç¨‹åºç»„åˆåˆ°ä¸€ä¸ªå¯é‡ç”¨çš„å•å…ƒä¸­ã€‚Roleä½¿å¾—æ‚¨å¯ä»¥æ›´è½»æ¾åœ°ç®¡ç†å’Œç»„ç»‡å¤§å‹çš„Ansibleé¡¹ç›®ï¼Œå¹¶ä¿ƒè¿›äº†å¯ç»´æŠ¤æ€§å’Œå¤ç”¨æ€§ã€‚ Roleçš„ç‰¹æ€§ 1234567891011ç»„ç»‡æ€§ï¼šRoleå…è®¸æ‚¨å°†ç›¸å…³çš„ä»»åŠ¡å’Œæ–‡ä»¶ç»„ç»‡åœ¨ä¸€èµ·ï¼Œä½¿å¾—ä»£ç æ›´æ˜“äºç†è§£å’Œç»´æŠ¤ã€‚æ¯ä¸ªRoleé€šå¸¸éƒ½æœ‰ä¸€ä¸ªç‰¹å®šçš„ç›®çš„ï¼Œä¾‹å¦‚å®‰è£…ç‰¹å®šçš„è½¯ä»¶ã€é…ç½®æœåŠ¡æˆ–æ‰§è¡Œç‰¹å®šçš„ç³»ç»Ÿç®¡ç†ä»»åŠ¡ã€‚å¯é‡ç”¨æ€§ï¼šRoleå¯ä»¥è¢«è®¾è®¡æˆå¯é‡ç”¨çš„ç»„ä»¶ï¼Œå¯ä»¥åœ¨ä¸åŒçš„é¡¹ç›®ä¸­å¤šæ¬¡ä½¿ç”¨ã€‚è¿™æ ·ä¸€æ¥ï¼Œæ‚¨å¯ä»¥å°†å¸¸è§çš„åŠŸèƒ½å’Œé…ç½®å°è£…åˆ°Roleä¸­ï¼Œå¹¶åœ¨éœ€è¦æ—¶è½»æ¾åœ°è°ƒç”¨å®ƒä»¬ï¼Œä»è€Œæé«˜äº†ä»£ç çš„å¤ç”¨æ€§å’Œå¯ç§»æ¤æ€§ã€‚ç»“æ„åŒ–å¸ƒå±€ï¼šAnsibleæ¨èä¸€ç§ç‰¹å®šçš„ç›®å½•ç»“æ„æ¥ç»„ç»‡Roleï¼ŒåŒ…æ‹¬tasksã€handlersã€templatesã€filesã€varså’Œdefaultsç­‰ç›®å½•ã€‚è¿™ç§ç»“æ„åŒ–å¸ƒå±€æœ‰åŠ©äºæ›´æ¸…æ™°åœ°åˆ†ç¦»ä»»åŠ¡ã€å˜é‡ã€æ–‡ä»¶å’Œå¤„ç†ç¨‹åºï¼Œå¹¶ä½¿Roleæ›´æ˜“äºç®¡ç†å’Œç»´æŠ¤ã€‚å‚æ•°åŒ–ï¼šRoleå¯ä»¥ä½¿ç”¨å˜é‡æ¥æ¥å—å¤–éƒ¨è¾“å…¥ï¼Œä»è€Œä½¿å…¶æ›´åŠ çµæ´»å’Œé€šç”¨ã€‚é€šè¿‡å‚æ•°åŒ–ï¼Œæ‚¨å¯ä»¥å®šåˆ¶Roleçš„è¡Œä¸ºï¼Œä½¿å…¶é€‚ç”¨äºä¸åŒçš„ç¯å¢ƒå’Œéœ€æ±‚ã€‚ä¾èµ–å…³ç³»ï¼šRoleå¯ä»¥å®šä¹‰ä¾èµ–å…³ç³»ï¼Œå³ä¸€ä¸ªRoleå¯èƒ½ä¾èµ–äºå¦ä¸€ä¸ªRoleã€‚è¿™ç§ä¾èµ–å…³ç³»ä½¿å¾—æ‚¨å¯ä»¥æ„å»ºå¤æ‚çš„ç³»ç»Ÿé…ç½®ï¼Œè€Œä¸å¿…é‡å¤ç¼–å†™ç›¸åŒçš„ä»£ç ã€‚å¯æµ‹è¯•æ€§ï¼šç”±äºRoleæ˜¯å¯é‡ç”¨çš„ç»„ä»¶ï¼Œå› æ­¤å®ƒä»¬ä¹Ÿæ˜¯å¯æµ‹è¯•çš„ã€‚æ‚¨å¯ä»¥ç¼–å†™æµ‹è¯•ç”¨ä¾‹æ¥éªŒè¯Roleçš„è¡Œä¸ºæ˜¯å¦ç¬¦åˆé¢„æœŸï¼Œå¹¶ç¡®ä¿åœ¨ä¿®æ”¹ä»£ç æ—¶ä¸ä¼šç ´åç°æœ‰åŠŸèƒ½ã€‚ ansible-examples åˆ›å»ºrole 123456789101112131415161718192021222324252627# åœ¨å½“å‰ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªåç§°ä¸ºnginx-installçš„roleï¼Œå®é™…ä¸Šå°±æ˜¯åˆ›å»ºä¸€ä¸ªåç§°ä¸ºnginx-installçš„ç›®å½•ç»“æ„ansible-galaxy init nginx-install# åœ¨æŒ‡å®šç›®å½•ä¸‹åˆ›å»ºroleansible-galaxy init --init-path /usr/local nginx-install# nginx-installç›®å½•ç»“æ„$ tree nginx-install/nginx-install/â”œâ”€â”€ README.mdâ”œâ”€â”€ defaultsâ”‚ â””â”€â”€ main.ymlâ”œâ”€â”€ filesâ”œâ”€â”€ handlersâ”‚ â””â”€â”€ main.ymlâ”œâ”€â”€ metaâ”‚ â””â”€â”€ main.ymlâ”œâ”€â”€ tasksâ”‚ â””â”€â”€ main.ymlâ”œâ”€â”€ templatesâ”œâ”€â”€ testsâ”‚ â”œâ”€â”€ inventoryâ”‚ â””â”€â”€ test.ymlâ””â”€â”€ vars â””â”€â”€ main.yml8 directories, 8 files 12345678filesï¼šå­˜æ”¾ç”±copyæˆ–scriptæ¨¡å—ç­‰è°ƒç”¨çš„æ–‡ä»¶templatesï¼štemplateæ¨¡å—æŸ¥æ‰¾æ‰€éœ€è¦æ¨¡æ¿æ–‡ä»¶çš„ç›®å½•tasksï¼šå®šä¹‰taskã€roleçš„åŸºæœ¬å…ƒç´ ï¼Œè‡³å°‘åº”è¯¥åŒ…å«ä¸€ä¸ªåä¸ºmain.ymlçš„æ–‡ä»¶ã€‚å…¶ä»–æ–‡ä»¶éœ€è¦åœ¨æ­¤æ–‡ä»¶ä¸­é€šè¿‡includeè¿›è¡ŒåŒ…å«handlersï¼šè‡³å°‘åº”è¯¥åŒ…å«ä¸€ä¸ªåä¸ºmain.ymlçš„æ–‡ä»¶ï¼Œå…¶ä»–æ–‡ä»¶éœ€è¦åœ¨æ­¤æ–‡ä»¶ä¸­é€šè¿‡includeè¿›è¡ŒåŒ…å«varsï¼šå®šä¹‰å˜é‡ï¼Œè‡³å°‘åº”è¯¥åŒ…å«ä¸€ä¸ªåä¸ºmain.ymlçš„æ–‡ä»¶ï¼Œå…¶ä»–æ–‡ä»¶éœ€è¦åœ¨æ­¤æ–‡ä»¶ä¸­é€šè¿‡includeè¿›è¡ŒåŒ…å«metaï¼šå®šä¹‰å½“å‰è§’è‰²çš„ç‰¹æ®Šè®¾å®šåŠå…¶ä¾èµ–å…³ç³»ï¼Œè‡³å°‘åº”è¯¥åŒ…å«ä¸€ä¸ªåä¸ºmain.ymlçš„æ–‡ä»¶ï¼Œå…¶ä»–æ–‡ä»¶éœ€åœ¨æ­¤æ–‡ä»¶ä¸­é€šè¿‡includeè¿›è¡ŒåŒ…å«defaultï¼šè®¾å®šé»˜è®¤å˜é‡æ—¶ä½¿ç”¨æ­¤ç›®å½•ä¸­çš„main.ymlæ–‡ä»¶ï¼Œæ¯”varsçš„ä¼˜å…ˆçº§ä½testsï¼šå®šä¹‰æµ‹è¯•ç”¨ä¾‹ï¼Œè‡³å°‘åº”è¯¥åŒ…å«ä¸€ä¸ªåä¸ºinventoryçš„æ–‡ä»¶ï¼Œå…¶ä»–æ–‡ä»¶éœ€è¦åœ¨æ­¤æ–‡ä»¶ä¸­é€šè¿‡includeè¿›è¡ŒåŒ…å« ansibleæŸ¥æ‰¾roleçš„è·¯å¾„ï¼Œæ¨èæ”¾åˆ°/etc/ansible/roles 12345$(pwd)/roles/$(whoami)/.ansible/roles/usr/share/ansible/roles/etc/ansible/roles$(pwd) æˆ‘ä»¬å°†ä¸Šé¢å®‰è£…nginxé‚£ä¸ªå‰§æœ¬ä¿®æ”¹ä¸ºroleçš„æ–¹å¼ nginx-install/tasks/main.yml 1234567891011121314151617181920212223242526272829303132333435363738394041---# tasks file for nginx-install- name: Check if running as root fail: msg: &quot;This role must be run as root user&quot; when: ansible_facts[&#x27;user_id&#x27;] != &#x27;root&#x27; # å› ä¸ºæˆ‘ä»¬çš„å‰§æœ¬æ˜¯éœ€è¦rootç”¨æˆ·è¿è¡Œï¼Œæ‰€ä»¥è¿™é‡ŒåŠ ä¸€ä¸ªåˆ¤æ–­ï¼Œè¿™é‡Œå°±ç”¨åˆ°äº†ansible_factsç‰¹æ®Šå˜é‡- name: åˆ¤æ–­æ˜¯å¦å­˜åœ¨nginxå®‰è£…ç›®å½•ï¼Œä¸å­˜åœ¨å°±å®‰è£…nginx file: path: &quot;&#123;&#123; nginx_install_path &#125;&#125;&quot; state: directory notify: # æ‰§è¡Œé€šçŸ¥ä»»åŠ¡ï¼Œé¡ºåºä¸ºä»ä¸‹åˆ°ä¸Š - Nginxå®‰è£… - å®‰è£…Nginxä¾èµ–è½¯ä»¶åŒ… - æ·»åŠ nginxç”¨æˆ·- name: æ£€æŸ¥ç³»ç»Ÿæ˜¯å¦å·²å¯åŠ¨Nginx shell: ps aux | grep nginx | grep -v grep register: nginx_status ignore_errors: yes- name: æ£€æŸ¥æ˜¯å¦éœ€è¦å¯åŠ¨nginx shell: echo &quot;start nginx&quot; when: nginx_status.rc != 0 notify: - å¯åŠ¨NginxæœåŠ¡- name: ä¸Šä¼ å›¾ç‰‡ copy: src: me.png # ä¸ymlåœ¨åŒä¸€ç›®å½• dest: &quot;&#123;&#123; nginx_install_path &#125;&#125;/html/me.png&quot;- name: å‘å¸ƒindex.html template: src: index.html.j2 # ä¸ymlåœ¨åŒä¸€ç›®å½• dest: &quot;&#123;&#123; nginx_install_path &#125;&#125;/html/index.html&quot; force: true # å¼ºåˆ¶è¦†ç›– backup: true # è¦†ç›–å‰å¤‡ä»½ notify: - é‡å¯NginxæœåŠ¡ nginx-install/handlers/main.yml 1234567891011121314151617181920212223242526272829303132333435363738394041---# handlers file for nginx-install- name: æ·»åŠ nginxç”¨æˆ· user: name: nginx state: present shell: /sbin/nologin createhome: no- name: å®‰è£…Nginxä¾èµ–è½¯ä»¶åŒ… yum: name: &quot;&#123;&#123; item &#125;&#125;&quot; state: present loop: - gcc - zlib - zlib-devel - pcre-devel - openssl - openssl-devel- name: Nginxå®‰è£… shell: cmd: | wget https://nginx.org/download/nginx-&#123;&#123; nginx_version &#125;&#125;.tar.gz tar -zxvf nginx-&#123;&#123; nginx_version &#125;&#125;.tar.gz cd nginx-&#123;&#123; nginx_version &#125;&#125; ./configure --prefix=&#123;&#123; nginx_install_path &#125;&#125; --with-http_stub_status_module --with-http_ssl_module --user=nginx make -j4 make -j4 install chdir: &quot;&#123;&#123; work_dir &#125;&#125;&quot;- name: å¯åŠ¨NginxæœåŠ¡ shell: cmd: &quot;&#123;&#123; nginx_install_path &#125;&#125;/sbin/nginx&quot;- name: é‡å¯NginxæœåŠ¡ shell: cmd: | pkill nginx &quot;&#123;&#123; nginx_install_path &#125;&#125;/sbin/nginx&quot; nginx-install/vars/main.yml 123456789101112---# vars file for nginx-installnginx_version: &quot;1.22.1&quot;work_dir: &quot;/usr/local&quot;nginx_install_path: &quot;/usr/local/nginx&quot;index_title: &quot;hanqf&#x27;s blog&quot;index_for_array: - hello - worldblog_href_show: trueblog_href: &quot;https://blog.hanqunfeng.com&quot;blog_img: &quot;me.png&quot; å°è´´å£« ä¸Šé¢ä»‹ç»çš„tasksã€handlersï¼Œå…¶ç›®å½•ä¸­éƒ½å«æœ‰ä¸€ä¸ªmain.ymlæ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶æ˜¯å¿…é¡»å­˜åœ¨çš„ ä½†æ˜¯å¦‚æœé…ç½®çš„å†…å®¹æ¯”è¾ƒå¤šï¼Œéƒ½å†™åœ¨main.ymlæ–‡ä»¶ä¸­ï¼Œé‚£ä¹ˆè¿™ä¸ªæ–‡ä»¶å°±æ˜¾å¾—æœ‰ç‚¹è‡ƒè‚¿ï¼Œæ‰€ä»¥å¯ä»¥å°†è¿™äº›å†…å®¹æ‹†åˆ†æˆå¤šä¸ªæ–‡ä»¶ï¼Œç„¶ååœ¨main.ymlæ–‡ä»¶ä¸­é€šè¿‡includeè¿›è¡ŒåŒ…å« 123---- include: other1.yml- include: other2.yml tasksæˆ–è€…handlersä¸­è¿˜å¯ä»¥ä½¿ç”¨include_tasksè¿›è¡ŒåŒ…å« 12345678---- include_tasks: other1.yml- include_tasks: other2.yml# æˆ–è€…- include_tasks: &quot;&#123;&#123; item &#125;&#125;&quot; loop: - other1.yml - other2.yml varsé‡Œä¹Ÿå¯ä»¥å®šä¹‰å¤šä¸ªymlæ–‡ä»¶å­˜å‚¨å˜é‡ï¼Œç„¶ååœ¨tasksä¸­é€šè¿‡include_varsè¿›è¡ŒåŒ…å«ï¼Œæ³¨æ„ï¼Œå¿…é¡»æ”¾åœ¨taskçš„ymlæ–‡ä»¶ä¸­ 12345678# æ­¤æ—¶ä¸éœ€è¦åŠ ä¸Švarsè·¯å¾„ï¼Œä¼šè‡ªåŠ¨ä»varsç›®å½•ä¸‹æŸ¥æ‰¾- include_vars: &quot;v-other1.yml&quot;- include_vars: &quot;v-other2.yml&quot;# æˆ–è€…- include_vars: &quot;&#123;&#123; item &#125;&#125;&quot; loop: - v-other1.yml - v-other2.yml å°†æ¨¡æ¿æ–‡ä»¶å’Œå›¾ç‰‡æ–‡æœ¬ä¿å­˜åˆ°å¯¹åº”çš„è·¯å¾„ nginx-install/templates/index.html.j2 nginx-install/files/me.png æ‰§è¡Œ å‡è®¾æˆ‘ä»¬å°†åˆ›å»ºçš„è§’è‰²å®‰è£…åˆ°äº†/etc/ansible/rolesä¸‹ åˆ›å»ºå¯åŠ¨å‰§æœ¬nginx-install-start.ymlï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä¿®æ”¹tests/test.yml 12345- name: å®‰è£…nginxå¹¶é…ç½® hosts: webservers become: yes # åˆ‡æ¢åˆ°rootç”¨æˆ·ä¸‹æ‰§è¡Œ roles: # è°ƒç”¨role - nginx-install # roleåç§° æ‰§è¡Œrole 1ansible-playbook nginx-install-start.yml ansible-galaxy ä»€ä¹ˆæ˜¯ansible-galaxy ç”¨äºä»ansible-galaxyå®˜ç½‘ä¸ŠæŸ¥æ‰¾ï¼Œä¸‹è½½roleå’Œcollectionçš„å·¥å…·ï¼Œå¦‚ä½•ä¸‹è½½å’Œä½¿ç”¨ç½‘ç«™ä¸Šéƒ½æœ‰è¯´æ˜ã€‚ ansible-galaxyç”¨æˆ·æŒ‡å— æˆ‘ä»¬ä¹Ÿå¯ä»¥å°†è‡ªå·±åˆ›å»ºå¥½çš„roleå‘å¸ƒåˆ°ansible-galaxyä¸Šï¼Œå¯ä»¥å‚è€ƒ Ansible Role Publish To Galaxy role 1234567891011121314# æœç´¢roleansible-galaxy search mysql# æˆ–è€…ansible-galaxy role search mysql# æŸ¥çœ‹å·²ç»å®‰è£…çš„roleansible-galaxy list# æˆ–è€…ansible-galaxy role list# å®‰è£…roleï¼Œé»˜è®¤å®‰è£…åˆ° ~/.ansible/roles ä¸‹ansible-galaxy role install shaneholloman.redis# å®‰è£…åˆ°æŒ‡å®šè·¯å¾„ansible-galaxy role install &lt;role-name&gt; -p &lt;path&gt; collection ansible-galaxyåŒæ—¶æ”¯æŒä¸‹è½½ collection 1234567# æŸ¥çœ‹å·²ç»å®‰è£…çš„collectionansible-galaxy collection list# å®‰è£…collectionï¼Œï¼Œé»˜è®¤å®‰è£…åˆ° ~/.ansible/collections/ansible_collections ä¸‹ansible-galaxy collection install saiello.kafka# å®‰è£…åˆ°æŒ‡å®šè·¯å¾„ansible-galaxy collection install &lt;collection-name&gt; -p &lt;path&gt; Ansible Collection æ˜¯ Ansible ç¤¾åŒºä¸ºäº†æ›´å¥½åœ°ç®¡ç†å’Œç»„ç»‡ Ansible è§’è‰²ã€æ¨¡å—ã€æ’ä»¶ç­‰å†…å®¹è€Œå¼•å…¥çš„æ¦‚å¿µã€‚å®ƒå¯ä»¥è¢«è§†ä¸ºä¸€ç§æ‰“åŒ…æœºåˆ¶ï¼Œç”¨äºå°†ç›¸å…³çš„ Ansible å†…å®¹æ‰“åŒ…æˆå•ç‹¬çš„å•å…ƒï¼Œä½¿å¾—å…¶æ›´æ˜“äºåˆ†äº«ã€å®‰è£…å’Œç»´æŠ¤ã€‚ å…·ä½“æ¥è¯´ï¼ŒAnsible Collection å…·æœ‰ä»¥ä¸‹ä½œç”¨ï¼š 123456789ç»„ç»‡å’Œç®¡ç†è§’è‰²ã€æ¨¡å—å’Œæ’ä»¶ï¼šé€šè¿‡ Collectionï¼Œå¯ä»¥å°†ç›¸å…³çš„è§’è‰²ã€æ¨¡å—å’Œæ’ä»¶æ‰“åŒ…åœ¨ä¸€èµ·ï¼Œå½¢æˆé€»è¾‘ä¸Šçš„å•å…ƒï¼Œæé«˜äº†å†…å®¹çš„ç»„ç»‡æ€§å’Œå¯ç®¡ç†æ€§ã€‚æ˜“äºåˆ†äº«å’Œåˆ†å‘ï¼šAnsible Collection å¯ä»¥è¢«è½»æ¾åœ°åˆ†äº«å’Œåˆ†å‘ç»™å…¶ä»–ç”¨æˆ·ã€‚å¼€å‘äººå‘˜å¯ä»¥å°†è‡ªå·±çš„è§’è‰²ã€æ¨¡å—æ‰“åŒ…æˆ Collectionï¼Œå¹¶å°†å…¶å‘å¸ƒåˆ° Ansible Galaxy æˆ–å…¶ä»–é›†ä¸­å¼çš„ä»“åº“ä¸­ï¼Œä¾›å…¶ä»–ç”¨æˆ·ä½¿ç”¨ã€‚ç‰ˆæœ¬æ§åˆ¶å’Œæ›´æ–°ï¼šä¸è§’è‰²ç›¸æ¯”ï¼ŒCollection æ›´å®¹æ˜“è¿›è¡Œç‰ˆæœ¬æ§åˆ¶å’Œæ›´æ–°ã€‚å¼€å‘äººå‘˜å¯ä»¥ä¸º Collection æŒ‡å®šç‰ˆæœ¬ï¼Œå¹¶åœ¨æ›´æ–°å†…å®¹æ—¶å‘å¸ƒæ–°çš„ç‰ˆæœ¬ï¼Œä½¿å¾—ç”¨æˆ·å¯ä»¥é€‰æ‹©ä½¿ç”¨ç‰¹å®šç‰ˆæœ¬æˆ–è€…å‡çº§åˆ°æœ€æ–°ç‰ˆæœ¬ã€‚ä¾èµ–ç®¡ç†ï¼šCollection æ”¯æŒä¾èµ–ç®¡ç†ï¼Œå¯ä»¥åœ¨ Collection ä¸­æŒ‡å®šä¾èµ–å…³ç³»ï¼Œç¡®ä¿ç›¸å…³çš„è§’è‰²ã€æ¨¡å—å’Œæ’ä»¶èƒ½å¤Ÿæ­£å¸¸å·¥ä½œã€‚æä¾›æ–‡æ¡£å’Œç¤ºä¾‹ï¼šå¼€å‘äººå‘˜å¯ä»¥å°†æ–‡æ¡£å’Œç¤ºä¾‹ä»£ç ä¸ Collection æ‰“åŒ…åœ¨ä¸€èµ·ï¼Œä½¿å¾—ç”¨æˆ·æ›´å®¹æ˜“ç†è§£å’Œä½¿ç”¨å…¶ä¸­çš„å†…å®¹ã€‚ æ€»çš„æ¥è¯´ï¼ŒAnsible Collection æä¾›äº†ä¸€ç§æ›´é«˜çº§åˆ«çš„ç»„ç»‡å’Œç®¡ç†æ–¹å¼ï¼Œä½¿å¾— Ansible å†…å®¹æ›´æ˜“äºåˆ†äº«ã€ä½¿ç”¨å’Œç»´æŠ¤ï¼Œä»è€Œæé«˜äº† Ansible çš„æ•´ä½“ç”Ÿæ€ç³»ç»Ÿçš„å¥å£®æ€§å’Œå¯ç”¨æ€§ã€‚ å°è´´å£« å‰é¢çš„å‰§æœ¬ä¸­æˆ‘ä»¬å¤šæ¬¡ä½¿ç”¨åˆ°äº†becomeåˆ‡æ¢ç”¨æˆ·åˆ°rootç”¨æˆ·ï¼Œå…¶å®åœ¨ansible.cfgä¸­æˆ‘ä»¬å¯ä»¥é…ç½®become_userï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ä¸ç”¨æ¯æ¬¡éƒ½åˆ‡æ¢ç”¨æˆ·äº† ä½†è¿™é‡Œæœ‰ä¸ªéœ€è¦æ³¨æ„çš„ç‚¹ï¼Œå°±æ˜¯å› ä¸º become ä¼šä»¥ä¸€ä¸ªå…¨æ–°çš„ç¯å¢ƒæ‰§è¡Œä»»åŠ¡ï¼Œæ‰€ä»¥å…¶ä¸ä¼šåŒ…å«åŸç”¨æˆ·çš„ç¯å¢ƒå˜é‡ã€‚å¯ä»¥ç†è§£ä¸ºå…¶æ˜¯é€šè¿‡sudo suåˆ‡æ¢åˆ°rootï¼Œè€Œésudo -iã€‚ åè®° å…³äºansibleçš„çŸ¥è¯†ç‚¹è¿˜æœ‰å¾ˆå¤šæ²¡æœ‰ç ”ç©¶åˆ°ï¼Œåé¢ä¼šæ…¢æ…¢è¡¥å§â€¦â€¦ å…³äºå°†Ansible Roleå‘å¸ƒåˆ°Galaxyçš„è¯¦ç»†ä»‹ç»å¯ä»¥å‚çœ‹ Ansible Role Publish To Galaxy å…³äºå°†Ansible Collectionå‘å¸ƒåˆ°Galaxyçš„è¯¦ç»†ä»‹ç»å¯ä»¥å‚çœ‹ Ansible Collection Publish To Galaxy","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç»Ansibleçš„å®‰è£…å’Œä½¿ç”¨ã€‚ æœ¬æ–‡åŸºäºCentOS8ã€‚","date_published":"2024-03-19T13:30:05.000Z","tags":["æŠ€æœ¯","linux","linuxå¸¸ç”¨å‘½ä»¤","linuxå¸¸ç”¨å‘½ä»¤"]},{"id":"https://blog.hanqunfeng.com/2024/03/14/mongodb7-mtools/","url":"https://blog.hanqunfeng.com/2024/03/14/mongodb7-mtools/","title":"MongoDBæœ¬åœ°æµ‹è¯•ç¯å¢ƒæ­å»ºå·¥å…·--mtoolsä¹‹mlaunchä½¿ç”¨æ–¹æ³•","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç»mtoolså·¥å…·çš„ä½¿ç”¨</p>\n</li>\n<li class=\"lvl-2\">\n<p>mtools<a href=\"https://rueckstiess.github.io/mtools/\">å®˜æ–¹æ–‡æ¡£</a>ï¼Œ<a href=\"https://github.com/rueckstiess/mtools\">mtools-github</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>mtoolsæä¾›çš„<code>mlaunch</code>æ˜¯ä¸€ä¸ªåŸºäºpythonçš„mongoç¯å¢ƒç®¡ç†å·¥å…·ï¼Œå¯ä»¥æ–¹ä¾¿çš„å¯åŠ¨ã€åœæ­¢ã€é‡å¯ã€kill mongoè¿›ç¨‹ï¼Œè¿˜å¯ä»¥æŸ¥çœ‹mongoè¿›ç¨‹çš„è¿è¡ŒçŠ¶æ€ï¼Œå¯ä»¥æ–¹ä¾¿åˆå­¦è€…å¿«é€Ÿæ­å»ºæœ¬åœ°mongoç¯å¢ƒï¼Œä½†æ˜¯å…¶åªèƒ½åœ¨ä¸€å°æœºå™¨ä¸Šè¿è¡Œã€‚</p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"mtoolså®‰è£…\">mtoolså®‰è£…</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>mtoolsåŸºäºpython3ï¼Œæ”¯æŒmongo4+ä»¥ä¸Šç‰ˆæœ¬ï¼Œä½†æ˜¯mtoolså¹¶ä¸”ä¸ä¼šä¸ºæˆ‘ä»¬å®‰è£…mongodbï¼Œæ‰€ä»¥éœ€è¦æˆ‘ä»¬è‡ªå·±å…ˆåœ¨ç³»ç»Ÿä¸­å®‰è£…å¥½mongodbï¼Œmongodbçš„å®‰è£…å¯ä»¥å‚è€ƒ<a href=\"/2024/03/01/mongodb7/\" title=\"MongoDB7.0çš„å®‰è£…\">MongoDB7.0çš„å®‰è£…</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>æŒ‰ç…§å®˜ç½‘çš„è¯´æ³•ï¼Œmtoolsæ”¯æŒçš„Pythonç‰ˆæœ¬ä¸º 3.7|3.8|3.9|3.10ï¼Œå…¶ä»–ç‰ˆæœ¬çš„Pythonç›®å‰ä¸å—æ”¯æŒæˆ–æµ‹è¯•ï¼Œä½†ä½œè€…çš„pythonç‰ˆæœ¬ä¸º3.11.3ï¼Œå¹¶æ²¡æœ‰å‡ºç°å…¼å®¹æ€§é—®é¢˜ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">âœ  ~ python3 --version</span><br><span class=\"line\">Python 3.11.3</span><br><span class=\"line\">âœ  ~ pip3 -V</span><br><span class=\"line\">pip 24.0 from /usr/local/lib/python3.11/site-packages/pip (python 3.11)</span><br><span class=\"line\">âœ  ~ pip3 list</span><br><span class=\"line\">Package           Version</span><br><span class=\"line\">----------------- ------------</span><br><span class=\"line\">certifi           2023.11.17</span><br><span class=\"line\">cffi              1.16.0</span><br><span class=\"line\">cryptography      41.0.7</span><br><span class=\"line\">docutils          0.20.1</span><br><span class=\"line\">idna              3.6</span><br><span class=\"line\">Jinja2            3.1.2</span><br><span class=\"line\">MarkupSafe        2.1.3</span><br><span class=\"line\">packaging         23.2</span><br><span class=\"line\">pip               24.0</span><br><span class=\"line\">pycparser         2.21</span><br><span class=\"line\">Pygments          2.17.2</span><br><span class=\"line\">pyparsing         3.1.1</span><br><span class=\"line\">pytz              2023.3.post1</span><br><span class=\"line\">requests          2.31.0</span><br><span class=\"line\">setuptools        68.2.2</span><br><span class=\"line\">six               1.16.0</span><br><span class=\"line\">tabulate          0.0.0</span><br><span class=\"line\">typing_extensions 4.9.0</span><br><span class=\"line\">urllib3           2.1.0</span><br><span class=\"line\">wheel             0.41.2</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å®‰è£…mtoolsä¾èµ–</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pip3 install python-dateutil psutil pymongo</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å®‰è£…mtools</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pip3 install mtools</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å®‰è£…mtoolsä¼šåŒæ—¶ä¸ºæˆ‘ä»¬å®‰è£…mtoolsçš„æ‰€æœ‰å·¥å…·ï¼Œå¦‚æœåªå¸Œæœ›å®‰è£…mlaunchï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤<br>\n<em><strong>mtoolsæä¾›çš„å…¶å®ƒå·¥å…·ï¼Œå¦‚<code>mlogfilter</code>,<code>mloginfo</code>,<code>mplotqueries</code>ç­‰å¹¶ä¸æ”¯æŒ<code>logv2</code>æ ¼å¼çš„æ—¥å¿—ï¼Œ<code>logv2</code>æ˜¯<code>mongodb4.4+</code>ä»¥åçš„åŠ å…¥çš„ï¼Œä»<code>mongodb5.0</code>ä»¥å<code>logv2</code>ä¸ºé»˜è®¤çš„æ—¥å¿—æ ¼å¼ï¼Œæ‰€ä»¥è¿™é‡Œä¸åšä»‹ç»ã€‚</strong></em></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pip3 install <span class=\"string\">&#x27;mtools[mlaunch]&#x27;</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"mlaunch\">mlaunch</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æŸ¥çœ‹mlaunchç‰ˆæœ¬</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">âœ  ~ <span class=\"built_in\">which</span> mlaunch</span><br><span class=\"line\">/usr/local/bin/mlaunch</span><br><span class=\"line\">âœ  ~ mlaunch --version</span><br><span class=\"line\">Detected mongod version: 7.0.6</span><br><span class=\"line\">mtools version 1.7.2 || Python 3.11.6 (main, Oct 3 2023, 02:51:45) [Clang 14.0.3 (clang-1403.0.22.14.1)]</span><br></pre></td></tr></table></figure>\n<h3 id=\"init-æ„å»ºç¯å¢ƒ\">init :æ„å»ºç¯å¢ƒ</h3>\n<p><em><strong>æ­¤å‘½ä»¤åˆå§‹åŒ–å¹¶å¯åŠ¨MongoDBç‹¬ç«‹å®ä¾‹ã€å‰¯æœ¬é›†æˆ–åˆ†ç‰‡é›†ç¾¤ï¼Œå®ƒåªéœ€è¦ä¸ºæ¯ä¸ªç¯å¢ƒè°ƒç”¨ä¸€æ¬¡ã€‚</strong></em></p>\n<h4 id=\"æ„å»ºç‹¬ç«‹å®ä¾‹\">æ„å»ºç‹¬ç«‹å®ä¾‹</h4>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å¿«é€Ÿæ„å»ºä¸€ä¸ªå•èŠ‚ç‚¹ï¼Œæ•°æ®ç›®å½•åœ¨å½“å‰è·¯å¾„ä¸‹çš„dataç›®å½•ä¸‹</span></span><br><span class=\"line\">$ mlaunch init --single --auth</span><br><span class=\"line\">Detected mongod version: 7.0.6</span><br><span class=\"line\">Generating keyfile: /mongodb/mtools/single/data/keyfile</span><br><span class=\"line\">launching: <span class=\"string\">&quot;mongod&quot;</span> on port 27017</span><br><span class=\"line\">Username <span class=\"string\">&quot;user&quot;</span>, password <span class=\"string\">&quot;password&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å‚æ•°è¯´æ˜</span></span><br><span class=\"line\"><span class=\"comment\"># --single ï¼šå¯åŠ¨å•èŠ‚ç‚¹</span></span><br><span class=\"line\"><span class=\"comment\"># --auth ï¼šå¼€å¯é»˜è®¤è®¤è¯ï¼Œé»˜è®¤ç”¨æˆ·å/å¯†ç :user/passwordï¼Œå¹¶æˆäºˆå¦‚ä¸‹è§’è‰²</span></span><br><span class=\"line\">  <span class=\"comment\"># &#123; role: &#x27;userAdminAnyDatabase&#x27;, db: &#x27;admin&#x27; &#125;,</span></span><br><span class=\"line\">  <span class=\"comment\"># &#123; role: &#x27;readWriteAnyDatabase&#x27;, db: &#x27;admin&#x27; &#125;,</span></span><br><span class=\"line\">  <span class=\"comment\"># &#123; role: &#x27;dbAdminAnyDatabase&#x27;, db: &#x27;admin&#x27; &#125;,</span></span><br><span class=\"line\">  <span class=\"comment\"># &#123; role: &#x27;clusterAdmin&#x27;, db: &#x27;admin&#x27; &#125;</span></span><br><span class=\"line\"><span class=\"comment\"># --dir ï¼šæŒ‡å®šæ•°æ®ç›®å½•ï¼Œé»˜è®¤ä¸ºå½“å‰è·¯å¾„ä¸‹çš„dataç›®å½•</span></span><br><span class=\"line\"><span class=\"comment\"># --bind_ipï¼šæŒ‡å®šç›‘å¬ipï¼Œé»˜è®¤ä¸º127.0.0.1</span></span><br><span class=\"line\"><span class=\"comment\"># --portï¼šæŒ‡å®šç›‘å¬ç«¯å£ï¼Œé»˜è®¤ä¸º27017</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"æ„å»ºå¤åˆ¶é›†\">æ„å»ºå¤åˆ¶é›†</h4>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å¿«é€Ÿæ„å»ºä¸€ä¸ª3èŠ‚ç‚¹çš„å¤åˆ¶é›†</span></span><br><span class=\"line\">$ mlaunch init --replicaset --nodes 3 --auth --port 27040</span><br><span class=\"line\">Detected mongod version: 7.0.6</span><br><span class=\"line\">Generating keyfile: /mongodb/mtools/replicaset/data/keyfile</span><br><span class=\"line\">launching: <span class=\"string\">&quot;mongod&quot;</span> on port 27040</span><br><span class=\"line\">launching: <span class=\"string\">&quot;mongod&quot;</span> on port 27041</span><br><span class=\"line\">launching: <span class=\"string\">&quot;mongod&quot;</span> on port 27042</span><br><span class=\"line\">replica <span class=\"built_in\">set</span> <span class=\"string\">&#x27;replset&#x27;</span> initialized.</span><br><span class=\"line\">waiting <span class=\"keyword\">for</span> primary to add a user.</span><br><span class=\"line\">Username <span class=\"string\">&quot;user&quot;</span>, password <span class=\"string\">&quot;password&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># --replicaset ï¼šåˆ›å»ºå‰¯æœ¬é›†ï¼Œé»˜è®¤3ä¸ªèŠ‚ç‚¹</span></span><br><span class=\"line\"><span class=\"comment\"># --nodes 3 ï¼šæŒ‡å®šå‰¯æœ¬é›†èŠ‚ç‚¹ä¸ªæ•°ï¼Œé»˜è®¤3ä¸ªèŠ‚ç‚¹</span></span><br><span class=\"line\"><span class=\"comment\"># --auth : å¼€å¯é»˜è®¤è®¤è¯ï¼ŒåŒå•èŠ‚ç‚¹</span></span><br><span class=\"line\"><span class=\"comment\"># --port 27040 : æŒ‡å®šå¤åˆ¶é›†çš„èµ·å§‹ç«¯å£ï¼Œé»˜è®¤ä»27017å¼€å§‹ï¼Œä¾æ¬¡é€’å¢</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"æ„å»ºåˆ†ç‰‡é›†ç¾¤\">æ„å»ºåˆ†ç‰‡é›†ç¾¤</h4>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å¿«é€Ÿæ„å»ºä¸€ä¸ª2ä¸ªåˆ†ç‰‡çš„åˆ†ç‰‡é›†ç¾¤ï¼Œæ¯ä¸ªåˆ†ç‰‡æ˜¯ä¸€ä¸ªåŒ…å«3æ¯ä¸ªèŠ‚ç‚¹çš„å¤åˆ¶é›†ï¼ŒåŒ…å«ä¸€ä¸ª3ä¸ªèŠ‚ç‚¹é…ç½®å¤åˆ¶é›†ï¼Œå¹¶ä¸”å¯åŠ¨3ä¸ªmongosè·¯ç”±</span></span><br><span class=\"line\">$ mlaunch init --sharded 2 --replicaset --node 3 --config 3 --csrs --mongos 3 --auth --port 27050</span><br><span class=\"line\">Detected mongod version: 7.0.6</span><br><span class=\"line\">Generating keyfile: /mongodb/mtools/sharded/data/keyfile</span><br><span class=\"line\">launching: <span class=\"string\">&quot;mongod&quot;</span> on port 27053</span><br><span class=\"line\">launching: <span class=\"string\">&quot;mongod&quot;</span> on port 27054</span><br><span class=\"line\">launching: <span class=\"string\">&quot;mongod&quot;</span> on port 27055</span><br><span class=\"line\">launching: <span class=\"string\">&quot;mongod&quot;</span> on port 27056</span><br><span class=\"line\">launching: <span class=\"string\">&quot;mongod&quot;</span> on port 27057</span><br><span class=\"line\">launching: <span class=\"string\">&quot;mongod&quot;</span> on port 27058</span><br><span class=\"line\">launching: config server on port 27059</span><br><span class=\"line\">launching: config server on port 27060</span><br><span class=\"line\">launching: config server on port 27061</span><br><span class=\"line\">replica <span class=\"built_in\">set</span> <span class=\"string\">&#x27;configRepl&#x27;</span> initialized.</span><br><span class=\"line\">replica <span class=\"built_in\">set</span> <span class=\"string\">&#x27;shard01&#x27;</span> initialized.</span><br><span class=\"line\">replica <span class=\"built_in\">set</span> <span class=\"string\">&#x27;shard02&#x27;</span> initialized.</span><br><span class=\"line\">launching: mongos on port 27050</span><br><span class=\"line\">launching: mongos on port 27051</span><br><span class=\"line\">launching: mongos on port 27052</span><br><span class=\"line\">adding shards. can take up to 30 seconds...</span><br><span class=\"line\">sent signal 15 to 12 processes.</span><br><span class=\"line\">launching: config server on port 27059</span><br><span class=\"line\">launching: config server on port 27060</span><br><span class=\"line\">launching: config server on port 27061</span><br><span class=\"line\">launching: <span class=\"string\">&quot;mongod&quot;</span> on port 27053</span><br><span class=\"line\">launching: <span class=\"string\">&quot;mongod&quot;</span> on port 27054</span><br><span class=\"line\">launching: <span class=\"string\">&quot;mongod&quot;</span> on port 27055</span><br><span class=\"line\">launching: <span class=\"string\">&quot;mongod&quot;</span> on port 27056</span><br><span class=\"line\">launching: <span class=\"string\">&quot;mongod&quot;</span> on port 27057</span><br><span class=\"line\">launching: <span class=\"string\">&quot;mongod&quot;</span> on port 27058</span><br><span class=\"line\">launching: mongos on port 27050</span><br><span class=\"line\">launching: mongos on port 27051</span><br><span class=\"line\">launching: mongos on port 27052</span><br><span class=\"line\">Username <span class=\"string\">&quot;user&quot;</span>, password <span class=\"string\">&quot;password&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># --sharded 2ï¼šå¯ç”¨åˆ†ç‰‡é›†ç¾¤æ¨¡å¼ï¼Œåˆ†ç‰‡æ•°ä¸º2ã€‚</span></span><br><span class=\"line\"><span class=\"comment\"># --replicaset : åˆ›å»ºå‰¯æœ¬é›†ï¼Œé»˜è®¤3ä¸ªèŠ‚ç‚¹ï¼Œå¯ä»¥é€šè¿‡ --nodes æŒ‡å®šå¤åˆ¶é›†èŠ‚ç‚¹ä¸ªæ•°</span></span><br><span class=\"line\"><span class=\"comment\"># --nodes 3ï¼šé‡‡ç”¨3èŠ‚ç‚¹çš„å¤åˆ¶é›†æ¶æ„ï¼Œé»˜è®¤å°±æ˜¯3ä¸ªèŠ‚ç‚¹ã€‚</span></span><br><span class=\"line\"><span class=\"comment\"># --config 3ï¼šé…ç½®æœåŠ¡å™¨é‡‡ç”¨3èŠ‚ç‚¹çš„å¤åˆ¶é›†æ¶æ„æ¨¡å¼</span></span><br><span class=\"line\"><span class=\"comment\"># --csrsï¼šæŒ‡Config Server as a Replica Setï¼Œè¿™ä¸ªä¹Ÿæ˜¯é»˜è®¤é…ç½®</span></span><br><span class=\"line\"><span class=\"comment\"># --mongos 3ï¼šå¯åŠ¨3ä¸ªmongoså®ä¾‹è¿›ç¨‹ã€‚</span></span><br><span class=\"line\"><span class=\"comment\"># --auth : å¼€å¯é»˜è®¤è®¤è¯ï¼ŒåŒå•èŠ‚ç‚¹</span></span><br><span class=\"line\"><span class=\"comment\"># --port 27050ï¼šé›†ç¾¤å°†ä»¥27050ä½œä¸ºèµ·å§‹ç«¯å£ï¼Œé›†ç¾¤ä¸­çš„å„ä¸ªå®ä¾‹åŸºäºè¯¥ç«¯å£å‘ä¸Šé€’å¢ã€‚</span></span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>ä»¥ä¸‹å‘½ä»¤è¿è¡Œæ—¶å¿…é¡»æŒ‡å®šæ•°æ®ç›®å½•ï¼Œé»˜è®¤ä¸ºå½“å‰è·¯å¾„ä¸‹çš„dataç›®å½•ï¼Œå¯ä»¥ä½¿ç”¨<code>--dir</code>æŒ‡å®šæ•°æ®ç›®å½•ï¼Œå› ä¸ºéœ€è¦é€šè¿‡<code>./data/.mlaunch_startup</code>æ¥è·å–mongoçš„æ„å»ºä¿¡æ¯ã€‚ä»¥åˆ†ç‰‡é›†ç¾¤ä¸¾ä¾‹ï¼š</p>\n</blockquote>\n<h3 id=\"list-æŸ¥çœ‹å¯åŠ¨ä¿¡æ¯\">list: æŸ¥çœ‹å¯åŠ¨ä¿¡æ¯</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æŸ¥çœ‹é›†ç¾¤çŠ¶æ€</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æ˜¾ç¤ºmongoè¿›ç¨‹çš„åˆ—è¡¨</span></span><br><span class=\"line\">$ mlaunch list</span><br><span class=\"line\">Detected mongod version: 7.0.6</span><br><span class=\"line\"></span><br><span class=\"line\">PROCESS          PORT     STATUS     PID</span><br><span class=\"line\"></span><br><span class=\"line\">mongos           27050    running    61988</span><br><span class=\"line\">mongos           27051    running    61991</span><br><span class=\"line\">mongos           27052    running    61999</span><br><span class=\"line\"></span><br><span class=\"line\">config server    27059    running    61903</span><br><span class=\"line\">config server    27060    running    61911</span><br><span class=\"line\">config server    27061    running    61914</span><br><span class=\"line\"></span><br><span class=\"line\">shard01</span><br><span class=\"line\">    mongod       27053    running    61922</span><br><span class=\"line\">    mongod       27054    running    61947</span><br><span class=\"line\">    mongod       27055    running    61955</span><br><span class=\"line\"></span><br><span class=\"line\">shard02</span><br><span class=\"line\">    mongod       27056    running    61964</span><br><span class=\"line\">    mongod       27057    running    61972</span><br><span class=\"line\">    mongod       27058    running    61980</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æŸ¥çœ‹å¯åŠ¨å‘½ä»¤</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ mlaunch list --startup</span><br><span class=\"line\">Detected mongod version: 7.0.6</span><br><span class=\"line\"></span><br><span class=\"line\">PROCESS          PORT     STATUS     PID      STARTUP COMMAND</span><br><span class=\"line\"></span><br><span class=\"line\">mongos           27050    running    61988    mongos --logpath /mongodb/mtools/sharded/data/mongos/mongos_27050.<span class=\"built_in\">log</span> --port 27050 --configdb configRepl/localhost:27059,localhost:27060,localhost:27061 --keyFile /mongodb/mtools/sharded/data/keyfile --fork</span><br><span class=\"line\">mongos           27051    running    61991    mongos --logpath /mongodb/mtools/sharded/data/mongos/mongos_27051.<span class=\"built_in\">log</span> --port 27051 --configdb configRepl/localhost:27059,localhost:27060,localhost:27061 --keyFile /mongodb/mtools/sharded/data/keyfile --fork</span><br><span class=\"line\">mongos           27052    running    61999    mongos --logpath /mongodb/mtools/sharded/data/mongos/mongos_27052.<span class=\"built_in\">log</span> --port 27052 --configdb configRepl/localhost:27059,localhost:27060,localhost:27061 --keyFile /mongodb/mtools/sharded/data/keyfile --fork</span><br><span class=\"line\"></span><br><span class=\"line\">config server    27059    running    61903    mongod --replSet configRepl --dbpath /mongodb/mtools/sharded/data/configRepl/rs1/db --logpath /mongodb/mtools/sharded/data/configRepl/rs1/mongod.log --port 27059 --fork --keyFile /mongodb/mtools/sharded/data/keyfile --configsvr --wiredTigerCacheSizeGB 1</span><br><span class=\"line\">config server    27060    running    61911    mongod --replSet configRepl --dbpath /mongodb/mtools/sharded/data/configRepl/rs2/db --logpath /mongodb/mtools/sharded/data/configRepl/rs2/mongod.log --port 27060 --fork --keyFile /mongodb/mtools/sharded/data/keyfile --configsvr --wiredTigerCacheSizeGB 1</span><br><span class=\"line\">config server    27061    running    61914    mongod --replSet configRepl --dbpath /mongodb/mtools/sharded/data/configRepl/rs3/db --logpath /mongodb/mtools/sharded/data/configRepl/rs3/mongod.log --port 27061 --fork --keyFile /mongodb/mtools/sharded/data/keyfile --configsvr --wiredTigerCacheSizeGB 1</span><br><span class=\"line\"></span><br><span class=\"line\">shard01</span><br><span class=\"line\">    mongod       27053    running    61922    mongod --replSet shard01 --dbpath /mongodb/mtools/sharded/data/shard01/rs1/db --logpath /mongodb/mtools/sharded/data/shard01/rs1/mongod.log --port 27053 --fork --keyFile /mongodb/mtools/sharded/data/keyfile --shardsvr --wiredTigerCacheSizeGB 1</span><br><span class=\"line\">    mongod       27054    running    61947    mongod --replSet shard01 --dbpath /mongodb/mtools/sharded/data/shard01/rs2/db --logpath /mongodb/mtools/sharded/data/shard01/rs2/mongod.log --port 27054 --fork --keyFile /mongodb/mtools/sharded/data/keyfile --shardsvr --wiredTigerCacheSizeGB 1</span><br><span class=\"line\">    mongod       27055    running    61955    mongod --replSet shard01 --dbpath /mongodb/mtools/sharded/data/shard01/rs3/db --logpath /mongodb/mtools/sharded/data/shard01/rs3/mongod.log --port 27055 --fork --keyFile /mongodb/mtools/sharded/data/keyfile --shardsvr --wiredTigerCacheSizeGB 1</span><br><span class=\"line\"></span><br><span class=\"line\">shard02</span><br><span class=\"line\">    mongod       27056    running    61964    mongod --replSet shard02 --dbpath /mongodb/mtools/sharded/data/shard02/rs1/db --logpath /mongodb/mtools/sharded/data/shard02/rs1/mongod.log --port 27056 --fork --keyFile /mongodb/mtools/sharded/data/keyfile --shardsvr --wiredTigerCacheSizeGB 1</span><br><span class=\"line\">    mongod       27057    running    61972    mongod --replSet shard02 --dbpath /mongodb/mtools/sharded/data/shard02/rs2/db --logpath /mongodb/mtools/sharded/data/shard02/rs2/mongod.log --port 27057 --fork --keyFile /mongodb/mtools/sharded/data/keyfile --shardsvr --wiredTigerCacheSizeGB 1</span><br><span class=\"line\">    mongod       27058    running    61980    mongod --replSet shard02 --dbpath /mongodb/mtools/sharded/data/shard02/rs3/db --logpath /mongodb/mtools/sharded/data/shard02/rs3/mongod.log --port 27058 --fork --keyFile /mongodb/mtools/sharded/data/keyfile --shardsvr --wiredTigerCacheSizeGB 1</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    auth: <span class=\"string\">&quot;user:password&quot;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"stop-å…³é—­-mongoè¿›ç¨‹\">stop: å…³é—­ mongoè¿›ç¨‹</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å…³é—­å…¨éƒ¨mongoè¿›ç¨‹ï¼Œæ³¨æ„ï¼šå¦‚æœå¼€å¯äº†è®¤è¯ï¼Œstopä¼šä½¿ç”¨é»˜è®¤çš„ç”¨æˆ·åå’Œå¯†ç è¿›è¡Œè®¤è¯ï¼ˆuser/passwordï¼‰ï¼Œå¦åˆ™éœ€è¦ä½¿ç”¨ kill</span></span><br><span class=\"line\">$ mlaunch stop</span><br><span class=\"line\">Detected mongod version: 7.0.6</span><br><span class=\"line\">sent signal 15 to 11 processes.</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åªå…³é—­mongosè¿›ç¨‹ï¼Œè¿™é‡Œmongosæ˜¯tag</span></span><br><span class=\"line\">$ mlaunch stop mongos</span><br><span class=\"line\">Detected mongod version: 7.0.6</span><br><span class=\"line\">sent signal 15 to 2 processes.</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹å½“å‰mongoè¿›ç¨‹çŠ¶æ€</span></span><br><span class=\"line\">$ mlaunch list</span><br><span class=\"line\">Detected mongod version: 7.0.6</span><br><span class=\"line\"></span><br><span class=\"line\">PROCESS          PORT     STATUS     PID</span><br><span class=\"line\"></span><br><span class=\"line\">mongos           27050    down       -</span><br><span class=\"line\">mongos           27051    down       -</span><br><span class=\"line\"></span><br><span class=\"line\">config server    27058    running    23284</span><br><span class=\"line\">config server    27059    running    23287</span><br><span class=\"line\">config server    27060    running    23295</span><br><span class=\"line\"></span><br><span class=\"line\">shard01</span><br><span class=\"line\">    mongod       27052    running    23303</span><br><span class=\"line\">    mongod       27053    running    23326</span><br><span class=\"line\">    mongod       27054    running    23334</span><br><span class=\"line\"></span><br><span class=\"line\">shard02</span><br><span class=\"line\">    mongod       27055    running    23342</span><br><span class=\"line\">    mongod       27056    running    23345</span><br><span class=\"line\">    mongod       27057    running    23353</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\tauth: <span class=\"string\">&quot;user:password&quot;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"start-å¯åŠ¨-mongoè¿›ç¨‹\">start: å¯åŠ¨ mongoè¿›ç¨‹</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å¯åŠ¨å…¨éƒ¨mongoè¿›ç¨‹</span></span><br><span class=\"line\">$ mlaunch start</span><br><span class=\"line\">Detected mongod version: 7.0.6</span><br><span class=\"line\">launching: config server on port 27058</span><br><span class=\"line\">launching: config server on port 27059</span><br><span class=\"line\">launching: config server on port 27060</span><br><span class=\"line\">launching: <span class=\"string\">&quot;mongod&quot;</span> on port 27052</span><br><span class=\"line\">launching: <span class=\"string\">&quot;mongod&quot;</span> on port 27053</span><br><span class=\"line\">launching: <span class=\"string\">&quot;mongod&quot;</span> on port 27054</span><br><span class=\"line\">launching: <span class=\"string\">&quot;mongod&quot;</span> on port 27055</span><br><span class=\"line\">launching: <span class=\"string\">&quot;mongod&quot;</span> on port 27056</span><br><span class=\"line\">launching: <span class=\"string\">&quot;mongod&quot;</span> on port 27057</span><br><span class=\"line\">launching: mongos on port 27050</span><br><span class=\"line\">launching: mongos on port 27051</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åªå¯åŠ¨å½“å‰å…³é—­çš„mongoè¿›ç¨‹</span></span><br><span class=\"line\">$ mlaunch start down</span><br><span class=\"line\">Detected mongod version: 7.0.6</span><br><span class=\"line\">launching: mongos on port 27050</span><br><span class=\"line\">launching: mongos on port 27051</span><br></pre></td></tr></table></figure>\n<h3 id=\"restart-é‡å¯-mongoè¿›ç¨‹\">restart: é‡å¯ mongoè¿›ç¨‹</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># é‡å¯ï¼Œä¸æ¨èä½¿ç”¨ï¼Œé™¤äº†å•å®ä¾‹ï¼Œå¤åˆ¶é›†å’Œåˆ†ç‰‡é›†ç¾¤éƒ½ä¼šå‡ºé—®é¢˜</span></span><br><span class=\"line\">$ mlaunch restart</span><br><span class=\"line\"><span class=\"comment\"># ä»¥ä¸‹æ˜¯åˆ†ç‰‡é›†ç¾¤é‡å¯åçš„æŠ¥é”™ä¿¡æ¯ï¼ŒçŒœæµ‹åŸå› æ˜¯å¹¶æ²¡æœ‰å®Œå…¨å…³é—­mongoåˆ†ç‰‡é›†ç¾¤ä¸­çš„æ‰€æœ‰èŠ‚ç‚¹æ—¶å°±å¯åŠ¨äº†</span></span><br><span class=\"line\">Detected mongod version: 7.0.6</span><br><span class=\"line\">sent signal 15 to 11 processes.</span><br><span class=\"line\">b<span class=\"string\">&#x27;about to fork child process, waiting until server is ready for connections.\\nforked process: 20202\\nERROR: child process failed, exited with 1\\nTo see additional information in this output, start without the &quot;--fork&quot; option.\\n&#x27;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"kill-æ€æ‰-mongoè¿›ç¨‹\">kill: æ€æ‰ mongoè¿›ç¨‹</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æ€æ‰å…¨éƒ¨mongoè¿›ç¨‹</span></span><br><span class=\"line\">$ mlaunch <span class=\"built_in\">kill</span></span><br><span class=\"line\">Detected mongod version: 7.0.6</span><br><span class=\"line\">sent signal 15 to 11 processes.</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ€æ‰æŸä¸ªç«¯å£çš„mongoè¿›ç¨‹</span></span><br><span class=\"line\">$ mlaunch <span class=\"built_in\">kill</span> 27050</span><br><span class=\"line\">Detected mongod version: 7.0.6</span><br><span class=\"line\">sent signal 15 to 1 process.</span><br><span class=\"line\"><span class=\"comment\"># å¯ä»¥çœ‹åˆ°27050ç«¯å£çš„mongoè¿›ç¨‹çš„çŠ¶æ€ä¸ºdown</span></span><br><span class=\"line\">$ mlaunch list</span><br><span class=\"line\">Detected mongod version: 7.0.6</span><br><span class=\"line\"></span><br><span class=\"line\">PROCESS          PORT     STATUS     PID</span><br><span class=\"line\"></span><br><span class=\"line\">mongos           27050    down       -</span><br><span class=\"line\">mongos           27051    running    23369</span><br><span class=\"line\"></span><br><span class=\"line\">config server    27058    running    23284</span><br><span class=\"line\">config server    27059    running    23287</span><br><span class=\"line\">config server    27060    running    23295</span><br><span class=\"line\"></span><br><span class=\"line\">shard01</span><br><span class=\"line\">    mongod       27052    running    23303</span><br><span class=\"line\">    mongod       27053    running    23326</span><br><span class=\"line\">    mongod       27054    running    23334</span><br><span class=\"line\"></span><br><span class=\"line\">shard02</span><br><span class=\"line\">    mongod       27055    running    23342</span><br><span class=\"line\">    mongod       27056    running    23345</span><br><span class=\"line\">    mongod       27057    running    23353</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\tauth: <span class=\"string\">&quot;user:password&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å…³é—­å…¨éƒ¨mongosè¿›ç¨‹</span></span><br><span class=\"line\">$ mlaunch <span class=\"built_in\">kill</span> mongos</span><br></pre></td></tr></table></figure>\n<div class=\"tips\">\n<p><em><strong>æ”¯æŒçš„tags</strong></em></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">allï¼šç¯å¢ƒä¸­çš„æ‰€æœ‰èŠ‚ç‚¹ã€‚</span><br><span class=\"line\">runningï¼šæ‰€æœ‰å½“å‰è¿è¡Œçš„èŠ‚ç‚¹ã€‚</span><br><span class=\"line\">downï¼šç›®å‰æ‰€æœ‰å…³é—­çš„èŠ‚ç‚¹ã€‚</span><br><span class=\"line\">mongosï¼šæ‰€æœ‰mongosè¿›ç¨‹éƒ½å¸¦æœ‰æ­¤æ ‡ç­¾ã€‚</span><br><span class=\"line\">mongodï¼šæ‰€æœ‰mongodè¿›ç¨‹ï¼ˆåŒ…æ‹¬ä»²è£è€…å’Œé…ç½®æœåŠ¡å™¨ï¼‰ã€‚</span><br><span class=\"line\">configï¼šæ‰€æœ‰é…ç½®æœåŠ¡å™¨</span><br><span class=\"line\">&lt;shard name&gt;ï¼šå¯¹äºåˆ†ç‰‡ç¯å¢ƒï¼Œåˆ†ç‰‡çš„æ¯ä¸ªæˆå‘˜éƒ½å¸¦æœ‰åˆ†ç‰‡åç§°ä½œä¸ºæ ‡ç­¾ï¼Œä¾‹å¦‚â€œshard-aâ€ã€‚</span><br><span class=\"line\">&lt;port number&gt;ï¼šæ¯ä¸ªèŠ‚ç‚¹éƒ½å¸¦æœ‰å…¶ç«¯å£å·ä½œä¸ºæ ‡ç­¾ã€‚</span><br></pre></td></tr></table></figure>\n</div>\n","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç»mtoolså·¥å…·çš„ä½¿ç”¨ mtoolså®˜æ–¹æ–‡æ¡£ï¼Œmtools-github mtoolsæä¾›çš„mlaunchæ˜¯ä¸€ä¸ªåŸºäºpythonçš„mongoç¯å¢ƒç®¡ç†å·¥å…·ï¼Œå¯ä»¥æ–¹ä¾¿çš„å¯åŠ¨ã€åœæ­¢ã€é‡å¯ã€kill mongoè¿›ç¨‹ï¼Œè¿˜å¯ä»¥æŸ¥çœ‹mongoè¿›ç¨‹çš„è¿è¡ŒçŠ¶æ€ï¼Œå¯ä»¥æ–¹ä¾¿åˆå­¦è€…å¿«é€Ÿæ­å»ºæœ¬åœ°mongoç¯å¢ƒï¼Œä½†æ˜¯å…¶åªèƒ½åœ¨ä¸€å°æœºå™¨ä¸Šè¿è¡Œã€‚ mtoolså®‰è£… mtoolsåŸºäºpython3ï¼Œæ”¯æŒmongo4+ä»¥ä¸Šç‰ˆæœ¬ï¼Œä½†æ˜¯mtoolså¹¶ä¸”ä¸ä¼šä¸ºæˆ‘ä»¬å®‰è£…mongodbï¼Œæ‰€ä»¥éœ€è¦æˆ‘ä»¬è‡ªå·±å…ˆåœ¨ç³»ç»Ÿä¸­å®‰è£…å¥½mongodbï¼Œmongodbçš„å®‰è£…å¯ä»¥å‚è€ƒMongoDB7.0çš„å®‰è£… æŒ‰ç…§å®˜ç½‘çš„è¯´æ³•ï¼Œmtoolsæ”¯æŒçš„Pythonç‰ˆæœ¬ä¸º 3.7|3.8|3.9|3.10ï¼Œå…¶ä»–ç‰ˆæœ¬çš„Pythonç›®å‰ä¸å—æ”¯æŒæˆ–æµ‹è¯•ï¼Œä½†ä½œè€…çš„pythonç‰ˆæœ¬ä¸º3.11.3ï¼Œå¹¶æ²¡æœ‰å‡ºç°å…¼å®¹æ€§é—®é¢˜ã€‚ 123456789101112131415161718192021222324252627âœ ~ python3 --versionPython 3.11.3âœ ~ pip3 -Vpip 24.0 from /usr/local/lib/python3.11/site-packages/pip (python 3.11)âœ ~ pip3 listPackage Version----------------- ------------certifi 2023.11.17cffi 1.16.0cryptography 41.0.7docutils 0.20.1idna 3.6Jinja2 3.1.2MarkupSafe 2.1.3packaging 23.2pip 24.0pycparser 2.21Pygments 2.17.2pyparsing 3.1.1pytz 2023.3.post1requests 2.31.0setuptools 68.2.2six 1.16.0tabulate 0.0.0typing_extensions 4.9.0urllib3 2.1.0wheel 0.41.2 å®‰è£…mtoolsä¾èµ– 1pip3 install python-dateutil psutil pymongo å®‰è£…mtools 1pip3 install mtools å®‰è£…mtoolsä¼šåŒæ—¶ä¸ºæˆ‘ä»¬å®‰è£…mtoolsçš„æ‰€æœ‰å·¥å…·ï¼Œå¦‚æœåªå¸Œæœ›å®‰è£…mlaunchï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤ mtoolsæä¾›çš„å…¶å®ƒå·¥å…·ï¼Œå¦‚mlogfilter,mloginfo,mplotqueriesç­‰å¹¶ä¸æ”¯æŒlogv2æ ¼å¼çš„æ—¥å¿—ï¼Œlogv2æ˜¯mongodb4.4+ä»¥åçš„åŠ å…¥çš„ï¼Œä»mongodb5.0ä»¥ålogv2ä¸ºé»˜è®¤çš„æ—¥å¿—æ ¼å¼ï¼Œæ‰€ä»¥è¿™é‡Œä¸åšä»‹ç»ã€‚ 1pip3 install &#x27;mtools[mlaunch]&#x27; mlaunch æŸ¥çœ‹mlaunchç‰ˆæœ¬ 12345âœ ~ which mlaunch/usr/local/bin/mlaunchâœ ~ mlaunch --versionDetected mongod version: 7.0.6mtools version 1.7.2 || Python 3.11.6 (main, Oct 3 2023, 02:51:45) [Clang 14.0.3 (clang-1403.0.22.14.1)] init :æ„å»ºç¯å¢ƒ æ­¤å‘½ä»¤åˆå§‹åŒ–å¹¶å¯åŠ¨MongoDBç‹¬ç«‹å®ä¾‹ã€å‰¯æœ¬é›†æˆ–åˆ†ç‰‡é›†ç¾¤ï¼Œå®ƒåªéœ€è¦ä¸ºæ¯ä¸ªç¯å¢ƒè°ƒç”¨ä¸€æ¬¡ã€‚ æ„å»ºç‹¬ç«‹å®ä¾‹ 123456789101112131415161718# å¿«é€Ÿæ„å»ºä¸€ä¸ªå•èŠ‚ç‚¹ï¼Œæ•°æ®ç›®å½•åœ¨å½“å‰è·¯å¾„ä¸‹çš„dataç›®å½•ä¸‹$ mlaunch init --single --authDetected mongod version: 7.0.6Generating keyfile: /mongodb/mtools/single/data/keyfilelaunching: &quot;mongod&quot; on port 27017Username &quot;user&quot;, password &quot;password&quot;# å‚æ•°è¯´æ˜# --single ï¼šå¯åŠ¨å•èŠ‚ç‚¹# --auth ï¼šå¼€å¯é»˜è®¤è®¤è¯ï¼Œé»˜è®¤ç”¨æˆ·å/å¯†ç :user/passwordï¼Œå¹¶æˆäºˆå¦‚ä¸‹è§’è‰² # &#123; role: &#x27;userAdminAnyDatabase&#x27;, db: &#x27;admin&#x27; &#125;, # &#123; role: &#x27;readWriteAnyDatabase&#x27;, db: &#x27;admin&#x27; &#125;, # &#123; role: &#x27;dbAdminAnyDatabase&#x27;, db: &#x27;admin&#x27; &#125;, # &#123; role: &#x27;clusterAdmin&#x27;, db: &#x27;admin&#x27; &#125;# --dir ï¼šæŒ‡å®šæ•°æ®ç›®å½•ï¼Œé»˜è®¤ä¸ºå½“å‰è·¯å¾„ä¸‹çš„dataç›®å½•# --bind_ipï¼šæŒ‡å®šç›‘å¬ipï¼Œé»˜è®¤ä¸º127.0.0.1# --portï¼šæŒ‡å®šç›‘å¬ç«¯å£ï¼Œé»˜è®¤ä¸º27017 æ„å»ºå¤åˆ¶é›† 123456789101112131415# å¿«é€Ÿæ„å»ºä¸€ä¸ª3èŠ‚ç‚¹çš„å¤åˆ¶é›†$ mlaunch init --replicaset --nodes 3 --auth --port 27040Detected mongod version: 7.0.6Generating keyfile: /mongodb/mtools/replicaset/data/keyfilelaunching: &quot;mongod&quot; on port 27040launching: &quot;mongod&quot; on port 27041launching: &quot;mongod&quot; on port 27042replica set &#x27;replset&#x27; initialized.waiting for primary to add a user.Username &quot;user&quot;, password &quot;password&quot;# --replicaset ï¼šåˆ›å»ºå‰¯æœ¬é›†ï¼Œé»˜è®¤3ä¸ªèŠ‚ç‚¹# --nodes 3 ï¼šæŒ‡å®šå‰¯æœ¬é›†èŠ‚ç‚¹ä¸ªæ•°ï¼Œé»˜è®¤3ä¸ªèŠ‚ç‚¹# --auth : å¼€å¯é»˜è®¤è®¤è¯ï¼ŒåŒå•èŠ‚ç‚¹# --port 27040 : æŒ‡å®šå¤åˆ¶é›†çš„èµ·å§‹ç«¯å£ï¼Œé»˜è®¤ä»27017å¼€å§‹ï¼Œä¾æ¬¡é€’å¢ æ„å»ºåˆ†ç‰‡é›†ç¾¤ 12345678910111213141516171819202122232425262728293031323334353637383940414243# å¿«é€Ÿæ„å»ºä¸€ä¸ª2ä¸ªåˆ†ç‰‡çš„åˆ†ç‰‡é›†ç¾¤ï¼Œæ¯ä¸ªåˆ†ç‰‡æ˜¯ä¸€ä¸ªåŒ…å«3æ¯ä¸ªèŠ‚ç‚¹çš„å¤åˆ¶é›†ï¼ŒåŒ…å«ä¸€ä¸ª3ä¸ªèŠ‚ç‚¹é…ç½®å¤åˆ¶é›†ï¼Œå¹¶ä¸”å¯åŠ¨3ä¸ªmongosè·¯ç”±$ mlaunch init --sharded 2 --replicaset --node 3 --config 3 --csrs --mongos 3 --auth --port 27050Detected mongod version: 7.0.6Generating keyfile: /mongodb/mtools/sharded/data/keyfilelaunching: &quot;mongod&quot; on port 27053launching: &quot;mongod&quot; on port 27054launching: &quot;mongod&quot; on port 27055launching: &quot;mongod&quot; on port 27056launching: &quot;mongod&quot; on port 27057launching: &quot;mongod&quot; on port 27058launching: config server on port 27059launching: config server on port 27060launching: config server on port 27061replica set &#x27;configRepl&#x27; initialized.replica set &#x27;shard01&#x27; initialized.replica set &#x27;shard02&#x27; initialized.launching: mongos on port 27050launching: mongos on port 27051launching: mongos on port 27052adding shards. can take up to 30 seconds...sent signal 15 to 12 processes.launching: config server on port 27059launching: config server on port 27060launching: config server on port 27061launching: &quot;mongod&quot; on port 27053launching: &quot;mongod&quot; on port 27054launching: &quot;mongod&quot; on port 27055launching: &quot;mongod&quot; on port 27056launching: &quot;mongod&quot; on port 27057launching: &quot;mongod&quot; on port 27058launching: mongos on port 27050launching: mongos on port 27051launching: mongos on port 27052Username &quot;user&quot;, password &quot;password&quot;# --sharded 2ï¼šå¯ç”¨åˆ†ç‰‡é›†ç¾¤æ¨¡å¼ï¼Œåˆ†ç‰‡æ•°ä¸º2ã€‚# --replicaset : åˆ›å»ºå‰¯æœ¬é›†ï¼Œé»˜è®¤3ä¸ªèŠ‚ç‚¹ï¼Œå¯ä»¥é€šè¿‡ --nodes æŒ‡å®šå¤åˆ¶é›†èŠ‚ç‚¹ä¸ªæ•°# --nodes 3ï¼šé‡‡ç”¨3èŠ‚ç‚¹çš„å¤åˆ¶é›†æ¶æ„ï¼Œé»˜è®¤å°±æ˜¯3ä¸ªèŠ‚ç‚¹ã€‚# --config 3ï¼šé…ç½®æœåŠ¡å™¨é‡‡ç”¨3èŠ‚ç‚¹çš„å¤åˆ¶é›†æ¶æ„æ¨¡å¼# --csrsï¼šæŒ‡Config Server as a Replica Setï¼Œè¿™ä¸ªä¹Ÿæ˜¯é»˜è®¤é…ç½®# --mongos 3ï¼šå¯åŠ¨3ä¸ªmongoså®ä¾‹è¿›ç¨‹ã€‚# --auth : å¼€å¯é»˜è®¤è®¤è¯ï¼ŒåŒå•èŠ‚ç‚¹# --port 27050ï¼šé›†ç¾¤å°†ä»¥27050ä½œä¸ºèµ·å§‹ç«¯å£ï¼Œé›†ç¾¤ä¸­çš„å„ä¸ªå®ä¾‹åŸºäºè¯¥ç«¯å£å‘ä¸Šé€’å¢ã€‚ ä»¥ä¸‹å‘½ä»¤è¿è¡Œæ—¶å¿…é¡»æŒ‡å®šæ•°æ®ç›®å½•ï¼Œé»˜è®¤ä¸ºå½“å‰è·¯å¾„ä¸‹çš„dataç›®å½•ï¼Œå¯ä»¥ä½¿ç”¨--diræŒ‡å®šæ•°æ®ç›®å½•ï¼Œå› ä¸ºéœ€è¦é€šè¿‡./data/.mlaunch_startupæ¥è·å–mongoçš„æ„å»ºä¿¡æ¯ã€‚ä»¥åˆ†ç‰‡é›†ç¾¤ä¸¾ä¾‹ï¼š list: æŸ¥çœ‹å¯åŠ¨ä¿¡æ¯ æŸ¥çœ‹é›†ç¾¤çŠ¶æ€ 1234567891011121314151617181920212223# æ˜¾ç¤ºmongoè¿›ç¨‹çš„åˆ—è¡¨$ mlaunch listDetected mongod version: 7.0.6PROCESS PORT STATUS PIDmongos 27050 running 61988mongos 27051 running 61991mongos 27052 running 61999config server 27059 running 61903config server 27060 running 61911config server 27061 running 61914shard01 mongod 27053 running 61922 mongod 27054 running 61947 mongod 27055 running 61955shard02 mongod 27056 running 61964 mongod 27057 running 61972 mongod 27058 running 61980 æŸ¥çœ‹å¯åŠ¨å‘½ä»¤ 12345678910111213141516171819202122232425$ mlaunch list --startupDetected mongod version: 7.0.6PROCESS PORT STATUS PID STARTUP COMMANDmongos 27050 running 61988 mongos --logpath /mongodb/mtools/sharded/data/mongos/mongos_27050.log --port 27050 --configdb configRepl/localhost:27059,localhost:27060,localhost:27061 --keyFile /mongodb/mtools/sharded/data/keyfile --forkmongos 27051 running 61991 mongos --logpath /mongodb/mtools/sharded/data/mongos/mongos_27051.log --port 27051 --configdb configRepl/localhost:27059,localhost:27060,localhost:27061 --keyFile /mongodb/mtools/sharded/data/keyfile --forkmongos 27052 running 61999 mongos --logpath /mongodb/mtools/sharded/data/mongos/mongos_27052.log --port 27052 --configdb configRepl/localhost:27059,localhost:27060,localhost:27061 --keyFile /mongodb/mtools/sharded/data/keyfile --forkconfig server 27059 running 61903 mongod --replSet configRepl --dbpath /mongodb/mtools/sharded/data/configRepl/rs1/db --logpath /mongodb/mtools/sharded/data/configRepl/rs1/mongod.log --port 27059 --fork --keyFile /mongodb/mtools/sharded/data/keyfile --configsvr --wiredTigerCacheSizeGB 1config server 27060 running 61911 mongod --replSet configRepl --dbpath /mongodb/mtools/sharded/data/configRepl/rs2/db --logpath /mongodb/mtools/sharded/data/configRepl/rs2/mongod.log --port 27060 --fork --keyFile /mongodb/mtools/sharded/data/keyfile --configsvr --wiredTigerCacheSizeGB 1config server 27061 running 61914 mongod --replSet configRepl --dbpath /mongodb/mtools/sharded/data/configRepl/rs3/db --logpath /mongodb/mtools/sharded/data/configRepl/rs3/mongod.log --port 27061 --fork --keyFile /mongodb/mtools/sharded/data/keyfile --configsvr --wiredTigerCacheSizeGB 1shard01 mongod 27053 running 61922 mongod --replSet shard01 --dbpath /mongodb/mtools/sharded/data/shard01/rs1/db --logpath /mongodb/mtools/sharded/data/shard01/rs1/mongod.log --port 27053 --fork --keyFile /mongodb/mtools/sharded/data/keyfile --shardsvr --wiredTigerCacheSizeGB 1 mongod 27054 running 61947 mongod --replSet shard01 --dbpath /mongodb/mtools/sharded/data/shard01/rs2/db --logpath /mongodb/mtools/sharded/data/shard01/rs2/mongod.log --port 27054 --fork --keyFile /mongodb/mtools/sharded/data/keyfile --shardsvr --wiredTigerCacheSizeGB 1 mongod 27055 running 61955 mongod --replSet shard01 --dbpath /mongodb/mtools/sharded/data/shard01/rs3/db --logpath /mongodb/mtools/sharded/data/shard01/rs3/mongod.log --port 27055 --fork --keyFile /mongodb/mtools/sharded/data/keyfile --shardsvr --wiredTigerCacheSizeGB 1shard02 mongod 27056 running 61964 mongod --replSet shard02 --dbpath /mongodb/mtools/sharded/data/shard02/rs1/db --logpath /mongodb/mtools/sharded/data/shard02/rs1/mongod.log --port 27056 --fork --keyFile /mongodb/mtools/sharded/data/keyfile --shardsvr --wiredTigerCacheSizeGB 1 mongod 27057 running 61972 mongod --replSet shard02 --dbpath /mongodb/mtools/sharded/data/shard02/rs2/db --logpath /mongodb/mtools/sharded/data/shard02/rs2/mongod.log --port 27057 --fork --keyFile /mongodb/mtools/sharded/data/keyfile --shardsvr --wiredTigerCacheSizeGB 1 mongod 27058 running 61980 mongod --replSet shard02 --dbpath /mongodb/mtools/sharded/data/shard02/rs3/db --logpath /mongodb/mtools/sharded/data/shard02/rs3/mongod.log --port 27058 --fork --keyFile /mongodb/mtools/sharded/data/keyfile --shardsvr --wiredTigerCacheSizeGB 1 auth: &quot;user:password&quot; stop: å…³é—­ mongoè¿›ç¨‹ 12345678910111213141516171819202122232425262728293031323334# å…³é—­å…¨éƒ¨mongoè¿›ç¨‹ï¼Œæ³¨æ„ï¼šå¦‚æœå¼€å¯äº†è®¤è¯ï¼Œstopä¼šä½¿ç”¨é»˜è®¤çš„ç”¨æˆ·åå’Œå¯†ç è¿›è¡Œè®¤è¯ï¼ˆuser/passwordï¼‰ï¼Œå¦åˆ™éœ€è¦ä½¿ç”¨ kill$ mlaunch stopDetected mongod version: 7.0.6sent signal 15 to 11 processes.# åªå…³é—­mongosè¿›ç¨‹ï¼Œè¿™é‡Œmongosæ˜¯tag$ mlaunch stop mongosDetected mongod version: 7.0.6sent signal 15 to 2 processes.# æŸ¥çœ‹å½“å‰mongoè¿›ç¨‹çŠ¶æ€$ mlaunch listDetected mongod version: 7.0.6PROCESS PORT STATUS PIDmongos 27050 down -mongos 27051 down -config server 27058 running 23284config server 27059 running 23287config server 27060 running 23295shard01 mongod 27052 running 23303 mongod 27053 running 23326 mongod 27054 running 23334shard02 mongod 27055 running 23342 mongod 27056 running 23345 mongod 27057 running 23353 auth: &quot;user:password&quot; start: å¯åŠ¨ mongoè¿›ç¨‹ 1234567891011121314151617181920# å¯åŠ¨å…¨éƒ¨mongoè¿›ç¨‹$ mlaunch startDetected mongod version: 7.0.6launching: config server on port 27058launching: config server on port 27059launching: config server on port 27060launching: &quot;mongod&quot; on port 27052launching: &quot;mongod&quot; on port 27053launching: &quot;mongod&quot; on port 27054launching: &quot;mongod&quot; on port 27055launching: &quot;mongod&quot; on port 27056launching: &quot;mongod&quot; on port 27057launching: mongos on port 27050launching: mongos on port 27051# åªå¯åŠ¨å½“å‰å…³é—­çš„mongoè¿›ç¨‹$ mlaunch start downDetected mongod version: 7.0.6launching: mongos on port 27050launching: mongos on port 27051 restart: é‡å¯ mongoè¿›ç¨‹ 123456# é‡å¯ï¼Œä¸æ¨èä½¿ç”¨ï¼Œé™¤äº†å•å®ä¾‹ï¼Œå¤åˆ¶é›†å’Œåˆ†ç‰‡é›†ç¾¤éƒ½ä¼šå‡ºé—®é¢˜$ mlaunch restart# ä»¥ä¸‹æ˜¯åˆ†ç‰‡é›†ç¾¤é‡å¯åçš„æŠ¥é”™ä¿¡æ¯ï¼ŒçŒœæµ‹åŸå› æ˜¯å¹¶æ²¡æœ‰å®Œå…¨å…³é—­mongoåˆ†ç‰‡é›†ç¾¤ä¸­çš„æ‰€æœ‰èŠ‚ç‚¹æ—¶å°±å¯åŠ¨äº†Detected mongod version: 7.0.6sent signal 15 to 11 processes.b&#x27;about to fork child process, waiting until server is ready for connections.\\nforked process: 20202\\nERROR: child process failed, exited with 1\\nTo see additional information in this output, start without the &quot;--fork&quot; option.\\n&#x27; kill: æ€æ‰ mongoè¿›ç¨‹ 12345678910111213141516171819202122232425262728293031323334353637# æ€æ‰å…¨éƒ¨mongoè¿›ç¨‹$ mlaunch killDetected mongod version: 7.0.6sent signal 15 to 11 processes.# æ€æ‰æŸä¸ªç«¯å£çš„mongoè¿›ç¨‹$ mlaunch kill 27050Detected mongod version: 7.0.6sent signal 15 to 1 process.# å¯ä»¥çœ‹åˆ°27050ç«¯å£çš„mongoè¿›ç¨‹çš„çŠ¶æ€ä¸ºdown$ mlaunch listDetected mongod version: 7.0.6PROCESS PORT STATUS PIDmongos 27050 down -mongos 27051 running 23369config server 27058 running 23284config server 27059 running 23287config server 27060 running 23295shard01 mongod 27052 running 23303 mongod 27053 running 23326 mongod 27054 running 23334shard02 mongod 27055 running 23342 mongod 27056 running 23345 mongod 27057 running 23353 auth: &quot;user:password&quot;# å…³é—­å…¨éƒ¨mongosè¿›ç¨‹$ mlaunch kill mongos æ”¯æŒçš„tags 12345678allï¼šç¯å¢ƒä¸­çš„æ‰€æœ‰èŠ‚ç‚¹ã€‚runningï¼šæ‰€æœ‰å½“å‰è¿è¡Œçš„èŠ‚ç‚¹ã€‚downï¼šç›®å‰æ‰€æœ‰å…³é—­çš„èŠ‚ç‚¹ã€‚mongosï¼šæ‰€æœ‰mongosè¿›ç¨‹éƒ½å¸¦æœ‰æ­¤æ ‡ç­¾ã€‚mongodï¼šæ‰€æœ‰mongodè¿›ç¨‹ï¼ˆåŒ…æ‹¬ä»²è£è€…å’Œé…ç½®æœåŠ¡å™¨ï¼‰ã€‚configï¼šæ‰€æœ‰é…ç½®æœåŠ¡å™¨&lt;shard name&gt;ï¼šå¯¹äºåˆ†ç‰‡ç¯å¢ƒï¼Œåˆ†ç‰‡çš„æ¯ä¸ªæˆå‘˜éƒ½å¸¦æœ‰åˆ†ç‰‡åç§°ä½œä¸ºæ ‡ç­¾ï¼Œä¾‹å¦‚â€œshard-aâ€ã€‚&lt;port number&gt;ï¼šæ¯ä¸ªèŠ‚ç‚¹éƒ½å¸¦æœ‰å…¶ç«¯å£å·ä½œä¸ºæ ‡ç­¾ã€‚","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç»mtoolså·¥å…·çš„ä½¿ç”¨ mtoolså®˜æ–¹æ–‡æ¡£ï¼Œmtools-github mtoolsæä¾›çš„mlaunchæ˜¯ä¸€ä¸ªåŸºäºpythonçš„mongoç¯å¢ƒç®¡ç†å·¥å…·ï¼Œå¯ä»¥æ–¹ä¾¿çš„å¯åŠ¨ã€åœæ­¢ã€é‡å¯ã€kill mongoè¿›ç¨‹ï¼Œè¿˜å¯ä»¥æŸ¥çœ‹mongoè¿›ç¨‹çš„è¿è¡ŒçŠ¶æ€ï¼Œå¯ä»¥æ–¹ä¾¿åˆå­¦è€…å¿«é€Ÿæ­å»ºæœ¬åœ°mongoç¯å¢ƒï¼Œä½†æ˜¯å…¶åªèƒ½åœ¨ä¸€å°æœºå™¨ä¸Šè¿è¡Œã€‚","date_published":"2024-03-14T13:30:05.000Z","tags":["æŠ€æœ¯","mac","mongodb","mongodb"]},{"id":"https://blog.hanqunfeng.com/2024/03/13/linux-command14-setting/","url":"https://blog.hanqunfeng.com/2024/03/13/linux-command14-setting/","title":"Linuxå¸¸ç”¨å‘½ä»¤--å¸¸ç”¨è®¾ç½®","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å®‰è£…å®Œlinuxåï¼Œä¸€äº›å¸¸ç”¨çš„è®¾ç½®å¯ä»¥æ–¹ä¾¿æˆ‘ä»¬ä»Šåçš„ä½¿ç”¨ï¼Œæ¯”å¦‚å…³é—­SELinuxï¼Œå¢åŠ æ–‡ä»¶æè¿°ç¬¦é™åˆ¶ï¼Œç­‰ç­‰ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡åŸºäºCentOS8ã€‚</p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"å…³é—­SELinux\">å…³é—­SELinux</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>SELinuxï¼ˆSecurity-Enhanced Linuxï¼‰æ˜¯ä¸€ç§åŸºäºå®‰å…¨ç­–ç•¥çš„ Linux å®‰å…¨æ¨¡å—ï¼Œå…¶ä¸»è¦ç›®çš„æ˜¯æä¾›å¯¹å„ç§åº”ç”¨ç¨‹åºå’Œè¿›ç¨‹çš„æ›´ç»†ç²’åº¦çš„è®¿é—®æ§åˆ¶ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>SELinux çš„å®‰å…¨æ–¹æ¡ˆä¸»è¦åŸºäºä»¥ä¸‹ä¸¤ä¸ªç­–ç•¥ï¼š</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-6\">å¼ºåˆ¶è®¿é—®æ§åˆ¶ï¼ˆMandatory Access Control, MACï¼‰ï¼šMAC ç­–ç•¥ä¸å…è®¸ç”¨æˆ·åœ¨ä»–ä»¬æ‹¥æœ‰çš„æ–‡ä»¶å’Œè¿›ç¨‹ä¸Šè®¾ç½®å®‰å…¨è®¿é—®æ§åˆ¶ï¼Œè€Œæ˜¯æ ¹æ®ä¸€ä¸ªç”±ç³»ç»Ÿç®¡ç†å‘˜å’Œ/æˆ–æ“ä½œç³»ç»Ÿå¼€å‘å•†å®šä¹‰çš„é›†ä¸­å®‰å…¨ç­–ç•¥è¿›è¡Œè®¿é—®æ§åˆ¶ã€‚</li>\n<li class=\"lvl-6\">ç±»å‹å¼ºåˆ¶è®¿é—®æ§åˆ¶ï¼ˆType Enforcementï¼‰ï¼šé€šè¿‡å°†æ–‡ä»¶ã€ç›®å½•å’Œå…¶ä»–èµ„æºåˆ†é…åˆ°ç±»å‹ï¼Œå¹¶å®šä¹‰å®ƒä»¬ä¹‹é—´çš„äº¤äº’ï¼Œé™åˆ¶è¿›ç¨‹åœ¨èµ„æºä¹‹é—´çš„ä¿¡æ¯æµã€‚</li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<p>åœ¨å®é™…å·¥ä½œä¸­ï¼ŒSELinux å¯ä»¥ç”¨æ¥é˜»æ­¢æˆ–é™åˆ¶æ¶æ„æˆ–æŸåçš„åº”ç”¨ç¨‹åºå¯¹ç³»ç»Ÿé€ æˆçš„æŸå®³ã€‚å½“é…ç½®æ­£ç¡®æ—¶ï¼ŒSELinux æä¾›çš„å¼ºå¤§å®‰å…¨æœºåˆ¶å¯ä»¥æ˜¾è‘—æé«˜ç³»ç»Ÿçš„å®‰å…¨æ€§ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä½†æ˜¯ï¼ŒSELinux ä¹Ÿå¯èƒ½ä¼šå¸¦æ¥ä¸€äº›é—®é¢˜ï¼Œä¾‹å¦‚ï¼Œå®ƒå¯èƒ½ä¼šå¯¼è‡´æŸäº›åº”ç”¨ç¨‹åºæ— æ³•æ­£å¸¸å·¥ä½œï¼Œæˆ–è€…å®ƒå¯èƒ½ä¼šåœ¨æŸäº›æƒ…å†µä¸‹å¯¼è‡´æ€§èƒ½ä¸‹é™ã€‚å› æ­¤ï¼Œè®¸å¤š Linux å‘è¡Œç‰ˆé»˜è®¤ä¼šå…³é—­ SELinuxï¼Œä»¥é¿å…è¿™äº›é—®é¢˜ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>é€šè¿‡ä»¥ä¸‹å‘½ä»¤ï¼Œå¯ä»¥æŸ¥çœ‹å½“å‰çš„ SELinux çŠ¶æ€ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å¦‚æœå½“å‰çŠ¶æ€ä¸º Enforcingï¼Œè¡¨ç¤º SELinux å·²å¯ç”¨ï¼Œå¦åˆ™ä¸º Disabledã€‚</span></span><br><span class=\"line\">$ sestatus</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¸´æ—¶å…³é—­ SELinuxï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ setenforce 0</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ°¸ä¹…å…³é—­ SELinuxï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ vi /etc/selinux/config</span><br><span class=\"line\">    <span class=\"comment\"># åœ¨æ–‡ä»¶ä¸­æ‰¾åˆ°ä»¥ä¸‹è¡Œï¼Œå°†å€¼æ”¹ä¸º disabledã€‚</span></span><br><span class=\"line\">    SELINUX=disabled</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># é‡å¯ç³»ç»Ÿï¼ŒSELinux å°±ä¼šå…³é—­ã€‚</span></span><br><span class=\"line\">$ reboot</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¸´æ—¶å¼€å¯ SELinuxï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ setenforce 1</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ°¸ä¹…å¼€å¯ SELinuxï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ vi /etc/selinux/config</span><br><span class=\"line\">    <span class=\"comment\"># åœ¨æ–‡ä»¶ä¸­æ‰¾åˆ°ä»¥ä¸‹è¡Œï¼Œå°†å€¼æ”¹ä¸º enforcingã€‚</span></span><br><span class=\"line\">    SELINUX=enforcing</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># é‡å¯ç³»ç»Ÿï¼ŒSELinux å°±ä¼šå¼€å¯ã€‚</span></span><br><span class=\"line\">$ reboot</span><br></pre></td></tr></table></figure>\n<h2 id=\"å¢åŠ æ–‡ä»¶æè¿°ç¬¦é™åˆ¶\">å¢åŠ æ–‡ä»¶æè¿°ç¬¦é™åˆ¶</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ¯ä¸ªè¿è¡Œä¸­çš„è¿›ç¨‹éƒ½æœ‰ä¸€ä¸ªé™åˆ¶ï¼Œå³å®ƒå¯ä»¥åŒæ—¶æ‰“å¼€çš„æœ€å¤§æ–‡ä»¶æè¿°ç¬¦æ•°é‡ã€‚è¿™ä¸ªé™åˆ¶å¯¹äºé¿å…è¿‡åº¦ä½¿ç”¨ç³»ç»Ÿèµ„æºéå¸¸é‡è¦ã€‚ç„¶è€Œï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä½ å¯èƒ½éœ€è¦å¢åŠ è¿™ä¸ªé™åˆ¶æ¥æ»¡è¶³åº”ç”¨çš„éœ€æ±‚ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>Linux æœåŠ¡å™¨é»˜è®¤çš„æ–‡ä»¶æè¿°ç¬¦é™åˆ¶ä¸º 1024ï¼Œå¦‚æœéœ€è¦ä½¿ç”¨æ›´å¤šçš„æ–‡ä»¶æè¿°ç¬¦ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¥å¢åŠ é™åˆ¶ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ä¸´æ—¶è®¾ç½®ï¼Œå³åˆ»ç”Ÿæ•ˆ</span></span><br><span class=\"line\"><span class=\"built_in\">ulimit</span> -n 65535</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ°¸ä¹…è®¾ç½®</span></span><br><span class=\"line\">$ vi /etc/security/limits.conf</span><br><span class=\"line\">    <span class=\"comment\"># åœ¨æ–‡ä»¶ä¸­æ‰¾åˆ°ä»¥ä¸‹è¡Œï¼Œå°†å€¼æ”¹ä¸º 65535</span></span><br><span class=\"line\">    <span class=\"comment\"># å¦‚æœä¸å­˜åœ¨å¯¹åº”çš„é…ç½®åˆ™åœ¨æ–‡ä»¶æœ«å°¾æ·»åŠ å³å¯</span></span><br><span class=\"line\">    <span class=\"comment\"># rootç”¨æˆ·é™åˆ¶</span></span><br><span class=\"line\">    root soft nofile 65535</span><br><span class=\"line\">    root hard nofile 65535</span><br><span class=\"line\">    <span class=\"comment\"># å…¶å®ƒç”¨æˆ·é™åˆ¶</span></span><br><span class=\"line\">    * soft nofile 65535</span><br><span class=\"line\">    * hard nofile 65535</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># é‡å¯ç³»ç»Ÿï¼Œæ–‡ä»¶æè¿°ç¬¦é™åˆ¶å°±å˜äº†ã€‚</span></span><br><span class=\"line\">$ reboot</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¿™æ ·çš„è®¾ç½®æ—¢ä¸º root ç”¨æˆ·è®¾ç½®äº†æ–‡ä»¶æè¿°ç¬¦ï¼ˆå¥æŸ„ï¼‰çš„è½¯ç¡¬é™åˆ¶æ•°é‡ä¸º65535ï¼Œä¹Ÿä¸ºç³»ç»Ÿä¸­æ‰€æœ‰å…¶ä»–ç”¨æˆ·è®¾ç½®äº†åŒæ ·çš„é™åˆ¶ã€‚æ‰€è°“â€œè½¯é™åˆ¶â€æ˜¯æŒ‡ç”¨æˆ·å¯ä»¥è¾¾åˆ°ä½†ä¸èƒ½è¶…è¿‡çš„é™åˆ¶ï¼Œè€Œâ€œç¡¬é™åˆ¶â€æ˜¯æŒ‡ç³»ç»Ÿè®¾ç½®çš„ç»å¯¹é™åˆ¶ã€‚å³è½¯é™åˆ¶ä¸èƒ½å¤§äºç¡¬é™åˆ¶çš„å€¼ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>é€šè¿‡ä»¥ä¸‹å‘½ä»¤ï¼Œå¯ä»¥æŸ¥çœ‹å½“å‰çš„æ–‡ä»¶æè¿°ç¬¦é™åˆ¶ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹çš„æ˜¯å½“å‰ bash çš„â€œè½¯â€æ–‡ä»¶æè¿°ç¬¦é™åˆ¶</span></span><br><span class=\"line\">$ <span class=\"built_in\">ulimit</span> -n</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹è½¯é™åˆ¶ï¼Œåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œulimit -n å’Œ ulimit -Sn æ˜¯ç›¸åŒçš„</span></span><br><span class=\"line\">$ <span class=\"built_in\">ulimit</span> -Sn</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹ç¡¬é™åˆ¶</span></span><br><span class=\"line\">$ <span class=\"built_in\">ulimit</span> -Hn</span><br></pre></td></tr></table></figure>\n","content_text":"æ‘˜è¦ å®‰è£…å®Œlinuxåï¼Œä¸€äº›å¸¸ç”¨çš„è®¾ç½®å¯ä»¥æ–¹ä¾¿æˆ‘ä»¬ä»Šåçš„ä½¿ç”¨ï¼Œæ¯”å¦‚å…³é—­SELinuxï¼Œå¢åŠ æ–‡ä»¶æè¿°ç¬¦é™åˆ¶ï¼Œç­‰ç­‰ã€‚ æœ¬æ–‡åŸºäºCentOS8ã€‚ å…³é—­SELinux SELinuxï¼ˆSecurity-Enhanced Linuxï¼‰æ˜¯ä¸€ç§åŸºäºå®‰å…¨ç­–ç•¥çš„ Linux å®‰å…¨æ¨¡å—ï¼Œå…¶ä¸»è¦ç›®çš„æ˜¯æä¾›å¯¹å„ç§åº”ç”¨ç¨‹åºå’Œè¿›ç¨‹çš„æ›´ç»†ç²’åº¦çš„è®¿é—®æ§åˆ¶ã€‚ SELinux çš„å®‰å…¨æ–¹æ¡ˆä¸»è¦åŸºäºä»¥ä¸‹ä¸¤ä¸ªç­–ç•¥ï¼š å¼ºåˆ¶è®¿é—®æ§åˆ¶ï¼ˆMandatory Access Control, MACï¼‰ï¼šMAC ç­–ç•¥ä¸å…è®¸ç”¨æˆ·åœ¨ä»–ä»¬æ‹¥æœ‰çš„æ–‡ä»¶å’Œè¿›ç¨‹ä¸Šè®¾ç½®å®‰å…¨è®¿é—®æ§åˆ¶ï¼Œè€Œæ˜¯æ ¹æ®ä¸€ä¸ªç”±ç³»ç»Ÿç®¡ç†å‘˜å’Œ/æˆ–æ“ä½œç³»ç»Ÿå¼€å‘å•†å®šä¹‰çš„é›†ä¸­å®‰å…¨ç­–ç•¥è¿›è¡Œè®¿é—®æ§åˆ¶ã€‚ ç±»å‹å¼ºåˆ¶è®¿é—®æ§åˆ¶ï¼ˆType Enforcementï¼‰ï¼šé€šè¿‡å°†æ–‡ä»¶ã€ç›®å½•å’Œå…¶ä»–èµ„æºåˆ†é…åˆ°ç±»å‹ï¼Œå¹¶å®šä¹‰å®ƒä»¬ä¹‹é—´çš„äº¤äº’ï¼Œé™åˆ¶è¿›ç¨‹åœ¨èµ„æºä¹‹é—´çš„ä¿¡æ¯æµã€‚ åœ¨å®é™…å·¥ä½œä¸­ï¼ŒSELinux å¯ä»¥ç”¨æ¥é˜»æ­¢æˆ–é™åˆ¶æ¶æ„æˆ–æŸåçš„åº”ç”¨ç¨‹åºå¯¹ç³»ç»Ÿé€ æˆçš„æŸå®³ã€‚å½“é…ç½®æ­£ç¡®æ—¶ï¼ŒSELinux æä¾›çš„å¼ºå¤§å®‰å…¨æœºåˆ¶å¯ä»¥æ˜¾è‘—æé«˜ç³»ç»Ÿçš„å®‰å…¨æ€§ã€‚ ä½†æ˜¯ï¼ŒSELinux ä¹Ÿå¯èƒ½ä¼šå¸¦æ¥ä¸€äº›é—®é¢˜ï¼Œä¾‹å¦‚ï¼Œå®ƒå¯èƒ½ä¼šå¯¼è‡´æŸäº›åº”ç”¨ç¨‹åºæ— æ³•æ­£å¸¸å·¥ä½œï¼Œæˆ–è€…å®ƒå¯èƒ½ä¼šåœ¨æŸäº›æƒ…å†µä¸‹å¯¼è‡´æ€§èƒ½ä¸‹é™ã€‚å› æ­¤ï¼Œè®¸å¤š Linux å‘è¡Œç‰ˆé»˜è®¤ä¼šå…³é—­ SELinuxï¼Œä»¥é¿å…è¿™äº›é—®é¢˜ã€‚ é€šè¿‡ä»¥ä¸‹å‘½ä»¤ï¼Œå¯ä»¥æŸ¥çœ‹å½“å‰çš„ SELinux çŠ¶æ€ï¼š 12# å¦‚æœå½“å‰çŠ¶æ€ä¸º Enforcingï¼Œè¡¨ç¤º SELinux å·²å¯ç”¨ï¼Œå¦åˆ™ä¸º Disabledã€‚$ sestatus ä¸´æ—¶å…³é—­ SELinuxï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š 1$ setenforce 0 æ°¸ä¹…å…³é—­ SELinuxï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š 123456$ vi /etc/selinux/config # åœ¨æ–‡ä»¶ä¸­æ‰¾åˆ°ä»¥ä¸‹è¡Œï¼Œå°†å€¼æ”¹ä¸º disabledã€‚ SELINUX=disabled# é‡å¯ç³»ç»Ÿï¼ŒSELinux å°±ä¼šå…³é—­ã€‚$ reboot ä¸´æ—¶å¼€å¯ SELinuxï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š 1$ setenforce 1 æ°¸ä¹…å¼€å¯ SELinuxï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š 123456$ vi /etc/selinux/config # åœ¨æ–‡ä»¶ä¸­æ‰¾åˆ°ä»¥ä¸‹è¡Œï¼Œå°†å€¼æ”¹ä¸º enforcingã€‚ SELINUX=enforcing# é‡å¯ç³»ç»Ÿï¼ŒSELinux å°±ä¼šå¼€å¯ã€‚$ reboot å¢åŠ æ–‡ä»¶æè¿°ç¬¦é™åˆ¶ æ¯ä¸ªè¿è¡Œä¸­çš„è¿›ç¨‹éƒ½æœ‰ä¸€ä¸ªé™åˆ¶ï¼Œå³å®ƒå¯ä»¥åŒæ—¶æ‰“å¼€çš„æœ€å¤§æ–‡ä»¶æè¿°ç¬¦æ•°é‡ã€‚è¿™ä¸ªé™åˆ¶å¯¹äºé¿å…è¿‡åº¦ä½¿ç”¨ç³»ç»Ÿèµ„æºéå¸¸é‡è¦ã€‚ç„¶è€Œï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä½ å¯èƒ½éœ€è¦å¢åŠ è¿™ä¸ªé™åˆ¶æ¥æ»¡è¶³åº”ç”¨çš„éœ€æ±‚ã€‚ Linux æœåŠ¡å™¨é»˜è®¤çš„æ–‡ä»¶æè¿°ç¬¦é™åˆ¶ä¸º 1024ï¼Œå¦‚æœéœ€è¦ä½¿ç”¨æ›´å¤šçš„æ–‡ä»¶æè¿°ç¬¦ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¥å¢åŠ é™åˆ¶ï¼š 12345678910111213141516# ä¸´æ—¶è®¾ç½®ï¼Œå³åˆ»ç”Ÿæ•ˆulimit -n 65535# æ°¸ä¹…è®¾ç½®$ vi /etc/security/limits.conf # åœ¨æ–‡ä»¶ä¸­æ‰¾åˆ°ä»¥ä¸‹è¡Œï¼Œå°†å€¼æ”¹ä¸º 65535 # å¦‚æœä¸å­˜åœ¨å¯¹åº”çš„é…ç½®åˆ™åœ¨æ–‡ä»¶æœ«å°¾æ·»åŠ å³å¯ # rootç”¨æˆ·é™åˆ¶ root soft nofile 65535 root hard nofile 65535 # å…¶å®ƒç”¨æˆ·é™åˆ¶ * soft nofile 65535 * hard nofile 65535# é‡å¯ç³»ç»Ÿï¼Œæ–‡ä»¶æè¿°ç¬¦é™åˆ¶å°±å˜äº†ã€‚$ reboot è¿™æ ·çš„è®¾ç½®æ—¢ä¸º root ç”¨æˆ·è®¾ç½®äº†æ–‡ä»¶æè¿°ç¬¦ï¼ˆå¥æŸ„ï¼‰çš„è½¯ç¡¬é™åˆ¶æ•°é‡ä¸º65535ï¼Œä¹Ÿä¸ºç³»ç»Ÿä¸­æ‰€æœ‰å…¶ä»–ç”¨æˆ·è®¾ç½®äº†åŒæ ·çš„é™åˆ¶ã€‚æ‰€è°“â€œè½¯é™åˆ¶â€æ˜¯æŒ‡ç”¨æˆ·å¯ä»¥è¾¾åˆ°ä½†ä¸èƒ½è¶…è¿‡çš„é™åˆ¶ï¼Œè€Œâ€œç¡¬é™åˆ¶â€æ˜¯æŒ‡ç³»ç»Ÿè®¾ç½®çš„ç»å¯¹é™åˆ¶ã€‚å³è½¯é™åˆ¶ä¸èƒ½å¤§äºç¡¬é™åˆ¶çš„å€¼ã€‚ é€šè¿‡ä»¥ä¸‹å‘½ä»¤ï¼Œå¯ä»¥æŸ¥çœ‹å½“å‰çš„æ–‡ä»¶æè¿°ç¬¦é™åˆ¶ï¼š 123456# æŸ¥çœ‹çš„æ˜¯å½“å‰ bash çš„â€œè½¯â€æ–‡ä»¶æè¿°ç¬¦é™åˆ¶$ ulimit -n# æŸ¥çœ‹è½¯é™åˆ¶ï¼Œåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œulimit -n å’Œ ulimit -Sn æ˜¯ç›¸åŒçš„$ ulimit -Sn# æŸ¥çœ‹ç¡¬é™åˆ¶$ ulimit -Hn","summary":"æ‘˜è¦ å®‰è£…å®Œlinuxåï¼Œä¸€äº›å¸¸ç”¨çš„è®¾ç½®å¯ä»¥æ–¹ä¾¿æˆ‘ä»¬ä»Šåçš„ä½¿ç”¨ï¼Œæ¯”å¦‚å…³é—­SELinuxï¼Œå¢åŠ æ–‡ä»¶æè¿°ç¬¦é™åˆ¶ï¼Œç­‰ç­‰ã€‚ æœ¬æ–‡åŸºäºCentOS8ã€‚","date_published":"2024-03-13T13:30:05.000Z","tags":["æŠ€æœ¯","linux","linuxå¸¸ç”¨å‘½ä»¤","linuxå¸¸ç”¨å‘½ä»¤"]},{"id":"https://blog.hanqunfeng.com/2024/03/11/mongodb7-index/","url":"https://blog.hanqunfeng.com/2024/03/11/mongodb7-index/","title":"MongoDB7.0--ç´¢å¼•","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç»å¦‚ä½•ä½¿ç”¨MongoDB7.0çš„ç´¢å¼•</p>\n</li>\n<li class=\"lvl-2\">\n<p>MongoDBç‰ˆæœ¬7.0.6</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://www.mongodb.com/docs/v7.0/indexes/\">MongoDB Indexes</a></p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"MongoDBç´¢å¼•ç®€ä»‹\">MongoDBç´¢å¼•ç®€ä»‹</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç´¢å¼•æ”¯æŒåœ¨MongoDBä¸­é«˜æ•ˆæ‰§è¡ŒæŸ¥è¯¢ã€‚å¦‚æœæ²¡æœ‰ç´¢å¼•ï¼ŒMongoDBå¿…é¡»æ‰«æé›†åˆä¸­çš„æ¯ä¸ªæ–‡æ¡£æ‰èƒ½è¿”å›æŸ¥è¯¢ç»“æœã€‚å¦‚æœæŸ¥è¯¢å­˜åœ¨é€‚å½“çš„ç´¢å¼•ï¼ŒMongoDBä½¿ç”¨è¯¥ç´¢å¼•æ¥é™åˆ¶å®ƒå¿…é¡»æ‰«æçš„æ–‡æ¡£æ•°é‡ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>è™½ç„¶ç´¢å¼•å¯ä»¥æé«˜æŸ¥è¯¢æ€§èƒ½ï¼Œä½†æ·»åŠ ç´¢å¼•å¯¹å†™å…¥æ“ä½œçš„æ€§èƒ½æœ‰è´Ÿé¢å½±å“ã€‚å¯¹äºå†™å…¥è¯»æ•°æ¯”è¾ƒé«˜çš„é›†åˆï¼Œç´¢å¼•å¾ˆæ˜‚è´µï¼Œå› ä¸ºæ¯ä¸ªæ’å…¥è¿˜å¿…é¡»æ›´æ–°ä»»ä½•ç´¢å¼•ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>æ‰€ä»¥åˆç†çš„åˆ›å»ºç´¢å¼•ï¼Œå³å¯ä»¥æå‡æŸ¥è¯¢æ€§èƒ½ï¼Œåˆä¸ä¼šå¯¹å†™æ“ä½œé€ æˆå¤ªå¤§çš„å½±å“ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>MongoDBé‡‡ç”¨ <code>B-Tree (å‡†ç¡®çš„è¯´æ˜¯ B+Tree)</code> åšç´¢å¼•ï¼Œç´¢å¼•åˆ›å»ºåœ¨colletionsä¸Šã€‚</p>\n</li>\n</ul>\n<h2 id=\"åˆ›å»ºç´¢å¼•è¯­æ³•\">åˆ›å»ºç´¢å¼•è¯­æ³•</h2>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">db.collection.createIndex( keys, options )</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Key å€¼ä¸ºä½ è¦åˆ›å»ºçš„ç´¢å¼•å­—æ®µï¼Œ1 æŒ‰å‡åºåˆ›å»ºç´¢å¼•ï¼Œ -1 æŒ‰é™åºåˆ›å»ºç´¢å¼•</p>\n</li>\n<li class=\"lvl-2\">\n<p>options é€‰é¡¹</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>å‚æ•°</th>\n<th>ç±»å‹</th>\n<th>æè¿°</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>background</td>\n<td>Boolean</td>\n<td>å»ºç´¢å¼•è¿‡ç¨‹æ˜¯å¦é˜»å¡å…¶å®ƒæ•°æ®åº“æ“ä½œï¼Œè®¾ç½®ä¸º true åˆ™ä»¥åå°æ–¹å¼åˆ›å»ºç´¢å¼•</td>\n</tr>\n<tr>\n<td>unique</td>\n<td>Boolean</td>\n<td>å»ºç«‹çš„ç´¢å¼•æ˜¯å¦å”¯ä¸€ï¼Œè®¾ç½®ä¸º true åˆ™åˆ›å»ºå”¯ä¸€ç´¢å¼•</td>\n</tr>\n<tr>\n<td>name</td>\n<td>string</td>\n<td>ç´¢å¼•çš„åç§°</td>\n</tr>\n<tr>\n<td>dropDups</td>\n<td>Boolean</td>\n<td>3.0+ç‰ˆæœ¬å·²åºŸå¼ƒï¼Œåœ¨å»ºç«‹å”¯ä¸€ç´¢å¼•æ—¶æ˜¯å¦åˆ é™¤é‡å¤è®°å½•</td>\n</tr>\n<tr>\n<td>sparse</td>\n<td>Boolean</td>\n<td>å¯¹æ–‡æ¡£ä¸­ä¸å­˜åœ¨çš„å­—æ®µæ•°æ®æ˜¯å¦å¯ç”¨ç´¢å¼•</td>\n</tr>\n<tr>\n<td>expireAfterSeconds</td>\n<td>integer</td>\n<td>æŒ‡å®šä¸€ä¸ªä»¥ç§’ä¸ºå•ä½çš„æ•°å€¼ï¼Œå®Œæˆ TTL è®¾å®šï¼Œè®¾å®šé›†åˆçš„ç”Ÿå­˜æ—¶é—´</td>\n</tr>\n<tr>\n<td>v</td>\n<td>index version</td>\n<td>ç´¢å¼•çš„ç‰ˆæœ¬å·</td>\n</tr>\n<tr>\n<td>weights</td>\n<td>document</td>\n<td>ç´¢å¼•æƒé‡å€¼ï¼Œæ•°å€¼åœ¨ 1 åˆ° 99,999 ä¹‹é—´ï¼Œè¡¨ç¤ºè¯¥ç´¢å¼•ç›¸å¯¹äºå…¶ä»–ç´¢å¼•å­—æ®µçš„å¾—åˆ†æƒé‡</td>\n</tr>\n<tr>\n<td>default_language</td>\n<td>string</td>\n<td>å¯¹äºæ–‡æœ¬ç´¢å¼•ï¼Œè¯¥å‚æ•°å†³å®šäº†åœç”¨è¯åŠè¯å¹²å’Œè¯å™¨çš„è§„åˆ™çš„åˆ—è¡¨</td>\n</tr>\n<tr>\n<td>language_override</td>\n<td>string</td>\n<td>å¯¹äºæ–‡æœ¬ç´¢å¼•ï¼Œè¯¥å‚æ•°æŒ‡å®šäº†åŒ…å«åœ¨æ–‡æ¡£ä¸­çš„å­—æ®µåï¼Œè¯­è¨€è¦†ç›–é»˜è®¤çš„ language</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"ç´¢å¼•ç±»å‹\">ç´¢å¼•ç±»å‹</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¸å¤§å¤šæ•°æ•°æ®åº“ä¸€æ ·ï¼ŒMongoDBæ”¯æŒå„ç§ä¸°å¯Œçš„ç´¢å¼•ç±»å‹ï¼ŒåŒ…æ‹¬å•é”®ç´¢å¼•ã€å¤åˆç´¢å¼•ï¼Œå”¯ä¸€ç´¢å¼•ç­‰ä¸€äº›å¸¸ç”¨çš„ç»“æ„ã€‚ç”±äºé‡‡ç”¨äº†çµæ´»å¯å˜çš„æ–‡æ¡£ç±»å‹ï¼Œå› æ­¤å®ƒä¹ŸåŒæ ·æ”¯æŒå¯¹åµŒå¥—å­—æ®µã€æ•°ç»„è¿›è¡Œç´¢å¼•ã€‚é€šè¿‡å»ºç«‹åˆé€‚çš„ç´¢å¼•ï¼Œæˆ‘ä»¬å¯ä»¥æå¤§åœ°æå‡æ•°æ®çš„æ£€ç´¢é€Ÿåº¦ã€‚åœ¨ä¸€äº›ç‰¹æ®Šåº”ç”¨åœºæ™¯ï¼ŒMongoDBè¿˜æ”¯æŒåœ°ç†ç©ºé—´ç´¢å¼•ã€æ–‡æœ¬æ£€ç´¢ç´¢å¼•ã€TTLç´¢å¼•ç­‰ä¸åŒçš„ç‰¹æ€§ã€‚</p>\n</li>\n</ul>\n<h3 id=\"å•é”®ç´¢å¼•-Single-Field-Indexes\">å•é”®ç´¢å¼•(Single Field Indexes)</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å•é”®ç´¢å¼•æ˜¯MongoDBæœ€ç®€å•çš„ç´¢å¼•ç±»å‹ï¼Œå®ƒå°†ä¸€ä¸ªå­—æ®µä½œä¸ºç´¢å¼•é”®ï¼Œç´¢å¼•é”®å€¼å”¯ä¸€ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒMongoDBä¼šåœ¨IDå­—æ®µä¸Šåˆ›å»ºä¸€ä¸ªå•é”®ç´¢å¼•ï¼ŒIDå­—æ®µæ˜¯æ–‡æ¡£çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼ŒMongoDBä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªIDå­—æ®µï¼Œå¦‚æœç”¨æˆ·è‡ªå·±åˆ›å»ºIDå­—æ®µï¼ŒMongoDBä¼šè‡ªåŠ¨å°†IDå­—æ®µä½œä¸ºå•é”®ç´¢å¼•ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å•é”®ç´¢å¼•çš„åˆ›å»ºæ–¹å¼å¦‚ä¸‹ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 1è¡¨ç¤ºæ­£åºï¼Œ-1è¡¨ç¤ºå€’åº</span></span><br><span class=\"line\">db.books.createIndex(&#123;title:1&#125;)</span><br><span class=\"line\"><span class=\"comment\"># å¯¹å†…åµŒæ–‡æ¡£å­—æ®µåˆ›å»ºç´¢å¼•ï¼š</span></span><br><span class=\"line\">db.books.createIndex(&#123;<span class=\"string\">&quot;author.name&quot;</span>:1&#125;)</span><br></pre></td></tr></table></figure>\n<h3 id=\"å¤åˆç´¢å¼•-Compound-Index\">å¤åˆç´¢å¼•(Compound Index)</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¤åˆç´¢å¼•æ˜¯å°†å¤šä¸ªå­—æ®µä½œä¸ºç´¢å¼•é”®ï¼Œå…¶æ€§è´¨å’Œå•å­—æ®µç´¢å¼•ç±»ä¼¼ã€‚ä½†ä¸åŒçš„æ˜¯ï¼Œå¤åˆç´¢å¼•ä¸­å­—æ®µçš„é¡ºåºã€å­—æ®µçš„å‡é™åºå¯¹æŸ¥è¯¢æ€§èƒ½æœ‰ç›´æ¥çš„å½±å“ï¼Œå› æ­¤åœ¨è®¾è®¡å¤åˆç´¢å¼•æ—¶åˆ™éœ€è¦è€ƒè™‘ä¸åŒçš„æŸ¥è¯¢åœºæ™¯ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å¤åˆç´¢å¼•çš„åˆ›å»ºæ–¹å¼å¦‚ä¸‹ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">db.books.createIndex(&#123;title:1, author.name:1&#125;)</span><br><span class=\"line\"><span class=\"comment\"># å¯¹å†…åµŒæ–‡æ¡£å­—æ®µåˆ›å»ºç´¢å¼•ï¼š</span></span><br><span class=\"line\">db.books.createIndex(&#123;<span class=\"string\">&quot;author.name&quot;</span>:1, <span class=\"string\">&quot;author.age&quot;</span>:1&#125;)</span><br></pre></td></tr></table></figure>\n<h3 id=\"å¤šé”®-æ•°ç»„-ç´¢å¼•-Multikey-Index\">å¤šé”®(æ•°ç»„)ç´¢å¼•(Multikey Index)</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¤šé”®ç´¢å¼•æ˜¯å°†ä¸€ä¸ªå­—æ®µä½œä¸ºç´¢å¼•é”®ï¼Œè¯¥å­—æ®µå¯ä»¥æ˜¯åµŒå¥—æ–‡æ¡£ã€æ•°ç»„ç­‰å¤æ‚æ•°æ®ç±»å‹ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å¤šé”®ç´¢å¼•çš„åˆ›å»ºæ–¹å¼å¦‚ä¸‹ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># tagså­—æ®µä¸ºæ•°ç»„</span></span><br><span class=\"line\">db.books.createIndex(&#123;<span class=\"string\">&quot;tags&quot;</span>:1&#125;)</span><br><span class=\"line\"><span class=\"comment\"># åˆ›å»ºå¤åˆå¤šå€¼ç´¢å¼•ï¼Œè¿™é‡Œä»…èƒ½æœ‰ä¸€ä¸ªå­—æ®µæ˜¯æ•°ç»„ï¼ŒMongoDBå¹¶ä¸æ”¯æŒä¸€ä¸ªå¤åˆç´¢å¼•ä¸­åŒæ—¶å‡ºç°å¤šä¸ªæ•°ç»„å­—æ®µ</span></span><br><span class=\"line\">db.books.createIndex(&#123;title:1, tags:1&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ç¤ºä¾‹æ•°æ®æ ¼å¼</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  _id: 1,</span><br><span class=\"line\">  item: <span class=\"string\">&quot;abc&quot;</span>,</span><br><span class=\"line\">  stock: [</span><br><span class=\"line\">    &#123; size: <span class=\"string\">&quot;S&quot;</span>, color: <span class=\"string\">&quot;red&quot;</span>, quantity: 25 &#125;,</span><br><span class=\"line\">    &#123; size: <span class=\"string\">&quot;S&quot;</span>, color: <span class=\"string\">&quot;blue&quot;</span>, quantity: 10 &#125;,</span><br><span class=\"line\">    &#123; size: <span class=\"string\">&quot;M&quot;</span>, color: <span class=\"string\">&quot;blue&quot;</span>, quantity: 50 &#125;</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\"># å¯ä»¥å¯¹åµŒå…¥æ–‡æ¡£åˆ›å»ºå¤šé”®ç´¢å¼•</span></span><br><span class=\"line\">db.collection.createIndex( &#123; <span class=\"string\">&quot;stock.size&quot;</span>: 1, <span class=\"string\">&quot;stock.quantity&quot;</span>: 1 &#125; )</span><br></pre></td></tr></table></figure>\n<h3 id=\"Hashç´¢å¼•-Hashed-Indexes\">Hashç´¢å¼•(Hashed Indexes)</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Hashç´¢å¼•æ˜¯MongoDBä¸­çš„ä¸€ç§ç‰¹æ®Šçš„ç´¢å¼•ç±»å‹ï¼Œå®ƒå°†å­—æ®µçš„å€¼è®¡ç®—å‡ºä¸€ä¸ªå“ˆå¸Œå€¼ï¼Œç„¶åå°†è¯¥å“ˆå¸Œå€¼ä½œä¸ºç´¢å¼•é”®ã€‚ç”±äºå“ˆå¸Œå€¼çš„å”¯ä¸€æ€§ï¼Œå› æ­¤MongoDBåœ¨åˆ›å»ºHashç´¢å¼•æ—¶ï¼Œä¸ä¼šå¯¹ç´¢å¼•é”®å€¼è¿›è¡Œæ’åºã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>Hashç´¢å¼•çš„åˆ›å»ºæ–¹å¼å¦‚ä¸‹ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">db.books.createIndex(&#123;title:<span class=\"string\">&quot;hashed&quot;</span>&#125;)</span><br><span class=\"line\"><span class=\"comment\"># å¯¹å†…åµŒæ–‡æ¡£å­—æ®µåˆ›å»ºç´¢å¼•ï¼š</span></span><br><span class=\"line\">db.books.createIndex(&#123;<span class=\"string\">&quot;author.name&quot;</span>:<span class=\"string\">&quot;hashed&quot;</span>&#125;)</span><br></pre></td></tr></table></figure>\n<h3 id=\"é€šé…ç¬¦ç´¢å¼•-Wildcard-Indexes\">é€šé…ç¬¦ç´¢å¼•(Wildcard Indexes)</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>é€šé…ç¬¦ç´¢å¼•æ˜¯MongoDBä¸­çš„ä¸€ç§ç‰¹æ®Šçš„ç´¢å¼•ç±»å‹ï¼Œå®ƒå…è®¸åœ¨ç´¢å¼•é”®å€¼ä¸­åŒ…å«é€šé…ç¬¦ï¼Œä»è€Œæ”¯æŒå¯¹é€šé…ç¬¦åŒ¹é…çš„æŸ¥è¯¢ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>MongoDB 4.2 å¼•å…¥äº†é€šé…ç¬¦ç´¢</p>\n</li>\n<li class=\"lvl-2\">\n<p>é€šé…ç¬¦ç´¢å¼•çš„åˆ›å»ºæ–¹å¼å¦‚ä¸‹ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ç¤ºä¾‹æ•°æ®</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;product_name&quot;</span> : <span class=\"string\">&quot;Spy Coat&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;product_attributes&quot;</span> : &#123;</span><br><span class=\"line\">        <span class=\"string\">&quot;material&quot;</span> : [ <span class=\"string\">&quot;Tweed&quot;</span>, <span class=\"string\">&quot;Wool&quot;</span>, <span class=\"string\">&quot;Leather&quot;</span> ],</span><br><span class=\"line\">        <span class=\"string\">&quot;size&quot;</span> : &#123;</span><br><span class=\"line\">            <span class=\"string\">&quot;length&quot;</span> : 72,</span><br><span class=\"line\">            <span class=\"string\">&quot;units&quot;</span> : <span class=\"string\">&quot;inches&quot;</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">db.products.createIndex( &#123; <span class=\"string\">&quot;product_attributes.$**&quot;</span> : 1 &#125; )</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>é€šé…ç¬¦ç´¢å¼•æ˜¯ç¨€ç–çš„ï¼Œä¸ç´¢å¼•ç©ºå­—æ®µã€‚å› æ­¤ï¼Œé€šé…ç¬¦ç´¢å¼•ä¸èƒ½æ”¯æŒæŸ¥è¯¢å­—æ®µä¸å­˜åœ¨çš„æ–‡æ¡£ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># é€šé…ç¬¦ç´¢å¼•ä¸èƒ½æ”¯æŒä»¥ä¸‹æŸ¥è¯¢</span></span><br><span class=\"line\">db.products.find( &#123;<span class=\"string\">&quot;product_attributes&quot;</span> : &#123; <span class=\"variable\">$exists</span> : <span class=\"literal\">false</span> &#125; &#125; )</span><br><span class=\"line\">db.products.aggregate([</span><br><span class=\"line\">  &#123; <span class=\"variable\">$match</span> : &#123; <span class=\"string\">&quot;product_attributes&quot;</span> : &#123; <span class=\"variable\">$exists</span> : <span class=\"literal\">false</span> &#125; &#125; &#125;</span><br><span class=\"line\">])</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>é€šé…ç¬¦ç´¢å¼•ä¸ºæ–‡æ¡£æˆ–æ•°ç»„çš„å†…å®¹ç”Ÿæˆæ¡ç›®ï¼Œè€Œä¸æ˜¯æ–‡æ¡£/æ•°ç»„æœ¬èº«ã€‚å› æ­¤é€šé…ç¬¦ç´¢å¼•ä¸èƒ½æ”¯æŒç²¾ç¡®çš„æ–‡æ¡£/æ•°ç»„ç›¸ç­‰åŒ¹é…ã€‚é€šé…ç¬¦ç´¢å¼•å¯ä»¥æ”¯æŒæŸ¥è¯¢å­—æ®µç­‰äºç©ºæ–‡æ¡£{}çš„æƒ…å†µ</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#é€šé…ç¬¦ç´¢å¼•ä¸èƒ½æ”¯æŒä»¥ä¸‹æŸ¥è¯¢:</span></span><br><span class=\"line\">db.products.find(&#123; <span class=\"string\">&quot;product_attributes.colors&quot;</span> : [ <span class=\"string\">&quot;Blue&quot;</span>, <span class=\"string\">&quot;Black&quot;</span> ] &#125; )</span><br><span class=\"line\"></span><br><span class=\"line\">db.products.aggregate([&#123;</span><br><span class=\"line\">  <span class=\"variable\">$match</span> : &#123; <span class=\"string\">&quot;product_attributes.colors&quot;</span> : [ <span class=\"string\">&quot;Blue&quot;</span>, <span class=\"string\">&quot;Black&quot;</span> ] &#125;</span><br><span class=\"line\">&#125;])</span><br></pre></td></tr></table></figure>\n<h2 id=\"ç´¢å¼•å±æ€§\">ç´¢å¼•å±æ€§</h2>\n<h3 id=\"å”¯ä¸€ç´¢å¼•-Unique-Indexes\">å”¯ä¸€ç´¢å¼•(Unique Indexes)</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å”¯ä¸€ç´¢å¼•çš„åˆ›å»ºæ–¹å¼å¦‚ä¸‹ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å•é”®ç´¢å¼•æ”¯æŒå”¯ä¸€çº¦æŸ</span></span><br><span class=\"line\">db.books.createIndex(&#123;title:1&#125;, &#123;unique:<span class=\"literal\">true</span>&#125;)</span><br><span class=\"line\"><span class=\"comment\"># å¤åˆç´¢å¼•æ”¯æŒå”¯ä¸€æ€§çº¦æŸ</span></span><br><span class=\"line\">db.books.createIndex(&#123;title:1ï¼Œ<span class=\"built_in\">type</span>:1&#125;, &#123;unique:<span class=\"literal\">true</span>&#125;)</span><br><span class=\"line\"><span class=\"comment\"># å¤šé”®ç´¢å¼•æ”¯æŒå”¯ä¸€æ€§çº¦æŸï¼Œè¿™é‡Œtagsæ˜¯æ•°ç»„</span></span><br><span class=\"line\">db.books.createIndex(&#123;<span class=\"string\">&quot;tags&quot;</span>:1&#125;, &#123;unique:<span class=\"literal\">true</span>&#125;)</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å”¯ä¸€æ€§ç´¢å¼•å¯¹äºæ–‡æ¡£ä¸­ç¼ºå¤±çš„å­—æ®µï¼Œä¼šä½¿ç”¨nullå€¼ä»£æ›¿ï¼Œå› æ­¤ä¸å…è®¸å­˜åœ¨å¤šä¸ªæ–‡æ¡£ç¼ºå¤±ç´¢å¼•å­—æ®µçš„æƒ…å†µã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å¯¹äºåˆ†ç‰‡çš„é›†åˆï¼Œå”¯ä¸€æ€§çº¦æŸå¿…é¡»åŒ¹é…åˆ†ç‰‡è§„åˆ™ã€‚æ¢å¥è¯è¯´ï¼Œä¸ºäº†ä¿è¯å…¨å±€çš„å”¯ä¸€æ€§ï¼Œåˆ†ç‰‡é”®å¿…é¡»ä½œä¸ºå”¯ä¸€æ€§ç´¢å¼•çš„å‰ç¼€å­—æ®µã€‚</p>\n</li>\n</ul>\n<h3 id=\"éƒ¨åˆ†ç´¢å¼•-Partial-Indexes\">éƒ¨åˆ†ç´¢å¼•(Partial Indexes)</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>éƒ¨åˆ†ç´¢å¼•ä»…å¯¹æ»¡è¶³æŒ‡å®šè¿‡æ»¤å™¨è¡¨è¾¾å¼çš„æ–‡æ¡£è¿›è¡Œç´¢å¼•ã€‚é€šè¿‡åœ¨ä¸€ä¸ªé›†åˆä¸­ä¸ºæ–‡æ¡£çš„ä¸€ä¸ªå­é›†å»ºç«‹ç´¢å¼•ï¼Œéƒ¨åˆ†ç´¢å¼•å…·æœ‰æ›´ä½çš„å­˜å‚¨éœ€æ±‚å’Œæ›´ä½çš„ç´¢å¼•åˆ›å»ºå’Œç»´æŠ¤çš„æ€§èƒ½æˆæœ¬ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>éƒ¨åˆ†ç´¢å¼•çš„åˆ›å»ºæ–¹å¼å¦‚ä¸‹ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ç¬¦åˆæ¡ä»¶&#123;author: &#123;$exists: true&#125;&#125;ï¼Œå³å­˜åœ¨ä½œè€…ï¼Œæ‰å¯¹titleåˆ›å»ºå‡åºç´¢å¼•</span></span><br><span class=\"line\">db.books.createIndex(&#123;title:1&#125;, &#123;partialFilterExpression: &#123;author: &#123;<span class=\"variable\">$exists</span>: <span class=\"literal\">true</span>&#125;&#125;&#125;)</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>partialFilterExpression(ç­›é€‰å™¨è¡¨è¾¾å¼)é€‰é¡¹æ¥å—æŒ‡å®šè¿‡æ»¤æ¡ä»¶çš„æ–‡æ¡£:<br>\n- ç­‰å¼è¡¨è¾¾å¼(ä¾‹å¦‚:field: valueæˆ–ä½¿ç”¨$eqæ“ä½œç¬¦)<br>\n- $exists: true<br>\n- $gtï¼Œ $gteï¼Œ $ltï¼Œ $lte<br>\n- <span class='katex-error' title='ParseError: KaTeX parse error: LaTeX-incompatible input and strict mode is set to &#039;error&#039;: Unicode text character &quot;é¡¶&quot; used in math mode [unicodeTextInMathMode] at position 12: type\n    - é¡¶Ì²å±‚çš„'>type\n    - é¡¶å±‚çš„</span>and</p>\n</blockquote>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ³¨æ„ï¼šå¦‚æœåŒæ—¶æŒ‡å®šäº†partialFilterExpressionå’Œå”¯ä¸€çº¦æŸï¼Œé‚£ä¹ˆå”¯ä¸€çº¦æŸåªé€‚ç”¨äºæ»¡è¶³ç­›é€‰å™¨è¡¨è¾¾å¼çš„æ–‡æ¡£ã€‚å¦‚æœæ–‡æ¡£ä¸æ»¡è¶³ç­›é€‰æ¡ä»¶ï¼Œé‚£ä¹ˆå¸¦æœ‰æƒŸä¸€çº¦æŸçš„éƒ¨åˆ†ç´¢å¼•ä¸ä¼šé˜»æ­¢æ’å…¥ä¸æ»¡è¶³æƒŸä¸€çº¦æŸçš„æ–‡æ¡£ã€‚</p>\n</li>\n</ul>\n<h3 id=\"ç¨€ç–ç´¢å¼•-Sparse-Indexes\">ç¨€ç–ç´¢å¼•(Sparse Indexes)</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç´¢å¼•çš„ç¨€ç–å±æ€§ç¡®ä¿ç´¢å¼•åªåŒ…å«å…·æœ‰ç´¢å¼•å­—æ®µçš„æ–‡æ¡£çš„æ¡ç›®ï¼Œç´¢å¼•å°†è·³è¿‡æ²¡æœ‰ç´¢å¼•å­—æ®µçš„æ–‡æ¡£ã€‚å³åªå¯¹å­˜åœ¨å­—æ®µçš„æ–‡æ¡£è¿›è¡Œç´¢å¼•ï¼ˆåŒ…æ‹¬å­—æ®µå€¼ä¸ºnullçš„æ–‡æ¡£ï¼‰ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å¦‚æœç¨€ç–ç´¢å¼•ä¼šå¯¼è‡´æŸ¥è¯¢å’Œæ’åºæ“ä½œçš„ç»“æœé›†ä¸å®Œæ•´ï¼ŒMongoDBå°†ä¸ä¼šä½¿ç”¨è¯¥ç´¢å¼•ï¼Œé™¤éhint()æ˜ç¡®æŒ‡å®šç´¢å¼•ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ç¨€ç–ç´¢å¼•çš„åˆ›å»ºæ–¹å¼å¦‚ä¸‹ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æ•°æ®å‡†å¤‡</span></span><br><span class=\"line\">db.scores.insertMany([</span><br><span class=\"line\">    &#123;<span class=\"string\">&quot;userid&quot;</span> : <span class=\"string\">&quot;newbie&quot;</span>&#125;,</span><br><span class=\"line\">    &#123;<span class=\"string\">&quot;userid&quot;</span> : <span class=\"string\">&quot;abby&quot;</span>, <span class=\"string\">&quot;score&quot;</span> : 82&#125;,</span><br><span class=\"line\">    &#123;<span class=\"string\">&quot;userid&quot;</span> : <span class=\"string\">&quot;nina&quot;</span>, <span class=\"string\">&quot;score&quot;</span> : 90&#125;</span><br><span class=\"line\">])</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åˆ›å»ºç¨€ç–ç´¢å¼•</span></span><br><span class=\"line\">db.scores.createIndex( &#123; score: 1 &#125; , &#123; sparse: <span class=\"literal\">true</span> &#125; )</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æµ‹è¯•</span></span><br><span class=\"line\"><span class=\"comment\"># ä½¿ç”¨ç¨€ç–ç´¢å¼•</span></span><br><span class=\"line\">db.scores.find( &#123; score: &#123; <span class=\"variable\">$lt</span>: 90 &#125; &#125; )</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å³ä½¿æ’åºæ˜¯é€šè¿‡ç´¢å¼•å­—æ®µï¼ŒMongoDBä¹Ÿä¸ä¼šé€‰æ‹©ç¨€ç–ç´¢å¼•æ¥å®ŒæˆæŸ¥è¯¢ï¼Œä»¥è¿”å›å®Œæ•´çš„ç»“æœ</span></span><br><span class=\"line\">db.scores.find().<span class=\"built_in\">sort</span>( &#123; score: -1 &#125; )</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># è¦ä½¿ç”¨ç¨€ç–ç´¢å¼•ï¼Œä½¿ç”¨hint()æ˜¾å¼æŒ‡å®šç´¢å¼•</span></span><br><span class=\"line\">db.scores.find().<span class=\"built_in\">sort</span>( &#123; score: -1 &#125; ).hint( &#123; score: 1 &#125; )</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åŒæ—¶å…·æœ‰ç¨€ç–æ€§å’Œå”¯ä¸€æ€§çš„ç´¢å¼•å¯ä»¥é˜²æ­¢é›†åˆä¸­å­˜åœ¨å­—æ®µå€¼é‡å¤çš„æ–‡æ¡£ï¼Œä½†å…è®¸ä¸åŒ…å«æ­¤ç´¢å¼•å­—æ®µçš„æ–‡æ¡£æ’å…¥ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åˆ é™¤ä¹‹å‰åˆ›å»ºçš„ç´¢å¼•</span></span><br><span class=\"line\">db.scores.dropIndex(&#123;score:1&#125;)</span><br><span class=\"line\"><span class=\"comment\"># åˆ›å»ºå…·æœ‰å”¯ä¸€çº¦æŸçš„ç¨€ç–ç´¢å¼•</span></span><br><span class=\"line\">db.scores.createIndex( &#123; score: 1 &#125; , &#123; sparse: <span class=\"literal\">true</span>, unique: <span class=\"literal\">true</span> &#125; )</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æµ‹è¯•æ’å…¥</span></span><br><span class=\"line\">db.scores.insertMany( [</span><br><span class=\"line\">   &#123; <span class=\"string\">&quot;userid&quot;</span>: <span class=\"string\">&quot;AAAAAAA&quot;</span>, <span class=\"string\">&quot;score&quot;</span>: 50 &#125;,</span><br><span class=\"line\">   &#123; <span class=\"string\">&quot;userid&quot;</span>: <span class=\"string\">&quot;BBBBBBB&quot;</span>, <span class=\"string\">&quot;score&quot;</span>: 64 &#125;,</span><br><span class=\"line\">   &#123; <span class=\"string\">&quot;userid&quot;</span>: <span class=\"string\">&quot;CCCCCCC&quot;</span> &#125;,</span><br><span class=\"line\">   &#123; <span class=\"string\">&quot;userid&quot;</span>: <span class=\"string\">&quot;CCCCCCC&quot;</span> &#125;</span><br><span class=\"line\">] )</span><br></pre></td></tr></table></figure>\n<h3 id=\"TTLç´¢å¼•-TTL-Indexes\">TTLç´¢å¼•(TTL Indexes)</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>MongoDB å¯ä»¥ä½¿ç”¨å®ƒåœ¨ä¸€å®šæ—¶é—´æˆ–ç‰¹å®šæ—¶é’Ÿæ—¶é—´åè‡ªåŠ¨ä»é›†åˆä¸­åˆ é™¤æ–‡æ¡£ï¼Œå°±æ˜¯å¸¦æœ‰è¿‡æœŸæ—¶é—´çš„ç´¢å¼•ï¼Œåˆ°æœŸåï¼ŒMongoDBä¼šè‡ªåŠ¨åˆ é™¤è¿™äº›è¿‡æœŸçš„æ–‡æ¡£ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>TTLç´¢å¼•åªèƒ½åˆ›å»ºåœ¨æ—¥æœŸå­—æ®µä¸Šï¼Œå½“æ–‡æ¡£è¿‡æœŸåï¼ŒMongoDBä¼šè‡ªåŠ¨åˆ é™¤è¿™äº›æ–‡æ¡£ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>TTLç´¢å¼•çš„åˆ›å»ºæ–¹å¼å¦‚ä¸‹ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æ•°æ®å‡†å¤‡</span></span><br><span class=\"line\">db.log_events.insertOne( &#123;</span><br><span class=\"line\">   <span class=\"string\">&quot;createdAt&quot;</span>: new Date(),</span><br><span class=\"line\">   <span class=\"string\">&quot;logEvent&quot;</span>: 2,</span><br><span class=\"line\">   <span class=\"string\">&quot;logMessage&quot;</span>: <span class=\"string\">&quot;Success!&quot;</span></span><br><span class=\"line\">&#125; )</span><br><span class=\"line\"><span class=\"comment\"># åˆ›å»ºTTLç´¢å¼•</span></span><br><span class=\"line\">db.scores.createIndex( &#123; <span class=\"string\">&quot;createdAt&quot;</span>: 1 &#125;, &#123; expireAfterSeconds: 3600 &#125; )</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>TTL ç´¢å¼•ä¸ä¿è¯è¿‡æœŸæ•°æ®ä¼šåœ¨è¿‡æœŸåç«‹å³è¢«åˆ é™¤ã€‚æ–‡æ¡£è¿‡æœŸå’Œ MongoDB ä»æ•°æ®åº“ä¸­åˆ é™¤æ–‡æ¡£çš„æ—¶é—´ä¹‹é—´å¯èƒ½å­˜åœ¨å»¶è¿Ÿã€‚åˆ é™¤è¿‡æœŸæ–‡æ¡£çš„åå°ä»»åŠ¡æ¯ 60 ç§’è¿è¡Œä¸€æ¬¡ã€‚å› æ­¤ï¼Œåœ¨æ–‡æ¡£åˆ°æœŸå’Œåå°ä»»åŠ¡è¿è¡Œä¹‹é—´çš„æ—¶é—´æ®µå†…ï¼Œæ–‡æ¡£å¯èƒ½ä¼šä¿ç•™åœ¨é›†åˆä¸­ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>TTLç´¢å¼•åœ¨åˆ›å»ºä¹‹åï¼Œä»ç„¶å¯ä»¥å¯¹è¿‡æœŸæ—¶é—´è¿›è¡Œä¿®æ”¹ã€‚è¿™éœ€è¦ä½¿ç”¨collModå‘½ä»¤å¯¹ç´¢å¼•çš„å®šä¹‰è¿›è¡Œå˜æ›´</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">db.runCommand( &#123;</span><br><span class=\"line\">    collMod: <span class=\"string\">&quot;log_events&quot;</span>,</span><br><span class=\"line\">    index: &#123;</span><br><span class=\"line\">        keyPattern: &#123; createdAt: 1 &#125;,</span><br><span class=\"line\">        expireAfterSeconds: 3600</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125; )</span><br></pre></td></tr></table></figure>\n<h3 id=\"éšè—ç´¢å¼•-Hidden-Indexes\">éšè—ç´¢å¼•(Hidden Indexes)</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>éšè—ç´¢å¼•å¯¹æŸ¥è¯¢è§„åˆ’å™¨ä¸å¯è§ï¼Œä¸èƒ½ç”¨äºæŸ¥è¯¢ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>é€šè¿‡å¯¹è§„åˆ’å™¨éšè—ç´¢å¼•ï¼Œç”¨æˆ·å¯ä»¥åœ¨ä¸å®é™…åˆ é™¤ç´¢å¼•çš„æƒ…å†µä¸‹è¯„ä¼°åˆ é™¤ç´¢å¼•çš„æ½œåœ¨å½±å“ã€‚å¦‚æœå½±å“æ˜¯è´Ÿé¢çš„ï¼Œç”¨æˆ·å¯ä»¥å–æ¶ˆéšè—ç´¢å¼•ï¼Œè€Œä¸å¿…é‡æ–°åˆ›å»ºå·²åˆ é™¤çš„ç´¢å¼•ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>éšè—ç´¢å¼•çš„åˆ›å»ºæ–¹å¼å¦‚ä¸‹ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åˆ›å»ºéšè—ç´¢å¼•</span></span><br><span class=\"line\">db.restaurants.createIndex(&#123; borough: 1 &#125;,&#123; hidden: <span class=\"literal\">true</span> &#125;);</span><br><span class=\"line\"><span class=\"comment\"># éšè—ç°æœ‰ç´¢å¼•</span></span><br><span class=\"line\">db.restaurants.hideIndex( &#123; borough: 1&#125; );</span><br><span class=\"line\">db.restaurants.hideIndex( <span class=\"string\">&quot;ç´¢å¼•åç§°&quot;</span> )</span><br><span class=\"line\"><span class=\"comment\"># å–æ¶ˆéšè—ç´¢å¼•</span></span><br><span class=\"line\">db.restaurants.unhideIndex( &#123; borough: 1&#125; );</span><br><span class=\"line\">db.restaurants.unhideIndex( <span class=\"string\">&quot;ç´¢å¼•åç§°&quot;</span> );</span><br></pre></td></tr></table></figure>\n<h2 id=\"ç´¢å¼•å…¶å®ƒæ“ä½œ\">ç´¢å¼•å…¶å®ƒæ“ä½œ</h2>\n<h3 id=\"æŸ¥çœ‹ç´¢å¼•\">æŸ¥çœ‹ç´¢å¼•</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹ç´¢å¼•ä¿¡æ¯</span></span><br><span class=\"line\">db.books.getIndexes()</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹ç´¢å¼•é”®</span></span><br><span class=\"line\">db.books.getIndexKeys()</span><br></pre></td></tr></table></figure>\n<h3 id=\"åˆ é™¤ç´¢å¼•\">åˆ é™¤ç´¢å¼•</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åˆ é™¤é›†åˆæŒ‡å®šç´¢å¼•</span></span><br><span class=\"line\">db.col.dropIndex(<span class=\"string\">&quot;ç´¢å¼•åç§°&quot;</span>)</span><br><span class=\"line\"><span class=\"comment\"># åˆ é™¤é›†åˆæ‰€æœ‰ç´¢å¼•,ä¸èƒ½åˆ é™¤ä¸»é”®ç´¢å¼•</span></span><br><span class=\"line\">db.col.dropIndexes()</span><br></pre></td></tr></table></figure>\n<h2 id=\"ç´¢å¼•ä½¿ç”¨å»ºè®®\">ç´¢å¼•ä½¿ç”¨å»ºè®®</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¸ºæ¯ä¸€ä¸ªæŸ¥è¯¢å»ºç«‹åˆé€‚çš„ç´¢å¼•</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-6\">è¿™ä¸ªæ˜¯é’ˆå¯¹äºæ•°æ®é‡è¾ƒå¤§æ¯”å¦‚è¯´è¶…è¿‡å‡ åä¸Šç™¾ä¸‡ï¼ˆæ–‡æ¡£æ•°ç›®ï¼‰æ•°é‡çº§çš„é›†åˆã€‚</li>\n<li class=\"lvl-6\">å¦‚æœæ²¡æœ‰ç´¢å¼•MongoDBéœ€è¦æŠŠæ‰€æœ‰çš„Documentä»ç›˜ä¸Šè¯»åˆ°å†…å­˜ï¼Œè¿™ä¼šå¯¹MongoDBæœåŠ¡å™¨é€ æˆè¾ƒå¤§çš„å‹åŠ›å¹¶å½±å“åˆ°å…¶ä»–è¯·æ±‚çš„æ‰§è¡Œã€‚</li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<p>åˆ›å»ºåˆé€‚çš„å¤åˆç´¢å¼•ï¼Œä¸è¦ä¾èµ–äºäº¤å‰ç´¢å¼•</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-6\">å¦‚æœä½ çš„æŸ¥è¯¢ä¼šä½¿ç”¨åˆ°å¤šä¸ªå­—æ®µï¼ŒMongoDBæœ‰ä¸¤ä¸ªç´¢å¼•æŠ€æœ¯å¯ä»¥ä½¿ç”¨ï¼šäº¤å‰ç´¢å¼•å’Œå¤åˆç´¢å¼•ã€‚</li>\n<li class=\"lvl-6\">äº¤å‰ç´¢å¼•å°±æ˜¯é’ˆå¯¹æ¯ä¸ªå­—æ®µå•ç‹¬å»ºç«‹ä¸€ä¸ªå•å­—æ®µç´¢å¼•ï¼Œç„¶ååœ¨æŸ¥è¯¢æ‰§è¡Œæ—¶å€™ä½¿ç”¨ç›¸åº”çš„å•å­—æ®µç´¢å¼•è¿›è¡Œç´¢å¼•äº¤å‰è€Œå¾—åˆ°æŸ¥è¯¢ç»“æœã€‚</li>\n<li class=\"lvl-6\">äº¤å‰ç´¢å¼•ç›®å‰è§¦å‘ç‡è¾ƒä½ï¼Œæ‰€ä»¥å¦‚æœä½ æœ‰ä¸€ä¸ªå¤šå­—æ®µæŸ¥è¯¢çš„æ—¶å€™ï¼Œå»ºè®®ä½¿ç”¨å¤åˆç´¢å¼•èƒ½å¤Ÿä¿è¯ç´¢å¼•æ­£å¸¸çš„ä½¿ç”¨ã€‚</li>\n</ul>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#æŸ¥æ‰¾æ‰€æœ‰å¹´é¾„å°äº30å²çš„æ·±åœ³å¸‚é©¬æ‹‰æ¾è¿åŠ¨å‘˜</span></span><br><span class=\"line\">db.athelets.find(&#123;sport: <span class=\"string\">&quot;marathon&quot;</span>, location: <span class=\"string\">&quot;sz&quot;</span>, age: &#123;<span class=\"variable\">$lt</span>: 30&#125;&#125;&#125;)</span><br><span class=\"line\"><span class=\"comment\">#åˆ›å»ºå¤åˆç´¢å¼•</span></span><br><span class=\"line\">db.athelets.createIndex(&#123;sport:1, location:1, age:1&#125;)</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¤åˆç´¢å¼•å­—æ®µé¡ºåºï¼šåŒ¹é…æ¡ä»¶åœ¨å‰ï¼ŒèŒƒå›´æ¡ä»¶åœ¨åï¼ˆEquality First, Range Afterï¼‰</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-6\">å‰é¢çš„ä¾‹å­ï¼Œåœ¨åˆ›å»ºå¤åˆç´¢å¼•æ—¶å¦‚æœæ¡ä»¶æœ‰åŒ¹é…å’ŒèŒƒå›´ä¹‹åˆ†ï¼Œé‚£ä¹ˆåŒ¹é…æ¡ä»¶ï¼ˆsport: â€œmarathonâ€) åº”è¯¥åœ¨å¤åˆç´¢å¼•çš„å‰é¢ã€‚èŒƒå›´æ¡ä»¶(age: &lt;30)å­—æ®µåº”è¯¥æ”¾åœ¨å¤åˆç´¢å¼•çš„åé¢ã€‚</li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<p>å°½å¯èƒ½ä½¿ç”¨è¦†ç›–ç´¢å¼•ï¼ˆCovered Indexï¼‰</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-6\">å»ºè®®åªè¿”å›éœ€è¦çš„å­—æ®µï¼ŒåŒæ—¶ï¼Œåˆ©ç”¨è¦†ç›–ç´¢å¼•æ¥æå‡æ€§èƒ½ã€‚</li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<p>å»ºç´¢å¼•è¦åœ¨åå°è¿è¡Œ</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-6\">åœ¨å¯¹ä¸€ä¸ªé›†åˆåˆ›å»ºç´¢å¼•æ—¶ï¼Œè¯¥é›†åˆæ‰€åœ¨çš„æ•°æ®åº“å°†ä¸æ¥å—å…¶ä»–è¯»å†™æ“ä½œã€‚å¯¹å¤§æ•°æ®é‡çš„é›†åˆå»ºç´¢å¼•ï¼Œå»ºè®®ä½¿ç”¨åå°è¿è¡Œé€‰é¡¹ {background: true}</li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<p>é¿å…è®¾è®¡è¿‡é•¿çš„æ•°ç»„ç´¢å¼•</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-6\">æ•°ç»„ç´¢å¼•æ˜¯å¤šå€¼çš„ï¼Œåœ¨å­˜å‚¨æ—¶éœ€è¦ä½¿ç”¨æ›´å¤šçš„ç©ºé—´ã€‚å¦‚æœç´¢å¼•çš„æ•°ç»„é•¿åº¦ç‰¹åˆ«é•¿ï¼Œæˆ–è€…æ•°ç»„çš„å¢é•¿ä¸å—æ§åˆ¶ï¼Œåˆ™å¯èƒ½å¯¼è‡´ç´¢å¼•ç©ºé—´æ€¥å‰§è†¨èƒ€ã€‚</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"explainæ‰§è¡Œè®¡åˆ’\">explainæ‰§è¡Œè®¡åˆ’</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>explainæ‰§è¡Œè®¡åˆ’çš„ä½œç”¨æ˜¯ï¼šæŸ¥çœ‹MongoDBæ‰§è¡ŒæŸ¥è¯¢æ—¶çš„æ‰§è¡Œè®¡åˆ’ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>explainæ‰§è¡Œè®¡åˆ’çš„ä½¿ç”¨æ–¹å¼å¦‚ä¸‹ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># è¯­æ³•</span></span><br><span class=\"line\">db.collection.find().explain(&lt;verbose&gt;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ç¤ºä¾‹</span></span><br><span class=\"line\">db.books.find(&#123;title: <span class=\"string\">&quot;MongoDB æ•™ç¨‹&quot;</span>&#125;).explain()</span><br><span class=\"line\">db.books.find(&#123;title: <span class=\"string\">&quot;MongoDB æ•™ç¨‹&quot;</span>&#125;).explain(<span class=\"string\">&quot;executionStats&quot;</span>)</span><br><span class=\"line\">db.books.find(&#123;title: <span class=\"string\">&quot;MongoDB æ•™ç¨‹&quot;</span>&#125;).explain(<span class=\"string\">&quot;allPlansExecution&quot;</span>)</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>verbose :å¯é€‰å‚æ•°ï¼Œè¡¨ç¤ºæ‰§è¡Œè®¡åˆ’çš„è¾“å‡ºæ¨¡å¼ï¼Œé»˜è®¤queryPlanner</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>æ¨¡å¼åå­—</th>\n<th>æè¿°</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>queryPlanner</td>\n<td>æ‰§è¡Œè®¡åˆ’çš„è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…æ‹¬æŸ¥è¯¢è®¡åˆ’ã€é›†åˆä¿¡æ¯ã€æŸ¥è¯¢æ¡ä»¶ã€æœ€ä½³æ‰§è¡Œè®¡åˆ’ã€æŸ¥è¯¢æ–¹å¼å’Œ MongoDB æœåŠ¡ä¿¡æ¯ç­‰</td>\n</tr>\n<tr>\n<td>executionStats</td>\n<td>æœ€ä½³æ‰§è¡Œè®¡åˆ’çš„æ‰§è¡Œæƒ…å†µå’Œè¢«æ‹’ç»çš„è®¡åˆ’ç­‰ä¿¡æ¯</td>\n</tr>\n<tr>\n<td>allPlansExecution</td>\n<td>é€‰æ‹©å¹¶æ‰§è¡Œæœ€ä½³æ‰§è¡Œè®¡åˆ’ï¼Œå¹¶è¿”å›æœ€ä½³æ‰§è¡Œè®¡åˆ’å’Œå…¶ä»–æ‰§è¡Œè®¡åˆ’çš„æ‰§è¡Œæƒ…å†µ</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¾“å‡ºç»“æœä¸­é‡ç‚¹æŸ¥çœ‹<code>stage</code>,æ¯”å¦‚<code>queryPlanner</code>ä¸‹çš„<code>winningPlan.stage</code></p>\n</li>\n<li class=\"lvl-2\">\n<p><code>stage</code>ç±»å‹</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>çŠ¶æ€</th>\n<th>æè¿°</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>COLLSCAN</td>\n<td>å…¨è¡¨æ‰«æ</td>\n</tr>\n<tr>\n<td>IXSCAN</td>\n<td>ç´¢å¼•æ‰«æ</td>\n</tr>\n<tr>\n<td>FETCH</td>\n<td>æ ¹æ®ç´¢å¼•æ£€ç´¢æŒ‡å®šæ–‡æ¡£</td>\n</tr>\n<tr>\n<td>SHARD_MERGE</td>\n<td>å°†å„ä¸ªåˆ†ç‰‡è¿”å›æ•°æ®è¿›è¡Œåˆå¹¶</td>\n</tr>\n<tr>\n<td>SORT</td>\n<td>åœ¨å†…å­˜ä¸­è¿›è¡Œäº†æ’åº</td>\n</tr>\n<tr>\n<td>LIMIT</td>\n<td>ä½¿ç”¨ limit é™åˆ¶è¿”å›æ•°</td>\n</tr>\n<tr>\n<td>SKIP</td>\n<td>ä½¿ç”¨ skip è¿›è¡Œè·³è¿‡</td>\n</tr>\n<tr>\n<td>IDHACK</td>\n<td>å¯¹ _id è¿›è¡ŒæŸ¥è¯¢</td>\n</tr>\n<tr>\n<td>SHARDING_FILTER</td>\n<td>é€šè¿‡ mongos å¯¹åˆ†ç‰‡æ•°æ®è¿›è¡ŒæŸ¥è¯¢</td>\n</tr>\n<tr>\n<td>COUNTSCAN</td>\n<td>count ä¸ä½¿ç”¨ç´¢å¼•è¿›è¡Œ count æ—¶çš„ stage è¿”å›</td>\n</tr>\n<tr>\n<td>COUNT_SCAN</td>\n<td>count ä½¿ç”¨äº†ç´¢å¼•è¿›è¡Œ count æ—¶çš„ stage è¿”å›</td>\n</tr>\n<tr>\n<td>SUBPLAN</td>\n<td>æœªä½¿ç”¨åˆ°ç´¢å¼•çš„ $or æŸ¥è¯¢çš„ stage è¿”å›</td>\n</tr>\n<tr>\n<td>TEXT</td>\n<td>ä½¿ç”¨å…¨æ–‡ç´¢å¼•è¿›è¡ŒæŸ¥è¯¢æ—¶å€™çš„ stage è¿”å›</td>\n</tr>\n<tr>\n<td>PROJECTION</td>\n<td>é™å®šè¿”å›å­—æ®µæ—¶å€™ stage çš„è¿”å›</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ‰§è¡Œè®¡åˆ’çš„è¿”å›ç»“æœä¸­å°½é‡ä¸è¦å‡ºç°ä»¥ä¸‹<code>stage</code>:</p>\n  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- COLLSCAN(å…¨è¡¨æ‰«æ)</span><br><span class=\"line\">- SORT(ä½¿ç”¨sortä½†æ˜¯æ— index)</span><br><span class=\"line\">- ä¸åˆç†çš„SKIP</span><br><span class=\"line\">- SUBPLA(æœªç”¨åˆ°indexçš„$or)</span><br><span class=\"line\">- COUNTSCAN(ä¸ä½¿ç”¨indexè¿›è¡Œcount)</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<h2 id=\"å®æˆ˜\">å®æˆ˜</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¸‹é¢æ˜¯ä¸€ä¸ªç»“åˆå„ç§ç´¢å¼•ç±»å‹çš„ç¤ºä¾‹ï¼Œå‡è®¾æˆ‘ä»¬æ­£åœ¨ä¸ºä¸€ä¸ªç”µå•†åº”ç”¨åˆ›å»ºå’Œç®¡ç†ä¸€ä¸ªMongoDBé›†åˆproductsï¼Œå…¶ä¸­åŒ…å«ä»¥ä¸‹å­—æ®µï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">_id: é»˜è®¤çš„ObjectIdç±»å‹ï¼Œä½œä¸ºä¸»é”®ï¼ˆå·²è‡ªåŠ¨å¸¦æœ‰å”¯ä¸€æ€§ç´¢å¼•ï¼‰ã€‚</span><br><span class=\"line\">category: å•†å“åˆ†ç±»ï¼Œå­—ç¬¦ä¸²ç±»å‹ã€‚</span><br><span class=\"line\">brand: å•†å“å“ç‰Œï¼Œå­—ç¬¦ä¸²ç±»å‹ã€‚</span><br><span class=\"line\">tags: å•†å“æ ‡ç­¾æ•°ç»„ï¼ŒåŒ…å«å¤šä¸ªå­—ç¬¦ä¸²å…ƒç´ ã€‚</span><br><span class=\"line\">price: å•†å“ä»·æ ¼ï¼Œæ•°å­—ç±»å‹ã€‚</span><br><span class=\"line\">lastUpdated: å•†å“æœ€åæ›´æ–°æ—¶é—´ï¼Œæ—¥æœŸç±»å‹ã€‚</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ›å»ºé›†åˆä¸æ’å…¥æ–‡æ¡£</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// å‡è®¾å·²ç»è¿æ¥åˆ°æ•°æ®åº“å¹¶é€‰æ‹©äº†ä¸€ä¸ªdatabase</span><br><span class=\"line\">db.createCollection(<span class=\"string\">&quot;products&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">// æ’å…¥ä¸€äº›ç¤ºä¾‹æ•°æ®</span><br><span class=\"line\">db.products.insertMany([</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    category: <span class=\"string\">&quot;Electronics&quot;</span>,</span><br><span class=\"line\">    brand: <span class=\"string\">&quot;Apple&quot;</span>,</span><br><span class=\"line\">    tags: [<span class=\"string\">&quot;smartphone&quot;</span>, <span class=\"string\">&quot;ios&quot;</span>],</span><br><span class=\"line\">    price: 999,</span><br><span class=\"line\">    lastUpdated: ISODate(<span class=\"string\">&quot;2023-03-01T00:00:00Z&quot;</span>)</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  // ...å…¶ä»–å•†å“æ–‡æ¡£</span><br><span class=\"line\">]);</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å•é”®ç´¢å¼• - æŸ¥è¯¢å•†å“æŒ‰ä»·æ ¼æ’åº</p>\n</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">db.<span class=\"property\">products</span>.<span class=\"title function_\">createIndex</span>(&#123; <span class=\"attr\">price</span>: <span class=\"number\">1</span> &#125;);</span><br><span class=\"line\">db.<span class=\"property\">products</span>.<span class=\"title function_\">find</span>().<span class=\"title function_\">sort</span>(&#123; <span class=\"attr\">price</span>: <span class=\"number\">1</span> &#125;); <span class=\"comment\">// è·å–æ‰€æœ‰å•†å“æŒ‰ä»·æ ¼å‡åºæ’åˆ—</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¤åˆç´¢å¼• - æŒ‰å“ç‰Œå’Œä»·æ ¼æŸ¥è¯¢ï¼Œå¹¶è¿›è¡Œæ’åºï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">db.<span class=\"property\">products</span>.<span class=\"title function_\">createIndex</span>(&#123; <span class=\"attr\">brand</span>: <span class=\"number\">1</span>, <span class=\"attr\">price</span>: -<span class=\"number\">1</span> &#125;);</span><br><span class=\"line\">db.<span class=\"property\">products</span>.<span class=\"title function_\">find</span>(&#123; <span class=\"attr\">brand</span>: <span class=\"string\">&quot;Apple&quot;</span> &#125;).<span class=\"title function_\">sort</span>(&#123; <span class=\"attr\">price</span>: -<span class=\"number\">1</span> &#125;); <span class=\"comment\">// è·å–æŒ‡å®šå“ç‰Œçš„å•†å“å¹¶æŒ‰ä»·æ ¼é™åºæ’åˆ—</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¤šé”®ç´¢å¼• - æ ¹æ®å•†å“æ ‡ç­¾è¿›è¡Œæœç´¢</p>\n</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">db.<span class=\"property\">products</span>.<span class=\"title function_\">createIndex</span>(&#123; <span class=\"string\">&quot;tags&quot;</span>: <span class=\"number\">1</span> &#125;, &#123; <span class=\"string\">&quot;sparse&quot;</span>: <span class=\"literal\">true</span> &#125;); <span class=\"comment\">// å¦‚æœä¸æ˜¯æ¯ä¸ªæ–‡æ¡£éƒ½æœ‰tagsï¼Œå¯ä»¥ä½¿ç”¨sparseé€‰é¡¹ä»¥èŠ‚çœç©ºé—´</span></span><br><span class=\"line\">db.<span class=\"property\">products</span>.<span class=\"title function_\">find</span>(&#123; <span class=\"string\">&quot;tags&quot;</span>: <span class=\"string\">&quot;smartphone&quot;</span> &#125;); <span class=\"comment\">// æ‰¾åˆ°æ‰€æœ‰å¸¦æœ‰â€œsmartphoneâ€æ ‡ç­¾çš„å•†å“</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å”¯ä¸€ç´¢å¼• - ç¡®ä¿å“ç‰Œåç§°ä¸é‡å¤</p>\n</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">db.<span class=\"property\">products</span>.<span class=\"title function_\">createIndex</span>(&#123; <span class=\"attr\">brand</span>: <span class=\"number\">1</span> &#125;, &#123; <span class=\"attr\">unique</span>: <span class=\"literal\">true</span> &#125;);</span><br><span class=\"line\"><span class=\"comment\">// å°è¯•æ’å…¥é‡å¤è®°å½•æ—¶</span></span><br><span class=\"line\">db.<span class=\"property\">products</span>.<span class=\"title function_\">insertOne</span>(&#123; <span class=\"attr\">category</span>: <span class=\"string\">&quot;Electronics&quot;</span>, <span class=\"attr\">brand</span>: <span class=\"string\">&quot;Apple&quot;</span>, ... &#125;); <span class=\"comment\">// æ­£å¸¸æ’å…¥</span></span><br><span class=\"line\">db.<span class=\"property\">products</span>.<span class=\"title function_\">insertOne</span>(&#123; <span class=\"attr\">category</span>: <span class=\"string\">&quot;Computers&quot;</span>, <span class=\"attr\">brand</span>: <span class=\"string\">&quot;Apple&quot;</span>, ... &#125;); <span class=\"comment\">// è‹¥æ•°æ®åº“ä¸­å·²æœ‰Appleå“ç‰Œï¼Œåˆ™ä¼šå› è¿åå”¯ä¸€æ€§è€ŒæŠ¥é”™</span></span><br></pre></td></tr></table></figure>","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç»å¦‚ä½•ä½¿ç”¨MongoDB7.0çš„ç´¢å¼• MongoDBç‰ˆæœ¬7.0.6 MongoDB Indexes MongoDBç´¢å¼•ç®€ä»‹ ç´¢å¼•æ”¯æŒåœ¨MongoDBä¸­é«˜æ•ˆæ‰§è¡ŒæŸ¥è¯¢ã€‚å¦‚æœæ²¡æœ‰ç´¢å¼•ï¼ŒMongoDBå¿…é¡»æ‰«æé›†åˆä¸­çš„æ¯ä¸ªæ–‡æ¡£æ‰èƒ½è¿”å›æŸ¥è¯¢ç»“æœã€‚å¦‚æœæŸ¥è¯¢å­˜åœ¨é€‚å½“çš„ç´¢å¼•ï¼ŒMongoDBä½¿ç”¨è¯¥ç´¢å¼•æ¥é™åˆ¶å®ƒå¿…é¡»æ‰«æçš„æ–‡æ¡£æ•°é‡ã€‚ è™½ç„¶ç´¢å¼•å¯ä»¥æé«˜æŸ¥è¯¢æ€§èƒ½ï¼Œä½†æ·»åŠ ç´¢å¼•å¯¹å†™å…¥æ“ä½œçš„æ€§èƒ½æœ‰è´Ÿé¢å½±å“ã€‚å¯¹äºå†™å…¥è¯»æ•°æ¯”è¾ƒé«˜çš„é›†åˆï¼Œç´¢å¼•å¾ˆæ˜‚è´µï¼Œå› ä¸ºæ¯ä¸ªæ’å…¥è¿˜å¿…é¡»æ›´æ–°ä»»ä½•ç´¢å¼•ã€‚ æ‰€ä»¥åˆç†çš„åˆ›å»ºç´¢å¼•ï¼Œå³å¯ä»¥æå‡æŸ¥è¯¢æ€§èƒ½ï¼Œåˆä¸ä¼šå¯¹å†™æ“ä½œé€ æˆå¤ªå¤§çš„å½±å“ã€‚ MongoDBé‡‡ç”¨ B-Tree (å‡†ç¡®çš„è¯´æ˜¯ B+Tree) åšç´¢å¼•ï¼Œç´¢å¼•åˆ›å»ºåœ¨colletionsä¸Šã€‚ åˆ›å»ºç´¢å¼•è¯­æ³• 1db.collection.createIndex( keys, options ) Key å€¼ä¸ºä½ è¦åˆ›å»ºçš„ç´¢å¼•å­—æ®µï¼Œ1 æŒ‰å‡åºåˆ›å»ºç´¢å¼•ï¼Œ -1 æŒ‰é™åºåˆ›å»ºç´¢å¼• options é€‰é¡¹ å‚æ•° ç±»å‹ æè¿° background Boolean å»ºç´¢å¼•è¿‡ç¨‹æ˜¯å¦é˜»å¡å…¶å®ƒæ•°æ®åº“æ“ä½œï¼Œè®¾ç½®ä¸º true åˆ™ä»¥åå°æ–¹å¼åˆ›å»ºç´¢å¼• unique Boolean å»ºç«‹çš„ç´¢å¼•æ˜¯å¦å”¯ä¸€ï¼Œè®¾ç½®ä¸º true åˆ™åˆ›å»ºå”¯ä¸€ç´¢å¼• name string ç´¢å¼•çš„åç§° dropDups Boolean 3.0+ç‰ˆæœ¬å·²åºŸå¼ƒï¼Œåœ¨å»ºç«‹å”¯ä¸€ç´¢å¼•æ—¶æ˜¯å¦åˆ é™¤é‡å¤è®°å½• sparse Boolean å¯¹æ–‡æ¡£ä¸­ä¸å­˜åœ¨çš„å­—æ®µæ•°æ®æ˜¯å¦å¯ç”¨ç´¢å¼• expireAfterSeconds integer æŒ‡å®šä¸€ä¸ªä»¥ç§’ä¸ºå•ä½çš„æ•°å€¼ï¼Œå®Œæˆ TTL è®¾å®šï¼Œè®¾å®šé›†åˆçš„ç”Ÿå­˜æ—¶é—´ v index version ç´¢å¼•çš„ç‰ˆæœ¬å· weights document ç´¢å¼•æƒé‡å€¼ï¼Œæ•°å€¼åœ¨ 1 åˆ° 99,999 ä¹‹é—´ï¼Œè¡¨ç¤ºè¯¥ç´¢å¼•ç›¸å¯¹äºå…¶ä»–ç´¢å¼•å­—æ®µçš„å¾—åˆ†æƒé‡ default_language string å¯¹äºæ–‡æœ¬ç´¢å¼•ï¼Œè¯¥å‚æ•°å†³å®šäº†åœç”¨è¯åŠè¯å¹²å’Œè¯å™¨çš„è§„åˆ™çš„åˆ—è¡¨ language_override string å¯¹äºæ–‡æœ¬ç´¢å¼•ï¼Œè¯¥å‚æ•°æŒ‡å®šäº†åŒ…å«åœ¨æ–‡æ¡£ä¸­çš„å­—æ®µåï¼Œè¯­è¨€è¦†ç›–é»˜è®¤çš„ language ç´¢å¼•ç±»å‹ ä¸å¤§å¤šæ•°æ•°æ®åº“ä¸€æ ·ï¼ŒMongoDBæ”¯æŒå„ç§ä¸°å¯Œçš„ç´¢å¼•ç±»å‹ï¼ŒåŒ…æ‹¬å•é”®ç´¢å¼•ã€å¤åˆç´¢å¼•ï¼Œå”¯ä¸€ç´¢å¼•ç­‰ä¸€äº›å¸¸ç”¨çš„ç»“æ„ã€‚ç”±äºé‡‡ç”¨äº†çµæ´»å¯å˜çš„æ–‡æ¡£ç±»å‹ï¼Œå› æ­¤å®ƒä¹ŸåŒæ ·æ”¯æŒå¯¹åµŒå¥—å­—æ®µã€æ•°ç»„è¿›è¡Œç´¢å¼•ã€‚é€šè¿‡å»ºç«‹åˆé€‚çš„ç´¢å¼•ï¼Œæˆ‘ä»¬å¯ä»¥æå¤§åœ°æå‡æ•°æ®çš„æ£€ç´¢é€Ÿåº¦ã€‚åœ¨ä¸€äº›ç‰¹æ®Šåº”ç”¨åœºæ™¯ï¼ŒMongoDBè¿˜æ”¯æŒåœ°ç†ç©ºé—´ç´¢å¼•ã€æ–‡æœ¬æ£€ç´¢ç´¢å¼•ã€TTLç´¢å¼•ç­‰ä¸åŒçš„ç‰¹æ€§ã€‚ å•é”®ç´¢å¼•(Single Field Indexes) å•é”®ç´¢å¼•æ˜¯MongoDBæœ€ç®€å•çš„ç´¢å¼•ç±»å‹ï¼Œå®ƒå°†ä¸€ä¸ªå­—æ®µä½œä¸ºç´¢å¼•é”®ï¼Œç´¢å¼•é”®å€¼å”¯ä¸€ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼ŒMongoDBä¼šåœ¨IDå­—æ®µä¸Šåˆ›å»ºä¸€ä¸ªå•é”®ç´¢å¼•ï¼ŒIDå­—æ®µæ˜¯æ–‡æ¡£çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼ŒMongoDBä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªIDå­—æ®µï¼Œå¦‚æœç”¨æˆ·è‡ªå·±åˆ›å»ºIDå­—æ®µï¼ŒMongoDBä¼šè‡ªåŠ¨å°†IDå­—æ®µä½œä¸ºå•é”®ç´¢å¼•ã€‚ å•é”®ç´¢å¼•çš„åˆ›å»ºæ–¹å¼å¦‚ä¸‹ï¼š 1234# 1è¡¨ç¤ºæ­£åºï¼Œ-1è¡¨ç¤ºå€’åºdb.books.createIndex(&#123;title:1&#125;)# å¯¹å†…åµŒæ–‡æ¡£å­—æ®µåˆ›å»ºç´¢å¼•ï¼šdb.books.createIndex(&#123;&quot;author.name&quot;:1&#125;) å¤åˆç´¢å¼•(Compound Index) å¤åˆç´¢å¼•æ˜¯å°†å¤šä¸ªå­—æ®µä½œä¸ºç´¢å¼•é”®ï¼Œå…¶æ€§è´¨å’Œå•å­—æ®µç´¢å¼•ç±»ä¼¼ã€‚ä½†ä¸åŒçš„æ˜¯ï¼Œå¤åˆç´¢å¼•ä¸­å­—æ®µçš„é¡ºåºã€å­—æ®µçš„å‡é™åºå¯¹æŸ¥è¯¢æ€§èƒ½æœ‰ç›´æ¥çš„å½±å“ï¼Œå› æ­¤åœ¨è®¾è®¡å¤åˆç´¢å¼•æ—¶åˆ™éœ€è¦è€ƒè™‘ä¸åŒçš„æŸ¥è¯¢åœºæ™¯ã€‚ å¤åˆç´¢å¼•çš„åˆ›å»ºæ–¹å¼å¦‚ä¸‹ï¼š 123db.books.createIndex(&#123;title:1, author.name:1&#125;)# å¯¹å†…åµŒæ–‡æ¡£å­—æ®µåˆ›å»ºç´¢å¼•ï¼šdb.books.createIndex(&#123;&quot;author.name&quot;:1, &quot;author.age&quot;:1&#125;) å¤šé”®(æ•°ç»„)ç´¢å¼•(Multikey Index) å¤šé”®ç´¢å¼•æ˜¯å°†ä¸€ä¸ªå­—æ®µä½œä¸ºç´¢å¼•é”®ï¼Œè¯¥å­—æ®µå¯ä»¥æ˜¯åµŒå¥—æ–‡æ¡£ã€æ•°ç»„ç­‰å¤æ‚æ•°æ®ç±»å‹ã€‚ å¤šé”®ç´¢å¼•çš„åˆ›å»ºæ–¹å¼å¦‚ä¸‹ï¼š 1234567891011121314151617# tagså­—æ®µä¸ºæ•°ç»„db.books.createIndex(&#123;&quot;tags&quot;:1&#125;)# åˆ›å»ºå¤åˆå¤šå€¼ç´¢å¼•ï¼Œè¿™é‡Œä»…èƒ½æœ‰ä¸€ä¸ªå­—æ®µæ˜¯æ•°ç»„ï¼ŒMongoDBå¹¶ä¸æ”¯æŒä¸€ä¸ªå¤åˆç´¢å¼•ä¸­åŒæ—¶å‡ºç°å¤šä¸ªæ•°ç»„å­—æ®µdb.books.createIndex(&#123;title:1, tags:1&#125;)# ç¤ºä¾‹æ•°æ®æ ¼å¼&#123; _id: 1, item: &quot;abc&quot;, stock: [ &#123; size: &quot;S&quot;, color: &quot;red&quot;, quantity: 25 &#125;, &#123; size: &quot;S&quot;, color: &quot;blue&quot;, quantity: 10 &#125;, &#123; size: &quot;M&quot;, color: &quot;blue&quot;, quantity: 50 &#125; ]&#125;# å¯ä»¥å¯¹åµŒå…¥æ–‡æ¡£åˆ›å»ºå¤šé”®ç´¢å¼•db.collection.createIndex( &#123; &quot;stock.size&quot;: 1, &quot;stock.quantity&quot;: 1 &#125; ) Hashç´¢å¼•(Hashed Indexes) Hashç´¢å¼•æ˜¯MongoDBä¸­çš„ä¸€ç§ç‰¹æ®Šçš„ç´¢å¼•ç±»å‹ï¼Œå®ƒå°†å­—æ®µçš„å€¼è®¡ç®—å‡ºä¸€ä¸ªå“ˆå¸Œå€¼ï¼Œç„¶åå°†è¯¥å“ˆå¸Œå€¼ä½œä¸ºç´¢å¼•é”®ã€‚ç”±äºå“ˆå¸Œå€¼çš„å”¯ä¸€æ€§ï¼Œå› æ­¤MongoDBåœ¨åˆ›å»ºHashç´¢å¼•æ—¶ï¼Œä¸ä¼šå¯¹ç´¢å¼•é”®å€¼è¿›è¡Œæ’åºã€‚ Hashç´¢å¼•çš„åˆ›å»ºæ–¹å¼å¦‚ä¸‹ï¼š 123db.books.createIndex(&#123;title:&quot;hashed&quot;&#125;)# å¯¹å†…åµŒæ–‡æ¡£å­—æ®µåˆ›å»ºç´¢å¼•ï¼šdb.books.createIndex(&#123;&quot;author.name&quot;:&quot;hashed&quot;&#125;) é€šé…ç¬¦ç´¢å¼•(Wildcard Indexes) é€šé…ç¬¦ç´¢å¼•æ˜¯MongoDBä¸­çš„ä¸€ç§ç‰¹æ®Šçš„ç´¢å¼•ç±»å‹ï¼Œå®ƒå…è®¸åœ¨ç´¢å¼•é”®å€¼ä¸­åŒ…å«é€šé…ç¬¦ï¼Œä»è€Œæ”¯æŒå¯¹é€šé…ç¬¦åŒ¹é…çš„æŸ¥è¯¢ã€‚ MongoDB 4.2 å¼•å…¥äº†é€šé…ç¬¦ç´¢ é€šé…ç¬¦ç´¢å¼•çš„åˆ›å»ºæ–¹å¼å¦‚ä¸‹ï¼š 12345678910111213# ç¤ºä¾‹æ•°æ®&#123; &quot;product_name&quot; : &quot;Spy Coat&quot;, &quot;product_attributes&quot; : &#123; &quot;material&quot; : [ &quot;Tweed&quot;, &quot;Wool&quot;, &quot;Leather&quot; ], &quot;size&quot; : &#123; &quot;length&quot; : 72, &quot;units&quot; : &quot;inches&quot; &#125; &#125;&#125;db.products.createIndex( &#123; &quot;product_attributes.$**&quot; : 1 &#125; ) é€šé…ç¬¦ç´¢å¼•æ˜¯ç¨€ç–çš„ï¼Œä¸ç´¢å¼•ç©ºå­—æ®µã€‚å› æ­¤ï¼Œé€šé…ç¬¦ç´¢å¼•ä¸èƒ½æ”¯æŒæŸ¥è¯¢å­—æ®µä¸å­˜åœ¨çš„æ–‡æ¡£ã€‚ 12345# é€šé…ç¬¦ç´¢å¼•ä¸èƒ½æ”¯æŒä»¥ä¸‹æŸ¥è¯¢db.products.find( &#123;&quot;product_attributes&quot; : &#123; $exists : false &#125; &#125; )db.products.aggregate([ &#123; $match : &#123; &quot;product_attributes&quot; : &#123; $exists : false &#125; &#125; &#125;]) é€šé…ç¬¦ç´¢å¼•ä¸ºæ–‡æ¡£æˆ–æ•°ç»„çš„å†…å®¹ç”Ÿæˆæ¡ç›®ï¼Œè€Œä¸æ˜¯æ–‡æ¡£/æ•°ç»„æœ¬èº«ã€‚å› æ­¤é€šé…ç¬¦ç´¢å¼•ä¸èƒ½æ”¯æŒç²¾ç¡®çš„æ–‡æ¡£/æ•°ç»„ç›¸ç­‰åŒ¹é…ã€‚é€šé…ç¬¦ç´¢å¼•å¯ä»¥æ”¯æŒæŸ¥è¯¢å­—æ®µç­‰äºç©ºæ–‡æ¡£{}çš„æƒ…å†µ 123456#é€šé…ç¬¦ç´¢å¼•ä¸èƒ½æ”¯æŒä»¥ä¸‹æŸ¥è¯¢:db.products.find(&#123; &quot;product_attributes.colors&quot; : [ &quot;Blue&quot;, &quot;Black&quot; ] &#125; )db.products.aggregate([&#123; $match : &#123; &quot;product_attributes.colors&quot; : [ &quot;Blue&quot;, &quot;Black&quot; ] &#125;&#125;]) ç´¢å¼•å±æ€§ å”¯ä¸€ç´¢å¼•(Unique Indexes) å”¯ä¸€ç´¢å¼•çš„åˆ›å»ºæ–¹å¼å¦‚ä¸‹ï¼š 123456# å•é”®ç´¢å¼•æ”¯æŒå”¯ä¸€çº¦æŸdb.books.createIndex(&#123;title:1&#125;, &#123;unique:true&#125;)# å¤åˆç´¢å¼•æ”¯æŒå”¯ä¸€æ€§çº¦æŸdb.books.createIndex(&#123;title:1ï¼Œtype:1&#125;, &#123;unique:true&#125;)# å¤šé”®ç´¢å¼•æ”¯æŒå”¯ä¸€æ€§çº¦æŸï¼Œè¿™é‡Œtagsæ˜¯æ•°ç»„db.books.createIndex(&#123;&quot;tags&quot;:1&#125;, &#123;unique:true&#125;) å”¯ä¸€æ€§ç´¢å¼•å¯¹äºæ–‡æ¡£ä¸­ç¼ºå¤±çš„å­—æ®µï¼Œä¼šä½¿ç”¨nullå€¼ä»£æ›¿ï¼Œå› æ­¤ä¸å…è®¸å­˜åœ¨å¤šä¸ªæ–‡æ¡£ç¼ºå¤±ç´¢å¼•å­—æ®µçš„æƒ…å†µã€‚ å¯¹äºåˆ†ç‰‡çš„é›†åˆï¼Œå”¯ä¸€æ€§çº¦æŸå¿…é¡»åŒ¹é…åˆ†ç‰‡è§„åˆ™ã€‚æ¢å¥è¯è¯´ï¼Œä¸ºäº†ä¿è¯å…¨å±€çš„å”¯ä¸€æ€§ï¼Œåˆ†ç‰‡é”®å¿…é¡»ä½œä¸ºå”¯ä¸€æ€§ç´¢å¼•çš„å‰ç¼€å­—æ®µã€‚ éƒ¨åˆ†ç´¢å¼•(Partial Indexes) éƒ¨åˆ†ç´¢å¼•ä»…å¯¹æ»¡è¶³æŒ‡å®šè¿‡æ»¤å™¨è¡¨è¾¾å¼çš„æ–‡æ¡£è¿›è¡Œç´¢å¼•ã€‚é€šè¿‡åœ¨ä¸€ä¸ªé›†åˆä¸­ä¸ºæ–‡æ¡£çš„ä¸€ä¸ªå­é›†å»ºç«‹ç´¢å¼•ï¼Œéƒ¨åˆ†ç´¢å¼•å…·æœ‰æ›´ä½çš„å­˜å‚¨éœ€æ±‚å’Œæ›´ä½çš„ç´¢å¼•åˆ›å»ºå’Œç»´æŠ¤çš„æ€§èƒ½æˆæœ¬ã€‚ éƒ¨åˆ†ç´¢å¼•çš„åˆ›å»ºæ–¹å¼å¦‚ä¸‹ï¼š 12# ç¬¦åˆæ¡ä»¶&#123;author: &#123;$exists: true&#125;&#125;ï¼Œå³å­˜åœ¨ä½œè€…ï¼Œæ‰å¯¹titleåˆ›å»ºå‡åºç´¢å¼•db.books.createIndex(&#123;title:1&#125;, &#123;partialFilterExpression: &#123;author: &#123;$exists: true&#125;&#125;&#125;) partialFilterExpression(ç­›é€‰å™¨è¡¨è¾¾å¼)é€‰é¡¹æ¥å—æŒ‡å®šè¿‡æ»¤æ¡ä»¶çš„æ–‡æ¡£: - ç­‰å¼è¡¨è¾¾å¼(ä¾‹å¦‚:field: valueæˆ–ä½¿ç”¨$eqæ“ä½œç¬¦) - $exists: true - $gtï¼Œ $gteï¼Œ $ltï¼Œ $lte - type - é¡¶å±‚çš„and æ³¨æ„ï¼šå¦‚æœåŒæ—¶æŒ‡å®šäº†partialFilterExpressionå’Œå”¯ä¸€çº¦æŸï¼Œé‚£ä¹ˆå”¯ä¸€çº¦æŸåªé€‚ç”¨äºæ»¡è¶³ç­›é€‰å™¨è¡¨è¾¾å¼çš„æ–‡æ¡£ã€‚å¦‚æœæ–‡æ¡£ä¸æ»¡è¶³ç­›é€‰æ¡ä»¶ï¼Œé‚£ä¹ˆå¸¦æœ‰æƒŸä¸€çº¦æŸçš„éƒ¨åˆ†ç´¢å¼•ä¸ä¼šé˜»æ­¢æ’å…¥ä¸æ»¡è¶³æƒŸä¸€çº¦æŸçš„æ–‡æ¡£ã€‚ ç¨€ç–ç´¢å¼•(Sparse Indexes) ç´¢å¼•çš„ç¨€ç–å±æ€§ç¡®ä¿ç´¢å¼•åªåŒ…å«å…·æœ‰ç´¢å¼•å­—æ®µçš„æ–‡æ¡£çš„æ¡ç›®ï¼Œç´¢å¼•å°†è·³è¿‡æ²¡æœ‰ç´¢å¼•å­—æ®µçš„æ–‡æ¡£ã€‚å³åªå¯¹å­˜åœ¨å­—æ®µçš„æ–‡æ¡£è¿›è¡Œç´¢å¼•ï¼ˆåŒ…æ‹¬å­—æ®µå€¼ä¸ºnullçš„æ–‡æ¡£ï¼‰ã€‚ å¦‚æœç¨€ç–ç´¢å¼•ä¼šå¯¼è‡´æŸ¥è¯¢å’Œæ’åºæ“ä½œçš„ç»“æœé›†ä¸å®Œæ•´ï¼ŒMongoDBå°†ä¸ä¼šä½¿ç”¨è¯¥ç´¢å¼•ï¼Œé™¤éhint()æ˜ç¡®æŒ‡å®šç´¢å¼•ã€‚ ç¨€ç–ç´¢å¼•çš„åˆ›å»ºæ–¹å¼å¦‚ä¸‹ï¼š 12345678910111213141516171819# æ•°æ®å‡†å¤‡db.scores.insertMany([ &#123;&quot;userid&quot; : &quot;newbie&quot;&#125;, &#123;&quot;userid&quot; : &quot;abby&quot;, &quot;score&quot; : 82&#125;, &#123;&quot;userid&quot; : &quot;nina&quot;, &quot;score&quot; : 90&#125;])# åˆ›å»ºç¨€ç–ç´¢å¼•db.scores.createIndex( &#123; score: 1 &#125; , &#123; sparse: true &#125; )# æµ‹è¯•# ä½¿ç”¨ç¨€ç–ç´¢å¼•db.scores.find( &#123; score: &#123; $lt: 90 &#125; &#125; )# å³ä½¿æ’åºæ˜¯é€šè¿‡ç´¢å¼•å­—æ®µï¼ŒMongoDBä¹Ÿä¸ä¼šé€‰æ‹©ç¨€ç–ç´¢å¼•æ¥å®ŒæˆæŸ¥è¯¢ï¼Œä»¥è¿”å›å®Œæ•´çš„ç»“æœdb.scores.find().sort( &#123; score: -1 &#125; )# è¦ä½¿ç”¨ç¨€ç–ç´¢å¼•ï¼Œä½¿ç”¨hint()æ˜¾å¼æŒ‡å®šç´¢å¼•db.scores.find().sort( &#123; score: -1 &#125; ).hint( &#123; score: 1 &#125; ) åŒæ—¶å…·æœ‰ç¨€ç–æ€§å’Œå”¯ä¸€æ€§çš„ç´¢å¼•å¯ä»¥é˜²æ­¢é›†åˆä¸­å­˜åœ¨å­—æ®µå€¼é‡å¤çš„æ–‡æ¡£ï¼Œä½†å…è®¸ä¸åŒ…å«æ­¤ç´¢å¼•å­—æ®µçš„æ–‡æ¡£æ’å…¥ã€‚ 123456789101112# åˆ é™¤ä¹‹å‰åˆ›å»ºçš„ç´¢å¼•db.scores.dropIndex(&#123;score:1&#125;)# åˆ›å»ºå…·æœ‰å”¯ä¸€çº¦æŸçš„ç¨€ç–ç´¢å¼•db.scores.createIndex( &#123; score: 1 &#125; , &#123; sparse: true, unique: true &#125; )# æµ‹è¯•æ’å…¥db.scores.insertMany( [ &#123; &quot;userid&quot;: &quot;AAAAAAA&quot;, &quot;score&quot;: 50 &#125;, &#123; &quot;userid&quot;: &quot;BBBBBBB&quot;, &quot;score&quot;: 64 &#125;, &#123; &quot;userid&quot;: &quot;CCCCCCC&quot; &#125;, &#123; &quot;userid&quot;: &quot;CCCCCCC&quot; &#125;] ) TTLç´¢å¼•(TTL Indexes) MongoDB å¯ä»¥ä½¿ç”¨å®ƒåœ¨ä¸€å®šæ—¶é—´æˆ–ç‰¹å®šæ—¶é’Ÿæ—¶é—´åè‡ªåŠ¨ä»é›†åˆä¸­åˆ é™¤æ–‡æ¡£ï¼Œå°±æ˜¯å¸¦æœ‰è¿‡æœŸæ—¶é—´çš„ç´¢å¼•ï¼Œåˆ°æœŸåï¼ŒMongoDBä¼šè‡ªåŠ¨åˆ é™¤è¿™äº›è¿‡æœŸçš„æ–‡æ¡£ã€‚ TTLç´¢å¼•åªèƒ½åˆ›å»ºåœ¨æ—¥æœŸå­—æ®µä¸Šï¼Œå½“æ–‡æ¡£è¿‡æœŸåï¼ŒMongoDBä¼šè‡ªåŠ¨åˆ é™¤è¿™äº›æ–‡æ¡£ã€‚ TTLç´¢å¼•çš„åˆ›å»ºæ–¹å¼å¦‚ä¸‹ï¼š 12345678# æ•°æ®å‡†å¤‡db.log_events.insertOne( &#123; &quot;createdAt&quot;: new Date(), &quot;logEvent&quot;: 2, &quot;logMessage&quot;: &quot;Success!&quot;&#125; )# åˆ›å»ºTTLç´¢å¼•db.scores.createIndex( &#123; &quot;createdAt&quot;: 1 &#125;, &#123; expireAfterSeconds: 3600 &#125; ) TTL ç´¢å¼•ä¸ä¿è¯è¿‡æœŸæ•°æ®ä¼šåœ¨è¿‡æœŸåç«‹å³è¢«åˆ é™¤ã€‚æ–‡æ¡£è¿‡æœŸå’Œ MongoDB ä»æ•°æ®åº“ä¸­åˆ é™¤æ–‡æ¡£çš„æ—¶é—´ä¹‹é—´å¯èƒ½å­˜åœ¨å»¶è¿Ÿã€‚åˆ é™¤è¿‡æœŸæ–‡æ¡£çš„åå°ä»»åŠ¡æ¯ 60 ç§’è¿è¡Œä¸€æ¬¡ã€‚å› æ­¤ï¼Œåœ¨æ–‡æ¡£åˆ°æœŸå’Œåå°ä»»åŠ¡è¿è¡Œä¹‹é—´çš„æ—¶é—´æ®µå†…ï¼Œæ–‡æ¡£å¯èƒ½ä¼šä¿ç•™åœ¨é›†åˆä¸­ã€‚ TTLç´¢å¼•åœ¨åˆ›å»ºä¹‹åï¼Œä»ç„¶å¯ä»¥å¯¹è¿‡æœŸæ—¶é—´è¿›è¡Œä¿®æ”¹ã€‚è¿™éœ€è¦ä½¿ç”¨collModå‘½ä»¤å¯¹ç´¢å¼•çš„å®šä¹‰è¿›è¡Œå˜æ›´ 1234567db.runCommand( &#123; collMod: &quot;log_events&quot;, index: &#123; keyPattern: &#123; createdAt: 1 &#125;, expireAfterSeconds: 3600 &#125;&#125; ) éšè—ç´¢å¼•(Hidden Indexes) éšè—ç´¢å¼•å¯¹æŸ¥è¯¢è§„åˆ’å™¨ä¸å¯è§ï¼Œä¸èƒ½ç”¨äºæŸ¥è¯¢ã€‚ é€šè¿‡å¯¹è§„åˆ’å™¨éšè—ç´¢å¼•ï¼Œç”¨æˆ·å¯ä»¥åœ¨ä¸å®é™…åˆ é™¤ç´¢å¼•çš„æƒ…å†µä¸‹è¯„ä¼°åˆ é™¤ç´¢å¼•çš„æ½œåœ¨å½±å“ã€‚å¦‚æœå½±å“æ˜¯è´Ÿé¢çš„ï¼Œç”¨æˆ·å¯ä»¥å–æ¶ˆéšè—ç´¢å¼•ï¼Œè€Œä¸å¿…é‡æ–°åˆ›å»ºå·²åˆ é™¤çš„ç´¢å¼•ã€‚ éšè—ç´¢å¼•çš„åˆ›å»ºæ–¹å¼å¦‚ä¸‹ï¼š 12345678# åˆ›å»ºéšè—ç´¢å¼•db.restaurants.createIndex(&#123; borough: 1 &#125;,&#123; hidden: true &#125;);# éšè—ç°æœ‰ç´¢å¼•db.restaurants.hideIndex( &#123; borough: 1&#125; );db.restaurants.hideIndex( &quot;ç´¢å¼•åç§°&quot; )# å–æ¶ˆéšè—ç´¢å¼•db.restaurants.unhideIndex( &#123; borough: 1&#125; );db.restaurants.unhideIndex( &quot;ç´¢å¼•åç§°&quot; ); ç´¢å¼•å…¶å®ƒæ“ä½œ æŸ¥çœ‹ç´¢å¼• 1234# æŸ¥çœ‹ç´¢å¼•ä¿¡æ¯db.books.getIndexes()# æŸ¥çœ‹ç´¢å¼•é”®db.books.getIndexKeys() åˆ é™¤ç´¢å¼• 1234# åˆ é™¤é›†åˆæŒ‡å®šç´¢å¼•db.col.dropIndex(&quot;ç´¢å¼•åç§°&quot;)# åˆ é™¤é›†åˆæ‰€æœ‰ç´¢å¼•,ä¸èƒ½åˆ é™¤ä¸»é”®ç´¢å¼•db.col.dropIndexes() ç´¢å¼•ä½¿ç”¨å»ºè®® ä¸ºæ¯ä¸€ä¸ªæŸ¥è¯¢å»ºç«‹åˆé€‚çš„ç´¢å¼• è¿™ä¸ªæ˜¯é’ˆå¯¹äºæ•°æ®é‡è¾ƒå¤§æ¯”å¦‚è¯´è¶…è¿‡å‡ åä¸Šç™¾ä¸‡ï¼ˆæ–‡æ¡£æ•°ç›®ï¼‰æ•°é‡çº§çš„é›†åˆã€‚ å¦‚æœæ²¡æœ‰ç´¢å¼•MongoDBéœ€è¦æŠŠæ‰€æœ‰çš„Documentä»ç›˜ä¸Šè¯»åˆ°å†…å­˜ï¼Œè¿™ä¼šå¯¹MongoDBæœåŠ¡å™¨é€ æˆè¾ƒå¤§çš„å‹åŠ›å¹¶å½±å“åˆ°å…¶ä»–è¯·æ±‚çš„æ‰§è¡Œã€‚ åˆ›å»ºåˆé€‚çš„å¤åˆç´¢å¼•ï¼Œä¸è¦ä¾èµ–äºäº¤å‰ç´¢å¼• å¦‚æœä½ çš„æŸ¥è¯¢ä¼šä½¿ç”¨åˆ°å¤šä¸ªå­—æ®µï¼ŒMongoDBæœ‰ä¸¤ä¸ªç´¢å¼•æŠ€æœ¯å¯ä»¥ä½¿ç”¨ï¼šäº¤å‰ç´¢å¼•å’Œå¤åˆç´¢å¼•ã€‚ äº¤å‰ç´¢å¼•å°±æ˜¯é’ˆå¯¹æ¯ä¸ªå­—æ®µå•ç‹¬å»ºç«‹ä¸€ä¸ªå•å­—æ®µç´¢å¼•ï¼Œç„¶ååœ¨æŸ¥è¯¢æ‰§è¡Œæ—¶å€™ä½¿ç”¨ç›¸åº”çš„å•å­—æ®µç´¢å¼•è¿›è¡Œç´¢å¼•äº¤å‰è€Œå¾—åˆ°æŸ¥è¯¢ç»“æœã€‚ äº¤å‰ç´¢å¼•ç›®å‰è§¦å‘ç‡è¾ƒä½ï¼Œæ‰€ä»¥å¦‚æœä½ æœ‰ä¸€ä¸ªå¤šå­—æ®µæŸ¥è¯¢çš„æ—¶å€™ï¼Œå»ºè®®ä½¿ç”¨å¤åˆç´¢å¼•èƒ½å¤Ÿä¿è¯ç´¢å¼•æ­£å¸¸çš„ä½¿ç”¨ã€‚ 1234#æŸ¥æ‰¾æ‰€æœ‰å¹´é¾„å°äº30å²çš„æ·±åœ³å¸‚é©¬æ‹‰æ¾è¿åŠ¨å‘˜db.athelets.find(&#123;sport: &quot;marathon&quot;, location: &quot;sz&quot;, age: &#123;$lt: 30&#125;&#125;&#125;)#åˆ›å»ºå¤åˆç´¢å¼•db.athelets.createIndex(&#123;sport:1, location:1, age:1&#125;) å¤åˆç´¢å¼•å­—æ®µé¡ºåºï¼šåŒ¹é…æ¡ä»¶åœ¨å‰ï¼ŒèŒƒå›´æ¡ä»¶åœ¨åï¼ˆEquality First, Range Afterï¼‰ å‰é¢çš„ä¾‹å­ï¼Œåœ¨åˆ›å»ºå¤åˆç´¢å¼•æ—¶å¦‚æœæ¡ä»¶æœ‰åŒ¹é…å’ŒèŒƒå›´ä¹‹åˆ†ï¼Œé‚£ä¹ˆåŒ¹é…æ¡ä»¶ï¼ˆsport: â€œmarathonâ€) åº”è¯¥åœ¨å¤åˆç´¢å¼•çš„å‰é¢ã€‚èŒƒå›´æ¡ä»¶(age: &lt;30)å­—æ®µåº”è¯¥æ”¾åœ¨å¤åˆç´¢å¼•çš„åé¢ã€‚ å°½å¯èƒ½ä½¿ç”¨è¦†ç›–ç´¢å¼•ï¼ˆCovered Indexï¼‰ å»ºè®®åªè¿”å›éœ€è¦çš„å­—æ®µï¼ŒåŒæ—¶ï¼Œåˆ©ç”¨è¦†ç›–ç´¢å¼•æ¥æå‡æ€§èƒ½ã€‚ å»ºç´¢å¼•è¦åœ¨åå°è¿è¡Œ åœ¨å¯¹ä¸€ä¸ªé›†åˆåˆ›å»ºç´¢å¼•æ—¶ï¼Œè¯¥é›†åˆæ‰€åœ¨çš„æ•°æ®åº“å°†ä¸æ¥å—å…¶ä»–è¯»å†™æ“ä½œã€‚å¯¹å¤§æ•°æ®é‡çš„é›†åˆå»ºç´¢å¼•ï¼Œå»ºè®®ä½¿ç”¨åå°è¿è¡Œé€‰é¡¹ {background: true} é¿å…è®¾è®¡è¿‡é•¿çš„æ•°ç»„ç´¢å¼• æ•°ç»„ç´¢å¼•æ˜¯å¤šå€¼çš„ï¼Œåœ¨å­˜å‚¨æ—¶éœ€è¦ä½¿ç”¨æ›´å¤šçš„ç©ºé—´ã€‚å¦‚æœç´¢å¼•çš„æ•°ç»„é•¿åº¦ç‰¹åˆ«é•¿ï¼Œæˆ–è€…æ•°ç»„çš„å¢é•¿ä¸å—æ§åˆ¶ï¼Œåˆ™å¯èƒ½å¯¼è‡´ç´¢å¼•ç©ºé—´æ€¥å‰§è†¨èƒ€ã€‚ explainæ‰§è¡Œè®¡åˆ’ explainæ‰§è¡Œè®¡åˆ’çš„ä½œç”¨æ˜¯ï¼šæŸ¥çœ‹MongoDBæ‰§è¡ŒæŸ¥è¯¢æ—¶çš„æ‰§è¡Œè®¡åˆ’ã€‚ explainæ‰§è¡Œè®¡åˆ’çš„ä½¿ç”¨æ–¹å¼å¦‚ä¸‹ï¼š 1234567# è¯­æ³•db.collection.find().explain(&lt;verbose&gt;)# ç¤ºä¾‹db.books.find(&#123;title: &quot;MongoDB æ•™ç¨‹&quot;&#125;).explain()db.books.find(&#123;title: &quot;MongoDB æ•™ç¨‹&quot;&#125;).explain(&quot;executionStats&quot;)db.books.find(&#123;title: &quot;MongoDB æ•™ç¨‹&quot;&#125;).explain(&quot;allPlansExecution&quot;) verbose :å¯é€‰å‚æ•°ï¼Œè¡¨ç¤ºæ‰§è¡Œè®¡åˆ’çš„è¾“å‡ºæ¨¡å¼ï¼Œé»˜è®¤queryPlanner æ¨¡å¼åå­— æè¿° queryPlanner æ‰§è¡Œè®¡åˆ’çš„è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…æ‹¬æŸ¥è¯¢è®¡åˆ’ã€é›†åˆä¿¡æ¯ã€æŸ¥è¯¢æ¡ä»¶ã€æœ€ä½³æ‰§è¡Œè®¡åˆ’ã€æŸ¥è¯¢æ–¹å¼å’Œ MongoDB æœåŠ¡ä¿¡æ¯ç­‰ executionStats æœ€ä½³æ‰§è¡Œè®¡åˆ’çš„æ‰§è¡Œæƒ…å†µå’Œè¢«æ‹’ç»çš„è®¡åˆ’ç­‰ä¿¡æ¯ allPlansExecution é€‰æ‹©å¹¶æ‰§è¡Œæœ€ä½³æ‰§è¡Œè®¡åˆ’ï¼Œå¹¶è¿”å›æœ€ä½³æ‰§è¡Œè®¡åˆ’å’Œå…¶ä»–æ‰§è¡Œè®¡åˆ’çš„æ‰§è¡Œæƒ…å†µ è¾“å‡ºç»“æœä¸­é‡ç‚¹æŸ¥çœ‹stage,æ¯”å¦‚queryPlannerä¸‹çš„winningPlan.stage stageç±»å‹ çŠ¶æ€ æè¿° COLLSCAN å…¨è¡¨æ‰«æ IXSCAN ç´¢å¼•æ‰«æ FETCH æ ¹æ®ç´¢å¼•æ£€ç´¢æŒ‡å®šæ–‡æ¡£ SHARD_MERGE å°†å„ä¸ªåˆ†ç‰‡è¿”å›æ•°æ®è¿›è¡Œåˆå¹¶ SORT åœ¨å†…å­˜ä¸­è¿›è¡Œäº†æ’åº LIMIT ä½¿ç”¨ limit é™åˆ¶è¿”å›æ•° SKIP ä½¿ç”¨ skip è¿›è¡Œè·³è¿‡ IDHACK å¯¹ _id è¿›è¡ŒæŸ¥è¯¢ SHARDING_FILTER é€šè¿‡ mongos å¯¹åˆ†ç‰‡æ•°æ®è¿›è¡ŒæŸ¥è¯¢ COUNTSCAN count ä¸ä½¿ç”¨ç´¢å¼•è¿›è¡Œ count æ—¶çš„ stage è¿”å› COUNT_SCAN count ä½¿ç”¨äº†ç´¢å¼•è¿›è¡Œ count æ—¶çš„ stage è¿”å› SUBPLAN æœªä½¿ç”¨åˆ°ç´¢å¼•çš„ $or æŸ¥è¯¢çš„ stage è¿”å› TEXT ä½¿ç”¨å…¨æ–‡ç´¢å¼•è¿›è¡ŒæŸ¥è¯¢æ—¶å€™çš„ stage è¿”å› PROJECTION é™å®šè¿”å›å­—æ®µæ—¶å€™ stage çš„è¿”å› æ‰§è¡Œè®¡åˆ’çš„è¿”å›ç»“æœä¸­å°½é‡ä¸è¦å‡ºç°ä»¥ä¸‹stage: 12345- COLLSCAN(å…¨è¡¨æ‰«æ)- SORT(ä½¿ç”¨sortä½†æ˜¯æ— index)- ä¸åˆç†çš„SKIP- SUBPLA(æœªç”¨åˆ°indexçš„$or)- COUNTSCAN(ä¸ä½¿ç”¨indexè¿›è¡Œcount) å®æˆ˜ ä¸‹é¢æ˜¯ä¸€ä¸ªç»“åˆå„ç§ç´¢å¼•ç±»å‹çš„ç¤ºä¾‹ï¼Œå‡è®¾æˆ‘ä»¬æ­£åœ¨ä¸ºä¸€ä¸ªç”µå•†åº”ç”¨åˆ›å»ºå’Œç®¡ç†ä¸€ä¸ªMongoDBé›†åˆproductsï¼Œå…¶ä¸­åŒ…å«ä»¥ä¸‹å­—æ®µï¼š 123456_id: é»˜è®¤çš„ObjectIdç±»å‹ï¼Œä½œä¸ºä¸»é”®ï¼ˆå·²è‡ªåŠ¨å¸¦æœ‰å”¯ä¸€æ€§ç´¢å¼•ï¼‰ã€‚category: å•†å“åˆ†ç±»ï¼Œå­—ç¬¦ä¸²ç±»å‹ã€‚brand: å•†å“å“ç‰Œï¼Œå­—ç¬¦ä¸²ç±»å‹ã€‚tags: å•†å“æ ‡ç­¾æ•°ç»„ï¼ŒåŒ…å«å¤šä¸ªå­—ç¬¦ä¸²å…ƒç´ ã€‚price: å•†å“ä»·æ ¼ï¼Œæ•°å­—ç±»å‹ã€‚lastUpdated: å•†å“æœ€åæ›´æ–°æ—¶é—´ï¼Œæ—¥æœŸç±»å‹ã€‚ åˆ›å»ºé›†åˆä¸æ’å…¥æ–‡æ¡£ 1234567891011121314// å‡è®¾å·²ç»è¿æ¥åˆ°æ•°æ®åº“å¹¶é€‰æ‹©äº†ä¸€ä¸ªdatabasedb.createCollection(&quot;products&quot;);// æ’å…¥ä¸€äº›ç¤ºä¾‹æ•°æ®db.products.insertMany([ &#123; category: &quot;Electronics&quot;, brand: &quot;Apple&quot;, tags: [&quot;smartphone&quot;, &quot;ios&quot;], price: 999, lastUpdated: ISODate(&quot;2023-03-01T00:00:00Z&quot;) &#125;, // ...å…¶ä»–å•†å“æ–‡æ¡£]); å•é”®ç´¢å¼• - æŸ¥è¯¢å•†å“æŒ‰ä»·æ ¼æ’åº 12db.products.createIndex(&#123; price: 1 &#125;);db.products.find().sort(&#123; price: 1 &#125;); // è·å–æ‰€æœ‰å•†å“æŒ‰ä»·æ ¼å‡åºæ’åˆ— å¤åˆç´¢å¼• - æŒ‰å“ç‰Œå’Œä»·æ ¼æŸ¥è¯¢ï¼Œå¹¶è¿›è¡Œæ’åºï¼š 12db.products.createIndex(&#123; brand: 1, price: -1 &#125;);db.products.find(&#123; brand: &quot;Apple&quot; &#125;).sort(&#123; price: -1 &#125;); // è·å–æŒ‡å®šå“ç‰Œçš„å•†å“å¹¶æŒ‰ä»·æ ¼é™åºæ’åˆ— å¤šé”®ç´¢å¼• - æ ¹æ®å•†å“æ ‡ç­¾è¿›è¡Œæœç´¢ 12db.products.createIndex(&#123; &quot;tags&quot;: 1 &#125;, &#123; &quot;sparse&quot;: true &#125;); // å¦‚æœä¸æ˜¯æ¯ä¸ªæ–‡æ¡£éƒ½æœ‰tagsï¼Œå¯ä»¥ä½¿ç”¨sparseé€‰é¡¹ä»¥èŠ‚çœç©ºé—´db.products.find(&#123; &quot;tags&quot;: &quot;smartphone&quot; &#125;); // æ‰¾åˆ°æ‰€æœ‰å¸¦æœ‰â€œsmartphoneâ€æ ‡ç­¾çš„å•†å“ å”¯ä¸€ç´¢å¼• - ç¡®ä¿å“ç‰Œåç§°ä¸é‡å¤ 1234db.products.createIndex(&#123; brand: 1 &#125;, &#123; unique: true &#125;);// å°è¯•æ’å…¥é‡å¤è®°å½•æ—¶db.products.insertOne(&#123; category: &quot;Electronics&quot;, brand: &quot;Apple&quot;, ... &#125;); // æ­£å¸¸æ’å…¥db.products.insertOne(&#123; category: &quot;Computers&quot;, brand: &quot;Apple&quot;, ... &#125;); // è‹¥æ•°æ®åº“ä¸­å·²æœ‰Appleå“ç‰Œï¼Œåˆ™ä¼šå› è¿åå”¯ä¸€æ€§è€ŒæŠ¥é”™","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç»å¦‚ä½•ä½¿ç”¨MongoDB7.0çš„ç´¢å¼• MongoDBç‰ˆæœ¬7.0.6 MongoDB Indexes","date_published":"2024-03-11T13:30:05.000Z","tags":["æŠ€æœ¯","linux","mongodb","mongodb"]},{"id":"https://blog.hanqunfeng.com/2024/03/07/mongodb7-springboot-aggregate/","url":"https://blog.hanqunfeng.com/2024/03/07/mongodb7-springboot-aggregate/","title":"MongoDB7.0--SpringBootèšåˆæ“ä½œ","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç»å¦‚ä½•ä½¿ç”¨SpringBootå®ç°MongoDB7.0çš„èšåˆæ“ä½œ</p>\n</li>\n<li class=\"lvl-2\">\n<p>SpringBootç‰ˆæœ¬3.2.3ï¼ŒMongoDBç‰ˆæœ¬7.0.6</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://www.mongodb.com/docs/v7.0/aggregation/\">MongoDB Aggregation Operations</a></p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://www.mongodb.com/docs/v7.0/reference/sql-aggregation-comparison/\">SQL to Aggregation Mapping Chart</a></p>\n</li>\n<li class=\"lvl-2\">\n<a href=\"/2024/03/05/mongodb7-springboot/\" title=\"MongoDB7.0--SpringBootå•é›†åˆæ“ä½œ\">MongoDB7.0--SpringBootå•é›†åˆæ“ä½œ</a>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"èšåˆæ“ä½œç®€ä»‹\">èšåˆæ“ä½œç®€ä»‹</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>èšåˆæ“ä½œå…è®¸ç”¨æˆ·å¤„ç†å¤šä¸ªæ–‡æ¡£å¹¶è¿”å›è®¡ç®—ç»“æœ</p>\n</li>\n<li class=\"lvl-2\">\n<p>èšåˆæ“ä½œåŒ…å«ä¸‰ç±»</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-6\">å•æ–‡æ¡£èšåˆï¼šé’ˆå¯¹å•ä¸ªé›†åˆï¼Œå¦‚ï¼š<code>db.collection.countDocument()</code>, <code>db.collection.distinct()</code></li>\n<li class=\"lvl-6\">èšåˆç®¡é“ï¼šå®ƒå¯ä»¥ä½œç”¨åœ¨ä¸€ä¸ªæˆ–å‡ ä¸ªé›†åˆä¸Šï¼Œå¯¹é›†åˆä¸­çš„æ•°æ®è¿›è¡Œçš„ä¸€ç³»åˆ—è¿ç®—ï¼Œå¹¶å°†è¿™äº›æ•°æ®è½¬åŒ–ä¸ºç”¨æˆ·æœŸæœ›çš„å½¢å¼ï¼Œæœ¬æ–‡ä¸»è¦ä»‹ç»ç®¡é“æ“ä½œ</li>\n<li class=\"lvl-6\">MapReduceï¼šä»MongoDB 5.0å¼€å§‹ï¼Œmap-reduceæ“ä½œå·²è¢«å¼ƒç”¨ï¼Œæœ¬æ–‡ä¸åšä»‹ç»ã€‚</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"èšåˆç®¡é“\">èšåˆç®¡é“</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>èšåˆç®¡é“æ˜¯MongoDBä¸­éå¸¸å¼ºå¤§çš„åŠŸèƒ½ï¼Œå®ƒå…è®¸ç”¨æˆ·å°†å¤šä¸ªæ“ä½œç»„åˆåœ¨ä¸€èµ·ï¼Œä»¥å®ç°å¤æ‚çš„æ•°æ®å¤„ç†ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä»æ•ˆæœè€Œè¨€ï¼Œèšåˆç®¡é“ç›¸å½“äº SQL æŸ¥è¯¢ä¸­çš„ GROUP BYã€ LEFT OUTER JOIN ã€ ASç­‰ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>æ•´ä¸ªèšåˆè¿ç®—è¿‡ç¨‹ç§°ä¸ºç®¡é“ï¼ˆPipelineï¼‰ï¼Œå®ƒæ˜¯ç”±å¤šä¸ªé˜¶æ®µï¼ˆStageï¼‰ç»„æˆçš„ï¼Œ æ¯ä¸ªç®¡é“ï¼š</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-6\">æ¥å—ä¸€ç³»åˆ—æ–‡æ¡£ï¼ˆåŸå§‹æ•°æ®ï¼‰</li>\n<li class=\"lvl-6\">æ¯ä¸ªé˜¶æ®µå¯¹è¿™äº›æ–‡æ¡£è¿›è¡Œä¸€ç³»åˆ—è¿ç®—</li>\n<li class=\"lvl-6\">ç»“æœæ–‡æ¡£è¾“å‡ºç»™ä¸‹ä¸€ä¸ªé˜¶æ®µ</li>\n</ul>\n</li>\n</ul>\n<p><img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/cHlDgv.png\" alt=\"\"></p>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>èšåˆç®¡é“æ“ä½œè¯­æ³•</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-6\">pipelines ä¸€ç»„æ•°æ®èšåˆé˜¶æ®µã€‚é™¤<span class='katex-error' title='ParseError: KaTeX parse error: LaTeX-incompatible input and strict mode is set to &#039;error&#039;: Unicode text character &quot;ã€&quot; used in math mode [unicodeTextInMathMode] at position 4: outã€Ì²'>outã€</span>Mergeå’Œ$geonearé˜¶æ®µä¹‹å¤–ï¼Œæ¯ä¸ªé˜¶æ®µéƒ½å¯ä»¥åœ¨ç®¡é“ä¸­å‡ºç°å¤šæ¬¡ã€‚</li>\n<li class=\"lvl-6\">options å¯é€‰ï¼Œèšåˆæ“ä½œçš„å…¶ä»–å‚æ•°ã€‚åŒ…å«ï¼šæŸ¥è¯¢è®¡åˆ’ã€æ˜¯å¦ä½¿ç”¨ä¸´æ—¶æ–‡ä»¶ã€ æ¸¸æ ‡ã€æœ€å¤§æ“ä½œæ—¶é—´ã€è¯»å†™ç­–ç•¥ã€å¼ºåˆ¶ç´¢å¼•ç­‰ç­‰</li>\n</ul>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pipeline = [<span class=\"variable\">$stage1</span>, <span class=\"variable\">$stage2</span>, ...<span class=\"variable\">$stageN</span>];</span><br><span class=\"line\">db.collection.aggregate(pipeline, &#123;options&#125;)</span><br></pre></td></tr></table></figure>\n<p><img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/reMhNx.png\" alt=\"èšåˆç®¡é“\"></p>\n</li>\n<li class=\"lvl-2\">\n<p>å¸¸ç”¨çš„èšåˆé˜¶æ®µè¿ç®—ç¬¦</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>é˜¶æ®µè¿ç®—ç¬¦</th>\n<th>æè¿°</th>\n<th>SQLç­‰ä»·è¿ç®—ç¬¦</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>$match</td>\n<td>è¿‡æ»¤æ–‡æ¡£</td>\n<td>WHERE</td>\n</tr>\n<tr>\n<td>$project</td>\n<td>æŠ•å½±ï¼Œæ”¹å˜æ–‡æ¡£çš„å½¢çŠ¶å’Œå†…å®¹</td>\n<td>SELECT filedName AS newName</td>\n</tr>\n<tr>\n<td>$group</td>\n<td>å°†æ–‡æ¡£åˆ†ç»„</td>\n<td>GROUP BY</td>\n</tr>\n<tr>\n<td>$sort</td>\n<td>å¯¹æ–‡æ¡£è¿›è¡Œæ’åº</td>\n<td>ORDER BY</td>\n</tr>\n<tr>\n<td>$limit</td>\n<td>é™åˆ¶ç»“æœé›†çš„å¤§å°</td>\n<td>LIMIT</td>\n</tr>\n<tr>\n<td>$skip</td>\n<td>è·³è¿‡æŒ‡å®šæ•°é‡çš„æ–‡æ¡£</td>\n<td>OFFSET</td>\n</tr>\n<tr>\n<td>$unwind</td>\n<td>å±•å¼€æ•°ç»„</td>\n<td>-</td>\n</tr>\n<tr>\n<td>$lookup</td>\n<td>ä»å…¶ä»–é›†åˆä¸­è·å–ç›¸å…³æ–‡æ¡£,å·¦å¤–è¿æ¥</td>\n<td>LEFT OUTER JOIN</td>\n</tr>\n<tr>\n<td>$out</td>\n<td>å°†ç»“æœé›†è¾“å‡ºåˆ°æ–°çš„é›†åˆ</td>\n<td>-</td>\n</tr>\n<tr>\n<td>$geoNear</td>\n<td>æŒ‰ç…§åœ°ç†ä½ç½®é™„è¿‘çš„é¡ºåºè¿”å›æ–‡æ¡£</td>\n<td>-</td>\n</tr>\n<tr>\n<td>$graphLookup</td>\n<td>æ‰§è¡Œé€’å½’æŸ¥è¯¢</td>\n<td>-</td>\n</tr>\n<tr>\n<td>$addFields</td>\n<td>æ·»åŠ æ–°å­—æ®µ</td>\n<td>-</td>\n</tr>\n<tr>\n<td>$bucket</td>\n<td>æ ¹æ®æŒ‡å®šæ¡ä»¶å°†æ–‡æ¡£åˆ†ç»„æˆæ¡¶</td>\n<td>-</td>\n</tr>\n<tr>\n<td>$facet</td>\n<td>å…è®¸åœ¨å•ä¸ªèšåˆé˜¶æ®µå†…æ‰§è¡Œå¤šä¸ªç‹¬ç«‹çš„å­èšåˆ</td>\n<td>-</td>\n</tr>\n</tbody>\n</table>\n<p><img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/BqWIi9.png\" alt=\"\"></p>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>èšåˆè¡¨è¾¾å¼</p>\n</li>\n</ul>\n<blockquote>\n<p>è·å–å­—æ®µä¿¡æ¯</p>\n</blockquote>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$&lt;field&gt;  ï¼š ç”¨ $ æŒ‡ç¤ºå­—æ®µè·¯å¾„</span><br><span class=\"line\">$&lt;field&gt;.&lt;subfield&gt;  ï¼š ä½¿ç”¨ $  å’Œ .  æ¥æŒ‡ç¤ºå†…åµŒæ–‡æ¡£çš„è·¯å¾„</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>å¸¸é‡è¡¨è¾¾å¼</p>\n</blockquote>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable\">$literal</span> :&lt;value&gt; ï¼š æŒ‡ç¤ºå¸¸é‡ &lt;value&gt;</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>ç³»ç»Ÿå˜é‡è¡¨è¾¾å¼</p>\n</blockquote>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$$&lt;variable&gt;  ä½¿ç”¨ $$ æŒ‡ç¤ºç³»ç»Ÿå˜é‡</span><br><span class=\"line\">$<span class=\"variable\">$CURRENT</span>  æŒ‡ç¤ºç®¡é“ä¸­å½“å‰æ“ä½œçš„æ–‡æ¡£</span><br></pre></td></tr></table></figure>\n<h2 id=\"èšåˆç®¡é“ç¤ºä¾‹\">èšåˆç®¡é“ç¤ºä¾‹</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬ç¤ºä¾‹ä½¿ç”¨SpringBootå®ç°MongoDB7.0çš„èšåˆæ“ä½œ</p>\n</li>\n<li class=\"lvl-2\">\n<p>åˆå§‹åŒ–æ•°æ®</p>\n</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">var tags = [&quot;nosql&quot;,&quot;mongodb&quot;,&quot;document&quot;,&quot;developer&quot;,&quot;popular&quot;];</span></span><br><span class=\"line\"><span class=\"comment\">var types = [&quot;technology&quot;,&quot;sociality&quot;,&quot;travel&quot;,&quot;novel&quot;,&quot;literature&quot;];</span></span><br><span class=\"line\"><span class=\"comment\">var books=[];</span></span><br><span class=\"line\"><span class=\"comment\">for(var i=0;i&lt;50;i++)&#123;</span></span><br><span class=\"line\"><span class=\"comment\">    var typeIdx = Math.floor(Math.random()*types.length);</span></span><br><span class=\"line\"><span class=\"comment\">    var tagIdx = Math.floor(Math.random()*tags.length);</span></span><br><span class=\"line\"><span class=\"comment\">    var tagIdx2 = Math.floor(Math.random()*tags.length);</span></span><br><span class=\"line\"><span class=\"comment\">    var favCount = Math.floor(Math.random()*100);</span></span><br><span class=\"line\"><span class=\"comment\">    var username = &quot;xx00&quot;+Math.floor(Math.random()*10);</span></span><br><span class=\"line\"><span class=\"comment\">    var age = 20 + Math.floor(Math.random()*15);</span></span><br><span class=\"line\"><span class=\"comment\">    var book = &#123;</span></span><br><span class=\"line\"><span class=\"comment\">        title: &quot;book-&quot;+i,</span></span><br><span class=\"line\"><span class=\"comment\">        type: types[typeIdx],</span></span><br><span class=\"line\"><span class=\"comment\">        tag: [tags[tagIdx],tags[tagIdx2]],</span></span><br><span class=\"line\"><span class=\"comment\">        favCount: favCount,</span></span><br><span class=\"line\"><span class=\"comment\">        author: &#123;name:username,age:age&#125;</span></span><br><span class=\"line\"><span class=\"comment\">    &#125;;</span></span><br><span class=\"line\"><span class=\"comment\">    books.push(book)</span></span><br><span class=\"line\"><span class=\"comment\">&#125;</span></span><br><span class=\"line\"><span class=\"comment\">db.books.insertMany(books);</span></span><br><span class=\"line\"><span class=\"comment\">*/</span></span><br><span class=\"line\">String[] tags = &#123;<span class=\"string\">&quot;nosql&quot;</span>, <span class=\"string\">&quot;mongodb&quot;</span>, <span class=\"string\">&quot;document&quot;</span>, <span class=\"string\">&quot;developer&quot;</span>, <span class=\"string\">&quot;popular&quot;</span>&#125;;</span><br><span class=\"line\">String[] types = &#123;<span class=\"string\">&quot;technology&quot;</span>, <span class=\"string\">&quot;sociality&quot;</span>, <span class=\"string\">&quot;travel&quot;</span>, <span class=\"string\">&quot;novel&quot;</span>, <span class=\"string\">&quot;literature&quot;</span>&#125;;</span><br><span class=\"line\">List&lt;Document&gt; books = <span class=\"keyword\">new</span> <span class=\"title class_\">ArrayList</span>&lt;&gt;();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"type\">Random</span> <span class=\"variable\">random</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Random</span>();</span><br><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; i &lt; <span class=\"number\">50</span>; i++) &#123;</span><br><span class=\"line\">    <span class=\"type\">int</span> <span class=\"variable\">typeIdx</span> <span class=\"operator\">=</span> random.nextInt(types.length);</span><br><span class=\"line\">    <span class=\"type\">int</span> <span class=\"variable\">tagIdx</span> <span class=\"operator\">=</span> random.nextInt(tags.length);</span><br><span class=\"line\">    <span class=\"type\">int</span> <span class=\"variable\">tagIdx2</span> <span class=\"operator\">=</span> random.nextInt(tags.length);</span><br><span class=\"line\">    <span class=\"type\">int</span> <span class=\"variable\">favCount</span> <span class=\"operator\">=</span> random.nextInt(<span class=\"number\">100</span>);</span><br><span class=\"line\">    <span class=\"type\">String</span> <span class=\"variable\">username</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;xx00&quot;</span> + random.nextInt(<span class=\"number\">10</span>);</span><br><span class=\"line\">    <span class=\"type\">int</span> <span class=\"variable\">age</span> <span class=\"operator\">=</span> <span class=\"number\">20</span> + random.nextInt(<span class=\"number\">15</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"type\">Document</span> <span class=\"variable\">book</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Document</span>(<span class=\"string\">&quot;title&quot;</span>, <span class=\"string\">&quot;book-&quot;</span> + i)</span><br><span class=\"line\">            .append(<span class=\"string\">&quot;type&quot;</span>, types[typeIdx])</span><br><span class=\"line\">            .append(<span class=\"string\">&quot;tag&quot;</span>, List.of(tags[tagIdx], tags[tagIdx2]))</span><br><span class=\"line\">            .append(<span class=\"string\">&quot;favCount&quot;</span>, favCount)</span><br><span class=\"line\">            .append(<span class=\"string\">&quot;author&quot;</span>, <span class=\"keyword\">new</span> <span class=\"title class_\">Document</span>(<span class=\"string\">&quot;name&quot;</span>, username).append(<span class=\"string\">&quot;age&quot;</span>, age));</span><br><span class=\"line\">    books.add(book);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">mongoTemplate.insert(books, <span class=\"string\">&quot;books&quot;</span>);</span><br></pre></td></tr></table></figure>\n<h3 id=\"project-æŠ•å½±æ“ä½œ\">$project:æŠ•å½±æ“ä½œ</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å°†åŸå§‹å­—æ®µæŠ•å½±æˆæŒ‡å®šåç§°ï¼Œ å¦‚å°†é›†åˆä¸­çš„ title æŠ•å½±æˆ name</p>\n</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// db.books.aggregate([&#123;$project:&#123;name:&quot;$title&quot;&#125;&#125;])</span></span><br><span class=\"line\"><span class=\"type\">ProjectionOperation</span> <span class=\"variable\">projectOperation</span> <span class=\"operator\">=</span> Aggregation.project()</span><br><span class=\"line\">        .andExpression(<span class=\"string\">&quot;title&quot;</span>).as(<span class=\"string\">&quot;name&quot;</span>);</span><br><span class=\"line\"><span class=\"type\">Aggregation</span> <span class=\"variable\">aggregation</span> <span class=\"operator\">=</span> Aggregation.newAggregation(projectOperation);</span><br><span class=\"line\">System.out.println(aggregation);</span><br><span class=\"line\">List&lt;Document&gt; results = mongoTemplate.aggregate(aggregation, <span class=\"string\">&quot;books&quot;</span>, Document.class).getMappedResults();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">for</span> (Document document : result) &#123;</span><br><span class=\"line\">    System.out.println(document.toJson());</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å‰”é™¤ä¸éœ€è¦çš„å­—æ®µ</p>\n</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// db.books.aggregate([&#123;$project:&#123;name:&quot;$title&quot;,_id:0,type:1,author.name:1&#125;&#125;])</span></span><br><span class=\"line\"><span class=\"type\">ProjectionOperation</span> <span class=\"variable\">projectOperation</span> <span class=\"operator\">=</span> Aggregation.project()</span><br><span class=\"line\">        .andExclude(<span class=\"string\">&quot;_id&quot;</span>)</span><br><span class=\"line\">        .andInclude(<span class=\"string\">&quot;type&quot;</span>)</span><br><span class=\"line\">        .andExpression(<span class=\"string\">&quot;author.name&quot;</span>).as(<span class=\"string\">&quot;author.name&quot;</span>) <span class=\"comment\">// è¿™é‡Œå¿…é¡»ä½¿ç”¨asé‡æ–°å‘½åï¼Œå¦åˆ™åªä¼šç”¨nameåšå­—æ®µåç§°ï¼Œè¿™å°±å’Œåé¢çš„titleçš„åˆ«åå†²çªäº†</span></span><br><span class=\"line\">        .andExpression(<span class=\"string\">&quot;title&quot;</span>).as(<span class=\"string\">&quot;name&quot;</span>);</span><br><span class=\"line\"><span class=\"type\">Aggregation</span> <span class=\"variable\">aggregation</span> <span class=\"operator\">=</span> Aggregation.newAggregation(projectOperation);</span><br><span class=\"line\">System.out.println(aggregation);</span><br><span class=\"line\">List&lt;Document&gt; results = mongoTemplate.aggregate(aggregation, <span class=\"string\">&quot;books&quot;</span>, Document.class).getMappedResults();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">for</span> (Document document : results) &#123;</span><br><span class=\"line\">    System.out.println(document.toJson());</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"match-è¿‡æ»¤æ“ä½œ\">$match:è¿‡æ»¤æ“ä½œ</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¿‡æ»¤å‡ºæŒ‡å®šæ¡ä»¶çš„æ–‡æ¡£</p>\n</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// db.books.aggregate([&#123;$match:&#123;type:&quot;technology&quot;&#125;&#125;])</span></span><br><span class=\"line\"><span class=\"type\">MatchOperation</span> <span class=\"variable\">matchOperation</span> <span class=\"operator\">=</span> Aggregation.match(Criteria.where(<span class=\"string\">&quot;type&quot;</span>).is(<span class=\"string\">&quot;technology&quot;</span>));</span><br><span class=\"line\"><span class=\"type\">Aggregation</span> <span class=\"variable\">aggregation</span> <span class=\"operator\">=</span> Aggregation.newAggregation(matchOperation);</span><br><span class=\"line\">System.out.println(aggregation);</span><br><span class=\"line\">List&lt;Document&gt; results = mongoTemplate.aggregate(aggregation, <span class=\"string\">&quot;books&quot;</span>, Document.class).getMappedResults();</span><br><span class=\"line\"><span class=\"keyword\">for</span> (Document document : results) &#123;</span><br><span class=\"line\">    System.out.println(document.toJson());</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç»„åˆå…¶å®ƒç®¡é“</p>\n</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">db.books.aggregate([</span></span><br><span class=\"line\"><span class=\"comment\">    &#123;$match:&#123;type:&quot;technology&quot;&#125;&#125;,</span></span><br><span class=\"line\"><span class=\"comment\">    &#123;$project:&#123;name:&quot;$title&quot;,_id:0,type:1,author:&#123;name:1&#125;&#125;&#125;</span></span><br><span class=\"line\"><span class=\"comment\">])</span></span><br><span class=\"line\"><span class=\"comment\">*/</span></span><br><span class=\"line\"><span class=\"type\">MatchOperation</span> <span class=\"variable\">matchOperation</span> <span class=\"operator\">=</span> Aggregation.match(Criteria.where(<span class=\"string\">&quot;type&quot;</span>).is(<span class=\"string\">&quot;technology&quot;</span>));</span><br><span class=\"line\"><span class=\"type\">ProjectionOperation</span> <span class=\"variable\">projectOperation</span> <span class=\"operator\">=</span> Aggregation.project(<span class=\"string\">&quot;title&quot;</span>).andExclude(<span class=\"string\">&quot;_id&quot;</span>).andInclude(<span class=\"string\">&quot;type&quot;</span>).and(<span class=\"string\">&quot;author.name&quot;</span>).as(<span class=\"string\">&quot;author.name&quot;</span>);</span><br><span class=\"line\"><span class=\"type\">Aggregation</span> <span class=\"variable\">aggregation</span> <span class=\"operator\">=</span> Aggregation.newAggregation(matchOperation, projectOperation);</span><br><span class=\"line\">List&lt;Document&gt; results = mongoTemplate.aggregate(aggregation, <span class=\"string\">&quot;books&quot;</span>, Document.class).getMappedResults();</span><br></pre></td></tr></table></figure>\n<h3 id=\"count-è®¡æ•°æ“ä½œ\">$count:è®¡æ•°æ“ä½œ</h3>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">db.books.aggregate([</span></span><br><span class=\"line\"><span class=\"comment\">    &#123;$match:&#123;type:&quot;technology&quot;&#125;&#125;,</span></span><br><span class=\"line\"><span class=\"comment\">    &#123;$count: &quot;type_count&quot;&#125;</span></span><br><span class=\"line\"><span class=\"comment\">])</span></span><br><span class=\"line\"><span class=\"comment\">*/</span></span><br><span class=\"line\"><span class=\"comment\">// MatchOperation to filter documents by type: &quot;technology&quot;</span></span><br><span class=\"line\"><span class=\"type\">MatchOperation</span> <span class=\"variable\">matchAggregation</span> <span class=\"operator\">=</span> Aggregation.match(Criteria.where(<span class=\"string\">&quot;type&quot;</span>).is(<span class=\"string\">&quot;technology&quot;</span>));</span><br><span class=\"line\"><span class=\"comment\">// CountOperation to count the matched documents</span></span><br><span class=\"line\"><span class=\"type\">CountOperation</span> <span class=\"variable\">countAggregation</span> <span class=\"operator\">=</span> Aggregation.count().as(<span class=\"string\">&quot;type_count&quot;</span>);</span><br><span class=\"line\"><span class=\"comment\">// Combine the match and count operations</span></span><br><span class=\"line\"><span class=\"type\">Aggregation</span> <span class=\"variable\">aggregation</span> <span class=\"operator\">=</span> Aggregation.newAggregation(matchAggregation, countAggregation);</span><br><span class=\"line\">System.out.println(aggregation);</span><br><span class=\"line\">List&lt;Document&gt; results = mongoTemplate.aggregate(aggregation, <span class=\"string\">&quot;books&quot;</span>, Document.class).getMappedResults();</span><br></pre></td></tr></table></figure>\n<h3 id=\"group-åˆ†ç»„æ“ä½œ\">$group:åˆ†ç»„æ“ä½œ</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æŒ‰æŒ‡å®šçš„è¡¨è¾¾å¼å¯¹æ–‡æ¡£è¿›è¡Œåˆ†ç»„ï¼Œå¹¶å°†æ¯ä¸ªä¸åŒåˆ†ç»„çš„æ–‡æ¡£è¾“å‡ºåˆ°ä¸‹ä¸€ä¸ªé˜¶æ®µã€‚è¾“å‡ºæ–‡æ¡£åŒ…å«ä¸€ä¸ª_idå­—æ®µï¼Œè¯¥å­—æ®µæŒ‰é”®åŒ…å«ä¸åŒçš„ç»„ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>è¾“å‡ºæ–‡æ¡£è¿˜å¯ä»¥åŒ…å«è®¡ç®—å­—æ®µï¼Œè¯¥å­—æ®µä¿å­˜ç”±$groupçš„_idå­—æ®µåˆ†ç»„çš„ä¸€äº›accumulatorè¡¨è¾¾å¼çš„å€¼ã€‚ $groupä¸ä¼šè¾“å‡ºå…·ä½“çš„æ–‡æ¡£è€Œåªæ˜¯ç»Ÿè®¡ä¿¡æ¯ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>è¯­æ³•</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123; <span class=\"variable\">$group</span>: &#123; _id: &lt;expression&gt;, &lt;field1&gt;: &#123; &lt;accumulator1&gt; : &lt;expression1&gt; &#125;, ... &#125; &#125;</span><br><span class=\"line\"><span class=\"comment\"># _idå­—æ®µæ˜¯å¿…å¡«çš„;ä½†æ˜¯ï¼Œå¯ä»¥æŒ‡å®š_idå€¼ä¸ºnullæ¥ä¸ºæ•´ä¸ªè¾“å…¥æ–‡æ¡£è®¡ç®—ç´¯è®¡å€¼ã€‚</span></span><br><span class=\"line\"><span class=\"comment\"># å‰©ä½™çš„è®¡ç®—å­—æ®µæ˜¯å¯é€‰çš„ï¼Œå¹¶ä½¿ç”¨&lt;accumulator&gt;è¿ç®—ç¬¦è¿›è¡Œè®¡ç®—ã€‚</span></span><br><span class=\"line\"><span class=\"comment\"># _idå’Œ&lt;accumulator&gt;è¡¨è¾¾å¼å¯ä»¥æ¥å—ä»»ä½•æœ‰æ•ˆçš„è¡¨è¾¾å¼ã€‚</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>accumulatoræ“ä½œç¬¦</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>åç§°</th>\n<th>æè¿°</th>\n<th>ç±»æ¯”sql</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>avg</code></td>\n<td>è®¡ç®—å‡å€¼</td>\n<td>avg</td>\n</tr>\n<tr>\n<td><code>first</code></td>\n<td>è¿”å›æ¯ç»„ç¬¬ä¸€ä¸ªæ–‡æ¡£ï¼Œå¦‚æœæœ‰æ’åºï¼ŒæŒ‰ç…§æ’åºï¼Œå¦‚æœæ²¡æœ‰æŒ‰ç…§é»˜è®¤çš„å­˜å‚¨çš„é¡ºåºçš„ç¬¬ä¸€ä¸ªæ–‡æ¡£ã€‚</td>\n<td>limit 0,1</td>\n</tr>\n<tr>\n<td><code>last</code></td>\n<td>è¿”å›æ¯ç»„æœ€åä¸€ä¸ªæ–‡æ¡£ï¼Œå¦‚æœæœ‰æ’åºï¼ŒæŒ‰ç…§æ’åºï¼Œå¦‚æœæ²¡æœ‰æŒ‰ç…§é»˜è®¤çš„å­˜å‚¨çš„é¡ºåºçš„æœ€åä¸ªæ–‡æ¡£ã€‚</td>\n<td>-</td>\n</tr>\n<tr>\n<td><code>max</code></td>\n<td>æ ¹æ®åˆ†ç»„ï¼Œè·å–é›†åˆä¸­æ‰€æœ‰æ–‡æ¡£å¯¹åº”å€¼å¾—æœ€å¤§å€¼ã€‚</td>\n<td>max</td>\n</tr>\n<tr>\n<td><code>min</code></td>\n<td>æ ¹æ®åˆ†ç»„ï¼Œè·å–é›†åˆä¸­æ‰€æœ‰æ–‡æ¡£å¯¹åº”å€¼å¾—æœ€å°å€¼ã€‚</td>\n<td>min</td>\n</tr>\n<tr>\n<td><code>push</code></td>\n<td>å°†æŒ‡å®šçš„è¡¨è¾¾å¼çš„å€¼æ·»åŠ åˆ°ä¸€ä¸ªæ•°ç»„ä¸­ã€‚</td>\n<td>-</td>\n</tr>\n<tr>\n<td><code>addToSet</code></td>\n<td>å°†è¡¨è¾¾å¼çš„å€¼æ·»åŠ åˆ°ä¸€ä¸ªé›†åˆä¸­ï¼ˆæ— é‡å¤å€¼ï¼Œæ— åºï¼‰ã€‚</td>\n<td>-</td>\n</tr>\n<tr>\n<td><code>sum</code></td>\n<td>è®¡ç®—æ€»å’Œ</td>\n<td>sum</td>\n</tr>\n<tr>\n<td><code>stdDevPop</code></td>\n<td>è¿”å›è¾“å…¥å€¼çš„æ€»ä½“æ ‡å‡†åå·®ï¼ˆpopulation standard deviationï¼‰</td>\n<td>-</td>\n</tr>\n<tr>\n<td><code>stdDevSamp</code></td>\n<td>è¿”å›è¾“å…¥å€¼çš„æ ·æœ¬æ ‡å‡†åå·®ï¼ˆthe sample standard deviationï¼‰</td>\n<td>-</td>\n</tr>\n</tbody>\n</table>\n<p><img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/EVvswC.png\" alt=\"\"></p>\n<h4 id=\"ç¤ºä¾‹\">ç¤ºä¾‹</h4>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>bookçš„æ•°é‡ï¼Œæ”¶è—æ€»æ•°å’Œå¹³å‡å€¼</p>\n</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">db.books.aggregate([</span></span><br><span class=\"line\"><span class=\"comment\">    &#123;$group:&#123;_id:null,count:&#123;$sum:1&#125;,pop:&#123;$sum:&quot;$favCount&quot;&#125;,avg:&#123;$avg:&quot;$favCount&quot;&#125;&#125;&#125;</span></span><br><span class=\"line\"><span class=\"comment\">])</span></span><br><span class=\"line\"><span class=\"comment\">*/</span></span><br><span class=\"line\"><span class=\"type\">Aggregation</span> <span class=\"variable\">aggregation</span> <span class=\"operator\">=</span> Aggregation.newAggregation(</span><br><span class=\"line\">        Aggregation.group().count().as(<span class=\"string\">&quot;count&quot;</span>).sum(<span class=\"string\">&quot;favCount&quot;</span>).as(<span class=\"string\">&quot;pop&quot;</span>).avg(<span class=\"string\">&quot;favCount&quot;</span>).as(<span class=\"string\">&quot;avg&quot;</span>)</span><br><span class=\"line\">);</span><br><span class=\"line\"></span><br><span class=\"line\">AggregationResults&lt;Document&gt; results = mongoTemplate.aggregate(aggregation, <span class=\"string\">&quot;books&quot;</span>, Document.class);</span><br><span class=\"line\">List&lt;Document&gt; mappedResults = results.getMappedResults();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Assuming that there will be only one result due to grouping by null (_id: null)</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> (!mappedResults.isEmpty()) &#123;</span><br><span class=\"line\">    System.out.println(mappedResults.get(<span class=\"number\">0</span>).toJson());</span><br><span class=\"line\">&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    System.out.println(<span class=\"string\">&quot;&#123;&#125;&quot;</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç»Ÿè®¡æ¯ä¸ªä½œè€…çš„bookæ”¶è—æ€»æ•°</p>\n</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">db.books.aggregate([</span></span><br><span class=\"line\"><span class=\"comment\">    &#123;$group:&#123;_id:&quot;$author.name&quot;,pop:&#123;$sum:&quot;$favCount&quot;&#125;&#125;&#125;</span></span><br><span class=\"line\"><span class=\"comment\">])</span></span><br><span class=\"line\"><span class=\"comment\">*/</span></span><br><span class=\"line\"><span class=\"type\">Aggregation</span> <span class=\"variable\">aggregation</span> <span class=\"operator\">=</span> Aggregation.newAggregation(</span><br><span class=\"line\">        Aggregation.group(<span class=\"string\">&quot;author.name&quot;</span>).sum(<span class=\"string\">&quot;favCount&quot;</span>).as(<span class=\"string\">&quot;pop&quot;</span>)</span><br><span class=\"line\">);</span><br><span class=\"line\"></span><br><span class=\"line\">AggregationResults&lt;Document&gt; results = mongoTemplate.aggregate(aggregation, <span class=\"string\">&quot;books&quot;</span>, Document.class);</span><br><span class=\"line\">List&lt;Document&gt; mappedResults = results.getMappedResults();</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç»Ÿè®¡æ¯ä¸ªä½œè€…çš„æ¯æœ¬bookçš„æ”¶è—æ•°</p>\n</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">db.books.aggregate([</span></span><br><span class=\"line\"><span class=\"comment\">    &#123;$group:&#123;_id:&#123;name:&quot;$author.name&quot;,title:&quot;$title&quot;&#125;,pop:&#123;$sum:&quot;$favCount&quot;&#125;&#125;&#125;</span></span><br><span class=\"line\"><span class=\"comment\">])</span></span><br><span class=\"line\"><span class=\"comment\">*/</span></span><br><span class=\"line\"><span class=\"type\">Aggregation</span> <span class=\"variable\">aggregation</span> <span class=\"operator\">=</span> Aggregation.newAggregation(</span><br><span class=\"line\">        Aggregation.group(<span class=\"string\">&quot;author.name&quot;</span>, <span class=\"string\">&quot;title&quot;</span>).sum(<span class=\"string\">&quot;favCount&quot;</span>).as(<span class=\"string\">&quot;pop&quot;</span>)</span><br><span class=\"line\">);</span><br><span class=\"line\"></span><br><span class=\"line\">AggregationResults&lt;Document&gt; results = mongoTemplate.aggregate(aggregation, <span class=\"string\">&quot;books&quot;</span>, Document.class);</span><br><span class=\"line\">List&lt;Document&gt; mappedResults = results.getMappedResults();</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ¯ä¸ªä½œè€…çš„bookçš„typeåˆé›†</p>\n</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">db.books.aggregate([</span></span><br><span class=\"line\"><span class=\"comment\">    &#123;$group:&#123;_id:&quot;$author.name&quot;,types:&#123;$addToSet:&quot;$type&quot;&#125;&#125;&#125;</span></span><br><span class=\"line\"><span class=\"comment\">])</span></span><br><span class=\"line\"><span class=\"comment\">*/</span></span><br><span class=\"line\"><span class=\"type\">GroupOperation</span> <span class=\"variable\">groupOperation</span> <span class=\"operator\">=</span> Aggregation.group(<span class=\"string\">&quot;author.name&quot;</span>).addToSet(<span class=\"string\">&quot;type&quot;</span>).as(<span class=\"string\">&quot;types&quot;</span>);</span><br><span class=\"line\"><span class=\"type\">Aggregation</span> <span class=\"variable\">aggregation</span> <span class=\"operator\">=</span> Aggregation.newAggregation(groupOperation);</span><br><span class=\"line\">AggregationResults&lt;Document&gt; results = mongoTemplate.aggregate(aggregation, <span class=\"string\">&quot;books&quot;</span>, Document.class);</span><br><span class=\"line\">List&lt;Document&gt; mappedResults = results.getMappedResults();</span><br></pre></td></tr></table></figure>\n<h3 id=\"unwind\">$unwind</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¯ä»¥å°†æ•°ç»„æ‹†åˆ†ä¸ºå•ç‹¬çš„æ–‡æ¡£</p>\n</li>\n<li class=\"lvl-2\">\n<p>è¯­æ³•</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"variable\">$unwind</span>:</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      <span class=\"comment\">#è¦æŒ‡å®šå­—æ®µè·¯å¾„ï¼Œåœ¨å­—æ®µåç§°å‰åŠ ä¸Š$ç¬¦å¹¶ç”¨å¼•å·æ‹¬èµ·æ¥ã€‚</span></span><br><span class=\"line\">      path: &lt;field path&gt;,</span><br><span class=\"line\">      <span class=\"comment\">#å¯é€‰,ä¸€ä¸ªæ–°å­—æ®µçš„åç§°ç”¨äºå­˜æ”¾å…ƒç´ çš„æ•°ç»„ç´¢å¼•ã€‚è¯¥åç§°ä¸èƒ½ä»¥$å¼€å¤´ã€‚</span></span><br><span class=\"line\">      includeArrayIndex: &lt;string&gt;,</span><br><span class=\"line\">      <span class=\"comment\">#å¯é€‰ï¼Œdefault :falseï¼Œè‹¥ä¸ºtrue,å¦‚æœè·¯å¾„ä¸ºç©ºï¼Œç¼ºå°‘æˆ–ä¸ºç©ºæ•°ç»„ï¼Œåˆ™$unwindè¾“å‡ºæ–‡æ¡£</span></span><br><span class=\"line\">      preserveNullAndEmptyArrays: &lt;boolean&gt;</span><br><span class=\"line\"> &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"ç¤ºä¾‹-2\">ç¤ºä¾‹</h4>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å§“åä¸ºxx006çš„ä½œè€…çš„bookçš„tagæ•°ç»„æ‹†åˆ†ä¸ºå¤šä¸ªæ–‡æ¡£</p>\n</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">db.books.aggregate([</span></span><br><span class=\"line\"><span class=\"comment\">    &#123;$match:&#123;&quot;author.name&quot;:&quot;xx006&quot;&#125;&#125;,</span></span><br><span class=\"line\"><span class=\"comment\">    &#123;$unwind:&quot;$tag&quot;&#125;</span></span><br><span class=\"line\"><span class=\"comment\">])</span></span><br><span class=\"line\"><span class=\"comment\">*/</span></span><br><span class=\"line\"><span class=\"type\">Aggregation</span> <span class=\"variable\">aggregation</span> <span class=\"operator\">=</span> Aggregation.newAggregation(</span><br><span class=\"line\">        Aggregation.match(Criteria.where(<span class=\"string\">&quot;author.name&quot;</span>).is(<span class=\"string\">&quot;xx006&quot;</span>)),</span><br><span class=\"line\">        Aggregation.unwind(<span class=\"string\">&quot;tag&quot;</span>)</span><br><span class=\"line\">);</span><br><span class=\"line\">List&lt;Document&gt; results = mongoTemplate.aggregate(aggregation, <span class=\"string\">&quot;books&quot;</span>, Document.class).getMappedResults();</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä½¿ç”¨<code>includeArrayIndex</code>é€‰é¡¹æ¥è¾“å‡ºæ•°ç»„å…ƒç´ çš„æ•°ç»„ç´¢å¼•</p>\n</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">db.books.aggregate([</span></span><br><span class=\"line\"><span class=\"comment\">    &#123;$match:&#123;&quot;author.name&quot;:&quot;xx006&quot;&#125;&#125;,</span></span><br><span class=\"line\"><span class=\"comment\">    &#123;$unwind:&#123;path:&quot;$tag&quot;, includeArrayIndex: &quot;arrayIndex&quot;&#125;&#125;</span></span><br><span class=\"line\"><span class=\"comment\">])</span></span><br><span class=\"line\"><span class=\"comment\">*/</span></span><br><span class=\"line\"><span class=\"type\">Aggregation</span> <span class=\"variable\">aggregation</span> <span class=\"operator\">=</span> Aggregation.newAggregation(</span><br><span class=\"line\">        Aggregation.match(Criteria.where(<span class=\"string\">&quot;author.name&quot;</span>).is(<span class=\"string\">&quot;xx006&quot;</span>)),</span><br><span class=\"line\">        Aggregation.unwind(<span class=\"string\">&quot;tag&quot;</span>, <span class=\"string\">&quot;arrayIndex&quot;</span>)</span><br><span class=\"line\">);</span><br><span class=\"line\">List&lt;Document&gt; results = mongoTemplate.aggregate(aggregation, <span class=\"string\">&quot;books&quot;</span>, Document.class).getMappedResults();</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ¯ä¸ªä½œè€…çš„bookçš„tagåˆé›†</p>\n</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">db.books.aggregate([</span></span><br><span class=\"line\"><span class=\"comment\">    &#123;$unwind:&quot;$tag&quot;&#125;,</span></span><br><span class=\"line\"><span class=\"comment\">    &#123;$group:&#123;_id:&quot;$author.name&quot;,types:&#123;$addToSet:&quot;$tag&quot;&#125;&#125;&#125;</span></span><br><span class=\"line\"><span class=\"comment\">])</span></span><br><span class=\"line\"><span class=\"comment\">*/</span></span><br><span class=\"line\"><span class=\"type\">UnwindOperation</span> <span class=\"variable\">unwindOperation</span> <span class=\"operator\">=</span> Aggregation.unwind(<span class=\"string\">&quot;tag&quot;</span>);</span><br><span class=\"line\"><span class=\"type\">GroupOperation</span> <span class=\"variable\">groupOperation</span> <span class=\"operator\">=</span> Aggregation.group(<span class=\"string\">&quot;author.name&quot;</span>).addToSet(<span class=\"string\">&quot;tag&quot;</span>).as(<span class=\"string\">&quot;types&quot;</span>);</span><br><span class=\"line\"><span class=\"type\">Aggregation</span> <span class=\"variable\">aggregation</span> <span class=\"operator\">=</span> Aggregation.newAggregation(unwindOperation, groupOperation);</span><br><span class=\"line\">AggregationResults&lt;Document&gt; results = mongoTemplate.aggregate(aggregation, <span class=\"string\">&quot;books&quot;</span>, Document.class);</span><br><span class=\"line\">List&lt;Document&gt; mappedResults = results.getMappedResults();</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä½¿ç”¨<code>preserveNullAndEmptyArrays</code>é€‰é¡¹åœ¨è¾“å‡ºä¸­åŒ…å«ç¼ºå°‘tagå­—æ®µï¼Œnullæˆ–ç©ºæ•°ç»„çš„æ–‡æ¡£</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åˆå§‹åŒ–æ•°æ®ï¼ŒåŠ å…¥ä¸€äº›tagä¸ºç©ºæ•°ç»„æˆ–ä¸å­˜åœ¨tagçš„æ–‡æ¡£</span></span><br><span class=\"line\">db.books.insertMany([</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"string\">&quot;title&quot;</span> : <span class=\"string\">&quot;book-51&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;type&quot;</span> : <span class=\"string\">&quot;technology&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;favCount&quot;</span> : 11,</span><br><span class=\"line\">        <span class=\"string\">&quot;tag&quot;</span>:[],</span><br><span class=\"line\">        <span class=\"string\">&quot;author&quot;</span> : &#123;</span><br><span class=\"line\">            <span class=\"string\">&quot;name&quot;</span> : <span class=\"string\">&quot;xx006&quot;</span>,</span><br><span class=\"line\">            <span class=\"string\">&quot;age&quot;</span> : 28</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"string\">&quot;title&quot;</span> : <span class=\"string\">&quot;book-52&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;type&quot;</span> : <span class=\"string\">&quot;technology&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;favCount&quot;</span> : 15,</span><br><span class=\"line\">        <span class=\"string\">&quot;author&quot;</span> : &#123;</span><br><span class=\"line\">            <span class=\"string\">&quot;name&quot;</span> : <span class=\"string\">&quot;xx006&quot;</span>,</span><br><span class=\"line\">            <span class=\"string\">&quot;age&quot;</span> : 28</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">])</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">db.books.aggregate([</span></span><br><span class=\"line\"><span class=\"comment\">    &#123;$match:&#123;&quot;author.name&quot;:&quot;xx006&quot;&#125;&#125;,</span></span><br><span class=\"line\"><span class=\"comment\">    &#123;$unwind:&#123;path:&quot;$tag&quot;, preserveNullAndEmptyArrays: true&#125;&#125;</span></span><br><span class=\"line\"><span class=\"comment\">])</span></span><br><span class=\"line\"><span class=\"comment\">*/</span></span><br><span class=\"line\"><span class=\"type\">Aggregation</span> <span class=\"variable\">aggregation</span> <span class=\"operator\">=</span> Aggregation.newAggregation(</span><br><span class=\"line\">        Aggregation.match(Criteria.where(<span class=\"string\">&quot;author.name&quot;</span>).is(<span class=\"string\">&quot;xx006&quot;</span>)),</span><br><span class=\"line\">        Aggregation.unwind(<span class=\"string\">&quot;tag&quot;</span>, <span class=\"literal\">true</span>)</span><br><span class=\"line\">);</span><br><span class=\"line\">List&lt;Document&gt; results = mongoTemplate.aggregate(aggregation, <span class=\"string\">&quot;books&quot;</span>, Document.class).getMappedResults();</span><br></pre></td></tr></table></figure>\n<h3 id=\"limit-skip-sort\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>l</mi><mi>i</mi><mi>m</mi><mi>i</mi><mi>t</mi><mi mathvariant=\"normal\">/</mi></mrow><annotation encoding=\"application/x-tex\">limit/</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord mathnormal\">i</span><span class=\"mord mathnormal\">m</span><span class=\"mord mathnormal\">i</span><span class=\"mord mathnormal\">t</span><span class=\"mord\">/</span></span></span></span>skip/$sort</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>$limit:é™åˆ¶ä¼ é€’åˆ°ç®¡é“ä¸­ä¸‹ä¸€é˜¶æ®µçš„æ–‡æ¡£æ•°</p>\n</li>\n<li class=\"lvl-2\">\n<p>$skip:è·³è¿‡ä¼ é€’åˆ°ç®¡é“ä¸­ä¸‹ä¸€é˜¶æ®µçš„æ–‡æ¡£æ•°</p>\n</li>\n<li class=\"lvl-2\">\n<p>$sort:å¯¹ä¼ é€’åˆ°ç®¡é“ä¸­ä¸‹ä¸€é˜¶æ®µçš„æ–‡æ¡£è¿›è¡Œæ’åº</p>\n</li>\n</ul>\n<h4 id=\"ç¤ºä¾‹-3\">ç¤ºä¾‹</h4>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å§“åä¸ºxx006çš„ä½œè€…çš„bookçš„tagæ•°ç»„æ‹†åˆ†ä¸ºå¤šä¸ªæ–‡æ¡£ï¼ŒæŒ‰ç…§æ”¶è—æ•°é™åºæ’åºï¼Œè·³è¿‡2ä¸ªæ–‡æ¡£ï¼Œå–5ä¸ªæ–‡æ¡£</p>\n</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">db.books.aggregate([</span></span><br><span class=\"line\"><span class=\"comment\">    &#123;$match:&#123;&quot;author.name&quot;:&quot;xx006&quot;&#125;&#125;,</span></span><br><span class=\"line\"><span class=\"comment\">    &#123;$unwind:&#123;path:&quot;$tag&quot;, preserveNullAndEmptyArrays: true&#125;&#125;,</span></span><br><span class=\"line\"><span class=\"comment\">    &#123;$sort:&#123;&quot;favCount&quot;:-1&#125;&#125;,</span></span><br><span class=\"line\"><span class=\"comment\">    &#123;$limit : 5 &#125;,</span></span><br><span class=\"line\"><span class=\"comment\">    &#123;$skip : 2&#125;</span></span><br><span class=\"line\"><span class=\"comment\">])</span></span><br><span class=\"line\"><span class=\"comment\">*/</span></span><br><span class=\"line\"><span class=\"type\">Aggregation</span> <span class=\"variable\">aggregation</span> <span class=\"operator\">=</span> Aggregation.newAggregation(</span><br><span class=\"line\">        Aggregation.match(Criteria.where(<span class=\"string\">&quot;author.name&quot;</span>).is(<span class=\"string\">&quot;xx006&quot;</span>)),</span><br><span class=\"line\">        Aggregation.unwind(<span class=\"string\">&quot;tag&quot;</span>, <span class=\"literal\">true</span>),</span><br><span class=\"line\">        Aggregation.sort(Sort.by(Sort.Direction.DESC, <span class=\"string\">&quot;favCount&quot;</span>)),</span><br><span class=\"line\">        Aggregation.skip(<span class=\"number\">2</span>),</span><br><span class=\"line\">        Aggregation.limit(<span class=\"number\">5</span>)</span><br><span class=\"line\">);</span><br><span class=\"line\">List&lt;Document&gt; results = mongoTemplate.aggregate(aggregation, <span class=\"string\">&quot;books&quot;</span>, Document.class).getMappedResults();</span><br><span class=\"line\">``</span><br><span class=\"line\">* ç»Ÿè®¡æ¯ä¸ªåˆ†ç±»çš„bookæ–‡æ¡£æ•°é‡</span><br><span class=\"line\">```java</span><br><span class=\"line\"><span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">db.books.aggregate([</span></span><br><span class=\"line\"><span class=\"comment\">    &#123;$group:&#123;_id:&quot;$type&quot;,total:&#123;$sum:1&#125;&#125;&#125;,</span></span><br><span class=\"line\"><span class=\"comment\">    &#123;$sort:&#123;total:-1&#125;&#125;</span></span><br><span class=\"line\"><span class=\"comment\">])</span></span><br><span class=\"line\"><span class=\"comment\">*/</span></span><br><span class=\"line\"><span class=\"type\">Aggregation</span> <span class=\"variable\">aggregation</span> <span class=\"operator\">=</span> Aggregation.newAggregation(</span><br><span class=\"line\">        Aggregation.group(<span class=\"string\">&quot;type&quot;</span>).count().as(<span class=\"string\">&quot;total&quot;</span>),</span><br><span class=\"line\">        Aggregation.sort(Sort.by(Sort.Direction.DESC, <span class=\"string\">&quot;total&quot;</span>))</span><br><span class=\"line\">);</span><br><span class=\"line\">List&lt;Document&gt; results = mongoTemplate.aggregate(aggregation, <span class=\"string\">&quot;books&quot;</span>, Document.class).getMappedResults();</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ ‡ç­¾çš„çƒ­åº¦æ’è¡Œï¼Œæ ‡ç­¾çš„çƒ­åº¦åˆ™æŒ‰å…¶å…³è”bookæ–‡æ¡£çš„æ”¶è—æ•°ï¼ˆfavCountï¼‰æ¥è®¡ç®—</p>\n</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">db.books.aggregate([</span></span><br><span class=\"line\"><span class=\"comment\">    &#123;$match:&#123;favCount:&#123;$gt:0&#125;&#125;&#125;,</span></span><br><span class=\"line\"><span class=\"comment\">    &#123;$unwind:&quot;$tag&quot;&#125;,</span></span><br><span class=\"line\"><span class=\"comment\">    &#123;$group:&#123;_id:&quot;$tag&quot;,total:&#123;$sum:&quot;$favCount&quot;&#125;&#125;&#125;,</span></span><br><span class=\"line\"><span class=\"comment\">    &#123;$sort:&#123;total:-1&#125;&#125;</span></span><br><span class=\"line\"><span class=\"comment\">])</span></span><br><span class=\"line\"><span class=\"comment\">*/</span></span><br><span class=\"line\"><span class=\"type\">Aggregation</span> <span class=\"variable\">aggregation</span> <span class=\"operator\">=</span> Aggregation.newAggregation(</span><br><span class=\"line\">        Aggregation.match(Criteria.where(<span class=\"string\">&quot;favCount&quot;</span>).gt(<span class=\"number\">0</span>)),</span><br><span class=\"line\">        Aggregation.unwind(<span class=\"string\">&quot;tag&quot;</span>),</span><br><span class=\"line\">        Aggregation.group(<span class=\"string\">&quot;tag&quot;</span>).sum(<span class=\"string\">&quot;favCount&quot;</span>).as(<span class=\"string\">&quot;total&quot;</span>),</span><br><span class=\"line\">        Aggregation.sort(Sort.by(Sort.Direction.DESC, <span class=\"string\">&quot;total&quot;</span>))</span><br><span class=\"line\">);</span><br><span class=\"line\">List&lt;Document&gt; results = mongoTemplate.aggregate(aggregation, <span class=\"string\">&quot;books&quot;</span>, Document.class).getMappedResults();</span><br></pre></td></tr></table></figure>\n<h3 id=\"bucket\">$bucket</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>$bucket:æ ¹æ®æŒ‡å®šçš„æ¡ä»¶å’Œè¾¹ç•Œï¼Œå°†æ–‡æ¡£åˆ†ç»„åˆ°ä¸åŒçš„æ¡¶ä¸­</p>\n</li>\n</ul>\n<h4 id=\"ç¤ºä¾‹-4\">ç¤ºä¾‹</h4>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç»Ÿè®¡bookæ–‡æ¡£æ”¶è—æ•°[0,10),[10,60),[60,80),[80,100),[100,+âˆï¼‰</p>\n</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">db.books.aggregate([&#123;</span></span><br><span class=\"line\"><span class=\"comment\">    $bucket:&#123;</span></span><br><span class=\"line\"><span class=\"comment\">        groupBy:&quot;$favCount&quot;,</span></span><br><span class=\"line\"><span class=\"comment\">        boundaries:[0,10,60,80,100],</span></span><br><span class=\"line\"><span class=\"comment\">        default:&quot;other&quot;,</span></span><br><span class=\"line\"><span class=\"comment\">        output:&#123;&quot;count&quot;:&#123;$sum:1&#125;&#125;</span></span><br><span class=\"line\"><span class=\"comment\">    &#125;</span></span><br><span class=\"line\"><span class=\"comment\">&#125;])</span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\">[</span></span><br><span class=\"line\"><span class=\"comment\">  &#123; _id: 0, count: 3 &#125;,</span></span><br><span class=\"line\"><span class=\"comment\">  &#123; _id: 10, count: 27 &#125;,</span></span><br><span class=\"line\"><span class=\"comment\">  &#123; _id: 60, count: 11 &#125;,</span></span><br><span class=\"line\"><span class=\"comment\">  &#123; _id: 80, count: 11 &#125;</span></span><br><span class=\"line\"><span class=\"comment\">]</span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\">groupBy: æŒ‡å®šç”¨äºåˆ†ç»„çš„å­—æ®µã€‚åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œæ ¹æ® favCount å­—æ®µçš„å€¼è¿›è¡Œåˆ†ç»„ã€‚</span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\">boundaries: å®šä¹‰åˆ†æ¡¶çš„è¾¹ç•Œï¼Œå³æ¯ä¸ªæ¡¶çš„èŒƒå›´ã€‚æ–‡æ¡£çš„å€¼å°†æ ¹æ®è¿™äº›è¾¹ç•Œè¢«åˆ†é…åˆ°ä¸åŒçš„æ¡¶ä¸­ã€‚è¾¹ç•Œåº”æŒ‰å‡åºæ’åˆ—ã€‚åœ¨è¿™ä¸ªå‘½ä»¤ä¸­ï¼Œè¾¹ç•Œ [0, 10, 60, 80, 100] è¡¨ç¤ºå°†æ–‡æ¡£åˆ†æˆå…­ä¸ªæ¡¶ï¼šå°äºç­‰äº0ã€å¤§äº0å°äºç­‰äº10ã€å¤§äº10å°äºç­‰äº60ã€å¤§äº60å°äºç­‰äº80ã€å¤§äº80å°äºç­‰äº100ã€å¤§äº100ã€‚</span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\">default: è¿™æ˜¯ä¸€ä¸ªå¯é€‰å‚æ•°ï¼Œç”¨äºæŒ‡å®šé»˜è®¤æ¡¶çš„åç§°ã€‚å¦‚æœæ–‡æ¡£çš„å€¼ä¸åœ¨æŒ‡å®šçš„è¾¹ç•ŒèŒƒå›´å†…ï¼Œåˆ™ä¼šè¢«æ”¾å…¥è¯¥æ¡¶ä¸­ã€‚åœ¨è¿™ä¸ªå‘½ä»¤ä¸­ï¼Œå¦‚æœ favCount çš„å€¼ä¸åœ¨æŒ‡å®šçš„è¾¹ç•ŒèŒƒå›´å†…ï¼Œå°†ä¼šè¢«æ”¾å…¥åä¸º &quot;other&quot; çš„æ¡¶ä¸­ã€‚æ¯”å¦‚è¿™é‡Œè®¾ç½®è¾¹ç•Œ [10, 60, 80, 100]ï¼Œå³è¡¨ç¤ºä»10å¼€å§‹åˆ†ç»„ï¼Œåˆ™0~10çš„æ•°æ®ä¼šè¢«åˆ†ç»„åˆ°åä¸º &quot;other&quot; çš„æ¡¶ä¸­ã€‚</span></span><br><span class=\"line\"><span class=\"comment\">[</span></span><br><span class=\"line\"><span class=\"comment\">  &#123; _id: 10, count: 27 &#125;,</span></span><br><span class=\"line\"><span class=\"comment\">  &#123; _id: 60, count: 11 &#125;,</span></span><br><span class=\"line\"><span class=\"comment\">  &#123; _id: 80, count: 11 &#125;,</span></span><br><span class=\"line\"><span class=\"comment\">  &#123; _id: &#x27;other&#x27;, count: 3 &#125;</span></span><br><span class=\"line\"><span class=\"comment\">]</span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\">output: å®šä¹‰äº†æ¯ä¸ªæ¡¶çš„è¾“å‡ºå†…å®¹ã€‚è¿™æ˜¯ä¸€ä¸ªå­æ–‡æ¡£ï¼Œå®ƒæŒ‡å®šäº†åœ¨æ¯ä¸ªæ¡¶ä¸­è®¡ç®—çš„èšåˆæ“ä½œã€‚åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œä½¿ç”¨ $sum èšåˆæ“ä½œç¬¦æ¥è®¡ç®—æ¯ä¸ªæ¡¶ä¸­çš„æ–‡æ¡£æ•°é‡ï¼Œå¹¶å°†ç»“æœå­˜å‚¨åœ¨åä¸º &quot;count&quot; çš„å­—æ®µä¸­ã€‚</span></span><br><span class=\"line\"><span class=\"comment\">*/</span></span><br><span class=\"line\"><span class=\"type\">Aggregation</span> <span class=\"variable\">aggregation</span> <span class=\"operator\">=</span> Aggregation.newAggregation(</span><br><span class=\"line\">        Aggregation.bucket(<span class=\"string\">&quot;$favCount&quot;</span>)</span><br><span class=\"line\">                .withBoundaries(<span class=\"number\">0</span>,<span class=\"number\">10</span>,<span class=\"number\">60</span>,<span class=\"number\">80</span>,<span class=\"number\">100</span>)</span><br><span class=\"line\">                .withDefaultBucket(<span class=\"string\">&quot;other&quot;</span>)</span><br><span class=\"line\">                .andOutput(context -&gt; <span class=\"keyword\">new</span> <span class=\"title class_\">Document</span>(<span class=\"string\">&quot;$sum&quot;</span>, <span class=\"number\">1</span>))</span><br><span class=\"line\">                .as(<span class=\"string\">&quot;count&quot;</span>)</span><br><span class=\"line\">);</span><br><span class=\"line\">List&lt;Document&gt; results = mongoTemplate.aggregate(aggregation, <span class=\"string\">&quot;books&quot;</span>, Document.class).getMappedResults();</span><br></pre></td></tr></table></figure>\n<h3 id=\"lookup\">$lookup</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>$lookup:å°†æ–‡æ¡£ä¸­çš„ä¸€ä¸ªå­—æ®µçš„å€¼ä¸å¦ä¸€ä¸ªé›†åˆä¸­çš„æ–‡æ¡£è¿›è¡ŒåŒ¹é…ï¼Œç„¶åå°†åŒ¹é…çš„æ–‡æ¡£æ·»åŠ åˆ°å½“å‰æ–‡æ¡£ä¸­</p>\n</li>\n<li class=\"lvl-2\">\n<p>è¯­æ³•</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">db.collection.aggregate([&#123;</span><br><span class=\"line\">    <span class=\"variable\">$lookup</span>: &#123;</span><br><span class=\"line\">            from: <span class=\"string\">&quot;&lt;collection to join&gt;&quot;</span>,</span><br><span class=\"line\">            localField: <span class=\"string\">&quot;&lt;field from the input documents&gt;&quot;</span>,</span><br><span class=\"line\">            foreignField: <span class=\"string\">&quot;&lt;field from the documents of the from collection&gt;&quot;</span>,</span><br><span class=\"line\">            as: <span class=\"string\">&quot;&lt;output array field&gt;&quot;</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n<table>\n<thead>\n<tr>\n<th>åç§°</th>\n<th>æè¿°</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>from</code></td>\n<td>åŒä¸€ä¸ªæ•°æ®åº“ä¸‹ç­‰å¾…è¢«Joinçš„é›†åˆã€‚</td>\n</tr>\n<tr>\n<td><code>localField</code></td>\n<td>æºé›†åˆä¸­çš„matchå€¼ï¼Œå¦‚æœè¾“å…¥çš„é›†åˆä¸­ï¼ŒæŸæ–‡æ¡£æ²¡æœ‰ localFieldè¿™ä¸ªKeyï¼ˆFieldï¼‰ï¼Œåœ¨å¤„ç†çš„è¿‡ç¨‹ä¸­ï¼Œä¼šé»˜è®¤ä¸ºæ­¤æ–‡æ¡£å«æœ‰ localFieldï¼šnullçš„é”®å€¼å¯¹ã€‚</td>\n</tr>\n<tr>\n<td><code>foreignField</code></td>\n<td>å¾…Joinçš„é›†åˆçš„matchå€¼ï¼Œå¦‚æœå¾…Joinçš„é›†åˆä¸­ï¼Œæ–‡æ¡£æ²¡æœ‰foreignFieldå€¼ï¼Œåœ¨å¤„ç†çš„è¿‡ç¨‹ä¸­ï¼Œä¼šé»˜è®¤ä¸ºæ­¤æ–‡æ¡£å«æœ‰ foreignFieldï¼šnullçš„é”®å€¼å¯¹ã€‚</td>\n</tr>\n<tr>\n<td><code>as</code></td>\n<td>ä¸ºè¾“å‡ºæ–‡æ¡£çš„æ–°å¢å€¼å‘½åã€‚å¦‚æœè¾“å…¥çš„é›†åˆä¸­å·²å­˜åœ¨è¯¥å€¼ï¼Œåˆ™ä¼šè¦†ç›–æ‰ã€‚</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å…¶è¯­æ³•åŠŸèƒ½ç±»ä¼¼äºä¸‹é¢çš„ä¼ªSQLè¯­å¥</p>\n</li>\n</ul>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">SELECT</span> <span class=\"operator\">*</span>, <span class=\"operator\">&lt;</span>output <span class=\"keyword\">array</span> field<span class=\"operator\">&gt;</span></span><br><span class=\"line\"><span class=\"keyword\">FROM</span> collection</span><br><span class=\"line\"><span class=\"keyword\">WHERE</span> <span class=\"operator\">&lt;</span>output <span class=\"keyword\">array</span> field<span class=\"operator\">&gt;</span> <span class=\"keyword\">IN</span> (<span class=\"keyword\">SELECT</span> <span class=\"operator\">*</span></span><br><span class=\"line\">                               <span class=\"keyword\">FROM</span> <span class=\"operator\">&lt;</span>collection <span class=\"keyword\">to</span> <span class=\"keyword\">join</span><span class=\"operator\">&gt;</span></span><br><span class=\"line\">                               <span class=\"keyword\">WHERE</span> <span class=\"operator\">&lt;</span>foreignField<span class=\"operator\">&gt;</span> <span class=\"operator\">=</span> <span class=\"operator\">&lt;</span>collection.localField<span class=\"operator\">&gt;</span>);</span><br></pre></td></tr></table></figure>\n<h4 id=\"ç¤ºä¾‹-5\">ç¤ºä¾‹</h4>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å‡†å¤‡æ•°æ®</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># é¡¾å®¢ä¿¡æ¯</span></span><br><span class=\"line\">db.customer.insertOne(&#123;customerCode:1,name:<span class=\"string\">&quot;customer1&quot;</span>,phone:<span class=\"string\">&quot;13112345678&quot;</span>,address:<span class=\"string\">&quot;test1&quot;</span>&#125;)</span><br><span class=\"line\">db.customer.insertOne(&#123;customerCode:2,name:<span class=\"string\">&quot;customer2&quot;</span>,phone:<span class=\"string\">&quot;13112345679&quot;</span>,address:<span class=\"string\">&quot;test2&quot;</span>&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># è®¢å•ä¿¡æ¯</span></span><br><span class=\"line\">db.order.insertOne(&#123;orderId:1,orderCode:<span class=\"string\">&quot;order001&quot;</span>,customerCode:1,price:200&#125;)</span><br><span class=\"line\">db.order.insertOne(&#123;orderId:2,orderCode:<span class=\"string\">&quot;order002&quot;</span>,customerCode:2,price:400&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># è®¢å•æ˜ç»†</span></span><br><span class=\"line\">db.orderItem.insertOne(&#123;itemId:1,productName:<span class=\"string\">&quot;apples&quot;</span>,qutity:2,orderId:1&#125;)</span><br><span class=\"line\">db.orderItem.insertOne(&#123;itemId:2,productName:<span class=\"string\">&quot;oranges&quot;</span>,qutity:2,orderId:1&#125;)</span><br><span class=\"line\">db.orderItem.insertOne(&#123;itemId:3,productName:<span class=\"string\">&quot;mangoes&quot;</span>,qutity:2,orderId:1&#125;)</span><br><span class=\"line\">db.orderItem.insertOne(&#123;itemId:4,productName:<span class=\"string\">&quot;apples&quot;</span>,qutity:2,orderId:2&#125;)</span><br><span class=\"line\">db.orderItem.insertOne(&#123;itemId:5,productName:<span class=\"string\">&quot;oranges&quot;</span>,qutity:2,orderId:2&#125;)</span><br><span class=\"line\">db.orderItem.insertOne(&#123;itemId:6,productName:<span class=\"string\">&quot;mangoes&quot;</span>,qutity:2,orderId:2&#125;)</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æŸ¥è¯¢é¡¾å®¢çš„è®¢å•ä¿¡æ¯ï¼Œå…³è”å­—æ®µä¸ºcustomerCodeé¡¾å®¢å·ç </p>\n</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">db.customer.aggregate([</span></span><br><span class=\"line\"><span class=\"comment\">    &#123;$lookup: &#123;</span></span><br><span class=\"line\"><span class=\"comment\">       from: &quot;order&quot;,</span></span><br><span class=\"line\"><span class=\"comment\">       localField: &quot;customerCode&quot;,</span></span><br><span class=\"line\"><span class=\"comment\">       foreignField: &quot;customerCode&quot;,</span></span><br><span class=\"line\"><span class=\"comment\">       as: &quot;customerOrder&quot;</span></span><br><span class=\"line\"><span class=\"comment\">     &#125;</span></span><br><span class=\"line\"><span class=\"comment\">    &#125;</span></span><br><span class=\"line\"><span class=\"comment\">])</span></span><br><span class=\"line\"><span class=\"comment\">*/</span></span><br><span class=\"line\"><span class=\"type\">Aggregation</span> <span class=\"variable\">aggregation</span> <span class=\"operator\">=</span> Aggregation.newAggregation(</span><br><span class=\"line\">        Aggregation.lookup(<span class=\"string\">&quot;order&quot;</span>, <span class=\"string\">&quot;customerCode&quot;</span>, <span class=\"string\">&quot;customerCode&quot;</span>, <span class=\"string\">&quot;customerOrder&quot;</span>)</span><br><span class=\"line\">);</span><br><span class=\"line\">List&lt;Document&gt; results = mongoTemplate.aggregate(aggregation, <span class=\"string\">&quot;customer&quot;</span>, Document.class).getMappedResults();</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ ¹æ®è®¢å•ä¿¡æ¯å…³è”é¡¾å®¢ä¿¡æ¯å’Œè®¢å•æ˜ç»†</p>\n</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">db.order.aggregate([</span></span><br><span class=\"line\"><span class=\"comment\">    &#123;$lookup: &#123;</span></span><br><span class=\"line\"><span class=\"comment\">               from: &quot;customer&quot;,</span></span><br><span class=\"line\"><span class=\"comment\">               localField: &quot;customerCode&quot;,</span></span><br><span class=\"line\"><span class=\"comment\">               foreignField: &quot;customerCode&quot;,</span></span><br><span class=\"line\"><span class=\"comment\">               as: &quot;curstomer&quot;</span></span><br><span class=\"line\"><span class=\"comment\">             &#125;</span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\">    &#125;,</span></span><br><span class=\"line\"><span class=\"comment\">    &#123;$lookup: &#123;</span></span><br><span class=\"line\"><span class=\"comment\">               from: &quot;orderItem&quot;,</span></span><br><span class=\"line\"><span class=\"comment\">               localField: &quot;orderId&quot;,</span></span><br><span class=\"line\"><span class=\"comment\">               foreignField: &quot;orderId&quot;,</span></span><br><span class=\"line\"><span class=\"comment\">               as: &quot;orderItem&quot;</span></span><br><span class=\"line\"><span class=\"comment\">             &#125;</span></span><br><span class=\"line\"><span class=\"comment\">    &#125;</span></span><br><span class=\"line\"><span class=\"comment\">])</span></span><br><span class=\"line\"><span class=\"comment\">*/</span></span><br><span class=\"line\"><span class=\"type\">Aggregation</span> <span class=\"variable\">aggregation</span> <span class=\"operator\">=</span> Aggregation.newAggregation(</span><br><span class=\"line\">        Aggregation.lookup(<span class=\"string\">&quot;customer&quot;</span>, <span class=\"string\">&quot;customerCode&quot;</span>, <span class=\"string\">&quot;customerCode&quot;</span>, <span class=\"string\">&quot;curstomer&quot;</span>),</span><br><span class=\"line\">        Aggregation.lookup(<span class=\"string\">&quot;orderItem&quot;</span>, <span class=\"string\">&quot;orderId&quot;</span>, <span class=\"string\">&quot;orderId&quot;</span>, <span class=\"string\">&quot;orderItem&quot;</span>)</span><br><span class=\"line\">);</span><br><span class=\"line\">List&lt;Document&gt; results = mongoTemplate.aggregate(aggregation, <span class=\"string\">&quot;order&quot;</span>, Document.class).getMappedResults();</span><br></pre></td></tr></table></figure>\n","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç»å¦‚ä½•ä½¿ç”¨SpringBootå®ç°MongoDB7.0çš„èšåˆæ“ä½œ SpringBootç‰ˆæœ¬3.2.3ï¼ŒMongoDBç‰ˆæœ¬7.0.6 MongoDB Aggregation Operations SQL to Aggregation Mapping Chart MongoDB7.0--SpringBootå•é›†åˆæ“ä½œ èšåˆæ“ä½œç®€ä»‹ èšåˆæ“ä½œå…è®¸ç”¨æˆ·å¤„ç†å¤šä¸ªæ–‡æ¡£å¹¶è¿”å›è®¡ç®—ç»“æœ èšåˆæ“ä½œåŒ…å«ä¸‰ç±» å•æ–‡æ¡£èšåˆï¼šé’ˆå¯¹å•ä¸ªé›†åˆï¼Œå¦‚ï¼šdb.collection.countDocument(), db.collection.distinct() èšåˆç®¡é“ï¼šå®ƒå¯ä»¥ä½œç”¨åœ¨ä¸€ä¸ªæˆ–å‡ ä¸ªé›†åˆä¸Šï¼Œå¯¹é›†åˆä¸­çš„æ•°æ®è¿›è¡Œçš„ä¸€ç³»åˆ—è¿ç®—ï¼Œå¹¶å°†è¿™äº›æ•°æ®è½¬åŒ–ä¸ºç”¨æˆ·æœŸæœ›çš„å½¢å¼ï¼Œæœ¬æ–‡ä¸»è¦ä»‹ç»ç®¡é“æ“ä½œ MapReduceï¼šä»MongoDB 5.0å¼€å§‹ï¼Œmap-reduceæ“ä½œå·²è¢«å¼ƒç”¨ï¼Œæœ¬æ–‡ä¸åšä»‹ç»ã€‚ èšåˆç®¡é“ èšåˆç®¡é“æ˜¯MongoDBä¸­éå¸¸å¼ºå¤§çš„åŠŸèƒ½ï¼Œå®ƒå…è®¸ç”¨æˆ·å°†å¤šä¸ªæ“ä½œç»„åˆåœ¨ä¸€èµ·ï¼Œä»¥å®ç°å¤æ‚çš„æ•°æ®å¤„ç†ã€‚ ä»æ•ˆæœè€Œè¨€ï¼Œèšåˆç®¡é“ç›¸å½“äº SQL æŸ¥è¯¢ä¸­çš„ GROUP BYã€ LEFT OUTER JOIN ã€ ASç­‰ã€‚ æ•´ä¸ªèšåˆè¿ç®—è¿‡ç¨‹ç§°ä¸ºç®¡é“ï¼ˆPipelineï¼‰ï¼Œå®ƒæ˜¯ç”±å¤šä¸ªé˜¶æ®µï¼ˆStageï¼‰ç»„æˆçš„ï¼Œ æ¯ä¸ªç®¡é“ï¼š æ¥å—ä¸€ç³»åˆ—æ–‡æ¡£ï¼ˆåŸå§‹æ•°æ®ï¼‰ æ¯ä¸ªé˜¶æ®µå¯¹è¿™äº›æ–‡æ¡£è¿›è¡Œä¸€ç³»åˆ—è¿ç®— ç»“æœæ–‡æ¡£è¾“å‡ºç»™ä¸‹ä¸€ä¸ªé˜¶æ®µ èšåˆç®¡é“æ“ä½œè¯­æ³• pipelines ä¸€ç»„æ•°æ®èšåˆé˜¶æ®µã€‚é™¤outã€Mergeå’Œ$geonearé˜¶æ®µä¹‹å¤–ï¼Œæ¯ä¸ªé˜¶æ®µéƒ½å¯ä»¥åœ¨ç®¡é“ä¸­å‡ºç°å¤šæ¬¡ã€‚ options å¯é€‰ï¼Œèšåˆæ“ä½œçš„å…¶ä»–å‚æ•°ã€‚åŒ…å«ï¼šæŸ¥è¯¢è®¡åˆ’ã€æ˜¯å¦ä½¿ç”¨ä¸´æ—¶æ–‡ä»¶ã€ æ¸¸æ ‡ã€æœ€å¤§æ“ä½œæ—¶é—´ã€è¯»å†™ç­–ç•¥ã€å¼ºåˆ¶ç´¢å¼•ç­‰ç­‰ 12pipeline = [$stage1, $stage2, ...$stageN];db.collection.aggregate(pipeline, &#123;options&#125;) å¸¸ç”¨çš„èšåˆé˜¶æ®µè¿ç®—ç¬¦ é˜¶æ®µè¿ç®—ç¬¦ æè¿° SQLç­‰ä»·è¿ç®—ç¬¦ $match è¿‡æ»¤æ–‡æ¡£ WHERE $project æŠ•å½±ï¼Œæ”¹å˜æ–‡æ¡£çš„å½¢çŠ¶å’Œå†…å®¹ SELECT filedName AS newName $group å°†æ–‡æ¡£åˆ†ç»„ GROUP BY $sort å¯¹æ–‡æ¡£è¿›è¡Œæ’åº ORDER BY $limit é™åˆ¶ç»“æœé›†çš„å¤§å° LIMIT $skip è·³è¿‡æŒ‡å®šæ•°é‡çš„æ–‡æ¡£ OFFSET $unwind å±•å¼€æ•°ç»„ - $lookup ä»å…¶ä»–é›†åˆä¸­è·å–ç›¸å…³æ–‡æ¡£,å·¦å¤–è¿æ¥ LEFT OUTER JOIN $out å°†ç»“æœé›†è¾“å‡ºåˆ°æ–°çš„é›†åˆ - $geoNear æŒ‰ç…§åœ°ç†ä½ç½®é™„è¿‘çš„é¡ºåºè¿”å›æ–‡æ¡£ - $graphLookup æ‰§è¡Œé€’å½’æŸ¥è¯¢ - $addFields æ·»åŠ æ–°å­—æ®µ - $bucket æ ¹æ®æŒ‡å®šæ¡ä»¶å°†æ–‡æ¡£åˆ†ç»„æˆæ¡¶ - $facet å…è®¸åœ¨å•ä¸ªèšåˆé˜¶æ®µå†…æ‰§è¡Œå¤šä¸ªç‹¬ç«‹çš„å­èšåˆ - èšåˆè¡¨è¾¾å¼ è·å–å­—æ®µä¿¡æ¯ 12$&lt;field&gt; ï¼š ç”¨ $ æŒ‡ç¤ºå­—æ®µè·¯å¾„$&lt;field&gt;.&lt;subfield&gt; ï¼š ä½¿ç”¨ $ å’Œ . æ¥æŒ‡ç¤ºå†…åµŒæ–‡æ¡£çš„è·¯å¾„ å¸¸é‡è¡¨è¾¾å¼ 1$literal :&lt;value&gt; ï¼š æŒ‡ç¤ºå¸¸é‡ &lt;value&gt; ç³»ç»Ÿå˜é‡è¡¨è¾¾å¼ 12$$&lt;variable&gt; ä½¿ç”¨ $$ æŒ‡ç¤ºç³»ç»Ÿå˜é‡$$CURRENT æŒ‡ç¤ºç®¡é“ä¸­å½“å‰æ“ä½œçš„æ–‡æ¡£ èšåˆç®¡é“ç¤ºä¾‹ æœ¬ç¤ºä¾‹ä½¿ç”¨SpringBootå®ç°MongoDB7.0çš„èšåˆæ“ä½œ åˆå§‹åŒ–æ•°æ® 1234567891011121314151617181920212223242526272829303132333435363738394041424344/*var tags = [&quot;nosql&quot;,&quot;mongodb&quot;,&quot;document&quot;,&quot;developer&quot;,&quot;popular&quot;];var types = [&quot;technology&quot;,&quot;sociality&quot;,&quot;travel&quot;,&quot;novel&quot;,&quot;literature&quot;];var books=[];for(var i=0;i&lt;50;i++)&#123; var typeIdx = Math.floor(Math.random()*types.length); var tagIdx = Math.floor(Math.random()*tags.length); var tagIdx2 = Math.floor(Math.random()*tags.length); var favCount = Math.floor(Math.random()*100); var username = &quot;xx00&quot;+Math.floor(Math.random()*10); var age = 20 + Math.floor(Math.random()*15); var book = &#123; title: &quot;book-&quot;+i, type: types[typeIdx], tag: [tags[tagIdx],tags[tagIdx2]], favCount: favCount, author: &#123;name:username,age:age&#125; &#125;; books.push(book)&#125;db.books.insertMany(books);*/String[] tags = &#123;&quot;nosql&quot;, &quot;mongodb&quot;, &quot;document&quot;, &quot;developer&quot;, &quot;popular&quot;&#125;;String[] types = &#123;&quot;technology&quot;, &quot;sociality&quot;, &quot;travel&quot;, &quot;novel&quot;, &quot;literature&quot;&#125;;List&lt;Document&gt; books = new ArrayList&lt;&gt;();Random random = new Random();for (int i = 0; i &lt; 50; i++) &#123; int typeIdx = random.nextInt(types.length); int tagIdx = random.nextInt(tags.length); int tagIdx2 = random.nextInt(tags.length); int favCount = random.nextInt(100); String username = &quot;xx00&quot; + random.nextInt(10); int age = 20 + random.nextInt(15); Document book = new Document(&quot;title&quot;, &quot;book-&quot; + i) .append(&quot;type&quot;, types[typeIdx]) .append(&quot;tag&quot;, List.of(tags[tagIdx], tags[tagIdx2])) .append(&quot;favCount&quot;, favCount) .append(&quot;author&quot;, new Document(&quot;name&quot;, username).append(&quot;age&quot;, age)); books.add(book);&#125;mongoTemplate.insert(books, &quot;books&quot;); $project:æŠ•å½±æ“ä½œ å°†åŸå§‹å­—æ®µæŠ•å½±æˆæŒ‡å®šåç§°ï¼Œ å¦‚å°†é›†åˆä¸­çš„ title æŠ•å½±æˆ name 12345678910// db.books.aggregate([&#123;$project:&#123;name:&quot;$title&quot;&#125;&#125;])ProjectionOperation projectOperation = Aggregation.project() .andExpression(&quot;title&quot;).as(&quot;name&quot;);Aggregation aggregation = Aggregation.newAggregation(projectOperation);System.out.println(aggregation);List&lt;Document&gt; results = mongoTemplate.aggregate(aggregation, &quot;books&quot;, Document.class).getMappedResults();for (Document document : result) &#123; System.out.println(document.toJson());&#125; å‰”é™¤ä¸éœ€è¦çš„å­—æ®µ 12345678910111213// db.books.aggregate([&#123;$project:&#123;name:&quot;$title&quot;,_id:0,type:1,author.name:1&#125;&#125;])ProjectionOperation projectOperation = Aggregation.project() .andExclude(&quot;_id&quot;) .andInclude(&quot;type&quot;) .andExpression(&quot;author.name&quot;).as(&quot;author.name&quot;) // è¿™é‡Œå¿…é¡»ä½¿ç”¨asé‡æ–°å‘½åï¼Œå¦åˆ™åªä¼šç”¨nameåšå­—æ®µåç§°ï¼Œè¿™å°±å’Œåé¢çš„titleçš„åˆ«åå†²çªäº† .andExpression(&quot;title&quot;).as(&quot;name&quot;);Aggregation aggregation = Aggregation.newAggregation(projectOperation);System.out.println(aggregation);List&lt;Document&gt; results = mongoTemplate.aggregate(aggregation, &quot;books&quot;, Document.class).getMappedResults();for (Document document : results) &#123; System.out.println(document.toJson());&#125; $match:è¿‡æ»¤æ“ä½œ è¿‡æ»¤å‡ºæŒ‡å®šæ¡ä»¶çš„æ–‡æ¡£ 12345678// db.books.aggregate([&#123;$match:&#123;type:&quot;technology&quot;&#125;&#125;])MatchOperation matchOperation = Aggregation.match(Criteria.where(&quot;type&quot;).is(&quot;technology&quot;));Aggregation aggregation = Aggregation.newAggregation(matchOperation);System.out.println(aggregation);List&lt;Document&gt; results = mongoTemplate.aggregate(aggregation, &quot;books&quot;, Document.class).getMappedResults();for (Document document : results) &#123; System.out.println(document.toJson());&#125; ç»„åˆå…¶å®ƒç®¡é“ 12345678910/*db.books.aggregate([ &#123;$match:&#123;type:&quot;technology&quot;&#125;&#125;, &#123;$project:&#123;name:&quot;$title&quot;,_id:0,type:1,author:&#123;name:1&#125;&#125;&#125;])*/MatchOperation matchOperation = Aggregation.match(Criteria.where(&quot;type&quot;).is(&quot;technology&quot;));ProjectionOperation projectOperation = Aggregation.project(&quot;title&quot;).andExclude(&quot;_id&quot;).andInclude(&quot;type&quot;).and(&quot;author.name&quot;).as(&quot;author.name&quot;);Aggregation aggregation = Aggregation.newAggregation(matchOperation, projectOperation);List&lt;Document&gt; results = mongoTemplate.aggregate(aggregation, &quot;books&quot;, Document.class).getMappedResults(); $count:è®¡æ•°æ“ä½œ 1234567891011121314/*db.books.aggregate([ &#123;$match:&#123;type:&quot;technology&quot;&#125;&#125;, &#123;$count: &quot;type_count&quot;&#125;])*/// MatchOperation to filter documents by type: &quot;technology&quot;MatchOperation matchAggregation = Aggregation.match(Criteria.where(&quot;type&quot;).is(&quot;technology&quot;));// CountOperation to count the matched documentsCountOperation countAggregation = Aggregation.count().as(&quot;type_count&quot;);// Combine the match and count operationsAggregation aggregation = Aggregation.newAggregation(matchAggregation, countAggregation);System.out.println(aggregation);List&lt;Document&gt; results = mongoTemplate.aggregate(aggregation, &quot;books&quot;, Document.class).getMappedResults(); $group:åˆ†ç»„æ“ä½œ æŒ‰æŒ‡å®šçš„è¡¨è¾¾å¼å¯¹æ–‡æ¡£è¿›è¡Œåˆ†ç»„ï¼Œå¹¶å°†æ¯ä¸ªä¸åŒåˆ†ç»„çš„æ–‡æ¡£è¾“å‡ºåˆ°ä¸‹ä¸€ä¸ªé˜¶æ®µã€‚è¾“å‡ºæ–‡æ¡£åŒ…å«ä¸€ä¸ª_idå­—æ®µï¼Œè¯¥å­—æ®µæŒ‰é”®åŒ…å«ä¸åŒçš„ç»„ã€‚ è¾“å‡ºæ–‡æ¡£è¿˜å¯ä»¥åŒ…å«è®¡ç®—å­—æ®µï¼Œè¯¥å­—æ®µä¿å­˜ç”±$groupçš„_idå­—æ®µåˆ†ç»„çš„ä¸€äº›accumulatorè¡¨è¾¾å¼çš„å€¼ã€‚ $groupä¸ä¼šè¾“å‡ºå…·ä½“çš„æ–‡æ¡£è€Œåªæ˜¯ç»Ÿè®¡ä¿¡æ¯ã€‚ è¯­æ³• 1234&#123; $group: &#123; _id: &lt;expression&gt;, &lt;field1&gt;: &#123; &lt;accumulator1&gt; : &lt;expression1&gt; &#125;, ... &#125; &#125;# _idå­—æ®µæ˜¯å¿…å¡«çš„;ä½†æ˜¯ï¼Œå¯ä»¥æŒ‡å®š_idå€¼ä¸ºnullæ¥ä¸ºæ•´ä¸ªè¾“å…¥æ–‡æ¡£è®¡ç®—ç´¯è®¡å€¼ã€‚# å‰©ä½™çš„è®¡ç®—å­—æ®µæ˜¯å¯é€‰çš„ï¼Œå¹¶ä½¿ç”¨&lt;accumulator&gt;è¿ç®—ç¬¦è¿›è¡Œè®¡ç®—ã€‚# _idå’Œ&lt;accumulator&gt;è¡¨è¾¾å¼å¯ä»¥æ¥å—ä»»ä½•æœ‰æ•ˆçš„è¡¨è¾¾å¼ã€‚ accumulatoræ“ä½œç¬¦ åç§° æè¿° ç±»æ¯”sql avg è®¡ç®—å‡å€¼ avg first è¿”å›æ¯ç»„ç¬¬ä¸€ä¸ªæ–‡æ¡£ï¼Œå¦‚æœæœ‰æ’åºï¼ŒæŒ‰ç…§æ’åºï¼Œå¦‚æœæ²¡æœ‰æŒ‰ç…§é»˜è®¤çš„å­˜å‚¨çš„é¡ºåºçš„ç¬¬ä¸€ä¸ªæ–‡æ¡£ã€‚ limit 0,1 last è¿”å›æ¯ç»„æœ€åä¸€ä¸ªæ–‡æ¡£ï¼Œå¦‚æœæœ‰æ’åºï¼ŒæŒ‰ç…§æ’åºï¼Œå¦‚æœæ²¡æœ‰æŒ‰ç…§é»˜è®¤çš„å­˜å‚¨çš„é¡ºåºçš„æœ€åä¸ªæ–‡æ¡£ã€‚ - max æ ¹æ®åˆ†ç»„ï¼Œè·å–é›†åˆä¸­æ‰€æœ‰æ–‡æ¡£å¯¹åº”å€¼å¾—æœ€å¤§å€¼ã€‚ max min æ ¹æ®åˆ†ç»„ï¼Œè·å–é›†åˆä¸­æ‰€æœ‰æ–‡æ¡£å¯¹åº”å€¼å¾—æœ€å°å€¼ã€‚ min push å°†æŒ‡å®šçš„è¡¨è¾¾å¼çš„å€¼æ·»åŠ åˆ°ä¸€ä¸ªæ•°ç»„ä¸­ã€‚ - addToSet å°†è¡¨è¾¾å¼çš„å€¼æ·»åŠ åˆ°ä¸€ä¸ªé›†åˆä¸­ï¼ˆæ— é‡å¤å€¼ï¼Œæ— åºï¼‰ã€‚ - sum è®¡ç®—æ€»å’Œ sum stdDevPop è¿”å›è¾“å…¥å€¼çš„æ€»ä½“æ ‡å‡†åå·®ï¼ˆpopulation standard deviationï¼‰ - stdDevSamp è¿”å›è¾“å…¥å€¼çš„æ ·æœ¬æ ‡å‡†åå·®ï¼ˆthe sample standard deviationï¼‰ - ç¤ºä¾‹ bookçš„æ•°é‡ï¼Œæ”¶è—æ€»æ•°å’Œå¹³å‡å€¼ 123456789101112131415161718/*db.books.aggregate([ &#123;$group:&#123;_id:null,count:&#123;$sum:1&#125;,pop:&#123;$sum:&quot;$favCount&quot;&#125;,avg:&#123;$avg:&quot;$favCount&quot;&#125;&#125;&#125;])*/Aggregation aggregation = Aggregation.newAggregation( Aggregation.group().count().as(&quot;count&quot;).sum(&quot;favCount&quot;).as(&quot;pop&quot;).avg(&quot;favCount&quot;).as(&quot;avg&quot;));AggregationResults&lt;Document&gt; results = mongoTemplate.aggregate(aggregation, &quot;books&quot;, Document.class);List&lt;Document&gt; mappedResults = results.getMappedResults();// Assuming that there will be only one result due to grouping by null (_id: null)if (!mappedResults.isEmpty()) &#123; System.out.println(mappedResults.get(0).toJson());&#125; else &#123; System.out.println(&quot;&#123;&#125;&quot;);&#125; ç»Ÿè®¡æ¯ä¸ªä½œè€…çš„bookæ”¶è—æ€»æ•° 1234567891011/*db.books.aggregate([ &#123;$group:&#123;_id:&quot;$author.name&quot;,pop:&#123;$sum:&quot;$favCount&quot;&#125;&#125;&#125;])*/Aggregation aggregation = Aggregation.newAggregation( Aggregation.group(&quot;author.name&quot;).sum(&quot;favCount&quot;).as(&quot;pop&quot;));AggregationResults&lt;Document&gt; results = mongoTemplate.aggregate(aggregation, &quot;books&quot;, Document.class);List&lt;Document&gt; mappedResults = results.getMappedResults(); ç»Ÿè®¡æ¯ä¸ªä½œè€…çš„æ¯æœ¬bookçš„æ”¶è—æ•° 1234567891011/*db.books.aggregate([ &#123;$group:&#123;_id:&#123;name:&quot;$author.name&quot;,title:&quot;$title&quot;&#125;,pop:&#123;$sum:&quot;$favCount&quot;&#125;&#125;&#125;])*/Aggregation aggregation = Aggregation.newAggregation( Aggregation.group(&quot;author.name&quot;, &quot;title&quot;).sum(&quot;favCount&quot;).as(&quot;pop&quot;));AggregationResults&lt;Document&gt; results = mongoTemplate.aggregate(aggregation, &quot;books&quot;, Document.class);List&lt;Document&gt; mappedResults = results.getMappedResults(); æ¯ä¸ªä½œè€…çš„bookçš„typeåˆé›† 123456789/*db.books.aggregate([ &#123;$group:&#123;_id:&quot;$author.name&quot;,types:&#123;$addToSet:&quot;$type&quot;&#125;&#125;&#125;])*/GroupOperation groupOperation = Aggregation.group(&quot;author.name&quot;).addToSet(&quot;type&quot;).as(&quot;types&quot;);Aggregation aggregation = Aggregation.newAggregation(groupOperation);AggregationResults&lt;Document&gt; results = mongoTemplate.aggregate(aggregation, &quot;books&quot;, Document.class);List&lt;Document&gt; mappedResults = results.getMappedResults(); $unwind å¯ä»¥å°†æ•°ç»„æ‹†åˆ†ä¸ºå•ç‹¬çš„æ–‡æ¡£ è¯­æ³• 1234567891011&#123; $unwind: &#123; #è¦æŒ‡å®šå­—æ®µè·¯å¾„ï¼Œåœ¨å­—æ®µåç§°å‰åŠ ä¸Š$ç¬¦å¹¶ç”¨å¼•å·æ‹¬èµ·æ¥ã€‚ path: &lt;field path&gt;, #å¯é€‰,ä¸€ä¸ªæ–°å­—æ®µçš„åç§°ç”¨äºå­˜æ”¾å…ƒç´ çš„æ•°ç»„ç´¢å¼•ã€‚è¯¥åç§°ä¸èƒ½ä»¥$å¼€å¤´ã€‚ includeArrayIndex: &lt;string&gt;, #å¯é€‰ï¼Œdefault :falseï¼Œè‹¥ä¸ºtrue,å¦‚æœè·¯å¾„ä¸ºç©ºï¼Œç¼ºå°‘æˆ–ä¸ºç©ºæ•°ç»„ï¼Œåˆ™$unwindè¾“å‡ºæ–‡æ¡£ preserveNullAndEmptyArrays: &lt;boolean&gt; &#125;&#125; ç¤ºä¾‹ å§“åä¸ºxx006çš„ä½œè€…çš„bookçš„tagæ•°ç»„æ‹†åˆ†ä¸ºå¤šä¸ªæ–‡æ¡£ 1234567891011/*db.books.aggregate([ &#123;$match:&#123;&quot;author.name&quot;:&quot;xx006&quot;&#125;&#125;, &#123;$unwind:&quot;$tag&quot;&#125;])*/Aggregation aggregation = Aggregation.newAggregation( Aggregation.match(Criteria.where(&quot;author.name&quot;).is(&quot;xx006&quot;)), Aggregation.unwind(&quot;tag&quot;));List&lt;Document&gt; results = mongoTemplate.aggregate(aggregation, &quot;books&quot;, Document.class).getMappedResults(); ä½¿ç”¨includeArrayIndexé€‰é¡¹æ¥è¾“å‡ºæ•°ç»„å…ƒç´ çš„æ•°ç»„ç´¢å¼• 1234567891011/*db.books.aggregate([ &#123;$match:&#123;&quot;author.name&quot;:&quot;xx006&quot;&#125;&#125;, &#123;$unwind:&#123;path:&quot;$tag&quot;, includeArrayIndex: &quot;arrayIndex&quot;&#125;&#125;])*/Aggregation aggregation = Aggregation.newAggregation( Aggregation.match(Criteria.where(&quot;author.name&quot;).is(&quot;xx006&quot;)), Aggregation.unwind(&quot;tag&quot;, &quot;arrayIndex&quot;));List&lt;Document&gt; results = mongoTemplate.aggregate(aggregation, &quot;books&quot;, Document.class).getMappedResults(); æ¯ä¸ªä½œè€…çš„bookçš„tagåˆé›† 1234567891011/*db.books.aggregate([ &#123;$unwind:&quot;$tag&quot;&#125;, &#123;$group:&#123;_id:&quot;$author.name&quot;,types:&#123;$addToSet:&quot;$tag&quot;&#125;&#125;&#125;])*/UnwindOperation unwindOperation = Aggregation.unwind(&quot;tag&quot;);GroupOperation groupOperation = Aggregation.group(&quot;author.name&quot;).addToSet(&quot;tag&quot;).as(&quot;types&quot;);Aggregation aggregation = Aggregation.newAggregation(unwindOperation, groupOperation);AggregationResults&lt;Document&gt; results = mongoTemplate.aggregate(aggregation, &quot;books&quot;, Document.class);List&lt;Document&gt; mappedResults = results.getMappedResults(); ä½¿ç”¨preserveNullAndEmptyArraysé€‰é¡¹åœ¨è¾“å‡ºä¸­åŒ…å«ç¼ºå°‘tagå­—æ®µï¼Œnullæˆ–ç©ºæ•°ç»„çš„æ–‡æ¡£ 12345678910111213141516171819202122# åˆå§‹åŒ–æ•°æ®ï¼ŒåŠ å…¥ä¸€äº›tagä¸ºç©ºæ•°ç»„æˆ–ä¸å­˜åœ¨tagçš„æ–‡æ¡£db.books.insertMany([ &#123; &quot;title&quot; : &quot;book-51&quot;, &quot;type&quot; : &quot;technology&quot;, &quot;favCount&quot; : 11, &quot;tag&quot;:[], &quot;author&quot; : &#123; &quot;name&quot; : &quot;xx006&quot;, &quot;age&quot; : 28 &#125; &#125;, &#123; &quot;title&quot; : &quot;book-52&quot;, &quot;type&quot; : &quot;technology&quot;, &quot;favCount&quot; : 15, &quot;author&quot; : &#123; &quot;name&quot; : &quot;xx006&quot;, &quot;age&quot; : 28 &#125; &#125;]) 1234567891011/*db.books.aggregate([ &#123;$match:&#123;&quot;author.name&quot;:&quot;xx006&quot;&#125;&#125;, &#123;$unwind:&#123;path:&quot;$tag&quot;, preserveNullAndEmptyArrays: true&#125;&#125;])*/Aggregation aggregation = Aggregation.newAggregation( Aggregation.match(Criteria.where(&quot;author.name&quot;).is(&quot;xx006&quot;)), Aggregation.unwind(&quot;tag&quot;, true));List&lt;Document&gt; results = mongoTemplate.aggregate(aggregation, &quot;books&quot;, Document.class).getMappedResults(); limit/limit/limit/skip/$sort $limit:é™åˆ¶ä¼ é€’åˆ°ç®¡é“ä¸­ä¸‹ä¸€é˜¶æ®µçš„æ–‡æ¡£æ•° $skip:è·³è¿‡ä¼ é€’åˆ°ç®¡é“ä¸­ä¸‹ä¸€é˜¶æ®µçš„æ–‡æ¡£æ•° $sort:å¯¹ä¼ é€’åˆ°ç®¡é“ä¸­ä¸‹ä¸€é˜¶æ®µçš„æ–‡æ¡£è¿›è¡Œæ’åº ç¤ºä¾‹ å§“åä¸ºxx006çš„ä½œè€…çš„bookçš„tagæ•°ç»„æ‹†åˆ†ä¸ºå¤šä¸ªæ–‡æ¡£ï¼ŒæŒ‰ç…§æ”¶è—æ•°é™åºæ’åºï¼Œè·³è¿‡2ä¸ªæ–‡æ¡£ï¼Œå–5ä¸ªæ–‡æ¡£ 12345678910111213141516171819202122232425262728293031/*db.books.aggregate([ &#123;$match:&#123;&quot;author.name&quot;:&quot;xx006&quot;&#125;&#125;, &#123;$unwind:&#123;path:&quot;$tag&quot;, preserveNullAndEmptyArrays: true&#125;&#125;, &#123;$sort:&#123;&quot;favCount&quot;:-1&#125;&#125;, &#123;$limit : 5 &#125;, &#123;$skip : 2&#125;])*/Aggregation aggregation = Aggregation.newAggregation( Aggregation.match(Criteria.where(&quot;author.name&quot;).is(&quot;xx006&quot;)), Aggregation.unwind(&quot;tag&quot;, true), Aggregation.sort(Sort.by(Sort.Direction.DESC, &quot;favCount&quot;)), Aggregation.skip(2), Aggregation.limit(5));List&lt;Document&gt; results = mongoTemplate.aggregate(aggregation, &quot;books&quot;, Document.class).getMappedResults();``* ç»Ÿè®¡æ¯ä¸ªåˆ†ç±»çš„bookæ–‡æ¡£æ•°é‡```java/*db.books.aggregate([ &#123;$group:&#123;_id:&quot;$type&quot;,total:&#123;$sum:1&#125;&#125;&#125;, &#123;$sort:&#123;total:-1&#125;&#125;])*/Aggregation aggregation = Aggregation.newAggregation( Aggregation.group(&quot;type&quot;).count().as(&quot;total&quot;), Aggregation.sort(Sort.by(Sort.Direction.DESC, &quot;total&quot;)));List&lt;Document&gt; results = mongoTemplate.aggregate(aggregation, &quot;books&quot;, Document.class).getMappedResults(); æ ‡ç­¾çš„çƒ­åº¦æ’è¡Œï¼Œæ ‡ç­¾çš„çƒ­åº¦åˆ™æŒ‰å…¶å…³è”bookæ–‡æ¡£çš„æ”¶è—æ•°ï¼ˆfavCountï¼‰æ¥è®¡ç®— 123456789101112131415/*db.books.aggregate([ &#123;$match:&#123;favCount:&#123;$gt:0&#125;&#125;&#125;, &#123;$unwind:&quot;$tag&quot;&#125;, &#123;$group:&#123;_id:&quot;$tag&quot;,total:&#123;$sum:&quot;$favCount&quot;&#125;&#125;&#125;, &#123;$sort:&#123;total:-1&#125;&#125;])*/Aggregation aggregation = Aggregation.newAggregation( Aggregation.match(Criteria.where(&quot;favCount&quot;).gt(0)), Aggregation.unwind(&quot;tag&quot;), Aggregation.group(&quot;tag&quot;).sum(&quot;favCount&quot;).as(&quot;total&quot;), Aggregation.sort(Sort.by(Sort.Direction.DESC, &quot;total&quot;)));List&lt;Document&gt; results = mongoTemplate.aggregate(aggregation, &quot;books&quot;, Document.class).getMappedResults(); $bucket $bucket:æ ¹æ®æŒ‡å®šçš„æ¡ä»¶å’Œè¾¹ç•Œï¼Œå°†æ–‡æ¡£åˆ†ç»„åˆ°ä¸åŒçš„æ¡¶ä¸­ ç¤ºä¾‹ ç»Ÿè®¡bookæ–‡æ¡£æ”¶è—æ•°[0,10),[10,60),[60,80),[80,100),[100,+âˆï¼‰ 123456789101112131415161718192021222324252627282930313233343536373839/*db.books.aggregate([&#123; $bucket:&#123; groupBy:&quot;$favCount&quot;, boundaries:[0,10,60,80,100], default:&quot;other&quot;, output:&#123;&quot;count&quot;:&#123;$sum:1&#125;&#125; &#125;&#125;])[ &#123; _id: 0, count: 3 &#125;, &#123; _id: 10, count: 27 &#125;, &#123; _id: 60, count: 11 &#125;, &#123; _id: 80, count: 11 &#125;]groupBy: æŒ‡å®šç”¨äºåˆ†ç»„çš„å­—æ®µã€‚åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œæ ¹æ® favCount å­—æ®µçš„å€¼è¿›è¡Œåˆ†ç»„ã€‚boundaries: å®šä¹‰åˆ†æ¡¶çš„è¾¹ç•Œï¼Œå³æ¯ä¸ªæ¡¶çš„èŒƒå›´ã€‚æ–‡æ¡£çš„å€¼å°†æ ¹æ®è¿™äº›è¾¹ç•Œè¢«åˆ†é…åˆ°ä¸åŒçš„æ¡¶ä¸­ã€‚è¾¹ç•Œåº”æŒ‰å‡åºæ’åˆ—ã€‚åœ¨è¿™ä¸ªå‘½ä»¤ä¸­ï¼Œè¾¹ç•Œ [0, 10, 60, 80, 100] è¡¨ç¤ºå°†æ–‡æ¡£åˆ†æˆå…­ä¸ªæ¡¶ï¼šå°äºç­‰äº0ã€å¤§äº0å°äºç­‰äº10ã€å¤§äº10å°äºç­‰äº60ã€å¤§äº60å°äºç­‰äº80ã€å¤§äº80å°äºç­‰äº100ã€å¤§äº100ã€‚default: è¿™æ˜¯ä¸€ä¸ªå¯é€‰å‚æ•°ï¼Œç”¨äºæŒ‡å®šé»˜è®¤æ¡¶çš„åç§°ã€‚å¦‚æœæ–‡æ¡£çš„å€¼ä¸åœ¨æŒ‡å®šçš„è¾¹ç•ŒèŒƒå›´å†…ï¼Œåˆ™ä¼šè¢«æ”¾å…¥è¯¥æ¡¶ä¸­ã€‚åœ¨è¿™ä¸ªå‘½ä»¤ä¸­ï¼Œå¦‚æœ favCount çš„å€¼ä¸åœ¨æŒ‡å®šçš„è¾¹ç•ŒèŒƒå›´å†…ï¼Œå°†ä¼šè¢«æ”¾å…¥åä¸º &quot;other&quot; çš„æ¡¶ä¸­ã€‚æ¯”å¦‚è¿™é‡Œè®¾ç½®è¾¹ç•Œ [10, 60, 80, 100]ï¼Œå³è¡¨ç¤ºä»10å¼€å§‹åˆ†ç»„ï¼Œåˆ™0~10çš„æ•°æ®ä¼šè¢«åˆ†ç»„åˆ°åä¸º &quot;other&quot; çš„æ¡¶ä¸­ã€‚[ &#123; _id: 10, count: 27 &#125;, &#123; _id: 60, count: 11 &#125;, &#123; _id: 80, count: 11 &#125;, &#123; _id: &#x27;other&#x27;, count: 3 &#125;]output: å®šä¹‰äº†æ¯ä¸ªæ¡¶çš„è¾“å‡ºå†…å®¹ã€‚è¿™æ˜¯ä¸€ä¸ªå­æ–‡æ¡£ï¼Œå®ƒæŒ‡å®šäº†åœ¨æ¯ä¸ªæ¡¶ä¸­è®¡ç®—çš„èšåˆæ“ä½œã€‚åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œä½¿ç”¨ $sum èšåˆæ“ä½œç¬¦æ¥è®¡ç®—æ¯ä¸ªæ¡¶ä¸­çš„æ–‡æ¡£æ•°é‡ï¼Œå¹¶å°†ç»“æœå­˜å‚¨åœ¨åä¸º &quot;count&quot; çš„å­—æ®µä¸­ã€‚*/Aggregation aggregation = Aggregation.newAggregation( Aggregation.bucket(&quot;$favCount&quot;) .withBoundaries(0,10,60,80,100) .withDefaultBucket(&quot;other&quot;) .andOutput(context -&gt; new Document(&quot;$sum&quot;, 1)) .as(&quot;count&quot;));List&lt;Document&gt; results = mongoTemplate.aggregate(aggregation, &quot;books&quot;, Document.class).getMappedResults(); $lookup $lookup:å°†æ–‡æ¡£ä¸­çš„ä¸€ä¸ªå­—æ®µçš„å€¼ä¸å¦ä¸€ä¸ªé›†åˆä¸­çš„æ–‡æ¡£è¿›è¡ŒåŒ¹é…ï¼Œç„¶åå°†åŒ¹é…çš„æ–‡æ¡£æ·»åŠ åˆ°å½“å‰æ–‡æ¡£ä¸­ è¯­æ³• 12345678db.collection.aggregate([&#123; $lookup: &#123; from: &quot;&lt;collection to join&gt;&quot;, localField: &quot;&lt;field from the input documents&gt;&quot;, foreignField: &quot;&lt;field from the documents of the from collection&gt;&quot;, as: &quot;&lt;output array field&gt;&quot; &#125;&#125;) åç§° æè¿° from åŒä¸€ä¸ªæ•°æ®åº“ä¸‹ç­‰å¾…è¢«Joinçš„é›†åˆã€‚ localField æºé›†åˆä¸­çš„matchå€¼ï¼Œå¦‚æœè¾“å…¥çš„é›†åˆä¸­ï¼ŒæŸæ–‡æ¡£æ²¡æœ‰ localFieldè¿™ä¸ªKeyï¼ˆFieldï¼‰ï¼Œåœ¨å¤„ç†çš„è¿‡ç¨‹ä¸­ï¼Œä¼šé»˜è®¤ä¸ºæ­¤æ–‡æ¡£å«æœ‰ localFieldï¼šnullçš„é”®å€¼å¯¹ã€‚ foreignField å¾…Joinçš„é›†åˆçš„matchå€¼ï¼Œå¦‚æœå¾…Joinçš„é›†åˆä¸­ï¼Œæ–‡æ¡£æ²¡æœ‰foreignFieldå€¼ï¼Œåœ¨å¤„ç†çš„è¿‡ç¨‹ä¸­ï¼Œä¼šé»˜è®¤ä¸ºæ­¤æ–‡æ¡£å«æœ‰ foreignFieldï¼šnullçš„é”®å€¼å¯¹ã€‚ as ä¸ºè¾“å‡ºæ–‡æ¡£çš„æ–°å¢å€¼å‘½åã€‚å¦‚æœè¾“å…¥çš„é›†åˆä¸­å·²å­˜åœ¨è¯¥å€¼ï¼Œåˆ™ä¼šè¦†ç›–æ‰ã€‚ å…¶è¯­æ³•åŠŸèƒ½ç±»ä¼¼äºä¸‹é¢çš„ä¼ªSQLè¯­å¥ 12345SELECT *, &lt;output array field&gt;FROM collectionWHERE &lt;output array field&gt; IN (SELECT * FROM &lt;collection to join&gt; WHERE &lt;foreignField&gt; = &lt;collection.localField&gt;); ç¤ºä¾‹ å‡†å¤‡æ•°æ® 123456789101112131415# é¡¾å®¢ä¿¡æ¯db.customer.insertOne(&#123;customerCode:1,name:&quot;customer1&quot;,phone:&quot;13112345678&quot;,address:&quot;test1&quot;&#125;)db.customer.insertOne(&#123;customerCode:2,name:&quot;customer2&quot;,phone:&quot;13112345679&quot;,address:&quot;test2&quot;&#125;)# è®¢å•ä¿¡æ¯db.order.insertOne(&#123;orderId:1,orderCode:&quot;order001&quot;,customerCode:1,price:200&#125;)db.order.insertOne(&#123;orderId:2,orderCode:&quot;order002&quot;,customerCode:2,price:400&#125;)# è®¢å•æ˜ç»†db.orderItem.insertOne(&#123;itemId:1,productName:&quot;apples&quot;,qutity:2,orderId:1&#125;)db.orderItem.insertOne(&#123;itemId:2,productName:&quot;oranges&quot;,qutity:2,orderId:1&#125;)db.orderItem.insertOne(&#123;itemId:3,productName:&quot;mangoes&quot;,qutity:2,orderId:1&#125;)db.orderItem.insertOne(&#123;itemId:4,productName:&quot;apples&quot;,qutity:2,orderId:2&#125;)db.orderItem.insertOne(&#123;itemId:5,productName:&quot;oranges&quot;,qutity:2,orderId:2&#125;)db.orderItem.insertOne(&#123;itemId:6,productName:&quot;mangoes&quot;,qutity:2,orderId:2&#125;) æŸ¥è¯¢é¡¾å®¢çš„è®¢å•ä¿¡æ¯ï¼Œå…³è”å­—æ®µä¸ºcustomerCodeé¡¾å®¢å·ç  123456789101112131415/*db.customer.aggregate([ &#123;$lookup: &#123; from: &quot;order&quot;, localField: &quot;customerCode&quot;, foreignField: &quot;customerCode&quot;, as: &quot;customerOrder&quot; &#125; &#125;])*/Aggregation aggregation = Aggregation.newAggregation( Aggregation.lookup(&quot;order&quot;, &quot;customerCode&quot;, &quot;customerCode&quot;, &quot;customerOrder&quot;));List&lt;Document&gt; results = mongoTemplate.aggregate(aggregation, &quot;customer&quot;, Document.class).getMappedResults(); æ ¹æ®è®¢å•ä¿¡æ¯å…³è”é¡¾å®¢ä¿¡æ¯å’Œè®¢å•æ˜ç»† 123456789101112131415161718192021222324/*db.order.aggregate([ &#123;$lookup: &#123; from: &quot;customer&quot;, localField: &quot;customerCode&quot;, foreignField: &quot;customerCode&quot;, as: &quot;curstomer&quot; &#125; &#125;, &#123;$lookup: &#123; from: &quot;orderItem&quot;, localField: &quot;orderId&quot;, foreignField: &quot;orderId&quot;, as: &quot;orderItem&quot; &#125; &#125;])*/Aggregation aggregation = Aggregation.newAggregation( Aggregation.lookup(&quot;customer&quot;, &quot;customerCode&quot;, &quot;customerCode&quot;, &quot;curstomer&quot;), Aggregation.lookup(&quot;orderItem&quot;, &quot;orderId&quot;, &quot;orderId&quot;, &quot;orderItem&quot;));List&lt;Document&gt; results = mongoTemplate.aggregate(aggregation, &quot;order&quot;, Document.class).getMappedResults();","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç»å¦‚ä½•ä½¿ç”¨SpringBootå®ç°MongoDB7.0çš„èšåˆæ“ä½œ SpringBootç‰ˆæœ¬3.2.3ï¼ŒMongoDBç‰ˆæœ¬7.0.6 MongoDB Aggregation Operations SQL to Aggregation Mapping Chart MongoDB7.0--SpringBootå•é›†åˆæ“ä½œ","date_published":"2024-03-07T13:30:05.000Z","tags":["æŠ€æœ¯","linux","mongodb","mongodb"]},{"id":"https://blog.hanqunfeng.com/2024/03/05/mongodb7-springboot/","url":"https://blog.hanqunfeng.com/2024/03/05/mongodb7-springboot/","title":"MongoDB7.0--SpringBootå•é›†åˆæ“ä½œ","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç»å¦‚ä½•ä½¿ç”¨SpringBootå®ç°MongoDB7.0çš„å•é›†åˆçš„CURDæ“ä½œ</p>\n</li>\n<li class=\"lvl-2\">\n<p>SpringBootç‰ˆæœ¬3.2.3ï¼ŒMongoDBç‰ˆæœ¬7.0.6</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://www.mongodb.com/docs/v7.0/crud/\">MongoDB CRUD Operations</a></p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://www.mongodb.com/docs/v7.0/reference/sql-comparison/\">SQL to MongoDB Mapping Chart</a></p>\n</li>\n<li class=\"lvl-2\">\n<a href=\"/2024/03/07/mongodb7-springboot-aggregate/\" title=\"MongoDB7.0--SpringBootèšåˆæ“ä½œ\">MongoDB7.0--SpringBootèšåˆæ“ä½œ</a>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"spring-boot-ä¸-MongoDB-çš„ç‰ˆæœ¬å¯¹åº”å…³ç³»\">spring-boot ä¸ MongoDB çš„ç‰ˆæœ¬å¯¹åº”å…³ç³»</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><code>spring-data-mongodb</code>ä¸<code>MongoDB</code>ç‰ˆæœ¬å¯¹åº”å…³ç³»å¯ä»¥å‚çœ‹<a href=\"https://docs.spring.io/spring-data/mongodb/reference/preface.html\">å®˜æ–¹æ–‡æ¡£</a></p>\n</li>\n<li class=\"lvl-2\">\n<p><code>spring-boot-starter-data-mongodb</code> ä¸ <code>spring-data-mongodb</code> ç‰ˆæœ¬å¯¹åº”å…³ç³»</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>spring-boot-starter-data-mongodb ç‰ˆæœ¬</th>\n<th>spring-data-mongodb ç‰ˆæœ¬</th>\n<th>MongoDB Server ç‰ˆæœ¬</th>\n<th>Java Driver Version</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>3.2.x</td>\n<td>4.2.x</td>\n<td>6.0.x,7.0.x</td>\n<td>4.11.x</td>\n</tr>\n<tr>\n<td>3.1.x</td>\n<td>4.1.x</td>\n<td>6.0.x,7.0.x</td>\n<td>4.9.x</td>\n</tr>\n<tr>\n<td>3.0.x</td>\n<td>4.0.x</td>\n<td>6.0.x</td>\n<td>4.7.x</td>\n</tr>\n<tr>\n<td>2.7.x</td>\n<td>3.4.x</td>\n<td>5.0.x</td>\n<td>4.6.x</td>\n</tr>\n<tr>\n<td>2.6.x</td>\n<td>3.3.x</td>\n<td>5.0.x</td>\n<td>4.4.x</td>\n</tr>\n<tr>\n<td>2.5.x</td>\n<td>3.2.x</td>\n<td>4.4.x</td>\n<td>4.1.x</td>\n</tr>\n<tr>\n<td>2.4.x</td>\n<td>3.1.x</td>\n<td>4.4.x</td>\n<td>4.1.x</td>\n</tr>\n<tr>\n<td>2.3.x</td>\n<td>3.0.x</td>\n<td>4.4.x</td>\n<td>4.0.x</td>\n</tr>\n<tr>\n<td>2.2.x</td>\n<td>2.2.x</td>\n<td>4.2.x</td>\n<td>3.11.x</td>\n</tr>\n<tr>\n<td>2.1.x</td>\n<td>2.1.x</td>\n<td>4.0.x</td>\n<td>3.8.x</td>\n</tr>\n<tr>\n<td>2.0.x</td>\n<td>2.0.x</td>\n<td>3.4.x</td>\n<td>3.5.x</td>\n</tr>\n<tr>\n<td>1.10.x</td>\n<td>1.10.x</td>\n<td>2.4.x</td>\n<td>2.10.x,2.11.x</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Mongoçš„Javaé©±åŠ¨ï¼Œåœ¨<code>3.7.x</code>åŠä»¥åçš„ç‰ˆæœ¬å«åš<a href=\"https://mvnrepository.com/artifact/org.mongodb/mongodb-driver-sync\">mongodb-driver-sync</a>ï¼Œä»¥å‰çš„ç‰ˆæœ¬å«åš<a href=\"https://mvnrepository.com/artifact/org.mongodb/mongo-java-driver\">mongo-java-driver</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>MongoDB ä¸ Java Driver å…¼å®¹æ€§<br>\n<img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/FZeH9j.png\" alt=\"\" width=\"800\" height=\"800\"></p>\n</li>\n</ul>\n<h2 id=\"SpringBootæ•´åˆMongoDB\">SpringBootæ•´åˆMongoDB</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¼•å…¥ä¾èµ–</p>\n</li>\n</ul>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-data-mongodb<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>é…ç½®yml</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">spring:</span></span><br><span class=\"line\">  <span class=\"attr\">data:</span></span><br><span class=\"line\">    <span class=\"attr\">mongodb:</span></span><br><span class=\"line\">      <span class=\"attr\">uri:</span> <span class=\"string\">mongodb://root:password@127.0.0.1:27017/mytest?authSource=admin</span></span><br><span class=\"line\">      <span class=\"comment\">#uriç­‰åŒäºä¸‹é¢çš„é…ç½®</span></span><br><span class=\"line\">      <span class=\"comment\"># database: mytest # æ•°æ®åº“å</span></span><br><span class=\"line\">      <span class=\"comment\"># host: 127.0.0.1</span></span><br><span class=\"line\">      <span class=\"comment\"># port: 27017</span></span><br><span class=\"line\">      <span class=\"comment\"># username: root</span></span><br><span class=\"line\">      <span class=\"comment\"># password: password</span></span><br><span class=\"line\">      <span class=\"comment\">#a uthentication-database: admin</span></span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\"># å¤åˆ¶é›†</span></span><br><span class=\"line\">      <span class=\"comment\"># uri: mongodb://user:password@127.0.0.1:27040,127.0.0.1:27041,127.0.0.1:27042/mytest?authSource=admin&amp;readPreference=primaryPreferred</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>é…ç½®ç±»:å»æ‰<code>_class</code>å±æ€§</p>\n</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">MongoConfig</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * å®šåˆ¶TypeMapperå»æ‰_classå±æ€§</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    MappingMongoConverter <span class=\"title function_\">mappingMongoConverter</span><span class=\"params\">(</span></span><br><span class=\"line\"><span class=\"params\">            MongoDatabaseFactory mongoDatabaseFactory,</span></span><br><span class=\"line\"><span class=\"params\">            MongoMappingContext context, MongoCustomConversions conversions)</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">DbRefResolver</span> <span class=\"variable\">dbRefResolver</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">DefaultDbRefResolver</span>(mongoDatabaseFactory);</span><br><span class=\"line\">        <span class=\"type\">MappingMongoConverter</span> <span class=\"variable\">mappingMongoConverter</span> <span class=\"operator\">=</span></span><br><span class=\"line\">                <span class=\"keyword\">new</span> <span class=\"title class_\">MappingMongoConverter</span>(dbRefResolver, context);</span><br><span class=\"line\">        mappingMongoConverter.setCustomConversions(conversions);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//æ„é€ DefaultMongoTypeMapperï¼Œå°†typeKeyè®¾ç½®ä¸ºç©ºå€¼</span></span><br><span class=\"line\">        mappingMongoConverter.setTypeMapper(<span class=\"keyword\">new</span> <span class=\"title class_\">DefaultMongoTypeMapper</span>(<span class=\"literal\">null</span>));</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> mappingMongoConverter;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"æŸ¥è¯¢\">æŸ¥è¯¢</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Mongoè¯­æ³•</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æŸ¥è¯¢é›†åˆä¸­çš„è‹¥å¹²æ–‡æ¡£</span></span><br><span class=\"line\">db.collection.find(query, projection)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥è¯¢é›†åˆä¸­çš„ç¬¬ä¸€ä¸ªæ–‡æ¡£</span></span><br><span class=\"line\">db.collection.findOne(query, projection)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å¦‚æœä½ éœ€è¦ä»¥æ˜“è¯»çš„æ–¹å¼æ¥è¯»å–æ•°æ®ï¼Œå¯ä»¥ä½¿ç”¨pretty()æ–¹æ³•</span></span><br><span class=\"line\">db.collection.find().pretty()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ’åºï¼Œ1 ä¸ºå‡åºæ’åˆ—ï¼Œè€Œ -1 æ˜¯ç”¨äºé™åºæ’åˆ—</span></span><br><span class=\"line\">db.collection.find(query, projection).<span class=\"built_in\">sort</span>(&#123;field:-1&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åˆ†é¡µ</span></span><br><span class=\"line\"><span class=\"comment\"># .skip(16) è¡¨ç¤ºè·³è¿‡å‰é¢ 16 æ¡è®°å½•ï¼Œå³å‰ä¸¤é¡µçš„æ‰€æœ‰è®°å½•.</span></span><br><span class=\"line\"><span class=\"comment\"># .limit(8) è¡¨ç¤ºè¿”å› 8 æ¡è®°å½•ï¼Œå³ç¬¬ä¸‰é¡µçš„æ‰€æœ‰è®°å½•ã€‚</span></span><br><span class=\"line\">db.collection.find().skip(16).<span class=\"built_in\">limit</span>(8)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥è¯¢è®°å½•æ•°</span></span><br><span class=\"line\">db.collection.countDocuments()</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-4\">\n<p>query ï¼šå¯é€‰ï¼Œä½¿ç”¨æŸ¥è¯¢æ“ä½œç¬¦æŒ‡å®šæŸ¥è¯¢æ¡ä»¶</p>\n</li>\n<li class=\"lvl-4\">\n<p>projection ï¼šå¯é€‰ï¼Œä½¿ç”¨æŠ•å½±æ“ä½œç¬¦æŒ‡å®šè¿”å›çš„é”®ã€‚æŸ¥è¯¢æ—¶è¿”å›æ–‡æ¡£ä¸­æ‰€æœ‰é”®å€¼ï¼Œ åªéœ€çœç•¥è¯¥å‚æ•°å³å¯ï¼ˆé»˜è®¤çœç•¥ï¼‰ã€‚æŠ•å½±æ—¶ï¼Œ_idä¸º1çš„æ—¶å€™ï¼Œå…¶ä»–å­—æ®µå¿…é¡»æ˜¯1ï¼›_idæ˜¯0çš„æ—¶å€™ï¼Œå…¶ä»–å­—æ®µå¯ä»¥æ˜¯0ï¼›å¦‚æœæ²¡æœ‰_idå­—æ®µçº¦æŸï¼Œå¤šä¸ªå…¶ä»–å­—æ®µå¿…é¡»åŒä¸º0æˆ–åŒä¸º1ã€‚</p>\n</li>\n</ul>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æŸ¥è¯¢æ“ä½œç¬¦</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>æ“ä½œç¬¦</th>\n<th>è§£é‡Š</th>\n<th>ç¤ºä¾‹</th>\n<th>ç¤ºä¾‹è§£é‡Š</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>$lt</code></td>\n<td>å°äº</td>\n<td><code>db.collection.find(&#123; &quot;age&quot;: &#123; &quot;$lt&quot;: 25 &#125; &#125;)</code></td>\n<td>æŸ¥è¯¢å¹´é¾„å°äº 25 çš„æ–‡æ¡£</td>\n</tr>\n<tr>\n<td><code>$lte</code></td>\n<td>å°äºç­‰äº</td>\n<td><code>db.collection.find(&#123; &quot;age&quot;: &#123; &quot;$lte&quot;: 25 &#125; &#125;)</code></td>\n<td>æŸ¥è¯¢å¹´é¾„å°äºç­‰äº 25 çš„æ–‡æ¡£</td>\n</tr>\n<tr>\n<td><code>$gt</code></td>\n<td>å¤§äº</td>\n<td><code>db.collection.find(&#123; &quot;age&quot;: &#123; &quot;$gt&quot;: 25 &#125; &#125;)</code></td>\n<td>æŸ¥è¯¢å¹´é¾„å¤§äº 25 çš„æ–‡æ¡£</td>\n</tr>\n<tr>\n<td><code>$gte</code></td>\n<td>å¤§äºç­‰äº</td>\n<td><code>db.collection.find(&#123; &quot;age&quot;: &#123; &quot;$gte&quot;: 25 &#125; &#125;)</code></td>\n<td>æŸ¥è¯¢å¹´é¾„å¤§äºç­‰äº 25 çš„æ–‡æ¡£</td>\n</tr>\n<tr>\n<td><code>$ne</code></td>\n<td>ä¸ç­‰äº</td>\n<td><code>db.collection.find(&#123; &quot;age&quot;: &#123; &quot;$ne&quot;: 25 &#125; &#125;)</code></td>\n<td>æŸ¥è¯¢å¹´é¾„ä¸ç­‰äº 25 çš„æ–‡æ¡£</td>\n</tr>\n<tr>\n<td><code>$in</code></td>\n<td>åœ¨æŒ‡å®šæ•°ç»„ä¸­</td>\n<td><code>db.collection.find(&#123; &quot;age&quot;: &#123; &quot;$in&quot;: [20, 25] &#125; &#125;)</code></td>\n<td>æŸ¥è¯¢å¹´é¾„å­˜åœ¨å¹¶ä¸”åœ¨æŒ‡å®šæ•°ç»„ä¸­çš„æ–‡æ¡£</td>\n</tr>\n<tr>\n<td><code>$nin</code></td>\n<td>ä¸åœ¨æŒ‡å®šæ•°ç»„ä¸­</td>\n<td><code>db.collection.find(&#123; &quot;age&quot;: &#123; &quot;$nin&quot;: [20, 25] &#125; &#125;)</code></td>\n<td>æŸ¥è¯¢å¹´é¾„ä¸å­˜åœ¨æˆ–è€…ä¸åœ¨æŒ‡å®šæ•°ç»„ä¸­çš„æ–‡æ¡£</td>\n</tr>\n<tr>\n<td><code>$or</code></td>\n<td>åŒ¹é…ä¸¤ä¸ªæˆ–å¤šä¸ªæ¡ä»¶ä¸­çš„ä¸€ä¸ª</td>\n<td><code>db.collection.find(&#123; &quot;$or&quot;: [ &#123; &quot;age&quot;: 20 &#125;, &#123; &quot;salary&quot;: &#123; &quot;$gt&quot;: 8000 &#125; &#125; ] &#125;)</code></td>\n<td>æŸ¥è¯¢å¹´é¾„ä¸º 20 æˆ–è€…è–ªèµ„å¤§äº 8000 çš„æ–‡æ¡£</td>\n</tr>\n<tr>\n<td><code>$and</code></td>\n<td>åŒ¹é…å…¨éƒ¨æ¡ä»¶</td>\n<td><code>db.collection.find(&#123; &quot;$and&quot;: [ &#123; &quot;age&quot;: 20 &#125;, &#123; &quot;salary&quot;: &#123; &quot;$gt&quot;: 8000 &#125; &#125; ] &#125;)</code></td>\n<td>æŸ¥è¯¢å¹´é¾„ä¸º 20 å¹¶ä¸”è–ªèµ„å¤§äº 8000 çš„æ–‡æ¡£</td>\n</tr>\n<tr>\n<td><code>$all</code></td>\n<td>åŒ¹é…æ•°ç»„ä¸­æ‰€æœ‰å…ƒç´ æ»¡è¶³æŒ‡å®šæ¡ä»¶</td>\n<td><code>db.collection.find(&#123; &quot;tags&quot;: &#123; &quot;$all&quot;: [ &#123; &quot;$elemMatch&quot;: &#123; &quot;tagKey&quot;: &quot;color&quot;, &quot;tagValue&quot;: &quot;red&quot; &#125; &#125;, &#123; &quot;$elemMatch&quot;: &#123; &quot;tagKey&quot;: &quot;size&quot;, &quot;tagValue&quot;: &quot;XL&quot; &#125; &#125; ] &#125; &#125;)</code></td>\n<td>æŸ¥è¯¢åŒ…å« tagKey ä¸º â€œcolorâ€ï¼ŒtagValue ä¸º â€œredâ€ çš„æ ‡ç­¾ï¼Œå¹¶ä¸”åŒ…å« tagKey ä¸º â€œsizeâ€ï¼ŒtagValue ä¸º â€œXLâ€ çš„æ ‡ç­¾çš„æ–‡æ¡£</td>\n</tr>\n<tr>\n<td><code>$elemMatch</code></td>\n<td>åŒ¹é…æ•°ç»„ä¸­è‡³å°‘ä¸€ä¸ªå…ƒç´ æ»¡è¶³æŒ‡å®šæ¡ä»¶</td>\n<td><code>db.collection.find(&#123; &quot;tags&quot;: &#123; &quot;$elemMatch&quot;: &#123; &quot;tagKey&quot;: &quot;color&quot;, &quot;tagValue&quot;: &quot;blue&quot; &#125; &#125; &#125;)</code></td>\n<td>æŸ¥è¯¢åŒ…å« tagKey ä¸º â€œcolorâ€ï¼ŒtagValue åŒ…å« â€œblueâ€ çš„æ ‡ç­¾çš„æ–‡æ¡£</td>\n</tr>\n<tr>\n<td><code>$text</code></td>\n<td>å…¨æ–‡æœç´¢</td>\n<td><code>db.collection.find(&#123; &quot;$text&quot;: &#123; &quot;$search&quot;: &quot;searchTerm&quot; &#125; &#125;)</code></td>\n<td>è¿›è¡Œå…¨æ–‡æœç´¢ï¼ŒæŸ¥æ‰¾åŒ…å« â€œsearchTermâ€ çš„æ–‡æ¡£</td>\n</tr>\n<tr>\n<td><code>$type</code></td>\n<td>æŒ‡å®šå­—æ®µç±»å‹</td>\n<td><code>db.collection.find(&#123; &quot;field&quot;: &#123; &quot;$type&quot;: &quot;string&quot; &#125; &#125;)</code></td>\n<td>æŸ¥è¯¢æŒ‡å®šå­—æ®µç±»å‹ä¸ºå­—ç¬¦ä¸²çš„æ–‡æ¡£</td>\n</tr>\n<tr>\n<td><code>$size</code></td>\n<td>æ•°ç»„é•¿åº¦</td>\n<td><code>db.collection.find(&#123; &quot;field&quot;: &#123; &quot;$size&quot;: sizeValue &#125; &#125;)</code></td>\n<td>æŸ¥è¯¢æŒ‡å®šå­—æ®µæ•°ç»„é•¿åº¦ä¸º sizeValue çš„æ–‡æ¡£</td>\n</tr>\n<tr>\n<td><code>$exists</code></td>\n<td>å­—æ®µå­˜åœ¨</td>\n<td><code>db.collection.find(&#123; &quot;field&quot;: &#123; &quot;$exists&quot;: true &#125; &#125;)</code></td>\n<td>æŸ¥è¯¢æŒ‡å®šå­—æ®µå­˜åœ¨çš„æ–‡æ¡£</td>\n</tr>\n<tr>\n<td><code>$mod</code></td>\n<td>å–æ¨¡</td>\n<td><code>db.collection.find(&#123; &quot;field&quot;: &#123; &quot;$mod&quot;: [divisor, remainder] &#125; &#125;)</code></td>\n<td>æŸ¥è¯¢æŒ‡å®šå­—æ®µå–æ¨¡åç¬¦åˆç»™å®šé™¤æ•°å’Œä½™æ•°çš„æ–‡æ¡£</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"SpringBootä»£ç ç¤ºä¾‹\">SpringBootä»£ç ç¤ºä¾‹</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ“ä½œ<code>org.bson.Document</code>å¯¹è±¡ï¼Œæ— éœ€åˆ›å»ºå®ä½“æ˜ å°„å¯¹è±¡ï¼Œä½†æ“ä½œæ—¶éœ€è¦æŒ‡å®šé›†åˆåç§°</p>\n</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br><span class=\"line\">222</span><br><span class=\"line\">223</span><br><span class=\"line\">224</span><br><span class=\"line\">225</span><br><span class=\"line\">226</span><br><span class=\"line\">227</span><br><span class=\"line\">228</span><br><span class=\"line\">229</span><br><span class=\"line\">230</span><br><span class=\"line\">231</span><br><span class=\"line\">232</span><br><span class=\"line\">233</span><br><span class=\"line\">234</span><br><span class=\"line\">235</span><br><span class=\"line\">236</span><br><span class=\"line\">237</span><br><span class=\"line\">238</span><br><span class=\"line\">239</span><br><span class=\"line\">240</span><br><span class=\"line\">241</span><br><span class=\"line\">242</span><br><span class=\"line\">243</span><br><span class=\"line\">244</span><br><span class=\"line\">245</span><br><span class=\"line\">246</span><br><span class=\"line\">247</span><br><span class=\"line\">248</span><br><span class=\"line\">249</span><br><span class=\"line\">250</span><br><span class=\"line\">251</span><br><span class=\"line\">252</span><br><span class=\"line\">253</span><br><span class=\"line\">254</span><br><span class=\"line\">255</span><br><span class=\"line\">256</span><br><span class=\"line\">257</span><br><span class=\"line\">258</span><br><span class=\"line\">259</span><br><span class=\"line\">260</span><br><span class=\"line\">261</span><br><span class=\"line\">262</span><br><span class=\"line\">263</span><br><span class=\"line\">264</span><br><span class=\"line\">265</span><br><span class=\"line\">266</span><br><span class=\"line\">267</span><br><span class=\"line\">268</span><br><span class=\"line\">269</span><br><span class=\"line\">270</span><br><span class=\"line\">271</span><br><span class=\"line\">272</span><br><span class=\"line\">273</span><br><span class=\"line\">274</span><br><span class=\"line\">275</span><br><span class=\"line\">276</span><br><span class=\"line\">277</span><br><span class=\"line\">278</span><br><span class=\"line\">279</span><br><span class=\"line\">280</span><br><span class=\"line\">281</span><br><span class=\"line\">282</span><br><span class=\"line\">283</span><br><span class=\"line\">284</span><br><span class=\"line\">285</span><br><span class=\"line\">286</span><br><span class=\"line\">287</span><br><span class=\"line\">288</span><br><span class=\"line\">289</span><br><span class=\"line\">290</span><br><span class=\"line\">291</span><br><span class=\"line\">292</span><br><span class=\"line\">293</span><br><span class=\"line\">294</span><br><span class=\"line\">295</span><br><span class=\"line\">296</span><br><span class=\"line\">297</span><br><span class=\"line\">298</span><br><span class=\"line\">299</span><br><span class=\"line\">300</span><br><span class=\"line\">301</span><br><span class=\"line\">302</span><br><span class=\"line\">303</span><br><span class=\"line\">304</span><br><span class=\"line\">305</span><br><span class=\"line\">306</span><br><span class=\"line\">307</span><br><span class=\"line\">308</span><br><span class=\"line\">309</span><br><span class=\"line\">310</span><br><span class=\"line\">311</span><br><span class=\"line\">312</span><br><span class=\"line\">313</span><br><span class=\"line\">314</span><br><span class=\"line\">315</span><br><span class=\"line\">316</span><br><span class=\"line\">317</span><br><span class=\"line\">318</span><br><span class=\"line\">319</span><br><span class=\"line\">320</span><br><span class=\"line\">321</span><br><span class=\"line\">322</span><br><span class=\"line\">323</span><br><span class=\"line\">324</span><br><span class=\"line\">325</span><br><span class=\"line\">326</span><br><span class=\"line\">327</span><br><span class=\"line\">328</span><br><span class=\"line\">329</span><br><span class=\"line\">330</span><br><span class=\"line\">331</span><br><span class=\"line\">332</span><br><span class=\"line\">333</span><br><span class=\"line\">334</span><br><span class=\"line\">335</span><br><span class=\"line\">336</span><br><span class=\"line\">337</span><br><span class=\"line\">338</span><br><span class=\"line\">339</span><br><span class=\"line\">340</span><br><span class=\"line\">341</span><br><span class=\"line\">342</span><br><span class=\"line\">343</span><br><span class=\"line\">344</span><br><span class=\"line\">345</span><br><span class=\"line\">346</span><br><span class=\"line\">347</span><br><span class=\"line\">348</span><br><span class=\"line\">349</span><br><span class=\"line\">350</span><br><span class=\"line\">351</span><br><span class=\"line\">352</span><br><span class=\"line\">353</span><br><span class=\"line\">354</span><br><span class=\"line\">355</span><br><span class=\"line\">356</span><br><span class=\"line\">357</span><br><span class=\"line\">358</span><br><span class=\"line\">359</span><br><span class=\"line\">360</span><br><span class=\"line\">361</span><br><span class=\"line\">362</span><br><span class=\"line\">363</span><br><span class=\"line\">364</span><br><span class=\"line\">365</span><br><span class=\"line\">366</span><br><span class=\"line\">367</span><br><span class=\"line\">368</span><br><span class=\"line\">369</span><br><span class=\"line\">370</span><br><span class=\"line\">371</span><br><span class=\"line\">372</span><br><span class=\"line\">373</span><br><span class=\"line\">374</span><br><span class=\"line\">375</span><br><span class=\"line\">376</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.hanqf;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> org.bson.Document;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.junit.jupiter.api.Test;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.boot.test.context.SpringBootTest;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.mongodb.core.MongoTemplate;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.mongodb.core.query.BasicQuery;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.mongodb.core.query.Criteria;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.mongodb.core.query.Query;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Arrays;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.List;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Map;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@SpringBootTest</span></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">BasicTests</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> MongoTemplate mongoTemplate;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">    // åˆå§‹åŒ–æ•°æ®</span></span><br><span class=\"line\"><span class=\"comment\">    db.collection.insertMany([</span></span><br><span class=\"line\"><span class=\"comment\">        &#123;</span></span><br><span class=\"line\"><span class=\"comment\">            &quot;name&quot;: &quot;item1&quot;,</span></span><br><span class=\"line\"><span class=\"comment\">            &quot;age&quot;: 20,</span></span><br><span class=\"line\"><span class=\"comment\">            &quot;salary&quot;: 5000,</span></span><br><span class=\"line\"><span class=\"comment\">            &quot;colors&quot;: [&quot;red&quot;, &quot;blue&quot;, &quot;green&quot;],</span></span><br><span class=\"line\"><span class=\"comment\">            &quot;sizes&quot;: [&quot;S&quot;, &quot;M&quot;, &quot;L&quot;],</span></span><br><span class=\"line\"><span class=\"comment\">            &quot;tags&quot;: [</span></span><br><span class=\"line\"><span class=\"comment\">                &#123; &quot;tagKey&quot;: &quot;color&quot;, &quot;tagValue&quot;: &quot;red&quot; &#125;,</span></span><br><span class=\"line\"><span class=\"comment\">                &#123; &quot;tagKey&quot;: &quot;size&quot;, &quot;tagValue&quot;: &quot;M&quot; &#125;,</span></span><br><span class=\"line\"><span class=\"comment\">                &#123; &quot;tagKey&quot;: &quot;style&quot;, &quot;tagValue&quot;: &quot;casual&quot; &#125;</span></span><br><span class=\"line\"><span class=\"comment\">            ]</span></span><br><span class=\"line\"><span class=\"comment\">        &#125;,</span></span><br><span class=\"line\"><span class=\"comment\">        &#123;</span></span><br><span class=\"line\"><span class=\"comment\">            &quot;name&quot;: &quot;item2&quot;,</span></span><br><span class=\"line\"><span class=\"comment\">            &quot;age&quot;: 30,</span></span><br><span class=\"line\"><span class=\"comment\">            &quot;salary&quot;: 8000,</span></span><br><span class=\"line\"><span class=\"comment\">            &quot;colors&quot;: [&quot;green&quot;, &quot;yellow&quot;],</span></span><br><span class=\"line\"><span class=\"comment\">            &quot;sizes&quot;: [&quot;M&quot;, &quot;L&quot;, &quot;XL&quot;],</span></span><br><span class=\"line\"><span class=\"comment\">            &quot;tags&quot;: [</span></span><br><span class=\"line\"><span class=\"comment\">                &#123; &quot;tagKey&quot;: &quot;color&quot;, &quot;tagValue&quot;: &quot;blue&quot; &#125;,</span></span><br><span class=\"line\"><span class=\"comment\">                &#123; &quot;tagKey&quot;: &quot;size&quot;, &quot;tagValue&quot;: &quot;XL&quot; &#125;,</span></span><br><span class=\"line\"><span class=\"comment\">                &#123; &quot;tagKey&quot;: &quot;style&quot;, &quot;tagValue&quot;: &quot;formal&quot; &#125;</span></span><br><span class=\"line\"><span class=\"comment\">            ]</span></span><br><span class=\"line\"><span class=\"comment\">        &#125;,</span></span><br><span class=\"line\"><span class=\"comment\">        &#123;</span></span><br><span class=\"line\"><span class=\"comment\">            &quot;name&quot;: &quot;item3&quot;,</span></span><br><span class=\"line\"><span class=\"comment\">            &quot;age&quot;: 25,</span></span><br><span class=\"line\"><span class=\"comment\">            &quot;salary&quot;: 10000,</span></span><br><span class=\"line\"><span class=\"comment\">            &quot;colors&quot;: [&quot;red&quot;, &quot;green&quot;],</span></span><br><span class=\"line\"><span class=\"comment\">            &quot;sizes&quot;: [&quot;L&quot;, &quot;XL&quot;],</span></span><br><span class=\"line\"><span class=\"comment\">            &quot;tags&quot;: [</span></span><br><span class=\"line\"><span class=\"comment\">                &#123; &quot;tagKey&quot;: &quot;color&quot;, &quot;tagValue&quot;: &quot;green&quot; &#125;,</span></span><br><span class=\"line\"><span class=\"comment\">                &#123; &quot;tagKey&quot;: &quot;size&quot;, &quot;tagValue&quot;: &quot;L&quot; &#125;,</span></span><br><span class=\"line\"><span class=\"comment\">                &#123; &quot;tagKey&quot;: &quot;style&quot;, &quot;tagValue&quot;: &quot;casual&quot; &#125;</span></span><br><span class=\"line\"><span class=\"comment\">            ]</span></span><br><span class=\"line\"><span class=\"comment\">        &#125;</span></span><br><span class=\"line\"><span class=\"comment\">    ]);</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Test</span></span><br><span class=\"line\">    <span class=\"keyword\">void</span> <span class=\"title function_\">initializeData</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        List&lt;Document&gt; documents = Arrays.asList(</span><br><span class=\"line\">                <span class=\"comment\">// æ–‡æ¡£1</span></span><br><span class=\"line\">                <span class=\"keyword\">new</span> <span class=\"title class_\">Document</span>().append(<span class=\"string\">&quot;name&quot;</span>, <span class=\"string\">&quot;item1&quot;</span>)</span><br><span class=\"line\">                        .append(<span class=\"string\">&quot;age&quot;</span>, <span class=\"number\">20</span>)</span><br><span class=\"line\">                        .append(<span class=\"string\">&quot;salary&quot;</span>, <span class=\"number\">5000</span>)</span><br><span class=\"line\">                        .append(<span class=\"string\">&quot;colors&quot;</span>, Arrays.asList(<span class=\"string\">&quot;red&quot;</span>, <span class=\"string\">&quot;blue&quot;</span>, <span class=\"string\">&quot;green&quot;</span>))</span><br><span class=\"line\">                        .append(<span class=\"string\">&quot;sizes&quot;</span>, Arrays.asList(<span class=\"string\">&quot;S&quot;</span>, <span class=\"string\">&quot;M&quot;</span>, <span class=\"string\">&quot;L&quot;</span>))</span><br><span class=\"line\">                        .append(<span class=\"string\">&quot;tags&quot;</span>, Arrays.asList(</span><br><span class=\"line\">                                <span class=\"keyword\">new</span> <span class=\"title class_\">Document</span>().append(<span class=\"string\">&quot;tagKey&quot;</span>, <span class=\"string\">&quot;color&quot;</span>)</span><br><span class=\"line\">                                        .append(<span class=\"string\">&quot;tagValue&quot;</span>, <span class=\"string\">&quot;red&quot;</span>),</span><br><span class=\"line\">                                <span class=\"keyword\">new</span> <span class=\"title class_\">Document</span>().append(<span class=\"string\">&quot;tagKey&quot;</span>, <span class=\"string\">&quot;size&quot;</span>)</span><br><span class=\"line\">                                        .append(<span class=\"string\">&quot;tagValue&quot;</span>, <span class=\"string\">&quot;M&quot;</span>),</span><br><span class=\"line\">                                <span class=\"keyword\">new</span> <span class=\"title class_\">Document</span>().append(<span class=\"string\">&quot;tagKey&quot;</span>, <span class=\"string\">&quot;style&quot;</span>)</span><br><span class=\"line\">                                        .append(<span class=\"string\">&quot;tagValue&quot;</span>, <span class=\"string\">&quot;casual&quot;</span>)</span><br><span class=\"line\">                        )),</span><br><span class=\"line\">                <span class=\"comment\">// æ–‡æ¡£2</span></span><br><span class=\"line\">                <span class=\"keyword\">new</span> <span class=\"title class_\">Document</span>().append(<span class=\"string\">&quot;name&quot;</span>, <span class=\"string\">&quot;item2&quot;</span>)</span><br><span class=\"line\">                        .append(<span class=\"string\">&quot;age&quot;</span>, <span class=\"number\">30</span>)</span><br><span class=\"line\">                        .append(<span class=\"string\">&quot;salary&quot;</span>, <span class=\"number\">8000</span>)</span><br><span class=\"line\">                        .append(<span class=\"string\">&quot;colors&quot;</span>, Arrays.asList(<span class=\"string\">&quot;green&quot;</span>, <span class=\"string\">&quot;yellow&quot;</span>))</span><br><span class=\"line\">                        .append(<span class=\"string\">&quot;sizes&quot;</span>, Arrays.asList(<span class=\"string\">&quot;M&quot;</span>, <span class=\"string\">&quot;L&quot;</span>, <span class=\"string\">&quot;XL&quot;</span>))</span><br><span class=\"line\">                        .append(<span class=\"string\">&quot;tags&quot;</span>, Arrays.asList(</span><br><span class=\"line\">                                <span class=\"keyword\">new</span> <span class=\"title class_\">Document</span>().append(<span class=\"string\">&quot;tagKey&quot;</span>, <span class=\"string\">&quot;color&quot;</span>)</span><br><span class=\"line\">                                        .append(<span class=\"string\">&quot;tagValue&quot;</span>, <span class=\"string\">&quot;blue&quot;</span>),</span><br><span class=\"line\">                                <span class=\"keyword\">new</span> <span class=\"title class_\">Document</span>().append(<span class=\"string\">&quot;tagKey&quot;</span>, <span class=\"string\">&quot;size&quot;</span>)</span><br><span class=\"line\">                                        .append(<span class=\"string\">&quot;tagValue&quot;</span>, <span class=\"string\">&quot;XL&quot;</span>),</span><br><span class=\"line\">                                <span class=\"keyword\">new</span> <span class=\"title class_\">Document</span>().append(<span class=\"string\">&quot;tagKey&quot;</span>, <span class=\"string\">&quot;style&quot;</span>)</span><br><span class=\"line\">                                        .append(<span class=\"string\">&quot;tagValue&quot;</span>, <span class=\"string\">&quot;formal&quot;</span>)</span><br><span class=\"line\">                        )),</span><br><span class=\"line\">                <span class=\"comment\">// æ–‡æ¡£3</span></span><br><span class=\"line\">                <span class=\"keyword\">new</span> <span class=\"title class_\">Document</span>().append(<span class=\"string\">&quot;name&quot;</span>, <span class=\"string\">&quot;item3&quot;</span>)</span><br><span class=\"line\">                        .append(<span class=\"string\">&quot;age&quot;</span>, <span class=\"number\">25</span>)</span><br><span class=\"line\">                        .append(<span class=\"string\">&quot;salary&quot;</span>, <span class=\"number\">10000</span>)</span><br><span class=\"line\">                        .append(<span class=\"string\">&quot;colors&quot;</span>, Arrays.asList(<span class=\"string\">&quot;red&quot;</span>, <span class=\"string\">&quot;green&quot;</span>))</span><br><span class=\"line\">                        .append(<span class=\"string\">&quot;sizes&quot;</span>, Arrays.asList(<span class=\"string\">&quot;L&quot;</span>, <span class=\"string\">&quot;XL&quot;</span>))</span><br><span class=\"line\">                        .append(<span class=\"string\">&quot;tags&quot;</span>, Arrays.asList(</span><br><span class=\"line\">                                <span class=\"keyword\">new</span> <span class=\"title class_\">Document</span>().append(<span class=\"string\">&quot;tagKey&quot;</span>, <span class=\"string\">&quot;color&quot;</span>)</span><br><span class=\"line\">                                        .append(<span class=\"string\">&quot;tagValue&quot;</span>, <span class=\"string\">&quot;green&quot;</span>),</span><br><span class=\"line\">                                <span class=\"keyword\">new</span> <span class=\"title class_\">Document</span>().append(<span class=\"string\">&quot;tagKey&quot;</span>, <span class=\"string\">&quot;size&quot;</span>)</span><br><span class=\"line\">                                        .append(<span class=\"string\">&quot;tagValue&quot;</span>, <span class=\"string\">&quot;L&quot;</span>),</span><br><span class=\"line\">                                <span class=\"keyword\">new</span> <span class=\"title class_\">Document</span>().append(<span class=\"string\">&quot;tagKey&quot;</span>, <span class=\"string\">&quot;style&quot;</span>)</span><br><span class=\"line\">                                        .append(<span class=\"string\">&quot;tagValue&quot;</span>, <span class=\"string\">&quot;casual&quot;</span>)</span><br><span class=\"line\">                        ))</span><br><span class=\"line\">        );</span><br><span class=\"line\">        <span class=\"comment\">// è¿™é‡Œè¦æŒ‡å®šé›†åˆåç§°</span></span><br><span class=\"line\">        mongoTemplate.insert(documents, <span class=\"string\">&quot;collection&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * ä¹Ÿå¯ä»¥é€šè¿‡jsonæ¥æ„å»ºDocumentå¯¹è±¡</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Test</span></span><br><span class=\"line\">    <span class=\"keyword\">void</span> <span class=\"title function_\">initializeData2</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        List&lt;String&gt; jsonList = <span class=\"keyword\">new</span> <span class=\"title class_\">ArrayList</span>&lt;&gt;();</span><br><span class=\"line\">        jsonList.add(<span class=\"string\">&quot;&quot;&quot;</span></span><br><span class=\"line\"><span class=\"string\">                &#123;</span></span><br><span class=\"line\"><span class=\"string\">                    &quot;name&quot;: &quot;item1&quot;,</span></span><br><span class=\"line\"><span class=\"string\">                    &quot;age&quot;: 20,</span></span><br><span class=\"line\"><span class=\"string\">                    &quot;salary&quot;: 5000,</span></span><br><span class=\"line\"><span class=\"string\">                    &quot;colors&quot;: [&quot;red&quot;, &quot;blue&quot;, &quot;green&quot;],</span></span><br><span class=\"line\"><span class=\"string\">                    &quot;sizes&quot;: [&quot;S&quot;, &quot;M&quot;, &quot;L&quot;],</span></span><br><span class=\"line\"><span class=\"string\">                    &quot;tags&quot;: [</span></span><br><span class=\"line\"><span class=\"string\">                        &#123; &quot;tagKey&quot;: &quot;color&quot;, &quot;tagValue&quot;: &quot;red&quot; &#125;,</span></span><br><span class=\"line\"><span class=\"string\">                        &#123; &quot;tagKey&quot;: &quot;size&quot;, &quot;tagValue&quot;: &quot;M&quot; &#125;,</span></span><br><span class=\"line\"><span class=\"string\">                        &#123; &quot;tagKey&quot;: &quot;style&quot;, &quot;tagValue&quot;: &quot;casual&quot; &#125;</span></span><br><span class=\"line\"><span class=\"string\">                    ]</span></span><br><span class=\"line\"><span class=\"string\">                &#125;</span></span><br><span class=\"line\"><span class=\"string\">                &quot;&quot;&quot;</span>);</span><br><span class=\"line\">        jsonList.add(<span class=\"string\">&quot;&quot;&quot;</span></span><br><span class=\"line\"><span class=\"string\">                &#123;</span></span><br><span class=\"line\"><span class=\"string\">                    &quot;name&quot;: &quot;item2&quot;,</span></span><br><span class=\"line\"><span class=\"string\">                    &quot;age&quot;: 30,</span></span><br><span class=\"line\"><span class=\"string\">                    &quot;salary&quot;: 8000,</span></span><br><span class=\"line\"><span class=\"string\">                    &quot;colors&quot;: [&quot;green&quot;, &quot;yellow&quot;],</span></span><br><span class=\"line\"><span class=\"string\">                    &quot;sizes&quot;: [&quot;M&quot;, &quot;L&quot;, &quot;XL&quot;],</span></span><br><span class=\"line\"><span class=\"string\">                    &quot;tags&quot;: [</span></span><br><span class=\"line\"><span class=\"string\">                        &#123; &quot;tagKey&quot;: &quot;color&quot;, &quot;tagValue&quot;: &quot;blue&quot; &#125;,</span></span><br><span class=\"line\"><span class=\"string\">                        &#123; &quot;tagKey&quot;: &quot;size&quot;, &quot;tagValue&quot;: &quot;XL&quot; &#125;,</span></span><br><span class=\"line\"><span class=\"string\">                        &#123; &quot;tagKey&quot;: &quot;style&quot;, &quot;tagValue&quot;: &quot;formal&quot; &#125;</span></span><br><span class=\"line\"><span class=\"string\">                    ]</span></span><br><span class=\"line\"><span class=\"string\">                &#125;</span></span><br><span class=\"line\"><span class=\"string\">                &quot;&quot;&quot;</span>);</span><br><span class=\"line\">        jsonList.add(<span class=\"string\">&quot;&quot;&quot;</span></span><br><span class=\"line\"><span class=\"string\">                &#123;</span></span><br><span class=\"line\"><span class=\"string\">                    &quot;name&quot;: &quot;item3&quot;,</span></span><br><span class=\"line\"><span class=\"string\">                    &quot;age&quot;: 25,</span></span><br><span class=\"line\"><span class=\"string\">                    &quot;salary&quot;: 10000,</span></span><br><span class=\"line\"><span class=\"string\">                    &quot;colors&quot;: [&quot;red&quot;, &quot;green&quot;],</span></span><br><span class=\"line\"><span class=\"string\">                    &quot;sizes&quot;: [&quot;L&quot;, &quot;XL&quot;],</span></span><br><span class=\"line\"><span class=\"string\">                    &quot;tags&quot;: [</span></span><br><span class=\"line\"><span class=\"string\">                        &#123; &quot;tagKey&quot;: &quot;color&quot;, &quot;tagValue&quot;: &quot;green&quot; &#125;,</span></span><br><span class=\"line\"><span class=\"string\">                        &#123; &quot;tagKey&quot;: &quot;size&quot;, &quot;tagValue&quot;: &quot;L&quot; &#125;,</span></span><br><span class=\"line\"><span class=\"string\">                        &#123; &quot;tagKey&quot;: &quot;style&quot;, &quot;tagValue&quot;: &quot;casual&quot; &#125;</span></span><br><span class=\"line\"><span class=\"string\">                    ]</span></span><br><span class=\"line\"><span class=\"string\">                &#125;</span></span><br><span class=\"line\"><span class=\"string\">                &quot;&quot;&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        List&lt;Document&gt; documents = <span class=\"keyword\">new</span> <span class=\"title class_\">ArrayList</span>&lt;&gt;();</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (String json : jsonList) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// é€šè¿‡Document.parse()æ–¹æ³•å°†jsonå­—ç¬¦ä¸²è½¬æ¢ä¸ºDocumentå¯¹è±¡</span></span><br><span class=\"line\">            documents.add(Document.parse(json));</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        mongoTemplate.insert(documents, <span class=\"string\">&quot;collection&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Test</span></span><br><span class=\"line\">    <span class=\"keyword\">void</span> <span class=\"title function_\">testQueries</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">QueryExecutor</span> <span class=\"variable\">queryExecutor</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">QueryExecutor</span>(mongoTemplate);</span><br><span class=\"line\">        <span class=\"comment\">// db.collection.find(&#123; &quot;age&quot;: &#123; &quot;$lt&quot;: 25 &#125; &#125;)</span></span><br><span class=\"line\">        printResult(<span class=\"string\">&quot;findAgeLessThan25&quot;</span>, queryExecutor.findAgeLessThan25());</span><br><span class=\"line\">        <span class=\"comment\">// db.collection.find(&#123; &quot;age&quot;: &#123; &quot;$lte&quot;: 25 &#125; &#125;)</span></span><br><span class=\"line\">        printResult(<span class=\"string\">&quot;findAgeLessThanOrEqualTo25&quot;</span>, queryExecutor.findAgeLessThanOrEqualTo25());</span><br><span class=\"line\">        <span class=\"comment\">// db.collection.find(&#123; &quot;age&quot;: &#123; &quot;$gt&quot;: 25 &#125; &#125;)</span></span><br><span class=\"line\">        printResult(<span class=\"string\">&quot;findAgeGreaterThan25&quot;</span>, queryExecutor.findAgeGreaterThan25());</span><br><span class=\"line\">        <span class=\"comment\">// db.collection.find(&#123; &quot;age&quot;: &#123; &quot;$gte&quot;: 25 &#125; &#125;)</span></span><br><span class=\"line\">        printResult(<span class=\"string\">&quot;findAgeGreaterThanOrEqualTo25&quot;</span>, queryExecutor.findAgeGreaterThanOrEqualTo25());</span><br><span class=\"line\">        <span class=\"comment\">// db.collection.find(&#123; &quot;age&quot;: &#123; &quot;$ne&quot;: 25 &#125; &#125;)</span></span><br><span class=\"line\">        printResult(<span class=\"string\">&quot;findAgeNotEqualTo25&quot;</span>, queryExecutor.findAgeNotEqualTo25());</span><br><span class=\"line\">        <span class=\"comment\">// db.collection.find(&#123; &quot;age&quot;: &#123; &quot;$in&quot;: [20, 25] &#125; &#125;)</span></span><br><span class=\"line\">        printResult(<span class=\"string\">&quot;findAgeInArray&quot;</span>, queryExecutor.findAgeInArray(List.of(<span class=\"number\">20</span>, <span class=\"number\">25</span>)));</span><br><span class=\"line\">        <span class=\"comment\">// db.collection.find(&#123; &quot;age&quot;: &#123; &quot;$nin&quot;: [20, 25] &#125; &#125;)</span></span><br><span class=\"line\">        printResult(<span class=\"string\">&quot;findAgeNotInArray&quot;</span>, queryExecutor.findAgeNotInArray(List.of(<span class=\"number\">20</span>, <span class=\"number\">25</span>)));</span><br><span class=\"line\">        <span class=\"comment\">// db.collection.find(&#123; &quot;$or&quot;: [ &#123; &quot;age&quot;: 20 &#125;, &#123; &quot;salary&quot;: &#123; &quot;$gt&quot;: 8000 &#125; &#125; ] &#125;)</span></span><br><span class=\"line\">        printResult(<span class=\"string\">&quot;findAgeOrSalary&quot;</span>, queryExecutor.findAgeOrSalary());</span><br><span class=\"line\">        <span class=\"comment\">// db.collection.find(&#123; &quot;$and&quot;: [ &#123; &quot;age&quot;: 20 &#125;, &#123; &quot;salary&quot;: &#123; &quot;$gt&quot;: 8000 &#125; &#125; ] &#125;)</span></span><br><span class=\"line\">        printResult(<span class=\"string\">&quot;findAgeAndSalary&quot;</span>, queryExecutor.findAgeAndSalary());</span><br><span class=\"line\">        <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">        db.collection.find(&#123; &quot;tags&quot;: &#123; &quot;$all&quot;: [</span></span><br><span class=\"line\"><span class=\"comment\">            &#123; &quot;$elemMatch&quot;: &#123; &quot;tagKey&quot;: &quot;color&quot;, &quot;tagValue&quot;: &quot;red&quot; &#125; &#125;,</span></span><br><span class=\"line\"><span class=\"comment\">            &#123; &quot;$elemMatch&quot;: &#123; &quot;tagKey&quot;: &quot;size&quot;, &quot;tagValue&quot;: &quot;XL&quot; &#125; &#125;</span></span><br><span class=\"line\"><span class=\"comment\">        ]&#125;&#125;)</span></span><br><span class=\"line\"><span class=\"comment\">         */</span></span><br><span class=\"line\">        printResult(<span class=\"string\">&quot;findTagsWithColorAndSize&quot;</span>, queryExecutor.findTagsWithColorAndSize());</span><br><span class=\"line\">        <span class=\"comment\">// db.collection.find(&#123; &quot;tags&quot;: &#123; &quot;$elemMatch&quot;: &#123; &quot;tagKey&quot;: &quot;color&quot;, &quot;tagValue&quot;: /blue/ &#125; &#125; &#125;)</span></span><br><span class=\"line\">        printResult(<span class=\"string\">&quot;findTagsWithColorContainingBlue&quot;</span>, queryExecutor.findTagsWithColorContainingBlue());</span><br><span class=\"line\">        <span class=\"comment\">// db.collection.find(&#123; &quot;tags.tagKey&quot;: &quot;color&quot; &#125;)</span></span><br><span class=\"line\">        printResult(<span class=\"string\">&quot;findTagsWithColor&quot;</span>, queryExecutor.findTagsWithColor());</span><br><span class=\"line\">        <span class=\"comment\">// db.collection.find(&#123; &quot;tags&quot;: &#123; &quot;$size&quot;: 3 &#125; &#125;)</span></span><br><span class=\"line\">        printResult(<span class=\"string\">&quot;findDocumentWithTagsSizeThree&quot;</span>, queryExecutor.findDocumentWithTagsSizeThree());</span><br><span class=\"line\">        <span class=\"comment\">// db.collection.find(&#123; &quot;tags&quot;: &#123; &quot;$elemMatch&quot;: &#123; &quot;tagKey&quot;: &quot;color&quot;, &quot;tagValue&quot;: &quot;red&quot; &#125; &#125; &#125;)</span></span><br><span class=\"line\">        printResult(<span class=\"string\">&quot;findDocumentWithSpecificTag&quot;</span>, queryExecutor.findDocumentWithSpecificTag());</span><br><span class=\"line\">        <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">        db.collection.find(&#123; &quot;tags&quot;: &#123; &quot;$all&quot;: [</span></span><br><span class=\"line\"><span class=\"comment\">            &#123; &quot;$elemMatch&quot;: &#123; &quot;tagKey&quot;: &quot;color&quot;, &quot;tagValue&quot;: /green/ &#125; &#125;</span></span><br><span class=\"line\"><span class=\"comment\">        ]&#125;&#125;)</span></span><br><span class=\"line\"><span class=\"comment\">         */</span></span><br><span class=\"line\">        printResult(<span class=\"string\">&quot;findAllElementsWithSpecificTag&quot;</span>, queryExecutor.findAllElementsWithSpecificTag());</span><br><span class=\"line\">        printResult(<span class=\"string\">&quot;findAllElementsWithSpecificTagByJson&quot;</span>, queryExecutor.findAllElementsWithSpecificTagByJson());</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title function_\">printResult</span><span class=\"params\">(String queryName, List&lt;Document&gt; result)</span> &#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;Query: &quot;</span> + queryName + <span class=\"string\">&quot; ###################################################&quot;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (Document document : result) &#123;</span><br><span class=\"line\">            System.out.println(document);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        System.out.println();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">class</span> <span class=\"title class_\">QueryExecutor</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> MongoTemplate mongoTemplate;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"title function_\">QueryExecutor</span><span class=\"params\">(MongoTemplate mongoTemplate)</span> &#123;</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.mongoTemplate = mongoTemplate;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// æŸ¥è¯¢å¹´é¾„å°äº 25 çš„æ–‡æ¡£</span></span><br><span class=\"line\">        <span class=\"comment\">// db.collection.find(&#123; &quot;age&quot;: &#123; &quot;$lt&quot;: 25 &#125; &#125;)</span></span><br><span class=\"line\">        <span class=\"keyword\">public</span> List&lt;Document&gt; <span class=\"title function_\">findAgeLessThan25</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">            <span class=\"type\">Query</span> <span class=\"variable\">query</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Query</span>(Criteria.where(<span class=\"string\">&quot;age&quot;</span>).lt(<span class=\"number\">25</span>));</span><br><span class=\"line\">            System.out.println(query); <span class=\"comment\">// æ‰“å°å‡ºç”Ÿæˆçš„æŸ¥è¯¢å­—ç¬¦ä¸²</span></span><br><span class=\"line\">            <span class=\"keyword\">return</span> mongoTemplate.find(query, Document.class, <span class=\"string\">&quot;collection&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// æŸ¥è¯¢å¹´é¾„å°äºç­‰äº 25 çš„æ–‡æ¡£</span></span><br><span class=\"line\">        <span class=\"comment\">// db.collection.find(&#123; &quot;age&quot;: &#123; &quot;$lte&quot;: 25 &#125; &#125;)</span></span><br><span class=\"line\">        <span class=\"keyword\">public</span> List&lt;Document&gt; <span class=\"title function_\">findAgeLessThanOrEqualTo25</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">            <span class=\"type\">Query</span> <span class=\"variable\">query</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Query</span>(Criteria.where(<span class=\"string\">&quot;age&quot;</span>).lte(<span class=\"number\">25</span>));</span><br><span class=\"line\">            System.out.println(query); <span class=\"comment\">// æ‰“å°å‡ºç”Ÿæˆçš„æŸ¥è¯¢å­—ç¬¦ä¸²</span></span><br><span class=\"line\">            <span class=\"keyword\">return</span> mongoTemplate.find(query, Document.class, <span class=\"string\">&quot;collection&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// æŸ¥è¯¢å¹´é¾„å¤§äº 25 çš„æ–‡æ¡£</span></span><br><span class=\"line\">        <span class=\"comment\">// db.collection.find(&#123; &quot;age&quot;: &#123; &quot;$gt&quot;: 25 &#125; &#125;)</span></span><br><span class=\"line\">        <span class=\"keyword\">public</span> List&lt;Document&gt; <span class=\"title function_\">findAgeGreaterThan25</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">            <span class=\"type\">Query</span> <span class=\"variable\">query</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Query</span>(Criteria.where(<span class=\"string\">&quot;age&quot;</span>).gt(<span class=\"number\">25</span>));</span><br><span class=\"line\">            System.out.println(query); <span class=\"comment\">// æ‰“å°å‡ºç”Ÿæˆçš„æŸ¥è¯¢å­—ç¬¦ä¸²</span></span><br><span class=\"line\">            <span class=\"keyword\">return</span> mongoTemplate.find(query, Document.class, <span class=\"string\">&quot;collection&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// æŸ¥è¯¢å¹´é¾„å¤§äºç­‰äº 25 çš„æ–‡æ¡£</span></span><br><span class=\"line\">        <span class=\"comment\">// db.collection.find(&#123; &quot;age&quot;: &#123; &quot;$gte&quot;: 25 &#125; &#125;)</span></span><br><span class=\"line\">        <span class=\"keyword\">public</span> List&lt;Document&gt; <span class=\"title function_\">findAgeGreaterThanOrEqualTo25</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">            <span class=\"type\">Query</span> <span class=\"variable\">query</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Query</span>(Criteria.where(<span class=\"string\">&quot;age&quot;</span>).gte(<span class=\"number\">25</span>));</span><br><span class=\"line\">            System.out.println(query); <span class=\"comment\">// æ‰“å°å‡ºç”Ÿæˆçš„æŸ¥è¯¢å­—ç¬¦ä¸²</span></span><br><span class=\"line\">            <span class=\"keyword\">return</span> mongoTemplate.find(query, Document.class, <span class=\"string\">&quot;collection&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// æŸ¥è¯¢å¹´é¾„ä¸ç­‰äº 25 çš„æ–‡æ¡£</span></span><br><span class=\"line\">        <span class=\"comment\">// db.collection.find(&#123; &quot;age&quot;: &#123; &quot;$ne&quot;: 25 &#125; &#125;)</span></span><br><span class=\"line\">        <span class=\"keyword\">public</span> List&lt;Document&gt; <span class=\"title function_\">findAgeNotEqualTo25</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">            <span class=\"type\">Query</span> <span class=\"variable\">query</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Query</span>(Criteria.where(<span class=\"string\">&quot;age&quot;</span>).ne(<span class=\"number\">25</span>));</span><br><span class=\"line\">            System.out.println(query); <span class=\"comment\">// æ‰“å°å‡ºç”Ÿæˆçš„æŸ¥è¯¢å­—ç¬¦ä¸²</span></span><br><span class=\"line\">            <span class=\"keyword\">return</span> mongoTemplate.find(query, Document.class, <span class=\"string\">&quot;collection&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// æŸ¥è¯¢å¹´é¾„å­˜åœ¨å¹¶ä¸”åœ¨æŒ‡å®šæ•°ç»„ä¸­çš„æ–‡æ¡£</span></span><br><span class=\"line\">        <span class=\"comment\">// db.collection.find(&#123; &quot;age&quot;: &#123; &quot;$in&quot;: [20, 25] &#125; &#125;)</span></span><br><span class=\"line\">        <span class=\"keyword\">public</span> List&lt;Document&gt; <span class=\"title function_\">findAgeInArray</span><span class=\"params\">(List&lt;Integer&gt; ages)</span> &#123;</span><br><span class=\"line\">            <span class=\"type\">Query</span> <span class=\"variable\">query</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Query</span>(Criteria.where(<span class=\"string\">&quot;age&quot;</span>).in(ages));</span><br><span class=\"line\">            System.out.println(query); <span class=\"comment\">// æ‰“å°å‡ºç”Ÿæˆçš„æŸ¥è¯¢å­—ç¬¦ä¸²</span></span><br><span class=\"line\">            <span class=\"keyword\">return</span> mongoTemplate.find(query, Document.class, <span class=\"string\">&quot;collection&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// æŸ¥è¯¢å¹´é¾„ä¸å­˜åœ¨æˆ–è€…ä¸åœ¨æŒ‡å®šæ•°ç»„ä¸­çš„æ–‡æ¡£</span></span><br><span class=\"line\">        <span class=\"comment\">// db.collection.find(&#123; &quot;age&quot;: &#123; &quot;$nin&quot;: [20, 25] &#125; &#125;)</span></span><br><span class=\"line\">        <span class=\"keyword\">public</span> List&lt;Document&gt; <span class=\"title function_\">findAgeNotInArray</span><span class=\"params\">(List&lt;Integer&gt; ages)</span> &#123;</span><br><span class=\"line\">            <span class=\"type\">Query</span> <span class=\"variable\">query</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Query</span>(Criteria.where(<span class=\"string\">&quot;age&quot;</span>).nin(ages));</span><br><span class=\"line\">            System.out.println(query); <span class=\"comment\">// æ‰“å°å‡ºç”Ÿæˆçš„æŸ¥è¯¢å­—ç¬¦ä¸²</span></span><br><span class=\"line\">            <span class=\"keyword\">return</span> mongoTemplate.find(query, Document.class, <span class=\"string\">&quot;collection&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// æŸ¥è¯¢å¹´é¾„å­˜åœ¨å¹¶ä¸”ä¸º 20ï¼Œæˆ–è€…è–ªèµ„å¤§äº 8000 çš„æ–‡æ¡£</span></span><br><span class=\"line\">        <span class=\"comment\">// db.collection.find(&#123; &quot;$or&quot;: [ &#123; &quot;age&quot;: 20 &#125;, &#123; &quot;salary&quot;: &#123; &quot;$gt&quot;: 8000 &#125; &#125; ] &#125;)</span></span><br><span class=\"line\">        <span class=\"keyword\">public</span> List&lt;Document&gt; <span class=\"title function_\">findAgeOrSalary</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">            <span class=\"type\">Query</span> <span class=\"variable\">query</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Query</span>(<span class=\"keyword\">new</span> <span class=\"title class_\">Criteria</span>().orOperator(Criteria.where(<span class=\"string\">&quot;age&quot;</span>).is(<span class=\"number\">20</span>), Criteria.where(<span class=\"string\">&quot;salary&quot;</span>).gt(<span class=\"number\">8000</span>)));</span><br><span class=\"line\">            System.out.println(query); <span class=\"comment\">// æ‰“å°å‡ºç”Ÿæˆçš„æŸ¥è¯¢å­—ç¬¦ä¸²</span></span><br><span class=\"line\">            <span class=\"keyword\">return</span> mongoTemplate.find(query, Document.class, <span class=\"string\">&quot;collection&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// æŸ¥è¯¢å¹´é¾„ä¸º 20ï¼Œå¹¶ä¸”è–ªèµ„å¤§äº 8000 çš„æ–‡æ¡£</span></span><br><span class=\"line\">        <span class=\"comment\">// db.collection.find(&#123; &quot;$and&quot;: [ &#123; &quot;age&quot;: 20 &#125;, &#123; &quot;salary&quot;: &#123; &quot;$gt&quot;: 8000 &#125; &#125; ] &#125;)</span></span><br><span class=\"line\">        <span class=\"keyword\">public</span> List&lt;Document&gt; <span class=\"title function_\">findAgeAndSalary</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">            <span class=\"type\">Query</span> <span class=\"variable\">query</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Query</span>(<span class=\"keyword\">new</span> <span class=\"title class_\">Criteria</span>().andOperator(Criteria.where(<span class=\"string\">&quot;age&quot;</span>).is(<span class=\"number\">20</span>), Criteria.where(<span class=\"string\">&quot;salary&quot;</span>).gt(<span class=\"number\">8000</span>)));</span><br><span class=\"line\">            System.out.println(query); <span class=\"comment\">// æ‰“å°å‡ºç”Ÿæˆçš„æŸ¥è¯¢å­—ç¬¦ä¸²</span></span><br><span class=\"line\">            <span class=\"keyword\">return</span> mongoTemplate.find(query, Document.class, <span class=\"string\">&quot;collection&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// æŸ¥è¯¢åŒ…å« tagKey ä¸º &quot;color&quot;ï¼ŒtagValue ä¸º &quot;red&quot; çš„æ ‡ç­¾ï¼Œå¹¶ä¸”åŒ…å« tagKey ä¸º &quot;size&quot;ï¼ŒtagValue ä¸º &quot;XL&quot; çš„æ ‡ç­¾çš„æ–‡æ¡£</span></span><br><span class=\"line\">        <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">        db.collection.find(&#123; &quot;tags&quot;: &#123; &quot;$all&quot;: [</span></span><br><span class=\"line\"><span class=\"comment\">            &#123; &quot;$elemMatch&quot;: &#123; &quot;tagKey&quot;: &quot;color&quot;, &quot;tagValue&quot;: &quot;red&quot; &#125; &#125;,</span></span><br><span class=\"line\"><span class=\"comment\">            &#123; &quot;$elemMatch&quot;: &#123; &quot;tagKey&quot;: &quot;size&quot;, &quot;tagValue&quot;: &quot;XL&quot; &#125; &#125;</span></span><br><span class=\"line\"><span class=\"comment\">        ]&#125;&#125;)</span></span><br><span class=\"line\"><span class=\"comment\">         */</span></span><br><span class=\"line\">        <span class=\"keyword\">public</span> List&lt;Document&gt; <span class=\"title function_\">findTagsWithColorAndSize</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">            <span class=\"type\">Criteria</span> <span class=\"variable\">criteria</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Criteria</span>().andOperator(Criteria.where(<span class=\"string\">&quot;tags&quot;</span>).elemMatch(Criteria.where(<span class=\"string\">&quot;tagKey&quot;</span>).is(<span class=\"string\">&quot;color&quot;</span>).and(<span class=\"string\">&quot;tagValue&quot;</span>).is(<span class=\"string\">&quot;red&quot;</span>)), Criteria.where(<span class=\"string\">&quot;tags&quot;</span>).elemMatch(Criteria.where(<span class=\"string\">&quot;tagKey&quot;</span>).is(<span class=\"string\">&quot;size&quot;</span>).and(<span class=\"string\">&quot;tagValue&quot;</span>).is(<span class=\"string\">&quot;XL&quot;</span>)));</span><br><span class=\"line\">            <span class=\"type\">Query</span> <span class=\"variable\">query</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Query</span>(criteria);</span><br><span class=\"line\">            System.out.println(query); <span class=\"comment\">// æ‰“å°å‡ºç”Ÿæˆçš„æŸ¥è¯¢å­—ç¬¦ä¸²</span></span><br><span class=\"line\">            <span class=\"keyword\">return</span> mongoTemplate.find(query, Document.class, <span class=\"string\">&quot;collection&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// æŸ¥è¯¢åŒ…å« tagKey ä¸º &quot;color&quot;ï¼ŒtagValue åŒ…å« &quot;blue&quot; çš„æ ‡ç­¾çš„æ–‡æ¡£</span></span><br><span class=\"line\">        <span class=\"comment\">// db.collection.find(&#123; &quot;tags&quot;: &#123; &quot;$elemMatch&quot;: &#123; &quot;tagKey&quot;: &quot;color&quot;, &quot;tagValue&quot;: /blue/ &#125; &#125; &#125;)</span></span><br><span class=\"line\">        <span class=\"keyword\">public</span> List&lt;Document&gt; <span class=\"title function_\">findTagsWithColorContainingBlue</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">            <span class=\"type\">Query</span> <span class=\"variable\">query</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Query</span>(Criteria.where(<span class=\"string\">&quot;tags&quot;</span>).elemMatch(Criteria.where(<span class=\"string\">&quot;tagKey&quot;</span>).is(<span class=\"string\">&quot;color&quot;</span>).and(<span class=\"string\">&quot;tagValue&quot;</span>).regex(<span class=\"string\">&quot;blue&quot;</span>)));</span><br><span class=\"line\">            System.out.println(query); <span class=\"comment\">// æ‰“å°å‡ºç”Ÿæˆçš„æŸ¥è¯¢å­—ç¬¦ä¸²</span></span><br><span class=\"line\">            <span class=\"keyword\">return</span> mongoTemplate.find(query, Document.class, <span class=\"string\">&quot;collection&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// æŸ¥è¯¢åŒ…å« tagKey ä¸º &quot;color&quot; çš„æ ‡ç­¾çš„æ–‡æ¡£</span></span><br><span class=\"line\">        <span class=\"comment\">// db.collection.find(&#123; &quot;tags.tagKey&quot;: &quot;color&quot; &#125;)</span></span><br><span class=\"line\">        <span class=\"keyword\">public</span> List&lt;Document&gt; <span class=\"title function_\">findTagsWithColor</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">            <span class=\"type\">Query</span> <span class=\"variable\">query</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Query</span>(Criteria.where(<span class=\"string\">&quot;tags.tagKey&quot;</span>).is(<span class=\"string\">&quot;color&quot;</span>));</span><br><span class=\"line\">            System.out.println(query); <span class=\"comment\">// æ‰“å°å‡ºç”Ÿæˆçš„æŸ¥è¯¢å­—ç¬¦ä¸²</span></span><br><span class=\"line\">            <span class=\"keyword\">return</span> mongoTemplate.find(query, Document.class, <span class=\"string\">&quot;collection&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// æŸ¥è¯¢ tags æ•°ç»„é•¿åº¦ä¸º 3 çš„æ–‡æ¡£</span></span><br><span class=\"line\">        <span class=\"comment\">// db.collection.find(&#123; &quot;tags&quot;: &#123; &quot;$size&quot;: 3 &#125; &#125;)</span></span><br><span class=\"line\">        <span class=\"keyword\">public</span> List&lt;Document&gt; <span class=\"title function_\">findDocumentWithTagsSizeThree</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">            <span class=\"type\">Query</span> <span class=\"variable\">query</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Query</span>(Criteria.where(<span class=\"string\">&quot;tags&quot;</span>).size(<span class=\"number\">3</span>));</span><br><span class=\"line\">            System.out.println(query); <span class=\"comment\">// æ‰“å°å‡ºç”Ÿæˆçš„æŸ¥è¯¢å­—ç¬¦ä¸²</span></span><br><span class=\"line\">            <span class=\"keyword\">return</span> mongoTemplate.find(query, Document.class, <span class=\"string\">&quot;collection&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// æŸ¥è¯¢åŒ…å« tagKey ä¸º &quot;color&quot;ï¼ŒtagValue ä¸º &quot;red&quot; çš„æ ‡ç­¾çš„æ–‡æ¡£</span></span><br><span class=\"line\">        <span class=\"comment\">// db.collection.find(&#123; &quot;tags&quot;: &#123; &quot;$elemMatch&quot;: &#123; &quot;tagKey&quot;: &quot;color&quot;, &quot;tagValue&quot;: &quot;red&quot; &#125; &#125; &#125;)</span></span><br><span class=\"line\">        <span class=\"keyword\">public</span> List&lt;Document&gt; <span class=\"title function_\">findDocumentWithSpecificTag</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">            <span class=\"type\">Query</span> <span class=\"variable\">query</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Query</span>(Criteria.where(<span class=\"string\">&quot;tags&quot;</span>).elemMatch(Criteria.where(<span class=\"string\">&quot;tagKey&quot;</span>).is(<span class=\"string\">&quot;color&quot;</span>).and(<span class=\"string\">&quot;tagValue&quot;</span>).is(<span class=\"string\">&quot;red&quot;</span>)));</span><br><span class=\"line\">            System.out.println(query); <span class=\"comment\">// æ‰“å°å‡ºç”Ÿæˆçš„æŸ¥è¯¢å­—ç¬¦ä¸²</span></span><br><span class=\"line\">            <span class=\"keyword\">return</span> mongoTemplate.find(query, Document.class, <span class=\"string\">&quot;collection&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// æŸ¥è¯¢ tags æ•°ç»„æ‰€æœ‰å…ƒç´ æ»¡è¶³ tagKey ä¸º &quot;color&quot;ï¼ŒtagValue åŒ…å« &quot;green&quot; çš„æ ‡ç­¾çš„æ–‡æ¡£</span></span><br><span class=\"line\">        <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">        db.collection.find(&#123; &quot;tags&quot;: &#123; &quot;$all&quot;: [</span></span><br><span class=\"line\"><span class=\"comment\">            &#123; &quot;$elemMatch&quot;: &#123; &quot;tagKey&quot;: &quot;color&quot;, &quot;tagValue&quot;: /green/ &#125; &#125;</span></span><br><span class=\"line\"><span class=\"comment\">        ]&#125;&#125;)</span></span><br><span class=\"line\"><span class=\"comment\">         */</span></span><br><span class=\"line\">        <span class=\"keyword\">public</span> List&lt;Document&gt; <span class=\"title function_\">findAllElementsWithSpecificTag</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">            <span class=\"type\">Query</span> <span class=\"variable\">query</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Query</span>(Criteria.where(<span class=\"string\">&quot;tags&quot;</span>).elemMatch(Criteria.where(<span class=\"string\">&quot;tagKey&quot;</span>).is(<span class=\"string\">&quot;color&quot;</span>).and(<span class=\"string\">&quot;tagValue&quot;</span>).regex(<span class=\"string\">&quot;green&quot;</span>)));</span><br><span class=\"line\">            System.out.println(query); <span class=\"comment\">// æ‰“å°å‡ºç”Ÿæˆçš„æŸ¥è¯¢å­—ç¬¦ä¸²</span></span><br><span class=\"line\">            <span class=\"keyword\">return</span> mongoTemplate.find(query, Document.class, <span class=\"string\">&quot;collection&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// æŸ¥è¯¢ tags æ•°ç»„æ‰€æœ‰å…ƒç´ æ»¡è¶³ tagKey ä¸º &quot;color&quot;ï¼ŒtagValue åŒ…å« &quot;green&quot; çš„æ ‡ç­¾çš„æ–‡æ¡£</span></span><br><span class=\"line\">        <span class=\"comment\">// ä½¿ç”¨ BasicQueryï¼Œå¯ä»¥ä½¿ç”¨ json å­—ç¬¦ä¸²ï¼Œè¿™æ ·å°±å¯ä»¥ç›´æ¥ä½¿ç”¨ mongo çš„æŸ¥è¯¢è¯­æ³•</span></span><br><span class=\"line\">        <span class=\"keyword\">public</span> List&lt;Document&gt; <span class=\"title function_\">findAllElementsWithSpecificTagByJson</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">            <span class=\"type\">String</span> <span class=\"variable\">json</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;&quot;&quot;</span></span><br><span class=\"line\"><span class=\"string\">                    &#123; &quot;tags&quot;: &#123; &quot;$all&quot;: [</span></span><br><span class=\"line\"><span class=\"string\">                                &#123; &quot;$elemMatch&quot;: &#123; &quot;tagKey&quot;: &quot;color&quot;, &quot;tagValue&quot;: /green/ &#125; &#125;</span></span><br><span class=\"line\"><span class=\"string\">                            ]&#125;&#125;</span></span><br><span class=\"line\"><span class=\"string\">                    &quot;&quot;&quot;</span>;</span><br><span class=\"line\">            <span class=\"type\">Query</span> <span class=\"variable\">query</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">BasicQuery</span>(json);</span><br><span class=\"line\">            System.out.println(query); <span class=\"comment\">// æ‰“å°å‡ºç”Ÿæˆçš„æŸ¥è¯¢å­—ç¬¦ä¸²</span></span><br><span class=\"line\">            <span class=\"keyword\">return</span> mongoTemplate.find(query, Document.class, <span class=\"string\">&quot;collection&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ“ä½œå®ä½“ç±»</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>ç›¸å…³æ³¨è§£</th>\n<th>ä¿®é¥°èŒƒå›´</th>\n<th>ä½œç”¨</th>\n<th>å±æ€§</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>@Document</td>\n<td>ç±»</td>\n<td>æ˜ å°„ç±»å¯¹è±¡ä¸ºMongoæ–‡æ¡£</td>\n<td>value, collection</td>\n</tr>\n<tr>\n<td>@Id</td>\n<td>æˆå‘˜å˜é‡ã€æ–¹æ³•</td>\n<td>å°†æˆå‘˜å˜é‡å€¼æ˜ å°„ä¸ºæ–‡æ¡£çš„_idçš„å€¼</td>\n<td></td>\n</tr>\n<tr>\n<td>@Field</td>\n<td>æˆå‘˜å˜é‡ã€æ–¹æ³•</td>\n<td>å°†æˆå‘˜å˜é‡åŠå€¼æ˜ å°„ä¸ºæ–‡æ¡£ä¸­key:valueå¯¹</td>\n<td>name, value</td>\n</tr>\n<tr>\n<td>@Transient</td>\n<td>æˆå‘˜å˜é‡ã€æ–¹æ³•</td>\n<td>æŒ‡å®šæˆå‘˜å˜é‡ä¸å‚ä¸æ–‡æ¡£çš„åºåˆ—åŒ–</td>\n<td></td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-4\">\n<p>ä½¿ç”¨ @Document æ³¨è§£æŒ‡å®šé›†åˆå</p>\n</li>\n</ul>\n  <figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.hanqf.mongo.model;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> lombok.AllArgsConstructor;</span><br><span class=\"line\"><span class=\"keyword\">import</span> lombok.Data;</span><br><span class=\"line\"><span class=\"keyword\">import</span> lombok.NoArgsConstructor;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.annotation.Id;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.mongodb.core.mapping.Document;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.mongodb.core.mapping.Field;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.List;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Data</span></span><br><span class=\"line\"><span class=\"meta\">@AllArgsConstructor</span></span><br><span class=\"line\"><span class=\"meta\">@NoArgsConstructor</span></span><br><span class=\"line\"><span class=\"meta\">@Document(collection = &quot;collection&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Item</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Id</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> String id;</span><br><span class=\"line\">    <span class=\"meta\">@Field</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> String name;</span><br><span class=\"line\">    <span class=\"meta\">@Field</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"type\">int</span> age;</span><br><span class=\"line\">    <span class=\"meta\">@Field</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"type\">double</span> salary;</span><br><span class=\"line\">    <span class=\"meta\">@Field</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> List&lt;String&gt; colors;</span><br><span class=\"line\">    <span class=\"meta\">@Field</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> List&lt;String&gt; sizes;</span><br><span class=\"line\">    <span class=\"meta\">@Field</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> List&lt;Tag&gt; tags;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">Item</span><span class=\"params\">(String name, <span class=\"type\">int</span> age, <span class=\"type\">double</span> salary, List&lt;String&gt; colors, List&lt;String&gt; sizes, List&lt;Tag&gt; tags)</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.name = name;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.age = age;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.salary = salary;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.colors = colors;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.sizes = sizes;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.tags = tags;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Data</span></span><br><span class=\"line\">    <span class=\"meta\">@AllArgsConstructor</span></span><br><span class=\"line\">    <span class=\"meta\">@NoArgsConstructor</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Tag</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">private</span> String tagKey;</span><br><span class=\"line\">        <span class=\"keyword\">private</span> String tagValue;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-4\">\n<p>æŸ¥è¯¢ç¤ºä¾‹</p>\n</li>\n</ul>\n  <figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br><span class=\"line\">222</span><br><span class=\"line\">223</span><br><span class=\"line\">224</span><br><span class=\"line\">225</span><br><span class=\"line\">226</span><br><span class=\"line\">227</span><br><span class=\"line\">228</span><br><span class=\"line\">229</span><br><span class=\"line\">230</span><br><span class=\"line\">231</span><br><span class=\"line\">232</span><br><span class=\"line\">233</span><br><span class=\"line\">234</span><br><span class=\"line\">235</span><br><span class=\"line\">236</span><br><span class=\"line\">237</span><br><span class=\"line\">238</span><br><span class=\"line\">239</span><br><span class=\"line\">240</span><br><span class=\"line\">241</span><br><span class=\"line\">242</span><br><span class=\"line\">243</span><br><span class=\"line\">244</span><br><span class=\"line\">245</span><br><span class=\"line\">246</span><br><span class=\"line\">247</span><br><span class=\"line\">248</span><br><span class=\"line\">249</span><br><span class=\"line\">250</span><br><span class=\"line\">251</span><br><span class=\"line\">252</span><br><span class=\"line\">253</span><br><span class=\"line\">254</span><br><span class=\"line\">255</span><br><span class=\"line\">256</span><br><span class=\"line\">257</span><br><span class=\"line\">258</span><br><span class=\"line\">259</span><br><span class=\"line\">260</span><br><span class=\"line\">261</span><br><span class=\"line\">262</span><br><span class=\"line\">263</span><br><span class=\"line\">264</span><br><span class=\"line\">265</span><br><span class=\"line\">266</span><br><span class=\"line\">267</span><br><span class=\"line\">268</span><br><span class=\"line\">269</span><br><span class=\"line\">270</span><br><span class=\"line\">271</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.hanqf;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.hanqf.mongo.model.Item;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.junit.jupiter.api.Test;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.boot.test.context.SpringBootTest;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.mongodb.core.MongoTemplate;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.mongodb.core.query.BasicQuery;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.mongodb.core.query.Criteria;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.mongodb.core.query.Query;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Arrays;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.List;</span><br><span class=\"line\"><span class=\"meta\">@SpringBootTest</span></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">BasicTests2</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> MongoTemplate mongoTemplate;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Test</span></span><br><span class=\"line\">    <span class=\"keyword\">void</span> <span class=\"title function_\">initializeData</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// Initialize data</span></span><br><span class=\"line\">        List&lt;Item&gt; items = Arrays.asList(</span><br><span class=\"line\">                <span class=\"keyword\">new</span> <span class=\"title class_\">Item</span>(<span class=\"string\">&quot;item1&quot;</span>, <span class=\"number\">20</span>, <span class=\"number\">5000</span>,</span><br><span class=\"line\">                        Arrays.asList(<span class=\"string\">&quot;red&quot;</span>, <span class=\"string\">&quot;blue&quot;</span>, <span class=\"string\">&quot;green&quot;</span>),</span><br><span class=\"line\">                        Arrays.asList(<span class=\"string\">&quot;S&quot;</span>, <span class=\"string\">&quot;M&quot;</span>, <span class=\"string\">&quot;L&quot;</span>),</span><br><span class=\"line\">                        Arrays.asList(<span class=\"keyword\">new</span> <span class=\"title class_\">Item</span>.Tag(<span class=\"string\">&quot;color&quot;</span>, <span class=\"string\">&quot;red&quot;</span>),</span><br><span class=\"line\">                                <span class=\"keyword\">new</span> <span class=\"title class_\">Item</span>.Tag(<span class=\"string\">&quot;size&quot;</span>, <span class=\"string\">&quot;M&quot;</span>),</span><br><span class=\"line\">                                <span class=\"keyword\">new</span> <span class=\"title class_\">Item</span>.Tag(<span class=\"string\">&quot;style&quot;</span>, <span class=\"string\">&quot;casual&quot;</span>))),</span><br><span class=\"line\">                <span class=\"keyword\">new</span> <span class=\"title class_\">Item</span>(<span class=\"string\">&quot;item2&quot;</span>, <span class=\"number\">30</span>, <span class=\"number\">8000</span>,</span><br><span class=\"line\">                        Arrays.asList(<span class=\"string\">&quot;green&quot;</span>, <span class=\"string\">&quot;yellow&quot;</span>),</span><br><span class=\"line\">                        Arrays.asList(<span class=\"string\">&quot;M&quot;</span>, <span class=\"string\">&quot;L&quot;</span>, <span class=\"string\">&quot;XL&quot;</span>),</span><br><span class=\"line\">                        Arrays.asList(<span class=\"keyword\">new</span> <span class=\"title class_\">Item</span>.Tag(<span class=\"string\">&quot;color&quot;</span>, <span class=\"string\">&quot;blue&quot;</span>),</span><br><span class=\"line\">                                <span class=\"keyword\">new</span> <span class=\"title class_\">Item</span>.Tag(<span class=\"string\">&quot;size&quot;</span>, <span class=\"string\">&quot;XL&quot;</span>),</span><br><span class=\"line\">                                <span class=\"keyword\">new</span> <span class=\"title class_\">Item</span>.Tag(<span class=\"string\">&quot;style&quot;</span>, <span class=\"string\">&quot;formal&quot;</span>))),</span><br><span class=\"line\">                <span class=\"keyword\">new</span> <span class=\"title class_\">Item</span>(<span class=\"string\">&quot;item3&quot;</span>, <span class=\"number\">25</span>, <span class=\"number\">10000</span>,</span><br><span class=\"line\">                        Arrays.asList(<span class=\"string\">&quot;red&quot;</span>, <span class=\"string\">&quot;green&quot;</span>),</span><br><span class=\"line\">                        Arrays.asList(<span class=\"string\">&quot;L&quot;</span>, <span class=\"string\">&quot;XL&quot;</span>),</span><br><span class=\"line\">                        Arrays.asList(<span class=\"keyword\">new</span> <span class=\"title class_\">Item</span>.Tag(<span class=\"string\">&quot;color&quot;</span>, <span class=\"string\">&quot;green&quot;</span>),</span><br><span class=\"line\">                                <span class=\"keyword\">new</span> <span class=\"title class_\">Item</span>.Tag(<span class=\"string\">&quot;size&quot;</span>, <span class=\"string\">&quot;L&quot;</span>),</span><br><span class=\"line\">                                <span class=\"keyword\">new</span> <span class=\"title class_\">Item</span>.Tag(<span class=\"string\">&quot;style&quot;</span>, <span class=\"string\">&quot;casual&quot;</span>)))</span><br><span class=\"line\">        );</span><br><span class=\"line\"></span><br><span class=\"line\">        mongoTemplate.insertAll(items);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Test</span></span><br><span class=\"line\">    <span class=\"keyword\">void</span> <span class=\"title function_\">testQueries</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        BasicTests2.<span class=\"type\">QueryExecutor</span> <span class=\"variable\">queryExecutor</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">BasicTests2</span>.QueryExecutor(mongoTemplate);</span><br><span class=\"line\">        <span class=\"comment\">// db.collection.find(&#123; &quot;age&quot;: &#123; &quot;$lt&quot;: 25 &#125; &#125;)</span></span><br><span class=\"line\">        printResult(<span class=\"string\">&quot;findAgeLessThan25&quot;</span>, queryExecutor.findAgeLessThan25());</span><br><span class=\"line\">        <span class=\"comment\">// db.collection.find(&#123; &quot;age&quot;: &#123; &quot;$lte&quot;: 25 &#125; &#125;)</span></span><br><span class=\"line\">        printResult(<span class=\"string\">&quot;findAgeLessThanOrEqualTo25&quot;</span>, queryExecutor.findAgeLessThanOrEqualTo25());</span><br><span class=\"line\">        <span class=\"comment\">// db.collection.find(&#123; &quot;age&quot;: &#123; &quot;$gt&quot;: 25 &#125; &#125;)</span></span><br><span class=\"line\">        printResult(<span class=\"string\">&quot;findAgeGreaterThan25&quot;</span>, queryExecutor.findAgeGreaterThan25());</span><br><span class=\"line\">        <span class=\"comment\">// db.collection.find(&#123; &quot;age&quot;: &#123; &quot;$gte&quot;: 25 &#125; &#125;)</span></span><br><span class=\"line\">        printResult(<span class=\"string\">&quot;findAgeGreaterThanOrEqualTo25&quot;</span>, queryExecutor.findAgeGreaterThanOrEqualTo25());</span><br><span class=\"line\">        <span class=\"comment\">// db.collection.find(&#123; &quot;age&quot;: &#123; &quot;$ne&quot;: 25 &#125; &#125;)</span></span><br><span class=\"line\">        printResult(<span class=\"string\">&quot;findAgeNotEqualTo25&quot;</span>, queryExecutor.findAgeNotEqualTo25());</span><br><span class=\"line\">        <span class=\"comment\">// db.collection.find(&#123; &quot;age&quot;: &#123; &quot;$in&quot;: [20, 25] &#125; &#125;)</span></span><br><span class=\"line\">        printResult(<span class=\"string\">&quot;findAgeInArray&quot;</span>, queryExecutor.findAgeInArray(List.of(<span class=\"number\">20</span>, <span class=\"number\">25</span>)));</span><br><span class=\"line\">        <span class=\"comment\">// db.collection.find(&#123; &quot;age&quot;: &#123; &quot;$nin&quot;: [20, 25] &#125; &#125;)</span></span><br><span class=\"line\">        printResult(<span class=\"string\">&quot;findAgeNotInArray&quot;</span>, queryExecutor.findAgeNotInArray(List.of(<span class=\"number\">20</span>, <span class=\"number\">25</span>)));</span><br><span class=\"line\">        <span class=\"comment\">// db.collection.find(&#123; &quot;$or&quot;: [ &#123; &quot;age&quot;: 20 &#125;, &#123; &quot;salary&quot;: &#123; &quot;$gt&quot;: 8000 &#125; &#125; ] &#125;)</span></span><br><span class=\"line\">        printResult(<span class=\"string\">&quot;findAgeOrSalary&quot;</span>, queryExecutor.findAgeOrSalary());</span><br><span class=\"line\">        <span class=\"comment\">// db.collection.find(&#123; &quot;$and&quot;: [ &#123; &quot;age&quot;: 20 &#125;, &#123; &quot;salary&quot;: &#123; &quot;$gt&quot;: 8000 &#125; &#125; ] &#125;)</span></span><br><span class=\"line\">        printResult(<span class=\"string\">&quot;findAgeAndSalary&quot;</span>, queryExecutor.findAgeAndSalary());</span><br><span class=\"line\">        <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">        db.collection.find(&#123; &quot;tags&quot;: &#123; &quot;$all&quot;: [</span></span><br><span class=\"line\"><span class=\"comment\">            &#123; &quot;$elemMatch&quot;: &#123; &quot;tagKey&quot;: &quot;color&quot;, &quot;tagValue&quot;: &quot;red&quot; &#125; &#125;,</span></span><br><span class=\"line\"><span class=\"comment\">            &#123; &quot;$elemMatch&quot;: &#123; &quot;tagKey&quot;: &quot;size&quot;, &quot;tagValue&quot;: &quot;XL&quot; &#125; &#125;</span></span><br><span class=\"line\"><span class=\"comment\">        ]&#125;&#125;)</span></span><br><span class=\"line\"><span class=\"comment\">        */</span></span><br><span class=\"line\">        printResult(<span class=\"string\">&quot;findTagsWithColorAndSize&quot;</span>, queryExecutor.findTagsWithColorAndSize());</span><br><span class=\"line\">        <span class=\"comment\">// db.collection.find(&#123; &quot;tags&quot;: &#123; &quot;$elemMatch&quot;: &#123; &quot;tagKey&quot;: &quot;color&quot;, &quot;tagValue&quot;: /blue/ &#125; &#125; &#125;)</span></span><br><span class=\"line\">        printResult(<span class=\"string\">&quot;findTagsWithColorContainingBlue&quot;</span>, queryExecutor.findTagsWithColorContainingBlue());</span><br><span class=\"line\">        <span class=\"comment\">// db.collection.find(&#123; &quot;tags.tagKey&quot;: &quot;color&quot; &#125;)</span></span><br><span class=\"line\">        printResult(<span class=\"string\">&quot;findTagsWithColor&quot;</span>, queryExecutor.findTagsWithColor());</span><br><span class=\"line\">        <span class=\"comment\">// db.collection.find(&#123; &quot;tags&quot;: &#123; &quot;$size&quot;: 3 &#125; &#125;)</span></span><br><span class=\"line\">        printResult(<span class=\"string\">&quot;findDocumentWithTagsSizeThree&quot;</span>, queryExecutor.findDocumentWithTagsSizeThree());</span><br><span class=\"line\">        <span class=\"comment\">// db.collection.find(&#123; &quot;tags&quot;: &#123; &quot;$elemMatch&quot;: &#123; &quot;tagKey&quot;: &quot;color&quot;, &quot;tagValue&quot;: &quot;red&quot; &#125; &#125; &#125;)</span></span><br><span class=\"line\">        printResult(<span class=\"string\">&quot;findDocumentWithSpecificTag&quot;</span>, queryExecutor.findDocumentWithSpecificTag());</span><br><span class=\"line\">        <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">        db.collection.find(&#123; &quot;tags&quot;: &#123; &quot;$all&quot;: [</span></span><br><span class=\"line\"><span class=\"comment\">            &#123; &quot;$elemMatch&quot;: &#123; &quot;tagKey&quot;: &quot;color&quot;, &quot;tagValue&quot;: /green/ &#125; &#125;</span></span><br><span class=\"line\"><span class=\"comment\">        ]&#125;&#125;)</span></span><br><span class=\"line\"><span class=\"comment\">        */</span></span><br><span class=\"line\">        printResult(<span class=\"string\">&quot;findAllElementsWithSpecificTag&quot;</span>, queryExecutor.findAllElementsWithSpecificTag());</span><br><span class=\"line\">        printResult(<span class=\"string\">&quot;findAllElementsWithSpecificTagByJson&quot;</span>, queryExecutor.findAllElementsWithSpecificTagByJson());</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title function_\">printResult</span><span class=\"params\">(String queryName, List&lt;Item&gt; result)</span> &#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;Query: &quot;</span> + queryName + <span class=\"string\">&quot; ###################################################&quot;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (Item item : result) &#123;</span><br><span class=\"line\">            System.out.println(item);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        System.out.println();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">class</span> <span class=\"title class_\">QueryExecutor</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> MongoTemplate mongoTemplate;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"title function_\">QueryExecutor</span><span class=\"params\">(MongoTemplate mongoTemplate)</span> &#123;</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.mongoTemplate = mongoTemplate;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// æŸ¥è¯¢å¹´é¾„å°äº 25 çš„æ–‡æ¡£</span></span><br><span class=\"line\">        <span class=\"comment\">// db.collection.find(&#123; &quot;age&quot;: &#123; &quot;$lt&quot;: 25 &#125; &#125;)</span></span><br><span class=\"line\">        <span class=\"keyword\">public</span> List&lt;Item&gt; <span class=\"title function_\">findAgeLessThan25</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">            <span class=\"type\">Query</span> <span class=\"variable\">query</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Query</span>(Criteria.where(<span class=\"string\">&quot;age&quot;</span>).lt(<span class=\"number\">25</span>));</span><br><span class=\"line\">            System.out.println(query); <span class=\"comment\">// æ‰“å°å‡ºç”Ÿæˆçš„æŸ¥è¯¢å­—ç¬¦ä¸²</span></span><br><span class=\"line\">            <span class=\"keyword\">return</span> mongoTemplate.find(query, Item.class);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// æŸ¥è¯¢å¹´é¾„å°äºç­‰äº 25 çš„æ–‡æ¡£</span></span><br><span class=\"line\">        <span class=\"comment\">// db.collection.find(&#123; &quot;age&quot;: &#123; &quot;$lte&quot;: 25 &#125; &#125;)</span></span><br><span class=\"line\">        <span class=\"keyword\">public</span> List&lt;Item&gt; <span class=\"title function_\">findAgeLessThanOrEqualTo25</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">            <span class=\"type\">Query</span> <span class=\"variable\">query</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Query</span>(Criteria.where(<span class=\"string\">&quot;age&quot;</span>).lte(<span class=\"number\">25</span>));</span><br><span class=\"line\">            System.out.println(query); <span class=\"comment\">// æ‰“å°å‡ºç”Ÿæˆçš„æŸ¥è¯¢å­—ç¬¦ä¸²</span></span><br><span class=\"line\">            <span class=\"keyword\">return</span> mongoTemplate.find(query, Item.class);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// æŸ¥è¯¢å¹´é¾„å¤§äº 25 çš„æ–‡æ¡£</span></span><br><span class=\"line\">        <span class=\"comment\">// db.collection.find(&#123; &quot;age&quot;: &#123; &quot;$gt&quot;: 25 &#125; &#125;)</span></span><br><span class=\"line\">        <span class=\"keyword\">public</span> List&lt;Item&gt; <span class=\"title function_\">findAgeGreaterThan25</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">            <span class=\"type\">Query</span> <span class=\"variable\">query</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Query</span>(Criteria.where(<span class=\"string\">&quot;age&quot;</span>).gt(<span class=\"number\">25</span>));</span><br><span class=\"line\">            System.out.println(query); <span class=\"comment\">// æ‰“å°å‡ºç”Ÿæˆçš„æŸ¥è¯¢å­—ç¬¦ä¸²</span></span><br><span class=\"line\">            <span class=\"keyword\">return</span> mongoTemplate.find(query, Item.class);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// æŸ¥è¯¢å¹´é¾„å¤§äºç­‰äº 25 çš„æ–‡æ¡£</span></span><br><span class=\"line\">        <span class=\"comment\">// db.collection.find(&#123; &quot;age&quot;: &#123; &quot;$gte&quot;: 25 &#125; &#125;)</span></span><br><span class=\"line\">        <span class=\"keyword\">public</span> List&lt;Item&gt; <span class=\"title function_\">findAgeGreaterThanOrEqualTo25</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">            <span class=\"type\">Query</span> <span class=\"variable\">query</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Query</span>(Criteria.where(<span class=\"string\">&quot;age&quot;</span>).gte(<span class=\"number\">25</span>));</span><br><span class=\"line\">            System.out.println(query); <span class=\"comment\">// æ‰“å°å‡ºç”Ÿæˆçš„æŸ¥è¯¢å­—ç¬¦ä¸²</span></span><br><span class=\"line\">            <span class=\"keyword\">return</span> mongoTemplate.find(query, Item.class);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// æŸ¥è¯¢å¹´é¾„ä¸ç­‰äº 25 çš„æ–‡æ¡£</span></span><br><span class=\"line\">        <span class=\"comment\">// db.collection.find(&#123; &quot;age&quot;: &#123; &quot;$ne&quot;: 25 &#125; &#125;)</span></span><br><span class=\"line\">        <span class=\"keyword\">public</span> List&lt;Item&gt; <span class=\"title function_\">findAgeNotEqualTo25</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">            <span class=\"type\">Query</span> <span class=\"variable\">query</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Query</span>(Criteria.where(<span class=\"string\">&quot;age&quot;</span>).ne(<span class=\"number\">25</span>));</span><br><span class=\"line\">            System.out.println(query); <span class=\"comment\">// æ‰“å°å‡ºç”Ÿæˆçš„æŸ¥è¯¢å­—ç¬¦ä¸²</span></span><br><span class=\"line\">            <span class=\"keyword\">return</span> mongoTemplate.find(query, Item.class);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// æŸ¥è¯¢å¹´é¾„å­˜åœ¨å¹¶ä¸”åœ¨æŒ‡å®šæ•°ç»„ä¸­çš„æ–‡æ¡£</span></span><br><span class=\"line\">        <span class=\"comment\">// db.collection.find(&#123; &quot;age&quot;: &#123; &quot;$in&quot;: [20, 25] &#125; &#125;)</span></span><br><span class=\"line\">        <span class=\"keyword\">public</span> List&lt;Item&gt; <span class=\"title function_\">findAgeInArray</span><span class=\"params\">(List&lt;Integer&gt; ages)</span> &#123;</span><br><span class=\"line\">            <span class=\"type\">Query</span> <span class=\"variable\">query</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Query</span>(Criteria.where(<span class=\"string\">&quot;age&quot;</span>).in(ages));</span><br><span class=\"line\">            System.out.println(query); <span class=\"comment\">// æ‰“å°å‡ºç”Ÿæˆçš„æŸ¥è¯¢å­—ç¬¦ä¸²</span></span><br><span class=\"line\">            <span class=\"keyword\">return</span> mongoTemplate.find(query, Item.class);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// æŸ¥è¯¢å¹´é¾„ä¸å­˜åœ¨æˆ–è€…ä¸åœ¨æŒ‡å®šæ•°ç»„ä¸­çš„æ–‡æ¡£</span></span><br><span class=\"line\">        <span class=\"comment\">// db.collection.find(&#123; &quot;age&quot;: &#123; &quot;$nin&quot;: [20, 25] &#125; &#125;)</span></span><br><span class=\"line\">        <span class=\"keyword\">public</span> List&lt;Item&gt; <span class=\"title function_\">findAgeNotInArray</span><span class=\"params\">(List&lt;Integer&gt; ages)</span> &#123;</span><br><span class=\"line\">            <span class=\"type\">Query</span> <span class=\"variable\">query</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Query</span>(Criteria.where(<span class=\"string\">&quot;age&quot;</span>).nin(ages));</span><br><span class=\"line\">            System.out.println(query); <span class=\"comment\">// æ‰“å°å‡ºç”Ÿæˆçš„æŸ¥è¯¢å­—ç¬¦ä¸²</span></span><br><span class=\"line\">            <span class=\"keyword\">return</span> mongoTemplate.find(query, Item.class);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// æŸ¥è¯¢å¹´é¾„å­˜åœ¨å¹¶ä¸”ä¸º 20ï¼Œæˆ–è€…è–ªèµ„å¤§äº 8000 çš„æ–‡æ¡£</span></span><br><span class=\"line\">        <span class=\"comment\">// db.collection.find(&#123; &quot;$or&quot;: [ &#123; &quot;age&quot;: 20 &#125;, &#123; &quot;salary&quot;: &#123; &quot;$gt&quot;: 8000 &#125; &#125; ] &#125;)</span></span><br><span class=\"line\">        <span class=\"keyword\">public</span> List&lt;Item&gt; <span class=\"title function_\">findAgeOrSalary</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">            <span class=\"type\">Query</span> <span class=\"variable\">query</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Query</span>(<span class=\"keyword\">new</span> <span class=\"title class_\">Criteria</span>().orOperator(</span><br><span class=\"line\">                    Criteria.where(<span class=\"string\">&quot;age&quot;</span>).is(<span class=\"number\">20</span>),</span><br><span class=\"line\">                    Criteria.where(<span class=\"string\">&quot;salary&quot;</span>).gt(<span class=\"number\">8000</span>)</span><br><span class=\"line\">            ));</span><br><span class=\"line\">            System.out.println(query); <span class=\"comment\">// æ‰“å°å‡ºç”Ÿæˆçš„æŸ¥è¯¢å­—ç¬¦ä¸²</span></span><br><span class=\"line\">            <span class=\"keyword\">return</span> mongoTemplate.find(query, Item.class);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// æŸ¥è¯¢å¹´é¾„ä¸º 20ï¼Œå¹¶ä¸”è–ªèµ„å¤§äº 8000 çš„æ–‡æ¡£</span></span><br><span class=\"line\">        <span class=\"comment\">// db.collection.find(&#123; &quot;$and&quot;: [ &#123; &quot;age&quot;: 20 &#125;, &#123; &quot;salary&quot;: &#123; &quot;$gt&quot;: 8000 &#125; &#125; ] &#125;)</span></span><br><span class=\"line\">        <span class=\"keyword\">public</span> List&lt;Item&gt; <span class=\"title function_\">findAgeAndSalary</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">            <span class=\"type\">Query</span> <span class=\"variable\">query</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Query</span>(<span class=\"keyword\">new</span> <span class=\"title class_\">Criteria</span>().andOperator(</span><br><span class=\"line\">                    Criteria.where(<span class=\"string\">&quot;age&quot;</span>).is(<span class=\"number\">20</span>),</span><br><span class=\"line\">                    Criteria.where(<span class=\"string\">&quot;salary&quot;</span>).gt(<span class=\"number\">8000</span>)</span><br><span class=\"line\">            ));</span><br><span class=\"line\">            System.out.println(query); <span class=\"comment\">// æ‰“å°å‡ºç”Ÿæˆçš„æŸ¥è¯¢å­—ç¬¦ä¸²</span></span><br><span class=\"line\">            <span class=\"keyword\">return</span> mongoTemplate.find(query, Item.class);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// æŸ¥è¯¢åŒ…å« tagKey ä¸º &quot;color&quot;ï¼ŒtagValue ä¸º &quot;red&quot; çš„æ ‡ç­¾ï¼Œå¹¶ä¸”åŒ…å« tagKey ä¸º &quot;size&quot;ï¼ŒtagValue ä¸º &quot;XL&quot; çš„æ ‡ç­¾çš„æ–‡æ¡£</span></span><br><span class=\"line\">        <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">        db.collection.find(&#123; &quot;tags&quot;: &#123; &quot;$all&quot;: [</span></span><br><span class=\"line\"><span class=\"comment\">            &#123; &quot;$elemMatch&quot;: &#123; &quot;tagKey&quot;: &quot;color&quot;, &quot;tagValue&quot;: &quot;red&quot; &#125; &#125;,</span></span><br><span class=\"line\"><span class=\"comment\">            &#123; &quot;$elemMatch&quot;: &#123; &quot;tagKey&quot;: &quot;size&quot;, &quot;tagValue&quot;: &quot;XL&quot; &#125; &#125;</span></span><br><span class=\"line\"><span class=\"comment\">        ]&#125;&#125;)</span></span><br><span class=\"line\"><span class=\"comment\">        */</span></span><br><span class=\"line\">        <span class=\"keyword\">public</span> List&lt;Item&gt; <span class=\"title function_\">findTagsWithColorAndSize</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">            <span class=\"type\">Criteria</span> <span class=\"variable\">criteria</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Criteria</span>().andOperator(</span><br><span class=\"line\">                    Criteria.where(<span class=\"string\">&quot;tags&quot;</span>).elemMatch(</span><br><span class=\"line\">                            Criteria.where(<span class=\"string\">&quot;tagKey&quot;</span>).is(<span class=\"string\">&quot;color&quot;</span>).and(<span class=\"string\">&quot;tagValue&quot;</span>).is(<span class=\"string\">&quot;red&quot;</span>)</span><br><span class=\"line\">                    ),</span><br><span class=\"line\">                    Criteria.where(<span class=\"string\">&quot;tags&quot;</span>).elemMatch(</span><br><span class=\"line\">                            Criteria.where(<span class=\"string\">&quot;tagKey&quot;</span>).is(<span class=\"string\">&quot;size&quot;</span>).and(<span class=\"string\">&quot;tagValue&quot;</span>).is(<span class=\"string\">&quot;XL&quot;</span>)</span><br><span class=\"line\">                    )</span><br><span class=\"line\">            );</span><br><span class=\"line\">            <span class=\"type\">Query</span> <span class=\"variable\">query</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Query</span>(criteria);</span><br><span class=\"line\">            System.out.println(query); <span class=\"comment\">// æ‰“å°å‡ºç”Ÿæˆçš„æŸ¥è¯¢å­—ç¬¦ä¸²</span></span><br><span class=\"line\">            <span class=\"keyword\">return</span> mongoTemplate.find(query, Item.class);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// æŸ¥è¯¢åŒ…å« tagKey ä¸º &quot;color&quot;ï¼ŒtagValue åŒ…å« &quot;blue&quot; çš„æ ‡ç­¾çš„æ–‡æ¡£</span></span><br><span class=\"line\">        <span class=\"comment\">// db.collection.find(&#123; &quot;tags&quot;: &#123; &quot;$elemMatch&quot;: &#123; &quot;tagKey&quot;: &quot;color&quot;, &quot;tagValue&quot;: /blue/ &#125; &#125; &#125;)</span></span><br><span class=\"line\">        <span class=\"keyword\">public</span> List&lt;Item&gt; <span class=\"title function_\">findTagsWithColorContainingBlue</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">            <span class=\"type\">Query</span> <span class=\"variable\">query</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Query</span>(Criteria.where(<span class=\"string\">&quot;tags&quot;</span>).elemMatch(</span><br><span class=\"line\">                    Criteria.where(<span class=\"string\">&quot;tagKey&quot;</span>).is(<span class=\"string\">&quot;color&quot;</span>).and(<span class=\"string\">&quot;tagValue&quot;</span>).regex(<span class=\"string\">&quot;blue&quot;</span>)</span><br><span class=\"line\">            ));</span><br><span class=\"line\">            System.out.println(query); <span class=\"comment\">// æ‰“å°å‡ºç”Ÿæˆçš„æŸ¥è¯¢å­—ç¬¦ä¸²</span></span><br><span class=\"line\">            <span class=\"keyword\">return</span> mongoTemplate.find(query, Item.class);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// æŸ¥è¯¢åŒ…å« tagKey ä¸º &quot;color&quot; çš„æ ‡ç­¾çš„æ–‡æ¡£</span></span><br><span class=\"line\">        <span class=\"comment\">// db.collection.find(&#123; &quot;tags.tagKey&quot;: &quot;color&quot; &#125;)</span></span><br><span class=\"line\">        <span class=\"keyword\">public</span> List&lt;Item&gt; <span class=\"title function_\">findTagsWithColor</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">            <span class=\"type\">Query</span> <span class=\"variable\">query</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Query</span>(Criteria.where(<span class=\"string\">&quot;tags.tagKey&quot;</span>).is(<span class=\"string\">&quot;color&quot;</span>));</span><br><span class=\"line\">            System.out.println(query); <span class=\"comment\">// æ‰“å°å‡ºç”Ÿæˆçš„æŸ¥è¯¢å­—ç¬¦ä¸²</span></span><br><span class=\"line\">            <span class=\"keyword\">return</span> mongoTemplate.find(query, Item.class);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// æŸ¥è¯¢ tags æ•°ç»„é•¿åº¦ä¸º 3 çš„æ–‡æ¡£</span></span><br><span class=\"line\">        <span class=\"comment\">// db.collection.find(&#123; &quot;tags&quot;: &#123; &quot;$size&quot;: 3 &#125; &#125;)</span></span><br><span class=\"line\">        <span class=\"keyword\">public</span> List&lt;Item&gt; <span class=\"title function_\">findDocumentWithTagsSizeThree</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">            <span class=\"type\">Query</span> <span class=\"variable\">query</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Query</span>(Criteria.where(<span class=\"string\">&quot;tags&quot;</span>).size(<span class=\"number\">3</span>));</span><br><span class=\"line\">            System.out.println(query); <span class=\"comment\">// æ‰“å°å‡ºç”Ÿæˆçš„æŸ¥è¯¢å­—ç¬¦ä¸²</span></span><br><span class=\"line\">            <span class=\"keyword\">return</span> mongoTemplate.find(query, Item.class);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// æŸ¥è¯¢åŒ…å« tagKey ä¸º &quot;color&quot;ï¼ŒtagValue ä¸º &quot;red&quot; çš„æ ‡ç­¾çš„æ–‡æ¡£</span></span><br><span class=\"line\">        <span class=\"comment\">// db.collection.find(&#123; &quot;tags&quot;: &#123; &quot;$elemMatch&quot;: &#123; &quot;tagKey&quot;: &quot;color&quot;, &quot;tagValue&quot;: &quot;red&quot; &#125; &#125; &#125;)</span></span><br><span class=\"line\">        <span class=\"keyword\">public</span> List&lt;Item&gt; <span class=\"title function_\">findDocumentWithSpecificTag</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">            <span class=\"type\">Query</span> <span class=\"variable\">query</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Query</span>(Criteria.where(<span class=\"string\">&quot;tags&quot;</span>).elemMatch(</span><br><span class=\"line\">                    Criteria.where(<span class=\"string\">&quot;tagKey&quot;</span>).is(<span class=\"string\">&quot;color&quot;</span>).and(<span class=\"string\">&quot;tagValue&quot;</span>).is(<span class=\"string\">&quot;red&quot;</span>)</span><br><span class=\"line\">            ));</span><br><span class=\"line\">            System.out.println(query); <span class=\"comment\">// æ‰“å°å‡ºç”Ÿæˆçš„æŸ¥è¯¢å­—ç¬¦ä¸²</span></span><br><span class=\"line\">            <span class=\"keyword\">return</span> mongoTemplate.find(query, Item.class);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// æŸ¥è¯¢ tags æ•°ç»„æ‰€æœ‰å…ƒç´ æ»¡è¶³ tagKey ä¸º &quot;color&quot;ï¼ŒtagValue åŒ…å« &quot;green&quot; çš„æ ‡ç­¾çš„æ–‡æ¡£</span></span><br><span class=\"line\">        <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">        db.collection.find(&#123; &quot;tags&quot;: &#123; &quot;$all&quot;: [</span></span><br><span class=\"line\"><span class=\"comment\">            &#123; &quot;$elemMatch&quot;: &#123; &quot;tagKey&quot;: &quot;color&quot;, &quot;tagValue&quot;: /green/ &#125; &#125;</span></span><br><span class=\"line\"><span class=\"comment\">        ]&#125;&#125;)</span></span><br><span class=\"line\"><span class=\"comment\">        */</span></span><br><span class=\"line\">        <span class=\"keyword\">public</span> List&lt;Item&gt; <span class=\"title function_\">findAllElementsWithSpecificTag</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">            <span class=\"type\">Query</span> <span class=\"variable\">query</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Query</span>(Criteria.where(<span class=\"string\">&quot;tags&quot;</span>).elemMatch(</span><br><span class=\"line\">                    Criteria.where(<span class=\"string\">&quot;tagKey&quot;</span>).is(<span class=\"string\">&quot;color&quot;</span>).and(<span class=\"string\">&quot;tagValue&quot;</span>).regex(<span class=\"string\">&quot;green&quot;</span>)</span><br><span class=\"line\">            ));</span><br><span class=\"line\">            System.out.println(query); <span class=\"comment\">// æ‰“å°å‡ºç”Ÿæˆçš„æŸ¥è¯¢å­—ç¬¦ä¸²</span></span><br><span class=\"line\">            <span class=\"keyword\">return</span> mongoTemplate.find(query, Item.class);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// æŸ¥è¯¢ tags æ•°ç»„æ‰€æœ‰å…ƒç´ æ»¡è¶³ tagKey ä¸º &quot;color&quot;ï¼ŒtagValue åŒ…å« &quot;green&quot; çš„æ ‡ç­¾çš„æ–‡æ¡£</span></span><br><span class=\"line\">        <span class=\"comment\">// ä½¿ç”¨ BasicQueryï¼Œå¯ä»¥ä½¿ç”¨ json å­—ç¬¦ä¸²ï¼Œè¿™æ ·å°±å¯ä»¥ç›´æ¥ä½¿ç”¨ mongo çš„æŸ¥è¯¢è¯­æ³•</span></span><br><span class=\"line\">        <span class=\"keyword\">public</span> List&lt;Item&gt; <span class=\"title function_\">findAllElementsWithSpecificTagByJson</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">            <span class=\"type\">String</span> <span class=\"variable\">json</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;&quot;&quot;</span></span><br><span class=\"line\"><span class=\"string\">                    &#123; &quot;tags&quot;: &#123; &quot;$all&quot;: [</span></span><br><span class=\"line\"><span class=\"string\">                                &#123; &quot;$elemMatch&quot;: &#123; &quot;tagKey&quot;: &quot;color&quot;, &quot;tagValue&quot;: /green/ &#125; &#125;</span></span><br><span class=\"line\"><span class=\"string\">                            ]&#125;&#125;</span></span><br><span class=\"line\"><span class=\"string\">                    &quot;&quot;&quot;</span>;</span><br><span class=\"line\">            <span class=\"type\">Query</span> <span class=\"variable\">query</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">BasicQuery</span>(json);</span><br><span class=\"line\">            System.out.println(query); <span class=\"comment\">// æ‰“å°å‡ºç”Ÿæˆçš„æŸ¥è¯¢å­—ç¬¦ä¸²</span></span><br><span class=\"line\">            <span class=\"keyword\">return</span> mongoTemplate.find(query, Item.class);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"å¸¸ç”¨çš„æŸ¥è¯¢æ–¹æ³•\">å¸¸ç”¨çš„æŸ¥è¯¢æ–¹æ³•</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-4\">\n<p>æŸ¥è¯¢æ‰€æœ‰æ–‡æ¡£</p>\n</li>\n</ul>\n  <figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// db.employee.find()</span></span><br><span class=\"line\">List&lt;Employee&gt; list = mongoTemplate.findAll(Employee.class);</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-4\">\n<p>æ ¹æ®_idæŸ¥è¯¢</p>\n</li>\n</ul>\n  <figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// db.employee.findOne(&#123; &quot;_id&quot;: 1 &#125;)|</span></span><br><span class=\"line\"><span class=\"type\">Employee</span> <span class=\"variable\">e</span> <span class=\"operator\">=</span> mongoTemplate.findById(<span class=\"number\">1</span>, Employee.class);</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-4\">\n<p>æŸ¥è¯¢ç¬¬ä¸€ä¸ªæ–‡æ¡£</p>\n</li>\n</ul>\n  <figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// db.employee.findOne(&#123;&#125;)</span></span><br><span class=\"line\"><span class=\"type\">Employee</span> <span class=\"variable\">e</span> <span class=\"operator\">=</span> mongoTemplate.findOne(<span class=\"keyword\">new</span> <span class=\"title class_\">Query</span>(), Employee.class);</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-4\">\n<p>æ¡ä»¶æŸ¥è¯¢ï¼Œæ’åºåŠåˆ†é¡µ</p>\n</li>\n</ul>\n  <figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">db.employee.find(&#123;</span></span><br><span class=\"line\"><span class=\"comment\">          &quot;$or&quot;: [</span></span><br><span class=\"line\"><span class=\"comment\">              &#123; &quot;username&quot;: &quot;å¼ ä¸‰&quot; &#125;,</span></span><br><span class=\"line\"><span class=\"comment\">              &#123; &quot;salary&quot;: &#123; &quot;$gt&quot;: 5000 &#125; &#125;</span></span><br><span class=\"line\"><span class=\"comment\">          ]</span></span><br><span class=\"line\"><span class=\"comment\">      &#125;).sort(&#123; &quot;salary&quot;: -1 &#125;).skip(2).limit(4)</span></span><br><span class=\"line\"><span class=\"comment\">*/</span></span><br><span class=\"line\"><span class=\"type\">Query</span> <span class=\"variable\">query</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Query</span>(<span class=\"keyword\">new</span> <span class=\"title class_\">Criteria</span>().orOperator(Criteria.where(<span class=\"string\">&quot;name&quot;</span>).is(<span class=\"string\">&quot;å¼ ä¸‰&quot;</span>), Criteria.where(<span class=\"string\">&quot;salary&quot;</span>).gt(<span class=\"number\">5000</span>)););</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// å¦‚æœä½ ä¸ç†Ÿæ‚‰ Criteriaï¼Œä½†æ˜¯ç†Ÿæ‚‰ mongo çš„æŸ¥è¯¢è¯­æ³•ï¼Œå¯ä»¥ä½¿ç”¨ BasicQuery</span></span><br><span class=\"line\"><span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">  String json = &quot;&quot;&quot;</span></span><br><span class=\"line\"><span class=\"comment\">          &#123;</span></span><br><span class=\"line\"><span class=\"comment\">              &quot;$or&quot;: [</span></span><br><span class=\"line\"><span class=\"comment\">                  &#123; &quot;username&quot;: &quot;å¼ ä¸‰&quot; &#125;,</span></span><br><span class=\"line\"><span class=\"comment\">                  &#123; &quot;salary&quot;: &#123; &quot;$gt&quot;: 5000 &#125; &#125;</span></span><br><span class=\"line\"><span class=\"comment\">              ]</span></span><br><span class=\"line\"><span class=\"comment\">          &#125;</span></span><br><span class=\"line\"><span class=\"comment\">          &quot;&quot;&quot;;</span></span><br><span class=\"line\"><span class=\"comment\">  Query query = new BasicQuery(json);</span></span><br><span class=\"line\"><span class=\"comment\">*/</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//skip limit åˆ†é¡µ  skipç”¨äºæŒ‡å®šè·³è¿‡è®°å½•æ•°ï¼Œlimitåˆ™ç”¨äºé™å®šè¿”å›ç»“æœæ•°é‡ã€‚</span></span><br><span class=\"line\">query.with(Sort.by(Sort.Order.desc(<span class=\"string\">&quot;salary&quot;</span>)))</span><br><span class=\"line\">        .skip(<span class=\"number\">2</span>)  <span class=\"comment\">//æŒ‡å®šè·³è¿‡è®°å½•æ•°</span></span><br><span class=\"line\">        .limit(<span class=\"number\">4</span>);  <span class=\"comment\">//æ¯é¡µæ˜¾ç¤ºè®°å½•æ•°</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//æŸ¥è¯¢ç»“æœ</span></span><br><span class=\"line\">List&lt;Employee&gt; employees = mongoTemplate.find(</span><br><span class=\"line\">        query, Employee.class);</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-4\">\n<p>åªè¿”å›éƒ¨åˆ†å­—æ®µ</p>\n</li>\n</ul>\n  <figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">db.employee.find(</span></span><br><span class=\"line\"><span class=\"comment\">  &#123; &quot;age&quot;: &#123; &quot;$gte&quot;: 18 &#125; &#125;,  // ç­›é€‰æ¡ä»¶ï¼Œå¹´é¾„å¤§äºç­‰äº18å²çš„æ–‡æ¡£</span></span><br><span class=\"line\"><span class=\"comment\">  &#123; &quot;name&quot;: 1, &quot;age&quot;: 1 &#125;      // æŒ‡å®šè¿”å›çš„å­—æ®µï¼ŒåªåŒ…å«&quot;name&quot;å’Œ&quot;age&quot;ï¼Œå…¶ä¸­1è¡¨ç¤ºåŒ…å«è¯¥å­—æ®µï¼Œ0è¡¨ç¤ºä¸åŒ…å«</span></span><br><span class=\"line\"><span class=\"comment\">)</span></span><br><span class=\"line\"><span class=\"comment\">*/</span></span><br><span class=\"line\"><span class=\"type\">Query</span> <span class=\"variable\">query</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Query</span>();</span><br><span class=\"line\">query.addCriteria(Criteria.where(<span class=\"string\">&quot;age&quot;</span>).gte(<span class=\"number\">18</span>)); <span class=\"comment\">// ç­›é€‰æ¡ä»¶ï¼Œå¹´é¾„å¤§äºç­‰äº18å²çš„æ–‡æ¡£</span></span><br><span class=\"line\">query.fields().include(<span class=\"string\">&quot;name&quot;</span>, <span class=\"string\">&quot;age&quot;</span>).exclude(<span class=\"string\">&quot;id&quot;</span>);<span class=\"comment\">// æŒ‡å®šè¿”å›çš„å­—æ®µï¼ŒåªåŒ…å«&quot;name&quot;å’Œ&quot;age&quot;ï¼Œè¦å»é™¤idï¼Œå¦åˆ™é»˜è®¤ä¼šè¿”å›id</span></span><br><span class=\"line\">List&lt;Employee&gt; results = mongoTemplate.find(query, Employee.class);</span><br><span class=\"line\"><span class=\"comment\">// Employee(id=null, name=å¼ ä¸‰, age=21, salary=null, entryDay=null)</span></span><br><span class=\"line\">results.forEach(System.out::println);</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-4\">\n<p>å»é‡</p>\n</li>\n</ul>\n<blockquote>\n<p>distinct æ–¹æ³•åªèƒ½ç›´æ¥è·å–å”¯ä¸€å€¼ï¼Œå¹¶ä¸èƒ½åœ¨æŸ¥è¯¢è¿‡ç¨‹ä¸­è¿›è¡Œå…¶ä»–çš„èšåˆæ“ä½œï¼Œä½¿ç”¨åœºæ™¯éå¸¸å—é™ï¼Œæ¨èä½¿ç”¨èšåˆæ–¹å¼è¿›è¡ŒæŸ¥è¯¢</p>\n</blockquote>\n  <figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//è¯­æ³•ï¼šdb.collectionName.distinct(&quot;fieldName&quot;, &#123; /* è¿‡æ»¤æ¡ä»¶ */ &#125;)ï¼Œè¿™å°†è¿”å›æŒ‡å®šå­—æ®µ fieldName çš„å”¯ä¸€å€¼æ•°ç»„ã€‚</span></span><br><span class=\"line\"><span class=\"comment\">// ç¤ºä¾‹ï¼šdb.collection.distinct(&quot;name&quot;,&#123;age:&#123;$gte:25&#125;&#125;)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// æ–¹å¼1</span></span><br><span class=\"line\">DistinctIterable&lt;String&gt; distinctIterable = mongoTemplate.getCollection(<span class=\"string\">&quot;collection&quot;</span>)</span><br><span class=\"line\">        .distinct(<span class=\"string\">&quot;name&quot;</span>, BsonDocument.parse(<span class=\"string\">&quot;&#123;age:&#123;$gte:25&#125;&#125;&quot;</span>), String.class);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// æ–¹å¼2</span></span><br><span class=\"line\"><span class=\"comment\">// DistinctIterable&lt;String&gt; distinctIterable = mongoTemplate.getCollection(&quot;collection&quot;)</span></span><br><span class=\"line\"><span class=\"comment\">//        .distinct(&quot;name&quot;, new Document(&quot;age&quot;, new Document(&quot;$gte&quot;, 25)), String.class);</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// å°†DistinctIterableè½¬æ¢ä¸ºList</span></span><br><span class=\"line\">List&lt;String&gt; distinctNames = <span class=\"keyword\">new</span> <span class=\"title class_\">ArrayList</span>&lt;&gt;();</span><br><span class=\"line\">distinctIterable.iterator().forEachRemaining(distinctNames::add);</span><br><span class=\"line\"><span class=\"comment\">// æ‰“å°è¾“å‡º</span></span><br><span class=\"line\">distinctNames.forEach(System.out::println);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// èšåˆæ–¹å¼ï¼Œèšåˆæ–¹å¼çš„è¯¦ç»†è¯´æ˜ä¼šåœ¨ä¸‹ä¸€ç¯‡åšå®¢ä¸­ä»‹ç»</span></span><br><span class=\"line\"><span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">  db.collection.aggregate([</span></span><br><span class=\"line\"><span class=\"comment\">      &#123;</span></span><br><span class=\"line\"><span class=\"comment\">          $match: &#123; age: &#123; $gte: 25 &#125; &#125;</span></span><br><span class=\"line\"><span class=\"comment\">      &#125;,</span></span><br><span class=\"line\"><span class=\"comment\">      &#123;</span></span><br><span class=\"line\"><span class=\"comment\">          $group: &#123;</span></span><br><span class=\"line\"><span class=\"comment\">              _id: &quot;$name&quot;</span></span><br><span class=\"line\"><span class=\"comment\">          &#125;</span></span><br><span class=\"line\"><span class=\"comment\">      &#125;</span></span><br><span class=\"line\"><span class=\"comment\">  ])</span></span><br><span class=\"line\"><span class=\"comment\">*/</span></span><br><span class=\"line\"><span class=\"type\">Aggregation</span> <span class=\"variable\">aggregation</span> <span class=\"operator\">=</span> Aggregation.newAggregation(</span><br><span class=\"line\">              Aggregation.match(Criteria.where(<span class=\"string\">&quot;age&quot;</span>).gte(<span class=\"number\">25</span>)),</span><br><span class=\"line\">              Aggregation.group(<span class=\"string\">&quot;name&quot;</span>)</span><br><span class=\"line\">      );</span><br><span class=\"line\"></span><br><span class=\"line\">      AggregationResults&lt;Document&gt; results = mongoTemplate.aggregate(aggregation, <span class=\"string\">&quot;collection&quot;</span>, Document.class);</span><br><span class=\"line\">      List&lt;String&gt; distinctNames = results.getMappedResults().stream()</span><br><span class=\"line\">              .map(document -&gt; document.getString(<span class=\"string\">&quot;_id&quot;</span>))</span><br><span class=\"line\">              .toList();</span><br><span class=\"line\"></span><br><span class=\"line\">      distinctNames.forEach(System.out::println);</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>SpringBootå¯¹Mongoçš„æŸ¥è¯¢ï¼Œå…¶å®å°±æ˜¯å¦‚ä½•é€šè¿‡Criteriaæ¥æ„å»ºä¸€ä¸ªQueryï¼Œæ‰€ä»¥æˆ‘ä»¬çš„ç›®æ ‡å°±æ˜¯è¦ç†Ÿç»ƒæŒæ¡Criteriaçš„è¯­æ³•ã€‚å½“ç„¶ï¼Œå¦‚æœä½ ç†Ÿæ‚‰Mongoçš„æŸ¥è¯¢è¯­æ³•ï¼Œä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨BasicQueryæ¥å®ç°Mongoçš„æŸ¥è¯¢ã€‚</p>\n</blockquote>\n<h2 id=\"æ’å…¥\">æ’å…¥</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Mongoè¯­æ³•</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æ’å…¥å•ä¸ªæ–‡æ¡£</span></span><br><span class=\"line\">db.collection.insertOne(</span><br><span class=\"line\">   &lt;document&gt;,</span><br><span class=\"line\">   &#123;</span><br><span class=\"line\">      writeConcern: &lt;document&gt;</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\">)</span><br><span class=\"line\"><span class=\"comment\"># ç¤ºä¾‹</span></span><br><span class=\"line\">db.demo.insertOne(</span><br><span class=\"line\">   &#123; name: <span class=\"string\">&quot;å¼ ä¸‰&quot;</span>, age: 35&#125;,</span><br><span class=\"line\">   &#123;</span><br><span class=\"line\">      writeConcern: &#123; w: <span class=\"string\">&quot;majority&quot;</span>, j: <span class=\"literal\">true</span>, wtimeout: 5000 &#125;</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ’å…¥å¤šä¸ªæ–‡æ¡£</span></span><br><span class=\"line\">db.collection.insertMany(</span><br><span class=\"line\">   [ &lt;document 1&gt; , &lt;document 2&gt;, ... ],</span><br><span class=\"line\">   &#123;</span><br><span class=\"line\">      writeConcern: &lt;document&gt;,</span><br><span class=\"line\">      ordered: &lt;boolean&gt;</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\">)</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>writeConcern æ˜¯ MongoDB ä¸­ç”¨æ¥æ§åˆ¶å†™å…¥ç¡®è®¤çš„é€‰é¡¹ï¼Œå¯é€‰ã€‚ä»¥ä¸‹æ˜¯ writeConcern å‚æ•°çš„ä¸€äº›å¸¸è§é€‰é¡¹ï¼š</p>\n</blockquote>\n<ul class=\"lvl-0\">\n<li class=\"lvl-4\">\n<p>wï¼šæŒ‡å®šå†™å…¥ç¡®è®¤çº§åˆ«ã€‚å¦‚æœæŒ‡å®šä¸ºæ•°å­—ï¼Œåˆ™è¡¨ç¤ºè¦ç­‰å¾…å†™å…¥æ“ä½œå®Œæˆçš„èŠ‚ç‚¹æ•°ã€‚å¦‚æœæŒ‡å®šä¸º majorityï¼Œåˆ™è¡¨ç¤ºç­‰å¾…å¤§å¤šæ•°èŠ‚ç‚¹å®Œæˆå†™å…¥æ“ä½œã€‚é»˜è®¤ä¸º 1ï¼Œè¡¨ç¤ºç­‰å¾…å†™å…¥æ“ä½œå®Œæˆçš„èŠ‚ç‚¹æ•°ä¸º 1ã€‚</p>\n</li>\n<li class=\"lvl-4\">\n<p>jï¼šè¡¨ç¤ºå†™å…¥æ“ä½œæ˜¯å¦è¦æ±‚æŒä¹…åŒ–åˆ°ç£ç›˜ã€‚å¦‚æœè®¾ç½®ä¸º trueï¼Œåˆ™è¡¨ç¤ºå†™å…¥æ“ä½œå¿…é¡»æŒä¹…åŒ–åˆ°ç£ç›˜åæ‰è¿”å›æˆåŠŸã€‚å¦‚æœè®¾ç½®ä¸º falseï¼Œåˆ™è¡¨ç¤ºå†™å…¥æ“ä½œå¯èƒ½åœ¨æ•°æ®è¢«æŒä¹…åŒ–åˆ°ç£ç›˜ä¹‹å‰è¿”å›æˆåŠŸã€‚é»˜è®¤ä¸º falseã€‚</p>\n</li>\n<li class=\"lvl-4\">\n<p>wtimeoutï¼šè¡¨ç¤ºç­‰å¾…å†™å…¥æ“ä½œå®Œæˆçš„è¶…æ—¶æ—¶é—´ï¼Œå•ä½ä¸ºæ¯«ç§’ã€‚å¦‚æœè¶…è¿‡æŒ‡å®šçš„æ—¶é—´ä»ç„¶æ²¡æœ‰è¿”å›ç¡®è®¤ä¿¡æ¯ï¼Œåˆ™è¿”å›é”™è¯¯ã€‚é»˜è®¤ä¸º 0ï¼Œè¡¨ç¤ºä¸è®¾ç½®è¶…æ—¶æ—¶é—´ã€‚</p>\n</li>\n</ul>\n<blockquote>\n<p>orderedï¼šæŒ‡å®šæ˜¯å¦æŒ‰é¡ºåºå†™å…¥ï¼Œé»˜è®¤ trueï¼ŒæŒ‰é¡ºåºå†™å…¥ã€‚</p>\n</blockquote>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ’å…¥å•ä¸ªæ–‡æ¡£</p>\n</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">  db.employee.insertOne(&#123;</span></span><br><span class=\"line\"><span class=\"comment\">      &quot;_id&quot;: 1,</span></span><br><span class=\"line\"><span class=\"comment\">      &quot;username&quot;: &quot;å°æ˜&quot;,</span></span><br><span class=\"line\"><span class=\"comment\">      &quot;age&quot;: 30,</span></span><br><span class=\"line\"><span class=\"comment\">      &quot;salary&quot;: 10000.00,</span></span><br><span class=\"line\"><span class=\"comment\">      &quot;entryDay&quot;: new Date()</span></span><br><span class=\"line\"><span class=\"comment\">  &#125;)</span></span><br><span class=\"line\"><span class=\"comment\">*/</span></span><br><span class=\"line\"><span class=\"type\">Employee</span> <span class=\"variable\">employee</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Employee</span>(<span class=\"number\">1</span>, <span class=\"string\">&quot;å°æ˜&quot;</span>, <span class=\"number\">30</span>, <span class=\"number\">10000.00</span>, <span class=\"keyword\">new</span> <span class=\"title class_\">Date</span>());</span><br><span class=\"line\">mongoTemplate.insert(employee);</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ’å…¥å¤šä¸ªæ–‡æ¡£</p>\n</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">  db.employee.insertMany([</span></span><br><span class=\"line\"><span class=\"comment\">      &#123;</span></span><br><span class=\"line\"><span class=\"comment\">          &quot;_id&quot;: 2,</span></span><br><span class=\"line\"><span class=\"comment\">          &quot;username&quot;: &quot;å¼ ä¸‰&quot;,</span></span><br><span class=\"line\"><span class=\"comment\">          &quot;age&quot;: 21,</span></span><br><span class=\"line\"><span class=\"comment\">          &quot;salary&quot;: 5000.00,</span></span><br><span class=\"line\"><span class=\"comment\">          &quot;entryDay&quot;: new Date()</span></span><br><span class=\"line\"><span class=\"comment\">      &#125;,</span></span><br><span class=\"line\"><span class=\"comment\">      &#123;</span></span><br><span class=\"line\"><span class=\"comment\">          &quot;_id&quot;: 3,</span></span><br><span class=\"line\"><span class=\"comment\">          &quot;username&quot;: &quot;æå››&quot;,</span></span><br><span class=\"line\"><span class=\"comment\">          &quot;age&quot;: 26,</span></span><br><span class=\"line\"><span class=\"comment\">          &quot;salary&quot;: 8000.00,</span></span><br><span class=\"line\"><span class=\"comment\">          &quot;entryDay&quot;: new Date()</span></span><br><span class=\"line\"><span class=\"comment\">      &#125;,</span></span><br><span class=\"line\"><span class=\"comment\">      &#123;</span></span><br><span class=\"line\"><span class=\"comment\">          &quot;_id&quot;: 4,</span></span><br><span class=\"line\"><span class=\"comment\">          &quot;username&quot;: &quot;ç‹äº”&quot;,</span></span><br><span class=\"line\"><span class=\"comment\">          &quot;age&quot;: 22,</span></span><br><span class=\"line\"><span class=\"comment\">          &quot;salary&quot;: 8000.00,</span></span><br><span class=\"line\"><span class=\"comment\">          &quot;entryDay&quot;: new Date()</span></span><br><span class=\"line\"><span class=\"comment\">      &#125;,</span></span><br><span class=\"line\"><span class=\"comment\">      &#123;</span></span><br><span class=\"line\"><span class=\"comment\">          &quot;_id&quot;: 5,</span></span><br><span class=\"line\"><span class=\"comment\">          &quot;username&quot;: &quot;å¼ é¾™&quot;,</span></span><br><span class=\"line\"><span class=\"comment\">          &quot;age&quot;: 28,</span></span><br><span class=\"line\"><span class=\"comment\">          &quot;salary&quot;: 6000.00,</span></span><br><span class=\"line\"><span class=\"comment\">          &quot;entryDay&quot;: new Date()</span></span><br><span class=\"line\"><span class=\"comment\">      &#125;,</span></span><br><span class=\"line\"><span class=\"comment\">      &#123;</span></span><br><span class=\"line\"><span class=\"comment\">          &quot;_id&quot;: 6,</span></span><br><span class=\"line\"><span class=\"comment\">          &quot;username&quot;: &quot;èµµè™&quot;,</span></span><br><span class=\"line\"><span class=\"comment\">          &quot;age&quot;: 24,</span></span><br><span class=\"line\"><span class=\"comment\">          &quot;salary&quot;: 7000.00,</span></span><br><span class=\"line\"><span class=\"comment\">          &quot;entryDay&quot;: new Date()</span></span><br><span class=\"line\"><span class=\"comment\">      &#125;,</span></span><br><span class=\"line\"><span class=\"comment\">      &#123;</span></span><br><span class=\"line\"><span class=\"comment\">          &quot;_id&quot;: 7,</span></span><br><span class=\"line\"><span class=\"comment\">          &quot;username&quot;: &quot;èµµå…­&quot;,</span></span><br><span class=\"line\"><span class=\"comment\">          &quot;age&quot;: 28,</span></span><br><span class=\"line\"><span class=\"comment\">          &quot;salary&quot;: 12000.00,</span></span><br><span class=\"line\"><span class=\"comment\">          &quot;entryDay&quot;: new Date()</span></span><br><span class=\"line\"><span class=\"comment\">      &#125;</span></span><br><span class=\"line\"><span class=\"comment\">  ])</span></span><br><span class=\"line\"><span class=\"comment\">*/</span></span><br><span class=\"line\">List&lt;Employee&gt; list = Arrays.asList(</span><br><span class=\"line\">        <span class=\"keyword\">new</span> <span class=\"title class_\">Employee</span>(<span class=\"number\">2</span>, <span class=\"string\">&quot;å¼ ä¸‰&quot;</span>, <span class=\"number\">21</span>, <span class=\"number\">5000.00</span>, <span class=\"keyword\">new</span> <span class=\"title class_\">Date</span>()),</span><br><span class=\"line\">        <span class=\"keyword\">new</span> <span class=\"title class_\">Employee</span>(<span class=\"number\">3</span>, <span class=\"string\">&quot;æå››&quot;</span>, <span class=\"number\">26</span>, <span class=\"number\">8000.00</span>, <span class=\"keyword\">new</span> <span class=\"title class_\">Date</span>()),</span><br><span class=\"line\">        <span class=\"keyword\">new</span> <span class=\"title class_\">Employee</span>(<span class=\"number\">4</span>, <span class=\"string\">&quot;ç‹äº”&quot;</span>, <span class=\"number\">22</span>, <span class=\"number\">8000.00</span>, <span class=\"keyword\">new</span> <span class=\"title class_\">Date</span>()),</span><br><span class=\"line\">        <span class=\"keyword\">new</span> <span class=\"title class_\">Employee</span>(<span class=\"number\">5</span>, <span class=\"string\">&quot;å¼ é¾™&quot;</span>, <span class=\"number\">28</span>, <span class=\"number\">6000.00</span>, <span class=\"keyword\">new</span> <span class=\"title class_\">Date</span>()),</span><br><span class=\"line\">        <span class=\"keyword\">new</span> <span class=\"title class_\">Employee</span>(<span class=\"number\">6</span>, <span class=\"string\">&quot;èµµè™&quot;</span>, <span class=\"number\">24</span>, <span class=\"number\">7000.00</span>, <span class=\"keyword\">new</span> <span class=\"title class_\">Date</span>()),</span><br><span class=\"line\">        <span class=\"keyword\">new</span> <span class=\"title class_\">Employee</span>(<span class=\"number\">7</span>, <span class=\"string\">&quot;èµµå…­&quot;</span>, <span class=\"number\">28</span>, <span class=\"number\">12000.00</span>, <span class=\"keyword\">new</span> <span class=\"title class_\">Date</span>()));</span><br><span class=\"line\"><span class=\"comment\">//æ’å…¥å¤šæ¡æ•°æ®</span></span><br><span class=\"line\">mongoTemplate.insert(list, Employee.class);</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>idå­˜åœ¨æ—¶æ›´æ–°ï¼Œä¸å­˜åœ¨æ—¶æ’å…¥</p>\n</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">  db.employee.updateOne(</span></span><br><span class=\"line\"><span class=\"comment\">   &#123; &quot;_id&quot;: 1 &#125;,</span></span><br><span class=\"line\"><span class=\"comment\">   &#123;</span></span><br><span class=\"line\"><span class=\"comment\">      $set: &#123;</span></span><br><span class=\"line\"><span class=\"comment\">         &quot;name&quot;: &quot;å°æ˜&quot;,</span></span><br><span class=\"line\"><span class=\"comment\">         &quot;age&quot;: 30,</span></span><br><span class=\"line\"><span class=\"comment\">         &quot;salary&quot;: 10000.00,</span></span><br><span class=\"line\"><span class=\"comment\">         &quot;entryDay&quot;: ISODate(&quot;2024-03-05T00:00:00Z&quot;)</span></span><br><span class=\"line\"><span class=\"comment\">      &#125;</span></span><br><span class=\"line\"><span class=\"comment\">   &#125;,</span></span><br><span class=\"line\"><span class=\"comment\">   &#123; upsert: true &#125;</span></span><br><span class=\"line\"><span class=\"comment\">)</span></span><br><span class=\"line\"><span class=\"comment\">*/</span></span><br><span class=\"line\"><span class=\"type\">Employee</span> <span class=\"variable\">employee</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Employee</span>(<span class=\"number\">1</span>, <span class=\"string\">&quot;å°æ˜&quot;</span>, <span class=\"number\">30</span>, <span class=\"number\">10000.00</span>, <span class=\"keyword\">new</span> <span class=\"title class_\">Date</span>());</span><br><span class=\"line\"><span class=\"comment\">//saveæ–¹æ³•ä¼šæ ¹æ®å¯¹è±¡çš„idæ˜¯å¦å­˜åœ¨æ¥åˆ¤æ–­æ˜¯æ›´æ–°è¿˜æ˜¯æ’å…¥</span></span><br><span class=\"line\">mongoTemplate.save(employee);</span><br></pre></td></tr></table></figure>\n<h2 id=\"æ›´æ–°\">æ›´æ–°</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Mongoè¯­æ³•</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æ›´æ–°å•ä¸ªæˆ–å¤šä¸ªæ–‡æ¡£</span></span><br><span class=\"line\">db.collection.update[One|Many](</span><br><span class=\"line\">   &lt;filter&gt;,</span><br><span class=\"line\">   &lt;update&gt;,</span><br><span class=\"line\">   &#123;</span><br><span class=\"line\">     upsert: &lt;boolean&gt;,</span><br><span class=\"line\">     writeConcern: &lt;document&gt;,</span><br><span class=\"line\">     collation: &lt;document&gt;,</span><br><span class=\"line\">     arrayFilters: [ &lt;filterdocument1&gt;, ... ],</span><br><span class=\"line\">     hint:  &lt;document|string&gt;        // Available starting <span class=\"keyword\">in</span> MongoDB 4.2.1</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># findAndModify,åªèƒ½æ›´æ–°å•ä¸ªæ–‡æ¡£</span></span><br><span class=\"line\">db.collection.findAndModify(&#123;</span><br><span class=\"line\">    query:&lt;filter&gt;,</span><br><span class=\"line\">    update:&lt;update&gt;</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"><span class=\"comment\"># ç¤ºä¾‹ï¼Œè¯¥æ“ä½œä¼šè¿”å›ç¬¦åˆæŸ¥è¯¢æ¡ä»¶çš„æ–‡æ¡£æ•°æ®ï¼Œå¹¶å®Œæˆå¯¹æ–‡æ¡£çš„ä¿®æ”¹</span></span><br><span class=\"line\"><span class=\"comment\"># å°†æŸä¸ªbookæ–‡æ¡£çš„æ”¶è—æ•°ï¼ˆfavCountï¼‰åŠ 1</span></span><br><span class=\"line\">db.books.findAndModify(&#123;</span><br><span class=\"line\">    query:&#123;_id:ObjectId(<span class=\"string\">&quot;6457a39c817728350ec83b9d&quot;</span>)&#125;,</span><br><span class=\"line\">    update:&#123;<span class=\"variable\">$inc</span>:&#123;favCount:1&#125;&#125;</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"><span class=\"comment\"># é»˜è®¤æƒ…å†µä¸‹ï¼ŒfindAndModifyä¼šè¿”å›ä¿®æ”¹å‰çš„â€œæ—§â€æ•°æ®ã€‚å¦‚æœå¸Œæœ›è¿”å›ä¿®æ”¹åçš„æ•°æ®ï¼Œåˆ™å¯ä»¥æŒ‡å®šnewé€‰é¡¹</span></span><br><span class=\"line\">db.books.findAndModify(&#123;</span><br><span class=\"line\">    query:&#123;_id:ObjectId(<span class=\"string\">&quot;6457a39c817728350ec83b9d&quot;</span>)&#125;,</span><br><span class=\"line\">    update:&#123;<span class=\"variable\">$inc</span>:&#123;favCount:1&#125;&#125;,</span><br><span class=\"line\">    new: <span class=\"literal\">true</span></span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n<table>\n<thead>\n<tr>\n<th>å‚æ•°</th>\n<th>æè¿°</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>&lt;filter&gt;</td>\n<td>ä¸€ä¸ªç­›é€‰å™¨å¯¹è±¡ï¼Œç”¨äºæŒ‡å®šè¦æ›´æ–°çš„æ–‡æ¡£ã€‚</td>\n</tr>\n<tr>\n<td>&lt;update&gt;</td>\n<td>ä¸€ä¸ªæ›´æ–°æ“ä½œå¯¹è±¡ï¼Œç”¨äºæŒ‡å®šå¦‚ä½•æ›´æ–°æ–‡æ¡£ã€‚å¯ä»¥ä½¿ç”¨ä¸€äº›æ“ä½œç¬¦ï¼Œä¾‹å¦‚<span class='katex-error' title='ParseError: KaTeX parse error: LaTeX-incompatible input and strict mode is set to &#039;error&#039;: Unicode text character &quot;ã€&quot; used in math mode [unicodeTextInMathMode] at position 4: setã€Ì²'>setã€</span>incã€$unsetç­‰ï¼Œä»¥æ›´æ–°æ–‡æ¡£ä¸­çš„ç‰¹å®šå­—æ®µã€‚</td>\n</tr>\n<tr>\n<td>upsert</td>\n<td>ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œç”¨äºæŒ‡å®šå¦‚æœæ‰¾ä¸åˆ°ä¸ç­›é€‰å™¨åŒ¹é…çš„æ–‡æ¡£æ—¶æ˜¯å¦åº”æ’å…¥ä¸€ä¸ªæ–°æ–‡æ¡£ã€‚å¦‚æœupsertä¸ºtrueï¼Œåˆ™ä¼šæ’å…¥ä¸€ä¸ªæ–°æ–‡æ¡£ã€‚é»˜è®¤å€¼ä¸ºfalseã€‚</td>\n</tr>\n<tr>\n<td>writeConcern</td>\n<td>ä¸€ä¸ªæ–‡æ¡£ï¼Œç”¨äºæŒ‡å®šå†™å…¥æ“ä½œçš„å®‰å…¨çº§åˆ«ã€‚å¯ä»¥æŒ‡å®šå†™å…¥æ“ä½œéœ€è¦åˆ°è¾¾çš„èŠ‚ç‚¹æ•°æˆ–ç­‰å¾…å†™å…¥æ“ä½œçš„æ—¶é—´ã€‚</td>\n</tr>\n<tr>\n<td>collation</td>\n<td>ä¸€ä¸ªæ–‡æ¡£ï¼Œç”¨äºæŒ‡å®šç”¨äºæŸ¥è¯¢çš„æ’åºè§„åˆ™ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥é€šè¿‡æŒ‡å®šlocaleå±æ€§æ¥æŒ‡å®šè¯­è¨€ç¯å¢ƒï¼Œä»è€Œå®ç°åŸºäºåŒºåŸŸè®¾ç½®çš„æ’åºã€‚</td>\n</tr>\n<tr>\n<td>arrayFilters</td>\n<td>ä¸€ä¸ªæ•°ç»„ï¼Œç”¨äºæŒ‡å®šè¦æ›´æ–°çš„æ•°ç»„å…ƒç´ ã€‚æ•°ç»„å…ƒç´ æ˜¯é€šè¿‡ä½¿ç”¨æ›´æ–°æ“ä½œç¬¦<span class='katex-error' title='ParseError: KaTeX parse error: LaTeX-incompatible input and strict mode is set to &#039;error&#039;: Unicode text character &quot;å’Œ&quot; used in math mode [unicodeTextInMathMode] at position 3: []å’ŒÌ²'>[]å’Œ</span>æ¥æŒ‡å®šçš„ã€‚</td>\n</tr>\n<tr>\n<td>hint</td>\n<td>ä¸€ä¸ªæ–‡æ¡£æˆ–å­—ç¬¦ä¸²ï¼Œç”¨äºæŒ‡å®šæŸ¥è¯¢ä½¿ç”¨çš„ç´¢å¼•ã€‚è¯¥å‚æ•°ä»…åœ¨MongoDB 4.2.1åŠä»¥ä¸Šç‰ˆæœ¬ä¸­å¯ç”¨ã€‚</td>\n</tr>\n</tbody>\n</table>\n<blockquote>\n<p>æ›´æ–°æ“ä½œç¬¦</p>\n</blockquote>\n<table>\n<thead>\n<tr>\n<th>æ“ä½œç¬¦</th>\n<th>æ ¼å¼</th>\n<th>æè¿°</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>$set</td>\n<td>{ $set: { field: value } }</td>\n<td>æŒ‡å®šä¸€ä¸ªé”®å¹¶æ›´æ–°å€¼ï¼Œè‹¥é”®ä¸å­˜åœ¨åˆ™åˆ›å»ºã€‚</td>\n</tr>\n<tr>\n<td>$unset</td>\n<td>{ $unset : { field : 1 } }</td>\n<td>åˆ é™¤ä¸€ä¸ªé”®ã€‚</td>\n</tr>\n<tr>\n<td>$inc</td>\n<td>{ $inc : { field : value } }</td>\n<td>å¯¹æ•°å€¼ç±»å‹è¿›è¡Œå¢å‡ã€‚</td>\n</tr>\n<tr>\n<td>$rename</td>\n<td>{ $rename : { old_field_name : new_field_name } }</td>\n<td>ä¿®æ”¹å­—æ®µåç§°ã€‚</td>\n</tr>\n<tr>\n<td>$push</td>\n<td>{ $push : { field : value } }</td>\n<td>å°†æ•°å€¼è¿½åŠ åˆ°æ•°ç»„ä¸­ï¼Œè‹¥æ•°ç»„ä¸å­˜åœ¨åˆ™ä¼šè¿›è¡Œåˆå§‹åŒ–ã€‚</td>\n</tr>\n<tr>\n<td>$pushAll</td>\n<td>{ $pushAll : { field : value_array } }</td>\n<td>è¿½åŠ å¤šä¸ªå€¼åˆ°ä¸€ä¸ªæ•°ç»„å­—æ®µå†…ã€‚</td>\n</tr>\n<tr>\n<td>$pull</td>\n<td>{ $pull : { field : _value } }</td>\n<td>ä»æ•°ç»„ä¸­åˆ é™¤æŒ‡å®šçš„å…ƒç´ ã€‚</td>\n</tr>\n<tr>\n<td>$addToSet</td>\n<td>{ $addToSet : { field : value } }</td>\n<td>æ·»åŠ å…ƒç´ åˆ°æ•°ç»„ä¸­ï¼Œå…·æœ‰æ’é‡åŠŸèƒ½ã€‚</td>\n</tr>\n<tr>\n<td>$pop</td>\n<td>{ $pop : { field : 1 } }</td>\n<td>åˆ é™¤æ•°ç»„çš„ç¬¬ä¸€ä¸ªæˆ–æœ€åä¸€ä¸ªå…ƒç´ ã€‚</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åªæ›´æ–°æ»¡è¶³æ¡ä»¶çš„ç¬¬ä¸€æ¡è®°å½•</p>\n</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">  db.employee.updateOne(</span></span><br><span class=\"line\"><span class=\"comment\">      &#123; &quot;salary&quot;: &#123; &quot;$gte&quot;: 8000 &#125; &#125;,</span></span><br><span class=\"line\"><span class=\"comment\">      &#123; &quot;$set&quot;: &#123; &quot;salary&quot;: 13000 &#125; &#125;</span></span><br><span class=\"line\"><span class=\"comment\">  )</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"type\">Query</span> <span class=\"variable\">query</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Query</span>(Criteria.where(<span class=\"string\">&quot;salary&quot;</span>).gte(<span class=\"number\">8000</span>));</span><br><span class=\"line\"><span class=\"type\">Update</span> <span class=\"variable\">update</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Update</span>();</span><br><span class=\"line\"><span class=\"comment\">//è®¾ç½®æ›´æ–°å±æ€§</span></span><br><span class=\"line\">update.set(<span class=\"string\">&quot;salary&quot;</span>, <span class=\"number\">13000</span>);</span><br><span class=\"line\"><span class=\"type\">UpdateResult</span> <span class=\"variable\">updateResult</span> <span class=\"operator\">=</span> mongoTemplate.updateFirst(query, update, Employee.class);</span><br><span class=\"line\"><span class=\"comment\">//è¿”å›ä¿®æ”¹çš„è®°å½•æ•°</span></span><br><span class=\"line\">System.out.println(updateResult.getModifiedCount());</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ›´æ–°æ‰€æœ‰æ»¡è¶³æ¡ä»¶çš„è®°å½•</p>\n</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">  db.employee.updateMany(</span></span><br><span class=\"line\"><span class=\"comment\">      &#123; &quot;salary&quot;: &#123; &quot;$gte&quot;: 8000 &#125; &#125;,</span></span><br><span class=\"line\"><span class=\"comment\">      &#123; &quot;$set&quot;: &#123; &quot;salary&quot;: 13000 &#125; &#125;</span></span><br><span class=\"line\"><span class=\"comment\">  )</span></span><br><span class=\"line\"><span class=\"comment\">*/</span></span><br><span class=\"line\"><span class=\"type\">Query</span> <span class=\"variable\">query</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Query</span>(Criteria.where(<span class=\"string\">&quot;salary&quot;</span>).gte(<span class=\"number\">8000</span>));</span><br><span class=\"line\"><span class=\"type\">Update</span> <span class=\"variable\">update</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Update</span>();</span><br><span class=\"line\"><span class=\"comment\">//è®¾ç½®æ›´æ–°å±æ€§</span></span><br><span class=\"line\">update.set(<span class=\"string\">&quot;salary&quot;</span>, <span class=\"number\">13000</span>);</span><br><span class=\"line\"><span class=\"type\">UpdateResult</span> <span class=\"variable\">updateResult</span> <span class=\"operator\">=</span> mongoTemplate.updateMulti(query, update, Employee.class);</span><br><span class=\"line\"><span class=\"comment\">//è¿”å›ä¿®æ”¹çš„è®°å½•æ•°</span></span><br><span class=\"line\">System.out.println(updateResult.getModifiedCount());</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ²¡æœ‰ç¬¦åˆæ¡ä»¶çš„è®°å½•åˆ™æ’å…¥æ•°æ®</p>\n</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">  db.employee.updateOne(</span></span><br><span class=\"line\"><span class=\"comment\">      &#123; &quot;salary&quot;: &#123; &quot;$gte&quot;: 8000 &#125; &#125;,</span></span><br><span class=\"line\"><span class=\"comment\">      &#123; &quot;$set&quot;: &#123; &quot;salary&quot;: 13000 &#125;, &quot;$setOnInsert&quot;: &#123; &quot;id&quot;: 11 &#125; &#125;,</span></span><br><span class=\"line\"><span class=\"comment\">      &#123; &quot;upsert&quot;: true &#125;</span></span><br><span class=\"line\"><span class=\"comment\">  )</span></span><br><span class=\"line\"><span class=\"comment\">*/</span></span><br><span class=\"line\"><span class=\"type\">Query</span> <span class=\"variable\">query</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Query</span>(Criteria.where(<span class=\"string\">&quot;salary&quot;</span>).gte(<span class=\"number\">8000</span>));</span><br><span class=\"line\"><span class=\"type\">Update</span> <span class=\"variable\">update</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Update</span>();</span><br><span class=\"line\"><span class=\"comment\">//è®¾ç½®æ›´æ–°å±æ€§</span></span><br><span class=\"line\">update.set(<span class=\"string\">&quot;salary&quot;</span>, <span class=\"number\">13000</span>);</span><br><span class=\"line\">update.setOnInsert(<span class=\"string\">&quot;id&quot;</span>,<span class=\"number\">11</span>);  <span class=\"comment\">//æŒ‡å®š_idï¼Œåªæœ‰æ²¡æœ‰åŒ¹é…åˆ°æ—¶æ‰æ’å…¥</span></span><br><span class=\"line\"><span class=\"type\">UpdateResult</span> <span class=\"variable\">updateResult</span> <span class=\"operator\">=</span> mongoTemplate.upsert(query, update, Employee.class);</span><br><span class=\"line\"><span class=\"comment\">//è¿”å›ä¿®æ”¹çš„è®°å½•æ•°</span></span><br><span class=\"line\">System.out.println(updateResult.getModifiedCount());</span><br></pre></td></tr></table></figure>\n<h2 id=\"æ›¿æ¢\">æ›¿æ¢</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Mongoè¯­æ³•</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">db.collection.replaceOne(</span><br><span class=\"line\">   &lt;filter&gt;,</span><br><span class=\"line\">   &lt;replacement&gt;,</span><br><span class=\"line\">   &#123;</span><br><span class=\"line\">     upsert: &lt;boolean&gt;,</span><br><span class=\"line\">     writeConcern: &lt;document&gt;,</span><br><span class=\"line\">     collation: &lt;document&gt;,</span><br><span class=\"line\">     hint: &lt;document|string&gt;</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><code>replaceOne</code>æ“ä½œä¼šé¦–å…ˆä½¿ç”¨æŒ‡å®šçš„ç­›é€‰æ¡ä»¶æ¥æŸ¥æ‰¾åŒ¹é…çš„æ–‡æ¡£ï¼Œç„¶åç”¨æä¾›çš„æ–°æ–‡æ¡£å®Œå…¨æ›¿æ¢æ‰åŸå§‹æ–‡æ¡£ï¼Œä¹Ÿå°±æ˜¯è¯´<code>replaceOne</code>æ˜¯æ•´ä½“æ›¿æ¢ï¼Œè€Œä¸æ˜¯ä¿®æ”¹æ–‡æ¡£ä¸­çš„æŸäº›å­—æ®µã€‚</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>å‚æ•°</th>\n<th>æè¿°</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>&lt;filter&gt;</td>\n<td>ä¸€ä¸ªç­›é€‰å™¨å¯¹è±¡ï¼Œç”¨äºæŒ‡å®šè¦æ›¿æ¢çš„æ–‡æ¡£ã€‚åªæœ‰ä¸ç­›é€‰å™¨å¯¹è±¡åŒ¹é…çš„ç¬¬ä¸€ä¸ªæ–‡æ¡£æ‰ä¼šè¢«æ›¿æ¢ã€‚</td>\n</tr>\n<tr>\n<td>&lt;replacement&gt;</td>\n<td>ä¸€ä¸ªæ›¿æ¢æ–‡æ¡£å¯¹è±¡ï¼Œç”¨äºæŒ‡å®šç”¨äºæ›¿æ¢åŸå§‹æ–‡æ¡£çš„æ–°æ–‡æ¡£ã€‚æ›¿æ¢æ–‡æ¡£å¿…é¡»åŒ…å«æ‰€æœ‰è¦åœ¨åŸå§‹æ–‡æ¡£ä¸­ä¿®æ”¹æˆ–æ›¿æ¢çš„å­—æ®µã€‚</td>\n</tr>\n<tr>\n<td>upsert</td>\n<td>ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºå¦‚æœæ‰¾ä¸åˆ°ä¸ç­›é€‰å™¨åŒ¹é…çš„æ–‡æ¡£æ—¶æ˜¯å¦åº”æ’å…¥ä¸€ä¸ªæ–°æ–‡æ¡£ã€‚å¦‚æœè®¾ç½®ä¸ºtrueï¼Œåˆ™ä¼šæ’å…¥ä¸€ä¸ªæ–°æ–‡æ¡£ã€‚é»˜è®¤ä¸ºfalseã€‚</td>\n</tr>\n<tr>\n<td>writeConcern</td>\n<td>ä¸€ä¸ªæ–‡æ¡£ï¼Œç”¨äºæŒ‡å®šå†™å…¥æ“ä½œçš„å®‰å…¨çº§åˆ«ã€‚å¯ä»¥æŒ‡å®šå†™å…¥æ“ä½œéœ€è¦åˆ°è¾¾çš„èŠ‚ç‚¹æ•°æˆ–ç­‰å¾…å†™å…¥æ“ä½œçš„æ—¶é—´ã€‚</td>\n</tr>\n<tr>\n<td>collation</td>\n<td>ä¸€ä¸ªæ–‡æ¡£ï¼Œç”¨äºæŒ‡å®šç”¨äºæŸ¥è¯¢çš„æ’åºè§„åˆ™ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥é€šè¿‡æŒ‡å®šlocaleå±æ€§æ¥æŒ‡å®šè¯­è¨€ç¯å¢ƒï¼Œä»è€Œå®ç°åŸºäºåŒºåŸŸè®¾ç½®çš„æ’åºã€‚</td>\n</tr>\n<tr>\n<td>hint</td>\n<td>ä¸€ä¸ªæ–‡æ¡£æˆ–å­—ç¬¦ä¸²ï¼Œç”¨äºæŒ‡å®šæŸ¥è¯¢ä½¿ç”¨çš„ç´¢å¼•ã€‚è¯¥å‚æ•°ä»…åœ¨MongoDB 4.2.1åŠä»¥ä¸Šç‰ˆæœ¬ä¸­å¯ç”¨</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç¤ºä¾‹</p>\n</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">db.collection.replaceOne(</span></span><br><span class=\"line\"><span class=\"comment\">   &#123; &quot;name&quot;: &quot;John&quot; &#125;,  // ç­›é€‰æ¡ä»¶ï¼ŒåŒ¹é…nameä¸ºJohnçš„æ–‡æ¡£</span></span><br><span class=\"line\"><span class=\"comment\">   &#123;                     // æ›¿æ¢æ–‡æ¡£ï¼Œç”¨äºæ›¿æ¢åŒ¹é…åˆ°çš„æ–‡æ¡£</span></span><br><span class=\"line\"><span class=\"comment\">     &quot;name&quot;: &quot;Peter&quot;,    // æ–°çš„nameå­—æ®µå€¼ä¸ºPeter</span></span><br><span class=\"line\"><span class=\"comment\">     &quot;age&quot;: 30           // æ–°å¢ageå­—æ®µï¼Œå€¼ä¸º30</span></span><br><span class=\"line\"><span class=\"comment\">   &#125;</span></span><br><span class=\"line\"><span class=\"comment\">)</span></span><br><span class=\"line\"><span class=\"comment\">*/</span></span><br><span class=\"line\"><span class=\"type\">Query</span> <span class=\"variable\">query</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Query</span>(Criteria.where(<span class=\"string\">&quot;name&quot;</span>).is(<span class=\"string\">&quot;John&quot;</span>));</span><br><span class=\"line\"><span class=\"type\">Employee</span> <span class=\"variable\">replacement</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Employee</span>();</span><br><span class=\"line\">replacement.setName(<span class=\"string\">&quot;Peter&quot;</span>);</span><br><span class=\"line\">replacement.setAge(<span class=\"number\">30</span>);</span><br><span class=\"line\">mongoTemplate.findAndReplace(query, replacement);</span><br></pre></td></tr></table></figure>\n<h2 id=\"åˆ é™¤\">åˆ é™¤</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Mongoè¯­æ³•</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æŒ‰æ¡ä»¶åˆ é™¤å¤šä¸ªæ–‡æ¡£</span></span><br><span class=\"line\">db.collection.deleteMany(&lt;filter&gt;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŒ‰æ¡ä»¶åˆ é™¤å•ä¸ªæ–‡æ¡£</span></span><br><span class=\"line\">db.collection.deleteOne(&lt;filter&gt;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å…ˆæŸ¥è¯¢ååˆ é™¤ï¼Œè¿”å›æŸ¥è¯¢æ¡ä»¶å¯¹åº”çš„æ–‡æ¡£ï¼Œsortæ˜¯å¯é€‰é¡¹</span></span><br><span class=\"line\">db.collection.findOneAndDelete(&lt;filter&gt;,&#123;<span class=\"built_in\">sort</span>:&#123;field:1&#125;&#125;)</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ é™¤æ‰€æœ‰æ–‡æ¡£</p>\n</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// db.employee.deleteMany(&#123;&#125;)</span></span><br><span class=\"line\">mongoTemplate.remove(<span class=\"keyword\">new</span> <span class=\"title class_\">Query</span>(),Employee.class);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// db.employee.drop()</span></span><br><span class=\"line\"><span class=\"comment\">// æ¸…ç©ºæ•°æ®ä¹Ÿå¯ä»¥ä½¿ç”¨dropæ–¹æ³•ï¼Œä½†æ˜¯è¿™æ ·ä¼šåˆ é™¤ç´¢å¼•</span></span><br><span class=\"line\">mongoTemplate.dropCollection(Employee.class);</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æŒ‰æ¡ä»¶åˆ é™¤æ–‡æ¡£</p>\n</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// db.employee.deleteMany(&#123; &quot;salary&quot;: &#123; &quot;$gte&quot;: 10000 &#125; &#125;)</span></span><br><span class=\"line\"><span class=\"type\">Query</span> <span class=\"variable\">query</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Query</span>(Criteria.where(<span class=\"string\">&quot;salary&quot;</span>).gte(<span class=\"number\">10000</span>));</span><br><span class=\"line\">mongoTemplate.remove(query, Employee.class);</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ é™¤æŸ¥è¯¢åˆ°çš„ç¬¬ä¸€ä¸ªæ–‡æ¡£</p>\n</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// db.employee.deleteOne(&#123; &quot;salary&quot;: &#123; &quot;$gte&quot;: 10000 &#125; &#125;)</span></span><br><span class=\"line\"><span class=\"type\">Query</span> <span class=\"variable\">query</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Query</span>(Criteria.where(<span class=\"string\">&quot;salary&quot;</span>).gte(<span class=\"number\">10000</span>));</span><br><span class=\"line\">query.limit(<span class=\"number\">1</span>);</span><br><span class=\"line\">mongoTemplate.remove(query, Employee.class);</span><br></pre></td></tr></table></figure>\n<h2 id=\"æ‰¹é‡æ“ä½œ\">æ‰¹é‡æ“ä½œ</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>bulkwrite()æ–¹æ³•æä¾›äº†æ‰§è¡Œæ‰¹é‡æ’å…¥ã€æ›´æ–°å’Œåˆ é™¤æ“ä½œçš„èƒ½åŠ›ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>bulkWrite()æ”¯æŒä»¥ä¸‹å†™æ“ä½œ:</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">insertOne</li>\n<li class=\"lvl-4\">updateOne</li>\n<li class=\"lvl-4\">updateMany</li>\n<li class=\"lvl-4\">replaceOne</li>\n<li class=\"lvl-4\">deleteOne</li>\n<li class=\"lvl-4\">deleteMany</li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<p>ç¤ºä¾‹</p>\n</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.hanqf;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> lombok.AllArgsConstructor;</span><br><span class=\"line\"><span class=\"keyword\">import</span> lombok.Data;</span><br><span class=\"line\"><span class=\"keyword\">import</span> lombok.NoArgsConstructor;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.junit.jupiter.api.Test;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.boot.test.context.SpringBootTest;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.annotation.Id;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.mongodb.core.BulkOperations;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.mongodb.core.MongoTemplate;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.mongodb.core.mapping.Document;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.mongodb.core.query.Criteria;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.mongodb.core.query.Query;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.mongodb.core.query.Update;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Arrays;</span><br><span class=\"line\"><span class=\"meta\">@SpringBootTest</span></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">BulkWriteTests</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> MongoTemplate mongoTemplate;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">    db.pizzas.insertMany( [</span></span><br><span class=\"line\"><span class=\"comment\">      &#123; _id: 0, type: &quot;pepperoni&quot;, size: &quot;small&quot;, price: 4 &#125;,</span></span><br><span class=\"line\"><span class=\"comment\">      &#123; _id: 1, type: &quot;cheese&quot;, size: &quot;medium&quot;, price: 7 &#125;,</span></span><br><span class=\"line\"><span class=\"comment\">      &#123; _id: 2, type: &quot;vegan&quot;, size: &quot;large&quot;, price: 8 &#125;</span></span><br><span class=\"line\"><span class=\"comment\">    ] )</span></span><br><span class=\"line\"><span class=\"comment\">    */</span></span><br><span class=\"line\">    <span class=\"meta\">@Test</span></span><br><span class=\"line\">    <span class=\"keyword\">void</span> <span class=\"title function_\">insertManyPizzas</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        mongoTemplate.insertAll(Arrays.asList(</span><br><span class=\"line\">                <span class=\"keyword\">new</span> <span class=\"title class_\">Pizza</span>(<span class=\"number\">0</span>, <span class=\"string\">&quot;pepperoni&quot;</span>, <span class=\"string\">&quot;small&quot;</span>, <span class=\"number\">4</span>),</span><br><span class=\"line\">                <span class=\"keyword\">new</span> <span class=\"title class_\">Pizza</span>(<span class=\"number\">1</span>, <span class=\"string\">&quot;cheese&quot;</span>, <span class=\"string\">&quot;medium&quot;</span>, <span class=\"number\">7</span>),</span><br><span class=\"line\">                <span class=\"keyword\">new</span> <span class=\"title class_\">Pizza</span>(<span class=\"number\">2</span>, <span class=\"string\">&quot;vegan&quot;</span>, <span class=\"string\">&quot;large&quot;</span>, <span class=\"number\">8</span>)</span><br><span class=\"line\">        ));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">    db.pizzas.bulkWrite( [</span></span><br><span class=\"line\"><span class=\"comment\">      &#123; insertOne: &#123; document: &#123; _id: 3, type: &quot;beef&quot;, size: &quot;medium&quot;, price: 6 &#125; &#125; &#125;,</span></span><br><span class=\"line\"><span class=\"comment\">      &#123; insertOne: &#123; document: &#123; _id: 4, type: &quot;sausage&quot;, size: &quot;large&quot;, price: 10 &#125; &#125; &#125;,</span></span><br><span class=\"line\"><span class=\"comment\">      &#123; updateOne: &#123;</span></span><br><span class=\"line\"><span class=\"comment\">          filter: &#123; type: &quot;cheese&quot; &#125;,</span></span><br><span class=\"line\"><span class=\"comment\">          update: &#123; $set: &#123; price: 8 &#125; &#125;</span></span><br><span class=\"line\"><span class=\"comment\">      &#125; &#125;,</span></span><br><span class=\"line\"><span class=\"comment\">      &#123; deleteOne: &#123; filter: &#123; type: &quot;pepperoni&quot;&#125; &#125; &#125;,</span></span><br><span class=\"line\"><span class=\"comment\">      &#123; replaceOne: &#123;</span></span><br><span class=\"line\"><span class=\"comment\">          filter: &#123; type: &quot;vegan&quot; &#125;,</span></span><br><span class=\"line\"><span class=\"comment\">          replacement: &#123; type: &quot;tofu&quot;, size: &quot;small&quot;, price: 4 &#125;</span></span><br><span class=\"line\"><span class=\"comment\">      &#125; &#125;</span></span><br><span class=\"line\"><span class=\"comment\">    ] )</span></span><br><span class=\"line\"><span class=\"comment\">    */</span></span><br><span class=\"line\">    <span class=\"meta\">@Test</span></span><br><span class=\"line\">    <span class=\"keyword\">void</span> <span class=\"title function_\">performBulkWrite</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">BulkOperations</span> <span class=\"variable\">bulkOperations</span> <span class=\"operator\">=</span> mongoTemplate.bulkOps(BulkOperations.BulkMode.ORDERED, Pizza.class);</span><br><span class=\"line\"></span><br><span class=\"line\">        bulkOperations.insert(Arrays.asList(</span><br><span class=\"line\">                <span class=\"keyword\">new</span> <span class=\"title class_\">Pizza</span>(<span class=\"number\">3</span>, <span class=\"string\">&quot;beef&quot;</span>, <span class=\"string\">&quot;medium&quot;</span>, <span class=\"number\">6</span>),</span><br><span class=\"line\">                <span class=\"keyword\">new</span> <span class=\"title class_\">Pizza</span>(<span class=\"number\">4</span>, <span class=\"string\">&quot;sausage&quot;</span>, <span class=\"string\">&quot;large&quot;</span>, <span class=\"number\">10</span>)</span><br><span class=\"line\">        ));</span><br><span class=\"line\"></span><br><span class=\"line\">        bulkOperations.updateOne(</span><br><span class=\"line\">                Query.query(Criteria.where(<span class=\"string\">&quot;type&quot;</span>).is(<span class=\"string\">&quot;cheese&quot;</span>)),</span><br><span class=\"line\">                <span class=\"keyword\">new</span> <span class=\"title class_\">Update</span>().set(<span class=\"string\">&quot;price&quot;</span>, <span class=\"number\">8</span>)</span><br><span class=\"line\">        );</span><br><span class=\"line\"></span><br><span class=\"line\">        bulkOperations.remove(</span><br><span class=\"line\">                Query.query(Criteria.where(<span class=\"string\">&quot;type&quot;</span>).is(<span class=\"string\">&quot;pepperoni&quot;</span>)).limit(<span class=\"number\">1</span>)</span><br><span class=\"line\">        );</span><br><span class=\"line\"></span><br><span class=\"line\">        bulkOperations.replaceOne(</span><br><span class=\"line\">                Query.query(Criteria.where(<span class=\"string\">&quot;type&quot;</span>).is(<span class=\"string\">&quot;vegan&quot;</span>)),</span><br><span class=\"line\">                <span class=\"keyword\">new</span> <span class=\"title class_\">Pizza</span>(<span class=\"literal\">null</span>, <span class=\"string\">&quot;tofu&quot;</span>, <span class=\"string\">&quot;small&quot;</span>, <span class=\"number\">4</span>)</span><br><span class=\"line\">        );</span><br><span class=\"line\"></span><br><span class=\"line\">        bulkOperations.execute();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Data</span></span><br><span class=\"line\">    <span class=\"meta\">@AllArgsConstructor</span></span><br><span class=\"line\">    <span class=\"meta\">@NoArgsConstructor</span></span><br><span class=\"line\">    <span class=\"meta\">@Document(&quot;pizza&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Pizza</span> &#123;</span><br><span class=\"line\">        <span class=\"meta\">@Id</span></span><br><span class=\"line\">        <span class=\"keyword\">private</span> Integer _id;</span><br><span class=\"line\">        <span class=\"keyword\">private</span> String type;</span><br><span class=\"line\">        <span class=\"keyword\">private</span> String size;</span><br><span class=\"line\">        <span class=\"keyword\">private</span> Integer price;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç»å¦‚ä½•ä½¿ç”¨SpringBootå®ç°MongoDB7.0çš„å•é›†åˆçš„CURDæ“ä½œ SpringBootç‰ˆæœ¬3.2.3ï¼ŒMongoDBç‰ˆæœ¬7.0.6 MongoDB CRUD Operations SQL to MongoDB Mapping Chart MongoDB7.0--SpringBootèšåˆæ“ä½œ spring-boot ä¸ MongoDB çš„ç‰ˆæœ¬å¯¹åº”å…³ç³» spring-data-mongodbä¸MongoDBç‰ˆæœ¬å¯¹åº”å…³ç³»å¯ä»¥å‚çœ‹å®˜æ–¹æ–‡æ¡£ spring-boot-starter-data-mongodb ä¸ spring-data-mongodb ç‰ˆæœ¬å¯¹åº”å…³ç³» spring-boot-starter-data-mongodb ç‰ˆæœ¬ spring-data-mongodb ç‰ˆæœ¬ MongoDB Server ç‰ˆæœ¬ Java Driver Version 3.2.x 4.2.x 6.0.x,7.0.x 4.11.x 3.1.x 4.1.x 6.0.x,7.0.x 4.9.x 3.0.x 4.0.x 6.0.x 4.7.x 2.7.x 3.4.x 5.0.x 4.6.x 2.6.x 3.3.x 5.0.x 4.4.x 2.5.x 3.2.x 4.4.x 4.1.x 2.4.x 3.1.x 4.4.x 4.1.x 2.3.x 3.0.x 4.4.x 4.0.x 2.2.x 2.2.x 4.2.x 3.11.x 2.1.x 2.1.x 4.0.x 3.8.x 2.0.x 2.0.x 3.4.x 3.5.x 1.10.x 1.10.x 2.4.x 2.10.x,2.11.x Mongoçš„Javaé©±åŠ¨ï¼Œåœ¨3.7.xåŠä»¥åçš„ç‰ˆæœ¬å«åšmongodb-driver-syncï¼Œä»¥å‰çš„ç‰ˆæœ¬å«åšmongo-java-driver MongoDB ä¸ Java Driver å…¼å®¹æ€§ SpringBootæ•´åˆMongoDB å¼•å…¥ä¾èµ– 1234&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-data-mongodb&lt;/artifactId&gt;&lt;/dependency&gt; é…ç½®yml 1234567891011121314spring: data: mongodb: uri: mongodb://root:password@127.0.0.1:27017/mytest?authSource=admin #uriç­‰åŒäºä¸‹é¢çš„é…ç½® # database: mytest # æ•°æ®åº“å # host: 127.0.0.1 # port: 27017 # username: root # password: password #a uthentication-database: admin # å¤åˆ¶é›† # uri: mongodb://user:password@127.0.0.1:27040,127.0.0.1:27041,127.0.0.1:27042/mytest?authSource=admin&amp;readPreference=primaryPreferred é…ç½®ç±»:å»æ‰_classå±æ€§ 12345678910111213141516171819202122@Configurationpublic class MongoConfig &#123; /** * å®šåˆ¶TypeMapperå»æ‰_classå±æ€§ */ @Bean MappingMongoConverter mappingMongoConverter( MongoDatabaseFactory mongoDatabaseFactory, MongoMappingContext context, MongoCustomConversions conversions) &#123; DbRefResolver dbRefResolver = new DefaultDbRefResolver(mongoDatabaseFactory); MappingMongoConverter mappingMongoConverter = new MappingMongoConverter(dbRefResolver, context); mappingMongoConverter.setCustomConversions(conversions); //æ„é€ DefaultMongoTypeMapperï¼Œå°†typeKeyè®¾ç½®ä¸ºç©ºå€¼ mappingMongoConverter.setTypeMapper(new DefaultMongoTypeMapper(null)); return mappingMongoConverter; &#125;&#125; æŸ¥è¯¢ Mongoè¯­æ³• 12345678910111213141516171819# æŸ¥è¯¢é›†åˆä¸­çš„è‹¥å¹²æ–‡æ¡£db.collection.find(query, projection)# æŸ¥è¯¢é›†åˆä¸­çš„ç¬¬ä¸€ä¸ªæ–‡æ¡£db.collection.findOne(query, projection)# å¦‚æœä½ éœ€è¦ä»¥æ˜“è¯»çš„æ–¹å¼æ¥è¯»å–æ•°æ®ï¼Œå¯ä»¥ä½¿ç”¨pretty()æ–¹æ³•db.collection.find().pretty()# æ’åºï¼Œ1 ä¸ºå‡åºæ’åˆ—ï¼Œè€Œ -1 æ˜¯ç”¨äºé™åºæ’åˆ—db.collection.find(query, projection).sort(&#123;field:-1&#125;)# åˆ†é¡µ# .skip(16) è¡¨ç¤ºè·³è¿‡å‰é¢ 16 æ¡è®°å½•ï¼Œå³å‰ä¸¤é¡µçš„æ‰€æœ‰è®°å½•.# .limit(8) è¡¨ç¤ºè¿”å› 8 æ¡è®°å½•ï¼Œå³ç¬¬ä¸‰é¡µçš„æ‰€æœ‰è®°å½•ã€‚db.collection.find().skip(16).limit(8)# æŸ¥è¯¢è®°å½•æ•°db.collection.countDocuments() query ï¼šå¯é€‰ï¼Œä½¿ç”¨æŸ¥è¯¢æ“ä½œç¬¦æŒ‡å®šæŸ¥è¯¢æ¡ä»¶ projection ï¼šå¯é€‰ï¼Œä½¿ç”¨æŠ•å½±æ“ä½œç¬¦æŒ‡å®šè¿”å›çš„é”®ã€‚æŸ¥è¯¢æ—¶è¿”å›æ–‡æ¡£ä¸­æ‰€æœ‰é”®å€¼ï¼Œ åªéœ€çœç•¥è¯¥å‚æ•°å³å¯ï¼ˆé»˜è®¤çœç•¥ï¼‰ã€‚æŠ•å½±æ—¶ï¼Œ_idä¸º1çš„æ—¶å€™ï¼Œå…¶ä»–å­—æ®µå¿…é¡»æ˜¯1ï¼›_idæ˜¯0çš„æ—¶å€™ï¼Œå…¶ä»–å­—æ®µå¯ä»¥æ˜¯0ï¼›å¦‚æœæ²¡æœ‰_idå­—æ®µçº¦æŸï¼Œå¤šä¸ªå…¶ä»–å­—æ®µå¿…é¡»åŒä¸º0æˆ–åŒä¸º1ã€‚ æŸ¥è¯¢æ“ä½œç¬¦ æ“ä½œç¬¦ è§£é‡Š ç¤ºä¾‹ ç¤ºä¾‹è§£é‡Š $lt å°äº db.collection.find(&#123; &quot;age&quot;: &#123; &quot;$lt&quot;: 25 &#125; &#125;) æŸ¥è¯¢å¹´é¾„å°äº 25 çš„æ–‡æ¡£ $lte å°äºç­‰äº db.collection.find(&#123; &quot;age&quot;: &#123; &quot;$lte&quot;: 25 &#125; &#125;) æŸ¥è¯¢å¹´é¾„å°äºç­‰äº 25 çš„æ–‡æ¡£ $gt å¤§äº db.collection.find(&#123; &quot;age&quot;: &#123; &quot;$gt&quot;: 25 &#125; &#125;) æŸ¥è¯¢å¹´é¾„å¤§äº 25 çš„æ–‡æ¡£ $gte å¤§äºç­‰äº db.collection.find(&#123; &quot;age&quot;: &#123; &quot;$gte&quot;: 25 &#125; &#125;) æŸ¥è¯¢å¹´é¾„å¤§äºç­‰äº 25 çš„æ–‡æ¡£ $ne ä¸ç­‰äº db.collection.find(&#123; &quot;age&quot;: &#123; &quot;$ne&quot;: 25 &#125; &#125;) æŸ¥è¯¢å¹´é¾„ä¸ç­‰äº 25 çš„æ–‡æ¡£ $in åœ¨æŒ‡å®šæ•°ç»„ä¸­ db.collection.find(&#123; &quot;age&quot;: &#123; &quot;$in&quot;: [20, 25] &#125; &#125;) æŸ¥è¯¢å¹´é¾„å­˜åœ¨å¹¶ä¸”åœ¨æŒ‡å®šæ•°ç»„ä¸­çš„æ–‡æ¡£ $nin ä¸åœ¨æŒ‡å®šæ•°ç»„ä¸­ db.collection.find(&#123; &quot;age&quot;: &#123; &quot;$nin&quot;: [20, 25] &#125; &#125;) æŸ¥è¯¢å¹´é¾„ä¸å­˜åœ¨æˆ–è€…ä¸åœ¨æŒ‡å®šæ•°ç»„ä¸­çš„æ–‡æ¡£ $or åŒ¹é…ä¸¤ä¸ªæˆ–å¤šä¸ªæ¡ä»¶ä¸­çš„ä¸€ä¸ª db.collection.find(&#123; &quot;$or&quot;: [ &#123; &quot;age&quot;: 20 &#125;, &#123; &quot;salary&quot;: &#123; &quot;$gt&quot;: 8000 &#125; &#125; ] &#125;) æŸ¥è¯¢å¹´é¾„ä¸º 20 æˆ–è€…è–ªèµ„å¤§äº 8000 çš„æ–‡æ¡£ $and åŒ¹é…å…¨éƒ¨æ¡ä»¶ db.collection.find(&#123; &quot;$and&quot;: [ &#123; &quot;age&quot;: 20 &#125;, &#123; &quot;salary&quot;: &#123; &quot;$gt&quot;: 8000 &#125; &#125; ] &#125;) æŸ¥è¯¢å¹´é¾„ä¸º 20 å¹¶ä¸”è–ªèµ„å¤§äº 8000 çš„æ–‡æ¡£ $all åŒ¹é…æ•°ç»„ä¸­æ‰€æœ‰å…ƒç´ æ»¡è¶³æŒ‡å®šæ¡ä»¶ db.collection.find(&#123; &quot;tags&quot;: &#123; &quot;$all&quot;: [ &#123; &quot;$elemMatch&quot;: &#123; &quot;tagKey&quot;: &quot;color&quot;, &quot;tagValue&quot;: &quot;red&quot; &#125; &#125;, &#123; &quot;$elemMatch&quot;: &#123; &quot;tagKey&quot;: &quot;size&quot;, &quot;tagValue&quot;: &quot;XL&quot; &#125; &#125; ] &#125; &#125;) æŸ¥è¯¢åŒ…å« tagKey ä¸º â€œcolorâ€ï¼ŒtagValue ä¸º â€œredâ€ çš„æ ‡ç­¾ï¼Œå¹¶ä¸”åŒ…å« tagKey ä¸º â€œsizeâ€ï¼ŒtagValue ä¸º â€œXLâ€ çš„æ ‡ç­¾çš„æ–‡æ¡£ $elemMatch åŒ¹é…æ•°ç»„ä¸­è‡³å°‘ä¸€ä¸ªå…ƒç´ æ»¡è¶³æŒ‡å®šæ¡ä»¶ db.collection.find(&#123; &quot;tags&quot;: &#123; &quot;$elemMatch&quot;: &#123; &quot;tagKey&quot;: &quot;color&quot;, &quot;tagValue&quot;: &quot;blue&quot; &#125; &#125; &#125;) æŸ¥è¯¢åŒ…å« tagKey ä¸º â€œcolorâ€ï¼ŒtagValue åŒ…å« â€œblueâ€ çš„æ ‡ç­¾çš„æ–‡æ¡£ $text å…¨æ–‡æœç´¢ db.collection.find(&#123; &quot;$text&quot;: &#123; &quot;$search&quot;: &quot;searchTerm&quot; &#125; &#125;) è¿›è¡Œå…¨æ–‡æœç´¢ï¼ŒæŸ¥æ‰¾åŒ…å« â€œsearchTermâ€ çš„æ–‡æ¡£ $type æŒ‡å®šå­—æ®µç±»å‹ db.collection.find(&#123; &quot;field&quot;: &#123; &quot;$type&quot;: &quot;string&quot; &#125; &#125;) æŸ¥è¯¢æŒ‡å®šå­—æ®µç±»å‹ä¸ºå­—ç¬¦ä¸²çš„æ–‡æ¡£ $size æ•°ç»„é•¿åº¦ db.collection.find(&#123; &quot;field&quot;: &#123; &quot;$size&quot;: sizeValue &#125; &#125;) æŸ¥è¯¢æŒ‡å®šå­—æ®µæ•°ç»„é•¿åº¦ä¸º sizeValue çš„æ–‡æ¡£ $exists å­—æ®µå­˜åœ¨ db.collection.find(&#123; &quot;field&quot;: &#123; &quot;$exists&quot;: true &#125; &#125;) æŸ¥è¯¢æŒ‡å®šå­—æ®µå­˜åœ¨çš„æ–‡æ¡£ $mod å–æ¨¡ db.collection.find(&#123; &quot;field&quot;: &#123; &quot;$mod&quot;: [divisor, remainder] &#125; &#125;) æŸ¥è¯¢æŒ‡å®šå­—æ®µå–æ¨¡åç¬¦åˆç»™å®šé™¤æ•°å’Œä½™æ•°çš„æ–‡æ¡£ SpringBootä»£ç ç¤ºä¾‹ æ“ä½œorg.bson.Documentå¯¹è±¡ï¼Œæ— éœ€åˆ›å»ºå®ä½“æ˜ å°„å¯¹è±¡ï¼Œä½†æ“ä½œæ—¶éœ€è¦æŒ‡å®šé›†åˆåç§° 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323324325326327328329330331332333334335336337338339340341342343344345346347348349350351352353354355356357358359360361362363364365366367368369370371372373374375376package com.hanqf;import org.bson.Document;import org.junit.jupiter.api.Test;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.boot.test.context.SpringBootTest;import org.springframework.data.mongodb.core.MongoTemplate;import org.springframework.data.mongodb.core.query.BasicQuery;import org.springframework.data.mongodb.core.query.Criteria;import org.springframework.data.mongodb.core.query.Query;import java.util.Arrays;import java.util.List;import java.util.Map;@SpringBootTestclass BasicTests &#123; @Autowired private MongoTemplate mongoTemplate; /* // åˆå§‹åŒ–æ•°æ® db.collection.insertMany([ &#123; &quot;name&quot;: &quot;item1&quot;, &quot;age&quot;: 20, &quot;salary&quot;: 5000, &quot;colors&quot;: [&quot;red&quot;, &quot;blue&quot;, &quot;green&quot;], &quot;sizes&quot;: [&quot;S&quot;, &quot;M&quot;, &quot;L&quot;], &quot;tags&quot;: [ &#123; &quot;tagKey&quot;: &quot;color&quot;, &quot;tagValue&quot;: &quot;red&quot; &#125;, &#123; &quot;tagKey&quot;: &quot;size&quot;, &quot;tagValue&quot;: &quot;M&quot; &#125;, &#123; &quot;tagKey&quot;: &quot;style&quot;, &quot;tagValue&quot;: &quot;casual&quot; &#125; ] &#125;, &#123; &quot;name&quot;: &quot;item2&quot;, &quot;age&quot;: 30, &quot;salary&quot;: 8000, &quot;colors&quot;: [&quot;green&quot;, &quot;yellow&quot;], &quot;sizes&quot;: [&quot;M&quot;, &quot;L&quot;, &quot;XL&quot;], &quot;tags&quot;: [ &#123; &quot;tagKey&quot;: &quot;color&quot;, &quot;tagValue&quot;: &quot;blue&quot; &#125;, &#123; &quot;tagKey&quot;: &quot;size&quot;, &quot;tagValue&quot;: &quot;XL&quot; &#125;, &#123; &quot;tagKey&quot;: &quot;style&quot;, &quot;tagValue&quot;: &quot;formal&quot; &#125; ] &#125;, &#123; &quot;name&quot;: &quot;item3&quot;, &quot;age&quot;: 25, &quot;salary&quot;: 10000, &quot;colors&quot;: [&quot;red&quot;, &quot;green&quot;], &quot;sizes&quot;: [&quot;L&quot;, &quot;XL&quot;], &quot;tags&quot;: [ &#123; &quot;tagKey&quot;: &quot;color&quot;, &quot;tagValue&quot;: &quot;green&quot; &#125;, &#123; &quot;tagKey&quot;: &quot;size&quot;, &quot;tagValue&quot;: &quot;L&quot; &#125;, &#123; &quot;tagKey&quot;: &quot;style&quot;, &quot;tagValue&quot;: &quot;casual&quot; &#125; ] &#125; ]); */ @Test void initializeData() &#123; List&lt;Document&gt; documents = Arrays.asList( // æ–‡æ¡£1 new Document().append(&quot;name&quot;, &quot;item1&quot;) .append(&quot;age&quot;, 20) .append(&quot;salary&quot;, 5000) .append(&quot;colors&quot;, Arrays.asList(&quot;red&quot;, &quot;blue&quot;, &quot;green&quot;)) .append(&quot;sizes&quot;, Arrays.asList(&quot;S&quot;, &quot;M&quot;, &quot;L&quot;)) .append(&quot;tags&quot;, Arrays.asList( new Document().append(&quot;tagKey&quot;, &quot;color&quot;) .append(&quot;tagValue&quot;, &quot;red&quot;), new Document().append(&quot;tagKey&quot;, &quot;size&quot;) .append(&quot;tagValue&quot;, &quot;M&quot;), new Document().append(&quot;tagKey&quot;, &quot;style&quot;) .append(&quot;tagValue&quot;, &quot;casual&quot;) )), // æ–‡æ¡£2 new Document().append(&quot;name&quot;, &quot;item2&quot;) .append(&quot;age&quot;, 30) .append(&quot;salary&quot;, 8000) .append(&quot;colors&quot;, Arrays.asList(&quot;green&quot;, &quot;yellow&quot;)) .append(&quot;sizes&quot;, Arrays.asList(&quot;M&quot;, &quot;L&quot;, &quot;XL&quot;)) .append(&quot;tags&quot;, Arrays.asList( new Document().append(&quot;tagKey&quot;, &quot;color&quot;) .append(&quot;tagValue&quot;, &quot;blue&quot;), new Document().append(&quot;tagKey&quot;, &quot;size&quot;) .append(&quot;tagValue&quot;, &quot;XL&quot;), new Document().append(&quot;tagKey&quot;, &quot;style&quot;) .append(&quot;tagValue&quot;, &quot;formal&quot;) )), // æ–‡æ¡£3 new Document().append(&quot;name&quot;, &quot;item3&quot;) .append(&quot;age&quot;, 25) .append(&quot;salary&quot;, 10000) .append(&quot;colors&quot;, Arrays.asList(&quot;red&quot;, &quot;green&quot;)) .append(&quot;sizes&quot;, Arrays.asList(&quot;L&quot;, &quot;XL&quot;)) .append(&quot;tags&quot;, Arrays.asList( new Document().append(&quot;tagKey&quot;, &quot;color&quot;) .append(&quot;tagValue&quot;, &quot;green&quot;), new Document().append(&quot;tagKey&quot;, &quot;size&quot;) .append(&quot;tagValue&quot;, &quot;L&quot;), new Document().append(&quot;tagKey&quot;, &quot;style&quot;) .append(&quot;tagValue&quot;, &quot;casual&quot;) )) ); // è¿™é‡Œè¦æŒ‡å®šé›†åˆåç§° mongoTemplate.insert(documents, &quot;collection&quot;); &#125; /** * ä¹Ÿå¯ä»¥é€šè¿‡jsonæ¥æ„å»ºDocumentå¯¹è±¡ */ @Test void initializeData2() &#123; List&lt;String&gt; jsonList = new ArrayList&lt;&gt;(); jsonList.add(&quot;&quot;&quot; &#123; &quot;name&quot;: &quot;item1&quot;, &quot;age&quot;: 20, &quot;salary&quot;: 5000, &quot;colors&quot;: [&quot;red&quot;, &quot;blue&quot;, &quot;green&quot;], &quot;sizes&quot;: [&quot;S&quot;, &quot;M&quot;, &quot;L&quot;], &quot;tags&quot;: [ &#123; &quot;tagKey&quot;: &quot;color&quot;, &quot;tagValue&quot;: &quot;red&quot; &#125;, &#123; &quot;tagKey&quot;: &quot;size&quot;, &quot;tagValue&quot;: &quot;M&quot; &#125;, &#123; &quot;tagKey&quot;: &quot;style&quot;, &quot;tagValue&quot;: &quot;casual&quot; &#125; ] &#125; &quot;&quot;&quot;); jsonList.add(&quot;&quot;&quot; &#123; &quot;name&quot;: &quot;item2&quot;, &quot;age&quot;: 30, &quot;salary&quot;: 8000, &quot;colors&quot;: [&quot;green&quot;, &quot;yellow&quot;], &quot;sizes&quot;: [&quot;M&quot;, &quot;L&quot;, &quot;XL&quot;], &quot;tags&quot;: [ &#123; &quot;tagKey&quot;: &quot;color&quot;, &quot;tagValue&quot;: &quot;blue&quot; &#125;, &#123; &quot;tagKey&quot;: &quot;size&quot;, &quot;tagValue&quot;: &quot;XL&quot; &#125;, &#123; &quot;tagKey&quot;: &quot;style&quot;, &quot;tagValue&quot;: &quot;formal&quot; &#125; ] &#125; &quot;&quot;&quot;); jsonList.add(&quot;&quot;&quot; &#123; &quot;name&quot;: &quot;item3&quot;, &quot;age&quot;: 25, &quot;salary&quot;: 10000, &quot;colors&quot;: [&quot;red&quot;, &quot;green&quot;], &quot;sizes&quot;: [&quot;L&quot;, &quot;XL&quot;], &quot;tags&quot;: [ &#123; &quot;tagKey&quot;: &quot;color&quot;, &quot;tagValue&quot;: &quot;green&quot; &#125;, &#123; &quot;tagKey&quot;: &quot;size&quot;, &quot;tagValue&quot;: &quot;L&quot; &#125;, &#123; &quot;tagKey&quot;: &quot;style&quot;, &quot;tagValue&quot;: &quot;casual&quot; &#125; ] &#125; &quot;&quot;&quot;); List&lt;Document&gt; documents = new ArrayList&lt;&gt;(); for (String json : jsonList) &#123; // é€šè¿‡Document.parse()æ–¹æ³•å°†jsonå­—ç¬¦ä¸²è½¬æ¢ä¸ºDocumentå¯¹è±¡ documents.add(Document.parse(json)); &#125; mongoTemplate.insert(documents, &quot;collection&quot;); &#125; @Test void testQueries() &#123; QueryExecutor queryExecutor = new QueryExecutor(mongoTemplate); // db.collection.find(&#123; &quot;age&quot;: &#123; &quot;$lt&quot;: 25 &#125; &#125;) printResult(&quot;findAgeLessThan25&quot;, queryExecutor.findAgeLessThan25()); // db.collection.find(&#123; &quot;age&quot;: &#123; &quot;$lte&quot;: 25 &#125; &#125;) printResult(&quot;findAgeLessThanOrEqualTo25&quot;, queryExecutor.findAgeLessThanOrEqualTo25()); // db.collection.find(&#123; &quot;age&quot;: &#123; &quot;$gt&quot;: 25 &#125; &#125;) printResult(&quot;findAgeGreaterThan25&quot;, queryExecutor.findAgeGreaterThan25()); // db.collection.find(&#123; &quot;age&quot;: &#123; &quot;$gte&quot;: 25 &#125; &#125;) printResult(&quot;findAgeGreaterThanOrEqualTo25&quot;, queryExecutor.findAgeGreaterThanOrEqualTo25()); // db.collection.find(&#123; &quot;age&quot;: &#123; &quot;$ne&quot;: 25 &#125; &#125;) printResult(&quot;findAgeNotEqualTo25&quot;, queryExecutor.findAgeNotEqualTo25()); // db.collection.find(&#123; &quot;age&quot;: &#123; &quot;$in&quot;: [20, 25] &#125; &#125;) printResult(&quot;findAgeInArray&quot;, queryExecutor.findAgeInArray(List.of(20, 25))); // db.collection.find(&#123; &quot;age&quot;: &#123; &quot;$nin&quot;: [20, 25] &#125; &#125;) printResult(&quot;findAgeNotInArray&quot;, queryExecutor.findAgeNotInArray(List.of(20, 25))); // db.collection.find(&#123; &quot;$or&quot;: [ &#123; &quot;age&quot;: 20 &#125;, &#123; &quot;salary&quot;: &#123; &quot;$gt&quot;: 8000 &#125; &#125; ] &#125;) printResult(&quot;findAgeOrSalary&quot;, queryExecutor.findAgeOrSalary()); // db.collection.find(&#123; &quot;$and&quot;: [ &#123; &quot;age&quot;: 20 &#125;, &#123; &quot;salary&quot;: &#123; &quot;$gt&quot;: 8000 &#125; &#125; ] &#125;) printResult(&quot;findAgeAndSalary&quot;, queryExecutor.findAgeAndSalary()); /* db.collection.find(&#123; &quot;tags&quot;: &#123; &quot;$all&quot;: [ &#123; &quot;$elemMatch&quot;: &#123; &quot;tagKey&quot;: &quot;color&quot;, &quot;tagValue&quot;: &quot;red&quot; &#125; &#125;, &#123; &quot;$elemMatch&quot;: &#123; &quot;tagKey&quot;: &quot;size&quot;, &quot;tagValue&quot;: &quot;XL&quot; &#125; &#125; ]&#125;&#125;) */ printResult(&quot;findTagsWithColorAndSize&quot;, queryExecutor.findTagsWithColorAndSize()); // db.collection.find(&#123; &quot;tags&quot;: &#123; &quot;$elemMatch&quot;: &#123; &quot;tagKey&quot;: &quot;color&quot;, &quot;tagValue&quot;: /blue/ &#125; &#125; &#125;) printResult(&quot;findTagsWithColorContainingBlue&quot;, queryExecutor.findTagsWithColorContainingBlue()); // db.collection.find(&#123; &quot;tags.tagKey&quot;: &quot;color&quot; &#125;) printResult(&quot;findTagsWithColor&quot;, queryExecutor.findTagsWithColor()); // db.collection.find(&#123; &quot;tags&quot;: &#123; &quot;$size&quot;: 3 &#125; &#125;) printResult(&quot;findDocumentWithTagsSizeThree&quot;, queryExecutor.findDocumentWithTagsSizeThree()); // db.collection.find(&#123; &quot;tags&quot;: &#123; &quot;$elemMatch&quot;: &#123; &quot;tagKey&quot;: &quot;color&quot;, &quot;tagValue&quot;: &quot;red&quot; &#125; &#125; &#125;) printResult(&quot;findDocumentWithSpecificTag&quot;, queryExecutor.findDocumentWithSpecificTag()); /* db.collection.find(&#123; &quot;tags&quot;: &#123; &quot;$all&quot;: [ &#123; &quot;$elemMatch&quot;: &#123; &quot;tagKey&quot;: &quot;color&quot;, &quot;tagValue&quot;: /green/ &#125; &#125; ]&#125;&#125;) */ printResult(&quot;findAllElementsWithSpecificTag&quot;, queryExecutor.findAllElementsWithSpecificTag()); printResult(&quot;findAllElementsWithSpecificTagByJson&quot;, queryExecutor.findAllElementsWithSpecificTagByJson()); &#125; private void printResult(String queryName, List&lt;Document&gt; result) &#123; System.out.println(&quot;Query: &quot; + queryName + &quot; ###################################################&quot;); for (Document document : result) &#123; System.out.println(document); &#125; System.out.println(); &#125; public static class QueryExecutor &#123; private final MongoTemplate mongoTemplate; public QueryExecutor(MongoTemplate mongoTemplate) &#123; this.mongoTemplate = mongoTemplate; &#125; // æŸ¥è¯¢å¹´é¾„å°äº 25 çš„æ–‡æ¡£ // db.collection.find(&#123; &quot;age&quot;: &#123; &quot;$lt&quot;: 25 &#125; &#125;) public List&lt;Document&gt; findAgeLessThan25() &#123; Query query = new Query(Criteria.where(&quot;age&quot;).lt(25)); System.out.println(query); // æ‰“å°å‡ºç”Ÿæˆçš„æŸ¥è¯¢å­—ç¬¦ä¸² return mongoTemplate.find(query, Document.class, &quot;collection&quot;); &#125; // æŸ¥è¯¢å¹´é¾„å°äºç­‰äº 25 çš„æ–‡æ¡£ // db.collection.find(&#123; &quot;age&quot;: &#123; &quot;$lte&quot;: 25 &#125; &#125;) public List&lt;Document&gt; findAgeLessThanOrEqualTo25() &#123; Query query = new Query(Criteria.where(&quot;age&quot;).lte(25)); System.out.println(query); // æ‰“å°å‡ºç”Ÿæˆçš„æŸ¥è¯¢å­—ç¬¦ä¸² return mongoTemplate.find(query, Document.class, &quot;collection&quot;); &#125; // æŸ¥è¯¢å¹´é¾„å¤§äº 25 çš„æ–‡æ¡£ // db.collection.find(&#123; &quot;age&quot;: &#123; &quot;$gt&quot;: 25 &#125; &#125;) public List&lt;Document&gt; findAgeGreaterThan25() &#123; Query query = new Query(Criteria.where(&quot;age&quot;).gt(25)); System.out.println(query); // æ‰“å°å‡ºç”Ÿæˆçš„æŸ¥è¯¢å­—ç¬¦ä¸² return mongoTemplate.find(query, Document.class, &quot;collection&quot;); &#125; // æŸ¥è¯¢å¹´é¾„å¤§äºç­‰äº 25 çš„æ–‡æ¡£ // db.collection.find(&#123; &quot;age&quot;: &#123; &quot;$gte&quot;: 25 &#125; &#125;) public List&lt;Document&gt; findAgeGreaterThanOrEqualTo25() &#123; Query query = new Query(Criteria.where(&quot;age&quot;).gte(25)); System.out.println(query); // æ‰“å°å‡ºç”Ÿæˆçš„æŸ¥è¯¢å­—ç¬¦ä¸² return mongoTemplate.find(query, Document.class, &quot;collection&quot;); &#125; // æŸ¥è¯¢å¹´é¾„ä¸ç­‰äº 25 çš„æ–‡æ¡£ // db.collection.find(&#123; &quot;age&quot;: &#123; &quot;$ne&quot;: 25 &#125; &#125;) public List&lt;Document&gt; findAgeNotEqualTo25() &#123; Query query = new Query(Criteria.where(&quot;age&quot;).ne(25)); System.out.println(query); // æ‰“å°å‡ºç”Ÿæˆçš„æŸ¥è¯¢å­—ç¬¦ä¸² return mongoTemplate.find(query, Document.class, &quot;collection&quot;); &#125; // æŸ¥è¯¢å¹´é¾„å­˜åœ¨å¹¶ä¸”åœ¨æŒ‡å®šæ•°ç»„ä¸­çš„æ–‡æ¡£ // db.collection.find(&#123; &quot;age&quot;: &#123; &quot;$in&quot;: [20, 25] &#125; &#125;) public List&lt;Document&gt; findAgeInArray(List&lt;Integer&gt; ages) &#123; Query query = new Query(Criteria.where(&quot;age&quot;).in(ages)); System.out.println(query); // æ‰“å°å‡ºç”Ÿæˆçš„æŸ¥è¯¢å­—ç¬¦ä¸² return mongoTemplate.find(query, Document.class, &quot;collection&quot;); &#125; // æŸ¥è¯¢å¹´é¾„ä¸å­˜åœ¨æˆ–è€…ä¸åœ¨æŒ‡å®šæ•°ç»„ä¸­çš„æ–‡æ¡£ // db.collection.find(&#123; &quot;age&quot;: &#123; &quot;$nin&quot;: [20, 25] &#125; &#125;) public List&lt;Document&gt; findAgeNotInArray(List&lt;Integer&gt; ages) &#123; Query query = new Query(Criteria.where(&quot;age&quot;).nin(ages)); System.out.println(query); // æ‰“å°å‡ºç”Ÿæˆçš„æŸ¥è¯¢å­—ç¬¦ä¸² return mongoTemplate.find(query, Document.class, &quot;collection&quot;); &#125; // æŸ¥è¯¢å¹´é¾„å­˜åœ¨å¹¶ä¸”ä¸º 20ï¼Œæˆ–è€…è–ªèµ„å¤§äº 8000 çš„æ–‡æ¡£ // db.collection.find(&#123; &quot;$or&quot;: [ &#123; &quot;age&quot;: 20 &#125;, &#123; &quot;salary&quot;: &#123; &quot;$gt&quot;: 8000 &#125; &#125; ] &#125;) public List&lt;Document&gt; findAgeOrSalary() &#123; Query query = new Query(new Criteria().orOperator(Criteria.where(&quot;age&quot;).is(20), Criteria.where(&quot;salary&quot;).gt(8000))); System.out.println(query); // æ‰“å°å‡ºç”Ÿæˆçš„æŸ¥è¯¢å­—ç¬¦ä¸² return mongoTemplate.find(query, Document.class, &quot;collection&quot;); &#125; // æŸ¥è¯¢å¹´é¾„ä¸º 20ï¼Œå¹¶ä¸”è–ªèµ„å¤§äº 8000 çš„æ–‡æ¡£ // db.collection.find(&#123; &quot;$and&quot;: [ &#123; &quot;age&quot;: 20 &#125;, &#123; &quot;salary&quot;: &#123; &quot;$gt&quot;: 8000 &#125; &#125; ] &#125;) public List&lt;Document&gt; findAgeAndSalary() &#123; Query query = new Query(new Criteria().andOperator(Criteria.where(&quot;age&quot;).is(20), Criteria.where(&quot;salary&quot;).gt(8000))); System.out.println(query); // æ‰“å°å‡ºç”Ÿæˆçš„æŸ¥è¯¢å­—ç¬¦ä¸² return mongoTemplate.find(query, Document.class, &quot;collection&quot;); &#125; // æŸ¥è¯¢åŒ…å« tagKey ä¸º &quot;color&quot;ï¼ŒtagValue ä¸º &quot;red&quot; çš„æ ‡ç­¾ï¼Œå¹¶ä¸”åŒ…å« tagKey ä¸º &quot;size&quot;ï¼ŒtagValue ä¸º &quot;XL&quot; çš„æ ‡ç­¾çš„æ–‡æ¡£ /* db.collection.find(&#123; &quot;tags&quot;: &#123; &quot;$all&quot;: [ &#123; &quot;$elemMatch&quot;: &#123; &quot;tagKey&quot;: &quot;color&quot;, &quot;tagValue&quot;: &quot;red&quot; &#125; &#125;, &#123; &quot;$elemMatch&quot;: &#123; &quot;tagKey&quot;: &quot;size&quot;, &quot;tagValue&quot;: &quot;XL&quot; &#125; &#125; ]&#125;&#125;) */ public List&lt;Document&gt; findTagsWithColorAndSize() &#123; Criteria criteria = new Criteria().andOperator(Criteria.where(&quot;tags&quot;).elemMatch(Criteria.where(&quot;tagKey&quot;).is(&quot;color&quot;).and(&quot;tagValue&quot;).is(&quot;red&quot;)), Criteria.where(&quot;tags&quot;).elemMatch(Criteria.where(&quot;tagKey&quot;).is(&quot;size&quot;).and(&quot;tagValue&quot;).is(&quot;XL&quot;))); Query query = new Query(criteria); System.out.println(query); // æ‰“å°å‡ºç”Ÿæˆçš„æŸ¥è¯¢å­—ç¬¦ä¸² return mongoTemplate.find(query, Document.class, &quot;collection&quot;); &#125; // æŸ¥è¯¢åŒ…å« tagKey ä¸º &quot;color&quot;ï¼ŒtagValue åŒ…å« &quot;blue&quot; çš„æ ‡ç­¾çš„æ–‡æ¡£ // db.collection.find(&#123; &quot;tags&quot;: &#123; &quot;$elemMatch&quot;: &#123; &quot;tagKey&quot;: &quot;color&quot;, &quot;tagValue&quot;: /blue/ &#125; &#125; &#125;) public List&lt;Document&gt; findTagsWithColorContainingBlue() &#123; Query query = new Query(Criteria.where(&quot;tags&quot;).elemMatch(Criteria.where(&quot;tagKey&quot;).is(&quot;color&quot;).and(&quot;tagValue&quot;).regex(&quot;blue&quot;))); System.out.println(query); // æ‰“å°å‡ºç”Ÿæˆçš„æŸ¥è¯¢å­—ç¬¦ä¸² return mongoTemplate.find(query, Document.class, &quot;collection&quot;); &#125; // æŸ¥è¯¢åŒ…å« tagKey ä¸º &quot;color&quot; çš„æ ‡ç­¾çš„æ–‡æ¡£ // db.collection.find(&#123; &quot;tags.tagKey&quot;: &quot;color&quot; &#125;) public List&lt;Document&gt; findTagsWithColor() &#123; Query query = new Query(Criteria.where(&quot;tags.tagKey&quot;).is(&quot;color&quot;)); System.out.println(query); // æ‰“å°å‡ºç”Ÿæˆçš„æŸ¥è¯¢å­—ç¬¦ä¸² return mongoTemplate.find(query, Document.class, &quot;collection&quot;); &#125; // æŸ¥è¯¢ tags æ•°ç»„é•¿åº¦ä¸º 3 çš„æ–‡æ¡£ // db.collection.find(&#123; &quot;tags&quot;: &#123; &quot;$size&quot;: 3 &#125; &#125;) public List&lt;Document&gt; findDocumentWithTagsSizeThree() &#123; Query query = new Query(Criteria.where(&quot;tags&quot;).size(3)); System.out.println(query); // æ‰“å°å‡ºç”Ÿæˆçš„æŸ¥è¯¢å­—ç¬¦ä¸² return mongoTemplate.find(query, Document.class, &quot;collection&quot;); &#125; // æŸ¥è¯¢åŒ…å« tagKey ä¸º &quot;color&quot;ï¼ŒtagValue ä¸º &quot;red&quot; çš„æ ‡ç­¾çš„æ–‡æ¡£ // db.collection.find(&#123; &quot;tags&quot;: &#123; &quot;$elemMatch&quot;: &#123; &quot;tagKey&quot;: &quot;color&quot;, &quot;tagValue&quot;: &quot;red&quot; &#125; &#125; &#125;) public List&lt;Document&gt; findDocumentWithSpecificTag() &#123; Query query = new Query(Criteria.where(&quot;tags&quot;).elemMatch(Criteria.where(&quot;tagKey&quot;).is(&quot;color&quot;).and(&quot;tagValue&quot;).is(&quot;red&quot;))); System.out.println(query); // æ‰“å°å‡ºç”Ÿæˆçš„æŸ¥è¯¢å­—ç¬¦ä¸² return mongoTemplate.find(query, Document.class, &quot;collection&quot;); &#125; // æŸ¥è¯¢ tags æ•°ç»„æ‰€æœ‰å…ƒç´ æ»¡è¶³ tagKey ä¸º &quot;color&quot;ï¼ŒtagValue åŒ…å« &quot;green&quot; çš„æ ‡ç­¾çš„æ–‡æ¡£ /* db.collection.find(&#123; &quot;tags&quot;: &#123; &quot;$all&quot;: [ &#123; &quot;$elemMatch&quot;: &#123; &quot;tagKey&quot;: &quot;color&quot;, &quot;tagValue&quot;: /green/ &#125; &#125; ]&#125;&#125;) */ public List&lt;Document&gt; findAllElementsWithSpecificTag() &#123; Query query = new Query(Criteria.where(&quot;tags&quot;).elemMatch(Criteria.where(&quot;tagKey&quot;).is(&quot;color&quot;).and(&quot;tagValue&quot;).regex(&quot;green&quot;))); System.out.println(query); // æ‰“å°å‡ºç”Ÿæˆçš„æŸ¥è¯¢å­—ç¬¦ä¸² return mongoTemplate.find(query, Document.class, &quot;collection&quot;); &#125; // æŸ¥è¯¢ tags æ•°ç»„æ‰€æœ‰å…ƒç´ æ»¡è¶³ tagKey ä¸º &quot;color&quot;ï¼ŒtagValue åŒ…å« &quot;green&quot; çš„æ ‡ç­¾çš„æ–‡æ¡£ // ä½¿ç”¨ BasicQueryï¼Œå¯ä»¥ä½¿ç”¨ json å­—ç¬¦ä¸²ï¼Œè¿™æ ·å°±å¯ä»¥ç›´æ¥ä½¿ç”¨ mongo çš„æŸ¥è¯¢è¯­æ³• public List&lt;Document&gt; findAllElementsWithSpecificTagByJson() &#123; String json = &quot;&quot;&quot; &#123; &quot;tags&quot;: &#123; &quot;$all&quot;: [ &#123; &quot;$elemMatch&quot;: &#123; &quot;tagKey&quot;: &quot;color&quot;, &quot;tagValue&quot;: /green/ &#125; &#125; ]&#125;&#125; &quot;&quot;&quot;; Query query = new BasicQuery(json); System.out.println(query); // æ‰“å°å‡ºç”Ÿæˆçš„æŸ¥è¯¢å­—ç¬¦ä¸² return mongoTemplate.find(query, Document.class, &quot;collection&quot;); &#125; &#125;&#125; æ“ä½œå®ä½“ç±» ç›¸å…³æ³¨è§£ ä¿®é¥°èŒƒå›´ ä½œç”¨ å±æ€§ @Document ç±» æ˜ å°„ç±»å¯¹è±¡ä¸ºMongoæ–‡æ¡£ value, collection @Id æˆå‘˜å˜é‡ã€æ–¹æ³• å°†æˆå‘˜å˜é‡å€¼æ˜ å°„ä¸ºæ–‡æ¡£çš„_idçš„å€¼ @Field æˆå‘˜å˜é‡ã€æ–¹æ³• å°†æˆå‘˜å˜é‡åŠå€¼æ˜ å°„ä¸ºæ–‡æ¡£ä¸­key:valueå¯¹ name, value @Transient æˆå‘˜å˜é‡ã€æ–¹æ³• æŒ‡å®šæˆå‘˜å˜é‡ä¸å‚ä¸æ–‡æ¡£çš„åºåˆ—åŒ– ä½¿ç”¨ @Document æ³¨è§£æŒ‡å®šé›†åˆå 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253package com.hanqf.mongo.model;import lombok.AllArgsConstructor;import lombok.Data;import lombok.NoArgsConstructor;import org.springframework.data.annotation.Id;import org.springframework.data.mongodb.core.mapping.Document;import org.springframework.data.mongodb.core.mapping.Field;import java.util.List;@Data@AllArgsConstructor@NoArgsConstructor@Document(collection = &quot;collection&quot;)public class Item &#123; @Id private String id; @Field private String name; @Field private int age; @Field private double salary; @Field private List&lt;String&gt; colors; @Field private List&lt;String&gt; sizes; @Field private List&lt;Tag&gt; tags; public Item(String name, int age, double salary, List&lt;String&gt; colors, List&lt;String&gt; sizes, List&lt;Tag&gt; tags) &#123; this.name = name; this.age = age; this.salary = salary; this.colors = colors; this.sizes = sizes; this.tags = tags; &#125; @Data @AllArgsConstructor @NoArgsConstructor public static class Tag &#123; private String tagKey; private String tagValue; &#125;&#125; æŸ¥è¯¢ç¤ºä¾‹ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271package com.hanqf;import com.hanqf.mongo.model.Item;import org.junit.jupiter.api.Test;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.boot.test.context.SpringBootTest;import org.springframework.data.mongodb.core.MongoTemplate;import org.springframework.data.mongodb.core.query.BasicQuery;import org.springframework.data.mongodb.core.query.Criteria;import org.springframework.data.mongodb.core.query.Query;import java.util.Arrays;import java.util.List;@SpringBootTestclass BasicTests2 &#123; @Autowired private MongoTemplate mongoTemplate; @Test void initializeData() &#123; // Initialize data List&lt;Item&gt; items = Arrays.asList( new Item(&quot;item1&quot;, 20, 5000, Arrays.asList(&quot;red&quot;, &quot;blue&quot;, &quot;green&quot;), Arrays.asList(&quot;S&quot;, &quot;M&quot;, &quot;L&quot;), Arrays.asList(new Item.Tag(&quot;color&quot;, &quot;red&quot;), new Item.Tag(&quot;size&quot;, &quot;M&quot;), new Item.Tag(&quot;style&quot;, &quot;casual&quot;))), new Item(&quot;item2&quot;, 30, 8000, Arrays.asList(&quot;green&quot;, &quot;yellow&quot;), Arrays.asList(&quot;M&quot;, &quot;L&quot;, &quot;XL&quot;), Arrays.asList(new Item.Tag(&quot;color&quot;, &quot;blue&quot;), new Item.Tag(&quot;size&quot;, &quot;XL&quot;), new Item.Tag(&quot;style&quot;, &quot;formal&quot;))), new Item(&quot;item3&quot;, 25, 10000, Arrays.asList(&quot;red&quot;, &quot;green&quot;), Arrays.asList(&quot;L&quot;, &quot;XL&quot;), Arrays.asList(new Item.Tag(&quot;color&quot;, &quot;green&quot;), new Item.Tag(&quot;size&quot;, &quot;L&quot;), new Item.Tag(&quot;style&quot;, &quot;casual&quot;))) ); mongoTemplate.insertAll(items); &#125; @Test void testQueries() &#123; BasicTests2.QueryExecutor queryExecutor = new BasicTests2.QueryExecutor(mongoTemplate); // db.collection.find(&#123; &quot;age&quot;: &#123; &quot;$lt&quot;: 25 &#125; &#125;) printResult(&quot;findAgeLessThan25&quot;, queryExecutor.findAgeLessThan25()); // db.collection.find(&#123; &quot;age&quot;: &#123; &quot;$lte&quot;: 25 &#125; &#125;) printResult(&quot;findAgeLessThanOrEqualTo25&quot;, queryExecutor.findAgeLessThanOrEqualTo25()); // db.collection.find(&#123; &quot;age&quot;: &#123; &quot;$gt&quot;: 25 &#125; &#125;) printResult(&quot;findAgeGreaterThan25&quot;, queryExecutor.findAgeGreaterThan25()); // db.collection.find(&#123; &quot;age&quot;: &#123; &quot;$gte&quot;: 25 &#125; &#125;) printResult(&quot;findAgeGreaterThanOrEqualTo25&quot;, queryExecutor.findAgeGreaterThanOrEqualTo25()); // db.collection.find(&#123; &quot;age&quot;: &#123; &quot;$ne&quot;: 25 &#125; &#125;) printResult(&quot;findAgeNotEqualTo25&quot;, queryExecutor.findAgeNotEqualTo25()); // db.collection.find(&#123; &quot;age&quot;: &#123; &quot;$in&quot;: [20, 25] &#125; &#125;) printResult(&quot;findAgeInArray&quot;, queryExecutor.findAgeInArray(List.of(20, 25))); // db.collection.find(&#123; &quot;age&quot;: &#123; &quot;$nin&quot;: [20, 25] &#125; &#125;) printResult(&quot;findAgeNotInArray&quot;, queryExecutor.findAgeNotInArray(List.of(20, 25))); // db.collection.find(&#123; &quot;$or&quot;: [ &#123; &quot;age&quot;: 20 &#125;, &#123; &quot;salary&quot;: &#123; &quot;$gt&quot;: 8000 &#125; &#125; ] &#125;) printResult(&quot;findAgeOrSalary&quot;, queryExecutor.findAgeOrSalary()); // db.collection.find(&#123; &quot;$and&quot;: [ &#123; &quot;age&quot;: 20 &#125;, &#123; &quot;salary&quot;: &#123; &quot;$gt&quot;: 8000 &#125; &#125; ] &#125;) printResult(&quot;findAgeAndSalary&quot;, queryExecutor.findAgeAndSalary()); /* db.collection.find(&#123; &quot;tags&quot;: &#123; &quot;$all&quot;: [ &#123; &quot;$elemMatch&quot;: &#123; &quot;tagKey&quot;: &quot;color&quot;, &quot;tagValue&quot;: &quot;red&quot; &#125; &#125;, &#123; &quot;$elemMatch&quot;: &#123; &quot;tagKey&quot;: &quot;size&quot;, &quot;tagValue&quot;: &quot;XL&quot; &#125; &#125; ]&#125;&#125;) */ printResult(&quot;findTagsWithColorAndSize&quot;, queryExecutor.findTagsWithColorAndSize()); // db.collection.find(&#123; &quot;tags&quot;: &#123; &quot;$elemMatch&quot;: &#123; &quot;tagKey&quot;: &quot;color&quot;, &quot;tagValue&quot;: /blue/ &#125; &#125; &#125;) printResult(&quot;findTagsWithColorContainingBlue&quot;, queryExecutor.findTagsWithColorContainingBlue()); // db.collection.find(&#123; &quot;tags.tagKey&quot;: &quot;color&quot; &#125;) printResult(&quot;findTagsWithColor&quot;, queryExecutor.findTagsWithColor()); // db.collection.find(&#123; &quot;tags&quot;: &#123; &quot;$size&quot;: 3 &#125; &#125;) printResult(&quot;findDocumentWithTagsSizeThree&quot;, queryExecutor.findDocumentWithTagsSizeThree()); // db.collection.find(&#123; &quot;tags&quot;: &#123; &quot;$elemMatch&quot;: &#123; &quot;tagKey&quot;: &quot;color&quot;, &quot;tagValue&quot;: &quot;red&quot; &#125; &#125; &#125;) printResult(&quot;findDocumentWithSpecificTag&quot;, queryExecutor.findDocumentWithSpecificTag()); /* db.collection.find(&#123; &quot;tags&quot;: &#123; &quot;$all&quot;: [ &#123; &quot;$elemMatch&quot;: &#123; &quot;tagKey&quot;: &quot;color&quot;, &quot;tagValue&quot;: /green/ &#125; &#125; ]&#125;&#125;) */ printResult(&quot;findAllElementsWithSpecificTag&quot;, queryExecutor.findAllElementsWithSpecificTag()); printResult(&quot;findAllElementsWithSpecificTagByJson&quot;, queryExecutor.findAllElementsWithSpecificTagByJson()); &#125; private void printResult(String queryName, List&lt;Item&gt; result) &#123; System.out.println(&quot;Query: &quot; + queryName + &quot; ###################################################&quot;); for (Item item : result) &#123; System.out.println(item); &#125; System.out.println(); &#125; public static class QueryExecutor &#123; private final MongoTemplate mongoTemplate; public QueryExecutor(MongoTemplate mongoTemplate) &#123; this.mongoTemplate = mongoTemplate; &#125; // æŸ¥è¯¢å¹´é¾„å°äº 25 çš„æ–‡æ¡£ // db.collection.find(&#123; &quot;age&quot;: &#123; &quot;$lt&quot;: 25 &#125; &#125;) public List&lt;Item&gt; findAgeLessThan25() &#123; Query query = new Query(Criteria.where(&quot;age&quot;).lt(25)); System.out.println(query); // æ‰“å°å‡ºç”Ÿæˆçš„æŸ¥è¯¢å­—ç¬¦ä¸² return mongoTemplate.find(query, Item.class); &#125; // æŸ¥è¯¢å¹´é¾„å°äºç­‰äº 25 çš„æ–‡æ¡£ // db.collection.find(&#123; &quot;age&quot;: &#123; &quot;$lte&quot;: 25 &#125; &#125;) public List&lt;Item&gt; findAgeLessThanOrEqualTo25() &#123; Query query = new Query(Criteria.where(&quot;age&quot;).lte(25)); System.out.println(query); // æ‰“å°å‡ºç”Ÿæˆçš„æŸ¥è¯¢å­—ç¬¦ä¸² return mongoTemplate.find(query, Item.class); &#125; // æŸ¥è¯¢å¹´é¾„å¤§äº 25 çš„æ–‡æ¡£ // db.collection.find(&#123; &quot;age&quot;: &#123; &quot;$gt&quot;: 25 &#125; &#125;) public List&lt;Item&gt; findAgeGreaterThan25() &#123; Query query = new Query(Criteria.where(&quot;age&quot;).gt(25)); System.out.println(query); // æ‰“å°å‡ºç”Ÿæˆçš„æŸ¥è¯¢å­—ç¬¦ä¸² return mongoTemplate.find(query, Item.class); &#125; // æŸ¥è¯¢å¹´é¾„å¤§äºç­‰äº 25 çš„æ–‡æ¡£ // db.collection.find(&#123; &quot;age&quot;: &#123; &quot;$gte&quot;: 25 &#125; &#125;) public List&lt;Item&gt; findAgeGreaterThanOrEqualTo25() &#123; Query query = new Query(Criteria.where(&quot;age&quot;).gte(25)); System.out.println(query); // æ‰“å°å‡ºç”Ÿæˆçš„æŸ¥è¯¢å­—ç¬¦ä¸² return mongoTemplate.find(query, Item.class); &#125; // æŸ¥è¯¢å¹´é¾„ä¸ç­‰äº 25 çš„æ–‡æ¡£ // db.collection.find(&#123; &quot;age&quot;: &#123; &quot;$ne&quot;: 25 &#125; &#125;) public List&lt;Item&gt; findAgeNotEqualTo25() &#123; Query query = new Query(Criteria.where(&quot;age&quot;).ne(25)); System.out.println(query); // æ‰“å°å‡ºç”Ÿæˆçš„æŸ¥è¯¢å­—ç¬¦ä¸² return mongoTemplate.find(query, Item.class); &#125; // æŸ¥è¯¢å¹´é¾„å­˜åœ¨å¹¶ä¸”åœ¨æŒ‡å®šæ•°ç»„ä¸­çš„æ–‡æ¡£ // db.collection.find(&#123; &quot;age&quot;: &#123; &quot;$in&quot;: [20, 25] &#125; &#125;) public List&lt;Item&gt; findAgeInArray(List&lt;Integer&gt; ages) &#123; Query query = new Query(Criteria.where(&quot;age&quot;).in(ages)); System.out.println(query); // æ‰“å°å‡ºç”Ÿæˆçš„æŸ¥è¯¢å­—ç¬¦ä¸² return mongoTemplate.find(query, Item.class); &#125; // æŸ¥è¯¢å¹´é¾„ä¸å­˜åœ¨æˆ–è€…ä¸åœ¨æŒ‡å®šæ•°ç»„ä¸­çš„æ–‡æ¡£ // db.collection.find(&#123; &quot;age&quot;: &#123; &quot;$nin&quot;: [20, 25] &#125; &#125;) public List&lt;Item&gt; findAgeNotInArray(List&lt;Integer&gt; ages) &#123; Query query = new Query(Criteria.where(&quot;age&quot;).nin(ages)); System.out.println(query); // æ‰“å°å‡ºç”Ÿæˆçš„æŸ¥è¯¢å­—ç¬¦ä¸² return mongoTemplate.find(query, Item.class); &#125; // æŸ¥è¯¢å¹´é¾„å­˜åœ¨å¹¶ä¸”ä¸º 20ï¼Œæˆ–è€…è–ªèµ„å¤§äº 8000 çš„æ–‡æ¡£ // db.collection.find(&#123; &quot;$or&quot;: [ &#123; &quot;age&quot;: 20 &#125;, &#123; &quot;salary&quot;: &#123; &quot;$gt&quot;: 8000 &#125; &#125; ] &#125;) public List&lt;Item&gt; findAgeOrSalary() &#123; Query query = new Query(new Criteria().orOperator( Criteria.where(&quot;age&quot;).is(20), Criteria.where(&quot;salary&quot;).gt(8000) )); System.out.println(query); // æ‰“å°å‡ºç”Ÿæˆçš„æŸ¥è¯¢å­—ç¬¦ä¸² return mongoTemplate.find(query, Item.class); &#125; // æŸ¥è¯¢å¹´é¾„ä¸º 20ï¼Œå¹¶ä¸”è–ªèµ„å¤§äº 8000 çš„æ–‡æ¡£ // db.collection.find(&#123; &quot;$and&quot;: [ &#123; &quot;age&quot;: 20 &#125;, &#123; &quot;salary&quot;: &#123; &quot;$gt&quot;: 8000 &#125; &#125; ] &#125;) public List&lt;Item&gt; findAgeAndSalary() &#123; Query query = new Query(new Criteria().andOperator( Criteria.where(&quot;age&quot;).is(20), Criteria.where(&quot;salary&quot;).gt(8000) )); System.out.println(query); // æ‰“å°å‡ºç”Ÿæˆçš„æŸ¥è¯¢å­—ç¬¦ä¸² return mongoTemplate.find(query, Item.class); &#125; // æŸ¥è¯¢åŒ…å« tagKey ä¸º &quot;color&quot;ï¼ŒtagValue ä¸º &quot;red&quot; çš„æ ‡ç­¾ï¼Œå¹¶ä¸”åŒ…å« tagKey ä¸º &quot;size&quot;ï¼ŒtagValue ä¸º &quot;XL&quot; çš„æ ‡ç­¾çš„æ–‡æ¡£ /* db.collection.find(&#123; &quot;tags&quot;: &#123; &quot;$all&quot;: [ &#123; &quot;$elemMatch&quot;: &#123; &quot;tagKey&quot;: &quot;color&quot;, &quot;tagValue&quot;: &quot;red&quot; &#125; &#125;, &#123; &quot;$elemMatch&quot;: &#123; &quot;tagKey&quot;: &quot;size&quot;, &quot;tagValue&quot;: &quot;XL&quot; &#125; &#125; ]&#125;&#125;) */ public List&lt;Item&gt; findTagsWithColorAndSize() &#123; Criteria criteria = new Criteria().andOperator( Criteria.where(&quot;tags&quot;).elemMatch( Criteria.where(&quot;tagKey&quot;).is(&quot;color&quot;).and(&quot;tagValue&quot;).is(&quot;red&quot;) ), Criteria.where(&quot;tags&quot;).elemMatch( Criteria.where(&quot;tagKey&quot;).is(&quot;size&quot;).and(&quot;tagValue&quot;).is(&quot;XL&quot;) ) ); Query query = new Query(criteria); System.out.println(query); // æ‰“å°å‡ºç”Ÿæˆçš„æŸ¥è¯¢å­—ç¬¦ä¸² return mongoTemplate.find(query, Item.class); &#125; // æŸ¥è¯¢åŒ…å« tagKey ä¸º &quot;color&quot;ï¼ŒtagValue åŒ…å« &quot;blue&quot; çš„æ ‡ç­¾çš„æ–‡æ¡£ // db.collection.find(&#123; &quot;tags&quot;: &#123; &quot;$elemMatch&quot;: &#123; &quot;tagKey&quot;: &quot;color&quot;, &quot;tagValue&quot;: /blue/ &#125; &#125; &#125;) public List&lt;Item&gt; findTagsWithColorContainingBlue() &#123; Query query = new Query(Criteria.where(&quot;tags&quot;).elemMatch( Criteria.where(&quot;tagKey&quot;).is(&quot;color&quot;).and(&quot;tagValue&quot;).regex(&quot;blue&quot;) )); System.out.println(query); // æ‰“å°å‡ºç”Ÿæˆçš„æŸ¥è¯¢å­—ç¬¦ä¸² return mongoTemplate.find(query, Item.class); &#125; // æŸ¥è¯¢åŒ…å« tagKey ä¸º &quot;color&quot; çš„æ ‡ç­¾çš„æ–‡æ¡£ // db.collection.find(&#123; &quot;tags.tagKey&quot;: &quot;color&quot; &#125;) public List&lt;Item&gt; findTagsWithColor() &#123; Query query = new Query(Criteria.where(&quot;tags.tagKey&quot;).is(&quot;color&quot;)); System.out.println(query); // æ‰“å°å‡ºç”Ÿæˆçš„æŸ¥è¯¢å­—ç¬¦ä¸² return mongoTemplate.find(query, Item.class); &#125; // æŸ¥è¯¢ tags æ•°ç»„é•¿åº¦ä¸º 3 çš„æ–‡æ¡£ // db.collection.find(&#123; &quot;tags&quot;: &#123; &quot;$size&quot;: 3 &#125; &#125;) public List&lt;Item&gt; findDocumentWithTagsSizeThree() &#123; Query query = new Query(Criteria.where(&quot;tags&quot;).size(3)); System.out.println(query); // æ‰“å°å‡ºç”Ÿæˆçš„æŸ¥è¯¢å­—ç¬¦ä¸² return mongoTemplate.find(query, Item.class); &#125; // æŸ¥è¯¢åŒ…å« tagKey ä¸º &quot;color&quot;ï¼ŒtagValue ä¸º &quot;red&quot; çš„æ ‡ç­¾çš„æ–‡æ¡£ // db.collection.find(&#123; &quot;tags&quot;: &#123; &quot;$elemMatch&quot;: &#123; &quot;tagKey&quot;: &quot;color&quot;, &quot;tagValue&quot;: &quot;red&quot; &#125; &#125; &#125;) public List&lt;Item&gt; findDocumentWithSpecificTag() &#123; Query query = new Query(Criteria.where(&quot;tags&quot;).elemMatch( Criteria.where(&quot;tagKey&quot;).is(&quot;color&quot;).and(&quot;tagValue&quot;).is(&quot;red&quot;) )); System.out.println(query); // æ‰“å°å‡ºç”Ÿæˆçš„æŸ¥è¯¢å­—ç¬¦ä¸² return mongoTemplate.find(query, Item.class); &#125; // æŸ¥è¯¢ tags æ•°ç»„æ‰€æœ‰å…ƒç´ æ»¡è¶³ tagKey ä¸º &quot;color&quot;ï¼ŒtagValue åŒ…å« &quot;green&quot; çš„æ ‡ç­¾çš„æ–‡æ¡£ /* db.collection.find(&#123; &quot;tags&quot;: &#123; &quot;$all&quot;: [ &#123; &quot;$elemMatch&quot;: &#123; &quot;tagKey&quot;: &quot;color&quot;, &quot;tagValue&quot;: /green/ &#125; &#125; ]&#125;&#125;) */ public List&lt;Item&gt; findAllElementsWithSpecificTag() &#123; Query query = new Query(Criteria.where(&quot;tags&quot;).elemMatch( Criteria.where(&quot;tagKey&quot;).is(&quot;color&quot;).and(&quot;tagValue&quot;).regex(&quot;green&quot;) )); System.out.println(query); // æ‰“å°å‡ºç”Ÿæˆçš„æŸ¥è¯¢å­—ç¬¦ä¸² return mongoTemplate.find(query, Item.class); &#125; // æŸ¥è¯¢ tags æ•°ç»„æ‰€æœ‰å…ƒç´ æ»¡è¶³ tagKey ä¸º &quot;color&quot;ï¼ŒtagValue åŒ…å« &quot;green&quot; çš„æ ‡ç­¾çš„æ–‡æ¡£ // ä½¿ç”¨ BasicQueryï¼Œå¯ä»¥ä½¿ç”¨ json å­—ç¬¦ä¸²ï¼Œè¿™æ ·å°±å¯ä»¥ç›´æ¥ä½¿ç”¨ mongo çš„æŸ¥è¯¢è¯­æ³• public List&lt;Item&gt; findAllElementsWithSpecificTagByJson() &#123; String json = &quot;&quot;&quot; &#123; &quot;tags&quot;: &#123; &quot;$all&quot;: [ &#123; &quot;$elemMatch&quot;: &#123; &quot;tagKey&quot;: &quot;color&quot;, &quot;tagValue&quot;: /green/ &#125; &#125; ]&#125;&#125; &quot;&quot;&quot;; Query query = new BasicQuery(json); System.out.println(query); // æ‰“å°å‡ºç”Ÿæˆçš„æŸ¥è¯¢å­—ç¬¦ä¸² return mongoTemplate.find(query, Item.class); &#125; &#125;&#125; å¸¸ç”¨çš„æŸ¥è¯¢æ–¹æ³• æŸ¥è¯¢æ‰€æœ‰æ–‡æ¡£ 12// db.employee.find()List&lt;Employee&gt; list = mongoTemplate.findAll(Employee.class); æ ¹æ®_idæŸ¥è¯¢ 12// db.employee.findOne(&#123; &quot;_id&quot;: 1 &#125;)|Employee e = mongoTemplate.findById(1, Employee.class); æŸ¥è¯¢ç¬¬ä¸€ä¸ªæ–‡æ¡£ 12// db.employee.findOne(&#123;&#125;)Employee e = mongoTemplate.findOne(new Query(), Employee.class); æ¡ä»¶æŸ¥è¯¢ï¼Œæ’åºåŠåˆ†é¡µ 12345678910111213141516171819202122232425262728293031/*db.employee.find(&#123; &quot;$or&quot;: [ &#123; &quot;username&quot;: &quot;å¼ ä¸‰&quot; &#125;, &#123; &quot;salary&quot;: &#123; &quot;$gt&quot;: 5000 &#125; &#125; ] &#125;).sort(&#123; &quot;salary&quot;: -1 &#125;).skip(2).limit(4)*/Query query = new Query(new Criteria().orOperator(Criteria.where(&quot;name&quot;).is(&quot;å¼ ä¸‰&quot;), Criteria.where(&quot;salary&quot;).gt(5000)););// å¦‚æœä½ ä¸ç†Ÿæ‚‰ Criteriaï¼Œä½†æ˜¯ç†Ÿæ‚‰ mongo çš„æŸ¥è¯¢è¯­æ³•ï¼Œå¯ä»¥ä½¿ç”¨ BasicQuery/* String json = &quot;&quot;&quot; &#123; &quot;$or&quot;: [ &#123; &quot;username&quot;: &quot;å¼ ä¸‰&quot; &#125;, &#123; &quot;salary&quot;: &#123; &quot;$gt&quot;: 5000 &#125; &#125; ] &#125; &quot;&quot;&quot;; Query query = new BasicQuery(json);*///skip limit åˆ†é¡µ skipç”¨äºæŒ‡å®šè·³è¿‡è®°å½•æ•°ï¼Œlimitåˆ™ç”¨äºé™å®šè¿”å›ç»“æœæ•°é‡ã€‚query.with(Sort.by(Sort.Order.desc(&quot;salary&quot;))) .skip(2) //æŒ‡å®šè·³è¿‡è®°å½•æ•° .limit(4); //æ¯é¡µæ˜¾ç¤ºè®°å½•æ•°//æŸ¥è¯¢ç»“æœList&lt;Employee&gt; employees = mongoTemplate.find( query, Employee.class); åªè¿”å›éƒ¨åˆ†å­—æ®µ 123456789101112/*db.employee.find( &#123; &quot;age&quot;: &#123; &quot;$gte&quot;: 18 &#125; &#125;, // ç­›é€‰æ¡ä»¶ï¼Œå¹´é¾„å¤§äºç­‰äº18å²çš„æ–‡æ¡£ &#123; &quot;name&quot;: 1, &quot;age&quot;: 1 &#125; // æŒ‡å®šè¿”å›çš„å­—æ®µï¼ŒåªåŒ…å«&quot;name&quot;å’Œ&quot;age&quot;ï¼Œå…¶ä¸­1è¡¨ç¤ºåŒ…å«è¯¥å­—æ®µï¼Œ0è¡¨ç¤ºä¸åŒ…å«)*/Query query = new Query();query.addCriteria(Criteria.where(&quot;age&quot;).gte(18)); // ç­›é€‰æ¡ä»¶ï¼Œå¹´é¾„å¤§äºç­‰äº18å²çš„æ–‡æ¡£query.fields().include(&quot;name&quot;, &quot;age&quot;).exclude(&quot;id&quot;);// æŒ‡å®šè¿”å›çš„å­—æ®µï¼ŒåªåŒ…å«&quot;name&quot;å’Œ&quot;age&quot;ï¼Œè¦å»é™¤idï¼Œå¦åˆ™é»˜è®¤ä¼šè¿”å›idList&lt;Employee&gt; results = mongoTemplate.find(query, Employee.class);// Employee(id=null, name=å¼ ä¸‰, age=21, salary=null, entryDay=null)results.forEach(System.out::println); å»é‡ distinct æ–¹æ³•åªèƒ½ç›´æ¥è·å–å”¯ä¸€å€¼ï¼Œå¹¶ä¸èƒ½åœ¨æŸ¥è¯¢è¿‡ç¨‹ä¸­è¿›è¡Œå…¶ä»–çš„èšåˆæ“ä½œï¼Œä½¿ç”¨åœºæ™¯éå¸¸å—é™ï¼Œæ¨èä½¿ç”¨èšåˆæ–¹å¼è¿›è¡ŒæŸ¥è¯¢ 12345678910111213141516171819202122232425262728293031323334353637383940414243//è¯­æ³•ï¼šdb.collectionName.distinct(&quot;fieldName&quot;, &#123; /* è¿‡æ»¤æ¡ä»¶ */ &#125;)ï¼Œè¿™å°†è¿”å›æŒ‡å®šå­—æ®µ fieldName çš„å”¯ä¸€å€¼æ•°ç»„ã€‚// ç¤ºä¾‹ï¼šdb.collection.distinct(&quot;name&quot;,&#123;age:&#123;$gte:25&#125;&#125;)// æ–¹å¼1DistinctIterable&lt;String&gt; distinctIterable = mongoTemplate.getCollection(&quot;collection&quot;) .distinct(&quot;name&quot;, BsonDocument.parse(&quot;&#123;age:&#123;$gte:25&#125;&#125;&quot;), String.class);// æ–¹å¼2// DistinctIterable&lt;String&gt; distinctIterable = mongoTemplate.getCollection(&quot;collection&quot;)// .distinct(&quot;name&quot;, new Document(&quot;age&quot;, new Document(&quot;$gte&quot;, 25)), String.class);// å°†DistinctIterableè½¬æ¢ä¸ºListList&lt;String&gt; distinctNames = new ArrayList&lt;&gt;();distinctIterable.iterator().forEachRemaining(distinctNames::add);// æ‰“å°è¾“å‡ºdistinctNames.forEach(System.out::println);// èšåˆæ–¹å¼ï¼Œèšåˆæ–¹å¼çš„è¯¦ç»†è¯´æ˜ä¼šåœ¨ä¸‹ä¸€ç¯‡åšå®¢ä¸­ä»‹ç»/* db.collection.aggregate([ &#123; $match: &#123; age: &#123; $gte: 25 &#125; &#125; &#125;, &#123; $group: &#123; _id: &quot;$name&quot; &#125; &#125; ])*/Aggregation aggregation = Aggregation.newAggregation( Aggregation.match(Criteria.where(&quot;age&quot;).gte(25)), Aggregation.group(&quot;name&quot;) ); AggregationResults&lt;Document&gt; results = mongoTemplate.aggregate(aggregation, &quot;collection&quot;, Document.class); List&lt;String&gt; distinctNames = results.getMappedResults().stream() .map(document -&gt; document.getString(&quot;_id&quot;)) .toList(); distinctNames.forEach(System.out::println); SpringBootå¯¹Mongoçš„æŸ¥è¯¢ï¼Œå…¶å®å°±æ˜¯å¦‚ä½•é€šè¿‡Criteriaæ¥æ„å»ºä¸€ä¸ªQueryï¼Œæ‰€ä»¥æˆ‘ä»¬çš„ç›®æ ‡å°±æ˜¯è¦ç†Ÿç»ƒæŒæ¡Criteriaçš„è¯­æ³•ã€‚å½“ç„¶ï¼Œå¦‚æœä½ ç†Ÿæ‚‰Mongoçš„æŸ¥è¯¢è¯­æ³•ï¼Œä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨BasicQueryæ¥å®ç°Mongoçš„æŸ¥è¯¢ã€‚ æ’å…¥ Mongoè¯­æ³• 1234567891011121314151617181920212223# æ’å…¥å•ä¸ªæ–‡æ¡£db.collection.insertOne( &lt;document&gt;, &#123; writeConcern: &lt;document&gt; &#125;)# ç¤ºä¾‹db.demo.insertOne( &#123; name: &quot;å¼ ä¸‰&quot;, age: 35&#125;, &#123; writeConcern: &#123; w: &quot;majority&quot;, j: true, wtimeout: 5000 &#125; &#125;)# æ’å…¥å¤šä¸ªæ–‡æ¡£db.collection.insertMany( [ &lt;document 1&gt; , &lt;document 2&gt;, ... ], &#123; writeConcern: &lt;document&gt;, ordered: &lt;boolean&gt; &#125;) writeConcern æ˜¯ MongoDB ä¸­ç”¨æ¥æ§åˆ¶å†™å…¥ç¡®è®¤çš„é€‰é¡¹ï¼Œå¯é€‰ã€‚ä»¥ä¸‹æ˜¯ writeConcern å‚æ•°çš„ä¸€äº›å¸¸è§é€‰é¡¹ï¼š wï¼šæŒ‡å®šå†™å…¥ç¡®è®¤çº§åˆ«ã€‚å¦‚æœæŒ‡å®šä¸ºæ•°å­—ï¼Œåˆ™è¡¨ç¤ºè¦ç­‰å¾…å†™å…¥æ“ä½œå®Œæˆçš„èŠ‚ç‚¹æ•°ã€‚å¦‚æœæŒ‡å®šä¸º majorityï¼Œåˆ™è¡¨ç¤ºç­‰å¾…å¤§å¤šæ•°èŠ‚ç‚¹å®Œæˆå†™å…¥æ“ä½œã€‚é»˜è®¤ä¸º 1ï¼Œè¡¨ç¤ºç­‰å¾…å†™å…¥æ“ä½œå®Œæˆçš„èŠ‚ç‚¹æ•°ä¸º 1ã€‚ jï¼šè¡¨ç¤ºå†™å…¥æ“ä½œæ˜¯å¦è¦æ±‚æŒä¹…åŒ–åˆ°ç£ç›˜ã€‚å¦‚æœè®¾ç½®ä¸º trueï¼Œåˆ™è¡¨ç¤ºå†™å…¥æ“ä½œå¿…é¡»æŒä¹…åŒ–åˆ°ç£ç›˜åæ‰è¿”å›æˆåŠŸã€‚å¦‚æœè®¾ç½®ä¸º falseï¼Œåˆ™è¡¨ç¤ºå†™å…¥æ“ä½œå¯èƒ½åœ¨æ•°æ®è¢«æŒä¹…åŒ–åˆ°ç£ç›˜ä¹‹å‰è¿”å›æˆåŠŸã€‚é»˜è®¤ä¸º falseã€‚ wtimeoutï¼šè¡¨ç¤ºç­‰å¾…å†™å…¥æ“ä½œå®Œæˆçš„è¶…æ—¶æ—¶é—´ï¼Œå•ä½ä¸ºæ¯«ç§’ã€‚å¦‚æœè¶…è¿‡æŒ‡å®šçš„æ—¶é—´ä»ç„¶æ²¡æœ‰è¿”å›ç¡®è®¤ä¿¡æ¯ï¼Œåˆ™è¿”å›é”™è¯¯ã€‚é»˜è®¤ä¸º 0ï¼Œè¡¨ç¤ºä¸è®¾ç½®è¶…æ—¶æ—¶é—´ã€‚ orderedï¼šæŒ‡å®šæ˜¯å¦æŒ‰é¡ºåºå†™å…¥ï¼Œé»˜è®¤ trueï¼ŒæŒ‰é¡ºåºå†™å…¥ã€‚ æ’å…¥å•ä¸ªæ–‡æ¡£ 1234567891011/* db.employee.insertOne(&#123; &quot;_id&quot;: 1, &quot;username&quot;: &quot;å°æ˜&quot;, &quot;age&quot;: 30, &quot;salary&quot;: 10000.00, &quot;entryDay&quot;: new Date() &#125;)*/Employee employee = new Employee(1, &quot;å°æ˜&quot;, 30, 10000.00, new Date());mongoTemplate.insert(employee); æ’å…¥å¤šä¸ªæ–‡æ¡£ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455/* db.employee.insertMany([ &#123; &quot;_id&quot;: 2, &quot;username&quot;: &quot;å¼ ä¸‰&quot;, &quot;age&quot;: 21, &quot;salary&quot;: 5000.00, &quot;entryDay&quot;: new Date() &#125;, &#123; &quot;_id&quot;: 3, &quot;username&quot;: &quot;æå››&quot;, &quot;age&quot;: 26, &quot;salary&quot;: 8000.00, &quot;entryDay&quot;: new Date() &#125;, &#123; &quot;_id&quot;: 4, &quot;username&quot;: &quot;ç‹äº”&quot;, &quot;age&quot;: 22, &quot;salary&quot;: 8000.00, &quot;entryDay&quot;: new Date() &#125;, &#123; &quot;_id&quot;: 5, &quot;username&quot;: &quot;å¼ é¾™&quot;, &quot;age&quot;: 28, &quot;salary&quot;: 6000.00, &quot;entryDay&quot;: new Date() &#125;, &#123; &quot;_id&quot;: 6, &quot;username&quot;: &quot;èµµè™&quot;, &quot;age&quot;: 24, &quot;salary&quot;: 7000.00, &quot;entryDay&quot;: new Date() &#125;, &#123; &quot;_id&quot;: 7, &quot;username&quot;: &quot;èµµå…­&quot;, &quot;age&quot;: 28, &quot;salary&quot;: 12000.00, &quot;entryDay&quot;: new Date() &#125; ])*/List&lt;Employee&gt; list = Arrays.asList( new Employee(2, &quot;å¼ ä¸‰&quot;, 21, 5000.00, new Date()), new Employee(3, &quot;æå››&quot;, 26, 8000.00, new Date()), new Employee(4, &quot;ç‹äº”&quot;, 22, 8000.00, new Date()), new Employee(5, &quot;å¼ é¾™&quot;, 28, 6000.00, new Date()), new Employee(6, &quot;èµµè™&quot;, 24, 7000.00, new Date()), new Employee(7, &quot;èµµå…­&quot;, 28, 12000.00, new Date()));//æ’å…¥å¤šæ¡æ•°æ®mongoTemplate.insert(list, Employee.class); idå­˜åœ¨æ—¶æ›´æ–°ï¼Œä¸å­˜åœ¨æ—¶æ’å…¥ 1234567891011121314151617/* db.employee.updateOne( &#123; &quot;_id&quot;: 1 &#125;, &#123; $set: &#123; &quot;name&quot;: &quot;å°æ˜&quot;, &quot;age&quot;: 30, &quot;salary&quot;: 10000.00, &quot;entryDay&quot;: ISODate(&quot;2024-03-05T00:00:00Z&quot;) &#125; &#125;, &#123; upsert: true &#125;)*/Employee employee = new Employee(1, &quot;å°æ˜&quot;, 30, 10000.00, new Date());//saveæ–¹æ³•ä¼šæ ¹æ®å¯¹è±¡çš„idæ˜¯å¦å­˜åœ¨æ¥åˆ¤æ–­æ˜¯æ›´æ–°è¿˜æ˜¯æ’å…¥mongoTemplate.save(employee); æ›´æ–° Mongoè¯­æ³• 123456789101112131415161718192021222324252627282930# æ›´æ–°å•ä¸ªæˆ–å¤šä¸ªæ–‡æ¡£db.collection.update[One|Many]( &lt;filter&gt;, &lt;update&gt;, &#123; upsert: &lt;boolean&gt;, writeConcern: &lt;document&gt;, collation: &lt;document&gt;, arrayFilters: [ &lt;filterdocument1&gt;, ... ], hint: &lt;document|string&gt; // Available starting in MongoDB 4.2.1 &#125;)# findAndModify,åªèƒ½æ›´æ–°å•ä¸ªæ–‡æ¡£db.collection.findAndModify(&#123; query:&lt;filter&gt;, update:&lt;update&gt;&#125;)# ç¤ºä¾‹ï¼Œè¯¥æ“ä½œä¼šè¿”å›ç¬¦åˆæŸ¥è¯¢æ¡ä»¶çš„æ–‡æ¡£æ•°æ®ï¼Œå¹¶å®Œæˆå¯¹æ–‡æ¡£çš„ä¿®æ”¹# å°†æŸä¸ªbookæ–‡æ¡£çš„æ”¶è—æ•°ï¼ˆfavCountï¼‰åŠ 1db.books.findAndModify(&#123; query:&#123;_id:ObjectId(&quot;6457a39c817728350ec83b9d&quot;)&#125;, update:&#123;$inc:&#123;favCount:1&#125;&#125;&#125;)# é»˜è®¤æƒ…å†µä¸‹ï¼ŒfindAndModifyä¼šè¿”å›ä¿®æ”¹å‰çš„â€œæ—§â€æ•°æ®ã€‚å¦‚æœå¸Œæœ›è¿”å›ä¿®æ”¹åçš„æ•°æ®ï¼Œåˆ™å¯ä»¥æŒ‡å®šnewé€‰é¡¹db.books.findAndModify(&#123; query:&#123;_id:ObjectId(&quot;6457a39c817728350ec83b9d&quot;)&#125;, update:&#123;$inc:&#123;favCount:1&#125;&#125;, new: true&#125;) å‚æ•° æè¿° &lt;filter&gt; ä¸€ä¸ªç­›é€‰å™¨å¯¹è±¡ï¼Œç”¨äºæŒ‡å®šè¦æ›´æ–°çš„æ–‡æ¡£ã€‚ &lt;update&gt; ä¸€ä¸ªæ›´æ–°æ“ä½œå¯¹è±¡ï¼Œç”¨äºæŒ‡å®šå¦‚ä½•æ›´æ–°æ–‡æ¡£ã€‚å¯ä»¥ä½¿ç”¨ä¸€äº›æ“ä½œç¬¦ï¼Œä¾‹å¦‚setã€incã€$unsetç­‰ï¼Œä»¥æ›´æ–°æ–‡æ¡£ä¸­çš„ç‰¹å®šå­—æ®µã€‚ upsert ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œç”¨äºæŒ‡å®šå¦‚æœæ‰¾ä¸åˆ°ä¸ç­›é€‰å™¨åŒ¹é…çš„æ–‡æ¡£æ—¶æ˜¯å¦åº”æ’å…¥ä¸€ä¸ªæ–°æ–‡æ¡£ã€‚å¦‚æœupsertä¸ºtrueï¼Œåˆ™ä¼šæ’å…¥ä¸€ä¸ªæ–°æ–‡æ¡£ã€‚é»˜è®¤å€¼ä¸ºfalseã€‚ writeConcern ä¸€ä¸ªæ–‡æ¡£ï¼Œç”¨äºæŒ‡å®šå†™å…¥æ“ä½œçš„å®‰å…¨çº§åˆ«ã€‚å¯ä»¥æŒ‡å®šå†™å…¥æ“ä½œéœ€è¦åˆ°è¾¾çš„èŠ‚ç‚¹æ•°æˆ–ç­‰å¾…å†™å…¥æ“ä½œçš„æ—¶é—´ã€‚ collation ä¸€ä¸ªæ–‡æ¡£ï¼Œç”¨äºæŒ‡å®šç”¨äºæŸ¥è¯¢çš„æ’åºè§„åˆ™ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥é€šè¿‡æŒ‡å®šlocaleå±æ€§æ¥æŒ‡å®šè¯­è¨€ç¯å¢ƒï¼Œä»è€Œå®ç°åŸºäºåŒºåŸŸè®¾ç½®çš„æ’åºã€‚ arrayFilters ä¸€ä¸ªæ•°ç»„ï¼Œç”¨äºæŒ‡å®šè¦æ›´æ–°çš„æ•°ç»„å…ƒç´ ã€‚æ•°ç»„å…ƒç´ æ˜¯é€šè¿‡ä½¿ç”¨æ›´æ–°æ“ä½œç¬¦[]å’Œæ¥æŒ‡å®šçš„ã€‚ hint ä¸€ä¸ªæ–‡æ¡£æˆ–å­—ç¬¦ä¸²ï¼Œç”¨äºæŒ‡å®šæŸ¥è¯¢ä½¿ç”¨çš„ç´¢å¼•ã€‚è¯¥å‚æ•°ä»…åœ¨MongoDB 4.2.1åŠä»¥ä¸Šç‰ˆæœ¬ä¸­å¯ç”¨ã€‚ æ›´æ–°æ“ä½œç¬¦ æ“ä½œç¬¦ æ ¼å¼ æè¿° $set { $set: { field: value } } æŒ‡å®šä¸€ä¸ªé”®å¹¶æ›´æ–°å€¼ï¼Œè‹¥é”®ä¸å­˜åœ¨åˆ™åˆ›å»ºã€‚ $unset { $unset : { field : 1 } } åˆ é™¤ä¸€ä¸ªé”®ã€‚ $inc { $inc : { field : value } } å¯¹æ•°å€¼ç±»å‹è¿›è¡Œå¢å‡ã€‚ $rename { $rename : { old_field_name : new_field_name } } ä¿®æ”¹å­—æ®µåç§°ã€‚ $push { $push : { field : value } } å°†æ•°å€¼è¿½åŠ åˆ°æ•°ç»„ä¸­ï¼Œè‹¥æ•°ç»„ä¸å­˜åœ¨åˆ™ä¼šè¿›è¡Œåˆå§‹åŒ–ã€‚ $pushAll { $pushAll : { field : value_array } } è¿½åŠ å¤šä¸ªå€¼åˆ°ä¸€ä¸ªæ•°ç»„å­—æ®µå†…ã€‚ $pull { $pull : { field : _value } } ä»æ•°ç»„ä¸­åˆ é™¤æŒ‡å®šçš„å…ƒç´ ã€‚ $addToSet { $addToSet : { field : value } } æ·»åŠ å…ƒç´ åˆ°æ•°ç»„ä¸­ï¼Œå…·æœ‰æ’é‡åŠŸèƒ½ã€‚ $pop { $pop : { field : 1 } } åˆ é™¤æ•°ç»„çš„ç¬¬ä¸€ä¸ªæˆ–æœ€åä¸€ä¸ªå…ƒç´ ã€‚ åªæ›´æ–°æ»¡è¶³æ¡ä»¶çš„ç¬¬ä¸€æ¡è®°å½• 12345678910111213/* db.employee.updateOne( &#123; &quot;salary&quot;: &#123; &quot;$gte&quot;: 8000 &#125; &#125;, &#123; &quot;$set&quot;: &#123; &quot;salary&quot;: 13000 &#125; &#125; ) */Query query = new Query(Criteria.where(&quot;salary&quot;).gte(8000));Update update = new Update();//è®¾ç½®æ›´æ–°å±æ€§update.set(&quot;salary&quot;, 13000);UpdateResult updateResult = mongoTemplate.updateFirst(query, update, Employee.class);//è¿”å›ä¿®æ”¹çš„è®°å½•æ•°System.out.println(updateResult.getModifiedCount()); æ›´æ–°æ‰€æœ‰æ»¡è¶³æ¡ä»¶çš„è®°å½• 12345678910111213/* db.employee.updateMany( &#123; &quot;salary&quot;: &#123; &quot;$gte&quot;: 8000 &#125; &#125;, &#123; &quot;$set&quot;: &#123; &quot;salary&quot;: 13000 &#125; &#125; )*/Query query = new Query(Criteria.where(&quot;salary&quot;).gte(8000));Update update = new Update();//è®¾ç½®æ›´æ–°å±æ€§update.set(&quot;salary&quot;, 13000);UpdateResult updateResult = mongoTemplate.updateMulti(query, update, Employee.class);//è¿”å›ä¿®æ”¹çš„è®°å½•æ•°System.out.println(updateResult.getModifiedCount()); æ²¡æœ‰ç¬¦åˆæ¡ä»¶çš„è®°å½•åˆ™æ’å…¥æ•°æ® 123456789101112131415/* db.employee.updateOne( &#123; &quot;salary&quot;: &#123; &quot;$gte&quot;: 8000 &#125; &#125;, &#123; &quot;$set&quot;: &#123; &quot;salary&quot;: 13000 &#125;, &quot;$setOnInsert&quot;: &#123; &quot;id&quot;: 11 &#125; &#125;, &#123; &quot;upsert&quot;: true &#125; )*/Query query = new Query(Criteria.where(&quot;salary&quot;).gte(8000));Update update = new Update();//è®¾ç½®æ›´æ–°å±æ€§update.set(&quot;salary&quot;, 13000);update.setOnInsert(&quot;id&quot;,11); //æŒ‡å®š_idï¼Œåªæœ‰æ²¡æœ‰åŒ¹é…åˆ°æ—¶æ‰æ’å…¥UpdateResult updateResult = mongoTemplate.upsert(query, update, Employee.class);//è¿”å›ä¿®æ”¹çš„è®°å½•æ•°System.out.println(updateResult.getModifiedCount()); æ›¿æ¢ Mongoè¯­æ³• 1234567891011db.collection.replaceOne( &lt;filter&gt;, &lt;replacement&gt;, &#123; upsert: &lt;boolean&gt;, writeConcern: &lt;document&gt;, collation: &lt;document&gt;, hint: &lt;document|string&gt; &#125;) replaceOneæ“ä½œä¼šé¦–å…ˆä½¿ç”¨æŒ‡å®šçš„ç­›é€‰æ¡ä»¶æ¥æŸ¥æ‰¾åŒ¹é…çš„æ–‡æ¡£ï¼Œç„¶åç”¨æä¾›çš„æ–°æ–‡æ¡£å®Œå…¨æ›¿æ¢æ‰åŸå§‹æ–‡æ¡£ï¼Œä¹Ÿå°±æ˜¯è¯´replaceOneæ˜¯æ•´ä½“æ›¿æ¢ï¼Œè€Œä¸æ˜¯ä¿®æ”¹æ–‡æ¡£ä¸­çš„æŸäº›å­—æ®µã€‚ å‚æ•° æè¿° &lt;filter&gt; ä¸€ä¸ªç­›é€‰å™¨å¯¹è±¡ï¼Œç”¨äºæŒ‡å®šè¦æ›¿æ¢çš„æ–‡æ¡£ã€‚åªæœ‰ä¸ç­›é€‰å™¨å¯¹è±¡åŒ¹é…çš„ç¬¬ä¸€ä¸ªæ–‡æ¡£æ‰ä¼šè¢«æ›¿æ¢ã€‚ &lt;replacement&gt; ä¸€ä¸ªæ›¿æ¢æ–‡æ¡£å¯¹è±¡ï¼Œç”¨äºæŒ‡å®šç”¨äºæ›¿æ¢åŸå§‹æ–‡æ¡£çš„æ–°æ–‡æ¡£ã€‚æ›¿æ¢æ–‡æ¡£å¿…é¡»åŒ…å«æ‰€æœ‰è¦åœ¨åŸå§‹æ–‡æ¡£ä¸­ä¿®æ”¹æˆ–æ›¿æ¢çš„å­—æ®µã€‚ upsert ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºå¦‚æœæ‰¾ä¸åˆ°ä¸ç­›é€‰å™¨åŒ¹é…çš„æ–‡æ¡£æ—¶æ˜¯å¦åº”æ’å…¥ä¸€ä¸ªæ–°æ–‡æ¡£ã€‚å¦‚æœè®¾ç½®ä¸ºtrueï¼Œåˆ™ä¼šæ’å…¥ä¸€ä¸ªæ–°æ–‡æ¡£ã€‚é»˜è®¤ä¸ºfalseã€‚ writeConcern ä¸€ä¸ªæ–‡æ¡£ï¼Œç”¨äºæŒ‡å®šå†™å…¥æ“ä½œçš„å®‰å…¨çº§åˆ«ã€‚å¯ä»¥æŒ‡å®šå†™å…¥æ“ä½œéœ€è¦åˆ°è¾¾çš„èŠ‚ç‚¹æ•°æˆ–ç­‰å¾…å†™å…¥æ“ä½œçš„æ—¶é—´ã€‚ collation ä¸€ä¸ªæ–‡æ¡£ï¼Œç”¨äºæŒ‡å®šç”¨äºæŸ¥è¯¢çš„æ’åºè§„åˆ™ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥é€šè¿‡æŒ‡å®šlocaleå±æ€§æ¥æŒ‡å®šè¯­è¨€ç¯å¢ƒï¼Œä»è€Œå®ç°åŸºäºåŒºåŸŸè®¾ç½®çš„æ’åºã€‚ hint ä¸€ä¸ªæ–‡æ¡£æˆ–å­—ç¬¦ä¸²ï¼Œç”¨äºæŒ‡å®šæŸ¥è¯¢ä½¿ç”¨çš„ç´¢å¼•ã€‚è¯¥å‚æ•°ä»…åœ¨MongoDB 4.2.1åŠä»¥ä¸Šç‰ˆæœ¬ä¸­å¯ç”¨ ç¤ºä¾‹ 1234567891011121314/*db.collection.replaceOne( &#123; &quot;name&quot;: &quot;John&quot; &#125;, // ç­›é€‰æ¡ä»¶ï¼ŒåŒ¹é…nameä¸ºJohnçš„æ–‡æ¡£ &#123; // æ›¿æ¢æ–‡æ¡£ï¼Œç”¨äºæ›¿æ¢åŒ¹é…åˆ°çš„æ–‡æ¡£ &quot;name&quot;: &quot;Peter&quot;, // æ–°çš„nameå­—æ®µå€¼ä¸ºPeter &quot;age&quot;: 30 // æ–°å¢ageå­—æ®µï¼Œå€¼ä¸º30 &#125;)*/Query query = new Query(Criteria.where(&quot;name&quot;).is(&quot;John&quot;));Employee replacement = new Employee();replacement.setName(&quot;Peter&quot;);replacement.setAge(30);mongoTemplate.findAndReplace(query, replacement); åˆ é™¤ Mongoè¯­æ³• 12345678# æŒ‰æ¡ä»¶åˆ é™¤å¤šä¸ªæ–‡æ¡£db.collection.deleteMany(&lt;filter&gt;)# æŒ‰æ¡ä»¶åˆ é™¤å•ä¸ªæ–‡æ¡£db.collection.deleteOne(&lt;filter&gt;)# å…ˆæŸ¥è¯¢ååˆ é™¤ï¼Œè¿”å›æŸ¥è¯¢æ¡ä»¶å¯¹åº”çš„æ–‡æ¡£ï¼Œsortæ˜¯å¯é€‰é¡¹db.collection.findOneAndDelete(&lt;filter&gt;,&#123;sort:&#123;field:1&#125;&#125;) åˆ é™¤æ‰€æœ‰æ–‡æ¡£ 123456// db.employee.deleteMany(&#123;&#125;)mongoTemplate.remove(new Query(),Employee.class);// db.employee.drop()// æ¸…ç©ºæ•°æ®ä¹Ÿå¯ä»¥ä½¿ç”¨dropæ–¹æ³•ï¼Œä½†æ˜¯è¿™æ ·ä¼šåˆ é™¤ç´¢å¼•mongoTemplate.dropCollection(Employee.class); æŒ‰æ¡ä»¶åˆ é™¤æ–‡æ¡£ 123// db.employee.deleteMany(&#123; &quot;salary&quot;: &#123; &quot;$gte&quot;: 10000 &#125; &#125;)Query query = new Query(Criteria.where(&quot;salary&quot;).gte(10000));mongoTemplate.remove(query, Employee.class); åˆ é™¤æŸ¥è¯¢åˆ°çš„ç¬¬ä¸€ä¸ªæ–‡æ¡£ 1234// db.employee.deleteOne(&#123; &quot;salary&quot;: &#123; &quot;$gte&quot;: 10000 &#125; &#125;)Query query = new Query(Criteria.where(&quot;salary&quot;).gte(10000));query.limit(1);mongoTemplate.remove(query, Employee.class); æ‰¹é‡æ“ä½œ bulkwrite()æ–¹æ³•æä¾›äº†æ‰§è¡Œæ‰¹é‡æ’å…¥ã€æ›´æ–°å’Œåˆ é™¤æ“ä½œçš„èƒ½åŠ›ã€‚ bulkWrite()æ”¯æŒä»¥ä¸‹å†™æ“ä½œ: insertOne updateOne updateMany replaceOne deleteOne deleteMany ç¤ºä¾‹ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192package com.hanqf;import lombok.AllArgsConstructor;import lombok.Data;import lombok.NoArgsConstructor;import org.junit.jupiter.api.Test;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.boot.test.context.SpringBootTest;import org.springframework.data.annotation.Id;import org.springframework.data.mongodb.core.BulkOperations;import org.springframework.data.mongodb.core.MongoTemplate;import org.springframework.data.mongodb.core.mapping.Document;import org.springframework.data.mongodb.core.query.Criteria;import org.springframework.data.mongodb.core.query.Query;import org.springframework.data.mongodb.core.query.Update;import java.util.Arrays;@SpringBootTestclass BulkWriteTests &#123; @Autowired private MongoTemplate mongoTemplate; /* db.pizzas.insertMany( [ &#123; _id: 0, type: &quot;pepperoni&quot;, size: &quot;small&quot;, price: 4 &#125;, &#123; _id: 1, type: &quot;cheese&quot;, size: &quot;medium&quot;, price: 7 &#125;, &#123; _id: 2, type: &quot;vegan&quot;, size: &quot;large&quot;, price: 8 &#125; ] ) */ @Test void insertManyPizzas() &#123; mongoTemplate.insertAll(Arrays.asList( new Pizza(0, &quot;pepperoni&quot;, &quot;small&quot;, 4), new Pizza(1, &quot;cheese&quot;, &quot;medium&quot;, 7), new Pizza(2, &quot;vegan&quot;, &quot;large&quot;, 8) )); &#125; /* db.pizzas.bulkWrite( [ &#123; insertOne: &#123; document: &#123; _id: 3, type: &quot;beef&quot;, size: &quot;medium&quot;, price: 6 &#125; &#125; &#125;, &#123; insertOne: &#123; document: &#123; _id: 4, type: &quot;sausage&quot;, size: &quot;large&quot;, price: 10 &#125; &#125; &#125;, &#123; updateOne: &#123; filter: &#123; type: &quot;cheese&quot; &#125;, update: &#123; $set: &#123; price: 8 &#125; &#125; &#125; &#125;, &#123; deleteOne: &#123; filter: &#123; type: &quot;pepperoni&quot;&#125; &#125; &#125;, &#123; replaceOne: &#123; filter: &#123; type: &quot;vegan&quot; &#125;, replacement: &#123; type: &quot;tofu&quot;, size: &quot;small&quot;, price: 4 &#125; &#125; &#125; ] ) */ @Test void performBulkWrite() &#123; BulkOperations bulkOperations = mongoTemplate.bulkOps(BulkOperations.BulkMode.ORDERED, Pizza.class); bulkOperations.insert(Arrays.asList( new Pizza(3, &quot;beef&quot;, &quot;medium&quot;, 6), new Pizza(4, &quot;sausage&quot;, &quot;large&quot;, 10) )); bulkOperations.updateOne( Query.query(Criteria.where(&quot;type&quot;).is(&quot;cheese&quot;)), new Update().set(&quot;price&quot;, 8) ); bulkOperations.remove( Query.query(Criteria.where(&quot;type&quot;).is(&quot;pepperoni&quot;)).limit(1) ); bulkOperations.replaceOne( Query.query(Criteria.where(&quot;type&quot;).is(&quot;vegan&quot;)), new Pizza(null, &quot;tofu&quot;, &quot;small&quot;, 4) ); bulkOperations.execute(); &#125; @Data @AllArgsConstructor @NoArgsConstructor @Document(&quot;pizza&quot;) private static class Pizza &#123; @Id private Integer _id; private String type; private String size; private Integer price; &#125;&#125;","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç»å¦‚ä½•ä½¿ç”¨SpringBootå®ç°MongoDB7.0çš„å•é›†åˆçš„CURDæ“ä½œ SpringBootç‰ˆæœ¬3.2.3ï¼ŒMongoDBç‰ˆæœ¬7.0.6 MongoDB CRUD Operations SQL to MongoDB Mapping Chart MongoDB7.0--SpringBootèšåˆæ“ä½œ","date_published":"2024-03-05T13:30:05.000Z","tags":["æŠ€æœ¯","linux","mongodb","mongodb"]},{"id":"https://blog.hanqunfeng.com/2024/03/01/mongodb7/","url":"https://blog.hanqunfeng.com/2024/03/01/mongodb7/","title":"MongoDB7.0çš„å®‰è£…","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç»Linuxä¸‹MongoDB7.0çš„å®‰è£…</p>\n</li>\n<li class=\"lvl-2\">\n<p>MongoDB<a href=\"https://www.mongodb.com/docs/v7.0/\">å®˜æ–¹æ–‡æ¡£</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡åŸºäº<code>CentOS8(x86_64)</code></p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"MongoDB-7-0æ–°ç‰¹æ€§\">MongoDB 7.0æ–°ç‰¹æ€§</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>2024å¹´8æœˆ15æ—¥ï¼ŒMongoDBæ­£å¼å‘å¸ƒ7.0ç‰ˆæœ¬ï¼Œæˆªæ­¢ç›®å‰æœ€æ–°ç‰ˆæœ¬ä¸º7.0.6ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://www.mongodb.com/docs/v7.0/release-notes/7.0/\">MongoDB7.0ç‰¹æ€§</a></p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://help.aliyun.com/zh/mongodb/product-overview/features-of-mongodb-7-0?spm=a2c4g.11186623.0.0.2acc36f3yP2Mr9\">é˜¿é‡Œäº‘å…³äºMongoDB7.0çš„ç‰¹æ€§è¯´æ˜</a>ï¼Œè¯¥æ–‡æ¡£ä¸­ä¹ŸåŒ…å«MongoDBå…¶å®ƒç‰ˆæœ¬çš„ç‰¹æ€§è¯´æ˜</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://www.mongodb.com/legal/support-policy/lifecycles\">MongoDB Software Lifecycle Schedules</a></p>\n</li>\n</ul>\n<h2 id=\"å®‰è£…MongoDB\">å®‰è£…MongoDB</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>mongodbçš„å®‰è£…æ–¹æ³•å¯ä»¥æŸ¥çœ‹<a href=\"https://www.mongodb.com/docs/v7.0/administration/install-community/\">å®˜æ–¹æ–‡æ¡£</a></p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://www.mongodb.com/try/download/community\">MongoDBä¸‹è½½åœ°å€</a>ï¼Œé€‰æ‹©åˆé€‚çš„ç‰ˆæœ¬ã€å¹³å°å’ŒåŒ…ç±»å‹</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#ä¸‹è½½MongoDB</span></span><br><span class=\"line\">wget https://fastdl.mongodb.org/linux/mongodb-linux-x86_64-rhel80-7.0.6.tgz</span><br><span class=\"line\"><span class=\"comment\"># è§£å‹</span></span><br><span class=\"line\">tar -zxvf mongodb-linux-x86_64-rhel80-7.0.6.tgz</span><br><span class=\"line\"><span class=\"comment\"># æ–¹ä¾¿èµ·è§ï¼Œåˆ›å»ºè½¯è¿æ¥</span></span><br><span class=\"line\"><span class=\"built_in\">ln</span> -s mongodb-linux-x86_64-rhel80-7.0.6 mongodb</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ä¿®æ”¹/etc/profileï¼Œæ·»åŠ ç¯å¢ƒå˜é‡ï¼Œæ–¹ä¾¿æ‰§è¡ŒMongoDBå‘½ä»¤</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> MONGODB_HOME=/usr/local/soft/mongodb</span><br><span class=\"line\">PATH=<span class=\"variable\">$PATH</span>:<span class=\"variable\">$MONGODB_HOME</span>/bin</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#é‡æ–°åŠ è½½ç¯å¢ƒå˜é‡</span></span><br><span class=\"line\"><span class=\"built_in\">source</span> /etc/profile</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#æŸ¥çœ‹ç‰ˆæœ¬ï¼Œæ£€æŸ¥å‘½ä»¤æ˜¯å¦å¯ç”¨</span></span><br><span class=\"line\">mongod --version</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#åˆ›å»ºdbpathå’Œlogpathçš„å­˜å‚¨ç›®å½•</span></span><br><span class=\"line\"><span class=\"built_in\">mkdir</span> -p /mongodb/data /mongodb/log</span><br></pre></td></tr></table></figure>\n<h3 id=\"å®‰è£…mongoDBæ—¶å¯èƒ½é‡åˆ°çš„é—®é¢˜\">å®‰è£…mongoDBæ—¶å¯èƒ½é‡åˆ°çš„é—®é¢˜</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<ol>\n<li class=\"lvl-5\">å¯åŠ¨mongodbæœåŠ¡æ—¶ï¼Œæç¤º<code>mongod: error while loading shared libraries: libcrypto.so.1.1: cannot open shared object file: No such file or directory</code></li>\n</ol>\n</li>\n</ul>\n<blockquote>\n<p>è§£å†³æ–¹æ³•ï¼š</p>\n</blockquote>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget  https://www.openssl.org/source/openssl-1.1.1w.tar.gz</span><br><span class=\"line\">tar -zxvf openssl-1.1.1w.tar.gz</span><br><span class=\"line\"><span class=\"built_in\">cd</span> openssl-1.1.1w</span><br><span class=\"line\">./config</span><br><span class=\"line\"><span class=\"comment\"># å¦‚æœmakeæ—¶æç¤º /bin/sh: gcc: command not foundï¼Œéœ€è¦å…ˆå®‰è£…gccï¼šsudo yum install gcc -y</span></span><br><span class=\"line\">make &amp;&amp; make install</span><br><span class=\"line\"><span class=\"built_in\">ln</span> -s /usr/local/lib64/libcrypto.so.1.1 /usr/lib64/libcrypto.so.1.1</span><br><span class=\"line\"><span class=\"built_in\">ln</span> -s /usr/local/lib64/libssl.so.1.1 /usr/lib64/libssl.so.1.1</span><br></pre></td></tr></table></figure>\n<h2 id=\"å¯åŠ¨mongodbæœåŠ¡\">å¯åŠ¨mongodbæœåŠ¡</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å‘½ä»¤å‚æ•°å¯åŠ¨</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mongod --port=27017 --dbpath=/mongodb/data --logpath=/mongodb/log/mongodb.log --bind_ip=0.0.0.0 --fork</span><br><span class=\"line\">    <span class=\"comment\"># å‚æ•°è¯´æ˜</span></span><br><span class=\"line\">    --port: æŒ‡å®šç«¯å£ï¼Œé»˜è®¤ä¸º27017</span><br><span class=\"line\">    --dbpath: æŒ‡å®šæ•°æ®æ–‡ä»¶å­˜æ”¾ç›®å½•</span><br><span class=\"line\">    --logpath: æŒ‡å®šæ—¥å¿—æ–‡ä»¶ï¼Œæ³¨æ„æ˜¯æŒ‡å®šæ–‡ä»¶ä¸æ˜¯ç›®å½•</span><br><span class=\"line\">    --bind_ip: é»˜è®¤åªç›‘å¬localhostç½‘å¡</span><br><span class=\"line\">    --fork: åå°å¯åŠ¨</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¹Ÿå¯ä»¥å°†ä¸Šé¢çš„å‚æ•°å†™åˆ°é…ç½®æ–‡ä»¶ä¸­ï¼Œå¦‚<code>/mongodb/conf/mongo.conf</code>æ–‡ä»¶ï¼Œå¿…é¡»æ˜¯yamlæ ¼å¼</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">systemLog:</span></span><br><span class=\"line\">  <span class=\"attr\">destination:</span> <span class=\"string\">file</span></span><br><span class=\"line\">  <span class=\"attr\">path:</span> <span class=\"string\">/mongodb/log/mongodb.log</span> <span class=\"comment\"># log path</span></span><br><span class=\"line\">  <span class=\"attr\">logAppend:</span> <span class=\"literal\">true</span></span><br><span class=\"line\"><span class=\"attr\">storage:</span></span><br><span class=\"line\">  <span class=\"attr\">dbPath:</span> <span class=\"string\">/mongodb/data</span> <span class=\"comment\"># data directory</span></span><br><span class=\"line\">  <span class=\"attr\">engine:</span> <span class=\"string\">wiredTiger</span>  <span class=\"comment\">#å­˜å‚¨å¼•æ“ï¼Œé»˜è®¤å€¼å°±æ˜¯wiredTiger</span></span><br><span class=\"line\">  <span class=\"attr\">journal:</span>            <span class=\"comment\">#journalæ—¥å¿—é…ç½®</span></span><br><span class=\"line\">    <span class=\"attr\">commitIntervalMs:</span> <span class=\"number\">100</span> <span class=\"comment\">#mongodè¿›ç¨‹åœ¨æ—¥å¿—æ“ä½œä¹‹é—´å…è®¸çš„æœ€å¤§æ—¶é—´ï¼ˆä»¥æ¯«ç§’ä¸ºå•ä½ï¼‰ã€‚å€¼å¯ä»¥ä»1åˆ°500æ¯«ç§’ä¸ç­‰ã€‚è¾ƒä½çš„å€¼ä¼šå¢åŠ æ—¥å¿—çš„è€ç”¨æ€§ï¼Œè€Œç‰ºç‰²äº†ç£ç›˜æ€§èƒ½ã€‚åœ¨WiredTigerä¸Šï¼Œé»˜è®¤çš„æ—¥å¿—æäº¤é—´éš”æ˜¯100æ¯«ç§’ã€‚æ­¤å¤–ï¼ŒåŒ…å«æˆ–æš—ç¤ºj:trueçš„å†™å…¥å°†å¯¼è‡´æœŸåˆŠç«‹å³åŒæ­¥ã€‚</span></span><br><span class=\"line\"><span class=\"attr\">net:</span></span><br><span class=\"line\">  <span class=\"attr\">bindIp:</span> <span class=\"number\">0.0</span><span class=\"number\">.0</span><span class=\"number\">.0</span></span><br><span class=\"line\">  <span class=\"attr\">port:</span> <span class=\"number\">27017</span></span><br><span class=\"line\"><span class=\"attr\">processManagement:</span></span><br><span class=\"line\">  <span class=\"attr\">fork:</span> <span class=\"literal\">true</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å°†å‘½ä»¤è¡Œå‚æ•°ç›´æ¥è½¬æ¢ä¸ºyaml:<code>--outputConfig</code></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ mongod --port=27017 --dbpath=/mongodb/data --logpath=/mongodb/log/mongodb.log --bind_ip=0.0.0.0 --fork --outputConfig</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">net:</span></span><br><span class=\"line\">  <span class=\"attr\">bindIp:</span> <span class=\"number\">0.0</span><span class=\"number\">.0</span><span class=\"number\">.0</span></span><br><span class=\"line\">  <span class=\"attr\">port:</span> <span class=\"number\">27017</span></span><br><span class=\"line\"><span class=\"attr\">outputConfig:</span> <span class=\"literal\">true</span></span><br><span class=\"line\"><span class=\"attr\">processManagement:</span></span><br><span class=\"line\">  <span class=\"attr\">fork:</span> <span class=\"literal\">true</span></span><br><span class=\"line\"><span class=\"attr\">storage:</span></span><br><span class=\"line\">  <span class=\"attr\">dbPath:</span> <span class=\"string\">/mongodb/data</span></span><br><span class=\"line\"><span class=\"attr\">systemLog:</span></span><br><span class=\"line\">  <span class=\"attr\">destination:</span> <span class=\"string\">file</span></span><br><span class=\"line\">  <span class=\"attr\">path:</span> <span class=\"string\">/mongodb/log/mongodb.log</span></span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>åˆ é™¤<code>outputConfig: true</code>è¿™ä¸€è¡Œï¼Œç„¶åå°†å…¶ä½™å†…å®¹å¤åˆ¶åˆ°mongo.confä¸­</p>\n</blockquote>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å…³äºé…ç½®å‚æ•°çš„è¯¦ç»†ä¿¡æ¯å¯ä»¥æŸ¥çœ‹<a href=\"https://www.mongodb.com/docs/v7.0/reference/configuration-options/\">å®˜æ–¹æ–‡æ¡£</a></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å¯åŠ¨mongoæœåŠ¡</span></span><br><span class=\"line\">mongod -f /mongodb/conf/mongo.conf</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å…³é—­mongoæœåŠ¡ï¼Œæ³¨æ„ï¼šmacosä¸‹ä¸æ”¯æŒ --shutdown</span></span><br><span class=\"line\">mongod -f /mongodb/conf/mongo.conf --shutdown</span><br></pre></td></tr></table></figure>\n<h2 id=\"shellå®¢æˆ·ç«¯mongosh\">shellå®¢æˆ·ç«¯mongosh</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä»mongodb6å¼€å§‹ä¸å†æ”¯æŒmongoå‘½ä»¤ï¼Œè€Œæ˜¯éœ€è¦ä½¿ç”¨mongoshå‘½ä»¤ï¼Œå…³äºmongoshå‘½ä»¤çš„ä½¿ç”¨å¯ä»¥æŸ¥çœ‹<a href=\"https://www.mongodb.com/docs/mongodb-shell/\">å®˜æ–¹æ–‡æ¡£</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>mongoshå‘½ä»¤çš„ä½¿ç”¨æ–¹å¼ä¸mongoå‘½ä»¤åŸºæœ¬ä¸€è‡´</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä¸‹è½½åœ°å€ï¼š<a href=\"https://www.mongodb.com/try/download/shell\">mongoshä¸‹è½½åœ°å€</a></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ä¸‹è½½å®‰è£…åŒ…</span></span><br><span class=\"line\"><span class=\"comment\"># openssl11æ˜¯centos7çš„ç‰ˆæœ¬ï¼Œç›®å‰æ”¯æŒcentos8ï¼Œä½†æ›´æ¨èä½¿ç”¨centos8æ—¶ä¸‹è½½openssl3çš„ç‰ˆæœ¬</span></span><br><span class=\"line\">wget https://downloads.mongodb.com/compass/mongosh-2.2.2-linux-x64-openssl11.tgz</span><br><span class=\"line\"><span class=\"comment\"># è§£å‹</span></span><br><span class=\"line\">tar -zxvf mongosh-2.2.2-linux-x64-openssl11.tgz</span><br><span class=\"line\"><span class=\"comment\"># åˆ›å»ºè½¯è¿æ¥</span></span><br><span class=\"line\"><span class=\"built_in\">ln</span> -s mongosh-2.2.2-linux-x64-openssl11 mongosh</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ä¿®æ”¹/etc/profileï¼Œæ·»åŠ ç¯å¢ƒå˜é‡ï¼Œæ–¹ä¾¿æ‰§è¡ŒMongoShellå‘½ä»¤</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> MONGODB_SHELL_HOME=/usr/local/soft/mongosh</span><br><span class=\"line\">PATH=<span class=\"variable\">$PATH</span>:<span class=\"variable\">$MONGODB_SHELL_HOME</span>/bin</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#é‡æ–°åŠ è½½ç¯å¢ƒå˜é‡</span></span><br><span class=\"line\"><span class=\"built_in\">source</span> /etc/profile</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹ç‰ˆæœ¬</span></span><br><span class=\"line\">mongosh --version</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># è¿æ¥mongodb serverç«¯</span></span><br><span class=\"line\">mongosh --host=127.0.0.1 --port=27017</span><br><span class=\"line\"><span class=\"comment\"># --host: mongodb serverç«¯ipåœ°å€</span></span><br><span class=\"line\"><span class=\"comment\"># --port: mongodb serverç«¯å£</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>mongoshå¸¸ç”¨å‘½ä»¤</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>å‘½ä»¤</th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>show dbs æˆ– show databases</td>\n<td>æ˜¾ç¤ºæ•°æ®åº“</td>\n</tr>\n<tr>\n<td>use æ•°æ®åº“å</td>\n<td>åˆ‡æ¢æ•°æ®åº“ï¼Œå¦‚æœä¸å­˜åœ¨åˆ›å»ºæ•°æ®åº“</td>\n</tr>\n<tr>\n<td>db.dropDatabase()</td>\n<td>åˆ é™¤æ•°æ®åº“</td>\n</tr>\n<tr>\n<td>show collections æˆ– show tables</td>\n<td>æ˜¾ç¤ºå½“å‰æ•°æ®åº“çš„é›†åˆåˆ—è¡¨</td>\n</tr>\n<tr>\n<td>db.é›†åˆå.stats()</td>\n<td>æŸ¥çœ‹é›†åˆè¯¦æƒ…</td>\n</tr>\n<tr>\n<td>db.é›†åˆå.drop()</td>\n<td>åˆ é™¤é›†åˆ</td>\n</tr>\n<tr>\n<td>show users</td>\n<td>æ˜¾ç¤ºå½“å‰æ•°æ®åº“çš„ç”¨æˆ·åˆ—è¡¨</td>\n</tr>\n<tr>\n<td>show roles</td>\n<td>æ˜¾ç¤ºå½“å‰æ•°æ®åº“çš„è§’è‰²åˆ—è¡¨</td>\n</tr>\n<tr>\n<td>show profile</td>\n<td>æ˜¾ç¤ºæœ€è¿‘å‘ç”Ÿçš„æ“ä½œ</td>\n</tr>\n<tr>\n<td>load(â€œxxx.jsâ€)</td>\n<td>æ‰§è¡Œä¸€ä¸ªJavaScriptè„šæœ¬æ–‡ä»¶</td>\n</tr>\n<tr>\n<td>exit æˆ– quit</td>\n<td>é€€å‡º</td>\n</tr>\n<tr>\n<td>help</td>\n<td>æŸ¥çœ‹mongodbæ”¯æŒå“ªäº›å‘½ä»¤</td>\n</tr>\n<tr>\n<td>db.help()</td>\n<td>æŸ¥è¯¢å½“å‰æ•°æ®åº“æ”¯æŒçš„æ–¹æ³•</td>\n</tr>\n<tr>\n<td>db.é›†åˆå.help()</td>\n<td>æ˜¾ç¤ºé›†åˆçš„å¸®åŠ©ä¿¡æ¯</td>\n</tr>\n<tr>\n<td>db.version()</td>\n<td>æŸ¥çœ‹æ•°æ®åº“ç‰ˆæœ¬</td>\n</tr>\n<tr>\n<td>cls</td>\n<td>æ¸…å±</td>\n</tr>\n<tr>\n<td>db.shutdownServer()</td>\n<td>å…³é—­mongodb serverç«¯</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"å®‰å…¨è®¤è¯\">å®‰å…¨è®¤è¯</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ›å»ºç®¡ç†å‘˜</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># è®¾ç½®ç®¡ç†å‘˜ç”¨æˆ·åå¯†ç éœ€è¦åˆ‡æ¢åˆ°adminåº“</span></span><br><span class=\"line\">use admin</span><br><span class=\"line\"><span class=\"comment\">#æ˜¾ç¤ºå¯è®¾ç½®æƒé™</span></span><br><span class=\"line\">show roles</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#åˆ›å»ºç®¡ç†å‘˜ï¼Œæˆäºˆrootè§’è‰²</span></span><br><span class=\"line\">db.createUser(&#123;user:<span class=\"string\">&quot;root&quot;</span>,<span class=\"built_in\">pwd</span>:<span class=\"string\">&quot;password&quot;</span>,roles:[<span class=\"string\">&quot;root&quot;</span>]&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#æŸ¥çœ‹å½“å‰æ•°æ®åº“æ‰€æœ‰ç”¨æˆ·ä¿¡æ¯</span></span><br><span class=\"line\">show <span class=\"built_in\">users</span></span><br><span class=\"line\"><span class=\"comment\">#æ˜¾ç¤ºæ‰€æœ‰ç”¨æˆ·</span></span><br><span class=\"line\">db.system.users.find()</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¸¸ç”¨è§’è‰²</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>æƒé™å</th>\n<th>æè¿°</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>read</td>\n<td>å…è®¸ç”¨æˆ·è¯»å–æŒ‡å®šæ•°æ®åº“</td>\n</tr>\n<tr>\n<td>readWrite</td>\n<td>å…è®¸ç”¨æˆ·è¯»å†™æŒ‡å®šæ•°æ®åº“</td>\n</tr>\n<tr>\n<td>dbAdmin</td>\n<td>å…è®¸ç”¨æˆ·åœ¨æŒ‡å®šæ•°æ®åº“ä¸­æ‰§è¡Œç®¡ç†å‡½æ•°ï¼Œå¦‚ç´¢å¼•åˆ›å»ºã€åˆ é™¤ï¼ŒæŸ¥çœ‹ç»Ÿè®¡æˆ–è®¿é—®system.profile</td>\n</tr>\n<tr>\n<td>dbOwner</td>\n<td>å…è®¸ç”¨æˆ·åœ¨æŒ‡å®šæ•°æ®åº“ä¸­æ‰§è¡Œä»»æ„æ“ä½œï¼Œå¢ã€åˆ ã€æ”¹ã€æŸ¥ç­‰</td>\n</tr>\n<tr>\n<td>userAdmin</td>\n<td>å…è®¸ç”¨æˆ·å‘system.usersé›†åˆå†™å…¥ï¼Œå¯ä»¥åœ¨æŒ‡å®šæ•°æ®åº“é‡Œåˆ›å»ºã€åˆ é™¤å’Œç®¡ç†ç”¨æˆ·</td>\n</tr>\n<tr>\n<td>clusterAdmin</td>\n<td>åªåœ¨adminæ•°æ®åº“ä¸­å¯ç”¨ï¼Œèµ‹äºˆç”¨æˆ·æ‰€æœ‰åˆ†ç‰‡å’Œå¤åˆ¶é›†ç›¸å…³å‡½æ•°çš„ç®¡ç†æƒé™</td>\n</tr>\n<tr>\n<td>readAnyDatabase</td>\n<td>åªåœ¨adminæ•°æ®åº“ä¸­å¯ç”¨ï¼Œèµ‹äºˆç”¨æˆ·æ‰€æœ‰æ•°æ®åº“çš„è¯»æƒé™</td>\n</tr>\n<tr>\n<td>readWriteAnyDatabase</td>\n<td>åªåœ¨adminæ•°æ®åº“ä¸­å¯ç”¨ï¼Œèµ‹äºˆç”¨æˆ·æ‰€æœ‰æ•°æ®åº“çš„è¯»å†™æƒé™</td>\n</tr>\n<tr>\n<td>userAdminAnyDatabase</td>\n<td>åªåœ¨adminæ•°æ®åº“ä¸­å¯ç”¨ï¼Œèµ‹äºˆç”¨æˆ·æ‰€æœ‰æ•°æ®åº“çš„userAdminæƒé™</td>\n</tr>\n<tr>\n<td>dbAdminAnyDatabase</td>\n<td>åªåœ¨adminæ•°æ®åº“ä¸­å¯ç”¨ï¼Œèµ‹äºˆç”¨æˆ·æ‰€æœ‰æ•°æ®åº“çš„dbAdminæƒé™</td>\n</tr>\n<tr>\n<td>root</td>\n<td>åªåœ¨adminæ•°æ®åº“ä¸­å¯ç”¨ã€‚è¶…çº§è´¦å·ï¼Œè¶…çº§æƒé™</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ›å»ºæ•°æ®åº“ç”¨æˆ·</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">admin&gt; use mydb</span><br><span class=\"line\">switched to db mydb</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># é»˜è®¤è®¤è¯æ•°æ®åº“ä¸ºå½“å‰æ•°æ®åº“ï¼Œä¸‹é¢çš„æˆæƒç­‰åŒäº &#123; role: &#x27;dbOwner&#x27;, db: &#x27;mydb&#x27; &#125;</span></span><br><span class=\"line\">mydb&gt; db.createUser(&#123;user:<span class=\"string\">&quot;mytest&quot;</span>,<span class=\"built_in\">pwd</span>:<span class=\"string\">&quot;123456&quot;</span>,roles:[<span class=\"string\">&quot;dbOwner&quot;</span>]&#125;)</span><br><span class=\"line\">&#123; ok: 1 &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ˜¾ç¤ºå½“å‰æ•°æ®åº“ä¸‹çš„ç”¨æˆ·</span></span><br><span class=\"line\">mydb&gt; show <span class=\"built_in\">users</span></span><br><span class=\"line\">[</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    _id: <span class=\"string\">&#x27;mydb.mytest&#x27;</span>,</span><br><span class=\"line\">    userId: UUID(<span class=\"string\">&#x27;8bc42a74-5d84-4849-af25-09fdcbdfd03a&#x27;</span>),</span><br><span class=\"line\">    user: <span class=\"string\">&#x27;mytest&#x27;</span>,</span><br><span class=\"line\">    db: <span class=\"string\">&#x27;mydb&#x27;</span>,</span><br><span class=\"line\">    roles: [ &#123; role: <span class=\"string\">&#x27;dbOwner&#x27;</span>, db: <span class=\"string\">&#x27;mydb&#x27;</span> &#125; ],</span><br><span class=\"line\">    mechanisms: [ <span class=\"string\">&#x27;SCRAM-SHA-1&#x27;</span>, <span class=\"string\">&#x27;SCRAM-SHA-256&#x27;</span> ]</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">]</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>é‡ç½®ç”¨æˆ·å¯†ç </p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mydb&gt; db.changeUserPassword(<span class=\"string\">&quot;mytest&quot;</span>, <span class=\"string\">&quot;password&quot;</span>)</span><br><span class=\"line\">&#123; ok: 1 &#125;</span><br><span class=\"line\"><span class=\"comment\"># æˆ–è€…</span></span><br><span class=\"line\">mydb&gt; db.updateUser(<span class=\"string\">&quot;mytest&quot;</span>, &#123;<span class=\"built_in\">pwd</span>: <span class=\"string\">&quot;password&quot;</span>&#125;)</span><br><span class=\"line\">&#123; ok: 1 &#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¸ºç”¨æˆ·æ·»åŠ è§’è‰²</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å‡è®¾å·²ç»åˆ›å»ºäº†ç”¨æˆ·mytestï¼Œéœ€è¦é‡æ–°èµ‹äºˆå…¶è§’è‰²</span></span><br><span class=\"line\">mydb&gt; db.grantRolesToUser( <span class=\"string\">&quot;mytest&quot;</span> , [</span><br><span class=\"line\"> &#123; role: <span class=\"string\">&quot;dbAdmin&quot;</span>, db: <span class=\"string\">&quot;mydb&quot;</span> &#125; ,</span><br><span class=\"line\"> &#123; role: <span class=\"string\">&quot;userAdmin&quot;</span>, db: <span class=\"string\">&quot;mydb&quot;</span>&#125;</span><br><span class=\"line\"> ])</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ é™¤ç”¨æˆ·çš„æŒ‡å®šè§’è‰²</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mydb&gt; db.revokeRolesFromUser( <span class=\"string\">&quot;mytest&quot;</span> , [</span><br><span class=\"line\">  &#123; role: <span class=\"string\">&quot;dbAdmin&quot;</span>, db: <span class=\"string\">&quot;mydb&quot;</span> &#125;</span><br><span class=\"line\">  ])</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ é™¤ç”¨æˆ·</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mydb&gt; db.dropUser(<span class=\"string\">&quot;mytest&quot;</span>)</span><br><span class=\"line\">&#123; ok: 1 &#125;</span><br><span class=\"line\">mydb&gt; show <span class=\"built_in\">users</span></span><br><span class=\"line\">[]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åˆ é™¤å…¨éƒ¨ç”¨æˆ·</span></span><br><span class=\"line\">mydb&gt; db.dropAllUsers()</span><br></pre></td></tr></table></figure>\n<h2 id=\"MongoDBå¯ç”¨é‰´æƒ\">MongoDBå¯ç”¨é‰´æƒ</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒMongoDBä¸ä¼šå¯ç”¨é‰´æƒï¼Œä»¥é‰´æƒæ¨¡å¼å¯åŠ¨MongoDBæœ‰ä¸¤ç§æ–¹æ³•</p>\n</li>\n</ul>\n<blockquote>\n<p>å‘½ä»¤è¡Œå‚æ•°å¢åŠ  <code>--auth</code></p>\n</blockquote>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mongod -f /mongodb/conf/mongo.conf --auth</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>é…ç½®æ–‡ä»¶ä¸­åŠ ä¸Šå¦‚ä¸‹å†…å®¹</p>\n</blockquote>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">security:</span></span><br><span class=\"line\">  <span class=\"attr\">authorization:</span> <span class=\"string\">enabled</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¯ç”¨é‰´æƒä¹‹åï¼Œè¿æ¥MongoDBçš„ç›¸å…³æ“ä½œéƒ½éœ€è¦æä¾›èº«ä»½è®¤è¯</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mongosh --host=127.0.0.1 --port=27017 -u root -p password --authenticationDatabase=admin</span><br><span class=\"line\"><span class=\"comment\"># -u: ç”¨æˆ·å</span></span><br><span class=\"line\"><span class=\"comment\"># -p: å¯†ç </span></span><br><span class=\"line\"><span class=\"comment\"># --authenticationDatabase: æŒ‡å®šè®¤è¯æ•°æ®åº“</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"mongoshè¿æ¥mongodb-serverç«¯çš„æ–¹å¼\">mongoshè¿æ¥mongodb serverç«¯çš„æ–¹å¼</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å‚æ•°æ–¹å¼</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å¯ä»¥é€šè¿‡ mongosh --help æŸ¥çœ‹å¸®åŠ©</span></span><br><span class=\"line\">mongosh --host=127.0.0.1 --port=27017 -u root -p password --authenticationDatabase=admin</span><br><span class=\"line\"><span class=\"comment\"># æŒ‡å®šè¿æ¥çš„æ•°æ®åº“ï¼Œè¿™é‡ŒæŒ‡å®šè¿æ¥åˆ°mydbæ•°æ®åº“ï¼Œå¦‚æœä¸æŒ‡å®šï¼Œé»˜è®¤è¿æ¥åˆ°testæ•°æ®åº“</span></span><br><span class=\"line\">mongosh mydb --host=127.0.0.1 --port=27017 -u root -p password --authenticationDatabase=admin</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ··åˆæ–¹å¼</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ip+ç«¯å£æ–¹å¼è¿æ¥</span></span><br><span class=\"line\">mongosh 127.0.0.1:27017</span><br><span class=\"line\"><span class=\"comment\"># ip+ç«¯å£æ–¹å¼è¿æ¥ï¼Œåé¢å¯ä»¥åŠ ä¸Šå„ç§å‚æ•°é…ç½®</span></span><br><span class=\"line\">mongosh 127.0.0.1:27017 -u root -p password --authenticationDatabase=admin</span><br><span class=\"line\"><span class=\"comment\"># ip+ç«¯å£æ–¹å¼è¿æ¥ï¼ŒåŒæ—¶å¯ä»¥æŒ‡å®šè¿æ¥çš„æ•°æ®åº“ï¼Œè¿™é‡ŒæŒ‡å®šè¿æ¥åˆ°mydbæ•°æ®åº“ï¼Œå¦‚æœä¸æŒ‡å®šï¼Œé»˜è®¤è¿æ¥åˆ°testæ•°æ®åº“</span></span><br><span class=\"line\">mongosh 127.0.0.1:27017/mydb</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>uriæ–¹å¼</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mongosh mongodb://127.0.0.1:27017</span><br><span class=\"line\"><span class=\"comment\"># æŒ‡å®šè¿æ¥æ•°æ®åº“</span></span><br><span class=\"line\">mongosh mongodb://127.0.0.1:27017/mydb</span><br><span class=\"line\"><span class=\"comment\"># å¸¦è®¤è¯æ–¹å¼è¿æ¥</span></span><br><span class=\"line\">mongosh <span class=\"string\">&quot;mongodb://root:password@127.0.0.1:27017/mydb?authSource=admin&quot;</span></span><br><span class=\"line\"><span class=\"comment\"># å¸¦è®¤è¯æ–¹å¼è¿æ¥ï¼ŒåŒæ—¶æŒ‡å®šreadPreferenceä¸ºprimaryPreferredï¼Œå³è¯»å–æ•°æ®æ—¶ä¼˜å…ˆä»ä¸»èŠ‚ç‚¹è¯»å–æ•°æ®</span></span><br><span class=\"line\">mongosh <span class=\"string\">&quot;mongodb://root:password@127.0.0.1:27019/mydb?authSource=admin&amp;readPreference=primaryPreferred&quot;</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¦‚æœåªæ˜¯è¿æ¥æœ¬æœºçš„serverç«¯ï¼Œè€Œä¸”ç«¯å£ä¸º27017ï¼Œå¯ä»¥çœç•¥hostå’Œport</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mongosh</span><br></pre></td></tr></table></figure>\n<h2 id=\"è§£å†³è¿æ¥MongoDBæ—¶å‡ºç°çš„-vm-max-map-count-is-too-low-çš„é—®é¢˜\">è§£å†³è¿æ¥MongoDBæ—¶å‡ºç°çš„ vm.max_map_count is too low çš„é—®é¢˜</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>é»˜è®¤çš„<code>vm.max_map_count</code>å€¼ä¸º<code>65530</code>ï¼Œå¦‚æœéœ€è¦å¼€å¯MongoDBçš„åˆ†ç‰‡åŠŸèƒ½ï¼Œéœ€è¦å°†<code>vm.max_map_count</code>è®¾ç½®ä¸ºè¾ƒé«˜çš„å€¼ï¼Œé€šå¸¸æ¨èä¸º<code>1048576</code></p>\n</li>\n<li class=\"lvl-2\">\n<p>æŸ¥çœ‹å½“å‰<code>vm.max_map_count</code>çš„å€¼</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sysctl vm.max_map_count</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¸´æ—¶å¢åŠ <code>vm.max_map_count</code>çš„å€¼</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sysctl -w vm.max_map_count=1048576</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ°¸ä¹…å¢åŠ <code>vm.max_map_count</code>çš„å€¼</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ä¿®æ”¹/etc/sysctl.confæ–‡ä»¶</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;vm.max_map_count = 1048576&quot;</span> &gt;&gt; /etc/sysctl.conf</span><br><span class=\"line\"><span class=\"comment\"># ä½¿é…ç½®ç”Ÿæ•ˆ</span></span><br><span class=\"line\">sysctl -p</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>é‡å¯MongoDBæ‰ä¼šç”Ÿæ•ˆ</p>\n</li>\n</ul>\n","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç»Linuxä¸‹MongoDB7.0çš„å®‰è£… MongoDBå®˜æ–¹æ–‡æ¡£ æœ¬æ–‡åŸºäºCentOS8(x86_64) MongoDB 7.0æ–°ç‰¹æ€§ 2024å¹´8æœˆ15æ—¥ï¼ŒMongoDBæ­£å¼å‘å¸ƒ7.0ç‰ˆæœ¬ï¼Œæˆªæ­¢ç›®å‰æœ€æ–°ç‰ˆæœ¬ä¸º7.0.6ã€‚ MongoDB7.0ç‰¹æ€§ é˜¿é‡Œäº‘å…³äºMongoDB7.0çš„ç‰¹æ€§è¯´æ˜ï¼Œè¯¥æ–‡æ¡£ä¸­ä¹ŸåŒ…å«MongoDBå…¶å®ƒç‰ˆæœ¬çš„ç‰¹æ€§è¯´æ˜ MongoDB Software Lifecycle Schedules å®‰è£…MongoDB mongodbçš„å®‰è£…æ–¹æ³•å¯ä»¥æŸ¥çœ‹å®˜æ–¹æ–‡æ¡£ MongoDBä¸‹è½½åœ°å€ï¼Œé€‰æ‹©åˆé€‚çš„ç‰ˆæœ¬ã€å¹³å°å’ŒåŒ…ç±»å‹ 12345678910111213141516171819#ä¸‹è½½MongoDBwget https://fastdl.mongodb.org/linux/mongodb-linux-x86_64-rhel80-7.0.6.tgz# è§£å‹tar -zxvf mongodb-linux-x86_64-rhel80-7.0.6.tgz# æ–¹ä¾¿èµ·è§ï¼Œåˆ›å»ºè½¯è¿æ¥ln -s mongodb-linux-x86_64-rhel80-7.0.6 mongodb# ä¿®æ”¹/etc/profileï¼Œæ·»åŠ ç¯å¢ƒå˜é‡ï¼Œæ–¹ä¾¿æ‰§è¡ŒMongoDBå‘½ä»¤export MONGODB_HOME=/usr/local/soft/mongodbPATH=$PATH:$MONGODB_HOME/bin#é‡æ–°åŠ è½½ç¯å¢ƒå˜é‡source /etc/profile#æŸ¥çœ‹ç‰ˆæœ¬ï¼Œæ£€æŸ¥å‘½ä»¤æ˜¯å¦å¯ç”¨mongod --version#åˆ›å»ºdbpathå’Œlogpathçš„å­˜å‚¨ç›®å½•mkdir -p /mongodb/data /mongodb/log å®‰è£…mongoDBæ—¶å¯èƒ½é‡åˆ°çš„é—®é¢˜ å¯åŠ¨mongodbæœåŠ¡æ—¶ï¼Œæç¤ºmongod: error while loading shared libraries: libcrypto.so.1.1: cannot open shared object file: No such file or directory è§£å†³æ–¹æ³•ï¼š 12345678wget https://www.openssl.org/source/openssl-1.1.1w.tar.gztar -zxvf openssl-1.1.1w.tar.gzcd openssl-1.1.1w./config# å¦‚æœmakeæ—¶æç¤º /bin/sh: gcc: command not foundï¼Œéœ€è¦å…ˆå®‰è£…gccï¼šsudo yum install gcc -ymake &amp;&amp; make installln -s /usr/local/lib64/libcrypto.so.1.1 /usr/lib64/libcrypto.so.1.1ln -s /usr/local/lib64/libssl.so.1.1 /usr/lib64/libssl.so.1.1 å¯åŠ¨mongodbæœåŠ¡ å‘½ä»¤å‚æ•°å¯åŠ¨ 1234567mongod --port=27017 --dbpath=/mongodb/data --logpath=/mongodb/log/mongodb.log --bind_ip=0.0.0.0 --fork # å‚æ•°è¯´æ˜ --port: æŒ‡å®šç«¯å£ï¼Œé»˜è®¤ä¸º27017 --dbpath: æŒ‡å®šæ•°æ®æ–‡ä»¶å­˜æ”¾ç›®å½• --logpath: æŒ‡å®šæ—¥å¿—æ–‡ä»¶ï¼Œæ³¨æ„æ˜¯æŒ‡å®šæ–‡ä»¶ä¸æ˜¯ç›®å½• --bind_ip: é»˜è®¤åªç›‘å¬localhostç½‘å¡ --fork: åå°å¯åŠ¨ ä¹Ÿå¯ä»¥å°†ä¸Šé¢çš„å‚æ•°å†™åˆ°é…ç½®æ–‡ä»¶ä¸­ï¼Œå¦‚/mongodb/conf/mongo.confæ–‡ä»¶ï¼Œå¿…é¡»æ˜¯yamlæ ¼å¼ 1234567891011121314systemLog: destination: file path: /mongodb/log/mongodb.log # log path logAppend: truestorage: dbPath: /mongodb/data # data directory engine: wiredTiger #å­˜å‚¨å¼•æ“ï¼Œé»˜è®¤å€¼å°±æ˜¯wiredTiger journal: #journalæ—¥å¿—é…ç½® commitIntervalMs: 100 #mongodè¿›ç¨‹åœ¨æ—¥å¿—æ“ä½œä¹‹é—´å…è®¸çš„æœ€å¤§æ—¶é—´ï¼ˆä»¥æ¯«ç§’ä¸ºå•ä½ï¼‰ã€‚å€¼å¯ä»¥ä»1åˆ°500æ¯«ç§’ä¸ç­‰ã€‚è¾ƒä½çš„å€¼ä¼šå¢åŠ æ—¥å¿—çš„è€ç”¨æ€§ï¼Œè€Œç‰ºç‰²äº†ç£ç›˜æ€§èƒ½ã€‚åœ¨WiredTigerä¸Šï¼Œé»˜è®¤çš„æ—¥å¿—æäº¤é—´éš”æ˜¯100æ¯«ç§’ã€‚æ­¤å¤–ï¼ŒåŒ…å«æˆ–æš—ç¤ºj:trueçš„å†™å…¥å°†å¯¼è‡´æœŸåˆŠç«‹å³åŒæ­¥ã€‚net: bindIp: 0.0.0.0 port: 27017processManagement: fork: true å°†å‘½ä»¤è¡Œå‚æ•°ç›´æ¥è½¬æ¢ä¸ºyaml:--outputConfig 1$ mongod --port=27017 --dbpath=/mongodb/data --logpath=/mongodb/log/mongodb.log --bind_ip=0.0.0.0 --fork --outputConfig 1234567891011net: bindIp: 0.0.0.0 port: 27017outputConfig: trueprocessManagement: fork: truestorage: dbPath: /mongodb/datasystemLog: destination: file path: /mongodb/log/mongodb.log åˆ é™¤outputConfig: trueè¿™ä¸€è¡Œï¼Œç„¶åå°†å…¶ä½™å†…å®¹å¤åˆ¶åˆ°mongo.confä¸­ å…³äºé…ç½®å‚æ•°çš„è¯¦ç»†ä¿¡æ¯å¯ä»¥æŸ¥çœ‹å®˜æ–¹æ–‡æ¡£ 12345# å¯åŠ¨mongoæœåŠ¡mongod -f /mongodb/conf/mongo.conf# å…³é—­mongoæœåŠ¡ï¼Œæ³¨æ„ï¼šmacosä¸‹ä¸æ”¯æŒ --shutdownmongod -f /mongodb/conf/mongo.conf --shutdown shellå®¢æˆ·ç«¯mongosh ä»mongodb6å¼€å§‹ä¸å†æ”¯æŒmongoå‘½ä»¤ï¼Œè€Œæ˜¯éœ€è¦ä½¿ç”¨mongoshå‘½ä»¤ï¼Œå…³äºmongoshå‘½ä»¤çš„ä½¿ç”¨å¯ä»¥æŸ¥çœ‹å®˜æ–¹æ–‡æ¡£ mongoshå‘½ä»¤çš„ä½¿ç”¨æ–¹å¼ä¸mongoå‘½ä»¤åŸºæœ¬ä¸€è‡´ ä¸‹è½½åœ°å€ï¼šmongoshä¸‹è½½åœ°å€ 12345678910111213141516171819202122# ä¸‹è½½å®‰è£…åŒ…# openssl11æ˜¯centos7çš„ç‰ˆæœ¬ï¼Œç›®å‰æ”¯æŒcentos8ï¼Œä½†æ›´æ¨èä½¿ç”¨centos8æ—¶ä¸‹è½½openssl3çš„ç‰ˆæœ¬wget https://downloads.mongodb.com/compass/mongosh-2.2.2-linux-x64-openssl11.tgz# è§£å‹tar -zxvf mongosh-2.2.2-linux-x64-openssl11.tgz# åˆ›å»ºè½¯è¿æ¥ln -s mongosh-2.2.2-linux-x64-openssl11 mongosh# ä¿®æ”¹/etc/profileï¼Œæ·»åŠ ç¯å¢ƒå˜é‡ï¼Œæ–¹ä¾¿æ‰§è¡ŒMongoShellå‘½ä»¤export MONGODB_SHELL_HOME=/usr/local/soft/mongoshPATH=$PATH:$MONGODB_SHELL_HOME/bin#é‡æ–°åŠ è½½ç¯å¢ƒå˜é‡source /etc/profile# æŸ¥çœ‹ç‰ˆæœ¬mongosh --version# è¿æ¥mongodb serverç«¯mongosh --host=127.0.0.1 --port=27017# --host: mongodb serverç«¯ipåœ°å€# --port: mongodb serverç«¯å£ mongoshå¸¸ç”¨å‘½ä»¤ å‘½ä»¤ è¯´æ˜ show dbs æˆ– show databases æ˜¾ç¤ºæ•°æ®åº“ use æ•°æ®åº“å åˆ‡æ¢æ•°æ®åº“ï¼Œå¦‚æœä¸å­˜åœ¨åˆ›å»ºæ•°æ®åº“ db.dropDatabase() åˆ é™¤æ•°æ®åº“ show collections æˆ– show tables æ˜¾ç¤ºå½“å‰æ•°æ®åº“çš„é›†åˆåˆ—è¡¨ db.é›†åˆå.stats() æŸ¥çœ‹é›†åˆè¯¦æƒ… db.é›†åˆå.drop() åˆ é™¤é›†åˆ show users æ˜¾ç¤ºå½“å‰æ•°æ®åº“çš„ç”¨æˆ·åˆ—è¡¨ show roles æ˜¾ç¤ºå½“å‰æ•°æ®åº“çš„è§’è‰²åˆ—è¡¨ show profile æ˜¾ç¤ºæœ€è¿‘å‘ç”Ÿçš„æ“ä½œ load(â€œxxx.jsâ€) æ‰§è¡Œä¸€ä¸ªJavaScriptè„šæœ¬æ–‡ä»¶ exit æˆ– quit é€€å‡º help æŸ¥çœ‹mongodbæ”¯æŒå“ªäº›å‘½ä»¤ db.help() æŸ¥è¯¢å½“å‰æ•°æ®åº“æ”¯æŒçš„æ–¹æ³• db.é›†åˆå.help() æ˜¾ç¤ºé›†åˆçš„å¸®åŠ©ä¿¡æ¯ db.version() æŸ¥çœ‹æ•°æ®åº“ç‰ˆæœ¬ cls æ¸…å± db.shutdownServer() å…³é—­mongodb serverç«¯ å®‰å…¨è®¤è¯ åˆ›å»ºç®¡ç†å‘˜ 123456789101112# è®¾ç½®ç®¡ç†å‘˜ç”¨æˆ·åå¯†ç éœ€è¦åˆ‡æ¢åˆ°adminåº“use admin#æ˜¾ç¤ºå¯è®¾ç½®æƒé™show roles#åˆ›å»ºç®¡ç†å‘˜ï¼Œæˆäºˆrootè§’è‰²db.createUser(&#123;user:&quot;root&quot;,pwd:&quot;password&quot;,roles:[&quot;root&quot;]&#125;)#æŸ¥çœ‹å½“å‰æ•°æ®åº“æ‰€æœ‰ç”¨æˆ·ä¿¡æ¯show users#æ˜¾ç¤ºæ‰€æœ‰ç”¨æˆ·db.system.users.find() å¸¸ç”¨è§’è‰² æƒé™å æè¿° read å…è®¸ç”¨æˆ·è¯»å–æŒ‡å®šæ•°æ®åº“ readWrite å…è®¸ç”¨æˆ·è¯»å†™æŒ‡å®šæ•°æ®åº“ dbAdmin å…è®¸ç”¨æˆ·åœ¨æŒ‡å®šæ•°æ®åº“ä¸­æ‰§è¡Œç®¡ç†å‡½æ•°ï¼Œå¦‚ç´¢å¼•åˆ›å»ºã€åˆ é™¤ï¼ŒæŸ¥çœ‹ç»Ÿè®¡æˆ–è®¿é—®system.profile dbOwner å…è®¸ç”¨æˆ·åœ¨æŒ‡å®šæ•°æ®åº“ä¸­æ‰§è¡Œä»»æ„æ“ä½œï¼Œå¢ã€åˆ ã€æ”¹ã€æŸ¥ç­‰ userAdmin å…è®¸ç”¨æˆ·å‘system.usersé›†åˆå†™å…¥ï¼Œå¯ä»¥åœ¨æŒ‡å®šæ•°æ®åº“é‡Œåˆ›å»ºã€åˆ é™¤å’Œç®¡ç†ç”¨æˆ· clusterAdmin åªåœ¨adminæ•°æ®åº“ä¸­å¯ç”¨ï¼Œèµ‹äºˆç”¨æˆ·æ‰€æœ‰åˆ†ç‰‡å’Œå¤åˆ¶é›†ç›¸å…³å‡½æ•°çš„ç®¡ç†æƒé™ readAnyDatabase åªåœ¨adminæ•°æ®åº“ä¸­å¯ç”¨ï¼Œèµ‹äºˆç”¨æˆ·æ‰€æœ‰æ•°æ®åº“çš„è¯»æƒé™ readWriteAnyDatabase åªåœ¨adminæ•°æ®åº“ä¸­å¯ç”¨ï¼Œèµ‹äºˆç”¨æˆ·æ‰€æœ‰æ•°æ®åº“çš„è¯»å†™æƒé™ userAdminAnyDatabase åªåœ¨adminæ•°æ®åº“ä¸­å¯ç”¨ï¼Œèµ‹äºˆç”¨æˆ·æ‰€æœ‰æ•°æ®åº“çš„userAdminæƒé™ dbAdminAnyDatabase åªåœ¨adminæ•°æ®åº“ä¸­å¯ç”¨ï¼Œèµ‹äºˆç”¨æˆ·æ‰€æœ‰æ•°æ®åº“çš„dbAdminæƒé™ root åªåœ¨adminæ•°æ®åº“ä¸­å¯ç”¨ã€‚è¶…çº§è´¦å·ï¼Œè¶…çº§æƒé™ åˆ›å»ºæ•°æ®åº“ç”¨æˆ· 12345678910111213141516171819admin&gt; use mydbswitched to db mydb# é»˜è®¤è®¤è¯æ•°æ®åº“ä¸ºå½“å‰æ•°æ®åº“ï¼Œä¸‹é¢çš„æˆæƒç­‰åŒäº &#123; role: &#x27;dbOwner&#x27;, db: &#x27;mydb&#x27; &#125;mydb&gt; db.createUser(&#123;user:&quot;mytest&quot;,pwd:&quot;123456&quot;,roles:[&quot;dbOwner&quot;]&#125;)&#123; ok: 1 &#125;# æ˜¾ç¤ºå½“å‰æ•°æ®åº“ä¸‹çš„ç”¨æˆ·mydb&gt; show users[ &#123; _id: &#x27;mydb.mytest&#x27;, userId: UUID(&#x27;8bc42a74-5d84-4849-af25-09fdcbdfd03a&#x27;), user: &#x27;mytest&#x27;, db: &#x27;mydb&#x27;, roles: [ &#123; role: &#x27;dbOwner&#x27;, db: &#x27;mydb&#x27; &#125; ], mechanisms: [ &#x27;SCRAM-SHA-1&#x27;, &#x27;SCRAM-SHA-256&#x27; ] &#125;] é‡ç½®ç”¨æˆ·å¯†ç  123456mydb&gt; db.changeUserPassword(&quot;mytest&quot;, &quot;password&quot;)&#123; ok: 1 &#125;# æˆ–è€…mydb&gt; db.updateUser(&quot;mytest&quot;, &#123;pwd: &quot;password&quot;&#125;)&#123; ok: 1 &#125; ä¸ºç”¨æˆ·æ·»åŠ è§’è‰² 12345# å‡è®¾å·²ç»åˆ›å»ºäº†ç”¨æˆ·mytestï¼Œéœ€è¦é‡æ–°èµ‹äºˆå…¶è§’è‰²mydb&gt; db.grantRolesToUser( &quot;mytest&quot; , [ &#123; role: &quot;dbAdmin&quot;, db: &quot;mydb&quot; &#125; , &#123; role: &quot;userAdmin&quot;, db: &quot;mydb&quot;&#125; ]) åˆ é™¤ç”¨æˆ·çš„æŒ‡å®šè§’è‰² 123mydb&gt; db.revokeRolesFromUser( &quot;mytest&quot; , [ &#123; role: &quot;dbAdmin&quot;, db: &quot;mydb&quot; &#125; ]) åˆ é™¤ç”¨æˆ· 1234567mydb&gt; db.dropUser(&quot;mytest&quot;)&#123; ok: 1 &#125;mydb&gt; show users[]# åˆ é™¤å…¨éƒ¨ç”¨æˆ·mydb&gt; db.dropAllUsers() MongoDBå¯ç”¨é‰´æƒ é»˜è®¤æƒ…å†µä¸‹ï¼ŒMongoDBä¸ä¼šå¯ç”¨é‰´æƒï¼Œä»¥é‰´æƒæ¨¡å¼å¯åŠ¨MongoDBæœ‰ä¸¤ç§æ–¹æ³• å‘½ä»¤è¡Œå‚æ•°å¢åŠ  --auth 1mongod -f /mongodb/conf/mongo.conf --auth é…ç½®æ–‡ä»¶ä¸­åŠ ä¸Šå¦‚ä¸‹å†…å®¹ 12security: authorization: enabled å¯ç”¨é‰´æƒä¹‹åï¼Œè¿æ¥MongoDBçš„ç›¸å…³æ“ä½œéƒ½éœ€è¦æä¾›èº«ä»½è®¤è¯ 1234mongosh --host=127.0.0.1 --port=27017 -u root -p password --authenticationDatabase=admin# -u: ç”¨æˆ·å# -p: å¯†ç # --authenticationDatabase: æŒ‡å®šè®¤è¯æ•°æ®åº“ mongoshè¿æ¥mongodb serverç«¯çš„æ–¹å¼ å‚æ•°æ–¹å¼ 1234# å¯ä»¥é€šè¿‡ mongosh --help æŸ¥çœ‹å¸®åŠ©mongosh --host=127.0.0.1 --port=27017 -u root -p password --authenticationDatabase=admin# æŒ‡å®šè¿æ¥çš„æ•°æ®åº“ï¼Œè¿™é‡ŒæŒ‡å®šè¿æ¥åˆ°mydbæ•°æ®åº“ï¼Œå¦‚æœä¸æŒ‡å®šï¼Œé»˜è®¤è¿æ¥åˆ°testæ•°æ®åº“mongosh mydb --host=127.0.0.1 --port=27017 -u root -p password --authenticationDatabase=admin æ··åˆæ–¹å¼ 123456# ip+ç«¯å£æ–¹å¼è¿æ¥mongosh 127.0.0.1:27017# ip+ç«¯å£æ–¹å¼è¿æ¥ï¼Œåé¢å¯ä»¥åŠ ä¸Šå„ç§å‚æ•°é…ç½®mongosh 127.0.0.1:27017 -u root -p password --authenticationDatabase=admin# ip+ç«¯å£æ–¹å¼è¿æ¥ï¼ŒåŒæ—¶å¯ä»¥æŒ‡å®šè¿æ¥çš„æ•°æ®åº“ï¼Œè¿™é‡ŒæŒ‡å®šè¿æ¥åˆ°mydbæ•°æ®åº“ï¼Œå¦‚æœä¸æŒ‡å®šï¼Œé»˜è®¤è¿æ¥åˆ°testæ•°æ®åº“mongosh 127.0.0.1:27017/mydb uriæ–¹å¼ 1234567mongosh mongodb://127.0.0.1:27017# æŒ‡å®šè¿æ¥æ•°æ®åº“mongosh mongodb://127.0.0.1:27017/mydb# å¸¦è®¤è¯æ–¹å¼è¿æ¥mongosh &quot;mongodb://root:password@127.0.0.1:27017/mydb?authSource=admin&quot;# å¸¦è®¤è¯æ–¹å¼è¿æ¥ï¼ŒåŒæ—¶æŒ‡å®šreadPreferenceä¸ºprimaryPreferredï¼Œå³è¯»å–æ•°æ®æ—¶ä¼˜å…ˆä»ä¸»èŠ‚ç‚¹è¯»å–æ•°æ®mongosh &quot;mongodb://root:password@127.0.0.1:27019/mydb?authSource=admin&amp;readPreference=primaryPreferred&quot; å¦‚æœåªæ˜¯è¿æ¥æœ¬æœºçš„serverç«¯ï¼Œè€Œä¸”ç«¯å£ä¸º27017ï¼Œå¯ä»¥çœç•¥hostå’Œport 1mongosh è§£å†³è¿æ¥MongoDBæ—¶å‡ºç°çš„ vm.max_map_count is too low çš„é—®é¢˜ é»˜è®¤çš„vm.max_map_countå€¼ä¸º65530ï¼Œå¦‚æœéœ€è¦å¼€å¯MongoDBçš„åˆ†ç‰‡åŠŸèƒ½ï¼Œéœ€è¦å°†vm.max_map_countè®¾ç½®ä¸ºè¾ƒé«˜çš„å€¼ï¼Œé€šå¸¸æ¨èä¸º1048576 æŸ¥çœ‹å½“å‰vm.max_map_countçš„å€¼ 1sysctl vm.max_map_count ä¸´æ—¶å¢åŠ vm.max_map_countçš„å€¼ 1sysctl -w vm.max_map_count=1048576 æ°¸ä¹…å¢åŠ vm.max_map_countçš„å€¼ 1234# ä¿®æ”¹/etc/sysctl.confæ–‡ä»¶echo &quot;vm.max_map_count = 1048576&quot; &gt;&gt; /etc/sysctl.conf# ä½¿é…ç½®ç”Ÿæ•ˆsysctl -p é‡å¯MongoDBæ‰ä¼šç”Ÿæ•ˆ","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç»Linuxä¸‹MongoDB7.0çš„å®‰è£… MongoDBå®˜æ–¹æ–‡æ¡£ æœ¬æ–‡åŸºäºCentOS8(x86_64)","date_published":"2024-03-01T13:30:05.000Z","tags":["æŠ€æœ¯","linux","mongodb","mongodb"]},{"id":"https://blog.hanqunfeng.com/2024/02/28/linux-command13-echo-printf/","url":"https://blog.hanqunfeng.com/2024/02/28/linux-command13-echo-printf/","title":"Linuxå¸¸ç”¨å‘½ä»¤--echoä¸printf","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åœ¨ç¼–å†™ shell è„šæœ¬æ—¶ï¼Œecho å’Œ printf æ˜¯ä¸¤ä¸ªå¸¸ç”¨çš„å‘½ä»¤ï¼Œç”¨äºè¾“å‡ºä¿¡æ¯åˆ°æ ‡å‡†è¾“å‡ºè®¾å¤‡ã€‚è™½ç„¶å®ƒä»¬çœ‹ä¼¼ç®€å•ï¼Œä½†æ·±å…¥ç†è§£å®ƒä»¬çš„ä½¿ç”¨æ–¹å¼å’Œå†…éƒ¨æœºåˆ¶å¯¹äºç¼–å†™é«˜æ•ˆã€å¯è¯»æ€§å¼ºçš„è„šæœ¬è‡³å…³é‡è¦ã€‚</p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"echo-å‘½ä»¤\">echo å‘½ä»¤</h2>\n<h3 id=\"åŸºæœ¬è¯­æ³•å’Œç”¨æ³•\">åŸºæœ¬è¯­æ³•å’Œç”¨æ³•</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><code>echo</code> å‘½ä»¤çš„åŸºæœ¬è¯­æ³•ä¸ºï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">echo</span> [é€‰é¡¹] [å­—ç¬¦ä¸²æˆ–å˜é‡]</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å‚æ•°å’Œé€‰é¡¹</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">-nï¼šä¸æ¢è¡Œè¾“å‡ºã€‚</span><br><span class=\"line\">-eï¼šè§£é‡Šè½¬ä¹‰å­—ç¬¦ã€‚</span><br><span class=\"line\">-Eï¼šç¦æ­¢è§£é‡Šè½¬ä¹‰å­—ç¬¦ã€‚</span><br><span class=\"line\"></span><br><span class=\"line\">å¸¸è§çš„è½¬ä¹‰å­—ç¬¦åŒ…æ‹¬ \\nï¼ˆæ¢è¡Œï¼‰ã€\\tï¼ˆåˆ¶è¡¨ç¬¦ï¼‰ç­‰ã€‚</span><br></pre></td></tr></table></figure>\n<h3 id=\"å®é™…åº”ç”¨ç¤ºä¾‹\">å®é™…åº”ç”¨ç¤ºä¾‹</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- æ‰“å°ä¸€ä¸ªæ–‡æœ¬æ¶ˆæ¯ã€‚æ³¨æ„ï¼šå¼•å·æ˜¯å¯é€‰çš„</span><br><span class=\"line\">    <span class=\"built_in\">echo</span> <span class=\"string\">&quot;Hello World&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">- æ‰“å°ä¸€ä¸ªå¸¦ç¯å¢ƒå˜é‡çš„æ¶ˆæ¯</span><br><span class=\"line\">    <span class=\"built_in\">echo</span> <span class=\"string\">&quot;My path is <span class=\"variable\">$PATH</span>&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">- æ‰“å°ä¸€ä¸ªä¸å¸¦å°¾éšæ¢è¡Œç¬¦çš„æ¶ˆæ¯</span><br><span class=\"line\">    <span class=\"built_in\">echo</span> -n <span class=\"string\">&quot;Hello World&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">- å°†æ¶ˆæ¯è¿½åŠ åˆ°æ–‡ä»¶ä¸­</span><br><span class=\"line\">    <span class=\"built_in\">echo</span> <span class=\"string\">&quot;Hello World&quot;</span> &gt;&gt; file.txt</span><br><span class=\"line\"></span><br><span class=\"line\">- å¯ç”¨åæ–œæ è½¬ä¹‰ï¼ˆç‰¹æ®Šå­—ç¬¦ï¼‰çš„è§£é‡Š</span><br><span class=\"line\">    <span class=\"built_in\">echo</span> -e <span class=\"string\">&quot;Column 1\\tColumn 2&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">- æ‰“å°æœ€åä¸€ä¸ªæ‰§è¡Œå‘½ä»¤çš„é€€å‡ºçŠ¶æ€</span><br><span class=\"line\">    <span class=\"built_in\">echo</span> $?</span><br></pre></td></tr></table></figure>\n<h3 id=\"echoè¾“å‡ºé¢œè‰²åŒ–æ–‡æœ¬\">echoè¾“å‡ºé¢œè‰²åŒ–æ–‡æœ¬</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">echo</span> -e <span class=\"string\">&quot;\\e[1;31mError:\\e[0m Something went wrong.&quot;</span></span><br><span class=\"line\"><span class=\"comment\"># æˆ–</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> -e <span class=\"string\">&quot;\\033[1;31mError:\\033[0m Something went wrong.&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># è¯´æ˜ï¼š</span></span><br><span class=\"line\">\\e[1;31mï¼šè¿™éƒ¨åˆ†æ§åˆ¶æ–‡æœ¬çš„é¢œè‰²å’Œæ ·å¼ã€‚</span><br><span class=\"line\">å…¶ä¸­ï¼š</span><br><span class=\"line\">    \\e è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªè½¬ä¹‰å­—ç¬¦ï¼Œå®ƒæ˜¯ ANSI è½¬ä¹‰åºåˆ—çš„èµ·å§‹ï¼Œåè·Ÿä¸€ç³»åˆ—ç”¨äºæ§åˆ¶æ–‡æœ¬é¢œè‰²ã€æ ·å¼ç­‰çš„æ•°å­—å’Œå­—ç¬¦ã€‚è¿™é‡Œ\\eä¹Ÿå¯ä»¥ç”¨\\033æ›¿ä»£ã€‚</span><br><span class=\"line\">    1 è¡¨ç¤ºè®¾ç½®æ–‡æœ¬ä¸ºç²—ä½“ï¼ˆæˆ–è€…ç§°ä¸ºé«˜äº®ï¼‰ã€‚</span><br><span class=\"line\">    31 è¡¨ç¤ºè®¾ç½®æ–‡æœ¬é¢œè‰²ä¸ºçº¢è‰²ã€‚ä¸åŒçš„æ•°å­—ä»£è¡¨ä¸åŒçš„é¢œè‰²ï¼Œè¿™é‡Œçš„ 31 å¯¹åº”çº¢è‰²ã€‚</span><br><span class=\"line\"></span><br><span class=\"line\">\\e[0mï¼šè¿™éƒ¨åˆ†é‡ç½®æ–‡æœ¬æ ¼å¼ä¸ºé»˜è®¤å€¼ã€‚è¿™æ ·åšæ˜¯ä¸ºäº†ç¡®ä¿åœ¨ä¹‹åçš„è¾“å‡ºä¸­æ–‡æœ¬æ ·å¼ä¸å—ä¹‹å‰çš„å½±å“ã€‚</span><br><span class=\"line\"></span><br><span class=\"line\">å› æ­¤ï¼Œè¿™æ¡å‘½ä»¤ä¼šè¾“å‡ºä¸€ä¸ªçº¢è‰²çš„â€œError:â€ï¼Œæ¥ç€æ˜¯ä¸€ä¸ªç©ºæ ¼ï¼Œç„¶åæ˜¯æ™®é€šæ–‡æœ¬â€œSomething went wrong.â€ã€‚æ•´ä½“æ•ˆæœæ˜¯ï¼Œé”™è¯¯æ¶ˆæ¯ä»¥çº¢è‰²é«˜äº®æ˜¾ç¤ºï¼Œä½¿å…¶åœ¨è¾“å‡ºä¸­æ›´åŠ é†’ç›®ã€‚</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">é¢œè‰²ï¼š</span><br><span class=\"line\">    30ï¼šé»‘è‰²</span><br><span class=\"line\">    31ï¼šçº¢è‰²</span><br><span class=\"line\">    32ï¼šç»¿è‰²</span><br><span class=\"line\">    33ï¼šé»„è‰²</span><br><span class=\"line\">    34ï¼šè“è‰²</span><br><span class=\"line\">    35ï¼šç´«è‰²</span><br><span class=\"line\">    36ï¼šé’è‰²</span><br><span class=\"line\">    37ï¼šç™½è‰²</span><br><span class=\"line\"></span><br><span class=\"line\">æ ·å¼ï¼š</span><br><span class=\"line\">    0ï¼šé‡ç½®æ‰€æœ‰æ ·å¼ï¼ˆé»˜è®¤å€¼ï¼‰</span><br><span class=\"line\">    1ï¼šç²—ä½“ï¼ˆæˆ–é«˜äº®ï¼‰</span><br><span class=\"line\">    2ï¼šæš—è‰²ï¼ˆä¸å¸¸è§ï¼Œè§†ç»ˆç«¯è€Œå®šï¼‰</span><br><span class=\"line\">    3ï¼šæ–œä½“ï¼ˆä¸å¸¸è§ï¼Œè§†ç»ˆç«¯è€Œå®šï¼‰</span><br><span class=\"line\">    4ï¼šä¸‹åˆ’çº¿</span><br><span class=\"line\">    5ï¼šé—ªçƒï¼ˆä¸å¸¸è§ï¼Œè§†ç»ˆç«¯è€Œå®šï¼‰</span><br><span class=\"line\">    7ï¼šåæ˜¾ï¼ˆå‰æ™¯è‰²ä¸èƒŒæ™¯è‰²äº¤æ¢ï¼‰</span><br><span class=\"line\">    8ï¼šéšè—ï¼ˆæ–‡æœ¬ä¸å¯è§ï¼‰</span><br><span class=\"line\"></span><br><span class=\"line\">è¿™äº›æ•°å­—å’Œå­—ç¬¦å¯ä»¥å•ç‹¬ä½¿ç”¨ï¼Œæ¯”å¦‚\\e[1m è¡¨ç¤ºåŠ ç²—ï¼Œ\\e[31m è¡¨ç¤ºè®¾ç½®æ–‡æœ¬é¢œè‰²ä¸ºçº¢è‰²ã€‚</span><br><span class=\"line\">ä¹Ÿå¯ä»¥ç»„åˆä½¿ç”¨ï¼Œæ¯”å¦‚ \\e[1;31m è¡¨ç¤ºè®¾ç½®æ–‡æœ¬ä¸ºçº¢è‰²å¹¶åŠ ç²—ï¼Œä¸­é—´ç”¨åˆ†å·éš”å¼€ã€‚</span><br></pre></td></tr></table></figure>\n<h2 id=\"printf-å‘½ä»¤\">printf å‘½ä»¤</h2>\n<h3 id=\"åŸºæœ¬è¯­æ³•å’Œç”¨æ³•-2\">åŸºæœ¬è¯­æ³•å’Œç”¨æ³•</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><code>printf</code> å‘½ä»¤çš„åŸºæœ¬è¯­æ³•ä¸ºï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">printf</span> [æ ¼å¼åŒ–å­—ç¬¦ä¸²] [å‚æ•°]</span><br></pre></td></tr></table></figure>\n<h3 id=\"å®é™…åº”ç”¨ç¤ºä¾‹-2\">å®é™…åº”ç”¨ç¤ºä¾‹</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- æ‰“å°æ–‡æœ¬æ¶ˆæ¯ï¼š</span><br><span class=\"line\">    <span class=\"built_in\">printf</span> <span class=\"string\">&quot;%s\\n&quot;</span> <span class=\"string\">&quot;Hello world&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">- ä»¥è“è‰²ç²—ä½“æ‰“å°æ•´æ•°ï¼šä½¿ç”¨æ–¹æ³•åŒ<span class=\"built_in\">echo</span></span><br><span class=\"line\">    <span class=\"built_in\">printf</span> <span class=\"string\">&quot;\\e[1;34m%.3d\\e[0m\\n&quot;</span> 42</span><br><span class=\"line\"></span><br><span class=\"line\">- æ‰“å°å¸¦æœ‰Unicode Euroç¬¦å·çš„æµ®ç‚¹æ•°ï¼š</span><br><span class=\"line\">    <span class=\"built_in\">printf</span> <span class=\"string\">&quot;\\u20AC %.2f\\n&quot;</span> 123.4</span><br><span class=\"line\"></span><br><span class=\"line\">- æ‰“å°ç”±å˜é‡ç»„æˆçš„æ–‡æœ¬æ¶ˆæ¯ï¼š</span><br><span class=\"line\">    <span class=\"built_in\">printf</span> <span class=\"string\">&quot;var1: %s\\tvar2: %s\\n&quot;</span> <span class=\"string\">&quot;<span class=\"variable\">$var1</span>&quot;</span> <span class=\"string\">&quot;<span class=\"variable\">$var2</span>&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">- å°†æ ¼å¼åŒ–çš„æ¶ˆæ¯å­˜å‚¨åœ¨å˜é‡ä¸­ï¼š</span><br><span class=\"line\">    <span class=\"built_in\">printf</span> -v myvar <span class=\"string\">&quot;This is %s = %d\\n&quot;</span> <span class=\"string\">&quot;a year&quot;</span> 2016</span><br><span class=\"line\">    <span class=\"built_in\">echo</span> <span class=\"variable\">$myvar</span></span><br><span class=\"line\">    This is a year = 2016</span><br></pre></td></tr></table></figure>\n<div class=\"tips\">\n<p>åœ¨ printf å‘½ä»¤ä¸­ï¼Œæ”¯æŒçš„æ ¼å¼åŒ–ç¬¦å·ç”¨äºæŒ‡å®šè¾“å‡ºçš„æ ¼å¼ï¼ŒåŒ…æ‹¬æ•´æ•°ã€æµ®ç‚¹æ•°ã€å­—ç¬¦ä¸²ç­‰ã€‚<br>\nä»¥ä¸‹æ˜¯å¸¸ç”¨çš„æ ¼å¼åŒ–ç¬¦å·åŠå…¶ä½¿ç”¨ç¤ºä¾‹ï¼š</p>\n<ul class=\"lvl-1\">\n<li class=\"lvl-2\">\n<p>1.æ•´æ•°æ ¼å¼åŒ–ç¬¦å·ï¼š</p>\n<ul class=\"lvl-3\">\n<li class=\"lvl-6\">%dï¼šä»¥åè¿›åˆ¶å½¢å¼è¾“å‡ºæ•´æ•°ã€‚</li>\n<li class=\"lvl-6\">%.ndï¼šæŒ‡å®šæ•°å­—å å‡ ä½ï¼Œä¸è¶³éƒ¨åˆ†å‰é¢è¡¥0ã€‚</li>\n<li class=\"lvl-6\">%oï¼šä»¥å…«è¿›åˆ¶å½¢å¼è¾“å‡ºæ•´æ•°ã€‚</li>\n<li class=\"lvl-6\">%x æˆ– %Xï¼šä»¥åå…­è¿›åˆ¶å½¢å¼è¾“å‡ºæ•´æ•°ï¼ˆå°å†™æˆ–å¤§å†™ï¼‰ã€‚</li>\n</ul>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">printf</span> <span class=\"string\">&quot;%d\\n&quot;</span> 42      <span class=\"comment\"># è¾“å‡ºï¼š42</span></span><br><span class=\"line\"><span class=\"built_in\">printf</span> <span class=\"string\">&quot;%.3d\\n&quot;</span> 42    <span class=\"comment\"># è¾“å‡ºï¼š042</span></span><br><span class=\"line\"><span class=\"built_in\">printf</span> <span class=\"string\">&quot;%o\\n&quot;</span> 42      <span class=\"comment\"># è¾“å‡ºï¼š52</span></span><br><span class=\"line\"><span class=\"built_in\">printf</span> <span class=\"string\">&quot;%x\\n&quot;</span> 42      <span class=\"comment\"># è¾“å‡ºï¼š2a</span></span><br><span class=\"line\"><span class=\"built_in\">printf</span> <span class=\"string\">&quot;%X\\n&quot;</span> 42      <span class=\"comment\"># è¾“å‡ºï¼š2A</span></span><br></pre></td></tr></table></figure>\n</li>\n<li class=\"lvl-2\">\n<p>2.æµ®ç‚¹æ•°æ ¼å¼åŒ–ç¬¦å·ï¼š</p>\n<ul class=\"lvl-3\">\n<li class=\"lvl-6\">%fï¼šä»¥åè¿›åˆ¶å½¢å¼è¾“å‡ºæµ®ç‚¹æ•°ã€‚</li>\n<li class=\"lvl-6\">%.nfï¼šæŒ‡å®šå°æ•°ç‚¹åä¿ç•™ n ä½å°æ•°ã€‚</li>\n</ul>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">printf</span> <span class=\"string\">&quot;%f\\n&quot;</span> 3.14159      <span class=\"comment\"># è¾“å‡ºï¼š3.141590</span></span><br><span class=\"line\"><span class=\"built_in\">printf</span> <span class=\"string\">&quot;%.2f\\n&quot;</span> 3.14159    <span class=\"comment\"># è¾“å‡ºï¼š3.14</span></span><br></pre></td></tr></table></figure>\n</li>\n<li class=\"lvl-2\">\n<p>3.å­—ç¬¦ä¸²æ ¼å¼åŒ–ç¬¦å·ï¼š</p>\n<ul class=\"lvl-3\">\n<li class=\"lvl-6\">%cï¼šè¾“å‡ºå•ä¸ªå­—ç¬¦ã€‚</li>\n<li class=\"lvl-6\">%sï¼šè¾“å‡ºå­—ç¬¦ä¸²ã€‚</li>\n</ul>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">printf</span> <span class=\"string\">&quot;%c\\n&quot;</span> <span class=\"string\">&#x27;A&#x27;</span>      <span class=\"comment\"># è¾“å‡ºï¼šA</span></span><br><span class=\"line\"><span class=\"built_in\">printf</span> <span class=\"string\">&quot;%s\\n&quot;</span> <span class=\"string\">&quot;Hello&quot;</span>  <span class=\"comment\"># è¾“å‡ºï¼šHello</span></span><br></pre></td></tr></table></figure>\n</li>\n<li class=\"lvl-2\">\n<p>4.å…¶ä»–æ ¼å¼åŒ–ç¬¦å·ï¼š</p>\n<ul class=\"lvl-3\">\n<li class=\"lvl-6\">%pï¼šä»¥åå…­è¿›åˆ¶å½¢å¼è¾“å‡ºæŒ‡é’ˆåœ°å€ã€‚</li>\n<li class=\"lvl-6\">%uï¼šè¾“å‡ºæ— ç¬¦å·æ•´æ•°ã€‚</li>\n<li class=\"lvl-6\">%e æˆ– %Eï¼šä»¥ç§‘å­¦è®¡æ•°æ³•å½¢å¼è¾“å‡ºæµ®ç‚¹æ•°ï¼ˆå°å†™æˆ–å¤§å†™ï¼‰ã€‚</li>\n<li class=\"lvl-6\">%g æˆ– %Gï¼šæ ¹æ®å®é™…æƒ…å†µè‡ªåŠ¨é€‰æ‹© %f æˆ– %e æ ¼å¼è¾“å‡ºæµ®ç‚¹æ•°ï¼ˆå°å†™æˆ–å¤§å†™ï¼‰ã€‚</li>\n<li class=\"lvl-6\">%%ï¼šè¾“å‡ºä¸€ä¸ªç™¾åˆ†å·ã€‚</li>\n</ul>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">printf</span> <span class=\"string\">&quot;%p\\n&quot;</span> <span class=\"variable\">$var</span>           <span class=\"comment\"># è¾“å‡ºï¼š0x7ffeefbff748 ï¼ˆå˜é‡ var çš„åœ°å€ï¼‰</span></span><br><span class=\"line\"><span class=\"built_in\">printf</span> <span class=\"string\">&quot;%u\\n&quot;</span> -42            <span class=\"comment\"># è¾“å‡ºï¼š4294967254</span></span><br><span class=\"line\"><span class=\"built_in\">printf</span> <span class=\"string\">&quot;%e\\n&quot;</span> 123.456        <span class=\"comment\"># è¾“å‡ºï¼š1.234560e+02</span></span><br><span class=\"line\"><span class=\"built_in\">printf</span> <span class=\"string\">&quot;%E\\n&quot;</span> 123.456        <span class=\"comment\"># è¾“å‡ºï¼š1.234560E+02</span></span><br><span class=\"line\"><span class=\"built_in\">printf</span> <span class=\"string\">&quot;%g\\n&quot;</span> 123.456        <span class=\"comment\"># è¾“å‡ºï¼š123.456</span></span><br><span class=\"line\"><span class=\"built_in\">printf</span> <span class=\"string\">&quot;%G\\n&quot;</span> 123.456        <span class=\"comment\"># è¾“å‡ºï¼š123.456</span></span><br><span class=\"line\"><span class=\"built_in\">printf</span> <span class=\"string\">&quot;100%%\\n&quot;</span>             <span class=\"comment\"># è¾“å‡ºï¼š100%</span></span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n</div>\n<h2 id=\"ä¸åŒè¿›åˆ¶ä¹‹é—´è¿›è¡Œç›¸äº’è½¬æ¢\">ä¸åŒè¿›åˆ¶ä¹‹é—´è¿›è¡Œç›¸äº’è½¬æ¢</h2>\n<h3 id=\"10è¿›åˆ¶è½¬å…¶å®ƒè¿›åˆ¶\">10è¿›åˆ¶è½¬å…¶å®ƒè¿›åˆ¶</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 10è¿›åˆ¶è½¬2è¿›åˆ¶ï¼Œobase=2 æŒ‡å®šè¾“å‡ºè¿›åˆ¶ä¸ºäºŒè¿›åˆ¶ï¼Œé»˜è®¤ä¸º10è¿›åˆ¶ã€‚</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;obase=2; 255&quot;</span> | bc <span class=\"comment\"># 11111111</span></span><br><span class=\"line\"><span class=\"comment\"># printfä¸æ”¯æŒåˆ°äºŒè¿›åˆ¶çš„è½¬æ¢</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 10è¿›åˆ¶è½¬8è¿›åˆ¶</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;obase=8; 255&quot;</span> | bc <span class=\"comment\"># 377</span></span><br><span class=\"line\"><span class=\"built_in\">printf</span> <span class=\"string\">&quot;%o\\n&quot;</span> 255 <span class=\"comment\"># 377ï¼Œ%o è¡¨ç¤ºå…«è¿›åˆ¶æ•°</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 10è¿›åˆ¶è½¬16è¿›åˆ¶</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;obase=16; 255&quot;</span> | bc <span class=\"comment\"># FF</span></span><br><span class=\"line\"><span class=\"built_in\">printf</span> <span class=\"string\">&quot;%x\\n&quot;</span> <span class=\"string\">&quot;255&quot;</span> <span class=\"comment\"># ffï¼Œ%x è¡¨ç¤ºåå…­è¿›åˆ¶æ•°ï¼Œå°å†™</span></span><br><span class=\"line\"><span class=\"built_in\">printf</span> <span class=\"string\">&quot;%X\\n&quot;</span> <span class=\"string\">&quot;255&quot;</span> <span class=\"comment\"># FFï¼Œ%X è¡¨ç¤ºåå…­è¿›åˆ¶æ•°ï¼Œå¤§å†™</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"2è¿›åˆ¶è½¬å…¶å®ƒè¿›åˆ¶\">2è¿›åˆ¶è½¬å…¶å®ƒè¿›åˆ¶</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 2è¿›åˆ¶è½¬10è¿›åˆ¶ï¼Œibase=2 æŒ‡å®šè¾“å…¥è¿›åˆ¶ä¸ºäºŒè¿›åˆ¶ï¼Œé»˜è®¤ä¸º10è¿›åˆ¶ã€‚</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;ibase=2; 11111111&quot;</span> | bc <span class=\"comment\"># 255</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> $((<span class=\"number\">2#11111111</span>)) <span class=\"comment\"># 255ï¼Œå†…ç½®çš„ç®—æœ¯è¿ç®— $((...))ï¼Œå¯ä»¥å®ç°å…¶å®ƒè¿›åˆ¶è½¬10è¿›åˆ¶</span></span><br><span class=\"line\"><span class=\"built_in\">printf</span> <span class=\"string\">&quot;%d\\n&quot;</span> <span class=\"string\">&quot;0b11111111&quot;</span> <span class=\"comment\"># 255ï¼Œ%d è¡¨ç¤ºåè¿›åˆ¶æ•°ï¼Œå¯¹äºäºŒè¿›åˆ¶æ•°ï¼Œä½ éœ€è¦åœ¨æ•°å­—å‰é¢åŠ ä¸Š 0b çš„å‰ç¼€</span></span><br><span class=\"line\"><span class=\"built_in\">printf</span> <span class=\"string\">&quot;%d\\n&quot;</span> $((<span class=\"number\">2#11111111</span>)) <span class=\"comment\"># 255</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 2è¿›åˆ¶è½¬16è¿›åˆ¶ï¼Œä¸¤ä¸ªåŒæ—¶å‡ºç°æ—¶è¦å…ˆå£°æ˜obaseï¼Œå†å£°æ˜ibaseï¼Œå¦åˆ™è¾“å‡ºç»“æœé”™è¯¯</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;obase=16; ibase=2; 11111111&quot;</span> | bc  <span class=\"comment\"># FF</span></span><br><span class=\"line\"><span class=\"built_in\">printf</span> <span class=\"string\">&quot;%X\\n&quot;</span> <span class=\"string\">&quot;0b11111111&quot;</span> <span class=\"comment\"># FF</span></span><br><span class=\"line\"><span class=\"built_in\">printf</span> <span class=\"string\">&quot;%x\\n&quot;</span> <span class=\"string\">&quot;0b11111111&quot;</span> <span class=\"comment\"># ff</span></span><br><span class=\"line\"><span class=\"built_in\">printf</span> <span class=\"string\">&quot;%X\\n&quot;</span> $((<span class=\"number\">2#11111111</span>)) <span class=\"comment\"># FF</span></span><br><span class=\"line\"><span class=\"built_in\">printf</span> <span class=\"string\">&quot;%x\\n&quot;</span> $((<span class=\"number\">2#11111111</span>)) <span class=\"comment\"># ff</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 2è¿›åˆ¶è½¬8è¿›åˆ¶</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;obase=8; ibase=2; 11111111&quot;</span> | bc <span class=\"comment\"># 377</span></span><br><span class=\"line\"><span class=\"built_in\">printf</span> <span class=\"string\">&quot;%o\\n&quot;</span> <span class=\"string\">&quot;0b11111111&quot;</span> <span class=\"comment\"># 377</span></span><br><span class=\"line\"><span class=\"built_in\">printf</span> <span class=\"string\">&quot;%o\\n&quot;</span> $((<span class=\"number\">2#11111111</span>)) <span class=\"comment\"># 377</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"8è¿›åˆ¶è½¬å…¶å®ƒè¿›åˆ¶\">8è¿›åˆ¶è½¬å…¶å®ƒè¿›åˆ¶</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 8è¿›åˆ¶è½¬10è¿›åˆ¶</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;ibase=8; 377&quot;</span> | bc <span class=\"comment\"># 255</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> $((<span class=\"number\">8#377</span>)) <span class=\"comment\"># 255</span></span><br><span class=\"line\"><span class=\"built_in\">printf</span> <span class=\"string\">&quot;%d\\n&quot;</span> $((<span class=\"number\">8#377</span>))  <span class=\"comment\"># 255</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 8è¿›åˆ¶è½¬2è¿›åˆ¶</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;obase=2; ibase=8; 377&quot;</span> | bc <span class=\"comment\"># 11111111</span></span><br><span class=\"line\"><span class=\"comment\"># printfä¸æ”¯æŒåˆ°äºŒè¿›åˆ¶çš„è½¬æ¢</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 8è¿›åˆ¶è½¬16è¿›åˆ¶</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;obase=16; ibase=8; 377&quot;</span> | bc <span class=\"comment\"># FF</span></span><br><span class=\"line\"><span class=\"built_in\">printf</span> <span class=\"string\">&quot;%X\\n&quot;</span> <span class=\"string\">&quot;<span class=\"subst\">$((8#377)</span>)&quot;</span> <span class=\"comment\"># FF</span></span><br><span class=\"line\"><span class=\"built_in\">printf</span> <span class=\"string\">&quot;%x\\n&quot;</span> <span class=\"string\">&quot;<span class=\"subst\">$((8#377)</span>)&quot;</span> <span class=\"comment\"># ff</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"16è¿›åˆ¶è½¬å…¶å®ƒè¿›åˆ¶\">16è¿›åˆ¶è½¬å…¶å®ƒè¿›åˆ¶</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 16è¿›åˆ¶è½¬10è¿›åˆ¶</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;ibase=16; FF&quot;</span> | bc <span class=\"comment\"># 255</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> $((<span class=\"number\">16</span>#FF)) <span class=\"comment\"># 255</span></span><br><span class=\"line\"><span class=\"built_in\">printf</span> <span class=\"string\">&quot;%d\\n&quot;</span> <span class=\"string\">&quot;0xFF&quot;</span>  <span class=\"comment\"># 255ï¼Œ%d è¡¨ç¤ºåè¿›åˆ¶æ•°ï¼Œå¯¹äºåå…­è¿›åˆ¶æ•°ï¼Œä½ éœ€è¦åœ¨æ•°å­—å‰é¢åŠ ä¸Š 0x çš„å‰ç¼€</span></span><br><span class=\"line\"><span class=\"built_in\">printf</span> <span class=\"string\">&quot;%d\\n&quot;</span> $((<span class=\"number\">16</span>#FF)) <span class=\"comment\"># 255</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 16è¿›åˆ¶è½¬2è¿›åˆ¶</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;obase=2; ibase=16; FF&quot;</span> | bc <span class=\"comment\"># 11111111</span></span><br><span class=\"line\"><span class=\"comment\"># printfä¸æ”¯æŒåˆ°äºŒè¿›åˆ¶çš„è½¬æ¢</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 16è¿›åˆ¶è½¬8è¿›åˆ¶</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;obase=8; ibase=16; FF&quot;</span> | bc <span class=\"comment\"># 377</span></span><br><span class=\"line\"><span class=\"built_in\">printf</span> <span class=\"string\">&quot;%o\\n&quot;</span> <span class=\"string\">&quot;0xFF&quot;</span> <span class=\"comment\"># 377</span></span><br><span class=\"line\"><span class=\"built_in\">printf</span> <span class=\"string\">&quot;%o\\n&quot;</span> <span class=\"string\">&quot;<span class=\"subst\">$((16#FF)</span>)&quot;</span> <span class=\"comment\"># 377</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"echo-ä¸-printf-çš„æ¯”è¾ƒ\">echo ä¸ printf çš„æ¯”è¾ƒ</h2>\n<h3 id=\"è¾“å‡ºæ•ˆæœçš„æ¯”è¾ƒ\">è¾“å‡ºæ•ˆæœçš„æ¯”è¾ƒ</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>echo ä¼šè‡ªåŠ¨æ¢è¡Œï¼Œè€Œ printf éœ€è¦æ˜¾å¼æŒ‡å®šæ¢è¡Œç¬¦ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>printf æä¾›æ›´çµæ´»çš„æ ¼å¼åŒ–è¾“å‡ºæ–¹å¼ã€‚</p>\n</li>\n</ul>\n<h3 id=\"æ€§èƒ½æ¯”è¾ƒ\">æ€§èƒ½æ¯”è¾ƒ</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åœ¨å¤§é‡è¾“å‡ºæ—¶ï¼Œecho é€šå¸¸æ¯” printf æ›´é«˜æ•ˆã€‚</p>\n</li>\n</ul>\n<h3 id=\"é€‚ç”¨åœºæ™¯çš„é€‰æ‹©\">é€‚ç”¨åœºæ™¯çš„é€‰æ‹©</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç®€å•æ–‡æœ¬è¾“å‡ºåœºæ™¯ï¼Œä½¿ç”¨ echoã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>éœ€è¦æ ¼å¼åŒ–è¾“å‡ºæˆ–è€…æ›´ç²¾ç¡®æ§åˆ¶è¾“å‡ºæ ¼å¼æ—¶ï¼Œä½¿ç”¨ printfã€‚</p>\n</li>\n</ul>\n","content_text":"æ‘˜è¦ åœ¨ç¼–å†™ shell è„šæœ¬æ—¶ï¼Œecho å’Œ printf æ˜¯ä¸¤ä¸ªå¸¸ç”¨çš„å‘½ä»¤ï¼Œç”¨äºè¾“å‡ºä¿¡æ¯åˆ°æ ‡å‡†è¾“å‡ºè®¾å¤‡ã€‚è™½ç„¶å®ƒä»¬çœ‹ä¼¼ç®€å•ï¼Œä½†æ·±å…¥ç†è§£å®ƒä»¬çš„ä½¿ç”¨æ–¹å¼å’Œå†…éƒ¨æœºåˆ¶å¯¹äºç¼–å†™é«˜æ•ˆã€å¯è¯»æ€§å¼ºçš„è„šæœ¬è‡³å…³é‡è¦ã€‚ echo å‘½ä»¤ åŸºæœ¬è¯­æ³•å’Œç”¨æ³• echo å‘½ä»¤çš„åŸºæœ¬è¯­æ³•ä¸ºï¼š 1echo [é€‰é¡¹] [å­—ç¬¦ä¸²æˆ–å˜é‡] å‚æ•°å’Œé€‰é¡¹ 12345-nï¼šä¸æ¢è¡Œè¾“å‡ºã€‚-eï¼šè§£é‡Šè½¬ä¹‰å­—ç¬¦ã€‚-Eï¼šç¦æ­¢è§£é‡Šè½¬ä¹‰å­—ç¬¦ã€‚å¸¸è§çš„è½¬ä¹‰å­—ç¬¦åŒ…æ‹¬ \\nï¼ˆæ¢è¡Œï¼‰ã€\\tï¼ˆåˆ¶è¡¨ç¬¦ï¼‰ç­‰ã€‚ å®é™…åº”ç”¨ç¤ºä¾‹ 1234567891011121314151617- æ‰“å°ä¸€ä¸ªæ–‡æœ¬æ¶ˆæ¯ã€‚æ³¨æ„ï¼šå¼•å·æ˜¯å¯é€‰çš„ echo &quot;Hello World&quot;- æ‰“å°ä¸€ä¸ªå¸¦ç¯å¢ƒå˜é‡çš„æ¶ˆæ¯ echo &quot;My path is $PATH&quot;- æ‰“å°ä¸€ä¸ªä¸å¸¦å°¾éšæ¢è¡Œç¬¦çš„æ¶ˆæ¯ echo -n &quot;Hello World&quot;- å°†æ¶ˆæ¯è¿½åŠ åˆ°æ–‡ä»¶ä¸­ echo &quot;Hello World&quot; &gt;&gt; file.txt- å¯ç”¨åæ–œæ è½¬ä¹‰ï¼ˆç‰¹æ®Šå­—ç¬¦ï¼‰çš„è§£é‡Š echo -e &quot;Column 1\\tColumn 2&quot;- æ‰“å°æœ€åä¸€ä¸ªæ‰§è¡Œå‘½ä»¤çš„é€€å‡ºçŠ¶æ€ echo $? echoè¾“å‡ºé¢œè‰²åŒ–æ–‡æœ¬ 1234567891011121314151617181920212223242526272829303132333435363738echo -e &quot;\\e[1;31mError:\\e[0m Something went wrong.&quot;# æˆ–echo -e &quot;\\033[1;31mError:\\033[0m Something went wrong.&quot;# è¯´æ˜ï¼š\\e[1;31mï¼šè¿™éƒ¨åˆ†æ§åˆ¶æ–‡æœ¬çš„é¢œè‰²å’Œæ ·å¼ã€‚å…¶ä¸­ï¼š \\e è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªè½¬ä¹‰å­—ç¬¦ï¼Œå®ƒæ˜¯ ANSI è½¬ä¹‰åºåˆ—çš„èµ·å§‹ï¼Œåè·Ÿä¸€ç³»åˆ—ç”¨äºæ§åˆ¶æ–‡æœ¬é¢œè‰²ã€æ ·å¼ç­‰çš„æ•°å­—å’Œå­—ç¬¦ã€‚è¿™é‡Œ\\eä¹Ÿå¯ä»¥ç”¨\\033æ›¿ä»£ã€‚ 1 è¡¨ç¤ºè®¾ç½®æ–‡æœ¬ä¸ºç²—ä½“ï¼ˆæˆ–è€…ç§°ä¸ºé«˜äº®ï¼‰ã€‚ 31 è¡¨ç¤ºè®¾ç½®æ–‡æœ¬é¢œè‰²ä¸ºçº¢è‰²ã€‚ä¸åŒçš„æ•°å­—ä»£è¡¨ä¸åŒçš„é¢œè‰²ï¼Œè¿™é‡Œçš„ 31 å¯¹åº”çº¢è‰²ã€‚\\e[0mï¼šè¿™éƒ¨åˆ†é‡ç½®æ–‡æœ¬æ ¼å¼ä¸ºé»˜è®¤å€¼ã€‚è¿™æ ·åšæ˜¯ä¸ºäº†ç¡®ä¿åœ¨ä¹‹åçš„è¾“å‡ºä¸­æ–‡æœ¬æ ·å¼ä¸å—ä¹‹å‰çš„å½±å“ã€‚å› æ­¤ï¼Œè¿™æ¡å‘½ä»¤ä¼šè¾“å‡ºä¸€ä¸ªçº¢è‰²çš„â€œError:â€ï¼Œæ¥ç€æ˜¯ä¸€ä¸ªç©ºæ ¼ï¼Œç„¶åæ˜¯æ™®é€šæ–‡æœ¬â€œSomething went wrong.â€ã€‚æ•´ä½“æ•ˆæœæ˜¯ï¼Œé”™è¯¯æ¶ˆæ¯ä»¥çº¢è‰²é«˜äº®æ˜¾ç¤ºï¼Œä½¿å…¶åœ¨è¾“å‡ºä¸­æ›´åŠ é†’ç›®ã€‚é¢œè‰²ï¼š 30ï¼šé»‘è‰² 31ï¼šçº¢è‰² 32ï¼šç»¿è‰² 33ï¼šé»„è‰² 34ï¼šè“è‰² 35ï¼šç´«è‰² 36ï¼šé’è‰² 37ï¼šç™½è‰²æ ·å¼ï¼š 0ï¼šé‡ç½®æ‰€æœ‰æ ·å¼ï¼ˆé»˜è®¤å€¼ï¼‰ 1ï¼šç²—ä½“ï¼ˆæˆ–é«˜äº®ï¼‰ 2ï¼šæš—è‰²ï¼ˆä¸å¸¸è§ï¼Œè§†ç»ˆç«¯è€Œå®šï¼‰ 3ï¼šæ–œä½“ï¼ˆä¸å¸¸è§ï¼Œè§†ç»ˆç«¯è€Œå®šï¼‰ 4ï¼šä¸‹åˆ’çº¿ 5ï¼šé—ªçƒï¼ˆä¸å¸¸è§ï¼Œè§†ç»ˆç«¯è€Œå®šï¼‰ 7ï¼šåæ˜¾ï¼ˆå‰æ™¯è‰²ä¸èƒŒæ™¯è‰²äº¤æ¢ï¼‰ 8ï¼šéšè—ï¼ˆæ–‡æœ¬ä¸å¯è§ï¼‰è¿™äº›æ•°å­—å’Œå­—ç¬¦å¯ä»¥å•ç‹¬ä½¿ç”¨ï¼Œæ¯”å¦‚\\e[1m è¡¨ç¤ºåŠ ç²—ï¼Œ\\e[31m è¡¨ç¤ºè®¾ç½®æ–‡æœ¬é¢œè‰²ä¸ºçº¢è‰²ã€‚ä¹Ÿå¯ä»¥ç»„åˆä½¿ç”¨ï¼Œæ¯”å¦‚ \\e[1;31m è¡¨ç¤ºè®¾ç½®æ–‡æœ¬ä¸ºçº¢è‰²å¹¶åŠ ç²—ï¼Œä¸­é—´ç”¨åˆ†å·éš”å¼€ã€‚ printf å‘½ä»¤ åŸºæœ¬è¯­æ³•å’Œç”¨æ³• printf å‘½ä»¤çš„åŸºæœ¬è¯­æ³•ä¸ºï¼š 1printf [æ ¼å¼åŒ–å­—ç¬¦ä¸²] [å‚æ•°] å®é™…åº”ç”¨ç¤ºä¾‹ 12345678910111213141516- æ‰“å°æ–‡æœ¬æ¶ˆæ¯ï¼š printf &quot;%s\\n&quot; &quot;Hello world&quot;- ä»¥è“è‰²ç²—ä½“æ‰“å°æ•´æ•°ï¼šä½¿ç”¨æ–¹æ³•åŒecho printf &quot;\\e[1;34m%.3d\\e[0m\\n&quot; 42- æ‰“å°å¸¦æœ‰Unicode Euroç¬¦å·çš„æµ®ç‚¹æ•°ï¼š printf &quot;\\u20AC %.2f\\n&quot; 123.4- æ‰“å°ç”±å˜é‡ç»„æˆçš„æ–‡æœ¬æ¶ˆæ¯ï¼š printf &quot;var1: %s\\tvar2: %s\\n&quot; &quot;$var1&quot; &quot;$var2&quot;- å°†æ ¼å¼åŒ–çš„æ¶ˆæ¯å­˜å‚¨åœ¨å˜é‡ä¸­ï¼š printf -v myvar &quot;This is %s = %d\\n&quot; &quot;a year&quot; 2016 echo $myvar This is a year = 2016 åœ¨ printf å‘½ä»¤ä¸­ï¼Œæ”¯æŒçš„æ ¼å¼åŒ–ç¬¦å·ç”¨äºæŒ‡å®šè¾“å‡ºçš„æ ¼å¼ï¼ŒåŒ…æ‹¬æ•´æ•°ã€æµ®ç‚¹æ•°ã€å­—ç¬¦ä¸²ç­‰ã€‚ ä»¥ä¸‹æ˜¯å¸¸ç”¨çš„æ ¼å¼åŒ–ç¬¦å·åŠå…¶ä½¿ç”¨ç¤ºä¾‹ï¼š 1.æ•´æ•°æ ¼å¼åŒ–ç¬¦å·ï¼š %dï¼šä»¥åè¿›åˆ¶å½¢å¼è¾“å‡ºæ•´æ•°ã€‚ %.ndï¼šæŒ‡å®šæ•°å­—å å‡ ä½ï¼Œä¸è¶³éƒ¨åˆ†å‰é¢è¡¥0ã€‚ %oï¼šä»¥å…«è¿›åˆ¶å½¢å¼è¾“å‡ºæ•´æ•°ã€‚ %x æˆ– %Xï¼šä»¥åå…­è¿›åˆ¶å½¢å¼è¾“å‡ºæ•´æ•°ï¼ˆå°å†™æˆ–å¤§å†™ï¼‰ã€‚ 12345printf &quot;%d\\n&quot; 42 # è¾“å‡ºï¼š42printf &quot;%.3d\\n&quot; 42 # è¾“å‡ºï¼š042printf &quot;%o\\n&quot; 42 # è¾“å‡ºï¼š52printf &quot;%x\\n&quot; 42 # è¾“å‡ºï¼š2aprintf &quot;%X\\n&quot; 42 # è¾“å‡ºï¼š2A 2.æµ®ç‚¹æ•°æ ¼å¼åŒ–ç¬¦å·ï¼š %fï¼šä»¥åè¿›åˆ¶å½¢å¼è¾“å‡ºæµ®ç‚¹æ•°ã€‚ %.nfï¼šæŒ‡å®šå°æ•°ç‚¹åä¿ç•™ n ä½å°æ•°ã€‚ 12printf &quot;%f\\n&quot; 3.14159 # è¾“å‡ºï¼š3.141590printf &quot;%.2f\\n&quot; 3.14159 # è¾“å‡ºï¼š3.14 3.å­—ç¬¦ä¸²æ ¼å¼åŒ–ç¬¦å·ï¼š %cï¼šè¾“å‡ºå•ä¸ªå­—ç¬¦ã€‚ %sï¼šè¾“å‡ºå­—ç¬¦ä¸²ã€‚ 12printf &quot;%c\\n&quot; &#x27;A&#x27; # è¾“å‡ºï¼šAprintf &quot;%s\\n&quot; &quot;Hello&quot; # è¾“å‡ºï¼šHello 4.å…¶ä»–æ ¼å¼åŒ–ç¬¦å·ï¼š %pï¼šä»¥åå…­è¿›åˆ¶å½¢å¼è¾“å‡ºæŒ‡é’ˆåœ°å€ã€‚ %uï¼šè¾“å‡ºæ— ç¬¦å·æ•´æ•°ã€‚ %e æˆ– %Eï¼šä»¥ç§‘å­¦è®¡æ•°æ³•å½¢å¼è¾“å‡ºæµ®ç‚¹æ•°ï¼ˆå°å†™æˆ–å¤§å†™ï¼‰ã€‚ %g æˆ– %Gï¼šæ ¹æ®å®é™…æƒ…å†µè‡ªåŠ¨é€‰æ‹© %f æˆ– %e æ ¼å¼è¾“å‡ºæµ®ç‚¹æ•°ï¼ˆå°å†™æˆ–å¤§å†™ï¼‰ã€‚ %%ï¼šè¾“å‡ºä¸€ä¸ªç™¾åˆ†å·ã€‚ 1234567printf &quot;%p\\n&quot; $var # è¾“å‡ºï¼š0x7ffeefbff748 ï¼ˆå˜é‡ var çš„åœ°å€ï¼‰printf &quot;%u\\n&quot; -42 # è¾“å‡ºï¼š4294967254printf &quot;%e\\n&quot; 123.456 # è¾“å‡ºï¼š1.234560e+02printf &quot;%E\\n&quot; 123.456 # è¾“å‡ºï¼š1.234560E+02printf &quot;%g\\n&quot; 123.456 # è¾“å‡ºï¼š123.456printf &quot;%G\\n&quot; 123.456 # è¾“å‡ºï¼š123.456printf &quot;100%%\\n&quot; # è¾“å‡ºï¼š100% ä¸åŒè¿›åˆ¶ä¹‹é—´è¿›è¡Œç›¸äº’è½¬æ¢ 10è¿›åˆ¶è½¬å…¶å®ƒè¿›åˆ¶ 123456789101112# 10è¿›åˆ¶è½¬2è¿›åˆ¶ï¼Œobase=2 æŒ‡å®šè¾“å‡ºè¿›åˆ¶ä¸ºäºŒè¿›åˆ¶ï¼Œé»˜è®¤ä¸º10è¿›åˆ¶ã€‚echo &quot;obase=2; 255&quot; | bc # 11111111# printfä¸æ”¯æŒåˆ°äºŒè¿›åˆ¶çš„è½¬æ¢# 10è¿›åˆ¶è½¬8è¿›åˆ¶echo &quot;obase=8; 255&quot; | bc # 377printf &quot;%o\\n&quot; 255 # 377ï¼Œ%o è¡¨ç¤ºå…«è¿›åˆ¶æ•°# 10è¿›åˆ¶è½¬16è¿›åˆ¶echo &quot;obase=16; 255&quot; | bc # FFprintf &quot;%x\\n&quot; &quot;255&quot; # ffï¼Œ%x è¡¨ç¤ºåå…­è¿›åˆ¶æ•°ï¼Œå°å†™printf &quot;%X\\n&quot; &quot;255&quot; # FFï¼Œ%X è¡¨ç¤ºåå…­è¿›åˆ¶æ•°ï¼Œå¤§å†™ 2è¿›åˆ¶è½¬å…¶å®ƒè¿›åˆ¶ 1234567891011121314151617# 2è¿›åˆ¶è½¬10è¿›åˆ¶ï¼Œibase=2 æŒ‡å®šè¾“å…¥è¿›åˆ¶ä¸ºäºŒè¿›åˆ¶ï¼Œé»˜è®¤ä¸º10è¿›åˆ¶ã€‚echo &quot;ibase=2; 11111111&quot; | bc # 255echo $((2#11111111)) # 255ï¼Œå†…ç½®çš„ç®—æœ¯è¿ç®— $((...))ï¼Œå¯ä»¥å®ç°å…¶å®ƒè¿›åˆ¶è½¬10è¿›åˆ¶printf &quot;%d\\n&quot; &quot;0b11111111&quot; # 255ï¼Œ%d è¡¨ç¤ºåè¿›åˆ¶æ•°ï¼Œå¯¹äºäºŒè¿›åˆ¶æ•°ï¼Œä½ éœ€è¦åœ¨æ•°å­—å‰é¢åŠ ä¸Š 0b çš„å‰ç¼€printf &quot;%d\\n&quot; $((2#11111111)) # 255# 2è¿›åˆ¶è½¬16è¿›åˆ¶ï¼Œä¸¤ä¸ªåŒæ—¶å‡ºç°æ—¶è¦å…ˆå£°æ˜obaseï¼Œå†å£°æ˜ibaseï¼Œå¦åˆ™è¾“å‡ºç»“æœé”™è¯¯echo &quot;obase=16; ibase=2; 11111111&quot; | bc # FFprintf &quot;%X\\n&quot; &quot;0b11111111&quot; # FFprintf &quot;%x\\n&quot; &quot;0b11111111&quot; # ffprintf &quot;%X\\n&quot; $((2#11111111)) # FFprintf &quot;%x\\n&quot; $((2#11111111)) # ff# 2è¿›åˆ¶è½¬8è¿›åˆ¶echo &quot;obase=8; ibase=2; 11111111&quot; | bc # 377printf &quot;%o\\n&quot; &quot;0b11111111&quot; # 377printf &quot;%o\\n&quot; $((2#11111111)) # 377 8è¿›åˆ¶è½¬å…¶å®ƒè¿›åˆ¶ 12345678910111213# 8è¿›åˆ¶è½¬10è¿›åˆ¶echo &quot;ibase=8; 377&quot; | bc # 255echo $((8#377)) # 255printf &quot;%d\\n&quot; $((8#377)) # 255# 8è¿›åˆ¶è½¬2è¿›åˆ¶echo &quot;obase=2; ibase=8; 377&quot; | bc # 11111111# printfä¸æ”¯æŒåˆ°äºŒè¿›åˆ¶çš„è½¬æ¢# 8è¿›åˆ¶è½¬16è¿›åˆ¶echo &quot;obase=16; ibase=8; 377&quot; | bc # FFprintf &quot;%X\\n&quot; &quot;$((8#377))&quot; # FFprintf &quot;%x\\n&quot; &quot;$((8#377))&quot; # ff 16è¿›åˆ¶è½¬å…¶å®ƒè¿›åˆ¶ 1234567891011121314# 16è¿›åˆ¶è½¬10è¿›åˆ¶echo &quot;ibase=16; FF&quot; | bc # 255echo $((16#FF)) # 255printf &quot;%d\\n&quot; &quot;0xFF&quot; # 255ï¼Œ%d è¡¨ç¤ºåè¿›åˆ¶æ•°ï¼Œå¯¹äºåå…­è¿›åˆ¶æ•°ï¼Œä½ éœ€è¦åœ¨æ•°å­—å‰é¢åŠ ä¸Š 0x çš„å‰ç¼€printf &quot;%d\\n&quot; $((16#FF)) # 255# 16è¿›åˆ¶è½¬2è¿›åˆ¶echo &quot;obase=2; ibase=16; FF&quot; | bc # 11111111# printfä¸æ”¯æŒåˆ°äºŒè¿›åˆ¶çš„è½¬æ¢# 16è¿›åˆ¶è½¬8è¿›åˆ¶echo &quot;obase=8; ibase=16; FF&quot; | bc # 377printf &quot;%o\\n&quot; &quot;0xFF&quot; # 377printf &quot;%o\\n&quot; &quot;$((16#FF))&quot; # 377 echo ä¸ printf çš„æ¯”è¾ƒ è¾“å‡ºæ•ˆæœçš„æ¯”è¾ƒ echo ä¼šè‡ªåŠ¨æ¢è¡Œï¼Œè€Œ printf éœ€è¦æ˜¾å¼æŒ‡å®šæ¢è¡Œç¬¦ã€‚ printf æä¾›æ›´çµæ´»çš„æ ¼å¼åŒ–è¾“å‡ºæ–¹å¼ã€‚ æ€§èƒ½æ¯”è¾ƒ åœ¨å¤§é‡è¾“å‡ºæ—¶ï¼Œecho é€šå¸¸æ¯” printf æ›´é«˜æ•ˆã€‚ é€‚ç”¨åœºæ™¯çš„é€‰æ‹© ç®€å•æ–‡æœ¬è¾“å‡ºåœºæ™¯ï¼Œä½¿ç”¨ echoã€‚ éœ€è¦æ ¼å¼åŒ–è¾“å‡ºæˆ–è€…æ›´ç²¾ç¡®æ§åˆ¶è¾“å‡ºæ ¼å¼æ—¶ï¼Œä½¿ç”¨ printfã€‚","summary":"æ‘˜è¦ åœ¨ç¼–å†™ shell è„šæœ¬æ—¶ï¼Œecho å’Œ printf æ˜¯ä¸¤ä¸ªå¸¸ç”¨çš„å‘½ä»¤ï¼Œç”¨äºè¾“å‡ºä¿¡æ¯åˆ°æ ‡å‡†è¾“å‡ºè®¾å¤‡ã€‚è™½ç„¶å®ƒä»¬çœ‹ä¼¼ç®€å•ï¼Œä½†æ·±å…¥ç†è§£å®ƒä»¬çš„ä½¿ç”¨æ–¹å¼å’Œå†…éƒ¨æœºåˆ¶å¯¹äºç¼–å†™é«˜æ•ˆã€å¯è¯»æ€§å¼ºçš„è„šæœ¬è‡³å…³é‡è¦ã€‚","date_published":"2024-02-28T13:30:05.000Z","tags":["æŠ€æœ¯","linux","linuxå¸¸ç”¨å‘½ä»¤","linuxå¸¸ç”¨å‘½ä»¤"]},{"id":"https://blog.hanqunfeng.com/2024/02/23/macos-shell-useful/","url":"https://blog.hanqunfeng.com/2024/02/23/macos-shell-useful/","title":"MacOSä¸‹ä¸€äº›æœ‰ç”¨çš„è„šæœ¬","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¿™é‡Œåˆ—ä¸¾ä¸€äº›macosä¸‹ä¸€äº›æœ‰ç”¨çš„shellè„šæœ¬</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä¸æœ¬æ–‡è„šæœ¬å¯¹åº”çš„centosè„šæœ¬å¯ä»¥å‚çœ‹<a href=\"https://gitee.com/hanqunfeng/centos-shell.git\">centos-shell</a></p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"æŸ¥çœ‹ç«¯å£è¢«å“ªä¸ªè¿›ç¨‹å ç”¨\">æŸ¥çœ‹ç«¯å£è¢«å“ªä¸ªè¿›ç¨‹å ç”¨</h2>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#!/usr/bin/env zsh</span></span><br><span class=\"line\"><span class=\"comment\">#################################################</span></span><br><span class=\"line\"><span class=\"comment\">#filenameï¼šport æˆäºˆæ‰§è¡Œæƒé™</span></span><br><span class=\"line\"><span class=\"comment\">#åŠŸèƒ½ï¼šæŸ¥è¯¢ç«¯å£è¢«å“ªä¸ªè¿›ç¨‹å ç”¨</span></span><br><span class=\"line\"><span class=\"comment\">#æ‰§è¡Œæ–¹æ³•ï¼šport 8080</span></span><br><span class=\"line\"><span class=\"comment\">#################################################</span></span><br><span class=\"line\">port=<span class=\"variable\">$1</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> [ -z <span class=\"string\">&quot;<span class=\"variable\">$port</span>&quot;</span> ]; <span class=\"keyword\">then</span></span><br><span class=\"line\">    <span class=\"built_in\">echo</span> <span class=\"string\">&quot;è¯·åŠ ä¸Šç«¯å£ä½œä¸ºå‚æ•°ï¼Œå¦‚ï¼šport 8080&quot;</span></span><br><span class=\"line\"><span class=\"keyword\">else</span></span><br><span class=\"line\">    lsof -i :<span class=\"variable\">$&#123;port&#125;</span></span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"æ€æ‰å ç”¨æŸä¸ªç«¯å£çš„è¿›ç¨‹\">æ€æ‰å ç”¨æŸä¸ªç«¯å£çš„è¿›ç¨‹</h2>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#!/usr/bin/env zsh</span></span><br><span class=\"line\"><span class=\"comment\">#################################################</span></span><br><span class=\"line\"><span class=\"comment\">#filenameï¼škillport æˆäºˆæ‰§è¡Œæƒé™</span></span><br><span class=\"line\"><span class=\"comment\">#åŠŸèƒ½ï¼šå…³é—­å ç”¨ç«¯å£çš„è¿›ç¨‹</span></span><br><span class=\"line\"><span class=\"comment\">#æ‰§è¡Œæ–¹æ³•ï¼škillport 8080</span></span><br><span class=\"line\"><span class=\"comment\">#################################################</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> [ -z <span class=\"string\">&quot;<span class=\"variable\">$1</span>&quot;</span> ]; <span class=\"keyword\">then</span></span><br><span class=\"line\">    <span class=\"built_in\">echo</span> <span class=\"string\">&quot;è¯·åŠ ä¸Šç«¯å£ä½œä¸ºå‚æ•°ï¼Œå¦‚ï¼škillport 8080&quot;</span></span><br><span class=\"line\"><span class=\"keyword\">else</span></span><br><span class=\"line\">    <span class=\"built_in\">echo</span> <span class=\"string\">&quot;kill  begin........&quot;</span></span><br><span class=\"line\">    pid=`port <span class=\"variable\">$1</span> | awk <span class=\"string\">&#x27;NR&gt;1 &#123;print $2&#125;&#x27;</span> | <span class=\"built_in\">sort</span> | <span class=\"built_in\">uniq</span>`</span><br><span class=\"line\">    <span class=\"built_in\">echo</span> <span class=\"variable\">$pid</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> [ -z <span class=\"string\">&quot;<span class=\"variable\">$pid</span>&quot;</span> ] ; <span class=\"keyword\">then</span></span><br><span class=\"line\">            <span class=\"built_in\">echo</span> <span class=\"string\">&quot;No process running.&quot;</span></span><br><span class=\"line\">            <span class=\"comment\">#exit -1;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">else</span></span><br><span class=\"line\">        <span class=\"built_in\">echo</span> <span class=\"string\">&quot;The process(<span class=\"variable\">$&#123;pid&#125;</span>) is running...&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"built_in\">kill</span> <span class=\"variable\">$&#123;pid&#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"built_in\">echo</span> <span class=\"string\">&quot;kill process(<span class=\"variable\">$&#123;pid&#125;</span>) OK&quot;</span></span><br><span class=\"line\">    <span class=\"keyword\">fi</span></span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"æœ¬æœºç«¯å£é€šè¿‡è·³æ¿æœºè½¬å‘åˆ°è¿œç¨‹ç«¯å£\">æœ¬æœºç«¯å£é€šè¿‡è·³æ¿æœºè½¬å‘åˆ°è¿œç¨‹ç«¯å£</h2>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#!/usr/bin/env zsh</span></span><br><span class=\"line\"><span class=\"comment\">#################################################</span></span><br><span class=\"line\"><span class=\"comment\">#filenameï¼šssh_port æˆäºˆæ‰§è¡Œæƒé™</span></span><br><span class=\"line\"><span class=\"comment\">#åŠŸèƒ½ï¼šæœ¬æœºç«¯å£é€šè¿‡è·³æ¿æœºè½¬å‘åˆ°è¿œç¨‹ç«¯å£</span></span><br><span class=\"line\"><span class=\"comment\">#æ‰§è¡Œæ–¹æ³•ï¼š</span></span><br><span class=\"line\"><span class=\"comment\"># ssh_port start 8080 10.10.2.2 80</span></span><br><span class=\"line\"><span class=\"comment\"># ssh_port stop 8080</span></span><br><span class=\"line\"><span class=\"comment\"># ssh_port status 8080</span></span><br><span class=\"line\"><span class=\"comment\">#################################################</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"title\">check</span></span>()&#123;</span><br><span class=\"line\">    <span class=\"comment\">#éªŒè¯å‚æ•°æ˜¯å¦ä¸ºç©º</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> [[ <span class=\"variable\">$&#123;#@&#125;</span> &lt; 1 ]];<span class=\"keyword\">then</span></span><br><span class=\"line\">        <span class=\"built_in\">echo</span> <span class=\"string\">&quot;è¯·è¾“å…¥å‚æ•°ï¼&quot;</span></span><br><span class=\"line\">        <span class=\"built_in\">echo</span> <span class=\"string\">&quot;å¼€å¯ç«¯å£è½¬å‘ï¼šssh_port start 8080 10.10.2.2 80&quot;</span></span><br><span class=\"line\">        <span class=\"built_in\">echo</span> <span class=\"string\">&quot;å…³é—­ç«¯å£è½¬å‘ï¼šssh_port stop 8080&quot;</span></span><br><span class=\"line\">        <span class=\"built_in\">echo</span> <span class=\"string\">&quot;æŸ¥çœ‹ç«¯å£çŠ¶æ€ï¼šssh_port status 8080&quot;</span></span><br><span class=\"line\">        <span class=\"built_in\">exit</span> 1</span><br><span class=\"line\">    <span class=\"keyword\">fi</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">check <span class=\"variable\">$@</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å·¥ä½œç›®å½•</span></span><br><span class=\"line\">WORKDIR=<span class=\"string\">&quot;/Users/<span class=\"subst\">$(whoami)</span>/workdir&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ“ä½œç±»å‹</span></span><br><span class=\"line\">operation=<span class=\"string\">&quot;<span class=\"variable\">$1</span>&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æœ¬åœ°ç«¯å£</span></span><br><span class=\"line\">local_port=<span class=\"string\">&quot;<span class=\"variable\">$2</span>&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># è¿œç¨‹ IP åœ°å€</span></span><br><span class=\"line\">remote_ip=<span class=\"string\">&quot;<span class=\"variable\">$3</span>&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># è¿œç¨‹ç«¯å£</span></span><br><span class=\"line\">remote_port=<span class=\"string\">&quot;<span class=\"variable\">$4</span>&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># SSH æ§åˆ¶å¥—æ¥å­—æ–‡ä»¶</span></span><br><span class=\"line\">sock_file=<span class=\"string\">&quot;<span class=\"variable\">$WORKDIR</span>/<span class=\"variable\">$local_port</span>.sock&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># è·³æ¿æœºï¼Œ~/.ssh/configä¸­çš„é…ç½®</span></span><br><span class=\"line\">jump_name=jump-machine</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"title\">start</span></span>()&#123;</span><br><span class=\"line\">    <span class=\"built_in\">echo</span> <span class=\"string\">&quot;start port begin........&quot;</span></span><br><span class=\"line\">    pid=`port <span class=\"variable\">$local_port</span> | grep ssh | awk <span class=\"string\">&#x27;&#123;print $2&#125;&#x27;</span>`</span><br><span class=\"line\">    <span class=\"keyword\">if</span> [ -z <span class=\"string\">&quot;<span class=\"variable\">$pid</span>&quot;</span> ] ; <span class=\"keyword\">then</span></span><br><span class=\"line\">        <span class=\"comment\"># å»ºç«‹è¿æ¥</span></span><br><span class=\"line\">        ssh -nNT -S <span class=\"string\">&quot;<span class=\"variable\">$sock_file</span>&quot;</span> -L 127.0.0.1:<span class=\"variable\">$local_port</span>:<span class=\"variable\">$remote_ip</span>:<span class=\"variable\">$remote_port</span> <span class=\"variable\">$jump_name</span></span><br><span class=\"line\">        <span class=\"built_in\">echo</span> <span class=\"string\">&quot;ssh -nNT -S <span class=\"variable\">$&#123;sock_file&#125;</span> -L 127.0.0.1:<span class=\"variable\">$&#123;local_port&#125;</span>:<span class=\"variable\">$&#123;remote_ip&#125;</span>:<span class=\"variable\">$&#123;remote_port&#125;</span> <span class=\"variable\">$&#123;jump_name&#125;</span>&quot;</span></span><br><span class=\"line\">        <span class=\"built_in\">echo</span> <span class=\"string\">&quot;start port success!&quot;</span></span><br><span class=\"line\">        <span class=\"built_in\">sleep</span> 1</span><br><span class=\"line\">    <span class=\"keyword\">else</span></span><br><span class=\"line\">        <span class=\"built_in\">echo</span> <span class=\"string\">&quot;port is running.&quot;</span></span><br><span class=\"line\">    <span class=\"keyword\">fi</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"title\">stop</span></span>()&#123;</span><br><span class=\"line\">    <span class=\"built_in\">echo</span> <span class=\"string\">&quot;stop port begin........&quot;</span></span><br><span class=\"line\">    pid=`port <span class=\"variable\">$local_port</span> | grep ssh | awk <span class=\"string\">&#x27;&#123;print $2&#125;&#x27;</span>`</span><br><span class=\"line\">    <span class=\"keyword\">if</span> [ -z <span class=\"string\">&quot;<span class=\"variable\">$pid</span>&quot;</span> ] ; <span class=\"keyword\">then</span></span><br><span class=\"line\">        <span class=\"built_in\">echo</span> <span class=\"string\">&quot;No port running.&quot;</span></span><br><span class=\"line\">    <span class=\"keyword\">else</span></span><br><span class=\"line\">        <span class=\"built_in\">echo</span> <span class=\"string\">&quot;The port (<span class=\"variable\">$&#123;pid&#125;</span>) is running...&quot;</span></span><br><span class=\"line\">        <span class=\"comment\"># kill -9 $pid</span></span><br><span class=\"line\">        ssh -S <span class=\"variable\">$sock_file</span> -O <span class=\"built_in\">exit</span> <span class=\"variable\">$jump_name</span></span><br><span class=\"line\">        <span class=\"built_in\">echo</span> <span class=\"string\">&quot;ssh -S <span class=\"variable\">$sock_file</span> -O exit <span class=\"variable\">$jump_name</span>&quot;</span></span><br><span class=\"line\">        <span class=\"built_in\">echo</span> <span class=\"string\">&quot;stop port (<span class=\"variable\">$&#123;pid&#125;</span>) success!&quot;</span></span><br><span class=\"line\">    <span class=\"keyword\">fi</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"title\">status</span></span>()&#123;</span><br><span class=\"line\">    <span class=\"built_in\">echo</span> <span class=\"string\">&quot;check status port begin........&quot;</span></span><br><span class=\"line\">    pid=`port <span class=\"variable\">$local_port</span> | grep ssh | awk <span class=\"string\">&#x27;&#123;print $2&#125;&#x27;</span>`</span><br><span class=\"line\">    <span class=\"keyword\">if</span> [ -z <span class=\"string\">&quot;<span class=\"variable\">$pid</span>&quot;</span> ] ; <span class=\"keyword\">then</span></span><br><span class=\"line\">        <span class=\"built_in\">echo</span> <span class=\"string\">&quot;No port running.&quot;</span></span><br><span class=\"line\">    <span class=\"keyword\">else</span></span><br><span class=\"line\">        <span class=\"built_in\">echo</span> <span class=\"string\">&quot;The port (<span class=\"variable\">$&#123;pid&#125;</span>) is running...&quot;</span></span><br><span class=\"line\">        port <span class=\"variable\">$local_port</span></span><br><span class=\"line\">    <span class=\"keyword\">fi</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> [ -n <span class=\"string\">&quot;<span class=\"variable\">$operation</span>&quot;</span> ];<span class=\"keyword\">then</span></span><br><span class=\"line\">    <span class=\"comment\"># åˆ¤æ–­æ“ä½œç±»å‹</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> [[ <span class=\"string\">&quot;<span class=\"variable\">$operation</span>&quot;</span> == <span class=\"string\">&quot;start&quot;</span> ]]; <span class=\"keyword\">then</span></span><br><span class=\"line\">        <span class=\"comment\"># å»ºç«‹è¿æ¥</span></span><br><span class=\"line\">        start</span><br><span class=\"line\">    <span class=\"keyword\">elif</span> [[ <span class=\"string\">&quot;<span class=\"variable\">$operation</span>&quot;</span> == <span class=\"string\">&quot;stop&quot;</span> ]]; <span class=\"keyword\">then</span></span><br><span class=\"line\">        <span class=\"comment\"># å…³é—­è¿æ¥</span></span><br><span class=\"line\">        stop</span><br><span class=\"line\">    <span class=\"keyword\">elif</span> [[ <span class=\"string\">&quot;<span class=\"variable\">$operation</span>&quot;</span> == <span class=\"string\">&quot;status&quot;</span> ]]; <span class=\"keyword\">then</span></span><br><span class=\"line\">        <span class=\"comment\"># å…³é—­è¿æ¥</span></span><br><span class=\"line\">        status</span><br><span class=\"line\">    <span class=\"keyword\">else</span></span><br><span class=\"line\">        check</span><br><span class=\"line\">        <span class=\"built_in\">exit</span> 1</span><br><span class=\"line\">    <span class=\"keyword\">fi</span></span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"æŸ¥çœ‹åŸŸååˆ°æœŸæ—¶é—´\">æŸ¥çœ‹åŸŸååˆ°æœŸæ—¶é—´</h2>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#!/usr/bin/env zsh</span></span><br><span class=\"line\"><span class=\"comment\">#################################################</span></span><br><span class=\"line\"><span class=\"comment\">#filenameï¼šcheck_domain æˆäºˆæ‰§è¡Œæƒé™</span></span><br><span class=\"line\"><span class=\"comment\">#åŠŸèƒ½ï¼šæ£€æŸ¥åŸŸååˆ°æœŸæ—¶é—´</span></span><br><span class=\"line\"><span class=\"comment\">#æ‰§è¡Œæ–¹æ³•ï¼šcheck_domain baidu.com google.com</span></span><br><span class=\"line\"><span class=\"comment\">#è¾“å‡ºç»“æœï¼š</span></span><br><span class=\"line\"><span class=\"comment\"># baidu.comï¼Œè¿‡æœŸæ—¥æœŸï¼š2026-10-11</span></span><br><span class=\"line\"><span class=\"comment\"># è·ç¦»åˆ°æœŸè¿˜æœ‰958å¤©</span></span><br><span class=\"line\"><span class=\"comment\"># google.comï¼Œè¿‡æœŸæ—¥æœŸï¼š2028-09-14</span></span><br><span class=\"line\"><span class=\"comment\"># è·ç¦»åˆ°æœŸè¿˜æœ‰1662å¤©</span></span><br><span class=\"line\"><span class=\"comment\">#################################################</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#éªŒè¯åŸŸåå‚æ•°æ˜¯å¦ä¸ºç©º</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> [[ <span class=\"variable\">$&#123;#@&#125;</span> &lt; 1 ]];<span class=\"keyword\">then</span></span><br><span class=\"line\">    <span class=\"built_in\">echo</span> <span class=\"string\">&quot;è¯·è¾“å…¥åŸŸåï¼Œå¤šä¸ªåŸŸåç©ºæ ¼åˆ†éš”ï¼Œå¦‚ï¼šcheck_domain baidu.com google.com&quot;</span></span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#æ£€æµ‹åŸŸååˆ°æœŸæ—¶é—´</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> domain <span class=\"keyword\">in</span> <span class=\"string\">&quot;<span class=\"variable\">$@</span>&quot;</span>;<span class=\"keyword\">do</span></span><br><span class=\"line\">    <span class=\"comment\">#å–å‡ºåŸŸåè¿‡æœŸæ—¶é—´</span></span><br><span class=\"line\">    expire_date=`whois <span class=\"variable\">$domain</span> | grep <span class=\"string\">&quot;Expiration Time&quot;</span> | awk <span class=\"string\">&#x27;&#123;print $3&#125;&#x27;</span>`</span><br><span class=\"line\">    <span class=\"keyword\">if</span> [ -z <span class=\"string\">&quot;<span class=\"variable\">$expire_date</span>&quot;</span> ];<span class=\"keyword\">then</span></span><br><span class=\"line\">        expire_date=`whois <span class=\"variable\">$domain</span> | grep <span class=\"string\">&#x27;Expiry Date&#x27;</span>| awk <span class=\"string\">&#x27;&#123;print $4&#125;&#x27;</span>| <span class=\"built_in\">cut</span> -d <span class=\"string\">&#x27;T&#x27;</span> -f 1`</span><br><span class=\"line\">    <span class=\"keyword\">fi</span></span><br><span class=\"line\">    <span class=\"built_in\">echo</span> <span class=\"string\">&quot;<span class=\"variable\">$&#123;domain&#125;</span>ï¼Œè¿‡æœŸæ—¥æœŸï¼š<span class=\"variable\">$&#123;expire_date&#125;</span>&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">#è½¬æ¢æˆæ—¶é—´æˆ³</span></span><br><span class=\"line\">    <span class=\"comment\"># 1.linux</span></span><br><span class=\"line\">    <span class=\"comment\"># expire_date_timestamp=`date -d $expire_date +%s`</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># 2.macos</span></span><br><span class=\"line\">    <span class=\"comment\"># https://blog.csdn.net/zhw21w/article/details/126010972</span></span><br><span class=\"line\">    expire_date_timestamp=`<span class=\"built_in\">date</span> -j -f %Y-%m-%d <span class=\"variable\">$expire_date</span> +%s`</span><br><span class=\"line\">    <span class=\"comment\">#ä»¥æ—¶é—´æˆ³çš„å½¢å¼æ˜¾ç¤ºå½“å‰æ—¶é—´</span></span><br><span class=\"line\">    now=`<span class=\"built_in\">date</span> <span class=\"string\">&#x27;+%s&#x27;</span>`</span><br><span class=\"line\">    <span class=\"comment\">#åŸŸååˆ°æœŸå‰©ä½™å¤©æ•°</span></span><br><span class=\"line\">    time_left=$[$[<span class=\"variable\">$expire_date_timestamp</span>-<span class=\"variable\">$now</span>]/86400]</span><br><span class=\"line\">    <span class=\"built_in\">echo</span> <span class=\"string\">&quot;è·ç¦»åˆ°æœŸè¿˜æœ‰<span class=\"variable\">$&#123;time_left&#125;</span>å¤©&quot;</span></span><br><span class=\"line\"><span class=\"keyword\">done</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"æŸ¥çœ‹è¯ä¹¦åˆ°æœŸæ—¶é—´\">æŸ¥çœ‹è¯ä¹¦åˆ°æœŸæ—¶é—´</h2>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#!/usr/bin/env zsh</span></span><br><span class=\"line\"><span class=\"comment\">#################################################</span></span><br><span class=\"line\"><span class=\"comment\">#filenameï¼šssl_check æˆäºˆæ‰§è¡Œæƒé™</span></span><br><span class=\"line\"><span class=\"comment\">#åŠŸèƒ½ï¼šæ£€æŸ¥è¯ä¹¦åˆ°æœŸæ—¶é—´</span></span><br><span class=\"line\"><span class=\"comment\">#æ‰§è¡Œæ–¹æ³•ï¼šssl_check www.baidu.com www.google.com</span></span><br><span class=\"line\"><span class=\"comment\">#è¾“å‡ºç»“æœï¼š</span></span><br><span class=\"line\"><span class=\"comment\"># è¯ä¹¦ï¼šwww.baidu.comï¼Œè¿‡æœŸæ—¶é—´ï¼š2024-08-06 01:51:05</span></span><br><span class=\"line\"><span class=\"comment\"># è·ç¦»åˆ°æœŸè¿˜æœ‰161å¤©</span></span><br><span class=\"line\"><span class=\"comment\"># è¯ä¹¦ï¼šwww.google.comï¼Œè¿‡æœŸæ—¶é—´ï¼š2024-04-29 08:19:49</span></span><br><span class=\"line\"><span class=\"comment\"># è·ç¦»åˆ°æœŸè¿˜æœ‰62å¤©</span></span><br><span class=\"line\"><span class=\"comment\">#################################################</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#éªŒè¯è¯ä¹¦å‚æ•°æ˜¯å¦ä¸ºç©º</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> [[ <span class=\"variable\">$&#123;#@&#125;</span> &lt; 1 ]];<span class=\"keyword\">then</span></span><br><span class=\"line\">    <span class=\"built_in\">echo</span> <span class=\"string\">&quot;è¯·è¾“å…¥è¯ä¹¦ï¼Œå¤šä¸ªè¯ä¹¦ç©ºæ ¼åˆ†éš”ï¼Œå¦‚ï¼šssl_check www.baidu.com www.google.com&quot;</span></span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#è·å–è¯ä¹¦çš„æœ‰æ•ˆæ—¶é—´</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> domain <span class=\"keyword\">in</span> <span class=\"string\">&quot;<span class=\"variable\">$@</span>&quot;</span>;<span class=\"keyword\">do</span></span><br><span class=\"line\">    <span class=\"comment\"># è¿™é‡Œåœ¨openssl x509 -noout -datesåé¢åŠ ä¸Šäº†2&gt;/dev/nullï¼Œå¦åˆ™ä¼šæ‰“å°å‘Šè­¦ä¿¡æ¯ï¼šWarning: Reading certificate from stdin since no -in or -new option is given</span></span><br><span class=\"line\">    <span class=\"comment\"># æ‚¨å¯ä»¥å¿½ç•¥æ­¤è­¦å‘Šã€‚å®ƒåªæ˜¯è¡¨æ˜æ‚¨æ²¡æœ‰ä½¿ç”¨ -in æˆ– -new é€‰é¡¹æŒ‡å®šè¾“å…¥æ–‡ä»¶ï¼Œå› æ­¤ OpenSSL å°†ä»æ ‡å‡†è¾“å…¥ (stdin) è¯»å–è¯ä¹¦ã€‚</span></span><br><span class=\"line\">    time=$(<span class=\"built_in\">echo</span> | openssl s_client  -connect  <span class=\"variable\">$domain</span>:443 2&gt;/dev/null | openssl x509 -noout -dates 2&gt;/dev/null |awk -F<span class=\"string\">&#x27;=&#x27;</span> <span class=\"string\">&#x27;NR==2&#123;print $2&#125;&#x27;</span>)</span><br><span class=\"line\">    <span class=\"comment\">#echo $time</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">#å–å‡ºåŸŸåè¿‡æœŸæ—¶é—´</span></span><br><span class=\"line\">    expire_date=`<span class=\"built_in\">env</span> LC_ALL=en_US.en <span class=\"built_in\">date</span> -j -f <span class=\"string\">&#x27;%b %d %H:%M:%S %Y GMT&#x27;</span> <span class=\"string\">&quot;<span class=\"variable\">$time</span>&quot;</span> <span class=\"string\">&#x27;+%Y-%m-%d %H:%M:%S&#x27;</span>`</span><br><span class=\"line\">    <span class=\"built_in\">echo</span> <span class=\"string\">&quot;è¯ä¹¦ï¼š<span class=\"variable\">$domain</span>ï¼Œè¿‡æœŸæ—¶é—´ï¼š<span class=\"variable\">$expire_date</span>&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    expire_date_timestamp=`<span class=\"built_in\">date</span> -j -f <span class=\"string\">&#x27;%Y-%m-%d %H:%M:%S&#x27;</span> <span class=\"variable\">$expire_date</span> +%s`</span><br><span class=\"line\">    <span class=\"comment\">#ä»¥æ—¶é—´æˆ³çš„å½¢å¼æ˜¾ç¤ºå½“å‰æ—¶é—´</span></span><br><span class=\"line\">    now=`<span class=\"built_in\">date</span> <span class=\"string\">&#x27;+%s&#x27;</span>`</span><br><span class=\"line\">    <span class=\"comment\">#è¯ä¹¦åˆ°æœŸå‰©ä½™å¤©æ•°</span></span><br><span class=\"line\">    time_left=$[$[<span class=\"variable\">$expire_date_timestamp</span>-<span class=\"variable\">$now</span>]/86400]</span><br><span class=\"line\">    <span class=\"built_in\">echo</span> <span class=\"string\">&quot;è·ç¦»åˆ°æœŸè¿˜æœ‰<span class=\"variable\">$&#123;time_left&#125;</span>å¤©&quot;</span></span><br><span class=\"line\"><span class=\"keyword\">done</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"æŸ¥çœ‹æŒ‡å®šIPçš„è¯¦ç»†ä¿¡æ¯\">æŸ¥çœ‹æŒ‡å®šIPçš„è¯¦ç»†ä¿¡æ¯</h2>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#!/usr/bin/env zsh</span></span><br><span class=\"line\"><span class=\"comment\">#################################################</span></span><br><span class=\"line\"><span class=\"comment\"># filenameï¼šip-info æˆæƒæ‰§è¡Œæƒé™</span></span><br><span class=\"line\"><span class=\"comment\"># åŠŸèƒ½ï¼šæŸ¥çœ‹IPä¿¡æ¯</span></span><br><span class=\"line\"><span class=\"comment\"># ä½¿ç”¨æ–¹æ³•ï¼šip-info 10.10.2.24/24</span></span><br><span class=\"line\"><span class=\"comment\"># è¾“å‡ºç»“æœï¼š</span></span><br><span class=\"line\"><span class=\"comment\">#  ç½‘ç»œåœ°å€: 10.10.2.0</span></span><br><span class=\"line\"><span class=\"comment\">#  ç½‘å…³åœ°å€: 10.10.2.1</span></span><br><span class=\"line\"><span class=\"comment\">#  å¹¿æ’­åœ°å€: 10.10.2.255</span></span><br><span class=\"line\"><span class=\"comment\">#  ä¸»æœºåœ°å€èŒƒå›´: 10.10.2.1 åˆ° 10.10.2.254</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ä¹Ÿå¯ä»¥ä½¿ç”¨ sipcalc å‘½ä»¤ï¼Œç”¨æ³•æ›´å¤šï¼Œæ˜¾ç¤ºä¹Ÿä¼šæ›´ä¸ºè¯¦ç»†ï¼š</span></span><br><span class=\"line\"><span class=\"comment\"># å®‰è£…ï¼šbrew install sipcalc</span></span><br><span class=\"line\"><span class=\"comment\"># ä½¿ç”¨ç¤ºä¾‹ï¼š</span></span><br><span class=\"line\"><span class=\"comment\">#  sipcalc 1.119.161.30/30</span></span><br><span class=\"line\"><span class=\"comment\">#  sipcalc 10.10.2.32 255.255.255.0</span></span><br><span class=\"line\"><span class=\"comment\">#  sipcalc 10.10.2.32 0xffffff00</span></span><br><span class=\"line\"><span class=\"comment\">#################################################</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ£€æŸ¥æ˜¯å¦æä¾›äº†æ­£ç¡®æ•°é‡çš„å‚æ•°</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> [ <span class=\"string\">&quot;<span class=\"variable\">$#</span>&quot;</span> -ne 1 ]; <span class=\"keyword\">then</span></span><br><span class=\"line\">    <span class=\"built_in\">echo</span> <span class=\"string\">&quot;ç”¨æ³•: <span class=\"variable\">$0</span> &lt;IPåœ°å€/å­ç½‘æ©ç CIDR&gt;&quot;</span></span><br><span class=\"line\">    <span class=\"built_in\">exit</span> 1</span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># è·å–å‘½ä»¤è¡Œå‚æ•°</span></span><br><span class=\"line\">ip_cidr=<span class=\"string\">&quot;<span class=\"variable\">$1</span>&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åˆ†å‰²IPåœ°å€å’Œå­ç½‘æ©ç </span></span><br><span class=\"line\">IFS=<span class=\"string\">&#x27;/&#x27;</span> <span class=\"built_in\">read</span> -A ip_parts &lt;&lt;&lt; <span class=\"string\">&quot;<span class=\"variable\">$ip_cidr</span>&quot;</span></span><br><span class=\"line\">ip=<span class=\"variable\">$&#123;ip_parts[1]&#125;</span></span><br><span class=\"line\">subnet_cidr=<span class=\"variable\">$&#123;ip_parts[2]&#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># è®¡ç®—å­ç½‘æ©ç çš„äºŒè¿›åˆ¶è¡¨ç¤º</span></span><br><span class=\"line\">subnet_binary=$(<span class=\"built_in\">printf</span> <span class=\"string\">&#x27;1%.0s&#x27;</span> $(<span class=\"built_in\">seq</span> 1 <span class=\"string\">&quot;<span class=\"variable\">$subnet_cidr</span>&quot;</span>) &amp;&amp; <span class=\"built_in\">printf</span> <span class=\"string\">&#x27;0%.0s&#x27;</span> $(<span class=\"built_in\">seq</span> 1 $((<span class=\"number\">32</span> - <span class=\"variable\">$subnet_cidr</span>))))</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å°†äºŒè¿›åˆ¶å­ç½‘æ©ç è½¬æ¢ä¸ºç‚¹åˆ†åè¿›åˆ¶è¡¨ç¤º</span></span><br><span class=\"line\">subnet_mask_decimal=$(<span class=\"built_in\">printf</span> <span class=\"string\">&quot;%d.%d.%d.%d&quot;</span> $((<span class=\"number\">2</span>#<span class=\"variable\">$&#123;subnet_binary:0:8&#125;</span>)) $((<span class=\"number\">2</span>#<span class=\"variable\">$&#123;subnet_binary:8:8&#125;</span>)) $((<span class=\"number\">2</span>#<span class=\"variable\">$&#123;subnet_binary:16:8&#125;</span>)) $((<span class=\"number\">2</span>#<span class=\"variable\">$&#123;subnet_binary:24:8&#125;</span>)))</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ä½¿ç”¨æŒ‰ä½ä¸è¿ç®—è®¡ç®—ç½‘ç»œåœ°å€</span></span><br><span class=\"line\">network_address=$(<span class=\"built_in\">printf</span> <span class=\"string\">&quot;%d.%d.%d.%d&quot;</span> $(( $(echo <span class=\"variable\">$ip</span> | cut -d. -f1) &amp; $(echo <span class=\"variable\">$subnet_mask_decimal</span> | cut -d. -f1) )) $(( $(echo <span class=\"variable\">$ip</span> | cut -d. -f2) &amp; $(echo <span class=\"variable\">$subnet_mask_decimal</span> | cut -d. -f2) )) $(( $(echo <span class=\"variable\">$ip</span> | cut -d. -f3) &amp; $(echo <span class=\"variable\">$subnet_mask_decimal</span> | cut -d. -f3) )) $(( $(echo <span class=\"variable\">$ip</span> | cut -d. -f4) &amp; $(echo <span class=\"variable\">$subnet_mask_decimal</span> | cut -d. -f4) )))</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># è®¡ç®—å¹¿æ’­åœ°å€å’Œç½‘å…³åœ°å€</span></span><br><span class=\"line\">broadcast_address=$(<span class=\"built_in\">printf</span> <span class=\"string\">&quot;%d.%d.%d.%d&quot;</span> $(( $(echo <span class=\"variable\">$network_address</span> | cut -d. -f1) | (<span class=\"number\">255</span> - $(echo <span class=\"variable\">$subnet_mask_decimal</span> | cut -d. -f1) % <span class=\"number\">256</span>) )) $(( $(echo <span class=\"variable\">$network_address</span> | cut -d. -f2) | (<span class=\"number\">255</span> - $(echo <span class=\"variable\">$subnet_mask_decimal</span> | cut -d. -f2) % <span class=\"number\">256</span>) )) $(( $(echo <span class=\"variable\">$network_address</span> | cut -d. -f3) | (<span class=\"number\">255</span> - $(echo <span class=\"variable\">$subnet_mask_decimal</span> | cut -d. -f3) % <span class=\"number\">256</span>) )) $(( $(echo <span class=\"variable\">$network_address</span> | cut -d. -f4) | (<span class=\"number\">255</span> - $(echo <span class=\"variable\">$subnet_mask_decimal</span> | cut -d. -f4) % <span class=\"number\">256</span>) )))</span><br><span class=\"line\"></span><br><span class=\"line\">gateway_address=$(<span class=\"built_in\">printf</span> <span class=\"string\">&quot;%d.%d.%d.%d&quot;</span> $(<span class=\"built_in\">echo</span> <span class=\"variable\">$network_address</span> | <span class=\"built_in\">cut</span> -d. -f1) $(<span class=\"built_in\">echo</span> <span class=\"variable\">$network_address</span> | <span class=\"built_in\">cut</span> -d. -f2) $(<span class=\"built_in\">echo</span> <span class=\"variable\">$network_address</span> | <span class=\"built_in\">cut</span> -d. -f3) $(( $(echo <span class=\"variable\">$network_address</span> | cut -d. -f4) + <span class=\"number\">1</span>)))</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># è¾“å‡ºç»“æœ</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;ç½‘ç»œåœ°å€: <span class=\"variable\">$network_address</span>&quot;</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;ç½‘å…³åœ°å€: <span class=\"variable\">$gateway_address</span>&quot;</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;å¹¿æ’­åœ°å€: <span class=\"variable\">$broadcast_address</span>&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># è®¡ç®—ä¸»æœºåœ°å€èŒƒå›´</span></span><br><span class=\"line\">first_host=$(<span class=\"built_in\">printf</span> <span class=\"string\">&quot;%d.%d.%d.%d&quot;</span> $(<span class=\"built_in\">echo</span> <span class=\"variable\">$network_address</span> | <span class=\"built_in\">cut</span> -d. -f1) $(<span class=\"built_in\">echo</span> <span class=\"variable\">$network_address</span> | <span class=\"built_in\">cut</span> -d. -f2) $(<span class=\"built_in\">echo</span> <span class=\"variable\">$network_address</span> | <span class=\"built_in\">cut</span> -d. -f3) $(( $(echo <span class=\"variable\">$network_address</span> | cut -d. -f4) + <span class=\"number\">1</span>)))</span><br><span class=\"line\">last_host=$(<span class=\"built_in\">printf</span> <span class=\"string\">&quot;%d.%d.%d.%d&quot;</span> $(<span class=\"built_in\">echo</span> <span class=\"variable\">$broadcast_address</span> | <span class=\"built_in\">cut</span> -d. -f1) $(<span class=\"built_in\">echo</span> <span class=\"variable\">$broadcast_address</span> | <span class=\"built_in\">cut</span> -d. -f2) $(<span class=\"built_in\">echo</span> <span class=\"variable\">$broadcast_address</span> | <span class=\"built_in\">cut</span> -d. -f3) $(( $(echo <span class=\"variable\">$broadcast_address</span> | cut -d. -f4) - <span class=\"number\">1</span>)))</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;ä¸»æœºåœ°å€èŒƒå›´: <span class=\"variable\">$first_host</span> åˆ° <span class=\"variable\">$last_host</span>&quot;</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h2 id=\"æŸ¥çœ‹æœ¬æœºç½‘ç»œä¿¡æ¯\">æŸ¥çœ‹æœ¬æœºç½‘ç»œä¿¡æ¯</h2>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#!/usr/bin/env zsh</span></span><br><span class=\"line\"><span class=\"comment\">#################################################</span></span><br><span class=\"line\"><span class=\"comment\">#filenameï¼šip</span></span><br><span class=\"line\"><span class=\"comment\">#æ‰§è¡Œæ–¹æ³•ï¼šip</span></span><br><span class=\"line\"><span class=\"comment\">#åŠŸèƒ½ï¼šæŸ¥çœ‹æœ¬æœºç½‘ç»œä¿¡æ¯</span></span><br><span class=\"line\"><span class=\"comment\">#################################################</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># é»˜è®¤è·å–å¤–ç½‘ipè¶…æ—¶3ç§’</span></span><br><span class=\"line\">maxtime=3</span><br><span class=\"line\"></span><br><span class=\"line\">net_ip=$(curl --max-time <span class=\"variable\">$maxtime</span> --silent https://ipv4.icanhazip.com)</span><br><span class=\"line\">MAC=$(ifconfig | grep en0: -A 7 | grep ether | <span class=\"built_in\">cut</span> -d <span class=\"string\">&quot; &quot;</span> -f 2)</span><br><span class=\"line\">local_ip=$(ifconfig | grep -A 1 <span class=\"string\">&quot;en&quot;</span> | grep broadcast | <span class=\"built_in\">cut</span> -d <span class=\"string\">&quot; &quot;</span> -f 2 | <span class=\"built_in\">tr</span> <span class=\"string\">&quot;\\\\n&quot;</span> <span class=\"string\">&quot; &quot;</span>)</span><br><span class=\"line\">DNS=$(nslookup localhost | grep Server | awk <span class=\"string\">&#x27;&#123;print $2&#125;&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;MAC: <span class=\"variable\">$&#123;MAC&#125;</span>&quot;</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;IP: <span class=\"variable\">$&#123;local_ip&#125;</span> <span class=\"variable\">$&#123;net_ip&#125;</span>&quot;</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;DNS: <span class=\"variable\">$&#123;DNS&#125;</span>&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">ip=`ifconfig | grep -A 1 <span class=\"string\">&quot;en&quot;</span> | grep broadcast | <span class=\"built_in\">cut</span> -d <span class=\"string\">&quot; &quot;</span> -f 2`</span><br><span class=\"line\">netmask=`ifconfig | grep -A 1 <span class=\"string\">&quot;en&quot;</span> | grep broadcast | <span class=\"built_in\">cut</span> -d <span class=\"string\">&quot; &quot;</span> -f 4`</span><br><span class=\"line\">Network=$(ipcalc -b <span class=\"variable\">$ip</span> <span class=\"variable\">$netmask</span> | grep Network | sed <span class=\"string\">&#x27;s/   / /&#x27;</span> | awk -F <span class=\"string\">&#x27; &#x27;</span> <span class=\"string\">&#x27;&#123;print $2&#125;&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;\\nIPè¯¦ç»†ä¿¡æ¯:&quot;</span></span><br><span class=\"line\">ip-info <span class=\"variable\">$&#123;Network&#125;</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"å°†åè¿›åˆ¶IPåœ°å€è½¬æ¢ä¸ºäºŒè¿›åˆ¶å½¢å¼\">å°†åè¿›åˆ¶IPåœ°å€è½¬æ¢ä¸ºäºŒè¿›åˆ¶å½¢å¼</h2>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#!/usr/bin/env zsh</span></span><br><span class=\"line\"><span class=\"comment\">#################################################</span></span><br><span class=\"line\"><span class=\"comment\">#åŠŸèƒ½ï¼šå°†åè¿›åˆ¶IPåœ°å€è½¬æ¢ä¸ºäºŒè¿›åˆ¶å½¢å¼</span></span><br><span class=\"line\"><span class=\"comment\">#filenameï¼šipTo2</span></span><br><span class=\"line\"><span class=\"comment\">#æ‰§è¡Œæ–¹æ³•ï¼šipTo2 192.168.16.155</span></span><br><span class=\"line\"><span class=\"comment\">#è¾“å‡ºç»“æœï¼š11000000.10101000.00010000.10011011</span></span><br><span class=\"line\"><span class=\"comment\">#################################################</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ£€æŸ¥æ˜¯å¦æä¾›äº†æ­£ç¡®æ•°é‡çš„å‚æ•°</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> [ <span class=\"string\">&quot;<span class=\"variable\">$#</span>&quot;</span> -ne 1 ]; <span class=\"keyword\">then</span></span><br><span class=\"line\">    <span class=\"built_in\">echo</span> <span class=\"string\">&quot;ç”¨æ³•: ipTo2 192.168.16.155&quot;</span></span><br><span class=\"line\">    <span class=\"built_in\">exit</span> 1</span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br><span class=\"line\"></span><br><span class=\"line\">ip=<span class=\"variable\">$1</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> $(<span class=\"built_in\">echo</span> <span class=\"variable\">$&#123;ip&#125;</span> | <span class=\"built_in\">tr</span> <span class=\"string\">&#x27;.&#x27;</span> <span class=\"string\">&#x27; &#x27;</span>); <span class=\"keyword\">do</span> <span class=\"built_in\">echo</span> <span class=\"string\">&quot;obase=2 ; <span class=\"variable\">$i</span>&quot;</span> | bc; <span class=\"keyword\">done</span> | awk <span class=\"string\">&#x27;&#123;printf &quot;.%08d&quot;, $1&#125;&#x27;</span> | <span class=\"built_in\">cut</span> -c2-</span><br></pre></td></tr></table></figure>\n<h2 id=\"å°†äºŒè¿›åˆ¶å½¢å¼è½¬æ¢ä¸ºåè¿›åˆ¶IPåœ°å€\">å°†äºŒè¿›åˆ¶å½¢å¼è½¬æ¢ä¸ºåè¿›åˆ¶IPåœ°å€</h2>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#!/usr/bin/env zsh</span></span><br><span class=\"line\"><span class=\"comment\">#################################################</span></span><br><span class=\"line\"><span class=\"comment\">#åŠŸèƒ½ï¼šå°†åè¿›åˆ¶IPåœ°å€è½¬æ¢ä¸ºäºŒè¿›åˆ¶å½¢å¼</span></span><br><span class=\"line\"><span class=\"comment\">#filenameï¼š2Toip</span></span><br><span class=\"line\"><span class=\"comment\">#æ‰§è¡Œæ–¹æ³•ï¼š2Toip 11111111.11111111.11100000.00000000</span></span><br><span class=\"line\"><span class=\"comment\">#è¾“å‡ºç»“æœï¼š255.255.224.0</span></span><br><span class=\"line\"><span class=\"comment\">#################################################</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ£€æŸ¥æ˜¯å¦æä¾›äº†æ­£ç¡®æ•°é‡çš„å‚æ•°</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> [ <span class=\"string\">&quot;<span class=\"variable\">$#</span>&quot;</span> -ne 1 ]; <span class=\"keyword\">then</span></span><br><span class=\"line\">    <span class=\"built_in\">echo</span> <span class=\"string\">&quot;ç”¨æ³•: 2Toip 11111111.11111111.11100000.00000000&quot;</span></span><br><span class=\"line\">    <span class=\"built_in\">exit</span> 1</span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"variable\">$1</span>|awk -F. <span class=\"string\">&#x27;function bin2dec(a,b,i,c)&#123;b=length(a);c=0;for(i=1;i&lt;=b;i++)&#123;c+=c;if(substr(a,i,1)==&quot;1&quot;)c++&#125;return c&#125;&#123;for(j=1;j&lt;=NF;j++)printf(&quot;%d%s&quot;,bin2dec($j),j!=NF?&quot;.&quot;:&quot;\\n&quot;)&#125;&#x27;</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"å­—ç¬¦ä¸²è½¬asciiç \">å­—ç¬¦ä¸²è½¬asciiç </h2>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#!/usr/bin/env zsh</span></span><br><span class=\"line\"><span class=\"comment\">#################################################</span></span><br><span class=\"line\"><span class=\"comment\">#filenameï¼šstrtoascii</span></span><br><span class=\"line\"><span class=\"comment\">#åŠŸèƒ½ï¼šå­—ç¬¦ä¸²è½¬asciiç </span></span><br><span class=\"line\"><span class=\"comment\">#æ‰§è¡Œæ–¹æ³•ï¼šstrtoascii ä½ å¥½hello</span></span><br><span class=\"line\"><span class=\"comment\">#è¾“å‡ºç»“æœï¼š\\u4f60\\u597d\\u68\\u65\\u6c\\u6c\\u6f</span></span><br><span class=\"line\"><span class=\"comment\">#################################################</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ£€æŸ¥æ˜¯å¦æä¾›äº†æ­£ç¡®æ•°é‡çš„å‚æ•°</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> [ <span class=\"string\">&quot;<span class=\"variable\">$#</span>&quot;</span> -ne 1 ]; <span class=\"keyword\">then</span></span><br><span class=\"line\">    <span class=\"built_in\">echo</span> <span class=\"string\">&quot;ç”¨æ³•: strtoascii ä½ å¥½hello&quot;</span></span><br><span class=\"line\">    <span class=\"built_in\">exit</span> 1</span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br><span class=\"line\"></span><br><span class=\"line\">str=<span class=\"variable\">$1</span></span><br><span class=\"line\">newstr=<span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">for</span> ((i=<span class=\"number\">0</span>;<span class=\"variable\">$i</span>&lt;<span class=\"variable\">$&#123;#str&#125;</span>;i=<span class=\"variable\">$i</span>+<span class=\"number\">1</span>));</span><br><span class=\"line\"><span class=\"keyword\">do</span></span><br><span class=\"line\">    text=<span class=\"string\">&quot;<span class=\"variable\">$&#123;str:$i:1&#125;</span>&quot;</span></span><br><span class=\"line\">    newtext=`<span class=\"built_in\">printf</span> <span class=\"string\">&quot;%x&quot;</span> <span class=\"string\">&quot;&#x27;<span class=\"variable\">$text</span>&quot;</span>`;</span><br><span class=\"line\">    newstr=<span class=\"variable\">$newstr</span><span class=\"string\">&quot;\\\\\\\\u&quot;</span><span class=\"variable\">$newtext</span></span><br><span class=\"line\"><span class=\"keyword\">done</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"variable\">$newstr</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"asciiç è½¬å­—ç¬¦ä¸²\">asciiç è½¬å­—ç¬¦ä¸²</h2>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#!/usr/bin/env zsh</span></span><br><span class=\"line\"><span class=\"comment\">#################################################</span></span><br><span class=\"line\"><span class=\"comment\">#filenameï¼šasciitostr</span></span><br><span class=\"line\"><span class=\"comment\">#åŠŸèƒ½ï¼š asciiç è½¬å­—ç¬¦ä¸²</span></span><br><span class=\"line\"><span class=\"comment\">#æ‰§è¡Œæ–¹æ³•ï¼šasciitostr \\u4f60\\u597d\\u68\\u65\\u6c\\u6c\\u6f</span></span><br><span class=\"line\"><span class=\"comment\">#è¾“å‡ºç»“æœï¼šä½ å¥½hello</span></span><br><span class=\"line\"><span class=\"comment\">#################################################</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ£€æŸ¥æ˜¯å¦æä¾›äº†æ­£ç¡®æ•°é‡çš„å‚æ•°</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> [ <span class=\"string\">&quot;<span class=\"variable\">$#</span>&quot;</span> -ne 1 ]; <span class=\"keyword\">then</span></span><br><span class=\"line\">    <span class=\"built_in\">echo</span> <span class=\"string\">&quot;ç”¨æ³•: asciitostr \\u4f60\\u597d\\u68\\u65\\u6c\\u6c\\u6f&quot;</span></span><br><span class=\"line\">    <span class=\"built_in\">exit</span> 1</span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ£€æŸ¥æ˜¯å¦åŒ…å«\\uï¼Œå¦‚æœä¸åŒ…å«ï¼Œæ·»åŠ åŒå¼•å·</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> [[ <span class=\"string\">&quot;<span class=\"variable\">$1</span>&quot;</span> != *\\\\u* ]]; <span class=\"keyword\">then</span></span><br><span class=\"line\">  input=$(<span class=\"built_in\">echo</span> -e <span class=\"variable\">$1</span> | sed <span class=\"string\">&#x27;s/u/\\\\u/g&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">else</span></span><br><span class=\"line\">  input=<span class=\"variable\">$1</span></span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br><span class=\"line\"><span class=\"comment\"># å°†Unicodeè½¬ä¹‰åºåˆ—è§£æä¸ºä¸­æ–‡å­—ç¬¦</span></span><br><span class=\"line\">result=$(<span class=\"built_in\">echo</span> -e <span class=\"variable\">$input</span> | perl -pe <span class=\"string\">&#x27;s/\\\\u([0-9a-fA-F]&#123;4&#125;)/chr(hex($1))/eg&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># è¾“å‡ºç»“æœ</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;<span class=\"variable\">$result</span>&quot;</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"è·å–javaæ–‡ä»¶çš„jdkç¼–è¯‘ç‰ˆæœ¬\">è·å–javaæ–‡ä»¶çš„jdkç¼–è¯‘ç‰ˆæœ¬</h2>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#!/usr/bin/env zsh</span></span><br><span class=\"line\"><span class=\"comment\">#################################################</span></span><br><span class=\"line\"><span class=\"comment\">#filenameï¼šjdk_version</span></span><br><span class=\"line\"><span class=\"comment\">#åŠŸèƒ½ï¼šè·å–å¯¹åº”javaæ–‡ä»¶çš„jdkç¼–è¯‘ç‰ˆæœ¬</span></span><br><span class=\"line\"><span class=\"comment\"># å¦‚æœæ˜¯jarï¼Œè¿™é‡Œåªä¼šæ£€ç´¢jaråŒ…ä¸­ç¬¬ä¸€ä¸ªclassçš„jdkç¼–è¯‘ç‰ˆæœ¬ï¼Œæ‰€ä»¥ä¹Ÿä¸ä¸€å®šå‡†ç¡®</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\">#æ‰§è¡Œæ–¹æ³•ï¼šjdk_version &lt;file_path:[.jar|.class|.war]&gt;</span></span><br><span class=\"line\"><span class=\"comment\"># 1.jarç¤ºä¾‹ï¼š</span></span><br><span class=\"line\"><span class=\"comment\">#  jdk_version xxl-job-admin-2.3.0.jar</span></span><br><span class=\"line\"><span class=\"comment\"># è¾“å‡ºï¼š</span></span><br><span class=\"line\"><span class=\"comment\">#  Build-Jdk: 1.8.0_271</span></span><br><span class=\"line\"><span class=\"comment\">#  file_path:[xxl-job-admin-2.3.0.jar]\tmajor_version:[52]\tjdk_version:[jdk1.8]</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 2.classç¤ºä¾‹</span></span><br><span class=\"line\"><span class=\"comment\">#  jdk_version XxlJobAdminConfig.class</span></span><br><span class=\"line\"><span class=\"comment\"># è¾“å‡ºï¼š</span></span><br><span class=\"line\"><span class=\"comment\">#  file_path:[XxlJobAdminConfig.class]\tmajor_version:[52]\tjdk_version:[jdk1.8]</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 3.warç¤ºä¾‹</span></span><br><span class=\"line\"><span class=\"comment\">#  jdk_version wardir/BOSS.war</span></span><br><span class=\"line\"><span class=\"comment\"># è¾“å‡ºï¼š</span></span><br><span class=\"line\"><span class=\"comment\">#  file_path:[wardir/BOSS.war]\t\tjdk_version:[1.7.0_67-b01 (Oracle Corporation)]</span></span><br><span class=\"line\"><span class=\"comment\">#################################################</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å®šä¹‰å…³è”æ•°ç»„</span></span><br><span class=\"line\"><span class=\"built_in\">typeset</span> -A my_map</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å‘å…³è”æ•°ç»„ä¸­æ·»åŠ é”®å€¼å¯¹</span></span><br><span class=\"line\"><span class=\"comment\"># LTS:</span></span><br><span class=\"line\"><span class=\"comment\">#    8(2014å¹´åˆå‘å¸ƒï¼Œå…è´¹ç‰ˆæœ¬è‡³8u202ï¼Œä»8u211å¼€å§‹å•†ç”¨æ”¶è´¹ï¼Œæ”¯æŒåˆ°2030å¹´9æœˆ)</span></span><br><span class=\"line\"><span class=\"comment\">#    11(2018å¹´9æœˆå‘å¸ƒï¼Œå…è´¹ç‰ˆæœ¬ç‰ˆæœ¬è‡³11.0.2ï¼Œåç»­ç‰ˆæœ¬å•†ç”¨æ”¶è´¹ï¼Œæ”¯æŒåˆ°2032å¹´9æœˆ)</span></span><br><span class=\"line\"><span class=\"comment\">#    17(2021å¹´9æœˆå‘å¸ƒï¼Œå…è´¹ï¼Œæ”¯æŒåˆ°2029å¹´9æœˆ)</span></span><br><span class=\"line\"><span class=\"comment\">#    21(2023å¹´9æœˆå‘å¸ƒï¼Œå…è´¹ï¼Œæ”¯æŒåˆ°2031å¹´9æœˆ)</span></span><br><span class=\"line\"><span class=\"comment\">#    25(é¢„è®¡2025å¹´9æœˆå‘å¸ƒï¼Œæ”¯æŒåˆ°2033å¹´9æœˆ)</span></span><br><span class=\"line\"><span class=\"comment\"># åç»­Oracleè®¡åˆ’æ¯åŠå¹´å‘å¸ƒä¸€ä¸ªæ–°çš„å¤§ç‰ˆæœ¬(3ã€9æœˆ)ï¼Œæ¯ä¸¤å¹´å‘å¸ƒä¸€æ¬¡LTS(9æœˆ)ï¼Œå»ºè®®æ­£å¼ç¯å¢ƒåªä½¿ç”¨LTSç‰ˆæœ¬</span></span><br><span class=\"line\"><span class=\"comment\"># æ­¤å¤„å¯ä»¥æŸ¥çœ‹jdkå‘å¸ƒè®¡åˆ’ï¼šhttps://www.java.com/en/releases/matrix/</span></span><br><span class=\"line\"><span class=\"comment\"># JDKä¸‹è½½åœ°å€ï¼šhttps://www.oracle.com/cn/java/technologies/downloads/</span></span><br><span class=\"line\">my_map=(</span><br><span class=\"line\">    [45]=<span class=\"string\">&quot;jdk1.1&quot;</span></span><br><span class=\"line\">    [46]=<span class=\"string\">&quot;jdk1.2&quot;</span></span><br><span class=\"line\">    [47]=<span class=\"string\">&quot;jdk1.3&quot;</span></span><br><span class=\"line\">    [48]=<span class=\"string\">&quot;jdk1.4&quot;</span></span><br><span class=\"line\">    [49]=<span class=\"string\">&quot;jdk1.5&quot;</span></span><br><span class=\"line\">    [50]=<span class=\"string\">&quot;jdk1.6&quot;</span></span><br><span class=\"line\">    [51]=<span class=\"string\">&quot;jdk1.7&quot;</span></span><br><span class=\"line\">    [52]=<span class=\"string\">&quot;jdk1.8&quot;</span></span><br><span class=\"line\">    [53]=<span class=\"string\">&quot;jdk9&quot;</span></span><br><span class=\"line\">    [54]=<span class=\"string\">&quot;jdk10&quot;</span></span><br><span class=\"line\">    [55]=<span class=\"string\">&quot;jdk11&quot;</span></span><br><span class=\"line\">    [56]=<span class=\"string\">&quot;jdk12&quot;</span></span><br><span class=\"line\">    [57]=<span class=\"string\">&quot;jdk13&quot;</span></span><br><span class=\"line\">    [58]=<span class=\"string\">&quot;jdk14&quot;</span></span><br><span class=\"line\">    [59]=<span class=\"string\">&quot;jdk15&quot;</span></span><br><span class=\"line\">    [60]=<span class=\"string\">&quot;jdk16&quot;</span></span><br><span class=\"line\">    [61]=<span class=\"string\">&quot;jdk17&quot;</span></span><br><span class=\"line\">    [62]=<span class=\"string\">&quot;jdk18&quot;</span></span><br><span class=\"line\">    [63]=<span class=\"string\">&quot;jdk19&quot;</span></span><br><span class=\"line\">    [64]=<span class=\"string\">&quot;jdk20&quot;</span></span><br><span class=\"line\">    [65]=<span class=\"string\">&quot;jdk21&quot;</span></span><br><span class=\"line\">    [66]=<span class=\"string\">&quot;jdk22&quot;</span></span><br><span class=\"line\">    [67]=<span class=\"string\">&quot;jdk23&quot;</span></span><br><span class=\"line\">    [68]=<span class=\"string\">&quot;jdk24&quot;</span></span><br><span class=\"line\">    [69]=<span class=\"string\">&quot;jdk25&quot;</span></span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># è·å–æ‰€æœ‰é”®å¹¶æ’åº</span></span><br><span class=\"line\">sorted_keys=(<span class=\"variable\">$&#123;(o)<span class=\"variable\">$&#123;(k)my_map&#125;</span>&#125;</span>)</span><br><span class=\"line\"><span class=\"comment\"># echo $sorted_keys</span></span><br><span class=\"line\"></span><br><span class=\"line\">original_string=<span class=\"string\">&quot;\\tmajor_version\\tjdk_version&quot;</span></span><br><span class=\"line\"><span class=\"comment\"># tr &#x27;[:lower:]&#x27; &#x27;[:upper:]&#x27; å°†å­—ç¬¦ä¸²ä¸­çš„å°å†™å­—æ¯è½¬æ¢ä¸ºå¤§å†™å­—æ¯ã€‚è¾“å‡ºç»“æœå°†æ˜¯ &quot;MAJOR_VERSION\\tJDK_VERSION&quot;</span></span><br><span class=\"line\">uppercase_string=$(<span class=\"built_in\">echo</span> <span class=\"string\">&quot;<span class=\"variable\">$original_string</span>&quot;</span> | <span class=\"built_in\">tr</span> <span class=\"string\">&#x27;[:lower:]&#x27;</span> <span class=\"string\">&#x27;[:upper:]&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ‰“å°map</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"title\">echo_map</span></span>() &#123;</span><br><span class=\"line\">    <span class=\"built_in\">echo</span> <span class=\"string\">&quot;<span class=\"variable\">$&#123;uppercase_string&#125;</span>&quot;</span></span><br><span class=\"line\">    <span class=\"comment\"># æŒ‰æ’åºåçš„é”®è¾“å‡ºé”®å€¼å¯¹</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> key <span class=\"keyword\">in</span> <span class=\"variable\">$sorted_keys</span>; <span class=\"keyword\">do</span></span><br><span class=\"line\">        <span class=\"built_in\">echo</span> <span class=\"string\">&quot;\\t<span class=\"variable\">$key</span>\\t\\t<span class=\"variable\">$&#123;my_map[$key]&#125;</span>&quot;</span></span><br><span class=\"line\">    <span class=\"keyword\">done</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"title\">error_message</span></span>() &#123;</span><br><span class=\"line\">    <span class=\"built_in\">echo</span> <span class=\"string\">&quot;Usage: jdk_version &lt;file_path:[.jar|.class|.war]&gt;&quot;</span></span><br><span class=\"line\">    echo_map</span><br><span class=\"line\">    <span class=\"built_in\">exit</span> 1</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ£€æŸ¥æ˜¯å¦ä¼ é€’äº†å‚æ•°</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> [ -z <span class=\"string\">&quot;<span class=\"variable\">$1</span>&quot;</span> ]; <span class=\"keyword\">then</span></span><br><span class=\"line\">    error_message</span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br><span class=\"line\"></span><br><span class=\"line\">file_path=<span class=\"variable\">$1</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> [ ! -e <span class=\"string\">&quot;<span class=\"variable\">$file_path</span>&quot;</span> ]; <span class=\"keyword\">then</span></span><br><span class=\"line\">    <span class=\"built_in\">echo</span> <span class=\"string\">&quot;æ–‡ä»¶ä¸å­˜åœ¨:file_path:[<span class=\"variable\">$&#123;file_path&#125;</span>]&quot;</span></span><br><span class=\"line\">    error_message</span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br><span class=\"line\"></span><br><span class=\"line\">greap_content=<span class=\"string\">&quot;major version&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> [[ <span class=\"variable\">$file_path</span> == *.class ]]; <span class=\"keyword\">then</span></span><br><span class=\"line\">    <span class=\"comment\"># é€šè¿‡javapå‘½ä»¤è·å–classæ–‡ä»¶çš„è¯¦ç»†ä¿¡æ¯ï¼Œgrepè¿‡æ»¤å‡ºåŒ…å« â€œmajor versionâ€ çš„è¡Œï¼Œawkå–å‡ºå…¶ç‰ˆæœ¬å·</span></span><br><span class=\"line\">    key=$(javap -verbose <span class=\"variable\">$&#123;file_path&#125;</span> | grep <span class=\"string\">&quot;<span class=\"variable\">$&#123;greap_content&#125;</span>&quot;</span> | awk -F<span class=\"string\">&#x27;: &#x27;</span> <span class=\"string\">&#x27;&#123;print $2&#125;&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">elif</span> [[ <span class=\"variable\">$file_path</span> == *.jar ]]; <span class=\"keyword\">then</span></span><br><span class=\"line\">    <span class=\"comment\"># å…ˆé€šè¿‡â€œjar tfâ€å‘½ä»¤è·å–jaråŒ…ä¸­çš„classæ–‡ä»¶ï¼Œè¿™é‡Œåªå–å‡ºç¬¬ä¸€ä¸ªï¼Œæ³¨æ„è¿™é‡Œclassè·¯å¾„å¿…é¡»å»æ‰â€œ.classâ€ï¼Œä¹‹åå†é€šè¿‡javapå‘½ä»¤è·å–â€œ-classpathâ€æ‰€æŒ‡å®šçš„jarä¸­çš„è¿™ä¸ªç¬¬ä¸€ä¸ªclassæ–‡ä»¶çš„è¯¦ç»†ä¿¡æ¯ï¼Œgrepè¿‡æ»¤å‡ºåŒ…å« â€œmajor versionâ€ çš„è¡Œï¼Œawkå–å‡ºå…¶ç‰ˆæœ¬å·</span></span><br><span class=\"line\">    key=$(javap -classpath <span class=\"variable\">$&#123;file_path&#125;</span> -verbose $(jar tf <span class=\"variable\">$&#123;file_path&#125;</span> | grep <span class=\"string\">&quot;.class$&quot;</span> | <span class=\"built_in\">head</span> -n 1 | sed s/.class//) | grep <span class=\"string\">&quot;<span class=\"variable\">$&#123;greap_content&#125;</span>&quot;</span> | awk -F<span class=\"string\">&#x27;: &#x27;</span> <span class=\"string\">&#x27;&#123;print $2&#125;&#x27;</span>)</span><br><span class=\"line\">    <span class=\"comment\"># é€šè¿‡jaråŒ…ä¸­çš„MANIFEST.MFæ–‡ä»¶æ¥åˆ¤æ–­æ‰“åŒ…çš„jdkç‰ˆæœ¬</span></span><br><span class=\"line\">    result=$(unzip -p <span class=\"variable\">$&#123;file_path&#125;</span> $(jar tf <span class=\"variable\">$&#123;file_path&#125;</span> | grep <span class=\"string\">&quot;MANIFEST.MF$&quot;</span> | <span class=\"built_in\">head</span> -n 1) | grep <span class=\"string\">&quot;^Build-Jdk&quot;</span>)</span><br><span class=\"line\">    <span class=\"keyword\">if</span> [ -z <span class=\"string\">&quot;<span class=\"variable\">$result</span>&quot;</span> ]; <span class=\"keyword\">then</span></span><br><span class=\"line\">        result=$(unzip -p <span class=\"variable\">$&#123;file_path&#125;</span> $(jar tf <span class=\"variable\">$&#123;file_path&#125;</span> | grep <span class=\"string\">&quot;MANIFEST.MF$&quot;</span> | <span class=\"built_in\">head</span> -n 1) | grep <span class=\"string\">&quot;^Created-By&quot;</span>)</span><br><span class=\"line\">    <span class=\"keyword\">fi</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> [ -n <span class=\"string\">&quot;<span class=\"variable\">$result</span>&quot;</span> ]; <span class=\"keyword\">then</span></span><br><span class=\"line\">        <span class=\"built_in\">echo</span> <span class=\"variable\">$result</span></span><br><span class=\"line\">    <span class=\"keyword\">else</span></span><br><span class=\"line\">        <span class=\"built_in\">echo</span> <span class=\"string\">&quot;æ²¡æœ‰åœ¨ MANIFEST.MF ä¸­å‘ç°jdkç›¸å…³ä¿¡æ¯&quot;</span></span><br><span class=\"line\">    <span class=\"keyword\">fi</span></span><br><span class=\"line\"><span class=\"keyword\">elif</span> [[ <span class=\"variable\">$file_path</span> == *.war ]]; <span class=\"keyword\">then</span></span><br><span class=\"line\">    <span class=\"comment\"># æŸ¥æ‰¾ Build-Jdk</span></span><br><span class=\"line\">    jdk_version=$(unzip -p <span class=\"string\">&quot;<span class=\"variable\">$&#123;file_path&#125;</span>&quot;</span> META-INF/MANIFEST.MF | grep -i <span class=\"string\">&quot;^Build-Jdk&quot;</span> | awk -F<span class=\"string\">&#x27;: &#x27;</span> <span class=\"string\">&#x27;&#123;print $2&#125;&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># å¦‚æœ Build-Jdk æœªæ‰¾åˆ°ï¼Œåˆ™å°è¯•æŸ¥æ‰¾ Created-By</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> [ -z <span class=\"string\">&quot;<span class=\"variable\">$jdk_version</span>&quot;</span> ]; <span class=\"keyword\">then</span></span><br><span class=\"line\">        jdk_version=$(unzip -p <span class=\"string\">&quot;<span class=\"variable\">$&#123;file_path&#125;</span>&quot;</span> META-INF/MANIFEST.MF | grep -i <span class=\"string\">&quot;^Created-By&quot;</span> | awk -F<span class=\"string\">&#x27;: &#x27;</span> <span class=\"string\">&#x27;&#123;print $2&#125;&#x27;</span>)</span><br><span class=\"line\">    <span class=\"keyword\">fi</span></span><br><span class=\"line\"><span class=\"keyword\">else</span></span><br><span class=\"line\">    error_message</span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ‰“å°ç»“æœ</span></span><br><span class=\"line\"><span class=\"comment\"># è¾“å‡º JDK ç‰ˆæœ¬ä¿¡æ¯</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> [ -n <span class=\"string\">&quot;<span class=\"variable\">$key</span>&quot;</span> ]; <span class=\"keyword\">then</span></span><br><span class=\"line\">    <span class=\"built_in\">echo</span> <span class=\"string\">&quot;file_path:[<span class=\"variable\">$&#123;file_path&#125;</span>]\\tmajor_version:[<span class=\"variable\">$key</span>]\\tjdk_version:[<span class=\"variable\">$&#123;my_map[$key]&#125;</span>]&quot;</span></span><br><span class=\"line\"><span class=\"keyword\">elif</span> [ -n <span class=\"string\">&quot;<span class=\"variable\">$jdk_version</span>&quot;</span> ]; <span class=\"keyword\">then</span></span><br><span class=\"line\">    <span class=\"comment\"># jdk_versionå«æœ‰ç‰¹æ®Šå­—ç¬¦ï¼Œé€šè¿‡å¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹åŒ…å«å“ªäº›ç‰¹æ®Šå­—ç¬¦ï¼Œç»“æœå‘ç°åŒ…å«\\r\\n</span></span><br><span class=\"line\">    <span class=\"comment\"># echo &quot;$&#123;jdk_version&#125;&quot; | od -c</span></span><br><span class=\"line\">    <span class=\"comment\"># å»æ‰ç‰¹æ®Šå­—ç¬¦ \\r\\n</span></span><br><span class=\"line\">    jdk_version_cleaned=$(<span class=\"built_in\">echo</span> <span class=\"string\">&quot;<span class=\"variable\">$&#123;jdk_version&#125;</span>&quot;</span> | <span class=\"built_in\">tr</span> -d <span class=\"string\">&#x27;\\r\\n&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">echo</span>  <span class=\"string\">&quot;file_path:[<span class=\"variable\">$&#123;file_path&#125;</span>]\\t\\tjdk_version:[<span class=\"variable\">$&#123;jdk_version_cleaned&#125;</span>]&quot;</span></span><br><span class=\"line\"><span class=\"keyword\">else</span></span><br><span class=\"line\">    <span class=\"built_in\">echo</span> <span class=\"string\">&quot;JDK Version information not found&quot;</span></span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br></pre></td></tr></table></figure>\n","content_text":"æ‘˜è¦ è¿™é‡Œåˆ—ä¸¾ä¸€äº›macosä¸‹ä¸€äº›æœ‰ç”¨çš„shellè„šæœ¬ ä¸æœ¬æ–‡è„šæœ¬å¯¹åº”çš„centosè„šæœ¬å¯ä»¥å‚çœ‹centos-shell æŸ¥çœ‹ç«¯å£è¢«å“ªä¸ªè¿›ç¨‹å ç”¨ 12345678910111213#!/usr/bin/env zsh##################################################filenameï¼šport æˆäºˆæ‰§è¡Œæƒé™#åŠŸèƒ½ï¼šæŸ¥è¯¢ç«¯å£è¢«å“ªä¸ªè¿›ç¨‹å ç”¨#æ‰§è¡Œæ–¹æ³•ï¼šport 8080#################################################port=$1if [ -z &quot;$port&quot; ]; then echo &quot;è¯·åŠ ä¸Šç«¯å£ä½œä¸ºå‚æ•°ï¼Œå¦‚ï¼šport 8080&quot;else lsof -i :$&#123;port&#125;fi æ€æ‰å ç”¨æŸä¸ªç«¯å£çš„è¿›ç¨‹ 123456789101112131415161718192021222324#!/usr/bin/env zsh##################################################filenameï¼škillport æˆäºˆæ‰§è¡Œæƒé™#åŠŸèƒ½ï¼šå…³é—­å ç”¨ç«¯å£çš„è¿›ç¨‹#æ‰§è¡Œæ–¹æ³•ï¼škillport 8080#################################################if [ -z &quot;$1&quot; ]; then echo &quot;è¯·åŠ ä¸Šç«¯å£ä½œä¸ºå‚æ•°ï¼Œå¦‚ï¼škillport 8080&quot;else echo &quot;kill begin........&quot; pid=`port $1 | awk &#x27;NR&gt;1 &#123;print $2&#125;&#x27; | sort | uniq` echo $pid if [ -z &quot;$pid&quot; ] ; then echo &quot;No process running.&quot; #exit -1; else echo &quot;The process($&#123;pid&#125;) is running...&quot; kill $&#123;pid&#125; echo &quot;kill process($&#123;pid&#125;) OK&quot; fifi æœ¬æœºç«¯å£é€šè¿‡è·³æ¿æœºè½¬å‘åˆ°è¿œç¨‹ç«¯å£ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100#!/usr/bin/env zsh##################################################filenameï¼šssh_port æˆäºˆæ‰§è¡Œæƒé™#åŠŸèƒ½ï¼šæœ¬æœºç«¯å£é€šè¿‡è·³æ¿æœºè½¬å‘åˆ°è¿œç¨‹ç«¯å£#æ‰§è¡Œæ–¹æ³•ï¼š# ssh_port start 8080 10.10.2.2 80# ssh_port stop 8080# ssh_port status 8080#################################################check()&#123; #éªŒè¯å‚æ•°æ˜¯å¦ä¸ºç©º if [[ $&#123;#@&#125; &lt; 1 ]];then echo &quot;è¯·è¾“å…¥å‚æ•°ï¼&quot; echo &quot;å¼€å¯ç«¯å£è½¬å‘ï¼šssh_port start 8080 10.10.2.2 80&quot; echo &quot;å…³é—­ç«¯å£è½¬å‘ï¼šssh_port stop 8080&quot; echo &quot;æŸ¥çœ‹ç«¯å£çŠ¶æ€ï¼šssh_port status 8080&quot; exit 1 fi&#125;check $@# å·¥ä½œç›®å½•WORKDIR=&quot;/Users/$(whoami)/workdir&quot;# æ“ä½œç±»å‹operation=&quot;$1&quot;# æœ¬åœ°ç«¯å£local_port=&quot;$2&quot;# è¿œç¨‹ IP åœ°å€remote_ip=&quot;$3&quot;# è¿œç¨‹ç«¯å£remote_port=&quot;$4&quot;# SSH æ§åˆ¶å¥—æ¥å­—æ–‡ä»¶sock_file=&quot;$WORKDIR/$local_port.sock&quot;# è·³æ¿æœºï¼Œ~/.ssh/configä¸­çš„é…ç½®jump_name=jump-machinestart()&#123; echo &quot;start port begin........&quot; pid=`port $local_port | grep ssh | awk &#x27;&#123;print $2&#125;&#x27;` if [ -z &quot;$pid&quot; ] ; then # å»ºç«‹è¿æ¥ ssh -nNT -S &quot;$sock_file&quot; -L 127.0.0.1:$local_port:$remote_ip:$remote_port $jump_name echo &quot;ssh -nNT -S $&#123;sock_file&#125; -L 127.0.0.1:$&#123;local_port&#125;:$&#123;remote_ip&#125;:$&#123;remote_port&#125; $&#123;jump_name&#125;&quot; echo &quot;start port success!&quot; sleep 1 else echo &quot;port is running.&quot; fi&#125;stop()&#123; echo &quot;stop port begin........&quot; pid=`port $local_port | grep ssh | awk &#x27;&#123;print $2&#125;&#x27;` if [ -z &quot;$pid&quot; ] ; then echo &quot;No port running.&quot; else echo &quot;The port ($&#123;pid&#125;) is running...&quot; # kill -9 $pid ssh -S $sock_file -O exit $jump_name echo &quot;ssh -S $sock_file -O exit $jump_name&quot; echo &quot;stop port ($&#123;pid&#125;) success!&quot; fi&#125;status()&#123; echo &quot;check status port begin........&quot; pid=`port $local_port | grep ssh | awk &#x27;&#123;print $2&#125;&#x27;` if [ -z &quot;$pid&quot; ] ; then echo &quot;No port running.&quot; else echo &quot;The port ($&#123;pid&#125;) is running...&quot; port $local_port fi&#125;if [ -n &quot;$operation&quot; ];then # åˆ¤æ–­æ“ä½œç±»å‹ if [[ &quot;$operation&quot; == &quot;start&quot; ]]; then # å»ºç«‹è¿æ¥ start elif [[ &quot;$operation&quot; == &quot;stop&quot; ]]; then # å…³é—­è¿æ¥ stop elif [[ &quot;$operation&quot; == &quot;status&quot; ]]; then # å…³é—­è¿æ¥ status else check exit 1 fifi æŸ¥çœ‹åŸŸååˆ°æœŸæ—¶é—´ 123456789101112131415161718192021222324252627282930313233343536373839#!/usr/bin/env zsh##################################################filenameï¼šcheck_domain æˆäºˆæ‰§è¡Œæƒé™#åŠŸèƒ½ï¼šæ£€æŸ¥åŸŸååˆ°æœŸæ—¶é—´#æ‰§è¡Œæ–¹æ³•ï¼šcheck_domain baidu.com google.com#è¾“å‡ºç»“æœï¼š# baidu.comï¼Œè¿‡æœŸæ—¥æœŸï¼š2026-10-11# è·ç¦»åˆ°æœŸè¿˜æœ‰958å¤©# google.comï¼Œè¿‡æœŸæ—¥æœŸï¼š2028-09-14# è·ç¦»åˆ°æœŸè¿˜æœ‰1662å¤©##################################################éªŒè¯åŸŸåå‚æ•°æ˜¯å¦ä¸ºç©ºif [[ $&#123;#@&#125; &lt; 1 ]];then echo &quot;è¯·è¾“å…¥åŸŸåï¼Œå¤šä¸ªåŸŸåç©ºæ ¼åˆ†éš”ï¼Œå¦‚ï¼šcheck_domain baidu.com google.com&quot;fi#æ£€æµ‹åŸŸååˆ°æœŸæ—¶é—´for domain in &quot;$@&quot;;do #å–å‡ºåŸŸåè¿‡æœŸæ—¶é—´ expire_date=`whois $domain | grep &quot;Expiration Time&quot; | awk &#x27;&#123;print $3&#125;&#x27;` if [ -z &quot;$expire_date&quot; ];then expire_date=`whois $domain | grep &#x27;Expiry Date&#x27;| awk &#x27;&#123;print $4&#125;&#x27;| cut -d &#x27;T&#x27; -f 1` fi echo &quot;$&#123;domain&#125;ï¼Œè¿‡æœŸæ—¥æœŸï¼š$&#123;expire_date&#125;&quot; #è½¬æ¢æˆæ—¶é—´æˆ³ # 1.linux # expire_date_timestamp=`date -d $expire_date +%s` # 2.macos # https://blog.csdn.net/zhw21w/article/details/126010972 expire_date_timestamp=`date -j -f %Y-%m-%d $expire_date +%s` #ä»¥æ—¶é—´æˆ³çš„å½¢å¼æ˜¾ç¤ºå½“å‰æ—¶é—´ now=`date &#x27;+%s&#x27;` #åŸŸååˆ°æœŸå‰©ä½™å¤©æ•° time_left=$[$[$expire_date_timestamp-$now]/86400] echo &quot;è·ç¦»åˆ°æœŸè¿˜æœ‰$&#123;time_left&#125;å¤©&quot;done æŸ¥çœ‹è¯ä¹¦åˆ°æœŸæ—¶é—´ 123456789101112131415161718192021222324252627282930313233343536#!/usr/bin/env zsh##################################################filenameï¼šssl_check æˆäºˆæ‰§è¡Œæƒé™#åŠŸèƒ½ï¼šæ£€æŸ¥è¯ä¹¦åˆ°æœŸæ—¶é—´#æ‰§è¡Œæ–¹æ³•ï¼šssl_check www.baidu.com www.google.com#è¾“å‡ºç»“æœï¼š# è¯ä¹¦ï¼šwww.baidu.comï¼Œè¿‡æœŸæ—¶é—´ï¼š2024-08-06 01:51:05# è·ç¦»åˆ°æœŸè¿˜æœ‰161å¤©# è¯ä¹¦ï¼šwww.google.comï¼Œè¿‡æœŸæ—¶é—´ï¼š2024-04-29 08:19:49# è·ç¦»åˆ°æœŸè¿˜æœ‰62å¤©##################################################éªŒè¯è¯ä¹¦å‚æ•°æ˜¯å¦ä¸ºç©ºif [[ $&#123;#@&#125; &lt; 1 ]];then echo &quot;è¯·è¾“å…¥è¯ä¹¦ï¼Œå¤šä¸ªè¯ä¹¦ç©ºæ ¼åˆ†éš”ï¼Œå¦‚ï¼šssl_check www.baidu.com www.google.com&quot;fi#è·å–è¯ä¹¦çš„æœ‰æ•ˆæ—¶é—´for domain in &quot;$@&quot;;do # è¿™é‡Œåœ¨openssl x509 -noout -datesåé¢åŠ ä¸Šäº†2&gt;/dev/nullï¼Œå¦åˆ™ä¼šæ‰“å°å‘Šè­¦ä¿¡æ¯ï¼šWarning: Reading certificate from stdin since no -in or -new option is given # æ‚¨å¯ä»¥å¿½ç•¥æ­¤è­¦å‘Šã€‚å®ƒåªæ˜¯è¡¨æ˜æ‚¨æ²¡æœ‰ä½¿ç”¨ -in æˆ– -new é€‰é¡¹æŒ‡å®šè¾“å…¥æ–‡ä»¶ï¼Œå› æ­¤ OpenSSL å°†ä»æ ‡å‡†è¾“å…¥ (stdin) è¯»å–è¯ä¹¦ã€‚ time=$(echo | openssl s_client -connect $domain:443 2&gt;/dev/null | openssl x509 -noout -dates 2&gt;/dev/null |awk -F&#x27;=&#x27; &#x27;NR==2&#123;print $2&#125;&#x27;) #echo $time #å–å‡ºåŸŸåè¿‡æœŸæ—¶é—´ expire_date=`env LC_ALL=en_US.en date -j -f &#x27;%b %d %H:%M:%S %Y GMT&#x27; &quot;$time&quot; &#x27;+%Y-%m-%d %H:%M:%S&#x27;` echo &quot;è¯ä¹¦ï¼š$domainï¼Œè¿‡æœŸæ—¶é—´ï¼š$expire_date&quot; expire_date_timestamp=`date -j -f &#x27;%Y-%m-%d %H:%M:%S&#x27; $expire_date +%s` #ä»¥æ—¶é—´æˆ³çš„å½¢å¼æ˜¾ç¤ºå½“å‰æ—¶é—´ now=`date &#x27;+%s&#x27;` #è¯ä¹¦åˆ°æœŸå‰©ä½™å¤©æ•° time_left=$[$[$expire_date_timestamp-$now]/86400] echo &quot;è·ç¦»åˆ°æœŸè¿˜æœ‰$&#123;time_left&#125;å¤©&quot;done æŸ¥çœ‹æŒ‡å®šIPçš„è¯¦ç»†ä¿¡æ¯ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758#!/usr/bin/env zsh################################################## filenameï¼šip-info æˆæƒæ‰§è¡Œæƒé™# åŠŸèƒ½ï¼šæŸ¥çœ‹IPä¿¡æ¯# ä½¿ç”¨æ–¹æ³•ï¼šip-info 10.10.2.24/24# è¾“å‡ºç»“æœï¼š# ç½‘ç»œåœ°å€: 10.10.2.0# ç½‘å…³åœ°å€: 10.10.2.1# å¹¿æ’­åœ°å€: 10.10.2.255# ä¸»æœºåœ°å€èŒƒå›´: 10.10.2.1 åˆ° 10.10.2.254# ä¹Ÿå¯ä»¥ä½¿ç”¨ sipcalc å‘½ä»¤ï¼Œç”¨æ³•æ›´å¤šï¼Œæ˜¾ç¤ºä¹Ÿä¼šæ›´ä¸ºè¯¦ç»†ï¼š# å®‰è£…ï¼šbrew install sipcalc# ä½¿ç”¨ç¤ºä¾‹ï¼š# sipcalc 1.119.161.30/30# sipcalc 10.10.2.32 255.255.255.0# sipcalc 10.10.2.32 0xffffff00################################################## æ£€æŸ¥æ˜¯å¦æä¾›äº†æ­£ç¡®æ•°é‡çš„å‚æ•°if [ &quot;$#&quot; -ne 1 ]; then echo &quot;ç”¨æ³•: $0 &lt;IPåœ°å€/å­ç½‘æ©ç CIDR&gt;&quot; exit 1fi# è·å–å‘½ä»¤è¡Œå‚æ•°ip_cidr=&quot;$1&quot;# åˆ†å‰²IPåœ°å€å’Œå­ç½‘æ©ç IFS=&#x27;/&#x27; read -A ip_parts &lt;&lt;&lt; &quot;$ip_cidr&quot;ip=$&#123;ip_parts[1]&#125;subnet_cidr=$&#123;ip_parts[2]&#125;# è®¡ç®—å­ç½‘æ©ç çš„äºŒè¿›åˆ¶è¡¨ç¤ºsubnet_binary=$(printf &#x27;1%.0s&#x27; $(seq 1 &quot;$subnet_cidr&quot;) &amp;&amp; printf &#x27;0%.0s&#x27; $(seq 1 $((32 - $subnet_cidr))))# å°†äºŒè¿›åˆ¶å­ç½‘æ©ç è½¬æ¢ä¸ºç‚¹åˆ†åè¿›åˆ¶è¡¨ç¤ºsubnet_mask_decimal=$(printf &quot;%d.%d.%d.%d&quot; $((2#$&#123;subnet_binary:0:8&#125;)) $((2#$&#123;subnet_binary:8:8&#125;)) $((2#$&#123;subnet_binary:16:8&#125;)) $((2#$&#123;subnet_binary:24:8&#125;)))# ä½¿ç”¨æŒ‰ä½ä¸è¿ç®—è®¡ç®—ç½‘ç»œåœ°å€network_address=$(printf &quot;%d.%d.%d.%d&quot; $(( $(echo $ip | cut -d. -f1) &amp; $(echo $subnet_mask_decimal | cut -d. -f1) )) $(( $(echo $ip | cut -d. -f2) &amp; $(echo $subnet_mask_decimal | cut -d. -f2) )) $(( $(echo $ip | cut -d. -f3) &amp; $(echo $subnet_mask_decimal | cut -d. -f3) )) $(( $(echo $ip | cut -d. -f4) &amp; $(echo $subnet_mask_decimal | cut -d. -f4) )))# è®¡ç®—å¹¿æ’­åœ°å€å’Œç½‘å…³åœ°å€broadcast_address=$(printf &quot;%d.%d.%d.%d&quot; $(( $(echo $network_address | cut -d. -f1) | (255 - $(echo $subnet_mask_decimal | cut -d. -f1) % 256) )) $(( $(echo $network_address | cut -d. -f2) | (255 - $(echo $subnet_mask_decimal | cut -d. -f2) % 256) )) $(( $(echo $network_address | cut -d. -f3) | (255 - $(echo $subnet_mask_decimal | cut -d. -f3) % 256) )) $(( $(echo $network_address | cut -d. -f4) | (255 - $(echo $subnet_mask_decimal | cut -d. -f4) % 256) )))gateway_address=$(printf &quot;%d.%d.%d.%d&quot; $(echo $network_address | cut -d. -f1) $(echo $network_address | cut -d. -f2) $(echo $network_address | cut -d. -f3) $(( $(echo $network_address | cut -d. -f4) + 1)))# è¾“å‡ºç»“æœecho &quot;ç½‘ç»œåœ°å€: $network_address&quot;echo &quot;ç½‘å…³åœ°å€: $gateway_address&quot;echo &quot;å¹¿æ’­åœ°å€: $broadcast_address&quot;# è®¡ç®—ä¸»æœºåœ°å€èŒƒå›´first_host=$(printf &quot;%d.%d.%d.%d&quot; $(echo $network_address | cut -d. -f1) $(echo $network_address | cut -d. -f2) $(echo $network_address | cut -d. -f3) $(( $(echo $network_address | cut -d. -f4) + 1)))last_host=$(printf &quot;%d.%d.%d.%d&quot; $(echo $broadcast_address | cut -d. -f1) $(echo $broadcast_address | cut -d. -f2) $(echo $broadcast_address | cut -d. -f3) $(( $(echo $broadcast_address | cut -d. -f4) - 1)))echo &quot;ä¸»æœºåœ°å€èŒƒå›´: $first_host åˆ° $last_host&quot; æŸ¥çœ‹æœ¬æœºç½‘ç»œä¿¡æ¯ 12345678910111213141516171819202122232425#!/usr/bin/env zsh##################################################filenameï¼šip#æ‰§è¡Œæ–¹æ³•ï¼šip#åŠŸèƒ½ï¼šæŸ¥çœ‹æœ¬æœºç½‘ç»œä¿¡æ¯################################################## é»˜è®¤è·å–å¤–ç½‘ipè¶…æ—¶3ç§’maxtime=3net_ip=$(curl --max-time $maxtime --silent https://ipv4.icanhazip.com)MAC=$(ifconfig | grep en0: -A 7 | grep ether | cut -d &quot; &quot; -f 2)local_ip=$(ifconfig | grep -A 1 &quot;en&quot; | grep broadcast | cut -d &quot; &quot; -f 2 | tr &quot;\\\\n&quot; &quot; &quot;)DNS=$(nslookup localhost | grep Server | awk &#x27;&#123;print $2&#125;&#x27;)echo &quot;MAC: $&#123;MAC&#125;&quot;echo &quot;IP: $&#123;local_ip&#125; $&#123;net_ip&#125;&quot;echo &quot;DNS: $&#123;DNS&#125;&quot;ip=`ifconfig | grep -A 1 &quot;en&quot; | grep broadcast | cut -d &quot; &quot; -f 2`netmask=`ifconfig | grep -A 1 &quot;en&quot; | grep broadcast | cut -d &quot; &quot; -f 4`Network=$(ipcalc -b $ip $netmask | grep Network | sed &#x27;s/ / /&#x27; | awk -F &#x27; &#x27; &#x27;&#123;print $2&#125;&#x27;)echo &quot;\\nIPè¯¦ç»†ä¿¡æ¯:&quot;ip-info $&#123;Network&#125; å°†åè¿›åˆ¶IPåœ°å€è½¬æ¢ä¸ºäºŒè¿›åˆ¶å½¢å¼ 12345678910111213141516#!/usr/bin/env zsh##################################################åŠŸèƒ½ï¼šå°†åè¿›åˆ¶IPåœ°å€è½¬æ¢ä¸ºäºŒè¿›åˆ¶å½¢å¼#filenameï¼šipTo2#æ‰§è¡Œæ–¹æ³•ï¼šipTo2 192.168.16.155#è¾“å‡ºç»“æœï¼š11000000.10101000.00010000.10011011################################################## æ£€æŸ¥æ˜¯å¦æä¾›äº†æ­£ç¡®æ•°é‡çš„å‚æ•°if [ &quot;$#&quot; -ne 1 ]; then echo &quot;ç”¨æ³•: ipTo2 192.168.16.155&quot; exit 1fiip=$1for i in $(echo $&#123;ip&#125; | tr &#x27;.&#x27; &#x27; &#x27;); do echo &quot;obase=2 ; $i&quot; | bc; done | awk &#x27;&#123;printf &quot;.%08d&quot;, $1&#125;&#x27; | cut -c2- å°†äºŒè¿›åˆ¶å½¢å¼è½¬æ¢ä¸ºåè¿›åˆ¶IPåœ°å€ 123456789101112131415#!/usr/bin/env zsh##################################################åŠŸèƒ½ï¼šå°†åè¿›åˆ¶IPåœ°å€è½¬æ¢ä¸ºäºŒè¿›åˆ¶å½¢å¼#filenameï¼š2Toip#æ‰§è¡Œæ–¹æ³•ï¼š2Toip 11111111.11111111.11100000.00000000#è¾“å‡ºç»“æœï¼š255.255.224.0################################################## æ£€æŸ¥æ˜¯å¦æä¾›äº†æ­£ç¡®æ•°é‡çš„å‚æ•°if [ &quot;$#&quot; -ne 1 ]; then echo &quot;ç”¨æ³•: 2Toip 11111111.11111111.11100000.00000000&quot; exit 1fiecho $1|awk -F. &#x27;function bin2dec(a,b,i,c)&#123;b=length(a);c=0;for(i=1;i&lt;=b;i++)&#123;c+=c;if(substr(a,i,1)==&quot;1&quot;)c++&#125;return c&#125;&#123;for(j=1;j&lt;=NF;j++)printf(&quot;%d%s&quot;,bin2dec($j),j!=NF?&quot;.&quot;:&quot;\\n&quot;)&#125;&#x27; å­—ç¬¦ä¸²è½¬asciiç  123456789101112131415161718192021222324#!/usr/bin/env zsh##################################################filenameï¼šstrtoascii#åŠŸèƒ½ï¼šå­—ç¬¦ä¸²è½¬asciiç #æ‰§è¡Œæ–¹æ³•ï¼šstrtoascii ä½ å¥½hello#è¾“å‡ºç»“æœï¼š\\u4f60\\u597d\\u68\\u65\\u6c\\u6c\\u6f################################################## æ£€æŸ¥æ˜¯å¦æä¾›äº†æ­£ç¡®æ•°é‡çš„å‚æ•°if [ &quot;$#&quot; -ne 1 ]; then echo &quot;ç”¨æ³•: strtoascii ä½ å¥½hello&quot; exit 1fistr=$1newstr=&quot;&quot;for ((i=0;$i&lt;$&#123;#str&#125;;i=$i+1));do text=&quot;$&#123;str:$i:1&#125;&quot; newtext=`printf &quot;%x&quot; &quot;&#x27;$text&quot;`; newstr=$newstr&quot;\\\\\\\\u&quot;$newtextdoneecho $newstr asciiç è½¬å­—ç¬¦ä¸² 12345678910111213141516171819202122232425#!/usr/bin/env zsh##################################################filenameï¼šasciitostr#åŠŸèƒ½ï¼š asciiç è½¬å­—ç¬¦ä¸²#æ‰§è¡Œæ–¹æ³•ï¼šasciitostr \\u4f60\\u597d\\u68\\u65\\u6c\\u6c\\u6f#è¾“å‡ºç»“æœï¼šä½ å¥½hello################################################## æ£€æŸ¥æ˜¯å¦æä¾›äº†æ­£ç¡®æ•°é‡çš„å‚æ•°if [ &quot;$#&quot; -ne 1 ]; then echo &quot;ç”¨æ³•: asciitostr \\u4f60\\u597d\\u68\\u65\\u6c\\u6c\\u6f&quot; exit 1fi# æ£€æŸ¥æ˜¯å¦åŒ…å«\\uï¼Œå¦‚æœä¸åŒ…å«ï¼Œæ·»åŠ åŒå¼•å·if [[ &quot;$1&quot; != *\\\\u* ]]; then input=$(echo -e $1 | sed &#x27;s/u/\\\\u/g&#x27;)else input=$1fi# å°†Unicodeè½¬ä¹‰åºåˆ—è§£æä¸ºä¸­æ–‡å­—ç¬¦result=$(echo -e $input | perl -pe &#x27;s/\\\\u([0-9a-fA-F]&#123;4&#125;)/chr(hex($1))/eg&#x27;)# è¾“å‡ºç»“æœecho &quot;$result&quot; è·å–javaæ–‡ä»¶çš„jdkç¼–è¯‘ç‰ˆæœ¬ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146#!/usr/bin/env zsh##################################################filenameï¼šjdk_version#åŠŸèƒ½ï¼šè·å–å¯¹åº”javaæ–‡ä»¶çš„jdkç¼–è¯‘ç‰ˆæœ¬# å¦‚æœæ˜¯jarï¼Œè¿™é‡Œåªä¼šæ£€ç´¢jaråŒ…ä¸­ç¬¬ä¸€ä¸ªclassçš„jdkç¼–è¯‘ç‰ˆæœ¬ï¼Œæ‰€ä»¥ä¹Ÿä¸ä¸€å®šå‡†ç¡®##æ‰§è¡Œæ–¹æ³•ï¼šjdk_version &lt;file_path:[.jar|.class|.war]&gt;# 1.jarç¤ºä¾‹ï¼š# jdk_version xxl-job-admin-2.3.0.jar# è¾“å‡ºï¼š# Build-Jdk: 1.8.0_271# file_path:[xxl-job-admin-2.3.0.jar] major_version:[52] jdk_version:[jdk1.8]# 2.classç¤ºä¾‹# jdk_version XxlJobAdminConfig.class# è¾“å‡ºï¼š# file_path:[XxlJobAdminConfig.class] major_version:[52] jdk_version:[jdk1.8]# 3.warç¤ºä¾‹# jdk_version wardir/BOSS.war# è¾“å‡ºï¼š# file_path:[wardir/BOSS.war] jdk_version:[1.7.0_67-b01 (Oracle Corporation)]################################################## å®šä¹‰å…³è”æ•°ç»„typeset -A my_map# å‘å…³è”æ•°ç»„ä¸­æ·»åŠ é”®å€¼å¯¹# LTS:# 8(2014å¹´åˆå‘å¸ƒï¼Œå…è´¹ç‰ˆæœ¬è‡³8u202ï¼Œä»8u211å¼€å§‹å•†ç”¨æ”¶è´¹ï¼Œæ”¯æŒåˆ°2030å¹´9æœˆ)# 11(2018å¹´9æœˆå‘å¸ƒï¼Œå…è´¹ç‰ˆæœ¬ç‰ˆæœ¬è‡³11.0.2ï¼Œåç»­ç‰ˆæœ¬å•†ç”¨æ”¶è´¹ï¼Œæ”¯æŒåˆ°2032å¹´9æœˆ)# 17(2021å¹´9æœˆå‘å¸ƒï¼Œå…è´¹ï¼Œæ”¯æŒåˆ°2029å¹´9æœˆ)# 21(2023å¹´9æœˆå‘å¸ƒï¼Œå…è´¹ï¼Œæ”¯æŒåˆ°2031å¹´9æœˆ)# 25(é¢„è®¡2025å¹´9æœˆå‘å¸ƒï¼Œæ”¯æŒåˆ°2033å¹´9æœˆ)# åç»­Oracleè®¡åˆ’æ¯åŠå¹´å‘å¸ƒä¸€ä¸ªæ–°çš„å¤§ç‰ˆæœ¬(3ã€9æœˆ)ï¼Œæ¯ä¸¤å¹´å‘å¸ƒä¸€æ¬¡LTS(9æœˆ)ï¼Œå»ºè®®æ­£å¼ç¯å¢ƒåªä½¿ç”¨LTSç‰ˆæœ¬# æ­¤å¤„å¯ä»¥æŸ¥çœ‹jdkå‘å¸ƒè®¡åˆ’ï¼šhttps://www.java.com/en/releases/matrix/# JDKä¸‹è½½åœ°å€ï¼šhttps://www.oracle.com/cn/java/technologies/downloads/my_map=( [45]=&quot;jdk1.1&quot; [46]=&quot;jdk1.2&quot; [47]=&quot;jdk1.3&quot; [48]=&quot;jdk1.4&quot; [49]=&quot;jdk1.5&quot; [50]=&quot;jdk1.6&quot; [51]=&quot;jdk1.7&quot; [52]=&quot;jdk1.8&quot; [53]=&quot;jdk9&quot; [54]=&quot;jdk10&quot; [55]=&quot;jdk11&quot; [56]=&quot;jdk12&quot; [57]=&quot;jdk13&quot; [58]=&quot;jdk14&quot; [59]=&quot;jdk15&quot; [60]=&quot;jdk16&quot; [61]=&quot;jdk17&quot; [62]=&quot;jdk18&quot; [63]=&quot;jdk19&quot; [64]=&quot;jdk20&quot; [65]=&quot;jdk21&quot; [66]=&quot;jdk22&quot; [67]=&quot;jdk23&quot; [68]=&quot;jdk24&quot; [69]=&quot;jdk25&quot;)# è·å–æ‰€æœ‰é”®å¹¶æ’åºsorted_keys=($&#123;(o)$&#123;(k)my_map&#125;&#125;)# echo $sorted_keysoriginal_string=&quot;\\tmajor_version\\tjdk_version&quot;# tr &#x27;[:lower:]&#x27; &#x27;[:upper:]&#x27; å°†å­—ç¬¦ä¸²ä¸­çš„å°å†™å­—æ¯è½¬æ¢ä¸ºå¤§å†™å­—æ¯ã€‚è¾“å‡ºç»“æœå°†æ˜¯ &quot;MAJOR_VERSION\\tJDK_VERSION&quot;uppercase_string=$(echo &quot;$original_string&quot; | tr &#x27;[:lower:]&#x27; &#x27;[:upper:]&#x27;)# æ‰“å°mapecho_map() &#123; echo &quot;$&#123;uppercase_string&#125;&quot; # æŒ‰æ’åºåçš„é”®è¾“å‡ºé”®å€¼å¯¹ for key in $sorted_keys; do echo &quot;\\t$key\\t\\t$&#123;my_map[$key]&#125;&quot; done&#125;error_message() &#123; echo &quot;Usage: jdk_version &lt;file_path:[.jar|.class|.war]&gt;&quot; echo_map exit 1&#125;# æ£€æŸ¥æ˜¯å¦ä¼ é€’äº†å‚æ•°if [ -z &quot;$1&quot; ]; then error_messagefifile_path=$1# æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨if [ ! -e &quot;$file_path&quot; ]; then echo &quot;æ–‡ä»¶ä¸å­˜åœ¨:file_path:[$&#123;file_path&#125;]&quot; error_messagefigreap_content=&quot;major version&quot;if [[ $file_path == *.class ]]; then # é€šè¿‡javapå‘½ä»¤è·å–classæ–‡ä»¶çš„è¯¦ç»†ä¿¡æ¯ï¼Œgrepè¿‡æ»¤å‡ºåŒ…å« â€œmajor versionâ€ çš„è¡Œï¼Œawkå–å‡ºå…¶ç‰ˆæœ¬å· key=$(javap -verbose $&#123;file_path&#125; | grep &quot;$&#123;greap_content&#125;&quot; | awk -F&#x27;: &#x27; &#x27;&#123;print $2&#125;&#x27;)elif [[ $file_path == *.jar ]]; then # å…ˆé€šè¿‡â€œjar tfâ€å‘½ä»¤è·å–jaråŒ…ä¸­çš„classæ–‡ä»¶ï¼Œè¿™é‡Œåªå–å‡ºç¬¬ä¸€ä¸ªï¼Œæ³¨æ„è¿™é‡Œclassè·¯å¾„å¿…é¡»å»æ‰â€œ.classâ€ï¼Œä¹‹åå†é€šè¿‡javapå‘½ä»¤è·å–â€œ-classpathâ€æ‰€æŒ‡å®šçš„jarä¸­çš„è¿™ä¸ªç¬¬ä¸€ä¸ªclassæ–‡ä»¶çš„è¯¦ç»†ä¿¡æ¯ï¼Œgrepè¿‡æ»¤å‡ºåŒ…å« â€œmajor versionâ€ çš„è¡Œï¼Œawkå–å‡ºå…¶ç‰ˆæœ¬å· key=$(javap -classpath $&#123;file_path&#125; -verbose $(jar tf $&#123;file_path&#125; | grep &quot;.class$&quot; | head -n 1 | sed s/.class//) | grep &quot;$&#123;greap_content&#125;&quot; | awk -F&#x27;: &#x27; &#x27;&#123;print $2&#125;&#x27;) # é€šè¿‡jaråŒ…ä¸­çš„MANIFEST.MFæ–‡ä»¶æ¥åˆ¤æ–­æ‰“åŒ…çš„jdkç‰ˆæœ¬ result=$(unzip -p $&#123;file_path&#125; $(jar tf $&#123;file_path&#125; | grep &quot;MANIFEST.MF$&quot; | head -n 1) | grep &quot;^Build-Jdk&quot;) if [ -z &quot;$result&quot; ]; then result=$(unzip -p $&#123;file_path&#125; $(jar tf $&#123;file_path&#125; | grep &quot;MANIFEST.MF$&quot; | head -n 1) | grep &quot;^Created-By&quot;) fi if [ -n &quot;$result&quot; ]; then echo $result else echo &quot;æ²¡æœ‰åœ¨ MANIFEST.MF ä¸­å‘ç°jdkç›¸å…³ä¿¡æ¯&quot; fielif [[ $file_path == *.war ]]; then # æŸ¥æ‰¾ Build-Jdk jdk_version=$(unzip -p &quot;$&#123;file_path&#125;&quot; META-INF/MANIFEST.MF | grep -i &quot;^Build-Jdk&quot; | awk -F&#x27;: &#x27; &#x27;&#123;print $2&#125;&#x27;) # å¦‚æœ Build-Jdk æœªæ‰¾åˆ°ï¼Œåˆ™å°è¯•æŸ¥æ‰¾ Created-By if [ -z &quot;$jdk_version&quot; ]; then jdk_version=$(unzip -p &quot;$&#123;file_path&#125;&quot; META-INF/MANIFEST.MF | grep -i &quot;^Created-By&quot; | awk -F&#x27;: &#x27; &#x27;&#123;print $2&#125;&#x27;) fielse error_messagefi# æ‰“å°ç»“æœ# è¾“å‡º JDK ç‰ˆæœ¬ä¿¡æ¯if [ -n &quot;$key&quot; ]; then echo &quot;file_path:[$&#123;file_path&#125;]\\tmajor_version:[$key]\\tjdk_version:[$&#123;my_map[$key]&#125;]&quot;elif [ -n &quot;$jdk_version&quot; ]; then # jdk_versionå«æœ‰ç‰¹æ®Šå­—ç¬¦ï¼Œé€šè¿‡å¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹åŒ…å«å“ªäº›ç‰¹æ®Šå­—ç¬¦ï¼Œç»“æœå‘ç°åŒ…å«\\r\\n # echo &quot;$&#123;jdk_version&#125;&quot; | od -c # å»æ‰ç‰¹æ®Šå­—ç¬¦ \\r\\n jdk_version_cleaned=$(echo &quot;$&#123;jdk_version&#125;&quot; | tr -d &#x27;\\r\\n&#x27;) echo &quot;file_path:[$&#123;file_path&#125;]\\t\\tjdk_version:[$&#123;jdk_version_cleaned&#125;]&quot;else echo &quot;JDK Version information not found&quot;fi","summary":"æ‘˜è¦ è¿™é‡Œåˆ—ä¸¾ä¸€äº›macosä¸‹ä¸€äº›æœ‰ç”¨çš„shellè„šæœ¬ ä¸æœ¬æ–‡è„šæœ¬å¯¹åº”çš„centosè„šæœ¬å¯ä»¥å‚çœ‹centos-shell","date_published":"2024-02-23T13:55:05.000Z","tags":["æŠ€æœ¯","macos","macos"]},{"id":"https://blog.hanqunfeng.com/2024/01/26/aws-s3-java/","url":"https://blog.hanqunfeng.com/2024/01/26/aws-s3-java/","title":"S3--AWS SDK for Java","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç»å¦‚ä½•ä½¿ç”¨AWS SDK for Java V2æ“ä½œS3ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å‚è€ƒèµ„æ–™ï¼š</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-6\"><a href=\"https://docs.aws.amazon.com/zh_cn/sdk-for-java/\">AWS SDK for Java æ–‡æ¡£</a></li>\n<li class=\"lvl-6\"><a href=\"https://docs.aws.amazon.com/zh_cn/AmazonS3/latest/userguide/service_code_examples.html\">é€‚ç”¨äºä½¿ç”¨ AWS è½¯ä»¶å¼€å‘å·¥å…·åŒ…çš„ Amazon S3 çš„ä»£ç ç¤ºä¾‹</a></li>\n</ul>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"ç¤ºä¾‹ä»£ç \">ç¤ºä¾‹ä»£ç </h2>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.hanqf.controller;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.hanqf.utils.AmazonS3V2Util;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.hanqf.utils.MyIOUtil;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.hanqf.utils.S3ClientFactory;</span><br><span class=\"line\"><span class=\"keyword\">import</span> jakarta.servlet.ServletOutputStream;</span><br><span class=\"line\"><span class=\"keyword\">import</span> jakarta.servlet.http.HttpServletRequest;</span><br><span class=\"line\"><span class=\"keyword\">import</span> jakarta.servlet.http.HttpServletResponse;</span><br><span class=\"line\"><span class=\"keyword\">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.util.StringUtils;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.*;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.multipart.MultipartFile;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.File;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.IOException;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.InputStream;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.nio.file.Files;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Slf4j</span></span><br><span class=\"line\"><span class=\"meta\">@RestController</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">DemoController</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * æ–‡ä»¶ä¸‹è½½ï¼Œæ”¯æŒæ–­ç‚¹ç»­ä¼ ï¼Œæ”¯æŒåˆ†æ®µä¸‹è½½</span></span><br><span class=\"line\"><span class=\"comment\">     * åˆ†æ®µä¸‹è½½çš„å¥½å¤„å°±æ˜¯å¯ä»¥è¿›è¡Œå¤šçº¿ç¨‹ä¸‹è½½ï¼Œæé«˜ä¸‹è½½é€Ÿåº¦ï¼Œä¸‹è½½å®Œæˆåå†å°†æ‰€æœ‰çš„åˆ†æ®µæ–‡ä»¶è¿›è¡Œåˆå¹¶æˆä¸€ä¸ªå®Œæ•´çš„æ–‡ä»¶</span></span><br><span class=\"line\"><span class=\"comment\">     * &lt;p&gt;</span></span><br><span class=\"line\"><span class=\"comment\">     * å¯ä»¥å…ˆä¸‹è½½ä¸€ä¸ªå­—èŠ‚çš„æ•°æ®ï¼Œæ­¤æ—¶å¯ä»¥è·å–æ–‡ä»¶æ€»çš„å­—èŠ‚æ•°ï¼Œç„¶ååŸºäºè¿™ä¸ªæ€»å­—èŠ‚æ•°å†³å®šåˆ†æ®µå¤§å°</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@GetMapping(&quot;/file-down-range&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">fileDownRange</span><span class=\"params\">(HttpServletRequest request, HttpServletResponse response)</span> <span class=\"keyword\">throws</span> IOException &#123;</span><br><span class=\"line\">        <span class=\"comment\">// æœåŠ¡å™¨ä¸Šçš„æ–‡ä»¶è·¯å¾„ï¼Œè¿™é‡Œåªæ˜¯ä¸ºäº†æ¼”ç¤ºæ–¹ä¾¿ï¼Œå®é™…ä½¿ç”¨æ—¶ï¼Œéœ€è¦æ ¹æ®æ–‡ä»¶çš„å®é™…å­˜å‚¨æ–¹å¼è¿›è¡Œå¤„ç†</span></span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">localFileName</span> <span class=\"operator\">=</span> request.getParameter(<span class=\"string\">&quot;fileName&quot;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!StringUtils.hasText(localFileName)) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">RuntimeException</span>(<span class=\"string\">&quot;æ²¡æœ‰ä¸Šä¼ fileNameï¼&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">File</span> <span class=\"variable\">file</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">File</span>(localFileName);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!file.exists()) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">RuntimeException</span>(localFileName + <span class=\"string\">&quot;:æ–‡ä»¶ä¸å­˜åœ¨ï¼&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">final</span> <span class=\"type\">long</span> <span class=\"variable\">contentLength</span> <span class=\"operator\">=</span> file.length();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">range</span> <span class=\"operator\">=</span> request.getHeader(<span class=\"string\">&quot;Range&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">start</span> <span class=\"operator\">=</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">end</span> <span class=\"operator\">=</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (StringUtils.hasText(range) &amp;&amp; (range.contains(<span class=\"string\">&quot;bytes=&quot;</span>) &amp;&amp; range.contains(<span class=\"string\">&quot;-&quot;</span>))) &#123;</span><br><span class=\"line\">            start = org.apache.commons.lang.StringUtils.substringBetween(range, <span class=\"string\">&quot;bytes=&quot;</span>, <span class=\"string\">&quot;-&quot;</span>);</span><br><span class=\"line\">            end = org.apache.commons.lang.StringUtils.substringAfter(range, <span class=\"string\">&quot;-&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">long</span> <span class=\"variable\">startIndex</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"type\">long</span> <span class=\"variable\">endIndex</span> <span class=\"operator\">=</span> contentLength - <span class=\"number\">1</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (StringUtils.hasText(start)) &#123;</span><br><span class=\"line\">            startIndex = Long.parseLong(start);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (StringUtils.hasText(end)) &#123;</span><br><span class=\"line\">            endIndex = Long.parseLong(end);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        log.info(<span class=\"string\">&quot;range:&quot;</span> + startIndex + <span class=\"string\">&quot;~&quot;</span> + endIndex);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">fileName</span> <span class=\"operator\">=</span> localFileName;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (localFileName.contains(<span class=\"string\">&quot;/&quot;</span>)) &#123;</span><br><span class=\"line\">            fileName = localFileName.substring(localFileName.lastIndexOf(<span class=\"string\">&quot;/&quot;</span>) + <span class=\"number\">1</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (StringUtils.hasText(start)) &#123;</span><br><span class=\"line\">            fileName = fileName + <span class=\"string\">&quot;.&quot;</span> + startIndex + <span class=\"string\">&quot;-&quot;</span> + endIndex;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"type\">long</span> <span class=\"variable\">length</span> <span class=\"operator\">=</span> endIndex - startIndex + <span class=\"number\">1</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        response.setContentType(<span class=\"string\">&quot;application/octet-stream&quot;</span>);</span><br><span class=\"line\">        response.setHeader(<span class=\"string\">&quot;Accept-Ranges&quot;</span>, <span class=\"string\">&quot;bytes&quot;</span>);</span><br><span class=\"line\">        response.setHeader(<span class=\"string\">&quot;Content-Range&quot;</span>, <span class=\"string\">&quot;bytes &quot;</span> + startIndex + <span class=\"string\">&quot;-&quot;</span> + endIndex + <span class=\"string\">&quot;/&quot;</span> + contentLength);</span><br><span class=\"line\">        response.setHeader(<span class=\"string\">&quot;Content-Length&quot;</span>, length + <span class=\"string\">&quot;&quot;</span>);</span><br><span class=\"line\">        response.addHeader(<span class=\"string\">&quot;Content-Disposition&quot;</span>, <span class=\"string\">&quot;attachment;filename=&quot;</span> + fileName);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// è¯»å–æ–‡ä»¶æµ</span></span><br><span class=\"line\">        <span class=\"keyword\">try</span> (<span class=\"type\">ServletOutputStream</span> <span class=\"variable\">outputStream</span> <span class=\"operator\">=</span> response.getOutputStream(); <span class=\"type\">InputStream</span> <span class=\"variable\">inputStream</span> <span class=\"operator\">=</span> Files.newInputStream(file.toPath())) &#123;</span><br><span class=\"line\">            MyIOUtil.copyDataFromInputStreamToOutputStream(inputStream, startIndex, length, outputStream, <span class=\"literal\">true</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * S3æ–‡ä»¶ä¸‹è½½ï¼Œåˆ†æ®µä¸‹è½½</span></span><br><span class=\"line\"><span class=\"comment\">     * num åˆ†æ®µå·ï¼Œä»1å¼€å§‹</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@GetMapping(&quot;/s3-down/&#123;num&#125;&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">s3Down</span><span class=\"params\">(<span class=\"meta\">@PathVariable</span> <span class=\"type\">int</span> num, HttpServletRequest request, HttpServletResponse response)</span> <span class=\"keyword\">throws</span> IOException &#123;</span><br><span class=\"line\">        <span class=\"comment\">// åˆ†æ®µä¸‹è½½æµ‹è¯•</span></span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">remoteFileName</span> <span class=\"operator\">=</span> request.getParameter(<span class=\"string\">&quot;fileName&quot;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!StringUtils.hasText(remoteFileName)) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">RuntimeException</span>(remoteFileName + <span class=\"string\">&quot;:æ–‡ä»¶ä¸å­˜åœ¨ï¼&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">fileName</span> <span class=\"operator\">=</span> remoteFileName;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (remoteFileName.contains(<span class=\"string\">&quot;/&quot;</span>)) &#123;</span><br><span class=\"line\">            fileName = remoteFileName.substring(remoteFileName.lastIndexOf(<span class=\"string\">&quot;/&quot;</span>) + <span class=\"number\">1</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        fileName = fileName + <span class=\"string\">&quot;.&quot;</span> + num;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">final</span> <span class=\"type\">long</span> <span class=\"variable\">contentLength</span> <span class=\"operator\">=</span> AmazonS3V2Util.getObjectInfo(S3ClientFactory.BUCKET_NAME, remoteFileName).contentLength();</span><br><span class=\"line\">        <span class=\"keyword\">final</span> java.util.List&lt;Long&gt; positions = AmazonS3V2Util.positions(contentLength);</span><br><span class=\"line\">        positions.add(contentLength);</span><br><span class=\"line\">        <span class=\"type\">long</span> <span class=\"variable\">start</span> <span class=\"operator\">=</span> positions.get(num - <span class=\"number\">1</span>);</span><br><span class=\"line\">        <span class=\"type\">long</span> <span class=\"variable\">end</span> <span class=\"operator\">=</span> positions.get(num) - <span class=\"number\">1</span>;</span><br><span class=\"line\">        log.info(<span class=\"string\">&quot;range:&quot;</span> + start + <span class=\"string\">&quot;~&quot;</span> + end);</span><br><span class=\"line\"></span><br><span class=\"line\">        response.setContentType(<span class=\"string\">&quot;application/octet-stream&quot;</span>);</span><br><span class=\"line\">        response.setHeader(<span class=\"string\">&quot;Accept-Ranges&quot;</span>, <span class=\"string\">&quot;bytes&quot;</span>);</span><br><span class=\"line\">        response.setHeader(<span class=\"string\">&quot;Content-Range&quot;</span>, <span class=\"string\">&quot;bytes &quot;</span> + start + <span class=\"string\">&quot;-&quot;</span> + end + <span class=\"string\">&quot;/&quot;</span> + contentLength);</span><br><span class=\"line\">        response.setHeader(<span class=\"string\">&quot;Content-Length&quot;</span>, (end - start + <span class=\"number\">1</span>) + <span class=\"string\">&quot;&quot;</span>);</span><br><span class=\"line\">        response.addHeader(<span class=\"string\">&quot;Content-Disposition&quot;</span>, <span class=\"string\">&quot;attachment;filename=&quot;</span> + fileName);</span><br><span class=\"line\">        <span class=\"type\">ServletOutputStream</span> <span class=\"variable\">outputStream</span> <span class=\"operator\">=</span> response.getOutputStream();</span><br><span class=\"line\">        AmazonS3V2Util.downloadSubsectionAndCloseOutputStream(S3ClientFactory.BUCKET_NAME, remoteFileName, start, end, outputStream);</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * S3æ–‡ä»¶ä¸‹è½½ï¼Œæ”¯æŒæ–­ç‚¹ç»­ä¼ ï¼Œæ”¯æŒåˆ†æ®µä¸‹è½½</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@GetMapping(&quot;/s3-down-range&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">s3DownRange</span><span class=\"params\">(HttpServletRequest request, HttpServletResponse response)</span> <span class=\"keyword\">throws</span> IOException &#123;</span><br><span class=\"line\">        <span class=\"comment\">// åˆ†æ®µä¸‹è½½æµ‹è¯•</span></span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">remoteFileName</span> <span class=\"operator\">=</span> request.getParameter(<span class=\"string\">&quot;fileName&quot;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!StringUtils.hasText(remoteFileName)) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">RuntimeException</span>(remoteFileName + <span class=\"string\">&quot;:æ–‡ä»¶ä¸å­˜åœ¨ï¼&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">final</span> <span class=\"type\">long</span> <span class=\"variable\">contentLength</span> <span class=\"operator\">=</span> AmazonS3V2Util.getObjectInfo(S3ClientFactory.BUCKET_NAME, remoteFileName).contentLength();</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">range</span> <span class=\"operator\">=</span> request.getHeader(<span class=\"string\">&quot;Range&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">start</span> <span class=\"operator\">=</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">end</span> <span class=\"operator\">=</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (StringUtils.hasText(range) &amp;&amp; (range.contains(<span class=\"string\">&quot;bytes=&quot;</span>) &amp;&amp; range.contains(<span class=\"string\">&quot;-&quot;</span>))) &#123;</span><br><span class=\"line\">            start = org.apache.commons.lang.StringUtils.substringBetween(range, <span class=\"string\">&quot;bytes=&quot;</span>, <span class=\"string\">&quot;-&quot;</span>);</span><br><span class=\"line\">            end = org.apache.commons.lang.StringUtils.substringAfter(range, <span class=\"string\">&quot;-&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">long</span> <span class=\"variable\">startIndex</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"type\">long</span> <span class=\"variable\">endIndex</span> <span class=\"operator\">=</span> contentLength - <span class=\"number\">1</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (StringUtils.hasText(start)) &#123;</span><br><span class=\"line\">            startIndex = Long.parseLong(start);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (StringUtils.hasText(end)) &#123;</span><br><span class=\"line\">            endIndex = Long.parseLong(end);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        log.info(<span class=\"string\">&quot;range:&quot;</span> + startIndex + <span class=\"string\">&quot;~&quot;</span> + endIndex);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">fileName</span> <span class=\"operator\">=</span> remoteFileName;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (remoteFileName.contains(<span class=\"string\">&quot;/&quot;</span>)) &#123;</span><br><span class=\"line\">            fileName = remoteFileName.substring(remoteFileName.lastIndexOf(<span class=\"string\">&quot;/&quot;</span>) + <span class=\"number\">1</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (StringUtils.hasText(start)) &#123;</span><br><span class=\"line\">            fileName = fileName + <span class=\"string\">&quot;.&quot;</span> + startIndex + <span class=\"string\">&quot;-&quot;</span> + endIndex;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        response.setContentType(<span class=\"string\">&quot;application/octet-stream&quot;</span>);</span><br><span class=\"line\">        response.setHeader(<span class=\"string\">&quot;Accept-Ranges&quot;</span>, <span class=\"string\">&quot;bytes&quot;</span>);</span><br><span class=\"line\">        response.setHeader(<span class=\"string\">&quot;Content-Range&quot;</span>, <span class=\"string\">&quot;bytes &quot;</span> + startIndex + <span class=\"string\">&quot;-&quot;</span> + endIndex + <span class=\"string\">&quot;/&quot;</span> + contentLength);</span><br><span class=\"line\">        response.setHeader(<span class=\"string\">&quot;Content-Length&quot;</span>, (endIndex - startIndex + <span class=\"number\">1</span>) + <span class=\"string\">&quot;&quot;</span>);</span><br><span class=\"line\">        response.addHeader(<span class=\"string\">&quot;Content-Disposition&quot;</span>, <span class=\"string\">&quot;attachment;filename=&quot;</span> + fileName);</span><br><span class=\"line\">        <span class=\"type\">ServletOutputStream</span> <span class=\"variable\">outputStream</span> <span class=\"operator\">=</span> response.getOutputStream();</span><br><span class=\"line\">        AmazonS3V2Util.downloadSubsectionAndCloseOutputStream(S3ClientFactory.BUCKET_NAME, remoteFileName, startIndex, endIndex, outputStream);</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * ä¸Šä¼ æ–‡ä»¶åˆ°S3ï¼Œæ”¯æŒåˆ†æ®µä¸Šä¼ </span></span><br><span class=\"line\"><span class=\"comment\">    */</span></span><br><span class=\"line\">    <span class=\"meta\">@PostMapping(&quot;/uploadToS3&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">uploadFileToS3</span><span class=\"params\">(MultipartFile file, String remoteFileName)</span> <span class=\"keyword\">throws</span> IOException &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (file != <span class=\"literal\">null</span> &amp;&amp; StringUtils.hasText(remoteFileName)) &#123;</span><br><span class=\"line\">            log.info(<span class=\"string\">&quot;ä¸Šä¼ æ–‡ä»¶åˆ°S3ï¼š&quot;</span> + remoteFileName);</span><br><span class=\"line\">            AmazonS3V2Util.multipartUpload(S3ClientFactory.BUCKET_NAME, remoteFileName, file.getBytes(), <span class=\"literal\">true</span>);</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"string\">&quot;ä¸Šä¼ æˆåŠŸ&quot;</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&quot;ä¸Šä¼ å¤±è´¥&quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"æºç åœ°å€\">æºç åœ°å€</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>V2ç‰ˆæœ¬ï¼š<a href=\"https://github.com/hanqunfeng/springbootchapter/tree/master/springboot3-demo/aws-s3-v2\">https://github.com/hanqunfeng/springbootchapter/tree/master/springboot3-demo/aws-s3-v2</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>V1ç‰ˆæœ¬ï¼š<a href=\"https://github.com/hanqunfeng/springbootchapter/blob/master/springboot3-demo/resumed-transfer-offset/src/main/java/com/hanqf/resumedtransferoffset/utils/AmazonS3Util.java\">https://github.com/hanqunfeng/springbootchapter/blob/master/springboot3-demo/resumed-transfer-offset/src/main/java/com/hanqf/resumedtransferoffset/utils/AmazonS3Util.java</a></p>\n</li>\n</ul>\n","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç»å¦‚ä½•ä½¿ç”¨AWS SDK for Java V2æ“ä½œS3ã€‚ å‚è€ƒèµ„æ–™ï¼š AWS SDK for Java æ–‡æ¡£ é€‚ç”¨äºä½¿ç”¨ AWS è½¯ä»¶å¼€å‘å·¥å…·åŒ…çš„ Amazon S3 çš„ä»£ç ç¤ºä¾‹ ç¤ºä¾‹ä»£ç  123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186package com.hanqf.controller;import com.hanqf.utils.AmazonS3V2Util;import com.hanqf.utils.MyIOUtil;import com.hanqf.utils.S3ClientFactory;import jakarta.servlet.ServletOutputStream;import jakarta.servlet.http.HttpServletRequest;import jakarta.servlet.http.HttpServletResponse;import lombok.extern.slf4j.Slf4j;import org.springframework.util.StringUtils;import org.springframework.web.bind.annotation.*;import org.springframework.web.multipart.MultipartFile;import java.io.File;import java.io.IOException;import java.io.InputStream;import java.nio.file.Files;@Slf4j@RestControllerpublic class DemoController &#123; /** * æ–‡ä»¶ä¸‹è½½ï¼Œæ”¯æŒæ–­ç‚¹ç»­ä¼ ï¼Œæ”¯æŒåˆ†æ®µä¸‹è½½ * åˆ†æ®µä¸‹è½½çš„å¥½å¤„å°±æ˜¯å¯ä»¥è¿›è¡Œå¤šçº¿ç¨‹ä¸‹è½½ï¼Œæé«˜ä¸‹è½½é€Ÿåº¦ï¼Œä¸‹è½½å®Œæˆåå†å°†æ‰€æœ‰çš„åˆ†æ®µæ–‡ä»¶è¿›è¡Œåˆå¹¶æˆä¸€ä¸ªå®Œæ•´çš„æ–‡ä»¶ * &lt;p&gt; * å¯ä»¥å…ˆä¸‹è½½ä¸€ä¸ªå­—èŠ‚çš„æ•°æ®ï¼Œæ­¤æ—¶å¯ä»¥è·å–æ–‡ä»¶æ€»çš„å­—èŠ‚æ•°ï¼Œç„¶ååŸºäºè¿™ä¸ªæ€»å­—èŠ‚æ•°å†³å®šåˆ†æ®µå¤§å° */ @GetMapping(&quot;/file-down-range&quot;) public void fileDownRange(HttpServletRequest request, HttpServletResponse response) throws IOException &#123; // æœåŠ¡å™¨ä¸Šçš„æ–‡ä»¶è·¯å¾„ï¼Œè¿™é‡Œåªæ˜¯ä¸ºäº†æ¼”ç¤ºæ–¹ä¾¿ï¼Œå®é™…ä½¿ç”¨æ—¶ï¼Œéœ€è¦æ ¹æ®æ–‡ä»¶çš„å®é™…å­˜å‚¨æ–¹å¼è¿›è¡Œå¤„ç† String localFileName = request.getParameter(&quot;fileName&quot;); if (!StringUtils.hasText(localFileName)) &#123; throw new RuntimeException(&quot;æ²¡æœ‰ä¸Šä¼ fileNameï¼&quot;); &#125; File file = new File(localFileName); if (!file.exists()) &#123; throw new RuntimeException(localFileName + &quot;:æ–‡ä»¶ä¸å­˜åœ¨ï¼&quot;); &#125; final long contentLength = file.length(); String range = request.getHeader(&quot;Range&quot;); String start = null; String end = null; if (StringUtils.hasText(range) &amp;&amp; (range.contains(&quot;bytes=&quot;) &amp;&amp; range.contains(&quot;-&quot;))) &#123; start = org.apache.commons.lang.StringUtils.substringBetween(range, &quot;bytes=&quot;, &quot;-&quot;); end = org.apache.commons.lang.StringUtils.substringAfter(range, &quot;-&quot;); &#125; long startIndex = 0; long endIndex = contentLength - 1; if (StringUtils.hasText(start)) &#123; startIndex = Long.parseLong(start); &#125; if (StringUtils.hasText(end)) &#123; endIndex = Long.parseLong(end); &#125; log.info(&quot;range:&quot; + startIndex + &quot;~&quot; + endIndex); String fileName = localFileName; if (localFileName.contains(&quot;/&quot;)) &#123; fileName = localFileName.substring(localFileName.lastIndexOf(&quot;/&quot;) + 1); &#125; if (StringUtils.hasText(start)) &#123; fileName = fileName + &quot;.&quot; + startIndex + &quot;-&quot; + endIndex; &#125; long length = endIndex - startIndex + 1; response.setContentType(&quot;application/octet-stream&quot;); response.setHeader(&quot;Accept-Ranges&quot;, &quot;bytes&quot;); response.setHeader(&quot;Content-Range&quot;, &quot;bytes &quot; + startIndex + &quot;-&quot; + endIndex + &quot;/&quot; + contentLength); response.setHeader(&quot;Content-Length&quot;, length + &quot;&quot;); response.addHeader(&quot;Content-Disposition&quot;, &quot;attachment;filename=&quot; + fileName); // è¯»å–æ–‡ä»¶æµ try (ServletOutputStream outputStream = response.getOutputStream(); InputStream inputStream = Files.newInputStream(file.toPath())) &#123; MyIOUtil.copyDataFromInputStreamToOutputStream(inputStream, startIndex, length, outputStream, true); &#125; &#125; /** * S3æ–‡ä»¶ä¸‹è½½ï¼Œåˆ†æ®µä¸‹è½½ * num åˆ†æ®µå·ï¼Œä»1å¼€å§‹ */ @GetMapping(&quot;/s3-down/&#123;num&#125;&quot;) public void s3Down(@PathVariable int num, HttpServletRequest request, HttpServletResponse response) throws IOException &#123; // åˆ†æ®µä¸‹è½½æµ‹è¯• String remoteFileName = request.getParameter(&quot;fileName&quot;); if (!StringUtils.hasText(remoteFileName)) &#123; throw new RuntimeException(remoteFileName + &quot;:æ–‡ä»¶ä¸å­˜åœ¨ï¼&quot;); &#125; String fileName = remoteFileName; if (remoteFileName.contains(&quot;/&quot;)) &#123; fileName = remoteFileName.substring(remoteFileName.lastIndexOf(&quot;/&quot;) + 1); &#125; fileName = fileName + &quot;.&quot; + num; final long contentLength = AmazonS3V2Util.getObjectInfo(S3ClientFactory.BUCKET_NAME, remoteFileName).contentLength(); final java.util.List&lt;Long&gt; positions = AmazonS3V2Util.positions(contentLength); positions.add(contentLength); long start = positions.get(num - 1); long end = positions.get(num) - 1; log.info(&quot;range:&quot; + start + &quot;~&quot; + end); response.setContentType(&quot;application/octet-stream&quot;); response.setHeader(&quot;Accept-Ranges&quot;, &quot;bytes&quot;); response.setHeader(&quot;Content-Range&quot;, &quot;bytes &quot; + start + &quot;-&quot; + end + &quot;/&quot; + contentLength); response.setHeader(&quot;Content-Length&quot;, (end - start + 1) + &quot;&quot;); response.addHeader(&quot;Content-Disposition&quot;, &quot;attachment;filename=&quot; + fileName); ServletOutputStream outputStream = response.getOutputStream(); AmazonS3V2Util.downloadSubsectionAndCloseOutputStream(S3ClientFactory.BUCKET_NAME, remoteFileName, start, end, outputStream); &#125; /** * S3æ–‡ä»¶ä¸‹è½½ï¼Œæ”¯æŒæ–­ç‚¹ç»­ä¼ ï¼Œæ”¯æŒåˆ†æ®µä¸‹è½½ */ @GetMapping(&quot;/s3-down-range&quot;) public void s3DownRange(HttpServletRequest request, HttpServletResponse response) throws IOException &#123; // åˆ†æ®µä¸‹è½½æµ‹è¯• String remoteFileName = request.getParameter(&quot;fileName&quot;); if (!StringUtils.hasText(remoteFileName)) &#123; throw new RuntimeException(remoteFileName + &quot;:æ–‡ä»¶ä¸å­˜åœ¨ï¼&quot;); &#125; final long contentLength = AmazonS3V2Util.getObjectInfo(S3ClientFactory.BUCKET_NAME, remoteFileName).contentLength(); String range = request.getHeader(&quot;Range&quot;); String start = null; String end = null; if (StringUtils.hasText(range) &amp;&amp; (range.contains(&quot;bytes=&quot;) &amp;&amp; range.contains(&quot;-&quot;))) &#123; start = org.apache.commons.lang.StringUtils.substringBetween(range, &quot;bytes=&quot;, &quot;-&quot;); end = org.apache.commons.lang.StringUtils.substringAfter(range, &quot;-&quot;); &#125; long startIndex = 0; long endIndex = contentLength - 1; if (StringUtils.hasText(start)) &#123; startIndex = Long.parseLong(start); &#125; if (StringUtils.hasText(end)) &#123; endIndex = Long.parseLong(end); &#125; log.info(&quot;range:&quot; + startIndex + &quot;~&quot; + endIndex); String fileName = remoteFileName; if (remoteFileName.contains(&quot;/&quot;)) &#123; fileName = remoteFileName.substring(remoteFileName.lastIndexOf(&quot;/&quot;) + 1); &#125; if (StringUtils.hasText(start)) &#123; fileName = fileName + &quot;.&quot; + startIndex + &quot;-&quot; + endIndex; &#125; response.setContentType(&quot;application/octet-stream&quot;); response.setHeader(&quot;Accept-Ranges&quot;, &quot;bytes&quot;); response.setHeader(&quot;Content-Range&quot;, &quot;bytes &quot; + startIndex + &quot;-&quot; + endIndex + &quot;/&quot; + contentLength); response.setHeader(&quot;Content-Length&quot;, (endIndex - startIndex + 1) + &quot;&quot;); response.addHeader(&quot;Content-Disposition&quot;, &quot;attachment;filename=&quot; + fileName); ServletOutputStream outputStream = response.getOutputStream(); AmazonS3V2Util.downloadSubsectionAndCloseOutputStream(S3ClientFactory.BUCKET_NAME, remoteFileName, startIndex, endIndex, outputStream); &#125; /** * ä¸Šä¼ æ–‡ä»¶åˆ°S3ï¼Œæ”¯æŒåˆ†æ®µä¸Šä¼  */ @PostMapping(&quot;/uploadToS3&quot;) public String uploadFileToS3(MultipartFile file, String remoteFileName) throws IOException &#123; if (file != null &amp;&amp; StringUtils.hasText(remoteFileName)) &#123; log.info(&quot;ä¸Šä¼ æ–‡ä»¶åˆ°S3ï¼š&quot; + remoteFileName); AmazonS3V2Util.multipartUpload(S3ClientFactory.BUCKET_NAME, remoteFileName, file.getBytes(), true); return &quot;ä¸Šä¼ æˆåŠŸ&quot;; &#125; return &quot;ä¸Šä¼ å¤±è´¥&quot;; &#125;&#125; æºç åœ°å€ V2ç‰ˆæœ¬ï¼šhttps://github.com/hanqunfeng/springbootchapter/tree/master/springboot3-demo/aws-s3-v2 V1ç‰ˆæœ¬ï¼šhttps://github.com/hanqunfeng/springbootchapter/blob/master/springboot3-demo/resumed-transfer-offset/src/main/java/com/hanqf/resumedtransferoffset/utils/AmazonS3Util.java","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç»å¦‚ä½•ä½¿ç”¨AWS SDK for Java V2æ“ä½œS3ã€‚ å‚è€ƒèµ„æ–™ï¼š AWS SDK for Java æ–‡æ¡£ é€‚ç”¨äºä½¿ç”¨ AWS è½¯ä»¶å¼€å‘å·¥å…·åŒ…çš„ Amazon S3 çš„ä»£ç ç¤ºä¾‹","date_published":"2024-01-26T14:30:05.000Z","tags":["æŠ€æœ¯","aws","s3","s3"]}]}