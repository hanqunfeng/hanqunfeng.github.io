{"version":"https://jsonfeed.org/version/1","name":"é£˜é€¸å³°çš„åšå®¢","home_page_url":"https://blog.hanqunfeng.com","feed_url":"https://blog.hanqunfeng.com/feed.json","author":{"name":"é£˜é€¸å³°"},"items":[{"id":"https://blog.hanqunfeng.com/2025/07/25/k8s-ui-rancher/","url":"https://blog.hanqunfeng.com/2025/07/25/k8s-ui-rancher/","title":"K8S UI ä¹‹ Rancher","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç» K8S çš„ UI ç®¡ç†å·¥å…· Rancher ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://kubernetes.io/zh-cn/\">K8Så®˜ç½‘</a></p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://github.com/kubernetes/kubernetes\">k8s Github</a></p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://ranchermanager.docs.rancher.com/zh/\">Rancher å®˜ç½‘</a></p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://github.com/rancher/rancher\">Rancher Github</a></p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"Rancher-ç®€ä»‹\">Rancher ç®€ä»‹</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Rancher æ˜¯ä¸€ä¸ª å¼€æºçš„ Kubernetes ç®¡ç†å¹³å°ï¼Œç”¨äºå¸®åŠ©ç”¨æˆ·éƒ¨ç½²ã€ç®¡ç†å’Œè¿ç»´å¤šä¸ª Kubernetes é›†ç¾¤ï¼Œå…·æœ‰æ˜“ç”¨çš„ Web UIã€æƒé™æ§åˆ¶ã€é›†ç¾¤ç›‘æ§ã€åº”ç”¨ç®¡ç†ç­‰åŠŸèƒ½ï¼Œå¹¿æ³›åº”ç”¨äºä¼ä¸šçš„äº‘åŸç”Ÿå¹³å°å»ºè®¾ä¸­ã€‚</p>\n</li>\n</ul>\n<h2 id=\"éƒ¨ç½²-Rancher\">éƒ¨ç½² Rancher</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><a href=\"https://ranchermanager.docs.rancher.com/zh/getting-started/quick-start-guides/deploy-rancher-manager/helm-cli#%E4%BD%BF%E7%94%A8-helm-%E6%9D%A5%E5%AE%89%E8%A3%85-rancher\">ä½¿ç”¨ Helm å®‰è£… Rancher</a></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æ·»åŠ  rancher çš„ Helm ä»“åº“</span></span><br><span class=\"line\">helm repo add rancher-latest https://releases.rancher.com/server-charts/latest</span><br><span class=\"line\"><span class=\"comment\"># æ›´æ–° rancher çš„ Helm ä»“åº“</span></span><br><span class=\"line\">helm repo update</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹ rancher çš„ç‰ˆæœ¬</span></span><br><span class=\"line\">$ helm search repo rancher -l | <span class=\"built_in\">head</span></span><br><span class=\"line\">NAME                  \tCHART VERSION\tAPP VERSION\tDESCRIPTION</span><br><span class=\"line\">rancher-latest/rancher\t2.11.3       \tv2.11.3    \tInstall Rancher Server to manage Kubernetes clu...</span><br><span class=\"line\">rancher-latest/rancher\t2.11.2       \tv2.11.2    \tInstall Rancher Server to manage Kubernetes clu...</span><br><span class=\"line\">rancher-latest/rancher\t2.11.1       \tv2.11.1    \tInstall Rancher Server to manage Kubernetes clu...</span><br><span class=\"line\">rancher-latest/rancher\t2.11.0       \tv2.11.0    \tInstall Rancher Server to manage Kubernetes clu...</span><br><span class=\"line\">rancher-latest/rancher\t2.10.3       \tv2.10.3    \tInstall Rancher Server to manage Kubernetes clu...</span><br><span class=\"line\">rancher-latest/rancher\t2.10.2       \tv2.10.2    \tInstall Rancher Server to manage Kubernetes clu...</span><br><span class=\"line\">rancher-latest/rancher\t2.10.1       \tv2.10.1    \tInstall Rancher Server to manage Kubernetes clu...</span><br><span class=\"line\">rancher-latest/rancher\t2.10.0       \tv2.10.0    \tInstall Rancher Server to manage Kubernetes clu...</span><br><span class=\"line\">rancher-latest/rancher\t2.9.3        \tv2.9.3     \tInstall Rancher Server to manage Kubernetes clu...</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åˆ›å»ºå‘½åç©ºé—´</span></span><br><span class=\"line\">kubectl create namespace cattle-system</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åˆ›å»ºè¯ä¹¦ï¼Œè¯ä¹¦æ˜¯æœºæ„é¢å‘çš„</span></span><br><span class=\"line\">kubectl create secret tls tls-rancher-ingress \\</span><br><span class=\"line\">  --key=nginx_ssl/nginx.hanqunfeng.com.key \\</span><br><span class=\"line\">  --cert=nginx_ssl/nginx.hanqunfeng.com.pem \\</span><br><span class=\"line\">  -n cattle-system</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å®‰è£… Rancher  --version v2.11.3 å¯ä»¥æŒ‡å®šç‰ˆæœ¬ï¼Œé»˜è®¤æœ€æ–°ç‰ˆ</span></span><br><span class=\"line\">helm install rancher rancher-latest/rancher \\</span><br><span class=\"line\">  --namespace cattle-system \\</span><br><span class=\"line\">  --create-namespace \\</span><br><span class=\"line\">  --<span class=\"built_in\">set</span> hostname=rancher.hanqunfeng.com \\</span><br><span class=\"line\">  --<span class=\"built_in\">set</span> ingress.tls.source=secret \\</span><br><span class=\"line\">  --<span class=\"built_in\">set</span> replicas=3 \\</span><br><span class=\"line\">  --<span class=\"built_in\">set</span> bootstrapPassword=rancher#2025</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">## å‚æ•°è¯´æ˜</span></span><br><span class=\"line\"><span class=\"comment\"># --set hostname=rancher.hanqunfeng.com è®¾ç½® rancher çš„åŸŸå</span></span><br><span class=\"line\"><span class=\"comment\"># --set ingress.tls.source=secret é…ç½® rancher çš„è¯ä¹¦ï¼Œåç§°ä¸º tls-rancher-ingress</span></span><br><span class=\"line\"><span class=\"comment\"># --set replicas=3 è®¾ç½® rancher çš„å‰¯æœ¬æ•°</span></span><br><span class=\"line\"><span class=\"comment\"># --set bootstrapPassword=rancher#2025 è®¾ç½® rancher çš„åˆå§‹å¯†ç </span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">## ä¸è¿‡æ‰§è¡Œä¸Šé¢çš„å®‰è£…å‘½ä»¤ä¼šæŠ¥é”™ï¼Œåº”è¯¥æ˜¯å½“å‰çš„ rancher ç‰ˆæœ¬ä¸æ”¯æŒ Kubernetes v1.33.2</span></span><br><span class=\"line\">Error: INSTALLATION FAILED: chart requires kubeVersion: &lt; 1.33.0-0 <span class=\"built_in\">which</span> is incompatible with Kubernetes v1.33.2</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">## è§£å†³åŠæ³•</span></span><br><span class=\"line\"><span class=\"comment\"># ä¸‹è½½å¹¶è§£å‹ rancher å®‰è£…åŒ…</span></span><br><span class=\"line\">helm pull rancher-latest/rancher --untar --untardir ./</span><br><span class=\"line\"><span class=\"comment\"># ä¿®æ”¹å…¶ä¸­çš„ Chart.yaml æ–‡ä»¶</span></span><br><span class=\"line\">kubeVersion: &lt; 1.33.0-0 ==&gt; kubeVersion: &lt; 1.34.0-0</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å®‰è£… rancher</span></span><br><span class=\"line\">helm install rancher rancher \\</span><br><span class=\"line\">  --namespace cattle-system \\</span><br><span class=\"line\">  --create-namespace \\</span><br><span class=\"line\">  --<span class=\"built_in\">set</span> hostname=rancher.hanqunfeng.com \\</span><br><span class=\"line\">  --<span class=\"built_in\">set</span> ingress.tls.source=secret \\</span><br><span class=\"line\">  --<span class=\"built_in\">set</span> replicas=3 \\</span><br><span class=\"line\">  --<span class=\"built_in\">set</span> bootstrapPassword=rancher#2025</span><br><span class=\"line\"><span class=\"comment\">## è¾“å‡º</span></span><br><span class=\"line\">NAME: rancher</span><br><span class=\"line\">LAST DEPLOYED: Thu Jul 24 23:55:24 2025</span><br><span class=\"line\">NAMESPACE: cattle-system</span><br><span class=\"line\">STATUS: deployed</span><br><span class=\"line\">REVISION: 1</span><br><span class=\"line\">TEST SUITE: None</span><br><span class=\"line\">NOTES:</span><br><span class=\"line\">Rancher Server has been installed.</span><br><span class=\"line\"></span><br><span class=\"line\">NOTE: Rancher may take several minutes to fully initialize. Please standby <span class=\"keyword\">while</span> Certificates are being issued, Containers are started and the Ingress rule comes up.</span><br><span class=\"line\"></span><br><span class=\"line\">Check out our docs at https://rancher.com/docs/</span><br><span class=\"line\"></span><br><span class=\"line\">If you provided your own bootstrap password during installation, browse to https://rancher.hanqunfeng.com to get started.</span><br><span class=\"line\"></span><br><span class=\"line\">If this is the first time you installed Rancher, get started by running this <span class=\"built_in\">command</span> and clicking the URL it generates:</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">echo</span> https://rancher.hanqunfeng.com/dashboard/?setup=$(kubectl get secret --namespace cattle-system bootstrap-secret -o go-template=<span class=\"string\">&#x27;&#123;&#123;.data.bootstrapPassword|base64decode&#125;&#125;&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">To get just the bootstrap password on its own, run:</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">kubectl get secret --namespace cattle-system bootstrap-secret -o go-template=<span class=\"string\">&#x27;&#123;&#123;.data.bootstrapPassword|base64decode&#125;&#125;&#123;&#123; &quot;\\n&quot; &#125;&#125;&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">Happy Containering!</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æŸ¥çœ‹åˆ›å»ºçš„èµ„æº</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ k get all,ing -n cattle-system</span><br><span class=\"line\">NAME                                   READY   STATUS      RESTARTS   AGE</span><br><span class=\"line\">pod/helm-operation-8257k               0/2     Completed   0          11m</span><br><span class=\"line\">pod/helm-operation-g8blp               0/2     Completed   0          12m</span><br><span class=\"line\">pod/helm-operation-hwpbp               0/2     Completed   0          10m</span><br><span class=\"line\">pod/helm-operation-qbs5n               0/2     Completed   0          10m</span><br><span class=\"line\">pod/helm-operation-wlptb               0/2     Completed   0          13m</span><br><span class=\"line\">pod/rancher-56689b7d8c-v7hpd           1/1     Running     0          21m</span><br><span class=\"line\">pod/rancher-56689b7d8c-xnrbf           1/1     Running     0          21m</span><br><span class=\"line\">pod/rancher-56689b7d8c-xvqgs           1/1     Running     0          21m</span><br><span class=\"line\">pod/rancher-webhook-5fd5fc44f9-8xwjk   1/1     Running     0          11m</span><br><span class=\"line\"></span><br><span class=\"line\">NAME                               TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)          AGE</span><br><span class=\"line\">service/imperative-api-extension   ClusterIP   10.96.188.28   &lt;none&gt;        6666/TCP         15m</span><br><span class=\"line\">service/rancher                    ClusterIP   10.96.21.41    &lt;none&gt;        80/TCP,443/TCP   21m</span><br><span class=\"line\">service/rancher-webhook            ClusterIP   10.96.85.153   &lt;none&gt;        443/TCP          11m</span><br><span class=\"line\"></span><br><span class=\"line\">NAME                              READY   UP-TO-DATE   AVAILABLE   AGE</span><br><span class=\"line\">deployment.apps/rancher           3/3     3            3           21m</span><br><span class=\"line\">deployment.apps/rancher-webhook   1/1     1            1           11m</span><br><span class=\"line\"></span><br><span class=\"line\">NAME                                         DESIRED   CURRENT   READY   AGE</span><br><span class=\"line\">replicaset.apps/rancher-56689b7d8c           3         3         3       21m</span><br><span class=\"line\">replicaset.apps/rancher-webhook-5fd5fc44f9   1         1         1       11m</span><br><span class=\"line\"></span><br><span class=\"line\">NAME                                CLASS   HOSTS                    ADDRESS         PORTS     AGE</span><br><span class=\"line\">ingress.networking.k8s.io/rancher   nginx   rancher.hanqunfeng.com   10.211.55.201   80, 443   21m</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æµè§ˆå™¨è®¿é—®ï¼š<a href=\"https://rancher.hanqunfeng.com\">https://rancher.hanqunfeng.com</a>ï¼Œè¾“å…¥ä¸Šé¢è®¾ç½®çš„å¯†ç å³å¯ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å¦‚æœå¿˜è®°åˆå§‹å¯†ç å¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹å¯†ç </span></span><br><span class=\"line\">kubectl get secret --namespace cattle-system bootstrap-secret -o go-template=<span class=\"string\">&#x27;&#123;&#123;.data.bootstrapPassword|base64decode&#125;&#125;&#123;&#123;&quot;\\n&quot;&#125;&#125;&#x27;</span></span><br></pre></td></tr></table></figure>\n<p><img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/uPic/rHDDMN.png\" alt=\"\"></p>\n<h2 id=\"å¸è½½-Rancher\">å¸è½½ Rancher</h2>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å¸è½½ Rancher</span></span><br><span class=\"line\">helm uninstall rancher -n cattle-system</span><br><span class=\"line\"><span class=\"comment\"># åˆ é™¤ cattle-system å‘½åç©ºé—´</span></span><br><span class=\"line\">kubectl delete namespace cattle-system</span><br></pre></td></tr></table></figure>\n","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» K8S çš„ UI ç®¡ç†å·¥å…· Rancher ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚ K8Så®˜ç½‘ k8s Github Rancher å®˜ç½‘ Rancher Github Rancher ç®€ä»‹ Rancher æ˜¯ä¸€ä¸ª å¼€æºçš„ Kubernetes ç®¡ç†å¹³å°ï¼Œç”¨äºå¸®åŠ©ç”¨æˆ·éƒ¨ç½²ã€ç®¡ç†å’Œè¿ç»´å¤šä¸ª Kubernetes é›†ç¾¤ï¼Œå…·æœ‰æ˜“ç”¨çš„ Web UIã€æƒé™æ§åˆ¶ã€é›†ç¾¤ç›‘æ§ã€åº”ç”¨ç®¡ç†ç­‰åŠŸèƒ½ï¼Œå¹¿æ³›åº”ç”¨äºä¼ä¸šçš„äº‘åŸç”Ÿå¹³å°å»ºè®¾ä¸­ã€‚ éƒ¨ç½² Rancher ä½¿ç”¨ Helm å®‰è£… Rancher 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788# æ·»åŠ  rancher çš„ Helm ä»“åº“helm repo add rancher-latest https://releases.rancher.com/server-charts/latest# æ›´æ–° rancher çš„ Helm ä»“åº“helm repo update# æŸ¥çœ‹ rancher çš„ç‰ˆæœ¬$ helm search repo rancher -l | headNAME CHART VERSION APP VERSION DESCRIPTIONrancher-latest/rancher 2.11.3 v2.11.3 Install Rancher Server to manage Kubernetes clu...rancher-latest/rancher 2.11.2 v2.11.2 Install Rancher Server to manage Kubernetes clu...rancher-latest/rancher 2.11.1 v2.11.1 Install Rancher Server to manage Kubernetes clu...rancher-latest/rancher 2.11.0 v2.11.0 Install Rancher Server to manage Kubernetes clu...rancher-latest/rancher 2.10.3 v2.10.3 Install Rancher Server to manage Kubernetes clu...rancher-latest/rancher 2.10.2 v2.10.2 Install Rancher Server to manage Kubernetes clu...rancher-latest/rancher 2.10.1 v2.10.1 Install Rancher Server to manage Kubernetes clu...rancher-latest/rancher 2.10.0 v2.10.0 Install Rancher Server to manage Kubernetes clu...rancher-latest/rancher 2.9.3 v2.9.3 Install Rancher Server to manage Kubernetes clu...# åˆ›å»ºå‘½åç©ºé—´kubectl create namespace cattle-system# åˆ›å»ºè¯ä¹¦ï¼Œè¯ä¹¦æ˜¯æœºæ„é¢å‘çš„kubectl create secret tls tls-rancher-ingress \\ --key=nginx_ssl/nginx.hanqunfeng.com.key \\ --cert=nginx_ssl/nginx.hanqunfeng.com.pem \\ -n cattle-system# å®‰è£… Rancher --version v2.11.3 å¯ä»¥æŒ‡å®šç‰ˆæœ¬ï¼Œé»˜è®¤æœ€æ–°ç‰ˆhelm install rancher rancher-latest/rancher \\ --namespace cattle-system \\ --create-namespace \\ --set hostname=rancher.hanqunfeng.com \\ --set ingress.tls.source=secret \\ --set replicas=3 \\ --set bootstrapPassword=rancher#2025## å‚æ•°è¯´æ˜# --set hostname=rancher.hanqunfeng.com è®¾ç½® rancher çš„åŸŸå# --set ingress.tls.source=secret é…ç½® rancher çš„è¯ä¹¦ï¼Œåç§°ä¸º tls-rancher-ingress# --set replicas=3 è®¾ç½® rancher çš„å‰¯æœ¬æ•°# --set bootstrapPassword=rancher#2025 è®¾ç½® rancher çš„åˆå§‹å¯†ç ## ä¸è¿‡æ‰§è¡Œä¸Šé¢çš„å®‰è£…å‘½ä»¤ä¼šæŠ¥é”™ï¼Œåº”è¯¥æ˜¯å½“å‰çš„ rancher ç‰ˆæœ¬ä¸æ”¯æŒ Kubernetes v1.33.2Error: INSTALLATION FAILED: chart requires kubeVersion: &lt; 1.33.0-0 which is incompatible with Kubernetes v1.33.2## è§£å†³åŠæ³•# ä¸‹è½½å¹¶è§£å‹ rancher å®‰è£…åŒ…helm pull rancher-latest/rancher --untar --untardir ./# ä¿®æ”¹å…¶ä¸­çš„ Chart.yaml æ–‡ä»¶kubeVersion: &lt; 1.33.0-0 ==&gt; kubeVersion: &lt; 1.34.0-0# å®‰è£… rancherhelm install rancher rancher \\ --namespace cattle-system \\ --create-namespace \\ --set hostname=rancher.hanqunfeng.com \\ --set ingress.tls.source=secret \\ --set replicas=3 \\ --set bootstrapPassword=rancher#2025## è¾“å‡ºNAME: rancherLAST DEPLOYED: Thu Jul 24 23:55:24 2025NAMESPACE: cattle-systemSTATUS: deployedREVISION: 1TEST SUITE: NoneNOTES:Rancher Server has been installed.NOTE: Rancher may take several minutes to fully initialize. Please standby while Certificates are being issued, Containers are started and the Ingress rule comes up.Check out our docs at https://rancher.com/docs/If you provided your own bootstrap password during installation, browse to https://rancher.hanqunfeng.com to get started.If this is the first time you installed Rancher, get started by running this command and clicking the URL it generates:echo https://rancher.hanqunfeng.com/dashboard/?setup=$(kubectl get secret --namespace cattle-system bootstrap-secret -o go-template=&#x27;&#123;&#123;.data.bootstrapPassword|base64decode&#125;&#125;&#x27;)To get just the bootstrap password on its own, run:kubectl get secret --namespace cattle-system bootstrap-secret -o go-template=&#x27;&#123;&#123;.data.bootstrapPassword|base64decode&#125;&#125;&#123;&#123; &quot;\\n&quot; &#125;&#125;&#x27;Happy Containering! æŸ¥çœ‹åˆ›å»ºçš„èµ„æº 123456789101112131415161718192021222324252627$ k get all,ing -n cattle-systemNAME READY STATUS RESTARTS AGEpod/helm-operation-8257k 0/2 Completed 0 11mpod/helm-operation-g8blp 0/2 Completed 0 12mpod/helm-operation-hwpbp 0/2 Completed 0 10mpod/helm-operation-qbs5n 0/2 Completed 0 10mpod/helm-operation-wlptb 0/2 Completed 0 13mpod/rancher-56689b7d8c-v7hpd 1/1 Running 0 21mpod/rancher-56689b7d8c-xnrbf 1/1 Running 0 21mpod/rancher-56689b7d8c-xvqgs 1/1 Running 0 21mpod/rancher-webhook-5fd5fc44f9-8xwjk 1/1 Running 0 11mNAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGEservice/imperative-api-extension ClusterIP 10.96.188.28 &lt;none&gt; 6666/TCP 15mservice/rancher ClusterIP 10.96.21.41 &lt;none&gt; 80/TCP,443/TCP 21mservice/rancher-webhook ClusterIP 10.96.85.153 &lt;none&gt; 443/TCP 11mNAME READY UP-TO-DATE AVAILABLE AGEdeployment.apps/rancher 3/3 3 3 21mdeployment.apps/rancher-webhook 1/1 1 1 11mNAME DESIRED CURRENT READY AGEreplicaset.apps/rancher-56689b7d8c 3 3 3 21mreplicaset.apps/rancher-webhook-5fd5fc44f9 1 1 1 11mNAME CLASS HOSTS ADDRESS PORTS AGEingress.networking.k8s.io/rancher nginx rancher.hanqunfeng.com 10.211.55.201 80, 443 21m æµè§ˆå™¨è®¿é—®ï¼šhttps://rancher.hanqunfeng.comï¼Œè¾“å…¥ä¸Šé¢è®¾ç½®çš„å¯†ç å³å¯ã€‚ 12# å¦‚æœå¿˜è®°åˆå§‹å¯†ç å¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹å¯†ç kubectl get secret --namespace cattle-system bootstrap-secret -o go-template=&#x27;&#123;&#123;.data.bootstrapPassword|base64decode&#125;&#125;&#123;&#123;&quot;\\n&quot;&#125;&#125;&#x27; å¸è½½ Rancher 1234# å¸è½½ Rancherhelm uninstall rancher -n cattle-system# åˆ é™¤ cattle-system å‘½åç©ºé—´kubectl delete namespace cattle-system","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» K8S çš„ UI ç®¡ç†å·¥å…· Rancher ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚ K8Så®˜ç½‘ k8s Github Rancher å®˜ç½‘ Rancher Github","date_published":"2025-07-25T14:33:05.000Z","tags":["æŠ€æœ¯","k8s","K8S"]},{"id":"https://blog.hanqunfeng.com/2025/07/24/k8s-ui-kubesphere/","url":"https://blog.hanqunfeng.com/2025/07/24/k8s-ui-kubesphere/","title":"K8S UI ä¹‹ Kubesphere","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç» K8S çš„ UI ç®¡ç†å·¥å…· Kubesphereï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://kubernetes.io/zh-cn/\">K8Så®˜ç½‘</a></p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://github.com/kubernetes/kubernetes\">k8s Github</a></p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://kubesphere.io/zh/\">Kubesphere å®˜ç½‘</a></p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"Kubesphere-ç®€ä»‹\">Kubesphere ç®€ä»‹</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>KubeSphere æ˜¯ä¸€ä¸ªåŸºäº Kubernetes æ„å»ºçš„ ä¼ä¸šçº§å¤šç§Ÿæˆ·å®¹å™¨ç®¡ç†å¹³å°ï¼Œæä¾›äº†ä¸€å¥—å®Œæ•´çš„å®¹å™¨å¹³å°è§£å†³æ–¹æ¡ˆï¼Œè®©ç”¨æˆ·ä»¥å›¾å½¢åŒ–æ–¹å¼è½»æ¾ä½¿ç”¨ Kubernetes å’Œ DevOps èƒ½åŠ›ï¼Œä¸éœ€è¦æ·±å…¥ç†è§£å¤æ‚çš„åº•å±‚æ¶æ„ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä¸ K8S çš„ Dashboard ç›¸æ¯”å…·æœ‰å¦‚ä¸‹ä¼˜åŠ¿ï¼š</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>åŠŸèƒ½ / ç‰¹æ€§</th>\n<th>Kubernetes Dashboard</th>\n<th><strong>KubeSphere</strong></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>âœ… åŸºç¡€èµ„æºç®¡ç†</td>\n<td>âœ… æ”¯æŒ</td>\n<td>âœ… æ›´ä¸°å¯Œï¼Œæ”¯æŒæ›´å¤šç»†ç²’åº¦æ§åˆ¶</td>\n</tr>\n<tr>\n<td>ğŸ‘¥ å¤šç§Ÿæˆ·æ”¯æŒ</td>\n<td>âŒ æ— </td>\n<td>âœ… å†…å»ºä¼ä¸šçº§å¤šç§Ÿæˆ·ã€ç©ºé—´ï¼ˆWorkspaceï¼‰éš”ç¦»</td>\n</tr>\n<tr>\n<td>ğŸ” èº«ä»½è®¤è¯ä¸æƒé™æ§åˆ¶</td>\n<td>âš ï¸ éœ€æ‰‹åŠ¨æ•´åˆ RBAC</td>\n<td>âœ… å†…å»ºç”¨æˆ·ç®¡ç†ã€è§’è‰²ã€å›¢é˜Ÿã€ä¼ä¸šç»„ç»‡æ¶æ„</td>\n</tr>\n<tr>\n<td>ğŸŒ å¤šé›†ç¾¤æ”¯æŒ</td>\n<td>âŒ ä¸æ”¯æŒ</td>\n<td>âœ… æ”¯æŒè·¨åŒºåŸŸå¤šé›†ç¾¤ç»Ÿä¸€ç®¡ç†</td>\n</tr>\n<tr>\n<td>ğŸš€ DevOpsï¼ˆCI/CD æµæ°´çº¿ï¼‰</td>\n<td>âŒ æ— </td>\n<td>âœ… å†…ç½®å›¾å½¢åŒ–æµæ°´çº¿ï¼ˆJenkins é©±åŠ¨ï¼‰</td>\n</tr>\n<tr>\n<td>ğŸ“Š ç›‘æ§ä¸æŒ‡æ ‡ï¼ˆPrometheusï¼‰</td>\n<td>âŒ æ‰‹åŠ¨å®‰è£…</td>\n<td>âœ… å†…ç½®ï¼Œå›¾å½¢åŒ–å±•ç¤º Pod/Node/æœåŠ¡ç­‰ç›‘æ§æ•°æ®</td>\n</tr>\n<tr>\n<td>ğŸ“ æ—¥å¿—æŸ¥è¯¢ä¸åˆ†æï¼ˆEFKï¼‰</td>\n<td>âŒ æ— </td>\n<td>âœ… å†…å»º Fluent Bit + Elasticsearch + Kibana</td>\n</tr>\n<tr>\n<td>ğŸ’¡ å¾®æœåŠ¡æ²»ç†ï¼ˆIstioï¼‰</td>\n<td>âŒ æ— </td>\n<td>âœ… å¯é€‰å¯ç”¨ï¼Œæ”¯æŒæœåŠ¡æ‹“æ‰‘ã€ç°åº¦å‘å¸ƒã€æµé‡æ²»ç†ç­‰</td>\n</tr>\n<tr>\n<td>ğŸ§° åº”ç”¨å•†åº—ï¼ˆHelm å¯è§†åŒ–éƒ¨ç½²ï¼‰</td>\n<td>âŒ æ— </td>\n<td>âœ… æ”¯æŒ Helm åº”ç”¨å¸‚åœºï¼Œç‚¹å‡»å³å¯å®‰è£…å¸¸è§ä¸­é—´ä»¶</td>\n</tr>\n<tr>\n<td>ğŸ”Œ æ’ä»¶æ¶æ„</td>\n<td>âŒ æ— </td>\n<td>âœ… æ”¯æŒæ¨¡å—æŒ‰éœ€å¯ç”¨/å…³é—­</td>\n</tr>\n<tr>\n<td>ğŸ§ª å®¹å™¨é•œåƒä»“åº“ï¼ˆHarborï¼‰</td>\n<td>âŒ æ— </td>\n<td>âœ… å¯é›†æˆæˆ–å†…å»º Harbor å®¹å™¨ä»“åº“</td>\n</tr>\n<tr>\n<td>ğŸ“¦ å®‰è£…å¤æ‚åº¦</td>\n<td>âœ… ç®€å•</td>\n<td>âš ï¸ ç•¥å¤æ‚ï¼Œä½†å¯æŒ‰éœ€å¯ç”¨æ¨¡å—</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"éƒ¨ç½²-Kubesphere\">éƒ¨ç½² Kubesphere</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Kubesphere å¯¹ç³»ç»Ÿèµ„æºæœ‰æœ€ä½è¦æ±‚ï¼Œå…·ä½“å‚è€ƒ<a href=\"https://kubesphere.io/zh/docs/v4.1/03-installation-and-upgrade/01-preparations/01-supported-k8s/\">å®˜ç½‘:ç¯å¢ƒè¦æ±‚</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>éƒ¨ç½²</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å¦‚æœæ— æ³•è®¿é—® charts.kubesphere.io, å¯å°† charts.kubesphere.io æ›¿æ¢ä¸º charts.kubesphere.com.cn</span></span><br><span class=\"line\">helm upgrade --install -n kubesphere-system --create-namespace ks-core https://charts.kubesphere.io/main/ks-core-1.1.4.tgz --debug --<span class=\"built_in\">wait</span></span><br><span class=\"line\"><span class=\"comment\">## å®‰è£…æˆåŠŸåä¼šè¾“å‡ºå¦‚ä¸‹ä¿¡æ¯ï¼š</span></span><br><span class=\"line\">NOTES:</span><br><span class=\"line\">Thank you <span class=\"keyword\">for</span> choosing KubeSphere Helm Chart.</span><br><span class=\"line\"></span><br><span class=\"line\">Please be patient and <span class=\"built_in\">wait</span> <span class=\"keyword\">for</span> several seconds <span class=\"keyword\">for</span> the KubeSphere deployment to complete.</span><br><span class=\"line\"></span><br><span class=\"line\">1. Wait <span class=\"keyword\">for</span> Deployment Completion</span><br><span class=\"line\"></span><br><span class=\"line\">    Confirm that all KubeSphere components are running by executing the following <span class=\"built_in\">command</span>:</span><br><span class=\"line\"></span><br><span class=\"line\">    kubectl get pods -n kubesphere-system</span><br><span class=\"line\">2. Access the KubeSphere Console</span><br><span class=\"line\"></span><br><span class=\"line\">    Once the deployment is complete, you can access the KubeSphere console using the following URL:</span><br><span class=\"line\"></span><br><span class=\"line\">    http://10.211.55.11:30880</span><br><span class=\"line\"></span><br><span class=\"line\">3. Login to KubeSphere Console</span><br><span class=\"line\"></span><br><span class=\"line\">    Use the following credentials to <span class=\"built_in\">log</span> <span class=\"keyword\">in</span>:</span><br><span class=\"line\"></span><br><span class=\"line\">    Account: admin</span><br><span class=\"line\">    Password: P@88w0rd</span><br><span class=\"line\"></span><br><span class=\"line\">NOTE: It is highly recommended to change the default password immediately after the first login.</span><br><span class=\"line\">For additional information and details, please visit https://kubesphere.io.</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹æ‰€æœ‰ç»„ä»¶</span></span><br><span class=\"line\">$ kubectl get pod,deploy,svc -n kubesphere-system</span><br><span class=\"line\">NAME                                         READY   STATUS    RESTARTS       AGE</span><br><span class=\"line\">pod/extensions-museum-ffd8bd9d8-fvcw4        1/1     Running   1 (28m ago)    5h5m</span><br><span class=\"line\">pod/ks-apiserver-7b4479d5f5-2k4c9            1/1     Running   2 (27m ago)    5h5m</span><br><span class=\"line\">pod/ks-console-6bd9b9f5d9-xqlzs              1/1     Running   0              26m</span><br><span class=\"line\">pod/ks-controller-manager-547f9fc8c9-5b88z   1/1     Running   10 (27m ago)   5h5m</span><br><span class=\"line\"></span><br><span class=\"line\">NAME                                    READY   UP-TO-DATE   AVAILABLE   AGE</span><br><span class=\"line\">deployment.apps/extensions-museum       1/1     1            1           5h14m</span><br><span class=\"line\">deployment.apps/ks-apiserver            1/1     1            1           5h14m</span><br><span class=\"line\">deployment.apps/ks-console              1/1     1            1           5h14m</span><br><span class=\"line\">deployment.apps/ks-controller-manager   1/1     1            1           5h14m</span><br><span class=\"line\"></span><br><span class=\"line\">NAME                            TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)        AGE</span><br><span class=\"line\">service/extensions-museum       ClusterIP   10.96.95.71    &lt;none&gt;        443/TCP        5h14m</span><br><span class=\"line\">service/ks-apiserver            ClusterIP   10.96.12.106   &lt;none&gt;        80/TCP         5h14m</span><br><span class=\"line\">service/ks-console              NodePort    10.96.55.165   &lt;none&gt;        80:30880/TCP   5h14m</span><br><span class=\"line\">service/ks-controller-manager   ClusterIP   10.96.13.243   &lt;none&gt;        443/TCP        5h14m</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æµè§ˆå™¨è®¿é—®ï¼š<a href=\"http://10.211.55.11:30880\">http://10.211.55.11:30880</a>ï¼Œè¾“å…¥è´¦å·å¯†ç ï¼šadmin/P@88w0rdï¼Œé¦–æ¬¡ç™»å½•éœ€è¦ä¿®æ”¹å¯†ç ã€‚</p>\n</li>\n</ul>\n<h2 id=\"é…ç½®-ingress\">é…ç½® ingress</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ›å»ºè¯ä¹¦</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl create secret tls nginx-tls \\</span><br><span class=\"line\">    --key=nginx_ssl/nginx.hanqunfeng.com.key \\</span><br><span class=\"line\">    --cert=nginx_ssl/nginx.hanqunfeng.com.pem \\</span><br><span class=\"line\">    -n kubesphere-system</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ›å»º ingress</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># kubesphere-ingress.yaml</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">networking.k8s.io/v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Ingress</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">kubesphere-nginx</span></span><br><span class=\"line\">  <span class=\"attr\">namespace:</span> <span class=\"string\">kubesphere-system</span></span><br><span class=\"line\">  <span class=\"attr\">annotations:</span></span><br><span class=\"line\">    <span class=\"attr\">nginx.ingress.kubernetes.io/force-ssl-redirect:</span> <span class=\"string\">&quot;true&quot;</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">ingressClassName:</span> <span class=\"string\">nginx</span></span><br><span class=\"line\">  <span class=\"attr\">tls:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">hosts:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">kubesphere.hanqunfeng.com</span></span><br><span class=\"line\">    <span class=\"attr\">secretName:</span> <span class=\"string\">nginx-tls</span></span><br><span class=\"line\">  <span class=\"attr\">rules:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">host:</span> <span class=\"string\">kubesphere.hanqunfeng.com</span></span><br><span class=\"line\">    <span class=\"attr\">http:</span></span><br><span class=\"line\">      <span class=\"attr\">paths:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">pathType:</span> <span class=\"string\">Prefix</span></span><br><span class=\"line\">        <span class=\"attr\">path:</span> <span class=\"string\">/</span></span><br><span class=\"line\">        <span class=\"attr\">backend:</span></span><br><span class=\"line\">          <span class=\"attr\">service:</span></span><br><span class=\"line\">            <span class=\"attr\">name:</span> <span class=\"string\">ks-console</span></span><br><span class=\"line\">            <span class=\"attr\">port:</span></span><br><span class=\"line\">              <span class=\"attr\">number:</span> <span class=\"number\">80</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"å¸è½½-Kubesphere\">å¸è½½ Kubesphere</h2>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">helm uninstall ks-core -n kubesphere-system</span><br><span class=\"line\">kubectl delete namespace kubesphere-system</span><br></pre></td></tr></table></figure>","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» K8S çš„ UI ç®¡ç†å·¥å…· Kubesphereï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚ K8Så®˜ç½‘ k8s Github Kubesphere å®˜ç½‘ Kubesphere ç®€ä»‹ KubeSphere æ˜¯ä¸€ä¸ªåŸºäº Kubernetes æ„å»ºçš„ ä¼ä¸šçº§å¤šç§Ÿæˆ·å®¹å™¨ç®¡ç†å¹³å°ï¼Œæä¾›äº†ä¸€å¥—å®Œæ•´çš„å®¹å™¨å¹³å°è§£å†³æ–¹æ¡ˆï¼Œè®©ç”¨æˆ·ä»¥å›¾å½¢åŒ–æ–¹å¼è½»æ¾ä½¿ç”¨ Kubernetes å’Œ DevOps èƒ½åŠ›ï¼Œä¸éœ€è¦æ·±å…¥ç†è§£å¤æ‚çš„åº•å±‚æ¶æ„ã€‚ ä¸ K8S çš„ Dashboard ç›¸æ¯”å…·æœ‰å¦‚ä¸‹ä¼˜åŠ¿ï¼š åŠŸèƒ½ / ç‰¹æ€§ Kubernetes Dashboard KubeSphere âœ… åŸºç¡€èµ„æºç®¡ç† âœ… æ”¯æŒ âœ… æ›´ä¸°å¯Œï¼Œæ”¯æŒæ›´å¤šç»†ç²’åº¦æ§åˆ¶ ğŸ‘¥ å¤šç§Ÿæˆ·æ”¯æŒ âŒ æ—  âœ… å†…å»ºä¼ä¸šçº§å¤šç§Ÿæˆ·ã€ç©ºé—´ï¼ˆWorkspaceï¼‰éš”ç¦» ğŸ” èº«ä»½è®¤è¯ä¸æƒé™æ§åˆ¶ âš ï¸ éœ€æ‰‹åŠ¨æ•´åˆ RBAC âœ… å†…å»ºç”¨æˆ·ç®¡ç†ã€è§’è‰²ã€å›¢é˜Ÿã€ä¼ä¸šç»„ç»‡æ¶æ„ ğŸŒ å¤šé›†ç¾¤æ”¯æŒ âŒ ä¸æ”¯æŒ âœ… æ”¯æŒè·¨åŒºåŸŸå¤šé›†ç¾¤ç»Ÿä¸€ç®¡ç† ğŸš€ DevOpsï¼ˆCI/CD æµæ°´çº¿ï¼‰ âŒ æ—  âœ… å†…ç½®å›¾å½¢åŒ–æµæ°´çº¿ï¼ˆJenkins é©±åŠ¨ï¼‰ ğŸ“Š ç›‘æ§ä¸æŒ‡æ ‡ï¼ˆPrometheusï¼‰ âŒ æ‰‹åŠ¨å®‰è£… âœ… å†…ç½®ï¼Œå›¾å½¢åŒ–å±•ç¤º Pod/Node/æœåŠ¡ç­‰ç›‘æ§æ•°æ® ğŸ“ æ—¥å¿—æŸ¥è¯¢ä¸åˆ†æï¼ˆEFKï¼‰ âŒ æ—  âœ… å†…å»º Fluent Bit + Elasticsearch + Kibana ğŸ’¡ å¾®æœåŠ¡æ²»ç†ï¼ˆIstioï¼‰ âŒ æ—  âœ… å¯é€‰å¯ç”¨ï¼Œæ”¯æŒæœåŠ¡æ‹“æ‰‘ã€ç°åº¦å‘å¸ƒã€æµé‡æ²»ç†ç­‰ ğŸ§° åº”ç”¨å•†åº—ï¼ˆHelm å¯è§†åŒ–éƒ¨ç½²ï¼‰ âŒ æ—  âœ… æ”¯æŒ Helm åº”ç”¨å¸‚åœºï¼Œç‚¹å‡»å³å¯å®‰è£…å¸¸è§ä¸­é—´ä»¶ ğŸ”Œ æ’ä»¶æ¶æ„ âŒ æ—  âœ… æ”¯æŒæ¨¡å—æŒ‰éœ€å¯ç”¨/å…³é—­ ğŸ§ª å®¹å™¨é•œåƒä»“åº“ï¼ˆHarborï¼‰ âŒ æ—  âœ… å¯é›†æˆæˆ–å†…å»º Harbor å®¹å™¨ä»“åº“ ğŸ“¦ å®‰è£…å¤æ‚åº¦ âœ… ç®€å• âš ï¸ ç•¥å¤æ‚ï¼Œä½†å¯æŒ‰éœ€å¯ç”¨æ¨¡å— éƒ¨ç½² Kubesphere Kubesphere å¯¹ç³»ç»Ÿèµ„æºæœ‰æœ€ä½è¦æ±‚ï¼Œå…·ä½“å‚è€ƒå®˜ç½‘:ç¯å¢ƒè¦æ±‚ éƒ¨ç½² 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748# å¦‚æœæ— æ³•è®¿é—® charts.kubesphere.io, å¯å°† charts.kubesphere.io æ›¿æ¢ä¸º charts.kubesphere.com.cnhelm upgrade --install -n kubesphere-system --create-namespace ks-core https://charts.kubesphere.io/main/ks-core-1.1.4.tgz --debug --wait## å®‰è£…æˆåŠŸåä¼šè¾“å‡ºå¦‚ä¸‹ä¿¡æ¯ï¼šNOTES:Thank you for choosing KubeSphere Helm Chart.Please be patient and wait for several seconds for the KubeSphere deployment to complete.1. Wait for Deployment Completion Confirm that all KubeSphere components are running by executing the following command: kubectl get pods -n kubesphere-system2. Access the KubeSphere Console Once the deployment is complete, you can access the KubeSphere console using the following URL: http://10.211.55.11:308803. Login to KubeSphere Console Use the following credentials to log in: Account: admin Password: P@88w0rdNOTE: It is highly recommended to change the default password immediately after the first login.For additional information and details, please visit https://kubesphere.io.# æŸ¥çœ‹æ‰€æœ‰ç»„ä»¶$ kubectl get pod,deploy,svc -n kubesphere-systemNAME READY STATUS RESTARTS AGEpod/extensions-museum-ffd8bd9d8-fvcw4 1/1 Running 1 (28m ago) 5h5mpod/ks-apiserver-7b4479d5f5-2k4c9 1/1 Running 2 (27m ago) 5h5mpod/ks-console-6bd9b9f5d9-xqlzs 1/1 Running 0 26mpod/ks-controller-manager-547f9fc8c9-5b88z 1/1 Running 10 (27m ago) 5h5mNAME READY UP-TO-DATE AVAILABLE AGEdeployment.apps/extensions-museum 1/1 1 1 5h14mdeployment.apps/ks-apiserver 1/1 1 1 5h14mdeployment.apps/ks-console 1/1 1 1 5h14mdeployment.apps/ks-controller-manager 1/1 1 1 5h14mNAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGEservice/extensions-museum ClusterIP 10.96.95.71 &lt;none&gt; 443/TCP 5h14mservice/ks-apiserver ClusterIP 10.96.12.106 &lt;none&gt; 80/TCP 5h14mservice/ks-console NodePort 10.96.55.165 &lt;none&gt; 80:30880/TCP 5h14mservice/ks-controller-manager ClusterIP 10.96.13.243 &lt;none&gt; 443/TCP 5h14m æµè§ˆå™¨è®¿é—®ï¼šhttp://10.211.55.11:30880ï¼Œè¾“å…¥è´¦å·å¯†ç ï¼šadmin/P@88w0rdï¼Œé¦–æ¬¡ç™»å½•éœ€è¦ä¿®æ”¹å¯†ç ã€‚ é…ç½® ingress åˆ›å»ºè¯ä¹¦ 1234kubectl create secret tls nginx-tls \\ --key=nginx_ssl/nginx.hanqunfeng.com.key \\ --cert=nginx_ssl/nginx.hanqunfeng.com.pem \\ -n kubesphere-system åˆ›å»º ingress 12345678910111213141516171819202122232425# kubesphere-ingress.yamlapiVersion: networking.k8s.io/v1kind: Ingressmetadata: name: kubesphere-nginx namespace: kubesphere-system annotations: nginx.ingress.kubernetes.io/force-ssl-redirect: &quot;true&quot;spec: ingressClassName: nginx tls: - hosts: - kubesphere.hanqunfeng.com secretName: nginx-tls rules: - host: kubesphere.hanqunfeng.com http: paths: - pathType: Prefix path: / backend: service: name: ks-console port: number: 80 å¸è½½ Kubesphere 12helm uninstall ks-core -n kubesphere-systemkubectl delete namespace kubesphere-system","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» K8S çš„ UI ç®¡ç†å·¥å…· Kubesphereï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚ K8Så®˜ç½‘ k8s Github Kubesphere å®˜ç½‘","date_published":"2025-07-24T14:33:05.000Z","tags":["æŠ€æœ¯","k8s","K8S"]},{"id":"https://blog.hanqunfeng.com/2025/07/24/k8s-ui-dashboard/","url":"https://blog.hanqunfeng.com/2025/07/24/k8s-ui-dashboard/","title":"K8S UI ä¹‹ Dashboard","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç» K8S çš„ UI ç®¡ç†å·¥å…· Dashboardï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://kubernetes.io/zh-cn/\">K8Så®˜ç½‘</a></p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://github.com/kubernetes/kubernetes\">k8s Github</a></p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/web-ui-dashboard/\">Dashboard k8sä»‹ç»</a></p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"Dashboard-ç®€ä»‹\">Dashboard ç®€ä»‹</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Dashboard æ˜¯åŸºäºç½‘é¡µçš„ Kubernetes ç”¨æˆ·ç•Œé¢ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä½ å¯ä»¥ä½¿ç”¨ Dashboard å°†å®¹å™¨åº”ç”¨éƒ¨ç½²åˆ° Kubernetes é›†ç¾¤ä¸­ï¼Œä¹Ÿå¯ä»¥å¯¹å®¹å™¨åº”ç”¨æ’é”™ï¼Œè¿˜èƒ½ç®¡ç†é›†ç¾¤èµ„æºã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä½ å¯ä»¥ä½¿ç”¨ Dashboard è·å–è¿è¡Œåœ¨é›†ç¾¤ä¸­çš„åº”ç”¨çš„æ¦‚è§ˆä¿¡æ¯ï¼Œä¹Ÿå¯ä»¥åˆ›å»ºæˆ–è€…ä¿®æ”¹ Kubernetes èµ„æº ï¼ˆå¦‚ Deploymentã€Jobã€DaemonSet ç­‰ç­‰ï¼‰ã€‚ ä¾‹å¦‚ï¼Œä½ å¯ä»¥å¯¹ Deployment å®ç°å¼¹æ€§ä¼¸ç¼©ã€å‘èµ·æ»šåŠ¨å‡çº§ã€é‡å¯ Pod æˆ–è€…ä½¿ç”¨å‘å¯¼åˆ›å»ºæ–°çš„åº”ç”¨ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>Dashboard åŒæ—¶å±•ç¤ºäº† Kubernetes é›†ç¾¤ä¸­çš„èµ„æºçŠ¶æ€ä¿¡æ¯å’Œæ‰€æœ‰æŠ¥é”™ä¿¡æ¯ã€‚</p>\n</li>\n</ul>\n<h2 id=\"éƒ¨ç½²-Dashboard\">éƒ¨ç½² Dashboard</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Kubernetes Dashboard ç›®å‰ä»…æ”¯æŒåŸºäº Helm çš„å®‰è£…ï¼Œå› ä¸ºå®ƒé€Ÿåº¦æ›´å¿«ï¼Œ å¹¶ä¸”å¯ä»¥è®©æˆ‘ä»¬æ›´å¥½åœ°æ§åˆ¶ Dashboard è¿è¡Œæ‰€éœ€çš„æ‰€æœ‰ä¾èµ–é¡¹ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æ·»åŠ  kubernetes-dashboard ä»“åº“</span></span><br><span class=\"line\">helm repo add kubernetes-dashboard https://kubernetes.github.io/dashboard/</span><br><span class=\"line\"><span class=\"comment\"># ä½¿ç”¨ kubernetes-dashboard Chart éƒ¨ç½²åä¸º `kubernetes-dashboard` çš„ Helm Release</span></span><br><span class=\"line\">$ helm upgrade --install kubernetes-dashboard kubernetes-dashboard/kubernetes-dashboard \\</span><br><span class=\"line\">    --create-namespace \\</span><br><span class=\"line\">    --namespace kubernetes-dashboard</span><br><span class=\"line\"><span class=\"comment\">## è¾“å‡º</span></span><br><span class=\"line\">Release <span class=\"string\">&quot;kubernetes-dashboard&quot;</span> does not exist. Installing it now.</span><br><span class=\"line\">NAME: kubernetes-dashboard</span><br><span class=\"line\">LAST DEPLOYED: Sun Jul  6 00:40:02 2025</span><br><span class=\"line\">NAMESPACE: kubernetes-dashboard</span><br><span class=\"line\">STATUS: deployed</span><br><span class=\"line\">REVISION: 1</span><br><span class=\"line\">TEST SUITE: None</span><br><span class=\"line\">NOTES:</span><br><span class=\"line\">*************************************************************************************************</span><br><span class=\"line\">*** PLEASE BE PATIENT: Kubernetes Dashboard may need a few minutes to get up and become ready ***</span><br><span class=\"line\">*************************************************************************************************</span><br><span class=\"line\"></span><br><span class=\"line\">Congratulations! You have just installed Kubernetes Dashboard <span class=\"keyword\">in</span> your cluster.</span><br><span class=\"line\"></span><br><span class=\"line\">To access Dashboard run:</span><br><span class=\"line\">  kubectl -n kubernetes-dashboard port-forward svc/kubernetes-dashboard-kong-proxy 8443:443</span><br><span class=\"line\"></span><br><span class=\"line\">NOTE: In <span class=\"keyword\">case</span> port-forward <span class=\"built_in\">command</span> does not work, make sure that kong service name is correct.</span><br><span class=\"line\">      Check the services <span class=\"keyword\">in</span> Kubernetes Dashboard namespace using:</span><br><span class=\"line\">        kubectl -n kubernetes-dashboard get svc</span><br><span class=\"line\"></span><br><span class=\"line\">Dashboard will be available at:</span><br><span class=\"line\">  https://localhost:8443</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹ helm å®‰è£…çš„åŒ…ï¼Œæ³¨æ„æŒ‡å®š å‘½åç©ºé—´</span></span><br><span class=\"line\">$ helm list -n kubernetes-dashboard</span><br><span class=\"line\">NAME                \tNAMESPACE           \tREVISION\tUPDATED                                \tSTATUS  \tCHART                      \tAPP VERSION</span><br><span class=\"line\">kubernetes-dashboard\tkubernetes-dashboard\t1       \t2025-07-24 14:01:06.678570212 +0800 CST\tdeployed\tkubernetes-dashboard-7.13.0</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æŸ¥çœ‹å¯åŠ¨çš„èµ„æº</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ kubectl -n kubernetes-dashboard get all</span><br><span class=\"line\">NAME                                                       READY   STATUS    RESTARTS   AGE</span><br><span class=\"line\">pod/kubernetes-dashboard-api-568f47ddd7-tx6f8              1/1     Running   0          20m</span><br><span class=\"line\">pod/kubernetes-dashboard-auth-645b944589-t6v2m             1/1     Running   0          20m</span><br><span class=\"line\">pod/kubernetes-dashboard-kong-648658d45f-7qsm9             1/1     Running   0          20m</span><br><span class=\"line\">pod/kubernetes-dashboard-metrics-scraper-547874fcf-87mrv   1/1     Running   0          20m</span><br><span class=\"line\">pod/kubernetes-dashboard-web-7796b9fbbb-xsdlw              1/1     Running   0          20m</span><br><span class=\"line\"></span><br><span class=\"line\">NAME                                           TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)    AGE</span><br><span class=\"line\">service/kubernetes-dashboard-api               ClusterIP   10.96.149.59    &lt;none&gt;        8000/TCP   20m</span><br><span class=\"line\">service/kubernetes-dashboard-auth              ClusterIP   10.96.145.120   &lt;none&gt;        8000/TCP   20m</span><br><span class=\"line\">service/kubernetes-dashboard-kong-proxy        ClusterIP   10.96.171.40    &lt;none&gt;        443/TCP    20m</span><br><span class=\"line\">service/kubernetes-dashboard-metrics-scraper   ClusterIP   10.96.79.48     &lt;none&gt;        8000/TCP   20m</span><br><span class=\"line\">service/kubernetes-dashboard-web               ClusterIP   10.96.247.143   &lt;none&gt;        8000/TCP   20m</span><br><span class=\"line\"></span><br><span class=\"line\">NAME                                                   READY   UP-TO-DATE   AVAILABLE   AGE</span><br><span class=\"line\">deployment.apps/kubernetes-dashboard-api               1/1     1            1           20m</span><br><span class=\"line\">deployment.apps/kubernetes-dashboard-auth              1/1     1            1           20m</span><br><span class=\"line\">deployment.apps/kubernetes-dashboard-kong              1/1     1            1           20m</span><br><span class=\"line\">deployment.apps/kubernetes-dashboard-metrics-scraper   1/1     1            1           20m</span><br><span class=\"line\">deployment.apps/kubernetes-dashboard-web               1/1     1            1           20m</span><br><span class=\"line\"></span><br><span class=\"line\">NAME                                                             DESIRED   CURRENT   READY   AGE</span><br><span class=\"line\">replicaset.apps/kubernetes-dashboard-api-568f47ddd7              1         1         1       20m</span><br><span class=\"line\">replicaset.apps/kubernetes-dashboard-auth-645b944589             1         1         1       20m</span><br><span class=\"line\">replicaset.apps/kubernetes-dashboard-kong-648658d45f             1         1         1       20m</span><br><span class=\"line\">replicaset.apps/kubernetes-dashboard-metrics-scraper-547874fcf   1         1         1       20m</span><br><span class=\"line\">replicaset.apps/kubernetes-dashboard-web-7796b9fbbb              1         1         1       20m</span><br></pre></td></tr></table></figure>\n<div class=\"tips\">\n<p><em><strong>å°è´´å£«</strong></em></p>\n<ul class=\"lvl-1\">\n<li class=\"lvl-2\">ç¬¬ä¸€æ¬¡åˆ›å»ºkubernetes-dashboardæ—¶ï¼Œæœ‰å‡ ä¸ª pod ä¸€ç›´å¤„äº ContainerCreating çŠ¶æ€ï¼Œé€šè¿‡ describe å‘½ä»¤ï¼ŒæŸ¥çœ‹ pod çš„çŠ¶æ€å‘ç°æŠ¥å¦‚ä¸‹é”™è¯¯ï¼š</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Warning  FailedCreatePodSandBox  4m52s                kubelet            Failed to create pod sandbox: rpc error: code = Unknown desc = failed to setup network <span class=\"keyword\">for</span> sandbox <span class=\"string\">&quot;cfa0b6062fabd77353e6d832ab0e62f96787b4d59346d9e57c28dbc0e19a3127&quot;</span>: plugin <span class=\"built_in\">type</span>=<span class=\"string\">&quot;calico&quot;</span> failed (add): error getting ClusterInformation: connection is unauthorized: Unauthorized</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-1\">\n<li class=\"lvl-2\">\n<p>è¿™æ¡é”™è¯¯è¯´æ˜ï¼š</p>\n<ul class=\"lvl-3\">\n<li class=\"lvl-6\">å®¹å™¨ç½‘ç»œæ’ä»¶ï¼ˆCNIï¼‰ä½¿ç”¨çš„æ˜¯ Calico</li>\n<li class=\"lvl-6\">Calico åœ¨å°è¯•è·å– Kubernetes é›†ç¾¤çš„ ClusterInformation æ—¶ è®¤è¯å¤±è´¥</li>\n<li class=\"lvl-6\">é”™è¯¯å…³é”®è¯ï¼šconnection is unauthorized: Unauthorized</li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<p>ä¸ç¡®å®šå¯¼è‡´è¿™ä¸€é—®é¢˜çš„åŸå› ï¼Œæˆ‘çš„è§£å†³æ–¹æ³•æ˜¯é‡æ–°å®‰è£… Calico</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl delete -f calico.yaml</span><br><span class=\"line\">kubectl apply -f calico.yaml</span><br></pre></td></tr></table></figure>\n</div>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¼€æ”¾ä»£ç†ç«¯å£</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åœ¨å“ªä¸ªæœºå™¨ä¸Šè¿è¡Œçš„å‘½ä»¤ï¼Œå¼€æ”¾çš„å°±æ˜¯å“ªä¸ªæœºå™¨çš„ç«¯å£</span></span><br><span class=\"line\">kubectl -n kubernetes-dashboard port-forward svc/kubernetes-dashboard-kong-proxy 8443:443</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è®¿é—®ï¼šåœ¨å¼€æ”¾ä»£ç†ç«¯å£çš„æœºå™¨ä¸Šä½¿ç”¨æµè§ˆå™¨è®¿é—®ï¼š<a href=\"https://localhost:8443\">https://localhost:8443</a></p>\n</li>\n</ul>\n<h2 id=\"ç™»å½•å¸å·\">ç™»å½•å¸å·</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ›å»ºç®¡ç†å‘˜ç”¨æˆ·</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># dashboard-adminuser.yaml</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">ServiceAccount</span>                    <span class=\"comment\"># åˆ›å»º ServiceAccount</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">admin-user</span>                      <span class=\"comment\"># SA åç§°</span></span><br><span class=\"line\">  <span class=\"attr\">namespace:</span> <span class=\"string\">kubernetes-dashboard</span>       <span class=\"comment\"># SA æ‰€åœ¨å‘½åç©ºé—´</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">rbac.authorization.k8s.io/v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">ClusterRoleBinding</span>                <span class=\"comment\"># é›†ç¾¤è§’è‰²ç»‘å®š</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">admin-user</span></span><br><span class=\"line\"><span class=\"attr\">roleRef:</span></span><br><span class=\"line\">  <span class=\"attr\">apiGroup:</span> <span class=\"string\">rbac.authorization.k8s.io</span>   <span class=\"comment\"># é›†ç¾¤è§’è‰²ç»„ï¼Œè¿™ä¸ªæ˜¯ k8s å†…ç½®çš„</span></span><br><span class=\"line\">  <span class=\"attr\">kind:</span> <span class=\"string\">ClusterRole</span>                     <span class=\"comment\"># é›†ç¾¤è§’è‰²</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">cluster-admin</span>                   <span class=\"comment\"># é›†ç¾¤ç®¡ç†å‘˜è§’è‰²</span></span><br><span class=\"line\"><span class=\"attr\">subjects:</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">kind:</span> <span class=\"string\">ServiceAccount</span>                  <span class=\"comment\"># æœåŠ¡è´¦å·</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">admin-user</span>                      <span class=\"comment\"># æœåŠ¡è´¦å·åç§°</span></span><br><span class=\"line\">  <span class=\"attr\">namespace:</span> <span class=\"string\">kubernetes-dashboard</span>       <span class=\"comment\"># æœåŠ¡è´¦å·å‘½åç©ºé—´</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ›å»ºå¹¶è·å–token</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl apply -f dashboard-adminuser.yaml</span><br><span class=\"line\"><span class=\"comment\"># è·å–tokenï¼Œè¯¥ token æœ‰æ•ˆæœŸä¸º 1 å°æ—¶ï¼Œtokenæ ¼å¼ä¸º jwtï¼Œå¯ä»¥é€šè¿‡ jwt.io è§£æ</span></span><br><span class=\"line\">kubectl -n kubernetes-dashboard create token admin-user</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è·å–é•¿æ•ˆtoken</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># dashboard-secret.yaml</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Secret</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">admin-user</span></span><br><span class=\"line\">  <span class=\"attr\">namespace:</span> <span class=\"string\">kubernetes-dashboard</span></span><br><span class=\"line\">  <span class=\"attr\">annotations:</span></span><br><span class=\"line\">    <span class=\"attr\">kubernetes.io/service-account.name:</span> <span class=\"string\">&quot;admin-user&quot;</span></span><br><span class=\"line\"><span class=\"attr\">type:</span> <span class=\"string\">kubernetes.io/service-account-token</span></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl apply -f dashboard-secret.yaml</span><br><span class=\"line\"><span class=\"comment\"># è¯¥å‘½ä»¤è·å–tokenï¼Œæ°¸ä¸è¿‡æœŸï¼Œå°†å…¶ä¿å­˜ä¸‹æ¥</span></span><br><span class=\"line\">kubectl get secret admin-user -n kubernetes-dashboard -o jsonpath=<span class=\"string\">&quot;&#123;.data.token&#125;&quot;</span> | <span class=\"built_in\">base64</span> -d</span><br></pre></td></tr></table></figure>\n<h2 id=\"å¸è½½-kubernetes-dashboard\">å¸è½½ kubernetes-dashboard</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¸è½½ kubernetes-dashboard</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">helm uninstall kubernetes-dashboard --namespace kubernetes-dashboard</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ¸…ç†ç”¨æˆ·ä¿¡æ¯</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl -n kubernetes-dashboard delete serviceaccount admin-user</span><br><span class=\"line\">kubectl -n kubernetes-dashboard delete clusterrolebinding admin-user</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ä¹Ÿå¯ä»¥ç›´æ¥åˆ é™¤ å‘½åç©ºé—´ï¼Œåˆ é™¤å‘½åç©ºé—´ä¼šåŒæ—¶åˆ é™¤æ‰€æœ‰èµ„æº</span></span><br><span class=\"line\">kubectl delete namespace kubernetes-dashboard</span><br></pre></td></tr></table></figure>\n","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» K8S çš„ UI ç®¡ç†å·¥å…· Dashboardï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚ K8Så®˜ç½‘ k8s Github Dashboard k8sä»‹ç» Dashboard ç®€ä»‹ Dashboard æ˜¯åŸºäºç½‘é¡µçš„ Kubernetes ç”¨æˆ·ç•Œé¢ã€‚ ä½ å¯ä»¥ä½¿ç”¨ Dashboard å°†å®¹å™¨åº”ç”¨éƒ¨ç½²åˆ° Kubernetes é›†ç¾¤ä¸­ï¼Œä¹Ÿå¯ä»¥å¯¹å®¹å™¨åº”ç”¨æ’é”™ï¼Œè¿˜èƒ½ç®¡ç†é›†ç¾¤èµ„æºã€‚ ä½ å¯ä»¥ä½¿ç”¨ Dashboard è·å–è¿è¡Œåœ¨é›†ç¾¤ä¸­çš„åº”ç”¨çš„æ¦‚è§ˆä¿¡æ¯ï¼Œä¹Ÿå¯ä»¥åˆ›å»ºæˆ–è€…ä¿®æ”¹ Kubernetes èµ„æº ï¼ˆå¦‚ Deploymentã€Jobã€DaemonSet ç­‰ç­‰ï¼‰ã€‚ ä¾‹å¦‚ï¼Œä½ å¯ä»¥å¯¹ Deployment å®ç°å¼¹æ€§ä¼¸ç¼©ã€å‘èµ·æ»šåŠ¨å‡çº§ã€é‡å¯ Pod æˆ–è€…ä½¿ç”¨å‘å¯¼åˆ›å»ºæ–°çš„åº”ç”¨ã€‚ Dashboard åŒæ—¶å±•ç¤ºäº† Kubernetes é›†ç¾¤ä¸­çš„èµ„æºçŠ¶æ€ä¿¡æ¯å’Œæ‰€æœ‰æŠ¥é”™ä¿¡æ¯ã€‚ éƒ¨ç½² Dashboard Kubernetes Dashboard ç›®å‰ä»…æ”¯æŒåŸºäº Helm çš„å®‰è£…ï¼Œå› ä¸ºå®ƒé€Ÿåº¦æ›´å¿«ï¼Œ å¹¶ä¸”å¯ä»¥è®©æˆ‘ä»¬æ›´å¥½åœ°æ§åˆ¶ Dashboard è¿è¡Œæ‰€éœ€çš„æ‰€æœ‰ä¾èµ–é¡¹ã€‚ 1234567891011121314151617181920212223242526272829303132333435# æ·»åŠ  kubernetes-dashboard ä»“åº“helm repo add kubernetes-dashboard https://kubernetes.github.io/dashboard/# ä½¿ç”¨ kubernetes-dashboard Chart éƒ¨ç½²åä¸º `kubernetes-dashboard` çš„ Helm Release$ helm upgrade --install kubernetes-dashboard kubernetes-dashboard/kubernetes-dashboard \\ --create-namespace \\ --namespace kubernetes-dashboard## è¾“å‡ºRelease &quot;kubernetes-dashboard&quot; does not exist. Installing it now.NAME: kubernetes-dashboardLAST DEPLOYED: Sun Jul 6 00:40:02 2025NAMESPACE: kubernetes-dashboardSTATUS: deployedREVISION: 1TEST SUITE: NoneNOTES:**************************************************************************************************** PLEASE BE PATIENT: Kubernetes Dashboard may need a few minutes to get up and become ready ****************************************************************************************************Congratulations! You have just installed Kubernetes Dashboard in your cluster.To access Dashboard run: kubectl -n kubernetes-dashboard port-forward svc/kubernetes-dashboard-kong-proxy 8443:443NOTE: In case port-forward command does not work, make sure that kong service name is correct. Check the services in Kubernetes Dashboard namespace using: kubectl -n kubernetes-dashboard get svcDashboard will be available at: https://localhost:8443# æŸ¥çœ‹ helm å®‰è£…çš„åŒ…ï¼Œæ³¨æ„æŒ‡å®š å‘½åç©ºé—´$ helm list -n kubernetes-dashboardNAME NAMESPACE REVISION UPDATED STATUS CHART APP VERSIONkubernetes-dashboard kubernetes-dashboard 1 2025-07-24 14:01:06.678570212 +0800 CST deployed kubernetes-dashboard-7.13.0 æŸ¥çœ‹å¯åŠ¨çš„èµ„æº 12345678910111213141516171819202122232425262728$ kubectl -n kubernetes-dashboard get allNAME READY STATUS RESTARTS AGEpod/kubernetes-dashboard-api-568f47ddd7-tx6f8 1/1 Running 0 20mpod/kubernetes-dashboard-auth-645b944589-t6v2m 1/1 Running 0 20mpod/kubernetes-dashboard-kong-648658d45f-7qsm9 1/1 Running 0 20mpod/kubernetes-dashboard-metrics-scraper-547874fcf-87mrv 1/1 Running 0 20mpod/kubernetes-dashboard-web-7796b9fbbb-xsdlw 1/1 Running 0 20mNAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGEservice/kubernetes-dashboard-api ClusterIP 10.96.149.59 &lt;none&gt; 8000/TCP 20mservice/kubernetes-dashboard-auth ClusterIP 10.96.145.120 &lt;none&gt; 8000/TCP 20mservice/kubernetes-dashboard-kong-proxy ClusterIP 10.96.171.40 &lt;none&gt; 443/TCP 20mservice/kubernetes-dashboard-metrics-scraper ClusterIP 10.96.79.48 &lt;none&gt; 8000/TCP 20mservice/kubernetes-dashboard-web ClusterIP 10.96.247.143 &lt;none&gt; 8000/TCP 20mNAME READY UP-TO-DATE AVAILABLE AGEdeployment.apps/kubernetes-dashboard-api 1/1 1 1 20mdeployment.apps/kubernetes-dashboard-auth 1/1 1 1 20mdeployment.apps/kubernetes-dashboard-kong 1/1 1 1 20mdeployment.apps/kubernetes-dashboard-metrics-scraper 1/1 1 1 20mdeployment.apps/kubernetes-dashboard-web 1/1 1 1 20mNAME DESIRED CURRENT READY AGEreplicaset.apps/kubernetes-dashboard-api-568f47ddd7 1 1 1 20mreplicaset.apps/kubernetes-dashboard-auth-645b944589 1 1 1 20mreplicaset.apps/kubernetes-dashboard-kong-648658d45f 1 1 1 20mreplicaset.apps/kubernetes-dashboard-metrics-scraper-547874fcf 1 1 1 20mreplicaset.apps/kubernetes-dashboard-web-7796b9fbbb 1 1 1 20m å°è´´å£« ç¬¬ä¸€æ¬¡åˆ›å»ºkubernetes-dashboardæ—¶ï¼Œæœ‰å‡ ä¸ª pod ä¸€ç›´å¤„äº ContainerCreating çŠ¶æ€ï¼Œé€šè¿‡ describe å‘½ä»¤ï¼ŒæŸ¥çœ‹ pod çš„çŠ¶æ€å‘ç°æŠ¥å¦‚ä¸‹é”™è¯¯ï¼š 1Warning FailedCreatePodSandBox 4m52s kubelet Failed to create pod sandbox: rpc error: code = Unknown desc = failed to setup network for sandbox &quot;cfa0b6062fabd77353e6d832ab0e62f96787b4d59346d9e57c28dbc0e19a3127&quot;: plugin type=&quot;calico&quot; failed (add): error getting ClusterInformation: connection is unauthorized: Unauthorized è¿™æ¡é”™è¯¯è¯´æ˜ï¼š å®¹å™¨ç½‘ç»œæ’ä»¶ï¼ˆCNIï¼‰ä½¿ç”¨çš„æ˜¯ Calico Calico åœ¨å°è¯•è·å– Kubernetes é›†ç¾¤çš„ ClusterInformation æ—¶ è®¤è¯å¤±è´¥ é”™è¯¯å…³é”®è¯ï¼šconnection is unauthorized: Unauthorized ä¸ç¡®å®šå¯¼è‡´è¿™ä¸€é—®é¢˜çš„åŸå› ï¼Œæˆ‘çš„è§£å†³æ–¹æ³•æ˜¯é‡æ–°å®‰è£… Calico 12kubectl delete -f calico.yamlkubectl apply -f calico.yaml å¼€æ”¾ä»£ç†ç«¯å£ 12# åœ¨å“ªä¸ªæœºå™¨ä¸Šè¿è¡Œçš„å‘½ä»¤ï¼Œå¼€æ”¾çš„å°±æ˜¯å“ªä¸ªæœºå™¨çš„ç«¯å£kubectl -n kubernetes-dashboard port-forward svc/kubernetes-dashboard-kong-proxy 8443:443 è®¿é—®ï¼šåœ¨å¼€æ”¾ä»£ç†ç«¯å£çš„æœºå™¨ä¸Šä½¿ç”¨æµè§ˆå™¨è®¿é—®ï¼šhttps://localhost:8443 ç™»å½•å¸å· åˆ›å»ºç®¡ç†å‘˜ç”¨æˆ· 12345678910111213141516171819# dashboard-adminuser.yamlapiVersion: v1kind: ServiceAccount # åˆ›å»º ServiceAccountmetadata: name: admin-user # SA åç§° namespace: kubernetes-dashboard # SA æ‰€åœ¨å‘½åç©ºé—´---apiVersion: rbac.authorization.k8s.io/v1kind: ClusterRoleBinding # é›†ç¾¤è§’è‰²ç»‘å®šmetadata: name: admin-userroleRef: apiGroup: rbac.authorization.k8s.io # é›†ç¾¤è§’è‰²ç»„ï¼Œè¿™ä¸ªæ˜¯ k8s å†…ç½®çš„ kind: ClusterRole # é›†ç¾¤è§’è‰² name: cluster-admin # é›†ç¾¤ç®¡ç†å‘˜è§’è‰²subjects:- kind: ServiceAccount # æœåŠ¡è´¦å· name: admin-user # æœåŠ¡è´¦å·åç§° namespace: kubernetes-dashboard # æœåŠ¡è´¦å·å‘½åç©ºé—´ åˆ›å»ºå¹¶è·å–token 123kubectl apply -f dashboard-adminuser.yaml# è·å–tokenï¼Œè¯¥ token æœ‰æ•ˆæœŸä¸º 1 å°æ—¶ï¼Œtokenæ ¼å¼ä¸º jwtï¼Œå¯ä»¥é€šè¿‡ jwt.io è§£ækubectl -n kubernetes-dashboard create token admin-user è·å–é•¿æ•ˆtoken 123456789# dashboard-secret.yamlapiVersion: v1kind: Secretmetadata: name: admin-user namespace: kubernetes-dashboard annotations: kubernetes.io/service-account.name: &quot;admin-user&quot;type: kubernetes.io/service-account-token 123kubectl apply -f dashboard-secret.yaml# è¯¥å‘½ä»¤è·å–tokenï¼Œæ°¸ä¸è¿‡æœŸï¼Œå°†å…¶ä¿å­˜ä¸‹æ¥kubectl get secret admin-user -n kubernetes-dashboard -o jsonpath=&quot;&#123;.data.token&#125;&quot; | base64 -d å¸è½½ kubernetes-dashboard å¸è½½ kubernetes-dashboard 1helm uninstall kubernetes-dashboard --namespace kubernetes-dashboard æ¸…ç†ç”¨æˆ·ä¿¡æ¯ 12345kubectl -n kubernetes-dashboard delete serviceaccount admin-userkubectl -n kubernetes-dashboard delete clusterrolebinding admin-user# ä¹Ÿå¯ä»¥ç›´æ¥åˆ é™¤ å‘½åç©ºé—´ï¼Œåˆ é™¤å‘½åç©ºé—´ä¼šåŒæ—¶åˆ é™¤æ‰€æœ‰èµ„æºkubectl delete namespace kubernetes-dashboard","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» K8S çš„ UI ç®¡ç†å·¥å…· Dashboardï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚ K8Så®˜ç½‘ k8s Github Dashboard k8sä»‹ç»","date_published":"2025-07-24T13:33:05.000Z","tags":["æŠ€æœ¯","k8s","K8S"]},{"id":"https://blog.hanqunfeng.com/2025/07/24/k8s-tools/","url":"https://blog.hanqunfeng.com/2025/07/24/k8s-tools/","title":"K8S ä¹‹ Tools","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-3\">\n<p>K8S çš„ Toolsï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://kubernetes.io/zh-cn/\">K8Så®˜ç½‘</a></p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://github.com/kubernetes/kubernetes\">k8s Github</a></p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"crictl-å‘½ä»¤\">crictl å‘½ä»¤</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><code>crictl</code> æ˜¯k8så®˜æ–¹å‡ºå“çš„ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼Œç”¨äºä¸ containerd è¿›è¡Œé€šä¿¡ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><code>crictl</code> å‘½ä»¤é»˜è®¤éœ€è¦ sudo æƒé™ï¼Œå¦‚æœä¸æƒ³æ¯æ¬¡éƒ½åŠ  sudoï¼Œå¯ä»¥å°†ç”¨æˆ·åŠ å…¥ containerd çš„ socket æƒé™ç»„</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># containerd çš„é»˜è®¤ socket æ˜¯ /var/run/containerd/containerd.sock</span></span><br><span class=\"line\">$ <span class=\"built_in\">ls</span> -l /var/run/containerd/containerd.sock</span><br><span class=\"line\">srw-rw---- 1 root root 0 7æœˆ   1 10:57 /var/run/containerd/containerd.sock</span><br><span class=\"line\"><span class=\"comment\"># å¦‚æœ group æ˜¯ rootï¼šä½ å¯ä»¥æ”¹ä¸ºå…¶å®ƒç»„ï¼Œæ¯”å¦‚ docker</span></span><br><span class=\"line\"><span class=\"comment\"># å¦‚æœ docker ç»„ä¸å­˜åœ¨åˆ™åˆ›å»º</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> groupadd docker</span><br><span class=\"line\"><span class=\"comment\"># ä¿®æ”¹æ–‡ä»¶æ‰€å±ç»„ä¸º docker</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> <span class=\"built_in\">chgrp</span> docker /var/run/containerd/containerd.sock</span><br><span class=\"line\"><span class=\"comment\"># ä¸ºç»„æ·»åŠ è¯»å†™æƒé™</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> <span class=\"built_in\">chmod</span> g+rw /var/run/containerd/containerd.sock</span><br><span class=\"line\"><span class=\"comment\"># æ·»åŠ ç”¨æˆ·åˆ° docker ç»„</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> usermod -aG docker <span class=\"variable\">$USER</span></span><br><span class=\"line\"><span class=\"comment\"># åˆ·æ–°æƒé™</span></span><br><span class=\"line\">newgrp docker</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ­¤æ—¶è™½ç„¶å·²ç»å¯ä»¥ä¸ç”¨ sudo äº†ï¼Œä½†æ˜¯ä¸€æ—¦é‡å¯ containerd å°±ä¼šé‡æ–°å›åˆ° root æƒé™ï¼Œå› æ­¤éœ€è¦æ·»åŠ å¦‚ä¸‹é…ç½®</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> <span class=\"built_in\">mkdir</span> -p /etc/systemd/system/containerd.service.d/</span><br><span class=\"line\"><span class=\"built_in\">sudo</span> <span class=\"built_in\">tee</span> /etc/systemd/system/containerd.service.d/override.conf &lt;&lt;<span class=\"string\">EOF</span></span><br><span class=\"line\"><span class=\"string\">[Service]</span></span><br><span class=\"line\"><span class=\"string\">ExecStartPost=/bin/bash -c &#x27;chmod 660 /run/containerd/containerd.sock &amp;&amp; chgrp docker /run/containerd/containerd.sock&#x27;</span></span><br><span class=\"line\"><span class=\"string\">EOF</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> systemctl daemon-reload</span><br><span class=\"line\"><span class=\"built_in\">sudo</span> systemctl restart containerd</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><code>crictl</code> å‘½ä»¤çš„ä½¿ç”¨æ–¹å¼æ¯”è¾ƒç±»ä¼¼<code>docker</code>å‘½ä»¤</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>æ“ä½œ</th>\n<th><code>docker</code> å‘½ä»¤</th>\n<th><code>crictl</code> å‘½ä»¤</th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>æŸ¥çœ‹æ­£åœ¨è¿è¡Œçš„å®¹å™¨</td>\n<td><code>docker ps</code></td>\n<td><code>crictl ps</code></td>\n<td></td>\n</tr>\n<tr>\n<td>æŸ¥çœ‹æ‰€æœ‰å®¹å™¨ï¼ˆåŒ…æ‹¬å·²åœæ­¢ï¼‰</td>\n<td><code>docker ps -a</code></td>\n<td><code>crictl ps -a</code></td>\n<td></td>\n</tr>\n<tr>\n<td>æŸ¥çœ‹é•œåƒ</td>\n<td><code>docker images</code></td>\n<td><code>crictl images</code></td>\n<td></td>\n</tr>\n<tr>\n<td>æŸ¥çœ‹å®¹å™¨æ—¥å¿—</td>\n<td><code>docker logs &lt;container_id&gt;</code></td>\n<td><code>crictl logs &lt;container_id&gt;</code></td>\n<td></td>\n</tr>\n<tr>\n<td>è¿›å…¥å®¹å™¨äº¤äº’</td>\n<td><code>docker exec -it &lt;id&gt; sh</code></td>\n<td><code>crictl exec -it &lt;id&gt; sh</code></td>\n<td></td>\n</tr>\n<tr>\n<td>æŸ¥çœ‹å®¹å™¨è¯¦ç»†ä¿¡æ¯</td>\n<td><code>docker inspect &lt;container_id&gt;</code></td>\n<td><code>crictl inspect &lt;container_id&gt;</code></td>\n<td></td>\n</tr>\n<tr>\n<td>æŸ¥çœ‹ Pod è¯¦ç»†ä¿¡æ¯</td>\n<td>âŒï¼ˆä¸æ”¯æŒï¼‰</td>\n<td><code>crictl inspectp &lt;pod_id&gt;</code></td>\n<td>K8s ä¸“å±</td>\n</tr>\n<tr>\n<td>åˆ é™¤å®¹å™¨</td>\n<td><code>docker rm &lt;container_id&gt;</code></td>\n<td><code>crictl rm &lt;container_id&gt;</code></td>\n<td></td>\n</tr>\n<tr>\n<td>åˆ é™¤é•œåƒ</td>\n<td><code>docker rmi &lt;image_id&gt;</code></td>\n<td><code>crictl rmi &lt;image_id&gt;</code></td>\n<td></td>\n</tr>\n<tr>\n<td>æ‹‰å–é•œåƒ</td>\n<td><code>docker pull nginx</code></td>\n<td><code>crictl pull nginx</code></td>\n<td></td>\n</tr>\n<tr>\n<td>è¿è¡Œå®¹å™¨ï¼ˆé K8s åœºæ™¯ï¼‰</td>\n<td><code>docker run -it nginx</code></td>\n<td>âŒï¼ˆä¸æ”¯æŒï¼‰</td>\n<td><code>crictl</code> ä¸è¿è¡Œå®¹å™¨ï¼Œä»…è°ƒè¯•ç°æœ‰å®¹å™¨</td>\n</tr>\n<tr>\n<td>åˆ—å‡ºå®¹å™¨è¿è¡Œæ—¶ä¿¡æ¯</td>\n<td><code>docker info</code></td>\n<td><code>crictl info</code></td>\n<td></td>\n</tr>\n<tr>\n<td>æŸ¥çœ‹å®¹å™¨è¿è¡ŒçŠ¶æ€</td>\n<td><code>docker stats</code></td>\n<td><code>crictl stats</code></td>\n<td>ç®€è¦ç‰ˆ</td>\n</tr>\n<tr>\n<td>è®¾ç½®é…ç½®æ–‡ä»¶</td>\n<td><code>~/.docker/config.json</code></td>\n<td><code>/etc/crictl.yaml</code></td>\n<td>å¦‚è®¾ç½® endpoint</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"nerdctl\">nerdctl</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><a href=\"https://github.com/containerd/nerdctl\">nerdctl</a> æ˜¯ä¸€ä¸ª å…¼å®¹ Docker CLI çš„å®¹å™¨å‘½ä»¤è¡Œå·¥å…·ï¼Œç”¨äºç®¡ç† containerd å®¹å™¨è¿è¡Œæ—¶ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å®ƒæ˜¯ containerd å®˜æ–¹å­é¡¹ç›®ï¼Œç”± CNCF ç»´æŠ¤ï¼Œå…¶å‘½ä»¤è¯­æ³•ä¸ Docker CLI å…¼å®¹ï¼Œç›®æ ‡æ˜¯è®©ä¹ æƒ¯ Docker çš„ç”¨æˆ·ä¹Ÿèƒ½è½»æ¾ä½¿ç”¨ containerdã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å®‰è£… nerdctl</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 1. ä¸‹è½½æœ€æ–°ç‰ˆæœ¬</span></span><br><span class=\"line\">VERSION=2.1.3</span><br><span class=\"line\">wget https://github.com/containerd/nerdctl/releases/download/v<span class=\"variable\">$&#123;VERSION&#125;</span>/nerdctl-<span class=\"variable\">$&#123;VERSION&#125;</span>-linux-amd64.tar.gz</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 2. è§£å‹</span></span><br><span class=\"line\">tar -xvf nerdctl-<span class=\"variable\">$&#123;VERSION&#125;</span>-linux-amd64.tar.gz</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 3. ç§»åŠ¨åˆ°ç³»ç»Ÿ PATH</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> <span class=\"built_in\">mv</span> nerdctl /usr/local/bin/</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># nerdctl éœ€è¦ sudo æƒé™</span></span><br><span class=\"line\"><span class=\"comment\">## ä¸º sudo æ·»åŠ  PATH</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> visudo</span><br><span class=\"line\"><span class=\"comment\">## æ‰¾åˆ°è¿™ä¸€è¡Œ</span></span><br><span class=\"line\">Defaults    secure_path = /sbin:/bin:/usr/sbin:/usr/bin</span><br><span class=\"line\"><span class=\"comment\">## ä¿®æ”¹ä¸ºï¼Œå³å°† nerdctl æ‰€åœ¨çš„ç›®å½•åŠ å…¥ PATH</span></span><br><span class=\"line\">Defaults    secure_path = /sbin:/bin:/usr/sbin:/usr/bin:/usr/local/bin</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 4.æµ‹è¯•</span></span><br><span class=\"line\"><span class=\"comment\">## æŸ¥çœ‹ç‰ˆæœ¬</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> nerdctl version</span><br><span class=\"line\"><span class=\"comment\">## åˆ—å‡ºå®¹å™¨ï¼Œ--namespace k8s.io è¡¨ç¤ºæŸ¥çœ‹ k8s ä¸­çš„å®¹å™¨</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> nerdctl ps --namespace k8s.io</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">## å¦‚æœä¸æƒ³æ¯æ¬¡éƒ½åŠ ä¸Š --namespace k8s.ioï¼Œå¯ä»¥è®¾ç½®åˆ«å</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;alias kps=&#x27;sudo nerdctl --namespace=k8s.io ps&#x27;&quot;</span> &gt;&gt; ~/.bashrc</span><br><span class=\"line\"><span class=\"built_in\">source</span> ~/.bashrc</span><br><span class=\"line\"><span class=\"comment\">## æµ‹è¯•</span></span><br><span class=\"line\">kps</span><br></pre></td></tr></table></figure>\n<h2 id=\"Helm\">Helm</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><a href=\"https://helm.sh/zh/docs/\">å®˜ç½‘æ–‡æ¡£</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>Helm æ˜¯ Kubernetes çš„åŒ…ç®¡ç†å™¨ï¼Œç±»ä¼¼äº Linux ä¸‹çš„åŒ…ç®¡ç†å·¥å…·å¦‚ yumã€apt ç­‰ã€‚å¯ä»¥æ–¹ä¾¿çš„å°†ä¹‹å‰æ‰“åŒ…å¥½çš„ yaml æ–‡ä»¶éƒ¨ç½²åˆ° Kunernetes ä¸Šã€‚</p>\n</li>\n</ul>\n<h3 id=\"Helmçš„å®‰è£…\">Helmçš„å®‰è£…</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å®˜ç½‘<a href=\"https://helm.sh/zh/docs/intro/install/\">å®‰è£…æ–¹æ³•</a></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget https://get.helm.sh/helm-v3.17.4-linux-amd64.tar.gz</span><br><span class=\"line\">tar -zxvf helm-v3.17.4-linux-amd64.tar.gz</span><br><span class=\"line\"><span class=\"built_in\">sudo</span> <span class=\"built_in\">mv</span> linux-amd64/helm /usr/local/bin/helm</span><br><span class=\"line\">$ helm version</span><br><span class=\"line\">version.BuildInfo&#123;Version:<span class=\"string\">&quot;v3.17.4&quot;</span>, GitCommit:<span class=\"string\">&quot;595a05da6166037d0abebaa27ac8a498fa4d7ed2&quot;</span>, GitTreeState:<span class=\"string\">&quot;clean&quot;</span>, GoVersion:<span class=\"string\">&quot;go1.23.10&quot;</span>&#125;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Helm<a href=\"https://helm.sh/zh/docs/helm/helm_completion_bash/\">è‡ªåŠ¨è¡¥å…¨</a></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å®‰è£… helm çš„è‡ªåŠ¨è¡¥å…¨åŠŸèƒ½</span></span><br><span class=\"line\"><span class=\"comment\"># 1 å½“å‰ç”¨æˆ·</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&#x27;source &lt;(helm completion bash)&#x27;</span> &gt;&gt; ~/.bashrc</span><br><span class=\"line\"><span class=\"built_in\">source</span> ~/.bashrc</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 2 æ‰€æœ‰ç”¨æˆ·</span></span><br><span class=\"line\">helm completion bash | <span class=\"built_in\">sudo</span> <span class=\"built_in\">tee</span> /etc/bash_completion.d/helm &gt; /dev/null</span><br><span class=\"line\"><span class=\"built_in\">sudo</span> <span class=\"built_in\">chmod</span> a+r /etc/bash_completion.d/helm</span><br></pre></td></tr></table></figure>\n<h3 id=\"Helmçš„ä½¿ç”¨\">Helmçš„ä½¿ç”¨</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¯ä»¥å‚è€ƒ <a href=\"/2023/07/10/aws-eks14-helm/\" title=\"AWS-EKS-14--Helm\">AWS-EKS-14--Helm</a></p>\n</li>\n</ul>\n<h4 id=\"ä»“åº“ç®¡ç†\">ä»“åº“ç®¡ç†</h4>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>addï¼šæ·»åŠ å›¾è¡¨å­˜å‚¨åº“</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">helm repo add bitnami https://charts.bitnami.com/bitnami</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>listï¼šåˆ—å‡ºå›¾è¡¨å­˜å‚¨åº“</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">helm repo list</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>removeï¼šåˆ é™¤å›¾è¡¨å­˜å‚¨åº“</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">helm repo remove bitnami</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>updateï¼šä»å›¾è¡¨å­˜å‚¨åº“æ›´æ–°æœ¬åœ°å¯ç”¨å›¾è¡¨çš„ä¿¡æ¯</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æ›´æ–°æ‰€æœ‰ä»“åº“</span></span><br><span class=\"line\">helm repo update</span><br><span class=\"line\"><span class=\"comment\"># æ›´æ–°æŒ‡å®šçš„ä»“åº“</span></span><br><span class=\"line\">helm repo update bitnami</span><br></pre></td></tr></table></figure>\n<h4 id=\"åœ¨ä»“åº“ä¸­æœç´¢\">åœ¨ä»“åº“ä¸­æœç´¢</h4>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åœ¨æ‰€æœ‰ä»“åº“ä¸­æœç´¢ï¼Œé»˜è®¤åªå±•ç¤ºæœ€æ–°çš„ç‰ˆæœ¬</span></span><br><span class=\"line\">helm search repo nginx</span><br><span class=\"line\"><span class=\"comment\"># åœ¨æŒ‡å®šçš„ä»“åº“ä¸­æœç´¢</span></span><br><span class=\"line\">helm search repo bitnami/wordpress</span><br><span class=\"line\"><span class=\"comment\"># æ˜¾ç¤ºæ‰€æœ‰ç‰ˆæœ¬</span></span><br><span class=\"line\">helm search repo nginx -l</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åœ¨å…¨éƒ¨ç‰ˆæœ¬ä¸­æœç´¢å¤§äºç­‰äºæŒ‡å®šç‰ˆæœ¬</span></span><br><span class=\"line\">$ helm search repo nginx --version ^21.0.0 -l</span><br><span class=\"line\">NAME         \tCHART VERSION\tAPP VERSION\tDESCRIPTION</span><br><span class=\"line\">bitnami/nginx\t21.0.8       \t1.29.0     \tNGINX Open Source is a web server that can be a...</span><br><span class=\"line\">bitnami/nginx\t21.0.7       \t1.29.0     \tNGINX Open Source is a web server that can be a...</span><br><span class=\"line\">bitnami/nginx\t21.0.6       \t1.29.0     \tNGINX Open Source is a web server that can be a...</span><br><span class=\"line\">bitnami/nginx\t21.0.4       \t1.29.0     \tNGINX Open Source is a web server that can be a...</span><br><span class=\"line\">bitnami/nginx\t21.0.3       \t1.29.0     \tNGINX Open Source is a web server that can be a...</span><br><span class=\"line\">bitnami/nginx\t21.0.2       \t1.29.0     \tNGINX Open Source is a web server that can be a...</span><br><span class=\"line\">bitnami/nginx\t21.0.1       \t1.29.0     \tNGINX Open Source is a web server that can be a...</span><br><span class=\"line\">bitnami/nginx\t21.0.0       \t1.29.0     \tNGINX Open Source is a web server that can be a...</span><br></pre></td></tr></table></figure>\n<h4 id=\"å®‰è£…åŒ…\">å®‰è£…åŒ…</h4>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å®‰è£…æœ€æ–°ç‰ˆ</span></span><br><span class=\"line\">helm install nginx bitnami/nginx</span><br><span class=\"line\"><span class=\"comment\"># å®‰è£…æŒ‡å®šç‰ˆæœ¬</span></span><br><span class=\"line\">helm install nginx bitnami/nginx --version 21.0.3</span><br><span class=\"line\"><span class=\"comment\"># å®‰è£…åŒ…åˆ°æŒ‡å®šå‘½åç©ºé—´</span></span><br><span class=\"line\">helm install nginx bitnami/nginx -n &lt;namespace&gt;</span><br><span class=\"line\"><span class=\"comment\"># å®‰è£…åŒ…å¹¶åˆ›å»ºå‘½åç©ºé—´</span></span><br><span class=\"line\">helm install nginx bitnami/nginx -n &lt;namespace&gt; --create-namespace</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å®‰è£…æœ¬åœ° chart ç›®å½•</span></span><br><span class=\"line\">helm install my-release ./nginx</span><br><span class=\"line\"><span class=\"comment\"># å®‰è£… .tgz æ ¼å¼çš„æ‰“åŒ… chart</span></span><br><span class=\"line\">helm install my-release ./nginx-1.2.3.tgz</span><br><span class=\"line\"><span class=\"comment\"># ä»è¿œç¨‹tgzå®‰è£…</span></span><br><span class=\"line\">helm install my-release https://example.com/charts/nginx-1.2.3.tgz</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å®‰è£… Git ä»“åº“ä¸­çš„ chartï¼ˆç»“åˆ pluginï¼‰</span></span><br><span class=\"line\">helm plugin install https://github.com/aslafy-z/helm-git</span><br><span class=\"line\">helm repo add mychart <span class=\"string\">&#x27;git+https://github.com/myorg/mychart.git&#x27;</span></span><br><span class=\"line\">helm install my-release mychart/nginx</span><br><span class=\"line\"><span class=\"comment\"># å¸è½½helm-gitæ’ä»¶</span></span><br><span class=\"line\">helm plugin remove helm-git</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ä½¿ç”¨ --set ä¼ é€’å•ä¸ªæˆ–å¤šä¸ªå€¼</span></span><br><span class=\"line\">helm install my-release bitnami/nginx --<span class=\"built_in\">set</span> service.type=NodePort</span><br><span class=\"line\"><span class=\"comment\"># ä½¿ç”¨ --values æˆ– -f åŠ è½½ YAML é…ç½®æ–‡ä»¶</span></span><br><span class=\"line\">helm install my-release bitnami/nginx -f custom-values.yaml</span><br><span class=\"line\"><span class=\"comment\"># åŒæ—¶ä½¿ç”¨å¤šç§ values æ–‡ä»¶ + --set</span></span><br><span class=\"line\">helm install my-release bitnami/nginx -f base.yaml -f prod.yaml --<span class=\"built_in\">set</span> replicaCount=3</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h4 id=\"æŸ¥çœ‹å·²ç»å®‰è£…çš„åŒ…\">æŸ¥çœ‹å·²ç»å®‰è£…çš„åŒ…</h4>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹æŒ‡å®šå‘½åç©ºé—´å·²å®‰è£…çš„åŒ…</span></span><br><span class=\"line\">helm list -n &lt;namespace&gt;</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹æ‰€æœ‰å·²å®‰è£…çš„åŒ…</span></span><br><span class=\"line\">helm list -A</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹å·²å®‰è£…çš„åŒ…çŠ¶æ€</span></span><br><span class=\"line\">helm status ngxin -n &lt;namespace&gt;</span><br></pre></td></tr></table></figure>\n<h4 id=\"å¸è½½åŒ…\">å¸è½½åŒ…</h4>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">helm uninstall nginx -n &lt;namespace&gt;</span><br></pre></td></tr></table></figure>","content_text":"æ‘˜è¦ K8S çš„ Toolsï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚ K8Så®˜ç½‘ k8s Github crictl å‘½ä»¤ crictl æ˜¯k8så®˜æ–¹å‡ºå“çš„ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼Œç”¨äºä¸ containerd è¿›è¡Œé€šä¿¡ã€‚ crictl å‘½ä»¤é»˜è®¤éœ€è¦ sudo æƒé™ï¼Œå¦‚æœä¸æƒ³æ¯æ¬¡éƒ½åŠ  sudoï¼Œå¯ä»¥å°†ç”¨æˆ·åŠ å…¥ containerd çš„ socket æƒé™ç»„ 123456789101112131415161718192021222324# containerd çš„é»˜è®¤ socket æ˜¯ /var/run/containerd/containerd.sock$ ls -l /var/run/containerd/containerd.socksrw-rw---- 1 root root 0 7æœˆ 1 10:57 /var/run/containerd/containerd.sock# å¦‚æœ group æ˜¯ rootï¼šä½ å¯ä»¥æ”¹ä¸ºå…¶å®ƒç»„ï¼Œæ¯”å¦‚ docker# å¦‚æœ docker ç»„ä¸å­˜åœ¨åˆ™åˆ›å»ºsudo groupadd docker# ä¿®æ”¹æ–‡ä»¶æ‰€å±ç»„ä¸º dockersudo chgrp docker /var/run/containerd/containerd.sock# ä¸ºç»„æ·»åŠ è¯»å†™æƒé™sudo chmod g+rw /var/run/containerd/containerd.sock# æ·»åŠ ç”¨æˆ·åˆ° docker ç»„sudo usermod -aG docker $USER# åˆ·æ–°æƒé™newgrp docker# æ­¤æ—¶è™½ç„¶å·²ç»å¯ä»¥ä¸ç”¨ sudo äº†ï¼Œä½†æ˜¯ä¸€æ—¦é‡å¯ containerd å°±ä¼šé‡æ–°å›åˆ° root æƒé™ï¼Œå› æ­¤éœ€è¦æ·»åŠ å¦‚ä¸‹é…ç½®sudo mkdir -p /etc/systemd/system/containerd.service.d/sudo tee /etc/systemd/system/containerd.service.d/override.conf &lt;&lt;EOF[Service]ExecStartPost=/bin/bash -c &#x27;chmod 660 /run/containerd/containerd.sock &amp;&amp; chgrp docker /run/containerd/containerd.sock&#x27;EOFsudo systemctl daemon-reloadsudo systemctl restart containerd crictl å‘½ä»¤çš„ä½¿ç”¨æ–¹å¼æ¯”è¾ƒç±»ä¼¼dockerå‘½ä»¤ æ“ä½œ docker å‘½ä»¤ crictl å‘½ä»¤ è¯´æ˜ æŸ¥çœ‹æ­£åœ¨è¿è¡Œçš„å®¹å™¨ docker ps crictl ps æŸ¥çœ‹æ‰€æœ‰å®¹å™¨ï¼ˆåŒ…æ‹¬å·²åœæ­¢ï¼‰ docker ps -a crictl ps -a æŸ¥çœ‹é•œåƒ docker images crictl images æŸ¥çœ‹å®¹å™¨æ—¥å¿— docker logs &lt;container_id&gt; crictl logs &lt;container_id&gt; è¿›å…¥å®¹å™¨äº¤äº’ docker exec -it &lt;id&gt; sh crictl exec -it &lt;id&gt; sh æŸ¥çœ‹å®¹å™¨è¯¦ç»†ä¿¡æ¯ docker inspect &lt;container_id&gt; crictl inspect &lt;container_id&gt; æŸ¥çœ‹ Pod è¯¦ç»†ä¿¡æ¯ âŒï¼ˆä¸æ”¯æŒï¼‰ crictl inspectp &lt;pod_id&gt; K8s ä¸“å± åˆ é™¤å®¹å™¨ docker rm &lt;container_id&gt; crictl rm &lt;container_id&gt; åˆ é™¤é•œåƒ docker rmi &lt;image_id&gt; crictl rmi &lt;image_id&gt; æ‹‰å–é•œåƒ docker pull nginx crictl pull nginx è¿è¡Œå®¹å™¨ï¼ˆé K8s åœºæ™¯ï¼‰ docker run -it nginx âŒï¼ˆä¸æ”¯æŒï¼‰ crictl ä¸è¿è¡Œå®¹å™¨ï¼Œä»…è°ƒè¯•ç°æœ‰å®¹å™¨ åˆ—å‡ºå®¹å™¨è¿è¡Œæ—¶ä¿¡æ¯ docker info crictl info æŸ¥çœ‹å®¹å™¨è¿è¡ŒçŠ¶æ€ docker stats crictl stats ç®€è¦ç‰ˆ è®¾ç½®é…ç½®æ–‡ä»¶ ~/.docker/config.json /etc/crictl.yaml å¦‚è®¾ç½® endpoint nerdctl nerdctl æ˜¯ä¸€ä¸ª å…¼å®¹ Docker CLI çš„å®¹å™¨å‘½ä»¤è¡Œå·¥å…·ï¼Œç”¨äºç®¡ç† containerd å®¹å™¨è¿è¡Œæ—¶ã€‚ å®ƒæ˜¯ containerd å®˜æ–¹å­é¡¹ç›®ï¼Œç”± CNCF ç»´æŠ¤ï¼Œå…¶å‘½ä»¤è¯­æ³•ä¸ Docker CLI å…¼å®¹ï¼Œç›®æ ‡æ˜¯è®©ä¹ æƒ¯ Docker çš„ç”¨æˆ·ä¹Ÿèƒ½è½»æ¾ä½¿ç”¨ containerdã€‚ å®‰è£… nerdctl 1234567891011121314151617181920212223242526272829# 1. ä¸‹è½½æœ€æ–°ç‰ˆæœ¬VERSION=2.1.3wget https://github.com/containerd/nerdctl/releases/download/v$&#123;VERSION&#125;/nerdctl-$&#123;VERSION&#125;-linux-amd64.tar.gz# 2. è§£å‹tar -xvf nerdctl-$&#123;VERSION&#125;-linux-amd64.tar.gz# 3. ç§»åŠ¨åˆ°ç³»ç»Ÿ PATHsudo mv nerdctl /usr/local/bin/# nerdctl éœ€è¦ sudo æƒé™## ä¸º sudo æ·»åŠ  PATHsudo visudo## æ‰¾åˆ°è¿™ä¸€è¡ŒDefaults secure_path = /sbin:/bin:/usr/sbin:/usr/bin## ä¿®æ”¹ä¸ºï¼Œå³å°† nerdctl æ‰€åœ¨çš„ç›®å½•åŠ å…¥ PATHDefaults secure_path = /sbin:/bin:/usr/sbin:/usr/bin:/usr/local/bin# 4.æµ‹è¯•## æŸ¥çœ‹ç‰ˆæœ¬sudo nerdctl version## åˆ—å‡ºå®¹å™¨ï¼Œ--namespace k8s.io è¡¨ç¤ºæŸ¥çœ‹ k8s ä¸­çš„å®¹å™¨sudo nerdctl ps --namespace k8s.io## å¦‚æœä¸æƒ³æ¯æ¬¡éƒ½åŠ ä¸Š --namespace k8s.ioï¼Œå¯ä»¥è®¾ç½®åˆ«åecho &quot;alias kps=&#x27;sudo nerdctl --namespace=k8s.io ps&#x27;&quot; &gt;&gt; ~/.bashrcsource ~/.bashrc## æµ‹è¯•kps Helm å®˜ç½‘æ–‡æ¡£ Helm æ˜¯ Kubernetes çš„åŒ…ç®¡ç†å™¨ï¼Œç±»ä¼¼äº Linux ä¸‹çš„åŒ…ç®¡ç†å·¥å…·å¦‚ yumã€apt ç­‰ã€‚å¯ä»¥æ–¹ä¾¿çš„å°†ä¹‹å‰æ‰“åŒ…å¥½çš„ yaml æ–‡ä»¶éƒ¨ç½²åˆ° Kunernetes ä¸Šã€‚ Helmçš„å®‰è£… å®˜ç½‘å®‰è£…æ–¹æ³• 12345wget https://get.helm.sh/helm-v3.17.4-linux-amd64.tar.gztar -zxvf helm-v3.17.4-linux-amd64.tar.gzsudo mv linux-amd64/helm /usr/local/bin/helm$ helm versionversion.BuildInfo&#123;Version:&quot;v3.17.4&quot;, GitCommit:&quot;595a05da6166037d0abebaa27ac8a498fa4d7ed2&quot;, GitTreeState:&quot;clean&quot;, GoVersion:&quot;go1.23.10&quot;&#125; Helmè‡ªåŠ¨è¡¥å…¨ 12345678# å®‰è£… helm çš„è‡ªåŠ¨è¡¥å…¨åŠŸèƒ½# 1 å½“å‰ç”¨æˆ·echo &#x27;source &lt;(helm completion bash)&#x27; &gt;&gt; ~/.bashrcsource ~/.bashrc# 2 æ‰€æœ‰ç”¨æˆ·helm completion bash | sudo tee /etc/bash_completion.d/helm &gt; /dev/nullsudo chmod a+r /etc/bash_completion.d/helm Helmçš„ä½¿ç”¨ å¯ä»¥å‚è€ƒ AWS-EKS-14--Helm ä»“åº“ç®¡ç† addï¼šæ·»åŠ å›¾è¡¨å­˜å‚¨åº“ 1helm repo add bitnami https://charts.bitnami.com/bitnami listï¼šåˆ—å‡ºå›¾è¡¨å­˜å‚¨åº“ 1helm repo list removeï¼šåˆ é™¤å›¾è¡¨å­˜å‚¨åº“ 1helm repo remove bitnami updateï¼šä»å›¾è¡¨å­˜å‚¨åº“æ›´æ–°æœ¬åœ°å¯ç”¨å›¾è¡¨çš„ä¿¡æ¯ 1234# æ›´æ–°æ‰€æœ‰ä»“åº“helm repo update# æ›´æ–°æŒ‡å®šçš„ä»“åº“helm repo update bitnami åœ¨ä»“åº“ä¸­æœç´¢ 123456789101112131415161718# åœ¨æ‰€æœ‰ä»“åº“ä¸­æœç´¢ï¼Œé»˜è®¤åªå±•ç¤ºæœ€æ–°çš„ç‰ˆæœ¬helm search repo nginx# åœ¨æŒ‡å®šçš„ä»“åº“ä¸­æœç´¢helm search repo bitnami/wordpress# æ˜¾ç¤ºæ‰€æœ‰ç‰ˆæœ¬helm search repo nginx -l# åœ¨å…¨éƒ¨ç‰ˆæœ¬ä¸­æœç´¢å¤§äºç­‰äºæŒ‡å®šç‰ˆæœ¬$ helm search repo nginx --version ^21.0.0 -lNAME CHART VERSION APP VERSION DESCRIPTIONbitnami/nginx 21.0.8 1.29.0 NGINX Open Source is a web server that can be a...bitnami/nginx 21.0.7 1.29.0 NGINX Open Source is a web server that can be a...bitnami/nginx 21.0.6 1.29.0 NGINX Open Source is a web server that can be a...bitnami/nginx 21.0.4 1.29.0 NGINX Open Source is a web server that can be a...bitnami/nginx 21.0.3 1.29.0 NGINX Open Source is a web server that can be a...bitnami/nginx 21.0.2 1.29.0 NGINX Open Source is a web server that can be a...bitnami/nginx 21.0.1 1.29.0 NGINX Open Source is a web server that can be a...bitnami/nginx 21.0.0 1.29.0 NGINX Open Source is a web server that can be a... å®‰è£…åŒ… 1234567891011121314151617181920212223242526272829303132# å®‰è£…æœ€æ–°ç‰ˆhelm install nginx bitnami/nginx# å®‰è£…æŒ‡å®šç‰ˆæœ¬helm install nginx bitnami/nginx --version 21.0.3# å®‰è£…åŒ…åˆ°æŒ‡å®šå‘½åç©ºé—´helm install nginx bitnami/nginx -n &lt;namespace&gt;# å®‰è£…åŒ…å¹¶åˆ›å»ºå‘½åç©ºé—´helm install nginx bitnami/nginx -n &lt;namespace&gt; --create-namespace# å®‰è£…æœ¬åœ° chart ç›®å½•helm install my-release ./nginx# å®‰è£… .tgz æ ¼å¼çš„æ‰“åŒ… charthelm install my-release ./nginx-1.2.3.tgz# ä»è¿œç¨‹tgzå®‰è£…helm install my-release https://example.com/charts/nginx-1.2.3.tgz# å®‰è£… Git ä»“åº“ä¸­çš„ chartï¼ˆç»“åˆ pluginï¼‰helm plugin install https://github.com/aslafy-z/helm-githelm repo add mychart &#x27;git+https://github.com/myorg/mychart.git&#x27;helm install my-release mychart/nginx# å¸è½½helm-gitæ’ä»¶helm plugin remove helm-git# ä½¿ç”¨ --set ä¼ é€’å•ä¸ªæˆ–å¤šä¸ªå€¼helm install my-release bitnami/nginx --set service.type=NodePort# ä½¿ç”¨ --values æˆ– -f åŠ è½½ YAML é…ç½®æ–‡ä»¶helm install my-release bitnami/nginx -f custom-values.yaml# åŒæ—¶ä½¿ç”¨å¤šç§ values æ–‡ä»¶ + --sethelm install my-release bitnami/nginx -f base.yaml -f prod.yaml --set replicaCount=3 æŸ¥çœ‹å·²ç»å®‰è£…çš„åŒ… 123456# æŸ¥çœ‹æŒ‡å®šå‘½åç©ºé—´å·²å®‰è£…çš„åŒ…helm list -n &lt;namespace&gt;# æŸ¥çœ‹æ‰€æœ‰å·²å®‰è£…çš„åŒ…helm list -A# æŸ¥çœ‹å·²å®‰è£…çš„åŒ…çŠ¶æ€helm status ngxin -n &lt;namespace&gt; å¸è½½åŒ… 1helm uninstall nginx -n &lt;namespace&gt;","summary":"æ‘˜è¦ K8S çš„ Toolsï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚ K8Så®˜ç½‘ k8s Github","date_published":"2025-07-24T13:30:05.000Z","tags":["æŠ€æœ¯","k8s","K8S"]},{"id":"https://blog.hanqunfeng.com/2025/07/24/k8s-connection/","url":"https://blog.hanqunfeng.com/2025/07/24/k8s-connection/","title":"K8S ä¹‹ è¿œç¨‹è¿æ¥","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç»  K8S çš„ è¿œç¨‹è¿æ¥ æ–¹æ³•ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://kubernetes.io/zh-cn/\">K8Så®˜ç½‘</a></p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://github.com/kubernetes/kubernetes\">k8s Github</a></p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"è¿œç¨‹è¿æ¥-k8s-é›†ç¾¤\">è¿œç¨‹è¿æ¥ k8s é›†ç¾¤</h2>\n<h3 id=\"æœ¬åœ°ä¸å­˜åœ¨-kubeconfig-æ–‡ä»¶\">æœ¬åœ°ä¸å­˜åœ¨ kubeconfig æ–‡ä»¶</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è·å– kubeconfig æ–‡ä»¶ï¼Œä½äº Master èŠ‚ç‚¹ï¼š/etc/kubernetes/admin.confï¼Œå°†å…¶æ‹·è´åˆ°æœ¬åœ°</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">scp k8s-master:/etc/kubernetes/admin.conf ~/.kube/config</span><br></pre></td></tr></table></figure>\n<h3 id=\"æœ¬åœ°å·²å­˜åœ¨-kubeconfig-æ–‡ä»¶\">æœ¬åœ°å·²å­˜åœ¨ kubeconfig æ–‡ä»¶</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å·²ç»é…ç½®äº†ä¸€ä¸ªé›†ç¾¤çš„è¿æ¥ï¼Œè¿˜æƒ³å†æ·»åŠ ä¸€ä¸ªé›†ç¾¤ï¼Œå¯ä»¥é€šè¿‡é€šè¿‡åˆå¹¶çš„æ–¹å¼æ·»åŠ </p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å°†æ–°é›†ç¾¤çš„ kubeconfig æ–‡ä»¶æ‹·è´åˆ°æœ¬åœ°</span></span><br><span class=\"line\">scp k8s-master:/etc/kubernetes/admin.conf ~/.kube/new-cluster.conf</span><br><span class=\"line\"><span class=\"comment\"># åˆå¹¶</span></span><br><span class=\"line\">KUBECONFIG=~/.kube/config:new-cluster.conf kubectl config view --flatten &gt; merged-config.yaml</span><br><span class=\"line\"><span class=\"comment\"># æ›¿æ¢</span></span><br><span class=\"line\"><span class=\"built_in\">mv</span> merged-config.yaml ~/.kube/config</span><br></pre></td></tr></table></figure>\n<h3 id=\"é›†ç¾¤é…ç½®ç›¸å…³å‘½ä»¤\">é›†ç¾¤é…ç½®ç›¸å…³å‘½ä»¤</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è·å–é›†ç¾¤é…ç½®</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># è·å–æ‰€æœ‰é›†ç¾¤é…ç½®</span></span><br><span class=\"line\">kubectl config get-contexts</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹å½“å‰é»˜è®¤çš„ context</span></span><br><span class=\"line\">kubectl config current-context</span><br><span class=\"line\"><span class=\"comment\"># åˆ‡æ¢ context</span></span><br><span class=\"line\">kubectl config use-context &lt;context_name&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># è·å–é›†ç¾¤åç§°</span></span><br><span class=\"line\">kubectl config get-clusters</span><br><span class=\"line\"><span class=\"comment\"># è·å–ç”¨æˆ·åç§°</span></span><br><span class=\"line\">kubectl config get-users</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æµ‹è¯•</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl get node</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ é™¤é›†ç¾¤é…ç½®</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åˆ é™¤ context</span></span><br><span class=\"line\">kubectl config delete-context &lt;context_name&gt;</span><br><span class=\"line\"><span class=\"comment\"># åˆ é™¤ cluster</span></span><br><span class=\"line\">kubectl config delete-cluster &lt;cluster_name&gt;</span><br><span class=\"line\"><span class=\"comment\"># åˆ é™¤ user</span></span><br><span class=\"line\">kubectl config delete-user &lt;user_name&gt;</span><br></pre></td></tr></table></figure>\n<h2 id=\"åè®°\">åè®°</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¹Ÿå¯ä»¥ç›´æ¥ç¼–è¾‘ kubeconfigï¼ˆ~/.kube/configï¼‰ æ–‡ä»¶ï¼Œæ·»åŠ æˆ–åˆ é™¤ä¸éœ€è¦çš„é›†ç¾¤ã€ç”¨æˆ·ã€ä¸Šä¸‹æ–‡ç­‰ä¿¡æ¯</p>\n</li>\n</ul>\n","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» K8S çš„ è¿œç¨‹è¿æ¥ æ–¹æ³•ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚ K8Så®˜ç½‘ k8s Github è¿œç¨‹è¿æ¥ k8s é›†ç¾¤ æœ¬åœ°ä¸å­˜åœ¨ kubeconfig æ–‡ä»¶ è·å– kubeconfig æ–‡ä»¶ï¼Œä½äº Master èŠ‚ç‚¹ï¼š/etc/kubernetes/admin.confï¼Œå°†å…¶æ‹·è´åˆ°æœ¬åœ° 1scp k8s-master:/etc/kubernetes/admin.conf ~/.kube/config æœ¬åœ°å·²å­˜åœ¨ kubeconfig æ–‡ä»¶ å·²ç»é…ç½®äº†ä¸€ä¸ªé›†ç¾¤çš„è¿æ¥ï¼Œè¿˜æƒ³å†æ·»åŠ ä¸€ä¸ªé›†ç¾¤ï¼Œå¯ä»¥é€šè¿‡é€šè¿‡åˆå¹¶çš„æ–¹å¼æ·»åŠ  123456# å°†æ–°é›†ç¾¤çš„ kubeconfig æ–‡ä»¶æ‹·è´åˆ°æœ¬åœ°scp k8s-master:/etc/kubernetes/admin.conf ~/.kube/new-cluster.conf# åˆå¹¶KUBECONFIG=~/.kube/config:new-cluster.conf kubectl config view --flatten &gt; merged-config.yaml# æ›¿æ¢mv merged-config.yaml ~/.kube/config é›†ç¾¤é…ç½®ç›¸å…³å‘½ä»¤ è·å–é›†ç¾¤é…ç½® 1234567891011# è·å–æ‰€æœ‰é›†ç¾¤é…ç½®kubectl config get-contexts# æŸ¥çœ‹å½“å‰é»˜è®¤çš„ contextkubectl config current-context# åˆ‡æ¢ contextkubectl config use-context &lt;context_name&gt;# è·å–é›†ç¾¤åç§°kubectl config get-clusters# è·å–ç”¨æˆ·åç§°kubectl config get-users æµ‹è¯• 1kubectl get node åˆ é™¤é›†ç¾¤é…ç½® 123456# åˆ é™¤ contextkubectl config delete-context &lt;context_name&gt;# åˆ é™¤ clusterkubectl config delete-cluster &lt;cluster_name&gt;# åˆ é™¤ userkubectl config delete-user &lt;user_name&gt; åè®° ä¹Ÿå¯ä»¥ç›´æ¥ç¼–è¾‘ kubeconfigï¼ˆ~/.kube/configï¼‰ æ–‡ä»¶ï¼Œæ·»åŠ æˆ–åˆ é™¤ä¸éœ€è¦çš„é›†ç¾¤ã€ç”¨æˆ·ã€ä¸Šä¸‹æ–‡ç­‰ä¿¡æ¯","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» K8S çš„ è¿œç¨‹è¿æ¥ æ–¹æ³•ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚ K8Så®˜ç½‘ k8s Github","date_published":"2025-07-24T12:30:05.000Z","tags":["æŠ€æœ¯","k8s","K8S"]},{"id":"https://blog.hanqunfeng.com/2025/07/23/k8s-secret/","url":"https://blog.hanqunfeng.com/2025/07/23/k8s-secret/","title":"K8S ä¹‹ Secret","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç» K8S çš„ Secret ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://kubernetes.io/zh-cn/\">K8Så®˜ç½‘</a></p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://github.com/kubernetes/kubernetes\">k8s Github</a></p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://kubernetes.io/zh-cn/docs/concepts/configuration/secret/\">k8s Secret å®˜æ–¹æ–‡æ¡£</a></p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"Secret-ä»‹ç»\">Secret ä»‹ç»</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Secret æ˜¯ä¸€ç§åŒ…å«å°‘é‡æ•æ„Ÿä¿¡æ¯ä¾‹å¦‚å¯†ç ã€ä»¤ç‰Œæˆ–å¯†é’¥çš„å¯¹è±¡ã€‚ è¿™æ ·çš„ä¿¡æ¯å¯èƒ½ä¼šè¢«æ”¾åœ¨ Pod è§„çº¦ä¸­æˆ–è€…é•œåƒä¸­ã€‚ ä½¿ç”¨ Secret æ„å‘³ç€ä½ ä¸éœ€è¦åœ¨åº”ç”¨ç¨‹åºä»£ç ä¸­åŒ…å«æœºå¯†æ•°æ®ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ç”±äºåˆ›å»º Secret å¯ä»¥ç‹¬ç«‹äºä½¿ç”¨å®ƒä»¬çš„ Podï¼Œ å› æ­¤åœ¨åˆ›å»ºã€æŸ¥çœ‹å’Œç¼–è¾‘ Pod çš„å·¥ä½œæµç¨‹ä¸­æš´éœ² Secretï¼ˆåŠå…¶æ•°æ®ï¼‰çš„é£é™©è¾ƒå°ã€‚ Kubernetes å’Œåœ¨é›†ç¾¤ä¸­è¿è¡Œçš„åº”ç”¨ç¨‹åºä¹Ÿå¯ä»¥å¯¹ Secret é‡‡å–é¢å¤–çš„é¢„é˜²æªæ–½ï¼Œ ä¾‹å¦‚é¿å…å°†æ•æ„Ÿæ•°æ®å†™å…¥éæ˜“å¤±æ€§å­˜å‚¨ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>Secret ç±»ä¼¼äº ConfigMap ä½†ä¸“é—¨ç”¨äºä¿å­˜æœºå¯†æ•°æ®ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>æ¯ä¸ª Secret çš„å°ºå¯¸æœ€å¤šä¸º 1MiB</p>\n</li>\n<li class=\"lvl-2\">\n<p>åœ¨ K8S ä¸­ï¼ŒSecret æœ‰å¤šç§ç±»å‹ï¼šæœ¬æ–‡åªè®²è§£ <code>Opaque</code> ç±»å‹ï¼Œå…¶ä½™ç±»å‹å‚è€ƒ[å®˜ç½‘]((<a href=\"https://kubernetes.io/zh-cn/docs/concepts/configuration/secret/\">https://kubernetes.io/zh-cn/docs/concepts/configuration/secret/</a>)ã€‚</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>å†…ç½®ç±»å‹</th>\n<th>ç”¨æ³•æè¿°</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>Opaque</code></td>\n<td>ç”¨æˆ·è‡ªå®šä¹‰çš„ä»»æ„æ•°æ®ï¼ˆé»˜è®¤ç±»å‹ï¼‰</td>\n</tr>\n<tr>\n<td><code>kubernetes.io/service-account-token</code></td>\n<td>è‡ªåŠ¨æŒ‚è½½çš„æœåŠ¡è´¦å·ä»¤ç‰Œï¼Œä¾› Pod è®¿é—® API ä½¿ç”¨</td>\n</tr>\n<tr>\n<td><code>kubernetes.io/dockercfg</code></td>\n<td>åºåˆ—åŒ–çš„ <code>~/.dockercfg</code> æ–‡ä»¶ï¼Œç”¨äºç§æœ‰ä»“åº“è®¤è¯ï¼ˆæ—§æ ¼å¼ï¼‰</td>\n</tr>\n<tr>\n<td><code>kubernetes.io/dockerconfigjson</code></td>\n<td>åºåˆ—åŒ–çš„ <code>~/.docker/config.json</code> æ–‡ä»¶ï¼ˆæ¨èï¼‰</td>\n</tr>\n<tr>\n<td><code>kubernetes.io/basic-auth</code></td>\n<td>å­˜å‚¨ç”¨æˆ·åå’Œå¯†ç ï¼Œç”¨äº HTTP åŸºæœ¬è®¤è¯</td>\n</tr>\n<tr>\n<td><code>kubernetes.io/ssh-auth</code></td>\n<td>å­˜å‚¨ SSH ç§é’¥ï¼Œç”¨äº SSH èº«ä»½è®¤è¯</td>\n</tr>\n<tr>\n<td><code>kubernetes.io/tls</code></td>\n<td>å­˜å‚¨ TLS å¯†é’¥å’Œè¯ä¹¦ï¼Œç”¨äº HTTPS æˆ–æœåŠ¡åŠ å¯†é€šä¿¡</td>\n</tr>\n<tr>\n<td><code>bootstrap.kubernetes.io/token</code></td>\n<td>ç”¨äº kubelet åŠ å…¥é›†ç¾¤çš„å¼•å¯¼ä»¤ç‰Œ</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"Secret-åˆ›å»ºåŠä½¿ç”¨\">Secret åˆ›å»ºåŠä½¿ç”¨</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Secret ä¸ ConfigMap åˆ›å»ºåŠä½¿ç”¨ç±»ä¼¼ï¼Œéƒ½æ˜¯å­˜å‚¨é”®å€¼å¯¹ï¼Œä½†å­˜å‚¨å†…å®¹ä¸åŒï¼ŒSecret å­˜å‚¨çš„æ˜¯ Base64 ç¼–ç åçš„å†…å®¹ã€‚</p>\n</li>\n</ul>\n<h3 id=\"ç¯å¢ƒå˜é‡å¼•ç”¨\">ç¯å¢ƒå˜é‡å¼•ç”¨</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>yamlåˆ›å»º</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># mysevret.yaml</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Secret</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">my-secret</span></span><br><span class=\"line\"><span class=\"attr\">type:</span> <span class=\"string\">Opaque</span>                  <span class=\"comment\"># é»˜è®¤ç±»å‹ ï¼Œå¯ä»¥çœç•¥</span></span><br><span class=\"line\"><span class=\"attr\">data:</span></span><br><span class=\"line\">  <span class=\"attr\">username:</span> <span class=\"string\">YWRtaW4=</span>          <span class=\"comment\"># &quot;admin&quot; çš„ base64 ç¼–ç </span></span><br><span class=\"line\">  <span class=\"attr\">password:</span> <span class=\"string\">MWYyZDFlMmU2N2Rm</span>  <span class=\"comment\"># &quot;1f2d1e2e67df&quot; çš„ base64 ç¼–ç </span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å‘½ä»¤è¡Œåˆ›å»º</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># keyï¼švalue æ–¹å¼åˆ›å»ºï¼Œè¿™é‡Œ value å€¼æ˜¯ æ˜æ–‡ï¼Œk8s ä¼šè¿›è¡Œ base64 ç¼–ç </span></span><br><span class=\"line\">kubectl create secret generic my-secret \\</span><br><span class=\"line\">  --from-literal=username=admin \\</span><br><span class=\"line\">  --from-literal=password=1f2d1e2e67df</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ–‡ä»¶æ–¹å¼åˆ›å»º</span></span><br><span class=\"line\"><span class=\"comment\"># --from-env-file=app.env ä½œç”¨ï¼šå°† app.env ä¸­çš„æ¯ä¸€è¡Œè§£æä¸º key=valueï¼Œæ¯ä¸€è¡Œå˜æˆ Secret ä¸­çš„ä¸€ä¸ªé”®å€¼å¯¹ã€‚</span></span><br><span class=\"line\">kubectl create secret generic my-secret \\</span><br><span class=\"line\">  --from-env-file=username.env \\</span><br><span class=\"line\">  --from-env-file=password.env</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># username.env æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</span></span><br><span class=\"line\"><span class=\"comment\"># username=admin</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># password.env æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</span></span><br><span class=\"line\"><span class=\"comment\"># password=1f2d1e2e67df</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åˆ›å»ºå®Œæˆåï¼ŒæŸ¥çœ‹ Secret çš„å†…å®¹</span></span><br><span class=\"line\">$ k get secrets my-secret -o yaml</span><br><span class=\"line\">apiVersion: v1</span><br><span class=\"line\">data:</span><br><span class=\"line\">  password: MWYyZDFlMmU2N2Rm</span><br><span class=\"line\">  username: YWRtaW4=</span><br><span class=\"line\">kind: Secret</span><br><span class=\"line\">metadata:</span><br><span class=\"line\">  creationTimestamp: <span class=\"string\">&quot;2025-07-05T13:21:22Z&quot;</span></span><br><span class=\"line\">  name: my-secret</span><br><span class=\"line\">  namespace: default</span><br><span class=\"line\">  resourceVersion: <span class=\"string\">&quot;747355&quot;</span></span><br><span class=\"line\">  uid: 4f77269d-d4c3-4ae8-aafc-7cfa56b84a5d</span><br><span class=\"line\"><span class=\"built_in\">type</span>: Opaque</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å°† Secret ä¸­çš„å…¨éƒ¨æ•°æ®ä½œä¸ºç¯å¢ƒå˜é‡ä½¿ç”¨</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># pod.yaml</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Pod</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">env-secret</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">containers:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">app</span></span><br><span class=\"line\">      <span class=\"attr\">command:</span> [<span class=\"string\">&quot;/bin/sh&quot;</span>, <span class=\"string\">&quot;-c&quot;</span>, <span class=\"string\">&quot;printenv&quot;</span>] <span class=\"comment\"># æ‰“å°ç¯å¢ƒå˜é‡</span></span><br><span class=\"line\">      <span class=\"attr\">image:</span> <span class=\"string\">busybox:latest</span></span><br><span class=\"line\">      <span class=\"attr\">envFrom:</span>                  <span class=\"comment\"># ç¯å¢ƒå˜é‡å¼•ç”¨æ–‡ä»¶ã€ Secret ï¼Œç­‰ç­‰</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">secretRef:</span>            <span class=\"comment\"># è¿™é‡Œå¼•ç”¨ Secret ï¼Œæ­¤å¤„å°† Secret ä¸­çš„å…¨éƒ¨æ•°æ®ä½œä¸ºç¯å¢ƒå˜é‡ä½¿ç”¨</span></span><br><span class=\"line\">            <span class=\"attr\">name:</span> <span class=\"string\">my-secret</span>     <span class=\"comment\"># Secret åç§°</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å°† Secret ä¸­çš„éƒ¨åˆ†æ•°æ®ä½œä¸ºç¯å¢ƒå˜é‡ä½¿ç”¨</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># pod2.yaml</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Pod</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">env-secret2</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">containers:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">app</span></span><br><span class=\"line\">    <span class=\"attr\">command:</span> [<span class=\"string\">&quot;/bin/sh&quot;</span>, <span class=\"string\">&quot;-c&quot;</span>]</span><br><span class=\"line\">    <span class=\"attr\">args:</span>                       <span class=\"comment\"># å®¹å™¨å¯åŠ¨å‘½ä»¤</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">|</span></span><br><span class=\"line\"><span class=\"string\">        echo &quot;username: $&#123;SECRET_USERNAME&#125;&quot;</span></span><br><span class=\"line\"><span class=\"string\">        echo &quot;password: $&#123;SECRET_PASSWORD&#125;&quot;</span></span><br><span class=\"line\"><span class=\"string\"></span>    <span class=\"attr\">image:</span> <span class=\"string\">busybox:latest</span></span><br><span class=\"line\">    <span class=\"attr\">env:</span>                        <span class=\"comment\"># ç¯å¢ƒå˜é‡é…ç½®ï¼Œkey: value å½¢å¼</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">SECRET_USERNAME</span>     <span class=\"comment\"># è¦åœ¨podä¸­é…ç½®çš„ç¯å¢ƒå˜é‡çš„ key</span></span><br><span class=\"line\">      <span class=\"attr\">valueFrom:</span>                <span class=\"comment\"># value æ¥æº</span></span><br><span class=\"line\">        <span class=\"attr\">secretKeyRef:</span>           <span class=\"comment\"># å¼•ç”¨ Secret ä¸­çš„ key</span></span><br><span class=\"line\">          <span class=\"attr\">name:</span> <span class=\"string\">my-secret</span>       <span class=\"comment\"># Secret åç§°</span></span><br><span class=\"line\">          <span class=\"attr\">key:</span> <span class=\"string\">username</span>         <span class=\"comment\"># Secret ä¸­ key çš„åç§°</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">SECRET_PASSWORD</span></span><br><span class=\"line\">      <span class=\"attr\">valueFrom:</span></span><br><span class=\"line\">        <span class=\"attr\">secretKeyRef:</span></span><br><span class=\"line\">          <span class=\"attr\">name:</span> <span class=\"string\">my-secret</span></span><br><span class=\"line\">          <span class=\"attr\">key:</span> <span class=\"string\">password</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æŸ¥çœ‹podæ—¥å¿—</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ k logs pods/env-secret</span><br><span class=\"line\">KUBERNETES_PORT=tcp://10.96.0.1:443</span><br><span class=\"line\">KUBERNETES_SERVICE_PORT=443</span><br><span class=\"line\">HOSTNAME=env-secret</span><br><span class=\"line\">SHLVL=1</span><br><span class=\"line\">username=admin</span><br><span class=\"line\">HOME=/root</span><br><span class=\"line\">KUBERNETES_PORT_443_TCP_ADDR=10.96.0.1</span><br><span class=\"line\">PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin</span><br><span class=\"line\">KUBERNETES_PORT_443_TCP_PORT=443</span><br><span class=\"line\">password=1f2d1e2e67df</span><br><span class=\"line\">KUBERNETES_PORT_443_TCP_PROTO=tcp</span><br><span class=\"line\">KUBERNETES_PORT_443_TCP=tcp://10.96.0.1:443</span><br><span class=\"line\">KUBERNETES_SERVICE_PORT_HTTPS=443</span><br><span class=\"line\">KUBERNETES_SERVICE_HOST=10.96.0.1</span><br><span class=\"line\">PWD=/</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">$ k logs pods/env-secret2</span><br><span class=\"line\">username: admin</span><br><span class=\"line\">password: 1f2d1e2e67df</span><br></pre></td></tr></table></figure>\n<h3 id=\"å­˜å‚¨å·å¼•ç”¨\">å­˜å‚¨å·å¼•ç”¨</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>yamlåˆ›å»º</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># secret-configfile.yaml</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Secret</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">my-secret</span></span><br><span class=\"line\"><span class=\"attr\">type:</span> <span class=\"string\">Opaque</span></span><br><span class=\"line\"><span class=\"attr\">stringData:</span>                          <span class=\"comment\"># ä½¿ç”¨ stringDataï¼ŒK8s ä¼šè‡ªåŠ¨å°†å…¶è½¬æ¢ä¸º base64 ç¼–ç </span></span><br><span class=\"line\">  <span class=\"attr\">app.properties:</span> <span class=\"string\">|</span>                  <span class=\"comment\"># æ–‡ä»¶å</span></span><br><span class=\"line\">    <span class=\"string\">server.port=8080</span></span><br><span class=\"line\">    <span class=\"string\">log.level=INFO</span></span><br><span class=\"line\">  <span class=\"attr\">db.properties:</span> <span class=\"string\">|</span>                   <span class=\"comment\"># æ–‡ä»¶å</span></span><br><span class=\"line\">    <span class=\"string\">db.host=localhost</span></span><br><span class=\"line\">    <span class=\"string\">db.port=5432</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å‘½ä»¤è¡Œåˆ›å»º</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æ³¨æ„è¿™é‡Œæ˜¯ --from-fileï¼Œä½œä¸ºæ–‡ä»¶é…ç½®ï¼Œè€Œéç¯å¢ƒå˜é‡</span></span><br><span class=\"line\"><span class=\"comment\"># æ–‡ä»¶å†…å®¹æ˜¯æ˜æ–‡ï¼Œk8s ä¼šè‡ªåŠ¨å°†å…¶è½¬æ¢ä¸º base64 ç¼–ç </span></span><br><span class=\"line\">kubectl create secret generic my-secret \\</span><br><span class=\"line\">  --from-file=app.properties \\</span><br><span class=\"line\">  --from-file=db.properties</span><br><span class=\"line\"><span class=\"comment\"># app.properties æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</span></span><br><span class=\"line\"><span class=\"comment\"># server.port=8080</span></span><br><span class=\"line\"><span class=\"comment\"># log.level=INFO</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># db.properties æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</span></span><br><span class=\"line\"><span class=\"comment\"># db.host=localhost</span></span><br><span class=\"line\"><span class=\"comment\"># db.port=5432</span></span><br><span class=\"line\"></span><br><span class=\"line\">$ k get secrets my-secret -oyaml</span><br><span class=\"line\">apiVersion: v1</span><br><span class=\"line\">data:</span><br><span class=\"line\">  app.properties: c2VydmVyLnBvcnQ9ODA4MApsb2cubGV2ZWw9SU5GTwo=</span><br><span class=\"line\">  db.properties: ZGIuaG9zdD1sb2NhbGhvc3QKZGIucG9ydD0xMjU0MzIK</span><br><span class=\"line\">kind: Secret</span><br><span class=\"line\">metadata:</span><br><span class=\"line\">  creationTimestamp: <span class=\"string\">&quot;2025-07-05T13:45:14Z&quot;</span></span><br><span class=\"line\">  name: my-secret</span><br><span class=\"line\">  namespace: default</span><br><span class=\"line\">  resourceVersion: <span class=\"string\">&quot;750742&quot;</span></span><br><span class=\"line\">  uid: 35ffcdd6-d70a-4f3a-9246-5c56da630bc1</span><br><span class=\"line\"><span class=\"built_in\">type</span>: Opaque</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Pod æŒ‚è½½ Secret ä¸ºæ–‡ä»¶</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># secret-pod.yaml æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Pod</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">secret-demo</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">containers:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">myapp</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">busybox</span></span><br><span class=\"line\">    <span class=\"attr\">command:</span> [<span class=\"string\">&quot;sleep&quot;</span>, <span class=\"string\">&quot;3600&quot;</span>]</span><br><span class=\"line\">    <span class=\"attr\">volumeMounts:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">config-volume</span></span><br><span class=\"line\">      <span class=\"attr\">mountPath:</span> <span class=\"string\">/etc/config</span>              <span class=\"comment\"># æŒ‚è½½è·¯å¾„</span></span><br><span class=\"line\">      <span class=\"attr\">readOnly:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">  <span class=\"attr\">volumes:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">config-volume</span>                   <span class=\"comment\"># å­˜å‚¨å· åç§°</span></span><br><span class=\"line\">    <span class=\"attr\">secret:</span>                               <span class=\"comment\"># å­˜å‚¨å·ç±»å‹ä¸º Secret</span></span><br><span class=\"line\">      <span class=\"attr\">secretName:</span> <span class=\"string\">my-secret</span>               <span class=\"comment\"># æŒ‚è½½çš„ Secret åç§°ï¼Œæœ¬åˆ©ä¸­å°† Secret ä¸­çš„å…¨éƒ¨æ–‡ä»¶éƒ½æŒ‚è½½åˆ°podç›®å½•ä¸‹</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å®¹å™¨å†…çš„ <code>/etc/config/</code> ç›®å½•ä¸‹ä¼šæœ‰ä¸¤ä¸ªæ–‡ä»¶ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/etc/config/app.properties</span><br><span class=\"line\">/etc/config/db.properties</span><br><span class=\"line\"></span><br><span class=\"line\">$ k <span class=\"built_in\">exec</span> -it secret-demo -- <span class=\"built_in\">ls</span> /etc/config/</span><br><span class=\"line\">app.properties  db.properties</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¦‚æœåªæƒ³æŒ‚è½½ Secret ä¸­çš„æŸäº›æ–‡ä»¶ï¼Œå¯ä»¥é€šè¿‡ <code>items</code> å­—æ®µæŒ‡å®šï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># secret-pod2.yaml</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Pod</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">secret-demo2</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">containers:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">myapp</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">busybox</span></span><br><span class=\"line\">    <span class=\"attr\">command:</span> [<span class=\"string\">&quot;sleep&quot;</span>, <span class=\"string\">&quot;3600&quot;</span>]</span><br><span class=\"line\">    <span class=\"attr\">volumeMounts:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">config-volume</span></span><br><span class=\"line\">      <span class=\"attr\">mountPath:</span> <span class=\"string\">/etc/config</span></span><br><span class=\"line\">      <span class=\"attr\">readOnly:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">  <span class=\"attr\">volumes:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">config-volume</span></span><br><span class=\"line\">    <span class=\"attr\">secret:</span></span><br><span class=\"line\">      <span class=\"attr\">secretName:</span> <span class=\"string\">my-secret</span></span><br><span class=\"line\">      <span class=\"attr\">items:</span>                   <span class=\"comment\"># æ˜ç¡®æŒ‡å®šæŒ‚è½½çš„key</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">key:</span> <span class=\"string\">app.properties</span>    <span class=\"comment\"># secret ä¸­çš„key</span></span><br><span class=\"line\">        <span class=\"attr\">path:</span> <span class=\"string\">app.properties</span>   <span class=\"comment\"># æ˜ å°„åˆ°å®¹å™¨å†…çš„è·¯å¾„ï¼Œæœ€ç»ˆæŒ‚è½½è·¯å¾„ä¸º /etc/config/app.properties</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"åè®°\">åè®°</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Secret çš„ç‰¹ç‚¹ä¸ä½¿ç”¨æ–¹æ³•ä¸ ConfigMap éå¸¸ç±»ä¼¼ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ğŸ” ConfigMap vs Secret å¯¹æ¯”è¡¨ï¼š</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>ç‰¹æ€§</th>\n<th>ConfigMap</th>\n<th>Secret</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>ç”¨é€”</strong></td>\n<td>å­˜å‚¨éæ•æ„Ÿé…ç½®ä¿¡æ¯ï¼ˆå¦‚ç¯å¢ƒå˜é‡ã€é…ç½®æ–‡ä»¶ï¼‰</td>\n<td>å­˜å‚¨æ•æ„Ÿä¿¡æ¯ï¼ˆå¦‚å¯†ç ã€è¯ä¹¦ã€tokenï¼‰</td>\n</tr>\n<tr>\n<td><strong>æ•°æ®æ˜¯å¦åŠ å¯†</strong></td>\n<td>å¦ï¼Œæ˜æ–‡å­˜å‚¨ï¼ˆBase64 ç¼–ç å¯è¯»ï¼‰</td>\n<td>å¦ï¼ˆé»˜è®¤ Base64 ç¼–ç ï¼‰ï¼Œå¯é…ç½®åŠ å¯†å­˜å‚¨ï¼ˆå¦‚ä½¿ç”¨ KMSï¼‰</td>\n</tr>\n<tr>\n<td><strong>å­—æ®µå</strong></td>\n<td><code>data</code> / <code>binaryData</code></td>\n<td><code>data</code>ï¼ˆéœ€ base64ï¼‰ / <code>stringData</code>ï¼ˆæ˜æ–‡ï¼‰</td>\n</tr>\n<tr>\n<td><strong>å¯å­˜å‚¨çš„æœ€å¤§å¤§å°</strong></td>\n<td>æ¯ä¸ªå¯¹è±¡æœ€å¤šçº¦ 1MB</td>\n<td>æ¯ä¸ªå¯¹è±¡æœ€å¤šçº¦ 1MB</td>\n</tr>\n<tr>\n<td><strong>æ”¯æŒçš„æŒ‚è½½æ–¹å¼</strong></td>\n<td>- ç¯å¢ƒå˜é‡<br>- å·ï¼ˆæ–‡ä»¶ï¼‰</td>\n<td>- ç¯å¢ƒå˜é‡<br>- å·ï¼ˆæ–‡ä»¶ï¼‰</td>\n</tr>\n<tr>\n<td><strong>é»˜è®¤ç±»å‹ï¼ˆtypeï¼‰</strong></td>\n<td>æ— ç±»å‹å­—æ®µ</td>\n<td>é»˜è®¤ä¸º <code>Opaque</code></td>\n</tr>\n<tr>\n<td><strong>å¯å®šä¹‰ä¸ºå¤šä¸ªæ–‡ä»¶æŒ‚è½½</strong></td>\n<td>âœ…</td>\n<td>âœ…</td>\n</tr>\n<tr>\n<td><strong>é»˜è®¤ RBAC è®¿é—®æ§åˆ¶å¼ºåº¦</strong></td>\n<td>å¼±ï¼ˆå¤šæ•°ç”¨æˆ·/Pod å¯è¯»å–ï¼‰</td>\n<td>å¼ºï¼ˆé»˜è®¤å—é™è®¿é—®ï¼‰</td>\n</tr>\n<tr>\n<td><strong>æ”¯æŒçš„å†…ç½®ç±»å‹</strong></td>\n<td>æ— </td>\n<td>âœ… å¦‚ï¼š<code>kubernetes.io/tls</code>ã€<code>kubernetes.io/basic-auth</code> ç­‰</td>\n</tr>\n<tr>\n<td><strong>æ˜¯å¦é€‚åˆå­˜å‚¨å¯†é’¥/å¯†ç </strong></td>\n<td>âŒ ä¸æ¨è</td>\n<td>âœ… æ¨è</td>\n</tr>\n<tr>\n<td><strong>å¯è§†åŒ–æ˜æ–‡è¯»å–</strong></td>\n<td>âœ… ç›´æ¥è¯»å–</td>\n<td>âœ… ä½† Base64 ç¼–ç åéœ€è¦è§£ç </td>\n</tr>\n<tr>\n<td><strong>å¸¸è§ç”¨é€”ç¤ºä¾‹</strong></td>\n<td>App é…ç½®ã€æ—¥å¿—çº§åˆ«ã€è¿æ¥å‚æ•°ç­‰</td>\n<td>æ•°æ®åº“å¯†ç ã€TLS è¯ä¹¦ã€API Token ç­‰</td>\n</tr>\n</tbody>\n</table>\n","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» K8S çš„ Secret ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚ K8Så®˜ç½‘ k8s Github k8s Secret å®˜æ–¹æ–‡æ¡£ Secret ä»‹ç» Secret æ˜¯ä¸€ç§åŒ…å«å°‘é‡æ•æ„Ÿä¿¡æ¯ä¾‹å¦‚å¯†ç ã€ä»¤ç‰Œæˆ–å¯†é’¥çš„å¯¹è±¡ã€‚ è¿™æ ·çš„ä¿¡æ¯å¯èƒ½ä¼šè¢«æ”¾åœ¨ Pod è§„çº¦ä¸­æˆ–è€…é•œåƒä¸­ã€‚ ä½¿ç”¨ Secret æ„å‘³ç€ä½ ä¸éœ€è¦åœ¨åº”ç”¨ç¨‹åºä»£ç ä¸­åŒ…å«æœºå¯†æ•°æ®ã€‚ ç”±äºåˆ›å»º Secret å¯ä»¥ç‹¬ç«‹äºä½¿ç”¨å®ƒä»¬çš„ Podï¼Œ å› æ­¤åœ¨åˆ›å»ºã€æŸ¥çœ‹å’Œç¼–è¾‘ Pod çš„å·¥ä½œæµç¨‹ä¸­æš´éœ² Secretï¼ˆåŠå…¶æ•°æ®ï¼‰çš„é£é™©è¾ƒå°ã€‚ Kubernetes å’Œåœ¨é›†ç¾¤ä¸­è¿è¡Œçš„åº”ç”¨ç¨‹åºä¹Ÿå¯ä»¥å¯¹ Secret é‡‡å–é¢å¤–çš„é¢„é˜²æªæ–½ï¼Œ ä¾‹å¦‚é¿å…å°†æ•æ„Ÿæ•°æ®å†™å…¥éæ˜“å¤±æ€§å­˜å‚¨ã€‚ Secret ç±»ä¼¼äº ConfigMap ä½†ä¸“é—¨ç”¨äºä¿å­˜æœºå¯†æ•°æ®ã€‚ æ¯ä¸ª Secret çš„å°ºå¯¸æœ€å¤šä¸º 1MiB åœ¨ K8S ä¸­ï¼ŒSecret æœ‰å¤šç§ç±»å‹ï¼šæœ¬æ–‡åªè®²è§£ Opaque ç±»å‹ï¼Œå…¶ä½™ç±»å‹å‚è€ƒ[å®˜ç½‘]((https://kubernetes.io/zh-cn/docs/concepts/configuration/secret/)ã€‚ å†…ç½®ç±»å‹ ç”¨æ³•æè¿° Opaque ç”¨æˆ·è‡ªå®šä¹‰çš„ä»»æ„æ•°æ®ï¼ˆé»˜è®¤ç±»å‹ï¼‰ kubernetes.io/service-account-token è‡ªåŠ¨æŒ‚è½½çš„æœåŠ¡è´¦å·ä»¤ç‰Œï¼Œä¾› Pod è®¿é—® API ä½¿ç”¨ kubernetes.io/dockercfg åºåˆ—åŒ–çš„ ~/.dockercfg æ–‡ä»¶ï¼Œç”¨äºç§æœ‰ä»“åº“è®¤è¯ï¼ˆæ—§æ ¼å¼ï¼‰ kubernetes.io/dockerconfigjson åºåˆ—åŒ–çš„ ~/.docker/config.json æ–‡ä»¶ï¼ˆæ¨èï¼‰ kubernetes.io/basic-auth å­˜å‚¨ç”¨æˆ·åå’Œå¯†ç ï¼Œç”¨äº HTTP åŸºæœ¬è®¤è¯ kubernetes.io/ssh-auth å­˜å‚¨ SSH ç§é’¥ï¼Œç”¨äº SSH èº«ä»½è®¤è¯ kubernetes.io/tls å­˜å‚¨ TLS å¯†é’¥å’Œè¯ä¹¦ï¼Œç”¨äº HTTPS æˆ–æœåŠ¡åŠ å¯†é€šä¿¡ bootstrap.kubernetes.io/token ç”¨äº kubelet åŠ å…¥é›†ç¾¤çš„å¼•å¯¼ä»¤ç‰Œ Secret åˆ›å»ºåŠä½¿ç”¨ Secret ä¸ ConfigMap åˆ›å»ºåŠä½¿ç”¨ç±»ä¼¼ï¼Œéƒ½æ˜¯å­˜å‚¨é”®å€¼å¯¹ï¼Œä½†å­˜å‚¨å†…å®¹ä¸åŒï¼ŒSecret å­˜å‚¨çš„æ˜¯ Base64 ç¼–ç åçš„å†…å®¹ã€‚ ç¯å¢ƒå˜é‡å¼•ç”¨ yamlåˆ›å»º 12345678910# mysevret.yamlapiVersion: v1kind: Secretmetadata: name: my-secrettype: Opaque # é»˜è®¤ç±»å‹ ï¼Œå¯ä»¥çœç•¥data: username: YWRtaW4= # &quot;admin&quot; çš„ base64 ç¼–ç  password: MWYyZDFlMmU2N2Rm # &quot;1f2d1e2e67df&quot; çš„ base64 ç¼–ç  å‘½ä»¤è¡Œåˆ›å»º 12345678910111213141516171819202122232425262728293031# keyï¼švalue æ–¹å¼åˆ›å»ºï¼Œè¿™é‡Œ value å€¼æ˜¯ æ˜æ–‡ï¼Œk8s ä¼šè¿›è¡Œ base64 ç¼–ç kubectl create secret generic my-secret \\ --from-literal=username=admin \\ --from-literal=password=1f2d1e2e67df# æ–‡ä»¶æ–¹å¼åˆ›å»º# --from-env-file=app.env ä½œç”¨ï¼šå°† app.env ä¸­çš„æ¯ä¸€è¡Œè§£æä¸º key=valueï¼Œæ¯ä¸€è¡Œå˜æˆ Secret ä¸­çš„ä¸€ä¸ªé”®å€¼å¯¹ã€‚kubectl create secret generic my-secret \\ --from-env-file=username.env \\ --from-env-file=password.env# username.env æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š# username=admin# password.env æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š# password=1f2d1e2e67df# åˆ›å»ºå®Œæˆåï¼ŒæŸ¥çœ‹ Secret çš„å†…å®¹$ k get secrets my-secret -o yamlapiVersion: v1data: password: MWYyZDFlMmU2N2Rm username: YWRtaW4=kind: Secretmetadata: creationTimestamp: &quot;2025-07-05T13:21:22Z&quot; name: my-secret namespace: default resourceVersion: &quot;747355&quot; uid: 4f77269d-d4c3-4ae8-aafc-7cfa56b84a5dtype: Opaque å°† Secret ä¸­çš„å…¨éƒ¨æ•°æ®ä½œä¸ºç¯å¢ƒå˜é‡ä½¿ç”¨ 12345678910111213# pod.yamlapiVersion: v1kind: Podmetadata: name: env-secretspec: containers: - name: app command: [&quot;/bin/sh&quot;, &quot;-c&quot;, &quot;printenv&quot;] # æ‰“å°ç¯å¢ƒå˜é‡ image: busybox:latest envFrom: # ç¯å¢ƒå˜é‡å¼•ç”¨æ–‡ä»¶ã€ Secret ï¼Œç­‰ç­‰ - secretRef: # è¿™é‡Œå¼•ç”¨ Secret ï¼Œæ­¤å¤„å°† Secret ä¸­çš„å…¨éƒ¨æ•°æ®ä½œä¸ºç¯å¢ƒå˜é‡ä½¿ç”¨ name: my-secret # Secret åç§° å°† Secret ä¸­çš„éƒ¨åˆ†æ•°æ®ä½œä¸ºç¯å¢ƒå˜é‡ä½¿ç”¨ 12345678910111213141516171819202122232425# pod2.yamlapiVersion: v1kind: Podmetadata: name: env-secret2spec: containers: - name: app command: [&quot;/bin/sh&quot;, &quot;-c&quot;] args: # å®¹å™¨å¯åŠ¨å‘½ä»¤ - | echo &quot;username: $&#123;SECRET_USERNAME&#125;&quot; echo &quot;password: $&#123;SECRET_PASSWORD&#125;&quot; image: busybox:latest env: # ç¯å¢ƒå˜é‡é…ç½®ï¼Œkey: value å½¢å¼ - name: SECRET_USERNAME # è¦åœ¨podä¸­é…ç½®çš„ç¯å¢ƒå˜é‡çš„ key valueFrom: # value æ¥æº secretKeyRef: # å¼•ç”¨ Secret ä¸­çš„ key name: my-secret # Secret åç§° key: username # Secret ä¸­ key çš„åç§° - name: SECRET_PASSWORD valueFrom: secretKeyRef: name: my-secret key: password æŸ¥çœ‹podæ—¥å¿— 123456789101112131415161718192021$ k logs pods/env-secretKUBERNETES_PORT=tcp://10.96.0.1:443KUBERNETES_SERVICE_PORT=443HOSTNAME=env-secretSHLVL=1username=adminHOME=/rootKUBERNETES_PORT_443_TCP_ADDR=10.96.0.1PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/binKUBERNETES_PORT_443_TCP_PORT=443password=1f2d1e2e67dfKUBERNETES_PORT_443_TCP_PROTO=tcpKUBERNETES_PORT_443_TCP=tcp://10.96.0.1:443KUBERNETES_SERVICE_PORT_HTTPS=443KUBERNETES_SERVICE_HOST=10.96.0.1PWD=/$ k logs pods/env-secret2username: adminpassword: 1f2d1e2e67df å­˜å‚¨å·å¼•ç”¨ yamlåˆ›å»º 1234567891011121314# secret-configfile.yamlapiVersion: v1kind: Secretmetadata: name: my-secrettype: OpaquestringData: # ä½¿ç”¨ stringDataï¼ŒK8s ä¼šè‡ªåŠ¨å°†å…¶è½¬æ¢ä¸º base64 ç¼–ç  app.properties: | # æ–‡ä»¶å server.port=8080 log.level=INFO db.properties: | # æ–‡ä»¶å db.host=localhost db.port=5432 å‘½ä»¤è¡Œåˆ›å»º 1234567891011121314151617181920212223242526# æ³¨æ„è¿™é‡Œæ˜¯ --from-fileï¼Œä½œä¸ºæ–‡ä»¶é…ç½®ï¼Œè€Œéç¯å¢ƒå˜é‡# æ–‡ä»¶å†…å®¹æ˜¯æ˜æ–‡ï¼Œk8s ä¼šè‡ªåŠ¨å°†å…¶è½¬æ¢ä¸º base64 ç¼–ç kubectl create secret generic my-secret \\ --from-file=app.properties \\ --from-file=db.properties# app.properties æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š# server.port=8080# log.level=INFO# db.properties æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š# db.host=localhost# db.port=5432$ k get secrets my-secret -oyamlapiVersion: v1data: app.properties: c2VydmVyLnBvcnQ9ODA4MApsb2cubGV2ZWw9SU5GTwo= db.properties: ZGIuaG9zdD1sb2NhbGhvc3QKZGIucG9ydD0xMjU0MzIKkind: Secretmetadata: creationTimestamp: &quot;2025-07-05T13:45:14Z&quot; name: my-secret namespace: default resourceVersion: &quot;750742&quot; uid: 35ffcdd6-d70a-4f3a-9246-5c56da630bc1type: Opaque Pod æŒ‚è½½ Secret ä¸ºæ–‡ä»¶ 123456789101112131415161718# secret-pod.yaml æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼šapiVersion: v1kind: Podmetadata: name: secret-demospec: containers: - name: myapp image: busybox command: [&quot;sleep&quot;, &quot;3600&quot;] volumeMounts: - name: config-volume mountPath: /etc/config # æŒ‚è½½è·¯å¾„ readOnly: true volumes: - name: config-volume # å­˜å‚¨å· åç§° secret: # å­˜å‚¨å·ç±»å‹ä¸º Secret secretName: my-secret # æŒ‚è½½çš„ Secret åç§°ï¼Œæœ¬åˆ©ä¸­å°† Secret ä¸­çš„å…¨éƒ¨æ–‡ä»¶éƒ½æŒ‚è½½åˆ°podç›®å½•ä¸‹ å®¹å™¨å†…çš„ /etc/config/ ç›®å½•ä¸‹ä¼šæœ‰ä¸¤ä¸ªæ–‡ä»¶ï¼š 12345/etc/config/app.properties/etc/config/db.properties$ k exec -it secret-demo -- ls /etc/config/app.properties db.properties å¦‚æœåªæƒ³æŒ‚è½½ Secret ä¸­çš„æŸäº›æ–‡ä»¶ï¼Œå¯ä»¥é€šè¿‡ items å­—æ®µæŒ‡å®šï¼š 123456789101112131415161718192021# secret-pod2.yamlapiVersion: v1kind: Podmetadata: name: secret-demo2spec: containers: - name: myapp image: busybox command: [&quot;sleep&quot;, &quot;3600&quot;] volumeMounts: - name: config-volume mountPath: /etc/config readOnly: true volumes: - name: config-volume secret: secretName: my-secret items: # æ˜ç¡®æŒ‡å®šæŒ‚è½½çš„key - key: app.properties # secret ä¸­çš„key path: app.properties # æ˜ å°„åˆ°å®¹å™¨å†…çš„è·¯å¾„ï¼Œæœ€ç»ˆæŒ‚è½½è·¯å¾„ä¸º /etc/config/app.properties åè®° Secret çš„ç‰¹ç‚¹ä¸ä½¿ç”¨æ–¹æ³•ä¸ ConfigMap éå¸¸ç±»ä¼¼ã€‚ ğŸ” ConfigMap vs Secret å¯¹æ¯”è¡¨ï¼š ç‰¹æ€§ ConfigMap Secret ç”¨é€” å­˜å‚¨éæ•æ„Ÿé…ç½®ä¿¡æ¯ï¼ˆå¦‚ç¯å¢ƒå˜é‡ã€é…ç½®æ–‡ä»¶ï¼‰ å­˜å‚¨æ•æ„Ÿä¿¡æ¯ï¼ˆå¦‚å¯†ç ã€è¯ä¹¦ã€tokenï¼‰ æ•°æ®æ˜¯å¦åŠ å¯† å¦ï¼Œæ˜æ–‡å­˜å‚¨ï¼ˆBase64 ç¼–ç å¯è¯»ï¼‰ å¦ï¼ˆé»˜è®¤ Base64 ç¼–ç ï¼‰ï¼Œå¯é…ç½®åŠ å¯†å­˜å‚¨ï¼ˆå¦‚ä½¿ç”¨ KMSï¼‰ å­—æ®µå data / binaryData dataï¼ˆéœ€ base64ï¼‰ / stringDataï¼ˆæ˜æ–‡ï¼‰ å¯å­˜å‚¨çš„æœ€å¤§å¤§å° æ¯ä¸ªå¯¹è±¡æœ€å¤šçº¦ 1MB æ¯ä¸ªå¯¹è±¡æœ€å¤šçº¦ 1MB æ”¯æŒçš„æŒ‚è½½æ–¹å¼ - ç¯å¢ƒå˜é‡- å·ï¼ˆæ–‡ä»¶ï¼‰ - ç¯å¢ƒå˜é‡- å·ï¼ˆæ–‡ä»¶ï¼‰ é»˜è®¤ç±»å‹ï¼ˆtypeï¼‰ æ— ç±»å‹å­—æ®µ é»˜è®¤ä¸º Opaque å¯å®šä¹‰ä¸ºå¤šä¸ªæ–‡ä»¶æŒ‚è½½ âœ… âœ… é»˜è®¤ RBAC è®¿é—®æ§åˆ¶å¼ºåº¦ å¼±ï¼ˆå¤šæ•°ç”¨æˆ·/Pod å¯è¯»å–ï¼‰ å¼ºï¼ˆé»˜è®¤å—é™è®¿é—®ï¼‰ æ”¯æŒçš„å†…ç½®ç±»å‹ æ—  âœ… å¦‚ï¼škubernetes.io/tlsã€kubernetes.io/basic-auth ç­‰ æ˜¯å¦é€‚åˆå­˜å‚¨å¯†é’¥/å¯†ç  âŒ ä¸æ¨è âœ… æ¨è å¯è§†åŒ–æ˜æ–‡è¯»å– âœ… ç›´æ¥è¯»å– âœ… ä½† Base64 ç¼–ç åéœ€è¦è§£ç  å¸¸è§ç”¨é€”ç¤ºä¾‹ App é…ç½®ã€æ—¥å¿—çº§åˆ«ã€è¿æ¥å‚æ•°ç­‰ æ•°æ®åº“å¯†ç ã€TLS è¯ä¹¦ã€API Token ç­‰","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» K8S çš„ Secret ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚ K8Så®˜ç½‘ k8s Github k8s Secret å®˜æ–¹æ–‡æ¡£","date_published":"2025-07-23T13:35:15.000Z","tags":["æŠ€æœ¯","k8s","K8S"]},{"id":"https://blog.hanqunfeng.com/2025/07/23/k8s-configmap/","url":"https://blog.hanqunfeng.com/2025/07/23/k8s-configmap/","title":"K8S ä¹‹ ConfigMap","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç» K8S çš„ ConfigMap ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://kubernetes.io/zh-cn/\">K8Så®˜ç½‘</a></p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://github.com/kubernetes/kubernetes\">k8s Github</a></p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://kubernetes.io/zh-cn/docs/concepts/configuration/configmap/\">k8s ConfigMap å®˜æ–¹æ–‡æ¡£</a></p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"ConfigMap-åˆ«åcm-ä»‹ç»\">ConfigMap(åˆ«åcm) ä»‹ç»</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ConfigMap æ˜¯ä¸€ç§ API å¯¹è±¡ï¼Œç”¨æ¥å°†éæœºå¯†æ€§çš„æ•°æ®ä¿å­˜åˆ°é”®å€¼å¯¹ä¸­ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä½¿ç”¨æ—¶ï¼Œ Pod å¯ä»¥å°†å…¶ç”¨ä½œç¯å¢ƒå˜é‡ã€å‘½ä»¤è¡Œå‚æ•°æˆ–è€…å­˜å‚¨å·ä¸­çš„é…ç½®æ–‡ä»¶ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ConfigMap å°†ä½ çš„ç¯å¢ƒé…ç½®ä¿¡æ¯å’Œå®¹å™¨é•œåƒè§£è€¦ï¼Œä¾¿äºåº”ç”¨é…ç½®çš„ä¿®æ”¹ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å¤šä¸ª Pod å¯ä»¥å…³è”åŒä¸€ä¸ª ConfigMap</p>\n</li>\n</ul>\n<h2 id=\"ConfigMap-åˆ›å»ºåŠä½¿ç”¨\">ConfigMap åˆ›å»ºåŠä½¿ç”¨</h2>\n<h3 id=\"ç¯å¢ƒå˜é‡å¼•ç”¨\">ç¯å¢ƒå˜é‡å¼•ç”¨</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>yamlåˆ›å»º</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># configmap.yaml</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">ConfigMap</span>       <span class=\"comment\"># ConfigMap</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">myconfigmap</span>   <span class=\"comment\"># configmap åç§°</span></span><br><span class=\"line\"><span class=\"attr\">data:</span>                 <span class=\"comment\"># data å­—æ®µè®¾è®¡ç”¨æ¥ä¿å­˜ UTF-8 å­—ç¬¦ä¸²ï¼Œæœ€å¤§å€¼ä¸º 1M</span></span><br><span class=\"line\">  <span class=\"attr\">username:</span> <span class=\"string\">k8s-admin</span> <span class=\"comment\"># key: value</span></span><br><span class=\"line\">  <span class=\"attr\">access_level:</span> <span class=\"string\">&quot;1&quot;</span></span><br><span class=\"line\">  <span class=\"attr\">password:</span> <span class=\"string\">&quot;123456&quot;</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å‘½ä»¤è¡Œåˆ›å»º</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># keyï¼švalue æ–¹å¼åˆ›å»º</span></span><br><span class=\"line\">kubectl create configmap myconfigmap --from-literal=username=k8s-admin --from-literal=access_level=1 --from-literal=password=123456</span><br><span class=\"line\"><span class=\"comment\"># æ–‡ä»¶æ–¹å¼åˆ›å»º</span></span><br><span class=\"line\"><span class=\"comment\"># --from-env-file=app.env ä½œç”¨ï¼šå°† app.env ä¸­çš„æ¯ä¸€è¡Œè§£æä¸º key=valueï¼Œæ¯ä¸€è¡Œå˜æˆ ConfigMap ä¸­çš„ä¸€ä¸ªé”®å€¼å¯¹ã€‚</span></span><br><span class=\"line\">kubectl create configmap myconfigmap --from-env-file=app.env --from-env-file=other.env</span><br><span class=\"line\"><span class=\"comment\"># app.env æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</span></span><br><span class=\"line\"><span class=\"comment\"># username=k8s-admin</span></span><br><span class=\"line\"><span class=\"comment\"># access_level=1</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># other.env æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</span></span><br><span class=\"line\"><span class=\"comment\"># password=123456</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åˆ›å»ºå®Œæˆåï¼ŒæŸ¥çœ‹ ConfigMap çš„å†…å®¹</span></span><br><span class=\"line\">$ k get cm myconfigmap -oyaml</span><br><span class=\"line\">apiVersion: v1</span><br><span class=\"line\">data:</span><br><span class=\"line\">  access_level: <span class=\"string\">&quot;1&quot;</span></span><br><span class=\"line\">  password: <span class=\"string\">&quot;123456&quot;</span></span><br><span class=\"line\">  username: k8s-admin</span><br><span class=\"line\">kind: ConfigMap</span><br><span class=\"line\">metadata:</span><br><span class=\"line\">  creationTimestamp: <span class=\"string\">&quot;2025-07-05T10:29:15Z&quot;</span></span><br><span class=\"line\">  name: myconfigmap</span><br><span class=\"line\">  namespace: default</span><br><span class=\"line\">  resourceVersion: <span class=\"string\">&quot;723770&quot;</span></span><br><span class=\"line\">  uid: ee850cf9-9014-4be2-97d8-5d1840e78d54</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å°† ConfigMap ä¸­çš„å…¨éƒ¨æ•°æ®ä½œä¸ºç¯å¢ƒå˜é‡ä½¿ç”¨</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># pod.yaml</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Pod</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">env-configmap</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">containers:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">app</span></span><br><span class=\"line\">      <span class=\"attr\">command:</span> [<span class=\"string\">&quot;/bin/sh&quot;</span>, <span class=\"string\">&quot;-c&quot;</span>, <span class=\"string\">&quot;printenv&quot;</span>] <span class=\"comment\"># æ‰“å°ç¯å¢ƒå˜é‡</span></span><br><span class=\"line\">      <span class=\"attr\">image:</span> <span class=\"string\">busybox:latest</span></span><br><span class=\"line\">      <span class=\"attr\">envFrom:</span>                  <span class=\"comment\"># ç¯å¢ƒå˜é‡å¼•ç”¨æ–‡ä»¶ã€configMapï¼Œç­‰ç­‰</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">configMapRef:</span>         <span class=\"comment\"># è¿™é‡Œå¼•ç”¨ ConfigMapï¼Œæ­¤å¤„å°† ConfigMap ä¸­çš„å…¨éƒ¨æ•°æ®ä½œä¸ºç¯å¢ƒå˜é‡ä½¿ç”¨</span></span><br><span class=\"line\">            <span class=\"attr\">name:</span> <span class=\"string\">myconfigmap</span>   <span class=\"comment\"># configMap åç§°</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å°† ConfigMap ä¸­çš„éƒ¨åˆ†æ•°æ®ä½œä¸ºç¯å¢ƒå˜é‡ä½¿ç”¨</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># pod2.yaml</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Pod</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">env-configmap2</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">containers:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">app</span></span><br><span class=\"line\">    <span class=\"attr\">command:</span> [<span class=\"string\">&quot;/bin/sh&quot;</span>, <span class=\"string\">&quot;-c&quot;</span>]</span><br><span class=\"line\">    <span class=\"attr\">args:</span>                       <span class=\"comment\"># å®¹å™¨å¯åŠ¨å‘½ä»¤</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">|</span></span><br><span class=\"line\"><span class=\"string\">        echo &quot;username: $&#123;CONFIGMAP_USERNAME&#125;&quot;</span></span><br><span class=\"line\"><span class=\"string\">        echo &quot;password: $&#123;CONFIGMAP_PASSWORD&#125;&quot;</span></span><br><span class=\"line\"><span class=\"string\"></span>    <span class=\"attr\">image:</span> <span class=\"string\">busybox:latest</span></span><br><span class=\"line\">    <span class=\"attr\">env:</span>                        <span class=\"comment\"># ç¯å¢ƒå˜é‡é…ç½®ï¼Œkey: value å½¢å¼</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">CONFIGMAP_USERNAME</span>  <span class=\"comment\"># è¦åœ¨podä¸­é…ç½®çš„ç¯å¢ƒå˜é‡çš„ key</span></span><br><span class=\"line\">      <span class=\"attr\">valueFrom:</span>                <span class=\"comment\"># value æ¥æº</span></span><br><span class=\"line\">        <span class=\"attr\">configMapKeyRef:</span>        <span class=\"comment\"># å¼•ç”¨ ConfigMap ä¸­çš„ key</span></span><br><span class=\"line\">          <span class=\"attr\">name:</span> <span class=\"string\">myconfigmap</span>     <span class=\"comment\"># configMap åç§°</span></span><br><span class=\"line\">          <span class=\"attr\">key:</span> <span class=\"string\">username</span>         <span class=\"comment\"># configMap ä¸­ key çš„åç§°</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">CONFIGMAP_PASSWORD</span></span><br><span class=\"line\">      <span class=\"attr\">valueFrom:</span></span><br><span class=\"line\">        <span class=\"attr\">configMapKeyRef:</span></span><br><span class=\"line\">          <span class=\"attr\">name:</span> <span class=\"string\">myconfigmap</span></span><br><span class=\"line\">          <span class=\"attr\">key:</span> <span class=\"string\">password</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æŸ¥çœ‹podæ—¥å¿—</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ kubectl logs pods/env-configmap</span><br><span class=\"line\">access_level=1</span><br><span class=\"line\">KUBERNETES_SERVICE_PORT=443</span><br><span class=\"line\">KUBERNETES_PORT=tcp://10.96.0.1:443</span><br><span class=\"line\">HOSTNAME=env-configmap</span><br><span class=\"line\">SHLVL=1</span><br><span class=\"line\">username=k8s-admin</span><br><span class=\"line\">HOME=/root</span><br><span class=\"line\">KUBERNETES_PORT_443_TCP_ADDR=10.96.0.1</span><br><span class=\"line\">PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin</span><br><span class=\"line\">KUBERNETES_PORT_443_TCP_PORT=443</span><br><span class=\"line\">password=123456</span><br><span class=\"line\">KUBERNETES_PORT_443_TCP_PROTO=tcp</span><br><span class=\"line\">KUBERNETES_PORT_443_TCP=tcp://10.96.0.1:443</span><br><span class=\"line\">KUBERNETES_SERVICE_PORT_HTTPS=443</span><br><span class=\"line\">KUBERNETES_SERVICE_HOST=10.96.0.1</span><br><span class=\"line\">PWD=/</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">$ kubectl logs pods/env-configmap2</span><br><span class=\"line\">username: k8s-admin</span><br><span class=\"line\">password: 123456</span><br></pre></td></tr></table></figure>\n<h3 id=\"å­˜å‚¨å·å¼•ç”¨\">å­˜å‚¨å·å¼•ç”¨</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>yamlåˆ›å»º</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># configmap-configfile.yaml</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">ConfigMap</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">app-config</span></span><br><span class=\"line\"><span class=\"attr\">data:</span></span><br><span class=\"line\">  <span class=\"attr\">app.properties:</span> <span class=\"string\">|</span>  <span class=\"comment\"># æ–‡ä»¶åç§° ï¼Œä½¿ç”¨ | åˆ›å»ºå¤šè¡Œ</span></span><br><span class=\"line\">    <span class=\"string\">server.port=8080</span></span><br><span class=\"line\">    <span class=\"string\">log.level=INFO</span></span><br><span class=\"line\">  <span class=\"attr\">db.properties:</span> <span class=\"string\">|</span>   <span class=\"comment\"># æ–‡ä»¶åç§°</span></span><br><span class=\"line\">    <span class=\"string\">db.host=localhost</span></span><br><span class=\"line\">    <span class=\"string\">db.port=5432</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å‘½ä»¤è¡Œåˆ›å»º</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> <span class=\"comment\"># æ³¨æ„è¿™é‡Œæ˜¯ --from-fileï¼Œä½œä¸ºæ–‡ä»¶é…ç½®ï¼Œè€Œéç¯å¢ƒå˜é‡</span></span><br><span class=\"line\">kubectl create configmap app-config \\</span><br><span class=\"line\">  --from-file=app.properties \\</span><br><span class=\"line\">  --from-file=db.properties</span><br><span class=\"line\"><span class=\"comment\"># app.properties æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</span></span><br><span class=\"line\"><span class=\"comment\"># server.port=8080</span></span><br><span class=\"line\"><span class=\"comment\"># log.level=INFO</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># db.properties æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</span></span><br><span class=\"line\"><span class=\"comment\"># db.host=localhost</span></span><br><span class=\"line\"><span class=\"comment\"># db.port=5432</span></span><br><span class=\"line\"></span><br><span class=\"line\">$ k get cm app-config -oyaml</span><br><span class=\"line\">apiVersion: v1</span><br><span class=\"line\">data:</span><br><span class=\"line\">  app.properties: |</span><br><span class=\"line\">    server.port=8080</span><br><span class=\"line\">    log.level=INFO</span><br><span class=\"line\">  db.properties: |</span><br><span class=\"line\">    db.host=localhost</span><br><span class=\"line\">    db.port=5432</span><br><span class=\"line\">kind: ConfigMap</span><br><span class=\"line\">metadata:</span><br><span class=\"line\">  creationTimestamp: <span class=\"string\">&quot;2025-07-05T10:49:00Z&quot;</span></span><br><span class=\"line\">  name: app-config</span><br><span class=\"line\">  namespace: default</span><br><span class=\"line\">  resourceVersion: <span class=\"string\">&quot;726507&quot;</span></span><br><span class=\"line\">  uid: 05c9a228-ec69-4e88-b8d8-63f97eff2651</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Pod æŒ‚è½½ ConfigMap ä¸ºæ–‡ä»¶</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># configmap-pod.yaml æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Pod</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">configmap-demo</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">containers:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">myapp</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">busybox</span></span><br><span class=\"line\">    <span class=\"attr\">command:</span> [<span class=\"string\">&quot;sleep&quot;</span>, <span class=\"string\">&quot;3600&quot;</span>]</span><br><span class=\"line\">    <span class=\"attr\">volumeMounts:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">config-volume</span></span><br><span class=\"line\">      <span class=\"attr\">mountPath:</span> <span class=\"string\">/etc/config</span>              <span class=\"comment\"># æŒ‚è½½è·¯å¾„</span></span><br><span class=\"line\">      <span class=\"attr\">readOnly:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">  <span class=\"attr\">volumes:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">config-volume</span>                   <span class=\"comment\"># å­˜å‚¨å· åç§°</span></span><br><span class=\"line\">    <span class=\"attr\">configMap:</span>                            <span class=\"comment\"># å­˜å‚¨å·ç±»å‹ä¸º ConfigMap</span></span><br><span class=\"line\">      <span class=\"attr\">name:</span> <span class=\"string\">app-config</span>                    <span class=\"comment\"># æŒ‚è½½çš„ ConfigMap åç§°ï¼Œæœ¬åˆ©ä¸­å°† configMap ä¸­çš„å…¨éƒ¨æ–‡ä»¶éƒ½æŒ‚è½½åˆ°podç›®å½•ä¸‹</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å®¹å™¨å†…çš„ <code>/etc/config/</code> ç›®å½•ä¸‹ä¼šæœ‰ä¸¤ä¸ªæ–‡ä»¶ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/etc/config/app.properties</span><br><span class=\"line\">/etc/config/db.properties</span><br><span class=\"line\"></span><br><span class=\"line\">$ k <span class=\"built_in\">exec</span> -it configmap-demo -- <span class=\"built_in\">ls</span> /etc/config/</span><br><span class=\"line\">app.properties  db.properties</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¦‚æœåªæƒ³æŒ‚è½½ ConfigMap ä¸­çš„æŸäº›æ–‡ä»¶ï¼Œå¯ä»¥é€šè¿‡ <code>items</code> å­—æ®µæŒ‡å®šï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Pod</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">configmap-demo</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">containers:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">myapp</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">busybox</span></span><br><span class=\"line\">    <span class=\"attr\">command:</span> [<span class=\"string\">&quot;sleep&quot;</span>, <span class=\"string\">&quot;3600&quot;</span>]</span><br><span class=\"line\">    <span class=\"attr\">volumeMounts:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">config-volume</span></span><br><span class=\"line\">      <span class=\"attr\">mountPath:</span> <span class=\"string\">/etc/config</span></span><br><span class=\"line\">      <span class=\"attr\">readOnly:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">  <span class=\"attr\">volumes:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">config-volume</span></span><br><span class=\"line\">    <span class=\"attr\">configMap:</span></span><br><span class=\"line\">      <span class=\"attr\">name:</span> <span class=\"string\">app-config</span></span><br><span class=\"line\">      <span class=\"attr\">items:</span>                   <span class=\"comment\"># æ˜ç¡®æŒ‡å®šæŒ‚è½½çš„key</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">key:</span> <span class=\"string\">app.properties</span>    <span class=\"comment\"># configMapä¸­çš„key</span></span><br><span class=\"line\">        <span class=\"attr\">path:</span> <span class=\"string\">app.properties</span>   <span class=\"comment\"># æ˜ å°„åˆ°å®¹å™¨å†…çš„è·¯å¾„ï¼Œæœ€ç»ˆæŒ‚è½½è·¯å¾„ä¸º /etc/config/app.properties</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"åè®°\">åè®°</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><code>--from-env-file=app.env</code> ä¸ <code>--from-file=app.env</code> çš„åŒºåˆ«</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>é¡¹ç›®</th>\n<th><code>--from-env-file=app.env</code></th>\n<th><code>--from-file=app.env</code></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>ç”¨é€”</td>\n<td>è§£æä¸ºç¯å¢ƒå˜é‡å½¢å¼é”®å€¼å¯¹</td>\n<td>æŒ‰æ–‡ä»¶æ•´ä½“è¯»å…¥ä¸ºå†…å®¹</td>\n</tr>\n<tr>\n<td>é€‚åˆåœºæ™¯</td>\n<td>æƒ³æŠŠæ¯ä¸ªå˜é‡éƒ½å•ç‹¬ç”¨æ‰</td>\n<td>æŒ‚è½½ä¸ºé…ç½®æ–‡ä»¶ä½¿ç”¨</td>\n</tr>\n<tr>\n<td>data ç»“æ„</td>\n<td>æ¯ä¸€è¡Œå˜ä¸€ä¸ªé”®å€¼å¯¹</td>\n<td>æ–‡ä»¶åä¸º keyï¼Œå†…å®¹ä¸ºå€¼</td>\n</tr>\n<tr>\n<td>è¯»å–æ–¹å¼</td>\n<td>ç”¨ <code>envFrom</code> æ³¨å…¥ç¯å¢ƒå˜é‡</td>\n<td>ç”¨ <code>volumeMount</code> æŒ‚è½½æ•´ä¸ªæ–‡ä»¶</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ConfigMap ä¹Ÿæ”¯æŒ <code>äºŒè¿›åˆ¶</code> æ•°æ®ï¼Œä½†éœ€è¦ç”¨ <code>base64</code> ç¼–ç </p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">ConfigMap</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">my-config</span></span><br><span class=\"line\"><span class=\"attr\">data:</span></span><br><span class=\"line\">  <span class=\"attr\">config.txt:</span> <span class=\"string\">|</span></span><br><span class=\"line\"><span class=\"string\">    Hello, world!</span></span><br><span class=\"line\"><span class=\"string\"></span><span class=\"attr\">binaryData:</span></span><br><span class=\"line\">  <span class=\"attr\">config.bin:</span> <span class=\"string\">aGVsbG8gd29ybGQK</span>   <span class=\"comment\"># è¿™æ˜¯ &quot;hello world&quot; çš„ base64 ç¼–ç </span></span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>binaryData å’Œ data çš„åŒºåˆ«</p>\n</blockquote>\n<table>\n<thead>\n<tr>\n<th>å­—æ®µ</th>\n<th>å†…å®¹ç±»å‹</th>\n<th>ç¼–ç æ–¹å¼</th>\n<th>é€‚åˆå­˜å‚¨</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>data</code></td>\n<td>æ–‡æœ¬ï¼ˆUTF-8ï¼‰</td>\n<td>æ˜æ–‡</td>\n<td>é…ç½®æ–‡ä»¶ã€å‚æ•°ã€è„šæœ¬ç­‰</td>\n</tr>\n<tr>\n<td><code>binaryData</code></td>\n<td>ä»»æ„äºŒè¿›åˆ¶æ•°æ®</td>\n<td>base64 ç¼–ç </td>\n<td>å›¾ç‰‡ã€è¯ä¹¦ã€éUTF-8æ–‡ä»¶ç­‰</td>\n</tr>\n</tbody>\n</table>\n<blockquote>\n<p>â—æ³¨æ„äº‹é¡¹</p>\n</blockquote>\n<table>\n<thead>\n<tr>\n<th>é¡¹ç›®</th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>base64 ç¼–ç æ ¼å¼</td>\n<td><code>binaryData</code> ä¸­çš„å€¼å¿…é¡»æ˜¯æ ‡å‡† base64ï¼Œä¸æ”¯æŒæ¢è¡Œ</td>\n</tr>\n<tr>\n<td>è§£ç åå¤§å°é™åˆ¶</td>\n<td>ConfigMap å•ä¸ªå¯¹è±¡æœ€å¤§ 1MBï¼ˆæ— è®º data è¿˜æ˜¯ binaryDataï¼‰</td>\n</tr>\n<tr>\n<td>äºŒè€…å¯å…±å­˜</td>\n<td><code>data</code> ä¸ <code>binaryData</code> å¯ä»¥åŒæ—¶å‡ºç°åœ¨åŒä¸€ä¸ª ConfigMap ä¸­ï¼ˆå­—æ®µåä¸èƒ½é‡å¤ï¼‰</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¿®æ”¹ ConfigMap å ï¼š<code>k edit configmap &lt;configmap-name&gt;</code></p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">å¦‚æœ Pod æ˜¯ä½œä¸º ç¯å¢ƒå˜é‡ å…³è”çš„ï¼ŒPod ä¸ä¼šæ›´æ–°ï¼Œåªèƒ½é‡æ–°åˆ›å»º</li>\n<li class=\"lvl-4\">å¦‚æœ Pod æ˜¯ä½œä¸º volume æŒ‚è½½çš„ï¼ŒPod ä¼šè‡ªåŠ¨æ›´æ–°(å¤§çº¦å‡ ç§’å)</li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<p>åˆ é™¤ ConfigMap åï¼š<code>k delete configmap &lt;configmap-name&gt;</code></p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>Pod çŠ¶æ€</th>\n<th>ConfigMap åˆ é™¤åå½±å“</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>æ­£åœ¨è¿è¡Œ</td>\n<td>ä¸å—å½±å“</td>\n</tr>\n<tr>\n<td>é‡å¯ / æ‰©å®¹</td>\n<td><strong>å¤±è´¥</strong>ï¼šæ‰¾ä¸åˆ° ConfigMapï¼Œæ— æ³•åˆ›å»ºå®¹å™¨</td>\n</tr>\n</tbody>\n</table>\n","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» K8S çš„ ConfigMap ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚ K8Så®˜ç½‘ k8s Github k8s ConfigMap å®˜æ–¹æ–‡æ¡£ ConfigMap(åˆ«åcm) ä»‹ç» ConfigMap æ˜¯ä¸€ç§ API å¯¹è±¡ï¼Œç”¨æ¥å°†éæœºå¯†æ€§çš„æ•°æ®ä¿å­˜åˆ°é”®å€¼å¯¹ä¸­ã€‚ ä½¿ç”¨æ—¶ï¼Œ Pod å¯ä»¥å°†å…¶ç”¨ä½œç¯å¢ƒå˜é‡ã€å‘½ä»¤è¡Œå‚æ•°æˆ–è€…å­˜å‚¨å·ä¸­çš„é…ç½®æ–‡ä»¶ã€‚ ConfigMap å°†ä½ çš„ç¯å¢ƒé…ç½®ä¿¡æ¯å’Œå®¹å™¨é•œåƒè§£è€¦ï¼Œä¾¿äºåº”ç”¨é…ç½®çš„ä¿®æ”¹ã€‚ å¤šä¸ª Pod å¯ä»¥å…³è”åŒä¸€ä¸ª ConfigMap ConfigMap åˆ›å»ºåŠä½¿ç”¨ ç¯å¢ƒå˜é‡å¼•ç”¨ yamlåˆ›å»º 123456789# configmap.yamlapiVersion: v1kind: ConfigMap # ConfigMapmetadata: name: myconfigmap # configmap åç§°data: # data å­—æ®µè®¾è®¡ç”¨æ¥ä¿å­˜ UTF-8 å­—ç¬¦ä¸²ï¼Œæœ€å¤§å€¼ä¸º 1M username: k8s-admin # key: value access_level: &quot;1&quot; password: &quot;123456&quot; å‘½ä»¤è¡Œåˆ›å»º 1234567891011121314151617181920212223242526# keyï¼švalue æ–¹å¼åˆ›å»ºkubectl create configmap myconfigmap --from-literal=username=k8s-admin --from-literal=access_level=1 --from-literal=password=123456# æ–‡ä»¶æ–¹å¼åˆ›å»º# --from-env-file=app.env ä½œç”¨ï¼šå°† app.env ä¸­çš„æ¯ä¸€è¡Œè§£æä¸º key=valueï¼Œæ¯ä¸€è¡Œå˜æˆ ConfigMap ä¸­çš„ä¸€ä¸ªé”®å€¼å¯¹ã€‚kubectl create configmap myconfigmap --from-env-file=app.env --from-env-file=other.env# app.env æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š# username=k8s-admin# access_level=1# other.env æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š# password=123456# åˆ›å»ºå®Œæˆåï¼ŒæŸ¥çœ‹ ConfigMap çš„å†…å®¹$ k get cm myconfigmap -oyamlapiVersion: v1data: access_level: &quot;1&quot; password: &quot;123456&quot; username: k8s-adminkind: ConfigMapmetadata: creationTimestamp: &quot;2025-07-05T10:29:15Z&quot; name: myconfigmap namespace: default resourceVersion: &quot;723770&quot; uid: ee850cf9-9014-4be2-97d8-5d1840e78d54 å°† ConfigMap ä¸­çš„å…¨éƒ¨æ•°æ®ä½œä¸ºç¯å¢ƒå˜é‡ä½¿ç”¨ 12345678910111213# pod.yamlapiVersion: v1kind: Podmetadata: name: env-configmapspec: containers: - name: app command: [&quot;/bin/sh&quot;, &quot;-c&quot;, &quot;printenv&quot;] # æ‰“å°ç¯å¢ƒå˜é‡ image: busybox:latest envFrom: # ç¯å¢ƒå˜é‡å¼•ç”¨æ–‡ä»¶ã€configMapï¼Œç­‰ç­‰ - configMapRef: # è¿™é‡Œå¼•ç”¨ ConfigMapï¼Œæ­¤å¤„å°† ConfigMap ä¸­çš„å…¨éƒ¨æ•°æ®ä½œä¸ºç¯å¢ƒå˜é‡ä½¿ç”¨ name: myconfigmap # configMap åç§° å°† ConfigMap ä¸­çš„éƒ¨åˆ†æ•°æ®ä½œä¸ºç¯å¢ƒå˜é‡ä½¿ç”¨ 12345678910111213141516171819202122232425# pod2.yamlapiVersion: v1kind: Podmetadata: name: env-configmap2spec: containers: - name: app command: [&quot;/bin/sh&quot;, &quot;-c&quot;] args: # å®¹å™¨å¯åŠ¨å‘½ä»¤ - | echo &quot;username: $&#123;CONFIGMAP_USERNAME&#125;&quot; echo &quot;password: $&#123;CONFIGMAP_PASSWORD&#125;&quot; image: busybox:latest env: # ç¯å¢ƒå˜é‡é…ç½®ï¼Œkey: value å½¢å¼ - name: CONFIGMAP_USERNAME # è¦åœ¨podä¸­é…ç½®çš„ç¯å¢ƒå˜é‡çš„ key valueFrom: # value æ¥æº configMapKeyRef: # å¼•ç”¨ ConfigMap ä¸­çš„ key name: myconfigmap # configMap åç§° key: username # configMap ä¸­ key çš„åç§° - name: CONFIGMAP_PASSWORD valueFrom: configMapKeyRef: name: myconfigmap key: password æŸ¥çœ‹podæ—¥å¿— 12345678910111213141516171819202122$ kubectl logs pods/env-configmapaccess_level=1KUBERNETES_SERVICE_PORT=443KUBERNETES_PORT=tcp://10.96.0.1:443HOSTNAME=env-configmapSHLVL=1username=k8s-adminHOME=/rootKUBERNETES_PORT_443_TCP_ADDR=10.96.0.1PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/binKUBERNETES_PORT_443_TCP_PORT=443password=123456KUBERNETES_PORT_443_TCP_PROTO=tcpKUBERNETES_PORT_443_TCP=tcp://10.96.0.1:443KUBERNETES_SERVICE_PORT_HTTPS=443KUBERNETES_SERVICE_HOST=10.96.0.1PWD=/$ kubectl logs pods/env-configmap2username: k8s-adminpassword: 123456 å­˜å‚¨å·å¼•ç”¨ yamlåˆ›å»º 123456789101112# configmap-configfile.yamlapiVersion: v1kind: ConfigMapmetadata: name: app-configdata: app.properties: | # æ–‡ä»¶åç§° ï¼Œä½¿ç”¨ | åˆ›å»ºå¤šè¡Œ server.port=8080 log.level=INFO db.properties: | # æ–‡ä»¶åç§° db.host=localhost db.port=5432 å‘½ä»¤è¡Œåˆ›å»º 12345678910111213141516171819202122232425262728 # æ³¨æ„è¿™é‡Œæ˜¯ --from-fileï¼Œä½œä¸ºæ–‡ä»¶é…ç½®ï¼Œè€Œéç¯å¢ƒå˜é‡kubectl create configmap app-config \\ --from-file=app.properties \\ --from-file=db.properties# app.properties æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š# server.port=8080# log.level=INFO# db.properties æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š# db.host=localhost# db.port=5432$ k get cm app-config -oyamlapiVersion: v1data: app.properties: | server.port=8080 log.level=INFO db.properties: | db.host=localhost db.port=5432kind: ConfigMapmetadata: creationTimestamp: &quot;2025-07-05T10:49:00Z&quot; name: app-config namespace: default resourceVersion: &quot;726507&quot; uid: 05c9a228-ec69-4e88-b8d8-63f97eff2651 Pod æŒ‚è½½ ConfigMap ä¸ºæ–‡ä»¶ 123456789101112131415161718# configmap-pod.yaml æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼šapiVersion: v1kind: Podmetadata: name: configmap-demospec: containers: - name: myapp image: busybox command: [&quot;sleep&quot;, &quot;3600&quot;] volumeMounts: - name: config-volume mountPath: /etc/config # æŒ‚è½½è·¯å¾„ readOnly: true volumes: - name: config-volume # å­˜å‚¨å· åç§° configMap: # å­˜å‚¨å·ç±»å‹ä¸º ConfigMap name: app-config # æŒ‚è½½çš„ ConfigMap åç§°ï¼Œæœ¬åˆ©ä¸­å°† configMap ä¸­çš„å…¨éƒ¨æ–‡ä»¶éƒ½æŒ‚è½½åˆ°podç›®å½•ä¸‹ å®¹å™¨å†…çš„ /etc/config/ ç›®å½•ä¸‹ä¼šæœ‰ä¸¤ä¸ªæ–‡ä»¶ï¼š 12345/etc/config/app.properties/etc/config/db.properties$ k exec -it configmap-demo -- ls /etc/config/app.properties db.properties å¦‚æœåªæƒ³æŒ‚è½½ ConfigMap ä¸­çš„æŸäº›æ–‡ä»¶ï¼Œå¯ä»¥é€šè¿‡ items å­—æ®µæŒ‡å®šï¼š 1234567891011121314151617181920apiVersion: v1kind: Podmetadata: name: configmap-demospec: containers: - name: myapp image: busybox command: [&quot;sleep&quot;, &quot;3600&quot;] volumeMounts: - name: config-volume mountPath: /etc/config readOnly: true volumes: - name: config-volume configMap: name: app-config items: # æ˜ç¡®æŒ‡å®šæŒ‚è½½çš„key - key: app.properties # configMapä¸­çš„key path: app.properties # æ˜ å°„åˆ°å®¹å™¨å†…çš„è·¯å¾„ï¼Œæœ€ç»ˆæŒ‚è½½è·¯å¾„ä¸º /etc/config/app.properties åè®° --from-env-file=app.env ä¸ --from-file=app.env çš„åŒºåˆ« é¡¹ç›® --from-env-file=app.env --from-file=app.env ç”¨é€” è§£æä¸ºç¯å¢ƒå˜é‡å½¢å¼é”®å€¼å¯¹ æŒ‰æ–‡ä»¶æ•´ä½“è¯»å…¥ä¸ºå†…å®¹ é€‚åˆåœºæ™¯ æƒ³æŠŠæ¯ä¸ªå˜é‡éƒ½å•ç‹¬ç”¨æ‰ æŒ‚è½½ä¸ºé…ç½®æ–‡ä»¶ä½¿ç”¨ data ç»“æ„ æ¯ä¸€è¡Œå˜ä¸€ä¸ªé”®å€¼å¯¹ æ–‡ä»¶åä¸º keyï¼Œå†…å®¹ä¸ºå€¼ è¯»å–æ–¹å¼ ç”¨ envFrom æ³¨å…¥ç¯å¢ƒå˜é‡ ç”¨ volumeMount æŒ‚è½½æ•´ä¸ªæ–‡ä»¶ ConfigMap ä¹Ÿæ”¯æŒ äºŒè¿›åˆ¶ æ•°æ®ï¼Œä½†éœ€è¦ç”¨ base64 ç¼–ç  123456789apiVersion: v1kind: ConfigMapmetadata: name: my-configdata: config.txt: | Hello, world!binaryData: config.bin: aGVsbG8gd29ybGQK # è¿™æ˜¯ &quot;hello world&quot; çš„ base64 ç¼–ç  binaryData å’Œ data çš„åŒºåˆ« å­—æ®µ å†…å®¹ç±»å‹ ç¼–ç æ–¹å¼ é€‚åˆå­˜å‚¨ data æ–‡æœ¬ï¼ˆUTF-8ï¼‰ æ˜æ–‡ é…ç½®æ–‡ä»¶ã€å‚æ•°ã€è„šæœ¬ç­‰ binaryData ä»»æ„äºŒè¿›åˆ¶æ•°æ® base64 ç¼–ç  å›¾ç‰‡ã€è¯ä¹¦ã€éUTF-8æ–‡ä»¶ç­‰ â—æ³¨æ„äº‹é¡¹ é¡¹ç›® è¯´æ˜ base64 ç¼–ç æ ¼å¼ binaryData ä¸­çš„å€¼å¿…é¡»æ˜¯æ ‡å‡† base64ï¼Œä¸æ”¯æŒæ¢è¡Œ è§£ç åå¤§å°é™åˆ¶ ConfigMap å•ä¸ªå¯¹è±¡æœ€å¤§ 1MBï¼ˆæ— è®º data è¿˜æ˜¯ binaryDataï¼‰ äºŒè€…å¯å…±å­˜ data ä¸ binaryData å¯ä»¥åŒæ—¶å‡ºç°åœ¨åŒä¸€ä¸ª ConfigMap ä¸­ï¼ˆå­—æ®µåä¸èƒ½é‡å¤ï¼‰ ä¿®æ”¹ ConfigMap å ï¼šk edit configmap &lt;configmap-name&gt; å¦‚æœ Pod æ˜¯ä½œä¸º ç¯å¢ƒå˜é‡ å…³è”çš„ï¼ŒPod ä¸ä¼šæ›´æ–°ï¼Œåªèƒ½é‡æ–°åˆ›å»º å¦‚æœ Pod æ˜¯ä½œä¸º volume æŒ‚è½½çš„ï¼ŒPod ä¼šè‡ªåŠ¨æ›´æ–°(å¤§çº¦å‡ ç§’å) åˆ é™¤ ConfigMap åï¼šk delete configmap &lt;configmap-name&gt; Pod çŠ¶æ€ ConfigMap åˆ é™¤åå½±å“ æ­£åœ¨è¿è¡Œ ä¸å—å½±å“ é‡å¯ / æ‰©å®¹ å¤±è´¥ï¼šæ‰¾ä¸åˆ° ConfigMapï¼Œæ— æ³•åˆ›å»ºå®¹å™¨","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» K8S çš„ ConfigMap ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚ K8Så®˜ç½‘ k8s Github k8s ConfigMap å®˜æ–¹æ–‡æ¡£","date_published":"2025-07-23T12:35:15.000Z","tags":["æŠ€æœ¯","k8s","K8S"]},{"id":"https://blog.hanqunfeng.com/2025/07/22/k8s-storageclass/","url":"https://blog.hanqunfeng.com/2025/07/22/k8s-storageclass/","title":"K8S ä¹‹ StorageClass","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç» K8S çš„ StorageClassï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://kubernetes.io/zh-cn/\">K8Så®˜ç½‘</a></p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://github.com/kubernetes/kubernetes\">k8s Github</a></p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://kubernetes.io/zh-cn/docs/concepts/storage/storage-classes/\">k8s StorageClass å®˜æ–¹æ–‡æ¡£</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡åº•å±‚å­˜å‚¨å·æ˜¯ NFS</p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"StorageClass-åˆ«åsc-ä»‹ç»\">StorageClass(åˆ«åsc) ä»‹ç»</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>K8s çš„å­˜å‚¨èµ„æºåˆ†ä¸ºä¸¤ç§ä¾›åº”æ¨¡å¼ï¼šé™æ€ä¾›åº”æ¨¡å¼ å’Œ åŠ¨æ€ä¾›åº”æ¨¡å¼ã€‚</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">é™æ€æ¨¡å¼ä¸‹ï¼Œç®¡ç†å‘˜éœ€è¦é¢„å…ˆåˆ›å»ºè®¸å¤šPVï¼Œç­‰å¾… PVC  æ¥ç»‘å®šã€‚</li>\n<li class=\"lvl-4\">åŠ¨æ€æ¨¡å¼ä¸‹ï¼ŒKubernetes ä¼šé€šè¿‡ StorageClass è‡ªåŠ¨åˆ›å»º PVï¼Œå¹¶å®Œæˆä¸ PVC çš„ç»‘å®šã€‚</li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<p>StorageClass æ˜¯ Kubernetes ä¸­ç”¨æ¥å®šä¹‰ <code>å­˜å‚¨åç«¯ç±»å‹å’Œé…ç½®å‚æ•°</code> çš„èµ„æº</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä½œç”¨ï¼š è‡ªåŠ¨åˆ›å»º PVï¼ˆPersistentVolumeï¼‰çš„â€œæ¨¡æ¿â€æˆ–â€œè§„åˆ™â€</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä½¿ç”¨åœºæ™¯ï¼š é…åˆ PVC ä½¿ç”¨æ—¶ï¼ŒKubernetes å¯ä»¥æ ¹æ® StorageClass è‡ªåŠ¨ åŠ¨æ€åˆ›å»º å¯¹åº”çš„æŒä¹…å·ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>âœ… æ ¸å¿ƒä¼˜åŠ¿ï¼š</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">æ— éœ€æ‰‹åŠ¨åˆ›å»º PV</li>\n<li class=\"lvl-4\">æ”¯æŒå¤šç§å­˜å‚¨åç«¯ï¼ˆNFSã€äº‘ç›˜ã€Cephã€GlusterFSã€iSCSIâ€¦ï¼‰</li>\n</ul>\n</li>\n</ul>\n<p><img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/uPic/OGGWYb.png\" alt=\"\"></p>\n<h2 id=\"åˆ›å»º-StorageClass\">åˆ›å»º StorageClass</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¸€ä¸ª NFS çš„ StorageClass çš„ yaml ç¤ºä¾‹</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># nfs-storage.yaml</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">storage.k8s.io/v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">StorageClass</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">nfs-csi</span>                                           <span class=\"comment\"># å­˜å‚¨ç±»åç§°</span></span><br><span class=\"line\"><span class=\"attr\">provisioner:</span> <span class=\"string\">nfs.csi.k8s.io</span>                               <span class=\"comment\"># æŒ‡å®šå­˜å‚¨æ’ä»¶çš„ CSI é©±åŠ¨åç§°ï¼Œéœ€è¦å®‰è£… nfs-csi-driver</span></span><br><span class=\"line\"><span class=\"attr\">reclaimPolicy:</span> <span class=\"string\">Delete</span>                                     <span class=\"comment\"># Retainï¼šPVC åˆ é™¤åï¼ŒPV ä¸ä¼šè¢«è‡ªåŠ¨åˆ é™¤ï¼ˆæ•°æ®ä¿ç•™ï¼‰ï¼Œé»˜è®¤æ˜¯ Delete,ç”Ÿäº§ç¯å¢ƒæ…ç”¨ã€‚</span></span><br><span class=\"line\"><span class=\"attr\">allowVolumeExpansion:</span> <span class=\"literal\">true</span>                                <span class=\"comment\"># æ˜¯å¦å…è®¸ PVC è‡ªåŠ¨æ‰©å®¹ï¼Œnfs æ”¯æŒæ‰©å®¹</span></span><br><span class=\"line\"><span class=\"attr\">mountOptions:</span>                                             <span class=\"comment\"># æŒ‚è½½é€‰é¡¹ï¼Œcsiæ’ä»¶ä¸åŒï¼Œé€‰é¡¹ä¸åŒã€‚è¿™é‡Œæ˜¯ nfsçš„</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">hard</span>                                                  <span class=\"comment\"># æœåŠ¡å™¨å¼‚å¸¸æ—¶å®¢æˆ·ç«¯ä¼šä¸€ç›´å‘è¯·æ±‚ç›´åˆ°æŒ‚è½½æˆåŠŸ</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">nfsvers=4.1</span>                                           <span class=\"comment\"># nfsç‰ˆæœ¬    nfs4.1</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">nolock</span>                                                <span class=\"comment\"># å…è®¸å¤šä¸ªå®¢æˆ·ç«¯åŒæ—¶è®¿é—®</span></span><br><span class=\"line\"><span class=\"attr\">volumeBindingMode:</span> <span class=\"string\">Immediate</span>                              <span class=\"comment\"># é»˜è®¤å€¼ï¼šImmediate: åˆ›å»ºPVCæ—¶ç«‹å³ç»‘å®š ,WaitForFirstConsumerï¼šç­‰åˆ° Pod è°ƒåº¦åˆ°èŠ‚ç‚¹åå†åˆ†é…å·ï¼Œé€‚åˆå¤šå¯ç”¨åŒºåœºæ™¯</span></span><br><span class=\"line\"><span class=\"attr\">parameters:</span>                                               <span class=\"comment\"># å‚æ•°é…ç½®</span></span><br><span class=\"line\">  <span class=\"attr\">server:</span> <span class=\"number\">10.211</span><span class=\"number\">.55</span><span class=\"number\">.88</span>                                    <span class=\"comment\"># nfsæœåŠ¡å™¨åœ°å€</span></span><br><span class=\"line\">  <span class=\"attr\">share:</span> <span class=\"string\">/nfs-server/data</span>                                 <span class=\"comment\"># nfs-serverä¸Šçš„å­˜å‚¨ç›®å½•</span></span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>csi-driver-nfs ä» v4.x èµ·ï¼Œå·²ç»æ”¯æŒ Delete reclaimPolicy å’Œ allowVolumeExpansion è‡ªåŠ¨æ‰©å®¹ã€‚<br>\nç”Ÿäº§ç¯å¢ƒæ…ç”¨ Delete reclaimPolicyï¼Œå› ä¸ºæ­¤æ—¶åˆ é™¤ PVC åï¼Œnfs-server ä¸Šçš„å­˜å‚¨ç›®å½•ä¹Ÿä¼šè¢«åˆ é™¤ã€‚</p>\n</blockquote>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ¯ä¸ª StorageClass é…ç½®ä¸­æœ‰ä¸‰ä¸ªå¿…å¡«çš„å‚æ•°ï¼š<code>provisioner</code>ã€<code>parameters</code> å’Œ <code>reclaimPolicy</code> å­—æ®µï¼Œ è¿™äº›å­—æ®µä¼šåœ¨ StorageClass éœ€è¦åŠ¨æ€åˆ¶å¤‡ PersistentVolume (PV) ä»¥æ»¡è¶³ PersistentVolumeClaim (PVC) æ—¶ä½¿ç”¨åˆ°ã€‚</p>\n</li>\n</ul>\n<h3 id=\"provisioner-å­˜å‚¨åˆ¶å¤‡å™¨\">provisioner: å­˜å‚¨åˆ¶å¤‡å™¨</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ¯ä¸ª StorageClass éƒ½æœ‰ä¸€ä¸ªåˆ¶å¤‡å™¨ï¼ˆProvisionerï¼‰ï¼Œç”¨æ¥å†³å®šä½¿ç”¨å“ªä¸ªå·æ’ä»¶åˆ¶å¤‡ PVã€‚ è¯¥å­—æ®µå¿…é¡»æŒ‡å®šã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>æ¯”å¦‚ NFS å­˜å‚¨åˆ¶å¤‡å™¨ï¼š<code>provisioner: nfs.csi.k8s.io</code>ï¼Œæ˜¯ K8S å®˜æ–¹ç»´æŠ¤çš„ NFS CSI æ’ä»¶ã€‚<a href=\"https://github.com/kubernetes-csi/csi-driver-nfs\">Github</a>ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å®‰è£… NFS CSI æ’ä»¶ï¼š<a href=\"https://github.com/kubernetes-csi/csi-driver-nfs/blob/master/docs/install-csi-driver-master.md\">Install NFS CSI Driver</a></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åœ¨çº¿å®‰è£…</span></span><br><span class=\"line\">curl -skSL https://raw.githubusercontent.com/kubernetes-csi/csi-driver-nfs/master/deploy/install-driver.sh | bash -s master --</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># éªŒè¯</span></span><br><span class=\"line\">kubectl -n kube-system get pod -o wide -l app=csi-nfs-controller</span><br><span class=\"line\">kubectl -n kube-system get pod -o wide -l app=csi-nfs-node</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¸è½½</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -skSL https://raw.githubusercontent.com/kubernetes-csi/csi-driver-nfs/master/deploy/uninstall-driver.sh | bash -s master --</span><br></pre></td></tr></table></figure>\n<h2 id=\"ç¤ºä¾‹\">ç¤ºä¾‹</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ›å»º StorageClass</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl apply -f nfs-storage.yaml</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">## æŸ¥çœ‹ storageclass</span></span><br><span class=\"line\">$ k get sc</span><br><span class=\"line\">NAME      PROVISIONER      RECLAIMPOLICY   VOLUMEBINDINGMODE   ALLOWVOLUMEEXPANSION   AGE</span><br><span class=\"line\">nfs-csi   nfs.csi.k8s.io   Delete          Immediate           <span class=\"literal\">true</span>                   5s</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ›å»º PVC æ—¶æŒ‡å®š storageclassï¼ŒStorageClass ä¼šè‡ªåŠ¨åˆ›å»º PV</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># nfs-pvc.yaml</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">PersistentVolumeClaim</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">nfs-pvc</span></span><br><span class=\"line\">  <span class=\"attr\">namespace:</span> <span class=\"string\">default</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">storageClassName:</span> <span class=\"string\">nfs-csi</span>  <span class=\"comment\"># æŒ‡å®š StorageClass çš„åç§°ï¼Œå¦‚æœè®¾ç½®äº†é»˜è®¤çš„scï¼Œæ­¤å¤„å¯ä»¥åˆ é™¤è¯¥é…ç½®</span></span><br><span class=\"line\">  <span class=\"attr\">accessModes:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">ReadWriteMany</span>          <span class=\"comment\"># æŒ‡å®šè®¿é—®æ¨¡å¼</span></span><br><span class=\"line\">  <span class=\"attr\">resources:</span></span><br><span class=\"line\">    <span class=\"attr\">requests:</span></span><br><span class=\"line\">      <span class=\"attr\">storage:</span> <span class=\"string\">800Mi</span>         <span class=\"comment\"># ç”³è¯·çš„å®¹é‡</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ›å»º PVC</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åˆ›å»º PVC</span></span><br><span class=\"line\">$ k apply -f nfs-pvc.yaml</span><br><span class=\"line\">persistentvolumeclaim/nfs-pvc created</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹ PVå’ŒPVCï¼Œå¯ä»¥çœ‹åˆ° PV è‡ªåŠ¨åˆ›å»ºäº†</span></span><br><span class=\"line\">$ k get pv,pvc</span><br><span class=\"line\">NAME                                                        CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS   CLAIM             STORAGECLASS   VOLUMEATTRIBUTESCLASS   REASON   AGE</span><br><span class=\"line\">persistentvolume/pvc-c1d33fec-5e16-4156-8405-1af4fc171907   800Mi      RWX            Delete           Bound    default/nfs-pvc   nfs-csi        &lt;<span class=\"built_in\">unset</span>&gt;                          2m4s</span><br><span class=\"line\"></span><br><span class=\"line\">NAME                            STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS   VOLUMEATTRIBUTESCLASS   AGE</span><br><span class=\"line\">persistentvolumeclaim/nfs-pvc   Bound    pvc-c1d33fec-5e16-4156-8405-1af4fc171907   800Mi      RWX            nfs-csi        &lt;<span class=\"built_in\">unset</span>&gt;                 2m4s</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è‡ªåŠ¨æ‰©å®¹ï¼Œä¿®æ”¹ PVC å®¹é‡åˆ° 1Gi</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl edit pvc nfs-pvc</span><br><span class=\"line\"><span class=\"comment\"># ä¿®æ”¹å¦‚ä¸‹</span></span><br><span class=\"line\"><span class=\"comment\"># &quot;storage&quot;:&quot;1Gi&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å†æ¬¡æŸ¥çœ‹ PV å’Œ PVCï¼Œå¯ä»¥çœ‹åˆ° è‡ªåŠ¨æ‰©å®¹æˆåŠŸ</span></span><br><span class=\"line\">$ k get pv,pvc</span><br><span class=\"line\">NAME                                                        CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS   CLAIM             STORAGECLASS   VOLUMEATTRIBUTESCLASS   REASON   AGE</span><br><span class=\"line\">persistentvolume/pvc-c1d33fec-5e16-4156-8405-1af4fc171907   1Gi        RWX            Delete           Bound    default/nfs-pvc   nfs-csi        &lt;<span class=\"built_in\">unset</span>&gt;                          4m50s</span><br><span class=\"line\"></span><br><span class=\"line\">NAME                            STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS   VOLUMEATTRIBUTESCLASS   AGE</span><br><span class=\"line\">persistentvolumeclaim/nfs-pvc   Bound    pvc-c1d33fec-5e16-4156-8405-1af4fc171907   1Gi        RWX            nfs-csi        &lt;<span class=\"built_in\">unset</span>&gt;                 4m50s</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ é™¤PVCï¼Œè‡ªåŠ¨åˆ é™¤PV</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl delete pvc nfs-pvc</span><br><span class=\"line\"><span class=\"comment\"># å†æ¬¡æŸ¥çœ‹ PV å’Œ PVCï¼Œå¯ä»¥çœ‹åˆ° PV å·²ç»è¢«è‡ªåŠ¨åˆ é™¤ï¼Œ reclaimPolicy: Delete</span></span><br><span class=\"line\">$ k get pv,pvc</span><br><span class=\"line\">No resources found</span><br><span class=\"line\"><span class=\"comment\"># æ­¤æ—¶ nfs-server çš„ç›®å½•ä¸‹çš„æ–‡ä»¶ä¹Ÿä¼šè¢«åˆ é™¤ï¼Œç”Ÿäº§ç¯å¢ƒæ…ç”¨</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"è®¾ç½®é»˜è®¤çš„-StorageClass\">è®¾ç½®é»˜è®¤çš„ StorageClass</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¸Šé¢æˆ‘ä»¬åˆ›å»º PVC çš„æ—¶å€™éœ€è¦æŒ‡å®š StorageClassï¼Œå¦‚æœæˆ‘ä»¬è®¾ç½®ä¸€ä¸ªé»˜è®¤çš„ StorageClassï¼Œé‚£ä¹ˆåœ¨PVCé‡Œå°±å¯ä»¥çœç•¥æ‰ StorageClass çš„è®¾ç½®ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>K8S ä¸­åªèƒ½è®¾ç½®ä¸€ä¸ªé»˜è®¤çš„ StorageClassï¼Œå¦‚æœæœ‰å¤šä¸ªï¼Œé‚£ä¹ˆå°±ä¼šæŠ¥é”™ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>è®¾ç½®é»˜è®¤çš„ StorageClass</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ä¸º sc æ·»åŠ  `é»˜è®¤` æ³¨è§£ï¼Œå»æ‰è¯¥æ³¨è§£ æˆ–è€… è®¾ç½®ä¸º false å°±å–æ¶ˆé»˜è®¤äº†ã€‚</span></span><br><span class=\"line\">$ kubectl patch storageclass nfs-csi -p <span class=\"string\">&#x27;&#123;&quot;metadata&quot;: &#123;&quot;annotations&quot;:&#123;&quot;storageclass.kubernetes.io/is-default-class&quot;:&quot;true&quot;&#125;&#125;&#125;&#x27;</span></span><br><span class=\"line\">storageclass.storage.k8s.io/nfs-csi patched</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹scï¼Œæ­¤æ—¶çœ‹åˆ°åç§°åé¢å¤šäº†ä¸€ä¸ª (default) ï¼Œè¡¨ç¤ºè¿™æ˜¯é»˜è®¤çš„ StorageClass</span></span><br><span class=\"line\">$ k get sc</span><br><span class=\"line\">NAME                PROVISIONER      RECLAIMPOLICY   VOLUMEBINDINGMODE   ALLOWVOLUMEEXPANSION   AGE</span><br><span class=\"line\">nfs-csi (default)   nfs.csi.k8s.io   Delete          Immediate           <span class=\"literal\">true</span>                   14m</span><br></pre></td></tr></table></figure>\n<h2 id=\"StatefulSet-è‡ªåŠ¨åˆ›å»º-PVC\">StatefulSet: è‡ªåŠ¨åˆ›å»º PVC</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¸Šé¢çš„æ–¹å¼è¿˜æ˜¯è¦æ±‚æˆ‘ä»¬å¿…é¡»åˆ›å»º PVCï¼Œæœ‰ä»€ä¹ˆæ–¹æ³•å¯ä»¥ä¸ç”¨åˆ›å»º PVC ï¼Œè€Œæ˜¯åœ¨åˆ›å»ºæ§åˆ¶å™¨çš„æ—¶å€™å°±ä¸€èµ·æŠŠ PVC åˆ›å»ºå¥½å‘¢ï¼Ÿ</p>\n</li>\n<li class=\"lvl-2\">\n<p>ç›®å‰åªæœ‰ <code>StatefulSet</code>æ§åˆ¶å™¨ æ‰æ”¯æŒè‡ªåŠ¨åˆ›å»º PVC</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># redis-statefulset.yaml</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">apps/v1</span>                  <span class=\"comment\"># æŒ‡å®šä½¿ç”¨çš„ API ç‰ˆæœ¬ï¼Œè¿™é‡Œæ˜¯ apps/v1ï¼Œé€‚ç”¨äº StatefulSet èµ„æº</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">StatefulSet</span>                    <span class=\"comment\"># Kubernetes èµ„æºç±»å‹ï¼Œè¿™é‡Œæ˜¯éƒ¨ç½²ï¼ˆStatefulSetï¼‰</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">redis-sts</span>                    <span class=\"comment\"># èµ„æºåç§°ï¼Œå¿…é¡»å”¯ä¸€ï¼ˆåœ¨åŒä¸€å‘½åç©ºé—´ä¸‹ï¼‰</span></span><br><span class=\"line\">  <span class=\"attr\">namespace:</span> <span class=\"string\">sts-ns</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span>                                <span class=\"comment\"># é…ç½®é¡¹</span></span><br><span class=\"line\">  <span class=\"attr\">revisionHistoryLimit:</span> <span class=\"number\">10</span>           <span class=\"comment\"># ä¿ç•™çš„å†å²ç‰ˆæœ¬æ•°ï¼Œé»˜è®¤å€¼ä¸º 10ï¼ŒDeployment å’Œ StatefulSet éƒ½æœ‰è¿™ä¸ªé…ç½®é¡¹ã€‚å›æ»šæ—¶æœ‰ç”¨ã€‚</span></span><br><span class=\"line\">  <span class=\"attr\">selector:</span>                          <span class=\"comment\"># é€‰æ‹©å™¨ï¼ŒæŒ‡å®šè¦ç®¡ç†çš„ Pod</span></span><br><span class=\"line\">    <span class=\"attr\">matchLabels:</span>                     <span class=\"comment\"># æ ‡ç­¾é€‰æ‹©å™¨</span></span><br><span class=\"line\">      <span class=\"attr\">app:</span> <span class=\"string\">redis</span>                     <span class=\"comment\"># é€‰æ‹©å™¨ï¼ŒæŒ‡å®š StatefulSet ç®¡ç†å“ªäº› Podï¼ˆæ ‡ç­¾å¿…é¡»ä¸ template ä¸­åŒ¹é…ï¼‰</span></span><br><span class=\"line\">  <span class=\"attr\">updateStrategy:</span>                    <span class=\"comment\"># æ›´æ–°ç­–ç•¥ï¼Œè¿™é‡Œè¦æ³¨æ„è¿™ä¸ªæ›´æ–°ç­–ç•¥ä¸Deploymentçš„å±æ€§åå­—ä¸ä¸€æ ·</span></span><br><span class=\"line\">    <span class=\"attr\">type:</span> <span class=\"string\">RollingUpdate</span>              <span class=\"comment\"># 1.RollingUpdateï¼šè¿™æ˜¯é»˜è®¤çš„æ›´æ–°ç­–ç•¥ã€‚ä½¿ç”¨ RollingUpdate æ›´æ–°ç­–ç•¥æ—¶ï¼Œåœ¨æ›´æ–° StatefulSet æ¨¡æ¿åï¼Œ è€çš„ StatefulSet Pod å°†è¢«ç»ˆæ­¢ï¼Œå¹¶ä¸”å°†ä»¥å—æ§æ–¹å¼è‡ªåŠ¨åˆ›å»ºæ–°çš„ StatefulSet Podã€‚ æ›´æ–°æœŸé—´ï¼Œæœ€å¤šåªèƒ½æœ‰ StatefulSet çš„ä¸€ä¸ª Pod è¿è¡Œäºæ¯ä¸ªèŠ‚ç‚¹ä¸Šã€‚</span></span><br><span class=\"line\">                                     <span class=\"comment\"># 2.OnDeleteï¼šä½¿ç”¨ OnDelete æ›´æ–°ç­–ç•¥æ—¶ï¼Œåœ¨æ›´æ–° StatefulSet æ¨¡æ¿åï¼Œåªæœ‰å½“ä½ æ‰‹åŠ¨åˆ é™¤è€çš„ StatefulSet Pod ä¹‹åï¼Œæ–°çš„ StatefulSet Pod æ‰ä¼šè¢«è‡ªåŠ¨åˆ›å»ºã€‚</span></span><br><span class=\"line\">    <span class=\"attr\">rollingUpdate:</span>                   <span class=\"comment\"># æ»šåŠ¨å‡çº§çš„é…ç½®</span></span><br><span class=\"line\">      <span class=\"attr\">partition:</span> <span class=\"number\">0</span>                   <span class=\"comment\"># ç”¨äºæ§åˆ¶ä»ç¬¬å‡ ä¸ª Pod å¼€å§‹æ»šåŠ¨å‡çº§</span></span><br><span class=\"line\">  <span class=\"attr\">serviceName:</span> <span class=\"string\">redis-svc</span>             <span class=\"comment\"># æœåŠ¡åç§°,stså¯¹è±¡ä½¿ç”¨æ— å¤´æœåŠ¡ï¼Œè¿™ä¸ªæ˜¯å¿…å¡«é¡¹ï¼Œéœ€è¦äº‹å…ˆåˆ›å»ºå¥½</span></span><br><span class=\"line\">  <span class=\"attr\">replicas:</span> <span class=\"number\">2</span>                        <span class=\"comment\"># å‰¯æœ¬æ•°ï¼Œé»˜è®¤æ˜¯ 1</span></span><br><span class=\"line\">  <span class=\"attr\">template:</span>                          <span class=\"comment\"># æ¨¡æ¿ï¼Œå®šä¹‰ Pod çš„å†…å®¹ï¼Œå…·ä½“å¯ä»¥å‚è€ƒ Pod çš„é…ç½®</span></span><br><span class=\"line\">    <span class=\"attr\">metadata:</span></span><br><span class=\"line\">      <span class=\"attr\">labels:</span></span><br><span class=\"line\">        <span class=\"attr\">app:</span> <span class=\"string\">redis</span>                   <span class=\"comment\"># Pod çš„æ ‡ç­¾ï¼Œå¿…é¡»ä¸ selector ä¸­çš„ matchLabels ä¸€è‡´</span></span><br><span class=\"line\">    <span class=\"attr\">spec:</span></span><br><span class=\"line\">      <span class=\"attr\">containers:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">image:</span> <span class=\"string\">redis:6.2</span>             <span class=\"comment\"># å®¹å™¨ä½¿ç”¨çš„é•œåƒï¼Œè¿™é‡Œæ˜¯å®˜æ–¹çš„ redis é•œåƒ</span></span><br><span class=\"line\">        <span class=\"attr\">name:</span> <span class=\"string\">redis</span>                  <span class=\"comment\"># å®¹å™¨çš„åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">volumeMounts:</span>                <span class=\"comment\"># æŒ‚è½½æ•°æ®å·</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">redis-data</span></span><br><span class=\"line\">          <span class=\"attr\">mountPath:</span> <span class=\"string\">/data</span>           <span class=\"comment\"># Redis æŒä¹…åŒ–æ•°æ®å­˜å‚¨è·¯å¾„ï¼Œæ ¹æ®å®é™…æƒ…å†µä¿®æ”¹</span></span><br><span class=\"line\">  <span class=\"attr\">volumeClaimTemplates:</span>              <span class=\"comment\"># é…ç½® PVC æ¨¡æ¿</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">metadata:</span></span><br><span class=\"line\">      <span class=\"attr\">name:</span> <span class=\"string\">redis-data</span>               <span class=\"comment\"># PVC åç§°</span></span><br><span class=\"line\">    <span class=\"attr\">spec:</span></span><br><span class=\"line\">      <span class=\"attr\">accessModes:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"string\">ReadWriteMany</span>              <span class=\"comment\"># è®¿é—®æ¨¡å¼ï¼šå¤šèŠ‚ç‚¹è¯»å†™</span></span><br><span class=\"line\">      <span class=\"attr\">resources:</span></span><br><span class=\"line\">        <span class=\"attr\">requests:</span></span><br><span class=\"line\">          <span class=\"attr\">storage:</span> <span class=\"string\">500Mi</span>             <span class=\"comment\"># è¯·æ±‚çš„å­˜å‚¨å®¹é‡ï¼Œæ ¹æ®å®é™…éœ€æ±‚è°ƒæ•´</span></span><br><span class=\"line\">      <span class=\"attr\">storageClassName:</span> <span class=\"string\">nfs-csi</span>      <span class=\"comment\"># å­˜å‚¨ç±»åç§°ï¼Œå¦‚æœä½¿ç”¨é»˜è®¤å­˜å‚¨ç±»ï¼Œåˆ™ä¸éœ€è¦æŒ‡å®š</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ›å»º StatefulSetï¼Œå¹¶æŸ¥çœ‹ PV,PVC</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åˆ›å»º StatefulSet</span></span><br><span class=\"line\">$ kubectl apply -f redis-statefulset.yaml</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹ PV,PVC</span></span><br><span class=\"line\">$ k get pv,pvc -n sts-ns</span><br><span class=\"line\">NAME                                                        CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS   CLAIM                           STORAGECLASS   VOLUMEATTRIBUTESCLASS   REASON   AGE</span><br><span class=\"line\">persistentvolume/pvc-748fc0d3-a142-4d08-b5c4-7320daea5618   500Mi      RWX            Delete           Bound    sts-ns/redis-data-redis-sts-1   nfs-csi        &lt;<span class=\"built_in\">unset</span>&gt;                          19s</span><br><span class=\"line\">persistentvolume/pvc-807018bb-ec66-4a5c-87f1-9c11df6f4784   500Mi      RWX            Delete           Bound    sts-ns/redis-data-redis-sts-0   nfs-csi        &lt;<span class=\"built_in\">unset</span>&gt;                          22s</span><br><span class=\"line\"></span><br><span class=\"line\">NAME                                           STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS   VOLUMEATTRIBUTESCLASS   AGE</span><br><span class=\"line\">persistentvolumeclaim/redis-data-redis-sts-0   Bound    pvc-807018bb-ec66-4a5c-87f1-9c11df6f4784   500Mi      RWX            nfs-csi        &lt;<span class=\"built_in\">unset</span>&gt;                 22s</span><br><span class=\"line\">persistentvolumeclaim/redis-data-redis-sts-1   Bound    pvc-748fc0d3-a142-4d08-b5c4-7320daea5618   500Mi      RWX            nfs-csi        &lt;<span class=\"built_in\">unset</span>&gt;                 20s</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>StatefulSet çš„ volumeClaimTemplates æ¯ä¸ª Pod å•ç‹¬åˆ›å»º PVCï¼ŒPod å’Œ PVC ä¸€ä¸€å¯¹åº”ï¼Œå³æœ‰å‡ ä¸ªå‰¯æœ¬å°±åˆ›å»ºå‡ ä¸ª PVCã€‚PVC åç§°æ˜¯ï¼š<code>&lt;volumeClaimTemplates.metadata.name&gt;-&lt;statefulset-name&gt;-&lt;pod-ordinal&gt;</code></p>\n</li>\n<li class=\"lvl-2\">\n<p>åˆ é™¤ StatefulSet</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl delete -f redis-statefulset.yaml</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹ PV,PVCï¼Œå‘ç°åˆ é™¤ StatefulSet åï¼ŒPV å’Œ PVC æ˜¯ä¸ä¼šè¢«è‡ªåŠ¨åˆ é™¤çš„ï¼Œéœ€è¦æ‰‹åŠ¨åˆ é™¤ PVC</span></span><br><span class=\"line\">$ k get pv,pvc -n sts-ns</span><br><span class=\"line\">NAME                                                        CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS   CLAIM                           STORAGECLASS   VOLUMEATTRIBUTESCLASS   REASON   AGE</span><br><span class=\"line\">persistentvolume/pvc-748fc0d3-a142-4d08-b5c4-7320daea5618   500Mi      RWX            Delete           Bound    sts-ns/redis-data-redis-sts-1   nfs-csi        &lt;<span class=\"built_in\">unset</span>&gt;                          6m30s</span><br><span class=\"line\">persistentvolume/pvc-807018bb-ec66-4a5c-87f1-9c11df6f4784   500Mi      RWX            Delete           Bound    sts-ns/redis-data-redis-sts-0   nfs-csi        &lt;<span class=\"built_in\">unset</span>&gt;                          6m33s</span><br><span class=\"line\"></span><br><span class=\"line\">NAME                                           STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS   VOLUMEATTRIBUTESCLASS   AGE</span><br><span class=\"line\">persistentvolumeclaim/redis-data-redis-sts-0   Bound    pvc-807018bb-ec66-4a5c-87f1-9c11df6f4784   500Mi      RWX            nfs-csi        &lt;<span class=\"built_in\">unset</span>&gt;                 6m33s</span><br><span class=\"line\">persistentvolumeclaim/redis-data-redis-sts-1   Bound    pvc-748fc0d3-a142-4d08-b5c4-7320daea5618   500Mi      RWX            nfs-csi        &lt;<span class=\"built_in\">unset</span>&gt;                 6m31s</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ‰‹åŠ¨åˆ é™¤ PVCï¼Œå› ä¸ºscé…ç½®çš„å›æ”¶ç­–ç•¥ä¸º Deleteï¼Œæ‰€ä»¥ PV ä¹Ÿä¼šè¢«åˆ é™¤</span></span><br><span class=\"line\">k delete pvc -n sts-ns redis-data-redis-sts-0</span><br><span class=\"line\">k delete pvc -n sts-ns redis-data-redis-sts-1</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å®é™…ä¸Šï¼Œæ— è®ºæ˜¯åˆ é™¤ statefulset è¿˜æ˜¯ç¼©å®¹ statefulsetï¼ŒPVC éƒ½ä¸ä¼šè¢«è‡ªåŠ¨åˆ é™¤ã€‚</p>\n</li>\n</ul>\n","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» K8S çš„ StorageClassï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚ K8Så®˜ç½‘ k8s Github k8s StorageClass å®˜æ–¹æ–‡æ¡£ æœ¬æ–‡åº•å±‚å­˜å‚¨å·æ˜¯ NFS StorageClass(åˆ«åsc) ä»‹ç» K8s çš„å­˜å‚¨èµ„æºåˆ†ä¸ºä¸¤ç§ä¾›åº”æ¨¡å¼ï¼šé™æ€ä¾›åº”æ¨¡å¼ å’Œ åŠ¨æ€ä¾›åº”æ¨¡å¼ã€‚ é™æ€æ¨¡å¼ä¸‹ï¼Œç®¡ç†å‘˜éœ€è¦é¢„å…ˆåˆ›å»ºè®¸å¤šPVï¼Œç­‰å¾… PVC æ¥ç»‘å®šã€‚ åŠ¨æ€æ¨¡å¼ä¸‹ï¼ŒKubernetes ä¼šé€šè¿‡ StorageClass è‡ªåŠ¨åˆ›å»º PVï¼Œå¹¶å®Œæˆä¸ PVC çš„ç»‘å®šã€‚ StorageClass æ˜¯ Kubernetes ä¸­ç”¨æ¥å®šä¹‰ å­˜å‚¨åç«¯ç±»å‹å’Œé…ç½®å‚æ•° çš„èµ„æº ä½œç”¨ï¼š è‡ªåŠ¨åˆ›å»º PVï¼ˆPersistentVolumeï¼‰çš„â€œæ¨¡æ¿â€æˆ–â€œè§„åˆ™â€ ä½¿ç”¨åœºæ™¯ï¼š é…åˆ PVC ä½¿ç”¨æ—¶ï¼ŒKubernetes å¯ä»¥æ ¹æ® StorageClass è‡ªåŠ¨ åŠ¨æ€åˆ›å»º å¯¹åº”çš„æŒä¹…å·ã€‚ âœ… æ ¸å¿ƒä¼˜åŠ¿ï¼š æ— éœ€æ‰‹åŠ¨åˆ›å»º PV æ”¯æŒå¤šç§å­˜å‚¨åç«¯ï¼ˆNFSã€äº‘ç›˜ã€Cephã€GlusterFSã€iSCSIâ€¦ï¼‰ åˆ›å»º StorageClass ä¸€ä¸ª NFS çš„ StorageClass çš„ yaml ç¤ºä¾‹ 12345678910111213141516# nfs-storage.yamlapiVersion: storage.k8s.io/v1kind: StorageClassmetadata: name: nfs-csi # å­˜å‚¨ç±»åç§°provisioner: nfs.csi.k8s.io # æŒ‡å®šå­˜å‚¨æ’ä»¶çš„ CSI é©±åŠ¨åç§°ï¼Œéœ€è¦å®‰è£… nfs-csi-driverreclaimPolicy: Delete # Retainï¼šPVC åˆ é™¤åï¼ŒPV ä¸ä¼šè¢«è‡ªåŠ¨åˆ é™¤ï¼ˆæ•°æ®ä¿ç•™ï¼‰ï¼Œé»˜è®¤æ˜¯ Delete,ç”Ÿäº§ç¯å¢ƒæ…ç”¨ã€‚allowVolumeExpansion: true # æ˜¯å¦å…è®¸ PVC è‡ªåŠ¨æ‰©å®¹ï¼Œnfs æ”¯æŒæ‰©å®¹mountOptions: # æŒ‚è½½é€‰é¡¹ï¼Œcsiæ’ä»¶ä¸åŒï¼Œé€‰é¡¹ä¸åŒã€‚è¿™é‡Œæ˜¯ nfsçš„ - hard # æœåŠ¡å™¨å¼‚å¸¸æ—¶å®¢æˆ·ç«¯ä¼šä¸€ç›´å‘è¯·æ±‚ç›´åˆ°æŒ‚è½½æˆåŠŸ - nfsvers=4.1 # nfsç‰ˆæœ¬ nfs4.1 - nolock # å…è®¸å¤šä¸ªå®¢æˆ·ç«¯åŒæ—¶è®¿é—®volumeBindingMode: Immediate # é»˜è®¤å€¼ï¼šImmediate: åˆ›å»ºPVCæ—¶ç«‹å³ç»‘å®š ,WaitForFirstConsumerï¼šç­‰åˆ° Pod è°ƒåº¦åˆ°èŠ‚ç‚¹åå†åˆ†é…å·ï¼Œé€‚åˆå¤šå¯ç”¨åŒºåœºæ™¯parameters: # å‚æ•°é…ç½® server: 10.211.55.88 # nfsæœåŠ¡å™¨åœ°å€ share: /nfs-server/data # nfs-serverä¸Šçš„å­˜å‚¨ç›®å½• csi-driver-nfs ä» v4.x èµ·ï¼Œå·²ç»æ”¯æŒ Delete reclaimPolicy å’Œ allowVolumeExpansion è‡ªåŠ¨æ‰©å®¹ã€‚ ç”Ÿäº§ç¯å¢ƒæ…ç”¨ Delete reclaimPolicyï¼Œå› ä¸ºæ­¤æ—¶åˆ é™¤ PVC åï¼Œnfs-server ä¸Šçš„å­˜å‚¨ç›®å½•ä¹Ÿä¼šè¢«åˆ é™¤ã€‚ æ¯ä¸ª StorageClass é…ç½®ä¸­æœ‰ä¸‰ä¸ªå¿…å¡«çš„å‚æ•°ï¼šprovisionerã€parameters å’Œ reclaimPolicy å­—æ®µï¼Œ è¿™äº›å­—æ®µä¼šåœ¨ StorageClass éœ€è¦åŠ¨æ€åˆ¶å¤‡ PersistentVolume (PV) ä»¥æ»¡è¶³ PersistentVolumeClaim (PVC) æ—¶ä½¿ç”¨åˆ°ã€‚ provisioner: å­˜å‚¨åˆ¶å¤‡å™¨ æ¯ä¸ª StorageClass éƒ½æœ‰ä¸€ä¸ªåˆ¶å¤‡å™¨ï¼ˆProvisionerï¼‰ï¼Œç”¨æ¥å†³å®šä½¿ç”¨å“ªä¸ªå·æ’ä»¶åˆ¶å¤‡ PVã€‚ è¯¥å­—æ®µå¿…é¡»æŒ‡å®šã€‚ æ¯”å¦‚ NFS å­˜å‚¨åˆ¶å¤‡å™¨ï¼šprovisioner: nfs.csi.k8s.ioï¼Œæ˜¯ K8S å®˜æ–¹ç»´æŠ¤çš„ NFS CSI æ’ä»¶ã€‚Githubã€‚ å®‰è£… NFS CSI æ’ä»¶ï¼šInstall NFS CSI Driver 123456# åœ¨çº¿å®‰è£…curl -skSL https://raw.githubusercontent.com/kubernetes-csi/csi-driver-nfs/master/deploy/install-driver.sh | bash -s master --# éªŒè¯kubectl -n kube-system get pod -o wide -l app=csi-nfs-controllerkubectl -n kube-system get pod -o wide -l app=csi-nfs-node å¸è½½ 1curl -skSL https://raw.githubusercontent.com/kubernetes-csi/csi-driver-nfs/master/deploy/uninstall-driver.sh | bash -s master -- ç¤ºä¾‹ åˆ›å»º StorageClass 123456kubectl apply -f nfs-storage.yaml## æŸ¥çœ‹ storageclass$ k get scNAME PROVISIONER RECLAIMPOLICY VOLUMEBINDINGMODE ALLOWVOLUMEEXPANSION AGEnfs-csi nfs.csi.k8s.io Delete Immediate true 5s åˆ›å»º PVC æ—¶æŒ‡å®š storageclassï¼ŒStorageClass ä¼šè‡ªåŠ¨åˆ›å»º PV 12345678910111213# nfs-pvc.yamlapiVersion: v1kind: PersistentVolumeClaimmetadata: name: nfs-pvc namespace: defaultspec: storageClassName: nfs-csi # æŒ‡å®š StorageClass çš„åç§°ï¼Œå¦‚æœè®¾ç½®äº†é»˜è®¤çš„scï¼Œæ­¤å¤„å¯ä»¥åˆ é™¤è¯¥é…ç½® accessModes: - ReadWriteMany # æŒ‡å®šè®¿é—®æ¨¡å¼ resources: requests: storage: 800Mi # ç”³è¯·çš„å®¹é‡ åˆ›å»º PVC 1234567891011# åˆ›å»º PVC$ k apply -f nfs-pvc.yamlpersistentvolumeclaim/nfs-pvc created# æŸ¥çœ‹ PVå’ŒPVCï¼Œå¯ä»¥çœ‹åˆ° PV è‡ªåŠ¨åˆ›å»ºäº†$ k get pv,pvcNAME CAPACITY ACCESS MODES RECLAIM POLICY STATUS CLAIM STORAGECLASS VOLUMEATTRIBUTESCLASS REASON AGEpersistentvolume/pvc-c1d33fec-5e16-4156-8405-1af4fc171907 800Mi RWX Delete Bound default/nfs-pvc nfs-csi &lt;unset&gt; 2m4sNAME STATUS VOLUME CAPACITY ACCESS MODES STORAGECLASS VOLUMEATTRIBUTESCLASS AGEpersistentvolumeclaim/nfs-pvc Bound pvc-c1d33fec-5e16-4156-8405-1af4fc171907 800Mi RWX nfs-csi &lt;unset&gt; 2m4s è‡ªåŠ¨æ‰©å®¹ï¼Œä¿®æ”¹ PVC å®¹é‡åˆ° 1Gi 1234567891011kubectl edit pvc nfs-pvc# ä¿®æ”¹å¦‚ä¸‹# &quot;storage&quot;:&quot;1Gi&quot;# å†æ¬¡æŸ¥çœ‹ PV å’Œ PVCï¼Œå¯ä»¥çœ‹åˆ° è‡ªåŠ¨æ‰©å®¹æˆåŠŸ$ k get pv,pvcNAME CAPACITY ACCESS MODES RECLAIM POLICY STATUS CLAIM STORAGECLASS VOLUMEATTRIBUTESCLASS REASON AGEpersistentvolume/pvc-c1d33fec-5e16-4156-8405-1af4fc171907 1Gi RWX Delete Bound default/nfs-pvc nfs-csi &lt;unset&gt; 4m50sNAME STATUS VOLUME CAPACITY ACCESS MODES STORAGECLASS VOLUMEATTRIBUTESCLASS AGEpersistentvolumeclaim/nfs-pvc Bound pvc-c1d33fec-5e16-4156-8405-1af4fc171907 1Gi RWX nfs-csi &lt;unset&gt; 4m50s åˆ é™¤PVCï¼Œè‡ªåŠ¨åˆ é™¤PV 12345kubectl delete pvc nfs-pvc# å†æ¬¡æŸ¥çœ‹ PV å’Œ PVCï¼Œå¯ä»¥çœ‹åˆ° PV å·²ç»è¢«è‡ªåŠ¨åˆ é™¤ï¼Œ reclaimPolicy: Delete$ k get pv,pvcNo resources found# æ­¤æ—¶ nfs-server çš„ç›®å½•ä¸‹çš„æ–‡ä»¶ä¹Ÿä¼šè¢«åˆ é™¤ï¼Œç”Ÿäº§ç¯å¢ƒæ…ç”¨ è®¾ç½®é»˜è®¤çš„ StorageClass ä¸Šé¢æˆ‘ä»¬åˆ›å»º PVC çš„æ—¶å€™éœ€è¦æŒ‡å®š StorageClassï¼Œå¦‚æœæˆ‘ä»¬è®¾ç½®ä¸€ä¸ªé»˜è®¤çš„ StorageClassï¼Œé‚£ä¹ˆåœ¨PVCé‡Œå°±å¯ä»¥çœç•¥æ‰ StorageClass çš„è®¾ç½®ã€‚ K8S ä¸­åªèƒ½è®¾ç½®ä¸€ä¸ªé»˜è®¤çš„ StorageClassï¼Œå¦‚æœæœ‰å¤šä¸ªï¼Œé‚£ä¹ˆå°±ä¼šæŠ¥é”™ã€‚ è®¾ç½®é»˜è®¤çš„ StorageClass 12345678# ä¸º sc æ·»åŠ  `é»˜è®¤` æ³¨è§£ï¼Œå»æ‰è¯¥æ³¨è§£ æˆ–è€… è®¾ç½®ä¸º false å°±å–æ¶ˆé»˜è®¤äº†ã€‚$ kubectl patch storageclass nfs-csi -p &#x27;&#123;&quot;metadata&quot;: &#123;&quot;annotations&quot;:&#123;&quot;storageclass.kubernetes.io/is-default-class&quot;:&quot;true&quot;&#125;&#125;&#125;&#x27;storageclass.storage.k8s.io/nfs-csi patched# æŸ¥çœ‹scï¼Œæ­¤æ—¶çœ‹åˆ°åç§°åé¢å¤šäº†ä¸€ä¸ª (default) ï¼Œè¡¨ç¤ºè¿™æ˜¯é»˜è®¤çš„ StorageClass$ k get scNAME PROVISIONER RECLAIMPOLICY VOLUMEBINDINGMODE ALLOWVOLUMEEXPANSION AGEnfs-csi (default) nfs.csi.k8s.io Delete Immediate true 14m StatefulSet: è‡ªåŠ¨åˆ›å»º PVC ä¸Šé¢çš„æ–¹å¼è¿˜æ˜¯è¦æ±‚æˆ‘ä»¬å¿…é¡»åˆ›å»º PVCï¼Œæœ‰ä»€ä¹ˆæ–¹æ³•å¯ä»¥ä¸ç”¨åˆ›å»º PVC ï¼Œè€Œæ˜¯åœ¨åˆ›å»ºæ§åˆ¶å™¨çš„æ—¶å€™å°±ä¸€èµ·æŠŠ PVC åˆ›å»ºå¥½å‘¢ï¼Ÿ ç›®å‰åªæœ‰ StatefulSetæ§åˆ¶å™¨ æ‰æ”¯æŒè‡ªåŠ¨åˆ›å»º PVC 123456789101112131415161718192021222324252627282930313233343536373839# redis-statefulset.yamlapiVersion: apps/v1 # æŒ‡å®šä½¿ç”¨çš„ API ç‰ˆæœ¬ï¼Œè¿™é‡Œæ˜¯ apps/v1ï¼Œé€‚ç”¨äº StatefulSet èµ„æºkind: StatefulSet # Kubernetes èµ„æºç±»å‹ï¼Œè¿™é‡Œæ˜¯éƒ¨ç½²ï¼ˆStatefulSetï¼‰metadata: name: redis-sts # èµ„æºåç§°ï¼Œå¿…é¡»å”¯ä¸€ï¼ˆåœ¨åŒä¸€å‘½åç©ºé—´ä¸‹ï¼‰ namespace: sts-nsspec: # é…ç½®é¡¹ revisionHistoryLimit: 10 # ä¿ç•™çš„å†å²ç‰ˆæœ¬æ•°ï¼Œé»˜è®¤å€¼ä¸º 10ï¼ŒDeployment å’Œ StatefulSet éƒ½æœ‰è¿™ä¸ªé…ç½®é¡¹ã€‚å›æ»šæ—¶æœ‰ç”¨ã€‚ selector: # é€‰æ‹©å™¨ï¼ŒæŒ‡å®šè¦ç®¡ç†çš„ Pod matchLabels: # æ ‡ç­¾é€‰æ‹©å™¨ app: redis # é€‰æ‹©å™¨ï¼ŒæŒ‡å®š StatefulSet ç®¡ç†å“ªäº› Podï¼ˆæ ‡ç­¾å¿…é¡»ä¸ template ä¸­åŒ¹é…ï¼‰ updateStrategy: # æ›´æ–°ç­–ç•¥ï¼Œè¿™é‡Œè¦æ³¨æ„è¿™ä¸ªæ›´æ–°ç­–ç•¥ä¸Deploymentçš„å±æ€§åå­—ä¸ä¸€æ · type: RollingUpdate # 1.RollingUpdateï¼šè¿™æ˜¯é»˜è®¤çš„æ›´æ–°ç­–ç•¥ã€‚ä½¿ç”¨ RollingUpdate æ›´æ–°ç­–ç•¥æ—¶ï¼Œåœ¨æ›´æ–° StatefulSet æ¨¡æ¿åï¼Œ è€çš„ StatefulSet Pod å°†è¢«ç»ˆæ­¢ï¼Œå¹¶ä¸”å°†ä»¥å—æ§æ–¹å¼è‡ªåŠ¨åˆ›å»ºæ–°çš„ StatefulSet Podã€‚ æ›´æ–°æœŸé—´ï¼Œæœ€å¤šåªèƒ½æœ‰ StatefulSet çš„ä¸€ä¸ª Pod è¿è¡Œäºæ¯ä¸ªèŠ‚ç‚¹ä¸Šã€‚ # 2.OnDeleteï¼šä½¿ç”¨ OnDelete æ›´æ–°ç­–ç•¥æ—¶ï¼Œåœ¨æ›´æ–° StatefulSet æ¨¡æ¿åï¼Œåªæœ‰å½“ä½ æ‰‹åŠ¨åˆ é™¤è€çš„ StatefulSet Pod ä¹‹åï¼Œæ–°çš„ StatefulSet Pod æ‰ä¼šè¢«è‡ªåŠ¨åˆ›å»ºã€‚ rollingUpdate: # æ»šåŠ¨å‡çº§çš„é…ç½® partition: 0 # ç”¨äºæ§åˆ¶ä»ç¬¬å‡ ä¸ª Pod å¼€å§‹æ»šåŠ¨å‡çº§ serviceName: redis-svc # æœåŠ¡åç§°,stså¯¹è±¡ä½¿ç”¨æ— å¤´æœåŠ¡ï¼Œè¿™ä¸ªæ˜¯å¿…å¡«é¡¹ï¼Œéœ€è¦äº‹å…ˆåˆ›å»ºå¥½ replicas: 2 # å‰¯æœ¬æ•°ï¼Œé»˜è®¤æ˜¯ 1 template: # æ¨¡æ¿ï¼Œå®šä¹‰ Pod çš„å†…å®¹ï¼Œå…·ä½“å¯ä»¥å‚è€ƒ Pod çš„é…ç½® metadata: labels: app: redis # Pod çš„æ ‡ç­¾ï¼Œå¿…é¡»ä¸ selector ä¸­çš„ matchLabels ä¸€è‡´ spec: containers: - image: redis:6.2 # å®¹å™¨ä½¿ç”¨çš„é•œåƒï¼Œè¿™é‡Œæ˜¯å®˜æ–¹çš„ redis é•œåƒ name: redis # å®¹å™¨çš„åç§° volumeMounts: # æŒ‚è½½æ•°æ®å· - name: redis-data mountPath: /data # Redis æŒä¹…åŒ–æ•°æ®å­˜å‚¨è·¯å¾„ï¼Œæ ¹æ®å®é™…æƒ…å†µä¿®æ”¹ volumeClaimTemplates: # é…ç½® PVC æ¨¡æ¿ - metadata: name: redis-data # PVC åç§° spec: accessModes: - ReadWriteMany # è®¿é—®æ¨¡å¼ï¼šå¤šèŠ‚ç‚¹è¯»å†™ resources: requests: storage: 500Mi # è¯·æ±‚çš„å­˜å‚¨å®¹é‡ï¼Œæ ¹æ®å®é™…éœ€æ±‚è°ƒæ•´ storageClassName: nfs-csi # å­˜å‚¨ç±»åç§°ï¼Œå¦‚æœä½¿ç”¨é»˜è®¤å­˜å‚¨ç±»ï¼Œåˆ™ä¸éœ€è¦æŒ‡å®š åˆ›å»º StatefulSetï¼Œå¹¶æŸ¥çœ‹ PV,PVC 123456789101112# åˆ›å»º StatefulSet$ kubectl apply -f redis-statefulset.yaml# æŸ¥çœ‹ PV,PVC$ k get pv,pvc -n sts-nsNAME CAPACITY ACCESS MODES RECLAIM POLICY STATUS CLAIM STORAGECLASS VOLUMEATTRIBUTESCLASS REASON AGEpersistentvolume/pvc-748fc0d3-a142-4d08-b5c4-7320daea5618 500Mi RWX Delete Bound sts-ns/redis-data-redis-sts-1 nfs-csi &lt;unset&gt; 19spersistentvolume/pvc-807018bb-ec66-4a5c-87f1-9c11df6f4784 500Mi RWX Delete Bound sts-ns/redis-data-redis-sts-0 nfs-csi &lt;unset&gt; 22sNAME STATUS VOLUME CAPACITY ACCESS MODES STORAGECLASS VOLUMEATTRIBUTESCLASS AGEpersistentvolumeclaim/redis-data-redis-sts-0 Bound pvc-807018bb-ec66-4a5c-87f1-9c11df6f4784 500Mi RWX nfs-csi &lt;unset&gt; 22spersistentvolumeclaim/redis-data-redis-sts-1 Bound pvc-748fc0d3-a142-4d08-b5c4-7320daea5618 500Mi RWX nfs-csi &lt;unset&gt; 20s StatefulSet çš„ volumeClaimTemplates æ¯ä¸ª Pod å•ç‹¬åˆ›å»º PVCï¼ŒPod å’Œ PVC ä¸€ä¸€å¯¹åº”ï¼Œå³æœ‰å‡ ä¸ªå‰¯æœ¬å°±åˆ›å»ºå‡ ä¸ª PVCã€‚PVC åç§°æ˜¯ï¼š&lt;volumeClaimTemplates.metadata.name&gt;-&lt;statefulset-name&gt;-&lt;pod-ordinal&gt; åˆ é™¤ StatefulSet 123456789101112131415kubectl delete -f redis-statefulset.yaml# æŸ¥çœ‹ PV,PVCï¼Œå‘ç°åˆ é™¤ StatefulSet åï¼ŒPV å’Œ PVC æ˜¯ä¸ä¼šè¢«è‡ªåŠ¨åˆ é™¤çš„ï¼Œéœ€è¦æ‰‹åŠ¨åˆ é™¤ PVC$ k get pv,pvc -n sts-nsNAME CAPACITY ACCESS MODES RECLAIM POLICY STATUS CLAIM STORAGECLASS VOLUMEATTRIBUTESCLASS REASON AGEpersistentvolume/pvc-748fc0d3-a142-4d08-b5c4-7320daea5618 500Mi RWX Delete Bound sts-ns/redis-data-redis-sts-1 nfs-csi &lt;unset&gt; 6m30spersistentvolume/pvc-807018bb-ec66-4a5c-87f1-9c11df6f4784 500Mi RWX Delete Bound sts-ns/redis-data-redis-sts-0 nfs-csi &lt;unset&gt; 6m33sNAME STATUS VOLUME CAPACITY ACCESS MODES STORAGECLASS VOLUMEATTRIBUTESCLASS AGEpersistentvolumeclaim/redis-data-redis-sts-0 Bound pvc-807018bb-ec66-4a5c-87f1-9c11df6f4784 500Mi RWX nfs-csi &lt;unset&gt; 6m33spersistentvolumeclaim/redis-data-redis-sts-1 Bound pvc-748fc0d3-a142-4d08-b5c4-7320daea5618 500Mi RWX nfs-csi &lt;unset&gt; 6m31s# æ‰‹åŠ¨åˆ é™¤ PVCï¼Œå› ä¸ºscé…ç½®çš„å›æ”¶ç­–ç•¥ä¸º Deleteï¼Œæ‰€ä»¥ PV ä¹Ÿä¼šè¢«åˆ é™¤k delete pvc -n sts-ns redis-data-redis-sts-0k delete pvc -n sts-ns redis-data-redis-sts-1 å®é™…ä¸Šï¼Œæ— è®ºæ˜¯åˆ é™¤ statefulset è¿˜æ˜¯ç¼©å®¹ statefulsetï¼ŒPVC éƒ½ä¸ä¼šè¢«è‡ªåŠ¨åˆ é™¤ã€‚","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» K8S çš„ StorageClassï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚ K8Så®˜ç½‘ k8s Github k8s StorageClass å®˜æ–¹æ–‡æ¡£ æœ¬æ–‡åº•å±‚å­˜å‚¨å·æ˜¯ NFS","date_published":"2025-07-22T12:35:15.000Z","tags":["æŠ€æœ¯","k8s","K8S"]},{"id":"https://blog.hanqunfeng.com/2025/07/21/k8s-storage-pv-pvc/","url":"https://blog.hanqunfeng.com/2025/07/21/k8s-storage-pv-pvc/","title":"K8S ä¹‹ æŒä¹…å· PV å’Œ PVC","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç» K8S çš„ æŒä¹…å· PV å’Œ PVC ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://kubernetes.io/zh-cn/\">K8Så®˜ç½‘</a></p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://github.com/kubernetes/kubernetes\">k8s Github</a></p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://kubernetes.io/zh-cn/docs/concepts/storage/persistent-volumes/\">k8s PV/PVC å®˜æ–¹æ–‡æ¡£</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡åº•å±‚å­˜å‚¨å·æ˜¯ NFS</p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"PV-å’Œ-PVC-ä»‹ç»\">PV å’Œ PVC ä»‹ç»</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>PV(PersistentVolume) æ˜¯ Kubernetes ä¸­çš„ä¸€ç§å­˜å‚¨èµ„æºï¼Œç”¨äºå°†åº•å±‚çš„ç‰©ç†å­˜å‚¨ï¼ˆå¦‚ NFSã€iSCSIã€Cephã€äº‘å­˜å‚¨ç­‰ï¼‰æŠ½è±¡æˆ Kubernetes èµ„æºï¼Œä¾› Pod ä½¿ç”¨ã€‚å®ƒæ˜¯å¯¹å­˜å‚¨çš„ä¸€ç§â€œå£°æ˜å¼â€ç®¡ç†ï¼Œç±»ä¼¼äº Pod å£°æ˜è®¡ç®—èµ„æºã€‚PV æ˜¯é›†ç¾¤çº§åˆ«çš„å­˜å‚¨èµ„æºï¼Œä¸æ”¯æŒ Namespaceã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>PVC(PersistentVolumeClaim)ï¼ŒæŒä¹…å·å£°æ˜ï¼Œ æ˜¯ Kubernetes ä¸­ç”¨äºç”³è¯·å­˜å‚¨èµ„æºçš„å¯¹è±¡ã€‚PVC æ˜¯ Namespace çº§åˆ«çš„èµ„æºã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ç®€è€Œè¨€ä¹‹ï¼š</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">PV æ˜¯é›†ç¾¤ä¸­çš„ä¸€å—å­˜å‚¨ï¼Œç”±ç®¡ç†å‘˜æå‰é…ç½®æˆ–åŠ¨æ€åˆ›å»ºã€‚</li>\n<li class=\"lvl-4\">PVCï¼ˆPersistentVolumeClaimï¼‰ æ˜¯ç”¨æˆ·å¯¹å­˜å‚¨çš„ç”³è¯·ã€‚</li>\n<li class=\"lvl-4\">Pod é€šè¿‡ PVC ç»‘å®šåˆ° PVï¼Œä½¿ç”¨æŒä¹…åŒ–å­˜å‚¨ã€‚</li>\n<li class=\"lvl-4\">å¼€å‘è€…ç”¨ PVC æ¥ç”³è¯·å­˜å‚¨ç©ºé—´ï¼Œä¸å…³å¿ƒå­˜å‚¨çš„å…·ä½“å®ç°æ–¹å¼ã€‚</li>\n<li class=\"lvl-4\">PVC é€šè¿‡ Kubernetes è‡ªåŠ¨åŒ¹é…ä¸€ä¸ªåˆé€‚çš„ PersistentVolumeï¼ˆPVï¼‰è¿›è¡Œç»‘å®šã€‚</li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<p>PV ä¸ PVC çš„åŸºæœ¬æµç¨‹</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">ç®¡ç†å‘˜åˆ›å»º PVï¼ˆæˆ–è€…é›†ç¾¤é€šè¿‡ StorageClass è‡ªåŠ¨åˆ›å»ºï¼‰ã€‚</li>\n<li class=\"lvl-4\">ç”¨æˆ·æäº¤ PVCï¼Œå£°æ˜è‡ªå·±éœ€è¦å¤šå°‘å®¹é‡ã€ä»€ä¹ˆè®¿é—®æ¨¡å¼ã€‚</li>\n<li class=\"lvl-4\">Kubernetes æŸ¥æ‰¾å¯ç”¨çš„ PVï¼Œæ¡ä»¶ç¬¦åˆï¼ˆå®¹é‡ã€è®¿é—®æ¨¡å¼ã€StorageClassï¼‰å°±è‡ªåŠ¨ç»‘å®šã€‚</li>\n<li class=\"lvl-4\">Pod æŒ‚è½½ PVCï¼Œå®ç°æŒä¹…åŒ–å­˜å‚¨ã€‚</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"PV-ç¤ºä¾‹\">PV ç¤ºä¾‹</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¸€ä¸ªä½¿ç”¨ NFS å­˜å‚¨å·çš„ PV ç¤ºä¾‹</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># pv-nfs.yaml</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">PersistentVolume</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">pv-nfs-1g</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">volumeMode:</span> <span class=\"string\">Filesystem</span>                 <span class=\"comment\"># å­˜å‚¨å·æ¨¡å¼ï¼Œé»˜è®¤ä¸º Filesystem</span></span><br><span class=\"line\">  <span class=\"attr\">capacity:</span>                              <span class=\"comment\"># å­˜å‚¨èƒ½åŠ›</span></span><br><span class=\"line\">    <span class=\"attr\">storage:</span> <span class=\"string\">1Gi</span>                         <span class=\"comment\"># å®¹é‡å¤§å°ï¼ŒGi æˆ– Mi</span></span><br><span class=\"line\">  <span class=\"attr\">accessModes:</span>                           <span class=\"comment\"># è®¿é—®æ¨¡å¼</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">ReadWriteOnce</span>                      <span class=\"comment\"># è®¿é—®æ¨¡å¼</span></span><br><span class=\"line\">  <span class=\"attr\">persistentVolumeReclaimPolicy:</span> <span class=\"string\">Retain</span>  <span class=\"comment\"># å›æ”¶ç­–ç•¥</span></span><br><span class=\"line\">  <span class=\"attr\">nfs:</span>                                   <span class=\"comment\"># æŒä¹…å·ç±»å‹ï¼ˆå¦‚ hostPathã€nfsã€ceph ç­‰ï¼‰</span></span><br><span class=\"line\">    <span class=\"attr\">path:</span> <span class=\"string\">/nfs-server/data/pv-nfs-1g</span>     <span class=\"comment\"># å­˜å‚¨è·¯å¾„è¦ç¡®ä¿å·²ç»å­˜åœ¨</span></span><br><span class=\"line\">    <span class=\"attr\">server:</span> <span class=\"number\">10.211</span><span class=\"number\">.55</span><span class=\"number\">.88</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">PersistentVolume</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">pv-nfs-2g</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">capacity:</span>                              <span class=\"comment\"># å­˜å‚¨èƒ½åŠ›</span></span><br><span class=\"line\">    <span class=\"attr\">storage:</span> <span class=\"string\">2Gi</span>                         <span class=\"comment\"># å®¹é‡å¤§å°ï¼ŒGi æˆ– Mi</span></span><br><span class=\"line\">  <span class=\"attr\">accessModes:</span>                           <span class=\"comment\"># è®¿é—®æ¨¡å¼</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">ReadWriteMany</span>                      <span class=\"comment\"># è®¿é—®æ¨¡å¼</span></span><br><span class=\"line\">  <span class=\"attr\">persistentVolumeReclaimPolicy:</span> <span class=\"string\">Retain</span>  <span class=\"comment\"># å›æ”¶ç­–ç•¥</span></span><br><span class=\"line\">  <span class=\"attr\">nfs:</span>                                   <span class=\"comment\"># å­˜å‚¨ç±»å‹ï¼ˆå¦‚ hostPathã€nfsã€ceph ç­‰ï¼‰</span></span><br><span class=\"line\">    <span class=\"attr\">path:</span> <span class=\"string\">/nfs-server/data/pv-nfs-2g</span>     <span class=\"comment\"># å­˜å‚¨è·¯å¾„è¦ç¡®ä¿å·²ç»å­˜åœ¨</span></span><br><span class=\"line\">    <span class=\"attr\">server:</span> <span class=\"number\">10.211</span><span class=\"number\">.55</span><span class=\"number\">.88</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"å­˜å‚¨å·æ¨¡å¼\">å­˜å‚¨å·æ¨¡å¼</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><a href=\"https://kubernetes.io/zh-cn/docs/concepts/storage/persistent-volumes/#volume-mode\">å®˜ç½‘æ–‡æ¡£:å­˜å‚¨å·æ¨¡å¼</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>Kubernetes æ”¯æŒä¸¤ç§å·æ¨¡å¼ï¼ˆvolumeModesï¼‰ï¼šFilesystemï¼ˆæ–‡ä»¶ç³»ç»Ÿï¼‰ å’Œ Blockï¼ˆå—ï¼‰ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å¦‚æœè¯¥å‚æ•°è¢«çœç•¥ï¼Œé»˜è®¤çš„å·æ¨¡å¼æ˜¯ Filesystemã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>volumeMode å±æ€§è®¾ç½®ä¸º Filesystem çš„å·ä¼šè¢« Pod æŒ‚è½½ï¼ˆMountï¼‰ åˆ°æŸä¸ªç›®å½•ã€‚</p>\n</li>\n</ul>\n<h3 id=\"æŒä¹…å·ç±»å‹\">æŒä¹…å·ç±»å‹</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><a href=\"https://kubernetes.io/zh-cn/docs/concepts/storage/persistent-volumes/#types-of-persistent-volumes\">å®˜ç½‘æ–‡æ¡£:æŒä¹…å·ç±»å‹</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>âœ… å½“å‰æ”¯æŒçš„æ’ä»¶</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>æ’ä»¶ç±»å‹</th>\n<th>æè¿°</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>csi</strong></td>\n<td><strong>å®¹å™¨å­˜å‚¨æ¥å£ï¼ˆCSIï¼‰</strong>ï¼Œæ¨èçš„ç°ä»£å­˜å‚¨æ¥å£</td>\n</tr>\n<tr>\n<td><strong>fc</strong></td>\n<td>Fibre Channel å­˜å‚¨</td>\n</tr>\n<tr>\n<td><strong>hostPath</strong></td>\n<td>HostPath å·ï¼ˆä»…ä¾›å•èŠ‚ç‚¹æµ‹è¯•ä½¿ç”¨ï¼›å¤šèŠ‚ç‚¹ä¸æ¨èï¼Œæ¨èä½¿ç”¨ local å·æ›¿ä»£ï¼‰</td>\n</tr>\n<tr>\n<td><strong>iscsi</strong></td>\n<td>iSCSIï¼ˆåŸºäº IP çš„ SCSI å­˜å‚¨ï¼‰</td>\n</tr>\n<tr>\n<td><strong>local</strong></td>\n<td>èŠ‚ç‚¹æœ¬åœ°å­˜å‚¨è®¾å¤‡</td>\n</tr>\n<tr>\n<td><strong>nfs</strong></td>\n<td>ç½‘ç»œæ–‡ä»¶ç³»ç»Ÿï¼ˆNFSï¼‰å­˜å‚¨</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>âš ï¸ å·²å¼ƒç”¨ä½†ä»å¯ç”¨ï¼ˆéœ€ CSI è¿ç§»ï¼‰</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>æ’ä»¶ç±»å‹</th>\n<th>æè¿°</th>\n<th>CSI è¿ç§»çŠ¶æ€</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>awsElasticBlockStore</strong></td>\n<td>AWS EBS å—å­˜å‚¨</td>\n<td>ä» v1.23 å¼€å§‹é»˜è®¤è¿ç§»</td>\n</tr>\n<tr>\n<td><strong>azureDisk</strong></td>\n<td>Azure ç£ç›˜å­˜å‚¨</td>\n<td>ä» v1.23 å¼€å§‹é»˜è®¤è¿ç§»</td>\n</tr>\n<tr>\n<td><strong>azureFile</strong></td>\n<td>Azure æ–‡ä»¶å­˜å‚¨</td>\n<td>ä» v1.24 å¼€å§‹é»˜è®¤è¿ç§»</td>\n</tr>\n<tr>\n<td><strong>cinder</strong></td>\n<td>OpenStack å—å­˜å‚¨</td>\n<td>ä» v1.21 å¼€å§‹é»˜è®¤è¿ç§»</td>\n</tr>\n<tr>\n<td><strong>flexVolume</strong></td>\n<td>FlexVolumeï¼ˆæ— è¿ç§»è®¡åˆ’ï¼Œä½†æœªè®¡åˆ’ç§»é™¤ï¼‰</td>\n<td>ä» v1.23 å¼€å§‹å¼ƒç”¨</td>\n</tr>\n<tr>\n<td><strong>gcePersistentDisk</strong></td>\n<td>GCP æŒä¹…ç£ç›˜</td>\n<td>ä» v1.23 å¼€å§‹é»˜è®¤è¿ç§»</td>\n</tr>\n<tr>\n<td><strong>portworxVolume</strong></td>\n<td>Portworx å­˜å‚¨å·</td>\n<td>ä» v1.31 å¼€å§‹é»˜è®¤è¿ç§»</td>\n</tr>\n<tr>\n<td><strong>vsphereVolume</strong></td>\n<td>vSphere VMDK å·</td>\n<td>ä» v1.25 å¼€å§‹é»˜è®¤è¿ç§»</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>âŒ å·²åºŸå¼ƒ/å³å°†ç§»é™¤çš„ In-Tree æ’ä»¶</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>æ’ä»¶ç±»å‹</th>\n<th>æè¿°</th>\n<th>å¼ƒç”¨/ç§»é™¤ç‰ˆæœ¬</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>cephfs</strong></td>\n<td>Ceph æ–‡ä»¶ç³»ç»Ÿå·</td>\n<td>v1.31 ä¹‹åä¸å¯ç”¨</td>\n</tr>\n<tr>\n<td><strong>flocker</strong></td>\n<td>Flocker å­˜å‚¨</td>\n<td>v1.25 ä¹‹åä¸å¯ç”¨</td>\n</tr>\n<tr>\n<td><strong>glusterfs</strong></td>\n<td>GlusterFS å­˜å‚¨</td>\n<td>v1.26 ä¹‹åä¸å¯ç”¨</td>\n</tr>\n<tr>\n<td><strong>photonPersistentDisk</strong></td>\n<td>Photon æŒä¹…ç£ç›˜</td>\n<td>v1.15 ä¹‹åä¸å¯ç”¨</td>\n</tr>\n<tr>\n<td><strong>quobyte</strong></td>\n<td>Quobyte å·</td>\n<td>v1.25 ä¹‹åä¸å¯ç”¨</td>\n</tr>\n<tr>\n<td><strong>rbd</strong></td>\n<td>Rados å—è®¾å¤‡ï¼ˆCeph RBDï¼‰</td>\n<td>v1.31 ä¹‹åä¸å¯ç”¨</td>\n</tr>\n<tr>\n<td><strong>scaleIO</strong></td>\n<td>ScaleIO å·</td>\n<td>v1.21 ä¹‹åä¸å¯ç”¨</td>\n</tr>\n<tr>\n<td><strong>storageos</strong></td>\n<td>StorageOS å·</td>\n<td>v1.25 ä¹‹åä¸å¯ç”¨</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"accessModes-è®¿é—®æ¨¡å¼\">accessModes è®¿é—®æ¨¡å¼</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><a href=\"https://kubernetes.io/zh-cn/docs/concepts/storage/persistent-volumes/#access-modes\">å®˜ç½‘æ–‡æ¡£:è®¿é—®æ¨¡å¼</a></p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>è®¿é—®æ¨¡å¼</th>\n<th>è¯´æ˜</th>\n<th>æ˜¯å¦è·¨èŠ‚ç‚¹æŒ‚è½½</th>\n<th>æ˜¯å¦æ”¯æŒå¤š Pod æŒ‚è½½</th>\n<th>æ˜¯å¦æ”¯æŒè¯»å†™</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>ReadWriteOnce (RWO)</strong></td>\n<td>å·å¯ä»¥è¢«ä¸€ä¸ªèŠ‚ç‚¹ä»¥è¯»å†™æ–¹å¼æŒ‚è½½ï¼ŒåŒä¸€èŠ‚ç‚¹å†…å¤šä¸ª Pod å¯å…±äº«ä½¿ç”¨ã€‚</td>\n<td>âŒ å¦</td>\n<td>âœ… æ˜¯ï¼ˆåŒä¸€èŠ‚ç‚¹ï¼‰</td>\n<td>âœ… æ˜¯</td>\n</tr>\n<tr>\n<td><strong>ReadOnlyMany (ROX)</strong></td>\n<td>å·å¯ä»¥è¢«å¤šä¸ªèŠ‚ç‚¹ä»¥åªè¯»æ–¹å¼æŒ‚è½½ã€‚</td>\n<td>âœ… æ˜¯</td>\n<td>âœ… æ˜¯</td>\n<td>âŒ å¦ï¼ˆåªè¯»ï¼‰</td>\n</tr>\n<tr>\n<td><strong>ReadWriteMany (RWX)</strong></td>\n<td>å·å¯ä»¥è¢«å¤šä¸ªèŠ‚ç‚¹ä»¥è¯»å†™æ–¹å¼æŒ‚è½½ã€‚</td>\n<td>âœ… æ˜¯</td>\n<td>âœ… æ˜¯</td>\n<td>âœ… æ˜¯</td>\n</tr>\n<tr>\n<td><strong>ReadWriteOncePod (RWOP)</strong></td>\n<td>å·åªèƒ½è¢«å•ä¸ª Pod ä»¥è¯»å†™æ–¹å¼æŒ‚è½½ï¼Œç¡®ä¿é›†ç¾¤ä¸­åªæœ‰ä¸€ä¸ª Pod ä½¿ç”¨è¯¥å·ï¼ˆv1.29+ç¨³å®šï¼‰ã€‚</td>\n<td>âŒ å¦</td>\n<td>âŒ å¦ï¼ˆåªèƒ½ä¸€ä¸ª Podï¼‰</td>\n<td>âœ… æ˜¯</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>NFS æ”¯æŒå‰ä¸‰ç§è®¿é—®æ¨¡å¼ï¼ŒhostPath åªæ”¯æŒ ReadWriteOnceã€‚</p>\n</li>\n</ul>\n<h3 id=\"persistentVolumeReclaimPolicy-å›æ”¶ç­–ç•¥\">persistentVolumeReclaimPolicy å›æ”¶ç­–ç•¥</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><a href=\"https://kubernetes.io/zh-cn/docs/concepts/storage/persistent-volumes/#reclaim-policy\">å®˜æ–¹æ–‡æ¡£:å›æ”¶ç­–ç•¥</a></p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>å›æ”¶ç­–ç•¥</th>\n<th>å«ä¹‰</th>\n<th>å›æ”¶è¡Œä¸º</th>\n<th>å…¸å‹ä½¿ç”¨åœºæ™¯</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>Retain</strong></td>\n<td><strong>ä¿ç•™</strong>ï¼šåˆ é™¤ PVC åï¼ŒPV å’Œåç«¯å­˜å‚¨ä»ç„¶ä¿ç•™</td>\n<td>æ‰‹åŠ¨å›æ”¶ï¼ŒPVC åˆ é™¤å PV çŠ¶æ€ä¸º <code>Released</code>ï¼Œéœ€è¦æ‰‹åŠ¨æ¸…ç†æˆ–é‡æ–°ç»‘å®š</td>\n<td>é‡è¦æ•°æ®ï¼Œé¿å…è¯¯åˆ ï¼›å¦‚æ•°æ®åº“æ•°æ®ç›˜</td>\n</tr>\n<tr>\n<td><strong>Delete</strong></td>\n<td><strong>åˆ é™¤</strong>ï¼šåˆ é™¤ PVC åï¼ŒPV å’Œåç«¯å­˜å‚¨éƒ½ä¼šè¢«åˆ é™¤</td>\n<td>è‡ªåŠ¨å›æ”¶ï¼ŒPVC åˆ é™¤æ—¶è‡ªåŠ¨åˆ é™¤ PV å’Œåç«¯å­˜å‚¨èµ„æºï¼ˆå¦‚äº‘ç›˜ï¼‰</td>\n<td>ä¸´æ—¶æ•°æ®ã€ä¸é‡è¦çš„å­˜å‚¨</td>\n</tr>\n<tr>\n<td><strong>Recycle</strong></td>\n<td><strong>å›æ”¶</strong>ï¼šç®€å•æ¸…ç©ºæ•°æ®</td>\n<td>è‡ªåŠ¨æ‰§è¡Œ <code>rm -rf /thevolume/*</code>ï¼Œç„¶å PV å˜å› <code>Available</code> çŠ¶æ€</td>\n<td>æ—§ç‰ˆæœ¬é›†ç¾¤çš„å°æ–‡ä»¶ä¸´æ—¶å­˜å‚¨</td>\n</tr>\n</tbody>\n</table>\n<div class=\"warning\">\n<ul class=\"lvl-1\">\n<li class=\"lvl-2\">\n<p><strong>æ³¨æ„</strong>: åˆ›å»º <strong>Recycle</strong> çš„ PV æ—¶ï¼Œä¼šæç¤ºå¦‚ä¸‹å†…å®¹</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Warning: spec.persistentVolumeReclaimPolicy: The Recycle reclaim policy is deprecated. Instead, the recommended approach is to use dynamic provisioning.</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-1\">\n<li class=\"lvl-2\">\n<p>æ„æ€å°±æ˜¯ <strong>Recycle</strong> ç­–ç•¥å·²è¢«å¼ƒç”¨ï¼Œå»ºè®®ä½¿ç”¨<code>åŠ¨æ€ä¾›åº”æ¨¡å¼</code>ã€‚ä½†<a href=\"https://kubernetes.io/zh-cn/docs/concepts/storage/persistent-volumes/#reclaim-policy\">å®˜æ–¹æ–‡æ¡£</a>ä¸­å´æç¤º <code>å¯¹äº Kubernetes 1.33 æ¥è¯´ï¼Œåªæœ‰ nfs å’Œ hostPath å·ç±»å‹æ”¯æŒå›æ”¶ï¼ˆRecycleï¼‰ã€‚</code></p>\n</li>\n<li class=\"lvl-2\">\n<p>æœ¬äººåœ¨ Kubernetes 1.33.2 ä¸­æµ‹è¯•ï¼ŒNFS æ”¯æŒ Recycleï¼Œåˆ é™¤ PVC å PV çŠ¶æ€ä¼šå˜ä¸º <strong>Available</strong></p>\n</li>\n</ul>\n</div>\n<h3 id=\"ç®¡ç†-PV\">ç®¡ç† PV</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åˆ›å»º</span></span><br><span class=\"line\">kubectl create -f pv-nfs.yaml</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹</span></span><br><span class=\"line\">$ k get pv</span><br><span class=\"line\">NAME        CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS      CLAIM   STORAGECLASS   VOLUMEATTRIBUTESCLASS   REASON   AGE</span><br><span class=\"line\">pv-nfs-1g   1Gi        RWO            Retain           Available                          &lt;<span class=\"built_in\">unset</span>&gt;                          80s</span><br><span class=\"line\">pv-nfs-2g   2Gi        RWX            Retain           Available                          &lt;<span class=\"built_in\">unset</span>&gt;                          80s</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åˆ é™¤</span></span><br><span class=\"line\">kubectl delete pv pv-nfs-1g</span><br><span class=\"line\">k delete -f pv-nfs.yaml</span><br></pre></td></tr></table></figure>\n<h2 id=\"PVC-ç¤ºä¾‹\">PVC ç¤ºä¾‹</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Pod é€šè¿‡ PVC å‘ PV ç”³è¯·å­˜å‚¨ç©ºé—´ï¼Œå¦‚æœ PVC ä¸€ç›´æ— æ³•åŒ¹é…åˆ° PVï¼Œåˆ™ PVC å¤„äº Pending çŠ¶æ€ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>Pod å¿…é¡»ä¸ PVC å¤„äºåŒä¸€å‘½åç©ºé—´ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>PVC ä¸ PV æ˜¯ 1:1 çš„å…³ç³»ã€‚ä¸€æ—¦ PV ç»‘å®šåˆ° PVCï¼Œåˆ™ PVC çŠ¶æ€å˜ä¸º Boundã€‚è¯¥ PV å°†ä¸å†è¢«å…¶ä»– PVC ç»‘å®šã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>PVC ä¸ PV åŒ¹é…çš„æ¡ä»¶</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>åŒ¹é…æ¡ä»¶</th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>å®¹é‡</strong></td>\n<td><strong>PVC è¯·æ±‚çš„å®¹é‡ â‰¤ PV æä¾›çš„å®¹é‡</strong>ã€‚PV å¿…é¡»è‡³å°‘æ»¡è¶³ PVC çš„å®¹é‡è¯·æ±‚ã€‚</td>\n</tr>\n<tr>\n<td><strong>è®¿é—®æ¨¡å¼</strong></td>\n<td><strong>PV æ”¯æŒ PVC è¯·æ±‚çš„è®¿é—®æ¨¡å¼</strong>ã€‚PVC è¦æ±‚çš„æ‰€æœ‰è®¿é—®æ¨¡å¼ï¼ŒPV éƒ½å¿…é¡»å…·å¤‡ã€‚ä¾‹å¦‚ï¼šPVC è¦æ±‚ <code>ReadWriteOnce</code>ï¼ŒPV è‡³å°‘è¦æ”¯æŒ <code>ReadWriteOnce</code>ã€‚</td>\n</tr>\n<tr>\n<td><strong>StorageClass</strong></td>\n<td><strong>PVC å’Œ PV çš„ <code>storageClassName</code> å¿…é¡»ä¸€è‡´</strong>ã€‚å¦‚æœ PVC æŒ‡å®šäº† <code>storageClassName</code>ï¼Œåªèƒ½ç»‘å®šåŒåçš„ PVã€‚</td>\n</tr>\n<tr>\n<td><strong>Selectorï¼ˆå¯é€‰ï¼‰</strong></td>\n<td>å¦‚æœ PVC æœ‰è®¾ç½® <code>selector</code>ï¼ˆåŸºäºæ ‡ç­¾ï¼‰ï¼ŒPV çš„æ ‡ç­¾ä¹Ÿå¿…é¡»åŒ¹é…ã€‚</td>\n</tr>\n</tbody>\n</table>\n<div class=\"tips\">\n<p><em><strong>å°è´´å£«</strong></em></p>\n<ul class=\"lvl-1\">\n<li class=\"lvl-2\">PV ä¸­å£°æ˜çš„ <code>accessModes</code> ä»…ä½œä¸ºä¸ PVC çš„è®¿é—®æ¨¡å¼è¿›è¡ŒåŒ¹é…ï¼Œå®é™…æŒ‚è½½åˆ° Pod åï¼Œä¸ä¼šé™åˆ¶ Pod çš„è¯»å†™è®¿é—®</li>\n</ul>\n</div>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¸€ä¸ªç®€å•çš„ yaml</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># pvc.yaml</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">PersistentVolumeClaim</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">mypvc</span></span><br><span class=\"line\">  <span class=\"attr\">namespace:</span> <span class=\"string\">default</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">accessModes:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">ReadWriteMany</span>   <span class=\"comment\"># ç”³è¯·åŒ¹é…çš„è®¿é—®æ¨¡å¼</span></span><br><span class=\"line\">  <span class=\"attr\">resources:</span></span><br><span class=\"line\">    <span class=\"attr\">requests:</span></span><br><span class=\"line\">      <span class=\"attr\">storage:</span> <span class=\"string\">500Mi</span>  <span class=\"comment\"># ç”³è¯·çš„å®¹é‡ï¼Œå®é™…å®¹é‡ä»¥åŒ¹é…çš„ PV ä¸ºå‡†</span></span><br><span class=\"line\">  <span class=\"comment\"># selector:         # åŒ¹é…çš„ PV æ ‡ç­¾</span></span><br><span class=\"line\">  <span class=\"comment\">#   matchLabels:</span></span><br><span class=\"line\">  <span class=\"comment\">#     pv: nfs-pv1   # pv çš„æ ‡ç­¾ï¼Œåˆ›å»º pv æ—¶è¦æŒ‡å®š</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"ç®¡ç†-PVC\">ç®¡ç† PVC</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åˆ›å»º PVC</span></span><br><span class=\"line\">kubectl apply -f pvc.yaml</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹PVCï¼Œæ­¤æ—¶çœ‹åˆ° pv-nfs-1g ç»‘å®šäº† PVC</span></span><br><span class=\"line\">$ k get pv,pvc</span><br><span class=\"line\">NAME                         CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS      CLAIM           STORAGECLASS   VOLUMEATTRIBUTESCLASS   REASON   AGE</span><br><span class=\"line\">persistentvolume/pv-nfs-1g   1Gi        RWO            Retain           Available                                  &lt;<span class=\"built_in\">unset</span>&gt;                          16s</span><br><span class=\"line\">persistentvolume/pv-nfs-2g   2Gi        RWX            Retain           Bound       default/mypvc                  &lt;<span class=\"built_in\">unset</span>&gt;                          16s</span><br><span class=\"line\"></span><br><span class=\"line\">NAME                          STATUS   VOLUME      CAPACITY   ACCESS MODES   STORAGECLASS   VOLUMEATTRIBUTESCLASS   AGE</span><br><span class=\"line\">persistentvolumeclaim/mypvc   Bound    pv-nfs-2g   2Gi        RWX                           &lt;<span class=\"built_in\">unset</span>&gt;                 9s</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åˆ é™¤ PVC</span></span><br><span class=\"line\">kubectl delete pvc mypvc</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ­¤æ—¶å†æ¬¡æŸ¥çœ‹ PVï¼Œpv-nfs-1g çŠ¶æ€å˜æ›´ä¸º Releasedï¼Œè¡¨ç¤ºå·²ç»é‡Šæ”¾ï¼Œä½†æ˜¯ä¸èƒ½å†è¢«å…¶å®ƒ PVC ç»‘å®šäº†ï¼Œåªèƒ½åˆ é™¤é‡å»ºäº†</span></span><br><span class=\"line\">$ k get pv</span><br><span class=\"line\">NAME        CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS      CLAIM           STORAGECLASS   VOLUMEATTRIBUTESCLASS   REASON   AGE</span><br><span class=\"line\">pv-nfs-1g   1Gi        RWO            Retain           Available                                              &lt;<span class=\"built_in\">unset</span>&gt;                          18m</span><br><span class=\"line\">pv-nfs-2g   2Gi        RWX            Retain           Released     default/mypvc                             &lt;<span class=\"built_in\">unset</span>&gt;                          18m</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åˆ é™¤ PV</span></span><br><span class=\"line\">k delete pv pv-nfs-1g</span><br></pre></td></tr></table></figure>\n<h2 id=\"Pod-ç»‘å®š-PVC\">Pod ç»‘å®š PVC</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¿™é‡Œä»¥ nginx deployment ä¸ºä¾‹</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># nginx-pvc-deployment.yaml</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">apps/v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Deployment</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">nginx-pvc-deployment</span></span><br><span class=\"line\">  <span class=\"attr\">namespace:</span> <span class=\"string\">default</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">replicas:</span> <span class=\"number\">3</span>                              <span class=\"comment\"># 3ä¸ª podä¼šå…±äº«ä¸€ä¸ª PVC</span></span><br><span class=\"line\">  <span class=\"attr\">selector:</span></span><br><span class=\"line\">    <span class=\"attr\">matchLabels:</span></span><br><span class=\"line\">      <span class=\"attr\">app:</span> <span class=\"string\">nginx-pvc</span></span><br><span class=\"line\">  <span class=\"attr\">template:</span></span><br><span class=\"line\">    <span class=\"attr\">metadata:</span></span><br><span class=\"line\">      <span class=\"attr\">labels:</span></span><br><span class=\"line\">        <span class=\"attr\">app:</span> <span class=\"string\">nginx-pvc</span></span><br><span class=\"line\">    <span class=\"attr\">spec:</span></span><br><span class=\"line\">      <span class=\"attr\">containers:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">nginx</span></span><br><span class=\"line\">        <span class=\"attr\">image:</span> <span class=\"string\">nginx</span></span><br><span class=\"line\">        <span class=\"attr\">ports:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">containerPort:</span> <span class=\"number\">80</span></span><br><span class=\"line\">        <span class=\"attr\">volumeMounts:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">nginx-storage</span></span><br><span class=\"line\">          <span class=\"attr\">mountPath:</span> <span class=\"string\">/usr/share/nginx/html</span>  <span class=\"comment\"># æŒ‚è½½åˆ° nginx çš„é»˜è®¤ç½‘é¡µç›®å½•</span></span><br><span class=\"line\">      <span class=\"attr\">volumes:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">nginx-storage</span></span><br><span class=\"line\">        <span class=\"attr\">persistentVolumeClaim:</span>              <span class=\"comment\"># æŒ‡å®šå­˜å‚¨å·ç±»å‹æ˜¯ PVC</span></span><br><span class=\"line\">          <span class=\"attr\">claimName:</span> <span class=\"string\">mypvc</span>                  <span class=\"comment\"># å¯¹åº”ä½ åˆ›å»ºçš„ PVC åç§°</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¸€ä¸ª PVC å¯¹åº”ä¸€ä¸ª PVï¼Œä½†æ˜¯ä¸€ä¸ª PVC å¯ä»¥å¯¹åº”å¤šä¸ª Deployment ç­‰æ§åˆ¶å™¨ã€‚ä¸‹é¢æˆ‘ä»¬å°±å†åˆ›å»ºä¸€ä¸ª Deploymentï¼Œå°† ç›¸åŒçš„ PVC æŒ‚è½½åˆ°å®¹å™¨ä¸­ï¼Œå¹¶ä¸”æ¯éš”5ç§’ä¿®æ”¹ä¸€æ¬¡ PVC æŒ‚è½½çš„ç½‘é¡µï¼Œå¹¶é€šè¿‡ nginx å®¹å™¨æŸ¥çœ‹ç»“æœ</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># busybox-deployment.yaml</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">apps/v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Deployment</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">busybox-deployment</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">replicas:</span> <span class=\"number\">1</span></span><br><span class=\"line\">  <span class=\"attr\">selector:</span></span><br><span class=\"line\">    <span class=\"attr\">matchLabels:</span></span><br><span class=\"line\">      <span class=\"attr\">app:</span> <span class=\"string\">busybox</span></span><br><span class=\"line\">  <span class=\"attr\">template:</span></span><br><span class=\"line\">    <span class=\"attr\">metadata:</span></span><br><span class=\"line\">      <span class=\"attr\">labels:</span></span><br><span class=\"line\">        <span class=\"attr\">app:</span> <span class=\"string\">busybox</span></span><br><span class=\"line\">    <span class=\"attr\">spec:</span></span><br><span class=\"line\">      <span class=\"attr\">containers:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">busybox</span></span><br><span class=\"line\">        <span class=\"attr\">image:</span> <span class=\"string\">busybox</span></span><br><span class=\"line\">        <span class=\"attr\">command:</span> [<span class=\"string\">&quot;sh&quot;</span>, <span class=\"string\">&quot;-c&quot;</span>, <span class=\"string\">&quot;while true; do echo $(date) &gt; /data/index.html; sleep 5; done&quot;</span>]</span><br><span class=\"line\">        <span class=\"attr\">volumeMounts:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">shared-volume</span></span><br><span class=\"line\">          <span class=\"attr\">mountPath:</span> <span class=\"string\">/data</span></span><br><span class=\"line\">      <span class=\"attr\">volumes:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">shared-volume</span></span><br><span class=\"line\">        <span class=\"attr\">persistentVolumeClaim:</span></span><br><span class=\"line\">          <span class=\"attr\">claimName:</span> <span class=\"string\">mypvc</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ›å»ºåæŸ¥çœ‹ pod ip</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ k get pod -o wide</span><br><span class=\"line\">NAME                                    READY   STATUS    RESTARTS   AGE     IP               NODE          NOMINATED NODE   READINESS GATES</span><br><span class=\"line\">busybox-deployment-d7589665d-dx2rs      1/1     Running   0          2m59s   10.244.126.6     k8s-worker2   &lt;none&gt;           &lt;none&gt;</span><br><span class=\"line\">nginx-pvc-deployment-775b8c4f8b-89cw7   1/1     Running   0          44s     10.244.126.8     k8s-worker2   &lt;none&gt;           &lt;none&gt;</span><br><span class=\"line\">nginx-pvc-deployment-775b8c4f8b-fszlf   1/1     Running   0          44s     10.244.194.123   k8s-worker1   &lt;none&gt;           &lt;none&gt;</span><br><span class=\"line\">nginx-pvc-deployment-775b8c4f8b-w9qkt   1/1     Running   0          44s     10.244.126.7     k8s-worker2   &lt;none&gt;           &lt;none&gt;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è®¿é—®ä»»æ„ä¸€ä¸ª nginx pod</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æ­¤æ—¶ä¼šçœ‹åˆ°é¡µé¢å†…å®¹åœ¨å˜åŒ–</span></span><br><span class=\"line\">watch -n 5 curl 10.244.194.123</span><br></pre></td></tr></table></figure>\n<h2 id=\"åè®°\">åè®°</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¸º pod ç»‘å®š pvcæ—¶ï¼Œæ¯æ¬¡éƒ½è¦å…ˆåˆ›å»º pv å’Œ pvcï¼Œéå¸¸éº»çƒ¦ã€‚æœ‰ä»€ä¹ˆå¥½çš„è§£å†³æ–¹æ¡ˆå—ï¼Ÿ</p>\n<blockquote>\n<p>ä½¿ç”¨ StorageClass å®ç°è‡ªåŠ¨åˆ›å»º PVï¼Œæˆ‘ä»¬ä¸‹æ–‡å°†ä»‹ç»å¦‚ä½•å®ç°ã€‚</p>\n</blockquote>\n</li>\n<li class=\"lvl-2\">\n<p>å¦‚æœ PVC è¢« Pod ä½¿ç”¨ï¼Œåˆ™æ­¤æ—¶å¯ä»¥åˆ é™¤ PVC å—ï¼Ÿ</p>\n<blockquote>\n<p>ä¸å¯ä»¥ï¼ŒPVC è¢« Pod ä½¿ç”¨ï¼Œæ­¤æ—¶åªèƒ½ç­‰å¾… Pod åˆ é™¤åæ‰èƒ½åˆ é™¤ PVCã€‚<br>\nè‹¥æ­¤æ—¶æ‰§è¡Œäº†åˆ é™¤ PVC å‘½ä»¤ï¼Œç»ˆç«¯ä¼šä¸€ç›´ç­‰å¾…ï¼Œctrl + c é€€å‡ºåå†æ¬¡æŸ¥çœ‹ PVC çŠ¶æ€ï¼Œä¼šçœ‹åˆ° PVC çŠ¶æ€ä¸º Terminatingã€‚ä½†æ­¤æ—¶ä¸ä¼šå½±å“å­˜Podå¯¹å‚¨å·çš„ä½¿ç”¨ã€‚<br>\næ­¤æ—¶ä¸€æ—¦Pod åˆ é™¤ï¼ŒPVC å°±ä¼šè¢«åˆ é™¤ã€‚</p>\n</blockquote>\n</li>\n<li class=\"lvl-2\">\n<p>å¦‚æœPV è¢« PVC ä½¿ç”¨ï¼Œåˆ™æ­¤æ—¶å¯ä»¥åˆ é™¤ PV å—ï¼Ÿ</p>\n<blockquote>\n<p>ä¸å¯ä»¥ï¼ŒPV è¢« PVC ä½¿ç”¨ï¼Œæ­¤æ—¶åªèƒ½ç­‰å¾… PVC åˆ é™¤åæ‰èƒ½åˆ é™¤ PVã€‚<br>\nè‹¥æ­¤æ—¶æ‰§è¡Œäº†åˆ é™¤ PV å‘½ä»¤ï¼Œç»ˆç«¯ä¼šä¸€ç›´ç­‰å¾…ï¼Œctrl + c é€€å‡ºåå†æ¬¡æŸ¥çœ‹ PV çŠ¶æ€ï¼Œä¼šçœ‹åˆ° PV çŠ¶æ€ä¸º Terminatingã€‚ä½†æ­¤æ—¶ä¸ä¼šå½±å“Podå¯¹å­˜å‚¨å·çš„ä½¿ç”¨ã€‚<br>\næ­¤æ—¶ä¸€æ—¦ PVC åˆ é™¤ï¼ŒPV å°±ä¼šè¢«åˆ é™¤ã€‚</p>\n</blockquote>\n</li>\n</ul>\n","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» K8S çš„ æŒä¹…å· PV å’Œ PVC ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚ K8Så®˜ç½‘ k8s Github k8s PV/PVC å®˜æ–¹æ–‡æ¡£ æœ¬æ–‡åº•å±‚å­˜å‚¨å·æ˜¯ NFS PV å’Œ PVC ä»‹ç» PV(PersistentVolume) æ˜¯ Kubernetes ä¸­çš„ä¸€ç§å­˜å‚¨èµ„æºï¼Œç”¨äºå°†åº•å±‚çš„ç‰©ç†å­˜å‚¨ï¼ˆå¦‚ NFSã€iSCSIã€Cephã€äº‘å­˜å‚¨ç­‰ï¼‰æŠ½è±¡æˆ Kubernetes èµ„æºï¼Œä¾› Pod ä½¿ç”¨ã€‚å®ƒæ˜¯å¯¹å­˜å‚¨çš„ä¸€ç§â€œå£°æ˜å¼â€ç®¡ç†ï¼Œç±»ä¼¼äº Pod å£°æ˜è®¡ç®—èµ„æºã€‚PV æ˜¯é›†ç¾¤çº§åˆ«çš„å­˜å‚¨èµ„æºï¼Œä¸æ”¯æŒ Namespaceã€‚ PVC(PersistentVolumeClaim)ï¼ŒæŒä¹…å·å£°æ˜ï¼Œ æ˜¯ Kubernetes ä¸­ç”¨äºç”³è¯·å­˜å‚¨èµ„æºçš„å¯¹è±¡ã€‚PVC æ˜¯ Namespace çº§åˆ«çš„èµ„æºã€‚ ç®€è€Œè¨€ä¹‹ï¼š PV æ˜¯é›†ç¾¤ä¸­çš„ä¸€å—å­˜å‚¨ï¼Œç”±ç®¡ç†å‘˜æå‰é…ç½®æˆ–åŠ¨æ€åˆ›å»ºã€‚ PVCï¼ˆPersistentVolumeClaimï¼‰ æ˜¯ç”¨æˆ·å¯¹å­˜å‚¨çš„ç”³è¯·ã€‚ Pod é€šè¿‡ PVC ç»‘å®šåˆ° PVï¼Œä½¿ç”¨æŒä¹…åŒ–å­˜å‚¨ã€‚ å¼€å‘è€…ç”¨ PVC æ¥ç”³è¯·å­˜å‚¨ç©ºé—´ï¼Œä¸å…³å¿ƒå­˜å‚¨çš„å…·ä½“å®ç°æ–¹å¼ã€‚ PVC é€šè¿‡ Kubernetes è‡ªåŠ¨åŒ¹é…ä¸€ä¸ªåˆé€‚çš„ PersistentVolumeï¼ˆPVï¼‰è¿›è¡Œç»‘å®šã€‚ PV ä¸ PVC çš„åŸºæœ¬æµç¨‹ ç®¡ç†å‘˜åˆ›å»º PVï¼ˆæˆ–è€…é›†ç¾¤é€šè¿‡ StorageClass è‡ªåŠ¨åˆ›å»ºï¼‰ã€‚ ç”¨æˆ·æäº¤ PVCï¼Œå£°æ˜è‡ªå·±éœ€è¦å¤šå°‘å®¹é‡ã€ä»€ä¹ˆè®¿é—®æ¨¡å¼ã€‚ Kubernetes æŸ¥æ‰¾å¯ç”¨çš„ PVï¼Œæ¡ä»¶ç¬¦åˆï¼ˆå®¹é‡ã€è®¿é—®æ¨¡å¼ã€StorageClassï¼‰å°±è‡ªåŠ¨ç»‘å®šã€‚ Pod æŒ‚è½½ PVCï¼Œå®ç°æŒä¹…åŒ–å­˜å‚¨ã€‚ PV ç¤ºä¾‹ ä¸€ä¸ªä½¿ç”¨ NFS å­˜å‚¨å·çš„ PV ç¤ºä¾‹ 1234567891011121314151617181920212223242526272829# pv-nfs.yamlapiVersion: v1kind: PersistentVolumemetadata: name: pv-nfs-1gspec: volumeMode: Filesystem # å­˜å‚¨å·æ¨¡å¼ï¼Œé»˜è®¤ä¸º Filesystem capacity: # å­˜å‚¨èƒ½åŠ› storage: 1Gi # å®¹é‡å¤§å°ï¼ŒGi æˆ– Mi accessModes: # è®¿é—®æ¨¡å¼ - ReadWriteOnce # è®¿é—®æ¨¡å¼ persistentVolumeReclaimPolicy: Retain # å›æ”¶ç­–ç•¥ nfs: # æŒä¹…å·ç±»å‹ï¼ˆå¦‚ hostPathã€nfsã€ceph ç­‰ï¼‰ path: /nfs-server/data/pv-nfs-1g # å­˜å‚¨è·¯å¾„è¦ç¡®ä¿å·²ç»å­˜åœ¨ server: 10.211.55.88---apiVersion: v1kind: PersistentVolumemetadata: name: pv-nfs-2gspec: capacity: # å­˜å‚¨èƒ½åŠ› storage: 2Gi # å®¹é‡å¤§å°ï¼ŒGi æˆ– Mi accessModes: # è®¿é—®æ¨¡å¼ - ReadWriteMany # è®¿é—®æ¨¡å¼ persistentVolumeReclaimPolicy: Retain # å›æ”¶ç­–ç•¥ nfs: # å­˜å‚¨ç±»å‹ï¼ˆå¦‚ hostPathã€nfsã€ceph ç­‰ï¼‰ path: /nfs-server/data/pv-nfs-2g # å­˜å‚¨è·¯å¾„è¦ç¡®ä¿å·²ç»å­˜åœ¨ server: 10.211.55.88 å­˜å‚¨å·æ¨¡å¼ å®˜ç½‘æ–‡æ¡£:å­˜å‚¨å·æ¨¡å¼ Kubernetes æ”¯æŒä¸¤ç§å·æ¨¡å¼ï¼ˆvolumeModesï¼‰ï¼šFilesystemï¼ˆæ–‡ä»¶ç³»ç»Ÿï¼‰ å’Œ Blockï¼ˆå—ï¼‰ã€‚ å¦‚æœè¯¥å‚æ•°è¢«çœç•¥ï¼Œé»˜è®¤çš„å·æ¨¡å¼æ˜¯ Filesystemã€‚ volumeMode å±æ€§è®¾ç½®ä¸º Filesystem çš„å·ä¼šè¢« Pod æŒ‚è½½ï¼ˆMountï¼‰ åˆ°æŸä¸ªç›®å½•ã€‚ æŒä¹…å·ç±»å‹ å®˜ç½‘æ–‡æ¡£:æŒä¹…å·ç±»å‹ âœ… å½“å‰æ”¯æŒçš„æ’ä»¶ æ’ä»¶ç±»å‹ æè¿° csi å®¹å™¨å­˜å‚¨æ¥å£ï¼ˆCSIï¼‰ï¼Œæ¨èçš„ç°ä»£å­˜å‚¨æ¥å£ fc Fibre Channel å­˜å‚¨ hostPath HostPath å·ï¼ˆä»…ä¾›å•èŠ‚ç‚¹æµ‹è¯•ä½¿ç”¨ï¼›å¤šèŠ‚ç‚¹ä¸æ¨èï¼Œæ¨èä½¿ç”¨ local å·æ›¿ä»£ï¼‰ iscsi iSCSIï¼ˆåŸºäº IP çš„ SCSI å­˜å‚¨ï¼‰ local èŠ‚ç‚¹æœ¬åœ°å­˜å‚¨è®¾å¤‡ nfs ç½‘ç»œæ–‡ä»¶ç³»ç»Ÿï¼ˆNFSï¼‰å­˜å‚¨ âš ï¸ å·²å¼ƒç”¨ä½†ä»å¯ç”¨ï¼ˆéœ€ CSI è¿ç§»ï¼‰ æ’ä»¶ç±»å‹ æè¿° CSI è¿ç§»çŠ¶æ€ awsElasticBlockStore AWS EBS å—å­˜å‚¨ ä» v1.23 å¼€å§‹é»˜è®¤è¿ç§» azureDisk Azure ç£ç›˜å­˜å‚¨ ä» v1.23 å¼€å§‹é»˜è®¤è¿ç§» azureFile Azure æ–‡ä»¶å­˜å‚¨ ä» v1.24 å¼€å§‹é»˜è®¤è¿ç§» cinder OpenStack å—å­˜å‚¨ ä» v1.21 å¼€å§‹é»˜è®¤è¿ç§» flexVolume FlexVolumeï¼ˆæ— è¿ç§»è®¡åˆ’ï¼Œä½†æœªè®¡åˆ’ç§»é™¤ï¼‰ ä» v1.23 å¼€å§‹å¼ƒç”¨ gcePersistentDisk GCP æŒä¹…ç£ç›˜ ä» v1.23 å¼€å§‹é»˜è®¤è¿ç§» portworxVolume Portworx å­˜å‚¨å· ä» v1.31 å¼€å§‹é»˜è®¤è¿ç§» vsphereVolume vSphere VMDK å· ä» v1.25 å¼€å§‹é»˜è®¤è¿ç§» âŒ å·²åºŸå¼ƒ/å³å°†ç§»é™¤çš„ In-Tree æ’ä»¶ æ’ä»¶ç±»å‹ æè¿° å¼ƒç”¨/ç§»é™¤ç‰ˆæœ¬ cephfs Ceph æ–‡ä»¶ç³»ç»Ÿå· v1.31 ä¹‹åä¸å¯ç”¨ flocker Flocker å­˜å‚¨ v1.25 ä¹‹åä¸å¯ç”¨ glusterfs GlusterFS å­˜å‚¨ v1.26 ä¹‹åä¸å¯ç”¨ photonPersistentDisk Photon æŒä¹…ç£ç›˜ v1.15 ä¹‹åä¸å¯ç”¨ quobyte Quobyte å· v1.25 ä¹‹åä¸å¯ç”¨ rbd Rados å—è®¾å¤‡ï¼ˆCeph RBDï¼‰ v1.31 ä¹‹åä¸å¯ç”¨ scaleIO ScaleIO å· v1.21 ä¹‹åä¸å¯ç”¨ storageos StorageOS å· v1.25 ä¹‹åä¸å¯ç”¨ accessModes è®¿é—®æ¨¡å¼ å®˜ç½‘æ–‡æ¡£:è®¿é—®æ¨¡å¼ è®¿é—®æ¨¡å¼ è¯´æ˜ æ˜¯å¦è·¨èŠ‚ç‚¹æŒ‚è½½ æ˜¯å¦æ”¯æŒå¤š Pod æŒ‚è½½ æ˜¯å¦æ”¯æŒè¯»å†™ ReadWriteOnce (RWO) å·å¯ä»¥è¢«ä¸€ä¸ªèŠ‚ç‚¹ä»¥è¯»å†™æ–¹å¼æŒ‚è½½ï¼ŒåŒä¸€èŠ‚ç‚¹å†…å¤šä¸ª Pod å¯å…±äº«ä½¿ç”¨ã€‚ âŒ å¦ âœ… æ˜¯ï¼ˆåŒä¸€èŠ‚ç‚¹ï¼‰ âœ… æ˜¯ ReadOnlyMany (ROX) å·å¯ä»¥è¢«å¤šä¸ªèŠ‚ç‚¹ä»¥åªè¯»æ–¹å¼æŒ‚è½½ã€‚ âœ… æ˜¯ âœ… æ˜¯ âŒ å¦ï¼ˆåªè¯»ï¼‰ ReadWriteMany (RWX) å·å¯ä»¥è¢«å¤šä¸ªèŠ‚ç‚¹ä»¥è¯»å†™æ–¹å¼æŒ‚è½½ã€‚ âœ… æ˜¯ âœ… æ˜¯ âœ… æ˜¯ ReadWriteOncePod (RWOP) å·åªèƒ½è¢«å•ä¸ª Pod ä»¥è¯»å†™æ–¹å¼æŒ‚è½½ï¼Œç¡®ä¿é›†ç¾¤ä¸­åªæœ‰ä¸€ä¸ª Pod ä½¿ç”¨è¯¥å·ï¼ˆv1.29+ç¨³å®šï¼‰ã€‚ âŒ å¦ âŒ å¦ï¼ˆåªèƒ½ä¸€ä¸ª Podï¼‰ âœ… æ˜¯ NFS æ”¯æŒå‰ä¸‰ç§è®¿é—®æ¨¡å¼ï¼ŒhostPath åªæ”¯æŒ ReadWriteOnceã€‚ persistentVolumeReclaimPolicy å›æ”¶ç­–ç•¥ å®˜æ–¹æ–‡æ¡£:å›æ”¶ç­–ç•¥ å›æ”¶ç­–ç•¥ å«ä¹‰ å›æ”¶è¡Œä¸º å…¸å‹ä½¿ç”¨åœºæ™¯ Retain ä¿ç•™ï¼šåˆ é™¤ PVC åï¼ŒPV å’Œåç«¯å­˜å‚¨ä»ç„¶ä¿ç•™ æ‰‹åŠ¨å›æ”¶ï¼ŒPVC åˆ é™¤å PV çŠ¶æ€ä¸º Releasedï¼Œéœ€è¦æ‰‹åŠ¨æ¸…ç†æˆ–é‡æ–°ç»‘å®š é‡è¦æ•°æ®ï¼Œé¿å…è¯¯åˆ ï¼›å¦‚æ•°æ®åº“æ•°æ®ç›˜ Delete åˆ é™¤ï¼šåˆ é™¤ PVC åï¼ŒPV å’Œåç«¯å­˜å‚¨éƒ½ä¼šè¢«åˆ é™¤ è‡ªåŠ¨å›æ”¶ï¼ŒPVC åˆ é™¤æ—¶è‡ªåŠ¨åˆ é™¤ PV å’Œåç«¯å­˜å‚¨èµ„æºï¼ˆå¦‚äº‘ç›˜ï¼‰ ä¸´æ—¶æ•°æ®ã€ä¸é‡è¦çš„å­˜å‚¨ Recycle å›æ”¶ï¼šç®€å•æ¸…ç©ºæ•°æ® è‡ªåŠ¨æ‰§è¡Œ rm -rf /thevolume/*ï¼Œç„¶å PV å˜å› Available çŠ¶æ€ æ—§ç‰ˆæœ¬é›†ç¾¤çš„å°æ–‡ä»¶ä¸´æ—¶å­˜å‚¨ æ³¨æ„: åˆ›å»º Recycle çš„ PV æ—¶ï¼Œä¼šæç¤ºå¦‚ä¸‹å†…å®¹ 1Warning: spec.persistentVolumeReclaimPolicy: The Recycle reclaim policy is deprecated. Instead, the recommended approach is to use dynamic provisioning. æ„æ€å°±æ˜¯ Recycle ç­–ç•¥å·²è¢«å¼ƒç”¨ï¼Œå»ºè®®ä½¿ç”¨åŠ¨æ€ä¾›åº”æ¨¡å¼ã€‚ä½†å®˜æ–¹æ–‡æ¡£ä¸­å´æç¤º å¯¹äº Kubernetes 1.33 æ¥è¯´ï¼Œåªæœ‰ nfs å’Œ hostPath å·ç±»å‹æ”¯æŒå›æ”¶ï¼ˆRecycleï¼‰ã€‚ æœ¬äººåœ¨ Kubernetes 1.33.2 ä¸­æµ‹è¯•ï¼ŒNFS æ”¯æŒ Recycleï¼Œåˆ é™¤ PVC å PV çŠ¶æ€ä¼šå˜ä¸º Available ç®¡ç† PV 123456789101112# åˆ›å»ºkubectl create -f pv-nfs.yaml# æŸ¥çœ‹$ k get pvNAME CAPACITY ACCESS MODES RECLAIM POLICY STATUS CLAIM STORAGECLASS VOLUMEATTRIBUTESCLASS REASON AGEpv-nfs-1g 1Gi RWO Retain Available &lt;unset&gt; 80spv-nfs-2g 2Gi RWX Retain Available &lt;unset&gt; 80s# åˆ é™¤kubectl delete pv pv-nfs-1gk delete -f pv-nfs.yaml PVC ç¤ºä¾‹ Pod é€šè¿‡ PVC å‘ PV ç”³è¯·å­˜å‚¨ç©ºé—´ï¼Œå¦‚æœ PVC ä¸€ç›´æ— æ³•åŒ¹é…åˆ° PVï¼Œåˆ™ PVC å¤„äº Pending çŠ¶æ€ã€‚ Pod å¿…é¡»ä¸ PVC å¤„äºåŒä¸€å‘½åç©ºé—´ã€‚ PVC ä¸ PV æ˜¯ 1:1 çš„å…³ç³»ã€‚ä¸€æ—¦ PV ç»‘å®šåˆ° PVCï¼Œåˆ™ PVC çŠ¶æ€å˜ä¸º Boundã€‚è¯¥ PV å°†ä¸å†è¢«å…¶ä»– PVC ç»‘å®šã€‚ PVC ä¸ PV åŒ¹é…çš„æ¡ä»¶ åŒ¹é…æ¡ä»¶ è¯´æ˜ å®¹é‡ PVC è¯·æ±‚çš„å®¹é‡ â‰¤ PV æä¾›çš„å®¹é‡ã€‚PV å¿…é¡»è‡³å°‘æ»¡è¶³ PVC çš„å®¹é‡è¯·æ±‚ã€‚ è®¿é—®æ¨¡å¼ PV æ”¯æŒ PVC è¯·æ±‚çš„è®¿é—®æ¨¡å¼ã€‚PVC è¦æ±‚çš„æ‰€æœ‰è®¿é—®æ¨¡å¼ï¼ŒPV éƒ½å¿…é¡»å…·å¤‡ã€‚ä¾‹å¦‚ï¼šPVC è¦æ±‚ ReadWriteOnceï¼ŒPV è‡³å°‘è¦æ”¯æŒ ReadWriteOnceã€‚ StorageClass PVC å’Œ PV çš„ storageClassName å¿…é¡»ä¸€è‡´ã€‚å¦‚æœ PVC æŒ‡å®šäº† storageClassNameï¼Œåªèƒ½ç»‘å®šåŒåçš„ PVã€‚ Selectorï¼ˆå¯é€‰ï¼‰ å¦‚æœ PVC æœ‰è®¾ç½® selectorï¼ˆåŸºäºæ ‡ç­¾ï¼‰ï¼ŒPV çš„æ ‡ç­¾ä¹Ÿå¿…é¡»åŒ¹é…ã€‚ å°è´´å£« PV ä¸­å£°æ˜çš„ accessModes ä»…ä½œä¸ºä¸ PVC çš„è®¿é—®æ¨¡å¼è¿›è¡ŒåŒ¹é…ï¼Œå®é™…æŒ‚è½½åˆ° Pod åï¼Œä¸ä¼šé™åˆ¶ Pod çš„è¯»å†™è®¿é—® ä¸€ä¸ªç®€å•çš„ yaml 123456789101112131415# pvc.yamlapiVersion: v1kind: PersistentVolumeClaimmetadata: name: mypvc namespace: defaultspec: accessModes: - ReadWriteMany # ç”³è¯·åŒ¹é…çš„è®¿é—®æ¨¡å¼ resources: requests: storage: 500Mi # ç”³è¯·çš„å®¹é‡ï¼Œå®é™…å®¹é‡ä»¥åŒ¹é…çš„ PV ä¸ºå‡† # selector: # åŒ¹é…çš„ PV æ ‡ç­¾ # matchLabels: # pv: nfs-pv1 # pv çš„æ ‡ç­¾ï¼Œåˆ›å»º pv æ—¶è¦æŒ‡å®š ç®¡ç† PVC 1234567891011121314151617181920212223# åˆ›å»º PVCkubectl apply -f pvc.yaml# æŸ¥çœ‹PVCï¼Œæ­¤æ—¶çœ‹åˆ° pv-nfs-1g ç»‘å®šäº† PVC$ k get pv,pvcNAME CAPACITY ACCESS MODES RECLAIM POLICY STATUS CLAIM STORAGECLASS VOLUMEATTRIBUTESCLASS REASON AGEpersistentvolume/pv-nfs-1g 1Gi RWO Retain Available &lt;unset&gt; 16spersistentvolume/pv-nfs-2g 2Gi RWX Retain Bound default/mypvc &lt;unset&gt; 16sNAME STATUS VOLUME CAPACITY ACCESS MODES STORAGECLASS VOLUMEATTRIBUTESCLASS AGEpersistentvolumeclaim/mypvc Bound pv-nfs-2g 2Gi RWX &lt;unset&gt; 9s# åˆ é™¤ PVCkubectl delete pvc mypvc# æ­¤æ—¶å†æ¬¡æŸ¥çœ‹ PVï¼Œpv-nfs-1g çŠ¶æ€å˜æ›´ä¸º Releasedï¼Œè¡¨ç¤ºå·²ç»é‡Šæ”¾ï¼Œä½†æ˜¯ä¸èƒ½å†è¢«å…¶å®ƒ PVC ç»‘å®šäº†ï¼Œåªèƒ½åˆ é™¤é‡å»ºäº†$ k get pvNAME CAPACITY ACCESS MODES RECLAIM POLICY STATUS CLAIM STORAGECLASS VOLUMEATTRIBUTESCLASS REASON AGEpv-nfs-1g 1Gi RWO Retain Available &lt;unset&gt; 18mpv-nfs-2g 2Gi RWX Retain Released default/mypvc &lt;unset&gt; 18m# åˆ é™¤ PVk delete pv pv-nfs-1g Pod ç»‘å®š PVC è¿™é‡Œä»¥ nginx deployment ä¸ºä¾‹ 12345678910111213141516171819202122232425262728# nginx-pvc-deployment.yamlapiVersion: apps/v1kind: Deploymentmetadata: name: nginx-pvc-deployment namespace: defaultspec: replicas: 3 # 3ä¸ª podä¼šå…±äº«ä¸€ä¸ª PVC selector: matchLabels: app: nginx-pvc template: metadata: labels: app: nginx-pvc spec: containers: - name: nginx image: nginx ports: - containerPort: 80 volumeMounts: - name: nginx-storage mountPath: /usr/share/nginx/html # æŒ‚è½½åˆ° nginx çš„é»˜è®¤ç½‘é¡µç›®å½• volumes: - name: nginx-storage persistentVolumeClaim: # æŒ‡å®šå­˜å‚¨å·ç±»å‹æ˜¯ PVC claimName: mypvc # å¯¹åº”ä½ åˆ›å»ºçš„ PVC åç§° ä¸€ä¸ª PVC å¯¹åº”ä¸€ä¸ª PVï¼Œä½†æ˜¯ä¸€ä¸ª PVC å¯ä»¥å¯¹åº”å¤šä¸ª Deployment ç­‰æ§åˆ¶å™¨ã€‚ä¸‹é¢æˆ‘ä»¬å°±å†åˆ›å»ºä¸€ä¸ª Deploymentï¼Œå°† ç›¸åŒçš„ PVC æŒ‚è½½åˆ°å®¹å™¨ä¸­ï¼Œå¹¶ä¸”æ¯éš”5ç§’ä¿®æ”¹ä¸€æ¬¡ PVC æŒ‚è½½çš„ç½‘é¡µï¼Œå¹¶é€šè¿‡ nginx å®¹å™¨æŸ¥çœ‹ç»“æœ 1234567891011121314151617181920212223242526# busybox-deployment.yamlapiVersion: apps/v1kind: Deploymentmetadata: name: busybox-deploymentspec: replicas: 1 selector: matchLabels: app: busybox template: metadata: labels: app: busybox spec: containers: - name: busybox image: busybox command: [&quot;sh&quot;, &quot;-c&quot;, &quot;while true; do echo $(date) &gt; /data/index.html; sleep 5; done&quot;] volumeMounts: - name: shared-volume mountPath: /data volumes: - name: shared-volume persistentVolumeClaim: claimName: mypvc åˆ›å»ºåæŸ¥çœ‹ pod ip 123456$ k get pod -o wideNAME READY STATUS RESTARTS AGE IP NODE NOMINATED NODE READINESS GATESbusybox-deployment-d7589665d-dx2rs 1/1 Running 0 2m59s 10.244.126.6 k8s-worker2 &lt;none&gt; &lt;none&gt;nginx-pvc-deployment-775b8c4f8b-89cw7 1/1 Running 0 44s 10.244.126.8 k8s-worker2 &lt;none&gt; &lt;none&gt;nginx-pvc-deployment-775b8c4f8b-fszlf 1/1 Running 0 44s 10.244.194.123 k8s-worker1 &lt;none&gt; &lt;none&gt;nginx-pvc-deployment-775b8c4f8b-w9qkt 1/1 Running 0 44s 10.244.126.7 k8s-worker2 &lt;none&gt; &lt;none&gt; è®¿é—®ä»»æ„ä¸€ä¸ª nginx pod 12# æ­¤æ—¶ä¼šçœ‹åˆ°é¡µé¢å†…å®¹åœ¨å˜åŒ–watch -n 5 curl 10.244.194.123 åè®° ä¸º pod ç»‘å®š pvcæ—¶ï¼Œæ¯æ¬¡éƒ½è¦å…ˆåˆ›å»º pv å’Œ pvcï¼Œéå¸¸éº»çƒ¦ã€‚æœ‰ä»€ä¹ˆå¥½çš„è§£å†³æ–¹æ¡ˆå—ï¼Ÿ ä½¿ç”¨ StorageClass å®ç°è‡ªåŠ¨åˆ›å»º PVï¼Œæˆ‘ä»¬ä¸‹æ–‡å°†ä»‹ç»å¦‚ä½•å®ç°ã€‚ å¦‚æœ PVC è¢« Pod ä½¿ç”¨ï¼Œåˆ™æ­¤æ—¶å¯ä»¥åˆ é™¤ PVC å—ï¼Ÿ ä¸å¯ä»¥ï¼ŒPVC è¢« Pod ä½¿ç”¨ï¼Œæ­¤æ—¶åªèƒ½ç­‰å¾… Pod åˆ é™¤åæ‰èƒ½åˆ é™¤ PVCã€‚ è‹¥æ­¤æ—¶æ‰§è¡Œäº†åˆ é™¤ PVC å‘½ä»¤ï¼Œç»ˆç«¯ä¼šä¸€ç›´ç­‰å¾…ï¼Œctrl + c é€€å‡ºåå†æ¬¡æŸ¥çœ‹ PVC çŠ¶æ€ï¼Œä¼šçœ‹åˆ° PVC çŠ¶æ€ä¸º Terminatingã€‚ä½†æ­¤æ—¶ä¸ä¼šå½±å“å­˜Podå¯¹å‚¨å·çš„ä½¿ç”¨ã€‚ æ­¤æ—¶ä¸€æ—¦Pod åˆ é™¤ï¼ŒPVC å°±ä¼šè¢«åˆ é™¤ã€‚ å¦‚æœPV è¢« PVC ä½¿ç”¨ï¼Œåˆ™æ­¤æ—¶å¯ä»¥åˆ é™¤ PV å—ï¼Ÿ ä¸å¯ä»¥ï¼ŒPV è¢« PVC ä½¿ç”¨ï¼Œæ­¤æ—¶åªèƒ½ç­‰å¾… PVC åˆ é™¤åæ‰èƒ½åˆ é™¤ PVã€‚ è‹¥æ­¤æ—¶æ‰§è¡Œäº†åˆ é™¤ PV å‘½ä»¤ï¼Œç»ˆç«¯ä¼šä¸€ç›´ç­‰å¾…ï¼Œctrl + c é€€å‡ºåå†æ¬¡æŸ¥çœ‹ PV çŠ¶æ€ï¼Œä¼šçœ‹åˆ° PV çŠ¶æ€ä¸º Terminatingã€‚ä½†æ­¤æ—¶ä¸ä¼šå½±å“Podå¯¹å­˜å‚¨å·çš„ä½¿ç”¨ã€‚ æ­¤æ—¶ä¸€æ—¦ PVC åˆ é™¤ï¼ŒPV å°±ä¼šè¢«åˆ é™¤ã€‚","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» K8S çš„ æŒä¹…å· PV å’Œ PVC ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚ K8Så®˜ç½‘ k8s Github k8s PV/PVC å®˜æ–¹æ–‡æ¡£ æœ¬æ–‡åº•å±‚å­˜å‚¨å·æ˜¯ NFS","date_published":"2025-07-21T15:35:15.000Z","tags":["æŠ€æœ¯","k8s","K8S"]},{"id":"https://blog.hanqunfeng.com/2025/07/21/k8s-storage-nfs/","url":"https://blog.hanqunfeng.com/2025/07/21/k8s-storage-nfs/","title":"K8S ä¹‹ å­˜å‚¨å· NFS","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç» K8S çš„ å­˜å‚¨å· NFS ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://kubernetes.io/zh-cn/\">K8Så®˜ç½‘</a></p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://github.com/kubernetes/kubernetes\">k8s Github</a></p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"å­˜å‚¨å·-NFS-ä»‹ç»\">å­˜å‚¨å· NFS ä»‹ç»</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åœ¨ Kubernetes ä¸­ï¼ŒNFS (Network File System) æ˜¯ä¸€ç§é€šè¿‡ç½‘ç»œå°†è¿œç¨‹å­˜å‚¨æŒ‚è½½åˆ° Pod çš„æ–¹å¼ã€‚å®ƒå…è®¸å¤šä¸ª Pod è·¨èŠ‚ç‚¹å…±äº«ç›¸åŒçš„å­˜å‚¨ç›®å½•ï¼Œå¸¸ç”¨äº ReadWriteManyï¼ˆRWXï¼‰ åœºæ™¯ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>æˆ‘ä»¬éœ€è¦å‡†å¤‡ä¸€ä¸ªNFS æœåŠ¡å™¨ï¼Œå¹¶é…ç½® NFS å­˜å‚¨å·ã€‚å…·ä½“å¯ä»¥å‚è€ƒ <a href=\"/2025/07/21/linux-nfs/\" title=\"Linux å®‰è£… NFS\">Linux å®‰è£… NFS</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>k8sä¸­æ¯ä¸ªworkerèŠ‚ç‚¹éƒ½éœ€è¦å®‰è£… NFS å®¢æˆ·ç«¯ï¼Œä½†æ˜¯ä¸éœ€è¦æŒ‚è½½ NFS å­˜å‚¨å·ï¼Œè¿™ä¸ªä¼šåœ¨podä¸­è¿›è¡Œã€‚</p>\n</li>\n</ul>\n<h2 id=\"ç¤ºä¾‹\">ç¤ºä¾‹</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¸€ä¸ªä½¿ç”¨ NFS å­˜å‚¨å·çš„ pod ç¤ºä¾‹</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># nfs-direct-pod.yaml</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Pod</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">nfs-direct-pod</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">containers:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">busybox</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">busybox</span></span><br><span class=\"line\">    <span class=\"attr\">command:</span> [<span class=\"string\">&quot;sh&quot;</span>, <span class=\"string\">&quot;-c&quot;</span>, <span class=\"string\">&quot;sleep 3600&quot;</span>]</span><br><span class=\"line\">    <span class=\"attr\">volumeMounts:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">nfs-volume</span></span><br><span class=\"line\">      <span class=\"attr\">mountPath:</span> <span class=\"string\">/data</span>          <span class=\"comment\"># å®¹å™¨å†…æŒ‚è½½ç‚¹</span></span><br><span class=\"line\">  <span class=\"attr\">volumes:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">nfs-volume</span></span><br><span class=\"line\">    <span class=\"attr\">nfs:</span></span><br><span class=\"line\">      <span class=\"attr\">server:</span> <span class=\"number\">10.211</span><span class=\"number\">.55</span><span class=\"number\">.88</span>      <span class=\"comment\"># NFS æœåŠ¡ç«¯åœ°å€</span></span><br><span class=\"line\">      <span class=\"attr\">path:</span> <span class=\"string\">/nfs-server/data</span>    <span class=\"comment\"># NFS æœåŠ¡ç«¯å…±äº«ç›®å½•</span></span><br><span class=\"line\">      <span class=\"attr\">readOnly:</span> <span class=\"literal\">false</span>           <span class=\"comment\"># æ˜¯å¦åªè¯»æŒ‚è½½ï¼Œfalse è¡¨ç¤ºå¯è¯»å†™</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ›å»º Pod</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl apply -f nfs-direct-pod.yaml</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æŸ¥çœ‹ Pod æŒ‚è½½ç‚¹</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹podéƒ¨ç½²åˆ°å“ªä¸ªèŠ‚ç‚¹</span></span><br><span class=\"line\">$ kubectl get pod nfs-direct-pod -o wide</span><br><span class=\"line\">NAME             READY   STATUS    RESTARTS   AGE   IP               NODE          NOMINATED NODE   READINESS GATES</span><br><span class=\"line\">nfs-direct-pod   1/1     Running   0          12m   10.244.194.115   k8s-worker1   &lt;none&gt;           &lt;none&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ç™»å½• k8s-worker1 èŠ‚ç‚¹ï¼ŒæŸ¥çœ‹ nfs æŒ‚è½½ç‚¹ï¼Œä¹Ÿå°±æ˜¯è¯´ åˆ›å»º podæ—¶ä¼šè‡ªåŠ¨åœ¨å®¿ä¸»æœºä¸ŠæŒ‚è½½ nfs</span></span><br><span class=\"line\">$ <span class=\"built_in\">df</span> -t nfs4</span><br><span class=\"line\">Filesystem                    1K-blocks    Used Available Use% Mounted on</span><br><span class=\"line\">10.211.55.88:/nfs-server/data  42872832 3630080  39242752   9% /var/lib/kubelet/pods/e44786a9-fbd9-4ee8-bb28-84eb074fb7d9/volumes/kubernetes.io~nfs/nfs-volume</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹podæŒ‚è½½çš„ç›®å½•</span></span><br><span class=\"line\">$ k <span class=\"built_in\">exec</span> -it nfs-direct-pod -- <span class=\"built_in\">df</span> -t nfs4</span><br><span class=\"line\">Filesystem           1K-blocks      Used Available Use% Mounted on</span><br><span class=\"line\">10.211.55.88:/nfs-server/data</span><br><span class=\"line\">                      42872832   3630080  39242752   8% /data</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å‘nfsæŒ‚è½½ç›®å½•ä¸­å†™å…¥æ•°æ®</span></span><br><span class=\"line\">k <span class=\"built_in\">exec</span> -it nfs-direct-pod -- sh -c <span class=\"string\">&#x27;echo &quot;hello world&quot; &gt; /data/test.txt&#x27;</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ é™¤pod</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">k delete pod nfs-direct-pod</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å†æ¬¡ç™»å½• å®¿ä¸»æœºèŠ‚ç‚¹ï¼Œå‘ç° nfs æŒ‚è½½ç‚¹ä¹Ÿè¢«å¸è½½äº†ï¼Œä½†æ˜¯ nfs-server ä¸­çš„æ–‡ä»¶ä»ç„¶å­˜åœ¨</span></span><br><span class=\"line\">$ <span class=\"built_in\">df</span> -t nfs4</span><br><span class=\"line\"><span class=\"built_in\">df</span>: no file systems processed</span><br></pre></td></tr></table></figure>\n<h2 id=\"å­˜å‚¨å·ç±»å‹-emptyDirã€hostPathã€NFS-çš„å¯¹æ¯”è¡¨\">å­˜å‚¨å·ç±»å‹ emptyDirã€hostPathã€NFS çš„å¯¹æ¯”è¡¨</h2>\n<table>\n<thead>\n<tr>\n<th>ç‰¹æ€§</th>\n<th><code>emptyDir</code></th>\n<th><code>hostPath</code></th>\n<th><code>nfs</code></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>æ•°æ®ç”Ÿå‘½å‘¨æœŸ</strong></td>\n<td>Pod ç”Ÿå‘½å‘¨æœŸå†…æœ‰æ•ˆï¼ŒPod åˆ é™¤æ•°æ®ä¸¢å¤±</td>\n<td>ç»‘å®šèŠ‚ç‚¹ä¸Šçš„ç›®å½•ï¼ŒPod åˆ äº†æ•°æ®ä»ä¿ç•™</td>\n<td>å­˜å‚¨åœ¨è¿œç¨‹ NFS Serverï¼ŒPod åˆ é™¤æ•°æ®ä¸ä¸¢å¤±</td>\n</tr>\n<tr>\n<td><strong>å…±äº«èŒƒå›´</strong></td>\n<td><strong>åŒä¸€ä¸ª Pod çš„å¤šä¸ªå®¹å™¨å¯å…±äº«</strong></td>\n<td>åŒä¸€èŠ‚ç‚¹ä¸Šå¤šä¸ª Pod å¯å…±äº«</td>\n<td>é›†ç¾¤å†…å¤šä¸ª Pod è·¨èŠ‚ç‚¹å¯å…±äº«</td>\n</tr>\n<tr>\n<td><strong>æŒä¹…åŒ–èƒ½åŠ›</strong></td>\n<td>âŒ ä¸æŒä¹…åŒ–ï¼Œéš Pod ç”Ÿå‘½å‘¨æœŸç»“æŸæ¶ˆå¤±</td>\n<td>âœ… æŒä¹…åŒ–ï¼Œåªè¦å®¿ä¸»æœºç›®å½•å­˜åœ¨æ•°æ®å°±åœ¨</td>\n<td>âœ… æŒä¹…åŒ–ï¼ŒNFS å­˜å‚¨ç‹¬ç«‹äº Pod å­˜åœ¨</td>\n</tr>\n<tr>\n<td><strong>è·¨èŠ‚ç‚¹å…±äº«</strong></td>\n<td>âŒ ä¸èƒ½</td>\n<td>âŒ ä¸èƒ½</td>\n<td>âœ… æ”¯æŒè·¨èŠ‚ç‚¹å…±äº«</td>\n</tr>\n<tr>\n<td><strong>é€‚ç”¨åœºæ™¯</strong></td>\n<td>ä¸´æ—¶ç¼“å­˜ã€è¿›ç¨‹é—´å…±äº«æ•°æ®</td>\n<td>å®¿ä¸»æœºç‰¹å®šç›®å½•æŒ‚è½½ï¼Œæ—¥å¿—å­˜å‚¨ã€å®¿ä¸»æœºæ’ä»¶å¯¹æ¥</td>\n<td>å¤šå‰¯æœ¬æœåŠ¡å…±äº«å­˜å‚¨ã€æŒä¹…åŒ–æ•°æ®ã€å…±äº«é…ç½®æ–‡ä»¶</td>\n</tr>\n<tr>\n<td><strong>æ•°æ®å®‰å…¨æ€§</strong></td>\n<td>éš Pod åˆ é™¤ï¼Œ<strong>æ•°æ®æ˜“ä¸¢å¤±</strong></td>\n<td>å®¹å™¨æœ‰æƒé™å¯ä¿®æ”¹å®¿ä¸»æœºæ–‡ä»¶ï¼Œå­˜åœ¨é£é™©</td>\n<td>ä¾èµ– NFS Server ç¨³å®šæ€§ï¼Œé…ç½®ä¸å½“å¯èƒ½è¢«æ‰€æœ‰èŠ‚ç‚¹è¯»å†™</td>\n</tr>\n<tr>\n<td><strong>å…¸å‹ç”¨ä¾‹</strong></td>\n<td>Redis ç¼“å­˜ç›®å½•ã€Sidecar å®¹å™¨å…±äº«æ—¥å¿—</td>\n<td>æŒ‚è½½å®¿ä¸»æœº docker.sockã€å®¿ä¸»æœºæ—¥å¿—ç›®å½•</td>\n<td>è·¨ Pod æ–‡ä»¶å…±äº«ã€Web é™æ€èµ„æºã€Tensorflow å¤šå‰¯æœ¬è®­ç»ƒå…±äº«æ•°æ®</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"ä¸ºä»€ä¹ˆå·²ç»æœ‰-NFSï¼Œè¿˜æ¨èç”¨-PV-PVCï¼Ÿ\">ä¸ºä»€ä¹ˆå·²ç»æœ‰ NFSï¼Œè¿˜æ¨èç”¨ PV/PVCï¼Ÿ</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>âœ… ç®€çŸ­å›ç­”ï¼šPV/PVC æ˜¯å¯¹åº•å±‚å­˜å‚¨ï¼ˆå¦‚ NFSï¼‰çš„æŠ½è±¡å’Œæ ‡å‡†åŒ–ç®¡ç†ã€‚</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>åŸå› </th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>âœ… <strong>Kubernetes æ ‡å‡†èµ„æº</strong></td>\n<td>ç”¨ PVC å£°æ˜å­˜å‚¨éœ€æ±‚ï¼Œç”± K8s ç»Ÿä¸€è°ƒåº¦å’Œç®¡ç†ã€‚</td>\n</tr>\n<tr>\n<td>âœ… <strong>å­˜å‚¨ä¸ Pod è§£è€¦</strong></td>\n<td>Pod ä¸“æ³¨äºåº”ç”¨é€»è¾‘ï¼ŒPVC ä¸“æ³¨äºå£°æ˜â€œæˆ‘è¦ä¸€ä¸ª 10Gi çš„ RWX å­˜å‚¨â€ï¼ŒèƒŒåæ˜¯ NFSã€Ceph è¿˜æ˜¯åˆ«çš„ï¼Œå¼€å‘è€…æ— éœ€å…³å¿ƒã€‚</td>\n</tr>\n<tr>\n<td>âœ… <strong>åŠ¨æ€ä¾›åº”</strong></td>\n<td>æ­é… StorageClass å¯ä»¥å®ç° <strong>è‡ªåŠ¨åˆ›å»º PV</strong>ï¼Œä¸éœ€è¦æ‰‹åŠ¨ç»´æŠ¤ PVã€‚</td>\n</tr>\n<tr>\n<td>âœ… <strong>ç”Ÿå‘½å‘¨æœŸç®¡ç†</strong></td>\n<td>PVC è¢«åˆ é™¤æ—¶å¯è§¦å‘ PV å›æ”¶ã€ä¿ç•™æˆ–åˆ é™¤ç­–ç•¥ï¼ˆ<code>Retain</code>ã€<code>Recycle</code>ã€<code>Delete</code>ï¼‰ã€‚ç›´æ¥æŒ‚è½½ NFS æ²¡æœ‰è¿™äº›æœºåˆ¶ã€‚</td>\n</tr>\n<tr>\n<td>âœ… <strong>æƒé™éš”ç¦»</strong></td>\n<td>PV/PVC å¯ä»¥é€šè¿‡ <code>accessModes</code> æ§åˆ¶è®¿é—®çº§åˆ«ï¼Œæ¯”å¦‚åªå…è®¸ç‰¹å®š Pod è®¿é—®ã€‚ç›´æ¥æŒ‚è½½ NFS å®¹æ˜“æƒé™æ··ä¹±ã€‚</td>\n</tr>\n<tr>\n<td>âœ… <strong>æ›´å¥½å…¼å®¹æ€§</strong></td>\n<td>æŸäº›å·¥ä½œè´Ÿè½½ï¼ˆå¦‚ StatefulSetï¼‰<strong>åªèƒ½ç”¨ PVC</strong>ï¼Œä¸æ”¯æŒç›´æ¥ <code>nfs</code> å·ã€‚</td>\n</tr>\n<tr>\n<td>âœ… <strong>æ›´çµæ´»çš„åˆ‡æ¢å­˜å‚¨æ–¹æ¡ˆ</strong></td>\n<td>åæœŸå¦‚æœæ¢æˆ Cephã€EBSã€GlusterFSï¼Œåªéœ€æ”¹ PV/PVCï¼Œä¸éœ€è¦æ”¹ Pod é…ç½®ã€‚</td>\n</tr>\n</tbody>\n</table>\n","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» K8S çš„ å­˜å‚¨å· NFS ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚ K8Så®˜ç½‘ k8s Github å­˜å‚¨å· NFS ä»‹ç» åœ¨ Kubernetes ä¸­ï¼ŒNFS (Network File System) æ˜¯ä¸€ç§é€šè¿‡ç½‘ç»œå°†è¿œç¨‹å­˜å‚¨æŒ‚è½½åˆ° Pod çš„æ–¹å¼ã€‚å®ƒå…è®¸å¤šä¸ª Pod è·¨èŠ‚ç‚¹å…±äº«ç›¸åŒçš„å­˜å‚¨ç›®å½•ï¼Œå¸¸ç”¨äº ReadWriteManyï¼ˆRWXï¼‰ åœºæ™¯ã€‚ æˆ‘ä»¬éœ€è¦å‡†å¤‡ä¸€ä¸ªNFS æœåŠ¡å™¨ï¼Œå¹¶é…ç½® NFS å­˜å‚¨å·ã€‚å…·ä½“å¯ä»¥å‚è€ƒ Linux å®‰è£… NFS k8sä¸­æ¯ä¸ªworkerèŠ‚ç‚¹éƒ½éœ€è¦å®‰è£… NFS å®¢æˆ·ç«¯ï¼Œä½†æ˜¯ä¸éœ€è¦æŒ‚è½½ NFS å­˜å‚¨å·ï¼Œè¿™ä¸ªä¼šåœ¨podä¸­è¿›è¡Œã€‚ ç¤ºä¾‹ ä¸€ä¸ªä½¿ç”¨ NFS å­˜å‚¨å·çš„ pod ç¤ºä¾‹ 12345678910111213141516171819# nfs-direct-pod.yamlapiVersion: v1kind: Podmetadata: name: nfs-direct-podspec: containers: - name: busybox image: busybox command: [&quot;sh&quot;, &quot;-c&quot;, &quot;sleep 3600&quot;] volumeMounts: - name: nfs-volume mountPath: /data # å®¹å™¨å†…æŒ‚è½½ç‚¹ volumes: - name: nfs-volume nfs: server: 10.211.55.88 # NFS æœåŠ¡ç«¯åœ°å€ path: /nfs-server/data # NFS æœåŠ¡ç«¯å…±äº«ç›®å½• readOnly: false # æ˜¯å¦åªè¯»æŒ‚è½½ï¼Œfalse è¡¨ç¤ºå¯è¯»å†™ åˆ›å»º Pod 1kubectl apply -f nfs-direct-pod.yaml æŸ¥çœ‹ Pod æŒ‚è½½ç‚¹ 123456789101112131415161718# æŸ¥çœ‹podéƒ¨ç½²åˆ°å“ªä¸ªèŠ‚ç‚¹$ kubectl get pod nfs-direct-pod -o wideNAME READY STATUS RESTARTS AGE IP NODE NOMINATED NODE READINESS GATESnfs-direct-pod 1/1 Running 0 12m 10.244.194.115 k8s-worker1 &lt;none&gt; &lt;none&gt;# ç™»å½• k8s-worker1 èŠ‚ç‚¹ï¼ŒæŸ¥çœ‹ nfs æŒ‚è½½ç‚¹ï¼Œä¹Ÿå°±æ˜¯è¯´ åˆ›å»º podæ—¶ä¼šè‡ªåŠ¨åœ¨å®¿ä¸»æœºä¸ŠæŒ‚è½½ nfs$ df -t nfs4Filesystem 1K-blocks Used Available Use% Mounted on10.211.55.88:/nfs-server/data 42872832 3630080 39242752 9% /var/lib/kubelet/pods/e44786a9-fbd9-4ee8-bb28-84eb074fb7d9/volumes/kubernetes.io~nfs/nfs-volume# æŸ¥çœ‹podæŒ‚è½½çš„ç›®å½•$ k exec -it nfs-direct-pod -- df -t nfs4Filesystem 1K-blocks Used Available Use% Mounted on10.211.55.88:/nfs-server/data 42872832 3630080 39242752 8% /data# å‘nfsæŒ‚è½½ç›®å½•ä¸­å†™å…¥æ•°æ®k exec -it nfs-direct-pod -- sh -c &#x27;echo &quot;hello world&quot; &gt; /data/test.txt&#x27; åˆ é™¤pod 12345k delete pod nfs-direct-pod# å†æ¬¡ç™»å½• å®¿ä¸»æœºèŠ‚ç‚¹ï¼Œå‘ç° nfs æŒ‚è½½ç‚¹ä¹Ÿè¢«å¸è½½äº†ï¼Œä½†æ˜¯ nfs-server ä¸­çš„æ–‡ä»¶ä»ç„¶å­˜åœ¨$ df -t nfs4df: no file systems processed å­˜å‚¨å·ç±»å‹ emptyDirã€hostPathã€NFS çš„å¯¹æ¯”è¡¨ ç‰¹æ€§ emptyDir hostPath nfs æ•°æ®ç”Ÿå‘½å‘¨æœŸ Pod ç”Ÿå‘½å‘¨æœŸå†…æœ‰æ•ˆï¼ŒPod åˆ é™¤æ•°æ®ä¸¢å¤± ç»‘å®šèŠ‚ç‚¹ä¸Šçš„ç›®å½•ï¼ŒPod åˆ äº†æ•°æ®ä»ä¿ç•™ å­˜å‚¨åœ¨è¿œç¨‹ NFS Serverï¼ŒPod åˆ é™¤æ•°æ®ä¸ä¸¢å¤± å…±äº«èŒƒå›´ åŒä¸€ä¸ª Pod çš„å¤šä¸ªå®¹å™¨å¯å…±äº« åŒä¸€èŠ‚ç‚¹ä¸Šå¤šä¸ª Pod å¯å…±äº« é›†ç¾¤å†…å¤šä¸ª Pod è·¨èŠ‚ç‚¹å¯å…±äº« æŒä¹…åŒ–èƒ½åŠ› âŒ ä¸æŒä¹…åŒ–ï¼Œéš Pod ç”Ÿå‘½å‘¨æœŸç»“æŸæ¶ˆå¤± âœ… æŒä¹…åŒ–ï¼Œåªè¦å®¿ä¸»æœºç›®å½•å­˜åœ¨æ•°æ®å°±åœ¨ âœ… æŒä¹…åŒ–ï¼ŒNFS å­˜å‚¨ç‹¬ç«‹äº Pod å­˜åœ¨ è·¨èŠ‚ç‚¹å…±äº« âŒ ä¸èƒ½ âŒ ä¸èƒ½ âœ… æ”¯æŒè·¨èŠ‚ç‚¹å…±äº« é€‚ç”¨åœºæ™¯ ä¸´æ—¶ç¼“å­˜ã€è¿›ç¨‹é—´å…±äº«æ•°æ® å®¿ä¸»æœºç‰¹å®šç›®å½•æŒ‚è½½ï¼Œæ—¥å¿—å­˜å‚¨ã€å®¿ä¸»æœºæ’ä»¶å¯¹æ¥ å¤šå‰¯æœ¬æœåŠ¡å…±äº«å­˜å‚¨ã€æŒä¹…åŒ–æ•°æ®ã€å…±äº«é…ç½®æ–‡ä»¶ æ•°æ®å®‰å…¨æ€§ éš Pod åˆ é™¤ï¼Œæ•°æ®æ˜“ä¸¢å¤± å®¹å™¨æœ‰æƒé™å¯ä¿®æ”¹å®¿ä¸»æœºæ–‡ä»¶ï¼Œå­˜åœ¨é£é™© ä¾èµ– NFS Server ç¨³å®šæ€§ï¼Œé…ç½®ä¸å½“å¯èƒ½è¢«æ‰€æœ‰èŠ‚ç‚¹è¯»å†™ å…¸å‹ç”¨ä¾‹ Redis ç¼“å­˜ç›®å½•ã€Sidecar å®¹å™¨å…±äº«æ—¥å¿— æŒ‚è½½å®¿ä¸»æœº docker.sockã€å®¿ä¸»æœºæ—¥å¿—ç›®å½• è·¨ Pod æ–‡ä»¶å…±äº«ã€Web é™æ€èµ„æºã€Tensorflow å¤šå‰¯æœ¬è®­ç»ƒå…±äº«æ•°æ® ä¸ºä»€ä¹ˆå·²ç»æœ‰ NFSï¼Œè¿˜æ¨èç”¨ PV/PVCï¼Ÿ âœ… ç®€çŸ­å›ç­”ï¼šPV/PVC æ˜¯å¯¹åº•å±‚å­˜å‚¨ï¼ˆå¦‚ NFSï¼‰çš„æŠ½è±¡å’Œæ ‡å‡†åŒ–ç®¡ç†ã€‚ åŸå›  è¯´æ˜ âœ… Kubernetes æ ‡å‡†èµ„æº ç”¨ PVC å£°æ˜å­˜å‚¨éœ€æ±‚ï¼Œç”± K8s ç»Ÿä¸€è°ƒåº¦å’Œç®¡ç†ã€‚ âœ… å­˜å‚¨ä¸ Pod è§£è€¦ Pod ä¸“æ³¨äºåº”ç”¨é€»è¾‘ï¼ŒPVC ä¸“æ³¨äºå£°æ˜â€œæˆ‘è¦ä¸€ä¸ª 10Gi çš„ RWX å­˜å‚¨â€ï¼ŒèƒŒåæ˜¯ NFSã€Ceph è¿˜æ˜¯åˆ«çš„ï¼Œå¼€å‘è€…æ— éœ€å…³å¿ƒã€‚ âœ… åŠ¨æ€ä¾›åº” æ­é… StorageClass å¯ä»¥å®ç° è‡ªåŠ¨åˆ›å»º PVï¼Œä¸éœ€è¦æ‰‹åŠ¨ç»´æŠ¤ PVã€‚ âœ… ç”Ÿå‘½å‘¨æœŸç®¡ç† PVC è¢«åˆ é™¤æ—¶å¯è§¦å‘ PV å›æ”¶ã€ä¿ç•™æˆ–åˆ é™¤ç­–ç•¥ï¼ˆRetainã€Recycleã€Deleteï¼‰ã€‚ç›´æ¥æŒ‚è½½ NFS æ²¡æœ‰è¿™äº›æœºåˆ¶ã€‚ âœ… æƒé™éš”ç¦» PV/PVC å¯ä»¥é€šè¿‡ accessModes æ§åˆ¶è®¿é—®çº§åˆ«ï¼Œæ¯”å¦‚åªå…è®¸ç‰¹å®š Pod è®¿é—®ã€‚ç›´æ¥æŒ‚è½½ NFS å®¹æ˜“æƒé™æ··ä¹±ã€‚ âœ… æ›´å¥½å…¼å®¹æ€§ æŸäº›å·¥ä½œè´Ÿè½½ï¼ˆå¦‚ StatefulSetï¼‰åªèƒ½ç”¨ PVCï¼Œä¸æ”¯æŒç›´æ¥ nfs å·ã€‚ âœ… æ›´çµæ´»çš„åˆ‡æ¢å­˜å‚¨æ–¹æ¡ˆ åæœŸå¦‚æœæ¢æˆ Cephã€EBSã€GlusterFSï¼Œåªéœ€æ”¹ PV/PVCï¼Œä¸éœ€è¦æ”¹ Pod é…ç½®ã€‚","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» K8S çš„ å­˜å‚¨å· NFS ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚ K8Så®˜ç½‘ k8s Github","date_published":"2025-07-21T15:34:15.000Z","tags":["æŠ€æœ¯","k8s","K8S"]},{"id":"https://blog.hanqunfeng.com/2025/07/21/linux-nfs/","url":"https://blog.hanqunfeng.com/2025/07/21/linux-nfs/","title":"Linux å®‰è£… NFS","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç» linux ä¸‹ nfs æ–‡ä»¶ç³»ç»Ÿçš„å®‰è£…ä¸ä½¿ç”¨</p>\n</li>\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡åŸºäº<code>CentOS8(x86_64)</code></p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"NFS-ç®€ä»‹\">NFS ç®€ä»‹</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>NFSï¼ˆç½‘ç»œæ–‡ä»¶ç³»ç»Ÿï¼ŒNetwork File Systemï¼‰æ˜¯ä¸€ä¸ªé€šè¿‡ç½‘ç»œå…±äº«æ–‡ä»¶çš„åè®®ï¼Œå…è®¸ä¸åŒæœåŠ¡å™¨æˆ–å®¢æˆ·ç«¯åƒæŒ‚è½½æœ¬åœ°ç£ç›˜ä¸€æ ·è®¿é—®è¿œç«¯çš„å…±äº«æ–‡ä»¶ç›®å½•ã€‚</p>\n</li>\n</ul>\n<h2 id=\"å‡†å¤‡ä¸€å°æœåŠ¡å™¨\">å‡†å¤‡ä¸€å°æœåŠ¡å™¨</h2>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># è®¾ç½® hostname</span></span><br><span class=\"line\">hostnamectl set-hostname nfs-server</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹ç½‘å¡</span></span><br><span class=\"line\">ip a</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># è®¾ç½®IP åˆ†é…æ–¹å¼ï¼Œmanual: æ‰‹åŠ¨æŒ‡å®šIPï¼Œauto: DHCPè‡ªåŠ¨è·å–ï¼Œdisabled: å…³é—­IP</span></span><br><span class=\"line\">nmcli con mod enp0s5 ipv4.method manual</span><br><span class=\"line\"><span class=\"comment\"># è®¾ç½® IP</span></span><br><span class=\"line\">nmcli con mod enp0s5 ipv4.addresses 10.211.55.88/24</span><br><span class=\"line\"><span class=\"comment\"># è®¾ç½® gateway</span></span><br><span class=\"line\">nmcli con mod enp0s5 ipv4.gateway 10.211.55.1</span><br><span class=\"line\"><span class=\"comment\"># è®¾ç½® dns</span></span><br><span class=\"line\">nmcli con mod enp0s5 ipv4.dns <span class=\"string\">&quot;10.211.55.1,8.8.8.8&quot;</span></span><br><span class=\"line\"><span class=\"comment\"># é‡æ–°å¯åŠ¨ç½‘å¡</span></span><br><span class=\"line\">nmcli con up enp0s5</span><br></pre></td></tr></table></figure>\n<h2 id=\"NFS-å®‰è£…ï¼šæœåŠ¡ç«¯\">NFS å®‰è£…ï¼šæœåŠ¡ç«¯</h2>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å®‰è£… nfs-utils å’Œ rpcbind</span></span><br><span class=\"line\">dnf install rpcbind nfs-utils -y</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åˆ›å»º nfs-server å­˜å‚¨ç›®å½•</span></span><br><span class=\"line\"><span class=\"built_in\">mkdir</span> -p /nfs-server/data</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># é…ç½® nfs-serverï¼Œå¯ä»¥æ·»åŠ å¤šä¸ªç›®å½•</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;/nfs-server/data *(insecure,rw,sync,no_root_squash,no_all_squash)&quot;</span> &gt;&gt; /etc/exports</span><br><span class=\"line\"><span class=\"comment\">## é…ç½®é¡¹è¯´æ˜</span></span><br><span class=\"line\"><span class=\"comment\"># * ï¼šå…è®¸æ‰€æœ‰å®¢æˆ·ç«¯è®¿é—®ï¼Œä¹Ÿå¯ä»¥æŒ‡å®šå…·ä½“çš„å®¢æˆ·ç«¯ IP åœ°å€ï¼Œæ¯”å¦‚ï¼š192.168.0.0/24(rw,sync,no_root_squash,no_all_squash)</span></span><br><span class=\"line\"><span class=\"comment\"># insecure ï¼šå…è®¸ä»»æ„ç«¯å£ï¼ˆå…¼å®¹æ€§å¥½,æ”¯æŒk8sï¼‰ï¼Œé»˜è®¤å€¼æ˜¯ secureï¼šåªå…è®¸ 1024 ä»¥ä¸‹ç«¯å£ï¼Œé€‚åˆä¼ ç»ŸæœåŠ¡å™¨</span></span><br><span class=\"line\"><span class=\"comment\"># rw ï¼šè¯»å†™æƒé™ï¼Œroï¼šåªè¯»æƒé™</span></span><br><span class=\"line\"><span class=\"comment\"># sync ï¼šåŒæ­¥æ¨¡å¼ï¼Œå¼ºä¸€è‡´æ€§ï¼Œasyncï¼šå¼‚æ­¥æ¨¡å¼ï¼Œæ€§èƒ½é«˜ï¼Œä½†å­˜åœ¨ä¸¢æ•°æ®é£é™©</span></span><br><span class=\"line\"><span class=\"comment\"># no_root_squash ï¼šå…è®¸ root ç”¨æˆ·è®¿é—®ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œroot ç”¨æˆ·è®¿é—®æ—¶ä¼šè¢«è½¬æ¢æˆ nobody ç”¨æˆ·</span></span><br><span class=\"line\"><span class=\"comment\"># no_all_squash ï¼šå…è®¸æ‰€æœ‰ç”¨æˆ·è®¿é—®ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰€æœ‰ç”¨æˆ·è®¿é—®æ—¶ä¼šè¢«è½¬æ¢æˆ nobody ç”¨æˆ·ï¼Œé»˜è®¤å°±æ˜¯è¿™ä¸ªï¼Œå¯ä»¥çœç•¥ã€‚</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å¯åŠ¨ rpcbindã€nfs æœåŠ¡</span></span><br><span class=\"line\">systemctl start rpcbind &amp;&amp; systemctl start nfs-server</span><br><span class=\"line\"><span class=\"comment\"># å¼€æœºè‡ªå¯åŠ¨</span></span><br><span class=\"line\">systemctl <span class=\"built_in\">enable</span> rpcbind &amp;&amp; systemctl <span class=\"built_in\">enable</span> nfs-server</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ä¿®æ”¹é…ç½®æ–‡ä»¶ /etc/exportsï¼Œéœ€è¦é‡è½½ nfs é…ç½®</span></span><br><span class=\"line\">systemctl reload nfs-server</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹ nfs æœåŠ¡çŠ¶æ€</span></span><br><span class=\"line\">systemctl status nfs-server</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹ nfs æœåŠ¡ç›‘å¬çš„ç«¯å£ï¼Œé»˜è®¤ä¸º 2049</span></span><br><span class=\"line\">$ rpcinfo -p | grep nfs</span><br><span class=\"line\">    100003    3   tcp   2049  nfs</span><br><span class=\"line\">    100003    4   tcp   2049  nfs</span><br><span class=\"line\">    100227    3   tcp   2049  nfs_acl</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ£€æŸ¥å¯¼å‡ºçš„å…±äº«ç›®å½•</span></span><br><span class=\"line\">$ exportfs -v</span><br><span class=\"line\">/nfs-server/data</span><br><span class=\"line\">                &lt;world&gt;(<span class=\"built_in\">sync</span>,wdelay,hide,no_subtree_check,sec=sys,rw,insecure,no_root_squash,no_all_squash)</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h3 id=\"å¼€æ”¾ç«¯å£\">å¼€æ”¾ç«¯å£</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æŸ¥çœ‹å½“å‰ä½¿ç”¨çš„ç«¯å£</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ rpcinfo -p 10.211.55.88</span><br><span class=\"line\">   program vers proto   port  service</span><br><span class=\"line\">    100000    4   tcp    111  portmapper</span><br><span class=\"line\">    100000    3   tcp    111  portmapper</span><br><span class=\"line\">    100000    2   tcp    111  portmapper</span><br><span class=\"line\">    100000    4   udp    111  portmapper</span><br><span class=\"line\">    100000    3   udp    111  portmapper</span><br><span class=\"line\">    100000    2   udp    111  portmapper</span><br><span class=\"line\">    100024    1   udp  36578  status</span><br><span class=\"line\">    100024    1   tcp  46973  status</span><br><span class=\"line\">    100005    1   udp  20048  mountd</span><br><span class=\"line\">    100005    1   tcp  20048  mountd</span><br><span class=\"line\">    100005    2   udp  20048  mountd</span><br><span class=\"line\">    100005    2   tcp  20048  mountd</span><br><span class=\"line\">    100005    3   udp  20048  mountd</span><br><span class=\"line\">    100005    3   tcp  20048  mountd</span><br><span class=\"line\">    100003    3   tcp   2049  nfs</span><br><span class=\"line\">    100003    4   tcp   2049  nfs</span><br><span class=\"line\">    100227    3   tcp   2049  nfs_acl</span><br><span class=\"line\">    100021    1   udp  36529  nlockmgr</span><br><span class=\"line\">    100021    3   udp  36529  nlockmgr</span><br><span class=\"line\">    100021    4   udp  36529  nlockmgr</span><br><span class=\"line\">    100021    1   tcp  45917  nlockmgr</span><br><span class=\"line\">    100021    3   tcp  45917  nlockmgr</span><br><span class=\"line\">    100021    4   tcp  45917  nlockmgr</span><br></pre></td></tr></table></figure>\n<table>\n<thead>\n<tr>\n<th>Program (ç¼–å·)</th>\n<th>æœåŠ¡åç§°</th>\n<th>ç”¨é€”</th>\n<th>ç«¯å£</th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>100000</code></td>\n<td>portmapper</td>\n<td>RPC æœåŠ¡æ³¨å†Œè¡¨</td>\n<td>111/tcp, 111/udp</td>\n<td><strong>å¿…é¡»å¼€æ”¾</strong>ï¼Œå®¢æˆ·ç«¯é€šè¿‡å®ƒæŸ¥æ‰¾å…¶å®ƒæœåŠ¡ç«¯å£</td>\n</tr>\n<tr>\n<td><code>100024</code></td>\n<td>status (rpc.statd)</td>\n<td>æ–‡ä»¶é”å®šçŠ¶æ€ç®¡ç†</td>\n<td>36578/udp, 46973/tcp</td>\n<td>å¸¸é…åˆ nlockmgr ä½¿ç”¨ï¼Œéå¿…éœ€</td>\n</tr>\n<tr>\n<td><code>100005</code></td>\n<td>mountd</td>\n<td>æŒ‚è½½æœåŠ¡</td>\n<td>20048/tcp, 20048/udp</td>\n<td><strong>æŒ‚è½½æ—¶å¿…éœ€</strong></td>\n</tr>\n<tr>\n<td><code>100003</code></td>\n<td>nfs</td>\n<td>NFS ä¸»æœåŠ¡</td>\n<td>2049/tcp</td>\n<td><strong>æ ¸å¿ƒæœåŠ¡ï¼Œå¿…éœ€</strong></td>\n</tr>\n<tr>\n<td><code>100227</code></td>\n<td>nfs_acl</td>\n<td>NFS çš„ ACL æƒé™æ§åˆ¶</td>\n<td>2049/tcp</td>\n<td>é€šå¸¸ä¸ nfs ä¸€èµ·</td>\n</tr>\n<tr>\n<td><code>100021</code></td>\n<td>nlockmgr</td>\n<td>æ–‡ä»¶é”ç®¡ç†</td>\n<td>36529/udp, 45917/tcp</td>\n<td>Stateful åº”ç”¨æ¶‰åŠæ–‡ä»¶é”æ—¶éœ€è¦</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ€å°ç«¯å£è¦æ±‚ï¼ˆåŸºæœ¬æŒ‚è½½ç”¨ï¼‰</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>åœºæ™¯</th>\n<th>éœ€è¦å¼€æ”¾çš„ç«¯å£</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>âœ… <strong>åŸºæœ¬ NFS æŒ‚è½½è¯»å†™</strong></td>\n<td><code>2049/tcp</code> + <code>111/tcp/udp</code></td>\n</tr>\n<tr>\n<td>âœ… <strong>å®¹å™¨æˆ– K8s æŒ‚è½½</strong></td>\n<td>åŒä¸Šï¼Œä¸€èˆ¬è¿˜æ¨è <code>20048/tcp/udp</code></td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¼€æ”¾å¿…é¡»ç«¯å£</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">firewall-cmd --permanent --add-port=2049/tcp</span><br><span class=\"line\">firewall-cmd --permanent --add-port=111/tcp</span><br><span class=\"line\">firewall-cmd --permanent --add-port=111/udp</span><br><span class=\"line\">firewall-cmd --permanent --add-port=20048/tcp</span><br><span class=\"line\">firewall-cmd --permanent --add-port=20048/udp</span><br><span class=\"line\">firewall-cmd --reload</span><br></pre></td></tr></table></figure>\n<h2 id=\"NFS-å®‰è£…ï¼šå®¢æˆ·ç«¯\">NFS å®‰è£…ï¼šå®¢æˆ·ç«¯</h2>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å®‰è£… nfs-utils å’Œ rpcbindï¼Œå®‰è£…åä¸éœ€è¦å¯åŠ¨ nfs-server æœåŠ¡ï¼Œåªéœ€è¦å¯åŠ¨ rpcbind æœåŠ¡ï¼Œæ‰€æœ‰å®¢æˆ·ç«¯éƒ½è¦è¿è¡Œ</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> dnf install rpcbind nfs-utils -y</span><br><span class=\"line\"><span class=\"built_in\">sudo</span> systemctl start rpcbind &amp;&amp; systemctl <span class=\"built_in\">enable</span> rpcbind</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹æœåŠ¡å™¨çš„å…±äº«èµ„æºåˆ—è¡¨</span></span><br><span class=\"line\"><span class=\"comment\"># showmount -e &lt;nfs-server-ip&gt;</span></span><br><span class=\"line\">$ showmount -e 10.211.55.88</span><br><span class=\"line\">Export list <span class=\"keyword\">for</span> 10.211.55.88:</span><br><span class=\"line\">/nfs-server/data *</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åˆ›å»º å®¢æˆ·ç«¯æŒ‚è½½ç›®å½•</span></span><br><span class=\"line\"><span class=\"built_in\">mkdir</span> -p /nfs/data</span><br><span class=\"line\"><span class=\"comment\"># æŒ‚è½½</span></span><br><span class=\"line\">mount -t nfs 10.211.55.88:/nfs-server/data /nfs/data</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹æŒ‚è½½ç‚¹</span></span><br><span class=\"line\">$ mount | grep nfs/data</span><br><span class=\"line\">10.211.55.88:/nfs-server/data on /nfs/data <span class=\"built_in\">type</span> nfs4 (rw,relatime,vers=4.2,rsize=524288,wsize=524288,namlen=255,hard,proto=tcp,timeo=600,retrans=2,sec=sys,clientaddr=10.211.55.11,local_lock=none,addr=10.211.55.88)</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹æŒ‚è½½ç‚¹ä¿¡æ¯ï¼Œè¿™ç§æ–¹å¼æ›´å‹å¥½</span></span><br><span class=\"line\">$ <span class=\"built_in\">df</span> -t nfs4</span><br><span class=\"line\">Filesystem                    1K-blocks    Used Available Use% Mounted on</span><br><span class=\"line\">10.211.55.88:/nfs-server/data  42872832 3630080  39242752   9% /nfs/data</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># é…ç½®è‡ªåŠ¨æŒ‚è½½</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;10.211.55.88:/nfs-server/data /nfs/data nfs defaults 0 0&quot;</span> &gt;&gt; /etc/fstab</span><br><span class=\"line\"><span class=\"comment\"># æ ¹æ® /etc/fstab æ–‡ä»¶çš„é…ç½®ï¼Œå°è¯•æŒ‚è½½æ‰€æœ‰æœªæŒ‚è½½çš„æ–‡ä»¶ç³»ç»Ÿã€‚ä¿®æ”¹ /etc/fstab åæ‰§è¡Œ mount -a ç«‹å³ç”Ÿæ•ˆ</span></span><br><span class=\"line\">mount -a</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å®¢æˆ·ç«¯æŒ‚è½½çš„ç›®å½•ä¸èƒ½åˆ é™¤ï¼Œéœ€è¦å…ˆå¸è½½</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># -f å¼ºåˆ¶å¸è½½</span></span><br><span class=\"line\">umount -f /nfs/data</span><br><span class=\"line\"></span><br><span class=\"line\">vim /etc/fstab</span><br><span class=\"line\"><span class=\"comment\"># åˆ é™¤æˆ–æ³¨é‡Šæ‰å¯¹åº”çš„ NFS æŒ‚è½½è¡Œ</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">rm</span> -rf /nfs/data</span><br></pre></td></tr></table></figure>","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» linux ä¸‹ nfs æ–‡ä»¶ç³»ç»Ÿçš„å®‰è£…ä¸ä½¿ç”¨ æœ¬æ–‡åŸºäºCentOS8(x86_64) NFS ç®€ä»‹ NFSï¼ˆç½‘ç»œæ–‡ä»¶ç³»ç»Ÿï¼ŒNetwork File Systemï¼‰æ˜¯ä¸€ä¸ªé€šè¿‡ç½‘ç»œå…±äº«æ–‡ä»¶çš„åè®®ï¼Œå…è®¸ä¸åŒæœåŠ¡å™¨æˆ–å®¢æˆ·ç«¯åƒæŒ‚è½½æœ¬åœ°ç£ç›˜ä¸€æ ·è®¿é—®è¿œç«¯çš„å…±äº«æ–‡ä»¶ç›®å½•ã€‚ å‡†å¤‡ä¸€å°æœåŠ¡å™¨ 12345678910111213141516# è®¾ç½® hostnamehostnamectl set-hostname nfs-server# æŸ¥çœ‹ç½‘å¡ip a# è®¾ç½®IP åˆ†é…æ–¹å¼ï¼Œmanual: æ‰‹åŠ¨æŒ‡å®šIPï¼Œauto: DHCPè‡ªåŠ¨è·å–ï¼Œdisabled: å…³é—­IPnmcli con mod enp0s5 ipv4.method manual# è®¾ç½® IPnmcli con mod enp0s5 ipv4.addresses 10.211.55.88/24# è®¾ç½® gatewaynmcli con mod enp0s5 ipv4.gateway 10.211.55.1# è®¾ç½® dnsnmcli con mod enp0s5 ipv4.dns &quot;10.211.55.1,8.8.8.8&quot;# é‡æ–°å¯åŠ¨ç½‘å¡nmcli con up enp0s5 NFS å®‰è£…ï¼šæœåŠ¡ç«¯ 1234567891011121314151617181920212223242526272829303132333435363738# å®‰è£… nfs-utils å’Œ rpcbinddnf install rpcbind nfs-utils -y# åˆ›å»º nfs-server å­˜å‚¨ç›®å½•mkdir -p /nfs-server/data# é…ç½® nfs-serverï¼Œå¯ä»¥æ·»åŠ å¤šä¸ªç›®å½•echo &quot;/nfs-server/data *(insecure,rw,sync,no_root_squash,no_all_squash)&quot; &gt;&gt; /etc/exports## é…ç½®é¡¹è¯´æ˜# * ï¼šå…è®¸æ‰€æœ‰å®¢æˆ·ç«¯è®¿é—®ï¼Œä¹Ÿå¯ä»¥æŒ‡å®šå…·ä½“çš„å®¢æˆ·ç«¯ IP åœ°å€ï¼Œæ¯”å¦‚ï¼š192.168.0.0/24(rw,sync,no_root_squash,no_all_squash)# insecure ï¼šå…è®¸ä»»æ„ç«¯å£ï¼ˆå…¼å®¹æ€§å¥½,æ”¯æŒk8sï¼‰ï¼Œé»˜è®¤å€¼æ˜¯ secureï¼šåªå…è®¸ 1024 ä»¥ä¸‹ç«¯å£ï¼Œé€‚åˆä¼ ç»ŸæœåŠ¡å™¨# rw ï¼šè¯»å†™æƒé™ï¼Œroï¼šåªè¯»æƒé™# sync ï¼šåŒæ­¥æ¨¡å¼ï¼Œå¼ºä¸€è‡´æ€§ï¼Œasyncï¼šå¼‚æ­¥æ¨¡å¼ï¼Œæ€§èƒ½é«˜ï¼Œä½†å­˜åœ¨ä¸¢æ•°æ®é£é™©# no_root_squash ï¼šå…è®¸ root ç”¨æˆ·è®¿é—®ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œroot ç”¨æˆ·è®¿é—®æ—¶ä¼šè¢«è½¬æ¢æˆ nobody ç”¨æˆ·# no_all_squash ï¼šå…è®¸æ‰€æœ‰ç”¨æˆ·è®¿é—®ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰€æœ‰ç”¨æˆ·è®¿é—®æ—¶ä¼šè¢«è½¬æ¢æˆ nobody ç”¨æˆ·ï¼Œé»˜è®¤å°±æ˜¯è¿™ä¸ªï¼Œå¯ä»¥çœç•¥ã€‚# å¯åŠ¨ rpcbindã€nfs æœåŠ¡systemctl start rpcbind &amp;&amp; systemctl start nfs-server# å¼€æœºè‡ªå¯åŠ¨systemctl enable rpcbind &amp;&amp; systemctl enable nfs-server# ä¿®æ”¹é…ç½®æ–‡ä»¶ /etc/exportsï¼Œéœ€è¦é‡è½½ nfs é…ç½®systemctl reload nfs-server# æŸ¥çœ‹ nfs æœåŠ¡çŠ¶æ€systemctl status nfs-server# æŸ¥çœ‹ nfs æœåŠ¡ç›‘å¬çš„ç«¯å£ï¼Œé»˜è®¤ä¸º 2049$ rpcinfo -p | grep nfs 100003 3 tcp 2049 nfs 100003 4 tcp 2049 nfs 100227 3 tcp 2049 nfs_acl# æ£€æŸ¥å¯¼å‡ºçš„å…±äº«ç›®å½•$ exportfs -v/nfs-server/data &lt;world&gt;(sync,wdelay,hide,no_subtree_check,sec=sys,rw,insecure,no_root_squash,no_all_squash) å¼€æ”¾ç«¯å£ æŸ¥çœ‹å½“å‰ä½¿ç”¨çš„ç«¯å£ 12345678910111213141516171819202122232425$ rpcinfo -p 10.211.55.88 program vers proto port service 100000 4 tcp 111 portmapper 100000 3 tcp 111 portmapper 100000 2 tcp 111 portmapper 100000 4 udp 111 portmapper 100000 3 udp 111 portmapper 100000 2 udp 111 portmapper 100024 1 udp 36578 status 100024 1 tcp 46973 status 100005 1 udp 20048 mountd 100005 1 tcp 20048 mountd 100005 2 udp 20048 mountd 100005 2 tcp 20048 mountd 100005 3 udp 20048 mountd 100005 3 tcp 20048 mountd 100003 3 tcp 2049 nfs 100003 4 tcp 2049 nfs 100227 3 tcp 2049 nfs_acl 100021 1 udp 36529 nlockmgr 100021 3 udp 36529 nlockmgr 100021 4 udp 36529 nlockmgr 100021 1 tcp 45917 nlockmgr 100021 3 tcp 45917 nlockmgr 100021 4 tcp 45917 nlockmgr Program (ç¼–å·) æœåŠ¡åç§° ç”¨é€” ç«¯å£ è¯´æ˜ 100000 portmapper RPC æœåŠ¡æ³¨å†Œè¡¨ 111/tcp, 111/udp å¿…é¡»å¼€æ”¾ï¼Œå®¢æˆ·ç«¯é€šè¿‡å®ƒæŸ¥æ‰¾å…¶å®ƒæœåŠ¡ç«¯å£ 100024 status (rpc.statd) æ–‡ä»¶é”å®šçŠ¶æ€ç®¡ç† 36578/udp, 46973/tcp å¸¸é…åˆ nlockmgr ä½¿ç”¨ï¼Œéå¿…éœ€ 100005 mountd æŒ‚è½½æœåŠ¡ 20048/tcp, 20048/udp æŒ‚è½½æ—¶å¿…éœ€ 100003 nfs NFS ä¸»æœåŠ¡ 2049/tcp æ ¸å¿ƒæœåŠ¡ï¼Œå¿…éœ€ 100227 nfs_acl NFS çš„ ACL æƒé™æ§åˆ¶ 2049/tcp é€šå¸¸ä¸ nfs ä¸€èµ· 100021 nlockmgr æ–‡ä»¶é”ç®¡ç† 36529/udp, 45917/tcp Stateful åº”ç”¨æ¶‰åŠæ–‡ä»¶é”æ—¶éœ€è¦ æœ€å°ç«¯å£è¦æ±‚ï¼ˆåŸºæœ¬æŒ‚è½½ç”¨ï¼‰ åœºæ™¯ éœ€è¦å¼€æ”¾çš„ç«¯å£ âœ… åŸºæœ¬ NFS æŒ‚è½½è¯»å†™ 2049/tcp + 111/tcp/udp âœ… å®¹å™¨æˆ– K8s æŒ‚è½½ åŒä¸Šï¼Œä¸€èˆ¬è¿˜æ¨è 20048/tcp/udp å¼€æ”¾å¿…é¡»ç«¯å£ 123456firewall-cmd --permanent --add-port=2049/tcpfirewall-cmd --permanent --add-port=111/tcpfirewall-cmd --permanent --add-port=111/udpfirewall-cmd --permanent --add-port=20048/tcpfirewall-cmd --permanent --add-port=20048/udpfirewall-cmd --reload NFS å®‰è£…ï¼šå®¢æˆ·ç«¯ 123456789101112131415161718192021222324252627# å®‰è£… nfs-utils å’Œ rpcbindï¼Œå®‰è£…åä¸éœ€è¦å¯åŠ¨ nfs-server æœåŠ¡ï¼Œåªéœ€è¦å¯åŠ¨ rpcbind æœåŠ¡ï¼Œæ‰€æœ‰å®¢æˆ·ç«¯éƒ½è¦è¿è¡Œsudo dnf install rpcbind nfs-utils -ysudo systemctl start rpcbind &amp;&amp; systemctl enable rpcbind# æŸ¥çœ‹æœåŠ¡å™¨çš„å…±äº«èµ„æºåˆ—è¡¨# showmount -e &lt;nfs-server-ip&gt;$ showmount -e 10.211.55.88Export list for 10.211.55.88:/nfs-server/data *# åˆ›å»º å®¢æˆ·ç«¯æŒ‚è½½ç›®å½•mkdir -p /nfs/data# æŒ‚è½½mount -t nfs 10.211.55.88:/nfs-server/data /nfs/data# æŸ¥çœ‹æŒ‚è½½ç‚¹$ mount | grep nfs/data10.211.55.88:/nfs-server/data on /nfs/data type nfs4 (rw,relatime,vers=4.2,rsize=524288,wsize=524288,namlen=255,hard,proto=tcp,timeo=600,retrans=2,sec=sys,clientaddr=10.211.55.11,local_lock=none,addr=10.211.55.88)# æŸ¥çœ‹æŒ‚è½½ç‚¹ä¿¡æ¯ï¼Œè¿™ç§æ–¹å¼æ›´å‹å¥½$ df -t nfs4Filesystem 1K-blocks Used Available Use% Mounted on10.211.55.88:/nfs-server/data 42872832 3630080 39242752 9% /nfs/data# é…ç½®è‡ªåŠ¨æŒ‚è½½echo &quot;10.211.55.88:/nfs-server/data /nfs/data nfs defaults 0 0&quot; &gt;&gt; /etc/fstab# æ ¹æ® /etc/fstab æ–‡ä»¶çš„é…ç½®ï¼Œå°è¯•æŒ‚è½½æ‰€æœ‰æœªæŒ‚è½½çš„æ–‡ä»¶ç³»ç»Ÿã€‚ä¿®æ”¹ /etc/fstab åæ‰§è¡Œ mount -a ç«‹å³ç”Ÿæ•ˆmount -a å®¢æˆ·ç«¯æŒ‚è½½çš„ç›®å½•ä¸èƒ½åˆ é™¤ï¼Œéœ€è¦å…ˆå¸è½½ 1234567# -f å¼ºåˆ¶å¸è½½umount -f /nfs/datavim /etc/fstab# åˆ é™¤æˆ–æ³¨é‡Šæ‰å¯¹åº”çš„ NFS æŒ‚è½½è¡Œrm -rf /nfs/data","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» linux ä¸‹ nfs æ–‡ä»¶ç³»ç»Ÿçš„å®‰è£…ä¸ä½¿ç”¨ æœ¬æ–‡åŸºäºCentOS8(x86_64)","date_published":"2025-07-21T15:34:05.000Z","tags":["æŠ€æœ¯","linux","nfs","linux","nfs"]},{"id":"https://blog.hanqunfeng.com/2025/07/21/k8s-storage-hostpath/","url":"https://blog.hanqunfeng.com/2025/07/21/k8s-storage-hostpath/","title":"K8S ä¹‹ å­˜å‚¨å· hostPath","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç» K8S çš„ å­˜å‚¨å· hostPath ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://kubernetes.io/zh-cn/\">K8Så®˜ç½‘</a></p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://github.com/kubernetes/kubernetes\">k8s Github</a></p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"å­˜å‚¨å·-hostPath-ä»‹ç»\">å­˜å‚¨å· hostPath ä»‹ç»</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>hostPath æ˜¯ä¸€ç§ç›´æ¥æŠŠ Node èŠ‚ç‚¹æœ¬åœ°æ–‡ä»¶æˆ–ç›®å½• æŒ‚è½½åˆ° Pod å®¹å™¨é‡Œçš„å­˜å‚¨å·ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å®¹æ˜“ç ´åèŠ‚ç‚¹ç¯å¢ƒï¼Œä¸å»ºè®®ç”Ÿäº§ä½¿ç”¨</p>\n</li>\n<li class=\"lvl-2\">\n<p>åŒä¸€ä¸ª Deployment çš„å¤šä¸ª Pod è¢«è°ƒåº¦åˆ°åŒä¸€ä¸ªèŠ‚ç‚¹ï¼Œå¹¶ä¸”å®ƒä»¬çš„ hostPath é…ç½®æŒ‡å‘ç›¸åŒçš„å®¿ä¸»æœºè·¯å¾„ï¼Œè¿™äº› Pod ä¹‹é—´æ˜¯å¯ä»¥å…±äº«è¯¥ç›®å½•ä¸­æ–‡ä»¶çš„ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å…¸å‹ä½¿ç”¨åœºæ™¯</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>åœºæ™¯</th>\n<th>ç¤ºä¾‹</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>æ—¥å¿—æ”¶é›†</td>\n<td>æŒ‚è½½ <code>/var/log</code> åˆ° Pod å†…éƒ¨</td>\n</tr>\n<tr>\n<td>æŒ‚è½½å®¿ä¸»æœºé…ç½®æ–‡ä»¶</td>\n<td>å¦‚æŒ‚è½½ <code>/etc/hosts</code>ã€<code>/etc/localtime</code></td>\n</tr>\n<tr>\n<td>ä½¿ç”¨å®¿ä¸»æœº docker.sock</td>\n<td>æŒ‚è½½ <code>/var/run/docker.sock</code> è¿è¡Œ Docker-in-Docker</td>\n</tr>\n<tr>\n<td>å­˜å‚¨è°ƒè¯•ä¸´æ—¶æ–‡ä»¶</td>\n<td>Pod è°ƒè¯•æ—¶è®¿é—®å®¿ä¸»æœºç‰¹å®šç›®å½•</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"ç¤ºä¾‹\">ç¤ºä¾‹</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Pod å†…éƒ¨ /mnt/hostdata æ˜ å°„åˆ°å®¿ä¸»æœº /data ç›®å½•</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Pod</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">hostpath-example</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">containers:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">busybox</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">busybox</span></span><br><span class=\"line\">    <span class=\"attr\">command:</span> [<span class=\"string\">&quot;sh&quot;</span>, <span class=\"string\">&quot;-c&quot;</span>, <span class=\"string\">&quot;sleep 3600&quot;</span>]</span><br><span class=\"line\">    <span class=\"attr\">volumeMounts:</span>                   <span class=\"comment\"># å­˜å‚¨å·æŒ‚è½½ç‚¹</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">mountPath:</span> <span class=\"string\">/mnt/hostdata</span>      <span class=\"comment\"># æŒ‚è½½ç‚¹è·¯å¾„ï¼ŒæŒ‚è½½åˆ°å®¹å™¨çš„ /mnt/hostdata ç›®å½•</span></span><br><span class=\"line\">      <span class=\"attr\">name:</span> <span class=\"string\">myvolume</span>                <span class=\"comment\"># å­˜å‚¨å·åç§° ï¼Œä¸ volumes ä¸­å®šä¹‰çš„ volume é…ç½®åç§°ä¸€è‡´</span></span><br><span class=\"line\">  <span class=\"attr\">volumes:</span>                          <span class=\"comment\"># å­˜å‚¨å·å£°æ˜</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">myvolume</span>                  <span class=\"comment\"># å­˜å‚¨å·åç§°</span></span><br><span class=\"line\">    <span class=\"attr\">hostPath:</span>                       <span class=\"comment\"># å­˜å‚¨å·ç±»å‹ï¼Œè¿™é‡Œæ˜¯ hostPath</span></span><br><span class=\"line\">      <span class=\"attr\">path:</span> <span class=\"string\">/data</span>                   <span class=\"comment\"># ä¸»æœºç›®å½•</span></span><br><span class=\"line\">      <span class=\"attr\">type:</span> <span class=\"string\">Directory</span>               <span class=\"comment\"># å¯é€‰å­—æ®µï¼Œä¸»è¦ç”¨äºæŒ‚è½½å‰éªŒè¯</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><code>hostPath.type</code> å¯ä»¥é…ç½®çš„å€¼å¦‚ä¸‹ï¼Œé»˜è®¤ä¸º ç©ºã€‚</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>type</th>\n<th>å«ä¹‰</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>DirectoryOrCreate</code></td>\n<td>å¦‚æœ <code>/data</code> ä¸å­˜åœ¨åˆ™è‡ªåŠ¨åˆ›å»º ï¼Œæƒé™ä¸º 0755</td>\n</tr>\n<tr>\n<td><code>Directory</code></td>\n<td>å¿…é¡»å­˜åœ¨ä¸”ä¸ºç›®å½•</td>\n</tr>\n<tr>\n<td><code>File</code></td>\n<td>å¿…é¡»å­˜åœ¨ä¸”ä¸ºæ–‡ä»¶</td>\n</tr>\n<tr>\n<td><code>Socket</code></td>\n<td>å¿…é¡»æ˜¯ socket</td>\n</tr>\n<tr>\n<td><code>CharDevice</code></td>\n<td>å­—ç¬¦è®¾å¤‡</td>\n</tr>\n<tr>\n<td><code>BlockDevice</code></td>\n<td>å—è®¾å¤‡</td>\n</tr>\n<tr>\n<td><code>FileOrCreate</code></td>\n<td>ä¸å­˜åœ¨åˆ™è‡ªåŠ¨åˆ›å»ºç©ºæ–‡ä»¶ï¼Œæƒé™è®¾ç½®ä¸º 0644</td>\n</tr>\n<tr>\n<td><code>ä¸è®¾ç½®</code></td>\n<td>é»˜è®¤å€¼æ˜¯ç©ºï¼Œä¸»æœºä¸Šçš„è·¯å¾„æ— è®ºæ˜¯æ–‡ä»¶ã€ç›®å½•ã€ç”šè‡³ä¸å­˜åœ¨ï¼Œéƒ½ä¼šç›´æ¥æŒ‚è½½ ,å®¹æ˜“å¼•èµ·é¢„æœŸä¹‹å¤–çš„æŒ‚è½½é—®é¢˜</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Kubernetes åœ¨åˆ é™¤ Pod æ—¶ï¼Œä¸ä¼šåˆ é™¤ hostPath æ‰€æŒ‚è½½çš„å®¿ä¸»æœºç›®å½•æˆ–æ–‡ä»¶</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>å­˜å‚¨å·ç±»å‹</th>\n<th>åˆ é™¤ Pod åç›®å½•ä¼šè¢«åˆ é™¤å—ï¼Ÿ</th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>emptyDir</code></td>\n<td>âœ… <strong>ä¼šè¢«åˆ é™¤</strong></td>\n<td>ä¸´æ—¶ç›®å½•ï¼ŒPod ç”Ÿå‘½å‘¨æœŸç»“æŸè‡ªåŠ¨æ¸…ç†</td>\n</tr>\n<tr>\n<td><code>hostPath</code></td>\n<td>âŒ <strong>ä¸ä¼šåˆ é™¤</strong></td>\n<td>å®¿ä¸»æœºè·¯å¾„ç‹¬ç«‹äº Pod ç”Ÿå‘½å‘¨æœŸï¼Œ<strong>ä¸ä¼šæ¸…ç†</strong></td>\n</tr>\n</tbody>\n</table>\n","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» K8S çš„ å­˜å‚¨å· hostPath ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚ K8Så®˜ç½‘ k8s Github å­˜å‚¨å· hostPath ä»‹ç» hostPath æ˜¯ä¸€ç§ç›´æ¥æŠŠ Node èŠ‚ç‚¹æœ¬åœ°æ–‡ä»¶æˆ–ç›®å½• æŒ‚è½½åˆ° Pod å®¹å™¨é‡Œçš„å­˜å‚¨å·ã€‚ å®¹æ˜“ç ´åèŠ‚ç‚¹ç¯å¢ƒï¼Œä¸å»ºè®®ç”Ÿäº§ä½¿ç”¨ åŒä¸€ä¸ª Deployment çš„å¤šä¸ª Pod è¢«è°ƒåº¦åˆ°åŒä¸€ä¸ªèŠ‚ç‚¹ï¼Œå¹¶ä¸”å®ƒä»¬çš„ hostPath é…ç½®æŒ‡å‘ç›¸åŒçš„å®¿ä¸»æœºè·¯å¾„ï¼Œè¿™äº› Pod ä¹‹é—´æ˜¯å¯ä»¥å…±äº«è¯¥ç›®å½•ä¸­æ–‡ä»¶çš„ã€‚ å…¸å‹ä½¿ç”¨åœºæ™¯ åœºæ™¯ ç¤ºä¾‹ æ—¥å¿—æ”¶é›† æŒ‚è½½ /var/log åˆ° Pod å†…éƒ¨ æŒ‚è½½å®¿ä¸»æœºé…ç½®æ–‡ä»¶ å¦‚æŒ‚è½½ /etc/hostsã€/etc/localtime ä½¿ç”¨å®¿ä¸»æœº docker.sock æŒ‚è½½ /var/run/docker.sock è¿è¡Œ Docker-in-Docker å­˜å‚¨è°ƒè¯•ä¸´æ—¶æ–‡ä»¶ Pod è°ƒè¯•æ—¶è®¿é—®å®¿ä¸»æœºç‰¹å®šç›®å½• ç¤ºä¾‹ Pod å†…éƒ¨ /mnt/hostdata æ˜ å°„åˆ°å®¿ä¸»æœº /data ç›®å½• 1234567891011121314151617apiVersion: v1kind: Podmetadata: name: hostpath-examplespec: containers: - name: busybox image: busybox command: [&quot;sh&quot;, &quot;-c&quot;, &quot;sleep 3600&quot;] volumeMounts: # å­˜å‚¨å·æŒ‚è½½ç‚¹ - mountPath: /mnt/hostdata # æŒ‚è½½ç‚¹è·¯å¾„ï¼ŒæŒ‚è½½åˆ°å®¹å™¨çš„ /mnt/hostdata ç›®å½• name: myvolume # å­˜å‚¨å·åç§° ï¼Œä¸ volumes ä¸­å®šä¹‰çš„ volume é…ç½®åç§°ä¸€è‡´ volumes: # å­˜å‚¨å·å£°æ˜ - name: myvolume # å­˜å‚¨å·åç§° hostPath: # å­˜å‚¨å·ç±»å‹ï¼Œè¿™é‡Œæ˜¯ hostPath path: /data # ä¸»æœºç›®å½• type: Directory # å¯é€‰å­—æ®µï¼Œä¸»è¦ç”¨äºæŒ‚è½½å‰éªŒè¯ hostPath.type å¯ä»¥é…ç½®çš„å€¼å¦‚ä¸‹ï¼Œé»˜è®¤ä¸º ç©ºã€‚ type å«ä¹‰ DirectoryOrCreate å¦‚æœ /data ä¸å­˜åœ¨åˆ™è‡ªåŠ¨åˆ›å»º ï¼Œæƒé™ä¸º 0755 Directory å¿…é¡»å­˜åœ¨ä¸”ä¸ºç›®å½• File å¿…é¡»å­˜åœ¨ä¸”ä¸ºæ–‡ä»¶ Socket å¿…é¡»æ˜¯ socket CharDevice å­—ç¬¦è®¾å¤‡ BlockDevice å—è®¾å¤‡ FileOrCreate ä¸å­˜åœ¨åˆ™è‡ªåŠ¨åˆ›å»ºç©ºæ–‡ä»¶ï¼Œæƒé™è®¾ç½®ä¸º 0644 ä¸è®¾ç½® é»˜è®¤å€¼æ˜¯ç©ºï¼Œä¸»æœºä¸Šçš„è·¯å¾„æ— è®ºæ˜¯æ–‡ä»¶ã€ç›®å½•ã€ç”šè‡³ä¸å­˜åœ¨ï¼Œéƒ½ä¼šç›´æ¥æŒ‚è½½ ,å®¹æ˜“å¼•èµ·é¢„æœŸä¹‹å¤–çš„æŒ‚è½½é—®é¢˜ Kubernetes åœ¨åˆ é™¤ Pod æ—¶ï¼Œä¸ä¼šåˆ é™¤ hostPath æ‰€æŒ‚è½½çš„å®¿ä¸»æœºç›®å½•æˆ–æ–‡ä»¶ å­˜å‚¨å·ç±»å‹ åˆ é™¤ Pod åç›®å½•ä¼šè¢«åˆ é™¤å—ï¼Ÿ è¯´æ˜ emptyDir âœ… ä¼šè¢«åˆ é™¤ ä¸´æ—¶ç›®å½•ï¼ŒPod ç”Ÿå‘½å‘¨æœŸç»“æŸè‡ªåŠ¨æ¸…ç† hostPath âŒ ä¸ä¼šåˆ é™¤ å®¿ä¸»æœºè·¯å¾„ç‹¬ç«‹äº Pod ç”Ÿå‘½å‘¨æœŸï¼Œä¸ä¼šæ¸…ç†","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» K8S çš„ å­˜å‚¨å· hostPath ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚ K8Så®˜ç½‘ k8s Github","date_published":"2025-07-21T15:33:05.000Z","tags":["æŠ€æœ¯","k8s","K8S"]},{"id":"https://blog.hanqunfeng.com/2025/07/21/k8s-storage-emptydir/","url":"https://blog.hanqunfeng.com/2025/07/21/k8s-storage-emptydir/","title":"K8S ä¹‹ å­˜å‚¨å· emptyDir","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç» K8S çš„ å­˜å‚¨å· emptyDir ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://kubernetes.io/zh-cn/\">K8Så®˜ç½‘</a></p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://github.com/kubernetes/kubernetes\">k8s Github</a></p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"å­˜å‚¨å·-emptyDir-ä»‹ç»\">å­˜å‚¨å· emptyDir ä»‹ç»</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>emptyDir æ˜¯ Kubernetes ä¸­æœ€ç®€å•çš„ä¸€ç§ Pod çº§åˆ«çš„ä¸´æ—¶å­˜å‚¨å·ã€‚å®ƒçš„æ ¸å¿ƒç‰¹ç‚¹æ˜¯ï¼šPod ç”Ÿå‘½å‘¨æœŸå†…å…±äº«ä¸´æ—¶å­˜å‚¨ï¼ŒPod åˆ é™¤åæ•°æ®è‡ªåŠ¨ä¸¢å¼ƒã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>åŒä¸€ä¸ª Pod å†…çš„å¤šä¸ªå®¹å™¨å¯ä»¥é€šè¿‡ emptyDir å…±äº«æ•°æ®ã€‚è·¨ Pod ä¸å…±äº«ï¼Œé€‚ç”¨äºä¸´æ—¶æ•°æ®ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>emptyDir åªèƒ½æŒ‚è½½ç›®å½•ã€‚</p>\n</li>\n</ul>\n<h2 id=\"ç¤ºä¾‹\">ç¤ºä¾‹</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¸¤ä¸ªå®¹å™¨ app å’Œ sidecar é€šè¿‡ /data å…±äº«ä¸€ä¸ª emptyDir å·ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># shared-emptydir-pod.yaml</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Pod</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">shared-emptydir-pod</span></span><br><span class=\"line\">  <span class=\"attr\">labels:</span></span><br><span class=\"line\">    <span class=\"attr\">app.sto:</span> <span class=\"string\">emptydir</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">containers:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">app</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">busybox</span></span><br><span class=\"line\">    <span class=\"attr\">command:</span> [<span class=\"string\">&quot;sh&quot;</span>, <span class=\"string\">&quot;-c&quot;</span>, <span class=\"string\">&quot;echo Hello &gt; /data1/hello; sleep 3600&quot;</span>]</span><br><span class=\"line\">    <span class=\"attr\">volumeMounts:</span>               <span class=\"comment\"># å­˜å‚¨å·æŒ‚è½½ç‚¹</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">shared-data</span>         <span class=\"comment\"># æŒ‚è½½ç‚¹åç§°ï¼Œä¸ä¸‹é¢ volumes ä¸­å®šä¹‰çš„ volume åç§°ä¸€è‡´</span></span><br><span class=\"line\">      <span class=\"attr\">mountPath:</span> <span class=\"string\">/data1</span>          <span class=\"comment\"># æŒ‚è½½ç‚¹è·¯å¾„ï¼ŒæŒ‚è½½åˆ°å®¹å™¨çš„ /data1 ç›®å½•</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">sidecar</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">busybox</span></span><br><span class=\"line\">    <span class=\"attr\">command:</span> [<span class=\"string\">&quot;sh&quot;</span>, <span class=\"string\">&quot;-c&quot;</span>, <span class=\"string\">&quot;sleep 3600&quot;</span>]</span><br><span class=\"line\">    <span class=\"attr\">volumeMounts:</span>               <span class=\"comment\"># å­˜å‚¨å·æŒ‚è½½ç‚¹</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">shared-data</span>         <span class=\"comment\"># æŒ‚è½½ç‚¹åç§°ï¼Œä¸ä¸Šé¢å®¹å™¨ä¸­çš„ volume é…ç½®åç§°ä¸€è‡´</span></span><br><span class=\"line\">      <span class=\"attr\">mountPath:</span> <span class=\"string\">/data2</span>         <span class=\"comment\"># æŒ‚è½½ç‚¹è·¯å¾„ï¼ŒæŒ‚è½½åˆ°å®¹å™¨çš„ /data2 ç›®å½•</span></span><br><span class=\"line\">  <span class=\"attr\">volumes:</span>                      <span class=\"comment\"># å­˜å‚¨å·å£°æ˜</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">shared-data</span>           <span class=\"comment\"># å­˜å‚¨å·åç§°</span></span><br><span class=\"line\">    <span class=\"attr\">emptyDir:</span> &#123;&#125;                <span class=\"comment\"># å£°æ˜ä¸º emptyDir å­˜å‚¨å·</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ›å»º</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">k apply -f shared-emptydir-pod.yaml</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹podæ‰€åœ¨èŠ‚ç‚¹</span></span><br><span class=\"line\">$ k get pod -l app.sto=emptydir</span><br><span class=\"line\">NAME                  READY   STATUS    RESTARTS   AGE   IP              NODE          NOMINATED NODE   READINESS GATES</span><br><span class=\"line\">shared-emptydir-pod   2/2     Running   0          22m   10.244.126.59   k8s-worker2   &lt;none&gt;           &lt;none&gt;</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹ pod-uid</span></span><br><span class=\"line\">$ kubectl get pod shared-emptydir-pod -o jsonpath=<span class=\"string\">&#x27;&#123;.metadata.uid&#125;&#x27;</span></span><br><span class=\"line\">d597b4d7-e6b6-4522-887e-73d3f4c01006</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>emptyDir å­˜å‚¨å· é»˜è®¤ä½¿ç”¨èŠ‚ç‚¹æœ¬åœ°ç£ç›˜ï¼Œè·¯å¾„ä¸º <code>/var/lib/kubelet/pods/&lt;pod-uid&gt;/volumes/kubernetes.io~empty-dir/&lt;volume-name&gt;</code></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ç™»å½• k8s-worker2 èŠ‚ç‚¹</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> POD_UID=d597b4d7-e6b6-4522-887e-73d3f4c01006</span><br><span class=\"line\"><span class=\"built_in\">export</span> POD_UID=6ea6636c-4a24-4dc5-af2a-2448825913b6</span><br><span class=\"line\"><span class=\"built_in\">export</span> VOLUME_NAME=shared-data</span><br><span class=\"line\"><span class=\"built_in\">cd</span> /var/lib/kubelet/pods/<span class=\"variable\">$POD_UID</span>/volumes/kubernetes.io~empty-dir/<span class=\"variable\">$VOLUME_NAME</span></span><br><span class=\"line\">$ <span class=\"built_in\">ls</span></span><br><span class=\"line\">hello</span><br><span class=\"line\">$ <span class=\"built_in\">cat</span> hello</span><br><span class=\"line\">Hello</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¿›å…¥å®¹å™¨æŸ¥çœ‹å­˜å‚¨å·å†…å®¹</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ kubectl <span class=\"built_in\">exec</span> -it shared-emptydir-pod -c app -- <span class=\"built_in\">cat</span> /data1/hello</span><br><span class=\"line\">Hello</span><br><span class=\"line\">$ kubectl <span class=\"built_in\">exec</span> -it shared-emptydir-pod -c sidecar -- <span class=\"built_in\">cat</span> /data2/hello</span><br><span class=\"line\">Hello</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ä¿®æ”¹å†…å®¹ï¼Œå®é™…ä¸Šåœ¨å®¹å™¨å†…éƒ¨å’Œå¤–éƒ¨éƒ½å¯ä»¥ä¿®æ”¹å­˜å‚¨å·å†…å®¹ï¼Œä¿®æ”¹åç«‹åˆ»ç”Ÿæ•ˆ</span></span><br><span class=\"line\">$ kubectl <span class=\"built_in\">exec</span> -it shared-emptydir-pod -c sidecar -- sh -c <span class=\"string\">&quot;echo &#x27;Hello World&#x27; &gt; /data2/hello&quot;</span></span><br><span class=\"line\">$ kubectl <span class=\"built_in\">exec</span> -it shared-emptydir-pod -c app -- <span class=\"built_in\">cat</span> /data1/hello</span><br><span class=\"line\">Hello World</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ é™¤PODåemptydirå­˜å‚¨å·ä¼šç«‹åˆ»åˆ é™¤</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl delete pod shared-emptydir-pod</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ç™»å½• k8s-worker2 èŠ‚ç‚¹æŸ¥çœ‹ emptydir å­˜å‚¨å·</span></span><br><span class=\"line\">$ <span class=\"built_in\">ls</span> /var/lib/kubelet/pods/<span class=\"variable\">$POD_UID</span></span><br><span class=\"line\"><span class=\"built_in\">ls</span>: cannot access <span class=\"string\">&#x27;/var/lib/kubelet/pods/d597b4d7-e6b6-4522-887e-73d3f4c01006&#x27;</span>: No such file or directory</span><br></pre></td></tr></table></figure>\n<h2 id=\"å°†-emptydir-å­˜å‚¨å·æ”¹ç”¨-å†…å­˜-å­˜å‚¨\">å°† emptydir å­˜å‚¨å·æ”¹ç”¨ å†…å­˜ å­˜å‚¨</h2>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">emptyDir:</span></span><br><span class=\"line\">  <span class=\"attr\">medium:</span> <span class=\"string\">Memory</span>        <span class=\"comment\"># ä½¿ç”¨ å†…å­˜ å­˜å‚¨ï¼ˆtmpfsï¼‰ï¼Œé€‚åˆé«˜ IO ä¸´æ—¶ç¼“å­˜</span></span><br><span class=\"line\">  <span class=\"attr\">sizeLimit:</span> <span class=\"string\">512Mi</span>      <span class=\"comment\"># é™åˆ¶å­˜å‚¨å¤§å°</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¿™é‡Œè¦æ³¨æ„ï¼Œå³ä½¿è¿™é‡Œä½¿ç”¨å†…å­˜å­˜å‚¨ï¼Œä½†æ˜¯ <code>/var/lib/kubelet/pods/&lt;pod-uid&gt;/volumes/kubernetes.io~empty-dir/&lt;volume-name&gt;</code> ä¾ç„¶å­˜åœ¨ï¼Œä½†å®ƒæŒ‚è½½çš„æ˜¯ tmpfs æ–‡ä»¶ç³»ç»Ÿ</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ç™»å½•podæ‰€åœ¨èŠ‚ç‚¹æŸ¥çœ‹æŒ‚è½½ç‚¹</span></span><br><span class=\"line\">$ mount | grep <span class=\"variable\">$POD_UID</span></span><br><span class=\"line\">tmpfs on /var/lib/kubelet/pods/6ea6636c-4a24-4dc5-af2a-2448825913b6/volumes/kubernetes.io~empty-dir/shared-data <span class=\"built_in\">type</span> tmpfs (rw,relatime,size=524288k)</span><br><span class=\"line\">tmpfs on /var/lib/kubelet/pods/6ea6636c-4a24-4dc5-af2a-2448825913b6/volumes/kubernetes.io~projected/kube-api-access-5nk7d <span class=\"built_in\">type</span> tmpfs (rw,relatime,size=3903212k)</span><br></pre></td></tr></table></figure>\n<table>\n<thead>\n<tr>\n<th>å·ç±»å‹</th>\n<th>æ¥æº</th>\n<th>æŒ‚è½½è·¯å¾„</th>\n<th>ä½œç”¨</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>emptyDir</td>\n<td>ä½ é…ç½®çš„</td>\n<td><code>/data1</code>, <code>/data2</code></td>\n<td>Pod å†…éƒ¨å®¹å™¨å…±äº«ä¸´æ—¶å†…å­˜å­˜å‚¨</td>\n</tr>\n<tr>\n<td>projected</td>\n<td>ç³»ç»Ÿè‡ªåŠ¨</td>\n<td><code>/var/run/secrets/kubernetes.io/serviceaccount/</code></td>\n<td>æŒ‚è½½ serviceaccount tokenï¼ŒCA è¯ä¹¦</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æŸ¥çœ‹å®¹å™¨å†…æŒ‚è½½ç‚¹</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ kubectl <span class=\"built_in\">exec</span> shared-emptydir-pod -c app -- mount | grep /data1</span><br><span class=\"line\">tmpfs on /data1 <span class=\"built_in\">type</span> tmpfs (rw,relatime,size=524288k)</span><br><span class=\"line\">$ kubectl <span class=\"built_in\">exec</span> shared-emptydir-pod -c app -- mount | grep serviceaccount</span><br><span class=\"line\">tmpfs on /var/run/secrets/kubernetes.io/serviceaccount <span class=\"built_in\">type</span> tmpfs (ro,relatime,size=3903212k)</span><br></pre></td></tr></table></figure>","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» K8S çš„ å­˜å‚¨å· emptyDir ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚ K8Så®˜ç½‘ k8s Github å­˜å‚¨å· emptyDir ä»‹ç» emptyDir æ˜¯ Kubernetes ä¸­æœ€ç®€å•çš„ä¸€ç§ Pod çº§åˆ«çš„ä¸´æ—¶å­˜å‚¨å·ã€‚å®ƒçš„æ ¸å¿ƒç‰¹ç‚¹æ˜¯ï¼šPod ç”Ÿå‘½å‘¨æœŸå†…å…±äº«ä¸´æ—¶å­˜å‚¨ï¼ŒPod åˆ é™¤åæ•°æ®è‡ªåŠ¨ä¸¢å¼ƒã€‚ åŒä¸€ä¸ª Pod å†…çš„å¤šä¸ªå®¹å™¨å¯ä»¥é€šè¿‡ emptyDir å…±äº«æ•°æ®ã€‚è·¨ Pod ä¸å…±äº«ï¼Œé€‚ç”¨äºä¸´æ—¶æ•°æ®ã€‚ emptyDir åªèƒ½æŒ‚è½½ç›®å½•ã€‚ ç¤ºä¾‹ ä¸¤ä¸ªå®¹å™¨ app å’Œ sidecar é€šè¿‡ /data å…±äº«ä¸€ä¸ª emptyDir å·ã€‚ 123456789101112131415161718192021222324# shared-emptydir-pod.yamlapiVersion: v1kind: Podmetadata: name: shared-emptydir-pod labels: app.sto: emptydirspec: containers: - name: app image: busybox command: [&quot;sh&quot;, &quot;-c&quot;, &quot;echo Hello &gt; /data1/hello; sleep 3600&quot;] volumeMounts: # å­˜å‚¨å·æŒ‚è½½ç‚¹ - name: shared-data # æŒ‚è½½ç‚¹åç§°ï¼Œä¸ä¸‹é¢ volumes ä¸­å®šä¹‰çš„ volume åç§°ä¸€è‡´ mountPath: /data1 # æŒ‚è½½ç‚¹è·¯å¾„ï¼ŒæŒ‚è½½åˆ°å®¹å™¨çš„ /data1 ç›®å½• - name: sidecar image: busybox command: [&quot;sh&quot;, &quot;-c&quot;, &quot;sleep 3600&quot;] volumeMounts: # å­˜å‚¨å·æŒ‚è½½ç‚¹ - name: shared-data # æŒ‚è½½ç‚¹åç§°ï¼Œä¸ä¸Šé¢å®¹å™¨ä¸­çš„ volume é…ç½®åç§°ä¸€è‡´ mountPath: /data2 # æŒ‚è½½ç‚¹è·¯å¾„ï¼ŒæŒ‚è½½åˆ°å®¹å™¨çš„ /data2 ç›®å½• volumes: # å­˜å‚¨å·å£°æ˜ - name: shared-data # å­˜å‚¨å·åç§° emptyDir: &#123;&#125; # å£°æ˜ä¸º emptyDir å­˜å‚¨å· åˆ›å»º 12345678k apply -f shared-emptydir-pod.yaml# æŸ¥çœ‹podæ‰€åœ¨èŠ‚ç‚¹$ k get pod -l app.sto=emptydirNAME READY STATUS RESTARTS AGE IP NODE NOMINATED NODE READINESS GATESshared-emptydir-pod 2/2 Running 0 22m 10.244.126.59 k8s-worker2 &lt;none&gt; &lt;none&gt;# æŸ¥çœ‹ pod-uid$ kubectl get pod shared-emptydir-pod -o jsonpath=&#x27;&#123;.metadata.uid&#125;&#x27;d597b4d7-e6b6-4522-887e-73d3f4c01006 emptyDir å­˜å‚¨å· é»˜è®¤ä½¿ç”¨èŠ‚ç‚¹æœ¬åœ°ç£ç›˜ï¼Œè·¯å¾„ä¸º /var/lib/kubelet/pods/&lt;pod-uid&gt;/volumes/kubernetes.io~empty-dir/&lt;volume-name&gt; 123456789# ç™»å½• k8s-worker2 èŠ‚ç‚¹export POD_UID=d597b4d7-e6b6-4522-887e-73d3f4c01006export POD_UID=6ea6636c-4a24-4dc5-af2a-2448825913b6export VOLUME_NAME=shared-datacd /var/lib/kubelet/pods/$POD_UID/volumes/kubernetes.io~empty-dir/$VOLUME_NAME$ lshello$ cat helloHello è¿›å…¥å®¹å™¨æŸ¥çœ‹å­˜å‚¨å·å†…å®¹ 123456789$ kubectl exec -it shared-emptydir-pod -c app -- cat /data1/helloHello$ kubectl exec -it shared-emptydir-pod -c sidecar -- cat /data2/helloHello# ä¿®æ”¹å†…å®¹ï¼Œå®é™…ä¸Šåœ¨å®¹å™¨å†…éƒ¨å’Œå¤–éƒ¨éƒ½å¯ä»¥ä¿®æ”¹å­˜å‚¨å·å†…å®¹ï¼Œä¿®æ”¹åç«‹åˆ»ç”Ÿæ•ˆ$ kubectl exec -it shared-emptydir-pod -c sidecar -- sh -c &quot;echo &#x27;Hello World&#x27; &gt; /data2/hello&quot;$ kubectl exec -it shared-emptydir-pod -c app -- cat /data1/helloHello World åˆ é™¤PODåemptydirå­˜å‚¨å·ä¼šç«‹åˆ»åˆ é™¤ 12345kubectl delete pod shared-emptydir-pod# ç™»å½• k8s-worker2 èŠ‚ç‚¹æŸ¥çœ‹ emptydir å­˜å‚¨å·$ ls /var/lib/kubelet/pods/$POD_UIDls: cannot access &#x27;/var/lib/kubelet/pods/d597b4d7-e6b6-4522-887e-73d3f4c01006&#x27;: No such file or directory å°† emptydir å­˜å‚¨å·æ”¹ç”¨ å†…å­˜ å­˜å‚¨ 123emptyDir: medium: Memory # ä½¿ç”¨ å†…å­˜ å­˜å‚¨ï¼ˆtmpfsï¼‰ï¼Œé€‚åˆé«˜ IO ä¸´æ—¶ç¼“å­˜ sizeLimit: 512Mi # é™åˆ¶å­˜å‚¨å¤§å° è¿™é‡Œè¦æ³¨æ„ï¼Œå³ä½¿è¿™é‡Œä½¿ç”¨å†…å­˜å­˜å‚¨ï¼Œä½†æ˜¯ /var/lib/kubelet/pods/&lt;pod-uid&gt;/volumes/kubernetes.io~empty-dir/&lt;volume-name&gt; ä¾ç„¶å­˜åœ¨ï¼Œä½†å®ƒæŒ‚è½½çš„æ˜¯ tmpfs æ–‡ä»¶ç³»ç»Ÿ 1234# ç™»å½•podæ‰€åœ¨èŠ‚ç‚¹æŸ¥çœ‹æŒ‚è½½ç‚¹$ mount | grep $POD_UIDtmpfs on /var/lib/kubelet/pods/6ea6636c-4a24-4dc5-af2a-2448825913b6/volumes/kubernetes.io~empty-dir/shared-data type tmpfs (rw,relatime,size=524288k)tmpfs on /var/lib/kubelet/pods/6ea6636c-4a24-4dc5-af2a-2448825913b6/volumes/kubernetes.io~projected/kube-api-access-5nk7d type tmpfs (rw,relatime,size=3903212k) å·ç±»å‹ æ¥æº æŒ‚è½½è·¯å¾„ ä½œç”¨ emptyDir ä½ é…ç½®çš„ /data1, /data2 Pod å†…éƒ¨å®¹å™¨å…±äº«ä¸´æ—¶å†…å­˜å­˜å‚¨ projected ç³»ç»Ÿè‡ªåŠ¨ /var/run/secrets/kubernetes.io/serviceaccount/ æŒ‚è½½ serviceaccount tokenï¼ŒCA è¯ä¹¦ æŸ¥çœ‹å®¹å™¨å†…æŒ‚è½½ç‚¹ 1234$ kubectl exec shared-emptydir-pod -c app -- mount | grep /data1tmpfs on /data1 type tmpfs (rw,relatime,size=524288k)$ kubectl exec shared-emptydir-pod -c app -- mount | grep serviceaccounttmpfs on /var/run/secrets/kubernetes.io/serviceaccount type tmpfs (ro,relatime,size=3903212k)","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» K8S çš„ å­˜å‚¨å· emptyDir ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚ K8Så®˜ç½‘ k8s Github","date_published":"2025-07-21T15:30:05.000Z","tags":["æŠ€æœ¯","k8s","K8S"]},{"id":"https://blog.hanqunfeng.com/2025/07/20/k8s-statefulset/","url":"https://blog.hanqunfeng.com/2025/07/20/k8s-statefulset/","title":"K8S ä¹‹ Statefulset","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç» K8S çš„ Statefulset ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://kubernetes.io/zh-cn/\">K8Så®˜ç½‘</a></p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://github.com/kubernetes/kubernetes\">k8s Github</a></p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://kubernetes.io/zh-cn/docs/concepts/workloads/controllers/statefulset/\">k8s Statefulset ä»‹ç»</a></p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"Statefulset-ä»‹ç»\">Statefulset ä»‹ç»</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Statefulset(ç¼©å†™ä¸º sts) æ˜¯ K8S å®˜æ–¹æä¾›çš„ä¸€ç§æ§åˆ¶å™¨ï¼Œç”¨äºç®¡ç†æœ‰çŠ¶æ€åº”ç”¨ã€‚ä¾‹å¦‚ï¼Œæ•°æ®åº“åº”ç”¨ï¼Œæ¶ˆæ¯é˜Ÿåˆ—ï¼Œç­‰ç­‰ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>Statefulset(æœ‰çŠ¶æ€) ä¸ Deployment(æ— çŠ¶æ€) çš„åŒºåˆ«æ˜¯ï¼š</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">Statefulset åˆ›å»ºçš„ Pod ä¼šæœ‰ç›¸åŒçš„åç§°ï¼Œå¹¶ä¸”ä¼šåˆ†é…ç›¸åŒçš„æŒä¹…å·ã€‚</li>\n<li class=\"lvl-4\">Statefulset åˆ›å»ºçš„ Pod ä½¿ç”¨ Headless Service(æ— å¤´æœåŠ¡ï¼Œæ²¡æœ‰ClusterIP)è¿›è¡Œé€šä¿¡ã€‚</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"Statefulset-ç®¡ç†\">Statefulset ç®¡ç†</h2>\n<h3 id=\"Statefulset-åˆ›å»º\">Statefulset åˆ›å»º</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Statefulset åªèƒ½ é€šè¿‡ <code>yaml</code> åˆ›å»ºï¼Œä¸æ”¯æŒ <code>create</code> åˆ›å»º</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä¸€ä¸ªç®€å•çš„ <code>redis-statefulset.yaml</code> æ–‡ä»¶è¯´æ˜</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span>                      <span class=\"comment\"># apiç‰ˆæœ¬</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Service</span>                       <span class=\"comment\"># èµ„æºç±»å‹</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span>                           <span class=\"comment\"># å…ƒæ•°æ®</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">redis-svc</span>                   <span class=\"comment\"># serviceåç§°</span></span><br><span class=\"line\">  <span class=\"attr\">namespace:</span> <span class=\"string\">sts-ns</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span>                               <span class=\"comment\"># é…ç½®</span></span><br><span class=\"line\">  <span class=\"attr\">ports:</span>                            <span class=\"comment\"># ç«¯å£</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">port:</span> <span class=\"number\">6379</span>                      <span class=\"comment\"># é›†ç¾¤å†…è®¿é—®ç«¯å£ï¼Œserviceçš„ç«¯å£ï¼Œä¸€èˆ¬é…ç½®ä¸ºä¸ targetPort ä¸€è‡´ï¼Œä½†æ˜¯éå¿…é¡»</span></span><br><span class=\"line\">    <span class=\"attr\">protocol:</span> <span class=\"string\">TCP</span>                   <span class=\"comment\"># åè®®</span></span><br><span class=\"line\">    <span class=\"attr\">targetPort:</span> <span class=\"number\">6379</span>                <span class=\"comment\"># å®¹å™¨ç«¯å£, podçš„ç«¯å£ï¼Œè¿™ä¸ªå¿…é¡»ä¸å®é™…å®¹å™¨ç«¯å£ä¸€è‡´</span></span><br><span class=\"line\">  <span class=\"attr\">selector:</span>                         <span class=\"comment\"># é€‰æ‹©å™¨</span></span><br><span class=\"line\">    <span class=\"attr\">app:</span> <span class=\"string\">redis</span>                      <span class=\"comment\"># podçš„æ ‡ç­¾ï¼Œå³åŒ¹é…podçš„æ ‡ç­¾ app=redis</span></span><br><span class=\"line\">  <span class=\"attr\">clusterIP:</span> <span class=\"string\">None</span>                   <span class=\"comment\"># é›†ç¾¤IPè®¾ç½®ä¸ºNoneï¼Œå³ä¸ºâ€œHeadless Serviceâ€</span></span><br><span class=\"line\">  <span class=\"attr\">type:</span> <span class=\"string\">ClusterIP</span>                   <span class=\"comment\"># æœåŠ¡ç±»å‹ï¼Œé»˜è®¤ä¸ºClusterIP</span></span><br><span class=\"line\"><span class=\"string\">---</span>                                 <span class=\"comment\"># åˆ†å‰²çº¿</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">apps/v1</span>                  <span class=\"comment\"># æŒ‡å®šä½¿ç”¨çš„ API ç‰ˆæœ¬ï¼Œè¿™é‡Œæ˜¯ apps/v1ï¼Œé€‚ç”¨äº StatefulSet èµ„æº</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">StatefulSet</span>                    <span class=\"comment\"># Kubernetes èµ„æºç±»å‹ï¼Œè¿™é‡Œæ˜¯éƒ¨ç½²ï¼ˆStatefulSetï¼‰</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">redis-sts</span>                    <span class=\"comment\"># èµ„æºåç§°ï¼Œå¿…é¡»å”¯ä¸€ï¼ˆåœ¨åŒä¸€å‘½åç©ºé—´ä¸‹ï¼‰</span></span><br><span class=\"line\">  <span class=\"attr\">namespace:</span> <span class=\"string\">sts-ns</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span>                                <span class=\"comment\"># é…ç½®é¡¹</span></span><br><span class=\"line\">  <span class=\"attr\">revisionHistoryLimit:</span> <span class=\"number\">10</span>           <span class=\"comment\"># ä¿ç•™çš„å†å²ç‰ˆæœ¬æ•°ï¼Œé»˜è®¤å€¼ä¸º 10ï¼ŒDeployment å’Œ StatefulSet éƒ½æœ‰è¿™ä¸ªé…ç½®é¡¹ã€‚å›æ»šæ—¶æœ‰ç”¨ã€‚</span></span><br><span class=\"line\">  <span class=\"attr\">selector:</span>                          <span class=\"comment\"># é€‰æ‹©å™¨ï¼ŒæŒ‡å®šè¦ç®¡ç†çš„ Pod</span></span><br><span class=\"line\">    <span class=\"attr\">matchLabels:</span>                     <span class=\"comment\"># æ ‡ç­¾é€‰æ‹©å™¨</span></span><br><span class=\"line\">      <span class=\"attr\">app:</span> <span class=\"string\">redis</span>                     <span class=\"comment\"># é€‰æ‹©å™¨ï¼ŒæŒ‡å®š StatefulSet ç®¡ç†å“ªäº› Podï¼ˆæ ‡ç­¾å¿…é¡»ä¸ template ä¸­åŒ¹é…ï¼‰</span></span><br><span class=\"line\">  <span class=\"attr\">updateStrategy:</span>                    <span class=\"comment\"># æ›´æ–°ç­–ç•¥ï¼Œè¿™é‡Œè¦æ³¨æ„è¿™ä¸ªæ›´æ–°ç­–ç•¥ä¸Deploymentçš„å±æ€§åå­—ä¸ä¸€æ ·</span></span><br><span class=\"line\">    <span class=\"attr\">type:</span> <span class=\"string\">RollingUpdate</span>              <span class=\"comment\"># 1.RollingUpdateï¼šè¿™æ˜¯é»˜è®¤çš„æ›´æ–°ç­–ç•¥ã€‚ä½¿ç”¨ RollingUpdate æ›´æ–°ç­–ç•¥æ—¶ï¼Œåœ¨æ›´æ–° StatefulSet æ¨¡æ¿åï¼Œ è€çš„ StatefulSet Pod å°†è¢«ç»ˆæ­¢ï¼Œå¹¶ä¸”å°†ä»¥å—æ§æ–¹å¼è‡ªåŠ¨åˆ›å»ºæ–°çš„ StatefulSet Podã€‚ æ›´æ–°æœŸé—´ï¼Œæœ€å¤šåªèƒ½æœ‰ StatefulSet çš„ä¸€ä¸ª Pod è¿è¡Œäºæ¯ä¸ªèŠ‚ç‚¹ä¸Šã€‚</span></span><br><span class=\"line\">                                     <span class=\"comment\"># 2.OnDeleteï¼šä½¿ç”¨ OnDelete æ›´æ–°ç­–ç•¥æ—¶ï¼Œåœ¨æ›´æ–° StatefulSet æ¨¡æ¿åï¼Œåªæœ‰å½“ä½ æ‰‹åŠ¨åˆ é™¤è€çš„ StatefulSet Pod ä¹‹åï¼Œæ–°çš„ StatefulSet Pod æ‰ä¼šè¢«è‡ªåŠ¨åˆ›å»ºã€‚</span></span><br><span class=\"line\">    <span class=\"attr\">rollingUpdate:</span>                   <span class=\"comment\"># æ»šåŠ¨å‡çº§çš„é…ç½®</span></span><br><span class=\"line\">      <span class=\"attr\">partition:</span> <span class=\"number\">0</span>                    <span class=\"comment\"># ç”¨äºæ§åˆ¶ä»ç¬¬å‡ ä¸ª Pod å¼€å§‹æ»šåŠ¨å‡çº§</span></span><br><span class=\"line\">  <span class=\"attr\">serviceName:</span> <span class=\"string\">redis-svc</span>             <span class=\"comment\"># æœåŠ¡åç§°,stså¯¹è±¡ä½¿ç”¨æ— å¤´æœåŠ¡ï¼Œè¿™ä¸ªæ˜¯å¿…å¡«é¡¹</span></span><br><span class=\"line\">  <span class=\"attr\">replicas:</span> <span class=\"number\">2</span>                        <span class=\"comment\"># å‰¯æœ¬æ•°ï¼Œé»˜è®¤æ˜¯ 1</span></span><br><span class=\"line\">  <span class=\"attr\">template:</span>                          <span class=\"comment\"># æ¨¡æ¿ï¼Œå®šä¹‰ Pod çš„å†…å®¹ï¼Œå…·ä½“å¯ä»¥å‚è€ƒ Pod çš„é…ç½®</span></span><br><span class=\"line\">    <span class=\"attr\">metadata:</span></span><br><span class=\"line\">      <span class=\"attr\">labels:</span></span><br><span class=\"line\">        <span class=\"attr\">app:</span> <span class=\"string\">redis</span>                   <span class=\"comment\"># Pod çš„æ ‡ç­¾ï¼Œå¿…é¡»ä¸ selector ä¸­çš„ matchLabels ä¸€è‡´</span></span><br><span class=\"line\">    <span class=\"attr\">spec:</span></span><br><span class=\"line\">      <span class=\"attr\">containers:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">image:</span> <span class=\"string\">redis:6.2</span>             <span class=\"comment\"># å®¹å™¨ä½¿ç”¨çš„é•œåƒï¼Œè¿™é‡Œæ˜¯å®˜æ–¹çš„ redis é•œåƒ</span></span><br><span class=\"line\">        <span class=\"attr\">name:</span> <span class=\"string\">redis</span>                  <span class=\"comment\"># å®¹å™¨çš„åç§°ï¼Œå®é™…çš„åç§°ä¸º sts-redis-&lt;number&gt;ï¼Œä» 0 å¼€å§‹é€’å¢</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ‰§è¡Œåˆ›å»º</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åˆ›å»ºå‘½åç©ºé—´</span></span><br><span class=\"line\">kubectl create namespace sts-ns</span><br><span class=\"line\"><span class=\"comment\"># åˆ›å»º StatefulSet</span></span><br><span class=\"line\">kubectl apply -f redis-statefulset.yaml</span><br></pre></td></tr></table></figure>\n<h3 id=\"æŸ¥çœ‹-Statefulset\">æŸ¥çœ‹ Statefulset</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ k get all -n sts-ns</span><br><span class=\"line\">NAME              READY   STATUS    RESTARTS   AGE</span><br><span class=\"line\">pod/redis-sts-0   1/1     Running   0          40s</span><br><span class=\"line\">pod/redis-sts-1   1/1     Running   0          24s</span><br><span class=\"line\"></span><br><span class=\"line\">NAME                TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)    AGE</span><br><span class=\"line\">service/redis-svc   ClusterIP   None         &lt;none&gt;        6379/TCP   40s</span><br><span class=\"line\"></span><br><span class=\"line\">NAME                         READY   AGE</span><br><span class=\"line\">statefulset.apps/redis-sts   2/2     40s</span><br></pre></td></tr></table></figure>\n<h3 id=\"è®¿é—®podä¸­çš„redisæœåŠ¡\">è®¿é—®podä¸­çš„redisæœåŠ¡</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ—¢ç„¶æ˜¯Headless Serviceï¼Œå°±åªèƒ½åœ¨é›†ç¾¤å†…éƒ¨è®¿é—®</p>\n</li>\n<li class=\"lvl-2\">\n<p>åœ¨ç›¸åŒçš„ namespace ä¸­ï¼Œå¯ä»¥é€šè¿‡ <code>serviceName</code> ç›´æ¥è®¿é—®ï¼Œè®¿é—®æŒ‡å®šçš„ podï¼Œå¯ä»¥é€šè¿‡ <code>&lt;pod-name&gt;.&lt;service-name&gt;</code></p>\n</li>\n<li class=\"lvl-2\">\n<p>åœ¨ä¸åŒçš„ namespace ä¸­ï¼Œå¯ä»¥é€šè¿‡ <code>&lt;serviceName&gt;.&lt;namespace&gt;</code> æˆ–è€… <code>&lt;serviceName&gt;.&lt;namespace&gt;.svc.cluster.local</code> è®¿é—®ï¼Œè®¿é—®æŒ‡å®šçš„ podï¼Œå¯ä»¥é€šè¿‡ <code>&lt;pod-name&gt;.&lt;service-name&gt;.&lt;namespace&gt;.svc.cluster.local</code> è®¿é—®ï¼Œå› ä¸º pod-name æ˜¯å›ºå®šä¸”å”¯ä¸€çš„</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ k <span class=\"built_in\">exec</span> -it pod/redis-sts-0 -n sts-ns -- getent hosts redis-svc</span><br><span class=\"line\">10.244.126.55   redis-svc.sts-ns.svc.cluster.local</span><br><span class=\"line\">10.244.194.110  redis-svc.sts-ns.svc.cluster.local</span><br><span class=\"line\"></span><br><span class=\"line\">$ k <span class=\"built_in\">exec</span> -it pod/redis-sts-0 -n sts-ns -- getent hosts redis-sts-1.redis-svc</span><br><span class=\"line\">10.244.126.55   redis-sts-1.redis-svc.sts-ns.svc.cluster.local</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åœ¨é›†ç¾¤å¤–éƒ¨è®¿é—®ï¼Œéœ€è¦åˆ›å»ºä¸€ä¸ªæ–°çš„ Serviceï¼Œç±»å‹ä¸º NodePort æˆ–è€… LoadBalancerï¼Œå°†redisæœåŠ¡æš´éœ²å‡ºå»</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span>                      <span class=\"comment\"># apiç‰ˆæœ¬</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Service</span>                       <span class=\"comment\"># èµ„æºç±»å‹</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span>                           <span class=\"comment\"># å…ƒæ•°æ®</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">redis-svc-out</span>               <span class=\"comment\"># serviceåç§°</span></span><br><span class=\"line\">  <span class=\"attr\">namespace:</span> <span class=\"string\">sts-ns</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span>                               <span class=\"comment\"># é…ç½®</span></span><br><span class=\"line\">  <span class=\"attr\">ports:</span>                            <span class=\"comment\"># ç«¯å£</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">port:</span> <span class=\"number\">6379</span>                      <span class=\"comment\"># é›†ç¾¤å†…è®¿é—®ç«¯å£ï¼Œserviceçš„ç«¯å£ï¼Œä¸€èˆ¬é…ç½®ä¸ºä¸ targetPort ä¸€è‡´ï¼Œä½†æ˜¯éå¿…é¡»</span></span><br><span class=\"line\">    <span class=\"attr\">protocol:</span> <span class=\"string\">TCP</span>                   <span class=\"comment\"># åè®®</span></span><br><span class=\"line\">    <span class=\"attr\">targetPort:</span> <span class=\"number\">6379</span>                <span class=\"comment\"># å®¹å™¨ç«¯å£, podçš„ç«¯å£ï¼Œè¿™ä¸ªå¿…é¡»ä¸å®é™…å®¹å™¨ç«¯å£ä¸€è‡´</span></span><br><span class=\"line\">  <span class=\"attr\">selector:</span>                         <span class=\"comment\"># é€‰æ‹©å™¨</span></span><br><span class=\"line\">    <span class=\"attr\">app:</span> <span class=\"string\">redis</span>                      <span class=\"comment\"># podçš„æ ‡ç­¾ï¼Œå³åŒ¹é…podçš„æ ‡ç­¾ app=redis</span></span><br><span class=\"line\">  <span class=\"attr\">type:</span> <span class=\"string\">LoadBalancer</span>                <span class=\"comment\"># è´Ÿè½½å‡è¡¡</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ‰§è¡Œ</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åˆ›å»º</span></span><br><span class=\"line\">$ k create -f redis-svc-out.yaml</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹</span></span><br><span class=\"line\">$ k get svc -n sts-ns</span><br><span class=\"line\">NAME            TYPE           CLUSTER-IP    EXTERNAL-IP     PORT(S)          AGE</span><br><span class=\"line\">redis-svc       ClusterIP      None          &lt;none&gt;          6379/TCP         70m</span><br><span class=\"line\">redis-svc-out   LoadBalancer   10.96.21.96   10.211.55.202   6379:31806/TCP   54m</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åœ¨é›†ç¾¤å¤–çš„æœºå™¨ä¸Šè®¿é—® redisï¼Œæ¯æ¬¡è¿æ¥ä¼šè½®è¯¢è®¿é—®å„ä¸ªpod</span></span><br><span class=\"line\">$ redis-cli -h 10.211.55.202 info server | grep redis_version</span><br><span class=\"line\">redis_version:8.0.3</span><br></pre></td></tr></table></figure>\n<h3 id=\"æŸ¥çœ‹-Statefulset-è¯¦æƒ…\">æŸ¥çœ‹ Statefulset è¯¦æƒ…</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å½“ Statefulset è¿è¡Œé”™è¯¯æ—¶ï¼Œå¯ä»¥é€šè¿‡è¯¥å‘½ä»¤æŸ¥çœ‹ Statefulset çš„è¯¦æƒ…ï¼Œæ‰¾åˆ°é”™è¯¯åŸå› </p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl describe sts &lt;sts-name&gt;</span><br><span class=\"line\">kubectl describe sts &lt;sts-name&gt; -n &lt;namespace-name&gt;</span><br></pre></td></tr></table></figure>\n<h3 id=\"åˆ é™¤-Statefulset\">åˆ é™¤ Statefulset</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl delete sts &lt;sts-name&gt;</span><br><span class=\"line\">kubectl delete sts &lt;sts-name&gt; -n &lt;namespace-name&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># é€šè¿‡ yaml æ–‡ä»¶åˆ é™¤</span></span><br><span class=\"line\">kubectl delete -f &lt;yaml-file&gt;</span><br></pre></td></tr></table></figure>\n<h3 id=\"æŸ¥çœ‹-Statefulset-æ—¥å¿—\">æŸ¥çœ‹ Statefulset æ—¥å¿—</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl logs sts/&lt;sts-name&gt;</span><br><span class=\"line\">kubectl logs sts/&lt;sts-name&gt; -n &lt;namespace-name&gt;</span><br></pre></td></tr></table></figure>\n<h3 id=\"æ»šåŠ¨å‡çº§ä¸å›æ»š-Statefulset\">æ»šåŠ¨å‡çº§ä¸å›æ»š Statefulset</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¯¹ <code>RollingUpdate</code> ç±»å‹çš„ <code>Statefulset</code> çš„ <code>.spec.template</code> çš„ä»»ä½•æ›´æ–°éƒ½å°†è§¦å‘æ»šåŠ¨æ›´æ–°ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>æˆ‘ä»¬ä¿®æ”¹è¿‡ <code>Statefulset</code> çš„ <code>.spec.template</code>ï¼Œå¹¶ä¿å­˜åï¼Œé‡æ–°è¿è¡Œ <code>kubectl apply -f &lt;yaml-file&gt;</code>å³å¯è§¦å‘æ»šåŠ¨å‡çº§ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å¦‚æœåªæ˜¯æ›´æ–°å®¹å™¨çš„é•œåƒï¼Œä¹Ÿå¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤è§¦å‘æ»šåŠ¨å‡çº§</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ k <span class=\"built_in\">exec</span> -it pod/redis-sts-0 -n sts-ns -- redis-server -v</span><br><span class=\"line\">Redis server v=6.2.19 sha=00000000:0 malloc=jemalloc-5.1.0 bits=64 build=c51c65e7ae83f735</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># kubectl set image sts/&lt;sts-name&gt; &lt;container-name&gt;=&lt;image&gt;:&lt;tag&gt; --record=true</span></span><br><span class=\"line\">kubectl <span class=\"built_in\">set</span> image sts redis-sts redis=redis:8.0 --record=<span class=\"literal\">true</span> -n sts-ns</span><br><span class=\"line\"></span><br><span class=\"line\">$ k <span class=\"built_in\">exec</span> -it pod/redis-sts-0 -n sts-ns -- redis-server -v</span><br><span class=\"line\">Redis server v=8.0.3 sha=00000000:1 malloc=jemalloc-5.3.0 bits=64 build=d4cb0aa008da4ca9</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æŸ¥çœ‹æ»šåŠ¨å‡çº§çŠ¶æ€</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># kubectl rollout status sts/&lt;sts-name&gt;</span></span><br><span class=\"line\">$ kubectl rollout status sts redis-sts -n sts-ns</span><br><span class=\"line\">partitioned roll out complete: 2 new pods have been updated...</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æŸ¥çœ‹å†å²ç‰ˆæœ¬</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å‰é¢çš„åºå·è¡¨ç¤ºç‰ˆæœ¬å·</span></span><br><span class=\"line\">kubectl rollout <span class=\"built_in\">history</span> sts redis-sts -n sts-ns</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹æŒ‡å®šç‰ˆæœ¬çš„è¯¦æƒ…</span></span><br><span class=\"line\">kubectl rollout <span class=\"built_in\">history</span> sts redis-sts -n sts-ns --revision=1</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å›æ»š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å›é€€åˆ°å‰ä¸€ä¸ªç‰ˆæœ¬</span></span><br><span class=\"line\">kubectl rollout undo sts redis-sts -n sts-ns</span><br><span class=\"line\"><span class=\"comment\"># å›åˆ°æŒ‡å®šç‰ˆæœ¬ï¼Œè¿™é‡Œ --to-revision=1 è¡¨ç¤ºå›åˆ°ç‰ˆæœ¬1</span></span><br><span class=\"line\">kubectl rollout undo sts redis-sts -n sts-nsx --to-revision=1</span><br></pre></td></tr></table></figure>\n<h2 id=\"Deployment-å’Œ-StatefulSet-çš„å¯¹æ¯”æ€»ç»“\">Deployment å’Œ StatefulSet çš„å¯¹æ¯”æ€»ç»“</h2>\n<table>\n<thead>\n<tr>\n<th>ç‰¹æ€§</th>\n<th><strong>Deployment</strong></th>\n<th><strong>StatefulSet</strong></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>ç”¨é€”</strong></td>\n<td>æ— çŠ¶æ€åº”ç”¨ï¼ˆå¦‚ Web æœåŠ¡ã€API æœåŠ¡ï¼‰</td>\n<td>æœ‰çŠ¶æ€åº”ç”¨ï¼ˆå¦‚æ•°æ®åº“ã€ç¼“å­˜ï¼šRedisã€MySQLã€Kafkaï¼‰</td>\n</tr>\n<tr>\n<td><strong>Pod åç§°</strong></td>\n<td>Pod åå­—éšæœºç”Ÿæˆï¼Œå¦‚ <code>nginx-abc123</code></td>\n<td>Pod åå­—æœ‰åºï¼Œæ ¼å¼ä¸º <code>name-0</code>ã€<code>name-1</code>ã€<code>name-2</code></td>\n</tr>\n<tr>\n<td><strong>ç¨³å®šçš„æ ‡è¯†</strong></td>\n<td><strong>ä¸æä¾›</strong>ï¼Œæ¯æ¬¡é‡å»º Pod åå­—å¯èƒ½ä¸åŒ</td>\n<td><strong>æä¾›</strong>ï¼Œæ¯ä¸ª Pod çš„åå­—ã€ç½‘ç»œ IDã€å­˜å‚¨æŒä¹…åŒ–ä¸å˜</td>\n</tr>\n<tr>\n<td><strong>å­˜å‚¨å·</strong></td>\n<td>é€šå¸¸é…åˆ PVCï¼Œä½† Pod é‡å»ºæ—¶æŒ‚è½½å·å¯èƒ½å˜åŒ–</td>\n<td>é…ç½® <code>volumeClaimTemplates</code>ï¼Œæ¯ä¸ª Pod ç‹¬ç«‹æŒä¹…å·</td>\n</tr>\n<tr>\n<td><strong>æ»šåŠ¨æ›´æ–°ç­–ç•¥</strong></td>\n<td>æ”¯æŒ <code>maxSurge</code>ã€<code>maxUnavailable</code>ï¼Œå¯å¹¶è¡Œæ›´æ–° Pod</td>\n<td>é»˜è®¤ <strong>é€ä¸ªé¡ºåºæ›´æ–°</strong> Podï¼ˆå¯ç”¨ <code>partition</code> æ§åˆ¶åˆ†æ‰¹æ›´æ–°ï¼‰</td>\n</tr>\n<tr>\n<td><strong>å¯ç”¨æ€§</strong></td>\n<td>é€šå¸¸è®¾è®¡ä¸º <strong>æ— çŠ¶æ€å¤šå‰¯æœ¬é«˜å¯ç”¨</strong>ï¼Œä¸ä¿è¯ Pod å¯åŠ¨é¡ºåºæˆ–å›ºå®š IP</td>\n<td><strong>æœ‰çŠ¶æ€ä¸”æœ‰åºéƒ¨ç½²ã€åˆ é™¤ã€æ›´æ–°</strong>ï¼Œé€šå¸¸å•å‰¯æœ¬é€ä¸ªç»´æŠ¤å¯ç”¨æ€§</td>\n</tr>\n<tr>\n<td><strong>æœåŠ¡è®¿é—®</strong></td>\n<td>é€šè¿‡ ClusterIPã€NodePortã€LoadBalancer è®¿é—®</td>\n<td>æ¨èç”¨ <strong>Headless Service (clusterIP: None)</strong>ï¼ŒPod æœ‰å›ºå®š DNS</td>\n</tr>\n<tr>\n<td><strong>å…¸å‹åº”ç”¨åœºæ™¯</strong></td>\n<td>Web åº”ç”¨ã€REST APIã€æ— çŠ¶æ€å¾®æœåŠ¡</td>\n<td>æ•°æ®åº“ï¼ˆMySQLã€PostgreSQLï¼‰ã€ç¼“å­˜ï¼ˆRedisï¼‰ã€é˜Ÿåˆ—ï¼ˆKafkaã€RabbitMQï¼‰</td>\n</tr>\n<tr>\n<td><strong>Pod ä¼¸ç¼©ç‰¹æ€§</strong></td>\n<td><strong>çµæ´»ä¼¸ç¼©</strong>ï¼Œå¢åŠ /å‡å°‘å‰¯æœ¬æ— ç‰¹å®šé¡ºåº</td>\n<td><strong>æœ‰åºä¼¸ç¼©</strong>ï¼Œ<code>name-0</code> -&gt; <code>name-1</code> -&gt; <code>name-2</code>â€¦</td>\n</tr>\n<tr>\n<td><strong>é‡å»ºç­–ç•¥</strong></td>\n<td>Pod å´©æºƒåé‡å»ºçš„æ˜¯æ–° Podï¼Œæ— æŒä¹…å­˜å‚¨æ•°æ®å¯èƒ½ä¸¢å¤±</td>\n<td>Pod å´©æºƒåé‡å»ºçš„æ˜¯ç›¸åŒ Pod åå­—ï¼ŒæŒ‚è½½ç›¸åŒ PVCï¼Œä¸ä¸¢æ•°æ®</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"åè®°\">åè®°</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>StatefulSet ç±»ä¼¼äº Deploymentï¼ŒåŒæ ·æ”¯æŒæ‰©ç¼©å®¹ï¼ˆscale æˆ–è€… hpaï¼‰ï¼Œä½†å› ä¸ºå…¶æ˜¯æœ‰çŠ¶æ€çš„ï¼Œæ‰€ä»¥éœ€è°¨æ…</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># scale</span></span><br><span class=\"line\">kubectl scale sts redis-sts --replicas=5 -n sts-ns</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># hpaï¼Œè¦æ±‚podé…ç½®ä¸­æœ‰èµ„æºé™åˆ¶</span></span><br><span class=\"line\">kubectl autoscale sts redis-sts --name=<span class=\"string\">&quot;hpa-redis&quot;</span> --cpu-percent=50 --min=3 --max=10 -n sts-ns</span><br></pre></td></tr></table></figure>\n<table>\n<thead>\n<tr>\n<th>æ“ä½œ</th>\n<th><strong>å¯è¡Œæ€§</strong></th>\n<th><strong>æ¨èæƒ…å†µ</strong></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>æ‰©å®¹ï¼ˆå¢åŠ å‰¯æœ¬æ•°ï¼‰</strong></td>\n<td>âœ… <strong>æ¨è</strong></td>\n<td>å®‰å…¨ï¼Œæ–°å¢ Pod æŒ‰åºä» N-1 å¼€å§‹åˆ›å»ºï¼ˆ<code>sts-name-0</code> -&gt; <code>sts-name-1</code> -&gt; <code>sts-name-2</code>ï¼‰</td>\n</tr>\n<tr>\n<td><strong>ç¼©å®¹ï¼ˆå‡å°‘å‰¯æœ¬æ•°ï¼‰</strong></td>\n<td>âš ï¸ <strong>å°å¿ƒä½¿ç”¨</strong></td>\n<td>å¯èƒ½å¯¼è‡´ Pod åŠå…¶å…³è” PVC è¢«åºŸå¼ƒï¼Œ<strong>æ•°æ®å¯èƒ½ä¸¢å¤±</strong></td>\n</tr>\n</tbody>\n</table>\n","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» K8S çš„ Statefulset ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚ K8Så®˜ç½‘ k8s Github k8s Statefulset ä»‹ç» Statefulset ä»‹ç» Statefulset(ç¼©å†™ä¸º sts) æ˜¯ K8S å®˜æ–¹æä¾›çš„ä¸€ç§æ§åˆ¶å™¨ï¼Œç”¨äºç®¡ç†æœ‰çŠ¶æ€åº”ç”¨ã€‚ä¾‹å¦‚ï¼Œæ•°æ®åº“åº”ç”¨ï¼Œæ¶ˆæ¯é˜Ÿåˆ—ï¼Œç­‰ç­‰ã€‚ Statefulset(æœ‰çŠ¶æ€) ä¸ Deployment(æ— çŠ¶æ€) çš„åŒºåˆ«æ˜¯ï¼š Statefulset åˆ›å»ºçš„ Pod ä¼šæœ‰ç›¸åŒçš„åç§°ï¼Œå¹¶ä¸”ä¼šåˆ†é…ç›¸åŒçš„æŒä¹…å·ã€‚ Statefulset åˆ›å»ºçš„ Pod ä½¿ç”¨ Headless Service(æ— å¤´æœåŠ¡ï¼Œæ²¡æœ‰ClusterIP)è¿›è¡Œé€šä¿¡ã€‚ Statefulset ç®¡ç† Statefulset åˆ›å»º Statefulset åªèƒ½ é€šè¿‡ yaml åˆ›å»ºï¼Œä¸æ”¯æŒ create åˆ›å»º ä¸€ä¸ªç®€å•çš„ redis-statefulset.yaml æ–‡ä»¶è¯´æ˜ 12345678910111213141516171819202122232425262728293031323334353637383940apiVersion: v1 # apiç‰ˆæœ¬kind: Service # èµ„æºç±»å‹metadata: # å…ƒæ•°æ® name: redis-svc # serviceåç§° namespace: sts-nsspec: # é…ç½® ports: # ç«¯å£ - port: 6379 # é›†ç¾¤å†…è®¿é—®ç«¯å£ï¼Œserviceçš„ç«¯å£ï¼Œä¸€èˆ¬é…ç½®ä¸ºä¸ targetPort ä¸€è‡´ï¼Œä½†æ˜¯éå¿…é¡» protocol: TCP # åè®® targetPort: 6379 # å®¹å™¨ç«¯å£, podçš„ç«¯å£ï¼Œè¿™ä¸ªå¿…é¡»ä¸å®é™…å®¹å™¨ç«¯å£ä¸€è‡´ selector: # é€‰æ‹©å™¨ app: redis # podçš„æ ‡ç­¾ï¼Œå³åŒ¹é…podçš„æ ‡ç­¾ app=redis clusterIP: None # é›†ç¾¤IPè®¾ç½®ä¸ºNoneï¼Œå³ä¸ºâ€œHeadless Serviceâ€ type: ClusterIP # æœåŠ¡ç±»å‹ï¼Œé»˜è®¤ä¸ºClusterIP--- # åˆ†å‰²çº¿apiVersion: apps/v1 # æŒ‡å®šä½¿ç”¨çš„ API ç‰ˆæœ¬ï¼Œè¿™é‡Œæ˜¯ apps/v1ï¼Œé€‚ç”¨äº StatefulSet èµ„æºkind: StatefulSet # Kubernetes èµ„æºç±»å‹ï¼Œè¿™é‡Œæ˜¯éƒ¨ç½²ï¼ˆStatefulSetï¼‰metadata: name: redis-sts # èµ„æºåç§°ï¼Œå¿…é¡»å”¯ä¸€ï¼ˆåœ¨åŒä¸€å‘½åç©ºé—´ä¸‹ï¼‰ namespace: sts-nsspec: # é…ç½®é¡¹ revisionHistoryLimit: 10 # ä¿ç•™çš„å†å²ç‰ˆæœ¬æ•°ï¼Œé»˜è®¤å€¼ä¸º 10ï¼ŒDeployment å’Œ StatefulSet éƒ½æœ‰è¿™ä¸ªé…ç½®é¡¹ã€‚å›æ»šæ—¶æœ‰ç”¨ã€‚ selector: # é€‰æ‹©å™¨ï¼ŒæŒ‡å®šè¦ç®¡ç†çš„ Pod matchLabels: # æ ‡ç­¾é€‰æ‹©å™¨ app: redis # é€‰æ‹©å™¨ï¼ŒæŒ‡å®š StatefulSet ç®¡ç†å“ªäº› Podï¼ˆæ ‡ç­¾å¿…é¡»ä¸ template ä¸­åŒ¹é…ï¼‰ updateStrategy: # æ›´æ–°ç­–ç•¥ï¼Œè¿™é‡Œè¦æ³¨æ„è¿™ä¸ªæ›´æ–°ç­–ç•¥ä¸Deploymentçš„å±æ€§åå­—ä¸ä¸€æ · type: RollingUpdate # 1.RollingUpdateï¼šè¿™æ˜¯é»˜è®¤çš„æ›´æ–°ç­–ç•¥ã€‚ä½¿ç”¨ RollingUpdate æ›´æ–°ç­–ç•¥æ—¶ï¼Œåœ¨æ›´æ–° StatefulSet æ¨¡æ¿åï¼Œ è€çš„ StatefulSet Pod å°†è¢«ç»ˆæ­¢ï¼Œå¹¶ä¸”å°†ä»¥å—æ§æ–¹å¼è‡ªåŠ¨åˆ›å»ºæ–°çš„ StatefulSet Podã€‚ æ›´æ–°æœŸé—´ï¼Œæœ€å¤šåªèƒ½æœ‰ StatefulSet çš„ä¸€ä¸ª Pod è¿è¡Œäºæ¯ä¸ªèŠ‚ç‚¹ä¸Šã€‚ # 2.OnDeleteï¼šä½¿ç”¨ OnDelete æ›´æ–°ç­–ç•¥æ—¶ï¼Œåœ¨æ›´æ–° StatefulSet æ¨¡æ¿åï¼Œåªæœ‰å½“ä½ æ‰‹åŠ¨åˆ é™¤è€çš„ StatefulSet Pod ä¹‹åï¼Œæ–°çš„ StatefulSet Pod æ‰ä¼šè¢«è‡ªåŠ¨åˆ›å»ºã€‚ rollingUpdate: # æ»šåŠ¨å‡çº§çš„é…ç½® partition: 0 # ç”¨äºæ§åˆ¶ä»ç¬¬å‡ ä¸ª Pod å¼€å§‹æ»šåŠ¨å‡çº§ serviceName: redis-svc # æœåŠ¡åç§°,stså¯¹è±¡ä½¿ç”¨æ— å¤´æœåŠ¡ï¼Œè¿™ä¸ªæ˜¯å¿…å¡«é¡¹ replicas: 2 # å‰¯æœ¬æ•°ï¼Œé»˜è®¤æ˜¯ 1 template: # æ¨¡æ¿ï¼Œå®šä¹‰ Pod çš„å†…å®¹ï¼Œå…·ä½“å¯ä»¥å‚è€ƒ Pod çš„é…ç½® metadata: labels: app: redis # Pod çš„æ ‡ç­¾ï¼Œå¿…é¡»ä¸ selector ä¸­çš„ matchLabels ä¸€è‡´ spec: containers: - image: redis:6.2 # å®¹å™¨ä½¿ç”¨çš„é•œåƒï¼Œè¿™é‡Œæ˜¯å®˜æ–¹çš„ redis é•œåƒ name: redis # å®¹å™¨çš„åç§°ï¼Œå®é™…çš„åç§°ä¸º sts-redis-&lt;number&gt;ï¼Œä» 0 å¼€å§‹é€’å¢ æ‰§è¡Œåˆ›å»º 1234# åˆ›å»ºå‘½åç©ºé—´kubectl create namespace sts-ns# åˆ›å»º StatefulSetkubectl apply -f redis-statefulset.yaml æŸ¥çœ‹ Statefulset 12345678910$ k get all -n sts-nsNAME READY STATUS RESTARTS AGEpod/redis-sts-0 1/1 Running 0 40spod/redis-sts-1 1/1 Running 0 24sNAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGEservice/redis-svc ClusterIP None &lt;none&gt; 6379/TCP 40sNAME READY AGEstatefulset.apps/redis-sts 2/2 40s è®¿é—®podä¸­çš„redisæœåŠ¡ æ—¢ç„¶æ˜¯Headless Serviceï¼Œå°±åªèƒ½åœ¨é›†ç¾¤å†…éƒ¨è®¿é—® åœ¨ç›¸åŒçš„ namespace ä¸­ï¼Œå¯ä»¥é€šè¿‡ serviceName ç›´æ¥è®¿é—®ï¼Œè®¿é—®æŒ‡å®šçš„ podï¼Œå¯ä»¥é€šè¿‡ &lt;pod-name&gt;.&lt;service-name&gt; åœ¨ä¸åŒçš„ namespace ä¸­ï¼Œå¯ä»¥é€šè¿‡ &lt;serviceName&gt;.&lt;namespace&gt; æˆ–è€… &lt;serviceName&gt;.&lt;namespace&gt;.svc.cluster.local è®¿é—®ï¼Œè®¿é—®æŒ‡å®šçš„ podï¼Œå¯ä»¥é€šè¿‡ &lt;pod-name&gt;.&lt;service-name&gt;.&lt;namespace&gt;.svc.cluster.local è®¿é—®ï¼Œå› ä¸º pod-name æ˜¯å›ºå®šä¸”å”¯ä¸€çš„ 123456$ k exec -it pod/redis-sts-0 -n sts-ns -- getent hosts redis-svc10.244.126.55 redis-svc.sts-ns.svc.cluster.local10.244.194.110 redis-svc.sts-ns.svc.cluster.local$ k exec -it pod/redis-sts-0 -n sts-ns -- getent hosts redis-sts-1.redis-svc10.244.126.55 redis-sts-1.redis-svc.sts-ns.svc.cluster.local åœ¨é›†ç¾¤å¤–éƒ¨è®¿é—®ï¼Œéœ€è¦åˆ›å»ºä¸€ä¸ªæ–°çš„ Serviceï¼Œç±»å‹ä¸º NodePort æˆ–è€… LoadBalancerï¼Œå°†redisæœåŠ¡æš´éœ²å‡ºå» 12345678910111213apiVersion: v1 # apiç‰ˆæœ¬kind: Service # èµ„æºç±»å‹metadata: # å…ƒæ•°æ® name: redis-svc-out # serviceåç§° namespace: sts-nsspec: # é…ç½® ports: # ç«¯å£ - port: 6379 # é›†ç¾¤å†…è®¿é—®ç«¯å£ï¼Œserviceçš„ç«¯å£ï¼Œä¸€èˆ¬é…ç½®ä¸ºä¸ targetPort ä¸€è‡´ï¼Œä½†æ˜¯éå¿…é¡» protocol: TCP # åè®® targetPort: 6379 # å®¹å™¨ç«¯å£, podçš„ç«¯å£ï¼Œè¿™ä¸ªå¿…é¡»ä¸å®é™…å®¹å™¨ç«¯å£ä¸€è‡´ selector: # é€‰æ‹©å™¨ app: redis # podçš„æ ‡ç­¾ï¼Œå³åŒ¹é…podçš„æ ‡ç­¾ app=redis type: LoadBalancer # è´Ÿè½½å‡è¡¡ æ‰§è¡Œ 1234567891011# åˆ›å»º$ k create -f redis-svc-out.yaml# æŸ¥çœ‹$ k get svc -n sts-nsNAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGEredis-svc ClusterIP None &lt;none&gt; 6379/TCP 70mredis-svc-out LoadBalancer 10.96.21.96 10.211.55.202 6379:31806/TCP 54m# åœ¨é›†ç¾¤å¤–çš„æœºå™¨ä¸Šè®¿é—® redisï¼Œæ¯æ¬¡è¿æ¥ä¼šè½®è¯¢è®¿é—®å„ä¸ªpod$ redis-cli -h 10.211.55.202 info server | grep redis_versionredis_version:8.0.3 æŸ¥çœ‹ Statefulset è¯¦æƒ… å½“ Statefulset è¿è¡Œé”™è¯¯æ—¶ï¼Œå¯ä»¥é€šè¿‡è¯¥å‘½ä»¤æŸ¥çœ‹ Statefulset çš„è¯¦æƒ…ï¼Œæ‰¾åˆ°é”™è¯¯åŸå›  12kubectl describe sts &lt;sts-name&gt;kubectl describe sts &lt;sts-name&gt; -n &lt;namespace-name&gt; åˆ é™¤ Statefulset 12345kubectl delete sts &lt;sts-name&gt;kubectl delete sts &lt;sts-name&gt; -n &lt;namespace-name&gt;# é€šè¿‡ yaml æ–‡ä»¶åˆ é™¤kubectl delete -f &lt;yaml-file&gt; æŸ¥çœ‹ Statefulset æ—¥å¿— 12kubectl logs sts/&lt;sts-name&gt;kubectl logs sts/&lt;sts-name&gt; -n &lt;namespace-name&gt; æ»šåŠ¨å‡çº§ä¸å›æ»š Statefulset å¯¹ RollingUpdate ç±»å‹çš„ Statefulset çš„ .spec.template çš„ä»»ä½•æ›´æ–°éƒ½å°†è§¦å‘æ»šåŠ¨æ›´æ–°ã€‚ æˆ‘ä»¬ä¿®æ”¹è¿‡ Statefulset çš„ .spec.templateï¼Œå¹¶ä¿å­˜åï¼Œé‡æ–°è¿è¡Œ kubectl apply -f &lt;yaml-file&gt;å³å¯è§¦å‘æ»šåŠ¨å‡çº§ã€‚ å¦‚æœåªæ˜¯æ›´æ–°å®¹å™¨çš„é•œåƒï¼Œä¹Ÿå¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤è§¦å‘æ»šåŠ¨å‡çº§ 12345678$ k exec -it pod/redis-sts-0 -n sts-ns -- redis-server -vRedis server v=6.2.19 sha=00000000:0 malloc=jemalloc-5.1.0 bits=64 build=c51c65e7ae83f735# kubectl set image sts/&lt;sts-name&gt; &lt;container-name&gt;=&lt;image&gt;:&lt;tag&gt; --record=truekubectl set image sts redis-sts redis=redis:8.0 --record=true -n sts-ns$ k exec -it pod/redis-sts-0 -n sts-ns -- redis-server -vRedis server v=8.0.3 sha=00000000:1 malloc=jemalloc-5.3.0 bits=64 build=d4cb0aa008da4ca9 æŸ¥çœ‹æ»šåŠ¨å‡çº§çŠ¶æ€ 123# kubectl rollout status sts/&lt;sts-name&gt;$ kubectl rollout status sts redis-sts -n sts-nspartitioned roll out complete: 2 new pods have been updated... æŸ¥çœ‹å†å²ç‰ˆæœ¬ 1234# å‰é¢çš„åºå·è¡¨ç¤ºç‰ˆæœ¬å·kubectl rollout history sts redis-sts -n sts-ns# æŸ¥çœ‹æŒ‡å®šç‰ˆæœ¬çš„è¯¦æƒ…kubectl rollout history sts redis-sts -n sts-ns --revision=1 å›æ»š 1234# å›é€€åˆ°å‰ä¸€ä¸ªç‰ˆæœ¬kubectl rollout undo sts redis-sts -n sts-ns# å›åˆ°æŒ‡å®šç‰ˆæœ¬ï¼Œè¿™é‡Œ --to-revision=1 è¡¨ç¤ºå›åˆ°ç‰ˆæœ¬1kubectl rollout undo sts redis-sts -n sts-nsx --to-revision=1 Deployment å’Œ StatefulSet çš„å¯¹æ¯”æ€»ç»“ ç‰¹æ€§ Deployment StatefulSet ç”¨é€” æ— çŠ¶æ€åº”ç”¨ï¼ˆå¦‚ Web æœåŠ¡ã€API æœåŠ¡ï¼‰ æœ‰çŠ¶æ€åº”ç”¨ï¼ˆå¦‚æ•°æ®åº“ã€ç¼“å­˜ï¼šRedisã€MySQLã€Kafkaï¼‰ Pod åç§° Pod åå­—éšæœºç”Ÿæˆï¼Œå¦‚ nginx-abc123 Pod åå­—æœ‰åºï¼Œæ ¼å¼ä¸º name-0ã€name-1ã€name-2 ç¨³å®šçš„æ ‡è¯† ä¸æä¾›ï¼Œæ¯æ¬¡é‡å»º Pod åå­—å¯èƒ½ä¸åŒ æä¾›ï¼Œæ¯ä¸ª Pod çš„åå­—ã€ç½‘ç»œ IDã€å­˜å‚¨æŒä¹…åŒ–ä¸å˜ å­˜å‚¨å· é€šå¸¸é…åˆ PVCï¼Œä½† Pod é‡å»ºæ—¶æŒ‚è½½å·å¯èƒ½å˜åŒ– é…ç½® volumeClaimTemplatesï¼Œæ¯ä¸ª Pod ç‹¬ç«‹æŒä¹…å· æ»šåŠ¨æ›´æ–°ç­–ç•¥ æ”¯æŒ maxSurgeã€maxUnavailableï¼Œå¯å¹¶è¡Œæ›´æ–° Pod é»˜è®¤ é€ä¸ªé¡ºåºæ›´æ–° Podï¼ˆå¯ç”¨ partition æ§åˆ¶åˆ†æ‰¹æ›´æ–°ï¼‰ å¯ç”¨æ€§ é€šå¸¸è®¾è®¡ä¸º æ— çŠ¶æ€å¤šå‰¯æœ¬é«˜å¯ç”¨ï¼Œä¸ä¿è¯ Pod å¯åŠ¨é¡ºåºæˆ–å›ºå®š IP æœ‰çŠ¶æ€ä¸”æœ‰åºéƒ¨ç½²ã€åˆ é™¤ã€æ›´æ–°ï¼Œé€šå¸¸å•å‰¯æœ¬é€ä¸ªç»´æŠ¤å¯ç”¨æ€§ æœåŠ¡è®¿é—® é€šè¿‡ ClusterIPã€NodePortã€LoadBalancer è®¿é—® æ¨èç”¨ Headless Service (clusterIP: None)ï¼ŒPod æœ‰å›ºå®š DNS å…¸å‹åº”ç”¨åœºæ™¯ Web åº”ç”¨ã€REST APIã€æ— çŠ¶æ€å¾®æœåŠ¡ æ•°æ®åº“ï¼ˆMySQLã€PostgreSQLï¼‰ã€ç¼“å­˜ï¼ˆRedisï¼‰ã€é˜Ÿåˆ—ï¼ˆKafkaã€RabbitMQï¼‰ Pod ä¼¸ç¼©ç‰¹æ€§ çµæ´»ä¼¸ç¼©ï¼Œå¢åŠ /å‡å°‘å‰¯æœ¬æ— ç‰¹å®šé¡ºåº æœ‰åºä¼¸ç¼©ï¼Œname-0 -&gt; name-1 -&gt; name-2â€¦ é‡å»ºç­–ç•¥ Pod å´©æºƒåé‡å»ºçš„æ˜¯æ–° Podï¼Œæ— æŒä¹…å­˜å‚¨æ•°æ®å¯èƒ½ä¸¢å¤± Pod å´©æºƒåé‡å»ºçš„æ˜¯ç›¸åŒ Pod åå­—ï¼ŒæŒ‚è½½ç›¸åŒ PVCï¼Œä¸ä¸¢æ•°æ® åè®° StatefulSet ç±»ä¼¼äº Deploymentï¼ŒåŒæ ·æ”¯æŒæ‰©ç¼©å®¹ï¼ˆscale æˆ–è€… hpaï¼‰ï¼Œä½†å› ä¸ºå…¶æ˜¯æœ‰çŠ¶æ€çš„ï¼Œæ‰€ä»¥éœ€è°¨æ… 12345# scalekubectl scale sts redis-sts --replicas=5 -n sts-ns# hpaï¼Œè¦æ±‚podé…ç½®ä¸­æœ‰èµ„æºé™åˆ¶kubectl autoscale sts redis-sts --name=&quot;hpa-redis&quot; --cpu-percent=50 --min=3 --max=10 -n sts-ns æ“ä½œ å¯è¡Œæ€§ æ¨èæƒ…å†µ æ‰©å®¹ï¼ˆå¢åŠ å‰¯æœ¬æ•°ï¼‰ âœ… æ¨è å®‰å…¨ï¼Œæ–°å¢ Pod æŒ‰åºä» N-1 å¼€å§‹åˆ›å»ºï¼ˆsts-name-0 -&gt; sts-name-1 -&gt; sts-name-2ï¼‰ ç¼©å®¹ï¼ˆå‡å°‘å‰¯æœ¬æ•°ï¼‰ âš ï¸ å°å¿ƒä½¿ç”¨ å¯èƒ½å¯¼è‡´ Pod åŠå…¶å…³è” PVC è¢«åºŸå¼ƒï¼Œæ•°æ®å¯èƒ½ä¸¢å¤±","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» K8S çš„ Statefulset ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚ K8Så®˜ç½‘ k8s Github k8s Statefulset ä»‹ç»","date_published":"2025-07-20T15:30:05.000Z","tags":["æŠ€æœ¯","k8s","K8S"]},{"id":"https://blog.hanqunfeng.com/2025/07/20/k8s-hpa/","url":"https://blog.hanqunfeng.com/2025/07/20/k8s-hpa/","title":"K8S ä¹‹ Horizontal Pod Autoscalerï¼ˆHPAï¼‰","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç» K8S ä¸­çš„ Horizontal Pod Autoscalerï¼ˆHPAï¼‰ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://kubernetes.io/zh-cn/\">K8Så®˜ç½‘</a></p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://kubernetes.io/zh-cn/docs/concepts/workloads/autoscaling/\">Autoscaling k8sç®€ä»‹</a></p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://kubernetes.io/zh-cn/docs/tasks/run-application/horizontal-pod-autoscale/\">Horizontal Pod Autoscalerï¼ˆHPAï¼‰</a></p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"Horizontal-Pod-Autoscalerï¼ˆHPAï¼‰-ç®€ä»‹\">Horizontal Pod Autoscalerï¼ˆHPAï¼‰ ç®€ä»‹</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Horizontal Pod Autoscalerï¼ˆç¼©å†™ä¸º hpaï¼‰åŸºäºèµ„æº CPU åˆ©ç”¨ç‡è‡ªåŠ¨è°ƒæ•´ deploymentã€replication controller æˆ–è€… replica ä¸­ pod çš„æ•°é‡ï¼Œè¿™æœ‰åŠ©äºæ‚¨çš„åº”ç”¨ç¨‹åºè¿›è¡Œæ‰©å±•ä»¥æ»¡è¶³å¢é•¿çš„éœ€æ±‚ï¼Œæˆ–åœ¨ä¸éœ€è¦èµ„æºæ—¶è¿›è¡Œç¼©å‡ï¼Œä»è€Œé‡Šæ”¾å‡ºèŠ‚ç‚¹ç”¨äºå…¶ä»–åº”ç”¨ç¨‹åºã€‚å½“æ‚¨è®¾ç½®ç›®æ ‡ CPU åˆ©ç”¨ç‡ç™¾åˆ†æ¯”æ—¶ï¼ŒHPA æ‰©å±•æˆ–ç¼©å‡åº”ç”¨ç¨‹åºæ¥å°è¯•æ»¡è¶³è¯¥ç›®æ ‡ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>Kubernetes æœ¬èº«å·²ç»åŒ…å«äº† HPA çš„ controllerï¼Œæ‰€ä»¥ä¸éœ€è¦é¢å¤–çš„å®‰è£…æˆ–éƒ¨ç½²ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>HPA éœ€è¦è·å– metrics ä¿¡æ¯ï¼Œmetrics ä¿¡æ¯éœ€è¦ä» Metrics Server ä¸­è·å–ï¼Œæ‰€ä»¥éœ€è¦å…ˆå®‰è£… Metrics Serverã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>HPA ä¼šå‘¨æœŸæ€§(é»˜è®¤15ç§’)æŸ¥è¯¢ç›®æ ‡èµ„æºçš„ä½¿ç”¨æƒ…å†µï¼Œç„¶åå’Œ HPA ä¸­å®šä¹‰çš„å€¼åšæ¯”è¾ƒï¼Œå¹¶æ ¹æ®æ¯”è¾ƒç»“æœç›¸åº”çš„è°ƒæ•´ pod æ•°é‡ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>åˆ›å»ºpodæ—¶ï¼Œå¿…é¡»ä¸ºå…¶è®¾å®šcpuèµ„æºï¼Œç”¨äºä¸ç›®æ ‡å€¼è¿›è¡Œæ¯”è¾ƒï¼Œç›®å‰æœ€æ–°çš„v2ç‰ˆæœ¬çš„HPAé™¤äº†æ”¯æŒCPUçš„å¯¹æ¯”ï¼Œè¿˜å¯ä»¥è®¾å®šå…¶å®ƒæŒ‡æ ‡ï¼Œå…·ä½“å‚è€ƒ<a href=\"https://kubernetes.io/zh-cn/docs/tasks/run-application/horizontal-pod-autoscale-walkthrough/\">HorizontalPodAutoscaler æ¼”ç»ƒ</a>ä¸­çš„â€œåŸºäºå¤šé¡¹åº¦é‡æŒ‡æ ‡å’Œè‡ªå®šä¹‰åº¦é‡æŒ‡æ ‡è‡ªåŠ¨æ‰©ç¼©â€ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>åšä¸»ä¹‹å‰å†™è¿‡ä¸€ç¯‡åœ¨awsçš„eksä¸­ä½¿ç”¨hpaçš„æ–‡ç«  <a href=\"/2023/07/17/aws-eks17-hpa/\" title=\"AWS-EKS-17--Horizontal Pod Autoscalerï¼ˆHPAï¼‰\">AWS-EKS-17--Horizontal Pod Autoscalerï¼ˆHPAï¼‰</a>ï¼Œå’Œåœ¨è‡ªå·±æ­å»º k8sé›†ç¾¤ ä¸­ä½¿ç”¨ hpa åŸºæœ¬ä¸€è‡´ï¼Œæ‰€ä»¥æœ¬æ–‡ä¸å†å¯¹é‡å¤å†…å®¹è¿›è¡Œèµ˜è¿°ï¼Œå»ºè®®è¯»è€…å…ˆé˜…è¯» <a href=\"/2023/07/17/aws-eks17-hpa/\" title=\"AWS-EKS-17--Horizontal Pod Autoscalerï¼ˆHPAï¼‰\">AWS-EKS-17--Horizontal Pod Autoscalerï¼ˆHPAï¼‰</a>ã€‚</p>\n</li>\n</ul>\n<h2 id=\"å®‰è£…-Metrics-Server\">å®‰è£… Metrics Server</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Kubernetes çš„ HPA æ˜¯ä¾èµ– Metrics API çš„ï¼Œé»˜è®¤å¹¶ä¸å†…ç½®ã€‚éœ€è¦é€šè¿‡ metrics-server æ¥æ”¶é›†å’Œæä¾›èŠ‚ç‚¹/Pod çš„èµ„æºç”¨é‡æ•°æ®ï¼ˆCPUã€å†…å­˜ç­‰ï¼‰ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å®‰è£… <a href=\"https://github.com/kubernetes-sigs/metrics-server\">metrics-server</a></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ curl -L -o metrics-server.yaml https://github.com/kubernetes-sigs/metrics-server/releases/latest/download/components.yaml</span><br><span class=\"line\">$ kubectl apply -f metrics-server.yaml</span><br><span class=\"line\">serviceaccount/metrics-server created</span><br><span class=\"line\">clusterrole.rbac.authorization.k8s.io/system:aggregated-metrics-reader created</span><br><span class=\"line\">clusterrole.rbac.authorization.k8s.io/system:metrics-server created</span><br><span class=\"line\">rolebinding.rbac.authorization.k8s.io/metrics-server-auth-reader created</span><br><span class=\"line\">clusterrolebinding.rbac.authorization.k8s.io/metrics-server:system:auth-delegator created</span><br><span class=\"line\">clusterrolebinding.rbac.authorization.k8s.io/system:metrics-server created</span><br><span class=\"line\">service/metrics-server created</span><br><span class=\"line\">deployment.apps/metrics-server created</span><br><span class=\"line\">apiservice.apiregistration.k8s.io/v1beta1.metrics.k8s.io created</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>éƒ¨ç½²åå‘ç°podæ²¡æœ‰è¿è¡ŒæˆåŠŸ</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$  k get all -n kube-system -l k8s-app=metrics-server</span><br><span class=\"line\">NAME                                  READY   STATUS    RESTARTS   AGE</span><br><span class=\"line\">pod/metrics-server-867d48dc9c-fgdjq   0/1     Running   0          16s</span><br><span class=\"line\"></span><br><span class=\"line\">NAME                     TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)   AGE</span><br><span class=\"line\">service/metrics-server   ClusterIP   10.96.91.221   &lt;none&gt;        443/TCP   16s</span><br><span class=\"line\"></span><br><span class=\"line\">NAME                             READY   UP-TO-DATE   AVAILABLE   AGE</span><br><span class=\"line\">deployment.apps/metrics-server   0/1     1            0           16s</span><br><span class=\"line\"></span><br><span class=\"line\">NAME                                        DESIRED   CURRENT   READY   AGE</span><br><span class=\"line\">replicaset.apps/metrics-server-867d48dc9c   1         1         0       16s</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ£€æŸ¥æ—¥å¿—</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ k logs deployment.apps/metrics-server -n kube-system</span><br><span class=\"line\"><span class=\"comment\">## è¾“å‡ºç±»ä¼¼äº</span></span><br><span class=\"line\">E0703 23:02:38.120831       1 scraper.go:149] <span class=\"string\">&quot;Failed to scrape node&quot;</span> err=<span class=\"string\">&quot;Get \\&quot;https://10.211.55.15:10250/metrics/resource\\&quot;: tls: failed to verify certificate: x509: cannot validate certificate for 10.211.55.15 because it doesn&#x27;t contain any IP SANs&quot;</span> node=<span class=\"string\">&quot;k8s-worker1&quot;</span></span><br><span class=\"line\">E0703 23:02:38.127774       1 scraper.go:149] <span class=\"string\">&quot;Failed to scrape node&quot;</span> err=<span class=\"string\">&quot;Get \\&quot;https://10.211.55.16:10250/metrics/resource\\&quot;: tls: failed to verify certificate: x509: cannot validate certificate for 10.211.55.16 because it doesn&#x27;t contain any IP SANs&quot;</span> node=<span class=\"string\">&quot;k8s-worker2&quot;</span></span><br><span class=\"line\">E0703 23:02:38.140583       1 scraper.go:149] <span class=\"string\">&quot;Failed to scrape node&quot;</span> err=<span class=\"string\">&quot;Get \\&quot;https://10.211.55.11:10250/metrics/resource\\&quot;: tls: failed to verify certificate: x509: cannot validate certificate for 10.211.55.11 because it doesn&#x27;t contain any IP SANs&quot;</span> node=<span class=\"string\">&quot;k8s-master&quot;</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ„æ€æ˜¯ metrics-server åœ¨é€šè¿‡ https://<node-ip>:10250 è¯·æ±‚ kubelet çš„æ—¶å€™ï¼Œå‘ç° kubelet çš„è¯ä¹¦ä¸åŒ…å«è¯¥ IP çš„ Subject Alternative Name (SAN)ï¼Œå› æ­¤ TLS æ ¡éªŒå¤±è´¥ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>è§£å†³æ–¹æ¡ˆ: æ·»åŠ  --kubelet-insecure-tls å‚æ•°ï¼Œè·³è¿‡ kubelet çš„ TLS è¯ä¹¦æ ¡éªŒ(metrics-server æœ¬èº«æƒé™æœ‰é™ï¼Œé£é™©å¯æ§ï¼Œkubelet è‡ªç­¾è¯ä¹¦ç»´æŠ¤æˆæœ¬é«˜)</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl edit deployment metrics-server -n kube-system</span><br><span class=\"line\"><span class=\"comment\">## åœ¨ args ä¸­æ·»åŠ  --kubelet-insecure-tls</span></span><br><span class=\"line\">  spec:</span><br><span class=\"line\">    containers:</span><br><span class=\"line\">    - args:</span><br><span class=\"line\">      - --cert-dir=/tmp</span><br><span class=\"line\">      - --secure-port=10250</span><br><span class=\"line\">      - --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname</span><br><span class=\"line\">      - --kubelet-use-node-status-port</span><br><span class=\"line\">      - --metric-resolution=15s</span><br><span class=\"line\">      - --kubelet-insecure-tls   <span class=\"comment\"># æ·»åŠ æ­¤è¡Œ</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><code>wq</code>ä¿å­˜åï¼Œç­‰ä¸€ä¼šå†æ¬¡æŸ¥çœ‹æ‰€æœ‰èµ„æºå‡å·²æ­£å¸¸</p>\n</li>\n<li class=\"lvl-2\">\n<p>æŸ¥çœ‹æ‰€æœ‰ node çš„èµ„æº</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ k top nodes</span><br><span class=\"line\">NAME          CPU(cores)   CPU(%)   MEMORY(bytes)   MEMORY(%)</span><br><span class=\"line\">k8s-master    216m         10%      1712Mi          44%</span><br><span class=\"line\">k8s-worker1   79m          3%       1025Mi          26%</span><br><span class=\"line\">k8s-worker2   82m          4%       982Mi           25%</span><br></pre></td></tr></table></figure>\n<table>\n<thead>\n<tr>\n<th>å­—æ®µ</th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>NAME</strong></td>\n<td>èŠ‚ç‚¹åç§°ï¼ŒKubernetes é›†ç¾¤çš„èŠ‚ç‚¹åå­—ã€‚</td>\n</tr>\n<tr>\n<td><strong>CPU(cores)</strong></td>\n<td>å½“å‰èŠ‚ç‚¹ CPU çš„ç¬æ—¶ä½¿ç”¨é‡ï¼Œå•ä½æ˜¯æ ¸å¿ƒæ•°ï¼ˆCoreï¼‰ï¼Œæ¯”å¦‚ <code>216m</code> = 0.216 æ ¸å¿ƒã€‚<code>m</code> = <strong>millicores</strong>ï¼Œ1000m = 1æ ¸ã€‚</td>\n</tr>\n<tr>\n<td><strong>CPU(%)</strong></td>\n<td>å½“å‰ CPU ä½¿ç”¨ç‡ï¼Œç›¸å¯¹äºè¯¥èŠ‚ç‚¹ CPU æ€»æ ¸æ•°çš„ç™¾åˆ†æ¯”ã€‚æ¯”å¦‚ <code>10%</code> è¡¨ç¤ºèŠ‚ç‚¹ CPU çš„ 10% è¢«ä½¿ç”¨ã€‚</td>\n</tr>\n<tr>\n<td><strong>MEMORY(bytes)</strong></td>\n<td>èŠ‚ç‚¹å½“å‰ä½¿ç”¨çš„å†…å­˜ï¼Œå•ä½æ˜¯å­—èŠ‚ï¼ˆä¾‹å¦‚ <code>1712Mi</code> = 1712 Mebibytes â‰ˆ 1.7 GBï¼‰ã€‚</td>\n</tr>\n<tr>\n<td><strong>MEMORY(%)</strong></td>\n<td>èŠ‚ç‚¹å†…å­˜ä½¿ç”¨ç‡ï¼Œå æ€»å†…å­˜çš„ç™¾åˆ†æ¯”ã€‚æ¯”å¦‚ <code>44%</code> è¡¨ç¤ºè¯¥èŠ‚ç‚¹å†…å­˜ä½¿ç”¨äº† 44%ã€‚</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æŸ¥çœ‹æ‰€æœ‰ pod çš„èµ„æº</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ k top pods -A</span><br><span class=\"line\">NAMESPACE     NAME                                       CPU(cores)   MEMORY(bytes)</span><br><span class=\"line\">default       nginx-5869d7778c-5682r                     0m           9Mi</span><br><span class=\"line\">default       nginx-5869d7778c-thw8f                     0m           4Mi</span><br><span class=\"line\">kube-system   calico-kube-controllers-7bfdc5b57c-q5xwp   6m           35Mi</span><br><span class=\"line\">kube-system   calico-node-7pbbq                          42m          281Mi</span><br><span class=\"line\">kube-system   calico-node-v4hzr                          47m          260Mi</span><br><span class=\"line\">kube-system   calico-node-w47qq                          40m          263Mi</span><br><span class=\"line\">kube-system   coredns-674b8bbfcf-2tvld                   2m           23Mi</span><br><span class=\"line\">kube-system   coredns-674b8bbfcf-h6kx7                   2m           22Mi</span><br><span class=\"line\">kube-system   etcd-k8s-master                            27m          85Mi</span><br><span class=\"line\">kube-system   kube-apiserver-k8s-master                  49m          404Mi</span><br><span class=\"line\">kube-system   kube-controller-manager-k8s-master         28m          100Mi</span><br><span class=\"line\">kube-system   kube-proxy-nkbns                           1m           41Mi</span><br><span class=\"line\">kube-system   kube-proxy-plqw8                           1m           25Mi</span><br><span class=\"line\">kube-system   kube-proxy-sbgh6                           1m           34Mi</span><br><span class=\"line\">kube-system   kube-scheduler-k8s-master                  8m           38Mi</span><br><span class=\"line\">kube-system   metrics-server-56fb9549f4-rtt7n            4m           21Mi</span><br></pre></td></tr></table></figure>\n<h2 id=\"åˆ›å»º-HPA\">åˆ›å»º HPA</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å‰é¢çš„æ–‡ç« ä¸­å¤šæ¬¡ä½¿ç”¨ nginx é•œåƒåˆ›å»ºäº† deploymentï¼Œä½†æ˜¯éƒ½æ²¡æœ‰é…ç½®è¿‡èµ„æºï¼Œä¸ºäº†æµ‹è¯• hpaï¼Œéœ€è¦ä¸ºå…¶æŒ‡å®šèµ„æº</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ç›´æ¥ä¿®æ”¹ deploymentï¼Œæ”¹å˜ spec.templateï¼ŒPod ä¼šè¢«é‡å»ºã€‚ä¿å­˜åç«‹åˆ»ç”Ÿæ•ˆ</span></span><br><span class=\"line\">kubectl edit deployment nginx</span><br><span class=\"line\"><span class=\"comment\"># å¢åŠ èµ„æºé™åˆ¶</span></span><br><span class=\"line\">spec:</span><br><span class=\"line\">  replicas: 1   <span class=\"comment\"># ä¿®æ”¹å‰¯æœ¬æ•°ä½ 1ï¼Œä»…æ”¹å˜ replicasï¼ŒPod ä¸ä¼šè¢«é‡å»º</span></span><br><span class=\"line\">  template:     <span class=\"comment\"># ä¿®æ”¹ templateï¼ŒPod ä¼šè¢«é‡å»º</span></span><br><span class=\"line\">    metadata:</span><br><span class=\"line\">      labels:</span><br><span class=\"line\">        app: nginx</span><br><span class=\"line\">    spec:</span><br><span class=\"line\">      containers:</span><br><span class=\"line\">      - name: nginx</span><br><span class=\"line\">        image: nginx</span><br><span class=\"line\">        resources:</span><br><span class=\"line\">          limits:</span><br><span class=\"line\">            cpu: 500m</span><br><span class=\"line\">            memory: 500Mi</span><br><span class=\"line\">          requests:</span><br><span class=\"line\">            cpu: 200m</span><br><span class=\"line\">            memory: 200Mi</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å‘½ä»¤è¡Œåˆ›å»º HPA</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åˆ›å»ºäº†ä¸€ä¸ªå«â€œhpa-nginxâ€çš„ HPAï¼Œé»˜è®¤ä¸ deployment çš„åç§°ç›¸åŒï¼Œå¯ä»¥ç”¨ --name=&#x27;hpa-nginx&#x27; æŒ‡å®šhpaçš„åç§°</span></span><br><span class=\"line\"><span class=\"comment\"># replicas å˜åŠ¨èŒƒå›´æ˜¯æœ€å° 3ï¼Œæœ€å¤§ 10</span></span><br><span class=\"line\"><span class=\"comment\"># ç›®æ ‡cpuåˆ©ç”¨ç‡ä¸º 50%ï¼Œä¸Šé¢æˆ‘ä»¬è®¾å®š CPU request å€¼ä¸º 100mï¼Œæ‰€ä»¥å½“å¹³å‡cpuå€¼ä¸º 100m æ—¶å°±ä¼šè§¦å‘ autoscale</span></span><br><span class=\"line\"><span class=\"comment\"># è¿™é‡Œè¯´å¹³å‡cpuï¼Œæ˜¯æŒ‡æ‰€æœ‰podçš„cpuåˆ©ç”¨ç‡çš„å¹³å‡å€¼</span></span><br><span class=\"line\">$ k autoscale deployment nginx --name=<span class=\"string\">&quot;hpa-nginx&quot;</span> --cpu-percent=50 --min=3 --max=10</span><br><span class=\"line\">horizontalpodautoscaler.autoscaling/hpa-nginx autoscaled</span><br><span class=\"line\"><span class=\"comment\"># è§‚å¯Ÿï¼Œå¤§çº¦ 15ç§’åï¼Œhpa-nginx å‘ç° replicas å€¼ä¸º1ï¼Œ30ç§’çš„æ—¶å€™è‡ªåŠ¨æ‰©å®¹åˆ°3ä¸ªï¼Œå› ä¸ºæˆ‘ä»¬è®¾ç½®çš„hpaçš„replicasæœ€å°å€¼ä¸º3ï¼Œå¹¶ä¸”é‡‡é›†åˆ°äº†cpuä½¿ç”¨ç‡</span></span><br><span class=\"line\">$ k get hpa -w</span><br><span class=\"line\">NAME        REFERENCE          TARGETS              MINPODS   MAXPODS   REPLICAS   AGE</span><br><span class=\"line\">hpa-nginx   Deployment/nginx   cpu: &lt;unknown&gt;/50%   3         10        0          0s</span><br><span class=\"line\">hpa-nginx   Deployment/nginx   cpu: &lt;unknown&gt;/50%   3         10        1          15s</span><br><span class=\"line\">hpa-nginx   Deployment/nginx   cpu: 0%/50%          3         10        3          30s</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ymalæ–‡ä»¶åˆ›å»º HPA</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">autoscaling/v2</span>    <span class=\"comment\"># apiç‰ˆæœ¬ï¼Œè¿™é‡Œè®¾ç½®ä¸º v2</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">HorizontalPodAutoscaler</span> <span class=\"comment\"># èµ„æºç±»å‹</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">hpa-nginx</span>             <span class=\"comment\"># hpaèµ„æºåç§°</span></span><br><span class=\"line\">  <span class=\"attr\">namespace:</span> <span class=\"string\">default</span>          <span class=\"comment\"># å‘½åç©ºé—´</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">maxReplicas:</span> <span class=\"number\">10</span>             <span class=\"comment\"># æœ€å¤§å‰¯æœ¬æ•°</span></span><br><span class=\"line\">  <span class=\"attr\">minReplicas:</span> <span class=\"number\">1</span>              <span class=\"comment\"># æœ€å°å‰¯æœ¬æ•°</span></span><br><span class=\"line\">  <span class=\"attr\">metrics:</span>                    <span class=\"comment\"># æŒ‡æ ‡è®¾å®š</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">type:</span> <span class=\"string\">Resource</span>            <span class=\"comment\"># èµ„æºç±»å‹ï¼Œå¯ä»¥é…ç½®ä¸º Resource/Object/Pods</span></span><br><span class=\"line\">    <span class=\"attr\">resource:</span>                 <span class=\"comment\"># èµ„æºå¯¹è±¡</span></span><br><span class=\"line\">      <span class=\"attr\">name:</span> <span class=\"string\">cpu</span>               <span class=\"comment\"># èµ„æºåç§° cpu/memory</span></span><br><span class=\"line\">      <span class=\"attr\">target:</span>                 <span class=\"comment\"># ç›®æ ‡å¯¹è±¡</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">Utilization</span>     <span class=\"comment\"># ç›®æ ‡ç±»å‹ï¼Œå¯ä»¥é…ç½®ä¸º Utilization/AverageValue/Value</span></span><br><span class=\"line\">        <span class=\"attr\">averageUtilization:</span> <span class=\"number\">50</span> <span class=\"comment\"># ç›®æ ‡å€¼ï¼Œè¿™é‡Œæ˜¯å¹³å‡ä½¿ç”¨ç‡çš„ç™¾åˆ†æ¯”</span></span><br><span class=\"line\">  <span class=\"attr\">scaleTargetRef:</span>             <span class=\"comment\"># æŒ‡å®šè¦è‡ªåŠ¨ä¼¸ç¼©çš„èµ„æºå¯¹è±¡</span></span><br><span class=\"line\">    <span class=\"attr\">apiVersion:</span> <span class=\"string\">apps/v1</span></span><br><span class=\"line\">    <span class=\"attr\">kind:</span> <span class=\"string\">Deployment</span>          <span class=\"comment\"># èµ„æºç±»å‹ä¸º Deployment</span></span><br><span class=\"line\">    <span class=\"attr\">name:</span> <span class=\"string\">nginx</span>               <span class=\"comment\"># èµ„æºåç§°ä¸º nginx</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"HPA-æ”¯æŒçš„ç›‘æ§æŒ‡æ ‡ç±»å‹\">HPA æ”¯æŒçš„ç›‘æ§æŒ‡æ ‡ç±»å‹</h2>\n<table>\n<thead>\n<tr>\n<th>ç±»å‹</th>\n<th>å­—æ®µå</th>\n<th>è¯´æ˜</th>\n<th>å¸¸è§ç”¨é€”</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>Resource</strong></td>\n<td><code>resource</code></td>\n<td>åŸºäº Pod èµ„æºä½¿ç”¨æƒ…å†µï¼ˆCPUã€å†…å­˜ï¼‰ï¼Œæœ€å¸¸ç”¨</td>\n<td>æŒ‰ CPU åˆ©ç”¨ç‡è‡ªåŠ¨æ‰©ç¼©å®¹</td>\n</tr>\n<tr>\n<td><strong>Pods</strong></td>\n<td><code>pods</code></td>\n<td>åŸºäºæ¯ä¸ª Pod çš„è‡ªå®šä¹‰åº¦é‡æŒ‡æ ‡çš„å¹³å‡å€¼ï¼Œéœ€è¦ç¬¬ä¸‰æ–¹ç›‘æ§ç³»ç»Ÿæä¾›ï¼Œæ¯”å¦‚ Prometheus</td>\n<td>æŒ‰ä¸šåŠ¡æŒ‡æ ‡ï¼ˆå¦‚è¯·æ±‚æ•°ã€é˜Ÿåˆ—é•¿åº¦ï¼‰æ‰©ç¼©å®¹</td>\n</tr>\n<tr>\n<td><strong>Object</strong></td>\n<td><code>object</code></td>\n<td>åŸºäºå•ä¸ª Kubernetes å¯¹è±¡ï¼ˆå¦‚ Serviceã€Ingressï¼‰çš„æŒ‡æ ‡ï¼Œï¼Œæ¯”å¦‚ Prometheus</td>\n<td>æŒ‰æŸä¸ªå¯¹è±¡çš„æŒ‡æ ‡æ‰©ç¼©å®¹ï¼Œä¾‹å¦‚é˜Ÿåˆ—é•¿åº¦</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"Resource-èµ„æºæŒ‡æ ‡ï¼ˆCPU-å†…å­˜ï¼‰\">Resource èµ„æºæŒ‡æ ‡ï¼ˆCPU/å†…å­˜ï¼‰</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Utilization: åˆ©ç”¨ç‡ç™¾åˆ†æ¯”</p>\n</li>\n<li class=\"lvl-2\">\n<p>Utilization ä¸å…³å¿ƒ limitsï¼Œåªçœ‹ requestsã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å¦‚æœ resources.requests æ²¡æœ‰è®¾ç½®ï¼ŒHPA Utilization ä¼šæŠ¥é”™ï¼ˆé™¤é AverageValueï¼‰ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">metrics:</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">type:</span> <span class=\"string\">Resource</span></span><br><span class=\"line\">  <span class=\"attr\">resource:</span>                   <span class=\"comment\"># èµ„æº æŒ‡æ ‡</span></span><br><span class=\"line\">    <span class=\"attr\">name:</span> <span class=\"string\">cpu</span>                 <span class=\"comment\"># cpu</span></span><br><span class=\"line\">    <span class=\"attr\">target:</span></span><br><span class=\"line\">      <span class=\"attr\">type:</span> <span class=\"string\">Utilization</span>       <span class=\"comment\"># åˆ©ç”¨ç‡ç™¾åˆ†æ¯”</span></span><br><span class=\"line\">      <span class=\"attr\">averageUtilization:</span> <span class=\"number\">50</span>  <span class=\"comment\"># 50%</span></span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>å½“å‰æœ‰ 3 ä¸ª Podï¼š</p>\n</blockquote>\n<table>\n<thead>\n<tr>\n<th>Pod</th>\n<th>CPU å®é™…ä½¿ç”¨</th>\n<th>CPU requests</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>pod-1</td>\n<td>150m</td>\n<td>200m</td>\n</tr>\n<tr>\n<td>pod-2</td>\n<td>100m</td>\n<td>200m</td>\n</tr>\n<tr>\n<td>pod-3</td>\n<td>50m</td>\n<td>200m</td>\n</tr>\n<tr>\n<td>åˆè®¡</td>\n<td>400m</td>\n<td>600m</td>\n</tr>\n<tr>\n<td><strong>å¹³å‡</strong></td>\n<td><strong>400m Ã· 600m Ã— 100% â‰ˆ 66.7%</strong></td>\n<td></td>\n</tr>\n</tbody>\n</table>\n<blockquote>\n<p>ç”±äº 66.7% &gt; 50%ï¼Œä¼šæ‰©å®¹ï¼›å¦‚æœå°äº 50%ï¼ŒHPA ä¼šç¼©å®¹ã€‚</p>\n</blockquote>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>AverageValue: æŒ‡å®šèµ„æºä½¿ç”¨å¹³å‡å€¼</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">metrics:</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">type:</span> <span class=\"string\">Resource</span></span><br><span class=\"line\">  <span class=\"attr\">resource:</span></span><br><span class=\"line\">    <span class=\"attr\">name:</span> <span class=\"string\">memory</span>                <span class=\"comment\"># ç›‘æ§èµ„æºç±»å‹ä¸º memoryï¼ˆå†…å­˜ï¼‰</span></span><br><span class=\"line\">    <span class=\"attr\">target:</span></span><br><span class=\"line\">      <span class=\"attr\">type:</span> <span class=\"string\">AverageValue</span>        <span class=\"comment\"># æŒ‡æ ‡ç±»å‹ä¸º AverageValueï¼Œè¡¨ç¤ºæ¯ä¸ª Pod å¹³å‡ä½¿ç”¨å¤šå°‘</span></span><br><span class=\"line\">      <span class=\"attr\">averageValue:</span> <span class=\"string\">400Mi</span>       <span class=\"comment\"># ç›®æ ‡å€¼ï¼šå¹³å‡æ¯ä¸ª Pod ä½¿ç”¨ 400Mi å†…å­˜</span></span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>å‡è®¾å½“å‰éƒ¨ç½²äº† 3 ä¸ªå‰¯æœ¬ï¼Œå†…å­˜ä½¿ç”¨æƒ…å†µå¦‚ä¸‹ï¼š</p>\n</blockquote>\n<table>\n<thead>\n<tr>\n<th>Pod</th>\n<th>å½“å‰å†…å­˜ä½¿ç”¨</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>pod-1</td>\n<td>450Mi</td>\n</tr>\n<tr>\n<td>pod-2</td>\n<td>400Mi</td>\n</tr>\n<tr>\n<td>pod-3</td>\n<td>300Mi</td>\n</tr>\n<tr>\n<td><strong>å¹³å‡</strong></td>\n<td><strong>(450+400+300)/3 = 383.3Mi</strong></td>\n</tr>\n</tbody>\n</table>\n<blockquote>\n<p>å› ä¸º 383.3Mi &lt; 400Miï¼Œä¸è§¦å‘æ‰©å®¹ã€‚å¦‚æœå°†æ¥å¹³å‡ä½¿ç”¨è¶…è¿‡ 400Miï¼ŒHPA å°±ä¼šæ‰©å®¹ï¼Œåä¹‹ç¼©å®¹ã€‚</p>\n</blockquote>\n<h2 id=\"HPA-æ‰©ç¼©å®¹é€Ÿåº¦é…ç½®\">HPA æ‰©ç¼©å®¹é€Ÿåº¦é…ç½®</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>HPA çš„æ‰©ç¼©å®¹é€Ÿåº¦æ˜¯å¯ä»¥æ§åˆ¶çš„ï¼Œé€šè¿‡ behavior å­—æ®µæ¥è‡ªå®šä¹‰æ‰©ç¼©å®¹çš„é€Ÿåº¦å’Œç­–ç•¥ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä»¥ä¸‹æ˜¯é»˜è®¤ç­–ç•¥</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">behavior:</span></span><br><span class=\"line\">  <span class=\"attr\">scaleUp:</span>                                  <span class=\"comment\"># â¬†ï¸ æ‰©å®¹ç­–ç•¥</span></span><br><span class=\"line\">    <span class=\"attr\">tolerance:</span> <span class=\"number\">0.1</span>                          <span class=\"comment\"># å®¹å¿é˜ˆå€¼ï¼Œé»˜è®¤0.1(10%)ï¼Œè¡¨ç¤ºæ¯æ¬¡æ‰©å®¹æ—¶ï¼Œpodä½¿ç”¨ç‡è¶…è¿‡1.1å€ç›®æ ‡å€¼æ—¶æ‰ä¼šè¿›è¡Œæ‰©å®¹</span></span><br><span class=\"line\">    <span class=\"attr\">stabilizationWindowSeconds:</span> <span class=\"number\">0</span>           <span class=\"comment\"># é»˜è®¤0ï¼Œå³å¢åŠ æˆ–å‡å°‘podæ•°é‡åä¿æŒä¸å˜çš„æ—¶é—´ï¼Œå•ä½ä¸ºç§’</span></span><br><span class=\"line\">    <span class=\"attr\">policies:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">type:</span> <span class=\"string\">Percent</span>                         <span class=\"comment\"># æ‰©å®¹é€Ÿåº¦æŒ‰ç™¾åˆ†æ¯”é™åˆ¶</span></span><br><span class=\"line\">      <span class=\"attr\">value:</span> <span class=\"number\">100</span>                            <span class=\"comment\"># æ¯ 15 ç§’æœ€å¤šæ‰©å®¹ 100% çš„å‰¯æœ¬æ•°</span></span><br><span class=\"line\">      <span class=\"attr\">periodSeconds:</span> <span class=\"number\">15</span>                     <span class=\"comment\"># æ¯ 15 ç§’è®¡ç®—ä¸€æ¬¡æ˜¯å¦å¯ä»¥æ‰©å®¹ï¼Œé»˜è®¤ 15 ç§’</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">type:</span> <span class=\"string\">Pods</span>                            <span class=\"comment\"># æŒ‰å›ºå®š Pod æ•°é‡é™åˆ¶æ‰©å®¹é€Ÿåº¦</span></span><br><span class=\"line\">      <span class=\"attr\">value:</span> <span class=\"number\">4</span>                              <span class=\"comment\"># æ¯ 15 ç§’æœ€å¤šæ‰©å®¹ 4 ä¸ª Pod</span></span><br><span class=\"line\">      <span class=\"attr\">periodSeconds:</span> <span class=\"number\">15</span>                     <span class=\"comment\"># åŒæ · 15 ç§’è®¡ç®—ä¸€æ¬¡ï¼Œé»˜è®¤ 15 ç§’</span></span><br><span class=\"line\">    <span class=\"attr\">selectPolicy:</span> <span class=\"string\">Max</span>                       <span class=\"comment\"># å¤šä¸ª policy åŒæ—¶å­˜åœ¨æ—¶ï¼Œå– Percent å’Œ Pods çš„æœ€å¤§å€¼ã€‚Min å–æœ€å°å€¼</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"attr\">scaleDown:</span>                                <span class=\"comment\"># â¬‡ï¸ ç¼©å®¹ç­–ç•¥</span></span><br><span class=\"line\">    <span class=\"comment\"># selectPolicy: Disabled                  # ç¦ç”¨ç¼©å®¹</span></span><br><span class=\"line\">    <span class=\"attr\">stabilizationWindowSeconds:</span> <span class=\"number\">300</span>         <span class=\"comment\"># é»˜è®¤ 300ï¼Œå³å¢åŠ æˆ–å‡å°‘podæ•°é‡åä¿æŒä¸å˜çš„æ—¶é—´ï¼Œå•ä½ä¸ºç§’ï¼Œé˜²æ­¢å¿«é€Ÿç¼©å®¹ï¼ˆå¹³æ»‘ç­–ç•¥ï¼‰</span></span><br><span class=\"line\">    <span class=\"attr\">policies:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">type:</span> <span class=\"string\">Percent</span>                         <span class=\"comment\"># ç¼©å®¹é€Ÿåº¦æŒ‰ç™¾åˆ†æ¯”é™åˆ¶</span></span><br><span class=\"line\">      <span class=\"attr\">value:</span> <span class=\"number\">100</span>                            <span class=\"comment\"># æ¯ 15 ç§’æœ€å¤šç¼©å®¹ 100% çš„å‰¯æœ¬æ•°</span></span><br><span class=\"line\">      <span class=\"attr\">periodSeconds:</span> <span class=\"number\">15</span>                     <span class=\"comment\"># æ¯ 15 ç§’è¯„ä¼°ä¸€æ¬¡æ˜¯å¦å¯ä»¥ç¼©å®¹</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å®Œæ•´çš„ HPA é…ç½®æ–‡ä»¶ç¤ºä¾‹(ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æ— éœ€ä¿®æ”¹æ‰©ç¼©å®¹é€Ÿåº¦çš„é…ç½®ï¼Œé»˜è®¤ç­–ç•¥æ»¡è¶³å¤§éƒ¨åˆ†åœºæ™¯)</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">autoscaling/v2</span>                    <span class=\"comment\"># apiç‰ˆæœ¬ï¼Œä½¿ç”¨ v2 ç‰ˆæœ¬æ”¯æŒ behavior æ‰©ç¼©å®¹ç­–ç•¥</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">HorizontalPodAutoscaler</span>                 <span class=\"comment\"># èµ„æºç±»å‹ä¸º HPA</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">hpa-nginx</span>                             <span class=\"comment\"># HPA èµ„æºçš„åç§°</span></span><br><span class=\"line\">  <span class=\"attr\">namespace:</span> <span class=\"string\">default</span>                          <span class=\"comment\"># å‘½åç©ºé—´ï¼Œè®¾ç½®ä¸º default</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">maxReplicas:</span> <span class=\"number\">10</span>                             <span class=\"comment\"># HPA è‡ªåŠ¨æ‰©å®¹çš„æœ€å¤§å‰¯æœ¬æ•°</span></span><br><span class=\"line\">  <span class=\"attr\">minReplicas:</span> <span class=\"number\">1</span>                              <span class=\"comment\"># HPA è‡ªåŠ¨ç¼©å®¹çš„æœ€å°å‰¯æœ¬æ•°</span></span><br><span class=\"line\">  <span class=\"attr\">metrics:</span>                                    <span class=\"comment\"># è‡ªåŠ¨ä¼¸ç¼©çš„æŒ‡æ ‡é…ç½®</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">type:</span> <span class=\"string\">Resource</span>                            <span class=\"comment\"># æŒ‡æ ‡ç±»å‹ä¸º Resourceï¼ˆèµ„æºå‹ï¼‰</span></span><br><span class=\"line\">    <span class=\"attr\">resource:</span>                                 <span class=\"comment\"># èµ„æºæŒ‡æ ‡å¯¹è±¡</span></span><br><span class=\"line\">      <span class=\"attr\">name:</span> <span class=\"string\">cpu</span>                               <span class=\"comment\"># èµ„æºåç§°ä¸º cpuï¼Œä¹Ÿå¯ä»¥è®¾ç½®ä¸º memory</span></span><br><span class=\"line\">      <span class=\"attr\">target:</span>                                 <span class=\"comment\"># ç›®æ ‡æŒ‡æ ‡å¯¹è±¡</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">Utilization</span>                     <span class=\"comment\"># æŒ‡æ ‡ç±»å‹ä¸º Utilizationï¼ˆåˆ©ç”¨ç‡ç™¾åˆ†æ¯”ï¼‰</span></span><br><span class=\"line\">        <span class=\"attr\">averageUtilization:</span> <span class=\"number\">50</span>                <span class=\"comment\"># CPU å¹³å‡ä½¿ç”¨ç‡è¾¾åˆ° 50% æ—¶è¿›è¡Œæ‰©ç¼©å®¹</span></span><br><span class=\"line\">  <span class=\"attr\">scaleTargetRef:</span>                             <span class=\"comment\"># HPA ç»‘å®šçš„ç›®æ ‡èµ„æºå¯¹è±¡</span></span><br><span class=\"line\">    <span class=\"attr\">apiVersion:</span> <span class=\"string\">apps/v1</span></span><br><span class=\"line\">    <span class=\"attr\">kind:</span> <span class=\"string\">Deployment</span>                          <span class=\"comment\"># ç›®æ ‡ç±»å‹ä¸º Deployment</span></span><br><span class=\"line\">    <span class=\"attr\">name:</span> <span class=\"string\">nginx</span>                               <span class=\"comment\"># ç›®æ ‡ Deployment åç§°ä¸º nginx</span></span><br><span class=\"line\">  <span class=\"attr\">behavior:</span>                                   <span class=\"comment\"># â¬‡ï¸ æ‰©ç¼©å®¹è¡Œä¸ºæ§åˆ¶</span></span><br><span class=\"line\">    <span class=\"attr\">scaleUp:</span>                                  <span class=\"comment\"># æ‰©å®¹ç­–ç•¥</span></span><br><span class=\"line\">      <span class=\"attr\">stabilizationWindowSeconds:</span> <span class=\"number\">30</span>          <span class=\"comment\"># æ‰©å®¹å¹³æ»‘çª—å£ä¸º 30 ç§’ï¼Œé˜²æ­¢çŸ­æ—¶é—´æŠ–åŠ¨é¢‘ç¹æ‰©å®¹</span></span><br><span class=\"line\">      <span class=\"attr\">policies:</span>                               <span class=\"comment\"># æ‰©å®¹é€Ÿåº¦é™åˆ¶ç­–ç•¥</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">type:</span> <span class=\"string\">Percent</span>                         <span class=\"comment\"># æŒ‰ç™¾åˆ†æ¯”è®¡ç®—</span></span><br><span class=\"line\">        <span class=\"attr\">value:</span> <span class=\"number\">100</span>                            <span class=\"comment\"># æ¯ 15 ç§’å†…æœ€å¤šæ‰©å®¹ 100%</span></span><br><span class=\"line\">        <span class=\"attr\">periodSeconds:</span> <span class=\"number\">15</span>                     <span class=\"comment\"># æ¯ 15 ç§’è¯„ä¼°ä¸€æ¬¡æ‰©å®¹é€Ÿç‡</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">type:</span> <span class=\"string\">Pods</span>                            <span class=\"comment\"># æŒ‰å›ºå®š Pod æ•°é‡è®¡ç®—</span></span><br><span class=\"line\">        <span class=\"attr\">value:</span> <span class=\"number\">4</span>                              <span class=\"comment\"># æ¯ 15 ç§’æœ€å¤šæ‰©å®¹ 4 ä¸ª Pod</span></span><br><span class=\"line\">        <span class=\"attr\">periodSeconds:</span> <span class=\"number\">15</span>                     <span class=\"comment\"># æ¯ 15 ç§’è¯„ä¼°ä¸€æ¬¡æ‰©å®¹é€Ÿç‡</span></span><br><span class=\"line\">      <span class=\"attr\">selectPolicy:</span> <span class=\"string\">Max</span>                       <span class=\"comment\"># å¦‚æœå¤šä¸ª policy åŒæ—¶æ»¡è¶³ï¼Œå–æœ€å¤§å€¼ï¼ˆæ›´æ¿€è¿›çš„æ‰©å®¹ï¼‰</span></span><br><span class=\"line\">    <span class=\"attr\">scaleDown:</span>                                <span class=\"comment\"># ç¼©å®¹ç­–ç•¥</span></span><br><span class=\"line\">      <span class=\"attr\">stabilizationWindowSeconds:</span> <span class=\"number\">300</span>         <span class=\"comment\"># ç¼©å®¹å¹³æ»‘çª—å£ä¸º 300 ç§’ï¼ˆ5 åˆ†é’Ÿï¼‰ï¼Œé¿å…çŸ­æ—¶æµé‡é™ä½å¿«é€Ÿç¼©å®¹</span></span><br><span class=\"line\">      <span class=\"attr\">policies:</span>                               <span class=\"comment\"># ç¼©å®¹é€Ÿåº¦é™åˆ¶ç­–ç•¥</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">type:</span> <span class=\"string\">Percent</span>                         <span class=\"comment\"># æŒ‰ç™¾åˆ†æ¯”ç¼©å®¹</span></span><br><span class=\"line\">        <span class=\"attr\">value:</span> <span class=\"number\">30</span>                             <span class=\"comment\"># æ¯ 60 ç§’æœ€å¤šç¼©å®¹ 30%</span></span><br><span class=\"line\">        <span class=\"attr\">periodSeconds:</span> <span class=\"number\">60</span>                     <span class=\"comment\"># æ¯ 60 ç§’è¯„ä¼°ä¸€æ¬¡ç¼©å®¹é€Ÿç‡</span></span><br></pre></td></tr></table></figure>","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» K8S ä¸­çš„ Horizontal Pod Autoscalerï¼ˆHPAï¼‰ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚ K8Så®˜ç½‘ Autoscaling k8sç®€ä»‹ Horizontal Pod Autoscalerï¼ˆHPAï¼‰ Horizontal Pod Autoscalerï¼ˆHPAï¼‰ ç®€ä»‹ Horizontal Pod Autoscalerï¼ˆç¼©å†™ä¸º hpaï¼‰åŸºäºèµ„æº CPU åˆ©ç”¨ç‡è‡ªåŠ¨è°ƒæ•´ deploymentã€replication controller æˆ–è€… replica ä¸­ pod çš„æ•°é‡ï¼Œè¿™æœ‰åŠ©äºæ‚¨çš„åº”ç”¨ç¨‹åºè¿›è¡Œæ‰©å±•ä»¥æ»¡è¶³å¢é•¿çš„éœ€æ±‚ï¼Œæˆ–åœ¨ä¸éœ€è¦èµ„æºæ—¶è¿›è¡Œç¼©å‡ï¼Œä»è€Œé‡Šæ”¾å‡ºèŠ‚ç‚¹ç”¨äºå…¶ä»–åº”ç”¨ç¨‹åºã€‚å½“æ‚¨è®¾ç½®ç›®æ ‡ CPU åˆ©ç”¨ç‡ç™¾åˆ†æ¯”æ—¶ï¼ŒHPA æ‰©å±•æˆ–ç¼©å‡åº”ç”¨ç¨‹åºæ¥å°è¯•æ»¡è¶³è¯¥ç›®æ ‡ã€‚ Kubernetes æœ¬èº«å·²ç»åŒ…å«äº† HPA çš„ controllerï¼Œæ‰€ä»¥ä¸éœ€è¦é¢å¤–çš„å®‰è£…æˆ–éƒ¨ç½²ã€‚ HPA éœ€è¦è·å– metrics ä¿¡æ¯ï¼Œmetrics ä¿¡æ¯éœ€è¦ä» Metrics Server ä¸­è·å–ï¼Œæ‰€ä»¥éœ€è¦å…ˆå®‰è£… Metrics Serverã€‚ HPA ä¼šå‘¨æœŸæ€§(é»˜è®¤15ç§’)æŸ¥è¯¢ç›®æ ‡èµ„æºçš„ä½¿ç”¨æƒ…å†µï¼Œç„¶åå’Œ HPA ä¸­å®šä¹‰çš„å€¼åšæ¯”è¾ƒï¼Œå¹¶æ ¹æ®æ¯”è¾ƒç»“æœç›¸åº”çš„è°ƒæ•´ pod æ•°é‡ã€‚ åˆ›å»ºpodæ—¶ï¼Œå¿…é¡»ä¸ºå…¶è®¾å®šcpuèµ„æºï¼Œç”¨äºä¸ç›®æ ‡å€¼è¿›è¡Œæ¯”è¾ƒï¼Œç›®å‰æœ€æ–°çš„v2ç‰ˆæœ¬çš„HPAé™¤äº†æ”¯æŒCPUçš„å¯¹æ¯”ï¼Œè¿˜å¯ä»¥è®¾å®šå…¶å®ƒæŒ‡æ ‡ï¼Œå…·ä½“å‚è€ƒHorizontalPodAutoscaler æ¼”ç»ƒä¸­çš„â€œåŸºäºå¤šé¡¹åº¦é‡æŒ‡æ ‡å’Œè‡ªå®šä¹‰åº¦é‡æŒ‡æ ‡è‡ªåŠ¨æ‰©ç¼©â€ã€‚ åšä¸»ä¹‹å‰å†™è¿‡ä¸€ç¯‡åœ¨awsçš„eksä¸­ä½¿ç”¨hpaçš„æ–‡ç«  AWS-EKS-17--Horizontal Pod Autoscalerï¼ˆHPAï¼‰ï¼Œå’Œåœ¨è‡ªå·±æ­å»º k8sé›†ç¾¤ ä¸­ä½¿ç”¨ hpa åŸºæœ¬ä¸€è‡´ï¼Œæ‰€ä»¥æœ¬æ–‡ä¸å†å¯¹é‡å¤å†…å®¹è¿›è¡Œèµ˜è¿°ï¼Œå»ºè®®è¯»è€…å…ˆé˜…è¯» AWS-EKS-17--Horizontal Pod Autoscalerï¼ˆHPAï¼‰ã€‚ å®‰è£… Metrics Server Kubernetes çš„ HPA æ˜¯ä¾èµ– Metrics API çš„ï¼Œé»˜è®¤å¹¶ä¸å†…ç½®ã€‚éœ€è¦é€šè¿‡ metrics-server æ¥æ”¶é›†å’Œæä¾›èŠ‚ç‚¹/Pod çš„èµ„æºç”¨é‡æ•°æ®ï¼ˆCPUã€å†…å­˜ç­‰ï¼‰ã€‚ å®‰è£… metrics-server 1234567891011$ curl -L -o metrics-server.yaml https://github.com/kubernetes-sigs/metrics-server/releases/latest/download/components.yaml$ kubectl apply -f metrics-server.yamlserviceaccount/metrics-server createdclusterrole.rbac.authorization.k8s.io/system:aggregated-metrics-reader createdclusterrole.rbac.authorization.k8s.io/system:metrics-server createdrolebinding.rbac.authorization.k8s.io/metrics-server-auth-reader createdclusterrolebinding.rbac.authorization.k8s.io/metrics-server:system:auth-delegator createdclusterrolebinding.rbac.authorization.k8s.io/system:metrics-server createdservice/metrics-server createddeployment.apps/metrics-server createdapiservice.apiregistration.k8s.io/v1beta1.metrics.k8s.io created éƒ¨ç½²åå‘ç°podæ²¡æœ‰è¿è¡ŒæˆåŠŸ 123456789101112$ k get all -n kube-system -l k8s-app=metrics-serverNAME READY STATUS RESTARTS AGEpod/metrics-server-867d48dc9c-fgdjq 0/1 Running 0 16sNAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGEservice/metrics-server ClusterIP 10.96.91.221 &lt;none&gt; 443/TCP 16sNAME READY UP-TO-DATE AVAILABLE AGEdeployment.apps/metrics-server 0/1 1 0 16sNAME DESIRED CURRENT READY AGEreplicaset.apps/metrics-server-867d48dc9c 1 1 0 16s æ£€æŸ¥æ—¥å¿— 12345$ k logs deployment.apps/metrics-server -n kube-system## è¾“å‡ºç±»ä¼¼äºE0703 23:02:38.120831 1 scraper.go:149] &quot;Failed to scrape node&quot; err=&quot;Get \\&quot;https://10.211.55.15:10250/metrics/resource\\&quot;: tls: failed to verify certificate: x509: cannot validate certificate for 10.211.55.15 because it doesn&#x27;t contain any IP SANs&quot; node=&quot;k8s-worker1&quot;E0703 23:02:38.127774 1 scraper.go:149] &quot;Failed to scrape node&quot; err=&quot;Get \\&quot;https://10.211.55.16:10250/metrics/resource\\&quot;: tls: failed to verify certificate: x509: cannot validate certificate for 10.211.55.16 because it doesn&#x27;t contain any IP SANs&quot; node=&quot;k8s-worker2&quot;E0703 23:02:38.140583 1 scraper.go:149] &quot;Failed to scrape node&quot; err=&quot;Get \\&quot;https://10.211.55.11:10250/metrics/resource\\&quot;: tls: failed to verify certificate: x509: cannot validate certificate for 10.211.55.11 because it doesn&#x27;t contain any IP SANs&quot; node=&quot;k8s-master&quot; æ„æ€æ˜¯ metrics-server åœ¨é€šè¿‡ https://:10250 è¯·æ±‚ kubelet çš„æ—¶å€™ï¼Œå‘ç° kubelet çš„è¯ä¹¦ä¸åŒ…å«è¯¥ IP çš„ Subject Alternative Name (SAN)ï¼Œå› æ­¤ TLS æ ¡éªŒå¤±è´¥ã€‚ è§£å†³æ–¹æ¡ˆ: æ·»åŠ  --kubelet-insecure-tls å‚æ•°ï¼Œè·³è¿‡ kubelet çš„ TLS è¯ä¹¦æ ¡éªŒ(metrics-server æœ¬èº«æƒé™æœ‰é™ï¼Œé£é™©å¯æ§ï¼Œkubelet è‡ªç­¾è¯ä¹¦ç»´æŠ¤æˆæœ¬é«˜) 1234567891011kubectl edit deployment metrics-server -n kube-system## åœ¨ args ä¸­æ·»åŠ  --kubelet-insecure-tls spec: containers: - args: - --cert-dir=/tmp - --secure-port=10250 - --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname - --kubelet-use-node-status-port - --metric-resolution=15s - --kubelet-insecure-tls # æ·»åŠ æ­¤è¡Œ wqä¿å­˜åï¼Œç­‰ä¸€ä¼šå†æ¬¡æŸ¥çœ‹æ‰€æœ‰èµ„æºå‡å·²æ­£å¸¸ æŸ¥çœ‹æ‰€æœ‰ node çš„èµ„æº 12345$ k top nodesNAME CPU(cores) CPU(%) MEMORY(bytes) MEMORY(%)k8s-master 216m 10% 1712Mi 44%k8s-worker1 79m 3% 1025Mi 26%k8s-worker2 82m 4% 982Mi 25% å­—æ®µ è¯´æ˜ NAME èŠ‚ç‚¹åç§°ï¼ŒKubernetes é›†ç¾¤çš„èŠ‚ç‚¹åå­—ã€‚ CPU(cores) å½“å‰èŠ‚ç‚¹ CPU çš„ç¬æ—¶ä½¿ç”¨é‡ï¼Œå•ä½æ˜¯æ ¸å¿ƒæ•°ï¼ˆCoreï¼‰ï¼Œæ¯”å¦‚ 216m = 0.216 æ ¸å¿ƒã€‚m = millicoresï¼Œ1000m = 1æ ¸ã€‚ CPU(%) å½“å‰ CPU ä½¿ç”¨ç‡ï¼Œç›¸å¯¹äºè¯¥èŠ‚ç‚¹ CPU æ€»æ ¸æ•°çš„ç™¾åˆ†æ¯”ã€‚æ¯”å¦‚ 10% è¡¨ç¤ºèŠ‚ç‚¹ CPU çš„ 10% è¢«ä½¿ç”¨ã€‚ MEMORY(bytes) èŠ‚ç‚¹å½“å‰ä½¿ç”¨çš„å†…å­˜ï¼Œå•ä½æ˜¯å­—èŠ‚ï¼ˆä¾‹å¦‚ 1712Mi = 1712 Mebibytes â‰ˆ 1.7 GBï¼‰ã€‚ MEMORY(%) èŠ‚ç‚¹å†…å­˜ä½¿ç”¨ç‡ï¼Œå æ€»å†…å­˜çš„ç™¾åˆ†æ¯”ã€‚æ¯”å¦‚ 44% è¡¨ç¤ºè¯¥èŠ‚ç‚¹å†…å­˜ä½¿ç”¨äº† 44%ã€‚ æŸ¥çœ‹æ‰€æœ‰ pod çš„èµ„æº 123456789101112131415161718$ k top pods -ANAMESPACE NAME CPU(cores) MEMORY(bytes)default nginx-5869d7778c-5682r 0m 9Midefault nginx-5869d7778c-thw8f 0m 4Mikube-system calico-kube-controllers-7bfdc5b57c-q5xwp 6m 35Mikube-system calico-node-7pbbq 42m 281Mikube-system calico-node-v4hzr 47m 260Mikube-system calico-node-w47qq 40m 263Mikube-system coredns-674b8bbfcf-2tvld 2m 23Mikube-system coredns-674b8bbfcf-h6kx7 2m 22Mikube-system etcd-k8s-master 27m 85Mikube-system kube-apiserver-k8s-master 49m 404Mikube-system kube-controller-manager-k8s-master 28m 100Mikube-system kube-proxy-nkbns 1m 41Mikube-system kube-proxy-plqw8 1m 25Mikube-system kube-proxy-sbgh6 1m 34Mikube-system kube-scheduler-k8s-master 8m 38Mikube-system metrics-server-56fb9549f4-rtt7n 4m 21Mi åˆ›å»º HPA å‰é¢çš„æ–‡ç« ä¸­å¤šæ¬¡ä½¿ç”¨ nginx é•œåƒåˆ›å»ºäº† deploymentï¼Œä½†æ˜¯éƒ½æ²¡æœ‰é…ç½®è¿‡èµ„æºï¼Œä¸ºäº†æµ‹è¯• hpaï¼Œéœ€è¦ä¸ºå…¶æŒ‡å®šèµ„æº 1234567891011121314151617181920# ç›´æ¥ä¿®æ”¹ deploymentï¼Œæ”¹å˜ spec.templateï¼ŒPod ä¼šè¢«é‡å»ºã€‚ä¿å­˜åç«‹åˆ»ç”Ÿæ•ˆkubectl edit deployment nginx# å¢åŠ èµ„æºé™åˆ¶spec: replicas: 1 # ä¿®æ”¹å‰¯æœ¬æ•°ä½ 1ï¼Œä»…æ”¹å˜ replicasï¼ŒPod ä¸ä¼šè¢«é‡å»º template: # ä¿®æ”¹ templateï¼ŒPod ä¼šè¢«é‡å»º metadata: labels: app: nginx spec: containers: - name: nginx image: nginx resources: limits: cpu: 500m memory: 500Mi requests: cpu: 200m memory: 200Mi å‘½ä»¤è¡Œåˆ›å»º HPA 123456789101112# åˆ›å»ºäº†ä¸€ä¸ªå«â€œhpa-nginxâ€çš„ HPAï¼Œé»˜è®¤ä¸ deployment çš„åç§°ç›¸åŒï¼Œå¯ä»¥ç”¨ --name=&#x27;hpa-nginx&#x27; æŒ‡å®šhpaçš„åç§°# replicas å˜åŠ¨èŒƒå›´æ˜¯æœ€å° 3ï¼Œæœ€å¤§ 10# ç›®æ ‡cpuåˆ©ç”¨ç‡ä¸º 50%ï¼Œä¸Šé¢æˆ‘ä»¬è®¾å®š CPU request å€¼ä¸º 100mï¼Œæ‰€ä»¥å½“å¹³å‡cpuå€¼ä¸º 100m æ—¶å°±ä¼šè§¦å‘ autoscale# è¿™é‡Œè¯´å¹³å‡cpuï¼Œæ˜¯æŒ‡æ‰€æœ‰podçš„cpuåˆ©ç”¨ç‡çš„å¹³å‡å€¼$ k autoscale deployment nginx --name=&quot;hpa-nginx&quot; --cpu-percent=50 --min=3 --max=10horizontalpodautoscaler.autoscaling/hpa-nginx autoscaled# è§‚å¯Ÿï¼Œå¤§çº¦ 15ç§’åï¼Œhpa-nginx å‘ç° replicas å€¼ä¸º1ï¼Œ30ç§’çš„æ—¶å€™è‡ªåŠ¨æ‰©å®¹åˆ°3ä¸ªï¼Œå› ä¸ºæˆ‘ä»¬è®¾ç½®çš„hpaçš„replicasæœ€å°å€¼ä¸º3ï¼Œå¹¶ä¸”é‡‡é›†åˆ°äº†cpuä½¿ç”¨ç‡$ k get hpa -wNAME REFERENCE TARGETS MINPODS MAXPODS REPLICAS AGEhpa-nginx Deployment/nginx cpu: &lt;unknown&gt;/50% 3 10 0 0shpa-nginx Deployment/nginx cpu: &lt;unknown&gt;/50% 3 10 1 15shpa-nginx Deployment/nginx cpu: 0%/50% 3 10 3 30s ymalæ–‡ä»¶åˆ›å»º HPA 12345678910111213141516171819apiVersion: autoscaling/v2 # apiç‰ˆæœ¬ï¼Œè¿™é‡Œè®¾ç½®ä¸º v2kind: HorizontalPodAutoscaler # èµ„æºç±»å‹metadata: name: hpa-nginx # hpaèµ„æºåç§° namespace: default # å‘½åç©ºé—´spec: maxReplicas: 10 # æœ€å¤§å‰¯æœ¬æ•° minReplicas: 1 # æœ€å°å‰¯æœ¬æ•° metrics: # æŒ‡æ ‡è®¾å®š - type: Resource # èµ„æºç±»å‹ï¼Œå¯ä»¥é…ç½®ä¸º Resource/Object/Pods resource: # èµ„æºå¯¹è±¡ name: cpu # èµ„æºåç§° cpu/memory target: # ç›®æ ‡å¯¹è±¡ type: Utilization # ç›®æ ‡ç±»å‹ï¼Œå¯ä»¥é…ç½®ä¸º Utilization/AverageValue/Value averageUtilization: 50 # ç›®æ ‡å€¼ï¼Œè¿™é‡Œæ˜¯å¹³å‡ä½¿ç”¨ç‡çš„ç™¾åˆ†æ¯” scaleTargetRef: # æŒ‡å®šè¦è‡ªåŠ¨ä¼¸ç¼©çš„èµ„æºå¯¹è±¡ apiVersion: apps/v1 kind: Deployment # èµ„æºç±»å‹ä¸º Deployment name: nginx # èµ„æºåç§°ä¸º nginx HPA æ”¯æŒçš„ç›‘æ§æŒ‡æ ‡ç±»å‹ ç±»å‹ å­—æ®µå è¯´æ˜ å¸¸è§ç”¨é€” Resource resource åŸºäº Pod èµ„æºä½¿ç”¨æƒ…å†µï¼ˆCPUã€å†…å­˜ï¼‰ï¼Œæœ€å¸¸ç”¨ æŒ‰ CPU åˆ©ç”¨ç‡è‡ªåŠ¨æ‰©ç¼©å®¹ Pods pods åŸºäºæ¯ä¸ª Pod çš„è‡ªå®šä¹‰åº¦é‡æŒ‡æ ‡çš„å¹³å‡å€¼ï¼Œéœ€è¦ç¬¬ä¸‰æ–¹ç›‘æ§ç³»ç»Ÿæä¾›ï¼Œæ¯”å¦‚ Prometheus æŒ‰ä¸šåŠ¡æŒ‡æ ‡ï¼ˆå¦‚è¯·æ±‚æ•°ã€é˜Ÿåˆ—é•¿åº¦ï¼‰æ‰©ç¼©å®¹ Object object åŸºäºå•ä¸ª Kubernetes å¯¹è±¡ï¼ˆå¦‚ Serviceã€Ingressï¼‰çš„æŒ‡æ ‡ï¼Œï¼Œæ¯”å¦‚ Prometheus æŒ‰æŸä¸ªå¯¹è±¡çš„æŒ‡æ ‡æ‰©ç¼©å®¹ï¼Œä¾‹å¦‚é˜Ÿåˆ—é•¿åº¦ Resource èµ„æºæŒ‡æ ‡ï¼ˆCPU/å†…å­˜ï¼‰ Utilization: åˆ©ç”¨ç‡ç™¾åˆ†æ¯” Utilization ä¸å…³å¿ƒ limitsï¼Œåªçœ‹ requestsã€‚ å¦‚æœ resources.requests æ²¡æœ‰è®¾ç½®ï¼ŒHPA Utilization ä¼šæŠ¥é”™ï¼ˆé™¤é AverageValueï¼‰ã€‚ 1234567metrics:- type: Resource resource: # èµ„æº æŒ‡æ ‡ name: cpu # cpu target: type: Utilization # åˆ©ç”¨ç‡ç™¾åˆ†æ¯” averageUtilization: 50 # 50% å½“å‰æœ‰ 3 ä¸ª Podï¼š Pod CPU å®é™…ä½¿ç”¨ CPU requests pod-1 150m 200m pod-2 100m 200m pod-3 50m 200m åˆè®¡ 400m 600m å¹³å‡ 400m Ã· 600m Ã— 100% â‰ˆ 66.7% ç”±äº 66.7% &gt; 50%ï¼Œä¼šæ‰©å®¹ï¼›å¦‚æœå°äº 50%ï¼ŒHPA ä¼šç¼©å®¹ã€‚ AverageValue: æŒ‡å®šèµ„æºä½¿ç”¨å¹³å‡å€¼ 1234567metrics:- type: Resource resource: name: memory # ç›‘æ§èµ„æºç±»å‹ä¸º memoryï¼ˆå†…å­˜ï¼‰ target: type: AverageValue # æŒ‡æ ‡ç±»å‹ä¸º AverageValueï¼Œè¡¨ç¤ºæ¯ä¸ª Pod å¹³å‡ä½¿ç”¨å¤šå°‘ averageValue: 400Mi # ç›®æ ‡å€¼ï¼šå¹³å‡æ¯ä¸ª Pod ä½¿ç”¨ 400Mi å†…å­˜ å‡è®¾å½“å‰éƒ¨ç½²äº† 3 ä¸ªå‰¯æœ¬ï¼Œå†…å­˜ä½¿ç”¨æƒ…å†µå¦‚ä¸‹ï¼š Pod å½“å‰å†…å­˜ä½¿ç”¨ pod-1 450Mi pod-2 400Mi pod-3 300Mi å¹³å‡ (450+400+300)/3 = 383.3Mi å› ä¸º 383.3Mi &lt; 400Miï¼Œä¸è§¦å‘æ‰©å®¹ã€‚å¦‚æœå°†æ¥å¹³å‡ä½¿ç”¨è¶…è¿‡ 400Miï¼ŒHPA å°±ä¼šæ‰©å®¹ï¼Œåä¹‹ç¼©å®¹ã€‚ HPA æ‰©ç¼©å®¹é€Ÿåº¦é…ç½® HPA çš„æ‰©ç¼©å®¹é€Ÿåº¦æ˜¯å¯ä»¥æ§åˆ¶çš„ï¼Œé€šè¿‡ behavior å­—æ®µæ¥è‡ªå®šä¹‰æ‰©ç¼©å®¹çš„é€Ÿåº¦å’Œç­–ç•¥ã€‚ ä»¥ä¸‹æ˜¯é»˜è®¤ç­–ç•¥ 1234567891011121314151617181920behavior: scaleUp: # â¬†ï¸ æ‰©å®¹ç­–ç•¥ tolerance: 0.1 # å®¹å¿é˜ˆå€¼ï¼Œé»˜è®¤0.1(10%)ï¼Œè¡¨ç¤ºæ¯æ¬¡æ‰©å®¹æ—¶ï¼Œpodä½¿ç”¨ç‡è¶…è¿‡1.1å€ç›®æ ‡å€¼æ—¶æ‰ä¼šè¿›è¡Œæ‰©å®¹ stabilizationWindowSeconds: 0 # é»˜è®¤0ï¼Œå³å¢åŠ æˆ–å‡å°‘podæ•°é‡åä¿æŒä¸å˜çš„æ—¶é—´ï¼Œå•ä½ä¸ºç§’ policies: - type: Percent # æ‰©å®¹é€Ÿåº¦æŒ‰ç™¾åˆ†æ¯”é™åˆ¶ value: 100 # æ¯ 15 ç§’æœ€å¤šæ‰©å®¹ 100% çš„å‰¯æœ¬æ•° periodSeconds: 15 # æ¯ 15 ç§’è®¡ç®—ä¸€æ¬¡æ˜¯å¦å¯ä»¥æ‰©å®¹ï¼Œé»˜è®¤ 15 ç§’ - type: Pods # æŒ‰å›ºå®š Pod æ•°é‡é™åˆ¶æ‰©å®¹é€Ÿåº¦ value: 4 # æ¯ 15 ç§’æœ€å¤šæ‰©å®¹ 4 ä¸ª Pod periodSeconds: 15 # åŒæ · 15 ç§’è®¡ç®—ä¸€æ¬¡ï¼Œé»˜è®¤ 15 ç§’ selectPolicy: Max # å¤šä¸ª policy åŒæ—¶å­˜åœ¨æ—¶ï¼Œå– Percent å’Œ Pods çš„æœ€å¤§å€¼ã€‚Min å–æœ€å°å€¼ scaleDown: # â¬‡ï¸ ç¼©å®¹ç­–ç•¥ # selectPolicy: Disabled # ç¦ç”¨ç¼©å®¹ stabilizationWindowSeconds: 300 # é»˜è®¤ 300ï¼Œå³å¢åŠ æˆ–å‡å°‘podæ•°é‡åä¿æŒä¸å˜çš„æ—¶é—´ï¼Œå•ä½ä¸ºç§’ï¼Œé˜²æ­¢å¿«é€Ÿç¼©å®¹ï¼ˆå¹³æ»‘ç­–ç•¥ï¼‰ policies: - type: Percent # ç¼©å®¹é€Ÿåº¦æŒ‰ç™¾åˆ†æ¯”é™åˆ¶ value: 100 # æ¯ 15 ç§’æœ€å¤šç¼©å®¹ 100% çš„å‰¯æœ¬æ•° periodSeconds: 15 # æ¯ 15 ç§’è¯„ä¼°ä¸€æ¬¡æ˜¯å¦å¯ä»¥ç¼©å®¹ å®Œæ•´çš„ HPA é…ç½®æ–‡ä»¶ç¤ºä¾‹(ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æ— éœ€ä¿®æ”¹æ‰©ç¼©å®¹é€Ÿåº¦çš„é…ç½®ï¼Œé»˜è®¤ç­–ç•¥æ»¡è¶³å¤§éƒ¨åˆ†åœºæ™¯) 123456789101112131415161718192021222324252627282930313233343536apiVersion: autoscaling/v2 # apiç‰ˆæœ¬ï¼Œä½¿ç”¨ v2 ç‰ˆæœ¬æ”¯æŒ behavior æ‰©ç¼©å®¹ç­–ç•¥kind: HorizontalPodAutoscaler # èµ„æºç±»å‹ä¸º HPAmetadata: name: hpa-nginx # HPA èµ„æºçš„åç§° namespace: default # å‘½åç©ºé—´ï¼Œè®¾ç½®ä¸º defaultspec: maxReplicas: 10 # HPA è‡ªåŠ¨æ‰©å®¹çš„æœ€å¤§å‰¯æœ¬æ•° minReplicas: 1 # HPA è‡ªåŠ¨ç¼©å®¹çš„æœ€å°å‰¯æœ¬æ•° metrics: # è‡ªåŠ¨ä¼¸ç¼©çš„æŒ‡æ ‡é…ç½® - type: Resource # æŒ‡æ ‡ç±»å‹ä¸º Resourceï¼ˆèµ„æºå‹ï¼‰ resource: # èµ„æºæŒ‡æ ‡å¯¹è±¡ name: cpu # èµ„æºåç§°ä¸º cpuï¼Œä¹Ÿå¯ä»¥è®¾ç½®ä¸º memory target: # ç›®æ ‡æŒ‡æ ‡å¯¹è±¡ type: Utilization # æŒ‡æ ‡ç±»å‹ä¸º Utilizationï¼ˆåˆ©ç”¨ç‡ç™¾åˆ†æ¯”ï¼‰ averageUtilization: 50 # CPU å¹³å‡ä½¿ç”¨ç‡è¾¾åˆ° 50% æ—¶è¿›è¡Œæ‰©ç¼©å®¹ scaleTargetRef: # HPA ç»‘å®šçš„ç›®æ ‡èµ„æºå¯¹è±¡ apiVersion: apps/v1 kind: Deployment # ç›®æ ‡ç±»å‹ä¸º Deployment name: nginx # ç›®æ ‡ Deployment åç§°ä¸º nginx behavior: # â¬‡ï¸ æ‰©ç¼©å®¹è¡Œä¸ºæ§åˆ¶ scaleUp: # æ‰©å®¹ç­–ç•¥ stabilizationWindowSeconds: 30 # æ‰©å®¹å¹³æ»‘çª—å£ä¸º 30 ç§’ï¼Œé˜²æ­¢çŸ­æ—¶é—´æŠ–åŠ¨é¢‘ç¹æ‰©å®¹ policies: # æ‰©å®¹é€Ÿåº¦é™åˆ¶ç­–ç•¥ - type: Percent # æŒ‰ç™¾åˆ†æ¯”è®¡ç®— value: 100 # æ¯ 15 ç§’å†…æœ€å¤šæ‰©å®¹ 100% periodSeconds: 15 # æ¯ 15 ç§’è¯„ä¼°ä¸€æ¬¡æ‰©å®¹é€Ÿç‡ - type: Pods # æŒ‰å›ºå®š Pod æ•°é‡è®¡ç®— value: 4 # æ¯ 15 ç§’æœ€å¤šæ‰©å®¹ 4 ä¸ª Pod periodSeconds: 15 # æ¯ 15 ç§’è¯„ä¼°ä¸€æ¬¡æ‰©å®¹é€Ÿç‡ selectPolicy: Max # å¦‚æœå¤šä¸ª policy åŒæ—¶æ»¡è¶³ï¼Œå–æœ€å¤§å€¼ï¼ˆæ›´æ¿€è¿›çš„æ‰©å®¹ï¼‰ scaleDown: # ç¼©å®¹ç­–ç•¥ stabilizationWindowSeconds: 300 # ç¼©å®¹å¹³æ»‘çª—å£ä¸º 300 ç§’ï¼ˆ5 åˆ†é’Ÿï¼‰ï¼Œé¿å…çŸ­æ—¶æµé‡é™ä½å¿«é€Ÿç¼©å®¹ policies: # ç¼©å®¹é€Ÿåº¦é™åˆ¶ç­–ç•¥ - type: Percent # æŒ‰ç™¾åˆ†æ¯”ç¼©å®¹ value: 30 # æ¯ 60 ç§’æœ€å¤šç¼©å®¹ 30% periodSeconds: 60 # æ¯ 60 ç§’è¯„ä¼°ä¸€æ¬¡ç¼©å®¹é€Ÿç‡","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» K8S ä¸­çš„ Horizontal Pod Autoscalerï¼ˆHPAï¼‰ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚ K8Så®˜ç½‘ Autoscaling k8sç®€ä»‹ Horizontal Pod Autoscalerï¼ˆHPAï¼‰","date_published":"2025-07-20T13:30:05.000Z","tags":["æŠ€æœ¯","k8s","K8S"]},{"id":"https://blog.hanqunfeng.com/2025/07/19/k8s-ingress-nginx/","url":"https://blog.hanqunfeng.com/2025/07/19/k8s-ingress-nginx/","title":"K8S ä¹‹ Ingress Nginx","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç» K8S å®‰è£…åŠä½¿ç”¨ Ingress Nginxï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://kubernetes.io/zh-cn/\">K8Så®˜ç½‘</a></p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://kubernetes.github.io/ingress-nginx/\">ingress-nginx å®˜ç½‘</a></p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://kubernetes.io/zh-cn/docs/concepts/services-networking/ingress/\">ingress-nginx k8sç®€ä»‹</a></p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://kubernetes.io/zh-cn/docs/concepts/services-networking/ingress-controllers/\">k8sæ”¯æŒçš„ ingress controller</a></p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"Ingress-ç®€ä»‹\">Ingress ç®€ä»‹</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Ingress(ç¼©å†™ä¸º ing) æä¾›ä»é›†ç¾¤å¤–éƒ¨åˆ°é›†ç¾¤å†…æœåŠ¡çš„ HTTP å’Œ HTTPS è·¯ç”±(7å±‚)ã€‚ æµé‡è·¯ç”±ç”± Ingress èµ„æºæ‰€å®šä¹‰çš„è§„åˆ™æ¥æ§åˆ¶ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å®é™…ä¸Š Ingress-Nginx å†…ç½®äº† nginxï¼Œç”± nginx å…¶è´Ÿè´£æ¥æ”¶è¯·æ±‚å¹¶è½¬å‘ç»™åç«¯æœåŠ¡ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä¸‹é¢æ˜¯ Ingress çš„ä¸€ä¸ªç®€å•ç¤ºä¾‹ï¼Œå¯å°†æ‰€æœ‰æµé‡éƒ½å‘é€åˆ°åŒä¸€ Service<br>\n<img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/uPic/jVrIUP.png\" alt=\"\"></p>\n</li>\n</ul>\n<h2 id=\"å®‰è£…-Ingress-Nginx\">å®‰è£… Ingress-Nginx</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å®‰è£…æ—¶è¦æ³¨æ„ ingress-nginx çš„ç‰ˆæœ¬å’Œ Kubernetes çš„ç‰ˆæœ¬å…¼å®¹æ€§ï¼Œå‚è€ƒ Github:<a href=\"https://github.com/kubernetes/ingress-nginx\">ingress-nginx</a>ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>è·å–å¯¹åº”ç‰ˆæœ¬çš„yamlæ–‡ä»¶</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ä¸‹è½½æœ€æ–°çš„ v1.13.0 ç‰ˆæœ¬ï¼Œå…¶æ”¯æŒ Kubernetes 1.33 ç‰ˆæœ¬</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> INGRESS_NGINX_VERSION=v1.13.0</span><br><span class=\"line\">curl -L -o ingress-nginx-controller.yaml https://raw.githubusercontent.com/kubernetes/ingress-nginx/controller-<span class=\"variable\">$&#123;INGRESS_NGINX_VERSION&#125;</span>/deploy/static/provider/cloud/deploy.yaml</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å®‰è£… ingress-nginx</p>\n</li>\n</ul>\n<blockquote>\n<p>è¿™é‡Œè¦æ³¨æ„ï¼Œingress-nginx çš„ <code>service/ingress-nginx-controller</code> é»˜è®¤ä½¿ç”¨ LoadBalancer ç±»å‹ï¼Œæ‰€ä»¥éœ€è¦å…ˆä½¿ k8s é›†ç¾¤æ”¯æŒ LoadBalancer ç±»å‹ï¼Œå¯ä»¥å‚è€ƒ <a href=\"/2025/07/18/k8s-service/\" title=\"K8S ä¹‹ Service\">K8S ä¹‹ Service</a> ä¸­ LoadBalancer éƒ¨åˆ†ã€‚</p>\n</blockquote>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ kubectl apply -f ingress-nginx-controller.yaml</span><br><span class=\"line\">namespace/ingress-nginx created</span><br><span class=\"line\">serviceaccount/ingress-nginx created</span><br><span class=\"line\">serviceaccount/ingress-nginx-admission created</span><br><span class=\"line\">role.rbac.authorization.k8s.io/ingress-nginx created</span><br><span class=\"line\">role.rbac.authorization.k8s.io/ingress-nginx-admission created</span><br><span class=\"line\">clusterrole.rbac.authorization.k8s.io/ingress-nginx created</span><br><span class=\"line\">clusterrole.rbac.authorization.k8s.io/ingress-nginx-admission created</span><br><span class=\"line\">rolebinding.rbac.authorization.k8s.io/ingress-nginx created</span><br><span class=\"line\">rolebinding.rbac.authorization.k8s.io/ingress-nginx-admission created</span><br><span class=\"line\">clusterrolebinding.rbac.authorization.k8s.io/ingress-nginx created</span><br><span class=\"line\">clusterrolebinding.rbac.authorization.k8s.io/ingress-nginx-admission created</span><br><span class=\"line\">configmap/ingress-nginx-controller created</span><br><span class=\"line\">service/ingress-nginx-controller created</span><br><span class=\"line\">service/ingress-nginx-controller-admission created</span><br><span class=\"line\">deployment.apps/ingress-nginx-controller created</span><br><span class=\"line\">job.batch/ingress-nginx-admission-create created</span><br><span class=\"line\">job.batch/ingress-nginx-admission-patch created</span><br><span class=\"line\">ingressclass.networking.k8s.io/nginx created</span><br><span class=\"line\">validatingwebhookconfiguration.admissionregistration.k8s.io/ingress-nginx-admission created</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹ingress-nginxèµ„æº</span></span><br><span class=\"line\">$ k get all -n ingress-nginx</span><br><span class=\"line\">NAME                                           READY   STATUS    RESTARTS   AGE</span><br><span class=\"line\">pod/ingress-nginx-controller-95f6586c6-nznwq   1/1     Running   0          2m46s</span><br><span class=\"line\"></span><br><span class=\"line\">NAME                                         TYPE           CLUSTER-IP      EXTERNAL-IP     PORT(S)                      AGE</span><br><span class=\"line\">service/ingress-nginx-controller             LoadBalancer   10.96.112.234   10.211.55.201   80:30168/TCP,443:30600/TCP   2m46s</span><br><span class=\"line\">service/ingress-nginx-controller-admission   ClusterIP      10.96.245.155   &lt;none&gt;          443/TCP                      2m46s</span><br><span class=\"line\"></span><br><span class=\"line\">NAME                                       READY   UP-TO-DATE   AVAILABLE   AGE</span><br><span class=\"line\">deployment.apps/ingress-nginx-controller   1/1     1            1           2m46s</span><br><span class=\"line\"></span><br><span class=\"line\">NAME                                                 DESIRED   CURRENT   READY   AGE</span><br><span class=\"line\">replicaset.apps/ingress-nginx-controller-95f6586c6   1         1         1       2m46s</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹ IngressClass èµ„æº</span></span><br><span class=\"line\">$ k get ingressclasses.networking.k8s.io</span><br><span class=\"line\">NAME    CONTROLLER             PARAMETERS   AGE</span><br><span class=\"line\">nginx   k8s.io/ingress-nginx   &lt;none&gt;       14m</span><br></pre></td></tr></table></figure>\n<h2 id=\"åˆ›å»º-Ingress-èµ„æº\">åˆ›å»º Ingress èµ„æº</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ingress-demo.yaml</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">networking.k8s.io/v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Ingress</span>                   <span class=\"comment\"># Ingress èµ„æº</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">web-ingress</span>             <span class=\"comment\"># Ingress åç§°</span></span><br><span class=\"line\">  <span class=\"attr\">namespace:</span> <span class=\"string\">default</span>            <span class=\"comment\"># Ingress æ‰€åœ¨çš„å‘½åç©ºé—´</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">ingressClassName:</span> <span class=\"string\">nginx</span>       <span class=\"comment\"># Ingress ä½¿ç”¨çš„ IngressClass</span></span><br><span class=\"line\">  <span class=\"attr\">rules:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">host:</span> <span class=\"string\">nginx.hanqunfeng.com</span>  <span class=\"comment\"># è½¬å‘åŸŸåï¼Œæ”¯æŒé€šé…ç¬¦ *.hanqunfeng.com</span></span><br><span class=\"line\">    <span class=\"attr\">http:</span></span><br><span class=\"line\">      <span class=\"attr\">paths:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">pathType:</span> <span class=\"string\">Prefix</span>        <span class=\"comment\"># è·¯å¾„åŒ¹é…è§„åˆ™, å‰ç¼€åŒ¹é…</span></span><br><span class=\"line\">        <span class=\"attr\">path:</span> <span class=\"string\">/</span>                 <span class=\"comment\"># è·¯å¾„</span></span><br><span class=\"line\">        <span class=\"attr\">backend:</span>                <span class=\"comment\"># åç«¯æœåŠ¡</span></span><br><span class=\"line\">          <span class=\"attr\">service:</span>              <span class=\"comment\"># å£°æ˜åç«¯æ˜¯ä¸€ä¸ª service</span></span><br><span class=\"line\">            <span class=\"attr\">name:</span> <span class=\"string\">nginx</span>         <span class=\"comment\"># serviceåç§°ï¼Œæå‰åˆ›å»ºå¥½ serviceï¼Œç±»å‹å¯ä»¥æ˜¯ClusterIPã€NodePortã€LoadBalancerä»»æ„ï¼Œæ¨èClusterIPï¼Œå› ä¸ºä½¿ç”¨ ingress çš„è¯ï¼Œå°±æ²¡å¿…è¦åˆ›å»ºå…¶å®ƒç±»å‹çš„ service äº†</span></span><br><span class=\"line\">            <span class=\"attr\">port:</span>               <span class=\"comment\"># ç«¯å£</span></span><br><span class=\"line\">              <span class=\"attr\">number:</span> <span class=\"number\">80</span>        <span class=\"comment\"># serviceçš„ç«¯å£</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æŸ¥çœ‹ ingress èµ„æº</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ k get ing -n ns1</span><br><span class=\"line\">NAME          CLASS   HOSTS                  ADDRESS         PORTS   AGE</span><br><span class=\"line\">web-ingress   nginx   nginx.hanqunfeng.com   10.211.55.201   80      80s</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è®¿é—® web-ingress</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å°†åŸŸå nginx.hanqunfeng.com è§£æåˆ° 10.211.55.201ï¼Œå¦‚æœæ˜¯å†…éƒ¨åŸŸåå¯ä»¥é€šè¿‡ hosts æ–‡ä»¶æ·»åŠ è§£æ</span></span><br><span class=\"line\"><span class=\"comment\"># åªèƒ½é€šè¿‡ nginx.hanqunfeng.com è®¿é—®ï¼Œä¸èƒ½é€šè¿‡ 10.211.55.201 è®¿é—®</span></span><br><span class=\"line\">curl http://nginx.hanqunfeng.com</span><br></pre></td></tr></table></figure>\n<h2 id=\"è®©-Ingress-æ”¯æŒ-HTTPS-è®¿é—®\">è®© Ingress æ”¯æŒ HTTPS è®¿é—®</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ›å»ºè¯ä¹¦ï¼Œå¯ä»¥åœ¨é˜¿é‡Œäº‘ä¸Šç”³è¯·ä¸€ä¸ªå…è´¹çš„è¯ä¹¦</p>\n</li>\n<li class=\"lvl-2\">\n<p>åˆ›å»º secret</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl create secret tls nginx-tls \\</span><br><span class=\"line\">    --key=nginx.hanqunfeng.com.key \\</span><br><span class=\"line\">    --cert=nginx.hanqunfeng.com.pem \\</span><br><span class=\"line\">    -n default</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¹Ÿå¯ä»¥é€šè¿‡yamlåˆ›å»º</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Secret</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">nginx-tls</span></span><br><span class=\"line\">  <span class=\"attr\">namespace:</span> <span class=\"string\">default</span></span><br><span class=\"line\"><span class=\"attr\">data:</span></span><br><span class=\"line\">  <span class=\"attr\">tls.crt:</span> <span class=\"string\">base64</span> <span class=\"string\">ç¼–ç çš„è¯ä¹¦ï¼Œè€Œéæ–‡ä»¶è·¯å¾„</span></span><br><span class=\"line\">  <span class=\"attr\">tls.key:</span> <span class=\"string\">base64</span> <span class=\"string\">ç¼–ç çš„ç§é’¥ï¼Œè€Œéæ–‡ä»¶è·¯å¾„</span></span><br><span class=\"line\"><span class=\"attr\">type:</span> <span class=\"string\">kubernetes.io/tls</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä½ çš„ Ingress èµ„æºéœ€è¦å¢åŠ  tls å­—æ®µï¼Œå¼•ç”¨ä¸€ä¸ª Secret å­˜å‚¨çš„ TLS è¯ä¹¦ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">networking.k8s.io/v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Ingress</span>                   <span class=\"comment\"># Ingress èµ„æº</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">web-ingress</span>             <span class=\"comment\"># Ingress åç§°</span></span><br><span class=\"line\">  <span class=\"attr\">namespace:</span> <span class=\"string\">default</span>            <span class=\"comment\"># Ingress æ‰€åœ¨çš„å‘½åç©ºé—´</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">ingressClassName:</span> <span class=\"string\">nginx</span>       <span class=\"comment\"># Ingress ä½¿ç”¨çš„ IngressClass</span></span><br><span class=\"line\">  <span class=\"attr\">tls:</span>                          <span class=\"comment\"># é…ç½® TLS</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">hosts:</span>                      <span class=\"comment\"># åŸŸååˆ—è¡¨</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">nginx.hanqunfeng.com</span>      <span class=\"comment\"># åŸŸå</span></span><br><span class=\"line\">    <span class=\"attr\">secretName:</span> <span class=\"string\">nginx-tls</span>       <span class=\"comment\"># å­˜æ”¾è¯ä¹¦çš„ Secret</span></span><br><span class=\"line\">  <span class=\"attr\">rules:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">host:</span> <span class=\"string\">nginx.hanqunfeng.com</span>  <span class=\"comment\">#è½¬å‘åŸŸå</span></span><br><span class=\"line\">    <span class=\"attr\">http:</span></span><br><span class=\"line\">      <span class=\"attr\">paths:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">pathType:</span> <span class=\"string\">Prefix</span>        <span class=\"comment\"># è·¯å¾„åŒ¹é…è§„åˆ™, å‰ç¼€åŒ¹é…</span></span><br><span class=\"line\">        <span class=\"attr\">path:</span> <span class=\"string\">/</span>                 <span class=\"comment\"># è·¯å¾„</span></span><br><span class=\"line\">        <span class=\"attr\">backend:</span>                <span class=\"comment\"># åç«¯æœåŠ¡</span></span><br><span class=\"line\">          <span class=\"attr\">service:</span>              <span class=\"comment\"># service</span></span><br><span class=\"line\">            <span class=\"attr\">name:</span> <span class=\"string\">nginx</span>         <span class=\"comment\"># serviceåç§°</span></span><br><span class=\"line\">            <span class=\"attr\">port:</span>               <span class=\"comment\"># ç«¯å£</span></span><br><span class=\"line\">              <span class=\"attr\">number:</span> <span class=\"number\">80</span>        <span class=\"comment\"># serviceçš„ç«¯å£</span></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># é‡æ–°è¿è¡Œingress</span></span><br><span class=\"line\">k apply -f nginx-ingress.yaml</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹ingressï¼Œæ­¤æ—¶å¤šäº†ä¸€ä¸ª 443 ç«¯å£</span></span><br><span class=\"line\">$ k get ing</span><br><span class=\"line\">NAME          CLASS   HOSTS                  ADDRESS         PORTS     AGE</span><br><span class=\"line\">web-ingress   nginx   nginx.hanqunfeng.com   10.211.55.201   80, 443   51s</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># è®¿é—®httpsï¼Œä½†æ­¤æ—¶ 80 ç«¯å£è®¿é—®ä¸äº†ï¼Œéœ€è¦é…ç½® 80 ç«¯å£é‡å®šå‘åˆ° 443</span></span><br><span class=\"line\">curl https://nginx.hanqunfeng.com</span><br></pre></td></tr></table></figure>\n<h2 id=\"80ç«¯å£é‡å®šå‘åˆ°443\">80ç«¯å£é‡å®šå‘åˆ°443</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><code>nginx ingress controller</code>ï¼Œå®ƒå†…ç½®æ”¯æŒé‡å®šå‘ï¼Œä½ å¯ä»¥åœ¨ Ingress ä¸Šæ·»åŠ  annotation</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">annotations:</span></span><br><span class=\"line\">    <span class=\"attr\">nginx.ingress.kubernetes.io/force-ssl-redirect:</span> <span class=\"string\">&quot;true&quot;</span>  <span class=\"comment\"># 80 é‡å®šå‘åˆ° 443</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å®Œæ•´çš„yaml</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">networking.k8s.io/v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Ingress</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">web-ingress</span></span><br><span class=\"line\">  <span class=\"attr\">namespace:</span> <span class=\"string\">default</span></span><br><span class=\"line\">  <span class=\"attr\">annotations:</span></span><br><span class=\"line\">    <span class=\"attr\">nginx.ingress.kubernetes.io/force-ssl-redirect:</span> <span class=\"string\">&quot;true&quot;</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">ingressClassName:</span> <span class=\"string\">nginx</span></span><br><span class=\"line\">  <span class=\"attr\">tls:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">hosts:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">nginx.hanqunfeng.com</span></span><br><span class=\"line\">    <span class=\"attr\">secretName:</span> <span class=\"string\">nginx-tls</span></span><br><span class=\"line\">  <span class=\"attr\">rules:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">host:</span> <span class=\"string\">nginx.hanqunfeng.com</span></span><br><span class=\"line\">    <span class=\"attr\">http:</span></span><br><span class=\"line\">      <span class=\"attr\">paths:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">pathType:</span> <span class=\"string\">Prefix</span></span><br><span class=\"line\">        <span class=\"attr\">path:</span> <span class=\"string\">/</span></span><br><span class=\"line\">        <span class=\"attr\">backend:</span></span><br><span class=\"line\">          <span class=\"attr\">service:</span></span><br><span class=\"line\">            <span class=\"attr\">name:</span> <span class=\"string\">nginx</span></span><br><span class=\"line\">            <span class=\"attr\">port:</span></span><br><span class=\"line\">              <span class=\"attr\">number:</span> <span class=\"number\">80</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è®¿é—®æµ‹è¯•</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># é‡æ–°è¿è¡Œingress</span></span><br><span class=\"line\">k apply -f nginx-ingress.yaml</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># é»˜è®¤æƒ…å†µä¸‹ curl ä¸ä¼šè‡ªåŠ¨è·³è½¬ï¼Œä½¿ç”¨æµè§ˆå™¨è®¿é—®ä¼šè‡ªåŠ¨é‡å®šå‘ï¼Œ308 è¡¨ç¤ºæ°¸ä¹…é‡å®šå‘</span></span><br><span class=\"line\">$ curl http://nginx.hanqunfeng.com</span><br><span class=\"line\">&lt;html&gt;</span><br><span class=\"line\">&lt;<span class=\"built_in\">head</span>&gt;&lt;title&gt;308 Permanent Redirect&lt;/title&gt;&lt;/head&gt;</span><br><span class=\"line\">&lt;body&gt;</span><br><span class=\"line\">&lt;center&gt;&lt;h1&gt;308 Permanent Redirect&lt;/h1&gt;&lt;/center&gt;</span><br><span class=\"line\">&lt;hr&gt;&lt;center&gt;nginx&lt;/center&gt;</span><br><span class=\"line\">&lt;/body&gt;</span><br><span class=\"line\">&lt;/html&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ·»åŠ  -L å‚æ•°ï¼Œcurl ä¼šè‡ªåŠ¨è·³è½¬</span></span><br><span class=\"line\">$ curl -L http://nginx.hanqunfeng.com</span><br><span class=\"line\">&lt;!DOCTYPE html&gt;</span><br><span class=\"line\">&lt;html&gt;</span><br><span class=\"line\">&lt;<span class=\"built_in\">head</span>&gt;</span><br><span class=\"line\">&lt;title&gt;Welcome to nginx!&lt;/title&gt;</span><br><span class=\"line\">&lt;style&gt;</span><br><span class=\"line\">html &#123; color-scheme: light dark; &#125;</span><br><span class=\"line\">body &#123; width: 35em; margin: 0 auto;</span><br><span class=\"line\">font-family: Tahoma, Verdana, Arial, sans-serif; &#125;</span><br><span class=\"line\">&lt;/style&gt;</span><br><span class=\"line\">&lt;/head&gt;</span><br><span class=\"line\">&lt;body&gt;</span><br><span class=\"line\">&lt;h1&gt;Welcome to nginx!&lt;/h1&gt;</span><br><span class=\"line\">&lt;p&gt;If you see this page, the nginx web server is successfully installed and</span><br><span class=\"line\">working. Further configuration is required.&lt;/p&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;p&gt;For online documentation and support please refer to</span><br><span class=\"line\">&lt;a href=<span class=\"string\">&quot;http://nginx.org/&quot;</span>&gt;nginx.org&lt;/a&gt;.&lt;br/&gt;</span><br><span class=\"line\">Commercial support is available at</span><br><span class=\"line\">&lt;a href=<span class=\"string\">&quot;http://nginx.com/&quot;</span>&gt;nginx.com&lt;/a&gt;.&lt;/p&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;p&gt;&lt;em&gt;Thank you <span class=\"keyword\">for</span> using nginx.&lt;/em&gt;&lt;/p&gt;</span><br><span class=\"line\">&lt;/body&gt;</span><br><span class=\"line\">&lt;/html&gt;</span><br></pre></td></tr></table></figure>\n<h2 id=\"åè®°\">åè®°</h2>\n<h3 id=\"ssl-è¯ä¹¦è¿‡æœŸæ€ä¹ˆåŠï¼Ÿ\">ssl è¯ä¹¦è¿‡æœŸæ€ä¹ˆåŠï¼Ÿ</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># apply ä¼šç›´æ¥æ›´æ–° Secretï¼Œè€Œä¸æ˜¯åˆ é™¤é‡å»º</span></span><br><span class=\"line\">kubectl create secret tls nginx-tls \\</span><br><span class=\"line\">    --key=æ–°çš„.key \\</span><br><span class=\"line\">    --cert=æ–°çš„.pem \\</span><br><span class=\"line\">    -n default --dry-run=client -o yaml | kubectl apply -f -</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Ingress Controllerï¼ˆå¦‚ nginx-ingressï¼‰é€šå¸¸ä¼šè‡ªåŠ¨ç›‘å¬ Secret å˜åŒ–ï¼Œå¤§æ¦‚ 30 ç§’ ~ 1 åˆ†é’Ÿå†…è‡ªåŠ¨çƒ­åŠ è½½æ–°è¯ä¹¦ï¼Œæ— éœ€é‡å¯ Podã€‚</p>\n</li>\n</ul>\n<h3 id=\"pathType-å¯ä»¥è®¾ç½®å“ªäº›å€¼ï¼Ÿ\">pathType å¯ä»¥è®¾ç½®å“ªäº›å€¼ï¼Ÿ</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åœ¨ Kubernetes Ingress çš„ pathType å­—æ®µä¸­ï¼Œä¸€å…±å¯ä»¥è®¾ç½®ä»¥ä¸‹ä¸‰ç§å€¼</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th><strong>pathType å€¼</strong></th>\n<th><strong>å«ä¹‰</strong></th>\n<th><strong>åŒ¹é…è§„åˆ™è¯´æ˜</strong></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>Exact</strong></td>\n<td>ç²¾ç¡®åŒ¹é…</td>\n<td>è·¯å¾„å¿…é¡»<strong>å®Œå…¨åŒ¹é…</strong></td>\n</tr>\n<tr>\n<td><strong>Prefix</strong></td>\n<td>å‰ç¼€åŒ¹é…</td>\n<td>ä»¥æŒ‡å®šè·¯å¾„ä¸º<strong>å‰ç¼€</strong>å³å¯åŒ¹é…</td>\n</tr>\n<tr>\n<td><strong>ImplementationSpecific</strong></td>\n<td>ç”± Ingress Controller è‡ªå·±å†³å®š</td>\n<td>nginx å¸¸å¸¸è¡¨ç°ä¸ºå‰ç¼€åŒ¹é…</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Exact ç²¾ç¡®åŒ¹é…ï¼Œä¸”åŒºåˆ†å¤§å°å†™</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åªåŒ¹é… http://example.com/foo</span></span><br><span class=\"line\"><span class=\"comment\"># ä¸ä¼šåŒ¹é… /foo/abc æˆ– /foo/</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">pathType:</span> <span class=\"string\">Exact</span></span><br><span class=\"line\">  <span class=\"attr\">path:</span> <span class=\"string\">/foo</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Prefix å‰ç¼€åŒ¹é…ï¼Œä¸”åŒºåˆ†å¤§å°å†™</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åŒ¹é…æ‰€æœ‰ä»¥ /foo å¼€å¤´çš„è·¯å¾„ï¼š</span></span><br><span class=\"line\"><span class=\"comment\">#   /foo</span></span><br><span class=\"line\"><span class=\"comment\">#   /foo/   # ä¼šå¿½ç•¥å°¾éƒ¨çš„ /</span></span><br><span class=\"line\"><span class=\"comment\">#   /foo/abc</span></span><br><span class=\"line\"><span class=\"comment\">#   /foo/bar/test</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">pathType:</span> <span class=\"string\">Prefix</span></span><br><span class=\"line\">  <span class=\"attr\">path:</span> <span class=\"string\">/foo</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ImplementationSpecific æ§åˆ¶å™¨è‡ªå®šä¹‰ï¼ˆä¸æ¨èï¼‰</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åŒ¹é…è§„åˆ™ç”± Ingress Controller å†³å®šï¼›</span></span><br><span class=\"line\"><span class=\"comment\"># åœ¨ nginx-ingress ä¸­é€šå¸¸è¡Œä¸ºç±»ä¼¼äº Prefixï¼Œä½†ä¸ä¿è¯å…¼å®¹æ€§ï¼›</span></span><br><span class=\"line\"><span class=\"comment\"># Kubernetes å®˜æ–¹ä¸æ¨èç”Ÿäº§ä½¿ç”¨ï¼Œå»ºè®®æ˜¾å¼ä½¿ç”¨ Prefix æˆ– Exactã€‚</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">pathType:</span> <span class=\"string\">ImplementationSpecific</span></span><br><span class=\"line\">  <span class=\"attr\">path:</span> <span class=\"string\">/foo</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"è®¾ç½®ç¼ºçœçš„-ingressclass\">è®¾ç½®ç¼ºçœçš„ ingressclass</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æˆ‘ä»¬å¯ä»¥è®¾ç½®ä¸€ä¸ªç¼ºçœçš„ ingressclass ä¸ºé»˜è®¤å€¼ï¼Œè¿™æ ·ï¼Œå½“åˆ›å»ºingressæ—¶ï¼Œå¦‚æœæœªæŒ‡å®šingressclassï¼Œåˆ™ä½¿ç”¨ç¼ºçœå€¼</p>\n</li>\n<li class=\"lvl-2\">\n<p>å¯ä»¥é€šè¿‡ kubectl patch ä¸º ingressclass ç›´æ¥æ‰“ä¸Šé»˜è®¤æ ‡è¯†(é€šè¿‡ k edit ingressclass ingressclass-name ä¸ºå…¶æ·»åŠ æ³¨è§£ä¹Ÿå¯ä»¥)</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹ ingressclasses</span></span><br><span class=\"line\">$ k get ingressclasses</span><br><span class=\"line\">NAME    CONTROLLER             PARAMETERS   AGE</span><br><span class=\"line\">nginx   k8s.io/ingress-nginx   &lt;none&gt;       3h3m</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># è®¾ç½® nginx ä¸ºé»˜è®¤ ingressclassï¼Œå°±æ˜¯ä¸ºå…¶åŠ ä¸Šå¦‚ä¸‹æ³¨è§£</span></span><br><span class=\"line\">$ kubectl patch ingressclass nginx -p <span class=\"string\">&#x27;&#123;&quot;metadata&quot;: &#123;&quot;annotations&quot;:&#123;&quot;ingressclass.kubernetes.io/is-default-class&quot;:&quot;true&quot;&#125;&#125;&#125;&#x27;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"ingerss-nginx-åº”ç”¨ç¤ºä¾‹\">ingerss-nginx åº”ç”¨ç¤ºä¾‹</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åŒä¸€åŸŸåä¸åŒè·¯å¾„<br>\n<img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/uPic/s1XbqM.png\" alt=\"\"></p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">networking.k8s.io/v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Ingress</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">simple-fanout-example</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span>                       <span class=\"comment\"># æœªæŒ‡å®š ingressClassName ,åˆ™ä½¿ç”¨ ä¸Šæ–‡ä¸­è®¾ç½®çš„é»˜è®¤ ingressClassName</span></span><br><span class=\"line\">  <span class=\"attr\">rules:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">host:</span> <span class=\"string\">foo.bar.com</span></span><br><span class=\"line\">    <span class=\"attr\">http:</span></span><br><span class=\"line\">      <span class=\"attr\">paths:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">path:</span> <span class=\"string\">/foo</span></span><br><span class=\"line\">        <span class=\"attr\">pathType:</span> <span class=\"string\">Prefix</span></span><br><span class=\"line\">        <span class=\"attr\">backend:</span></span><br><span class=\"line\">          <span class=\"attr\">service:</span></span><br><span class=\"line\">            <span class=\"attr\">name:</span> <span class=\"string\">service1</span></span><br><span class=\"line\">            <span class=\"attr\">port:</span></span><br><span class=\"line\">              <span class=\"attr\">number:</span> <span class=\"number\">4200</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">path:</span> <span class=\"string\">/bar</span></span><br><span class=\"line\">        <span class=\"attr\">pathType:</span> <span class=\"string\">Prefix</span></span><br><span class=\"line\">        <span class=\"attr\">backend:</span></span><br><span class=\"line\">          <span class=\"attr\">service:</span></span><br><span class=\"line\">            <span class=\"attr\">name:</span> <span class=\"string\">service2</span></span><br><span class=\"line\">            <span class=\"attr\">port:</span></span><br><span class=\"line\">              <span class=\"attr\">number:</span> <span class=\"number\">8080</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¸åŒåŸŸåçš„æœåŠ¡<br>\n<img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/uPic/sBhmbR.png\" alt=\"\"></p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">networking.k8s.io/v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Ingress</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">name-virtual-host-ingress</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">rules:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">host:</span> <span class=\"string\">foo.bar.com</span></span><br><span class=\"line\">    <span class=\"attr\">http:</span></span><br><span class=\"line\">      <span class=\"attr\">paths:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">pathType:</span> <span class=\"string\">Prefix</span></span><br><span class=\"line\">        <span class=\"attr\">path:</span> <span class=\"string\">&quot;/&quot;</span></span><br><span class=\"line\">        <span class=\"attr\">backend:</span></span><br><span class=\"line\">          <span class=\"attr\">service:</span></span><br><span class=\"line\">            <span class=\"attr\">name:</span> <span class=\"string\">service1</span></span><br><span class=\"line\">            <span class=\"attr\">port:</span></span><br><span class=\"line\">              <span class=\"attr\">number:</span> <span class=\"number\">80</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">host:</span> <span class=\"string\">bar.foo.com</span></span><br><span class=\"line\">    <span class=\"attr\">http:</span></span><br><span class=\"line\">      <span class=\"attr\">paths:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">pathType:</span> <span class=\"string\">Prefix</span></span><br><span class=\"line\">        <span class=\"attr\">path:</span> <span class=\"string\">&quot;/&quot;</span></span><br><span class=\"line\">        <span class=\"attr\">backend:</span></span><br><span class=\"line\">          <span class=\"attr\">service:</span></span><br><span class=\"line\">            <span class=\"attr\">name:</span> <span class=\"string\">service2</span></span><br><span class=\"line\">            <span class=\"attr\">port:</span></span><br><span class=\"line\">              <span class=\"attr\">number:</span> <span class=\"number\">80</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>é€šè¿‡å¦‚ä¸‹å‘½ä»¤å¯¹ ingress è¿›è¡Œä¿®æ”¹ï¼Œä¿®æ”¹ä¿å­˜(:wq)åä¼šç«‹åˆ»ç”Ÿæ•ˆ</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl edit ingress web-ingress</span><br></pre></td></tr></table></figure>","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» K8S å®‰è£…åŠä½¿ç”¨ Ingress Nginxï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚ K8Så®˜ç½‘ ingress-nginx å®˜ç½‘ ingress-nginx k8sç®€ä»‹ k8sæ”¯æŒçš„ ingress controller Ingress ç®€ä»‹ Ingress(ç¼©å†™ä¸º ing) æä¾›ä»é›†ç¾¤å¤–éƒ¨åˆ°é›†ç¾¤å†…æœåŠ¡çš„ HTTP å’Œ HTTPS è·¯ç”±(7å±‚)ã€‚ æµé‡è·¯ç”±ç”± Ingress èµ„æºæ‰€å®šä¹‰çš„è§„åˆ™æ¥æ§åˆ¶ã€‚ å®é™…ä¸Š Ingress-Nginx å†…ç½®äº† nginxï¼Œç”± nginx å…¶è´Ÿè´£æ¥æ”¶è¯·æ±‚å¹¶è½¬å‘ç»™åç«¯æœåŠ¡ã€‚ ä¸‹é¢æ˜¯ Ingress çš„ä¸€ä¸ªç®€å•ç¤ºä¾‹ï¼Œå¯å°†æ‰€æœ‰æµé‡éƒ½å‘é€åˆ°åŒä¸€ Service å®‰è£… Ingress-Nginx å®‰è£…æ—¶è¦æ³¨æ„ ingress-nginx çš„ç‰ˆæœ¬å’Œ Kubernetes çš„ç‰ˆæœ¬å…¼å®¹æ€§ï¼Œå‚è€ƒ Github:ingress-nginxã€‚ è·å–å¯¹åº”ç‰ˆæœ¬çš„yamlæ–‡ä»¶ 123# ä¸‹è½½æœ€æ–°çš„ v1.13.0 ç‰ˆæœ¬ï¼Œå…¶æ”¯æŒ Kubernetes 1.33 ç‰ˆæœ¬export INGRESS_NGINX_VERSION=v1.13.0curl -L -o ingress-nginx-controller.yaml https://raw.githubusercontent.com/kubernetes/ingress-nginx/controller-$&#123;INGRESS_NGINX_VERSION&#125;/deploy/static/provider/cloud/deploy.yaml å®‰è£… ingress-nginx è¿™é‡Œè¦æ³¨æ„ï¼Œingress-nginx çš„ service/ingress-nginx-controller é»˜è®¤ä½¿ç”¨ LoadBalancer ç±»å‹ï¼Œæ‰€ä»¥éœ€è¦å…ˆä½¿ k8s é›†ç¾¤æ”¯æŒ LoadBalancer ç±»å‹ï¼Œå¯ä»¥å‚è€ƒ K8S ä¹‹ Service ä¸­ LoadBalancer éƒ¨åˆ†ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940$ kubectl apply -f ingress-nginx-controller.yamlnamespace/ingress-nginx createdserviceaccount/ingress-nginx createdserviceaccount/ingress-nginx-admission createdrole.rbac.authorization.k8s.io/ingress-nginx createdrole.rbac.authorization.k8s.io/ingress-nginx-admission createdclusterrole.rbac.authorization.k8s.io/ingress-nginx createdclusterrole.rbac.authorization.k8s.io/ingress-nginx-admission createdrolebinding.rbac.authorization.k8s.io/ingress-nginx createdrolebinding.rbac.authorization.k8s.io/ingress-nginx-admission createdclusterrolebinding.rbac.authorization.k8s.io/ingress-nginx createdclusterrolebinding.rbac.authorization.k8s.io/ingress-nginx-admission createdconfigmap/ingress-nginx-controller createdservice/ingress-nginx-controller createdservice/ingress-nginx-controller-admission createddeployment.apps/ingress-nginx-controller createdjob.batch/ingress-nginx-admission-create createdjob.batch/ingress-nginx-admission-patch createdingressclass.networking.k8s.io/nginx createdvalidatingwebhookconfiguration.admissionregistration.k8s.io/ingress-nginx-admission created# æŸ¥çœ‹ingress-nginxèµ„æº$ k get all -n ingress-nginxNAME READY STATUS RESTARTS AGEpod/ingress-nginx-controller-95f6586c6-nznwq 1/1 Running 0 2m46sNAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGEservice/ingress-nginx-controller LoadBalancer 10.96.112.234 10.211.55.201 80:30168/TCP,443:30600/TCP 2m46sservice/ingress-nginx-controller-admission ClusterIP 10.96.245.155 &lt;none&gt; 443/TCP 2m46sNAME READY UP-TO-DATE AVAILABLE AGEdeployment.apps/ingress-nginx-controller 1/1 1 1 2m46sNAME DESIRED CURRENT READY AGEreplicaset.apps/ingress-nginx-controller-95f6586c6 1 1 1 2m46s# æŸ¥çœ‹ IngressClass èµ„æº$ k get ingressclasses.networking.k8s.ioNAME CONTROLLER PARAMETERS AGEnginx k8s.io/ingress-nginx &lt;none&gt; 14m åˆ›å»º Ingress èµ„æº ingress-demo.yaml 123456789101112131415161718apiVersion: networking.k8s.io/v1kind: Ingress # Ingress èµ„æºmetadata: name: web-ingress # Ingress åç§° namespace: default # Ingress æ‰€åœ¨çš„å‘½åç©ºé—´spec: ingressClassName: nginx # Ingress ä½¿ç”¨çš„ IngressClass rules: - host: nginx.hanqunfeng.com # è½¬å‘åŸŸåï¼Œæ”¯æŒé€šé…ç¬¦ *.hanqunfeng.com http: paths: - pathType: Prefix # è·¯å¾„åŒ¹é…è§„åˆ™, å‰ç¼€åŒ¹é… path: / # è·¯å¾„ backend: # åç«¯æœåŠ¡ service: # å£°æ˜åç«¯æ˜¯ä¸€ä¸ª service name: nginx # serviceåç§°ï¼Œæå‰åˆ›å»ºå¥½ serviceï¼Œç±»å‹å¯ä»¥æ˜¯ClusterIPã€NodePortã€LoadBalancerä»»æ„ï¼Œæ¨èClusterIPï¼Œå› ä¸ºä½¿ç”¨ ingress çš„è¯ï¼Œå°±æ²¡å¿…è¦åˆ›å»ºå…¶å®ƒç±»å‹çš„ service äº† port: # ç«¯å£ number: 80 # serviceçš„ç«¯å£ æŸ¥çœ‹ ingress èµ„æº 123$ k get ing -n ns1NAME CLASS HOSTS ADDRESS PORTS AGEweb-ingress nginx nginx.hanqunfeng.com 10.211.55.201 80 80s è®¿é—® web-ingress 123# å°†åŸŸå nginx.hanqunfeng.com è§£æåˆ° 10.211.55.201ï¼Œå¦‚æœæ˜¯å†…éƒ¨åŸŸåå¯ä»¥é€šè¿‡ hosts æ–‡ä»¶æ·»åŠ è§£æ# åªèƒ½é€šè¿‡ nginx.hanqunfeng.com è®¿é—®ï¼Œä¸èƒ½é€šè¿‡ 10.211.55.201 è®¿é—®curl http://nginx.hanqunfeng.com è®© Ingress æ”¯æŒ HTTPS è®¿é—® åˆ›å»ºè¯ä¹¦ï¼Œå¯ä»¥åœ¨é˜¿é‡Œäº‘ä¸Šç”³è¯·ä¸€ä¸ªå…è´¹çš„è¯ä¹¦ åˆ›å»º secret 1234kubectl create secret tls nginx-tls \\ --key=nginx.hanqunfeng.com.key \\ --cert=nginx.hanqunfeng.com.pem \\ -n default ä¹Ÿå¯ä»¥é€šè¿‡yamlåˆ›å»º 123456789apiVersion: v1kind: Secretmetadata: name: nginx-tls namespace: defaultdata: tls.crt: base64 ç¼–ç çš„è¯ä¹¦ï¼Œè€Œéæ–‡ä»¶è·¯å¾„ tls.key: base64 ç¼–ç çš„ç§é’¥ï¼Œè€Œéæ–‡ä»¶è·¯å¾„type: kubernetes.io/tls ä½ çš„ Ingress èµ„æºéœ€è¦å¢åŠ  tls å­—æ®µï¼Œå¼•ç”¨ä¸€ä¸ª Secret å­˜å‚¨çš„ TLS è¯ä¹¦ã€‚ 12345678910111213141516171819202122apiVersion: networking.k8s.io/v1kind: Ingress # Ingress èµ„æºmetadata: name: web-ingress # Ingress åç§° namespace: default # Ingress æ‰€åœ¨çš„å‘½åç©ºé—´spec: ingressClassName: nginx # Ingress ä½¿ç”¨çš„ IngressClass tls: # é…ç½® TLS - hosts: # åŸŸååˆ—è¡¨ - nginx.hanqunfeng.com # åŸŸå secretName: nginx-tls # å­˜æ”¾è¯ä¹¦çš„ Secret rules: - host: nginx.hanqunfeng.com #è½¬å‘åŸŸå http: paths: - pathType: Prefix # è·¯å¾„åŒ¹é…è§„åˆ™, å‰ç¼€åŒ¹é… path: / # è·¯å¾„ backend: # åç«¯æœåŠ¡ service: # service name: nginx # serviceåç§° port: # ç«¯å£ number: 80 # serviceçš„ç«¯å£ 12345678910# é‡æ–°è¿è¡Œingressk apply -f nginx-ingress.yaml# æŸ¥çœ‹ingressï¼Œæ­¤æ—¶å¤šäº†ä¸€ä¸ª 443 ç«¯å£$ k get ingNAME CLASS HOSTS ADDRESS PORTS AGEweb-ingress nginx nginx.hanqunfeng.com 10.211.55.201 80, 443 51s# è®¿é—®httpsï¼Œä½†æ­¤æ—¶ 80 ç«¯å£è®¿é—®ä¸äº†ï¼Œéœ€è¦é…ç½® 80 ç«¯å£é‡å®šå‘åˆ° 443curl https://nginx.hanqunfeng.com 80ç«¯å£é‡å®šå‘åˆ°443 nginx ingress controllerï¼Œå®ƒå†…ç½®æ”¯æŒé‡å®šå‘ï¼Œä½ å¯ä»¥åœ¨ Ingress ä¸Šæ·»åŠ  annotation 123metadata: annotations: nginx.ingress.kubernetes.io/force-ssl-redirect: &quot;true&quot; # 80 é‡å®šå‘åˆ° 443 å®Œæ•´çš„yaml 123456789101112131415161718192021222324apiVersion: networking.k8s.io/v1kind: Ingressmetadata: name: web-ingress namespace: default annotations: nginx.ingress.kubernetes.io/force-ssl-redirect: &quot;true&quot;spec: ingressClassName: nginx tls: - hosts: - nginx.hanqunfeng.com secretName: nginx-tls rules: - host: nginx.hanqunfeng.com http: paths: - pathType: Prefix path: / backend: service: name: nginx port: number: 80 è®¿é—®æµ‹è¯• 1234567891011121314151617181920212223242526272829303132333435363738# é‡æ–°è¿è¡Œingressk apply -f nginx-ingress.yaml# é»˜è®¤æƒ…å†µä¸‹ curl ä¸ä¼šè‡ªåŠ¨è·³è½¬ï¼Œä½¿ç”¨æµè§ˆå™¨è®¿é—®ä¼šè‡ªåŠ¨é‡å®šå‘ï¼Œ308 è¡¨ç¤ºæ°¸ä¹…é‡å®šå‘$ curl http://nginx.hanqunfeng.com&lt;html&gt;&lt;head&gt;&lt;title&gt;308 Permanent Redirect&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&lt;center&gt;&lt;h1&gt;308 Permanent Redirect&lt;/h1&gt;&lt;/center&gt;&lt;hr&gt;&lt;center&gt;nginx&lt;/center&gt;&lt;/body&gt;&lt;/html&gt;# æ·»åŠ  -L å‚æ•°ï¼Œcurl ä¼šè‡ªåŠ¨è·³è½¬$ curl -L http://nginx.hanqunfeng.com&lt;!DOCTYPE html&gt;&lt;html&gt;&lt;head&gt;&lt;title&gt;Welcome to nginx!&lt;/title&gt;&lt;style&gt;html &#123; color-scheme: light dark; &#125;body &#123; width: 35em; margin: 0 auto;font-family: Tahoma, Verdana, Arial, sans-serif; &#125;&lt;/style&gt;&lt;/head&gt;&lt;body&gt;&lt;h1&gt;Welcome to nginx!&lt;/h1&gt;&lt;p&gt;If you see this page, the nginx web server is successfully installed andworking. Further configuration is required.&lt;/p&gt;&lt;p&gt;For online documentation and support please refer to&lt;a href=&quot;http://nginx.org/&quot;&gt;nginx.org&lt;/a&gt;.&lt;br/&gt;Commercial support is available at&lt;a href=&quot;http://nginx.com/&quot;&gt;nginx.com&lt;/a&gt;.&lt;/p&gt;&lt;p&gt;&lt;em&gt;Thank you for using nginx.&lt;/em&gt;&lt;/p&gt;&lt;/body&gt;&lt;/html&gt; åè®° ssl è¯ä¹¦è¿‡æœŸæ€ä¹ˆåŠï¼Ÿ 12345# apply ä¼šç›´æ¥æ›´æ–° Secretï¼Œè€Œä¸æ˜¯åˆ é™¤é‡å»ºkubectl create secret tls nginx-tls \\ --key=æ–°çš„.key \\ --cert=æ–°çš„.pem \\ -n default --dry-run=client -o yaml | kubectl apply -f - Ingress Controllerï¼ˆå¦‚ nginx-ingressï¼‰é€šå¸¸ä¼šè‡ªåŠ¨ç›‘å¬ Secret å˜åŒ–ï¼Œå¤§æ¦‚ 30 ç§’ ~ 1 åˆ†é’Ÿå†…è‡ªåŠ¨çƒ­åŠ è½½æ–°è¯ä¹¦ï¼Œæ— éœ€é‡å¯ Podã€‚ pathType å¯ä»¥è®¾ç½®å“ªäº›å€¼ï¼Ÿ åœ¨ Kubernetes Ingress çš„ pathType å­—æ®µä¸­ï¼Œä¸€å…±å¯ä»¥è®¾ç½®ä»¥ä¸‹ä¸‰ç§å€¼ pathType å€¼ å«ä¹‰ åŒ¹é…è§„åˆ™è¯´æ˜ Exact ç²¾ç¡®åŒ¹é… è·¯å¾„å¿…é¡»å®Œå…¨åŒ¹é… Prefix å‰ç¼€åŒ¹é… ä»¥æŒ‡å®šè·¯å¾„ä¸ºå‰ç¼€å³å¯åŒ¹é… ImplementationSpecific ç”± Ingress Controller è‡ªå·±å†³å®š nginx å¸¸å¸¸è¡¨ç°ä¸ºå‰ç¼€åŒ¹é… Exact ç²¾ç¡®åŒ¹é…ï¼Œä¸”åŒºåˆ†å¤§å°å†™ 1234# åªåŒ¹é… http://example.com/foo# ä¸ä¼šåŒ¹é… /foo/abc æˆ– /foo/- pathType: Exact path: /foo Prefix å‰ç¼€åŒ¹é…ï¼Œä¸”åŒºåˆ†å¤§å°å†™ 1234567# åŒ¹é…æ‰€æœ‰ä»¥ /foo å¼€å¤´çš„è·¯å¾„ï¼š# /foo# /foo/ # ä¼šå¿½ç•¥å°¾éƒ¨çš„ /# /foo/abc# /foo/bar/test- pathType: Prefix path: /foo ImplementationSpecific æ§åˆ¶å™¨è‡ªå®šä¹‰ï¼ˆä¸æ¨èï¼‰ 12345# åŒ¹é…è§„åˆ™ç”± Ingress Controller å†³å®šï¼›# åœ¨ nginx-ingress ä¸­é€šå¸¸è¡Œä¸ºç±»ä¼¼äº Prefixï¼Œä½†ä¸ä¿è¯å…¼å®¹æ€§ï¼›# Kubernetes å®˜æ–¹ä¸æ¨èç”Ÿäº§ä½¿ç”¨ï¼Œå»ºè®®æ˜¾å¼ä½¿ç”¨ Prefix æˆ– Exactã€‚- pathType: ImplementationSpecific path: /foo è®¾ç½®ç¼ºçœçš„ ingressclass æˆ‘ä»¬å¯ä»¥è®¾ç½®ä¸€ä¸ªç¼ºçœçš„ ingressclass ä¸ºé»˜è®¤å€¼ï¼Œè¿™æ ·ï¼Œå½“åˆ›å»ºingressæ—¶ï¼Œå¦‚æœæœªæŒ‡å®šingressclassï¼Œåˆ™ä½¿ç”¨ç¼ºçœå€¼ å¯ä»¥é€šè¿‡ kubectl patch ä¸º ingressclass ç›´æ¥æ‰“ä¸Šé»˜è®¤æ ‡è¯†(é€šè¿‡ k edit ingressclass ingressclass-name ä¸ºå…¶æ·»åŠ æ³¨è§£ä¹Ÿå¯ä»¥) 1234567# æŸ¥çœ‹ ingressclasses$ k get ingressclassesNAME CONTROLLER PARAMETERS AGEnginx k8s.io/ingress-nginx &lt;none&gt; 3h3m# è®¾ç½® nginx ä¸ºé»˜è®¤ ingressclassï¼Œå°±æ˜¯ä¸ºå…¶åŠ ä¸Šå¦‚ä¸‹æ³¨è§£$ kubectl patch ingressclass nginx -p &#x27;&#123;&quot;metadata&quot;: &#123;&quot;annotations&quot;:&#123;&quot;ingressclass.kubernetes.io/is-default-class&quot;:&quot;true&quot;&#125;&#125;&#125;&#x27; ingerss-nginx åº”ç”¨ç¤ºä¾‹ åŒä¸€åŸŸåä¸åŒè·¯å¾„ 1234567891011121314151617181920212223apiVersion: networking.k8s.io/v1kind: Ingressmetadata: name: simple-fanout-examplespec: # æœªæŒ‡å®š ingressClassName ,åˆ™ä½¿ç”¨ ä¸Šæ–‡ä¸­è®¾ç½®çš„é»˜è®¤ ingressClassName rules: - host: foo.bar.com http: paths: - path: /foo pathType: Prefix backend: service: name: service1 port: number: 4200 - path: /bar pathType: Prefix backend: service: name: service2 port: number: 8080 ä¸åŒåŸŸåçš„æœåŠ¡ 1234567891011121314151617181920212223242526apiVersion: networking.k8s.io/v1kind: Ingressmetadata: name: name-virtual-host-ingressspec: rules: - host: foo.bar.com http: paths: - pathType: Prefix path: &quot;/&quot; backend: service: name: service1 port: number: 80 - host: bar.foo.com http: paths: - pathType: Prefix path: &quot;/&quot; backend: service: name: service2 port: number: 80 é€šè¿‡å¦‚ä¸‹å‘½ä»¤å¯¹ ingress è¿›è¡Œä¿®æ”¹ï¼Œä¿®æ”¹ä¿å­˜(:wq)åä¼šç«‹åˆ»ç”Ÿæ•ˆ 1kubectl edit ingress web-ingress","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» K8S å®‰è£…åŠä½¿ç”¨ Ingress Nginxï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚ K8Så®˜ç½‘ ingress-nginx å®˜ç½‘ ingress-nginx k8sç®€ä»‹ k8sæ”¯æŒçš„ ingress controller","date_published":"2025-07-19T13:30:05.000Z","tags":["æŠ€æœ¯","k8s","K8S"]},{"id":"https://blog.hanqunfeng.com/2025/07/18/k8s-service/","url":"https://blog.hanqunfeng.com/2025/07/18/k8s-service/","title":"K8S ä¹‹ Service","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç» K8S çš„ Service ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://kubernetes.io/zh-cn/\">K8Så®˜ç½‘</a></p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://github.com/kubernetes/kubernetes\">k8s Github</a></p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://kubernetes.io/zh-cn/docs/concepts/services-networking/service/\">k8s Service ä»‹ç»</a></p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"Service-ä»‹ç»\">Service ä»‹ç»</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Service(ç¼©å†™ä¸º svc)æ˜¯ä¸€ä¸ªæŠ½è±¡å±‚ï¼Œå®ƒå®šä¹‰äº†ä¸€ç»„Podçš„é€»è¾‘é›†ï¼Œå¹¶ä¸ºè¿™äº›Podæ”¯æŒå¤–éƒ¨æµé‡æš´éœ²ã€è´Ÿè½½å‡è¡¡å’ŒæœåŠ¡å‘ç°ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å°½ç®¡æ¯ä¸ªPod éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„IPåœ°å€ï¼Œä½†æ˜¯å¦‚æœæ²¡æœ‰Serviceï¼Œè¿™äº›IPä¸ä¼šæš´éœ²åœ¨ç¾¤é›†å¤–éƒ¨ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>Serviceå…è®¸æ‚¨çš„åº”ç”¨ç¨‹åºæ¥æ”¶æµé‡ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>Serviceä¹Ÿå¯ä»¥ç”¨åœ¨ServiceSpecæ ‡è®°typeçš„æ–¹å¼æš´éœ²ï¼Œtypeç±»å‹å¦‚ä¸‹ï¼š</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">ClusterIPï¼ˆé»˜è®¤ï¼‰ï¼šåœ¨é›†ç¾¤çš„å†…éƒ¨IPä¸Šå…¬å¼€Serviceã€‚è¿™ç§ç±»å‹ä½¿å¾—Serviceåªèƒ½ä»é›†ç¾¤å†…è®¿é—®ã€‚</li>\n<li class=\"lvl-4\">NodePortï¼šä½¿ç”¨NATåœ¨é›†ç¾¤ä¸­æ¯ä¸ªé€‰å®šNodeçš„ç›¸åŒç«¯å£ä¸Šå…¬å¼€Serviceã€‚ä½¿ç”¨ <NodeIP>:<NodePort> ä»é›†ç¾¤å¤–éƒ¨è®¿é—®Serviceã€‚æ˜¯ClusterIPçš„è¶…é›†ã€‚</li>\n<li class=\"lvl-4\">LoadBalancerï¼šåœ¨å½“å‰äº‘ä¸­åˆ›å»ºä¸€ä¸ªå¤–éƒ¨è´Ÿè½½å‡è¡¡å™¨(å¦‚æœæ”¯æŒçš„è¯)ï¼Œå¹¶ä¸ºServiceåˆ†é…ä¸€ä¸ªå›ºå®šçš„å¤–éƒ¨IPã€‚æ˜¯NodePortçš„è¶…é›†ã€‚</li>\n<li class=\"lvl-4\">ExternalNameï¼šé€šè¿‡è¿”å›å¸¦æœ‰è¯¥åç§°çš„CNAMEè®°å½•ï¼Œä½¿ç”¨ä»»æ„åç§°ï¼ˆç”±specä¸­çš„externalNameæŒ‡å®šï¼‰å…¬å¼€Serviceã€‚ä¸ä½¿ç”¨ä»£ç†ã€‚</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"åˆ›å»ºService\">åˆ›å»ºService</h2>\n<h3 id=\"ClusterIP\">ClusterIP</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åªèƒ½åœ¨é›†ç¾¤å†…éƒ¨è®¿é—®</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å…ˆåˆ›å»ºdeploymentï¼Œæ­¤æ—¶ä¼šä¸ºæ¯ä¸ªpodæ·»åŠ ä¸€ä¸ªlabel app=nginx</span></span><br><span class=\"line\">kubectl create deployment nginx --image=nginx --replicas=2</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åˆ›å»ºserviceï¼Œï¼Œå°†deploymentçš„podæš´éœ²å‡ºæ¥ï¼Œæš´éœ²ç±»å‹ä¸ºClusterIP</span></span><br><span class=\"line\">kubectl expose deployment nginx --<span class=\"built_in\">type</span>=ClusterIP --port=80</span><br><span class=\"line\">$ kubectl get svc nginx</span><br><span class=\"line\">NAME    TYPE        CLUSTER-IP    EXTERNAL-IP   PORT(S)   AGE</span><br><span class=\"line\">nginx   ClusterIP   10.96.14.90   &lt;none&gt;        80/TCP    60s</span><br></pre></td></tr></table></figure>\n<h3 id=\"NodePort\">NodePort</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æš´éœ²å®¿ä¸»æœºçš„ç«¯å£ï¼Œä¾›å¤–éƒ¨è®¿é—®</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åˆ›å»ºserviceï¼Œå°†deploymentçš„podæš´éœ²å‡ºæ¥ï¼Œæš´éœ²ç±»å‹ä¸ºNodePort</span></span><br><span class=\"line\">kubectl expose deployment nginx --<span class=\"built_in\">type</span>=NodePort --port=80</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹serviceï¼Œæ­¤æ—¶å¯ä»¥çœ‹åˆ°serviceçš„ç«¯å£å’ŒèŠ‚ç‚¹çš„ç«¯å£ï¼Œä¸ ClusterIP çš„åŒºåˆ«å°±æ˜¯æ˜¯å¦æš´éœ²åœ¨èŠ‚ç‚¹ä¸Šçš„ç«¯å£</span></span><br><span class=\"line\">$ kubectl get svc nginx</span><br><span class=\"line\">NAME    TYPE       CLUSTER-IP   EXTERNAL-IP   PORT(S)        AGE</span><br><span class=\"line\">nginx   NodePort   10.96.7.8    &lt;none&gt;        80:32691/TCP   31s</span><br></pre></td></tr></table></figure>\n<h3 id=\"yamlæ–‡ä»¶åˆ›å»ºservice\">yamlæ–‡ä»¶åˆ›å»ºservice</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>yamlæ–‡ä»¶æ ¼å¼</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span>      <span class=\"comment\"># apiç‰ˆæœ¬</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Service</span>       <span class=\"comment\"># èµ„æºç±»å‹</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span>           <span class=\"comment\"># å…ƒæ•°æ®</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">nginx</span>       <span class=\"comment\"># serviceåç§°</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span>               <span class=\"comment\"># é…ç½®</span></span><br><span class=\"line\">  <span class=\"attr\">ports:</span>            <span class=\"comment\"># ç«¯å£</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">port:</span> <span class=\"number\">80</span>        <span class=\"comment\"># é›†ç¾¤å†…è®¿é—®ç«¯å£ï¼Œserviceçš„ç«¯å£ï¼Œä¸€èˆ¬é…ç½®ä¸ºä¸ targetPort ä¸€è‡´ï¼Œä½†æ˜¯éå¿…é¡»</span></span><br><span class=\"line\">    <span class=\"attr\">protocol:</span> <span class=\"string\">TCP</span>   <span class=\"comment\"># åè®®</span></span><br><span class=\"line\">    <span class=\"attr\">targetPort:</span> <span class=\"number\">80</span>  <span class=\"comment\"># å®¹å™¨ç«¯å£, podçš„ç«¯å£ï¼Œè¿™ä¸ªå¿…é¡»ä¸å®é™…å®¹å™¨ç«¯å£ä¸€è‡´</span></span><br><span class=\"line\">    <span class=\"attr\">nodePort:</span> <span class=\"number\">30080</span> <span class=\"comment\"># nodeæš´éœ²çš„ç«¯å£ï¼Œserviceç±»å‹ä¸º NodePort æ—¶ä½¿ç”¨ï¼Œé»˜è®¤èŒƒå›´åœ¨ 30000-32767 ä¹‹é—´</span></span><br><span class=\"line\">  <span class=\"attr\">selector:</span>         <span class=\"comment\"># é€‰æ‹©å™¨</span></span><br><span class=\"line\">    <span class=\"attr\">app:</span> <span class=\"string\">nginx</span>      <span class=\"comment\"># podçš„æ ‡ç­¾ï¼Œå³åŒ¹é…podçš„æ ‡ç­¾ app=nginx</span></span><br><span class=\"line\">  <span class=\"attr\">type:</span> <span class=\"string\">NodePort</span>    <span class=\"comment\"># serviceç±»å‹</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¿™é‡Œæœ‰ä¸ªé—®é¢˜éœ€è¦æ³¨æ„ï¼Œservice é»˜è®¤æ˜¯é€šè¿‡<code>æ ‡ç­¾</code>æ¥åŒ¹é…podçš„ï¼Œæ‰€ä»¥åˆ›å»ºserviceçš„æ—¶å€™ï¼Œä¸€å®šè¦ä¿è¯podçš„æ ‡ç­¾æ˜¯å­˜åœ¨çš„ï¼Œå¦åˆ™serviceæ— æ³•åŒ¹é…podï¼Œå¦å¤–è™½ç„¶æˆ‘ä»¬é€šè¿‡å‘½ä»¤è¡Œåˆ›å»ºserviceæ—¶æ˜¯é€šè¿‡<code>kubectl expose deployment nginx --type=NodePort --port=80</code>åˆ›å»ºçš„ï¼Œä½†ä¹Ÿå¹¶ä¸è¡¨ç¤ºserviceåªä¼šåŒ¹é…è¿™ä¸ªdeploymentåˆ›å»ºçš„podï¼Œè€Œæ˜¯ä¼šåŒ¹é…æ‰€æœ‰å…·æœ‰æŒ‡å®šæ ‡ç­¾çš„podï¼ˆapp=nginxï¼‰ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># è·å–serviceçš„ selector</span></span><br><span class=\"line\">$ k get svc -owide</span><br><span class=\"line\">NAME         TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)        AGE    SELECTOR</span><br><span class=\"line\">kubernetes   ClusterIP   10.96.0.1    &lt;none&gt;        443/TCP        4d5h   &lt;none&gt;</span><br><span class=\"line\">nginx        NodePort    10.96.9.77   &lt;none&gt;        80:30080/TCP   8s     app=nginx</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># è¿™é‡Œæœ‰ä¸ªåç§°ä¸º kubernetes çš„ serviceï¼Œå…¶ä½œç”¨æ˜¯ä¸ºäº†æ–¹ä¾¿é›†ç¾¤å†…éƒ¨çš„ Pod è°ƒç”¨ API Server çš„ç»Ÿä¸€å…¥å£</span></span><br><span class=\"line\"><span class=\"comment\"># æ— è®º API Server å®é™…è¿è¡Œåœ¨å“ªä¸ªèŠ‚ç‚¹å“ªä¸ª IPï¼Œé›†ç¾¤å†…éƒ¨åªè¦è®¿é—®å¦‚ä¸‹åœ°å€å°±èƒ½è®¿é—® API Serverã€‚</span></span><br><span class=\"line\"><span class=\"comment\"># https://kubernetes.default.svc</span></span><br><span class=\"line\"><span class=\"comment\"># æˆ–è€…</span></span><br><span class=\"line\"><span class=\"comment\"># https://10.96.0.1</span></span><br><span class=\"line\"><span class=\"comment\"># è¿™ä¸ª Service æ˜¯ ç³»ç»Ÿè‡ªå¸¦çš„ï¼Œä¸å»ºè®®åˆ é™¤æˆ–ä¿®æ”¹ã€‚</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"ExternalName\">ExternalName</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¯ä»¥å°†å…¶å®ƒ namespace çš„ service åˆ«ååˆ° å½“å‰ namespaceï¼Œè¿™æ ·è®¿é—® service æ—¶å°±ä¸éœ€è¦åŠ ä¸Šå‘½åç©ºé—´åç§°äº†</p>\n</li>\n<li class=\"lvl-2\">\n<p>ExternalName Service æ˜¯çº¯ DNS CNAME æ˜ å°„ï¼Œæˆ‘ä»¬ä¸ç»å¯ä»¥æ˜ å°„é›†ç¾¤å†…å®¹æœåŠ¡ï¼Œä¹Ÿå¯ä»¥æ˜ å°„é›†ç¾¤å¤–éƒ¨æœåŠ¡ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>åŸå…ˆçš„ service è®¿é—®æ–¹å¼ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åœ¨ä¸åŒå‘½åç©ºé—´ä¸‹åˆ›å»ºservice</span></span><br><span class=\"line\"><span class=\"comment\"># åˆ›å»ºä¸¤ä¸ªå‘½åç©ºé—´ä»¥åŠä¸‹é¢çš„èµ„æº</span></span><br><span class=\"line\"><span class=\"comment\">## ns1</span></span><br><span class=\"line\">kubectl create namespace ns1</span><br><span class=\"line\">kubectl create deployment alpine-demo -n ns1 --image=alpine/curl --replicas=1 -- /bin/sh -c <span class=\"string\">&quot;sleep infinity&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">## ns2</span></span><br><span class=\"line\">kubectl create namespace ns2</span><br><span class=\"line\">kubectl create deployment nginx-demo -n ns2 --image=nginx --replicas=1</span><br><span class=\"line\">kubectl expose deployment nginx-demo -n ns2 --<span class=\"built_in\">type</span>=ClusterIP --port=80 --name=nginx-service</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># è¿›å…¥ ns1 ä¸­çš„ pod è®¿é—® ns2 ä¸­çš„ nginx-service</span></span><br><span class=\"line\">kubectl <span class=\"built_in\">exec</span> -it -n ns1 alpine-demo-66895487c8-sk4t4 -- /bin/sh</span><br><span class=\"line\">curl nginx-service.ns2.svc.cluster.local</span><br><span class=\"line\">curl nginx-service.ns2</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ExternalName è®¿é—®</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åœ¨ ns1 ä¸­åˆ›å»º externalName ç±»å‹çš„ serviceï¼Œ--external-name æŒ‡å®š ns2 ä¸­çš„ nginx-service</span></span><br><span class=\"line\">kubectl create service externalname nginx-service -n ns1 --external-name=nginx-service.ns2.svc.cluster.local</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¹Ÿå¯ä»¥é€šè¿‡ yaml åˆ›å»º</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Service</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">nginx-service</span>                               <span class=\"comment\"># service åç§°</span></span><br><span class=\"line\">  <span class=\"attr\">namespace:</span> <span class=\"string\">ns1</span>                                    <span class=\"comment\"># æŒ‡å®šå‘½åç©ºé—´ ä¸º ns1</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">externalName:</span> <span class=\"string\">nginx-service.ns2.svc.cluster.local</span> <span class=\"comment\"># æŒ‡å®šå¤–éƒ¨æœåŠ¡åï¼Œæ¯”å¦‚ www.baidu.com</span></span><br><span class=\"line\">  <span class=\"attr\">type:</span> <span class=\"string\">ExternalName</span>                                <span class=\"comment\"># æŒ‡å®šä¸º ExternalName ç±»å‹</span></span><br><span class=\"line\">  <span class=\"attr\">selector:</span>                                         <span class=\"comment\"># ä¸éœ€è¦é…ç½® selector</span></span><br><span class=\"line\">    <span class=\"attr\">app:</span> <span class=\"string\">nginx-service</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æŸ¥çœ‹ service</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ k get svc -n ns1</span><br><span class=\"line\">NAME            TYPE           CLUSTER-IP   EXTERNAL-IP                           PORT(S)   AGE</span><br><span class=\"line\">nginx-service   ExternalName   &lt;none&gt;       nginx-service.ns2.svc.cluster.local   &lt;none&gt;    16s</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ­¤æ—¶å†æ¬¡è¿›å…¥ ns1 ä¸­çš„ pod è®¿é—® ns2 ä¸­çš„ nginx-service æœåŠ¡</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl <span class=\"built_in\">exec</span> -it -n ns1 alpine-demo-66895487c8-sk4t4 -- /bin/sh</span><br><span class=\"line\"><span class=\"comment\"># æ­¤æ—¶å°±ä¸éœ€è¦åŠ ä¸Š ns2 çš„ namespace äº†</span></span><br><span class=\"line\">curl nginx-service</span><br></pre></td></tr></table></figure>\n<h3 id=\"LoadBalancer\">LoadBalancer</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>LoadBalancer æ˜¯ Kubernetes Service çš„ä¸€ç§ç±»å‹ï¼Œç”¨äºè‡ªåŠ¨ç”³è¯·ä¸€ä¸ªäº‘å‚å•†çš„è´Ÿè½½å‡è¡¡å™¨ï¼ˆå¦‚ AWS ELBã€GCP LBã€é˜¿é‡Œäº‘ SLBï¼‰ï¼Œå°†å¤–éƒ¨æµé‡è½¬å‘åˆ° Kubernetes é›†ç¾¤å†…éƒ¨çš„ Pod ä¸Šã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>åœ¨ç§æœ‰äº‘ä¸Šï¼Œéœ€è¦å€ŸåŠ©ç¬¬ä¸‰æ–¹è´Ÿè½½å‡è¡¡å™¨æ¥å®ç°ï¼Œæ¯”å¦‚ <a href=\"https://metallb.io\">MetalLB</a>ï¼Œ<a href=\"https://github.com/metallb/metallb\">github</a></p>\n</li>\n</ul>\n<h4 id=\"å®‰è£…-MetallB\">å®‰è£… MetallB</h4>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¦‚æœæ‚¨åœ¨IPVSæ¨¡å¼ä¸‹ä½¿ç”¨kubeä»£ç†ï¼Œä»Kubernetes v1.14.2å¼€å§‹ï¼Œæ‚¨å¿…é¡»å¯ç”¨ä¸¥æ ¼çš„ARPæ¨¡å¼ã€‚è¯·æ³¨æ„ï¼Œå¦‚æœæ‚¨ä½¿ç”¨kube-routerä½œä¸ºæœåŠ¡ä»£ç†ï¼Œåˆ™ä¸éœ€è¦è¿™ä¸ªï¼Œå› ä¸ºå®ƒé»˜è®¤å¯ç”¨äº†ä¸¥æ ¼çš„ARPã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹å°†è¦äº§ç”Ÿçš„å˜æ›´ï¼Œå¦‚æœæœ‰å˜æ›´åˆ™è¿”å›éé›¶çŠ¶æ€ç </span></span><br><span class=\"line\">kubectl get configmap kube-proxy -n kube-system -o yaml | \\</span><br><span class=\"line\">sed -e <span class=\"string\">&quot;s/strictARP: false/strictARP: true/&quot;</span> | \\</span><br><span class=\"line\">kubectl diff -f - -n kube-system</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å®é™…åº”ç”¨å˜æ›´ï¼Œåªæœ‰å‘ç”Ÿé”™è¯¯æ—¶æ‰è¿”å›éé›¶çŠ¶æ€ç </span></span><br><span class=\"line\">kubectl get configmap kube-proxy -n kube-system -o yaml | \\</span><br><span class=\"line\">sed -e <span class=\"string\">&quot;s/strictARP: false/strictARP: true/&quot;</span> | \\</span><br><span class=\"line\">kubectl apply -f - -n kube-system</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å®‰è£…MetalLB</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">export</span> METLB_VERSION=v0.15.2</span><br><span class=\"line\">curl -L -o metallb.yaml https://raw.githubusercontent.com/metallb/metallb/<span class=\"variable\">$&#123;METLB_VERSION&#125;</span>/config/manifests/metallb-native.yaml</span><br><span class=\"line\">kubectl apply -f metallb.yaml</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æŸ¥çœ‹MetalLBèµ„æº</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ k get all -n metallb-system -owide</span><br><span class=\"line\">NAME                              READY   STATUS    RESTARTS      AGE     IP               NODE          NOMINATED NODE   READINESS GATES</span><br><span class=\"line\">pod/controller-58fdf44d87-bsp4z   1/1     Running   0             4m13s   10.244.194.104   k8s-worker1   &lt;none&gt;           &lt;none&gt;</span><br><span class=\"line\">pod/speaker-sjvq5                 1/1     Running   0             4m13s   10.211.55.15     k8s-worker1   &lt;none&gt;           &lt;none&gt;</span><br><span class=\"line\">pod/speaker-srpp4                 1/1     Running   0             4m13s   10.211.55.16     k8s-worker2   &lt;none&gt;           &lt;none&gt;</span><br><span class=\"line\">pod/speaker-tbnls                 1/1     Running   2 (98s ago)   4m13s   10.211.55.11     k8s-master    &lt;none&gt;           &lt;none&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">NAME                              TYPE        CLUSTER-IP    EXTERNAL-IP   PORT(S)   AGE     SELECTOR</span><br><span class=\"line\">service/metallb-webhook-service   ClusterIP   10.96.233.8   &lt;none&gt;        443/TCP   4m14s   component=controller</span><br><span class=\"line\"></span><br><span class=\"line\">NAME                     DESIRED   CURRENT   READY   UP-TO-DATE   AVAILABLE   NODE SELECTOR            AGE     CONTAINERS   IMAGES                            SELECTOR</span><br><span class=\"line\">daemonset.apps/speaker   3         3         3       3            3           kubernetes.io/os=linux   4m13s   speaker      quay.io/metallb/speaker:v0.15.2   app=metallb,component=speaker</span><br><span class=\"line\"></span><br><span class=\"line\">NAME                         READY   UP-TO-DATE   AVAILABLE   AGE     CONTAINERS   IMAGES                               SELECTOR</span><br><span class=\"line\">deployment.apps/controller   1/1     1            1           4m14s   controller   quay.io/metallb/controller:v0.15.2   app=metallb,component=controller</span><br><span class=\"line\"></span><br><span class=\"line\">NAME                                    DESIRED   CURRENT   READY   AGE     CONTAINERS   IMAGES                               SELECTOR</span><br><span class=\"line\">replicaset.apps/controller-58fdf44d87   1         1         1       4m13s   controller   quay.io/metallb/controller:v0.15.2   app=metallb,component=controller,pod-template-hash=58fdf44d87</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>é…ç½®åœ°å€æ± :metallb-pool.yaml</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">metallb.io/v1beta1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">IPAddressPool</span>                 <span class=\"comment\"># åœ°å€æ± ç±»å‹</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">metallb-pool</span>                <span class=\"comment\"># åœ°å€æ± åç§°</span></span><br><span class=\"line\">  <span class=\"attr\">namespace:</span> <span class=\"string\">metallb-system</span>         <span class=\"comment\"># å‘½åç©ºé—´</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">addresses:</span>                        <span class=\"comment\"># é…ç½®åœ°å€æ± </span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"number\">10.211</span><span class=\"number\">.55</span><span class=\"number\">.200</span><span class=\"number\">-10.211</span><span class=\"number\">.55</span><span class=\"number\">.250</span>     <span class=\"comment\"># ä¸ èŠ‚ç‚¹ ç›¸åŒçš„ç½‘æ®µï¼Œè´Ÿè½½å‡è¡¡å™¨å¯ä»¥åˆ†é…çš„IPèŒƒå›´</span></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl apply -f metallb-pool.yaml</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>é…ç½®åœ°å€æ± çš„äºŒçº§å…¬å‘Š:metallb-advertisement.yaml</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">metallb.io/v1beta1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">L2Advertisement</span>               <span class=\"comment\"># åœ°å€æ± äºŒçº§å…¬å‘Šç±»å‹</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">metallb-advertisement</span>       <span class=\"comment\"># å…¬å‘Šåç§°</span></span><br><span class=\"line\">  <span class=\"attr\">namespace:</span> <span class=\"string\">metallb-system</span>         <span class=\"comment\"># å‘½åç©ºé—´</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">ipAddressPools:</span>                   <span class=\"comment\"># åœ°å€æ± åç§°åˆ—è¡¨ï¼Œåªæœ‰è¢«å…¬å‘Šçš„åœ°å€æ± æ‰ä¼šè¢«ä½¿ç”¨</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">metallb-pool</span>                    <span class=\"comment\"># åœ°å€æ± åç§°</span></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl apply -f metallb-advertisement.yaml</span><br></pre></td></tr></table></figure>\n<h4 id=\"åˆ›å»º-LoadBalancer-ç±»å‹çš„-service\">åˆ›å»º LoadBalancer ç±»å‹çš„ service</h4>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>metallb-service.yaml</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">apps/v1</span>                  <span class=\"comment\"># æŒ‡å®šä½¿ç”¨çš„ API ç‰ˆæœ¬ï¼Œè¿™é‡Œæ˜¯ apps/v1ï¼Œé€‚ç”¨äº Deployment èµ„æº</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Deployment</span>                     <span class=\"comment\"># Kubernetes èµ„æºç±»å‹ï¼Œè¿™é‡Œæ˜¯éƒ¨ç½²ï¼ˆDeploymentï¼‰</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">labels:</span></span><br><span class=\"line\">    <span class=\"attr\">app:</span> <span class=\"string\">nginx</span>                       <span class=\"comment\"># æ ‡ç­¾ï¼Œç”¨äºæ ‡è¯†èµ„æºï¼Œå¯ä¸ selector åŒ¹é…</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">nginx</span>                        <span class=\"comment\"># èµ„æºåç§°ï¼Œå¿…é¡»å”¯ä¸€ï¼ˆåœ¨åŒä¸€å‘½åç©ºé—´ä¸‹ï¼‰</span></span><br><span class=\"line\">  <span class=\"attr\">namespace:</span> <span class=\"string\">ns1</span>                     <span class=\"comment\"># å‘½åç©ºé—´ï¼Œé»˜è®¤ä¸º default</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span>                                <span class=\"comment\"># é…ç½®é¡¹</span></span><br><span class=\"line\">  <span class=\"attr\">replicas:</span> <span class=\"number\">3</span>                        <span class=\"comment\"># å‰¯æœ¬æ•°ï¼Œè¡¨ç¤ºå¸Œæœ›è¿è¡Œå¤šå°‘ä¸ª Pod å®ä¾‹</span></span><br><span class=\"line\">  <span class=\"attr\">selector:</span>                          <span class=\"comment\"># é€‰æ‹©å™¨ï¼ŒæŒ‡å®šè¦ç®¡ç†çš„ Pod</span></span><br><span class=\"line\">    <span class=\"attr\">matchLabels:</span>                     <span class=\"comment\"># æ ‡ç­¾é€‰æ‹©å™¨</span></span><br><span class=\"line\">      <span class=\"attr\">app:</span> <span class=\"string\">nginx</span>                     <span class=\"comment\"># é€‰æ‹©å™¨ï¼ŒæŒ‡å®š Deployment ç®¡ç†å“ªäº› Podï¼ˆæ ‡ç­¾å¿…é¡»ä¸ template ä¸­åŒ¹é…ï¼‰</span></span><br><span class=\"line\">  <span class=\"attr\">template:</span>                          <span class=\"comment\"># æ¨¡æ¿ï¼Œå®šä¹‰ Pod çš„å†…å®¹ï¼Œå…·ä½“å¯ä»¥å‚è€ƒ Pod çš„é…ç½®</span></span><br><span class=\"line\">    <span class=\"attr\">metadata:</span></span><br><span class=\"line\">      <span class=\"attr\">labels:</span></span><br><span class=\"line\">        <span class=\"attr\">app:</span> <span class=\"string\">nginx</span>                   <span class=\"comment\"># Pod çš„æ ‡ç­¾ï¼Œå¿…é¡»ä¸ selector ä¸­çš„ matchLabels ä¸€è‡´</span></span><br><span class=\"line\">    <span class=\"attr\">spec:</span></span><br><span class=\"line\">      <span class=\"attr\">containers:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">image:</span> <span class=\"string\">nginx</span>                 <span class=\"comment\"># å®¹å™¨ä½¿ç”¨çš„é•œåƒï¼Œè¿™é‡Œæ˜¯å®˜æ–¹çš„ nginx é•œåƒ</span></span><br><span class=\"line\">        <span class=\"attr\">name:</span> <span class=\"string\">nginx</span>                  <span class=\"comment\"># å®¹å™¨çš„åç§°</span></span><br><span class=\"line\"><span class=\"string\">---</span>                                  <span class=\"comment\"># åˆ†å‰²çº¿</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span>                       <span class=\"comment\"># apiç‰ˆæœ¬</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Service</span>                        <span class=\"comment\"># èµ„æºç±»å‹</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span>                            <span class=\"comment\"># å…ƒæ•°æ®</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">nginx</span>                        <span class=\"comment\"># serviceåç§°</span></span><br><span class=\"line\">  <span class=\"attr\">namespace:</span> <span class=\"string\">ns1</span>                     <span class=\"comment\"># å‘½åç©ºé—´</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span>                                <span class=\"comment\"># é…ç½®</span></span><br><span class=\"line\">  <span class=\"attr\">ports:</span>                             <span class=\"comment\"># ç«¯å£</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">port:</span> <span class=\"number\">80</span>                         <span class=\"comment\"># é›†ç¾¤å†…è®¿é—®ç«¯å£ï¼Œserviceçš„ç«¯å£ï¼Œä¸€èˆ¬é…ç½®ä¸ºä¸ targetPort ä¸€è‡´ï¼Œä½†æ˜¯éå¿…é¡»</span></span><br><span class=\"line\">    <span class=\"attr\">protocol:</span> <span class=\"string\">TCP</span>                    <span class=\"comment\"># åè®®</span></span><br><span class=\"line\">    <span class=\"attr\">targetPort:</span> <span class=\"number\">80</span>                   <span class=\"comment\"># å®¹å™¨ç«¯å£, podçš„ç«¯å£ï¼Œè¿™ä¸ªå¿…é¡»ä¸å®é™…å®¹å™¨ç«¯å£ä¸€è‡´</span></span><br><span class=\"line\">  <span class=\"attr\">selector:</span>                          <span class=\"comment\"># é€‰æ‹©å™¨</span></span><br><span class=\"line\">    <span class=\"attr\">app:</span> <span class=\"string\">nginx</span>                       <span class=\"comment\"># podçš„æ ‡ç­¾ï¼Œå³åŒ¹é…podçš„æ ‡ç­¾ app=nginx</span></span><br><span class=\"line\">  <span class=\"attr\">type:</span> <span class=\"string\">LoadBalancer</span>                 <span class=\"comment\"># serviceç±»å‹</span></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ k apply -f metallb-service.yaml</span><br><span class=\"line\">deployment.apps/nginx created</span><br><span class=\"line\">service/nginx created</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æŸ¥çœ‹service</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å¯ä»¥çœ‹åˆ° service çš„ç±»å‹ä¸º LoadBalancerï¼Œå¹¶åˆ†é…äº† EXTERNAL-IPï¼Œè¿™é‡Œè¿˜å¼€æ”¾äº†nodePort 30613</span></span><br><span class=\"line\">$ kubectl get svc -n ns1</span><br><span class=\"line\">NAME         TYPE           CLUSTER-IP      EXTERNAL-IP     PORT(S)        AGE</span><br><span class=\"line\">nginx        LoadBalancer   10.96.210.244   10.211.55.200   80:30613/TCP   52s</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è®¿é—®service</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># é€šè¿‡ service çš„ port è®¿é—®ï¼Œè¿™é‡Œæ˜¯ 80</span></span><br><span class=\"line\">curl 10.211.55.200</span><br><span class=\"line\"><span class=\"comment\"># åŒæ ·å¯ä»¥åŸºäº nodeIP+nodePort è®¿é—®</span></span><br><span class=\"line\">curl 10.211.55.11:30613</span><br></pre></td></tr></table></figure>\n<h2 id=\"è®¿é—®serviceï¼Œè½®è¯¢pod\">è®¿é—®serviceï¼Œè½®è¯¢pod</h2>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">## åœ¨é›†ç¾¤å†…</span></span><br><span class=\"line\"><span class=\"comment\"># åœ¨ç›¸åŒçš„ namespace ä¸­ï¼Œå¯ä»¥é€šè¿‡ serviceName ç›´æ¥è®¿é—®</span></span><br><span class=\"line\">curl nginx</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ä¹Ÿå¯ä»¥é€šè¿‡ CLUSTER-IP è®¿é—®</span></span><br><span class=\"line\">curl 10.96.9.77</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åœ¨ä¸åŒçš„ namespace ä¸­ï¼Œå¯ä»¥é€šè¿‡ &lt;serviceName&gt;.&lt;namespace&gt; æˆ–è€… &lt;serviceName&gt;.&lt;namespace&gt;.svc.cluster.local è®¿é—®ï¼Œæ¯”å¦‚æœ¬ç¤ºä¾‹ä¸º</span></span><br><span class=\"line\">curl nginx.default</span><br><span class=\"line\">curl nginx.default.svc.cluster.local</span><br><span class=\"line\"><span class=\"comment\"># è¿™æ˜¯å› ä¸ºåœ¨åˆ›å»º serviceå‰ï¼Œæˆ‘ä»¬æ˜¯ä¸çŸ¥é“ service çš„ IP åœ°å€çš„ï¼Œæ‰€ä»¥åœ¨å…¶å®ƒpodä¸­å°±å¯ä»¥é¢„å…ˆä½¿ç”¨ &lt;serviceName&gt;.&lt;namespace&gt; å ä½ï¼Œk8sä¼šè‡ªåŠ¨å°†å…¶è§£æä¸º service çš„ CLUSTER-IP</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">## åœ¨é›†ç¾¤å¤–</span></span><br><span class=\"line\"><span class=\"comment\"># é€šè¿‡ NODE-IP:NODE-PORT è®¿é—®</span></span><br><span class=\"line\">curl 10.211.55.16:30080</span><br></pre></td></tr></table></figure>\n<h2 id=\"ç®¡ç†service\">ç®¡ç†service</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æŸ¥çœ‹service</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹service</span></span><br><span class=\"line\">kubectl get svc</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹æŒ‡å®šnamespaceä¸‹çš„service</span></span><br><span class=\"line\">kubectl get svc -n kube-system</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹å…¨éƒ¨service</span></span><br><span class=\"line\">kubectl get svc -A</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹serviceè¯¦æƒ…</span></span><br><span class=\"line\">kubectl get svc nginx -o yaml</span><br><span class=\"line\">kubectl describe svc nginx</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹æ—¥å¿—</span></span><br><span class=\"line\">k logs svc/nginx</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç¼–è¾‘serviceï¼Œä¿å­˜ï¼ˆ:wqï¼‰åç”Ÿæ•ˆï¼Œä¸éœ€è¦é¢å¤– apply æˆ– restart</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl edit svc nginx</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ é™¤service</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl delete svc nginx</span><br></pre></td></tr></table></figure>\n","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» K8S çš„ Service ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚ K8Så®˜ç½‘ k8s Github k8s Service ä»‹ç» Service ä»‹ç» Service(ç¼©å†™ä¸º svc)æ˜¯ä¸€ä¸ªæŠ½è±¡å±‚ï¼Œå®ƒå®šä¹‰äº†ä¸€ç»„Podçš„é€»è¾‘é›†ï¼Œå¹¶ä¸ºè¿™äº›Podæ”¯æŒå¤–éƒ¨æµé‡æš´éœ²ã€è´Ÿè½½å‡è¡¡å’ŒæœåŠ¡å‘ç°ã€‚ å°½ç®¡æ¯ä¸ªPod éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„IPåœ°å€ï¼Œä½†æ˜¯å¦‚æœæ²¡æœ‰Serviceï¼Œè¿™äº›IPä¸ä¼šæš´éœ²åœ¨ç¾¤é›†å¤–éƒ¨ã€‚ Serviceå…è®¸æ‚¨çš„åº”ç”¨ç¨‹åºæ¥æ”¶æµé‡ã€‚ Serviceä¹Ÿå¯ä»¥ç”¨åœ¨ServiceSpecæ ‡è®°typeçš„æ–¹å¼æš´éœ²ï¼Œtypeç±»å‹å¦‚ä¸‹ï¼š ClusterIPï¼ˆé»˜è®¤ï¼‰ï¼šåœ¨é›†ç¾¤çš„å†…éƒ¨IPä¸Šå…¬å¼€Serviceã€‚è¿™ç§ç±»å‹ä½¿å¾—Serviceåªèƒ½ä»é›†ç¾¤å†…è®¿é—®ã€‚ NodePortï¼šä½¿ç”¨NATåœ¨é›†ç¾¤ä¸­æ¯ä¸ªé€‰å®šNodeçš„ç›¸åŒç«¯å£ä¸Šå…¬å¼€Serviceã€‚ä½¿ç”¨ : ä»é›†ç¾¤å¤–éƒ¨è®¿é—®Serviceã€‚æ˜¯ClusterIPçš„è¶…é›†ã€‚ LoadBalancerï¼šåœ¨å½“å‰äº‘ä¸­åˆ›å»ºä¸€ä¸ªå¤–éƒ¨è´Ÿè½½å‡è¡¡å™¨(å¦‚æœæ”¯æŒçš„è¯)ï¼Œå¹¶ä¸ºServiceåˆ†é…ä¸€ä¸ªå›ºå®šçš„å¤–éƒ¨IPã€‚æ˜¯NodePortçš„è¶…é›†ã€‚ ExternalNameï¼šé€šè¿‡è¿”å›å¸¦æœ‰è¯¥åç§°çš„CNAMEè®°å½•ï¼Œä½¿ç”¨ä»»æ„åç§°ï¼ˆç”±specä¸­çš„externalNameæŒ‡å®šï¼‰å…¬å¼€Serviceã€‚ä¸ä½¿ç”¨ä»£ç†ã€‚ åˆ›å»ºService ClusterIP åªèƒ½åœ¨é›†ç¾¤å†…éƒ¨è®¿é—® 12345678# å…ˆåˆ›å»ºdeploymentï¼Œæ­¤æ—¶ä¼šä¸ºæ¯ä¸ªpodæ·»åŠ ä¸€ä¸ªlabel app=nginxkubectl create deployment nginx --image=nginx --replicas=2# åˆ›å»ºserviceï¼Œï¼Œå°†deploymentçš„podæš´éœ²å‡ºæ¥ï¼Œæš´éœ²ç±»å‹ä¸ºClusterIPkubectl expose deployment nginx --type=ClusterIP --port=80$ kubectl get svc nginxNAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGEnginx ClusterIP 10.96.14.90 &lt;none&gt; 80/TCP 60s NodePort æš´éœ²å®¿ä¸»æœºçš„ç«¯å£ï¼Œä¾›å¤–éƒ¨è®¿é—® 123456# åˆ›å»ºserviceï¼Œå°†deploymentçš„podæš´éœ²å‡ºæ¥ï¼Œæš´éœ²ç±»å‹ä¸ºNodePortkubectl expose deployment nginx --type=NodePort --port=80# æŸ¥çœ‹serviceï¼Œæ­¤æ—¶å¯ä»¥çœ‹åˆ°serviceçš„ç«¯å£å’ŒèŠ‚ç‚¹çš„ç«¯å£ï¼Œä¸ ClusterIP çš„åŒºåˆ«å°±æ˜¯æ˜¯å¦æš´éœ²åœ¨èŠ‚ç‚¹ä¸Šçš„ç«¯å£$ kubectl get svc nginxNAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGEnginx NodePort 10.96.7.8 &lt;none&gt; 80:32691/TCP 31s yamlæ–‡ä»¶åˆ›å»ºservice yamlæ–‡ä»¶æ ¼å¼ 12345678910111213apiVersion: v1 # apiç‰ˆæœ¬kind: Service # èµ„æºç±»å‹metadata: # å…ƒæ•°æ® name: nginx # serviceåç§°spec: # é…ç½® ports: # ç«¯å£ - port: 80 # é›†ç¾¤å†…è®¿é—®ç«¯å£ï¼Œserviceçš„ç«¯å£ï¼Œä¸€èˆ¬é…ç½®ä¸ºä¸ targetPort ä¸€è‡´ï¼Œä½†æ˜¯éå¿…é¡» protocol: TCP # åè®® targetPort: 80 # å®¹å™¨ç«¯å£, podçš„ç«¯å£ï¼Œè¿™ä¸ªå¿…é¡»ä¸å®é™…å®¹å™¨ç«¯å£ä¸€è‡´ nodePort: 30080 # nodeæš´éœ²çš„ç«¯å£ï¼Œserviceç±»å‹ä¸º NodePort æ—¶ä½¿ç”¨ï¼Œé»˜è®¤èŒƒå›´åœ¨ 30000-32767 ä¹‹é—´ selector: # é€‰æ‹©å™¨ app: nginx # podçš„æ ‡ç­¾ï¼Œå³åŒ¹é…podçš„æ ‡ç­¾ app=nginx type: NodePort # serviceç±»å‹ è¿™é‡Œæœ‰ä¸ªé—®é¢˜éœ€è¦æ³¨æ„ï¼Œservice é»˜è®¤æ˜¯é€šè¿‡æ ‡ç­¾æ¥åŒ¹é…podçš„ï¼Œæ‰€ä»¥åˆ›å»ºserviceçš„æ—¶å€™ï¼Œä¸€å®šè¦ä¿è¯podçš„æ ‡ç­¾æ˜¯å­˜åœ¨çš„ï¼Œå¦åˆ™serviceæ— æ³•åŒ¹é…podï¼Œå¦å¤–è™½ç„¶æˆ‘ä»¬é€šè¿‡å‘½ä»¤è¡Œåˆ›å»ºserviceæ—¶æ˜¯é€šè¿‡kubectl expose deployment nginx --type=NodePort --port=80åˆ›å»ºçš„ï¼Œä½†ä¹Ÿå¹¶ä¸è¡¨ç¤ºserviceåªä¼šåŒ¹é…è¿™ä¸ªdeploymentåˆ›å»ºçš„podï¼Œè€Œæ˜¯ä¼šåŒ¹é…æ‰€æœ‰å…·æœ‰æŒ‡å®šæ ‡ç­¾çš„podï¼ˆapp=nginxï¼‰ã€‚ 123456789101112# è·å–serviceçš„ selector$ k get svc -owideNAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE SELECTORkubernetes ClusterIP 10.96.0.1 &lt;none&gt; 443/TCP 4d5h &lt;none&gt;nginx NodePort 10.96.9.77 &lt;none&gt; 80:30080/TCP 8s app=nginx# è¿™é‡Œæœ‰ä¸ªåç§°ä¸º kubernetes çš„ serviceï¼Œå…¶ä½œç”¨æ˜¯ä¸ºäº†æ–¹ä¾¿é›†ç¾¤å†…éƒ¨çš„ Pod è°ƒç”¨ API Server çš„ç»Ÿä¸€å…¥å£# æ— è®º API Server å®é™…è¿è¡Œåœ¨å“ªä¸ªèŠ‚ç‚¹å“ªä¸ª IPï¼Œé›†ç¾¤å†…éƒ¨åªè¦è®¿é—®å¦‚ä¸‹åœ°å€å°±èƒ½è®¿é—® API Serverã€‚# https://kubernetes.default.svc# æˆ–è€…# https://10.96.0.1# è¿™ä¸ª Service æ˜¯ ç³»ç»Ÿè‡ªå¸¦çš„ï¼Œä¸å»ºè®®åˆ é™¤æˆ–ä¿®æ”¹ã€‚ ExternalName å¯ä»¥å°†å…¶å®ƒ namespace çš„ service åˆ«ååˆ° å½“å‰ namespaceï¼Œè¿™æ ·è®¿é—® service æ—¶å°±ä¸éœ€è¦åŠ ä¸Šå‘½åç©ºé—´åç§°äº† ExternalName Service æ˜¯çº¯ DNS CNAME æ˜ å°„ï¼Œæˆ‘ä»¬ä¸ç»å¯ä»¥æ˜ å°„é›†ç¾¤å†…å®¹æœåŠ¡ï¼Œä¹Ÿå¯ä»¥æ˜ å°„é›†ç¾¤å¤–éƒ¨æœåŠ¡ã€‚ åŸå…ˆçš„ service è®¿é—®æ–¹å¼ï¼š 123456789101112131415# åœ¨ä¸åŒå‘½åç©ºé—´ä¸‹åˆ›å»ºservice# åˆ›å»ºä¸¤ä¸ªå‘½åç©ºé—´ä»¥åŠä¸‹é¢çš„èµ„æº## ns1kubectl create namespace ns1kubectl create deployment alpine-demo -n ns1 --image=alpine/curl --replicas=1 -- /bin/sh -c &quot;sleep infinity&quot;## ns2kubectl create namespace ns2kubectl create deployment nginx-demo -n ns2 --image=nginx --replicas=1kubectl expose deployment nginx-demo -n ns2 --type=ClusterIP --port=80 --name=nginx-service# è¿›å…¥ ns1 ä¸­çš„ pod è®¿é—® ns2 ä¸­çš„ nginx-servicekubectl exec -it -n ns1 alpine-demo-66895487c8-sk4t4 -- /bin/shcurl nginx-service.ns2.svc.cluster.localcurl nginx-service.ns2 ExternalName è®¿é—® 12# åœ¨ ns1 ä¸­åˆ›å»º externalName ç±»å‹çš„ serviceï¼Œ--external-name æŒ‡å®š ns2 ä¸­çš„ nginx-servicekubectl create service externalname nginx-service -n ns1 --external-name=nginx-service.ns2.svc.cluster.local ä¹Ÿå¯ä»¥é€šè¿‡ yaml åˆ›å»º 12345678910apiVersion: v1kind: Servicemetadata: name: nginx-service # service åç§° namespace: ns1 # æŒ‡å®šå‘½åç©ºé—´ ä¸º ns1spec: externalName: nginx-service.ns2.svc.cluster.local # æŒ‡å®šå¤–éƒ¨æœåŠ¡åï¼Œæ¯”å¦‚ www.baidu.com type: ExternalName # æŒ‡å®šä¸º ExternalName ç±»å‹ selector: # ä¸éœ€è¦é…ç½® selector app: nginx-service æŸ¥çœ‹ service 123$ k get svc -n ns1NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGEnginx-service ExternalName &lt;none&gt; nginx-service.ns2.svc.cluster.local &lt;none&gt; 16s æ­¤æ—¶å†æ¬¡è¿›å…¥ ns1 ä¸­çš„ pod è®¿é—® ns2 ä¸­çš„ nginx-service æœåŠ¡ 123kubectl exec -it -n ns1 alpine-demo-66895487c8-sk4t4 -- /bin/sh# æ­¤æ—¶å°±ä¸éœ€è¦åŠ ä¸Š ns2 çš„ namespace äº†curl nginx-service LoadBalancer LoadBalancer æ˜¯ Kubernetes Service çš„ä¸€ç§ç±»å‹ï¼Œç”¨äºè‡ªåŠ¨ç”³è¯·ä¸€ä¸ªäº‘å‚å•†çš„è´Ÿè½½å‡è¡¡å™¨ï¼ˆå¦‚ AWS ELBã€GCP LBã€é˜¿é‡Œäº‘ SLBï¼‰ï¼Œå°†å¤–éƒ¨æµé‡è½¬å‘åˆ° Kubernetes é›†ç¾¤å†…éƒ¨çš„ Pod ä¸Šã€‚ åœ¨ç§æœ‰äº‘ä¸Šï¼Œéœ€è¦å€ŸåŠ©ç¬¬ä¸‰æ–¹è´Ÿè½½å‡è¡¡å™¨æ¥å®ç°ï¼Œæ¯”å¦‚ MetalLBï¼Œgithub å®‰è£… MetallB å¦‚æœæ‚¨åœ¨IPVSæ¨¡å¼ä¸‹ä½¿ç”¨kubeä»£ç†ï¼Œä»Kubernetes v1.14.2å¼€å§‹ï¼Œæ‚¨å¿…é¡»å¯ç”¨ä¸¥æ ¼çš„ARPæ¨¡å¼ã€‚è¯·æ³¨æ„ï¼Œå¦‚æœæ‚¨ä½¿ç”¨kube-routerä½œä¸ºæœåŠ¡ä»£ç†ï¼Œåˆ™ä¸éœ€è¦è¿™ä¸ªï¼Œå› ä¸ºå®ƒé»˜è®¤å¯ç”¨äº†ä¸¥æ ¼çš„ARPã€‚ 123456789# æŸ¥çœ‹å°†è¦äº§ç”Ÿçš„å˜æ›´ï¼Œå¦‚æœæœ‰å˜æ›´åˆ™è¿”å›éé›¶çŠ¶æ€ç kubectl get configmap kube-proxy -n kube-system -o yaml | \\sed -e &quot;s/strictARP: false/strictARP: true/&quot; | \\kubectl diff -f - -n kube-system# å®é™…åº”ç”¨å˜æ›´ï¼Œåªæœ‰å‘ç”Ÿé”™è¯¯æ—¶æ‰è¿”å›éé›¶çŠ¶æ€ç kubectl get configmap kube-proxy -n kube-system -o yaml | \\sed -e &quot;s/strictARP: false/strictARP: true/&quot; | \\kubectl apply -f - -n kube-system å®‰è£…MetalLB 123export METLB_VERSION=v0.15.2curl -L -o metallb.yaml https://raw.githubusercontent.com/metallb/metallb/$&#123;METLB_VERSION&#125;/config/manifests/metallb-native.yamlkubectl apply -f metallb.yaml æŸ¥çœ‹MetalLBèµ„æº 123456789101112131415161718$ k get all -n metallb-system -owideNAME READY STATUS RESTARTS AGE IP NODE NOMINATED NODE READINESS GATESpod/controller-58fdf44d87-bsp4z 1/1 Running 0 4m13s 10.244.194.104 k8s-worker1 &lt;none&gt; &lt;none&gt;pod/speaker-sjvq5 1/1 Running 0 4m13s 10.211.55.15 k8s-worker1 &lt;none&gt; &lt;none&gt;pod/speaker-srpp4 1/1 Running 0 4m13s 10.211.55.16 k8s-worker2 &lt;none&gt; &lt;none&gt;pod/speaker-tbnls 1/1 Running 2 (98s ago) 4m13s 10.211.55.11 k8s-master &lt;none&gt; &lt;none&gt;NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE SELECTORservice/metallb-webhook-service ClusterIP 10.96.233.8 &lt;none&gt; 443/TCP 4m14s component=controllerNAME DESIRED CURRENT READY UP-TO-DATE AVAILABLE NODE SELECTOR AGE CONTAINERS IMAGES SELECTORdaemonset.apps/speaker 3 3 3 3 3 kubernetes.io/os=linux 4m13s speaker quay.io/metallb/speaker:v0.15.2 app=metallb,component=speakerNAME READY UP-TO-DATE AVAILABLE AGE CONTAINERS IMAGES SELECTORdeployment.apps/controller 1/1 1 1 4m14s controller quay.io/metallb/controller:v0.15.2 app=metallb,component=controllerNAME DESIRED CURRENT READY AGE CONTAINERS IMAGES SELECTORreplicaset.apps/controller-58fdf44d87 1 1 1 4m13s controller quay.io/metallb/controller:v0.15.2 app=metallb,component=controller,pod-template-hash=58fdf44d87 é…ç½®åœ°å€æ± :metallb-pool.yaml 12345678apiVersion: metallb.io/v1beta1kind: IPAddressPool # åœ°å€æ± ç±»å‹metadata: name: metallb-pool # åœ°å€æ± åç§° namespace: metallb-system # å‘½åç©ºé—´spec: addresses: # é…ç½®åœ°å€æ±  - 10.211.55.200-10.211.55.250 # ä¸ èŠ‚ç‚¹ ç›¸åŒçš„ç½‘æ®µï¼Œè´Ÿè½½å‡è¡¡å™¨å¯ä»¥åˆ†é…çš„IPèŒƒå›´ 1kubectl apply -f metallb-pool.yaml é…ç½®åœ°å€æ± çš„äºŒçº§å…¬å‘Š:metallb-advertisement.yaml 12345678apiVersion: metallb.io/v1beta1kind: L2Advertisement # åœ°å€æ± äºŒçº§å…¬å‘Šç±»å‹metadata: name: metallb-advertisement # å…¬å‘Šåç§° namespace: metallb-system # å‘½åç©ºé—´spec: ipAddressPools: # åœ°å€æ± åç§°åˆ—è¡¨ï¼Œåªæœ‰è¢«å…¬å‘Šçš„åœ°å€æ± æ‰ä¼šè¢«ä½¿ç”¨ - metallb-pool # åœ°å€æ± åç§° 1kubectl apply -f metallb-advertisement.yaml åˆ›å»º LoadBalancer ç±»å‹çš„ service metallb-service.yaml 12345678910111213141516171819202122232425262728293031323334apiVersion: apps/v1 # æŒ‡å®šä½¿ç”¨çš„ API ç‰ˆæœ¬ï¼Œè¿™é‡Œæ˜¯ apps/v1ï¼Œé€‚ç”¨äº Deployment èµ„æºkind: Deployment # Kubernetes èµ„æºç±»å‹ï¼Œè¿™é‡Œæ˜¯éƒ¨ç½²ï¼ˆDeploymentï¼‰metadata: labels: app: nginx # æ ‡ç­¾ï¼Œç”¨äºæ ‡è¯†èµ„æºï¼Œå¯ä¸ selector åŒ¹é… name: nginx # èµ„æºåç§°ï¼Œå¿…é¡»å”¯ä¸€ï¼ˆåœ¨åŒä¸€å‘½åç©ºé—´ä¸‹ï¼‰ namespace: ns1 # å‘½åç©ºé—´ï¼Œé»˜è®¤ä¸º defaultspec: # é…ç½®é¡¹ replicas: 3 # å‰¯æœ¬æ•°ï¼Œè¡¨ç¤ºå¸Œæœ›è¿è¡Œå¤šå°‘ä¸ª Pod å®ä¾‹ selector: # é€‰æ‹©å™¨ï¼ŒæŒ‡å®šè¦ç®¡ç†çš„ Pod matchLabels: # æ ‡ç­¾é€‰æ‹©å™¨ app: nginx # é€‰æ‹©å™¨ï¼ŒæŒ‡å®š Deployment ç®¡ç†å“ªäº› Podï¼ˆæ ‡ç­¾å¿…é¡»ä¸ template ä¸­åŒ¹é…ï¼‰ template: # æ¨¡æ¿ï¼Œå®šä¹‰ Pod çš„å†…å®¹ï¼Œå…·ä½“å¯ä»¥å‚è€ƒ Pod çš„é…ç½® metadata: labels: app: nginx # Pod çš„æ ‡ç­¾ï¼Œå¿…é¡»ä¸ selector ä¸­çš„ matchLabels ä¸€è‡´ spec: containers: - image: nginx # å®¹å™¨ä½¿ç”¨çš„é•œåƒï¼Œè¿™é‡Œæ˜¯å®˜æ–¹çš„ nginx é•œåƒ name: nginx # å®¹å™¨çš„åç§°--- # åˆ†å‰²çº¿apiVersion: v1 # apiç‰ˆæœ¬kind: Service # èµ„æºç±»å‹metadata: # å…ƒæ•°æ® name: nginx # serviceåç§° namespace: ns1 # å‘½åç©ºé—´spec: # é…ç½® ports: # ç«¯å£ - port: 80 # é›†ç¾¤å†…è®¿é—®ç«¯å£ï¼Œserviceçš„ç«¯å£ï¼Œä¸€èˆ¬é…ç½®ä¸ºä¸ targetPort ä¸€è‡´ï¼Œä½†æ˜¯éå¿…é¡» protocol: TCP # åè®® targetPort: 80 # å®¹å™¨ç«¯å£, podçš„ç«¯å£ï¼Œè¿™ä¸ªå¿…é¡»ä¸å®é™…å®¹å™¨ç«¯å£ä¸€è‡´ selector: # é€‰æ‹©å™¨ app: nginx # podçš„æ ‡ç­¾ï¼Œå³åŒ¹é…podçš„æ ‡ç­¾ app=nginx type: LoadBalancer # serviceç±»å‹ 123$ k apply -f metallb-service.yamldeployment.apps/nginx createdservice/nginx created æŸ¥çœ‹service 1234# å¯ä»¥çœ‹åˆ° service çš„ç±»å‹ä¸º LoadBalancerï¼Œå¹¶åˆ†é…äº† EXTERNAL-IPï¼Œè¿™é‡Œè¿˜å¼€æ”¾äº†nodePort 30613$ kubectl get svc -n ns1NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGEnginx LoadBalancer 10.96.210.244 10.211.55.200 80:30613/TCP 52s è®¿é—®service 1234# é€šè¿‡ service çš„ port è®¿é—®ï¼Œè¿™é‡Œæ˜¯ 80curl 10.211.55.200# åŒæ ·å¯ä»¥åŸºäº nodeIP+nodePort è®¿é—®curl 10.211.55.11:30613 è®¿é—®serviceï¼Œè½®è¯¢pod 12345678910111213141516## åœ¨é›†ç¾¤å†…# åœ¨ç›¸åŒçš„ namespace ä¸­ï¼Œå¯ä»¥é€šè¿‡ serviceName ç›´æ¥è®¿é—®curl nginx# ä¹Ÿå¯ä»¥é€šè¿‡ CLUSTER-IP è®¿é—®curl 10.96.9.77# åœ¨ä¸åŒçš„ namespace ä¸­ï¼Œå¯ä»¥é€šè¿‡ &lt;serviceName&gt;.&lt;namespace&gt; æˆ–è€… &lt;serviceName&gt;.&lt;namespace&gt;.svc.cluster.local è®¿é—®ï¼Œæ¯”å¦‚æœ¬ç¤ºä¾‹ä¸ºcurl nginx.defaultcurl nginx.default.svc.cluster.local# è¿™æ˜¯å› ä¸ºåœ¨åˆ›å»º serviceå‰ï¼Œæˆ‘ä»¬æ˜¯ä¸çŸ¥é“ service çš„ IP åœ°å€çš„ï¼Œæ‰€ä»¥åœ¨å…¶å®ƒpodä¸­å°±å¯ä»¥é¢„å…ˆä½¿ç”¨ &lt;serviceName&gt;.&lt;namespace&gt; å ä½ï¼Œk8sä¼šè‡ªåŠ¨å°†å…¶è§£æä¸º service çš„ CLUSTER-IP## åœ¨é›†ç¾¤å¤–# é€šè¿‡ NODE-IP:NODE-PORT è®¿é—®curl 10.211.55.16:30080 ç®¡ç†service æŸ¥çœ‹service 123456789101112# æŸ¥çœ‹servicekubectl get svc# æŸ¥çœ‹æŒ‡å®šnamespaceä¸‹çš„servicekubectl get svc -n kube-system# æŸ¥çœ‹å…¨éƒ¨servicekubectl get svc -A# æŸ¥çœ‹serviceè¯¦æƒ…kubectl get svc nginx -o yamlkubectl describe svc nginx# æŸ¥çœ‹æ—¥å¿—k logs svc/nginx ç¼–è¾‘serviceï¼Œä¿å­˜ï¼ˆ:wqï¼‰åç”Ÿæ•ˆï¼Œä¸éœ€è¦é¢å¤– apply æˆ– restart 1kubectl edit svc nginx åˆ é™¤service 1kubectl delete svc nginx","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» K8S çš„ Service ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚ K8Så®˜ç½‘ k8s Github k8s Service ä»‹ç»","date_published":"2025-07-18T14:30:05.000Z","tags":["æŠ€æœ¯","k8s","K8S"]},{"id":"https://blog.hanqunfeng.com/2025/07/17/acme/","url":"https://blog.hanqunfeng.com/2025/07/17/acme/","title":"acme.sh è‡ªåŠ¨ç”³è¯·å¹¶ç»­ç­¾ SSL è¯ä¹¦çš„å·¥å…·","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç»è‡ªåŠ¨ç”³è¯·å¹¶ç»­ç­¾ SSL è¯ä¹¦çš„å·¥å…·: <a href=\"http://acme.sh\">acme.sh</a></p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://github.com/acmesh-official/acme.sh\">acme.sh Github</a></p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"acme-sh-ä»‹ç»\"><a href=\"http://acme.sh\">acme.sh</a> ä»‹ç»</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><a href=\"http://acme.sh\">acme.sh</a> å®ç°äº† acme åè®®ï¼Œå¯ä»¥ä» ZeroSSLï¼ŒLetâ€™s Encrypt ç­‰ CA ç”Ÿæˆå…è´¹çš„è¯ä¹¦ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>é€‚ç”¨åœºæ™¯ï¼šshellè„šæœ¬æ–¹å¼ï¼Œå‡ ä¹æ— ä¾èµ–ï¼Œæç®€ï¼Œé€‚åˆä¸æƒ³å®‰è£…Pythonç¯å¢ƒçš„äººã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ç‰¹ç‚¹ï¼š</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">çº¯ Shell è„šæœ¬ï¼Œå•æ–‡ä»¶è¿è¡Œ</li>\n<li class=\"lvl-4\">æ”¯æŒ 100+ DNS API è‡ªåŠ¨ç»­ç­¾ï¼ˆå¦‚ Cloudflareã€é˜¿é‡Œäº‘ã€è…¾è®¯äº‘ç­‰ï¼‰</li>\n<li class=\"lvl-4\">æ”¯æŒé€šé…ç¬¦è¯ä¹¦</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"acme-sh-å®‰è£…\"><a href=\"http://acme.sh\">acme.sh</a> å®‰è£…</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>éœ€è¦å…ˆå®‰è£… crontab</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å®‰è£… crontab</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> dnf install cronie -y</span><br><span class=\"line\"><span class=\"comment\"># å¯åŠ¨ crond</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> systemctl <span class=\"built_in\">enable</span> --now crond</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹ crond çŠ¶æ€</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> systemctl status crond</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹ crontab æ˜¯å¦æ­£å¸¸</span></span><br><span class=\"line\">crontab -l</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å®‰è£… <a href=\"http://acme.sh\">acme.sh</a></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å®‰è£…æˆåŠŸåä¼šè‡ªåŠ¨å®‰è£…åˆ° ~/.acme.sh/ ç›®å½•ä¸‹ï¼Œè¯ä¹¦ä¹Ÿä¼šç”Ÿæˆåœ¨è¯¥ç›®å½•ä¸‹</span></span><br><span class=\"line\">curl https://get.acme.sh | sh -s email=qunfeng_han@aliyun.com</span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&#x27;alias acme.sh=~/.acme.sh/acme.sh&#x27;</span> &gt;&gt; ~/.bashrc</span><br><span class=\"line\"><span class=\"built_in\">source</span> ~/.bashrc</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å®‰è£…æˆåŠŸåä¼šè‡ªåŠ¨åœ¨ crontab ä¸­æ·»åŠ äº†å®šæ—¶ä»»åŠ¡ï¼Œæ¯å¤©æ£€æŸ¥ä¸€æ¬¡è¯ä¹¦æ˜¯å¦åˆ°è¾¾ä¸‹æ¬¡æ›´æ–°æ—¥æœŸï¼Œå¦‚æœåˆ°æœŸåˆ™è‡ªåŠ¨æ›´æ–°</span></span><br><span class=\"line\"><span class=\"comment\"># è¯ä¹¦æœ‰æ•ˆæœŸé»˜è®¤ä¸º 90 å¤©ï¼Œè¿˜å‰© 30 å¤©æ—¶ä¼šè§¦å‘è‡ªåŠ¨æ›´æ–°</span></span><br><span class=\"line\">crontab -l</span><br><span class=\"line\"><span class=\"comment\"># è¾“å‡ºç±»ä¼¼äº ä»¥ä¸‹å†…å®¹</span></span><br><span class=\"line\">48 1 * * * <span class=\"string\">&quot;/root/.acme.sh&quot;</span>/acme.sh --cron --home <span class=\"string\">&quot;/root/.acme.sh&quot;</span> &gt; /dev/null</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹å¸®åŠ©</span></span><br><span class=\"line\">acme.sh -h</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹ç‰ˆæœ¬</span></span><br><span class=\"line\">acme.sh -v</span><br></pre></td></tr></table></figure>\n<h2 id=\"å‡çº§-acme-sh\">å‡çº§ <a href=\"http://acme.sh\">acme.sh</a></h2>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å‡çº§ acme.sh åˆ°æœ€æ–°ç‰ˆ</span></span><br><span class=\"line\">acme.sh --upgrade</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å¼€å¯è‡ªåŠ¨å‡çº§</span></span><br><span class=\"line\">acme.sh --upgrade --auto-upgrade</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å¯ä»¥éšæ—¶å…³é—­è‡ªåŠ¨æ›´æ–°</span></span><br><span class=\"line\">acme.sh --upgrade --auto-upgrade  0</span><br></pre></td></tr></table></figure>\n<h2 id=\"å¸è½½-acme-sh\">å¸è½½ <a href=\"http://acme.sh\">acme.sh</a></h2>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">acme.sh --uninstall</span><br><span class=\"line\"><span class=\"built_in\">rm</span> -rf ~/.acme.sh</span><br></pre></td></tr></table></figure>\n<h2 id=\"ç”Ÿæˆè¯ä¹¦\">ç”Ÿæˆè¯ä¹¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><a href=\"http://acme.sh\">acme.sh</a> å®ç°äº† acme åè®®æ”¯æŒçš„æ‰€æœ‰éªŒè¯åè®®ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>è¯ä¹¦åˆ›å»ºåä¼šä¿å­˜åœ¨ ~/.acme.sh/ç›®å½•ä¸‹ï¼Œæ¯”å¦‚æˆ‘çš„åŸŸåæ˜¯ <code>acme.hanqunfeng.com</code>ï¼Œåˆ™è¯ä¹¦ä¿å­˜åœ¨ <code>~/.acme.sh/acme.hanqunfeng.com_ecc/</code>ç›®å½•ä¸‹</p>\n</li>\n<li class=\"lvl-2\">\n<p>åˆ›å»ºè¯ä¹¦æ—¶ä¸€èˆ¬æœ‰ä¸¤ç§æ–¹å¼éªŒè¯: HTTP å’Œ DNS éªŒè¯ã€‚</p>\n</li>\n</ul>\n<h3 id=\"HTTP-éªŒè¯\">HTTP éªŒè¯</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åªæ”¯æŒå•ä¸ªå­åŸŸåçš„è¯ä¹¦ç”Ÿæˆï¼Œä¸æ”¯æŒé€šé…ç¬¦åŸŸå</p>\n</li>\n<li class=\"lvl-2\">\n<p>éœ€è¦æå‰å°†åŸŸåè§£æåˆ°æœ¬æœºçš„IPåœ°å€</p>\n</li>\n</ul>\n<h4 id=\"ç›´æ¥ç­¾å‘\">ç›´æ¥ç­¾å‘</h4>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åªéœ€è¦æŒ‡å®šåŸŸåï¼Œå¹¶æŒ‡å®šåŸŸåæ‰€åœ¨çš„ç½‘ç«™æ ¹ç›®å½•. <a href=\"http://acme.sh\">acme.sh</a> ä¼šå…¨è‡ªåŠ¨çš„ç”ŸæˆéªŒè¯æ–‡ä»¶ï¼Œå¹¶æ”¾åˆ°ç½‘ç«™çš„æ ¹ç›®å½•ï¼ŒéªŒè¯å®Œæˆåä¼šèªæ˜çš„åˆ é™¤éªŒè¯æ–‡ä»¶ï¼Œæ•´ä¸ªè¿‡ç¨‹æ²¡æœ‰ä»»ä½•å‰¯ä½œç”¨ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># -d æŒ‡å®šåŸŸåï¼Œå¯ä»¥æ·»åŠ å¤šä¸ªï¼Œ--webroot æŒ‡å®šç½‘ç«™æ ¹ç›®å½•</span></span><br><span class=\"line\">acme.sh --issue -d acme.hanqunfeng.com -d www.hanqunfeng.com --webroot /home/wwwroot/mydomain.com/</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># --server æŒ‡å®š acme.sh ä½¿ç”¨çš„ CA æœåŠ¡å•†ä¸º Let&#x27;s Encryptï¼Œé»˜è®¤ä½¿ç”¨ ZeroSSL</span></span><br><span class=\"line\">acme.sh --issue -d acme.hanqunfeng.com -d www.hanqunfeng.com --webroot /home/wwwroot/mydomain.com/ --server letsencrypt</span><br></pre></td></tr></table></figure>\n<h4 id=\"ä½¿ç”¨-Nginx-Apache-æ¨¡å¼\">ä½¿ç”¨ Nginx/Apache æ¨¡å¼</h4>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¦‚æœä½ ç”¨çš„ Nginx/Apache æœåŠ¡å™¨ï¼Œæˆ–è€…åä»£ï¼Œ<a href=\"http://acme.sh\">acme.sh</a> è¿˜å¯ä»¥æ™ºèƒ½çš„ä» Nginx/Apache çš„é…ç½®ä¸­è‡ªåŠ¨å®ŒæˆéªŒè¯ï¼Œä½ ä¸éœ€è¦æŒ‡å®šç½‘ç«™æ ¹ç›®å½•</p>\n</li>\n<li class=\"lvl-2\">\n<p>nginx æˆ– httpd å‘½ä»¤è¦åœ¨ç³»ç»ŸPathä¸­</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># -d åŸŸåï¼Œå¯ä»¥æ·»åŠ å¤šä¸ª, --nginx å‘Šè¯‰ acme.sh ä½¿ç”¨ Nginx æ¨¡å¼</span></span><br><span class=\"line\">acme.sh --issue --nginx -d acme.hanqunfeng.com -d www.hanqunfeng.com</span><br><span class=\"line\"><span class=\"comment\"># -d åŸŸåï¼Œå¯ä»¥æ·»åŠ å¤šä¸ª, --apache å‘Šè¯‰ acme.sh ä½¿ç”¨ Apache æ¨¡å¼</span></span><br><span class=\"line\">acme.sh --issue --apache -d acme.hanqunfeng.com -d www.hanqunfeng.com</span><br></pre></td></tr></table></figure>\n<h4 id=\"ä½¿ç”¨ç‹¬ç«‹æœåŠ¡æ¨¡å¼\">ä½¿ç”¨ç‹¬ç«‹æœåŠ¡æ¨¡å¼</h4>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¦‚æœæœåŠ¡å™¨ä¸Šæ²¡æœ‰è¿è¡Œä»»ä½• Web æœåŠ¡ï¼Œ80 ç«¯å£æ˜¯ç©ºé—²çš„ï¼Œé‚£ä¹ˆ <a href=\"http://acme.sh\">acme.sh</a> è¿˜èƒ½å‡è£…è‡ªå·±æ˜¯ä¸€ä¸ª WebServerï¼Œä¸´æ—¶ç›‘å¬ 80 ç«¯å£ï¼Œå®ŒæˆéªŒè¯</p>\n</li>\n<li class=\"lvl-2\">\n<p>éœ€è¦å…ˆå®‰è£… socat å‘½ä»¤ï¼Œsocat å¸¸ç”¨äºä¸´æ—¶å¼€å¯ TCP/UDP ç›‘å¬ç«¯å£</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">sudo</span> dnf install socat -y</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç”Ÿæˆè¯ä¹¦ï¼Œè¦æ±‚80ç«¯å£ç©ºé—²ï¼Œå¦åˆ™ä¼šå¤±è´¥</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># --standalone ç‹¬ç«‹æœåŠ¡æ¨¡å¼</span></span><br><span class=\"line\">acme.sh --issue --standalone -d acme.hanqunfeng.com -d www.hanqunfeng.com</span><br></pre></td></tr></table></figure>\n<h3 id=\"DNS-éªŒè¯\">DNS éªŒè¯</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¦‚æœä½ æ²¡æœ‰æœåŠ¡å™¨ï¼Œæ²¡æœ‰å…¬ç½‘ IPï¼Œåªéœ€è¦ DNS çš„è§£æè®°å½•å³å¯å®ŒæˆéªŒè¯ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>æ”¯æŒé€šé…ç¬¦åŸŸå</p>\n</li>\n</ul>\n<h4 id=\"æ‰‹åŠ¨éªŒè¯\">æ‰‹åŠ¨éªŒè¯</h4>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¿™éœ€è¦ä½ æ‰‹åŠ¨åœ¨åŸŸåä¸Šæ·»åŠ ä¸€æ¡ TXT è§£æè®°å½•ï¼ŒéªŒè¯åŸŸåæ‰€æœ‰æƒã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>æ³¨æ„ï¼Œå¦‚æœä½¿ç”¨æ‰‹åŠ¨éªŒè¯ï¼Œ<a href=\"http://acme.sh\">acme.sh</a> å°†æ— æ³•è‡ªåŠ¨æ›´æ–°è¯ä¹¦ï¼Œæ¯æ¬¡éƒ½éœ€è¦æ‰‹åŠ¨æ·»åŠ è§£ææ¥éªŒè¯åŸŸåæ‰€æœ‰æƒã€‚å¦‚æœæœ‰è‡ªåŠ¨æ›´æ–°è¯ä¹¦çš„éœ€æ±‚ï¼Œè¯·ä½¿ç”¨è‡ªåŠ¨éªŒè¯ï¼ˆDNS APIï¼‰ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># éœ€è¦åŠ ä¸Š --yes-I-know-dns-manual-mode-enough-go-ahead-please é€‰é¡¹</span></span><br><span class=\"line\">acme.sh --issue --dns -d acme.hanqunfeng.com -d www.hanqunfeng.com --yes-I-know-dns-manual-mode-enough-go-ahead-please</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç„¶åï¼Œ<a href=\"http://acme.sh\">acme.sh</a> ä¼šç”Ÿæˆç›¸åº”çš„è§£æè®°å½•æ˜¾ç¤ºå‡ºæ¥ï¼Œä½ åªéœ€è¦åœ¨ä½ çš„åŸŸåç®¡ç†é¢æ¿ä¸­æ·»åŠ è¿™æ¡ TXT è®°å½•å³å¯ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Add the following txt record:</span><br><span class=\"line\">Domain:_acme-challenge.acme.hanqunfeng.com</span><br><span class=\"line\">Txt value:mUWNg9kuQ9hwOkqYFQ_DFMQ4Eu0CEaxxxxxxxxxxx</span><br><span class=\"line\"></span><br><span class=\"line\">Add the following txt record:</span><br><span class=\"line\">Domain:_acme-challenge.www.hanqunfeng.com</span><br><span class=\"line\">Txt value:vLwDR48eHcmcScOwHrDjaFZo-yw_f9xxxxxxxxxxx</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç­‰å¾…è§£æå®Œæˆä¹‹åï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤é‡æ–°ç”Ÿæˆè¯ä¹¦ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æ³¨æ„è¿™é‡Œç°åœ¨ç”¨çš„æ˜¯ --renew å‚æ•°</span></span><br><span class=\"line\">acme.sh --renew -d acme.hanqunfeng.com -d www.hanqunfeng.com</span><br></pre></td></tr></table></figure>\n<h4 id=\"è‡ªåŠ¨éªŒè¯ï¼ˆDNS-APIï¼‰\">è‡ªåŠ¨éªŒè¯ï¼ˆDNS APIï¼‰</h4>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>DNS æ–¹å¼çš„çœŸæ­£å¼ºå¤§ä¹‹å¤„åœ¨äºå¯ä»¥ä½¿ç”¨åŸŸåè§£æå•†æä¾›çš„ API è‡ªåŠ¨æ·»åŠ  TXT è®°å½•ï¼Œä¸”åœ¨å®ŒæˆéªŒè¯ååˆ é™¤å¯¹åº”çš„è®°å½•ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"http://acme.sh\">acme.sh</a> ç›®å‰æ”¯æŒ<a href=\"https://github.com/acmesh-official/acme.sh/wiki/dnsapi\">è¶…è¿‡ä¸€ç™¾å®¶çš„ DNS API</a>ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä»¥é˜¿é‡Œäº‘ä¸ºä¾‹ï¼Œç™»å½•é˜¿é‡Œäº‘å¸å·ï¼Œè·å– AccessKey å’Œ SecretKeyï¼Œå¹¶è®¾ç½®ç¯å¢ƒå˜é‡ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åªéœ€è¦å‘½ä»¤è¡Œæ‰§è¡Œä¸€æ¬¡ï¼Œè¿è¡Œç”Ÿæˆè¯ä¹¦å‘½ä»¤æ—¶ä¼šä¿å­˜åœ¨ ~/.acme.sh/account.conf ä¸­ï¼Œå¹¶åœ¨éœ€è¦æ—¶è‡ªåŠ¨è·å–ï¼Œæ— éœ€æ‰‹åŠ¨å†è®¾ç½®</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> Ali_Key=<span class=\"string\">&quot;&lt;key&gt;&quot;</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> Ali_Secret=<span class=\"string\">&quot;&lt;secret&gt;&quot;</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç”Ÿæˆè¯ä¹¦</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># --dns dns_ali æŒ‡å®šé˜¿é‡Œäº‘çš„DNS API</span></span><br><span class=\"line\">acme.sh --issue -d acme.hanqunfeng.com -d *.hanqunfeng.com --dns dns_ali</span><br></pre></td></tr></table></figure>\n<h2 id=\"ç”Ÿæˆè¯ä¹¦çš„å…¶å®ƒè¯´æ˜\">ç”Ÿæˆè¯ä¹¦çš„å…¶å®ƒè¯´æ˜</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><a href=\"http://acme.sh\">acme.sh</a> è„šæœ¬é»˜è®¤ CA æœåŠ¡å•†æ˜¯ ZeroSSLï¼Œ<a href=\"https://github.com/acmesh-official/acme.sh/wiki/Server\">acme.sh æ”¯æŒçš„CA æœåŠ¡å•†åŠå…¶ä½¿ç”¨æ–¹æ³•</a>ï¼Œå¯ä»¥åœ¨å‘½ä»¤è¡Œä¸­é€šè¿‡ --server æŒ‡å®š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># è¿™é‡Œä½¿ç”¨ Let&#x27;s Encrypt çš„ CA æœåŠ¡å•†</span></span><br><span class=\"line\">acme.sh --issue -d acme.hanqunfeng.com -d *.hanqunfeng.com --dns dns_ali --server letsencrypt</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¹Ÿå¯ä»¥è®¾ç½®å…¨å±€é»˜è®¤çš„ CA æœåŠ¡å•†ï¼Œè¿™æ ·å°±ä¸éœ€è¦æ¯æ¬¡éƒ½æŒ‡å®š --server</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">acme.sh --set-default-ca --server letsencrypt</span><br></pre></td></tr></table></figure>\n<div class=\"tips\">\n<p><em><strong>å°è´´å£«</strong></em></p>\n<ul class=\"lvl-1\">\n<li class=\"lvl-2\"><a href=\"http://acme.sh\">acme.sh</a> å®˜ç½‘è¯´ é»˜è®¤çš„ CA æœåŠ¡å•† ZeroSSL ä¸æ˜¯å¾ˆç¨³å®šï¼Œæœ‰æ—¶å¯èƒ½ä¼šå¯¼è‡´è·å–è¯ä¹¦çš„æ—¶å€™ä¸€ç›´å‡ºç°ï¼š<code>Pendingï¼ŒThe CA is processing your orderï¼Œplease just wait.</code>ï¼Œ æ­¤æ—¶åªéœ€è¦æŠŠ CA æœåŠ¡å™¨æ”¹æˆ Letâ€™s Encrypt å³å¯ï¼Œè™½ç„¶æ›´æ”¹ä»¥åè¿˜æ˜¯æœ‰æ¦‚ç‡å‡ºç° pendingï¼Œä½†åŸºæœ¬ 2-3 æ¬¡å³å¯æˆåŠŸã€‚</li>\n<li class=\"lvl-2\">ä½†æ˜¯ Letâ€™s Encrypt è·å–çš„è¯ä¹¦ï¼Œä¸æ”¯æŒæ¯”è¾ƒæ—§çš„è®¾å¤‡ï¼Œæ¯”å¦‚ Android 5.0 ä»¥ä¸‹çš„è®¾å¤‡ï¼Œå¦‚æœæœ‰è¿™æ–¹é¢çš„éœ€è¦è¿˜æ˜¯æ¨èä½¿ç”¨ ZeroSSLã€‚</li>\n<li class=\"lvl-2\">å¸¸è§æ ¹è¯ä¹¦è¡¨</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>æ ¹è¯ä¹¦ï¼ˆCNï¼‰</th>\n<th>Android 5.0</th>\n<th>å¸¸è§ç­¾å‘æ–¹</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>ISRG Root X1</strong></td>\n<td>âŒ ä¸å…¼å®¹</td>\n<td>Letâ€™s Encrypt</td>\n</tr>\n<tr>\n<td><strong>DST Root CA X3</strong></td>\n<td>âœ… å…¼å®¹ï¼ˆ2021å¹´è¿‡æœŸï¼‰</td>\n<td>Letâ€™s Encrypt è€ç‰ˆæœ¬</td>\n</tr>\n<tr>\n<td><strong>GlobalSign Root R1</strong></td>\n<td>âœ… å…¼å®¹</td>\n<td>GlobalSign</td>\n</tr>\n<tr>\n<td><strong>USERTrust RSA Certification Authority</strong></td>\n<td>âœ… å…¼å®¹</td>\n<td>ZeroSSL, Sectigo</td>\n</tr>\n<tr>\n<td><strong>Starfield Root CA - G2</strong></td>\n<td>âŒ ä¸å…¼å®¹</td>\n<td>GoDaddy æ–°ç‰ˆ</td>\n</tr>\n<tr>\n<td><strong>Starfield Root CA - G1</strong></td>\n<td>âœ… å…¼å®¹</td>\n<td>GoDaddy è€ç‰ˆ</td>\n</tr>\n<tr>\n<td><strong>GTS Root R1/R3</strong></td>\n<td>âŒ ä¸å…¼å®¹</td>\n<td>Google Trust Services</td>\n</tr>\n<tr>\n<td><strong>Amazon Root CA 1</strong></td>\n<td>âŒ ä¸å…¼å®¹</td>\n<td>Amazon Trust</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-1\">\n<li class=\"lvl-2\">\n<p>å¯ä»¥ç”¨åœ¨çº¿å·¥å…·ç›´æ¥æŸ¥çœ‹è¯ä¹¦é“¾ï¼š<a href=\"https://www.ssllabs.com/ssltest/\">https://www.ssllabs.com/ssltest/</a> ï¼Œå®ƒä¼šæ˜¾ç¤ºå®Œæ•´è¯ä¹¦é“¾å’Œå„ç§è®¾å¤‡çš„å…¼å®¹æ€§</p>\n</li>\n</ul>\n</div>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æŸ¥çœ‹å·²ç»ç”Ÿæˆçš„è¯ä¹¦</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ acme.sh --list</span><br><span class=\"line\">Main_Domain          KeyLength  SAN_Domains  CA           Created               Renew</span><br><span class=\"line\">acme.hanqunfeng.com  <span class=\"string\">&quot;ec-256&quot;</span>   no           ZeroSSL.com  2025-07-17T03:31:30Z  2025-09-14T03:31:30Z</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¦‚æœç”Ÿæˆè¯ä¹¦æ—¶å¤±è´¥ï¼Œå¯ä»¥é€šè¿‡æ·»åŠ  --debug å‚æ•°æŸ¥çœ‹è¯¦ç»†é”™è¯¯ä¿¡æ¯</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">acme.sh --issue -d acme.hanqunfeng.com -d *.hanqunfeng.com --dns dns_ali --server letsencrypt --debug</span><br><span class=\"line\"><span class=\"comment\"># --debug 2 è¾“å‡ºæ›´ä¸ºè¯¦ç»†çš„ä¿¡æ¯</span></span><br><span class=\"line\">acme.sh --issue -d acme.hanqunfeng.com -d *.hanqunfeng.com --dns dns_ali --server letsencrypt --debug 2</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç›®å‰è¯ä¹¦æ¯ 60 å¤©è‡ªåŠ¨æ›´æ–°ï¼Œä½ æ— éœ€ä»»ä½•æ“ä½œã€‚ä½†æ˜¯ä½ ä¹Ÿå¯ä»¥å¼ºåˆ¶ç»­ç­¾è¯ä¹¦ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æ³¨æ„è¿™é‡Œè¦å°† --issue æ”¹ä¸º --renewï¼Œ--issue åªæœ‰ç¬¬ä¸€æ¬¡ç”Ÿæˆæ­£å¼æ—¶æ‰ä¼šä½¿ç”¨ã€‚åŒæ—¶åŠ ä¸Š --forceï¼Œæœªåˆ°æ›´æ–°æ—¶é—´å¼ºåˆ¶é‡æ–°ç”Ÿæˆè¯ä¹¦ã€‚</span></span><br><span class=\"line\">acme.sh --renew -d acme.hanqunfeng.com -d *.hanqunfeng.com --dns dns_ali --server letsencrypt --force</span><br></pre></td></tr></table></figure>\n<h2 id=\"ç”Ÿæˆè¯ä¹¦åè‡ªåŠ¨éƒ¨ç½²å’Œæ›´æ–°\">ç”Ÿæˆè¯ä¹¦åè‡ªåŠ¨éƒ¨ç½²å’Œæ›´æ–°</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¸Šé¢æ— è®ºæ˜¯ http è¿˜æ˜¯ dns æ¨¡å¼ï¼Œç”Ÿæˆè¯ä¹¦åï¼Œéƒ½ä¼šåœ¨ ~/.acme.sh/acme.hanqunfeng.com_ecc/ ç›®å½•ä¸‹ç”Ÿæˆä»¥ä¸‹æ–‡ä»¶ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">â”œâ”€â”€ acme.hanqunfeng.com.cer</span><br><span class=\"line\">â”œâ”€â”€ acme.hanqunfeng.com.conf</span><br><span class=\"line\">â”œâ”€â”€ acme.hanqunfeng.com.csr</span><br><span class=\"line\">â”œâ”€â”€ acme.hanqunfeng.com.csr.conf</span><br><span class=\"line\">â”œâ”€â”€ acme.hanqunfeng.com.key</span><br><span class=\"line\">â”œâ”€â”€ ca.cer</span><br><span class=\"line\">â””â”€â”€ fullchain.cer</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨å°†è¯ä¹¦æ‹·è´åˆ°çœŸæ­£ä½¿ç”¨è¯ä¹¦çš„ç›®å½•ä¸‹ï¼Œå¦‚æœæˆ‘ä»¬ä½¿ç”¨nginxæˆ–è€…apacheï¼Œå¯ä»¥è®© <a href=\"http://acme.sh\">acme.sh</a> å¸®æˆ‘ä»¬è‡ªåŠ¨å°†è¯ä¹¦æ‹·è´åˆ°æ­£ç¡®çš„ç›®å½•ä¸‹ï¼Œå¹¶é‡å¯æœåŠ¡ä½¿è¯ä¹¦ç”Ÿæ•ˆï¼Œæˆ‘ä»¬åªéœ€è¦é€šè¿‡å¦‚ä¸‹å‘½ä»¤è¿›è¡Œè®¾ç½®å³å¯ï¼Œåªéœ€è¦è¿è¡Œä¸€æ¬¡å‘½ä»¤ï¼Œåç»­ä¼šé€šè¿‡ crontab è¿›è¡Œè‡ªåŠ¨æ›´æ–°è¯ä¹¦å¹¶å®Œæˆéƒ¨ç½²ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>Nginx</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">acme.sh --install-cert \\</span><br><span class=\"line\">-d acme.hanqunfeng.com \\                               <span class=\"comment\"># ç”Ÿæˆè¯ä¹¦æ—¶æŒ‡å®šçš„åŸŸå</span></span><br><span class=\"line\">--key-file /path/to/keyfile/in/nginx/key.pem \\    <span class=\"comment\"># nginx ä¸­é…ç½®çš„ key æ–‡ä»¶è·¯å¾„</span></span><br><span class=\"line\">--fullchain-file /path/to/fullchain/nginx/cert.pem \\  <span class=\"comment\"># nginx ä¸­é…ç½®çš„è¯ä¹¦æ–‡ä»¶è·¯å¾„</span></span><br><span class=\"line\">--reloadcmd <span class=\"string\">&quot;systemctl reload nginx&quot;</span>                   <span class=\"comment\"># nginx é‡è½½å‘½ä»¤ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ nginx -s reload</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ–‡ä»¶å¯¹åº”å…³ç³»</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th><a href=\"http://acme.sh\">acme.sh</a> æ–‡ä»¶</th>\n<th>å«ä¹‰</th>\n<th>ä½ é…ç½®çš„ç›®æ ‡æ–‡ä»¶</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>acme.hanqunfeng.com.key</code></td>\n<td><strong>ç§é’¥ (Private Key)</strong></td>\n<td><code>/path/to/keyfile/in/nginx/key.pem</code></td>\n</tr>\n<tr>\n<td><code>fullchain.cer</code></td>\n<td><strong>è¯ä¹¦ + ä¸­é—´è¯ä¹¦é“¾ (Fullchain)</strong></td>\n<td><code>/path/to/fullchain/nginx/cert.pem</code></td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Apache</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">acme.sh --install-cert \\</span><br><span class=\"line\">-d acme.hanqunfeng.com \\</span><br><span class=\"line\">--cert-file      /path/to/certfile/in/apache/cert.pem  \\ <span class=\"comment\"># apache è¯ä¹¦æ–‡ä»¶</span></span><br><span class=\"line\">--key-file       /path/to/keyfile/in/apache/key.pem  \\   <span class=\"comment\"># apache å¯†é’¥æ–‡ä»¶</span></span><br><span class=\"line\">--fullchain-file /path/to/fullchain/certfile/apache/fullchain.pem \\ <span class=\"comment\"># apache å…¨é“¾æ–‡ä»¶</span></span><br><span class=\"line\">--reloadcmd     <span class=\"string\">&quot;systemctl reload httpd&quot;</span>  <span class=\"comment\"># apache é‡è½½å‘½ä»¤</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ–‡ä»¶å¯¹åº”å…³ç³»</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th><a href=\"http://acme.sh\">acme.sh</a> æ–‡ä»¶</th>\n<th>å«ä¹‰</th>\n<th>ä½ é…ç½®çš„ç›®æ ‡æ–‡ä»¶</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>acme.hanqunfeng.com.key</code></td>\n<td><strong>ç§é’¥ (Private Key)</strong></td>\n<td><code>/path/to/keyfile/in/apache/key.pem</code></td>\n</tr>\n<tr>\n<td><code>acme.hanqunfeng.com.cer</code></td>\n<td><strong>ä»…åŸŸåè¯ä¹¦ (Certificate)</strong></td>\n<td><code>/path/to/certfile/in/apache/cert.pem</code></td>\n</tr>\n<tr>\n<td><code>fullchain.cer</code></td>\n<td><strong>è¯ä¹¦ + ä¸­é—´è¯ä¹¦é“¾ (Fullchain)</strong></td>\n<td><code>/path/to/fullchain/certfile/apache/fullchain.pem</code></td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"åœæ­¢è‡ªåŠ¨æ›´æ–°å¹¶åˆ é™¤è¯ä¹¦\">åœæ­¢è‡ªåŠ¨æ›´æ–°å¹¶åˆ é™¤è¯ä¹¦</h2>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åœæ­¢è‡ªåŠ¨æ›´æ–°</span></span><br><span class=\"line\">acme.sh --remove -d acme.hanqunfeng.com --ecc</span><br><span class=\"line\"><span class=\"comment\"># åˆ é™¤è¯ä¹¦</span></span><br><span class=\"line\"><span class=\"built_in\">rm</span> -rf ~/.acme.sh/acme.hanqunfeng.com_ecc</span><br></pre></td></tr></table></figure>\n<h2 id=\"å…¶å®ƒsslè‡ªåŠ¨ç»­ç­¾å·¥å…·\">å…¶å®ƒsslè‡ªåŠ¨ç»­ç­¾å·¥å…·</h2>\n<table>\n<thead>\n<tr>\n<th>å·¥å…·</th>\n<th>æ¨èåœºæ™¯</th>\n<th>å®˜ç½‘åœ°å€</th>\n<th>ä¾èµ–</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Certbot</td>\n<td>ä¼ ç»ŸæœåŠ¡å™¨ã€Nginx/Apache</td>\n<td><a href=\"https://certbot.eff.org/\">https://certbot.eff.org/</a></td>\n<td>Python</td>\n</tr>\n<tr>\n<td>Lego</td>\n<td>é™æ€äºŒè¿›åˆ¶ã€K8s</td>\n<td><a href=\"https://github.com/go-acme/lego\">https://github.com/go-acme/lego</a></td>\n<td>æ— ä¾èµ–</td>\n</tr>\n<tr>\n<td>cert-manager</td>\n<td>K8s é›†ç¾¤</td>\n<td><a href=\"https://cert-manager.io/\">https://cert-manager.io/</a></td>\n<td>K8s CRD</td>\n</tr>\n<tr>\n<td>Caddy</td>\n<td>ç®€å•ç«™ç‚¹è‡ªåŠ¨HTTPS</td>\n<td><a href=\"https://caddyserver.com/\">https://caddyserver.com/</a></td>\n<td>æ— éœ€å•ç‹¬å·¥å…·</td>\n</tr>\n<tr>\n<td>Traefik</td>\n<td>å¾®æœåŠ¡ç½‘å…³</td>\n<td><a href=\"https://traefik.io/\">https://traefik.io/</a></td>\n<td>Docker/K8s</td>\n</tr>\n</tbody>\n</table>\n","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç»è‡ªåŠ¨ç”³è¯·å¹¶ç»­ç­¾ SSL è¯ä¹¦çš„å·¥å…·: acme.sh acme.sh Github acme.sh ä»‹ç» acme.sh å®ç°äº† acme åè®®ï¼Œå¯ä»¥ä» ZeroSSLï¼ŒLetâ€™s Encrypt ç­‰ CA ç”Ÿæˆå…è´¹çš„è¯ä¹¦ã€‚ é€‚ç”¨åœºæ™¯ï¼šshellè„šæœ¬æ–¹å¼ï¼Œå‡ ä¹æ— ä¾èµ–ï¼Œæç®€ï¼Œé€‚åˆä¸æƒ³å®‰è£…Pythonç¯å¢ƒçš„äººã€‚ ç‰¹ç‚¹ï¼š çº¯ Shell è„šæœ¬ï¼Œå•æ–‡ä»¶è¿è¡Œ æ”¯æŒ 100+ DNS API è‡ªåŠ¨ç»­ç­¾ï¼ˆå¦‚ Cloudflareã€é˜¿é‡Œäº‘ã€è…¾è®¯äº‘ç­‰ï¼‰ æ”¯æŒé€šé…ç¬¦è¯ä¹¦ acme.sh å®‰è£… éœ€è¦å…ˆå®‰è£… crontab 12345678# å®‰è£… crontabsudo dnf install cronie -y# å¯åŠ¨ crondsudo systemctl enable --now crond# æŸ¥çœ‹ crond çŠ¶æ€sudo systemctl status crond# æŸ¥çœ‹ crontab æ˜¯å¦æ­£å¸¸crontab -l å®‰è£… acme.sh 123456789101112131415# å®‰è£…æˆåŠŸåä¼šè‡ªåŠ¨å®‰è£…åˆ° ~/.acme.sh/ ç›®å½•ä¸‹ï¼Œè¯ä¹¦ä¹Ÿä¼šç”Ÿæˆåœ¨è¯¥ç›®å½•ä¸‹curl https://get.acme.sh | sh -s email=qunfeng_han@aliyun.comecho &#x27;alias acme.sh=~/.acme.sh/acme.sh&#x27; &gt;&gt; ~/.bashrcsource ~/.bashrc# å®‰è£…æˆåŠŸåä¼šè‡ªåŠ¨åœ¨ crontab ä¸­æ·»åŠ äº†å®šæ—¶ä»»åŠ¡ï¼Œæ¯å¤©æ£€æŸ¥ä¸€æ¬¡è¯ä¹¦æ˜¯å¦åˆ°è¾¾ä¸‹æ¬¡æ›´æ–°æ—¥æœŸï¼Œå¦‚æœåˆ°æœŸåˆ™è‡ªåŠ¨æ›´æ–°# è¯ä¹¦æœ‰æ•ˆæœŸé»˜è®¤ä¸º 90 å¤©ï¼Œè¿˜å‰© 30 å¤©æ—¶ä¼šè§¦å‘è‡ªåŠ¨æ›´æ–°crontab -l# è¾“å‡ºç±»ä¼¼äº ä»¥ä¸‹å†…å®¹48 1 * * * &quot;/root/.acme.sh&quot;/acme.sh --cron --home &quot;/root/.acme.sh&quot; &gt; /dev/null# æŸ¥çœ‹å¸®åŠ©acme.sh -h# æŸ¥çœ‹ç‰ˆæœ¬acme.sh -v å‡çº§ acme.sh 12345678# å‡çº§ acme.sh åˆ°æœ€æ–°ç‰ˆacme.sh --upgrade# å¼€å¯è‡ªåŠ¨å‡çº§acme.sh --upgrade --auto-upgrade# å¯ä»¥éšæ—¶å…³é—­è‡ªåŠ¨æ›´æ–°acme.sh --upgrade --auto-upgrade 0 å¸è½½ acme.sh 12acme.sh --uninstallrm -rf ~/.acme.sh ç”Ÿæˆè¯ä¹¦ acme.sh å®ç°äº† acme åè®®æ”¯æŒçš„æ‰€æœ‰éªŒè¯åè®®ã€‚ è¯ä¹¦åˆ›å»ºåä¼šä¿å­˜åœ¨ ~/.acme.sh/ç›®å½•ä¸‹ï¼Œæ¯”å¦‚æˆ‘çš„åŸŸåæ˜¯ acme.hanqunfeng.comï¼Œåˆ™è¯ä¹¦ä¿å­˜åœ¨ ~/.acme.sh/acme.hanqunfeng.com_ecc/ç›®å½•ä¸‹ åˆ›å»ºè¯ä¹¦æ—¶ä¸€èˆ¬æœ‰ä¸¤ç§æ–¹å¼éªŒè¯: HTTP å’Œ DNS éªŒè¯ã€‚ HTTP éªŒè¯ åªæ”¯æŒå•ä¸ªå­åŸŸåçš„è¯ä¹¦ç”Ÿæˆï¼Œä¸æ”¯æŒé€šé…ç¬¦åŸŸå éœ€è¦æå‰å°†åŸŸåè§£æåˆ°æœ¬æœºçš„IPåœ°å€ ç›´æ¥ç­¾å‘ åªéœ€è¦æŒ‡å®šåŸŸåï¼Œå¹¶æŒ‡å®šåŸŸåæ‰€åœ¨çš„ç½‘ç«™æ ¹ç›®å½•. acme.sh ä¼šå…¨è‡ªåŠ¨çš„ç”ŸæˆéªŒè¯æ–‡ä»¶ï¼Œå¹¶æ”¾åˆ°ç½‘ç«™çš„æ ¹ç›®å½•ï¼ŒéªŒè¯å®Œæˆåä¼šèªæ˜çš„åˆ é™¤éªŒè¯æ–‡ä»¶ï¼Œæ•´ä¸ªè¿‡ç¨‹æ²¡æœ‰ä»»ä½•å‰¯ä½œç”¨ã€‚ 12345# -d æŒ‡å®šåŸŸåï¼Œå¯ä»¥æ·»åŠ å¤šä¸ªï¼Œ--webroot æŒ‡å®šç½‘ç«™æ ¹ç›®å½•acme.sh --issue -d acme.hanqunfeng.com -d www.hanqunfeng.com --webroot /home/wwwroot/mydomain.com/# --server æŒ‡å®š acme.sh ä½¿ç”¨çš„ CA æœåŠ¡å•†ä¸º Let&#x27;s Encryptï¼Œé»˜è®¤ä½¿ç”¨ ZeroSSLacme.sh --issue -d acme.hanqunfeng.com -d www.hanqunfeng.com --webroot /home/wwwroot/mydomain.com/ --server letsencrypt ä½¿ç”¨ Nginx/Apache æ¨¡å¼ å¦‚æœä½ ç”¨çš„ Nginx/Apache æœåŠ¡å™¨ï¼Œæˆ–è€…åä»£ï¼Œacme.sh è¿˜å¯ä»¥æ™ºèƒ½çš„ä» Nginx/Apache çš„é…ç½®ä¸­è‡ªåŠ¨å®ŒæˆéªŒè¯ï¼Œä½ ä¸éœ€è¦æŒ‡å®šç½‘ç«™æ ¹ç›®å½• nginx æˆ– httpd å‘½ä»¤è¦åœ¨ç³»ç»ŸPathä¸­ 1234# -d åŸŸåï¼Œå¯ä»¥æ·»åŠ å¤šä¸ª, --nginx å‘Šè¯‰ acme.sh ä½¿ç”¨ Nginx æ¨¡å¼acme.sh --issue --nginx -d acme.hanqunfeng.com -d www.hanqunfeng.com# -d åŸŸåï¼Œå¯ä»¥æ·»åŠ å¤šä¸ª, --apache å‘Šè¯‰ acme.sh ä½¿ç”¨ Apache æ¨¡å¼acme.sh --issue --apache -d acme.hanqunfeng.com -d www.hanqunfeng.com ä½¿ç”¨ç‹¬ç«‹æœåŠ¡æ¨¡å¼ å¦‚æœæœåŠ¡å™¨ä¸Šæ²¡æœ‰è¿è¡Œä»»ä½• Web æœåŠ¡ï¼Œ80 ç«¯å£æ˜¯ç©ºé—²çš„ï¼Œé‚£ä¹ˆ acme.sh è¿˜èƒ½å‡è£…è‡ªå·±æ˜¯ä¸€ä¸ª WebServerï¼Œä¸´æ—¶ç›‘å¬ 80 ç«¯å£ï¼Œå®ŒæˆéªŒè¯ éœ€è¦å…ˆå®‰è£… socat å‘½ä»¤ï¼Œsocat å¸¸ç”¨äºä¸´æ—¶å¼€å¯ TCP/UDP ç›‘å¬ç«¯å£ 1sudo dnf install socat -y ç”Ÿæˆè¯ä¹¦ï¼Œè¦æ±‚80ç«¯å£ç©ºé—²ï¼Œå¦åˆ™ä¼šå¤±è´¥ 12# --standalone ç‹¬ç«‹æœåŠ¡æ¨¡å¼acme.sh --issue --standalone -d acme.hanqunfeng.com -d www.hanqunfeng.com DNS éªŒè¯ å¦‚æœä½ æ²¡æœ‰æœåŠ¡å™¨ï¼Œæ²¡æœ‰å…¬ç½‘ IPï¼Œåªéœ€è¦ DNS çš„è§£æè®°å½•å³å¯å®ŒæˆéªŒè¯ã€‚ æ”¯æŒé€šé…ç¬¦åŸŸå æ‰‹åŠ¨éªŒè¯ è¿™éœ€è¦ä½ æ‰‹åŠ¨åœ¨åŸŸåä¸Šæ·»åŠ ä¸€æ¡ TXT è§£æè®°å½•ï¼ŒéªŒè¯åŸŸåæ‰€æœ‰æƒã€‚ æ³¨æ„ï¼Œå¦‚æœä½¿ç”¨æ‰‹åŠ¨éªŒè¯ï¼Œacme.sh å°†æ— æ³•è‡ªåŠ¨æ›´æ–°è¯ä¹¦ï¼Œæ¯æ¬¡éƒ½éœ€è¦æ‰‹åŠ¨æ·»åŠ è§£ææ¥éªŒè¯åŸŸåæ‰€æœ‰æƒã€‚å¦‚æœæœ‰è‡ªåŠ¨æ›´æ–°è¯ä¹¦çš„éœ€æ±‚ï¼Œè¯·ä½¿ç”¨è‡ªåŠ¨éªŒè¯ï¼ˆDNS APIï¼‰ã€‚ 12# éœ€è¦åŠ ä¸Š --yes-I-know-dns-manual-mode-enough-go-ahead-please é€‰é¡¹acme.sh --issue --dns -d acme.hanqunfeng.com -d www.hanqunfeng.com --yes-I-know-dns-manual-mode-enough-go-ahead-please ç„¶åï¼Œacme.sh ä¼šç”Ÿæˆç›¸åº”çš„è§£æè®°å½•æ˜¾ç¤ºå‡ºæ¥ï¼Œä½ åªéœ€è¦åœ¨ä½ çš„åŸŸåç®¡ç†é¢æ¿ä¸­æ·»åŠ è¿™æ¡ TXT è®°å½•å³å¯ã€‚ 1234567Add the following txt record:Domain:_acme-challenge.acme.hanqunfeng.comTxt value:mUWNg9kuQ9hwOkqYFQ_DFMQ4Eu0CEaxxxxxxxxxxxAdd the following txt record:Domain:_acme-challenge.www.hanqunfeng.comTxt value:vLwDR48eHcmcScOwHrDjaFZo-yw_f9xxxxxxxxxxx ç­‰å¾…è§£æå®Œæˆä¹‹åï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤é‡æ–°ç”Ÿæˆè¯ä¹¦ï¼š 12# æ³¨æ„è¿™é‡Œç°åœ¨ç”¨çš„æ˜¯ --renew å‚æ•°acme.sh --renew -d acme.hanqunfeng.com -d www.hanqunfeng.com è‡ªåŠ¨éªŒè¯ï¼ˆDNS APIï¼‰ DNS æ–¹å¼çš„çœŸæ­£å¼ºå¤§ä¹‹å¤„åœ¨äºå¯ä»¥ä½¿ç”¨åŸŸåè§£æå•†æä¾›çš„ API è‡ªåŠ¨æ·»åŠ  TXT è®°å½•ï¼Œä¸”åœ¨å®ŒæˆéªŒè¯ååˆ é™¤å¯¹åº”çš„è®°å½•ã€‚ acme.sh ç›®å‰æ”¯æŒè¶…è¿‡ä¸€ç™¾å®¶çš„ DNS APIã€‚ ä»¥é˜¿é‡Œäº‘ä¸ºä¾‹ï¼Œç™»å½•é˜¿é‡Œäº‘å¸å·ï¼Œè·å– AccessKey å’Œ SecretKeyï¼Œå¹¶è®¾ç½®ç¯å¢ƒå˜é‡ï¼š 123# åªéœ€è¦å‘½ä»¤è¡Œæ‰§è¡Œä¸€æ¬¡ï¼Œè¿è¡Œç”Ÿæˆè¯ä¹¦å‘½ä»¤æ—¶ä¼šä¿å­˜åœ¨ ~/.acme.sh/account.conf ä¸­ï¼Œå¹¶åœ¨éœ€è¦æ—¶è‡ªåŠ¨è·å–ï¼Œæ— éœ€æ‰‹åŠ¨å†è®¾ç½®export Ali_Key=&quot;&lt;key&gt;&quot;export Ali_Secret=&quot;&lt;secret&gt;&quot; ç”Ÿæˆè¯ä¹¦ 12# --dns dns_ali æŒ‡å®šé˜¿é‡Œäº‘çš„DNS APIacme.sh --issue -d acme.hanqunfeng.com -d *.hanqunfeng.com --dns dns_ali ç”Ÿæˆè¯ä¹¦çš„å…¶å®ƒè¯´æ˜ acme.sh è„šæœ¬é»˜è®¤ CA æœåŠ¡å•†æ˜¯ ZeroSSLï¼Œacme.sh æ”¯æŒçš„CA æœåŠ¡å•†åŠå…¶ä½¿ç”¨æ–¹æ³•ï¼Œå¯ä»¥åœ¨å‘½ä»¤è¡Œä¸­é€šè¿‡ --server æŒ‡å®š 12# è¿™é‡Œä½¿ç”¨ Let&#x27;s Encrypt çš„ CA æœåŠ¡å•†acme.sh --issue -d acme.hanqunfeng.com -d *.hanqunfeng.com --dns dns_ali --server letsencrypt ä¹Ÿå¯ä»¥è®¾ç½®å…¨å±€é»˜è®¤çš„ CA æœåŠ¡å•†ï¼Œè¿™æ ·å°±ä¸éœ€è¦æ¯æ¬¡éƒ½æŒ‡å®š --server 1acme.sh --set-default-ca --server letsencrypt å°è´´å£« acme.sh å®˜ç½‘è¯´ é»˜è®¤çš„ CA æœåŠ¡å•† ZeroSSL ä¸æ˜¯å¾ˆç¨³å®šï¼Œæœ‰æ—¶å¯èƒ½ä¼šå¯¼è‡´è·å–è¯ä¹¦çš„æ—¶å€™ä¸€ç›´å‡ºç°ï¼šPendingï¼ŒThe CA is processing your orderï¼Œplease just wait.ï¼Œ æ­¤æ—¶åªéœ€è¦æŠŠ CA æœåŠ¡å™¨æ”¹æˆ Letâ€™s Encrypt å³å¯ï¼Œè™½ç„¶æ›´æ”¹ä»¥åè¿˜æ˜¯æœ‰æ¦‚ç‡å‡ºç° pendingï¼Œä½†åŸºæœ¬ 2-3 æ¬¡å³å¯æˆåŠŸã€‚ ä½†æ˜¯ Letâ€™s Encrypt è·å–çš„è¯ä¹¦ï¼Œä¸æ”¯æŒæ¯”è¾ƒæ—§çš„è®¾å¤‡ï¼Œæ¯”å¦‚ Android 5.0 ä»¥ä¸‹çš„è®¾å¤‡ï¼Œå¦‚æœæœ‰è¿™æ–¹é¢çš„éœ€è¦è¿˜æ˜¯æ¨èä½¿ç”¨ ZeroSSLã€‚ å¸¸è§æ ¹è¯ä¹¦è¡¨ æ ¹è¯ä¹¦ï¼ˆCNï¼‰ Android 5.0 å¸¸è§ç­¾å‘æ–¹ ISRG Root X1 âŒ ä¸å…¼å®¹ Letâ€™s Encrypt DST Root CA X3 âœ… å…¼å®¹ï¼ˆ2021å¹´è¿‡æœŸï¼‰ Letâ€™s Encrypt è€ç‰ˆæœ¬ GlobalSign Root R1 âœ… å…¼å®¹ GlobalSign USERTrust RSA Certification Authority âœ… å…¼å®¹ ZeroSSL, Sectigo Starfield Root CA - G2 âŒ ä¸å…¼å®¹ GoDaddy æ–°ç‰ˆ Starfield Root CA - G1 âœ… å…¼å®¹ GoDaddy è€ç‰ˆ GTS Root R1/R3 âŒ ä¸å…¼å®¹ Google Trust Services Amazon Root CA 1 âŒ ä¸å…¼å®¹ Amazon Trust å¯ä»¥ç”¨åœ¨çº¿å·¥å…·ç›´æ¥æŸ¥çœ‹è¯ä¹¦é“¾ï¼šhttps://www.ssllabs.com/ssltest/ ï¼Œå®ƒä¼šæ˜¾ç¤ºå®Œæ•´è¯ä¹¦é“¾å’Œå„ç§è®¾å¤‡çš„å…¼å®¹æ€§ æŸ¥çœ‹å·²ç»ç”Ÿæˆçš„è¯ä¹¦ 123$ acme.sh --listMain_Domain KeyLength SAN_Domains CA Created Renewacme.hanqunfeng.com &quot;ec-256&quot; no ZeroSSL.com 2025-07-17T03:31:30Z 2025-09-14T03:31:30Z å¦‚æœç”Ÿæˆè¯ä¹¦æ—¶å¤±è´¥ï¼Œå¯ä»¥é€šè¿‡æ·»åŠ  --debug å‚æ•°æŸ¥çœ‹è¯¦ç»†é”™è¯¯ä¿¡æ¯ 123acme.sh --issue -d acme.hanqunfeng.com -d *.hanqunfeng.com --dns dns_ali --server letsencrypt --debug# --debug 2 è¾“å‡ºæ›´ä¸ºè¯¦ç»†çš„ä¿¡æ¯acme.sh --issue -d acme.hanqunfeng.com -d *.hanqunfeng.com --dns dns_ali --server letsencrypt --debug 2 ç›®å‰è¯ä¹¦æ¯ 60 å¤©è‡ªåŠ¨æ›´æ–°ï¼Œä½ æ— éœ€ä»»ä½•æ“ä½œã€‚ä½†æ˜¯ä½ ä¹Ÿå¯ä»¥å¼ºåˆ¶ç»­ç­¾è¯ä¹¦ï¼š 12# æ³¨æ„è¿™é‡Œè¦å°† --issue æ”¹ä¸º --renewï¼Œ--issue åªæœ‰ç¬¬ä¸€æ¬¡ç”Ÿæˆæ­£å¼æ—¶æ‰ä¼šä½¿ç”¨ã€‚åŒæ—¶åŠ ä¸Š --forceï¼Œæœªåˆ°æ›´æ–°æ—¶é—´å¼ºåˆ¶é‡æ–°ç”Ÿæˆè¯ä¹¦ã€‚acme.sh --renew -d acme.hanqunfeng.com -d *.hanqunfeng.com --dns dns_ali --server letsencrypt --force ç”Ÿæˆè¯ä¹¦åè‡ªåŠ¨éƒ¨ç½²å’Œæ›´æ–° ä¸Šé¢æ— è®ºæ˜¯ http è¿˜æ˜¯ dns æ¨¡å¼ï¼Œç”Ÿæˆè¯ä¹¦åï¼Œéƒ½ä¼šåœ¨ ~/.acme.sh/acme.hanqunfeng.com_ecc/ ç›®å½•ä¸‹ç”Ÿæˆä»¥ä¸‹æ–‡ä»¶ï¼š 1234567â”œâ”€â”€ acme.hanqunfeng.com.cerâ”œâ”€â”€ acme.hanqunfeng.com.confâ”œâ”€â”€ acme.hanqunfeng.com.csrâ”œâ”€â”€ acme.hanqunfeng.com.csr.confâ”œâ”€â”€ acme.hanqunfeng.com.keyâ”œâ”€â”€ ca.cerâ””â”€â”€ fullchain.cer æˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨å°†è¯ä¹¦æ‹·è´åˆ°çœŸæ­£ä½¿ç”¨è¯ä¹¦çš„ç›®å½•ä¸‹ï¼Œå¦‚æœæˆ‘ä»¬ä½¿ç”¨nginxæˆ–è€…apacheï¼Œå¯ä»¥è®© acme.sh å¸®æˆ‘ä»¬è‡ªåŠ¨å°†è¯ä¹¦æ‹·è´åˆ°æ­£ç¡®çš„ç›®å½•ä¸‹ï¼Œå¹¶é‡å¯æœåŠ¡ä½¿è¯ä¹¦ç”Ÿæ•ˆï¼Œæˆ‘ä»¬åªéœ€è¦é€šè¿‡å¦‚ä¸‹å‘½ä»¤è¿›è¡Œè®¾ç½®å³å¯ï¼Œåªéœ€è¦è¿è¡Œä¸€æ¬¡å‘½ä»¤ï¼Œåç»­ä¼šé€šè¿‡ crontab è¿›è¡Œè‡ªåŠ¨æ›´æ–°è¯ä¹¦å¹¶å®Œæˆéƒ¨ç½²ã€‚ Nginx 12345acme.sh --install-cert \\-d acme.hanqunfeng.com \\ # ç”Ÿæˆè¯ä¹¦æ—¶æŒ‡å®šçš„åŸŸå--key-file /path/to/keyfile/in/nginx/key.pem \\ # nginx ä¸­é…ç½®çš„ key æ–‡ä»¶è·¯å¾„--fullchain-file /path/to/fullchain/nginx/cert.pem \\ # nginx ä¸­é…ç½®çš„è¯ä¹¦æ–‡ä»¶è·¯å¾„--reloadcmd &quot;systemctl reload nginx&quot; # nginx é‡è½½å‘½ä»¤ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ nginx -s reload æ–‡ä»¶å¯¹åº”å…³ç³» acme.sh æ–‡ä»¶ å«ä¹‰ ä½ é…ç½®çš„ç›®æ ‡æ–‡ä»¶ acme.hanqunfeng.com.key ç§é’¥ (Private Key) /path/to/keyfile/in/nginx/key.pem fullchain.cer è¯ä¹¦ + ä¸­é—´è¯ä¹¦é“¾ (Fullchain) /path/to/fullchain/nginx/cert.pem Apache 123456acme.sh --install-cert \\-d acme.hanqunfeng.com \\--cert-file /path/to/certfile/in/apache/cert.pem \\ # apache è¯ä¹¦æ–‡ä»¶--key-file /path/to/keyfile/in/apache/key.pem \\ # apache å¯†é’¥æ–‡ä»¶--fullchain-file /path/to/fullchain/certfile/apache/fullchain.pem \\ # apache å…¨é“¾æ–‡ä»¶--reloadcmd &quot;systemctl reload httpd&quot; # apache é‡è½½å‘½ä»¤ æ–‡ä»¶å¯¹åº”å…³ç³» acme.sh æ–‡ä»¶ å«ä¹‰ ä½ é…ç½®çš„ç›®æ ‡æ–‡ä»¶ acme.hanqunfeng.com.key ç§é’¥ (Private Key) /path/to/keyfile/in/apache/key.pem acme.hanqunfeng.com.cer ä»…åŸŸåè¯ä¹¦ (Certificate) /path/to/certfile/in/apache/cert.pem fullchain.cer è¯ä¹¦ + ä¸­é—´è¯ä¹¦é“¾ (Fullchain) /path/to/fullchain/certfile/apache/fullchain.pem åœæ­¢è‡ªåŠ¨æ›´æ–°å¹¶åˆ é™¤è¯ä¹¦ 1234# åœæ­¢è‡ªåŠ¨æ›´æ–°acme.sh --remove -d acme.hanqunfeng.com --ecc# åˆ é™¤è¯ä¹¦rm -rf ~/.acme.sh/acme.hanqunfeng.com_ecc å…¶å®ƒsslè‡ªåŠ¨ç»­ç­¾å·¥å…· å·¥å…· æ¨èåœºæ™¯ å®˜ç½‘åœ°å€ ä¾èµ– Certbot ä¼ ç»ŸæœåŠ¡å™¨ã€Nginx/Apache https://certbot.eff.org/ Python Lego é™æ€äºŒè¿›åˆ¶ã€K8s https://github.com/go-acme/lego æ— ä¾èµ– cert-manager K8s é›†ç¾¤ https://cert-manager.io/ K8s CRD Caddy ç®€å•ç«™ç‚¹è‡ªåŠ¨HTTPS https://caddyserver.com/ æ— éœ€å•ç‹¬å·¥å…· Traefik å¾®æœåŠ¡ç½‘å…³ https://traefik.io/ Docker/K8s","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç»è‡ªåŠ¨ç”³è¯·å¹¶ç»­ç­¾ SSL è¯ä¹¦çš„å·¥å…·: acme.sh acme.sh Github","date_published":"2025-07-17T14:30:05.000Z","tags":["æŠ€æœ¯","acme","ssl","certificate","ssl","acme"]},{"id":"https://blog.hanqunfeng.com/2025/07/16/k8s-toomanyrequests/","url":"https://blog.hanqunfeng.com/2025/07/16/k8s-toomanyrequests/","title":"K8S é•œåƒæ‹‰å– ä¹‹ toomanyrequests çš„è§£å†³æ–¹æ³•","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç» K8S é•œåƒæ‹‰å– çš„ <code>toomanyrequests</code> çš„è§£å†³æ–¹æ³• ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://kubernetes.io/zh-cn/\">K8Så®˜ç½‘</a></p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://github.com/kubernetes/kubernetes\">k8s Github</a></p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"toomanyrequests-ä»‹ç»\">toomanyrequests ä»‹ç»</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å½“æˆ‘ä»¬é€šè¿‡k8såˆ›å»ºpodæ—¶éœ€è¦ä» dockerhub ä¸Šæ‹‰å–é•œåƒï¼Œä½†æ˜¯ dockerhub çš„apiè¯·æ±‚æ˜¯æœ‰é™åˆ¶çš„ï¼Œæœªè®¤è¯ç”¨æˆ·é™åˆ¶ä¸º100/6hï¼Œå¦‚æœè¶…è¿‡è¿™ä¸ªé™åˆ¶å°±ä¼šè¿”å›<code>429 Too Many Requestså“åº”</code>ã€‚<a href=\"https://docs.docker.com/docker-hub/usage/\">Docker Hubçš„ä½¿ç”¨å’Œé™åˆ¶</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>æˆ‘ä»¬å¯ä»¥è¿›è¡Œç”¨æˆ·è®¤è¯ï¼Œè¿™æ ·å¯ä»¥å°†é™åˆ¶æé«˜åˆ°2000/6hã€‚å¦‚æœè¿˜éœ€è¦è¿›ä¸€æ­¥æé«˜è¯·æ±‚é™åˆ¶ï¼Œå¯ä»¥ç”³è¯·dockerhubçš„pro planã€‚</p>\n</li>\n</ul>\n<h2 id=\"dockerhub-è®¤è¯\">dockerhub è®¤è¯</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ›å»º Docker Registry Secret</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æŒ‡å®š namespaceï¼Œ é»˜è®¤å‘½åç©ºé—´æ˜¯ default</span></span><br><span class=\"line\">kubectl create secret docker-registry \\</span><br><span class=\"line\">  dockerhub-secret \\                            <span class=\"comment\"># åˆ›å»º secret åç§°</span></span><br><span class=\"line\">  --namespace=ä½ çš„å‘½åç©ºé—´ \\                      <span class=\"comment\"># åˆ›å»º secret æ‰€åœ¨çš„å‘½åç©ºé—´</span></span><br><span class=\"line\">  --docker-server=https://index.docker.io/v1/ \\ <span class=\"comment\"># æŒ‡å®š docker registry åœ°å€ï¼Œé»˜è®¤å°±æ˜¯è¿™ä¸ªï¼Œå…¶å®ƒä»“åº“æˆ–ç§æœè¯·æ›´æ”¹ä¸ºå¯¹åº”çš„url</span></span><br><span class=\"line\">  --docker-username=ä½ çš„ç”¨æˆ·å \\                  <span class=\"comment\"># ä»“åº“ çš„ç”¨æˆ·å</span></span><br><span class=\"line\">  --docker-password=ä½ çš„å¯†ç æˆ–è®¿é—®ä»¤ç‰Œ \\           <span class=\"comment\"># ä»“åº“ çš„å¯†ç æˆ–è®¿é—®ä»¤ç‰Œ</span></span><br><span class=\"line\">  --docker-email=ä½ çš„é‚®ç®±                        <span class=\"comment\"># ä»“åº“ çš„é‚®ç®±</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹ secret</span></span><br><span class=\"line\">kubectl get secret dockerhub-secret -o yaml -n &lt;namespace&gt;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¯ä»¥åœ¨åˆ›å»º pod æˆ– deployment æ—¶æŒ‡å®šå‡­è¯</p>\n</li>\n</ul>\n<blockquote>\n<p>pod</p>\n</blockquote>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Pod</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">myapp</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">containers:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">myapp</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">username/repository:tag</span></span><br><span class=\"line\">  <span class=\"attr\">imagePullSecrets:</span>                         <span class=\"comment\"># æ·»åŠ å‡­è¯</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">dockerhub-secret</span></span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>deployment</p>\n</blockquote>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">apps/v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Deployment</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">myapp-deployment</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">replicas:</span> <span class=\"number\">3</span></span><br><span class=\"line\">  <span class=\"attr\">selector:</span></span><br><span class=\"line\">    <span class=\"attr\">matchLabels:</span></span><br><span class=\"line\">      <span class=\"attr\">app:</span> <span class=\"string\">myapp</span></span><br><span class=\"line\">  <span class=\"attr\">template:</span></span><br><span class=\"line\">    <span class=\"attr\">metadata:</span></span><br><span class=\"line\">      <span class=\"attr\">labels:</span></span><br><span class=\"line\">        <span class=\"attr\">app:</span> <span class=\"string\">myapp</span></span><br><span class=\"line\">    <span class=\"attr\">spec:</span></span><br><span class=\"line\">      <span class=\"attr\">containers:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">myapp</span></span><br><span class=\"line\">        <span class=\"attr\">image:</span> <span class=\"string\">username/repository:tag</span></span><br><span class=\"line\">      <span class=\"attr\">imagePullSecrets:</span>                       <span class=\"comment\"># æ·»åŠ å‡­è¯</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">dockerhub-secret</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å°† Secret æ·»åŠ åˆ° ServiceAccountï¼Œè¿™æ · Pod åˆ›å»ºçš„æ—¶å€™ï¼Œä¼šè‡ªåŠ¨å°† Secret æŒ‚è½½åˆ° Pod ä¸­</p>\n</li>\n</ul>\n<blockquote>\n<p>æ¯ä¸ª namespace ä¸‹ éƒ½æœ‰ä¸€ä¸ª åç§°ä¸º default çš„ ServiceAccount</p>\n</blockquote>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹ pod çš„ ServiceAccount</span></span><br><span class=\"line\">$ k describe pod pi-n65gn | grep <span class=\"string\">&quot;Service Account&quot;</span></span><br><span class=\"line\">Service Account:  default</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŒ‡å®š namespace ä¸‹çš„ Pod ä½¿ç”¨è¿™ä¸ªå‡­è¯</span></span><br><span class=\"line\">kubectl patch serviceaccount default -p <span class=\"string\">&#x27;&#123;&quot;imagePullSecrets&quot;: [&#123;&quot;name&quot;: &quot;dockerhub-secret&quot;&#125;]&#125;&#x27;</span> -n &lt;namespace&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ·»åŠ å¤šä¸ªå‡­è¯ï¼Œè¿™ä¼šè¦†ç›–ä¹‹å‰çš„è®¾ç½®ï¼Œå¤šä¸ª secret æŒ‰é¡ºåºç”Ÿæ•ˆï¼Œk8s ä¼šé€ä¸ªå°è¯•å»æ‹‰å–é•œåƒ</span></span><br><span class=\"line\">kubectl patch serviceaccount default -p <span class=\"string\">&#x27;&#123;&quot;imagePullSecrets&quot;: [&#123;&quot;name&quot;: &quot;dockerhub-secret&quot;&#125;, &#123;&quot;name&quot;: &quot;harbor-secret&quot;&#125;, &#123;&quot;name&quot;: &quot;aliyun-secret&quot;&#125;]&#125;&#x27;</span> -n &lt;namespace&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># è¿½åŠ ä¸€ä¸ªå‡­è¯ï¼Œä¸ä¼šè¦†ç›–åŸæœ‰çš„è®¾ç½®</span></span><br><span class=\"line\">kubectl patch serviceaccount default --<span class=\"built_in\">type</span>=<span class=\"string\">&#x27;json&#x27;</span> -p=<span class=\"string\">&#x27;[&#123;&quot;op&quot;: &quot;add&quot;, &quot;path&quot;: &quot;/imagePullSecrets/-&quot;, &quot;value&quot;: &#123;&quot;name&quot;: &quot;new-secret&quot;&#125;&#125;]&#x27;</span> -n &lt;namespace&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹å½“å‰ imagePullSecrets çš„ç´¢å¼•ï¼Œä»¥ä¸‹å‘½ä»¤ä¼šè¾“å‡ºå‡­è¯çš„åç§°ï¼Œç´¢å¼•ä» 0 å¼€å§‹</span></span><br><span class=\"line\">kubectl get sa default -o jsonpath=<span class=\"string\">&#x27;&#123;.imagePullSecrets[*].name&#125;&#x27;</span> -n &lt;namespace&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åˆ é™¤ä¸€ä¸ªå‡­è¯: åˆ é™¤ index ä¸º 1 çš„å‡­è¯</span></span><br><span class=\"line\">kubectl patch serviceaccount default --<span class=\"built_in\">type</span>=json -p=<span class=\"string\">&#x27;[&#123;&quot;op&quot;: &quot;remove&quot;, &quot;path&quot;: &quot;/imagePullSecrets/1&quot;&#125;]&#x27;</span> -n &lt;namespace&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ¸…ç©ºæ‰€æœ‰å‡­è¯</span></span><br><span class=\"line\">kubectl patch sa default -p <span class=\"string\">&#x27;&#123;&quot;imagePullSecrets&quot;: []&#125;&#x27;</span> -n &lt;namespace&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ä¸ºæ‰€æœ‰ namespace ä¸‹çš„ Pod æ·»åŠ å‡­è¯</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> ns <span class=\"keyword\">in</span> $(kubectl get ns -o jsonpath=<span class=\"string\">&#x27;&#123;.items[*].metadata.name&#125;&#x27;</span>); <span class=\"keyword\">do</span></span><br><span class=\"line\">  kubectl patch serviceaccount default -n <span class=\"variable\">$ns</span> \\</span><br><span class=\"line\">    --<span class=\"built_in\">type</span>=merge \\</span><br><span class=\"line\">    -p <span class=\"string\">&#x27;&#123;&quot;imagePullSecrets&quot;: [&#123;&quot;name&quot;: &quot;dockerhub-secret&quot;&#125;]&#125;&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">done</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹ ServiceAccount</span></span><br><span class=\"line\">$ kubectl get serviceaccount default -o yaml -n &lt;namespace&gt;</span><br><span class=\"line\">apiVersion: v1</span><br><span class=\"line\">imagePullSecrets:</span><br><span class=\"line\">- name: dockerhub-secret</span><br><span class=\"line\">kind: ServiceAccount</span><br><span class=\"line\">metadata:</span><br><span class=\"line\">  creationTimestamp: <span class=\"string\">&quot;2025-06-29T14:41:35Z&quot;</span></span><br><span class=\"line\">  name: default</span><br><span class=\"line\">  namespace: default</span><br><span class=\"line\">  resourceVersion: <span class=\"string\">&quot;361001&quot;</span></span><br><span class=\"line\">  uid: cb3a0f99-5804-4f21-816a-70533cc3d29d</span><br></pre></td></tr></table></figure>\n<h2 id=\"æé«˜ä¸‹è½½é¢‘ç‡çš„å…¶ä»–å»ºè®®\">æé«˜ä¸‹è½½é¢‘ç‡çš„å…¶ä»–å»ºè®®</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>1.ä½¿ç”¨é•œåƒç¼“å­˜:</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">è®¾ç½®é›†ç¾¤å†…é•œåƒç¼“å­˜ï¼ˆå¦‚ Harbor, Nexus Registryï¼‰</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ä¿®æ”¹é›†ç¾¤çš„é•œåƒä»“åº“é…ç½®ï¼ˆvimï¼‰</span></span><br><span class=\"line\">kubectl edit configmap -n kube-system</span><br><span class=\"line\"><span class=\"comment\"># æ‰¾åˆ° imageRepository: æ›¿æ¢ä¸ºä½ çš„ä»“åº“åœ°å€</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">ä½¿ç”¨ Docker Hub é•œåƒåŠ é€Ÿå™¨ï¼ˆå¦‚æœåœ¨ä¸­å›½å¤§é™†ï¼‰\n<ul class=\"lvl-4\">\n<li class=\"lvl-6\">å¦‚æœ k8s ä½¿ç”¨çš„æ˜¯ dockerï¼Œåˆ™åœ¨<code>/etc/docker/daemon.json</code>æ·»åŠ é•œåƒåŠ é€Ÿå™¨é…ç½®</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">sudo</span> <span class=\"built_in\">mkdir</span> -p /etc/docker</span><br><span class=\"line\"><span class=\"built_in\">sudo</span> <span class=\"built_in\">tee</span> /etc/docker/daemon.json &lt;&lt;-<span class=\"string\">&#x27;EOF&#x27;</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">&quot;registry-mirrors&quot;</span>: [</span><br><span class=\"line\">    <span class=\"string\">&quot;https://docker.1ms.run&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;https://docker.xuanyuan.me&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;https://docker.m.daocloud.io&quot;</span></span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">EOF</span><br><span class=\"line\"><span class=\"built_in\">sudo</span> systemctl daemon-reload</span><br><span class=\"line\"><span class=\"built_in\">sudo</span> systemctl restart docker</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-4\">\n<li class=\"lvl-6\">å¦‚æœ k8s ä½¿ç”¨çš„æ˜¯ containerdï¼Œåˆ™åœ¨<code>/etc/containerd/config.toml</code>æ·»åŠ é•œåƒåŠ é€Ÿå™¨é…ç½®</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">sudo</span> vi /etc/containerd/config.toml</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ‰¾åˆ° registry.mirrors å­—æ®µï¼Œæ·»åŠ åŠ é€Ÿå™¨ï¼Œæ¯”å¦‚ï¼š</span></span><br><span class=\"line\">[plugins.<span class=\"string\">&quot;io.containerd.grpc.v1.cri&quot;</span>.registry.mirrors]</span><br><span class=\"line\">  [plugins.<span class=\"string\">&quot;io.containerd.grpc.v1.cri&quot;</span>.registry.mirrors.<span class=\"string\">&quot;docker.io&quot;</span>]</span><br><span class=\"line\">    endpoint = [<span class=\"string\">&quot;https://docker.1ms.run&quot;</span>, <span class=\"string\">&quot;https://docker.xuanyuan.me&quot;</span>, <span class=\"string\">&quot;https://docker.m.daocloud.io&quot;</span>]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ä¿®æ”¹åé‡å¯ containerd</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> systemctl restart containerd</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<p>2.å‡çº§ Docker Hub è®¢é˜…:</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">å…è´¹è´¦æˆ·ï¼š200 pulls/6å°æ—¶ï¼ˆåŒ¿åç”¨æˆ·100 pulls/6å°æ—¶ï¼‰</li>\n<li class=\"lvl-4\">Pro/Team è´¦æˆ·ï¼šæ— é™åˆ¶æ‹‰å–</li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<p>3.ä½¿ç”¨å¤šä¸ªè´¦æˆ·:</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">ä¸ºä¸åŒèŠ‚ç‚¹é…ç½®ä¸åŒçš„ Docker Hub å‡­è¯</li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<p>4.å‡å°‘ä¸å¿…è¦çš„æ‹‰å–:</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">ä½¿ç”¨ imagePullPolicy: IfNotPresent</li>\n<li class=\"lvl-4\">å°½é‡ä½¿ç”¨å›ºå®šç‰ˆæœ¬æ ‡ç­¾è€Œé latest</li>\n</ul>\n</li>\n</ul>\n","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» K8S é•œåƒæ‹‰å– çš„ toomanyrequests çš„è§£å†³æ–¹æ³• ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚ K8Så®˜ç½‘ k8s Github toomanyrequests ä»‹ç» å½“æˆ‘ä»¬é€šè¿‡k8såˆ›å»ºpodæ—¶éœ€è¦ä» dockerhub ä¸Šæ‹‰å–é•œåƒï¼Œä½†æ˜¯ dockerhub çš„apiè¯·æ±‚æ˜¯æœ‰é™åˆ¶çš„ï¼Œæœªè®¤è¯ç”¨æˆ·é™åˆ¶ä¸º100/6hï¼Œå¦‚æœè¶…è¿‡è¿™ä¸ªé™åˆ¶å°±ä¼šè¿”å›429 Too Many Requestså“åº”ã€‚Docker Hubçš„ä½¿ç”¨å’Œé™åˆ¶ æˆ‘ä»¬å¯ä»¥è¿›è¡Œç”¨æˆ·è®¤è¯ï¼Œè¿™æ ·å¯ä»¥å°†é™åˆ¶æé«˜åˆ°2000/6hã€‚å¦‚æœè¿˜éœ€è¦è¿›ä¸€æ­¥æé«˜è¯·æ±‚é™åˆ¶ï¼Œå¯ä»¥ç”³è¯·dockerhubçš„pro planã€‚ dockerhub è®¤è¯ åˆ›å»º Docker Registry Secret 1234567891011# æŒ‡å®š namespaceï¼Œ é»˜è®¤å‘½åç©ºé—´æ˜¯ defaultkubectl create secret docker-registry \\ dockerhub-secret \\ # åˆ›å»º secret åç§° --namespace=ä½ çš„å‘½åç©ºé—´ \\ # åˆ›å»º secret æ‰€åœ¨çš„å‘½åç©ºé—´ --docker-server=https://index.docker.io/v1/ \\ # æŒ‡å®š docker registry åœ°å€ï¼Œé»˜è®¤å°±æ˜¯è¿™ä¸ªï¼Œå…¶å®ƒä»“åº“æˆ–ç§æœè¯·æ›´æ”¹ä¸ºå¯¹åº”çš„url --docker-username=ä½ çš„ç”¨æˆ·å \\ # ä»“åº“ çš„ç”¨æˆ·å --docker-password=ä½ çš„å¯†ç æˆ–è®¿é—®ä»¤ç‰Œ \\ # ä»“åº“ çš„å¯†ç æˆ–è®¿é—®ä»¤ç‰Œ --docker-email=ä½ çš„é‚®ç®± # ä»“åº“ çš„é‚®ç®±# æŸ¥çœ‹ secretkubectl get secret dockerhub-secret -o yaml -n &lt;namespace&gt; å¯ä»¥åœ¨åˆ›å»º pod æˆ– deployment æ—¶æŒ‡å®šå‡­è¯ pod 12345678910apiVersion: v1kind: Podmetadata: name: myappspec: containers: - name: myapp image: username/repository:tag imagePullSecrets: # æ·»åŠ å‡­è¯ - name: dockerhub-secret deployment 12345678910111213141516171819apiVersion: apps/v1kind: Deploymentmetadata: name: myapp-deploymentspec: replicas: 3 selector: matchLabels: app: myapp template: metadata: labels: app: myapp spec: containers: - name: myapp image: username/repository:tag imagePullSecrets: # æ·»åŠ å‡­è¯ - name: dockerhub-secret å°† Secret æ·»åŠ åˆ° ServiceAccountï¼Œè¿™æ · Pod åˆ›å»ºçš„æ—¶å€™ï¼Œä¼šè‡ªåŠ¨å°† Secret æŒ‚è½½åˆ° Pod ä¸­ æ¯ä¸ª namespace ä¸‹ éƒ½æœ‰ä¸€ä¸ª åç§°ä¸º default çš„ ServiceAccount 123456789101112131415161718192021222324252627282930313233343536373839404142# æŸ¥çœ‹ pod çš„ ServiceAccount$ k describe pod pi-n65gn | grep &quot;Service Account&quot;Service Account: default# æŒ‡å®š namespace ä¸‹çš„ Pod ä½¿ç”¨è¿™ä¸ªå‡­è¯kubectl patch serviceaccount default -p &#x27;&#123;&quot;imagePullSecrets&quot;: [&#123;&quot;name&quot;: &quot;dockerhub-secret&quot;&#125;]&#125;&#x27; -n &lt;namespace&gt;# æ·»åŠ å¤šä¸ªå‡­è¯ï¼Œè¿™ä¼šè¦†ç›–ä¹‹å‰çš„è®¾ç½®ï¼Œå¤šä¸ª secret æŒ‰é¡ºåºç”Ÿæ•ˆï¼Œk8s ä¼šé€ä¸ªå°è¯•å»æ‹‰å–é•œåƒkubectl patch serviceaccount default -p &#x27;&#123;&quot;imagePullSecrets&quot;: [&#123;&quot;name&quot;: &quot;dockerhub-secret&quot;&#125;, &#123;&quot;name&quot;: &quot;harbor-secret&quot;&#125;, &#123;&quot;name&quot;: &quot;aliyun-secret&quot;&#125;]&#125;&#x27; -n &lt;namespace&gt;# è¿½åŠ ä¸€ä¸ªå‡­è¯ï¼Œä¸ä¼šè¦†ç›–åŸæœ‰çš„è®¾ç½®kubectl patch serviceaccount default --type=&#x27;json&#x27; -p=&#x27;[&#123;&quot;op&quot;: &quot;add&quot;, &quot;path&quot;: &quot;/imagePullSecrets/-&quot;, &quot;value&quot;: &#123;&quot;name&quot;: &quot;new-secret&quot;&#125;&#125;]&#x27; -n &lt;namespace&gt;# æŸ¥çœ‹å½“å‰ imagePullSecrets çš„ç´¢å¼•ï¼Œä»¥ä¸‹å‘½ä»¤ä¼šè¾“å‡ºå‡­è¯çš„åç§°ï¼Œç´¢å¼•ä» 0 å¼€å§‹kubectl get sa default -o jsonpath=&#x27;&#123;.imagePullSecrets[*].name&#125;&#x27; -n &lt;namespace&gt;# åˆ é™¤ä¸€ä¸ªå‡­è¯: åˆ é™¤ index ä¸º 1 çš„å‡­è¯kubectl patch serviceaccount default --type=json -p=&#x27;[&#123;&quot;op&quot;: &quot;remove&quot;, &quot;path&quot;: &quot;/imagePullSecrets/1&quot;&#125;]&#x27; -n &lt;namespace&gt;# æ¸…ç©ºæ‰€æœ‰å‡­è¯kubectl patch sa default -p &#x27;&#123;&quot;imagePullSecrets&quot;: []&#125;&#x27; -n &lt;namespace&gt;# ä¸ºæ‰€æœ‰ namespace ä¸‹çš„ Pod æ·»åŠ å‡­è¯for ns in $(kubectl get ns -o jsonpath=&#x27;&#123;.items[*].metadata.name&#125;&#x27;); do kubectl patch serviceaccount default -n $ns \\ --type=merge \\ -p &#x27;&#123;&quot;imagePullSecrets&quot;: [&#123;&quot;name&quot;: &quot;dockerhub-secret&quot;&#125;]&#125;&#x27;done# æŸ¥çœ‹ ServiceAccount$ kubectl get serviceaccount default -o yaml -n &lt;namespace&gt;apiVersion: v1imagePullSecrets:- name: dockerhub-secretkind: ServiceAccountmetadata: creationTimestamp: &quot;2025-06-29T14:41:35Z&quot; name: default namespace: default resourceVersion: &quot;361001&quot; uid: cb3a0f99-5804-4f21-816a-70533cc3d29d æé«˜ä¸‹è½½é¢‘ç‡çš„å…¶ä»–å»ºè®® 1.ä½¿ç”¨é•œåƒç¼“å­˜: è®¾ç½®é›†ç¾¤å†…é•œåƒç¼“å­˜ï¼ˆå¦‚ Harbor, Nexus Registryï¼‰ 123# ä¿®æ”¹é›†ç¾¤çš„é•œåƒä»“åº“é…ç½®ï¼ˆvimï¼‰kubectl edit configmap -n kube-system# æ‰¾åˆ° imageRepository: æ›¿æ¢ä¸ºä½ çš„ä»“åº“åœ°å€ ä½¿ç”¨ Docker Hub é•œåƒåŠ é€Ÿå™¨ï¼ˆå¦‚æœåœ¨ä¸­å›½å¤§é™†ï¼‰ å¦‚æœ k8s ä½¿ç”¨çš„æ˜¯ dockerï¼Œåˆ™åœ¨/etc/docker/daemon.jsonæ·»åŠ é•œåƒåŠ é€Ÿå™¨é…ç½® 123456789101112sudo mkdir -p /etc/dockersudo tee /etc/docker/daemon.json &lt;&lt;-&#x27;EOF&#x27;&#123; &quot;registry-mirrors&quot;: [ &quot;https://docker.1ms.run&quot;, &quot;https://docker.xuanyuan.me&quot;, &quot;https://docker.m.daocloud.io&quot; ]&#125;EOFsudo systemctl daemon-reloadsudo systemctl restart docker å¦‚æœ k8s ä½¿ç”¨çš„æ˜¯ containerdï¼Œåˆ™åœ¨/etc/containerd/config.tomlæ·»åŠ é•œåƒåŠ é€Ÿå™¨é…ç½® 123456789sudo vi /etc/containerd/config.toml# æ‰¾åˆ° registry.mirrors å­—æ®µï¼Œæ·»åŠ åŠ é€Ÿå™¨ï¼Œæ¯”å¦‚ï¼š[plugins.&quot;io.containerd.grpc.v1.cri&quot;.registry.mirrors] [plugins.&quot;io.containerd.grpc.v1.cri&quot;.registry.mirrors.&quot;docker.io&quot;] endpoint = [&quot;https://docker.1ms.run&quot;, &quot;https://docker.xuanyuan.me&quot;, &quot;https://docker.m.daocloud.io&quot;]# ä¿®æ”¹åé‡å¯ containerdsudo systemctl restart containerd 2.å‡çº§ Docker Hub è®¢é˜…: å…è´¹è´¦æˆ·ï¼š200 pulls/6å°æ—¶ï¼ˆåŒ¿åç”¨æˆ·100 pulls/6å°æ—¶ï¼‰ Pro/Team è´¦æˆ·ï¼šæ— é™åˆ¶æ‹‰å– 3.ä½¿ç”¨å¤šä¸ªè´¦æˆ·: ä¸ºä¸åŒèŠ‚ç‚¹é…ç½®ä¸åŒçš„ Docker Hub å‡­è¯ 4.å‡å°‘ä¸å¿…è¦çš„æ‹‰å–: ä½¿ç”¨ imagePullPolicy: IfNotPresent å°½é‡ä½¿ç”¨å›ºå®šç‰ˆæœ¬æ ‡ç­¾è€Œé latest","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» K8S é•œåƒæ‹‰å– çš„ toomanyrequests çš„è§£å†³æ–¹æ³• ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚ K8Så®˜ç½‘ k8s Github","date_published":"2025-07-16T15:30:05.000Z","tags":["æŠ€æœ¯","k8s","K8S"]},{"id":"https://blog.hanqunfeng.com/2025/07/16/k8s-job-cornjob/","url":"https://blog.hanqunfeng.com/2025/07/16/k8s-job-cornjob/","title":"K8S ä¹‹ Job/CronJob","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç» K8S çš„ Job/CronJob ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://kubernetes.io/zh-cn/\">K8Så®˜ç½‘</a></p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://github.com/kubernetes/kubernetes\">k8s Github</a></p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://kubernetes.io/zh-cn/docs/concepts/workloads/controllers/job/\">k8s Job ä»‹ç»</a></p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://kubernetes.io/zh-cn/docs/concepts/workloads/controllers/cron-jobs/\">k8s CronJob ä»‹ç»</a></p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"Job-ä»‹ç»\">Job ä»‹ç»</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Job è¡¨ç¤ºä¸€æ¬¡æ€§ä»»åŠ¡ï¼Œè¿è¡Œå®Œæˆåå°±ä¼šåœæ­¢ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>Job ä¼šåˆ›å»ºä¸€ä¸ªæˆ–è€…å¤šä¸ª Podï¼Œå¹¶å°†ç»§ç»­é‡è¯• Pod çš„æ‰§è¡Œï¼Œç›´åˆ°æŒ‡å®šæ•°é‡çš„ Pod æˆåŠŸç»ˆæ­¢ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>éšç€ Pod æˆåŠŸç»“æŸï¼ŒJob è·Ÿè¸ªè®°å½•æˆåŠŸå®Œæˆçš„ Pod ä¸ªæ•°ã€‚ å½“æ•°é‡è¾¾åˆ°æŒ‡å®šçš„æˆåŠŸä¸ªæ•°é˜ˆå€¼æ—¶ï¼Œä»»åŠ¡ï¼ˆå³ Jobï¼‰ç»“æŸã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>åˆ é™¤ Job çš„æ“ä½œä¼šæ¸…é™¤æ‰€åˆ›å»ºçš„å…¨éƒ¨ Podã€‚ æŒ‚èµ· Job çš„æ“ä½œä¼šåˆ é™¤ Job çš„æ‰€æœ‰æ´»è·ƒ Podï¼Œç›´åˆ° Job è¢«å†æ¬¡æ¢å¤æ‰§è¡Œã€‚</p>\n</li>\n</ul>\n<h3 id=\"Job-åˆ›å»º\">Job åˆ›å»º</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>yaml æ–‡ä»¶: job.yaml</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">batch/v1</span>                      <span class=\"comment\"># API ç‰ˆæœ¬ï¼Œè¿™é‡Œä½¿ç”¨ batch/v1ï¼Œé€‚ç”¨äº Job èµ„æº</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Job</span>                                 <span class=\"comment\"># èµ„æºç±»å‹ï¼ŒJob ç”¨äºä¸€æ¬¡æ€§ä»»åŠ¡ï¼Œå®Œæˆåè‡ªåŠ¨é€€å‡º</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">pi</span>                                <span class=\"comment\"># Job çš„åç§°ï¼Œè¿™é‡Œå‘½åä¸º pi</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">ttlSecondsAfterFinished:</span> <span class=\"number\">100</span>            <span class=\"comment\"># Job å®Œæˆåï¼Œè‡ªåŠ¨åˆ é™¤jobçš„å»¶è¿Ÿæ—¶é—´ï¼Œå•ä½ä¸ºç§’ã€‚é»˜è®¤ä¸åˆ é™¤</span></span><br><span class=\"line\">  <span class=\"attr\">parallelism:</span> <span class=\"number\">1</span>                          <span class=\"comment\"># Job çš„å¹¶å‘æ•°ï¼Œé»˜è®¤ä¸º1ï¼Œå³ä¸€æ¬¡åªèƒ½å¯åŠ¨ä¸€ä¸ª Pod</span></span><br><span class=\"line\">  <span class=\"attr\">template:</span>                               <span class=\"comment\"># Pod æ¨¡æ¿ï¼Œå®šä¹‰ Job åˆ›å»ºçš„ Pod çš„è§„èŒƒ</span></span><br><span class=\"line\">    <span class=\"attr\">spec:</span></span><br><span class=\"line\">      <span class=\"attr\">containers:</span>                         <span class=\"comment\"># Pod å†…çš„å®¹å™¨åˆ—è¡¨</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">pi</span>                          <span class=\"comment\"># å®¹å™¨åç§°ï¼Œç”¨æˆ·è‡ªå®šä¹‰çš„åå­—</span></span><br><span class=\"line\">        <span class=\"attr\">image:</span> <span class=\"string\">perl:5.34.0</span>                <span class=\"comment\"># ä½¿ç”¨çš„é•œåƒï¼Œè¿™é‡Œæ˜¯ Perl 5.34.0 å®˜æ–¹é•œåƒ</span></span><br><span class=\"line\">        <span class=\"attr\">command:</span> [<span class=\"string\">&quot;perl&quot;</span>,  <span class=\"string\">&quot;-Mbignum=bpi&quot;</span>, <span class=\"string\">&quot;-wle&quot;</span>, <span class=\"string\">&quot;print bpi(2000)&quot;</span>]  <span class=\"comment\"># å®¹å™¨å¯åŠ¨æ—¶æ‰§è¡Œçš„å‘½ä»¤ï¼Œè®¡ç®—å¹¶è¾“å‡ºåœ†å‘¨ç‡çš„ 2000 ä½å°æ•°</span></span><br><span class=\"line\">      <span class=\"attr\">restartPolicy:</span> <span class=\"string\">Never</span>                <span class=\"comment\"># é‡å¯ç­–ç•¥ï¼Œè®¾ç½®ä¸º Neverï¼Œè¡¨ç¤º Pod å¤±è´¥æ—¶ä¸ä¼šè‡ªåŠ¨é‡å¯</span></span><br><span class=\"line\">  <span class=\"attr\">backoffLimit:</span> <span class=\"number\">4</span>                         <span class=\"comment\"># Job é‡è¯•æ¬¡æ•°ä¸Šé™ï¼Œè‹¥å¤±è´¥è¶…è¿‡ 4 æ¬¡ï¼Œåˆ™ä¸å†é‡è¯•ï¼ŒJob çŠ¶æ€å°†æ ‡è®°ä¸º Failedã€‚é»˜è®¤ä¸º 6</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¯åŠ¨Job</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl apply -f job.yaml</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æŸ¥çœ‹ Job</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹ Job</span></span><br><span class=\"line\">kubectl get <span class=\"built_in\">jobs</span></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹æ—¥å¿—ï¼Œæ­¤æ—¶ä¼šçœ‹åˆ°è¾“å‡º åœ†å‘¨ç‡å€¼</span></span><br><span class=\"line\">kubectl logs <span class=\"built_in\">jobs</span>/pi</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ é™¤ Job</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl delete <span class=\"built_in\">jobs</span>/pi</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># yaml åˆ é™¤</span></span><br><span class=\"line\">kubectl delete -f job.yaml</span><br></pre></td></tr></table></figure>\n<h2 id=\"CronJob-ä»‹ç»\">CronJob ä»‹ç»</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>CronJob(ç¼©å†™ä¸º cj) é€šè¿‡é‡å¤è°ƒåº¦å¯åŠ¨ä¸€æ¬¡æ€§çš„ Jobã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>CronJob ç”¨äºæ‰§è¡Œæ’æœŸæ“ä½œï¼Œä¾‹å¦‚å¤‡ä»½ã€ç”ŸæˆæŠ¥å‘Šç­‰ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä¸€ä¸ª CronJob å¯¹è±¡å°±åƒ Unix ç³»ç»Ÿä¸Šçš„ crontabï¼ˆcron tableï¼‰æ–‡ä»¶ä¸­çš„ä¸€è¡Œã€‚ å®ƒç”¨ Cron æ ¼å¼è¿›è¡Œç¼–å†™ï¼Œ å¹¶å‘¨æœŸæ€§åœ°åœ¨ç»™å®šçš„è°ƒåº¦æ—¶é—´æ‰§è¡Œ Jobã€‚</p>\n</li>\n</ul>\n<h3 id=\"CronJob-ç¤ºä¾‹ï¼š\">CronJob ç¤ºä¾‹ï¼š</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">apiVersion: batch/v1</span><br><span class=\"line\">kind: CronJob                               <span class=\"comment\"># åˆ›å»ºCronJob</span></span><br><span class=\"line\">metadata:</span><br><span class=\"line\">  name: hello</span><br><span class=\"line\">spec:</span><br><span class=\"line\">  schedule: <span class=\"string\">&quot;* * * * *&quot;</span>                     <span class=\"comment\"># æ¯åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡ï¼Œä¸æ”¯æŒæ—¶åŒºè®¾ç½®</span></span><br><span class=\"line\">  successfulJobsHistoryLimit: 3             <span class=\"comment\"># æŒ‡å®šè¦ä¿ç•™å¤šå°‘æˆåŠŸå®Œæˆçš„ Jobã€‚é»˜è®¤å€¼ä¸º 3</span></span><br><span class=\"line\">  failedJobsHistoryLimit: 1                 <span class=\"comment\"># æŒ‡å®šè¦ä¿ç•™å¤šå°‘å¤±è´¥å®Œæˆçš„ Jobã€‚é»˜è®¤å€¼ä¸º 1</span></span><br><span class=\"line\">  concurrencyPolicy: Allow                  <span class=\"comment\"># é»˜è®¤å€¼ä¸º Allowï¼šå…è®¸å¤šä¸ª Job åŒæ—¶è¿è¡Œ</span></span><br><span class=\"line\">                                            <span class=\"comment\"># Forbidï¼šä¸å…è®¸å¤šä¸ª Job åŒæ—¶è¿è¡Œã€‚å¦‚æœæ–° Job çš„æ‰§è¡Œæ—¶é—´åˆ°äº†è€Œè€ Job æ²¡æœ‰æ‰§è¡Œå®Œï¼ŒCronJob ä¼šå¿½ç•¥æ–° Job çš„æ‰§è¡Œã€‚ å¦è¯·æ³¨æ„ï¼Œå½“è€ Job æ‰§è¡Œå®Œæˆæ—¶ï¼Œä»ç„¶ä¼šè€ƒè™‘ .spec.startingDeadlineSecondsï¼Œå¯èƒ½ä¼šå¯¼è‡´æ–°çš„ Job æ‰§è¡Œã€‚</span></span><br><span class=\"line\">                                            <span class=\"comment\"># Replaceï¼šå¦‚æœæ–° Job çš„æ‰§è¡Œæ—¶é—´åˆ°äº†è€Œè€ Job æ²¡æœ‰æ‰§è¡Œå®Œï¼ŒCronJob ä¼šç”¨æ–° Job æ›¿æ¢å½“å‰æ­£åœ¨è¿è¡Œçš„ Jobã€‚</span></span><br><span class=\"line\">  jobTemplate:</span><br><span class=\"line\">    spec:</span><br><span class=\"line\">      template:</span><br><span class=\"line\">        spec:</span><br><span class=\"line\">          containers:</span><br><span class=\"line\">          - name: hello</span><br><span class=\"line\">            image: busybox:1.28</span><br><span class=\"line\">            imagePullPolicy: IfNotPresent</span><br><span class=\"line\">            <span class=\"built_in\">command</span>:</span><br><span class=\"line\">            - /bin/sh</span><br><span class=\"line\">            - -c</span><br><span class=\"line\">            - <span class=\"built_in\">date</span>; <span class=\"built_in\">echo</span> Hello from the Kubernetes cluster</span><br><span class=\"line\">          restartPolicy: OnFailure</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><code>.spec.schedule</code> å­—æ®µæ˜¯å¿…éœ€çš„ã€‚è¯¥å­—æ®µçš„å€¼éµå¾ª Cron è¯­æ³•ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ åˆ†é’Ÿ (0 - 59)</span></span><br><span class=\"line\"><span class=\"comment\"># â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ å°æ—¶ (0 - 23)</span></span><br><span class=\"line\"><span class=\"comment\"># â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ æœˆçš„æŸå¤© (1 - 31)</span></span><br><span class=\"line\"><span class=\"comment\"># â”‚ â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ æœˆä»½ (1 - 12)</span></span><br><span class=\"line\"><span class=\"comment\"># â”‚ â”‚ â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ å‘¨çš„æŸå¤© (0 - 6)ï¼ˆå‘¨æ—¥åˆ°å‘¨å…­ï¼‰</span></span><br><span class=\"line\"><span class=\"comment\"># â”‚ â”‚ â”‚ â”‚ â”‚                          æˆ–è€…æ˜¯ sunï¼Œmonï¼Œtueï¼Œwebï¼Œthuï¼Œfriï¼Œsat</span></span><br><span class=\"line\"><span class=\"comment\"># â”‚ â”‚ â”‚ â”‚ â”‚</span></span><br><span class=\"line\"><span class=\"comment\"># â”‚ â”‚ â”‚ â”‚ â”‚</span></span><br><span class=\"line\"><span class=\"comment\"># * * * * *</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ—¶é—´è¡¨ä¸­çš„é—®å· (?) å’Œæ˜Ÿå· * å«ä¹‰ç›¸åŒï¼Œå®ƒä»¬ç”¨æ¥è¡¨ç¤ºç»™å®šå­—æ®µçš„ä»»ä½•å¯ç”¨å€¼ã€‚</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>é™¤äº†æ ‡å‡†è¯­æ³•ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ä¸€äº›ç±»ä¼¼ @monthly çš„å®</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th><strong>è¾“å…¥</strong></th>\n<th><strong>æè¿°</strong></th>\n<th><strong>ç­‰ä»· Cron è¡¨è¾¾å¼</strong></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>@yearly</code> æˆ– <code>@annually</code></td>\n<td>æ¯å¹´ 1 æœˆ 1 æ—¥çš„åˆå¤œè¿è¡Œä¸€æ¬¡</td>\n<td><code>0 0 1 1 *</code></td>\n</tr>\n<tr>\n<td><code>@monthly</code></td>\n<td>æ¯æœˆç¬¬ä¸€å¤©çš„åˆå¤œè¿è¡Œä¸€æ¬¡</td>\n<td><code>0 0 1 * *</code></td>\n</tr>\n<tr>\n<td><code>@weekly</code></td>\n<td>æ¯å‘¨çš„å‘¨æ—¥åˆå¤œè¿è¡Œä¸€æ¬¡</td>\n<td><code>0 0 * * 0</code></td>\n</tr>\n<tr>\n<td><code>@daily</code> æˆ– <code>@midnight</code></td>\n<td>æ¯å¤©åˆå¤œè¿è¡Œä¸€æ¬¡</td>\n<td><code>0 0 * * *</code></td>\n</tr>\n<tr>\n<td><code>@hourly</code></td>\n<td>æ¯å°æ—¶çš„å¼€å§‹è¿è¡Œä¸€æ¬¡</td>\n<td><code>0 * * * *</code></td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç®¡ç†cronjob</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åˆ›å»ºcronjob</span></span><br><span class=\"line\">kubectl create -f cronjob.yaml</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹cronjob</span></span><br><span class=\"line\">kubectl get cronjob hello -o yaml</span><br><span class=\"line\"><span class=\"comment\"># åˆ é™¤cronjob</span></span><br><span class=\"line\">kubectl delete cronjob hello</span><br><span class=\"line\">k delete -f cronjob.yaml</span><br></pre></td></tr></table></figure>\n<h2 id=\"ä»¥ä¸‹æ˜¯-Kubernetes-ä¸­-Job-å’Œ-CronJob-çš„å¯¹æ¯”è¡¨\">ä»¥ä¸‹æ˜¯ Kubernetes ä¸­ Job å’Œ CronJob çš„å¯¹æ¯”è¡¨</h2>\n<table>\n<thead>\n<tr>\n<th>ç‰¹æ€§</th>\n<th>Job</th>\n<th>CronJob</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>ç”¨é€”</strong></td>\n<td>ä¸€æ¬¡æ€§ä»»åŠ¡ï¼Œå®Œæˆå³ç»“æŸ</td>\n<td>å®šæ—¶å‘¨æœŸæ€§ä»»åŠ¡ï¼ŒæŒ‰ç…§æ—¶é—´è®¡åˆ’å®šæ—¶è¿è¡Œ</td>\n</tr>\n<tr>\n<td><strong>è°ƒåº¦æ–¹å¼</strong></td>\n<td>æ‰‹åŠ¨åˆ›å»ºæˆ–ç”±æ§åˆ¶å™¨è§¦å‘</td>\n<td>æŒ‰ç…§ Cron è¡¨è¾¾å¼è‡ªåŠ¨å‘¨æœŸæ€§è°ƒåº¦</td>\n</tr>\n<tr>\n<td><strong>å¸¸ç”¨åœºæ™¯</strong></td>\n<td>æ•°æ®æ‰¹å¤„ç†ã€æ•°æ®åº“è¿ç§»ã€ä¸€æ¬¡æ€§ä»»åŠ¡</td>\n<td>æ¯å¤©å¤‡ä»½ã€å®šæ—¶æŠ¥å‘Šç”Ÿæˆã€å‘¨æœŸæ€§æ£€æŸ¥</td>\n</tr>\n<tr>\n<td><strong>é…ç½®å…³é”®å­—æ®µ</strong></td>\n<td><code>spec.template</code></td>\n<td><code>spec.schedule</code>ï¼ˆCron è¡¨è¾¾å¼ï¼‰ + <code>spec.jobTemplate</code></td>\n</tr>\n<tr>\n<td><strong>å¯åŠ¨é¢‘ç‡</strong></td>\n<td>åˆ›å»ºåç«‹åˆ»å¯åŠ¨ä¸€æ¬¡</td>\n<td>æ ¹æ® <code>schedule</code> å®šæœŸå¯åŠ¨</td>\n</tr>\n<tr>\n<td><strong>å¹¶å‘æ§åˆ¶</strong></td>\n<td>ä¸æ”¯æŒå¹¶å‘ç­–ç•¥</td>\n<td>æ”¯æŒ <code>concurrencyPolicy</code>ï¼ˆAllowã€Forbidã€Replaceï¼‰</td>\n</tr>\n<tr>\n<td><strong>ä¿ç•™å†å²ä»»åŠ¡</strong></td>\n<td>æ— ä¿ç•™ï¼Œä»»åŠ¡å®Œæˆåç›´æ¥ç»ˆç»“</td>\n<td>å¯é…ç½®ä¿ç•™æˆåŠŸæˆ–å¤±è´¥ä»»åŠ¡æ•°ï¼š<code>successfulJobsHistoryLimit</code>ã€<code>failedJobsHistoryLimit</code></td>\n</tr>\n<tr>\n<td><strong>å¤±è´¥é‡è¯•æœºåˆ¶</strong></td>\n<td>æ”¯æŒ <code>backoffLimit</code>ã€<code>restartPolicy</code></td>\n<td>åŒæ ·æ”¯æŒï¼Œä½œç”¨äºæ¯æ¬¡å‘¨æœŸæ€§è¿è¡Œäº§ç”Ÿçš„ Job ä¸Š</td>\n</tr>\n</tbody>\n</table>\n","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» K8S çš„ Job/CronJob ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚ K8Så®˜ç½‘ k8s Github k8s Job ä»‹ç» k8s CronJob ä»‹ç» Job ä»‹ç» Job è¡¨ç¤ºä¸€æ¬¡æ€§ä»»åŠ¡ï¼Œè¿è¡Œå®Œæˆåå°±ä¼šåœæ­¢ã€‚ Job ä¼šåˆ›å»ºä¸€ä¸ªæˆ–è€…å¤šä¸ª Podï¼Œå¹¶å°†ç»§ç»­é‡è¯• Pod çš„æ‰§è¡Œï¼Œç›´åˆ°æŒ‡å®šæ•°é‡çš„ Pod æˆåŠŸç»ˆæ­¢ã€‚ éšç€ Pod æˆåŠŸç»“æŸï¼ŒJob è·Ÿè¸ªè®°å½•æˆåŠŸå®Œæˆçš„ Pod ä¸ªæ•°ã€‚ å½“æ•°é‡è¾¾åˆ°æŒ‡å®šçš„æˆåŠŸä¸ªæ•°é˜ˆå€¼æ—¶ï¼Œä»»åŠ¡ï¼ˆå³ Jobï¼‰ç»“æŸã€‚ åˆ é™¤ Job çš„æ“ä½œä¼šæ¸…é™¤æ‰€åˆ›å»ºçš„å…¨éƒ¨ Podã€‚ æŒ‚èµ· Job çš„æ“ä½œä¼šåˆ é™¤ Job çš„æ‰€æœ‰æ´»è·ƒ Podï¼Œç›´åˆ° Job è¢«å†æ¬¡æ¢å¤æ‰§è¡Œã€‚ Job åˆ›å»º yaml æ–‡ä»¶: job.yaml 123456789101112131415apiVersion: batch/v1 # API ç‰ˆæœ¬ï¼Œè¿™é‡Œä½¿ç”¨ batch/v1ï¼Œé€‚ç”¨äº Job èµ„æºkind: Job # èµ„æºç±»å‹ï¼ŒJob ç”¨äºä¸€æ¬¡æ€§ä»»åŠ¡ï¼Œå®Œæˆåè‡ªåŠ¨é€€å‡ºmetadata: name: pi # Job çš„åç§°ï¼Œè¿™é‡Œå‘½åä¸º pispec: ttlSecondsAfterFinished: 100 # Job å®Œæˆåï¼Œè‡ªåŠ¨åˆ é™¤jobçš„å»¶è¿Ÿæ—¶é—´ï¼Œå•ä½ä¸ºç§’ã€‚é»˜è®¤ä¸åˆ é™¤ parallelism: 1 # Job çš„å¹¶å‘æ•°ï¼Œé»˜è®¤ä¸º1ï¼Œå³ä¸€æ¬¡åªèƒ½å¯åŠ¨ä¸€ä¸ª Pod template: # Pod æ¨¡æ¿ï¼Œå®šä¹‰ Job åˆ›å»ºçš„ Pod çš„è§„èŒƒ spec: containers: # Pod å†…çš„å®¹å™¨åˆ—è¡¨ - name: pi # å®¹å™¨åç§°ï¼Œç”¨æˆ·è‡ªå®šä¹‰çš„åå­— image: perl:5.34.0 # ä½¿ç”¨çš„é•œåƒï¼Œè¿™é‡Œæ˜¯ Perl 5.34.0 å®˜æ–¹é•œåƒ command: [&quot;perl&quot;, &quot;-Mbignum=bpi&quot;, &quot;-wle&quot;, &quot;print bpi(2000)&quot;] # å®¹å™¨å¯åŠ¨æ—¶æ‰§è¡Œçš„å‘½ä»¤ï¼Œè®¡ç®—å¹¶è¾“å‡ºåœ†å‘¨ç‡çš„ 2000 ä½å°æ•° restartPolicy: Never # é‡å¯ç­–ç•¥ï¼Œè®¾ç½®ä¸º Neverï¼Œè¡¨ç¤º Pod å¤±è´¥æ—¶ä¸ä¼šè‡ªåŠ¨é‡å¯ backoffLimit: 4 # Job é‡è¯•æ¬¡æ•°ä¸Šé™ï¼Œè‹¥å¤±è´¥è¶…è¿‡ 4 æ¬¡ï¼Œåˆ™ä¸å†é‡è¯•ï¼ŒJob çŠ¶æ€å°†æ ‡è®°ä¸º Failedã€‚é»˜è®¤ä¸º 6 å¯åŠ¨Job 1kubectl apply -f job.yaml æŸ¥çœ‹ Job 1234# æŸ¥çœ‹ Jobkubectl get jobs# æŸ¥çœ‹æ—¥å¿—ï¼Œæ­¤æ—¶ä¼šçœ‹åˆ°è¾“å‡º åœ†å‘¨ç‡å€¼kubectl logs jobs/pi åˆ é™¤ Job 1234kubectl delete jobs/pi# yaml åˆ é™¤kubectl delete -f job.yaml CronJob ä»‹ç» CronJob(ç¼©å†™ä¸º cj) é€šè¿‡é‡å¤è°ƒåº¦å¯åŠ¨ä¸€æ¬¡æ€§çš„ Jobã€‚ CronJob ç”¨äºæ‰§è¡Œæ’æœŸæ“ä½œï¼Œä¾‹å¦‚å¤‡ä»½ã€ç”ŸæˆæŠ¥å‘Šç­‰ã€‚ ä¸€ä¸ª CronJob å¯¹è±¡å°±åƒ Unix ç³»ç»Ÿä¸Šçš„ crontabï¼ˆcron tableï¼‰æ–‡ä»¶ä¸­çš„ä¸€è¡Œã€‚ å®ƒç”¨ Cron æ ¼å¼è¿›è¡Œç¼–å†™ï¼Œ å¹¶å‘¨æœŸæ€§åœ°åœ¨ç»™å®šçš„è°ƒåº¦æ—¶é—´æ‰§è¡Œ Jobã€‚ CronJob ç¤ºä¾‹ï¼š 123456789101112131415161718192021222324apiVersion: batch/v1kind: CronJob # åˆ›å»ºCronJobmetadata: name: hellospec: schedule: &quot;* * * * *&quot; # æ¯åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡ï¼Œä¸æ”¯æŒæ—¶åŒºè®¾ç½® successfulJobsHistoryLimit: 3 # æŒ‡å®šè¦ä¿ç•™å¤šå°‘æˆåŠŸå®Œæˆçš„ Jobã€‚é»˜è®¤å€¼ä¸º 3 failedJobsHistoryLimit: 1 # æŒ‡å®šè¦ä¿ç•™å¤šå°‘å¤±è´¥å®Œæˆçš„ Jobã€‚é»˜è®¤å€¼ä¸º 1 concurrencyPolicy: Allow # é»˜è®¤å€¼ä¸º Allowï¼šå…è®¸å¤šä¸ª Job åŒæ—¶è¿è¡Œ # Forbidï¼šä¸å…è®¸å¤šä¸ª Job åŒæ—¶è¿è¡Œã€‚å¦‚æœæ–° Job çš„æ‰§è¡Œæ—¶é—´åˆ°äº†è€Œè€ Job æ²¡æœ‰æ‰§è¡Œå®Œï¼ŒCronJob ä¼šå¿½ç•¥æ–° Job çš„æ‰§è¡Œã€‚ å¦è¯·æ³¨æ„ï¼Œå½“è€ Job æ‰§è¡Œå®Œæˆæ—¶ï¼Œä»ç„¶ä¼šè€ƒè™‘ .spec.startingDeadlineSecondsï¼Œå¯èƒ½ä¼šå¯¼è‡´æ–°çš„ Job æ‰§è¡Œã€‚ # Replaceï¼šå¦‚æœæ–° Job çš„æ‰§è¡Œæ—¶é—´åˆ°äº†è€Œè€ Job æ²¡æœ‰æ‰§è¡Œå®Œï¼ŒCronJob ä¼šç”¨æ–° Job æ›¿æ¢å½“å‰æ­£åœ¨è¿è¡Œçš„ Jobã€‚ jobTemplate: spec: template: spec: containers: - name: hello image: busybox:1.28 imagePullPolicy: IfNotPresent command: - /bin/sh - -c - date; echo Hello from the Kubernetes cluster restartPolicy: OnFailure .spec.schedule å­—æ®µæ˜¯å¿…éœ€çš„ã€‚è¯¥å­—æ®µçš„å€¼éµå¾ª Cron è¯­æ³•ï¼š 1234567891011# â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ åˆ†é’Ÿ (0 - 59)# â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ å°æ—¶ (0 - 23)# â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ æœˆçš„æŸå¤© (1 - 31)# â”‚ â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ æœˆä»½ (1 - 12)# â”‚ â”‚ â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ å‘¨çš„æŸå¤© (0 - 6)ï¼ˆå‘¨æ—¥åˆ°å‘¨å…­ï¼‰# â”‚ â”‚ â”‚ â”‚ â”‚ æˆ–è€…æ˜¯ sunï¼Œmonï¼Œtueï¼Œwebï¼Œthuï¼Œfriï¼Œsat# â”‚ â”‚ â”‚ â”‚ â”‚# â”‚ â”‚ â”‚ â”‚ â”‚# * * * * *# æ—¶é—´è¡¨ä¸­çš„é—®å· (?) å’Œæ˜Ÿå· * å«ä¹‰ç›¸åŒï¼Œå®ƒä»¬ç”¨æ¥è¡¨ç¤ºç»™å®šå­—æ®µçš„ä»»ä½•å¯ç”¨å€¼ã€‚ é™¤äº†æ ‡å‡†è¯­æ³•ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ä¸€äº›ç±»ä¼¼ @monthly çš„å® è¾“å…¥ æè¿° ç­‰ä»· Cron è¡¨è¾¾å¼ @yearly æˆ– @annually æ¯å¹´ 1 æœˆ 1 æ—¥çš„åˆå¤œè¿è¡Œä¸€æ¬¡ 0 0 1 1 * @monthly æ¯æœˆç¬¬ä¸€å¤©çš„åˆå¤œè¿è¡Œä¸€æ¬¡ 0 0 1 * * @weekly æ¯å‘¨çš„å‘¨æ—¥åˆå¤œè¿è¡Œä¸€æ¬¡ 0 0 * * 0 @daily æˆ– @midnight æ¯å¤©åˆå¤œè¿è¡Œä¸€æ¬¡ 0 0 * * * @hourly æ¯å°æ—¶çš„å¼€å§‹è¿è¡Œä¸€æ¬¡ 0 * * * * ç®¡ç†cronjob 1234567# åˆ›å»ºcronjobkubectl create -f cronjob.yaml# æŸ¥çœ‹cronjobkubectl get cronjob hello -o yaml# åˆ é™¤cronjobkubectl delete cronjob hellok delete -f cronjob.yaml ä»¥ä¸‹æ˜¯ Kubernetes ä¸­ Job å’Œ CronJob çš„å¯¹æ¯”è¡¨ ç‰¹æ€§ Job CronJob ç”¨é€” ä¸€æ¬¡æ€§ä»»åŠ¡ï¼Œå®Œæˆå³ç»“æŸ å®šæ—¶å‘¨æœŸæ€§ä»»åŠ¡ï¼ŒæŒ‰ç…§æ—¶é—´è®¡åˆ’å®šæ—¶è¿è¡Œ è°ƒåº¦æ–¹å¼ æ‰‹åŠ¨åˆ›å»ºæˆ–ç”±æ§åˆ¶å™¨è§¦å‘ æŒ‰ç…§ Cron è¡¨è¾¾å¼è‡ªåŠ¨å‘¨æœŸæ€§è°ƒåº¦ å¸¸ç”¨åœºæ™¯ æ•°æ®æ‰¹å¤„ç†ã€æ•°æ®åº“è¿ç§»ã€ä¸€æ¬¡æ€§ä»»åŠ¡ æ¯å¤©å¤‡ä»½ã€å®šæ—¶æŠ¥å‘Šç”Ÿæˆã€å‘¨æœŸæ€§æ£€æŸ¥ é…ç½®å…³é”®å­—æ®µ spec.template spec.scheduleï¼ˆCron è¡¨è¾¾å¼ï¼‰ + spec.jobTemplate å¯åŠ¨é¢‘ç‡ åˆ›å»ºåç«‹åˆ»å¯åŠ¨ä¸€æ¬¡ æ ¹æ® schedule å®šæœŸå¯åŠ¨ å¹¶å‘æ§åˆ¶ ä¸æ”¯æŒå¹¶å‘ç­–ç•¥ æ”¯æŒ concurrencyPolicyï¼ˆAllowã€Forbidã€Replaceï¼‰ ä¿ç•™å†å²ä»»åŠ¡ æ— ä¿ç•™ï¼Œä»»åŠ¡å®Œæˆåç›´æ¥ç»ˆç»“ å¯é…ç½®ä¿ç•™æˆåŠŸæˆ–å¤±è´¥ä»»åŠ¡æ•°ï¼šsuccessfulJobsHistoryLimitã€failedJobsHistoryLimit å¤±è´¥é‡è¯•æœºåˆ¶ æ”¯æŒ backoffLimitã€restartPolicy åŒæ ·æ”¯æŒï¼Œä½œç”¨äºæ¯æ¬¡å‘¨æœŸæ€§è¿è¡Œäº§ç”Ÿçš„ Job ä¸Š","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» K8S çš„ Job/CronJob ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚ K8Så®˜ç½‘ k8s Github k8s Job ä»‹ç» k8s CronJob ä»‹ç»","date_published":"2025-07-16T14:30:05.000Z","tags":["æŠ€æœ¯","k8s","K8S"]},{"id":"https://blog.hanqunfeng.com/2025/07/15/k8s-daemonset/","url":"https://blog.hanqunfeng.com/2025/07/15/k8s-daemonset/","title":"K8S ä¹‹ DaemonSet","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç» K8S çš„ DaemonSet ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://kubernetes.io/zh-cn/\">K8Så®˜ç½‘</a></p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://github.com/kubernetes/kubernetes\">k8s Github</a></p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://kubernetes.io/zh-cn/docs/concepts/workloads/controllers/daemonset/\">k8s DaemonSet ä»‹ç»</a></p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"DaemonSet-ä»‹ç»\">DaemonSet ä»‹ç»</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>DaemonSet(ç¼©å†™ä¸º ds) å®šä¹‰äº†æä¾›èŠ‚ç‚¹æœ¬åœ°è®¾æ–½çš„ Podã€‚è¿™äº›è®¾æ–½å¯èƒ½å¯¹äºé›†ç¾¤çš„è¿è¡Œè‡³å…³é‡è¦ï¼Œä¾‹å¦‚ç½‘ç»œè¾…åŠ©å·¥å…·ï¼Œæˆ–è€…ä½œä¸º add-on çš„ä¸€éƒ¨åˆ†ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>DaemonSet ç¡®ä¿å…¨éƒ¨ï¼ˆæˆ–è€…æŸäº›ï¼‰èŠ‚ç‚¹ä¸Šè¿è¡Œä¸€ä¸ª Pod çš„å‰¯æœ¬ã€‚ å½“æœ‰èŠ‚ç‚¹åŠ å…¥é›†ç¾¤æ—¶ï¼Œ ä¹Ÿä¼šä¸ºä»–ä»¬æ–°å¢ä¸€ä¸ª Pod ã€‚ å½“æœ‰èŠ‚ç‚¹ä»é›†ç¾¤ç§»é™¤æ—¶ï¼Œè¿™äº› Pod ä¹Ÿä¼šè¢«å›æ”¶ã€‚åˆ é™¤ DaemonSet å°†ä¼šåˆ é™¤å®ƒåˆ›å»ºçš„æ‰€æœ‰ Podã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>DaemonSet çš„ä¸€äº›å…¸å‹ç”¨æ³•ï¼š</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">åœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šè¿è¡Œé›†ç¾¤å®ˆæŠ¤è¿›ç¨‹</li>\n<li class=\"lvl-4\">åœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šè¿è¡Œæ—¥å¿—æ”¶é›†å®ˆæŠ¤è¿›ç¨‹</li>\n<li class=\"lvl-4\">åœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šè¿è¡Œç›‘æ§å®ˆæŠ¤è¿›ç¨‹</li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<p>DaemonSet ä¸ Deployment çš„ä¸»è¦åŒºåˆ«æ˜¯ï¼š</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">æ— æ³•è‡ªå®šä¹‰å‰¯æœ¬æ•°é‡</li>\n<li class=\"lvl-4\">æ¯ä¸ªnodeä¸Šéƒ½ä¼šè¿è¡Œä¸”åªå…è®¸è¿è¡Œä¸€ä¸ª Pod</li>\n<li class=\"lvl-4\">å½“æœ‰æ–°NodeåŠ å…¥é›†ç¾¤æ—¶ï¼Œä¼šè‡ªåŠ¨åœ¨å…¶ä¸Šéƒ¨ç½²å¹¶è¿è¡ŒPodå‰¯æœ¬ï¼Œå½“Nodeä»é›†ç¾¤ç§»é™¤æ—¶ï¼Œè¿™äº›Podä¹Ÿä¼šè¢«å›æ”¶</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"DaemonSet-ç®¡ç†\">DaemonSet ç®¡ç†</h2>\n<h3 id=\"DaemonSet-åˆ›å»º\">DaemonSet åˆ›å»º</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>DaemonSet åªèƒ½ é€šè¿‡ <code>yaml</code> åˆ›å»ºï¼Œä¸æ”¯æŒ <code>create</code> åˆ›å»º</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># é€šè¿‡ yaml æ–‡ä»¶åˆ›å»º</span></span><br><span class=\"line\">kubectl apply -f daemonset.yaml</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¸€ä¸ªç®€å•çš„ <code>daemonset.yaml</code> æ–‡ä»¶è¯´æ˜</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">apps/v1</span>                  <span class=\"comment\"># æŒ‡å®šä½¿ç”¨çš„ API ç‰ˆæœ¬ï¼Œè¿™é‡Œæ˜¯ apps/v1ï¼Œé€‚ç”¨äº DaemonSet èµ„æº</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">DaemonSet</span>                     <span class=\"comment\"># Kubernetes èµ„æºç±»å‹ï¼Œè¿™é‡Œæ˜¯éƒ¨ç½²ï¼ˆDaemonSetï¼‰</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">labels:</span></span><br><span class=\"line\">    <span class=\"attr\">app:</span> <span class=\"string\">nginx</span>                       <span class=\"comment\"># æ ‡ç­¾ï¼Œç”¨äºæ ‡è¯†èµ„æºï¼Œå¯ä¸ selector åŒ¹é…</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">nginx</span>                        <span class=\"comment\"># èµ„æºåç§°ï¼Œå¿…é¡»å”¯ä¸€ï¼ˆåœ¨åŒä¸€å‘½åç©ºé—´ä¸‹ï¼‰</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span>                                <span class=\"comment\"># é…ç½®é¡¹</span></span><br><span class=\"line\">  <span class=\"attr\">revisionHistoryLimit:</span> <span class=\"number\">10</span>           <span class=\"comment\"># ä¿ç•™çš„å†å²ç‰ˆæœ¬æ•°ï¼Œé»˜è®¤å€¼ä¸º 10ï¼ŒDeployment å’Œ StatefulSet éƒ½æœ‰è¿™ä¸ªé…ç½®é¡¹ã€‚å›æ»šæ—¶æœ‰ç”¨ã€‚</span></span><br><span class=\"line\">  <span class=\"attr\">selector:</span>                          <span class=\"comment\"># é€‰æ‹©å™¨ï¼ŒæŒ‡å®šè¦ç®¡ç†çš„ Pod</span></span><br><span class=\"line\">    <span class=\"attr\">matchLabels:</span>                     <span class=\"comment\"># æ ‡ç­¾é€‰æ‹©å™¨</span></span><br><span class=\"line\">      <span class=\"attr\">app:</span> <span class=\"string\">nginx</span>                     <span class=\"comment\"># é€‰æ‹©å™¨ï¼ŒæŒ‡å®š DaemonSet ç®¡ç†å“ªäº› Podï¼ˆæ ‡ç­¾å¿…é¡»ä¸ template ä¸­åŒ¹é…ï¼‰</span></span><br><span class=\"line\">  <span class=\"attr\">updateStrategy:</span>                    <span class=\"comment\"># æ›´æ–°ç­–ç•¥ï¼Œè¿™é‡Œè¦æ³¨æ„è¿™ä¸ªæ›´æ–°ç­–ç•¥ä¸Deploymentçš„å±æ€§åå­—ä¸ä¸€æ ·</span></span><br><span class=\"line\">    <span class=\"attr\">type:</span> <span class=\"string\">RollingUpdate</span>              <span class=\"comment\"># 1.RollingUpdateï¼šè¿™æ˜¯é»˜è®¤çš„æ›´æ–°ç­–ç•¥ã€‚ä½¿ç”¨ RollingUpdate æ›´æ–°ç­–ç•¥æ—¶ï¼Œåœ¨æ›´æ–° DaemonSet æ¨¡æ¿åï¼Œ è€çš„ DaemonSet Pod å°†è¢«ç»ˆæ­¢ï¼Œå¹¶ä¸”å°†ä»¥å—æ§æ–¹å¼è‡ªåŠ¨åˆ›å»ºæ–°çš„ DaemonSet Podã€‚ æ›´æ–°æœŸé—´ï¼Œæœ€å¤šåªèƒ½æœ‰ DaemonSet çš„ä¸€ä¸ª Pod è¿è¡Œäºæ¯ä¸ªèŠ‚ç‚¹ä¸Šã€‚</span></span><br><span class=\"line\">                                     <span class=\"comment\"># 2.OnDeleteï¼šä½¿ç”¨ OnDelete æ›´æ–°ç­–ç•¥æ—¶ï¼Œåœ¨æ›´æ–° DaemonSet æ¨¡æ¿åï¼Œåªæœ‰å½“ä½ æ‰‹åŠ¨åˆ é™¤è€çš„ DaemonSet Pod ä¹‹åï¼Œæ–°çš„ DaemonSet Pod æ‰ä¼šè¢«è‡ªåŠ¨åˆ›å»ºã€‚</span></span><br><span class=\"line\">    <span class=\"attr\">rollingUpdate:</span>                   <span class=\"comment\"># æ»šåŠ¨å‡çº§çš„é…ç½®</span></span><br><span class=\"line\">      <span class=\"attr\">maxSurge:</span> <span class=\"number\">0</span>                    <span class=\"comment\"># å¯ä»¥è¶…å‡ºç°æœ‰ DaemonSet Pod çš„æœ€å¤§æ•°æˆ–æœ€å¤§ç™¾åˆ†æ¯”ï¼Œé»˜è®¤æ˜¯ 0ã€‚ä¸ maxUnavailable ä¸èƒ½åŒæ—¶ä¸º 0</span></span><br><span class=\"line\">      <span class=\"attr\">maxUnavailable:</span> <span class=\"number\">1</span>              <span class=\"comment\"># æ›´æ–°æœŸé—´ä¸å¯ç”¨çš„ DaemonSet Pod çš„æœ€å¤§æ•°æˆ–æœ€å¤§ç™¾åˆ†æ¯”ï¼Œé»˜è®¤æ˜¯ 1ã€‚ä¸ maxSurge ä¸èƒ½åŒæ—¶ä¸º 0</span></span><br><span class=\"line\">  <span class=\"attr\">template:</span>                          <span class=\"comment\"># æ¨¡æ¿ï¼Œå®šä¹‰ Pod çš„å†…å®¹ï¼Œå…·ä½“å¯ä»¥å‚è€ƒ Pod çš„é…ç½®</span></span><br><span class=\"line\">    <span class=\"attr\">metadata:</span></span><br><span class=\"line\">      <span class=\"attr\">labels:</span></span><br><span class=\"line\">        <span class=\"attr\">app:</span> <span class=\"string\">nginx</span>                   <span class=\"comment\"># Pod çš„æ ‡ç­¾ï¼Œå¿…é¡»ä¸ selector ä¸­çš„ matchLabels ä¸€è‡´</span></span><br><span class=\"line\">    <span class=\"attr\">spec:</span></span><br><span class=\"line\">      <span class=\"attr\">containers:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">image:</span> <span class=\"string\">nginx</span>                 <span class=\"comment\"># å®¹å™¨ä½¿ç”¨çš„é•œåƒï¼Œè¿™é‡Œæ˜¯å®˜æ–¹çš„ nginx é•œåƒ</span></span><br><span class=\"line\">        <span class=\"attr\">name:</span> <span class=\"string\">nginx</span>                  <span class=\"comment\"># å®¹å™¨çš„åç§°</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"æŸ¥çœ‹-DaemonSet\">æŸ¥çœ‹ DaemonSet</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹ DaemonSet ï¼Œé»˜è®¤æ˜¾ç¤º default å‘½åç©ºé—´ä¸‹çš„ DaemonSet</span></span><br><span class=\"line\">kubectl get daemonsets</span><br><span class=\"line\">kubectl get ds <span class=\"comment\"># ç®€ç§°</span></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹ kube-system å‘½åç©ºé—´ä¸‹çš„ DaemonSet</span></span><br><span class=\"line\">kubectl get ds -n kube-system</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹æ‰€æœ‰å‘½åç©ºé—´ä¸‹çš„ DaemonSet</span></span><br><span class=\"line\">kubectl get ds -A</span><br><span class=\"line\"><span class=\"comment\"># -o wide: æ˜¾ç¤º deploy çš„è¯¦ç»†ä¿¡æ¯</span></span><br><span class=\"line\">kubectl get ds -o wide</span><br><span class=\"line\"><span class=\"comment\"># æ˜¾ç¤º DaemonSet çš„æ ‡ç­¾</span></span><br><span class=\"line\">kubectl get ds --show-labels</span><br><span class=\"line\"><span class=\"comment\"># æŒ‰ DaemonSet çš„æ ‡ç­¾è¿›ç¨‹æŸ¥è¯¢</span></span><br><span class=\"line\">kubectl get ds -l &lt;label_name&gt;=&lt;label_value&gt;</span><br><span class=\"line\"><span class=\"comment\"># æŒç»­æŸ¥çœ‹ DaemonSet çš„çŠ¶æ€ï¼Œå½“ DaemonSet çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶ï¼Œä¼šå®æ—¶æ˜¾ç¤º</span></span><br><span class=\"line\">kubectl get ds -w</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹ podã€ds çš„è¯¦ç»†ä¿¡æ¯</span></span><br><span class=\"line\">$ k get pod,ds -owide</span><br><span class=\"line\">NAME              READY   STATUS    RESTARTS   AGE    IP              NODE          NOMINATED NODE   READINESS GATES</span><br><span class=\"line\">pod/nginx-6g8j8   1/1     Running   0          9m3s   10.244.126.18   k8s-worker2   &lt;none&gt;           &lt;none&gt;</span><br><span class=\"line\">pod/nginx-tnvhn   1/1     Running   0          9m3s   10.244.194.89   k8s-worker1   &lt;none&gt;           &lt;none&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">NAME                   DESIRED   CURRENT   READY   UP-TO-DATE   AVAILABLE   NODE SELECTOR   AGE    CONTAINERS   IMAGES   SELECTOR</span><br><span class=\"line\">daemonset.apps/nginx   2         2         2       2            2           &lt;none&gt;          9m3s   nginx        nginx    app=nginx</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h3 id=\"å…è®¸-master-èŠ‚ç‚¹è¿è¡Œ-pod\">å…è®¸ master èŠ‚ç‚¹è¿è¡Œ pod</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¸Šé¢çœ‹åˆ°podåªåœ¨worker1å’Œworker2ä¸Šè¿è¡Œ,è€Œæ²¡æœ‰åœ¨masterèŠ‚ç‚¹ä¸Šè¿è¡Œ</p>\n</li>\n<li class=\"lvl-2\">\n<p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒKubernetes ä¸å…è®¸åœ¨ master èŠ‚ç‚¹ä¸Šè¿è¡Œ Podï¼Œè¿™æ˜¯å› ä¸ºmasterèŠ‚ç‚¹æœ‰æ±¡ç‚¹</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ kubectl describe node k8s-master | grep Taints</span><br><span class=\"line\">Taints:             node-role.kubernetes.io/control-plane:NoSchedule</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¸ºäº†èƒ½è®©podè¿è¡Œåœ¨å…·æœ‰æ±¡ç‚¹çš„èŠ‚ç‚¹ä¸Šï¼Œæˆ‘ä»¬éœ€è¦ä¸ºpodæŒ‡å®šå®¹å¿åº¦(tolerations)ï¼Œå®é™…ä¸Š DaemonSet æ§åˆ¶å™¨ä¼šè‡ªåŠ¨å°†ä¸€ç»„å®¹å¿åº¦æ·»åŠ åˆ° DaemonSet Pod</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>å®¹å¿åº¦é”®å</th>\n<th>æ•ˆæœ</th>\n<th>æ“ä½œ</th>\n<th>æè¿°</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>node.kubernetes.io/not-ready</code></td>\n<td><code>NoExecute</code></td>\n<td>Exists</td>\n<td>DaemonSet Pod å¯ä»¥è¢«è°ƒåº¦åˆ°ä¸å¥åº·æˆ–æœªå°±ç»ªçš„èŠ‚ç‚¹ä¸Šï¼Œä¸”ä¸ä¼šè¢«é©±é€ã€‚</td>\n</tr>\n<tr>\n<td><code>node.kubernetes.io/unreachable</code></td>\n<td><code>NoExecute</code></td>\n<td>Exists</td>\n<td>DaemonSet Pod å¯ä»¥è¢«è°ƒåº¦åˆ°ä¸å¯è¾¾çš„èŠ‚ç‚¹ä¸Šï¼Œä¸”ä¸ä¼šè¢«é©±é€ã€‚</td>\n</tr>\n<tr>\n<td><code>node.kubernetes.io/disk-pressure</code></td>\n<td><code>NoSchedule</code></td>\n<td>Exists</td>\n<td>DaemonSet Pod å¯ä»¥è¢«è°ƒåº¦åˆ°å­˜åœ¨ç£ç›˜å‹åŠ›çš„èŠ‚ç‚¹ä¸Šã€‚</td>\n</tr>\n<tr>\n<td><code>node.kubernetes.io/memory-pressure</code></td>\n<td><code>NoSchedule</code></td>\n<td>Exists</td>\n<td>DaemonSet Pod å¯ä»¥è¢«è°ƒåº¦åˆ°å­˜åœ¨å†…å­˜å‹åŠ›çš„èŠ‚ç‚¹ä¸Šã€‚</td>\n</tr>\n<tr>\n<td><code>node.kubernetes.io/pid-pressure</code></td>\n<td><code>NoSchedule</code></td>\n<td>Exists</td>\n<td>DaemonSet Pod å¯ä»¥è¢«è°ƒåº¦åˆ°å­˜åœ¨è¿›ç¨‹æ•°å‹åŠ›çš„èŠ‚ç‚¹ä¸Šã€‚</td>\n</tr>\n<tr>\n<td><code>node.kubernetes.io/unschedulable</code></td>\n<td><code>NoSchedule</code></td>\n<td>Exists</td>\n<td>DaemonSet Pod å¯ä»¥è¢«è°ƒåº¦åˆ°æ ‡è®°ä¸ºä¸å¯è°ƒåº¦çš„èŠ‚ç‚¹ä¸Šã€‚</td>\n</tr>\n<tr>\n<td><code>node.kubernetes.io/network-unavailable</code></td>\n<td><code>NoSchedule</code></td>\n<td>Exists</td>\n<td>é’ˆå¯¹ <code>spec.hostNetwork: true</code> çš„ Podï¼Œå¯ä»¥è¢«è°ƒåº¦åˆ°ç½‘ç»œä¸å¯ç”¨çš„èŠ‚ç‚¹ä¸Šã€‚</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¢åŠ å¯ä»¥è¿è¡Œåœ¨ master èŠ‚ç‚¹çš„å®¹å¿åº¦</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">apps/v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">DaemonSet</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">labels:</span></span><br><span class=\"line\">    <span class=\"attr\">app:</span> <span class=\"string\">nginx</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">nginx</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">selector:</span></span><br><span class=\"line\">    <span class=\"attr\">matchLabels:</span></span><br><span class=\"line\">      <span class=\"attr\">app:</span> <span class=\"string\">nginx</span></span><br><span class=\"line\">  <span class=\"attr\">template:</span></span><br><span class=\"line\">    <span class=\"attr\">metadata:</span></span><br><span class=\"line\">      <span class=\"attr\">labels:</span></span><br><span class=\"line\">        <span class=\"attr\">app:</span> <span class=\"string\">nginx</span></span><br><span class=\"line\">    <span class=\"attr\">spec:</span></span><br><span class=\"line\">      <span class=\"attr\">tolerations:</span>                                   <span class=\"comment\"># å¢åŠ å®¹å¿åº¦</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">key:</span> <span class=\"string\">&quot;node-role.kubernetes.io/control-plane&quot;</span> <span class=\"comment\"># å®¹å¿æ§åˆ¶å¹³é¢èŠ‚ç‚¹</span></span><br><span class=\"line\">        <span class=\"attr\">operator:</span> <span class=\"string\">&quot;Exists&quot;</span>                           <span class=\"comment\"># æ“ä½œç¬¦</span></span><br><span class=\"line\">        <span class=\"attr\">effect:</span> <span class=\"string\">&quot;NoSchedule&quot;</span>                         <span class=\"comment\"># æ±¡ç‚¹æ ‡ç­¾</span></span><br><span class=\"line\">      <span class=\"attr\">containers:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">image:</span> <span class=\"string\">nginx</span></span><br><span class=\"line\">        <span class=\"attr\">name:</span> <span class=\"string\">nginx</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¢åŠ å®¹å¿åº¦åé‡æ–°è¿è¡Œ</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl apply -f daemonset.yaml</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹</span></span><br><span class=\"line\">$ k get pod,ds -o wide</span><br><span class=\"line\">NAME              READY   STATUS    RESTARTS   AGE   IP               NODE          NOMINATED NODE   READINESS GATES</span><br><span class=\"line\">pod/nginx-4gxwh   1/1     Running   0          79m   10.244.235.205   k8s-master    &lt;none&gt;           &lt;none&gt;</span><br><span class=\"line\">pod/nginx-gx7tf   1/1     Running   0          78m   10.244.126.21    k8s-worker2   &lt;none&gt;           &lt;none&gt;</span><br><span class=\"line\">pod/nginx-sl8cc   1/1     Running   0          78m   10.244.194.92    k8s-worker1   &lt;none&gt;           &lt;none&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">NAME                   DESIRED   CURRENT   READY   UP-TO-DATE   AVAILABLE   NODE SELECTOR   AGE     CONTAINERS   IMAGES   SELECTOR</span><br><span class=\"line\">daemonset.apps/nginx   3         3         3       3            3           &lt;none&gt;          3h42m   nginx        nginx    app=nginx</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å®é™…ä¸Š daemonset åˆ›å»ºçš„ pod åŒæ ·æ”¯æŒ nodeNameï¼ŒnodeSelector,affinity ç­‰è°ƒåº¦ç­–ç•¥</p>\n</li>\n</ul>\n<h3 id=\"è®¿é—®podä¸­çš„nginxæœåŠ¡\">è®¿é—®podä¸­çš„nginxæœåŠ¡</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ­¤æ—¶æˆ‘ä»¬è¿˜æ²¡æœ‰åˆ›å»º <code>Service</code>(åé¢ç« èŠ‚ä¼šä»‹ç»)ï¼Œæ‰€ä»¥åªèƒ½é€šè¿‡ Pod çš„ IP è®¿é—®</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ä»»æ„podçš„IPï¼Œç«¯å£80</span></span><br><span class=\"line\">curl http://10.244.194.92</span><br></pre></td></tr></table></figure>\n<h3 id=\"æŸ¥çœ‹-DaemonSet-è¯¦æƒ…\">æŸ¥çœ‹ DaemonSet è¯¦æƒ…</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å½“ DaemonSet è¿è¡Œé”™è¯¯æ—¶ï¼Œå¯ä»¥é€šè¿‡è¯¥å‘½ä»¤æŸ¥çœ‹ DaemonSet çš„è¯¦æƒ…ï¼Œæ‰¾åˆ°é”™è¯¯åŸå› </p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl describe ds &lt;ds-name&gt;</span><br><span class=\"line\">kubectl describe ds &lt;ds-name&gt; -n &lt;namespace-name&gt;</span><br></pre></td></tr></table></figure>\n<h3 id=\"åˆ é™¤-DaemonSet\">åˆ é™¤ DaemonSet</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl delete ds &lt;ds-name&gt;</span><br><span class=\"line\">kubectl delete ds &lt;ds-name&gt; -n &lt;namespace-name&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># é€šè¿‡ yaml æ–‡ä»¶åˆ é™¤</span></span><br><span class=\"line\">kubectl delete -f &lt;yaml-file&gt;</span><br></pre></td></tr></table></figure>\n<h3 id=\"æŸ¥çœ‹-DaemonSet-æ—¥å¿—\">æŸ¥çœ‹ DaemonSet æ—¥å¿—</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl logs ds/&lt;ds-name&gt;</span><br><span class=\"line\">kubectl logs ds/&lt;ds-name&gt; -n &lt;namespace-name&gt;</span><br></pre></td></tr></table></figure>\n<h3 id=\"æ»šåŠ¨å‡çº§ä¸å›æ»š-DaemonSet\">æ»šåŠ¨å‡çº§ä¸å›æ»š DaemonSet</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¯¹ <code>RollingUpdate</code> ç±»å‹çš„ <code>DaemonSet</code> çš„ <code>.spec.template</code> çš„ä»»ä½•æ›´æ–°éƒ½å°†è§¦å‘æ»šåŠ¨æ›´æ–°ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>æˆ‘ä»¬ä¿®æ”¹è¿‡ <code>DaemonSet</code> çš„ <code>.spec.template</code>ï¼Œå¹¶ä¿å­˜åï¼Œé‡æ–°è¿è¡Œ <code>kubectl apply -f &lt;yaml-file&gt;</code>å³å¯è§¦å‘æ»šåŠ¨å‡çº§ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å¦‚æœåªæ˜¯æ›´æ–°å®¹å™¨çš„é•œåƒï¼Œä¹Ÿå¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤è§¦å‘æ»šåŠ¨å‡çº§</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># kubectl set image ds/&lt;ds-name&gt; &lt;container-name&gt;=&lt;image&gt;:&lt;tag&gt; --record=true</span></span><br><span class=\"line\">kubectl <span class=\"built_in\">set</span> image ds nginx nginx=nginx:1.9.1 --record=<span class=\"literal\">true</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æŸ¥çœ‹æ»šåŠ¨å‡çº§çŠ¶æ€</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># kubectl rollout status ds/&lt;ds-name&gt;</span></span><br><span class=\"line\">kubectl rollout status ds nginx</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æŸ¥çœ‹å†å²ç‰ˆæœ¬</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å‰é¢çš„åºå·è¡¨ç¤ºç‰ˆæœ¬å·</span></span><br><span class=\"line\">kubectl rollout <span class=\"built_in\">history</span> ds nginx</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹æŒ‡å®šç‰ˆæœ¬çš„è¯¦æƒ…</span></span><br><span class=\"line\">kubectl rollout <span class=\"built_in\">history</span> ds nginx --revision=1</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å›æ»š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å›é€€åˆ°å‰ä¸€ä¸ªç‰ˆæœ¬</span></span><br><span class=\"line\">kubectl rollout undo ds nginx</span><br><span class=\"line\"><span class=\"comment\"># å›åˆ°æŒ‡å®šç‰ˆæœ¬ï¼Œè¿™é‡Œ --to-revision=1 è¡¨ç¤ºå›åˆ°ç‰ˆæœ¬1</span></span><br><span class=\"line\">kubectl rollout undo ds nginx --to-revision=1</span><br></pre></td></tr></table></figure>\n<h2 id=\"Deployment-å’Œ-DaemonSet-çš„å¯¹æ¯”æ€»ç»“\">Deployment å’Œ DaemonSet çš„å¯¹æ¯”æ€»ç»“</h2>\n<table>\n<thead>\n<tr>\n<th>ç‰¹æ€§</th>\n<th><strong>Deployment</strong></th>\n<th><strong>DaemonSet</strong></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>ç”¨é€”</strong></td>\n<td>ç®¡ç†ä¸€ç»„å¯æ°´å¹³æ‰©å±•çš„ Podï¼ŒæŒ‰éœ€å‰¯æœ¬æ•°è¿è¡Œ</td>\n<td>åœ¨æ¯ä¸ªï¼ˆæˆ–ç‰¹å®šï¼‰èŠ‚ç‚¹ä¸Šè¿è¡Œ <strong>ä¸€ä¸ªå‰¯æœ¬</strong> çš„ Pod</td>\n</tr>\n<tr>\n<td><strong>å¸¸è§åœºæ™¯</strong></td>\n<td>æ— çŠ¶æ€æœåŠ¡ã€Web æœåŠ¡ã€APIã€åç«¯æœåŠ¡</td>\n<td>æ—¥å¿—é‡‡é›†ï¼ˆå¦‚ fluentdï¼‰ã€ç›‘æ§ï¼ˆå¦‚ node-exporterï¼‰ã€ç³»ç»Ÿå®ˆæŠ¤è¿›ç¨‹</td>\n</tr>\n<tr>\n<td><strong>å‰¯æœ¬æ§åˆ¶</strong></td>\n<td>å¯é€šè¿‡ <code>spec.replicas</code> çµæ´»æ§åˆ¶å‰¯æœ¬æ•°</td>\n<td>æ¯ä¸ªåŒ¹é…çš„èŠ‚ç‚¹è‡ªåŠ¨è¿è¡Œä¸€ä¸ª Podï¼Œæ— éœ€è®¾ç½® <code>replicas</code></td>\n</tr>\n<tr>\n<td><strong>èŠ‚ç‚¹åˆ†å¸ƒ</strong></td>\n<td>Pod åˆ†å¸ƒéšæœºï¼Œè°ƒåº¦å™¨é€‰æ‹©å¯ç”¨èŠ‚ç‚¹</td>\n<td>Pod åˆ†å¸ƒå›ºå®šï¼Œ<strong>æ¯ä¸ªåŒ¹é…èŠ‚ç‚¹å¿…è·‘ä¸€ä¸ª Pod</strong></td>\n</tr>\n<tr>\n<td><strong>æ›´æ–°ç­–ç•¥</strong></td>\n<td><code>RollingUpdate</code>ï¼ˆé»˜è®¤ï¼‰ã€<code>Recreate</code>ï¼Œæ”¯æŒå›æ»š</td>\n<td><code>RollingUpdate</code>ï¼ˆé»˜è®¤ä» Kubernetes 1.6 èµ·æ”¯æŒï¼‰</td>\n</tr>\n<tr>\n<td><strong>ä¼¸ç¼©æ–¹å¼</strong></td>\n<td><code>kubectl scale deployment</code> å¯ä»¥æ°´å¹³æ‰©ç¼©å®¹</td>\n<td><strong>ä¸æ”¯æŒæ‰‹åŠ¨ä¼¸ç¼©</strong>ï¼Œè·ŸéšèŠ‚ç‚¹å˜åŒ–è‡ªåŠ¨ä¼¸ç¼©</td>\n</tr>\n<tr>\n<td><strong>Pod æ›´æ–°è¡Œä¸º</strong></td>\n<td>æŒ‰ç­–ç•¥æ»šåŠ¨æ›´æ–°å…¨éƒ¨å‰¯æœ¬</td>\n<td>æ¯ä¸ªèŠ‚ç‚¹ä¸Šçš„ Pod é€ä¸ªæ»šåŠ¨æ›´æ–°</td>\n</tr>\n<tr>\n<td><strong>è°ƒåº¦ç­–ç•¥</strong></td>\n<td>é€šè¿‡è°ƒåº¦å™¨åˆ†é…èŠ‚ç‚¹ï¼Œå¯æ­é… <code>affinity</code> ä½¿ç”¨</td>\n<td>é»˜è®¤è°ƒåº¦æ‰€æœ‰èŠ‚ç‚¹ï¼Œå¯ç”¨ <code>nodeSelector</code>ã€<code>affinity</code>ã€<code>taints</code> æ§åˆ¶</td>\n</tr>\n</tbody>\n</table>\n","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» K8S çš„ DaemonSet ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚ K8Så®˜ç½‘ k8s Github k8s DaemonSet ä»‹ç» DaemonSet ä»‹ç» DaemonSet(ç¼©å†™ä¸º ds) å®šä¹‰äº†æä¾›èŠ‚ç‚¹æœ¬åœ°è®¾æ–½çš„ Podã€‚è¿™äº›è®¾æ–½å¯èƒ½å¯¹äºé›†ç¾¤çš„è¿è¡Œè‡³å…³é‡è¦ï¼Œä¾‹å¦‚ç½‘ç»œè¾…åŠ©å·¥å…·ï¼Œæˆ–è€…ä½œä¸º add-on çš„ä¸€éƒ¨åˆ†ã€‚ DaemonSet ç¡®ä¿å…¨éƒ¨ï¼ˆæˆ–è€…æŸäº›ï¼‰èŠ‚ç‚¹ä¸Šè¿è¡Œä¸€ä¸ª Pod çš„å‰¯æœ¬ã€‚ å½“æœ‰èŠ‚ç‚¹åŠ å…¥é›†ç¾¤æ—¶ï¼Œ ä¹Ÿä¼šä¸ºä»–ä»¬æ–°å¢ä¸€ä¸ª Pod ã€‚ å½“æœ‰èŠ‚ç‚¹ä»é›†ç¾¤ç§»é™¤æ—¶ï¼Œè¿™äº› Pod ä¹Ÿä¼šè¢«å›æ”¶ã€‚åˆ é™¤ DaemonSet å°†ä¼šåˆ é™¤å®ƒåˆ›å»ºçš„æ‰€æœ‰ Podã€‚ DaemonSet çš„ä¸€äº›å…¸å‹ç”¨æ³•ï¼š åœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šè¿è¡Œé›†ç¾¤å®ˆæŠ¤è¿›ç¨‹ åœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šè¿è¡Œæ—¥å¿—æ”¶é›†å®ˆæŠ¤è¿›ç¨‹ åœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šè¿è¡Œç›‘æ§å®ˆæŠ¤è¿›ç¨‹ DaemonSet ä¸ Deployment çš„ä¸»è¦åŒºåˆ«æ˜¯ï¼š æ— æ³•è‡ªå®šä¹‰å‰¯æœ¬æ•°é‡ æ¯ä¸ªnodeä¸Šéƒ½ä¼šè¿è¡Œä¸”åªå…è®¸è¿è¡Œä¸€ä¸ª Pod å½“æœ‰æ–°NodeåŠ å…¥é›†ç¾¤æ—¶ï¼Œä¼šè‡ªåŠ¨åœ¨å…¶ä¸Šéƒ¨ç½²å¹¶è¿è¡ŒPodå‰¯æœ¬ï¼Œå½“Nodeä»é›†ç¾¤ç§»é™¤æ—¶ï¼Œè¿™äº›Podä¹Ÿä¼šè¢«å›æ”¶ DaemonSet ç®¡ç† DaemonSet åˆ›å»º DaemonSet åªèƒ½ é€šè¿‡ yaml åˆ›å»ºï¼Œä¸æ”¯æŒ create åˆ›å»º 12# é€šè¿‡ yaml æ–‡ä»¶åˆ›å»ºkubectl apply -f daemonset.yaml ä¸€ä¸ªç®€å•çš„ daemonset.yaml æ–‡ä»¶è¯´æ˜ 12345678910111213141516171819202122232425apiVersion: apps/v1 # æŒ‡å®šä½¿ç”¨çš„ API ç‰ˆæœ¬ï¼Œè¿™é‡Œæ˜¯ apps/v1ï¼Œé€‚ç”¨äº DaemonSet èµ„æºkind: DaemonSet # Kubernetes èµ„æºç±»å‹ï¼Œè¿™é‡Œæ˜¯éƒ¨ç½²ï¼ˆDaemonSetï¼‰metadata: labels: app: nginx # æ ‡ç­¾ï¼Œç”¨äºæ ‡è¯†èµ„æºï¼Œå¯ä¸ selector åŒ¹é… name: nginx # èµ„æºåç§°ï¼Œå¿…é¡»å”¯ä¸€ï¼ˆåœ¨åŒä¸€å‘½åç©ºé—´ä¸‹ï¼‰spec: # é…ç½®é¡¹ revisionHistoryLimit: 10 # ä¿ç•™çš„å†å²ç‰ˆæœ¬æ•°ï¼Œé»˜è®¤å€¼ä¸º 10ï¼ŒDeployment å’Œ StatefulSet éƒ½æœ‰è¿™ä¸ªé…ç½®é¡¹ã€‚å›æ»šæ—¶æœ‰ç”¨ã€‚ selector: # é€‰æ‹©å™¨ï¼ŒæŒ‡å®šè¦ç®¡ç†çš„ Pod matchLabels: # æ ‡ç­¾é€‰æ‹©å™¨ app: nginx # é€‰æ‹©å™¨ï¼ŒæŒ‡å®š DaemonSet ç®¡ç†å“ªäº› Podï¼ˆæ ‡ç­¾å¿…é¡»ä¸ template ä¸­åŒ¹é…ï¼‰ updateStrategy: # æ›´æ–°ç­–ç•¥ï¼Œè¿™é‡Œè¦æ³¨æ„è¿™ä¸ªæ›´æ–°ç­–ç•¥ä¸Deploymentçš„å±æ€§åå­—ä¸ä¸€æ · type: RollingUpdate # 1.RollingUpdateï¼šè¿™æ˜¯é»˜è®¤çš„æ›´æ–°ç­–ç•¥ã€‚ä½¿ç”¨ RollingUpdate æ›´æ–°ç­–ç•¥æ—¶ï¼Œåœ¨æ›´æ–° DaemonSet æ¨¡æ¿åï¼Œ è€çš„ DaemonSet Pod å°†è¢«ç»ˆæ­¢ï¼Œå¹¶ä¸”å°†ä»¥å—æ§æ–¹å¼è‡ªåŠ¨åˆ›å»ºæ–°çš„ DaemonSet Podã€‚ æ›´æ–°æœŸé—´ï¼Œæœ€å¤šåªèƒ½æœ‰ DaemonSet çš„ä¸€ä¸ª Pod è¿è¡Œäºæ¯ä¸ªèŠ‚ç‚¹ä¸Šã€‚ # 2.OnDeleteï¼šä½¿ç”¨ OnDelete æ›´æ–°ç­–ç•¥æ—¶ï¼Œåœ¨æ›´æ–° DaemonSet æ¨¡æ¿åï¼Œåªæœ‰å½“ä½ æ‰‹åŠ¨åˆ é™¤è€çš„ DaemonSet Pod ä¹‹åï¼Œæ–°çš„ DaemonSet Pod æ‰ä¼šè¢«è‡ªåŠ¨åˆ›å»ºã€‚ rollingUpdate: # æ»šåŠ¨å‡çº§çš„é…ç½® maxSurge: 0 # å¯ä»¥è¶…å‡ºç°æœ‰ DaemonSet Pod çš„æœ€å¤§æ•°æˆ–æœ€å¤§ç™¾åˆ†æ¯”ï¼Œé»˜è®¤æ˜¯ 0ã€‚ä¸ maxUnavailable ä¸èƒ½åŒæ—¶ä¸º 0 maxUnavailable: 1 # æ›´æ–°æœŸé—´ä¸å¯ç”¨çš„ DaemonSet Pod çš„æœ€å¤§æ•°æˆ–æœ€å¤§ç™¾åˆ†æ¯”ï¼Œé»˜è®¤æ˜¯ 1ã€‚ä¸ maxSurge ä¸èƒ½åŒæ—¶ä¸º 0 template: # æ¨¡æ¿ï¼Œå®šä¹‰ Pod çš„å†…å®¹ï¼Œå…·ä½“å¯ä»¥å‚è€ƒ Pod çš„é…ç½® metadata: labels: app: nginx # Pod çš„æ ‡ç­¾ï¼Œå¿…é¡»ä¸ selector ä¸­çš„ matchLabels ä¸€è‡´ spec: containers: - image: nginx # å®¹å™¨ä½¿ç”¨çš„é•œåƒï¼Œè¿™é‡Œæ˜¯å®˜æ–¹çš„ nginx é•œåƒ name: nginx # å®¹å™¨çš„åç§° æŸ¥çœ‹ DaemonSet 12345678910111213141516171819202122232425# æŸ¥çœ‹ DaemonSet ï¼Œé»˜è®¤æ˜¾ç¤º default å‘½åç©ºé—´ä¸‹çš„ DaemonSetkubectl get daemonsetskubectl get ds # ç®€ç§°# æŸ¥çœ‹ kube-system å‘½åç©ºé—´ä¸‹çš„ DaemonSetkubectl get ds -n kube-system# æŸ¥çœ‹æ‰€æœ‰å‘½åç©ºé—´ä¸‹çš„ DaemonSetkubectl get ds -A# -o wide: æ˜¾ç¤º deploy çš„è¯¦ç»†ä¿¡æ¯kubectl get ds -o wide# æ˜¾ç¤º DaemonSet çš„æ ‡ç­¾kubectl get ds --show-labels# æŒ‰ DaemonSet çš„æ ‡ç­¾è¿›ç¨‹æŸ¥è¯¢kubectl get ds -l &lt;label_name&gt;=&lt;label_value&gt;# æŒç»­æŸ¥çœ‹ DaemonSet çš„çŠ¶æ€ï¼Œå½“ DaemonSet çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶ï¼Œä¼šå®æ—¶æ˜¾ç¤ºkubectl get ds -w# æŸ¥çœ‹ podã€ds çš„è¯¦ç»†ä¿¡æ¯$ k get pod,ds -owideNAME READY STATUS RESTARTS AGE IP NODE NOMINATED NODE READINESS GATESpod/nginx-6g8j8 1/1 Running 0 9m3s 10.244.126.18 k8s-worker2 &lt;none&gt; &lt;none&gt;pod/nginx-tnvhn 1/1 Running 0 9m3s 10.244.194.89 k8s-worker1 &lt;none&gt; &lt;none&gt;NAME DESIRED CURRENT READY UP-TO-DATE AVAILABLE NODE SELECTOR AGE CONTAINERS IMAGES SELECTORdaemonset.apps/nginx 2 2 2 2 2 &lt;none&gt; 9m3s nginx nginx app=nginx å…è®¸ master èŠ‚ç‚¹è¿è¡Œ pod ä¸Šé¢çœ‹åˆ°podåªåœ¨worker1å’Œworker2ä¸Šè¿è¡Œ,è€Œæ²¡æœ‰åœ¨masterèŠ‚ç‚¹ä¸Šè¿è¡Œ é»˜è®¤æƒ…å†µä¸‹ï¼ŒKubernetes ä¸å…è®¸åœ¨ master èŠ‚ç‚¹ä¸Šè¿è¡Œ Podï¼Œè¿™æ˜¯å› ä¸ºmasterèŠ‚ç‚¹æœ‰æ±¡ç‚¹ 12$ kubectl describe node k8s-master | grep TaintsTaints: node-role.kubernetes.io/control-plane:NoSchedule ä¸ºäº†èƒ½è®©podè¿è¡Œåœ¨å…·æœ‰æ±¡ç‚¹çš„èŠ‚ç‚¹ä¸Šï¼Œæˆ‘ä»¬éœ€è¦ä¸ºpodæŒ‡å®šå®¹å¿åº¦(tolerations)ï¼Œå®é™…ä¸Š DaemonSet æ§åˆ¶å™¨ä¼šè‡ªåŠ¨å°†ä¸€ç»„å®¹å¿åº¦æ·»åŠ åˆ° DaemonSet Pod å®¹å¿åº¦é”®å æ•ˆæœ æ“ä½œ æè¿° node.kubernetes.io/not-ready NoExecute Exists DaemonSet Pod å¯ä»¥è¢«è°ƒåº¦åˆ°ä¸å¥åº·æˆ–æœªå°±ç»ªçš„èŠ‚ç‚¹ä¸Šï¼Œä¸”ä¸ä¼šè¢«é©±é€ã€‚ node.kubernetes.io/unreachable NoExecute Exists DaemonSet Pod å¯ä»¥è¢«è°ƒåº¦åˆ°ä¸å¯è¾¾çš„èŠ‚ç‚¹ä¸Šï¼Œä¸”ä¸ä¼šè¢«é©±é€ã€‚ node.kubernetes.io/disk-pressure NoSchedule Exists DaemonSet Pod å¯ä»¥è¢«è°ƒåº¦åˆ°å­˜åœ¨ç£ç›˜å‹åŠ›çš„èŠ‚ç‚¹ä¸Šã€‚ node.kubernetes.io/memory-pressure NoSchedule Exists DaemonSet Pod å¯ä»¥è¢«è°ƒåº¦åˆ°å­˜åœ¨å†…å­˜å‹åŠ›çš„èŠ‚ç‚¹ä¸Šã€‚ node.kubernetes.io/pid-pressure NoSchedule Exists DaemonSet Pod å¯ä»¥è¢«è°ƒåº¦åˆ°å­˜åœ¨è¿›ç¨‹æ•°å‹åŠ›çš„èŠ‚ç‚¹ä¸Šã€‚ node.kubernetes.io/unschedulable NoSchedule Exists DaemonSet Pod å¯ä»¥è¢«è°ƒåº¦åˆ°æ ‡è®°ä¸ºä¸å¯è°ƒåº¦çš„èŠ‚ç‚¹ä¸Šã€‚ node.kubernetes.io/network-unavailable NoSchedule Exists é’ˆå¯¹ spec.hostNetwork: true çš„ Podï¼Œå¯ä»¥è¢«è°ƒåº¦åˆ°ç½‘ç»œä¸å¯ç”¨çš„èŠ‚ç‚¹ä¸Šã€‚ å¢åŠ å¯ä»¥è¿è¡Œåœ¨ master èŠ‚ç‚¹çš„å®¹å¿åº¦ 12345678910111213141516171819202122apiVersion: apps/v1kind: DaemonSetmetadata: labels: app: nginx name: nginxspec: selector: matchLabels: app: nginx template: metadata: labels: app: nginx spec: tolerations: # å¢åŠ å®¹å¿åº¦ - key: &quot;node-role.kubernetes.io/control-plane&quot; # å®¹å¿æ§åˆ¶å¹³é¢èŠ‚ç‚¹ operator: &quot;Exists&quot; # æ“ä½œç¬¦ effect: &quot;NoSchedule&quot; # æ±¡ç‚¹æ ‡ç­¾ containers: - image: nginx name: nginx å¢åŠ å®¹å¿åº¦åé‡æ–°è¿è¡Œ 1234567891011kubectl apply -f daemonset.yaml# æŸ¥çœ‹$ k get pod,ds -o wideNAME READY STATUS RESTARTS AGE IP NODE NOMINATED NODE READINESS GATESpod/nginx-4gxwh 1/1 Running 0 79m 10.244.235.205 k8s-master &lt;none&gt; &lt;none&gt;pod/nginx-gx7tf 1/1 Running 0 78m 10.244.126.21 k8s-worker2 &lt;none&gt; &lt;none&gt;pod/nginx-sl8cc 1/1 Running 0 78m 10.244.194.92 k8s-worker1 &lt;none&gt; &lt;none&gt;NAME DESIRED CURRENT READY UP-TO-DATE AVAILABLE NODE SELECTOR AGE CONTAINERS IMAGES SELECTORdaemonset.apps/nginx 3 3 3 3 3 &lt;none&gt; 3h42m nginx nginx app=nginx å®é™…ä¸Š daemonset åˆ›å»ºçš„ pod åŒæ ·æ”¯æŒ nodeNameï¼ŒnodeSelector,affinity ç­‰è°ƒåº¦ç­–ç•¥ è®¿é—®podä¸­çš„nginxæœåŠ¡ æ­¤æ—¶æˆ‘ä»¬è¿˜æ²¡æœ‰åˆ›å»º Service(åé¢ç« èŠ‚ä¼šä»‹ç»)ï¼Œæ‰€ä»¥åªèƒ½é€šè¿‡ Pod çš„ IP è®¿é—® 12# ä»»æ„podçš„IPï¼Œç«¯å£80curl http://10.244.194.92 æŸ¥çœ‹ DaemonSet è¯¦æƒ… å½“ DaemonSet è¿è¡Œé”™è¯¯æ—¶ï¼Œå¯ä»¥é€šè¿‡è¯¥å‘½ä»¤æŸ¥çœ‹ DaemonSet çš„è¯¦æƒ…ï¼Œæ‰¾åˆ°é”™è¯¯åŸå›  12kubectl describe ds &lt;ds-name&gt;kubectl describe ds &lt;ds-name&gt; -n &lt;namespace-name&gt; åˆ é™¤ DaemonSet 12345kubectl delete ds &lt;ds-name&gt;kubectl delete ds &lt;ds-name&gt; -n &lt;namespace-name&gt;# é€šè¿‡ yaml æ–‡ä»¶åˆ é™¤kubectl delete -f &lt;yaml-file&gt; æŸ¥çœ‹ DaemonSet æ—¥å¿— 12kubectl logs ds/&lt;ds-name&gt;kubectl logs ds/&lt;ds-name&gt; -n &lt;namespace-name&gt; æ»šåŠ¨å‡çº§ä¸å›æ»š DaemonSet å¯¹ RollingUpdate ç±»å‹çš„ DaemonSet çš„ .spec.template çš„ä»»ä½•æ›´æ–°éƒ½å°†è§¦å‘æ»šåŠ¨æ›´æ–°ã€‚ æˆ‘ä»¬ä¿®æ”¹è¿‡ DaemonSet çš„ .spec.templateï¼Œå¹¶ä¿å­˜åï¼Œé‡æ–°è¿è¡Œ kubectl apply -f &lt;yaml-file&gt;å³å¯è§¦å‘æ»šåŠ¨å‡çº§ã€‚ å¦‚æœåªæ˜¯æ›´æ–°å®¹å™¨çš„é•œåƒï¼Œä¹Ÿå¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤è§¦å‘æ»šåŠ¨å‡çº§ 12# kubectl set image ds/&lt;ds-name&gt; &lt;container-name&gt;=&lt;image&gt;:&lt;tag&gt; --record=truekubectl set image ds nginx nginx=nginx:1.9.1 --record=true æŸ¥çœ‹æ»šåŠ¨å‡çº§çŠ¶æ€ 12# kubectl rollout status ds/&lt;ds-name&gt;kubectl rollout status ds nginx æŸ¥çœ‹å†å²ç‰ˆæœ¬ 1234# å‰é¢çš„åºå·è¡¨ç¤ºç‰ˆæœ¬å·kubectl rollout history ds nginx# æŸ¥çœ‹æŒ‡å®šç‰ˆæœ¬çš„è¯¦æƒ…kubectl rollout history ds nginx --revision=1 å›æ»š 1234# å›é€€åˆ°å‰ä¸€ä¸ªç‰ˆæœ¬kubectl rollout undo ds nginx# å›åˆ°æŒ‡å®šç‰ˆæœ¬ï¼Œè¿™é‡Œ --to-revision=1 è¡¨ç¤ºå›åˆ°ç‰ˆæœ¬1kubectl rollout undo ds nginx --to-revision=1 Deployment å’Œ DaemonSet çš„å¯¹æ¯”æ€»ç»“ ç‰¹æ€§ Deployment DaemonSet ç”¨é€” ç®¡ç†ä¸€ç»„å¯æ°´å¹³æ‰©å±•çš„ Podï¼ŒæŒ‰éœ€å‰¯æœ¬æ•°è¿è¡Œ åœ¨æ¯ä¸ªï¼ˆæˆ–ç‰¹å®šï¼‰èŠ‚ç‚¹ä¸Šè¿è¡Œ ä¸€ä¸ªå‰¯æœ¬ çš„ Pod å¸¸è§åœºæ™¯ æ— çŠ¶æ€æœåŠ¡ã€Web æœåŠ¡ã€APIã€åç«¯æœåŠ¡ æ—¥å¿—é‡‡é›†ï¼ˆå¦‚ fluentdï¼‰ã€ç›‘æ§ï¼ˆå¦‚ node-exporterï¼‰ã€ç³»ç»Ÿå®ˆæŠ¤è¿›ç¨‹ å‰¯æœ¬æ§åˆ¶ å¯é€šè¿‡ spec.replicas çµæ´»æ§åˆ¶å‰¯æœ¬æ•° æ¯ä¸ªåŒ¹é…çš„èŠ‚ç‚¹è‡ªåŠ¨è¿è¡Œä¸€ä¸ª Podï¼Œæ— éœ€è®¾ç½® replicas èŠ‚ç‚¹åˆ†å¸ƒ Pod åˆ†å¸ƒéšæœºï¼Œè°ƒåº¦å™¨é€‰æ‹©å¯ç”¨èŠ‚ç‚¹ Pod åˆ†å¸ƒå›ºå®šï¼Œæ¯ä¸ªåŒ¹é…èŠ‚ç‚¹å¿…è·‘ä¸€ä¸ª Pod æ›´æ–°ç­–ç•¥ RollingUpdateï¼ˆé»˜è®¤ï¼‰ã€Recreateï¼Œæ”¯æŒå›æ»š RollingUpdateï¼ˆé»˜è®¤ä» Kubernetes 1.6 èµ·æ”¯æŒï¼‰ ä¼¸ç¼©æ–¹å¼ kubectl scale deployment å¯ä»¥æ°´å¹³æ‰©ç¼©å®¹ ä¸æ”¯æŒæ‰‹åŠ¨ä¼¸ç¼©ï¼Œè·ŸéšèŠ‚ç‚¹å˜åŒ–è‡ªåŠ¨ä¼¸ç¼© Pod æ›´æ–°è¡Œä¸º æŒ‰ç­–ç•¥æ»šåŠ¨æ›´æ–°å…¨éƒ¨å‰¯æœ¬ æ¯ä¸ªèŠ‚ç‚¹ä¸Šçš„ Pod é€ä¸ªæ»šåŠ¨æ›´æ–° è°ƒåº¦ç­–ç•¥ é€šè¿‡è°ƒåº¦å™¨åˆ†é…èŠ‚ç‚¹ï¼Œå¯æ­é… affinity ä½¿ç”¨ é»˜è®¤è°ƒåº¦æ‰€æœ‰èŠ‚ç‚¹ï¼Œå¯ç”¨ nodeSelectorã€affinityã€taints æ§åˆ¶","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» K8S çš„ DaemonSet ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚ K8Så®˜ç½‘ k8s Github k8s DaemonSet ä»‹ç»","date_published":"2025-07-15T14:30:05.000Z","tags":["æŠ€æœ¯","k8s","K8S"]},{"id":"https://blog.hanqunfeng.com/2025/07/14/k8s-deployment/","url":"https://blog.hanqunfeng.com/2025/07/14/k8s-deployment/","title":"K8S ä¹‹ Deployment","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç» K8S çš„ Deploymentï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://kubernetes.io/zh-cn/\">K8Så®˜ç½‘</a></p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://github.com/kubernetes/kubernetes\">k8s Github</a></p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://kubernetes.io/zh-cn/docs/concepts/workloads/controllers/deployment/\">k8s Deployment ä»‹ç»</a></p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"Deployment-ç¼©å†™ä¸º-deploy-ä»‹ç»\">Deployment(ç¼©å†™ä¸º deploy) ä»‹ç»</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åœ¨ä½¿ç”¨k8såˆ›å»ºå®¹å™¨æ—¶ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä¸ä¼šç›´æ¥åˆ›å»ºpodï¼Œè€Œæ˜¯åˆ›å»º deploymentï¼ŒdaemonSetï¼ŒStatefulSetç­‰ç­‰ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>Deployment ç”¨äºç®¡ç†è¿è¡Œä¸€ä¸ªåº”ç”¨è´Ÿè½½çš„ä¸€ç»„ Podï¼Œé€šå¸¸é€‚ç”¨äºä¸ä¿æŒçŠ¶æ€çš„è´Ÿè½½ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>Deployment æ˜¯æœ€å¸¸ç”¨çš„æ— çŠ¶æ€æœåŠ¡æ§åˆ¶å™¨ï¼Œç”±Deploymentã€ReplicaSetã€Podç»„æˆã€æ”¯æŒé›†ç¾¤æ‰©å®¹ç¼©å®¹ã€æ»šåŠ¨ã€æ›´æ–°ã€è‡ªåŠ¨ç»´æŠ¤Podå¯ç”¨æ€§åŠå‰¯æœ¬æ•°é‡ç­‰åŠŸèƒ½ï¼Œ<a href=\"https://kubernetes.io/zh-cn/docs/concepts/workloads/controllers/replicaset/\">ReplicaSet</a>å’ŒPodç”±Deploymentè‡ªåŠ¨ç®¡ç†ï¼Œç”¨æˆ·æ— éœ€å¹²é¢„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåˆ›å»ºä¸€ä¸ªDeploymentåï¼ŒK8Sä¼šè‡ªåŠ¨åˆ›å»ºReplicaSetï¼Œå¹¶åˆ›å»ºæŒ‡å®šæ•°é‡çš„Podã€‚<br>\n<img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/uPic/Tcj2Px.png\" alt=\"\" width=\"1200\" height=\"600\"></p>\n</li>\n</ul>\n<h2 id=\"Deployment-ç®¡ç†\">Deployment ç®¡ç†</h2>\n<h3 id=\"Deployment-åˆ›å»º\">Deployment åˆ›å»º</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><code>create</code> åˆ›å»º</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åˆ›å»º deployment</span></span><br><span class=\"line\">kubectl create deployment nginx --image=nginx</span><br><span class=\"line\"><span class=\"comment\"># å¤šå‰¯æœ¬ï¼Œ--replicas=3 åˆ›å»º3ä¸ªå‰¯æœ¬</span></span><br><span class=\"line\">kubectl create deployment nginx --image=nginx --replicas=3</span><br><span class=\"line\"><span class=\"comment\"># -o ç”Ÿæˆ yaml æ–‡ä»¶, --dry-run: ä¸çœŸçš„æ‰§è¡Œåˆ›å»º</span></span><br><span class=\"line\">kubectl create deployment nginx --image=nginx --replicas=3 --dry-run=client -o yaml &gt; deployment.yaml</span><br><span class=\"line\"><span class=\"comment\"># é€šè¿‡ yaml æ–‡ä»¶åˆ›å»º</span></span><br><span class=\"line\">kubectl apply -f deployment.yaml</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¸€ä¸ªç®€å•çš„ <code>deployment.yaml</code> æ–‡ä»¶è¯´æ˜</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">apps/v1</span>                  <span class=\"comment\"># æŒ‡å®šä½¿ç”¨çš„ API ç‰ˆæœ¬ï¼Œè¿™é‡Œæ˜¯ apps/v1ï¼Œé€‚ç”¨äº Deployment èµ„æº</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Deployment</span>                     <span class=\"comment\"># Kubernetes èµ„æºç±»å‹ï¼Œè¿™é‡Œæ˜¯éƒ¨ç½²ï¼ˆDeploymentï¼‰</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">labels:</span></span><br><span class=\"line\">    <span class=\"attr\">app:</span> <span class=\"string\">nginx</span>                       <span class=\"comment\"># æ ‡ç­¾ï¼Œç”¨äºæ ‡è¯†èµ„æºï¼Œå¯ä¸ selector åŒ¹é…</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">nginx</span>                        <span class=\"comment\"># èµ„æºåç§°ï¼Œå¿…é¡»å”¯ä¸€ï¼ˆåœ¨åŒä¸€å‘½åç©ºé—´ä¸‹ï¼‰</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span>                                <span class=\"comment\"># é…ç½®é¡¹</span></span><br><span class=\"line\">  <span class=\"attr\">replicas:</span> <span class=\"number\">3</span>                        <span class=\"comment\"># å‰¯æœ¬æ•°ï¼Œè¡¨ç¤ºå¸Œæœ›è¿è¡Œå¤šå°‘ä¸ª Pod å®ä¾‹</span></span><br><span class=\"line\">  <span class=\"attr\">selector:</span>                          <span class=\"comment\"># é€‰æ‹©å™¨ï¼ŒæŒ‡å®šè¦ç®¡ç†çš„ Pod</span></span><br><span class=\"line\">    <span class=\"attr\">matchLabels:</span>                     <span class=\"comment\"># æ ‡ç­¾é€‰æ‹©å™¨</span></span><br><span class=\"line\">      <span class=\"attr\">app:</span> <span class=\"string\">nginx</span>                     <span class=\"comment\"># é€‰æ‹©å™¨ï¼ŒæŒ‡å®š Deployment ç®¡ç†å“ªäº› Podï¼ˆæ ‡ç­¾å¿…é¡»ä¸ template ä¸­åŒ¹é…ï¼‰</span></span><br><span class=\"line\">  <span class=\"attr\">strategy:</span>                          <span class=\"comment\"># ç”¨æ–°Podæ›¿æ¢ç°æœ‰Podçš„éƒ¨ç½²ç­–ç•¥ï¼Œå¯çœç•¥ï¼Œé»˜è®¤å°±æ˜¯æ»šåŠ¨æ›´æ–°</span></span><br><span class=\"line\">    <span class=\"attr\">type:</span> <span class=\"string\">RollingUpdate</span>              <span class=\"comment\"># é»˜è®¤ä¸ºæ»šåŠ¨æ›´æ–°ç­–ç•¥ï¼Œè¿˜å¯ä»¥è®¾ç½®ä¸º Recreateï¼šåœ¨åˆ›å»ºæ–°podä¹‹å‰ï¼Œå…ˆåˆ é™¤æ‰€æœ‰ç°æœ‰çš„pod</span></span><br><span class=\"line\">    <span class=\"attr\">rollingUpdate:</span>                   <span class=\"comment\"># æ»šåŠ¨æ›´æ–°æ–¹å¼ï¼Œtype: RollingUpdate æ—¶æœ‰æ•ˆ</span></span><br><span class=\"line\">      <span class=\"attr\">maxSurge:</span> <span class=\"number\">30</span><span class=\"string\">%</span>                  <span class=\"comment\"># æœ€å¤§é¢å¤–å¯ä»¥å­˜åœ¨çš„å‰¯æœ¬æ•°ï¼Œå¯ä»¥ä¸ºç™¾åˆ†æ¯”ï¼Œä¹Ÿå¯ä»¥ä¸ºæ•´æ•°ï¼Œé»˜è®¤ä¸º 25%</span></span><br><span class=\"line\">      <span class=\"attr\">maxUnavailable:</span> <span class=\"number\">30</span><span class=\"string\">%</span>            <span class=\"comment\"># æœ€å¤§ä¸å¯ç”¨çŠ¶æ€çš„ Pod çš„æœ€å¤§å€¼ï¼Œå¯ä»¥ä¸ºç™¾åˆ†æ¯”ï¼Œä¹Ÿå¯ä»¥ä¸ºæ•´æ•°ï¼Œé»˜è®¤ä¸º 25%</span></span><br><span class=\"line\">  <span class=\"attr\">template:</span>                          <span class=\"comment\"># æ¨¡æ¿ï¼Œå®šä¹‰ Pod çš„å†…å®¹ï¼Œå…·ä½“å¯ä»¥å‚è€ƒ Pod çš„é…ç½®</span></span><br><span class=\"line\">    <span class=\"attr\">metadata:</span></span><br><span class=\"line\">      <span class=\"attr\">labels:</span></span><br><span class=\"line\">        <span class=\"attr\">app:</span> <span class=\"string\">nginx</span>                   <span class=\"comment\"># Pod çš„æ ‡ç­¾ï¼Œå¿…é¡»ä¸ selector ä¸­çš„ matchLabels ä¸€è‡´</span></span><br><span class=\"line\">    <span class=\"attr\">spec:</span></span><br><span class=\"line\">      <span class=\"attr\">containers:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">image:</span> <span class=\"string\">nginx</span>                 <span class=\"comment\"># å®¹å™¨ä½¿ç”¨çš„é•œåƒï¼Œè¿™é‡Œæ˜¯å®˜æ–¹çš„ nginx é•œåƒ</span></span><br><span class=\"line\">        <span class=\"attr\">name:</span> <span class=\"string\">nginx</span>                  <span class=\"comment\"># å®¹å™¨çš„åç§°</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># éœ€è¦æ–°äº†è§£çš„é…ç½®é¡¹å°±æ˜¯specä¸‹é¢å‡ ä¸ªé€‰é¡¹ï¼š</span></span><br><span class=\"line\"><span class=\"comment\"># replicasï¼šæŒ‡å®šå‰¯æœ¬æ•°é‡ï¼Œå…¶å®å°±æ˜¯å½“å‰rsåˆ›å»ºå‡ºæ¥çš„podçš„æ•°é‡ï¼Œé»˜è®¤ä¸º1</span></span><br><span class=\"line\"><span class=\"comment\"># selectorï¼šé€‰æ‹©å™¨ï¼Œå®ƒçš„ä½œç”¨æ˜¯å»ºç«‹podæ§åˆ¶å™¨å’Œpodä¹‹é—´çš„å…³è”å…³ç³»ï¼Œé‡‡ç”¨çš„Label Selectoræœºåˆ¶ï¼Œåœ¨podæ¨¡æ¿ä¸Šå®šä¹‰labelï¼Œåœ¨æ§åˆ¶å™¨ä¸Šå®šä¹‰é€‰æ‹©å™¨ï¼Œå°±å¯ä»¥è¡¨æ˜å½“å‰æ§åˆ¶å™¨èƒ½ç®¡ç†å“ªäº›podäº†</span></span><br><span class=\"line\"><span class=\"comment\"># templateï¼šæ¨¡æ¿ï¼Œå°±æ˜¯å½“å‰æ§åˆ¶å™¨åˆ›å»ºpodæ‰€ä½¿ç”¨çš„æ¨¡æ¿ï¼Œé‡Œé¢å…¶å®å°±æ˜¯å‰ä¸€ç« å­¦è¿‡çš„podçš„å®šä¹‰</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è·å– deployment çš„ yaml æ–‡ä»¶é…ç½®é¡¹å¸®åŠ©</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æ¯”å¦‚ï¼Œè¿™é‡ŒæŸ¥çœ‹ç”¨æ–°Podæ›¿æ¢ç°æœ‰Podçš„éƒ¨ç½²ç­–ç•¥</span></span><br><span class=\"line\">$ kubectl explain deployment.spec.strategy</span><br><span class=\"line\"><span class=\"comment\">## è¾“å‡ºç»“æœ</span></span><br><span class=\"line\">DESCRIPTION:</span><br><span class=\"line\">    The deployment strategy to use to replace existing pods with new ones.</span><br><span class=\"line\">    DeploymentStrategy describes how to replace existing pods with new ones.</span><br><span class=\"line\"></span><br><span class=\"line\">FIELDS:</span><br><span class=\"line\">  rollingUpdate\t&lt;RollingUpdateDeployment&gt;</span><br><span class=\"line\">    Rolling update config params. Present only <span class=\"keyword\">if</span> DeploymentStrategyType =</span><br><span class=\"line\">    RollingUpdate.</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"built_in\">type</span>\t&lt;string&gt;</span><br><span class=\"line\">  enum: Recreate, RollingUpdate</span><br><span class=\"line\">    Type of deployment. Can be <span class=\"string\">&quot;Recreate&quot;</span> or <span class=\"string\">&quot;RollingUpdate&quot;</span>. Default is</span><br><span class=\"line\">        RollingUpdate.</span><br><span class=\"line\"></span><br><span class=\"line\">        Possible enum values:</span><br><span class=\"line\">        <span class=\"comment\"># åœ¨åˆ›å»ºæ–°podä¹‹å‰ï¼Œå…ˆåˆ é™¤æ‰€æœ‰ç°æœ‰çš„pod</span></span><br><span class=\"line\">        - `<span class=\"string\">&quot;Recreate&quot;</span>` Kill all existing pods before creating new ones.</span><br><span class=\"line\">        <span class=\"comment\"># ä½¿ç”¨æ»šåŠ¨æ›´æ–°æ–¹å¼ç”¨æ–°çš„ ReplicaSet æ›¿æ¢æ—§çš„ ReplicaSetæ›´æ–°ï¼Œå³é€æ­¥ç¼©å‡æ—§çš„ReplicaSetå¹¶æ‰©å¤§æ–°çš„ReplicaSet</span></span><br><span class=\"line\">        - `<span class=\"string\">&quot;RollingUpdate&quot;</span>` Replace the old ReplicaSets by new one using rolling update i.e gradually scale down the old ReplicaSets and scale up the new one.</span><br></pre></td></tr></table></figure>\n<div class=\"tips\">\n<p><em><strong>å°è´´å£«</strong></em></p>\n<ul class=\"lvl-1\">\n<li class=\"lvl-2\">yaml æ–‡ä»¶ä¸­ï¼Œå‡ºç°äº† <code>metadata.labels</code>,<code>spec.selector.matchLabels</code> ä»¥åŠ <code>template.metadata.labels</code>ï¼Œä¸‰è€…æ˜¯ä»€ä¹ˆå…³ç³»ï¼Ÿ</li>\n</ul>\n<ol>\n<li class=\"lvl-3\">metadata.labelsï¼ˆDeployment çš„æ ‡ç­¾ï¼‰</li>\n</ol>\n<blockquote>\n<p>ç»™ Deployment æœ¬èº« æ‰“çš„æ ‡ç­¾, å’Œ Pod æ²¡æœ‰ç›´æ¥ç®¡ç†å…³ç³»<br>\nå¸¸ç”¨äºèµ„æºåˆ†ç»„ã€æŸ¥æ‰¾ï¼ˆæ¯”å¦‚ï¼škubectl get deploy -l app=nginxï¼‰</p>\n</blockquote>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">labels:</span></span><br><span class=\"line\">    <span class=\"attr\">app:</span> <span class=\"string\">nginx</span>   <span class=\"comment\"># å±äºè¿™ä¸ª Deployment çš„â€œæ ‡ç­¾â€ï¼Œåªæ˜¯æ ‡è¯†å®ƒè‡ªå·±</span></span><br></pre></td></tr></table></figure>\n<ol start=\"2\">\n<li class=\"lvl-3\">\n<p>spec.selector.matchLabelsï¼ˆé€‰æ‹©å™¨ï¼‰</p>\n</li>\n</ol>\n<blockquote>\n<p>æŒ‡å®š Deployment è¦ç®¡ç†å“ªäº› Pod<br>\nå¿…é¡»ç²¾ç¡®åŒ¹é… Pod çš„æ ‡ç­¾<br>\nå†³å®š Deployment ä¼šä¸ä¼šâ€œæ¥ç®¡â€æŸäº› Pod</p>\n</blockquote>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">selector:</span></span><br><span class=\"line\">    <span class=\"attr\">matchLabels:</span></span><br><span class=\"line\">      <span class=\"attr\">app:</span> <span class=\"string\">nginx</span></span><br></pre></td></tr></table></figure>\n<ol start=\"3\">\n<li class=\"lvl-3\">\n<p>template.metadata.labelsï¼ˆæ¨¡æ¿ä¸­çš„ Pod æ ‡ç­¾ï¼‰</p>\n</li>\n</ol>\n<blockquote>\n<p>Pod æ¨¡æ¿ä¸­å®šä¹‰çš„æ ‡ç­¾<br>\nDeployment æŒ‰è¿™ä¸ªæ¨¡æ¿åˆ›å»º Pod<br>\nå¿…é¡»ä¸ matchLabels å®Œå…¨ä¸€è‡´ï¼Œå¦åˆ™ä¼šæŠ¥é”™</p>\n</blockquote>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">template:</span></span><br><span class=\"line\">  <span class=\"attr\">metadata:</span></span><br><span class=\"line\">    <span class=\"attr\">labels:</span></span><br><span class=\"line\">      <span class=\"attr\">app:</span> <span class=\"string\">nginx</span>   <span class=\"comment\"># Pod çš„æ ‡ç­¾ï¼Œå¿…é¡»ä¸ selector åŒ¹é…ï¼</span></span><br></pre></td></tr></table></figure>\n<p>ğŸ” å…³ç³»å›¾ç¤ºæ„ï¼š</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">Deployment</span></span><br><span class=\"line\"><span class=\"string\">â”‚</span></span><br><span class=\"line\"><span class=\"string\">â”œâ”€</span> <span class=\"string\">metadata.labels</span>                <span class=\"string\">â†</span> <span class=\"string\">Deployment</span> <span class=\"string\">æœ¬èº«çš„æ ‡ç­¾ï¼ˆéå…³é”®ï¼‰</span></span><br><span class=\"line\"><span class=\"string\">â”‚</span></span><br><span class=\"line\"><span class=\"string\">â”œâ”€</span> <span class=\"string\">spec.selector.matchLabels</span> <span class=\"string\">â”€â”</span></span><br><span class=\"line\"><span class=\"string\">â”‚</span>                             <span class=\"string\">â”‚</span></span><br><span class=\"line\"><span class=\"string\">â””â”€</span> <span class=\"string\">spec.template.metadata.labels</span> <span class=\"string\">â†</span> <span class=\"string\">å¿…é¡»åŒ¹é…</span> <span class=\"string\">selectorï¼Œæ‰èƒ½è®©</span> <span class=\"string\">Pod</span> <span class=\"string\">è¢«</span> <span class=\"string\">Deployment</span> <span class=\"string\">ç®¡ç†</span></span><br></pre></td></tr></table></figure>\n</div>\n<h3 id=\"Deployment-æ‰©ç¼©å®¹\">Deployment æ‰©ç¼©å®¹</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æ‰©å®¹åˆ°5ä¸ªï¼ŒåŸå…ˆæœ‰3ä¸ªï¼Œè¿™é‡Œä¼šå†åˆ›å»º2ä¸ª</span></span><br><span class=\"line\">kubectl scale deployment nginx --replicas=5</span><br><span class=\"line\"><span class=\"comment\"># ç¼©å®¹åˆ°3ä¸ªï¼ŒåŸå…ˆæœ‰5ä¸ªï¼Œè¿™é‡Œä¼šåˆ é™¤2ä¸ª</span></span><br><span class=\"line\">kubectl scale deployment nginx --replicas=3</span><br></pre></td></tr></table></figure>\n<h3 id=\"æŸ¥çœ‹-Deployment\">æŸ¥çœ‹ Deployment</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹ Deployment ï¼Œé»˜è®¤æ˜¾ç¤º default å‘½åç©ºé—´ä¸‹çš„ deployments</span></span><br><span class=\"line\">kubectl get deployments</span><br><span class=\"line\">kubectl get deploy <span class=\"comment\"># ç®€ç§°</span></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹ kube-system å‘½åç©ºé—´ä¸‹çš„ Deployment</span></span><br><span class=\"line\">kubectl get deploy -n kube-system</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹æ‰€æœ‰å‘½åç©ºé—´ä¸‹çš„ Deployment</span></span><br><span class=\"line\">kubectl get deploy -A</span><br><span class=\"line\"><span class=\"comment\"># -o wide: æ˜¾ç¤º deploy çš„è¯¦ç»†ä¿¡æ¯</span></span><br><span class=\"line\">kubectl get deployments -o wide</span><br><span class=\"line\"><span class=\"comment\"># æ˜¾ç¤º Deployment çš„æ ‡ç­¾</span></span><br><span class=\"line\">kubectl get deploy --show-labels</span><br><span class=\"line\"><span class=\"comment\"># æŒ‰ Deployment çš„æ ‡ç­¾è¿›ç¨‹æŸ¥è¯¢</span></span><br><span class=\"line\">kubectl get deploy -l &lt;label_name&gt;=&lt;label_value&gt;</span><br><span class=\"line\"><span class=\"comment\"># æŒç»­æŸ¥çœ‹ Deployment çš„çŠ¶æ€ï¼Œå½“ Deployment çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶ï¼Œä¼šå®æ—¶æ˜¾ç¤º</span></span><br><span class=\"line\">kubectl get deploy -w</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹ podã€deployã€replicaset</span></span><br><span class=\"line\">$ k get pod,deploy,rs -owide</span><br><span class=\"line\">NAME                         READY   STATUS    RESTARTS   AGE    IP              NODE          NOMINATED NODE   READINESS GATES</span><br><span class=\"line\">pod/nginx-5869d7778c-4sqwf   1/1     Running   0          105s   10.244.126.11   k8s-worker2   &lt;none&gt;           &lt;none&gt;</span><br><span class=\"line\">pod/nginx-5869d7778c-kn6pg   1/1     Running   0          105s   10.244.126.12   k8s-worker2   &lt;none&gt;           &lt;none&gt;</span><br><span class=\"line\">pod/nginx-5869d7778c-zkwkd   1/1     Running   0          18m    10.244.194.82   k8s-worker1   &lt;none&gt;           &lt;none&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">NAME                    READY   UP-TO-DATE   AVAILABLE   AGE   CONTAINERS   IMAGES   SELECTOR</span><br><span class=\"line\">deployment.apps/nginx   3/3     3            3           18m   nginx        nginx    app=nginx</span><br><span class=\"line\"></span><br><span class=\"line\">NAME                               DESIRED   CURRENT   READY   AGE   CONTAINERS   IMAGES   SELECTOR</span><br><span class=\"line\">replicaset.apps/nginx-5869d7778c   3         3         3       18m   nginx        nginx    app=nginx,pod-template-hash=5869d7778c</span><br></pre></td></tr></table></figure>\n<h3 id=\"è®¿é—®podä¸­çš„nginxæœåŠ¡\">è®¿é—®podä¸­çš„nginxæœåŠ¡</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ­¤æ—¶æˆ‘ä»¬è¿˜æ²¡æœ‰åˆ›å»º <code>Service</code>(åé¢ç« èŠ‚ä¼šä»‹ç»)ï¼Œæ‰€ä»¥åªèƒ½é€šè¿‡ Pod çš„ IP è®¿é—®</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ä»»æ„podçš„IPï¼Œç«¯å£80</span></span><br><span class=\"line\">curl http://10.244.194.82</span><br></pre></td></tr></table></figure>\n<h3 id=\"æŸ¥çœ‹-Deployment-è¯¦æƒ…\">æŸ¥çœ‹ Deployment è¯¦æƒ…</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å½“ Deployment è¿è¡Œé”™è¯¯æ—¶ï¼Œå¯ä»¥é€šè¿‡è¯¥å‘½ä»¤æŸ¥çœ‹ Deployment çš„è¯¦æƒ…ï¼Œæ‰¾åˆ°é”™è¯¯åŸå› </p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl describe deploy &lt;deploy-name&gt;</span><br><span class=\"line\">kubectl describe deploy &lt;deploy-name&gt; -n &lt;namespace-name&gt;</span><br></pre></td></tr></table></figure>\n<h3 id=\"åˆ é™¤-Deployment\">åˆ é™¤ Deployment</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl delete deploy &lt;deploy-name&gt;</span><br><span class=\"line\">kubectl delete deploy &lt;deploy-name&gt; -n &lt;namespace-name&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># é€šè¿‡ yaml æ–‡ä»¶åˆ é™¤</span></span><br><span class=\"line\">kubectl delete -f &lt;yaml-file&gt;</span><br></pre></td></tr></table></figure>\n<h3 id=\"æŸ¥çœ‹-Deployment-æ—¥å¿—\">æŸ¥çœ‹ Deployment æ—¥å¿—</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl logs deploy/&lt;deploy-name&gt;</span><br><span class=\"line\">kubectl logs deploy/&lt;deploy-name&gt; -n &lt;namespace-name&gt;</span><br></pre></td></tr></table></figure>\n<h3 id=\"æ»šåŠ¨å‡çº§ä¸å›æ»š-Deployment\">æ»šåŠ¨å‡çº§ä¸å›æ»š Deployment</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¯¹ <code>RollingUpdate</code> ç±»å‹çš„ <code>Deployment</code> çš„ <code>.spec.template</code> çš„ä»»ä½•æ›´æ–°éƒ½å°†è§¦å‘æ»šåŠ¨æ›´æ–°ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>æˆ‘ä»¬ä¿®æ”¹è¿‡ <code>Deployment</code> çš„ <code>.spec.template</code>ï¼Œå¹¶ä¿å­˜åï¼Œé‡æ–°è¿è¡Œ <code>kubectl apply -f &lt;yaml-file&gt;</code>å³å¯è§¦å‘æ»šåŠ¨å‡çº§ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>é€šè¿‡<code>kubectl edit deploy &lt;deploy-name&gt;</code>ä¿®æ”¹<code>.spec.template</code>ï¼Œä¹Ÿä¼šè§¦å‘æ»šåŠ¨å‡çº§ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å¦‚æœåªæ˜¯æ›´æ–°å®¹å™¨çš„é•œåƒï¼Œä¹Ÿå¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤è§¦å‘æ»šåŠ¨å‡çº§</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># set image: è¿™é‡Œè¡¨ç¤ºè¦æ”¹å˜çš„æ˜¯é•œåƒï¼Œ --record=true è¡¨ç¤ºè®°å½•æ­¤æ¬¡æ“ä½œ</span></span><br><span class=\"line\"><span class=\"comment\"># kubectl set image deploy &lt;deploy-name&gt; &lt;container-name&gt;=&lt;image-name&gt;:&lt;tag&gt;</span></span><br><span class=\"line\">kubectl <span class=\"built_in\">set</span> image deploy nginx nginx=nginx:1.9.1 --record=<span class=\"literal\">true</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æŸ¥çœ‹å†å²ç‰ˆæœ¬</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å‰é¢çš„åºå·è¡¨ç¤ºç‰ˆæœ¬å·</span></span><br><span class=\"line\">$ kubectl rollout <span class=\"built_in\">history</span> deploy nginx</span><br><span class=\"line\">deployment.apps/nginx</span><br><span class=\"line\">REVISION  CHANGE-CAUSE</span><br><span class=\"line\">1         &lt;none&gt;</span><br><span class=\"line\">2         kubectl <span class=\"built_in\">set</span> image deploy nginx nginx=nginx:1.9.1 --record=<span class=\"literal\">true</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹æŒ‡å®šç‰ˆæœ¬çš„è¯¦æƒ…</span></span><br><span class=\"line\">kubectl rollout <span class=\"built_in\">history</span> deploy nginx --revision=1</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æŸ¥çœ‹æ›´æ–°çŠ¶æ€</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl rollout status deploy nginx</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å›æ»š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å›é€€åˆ°å‰ä¸€ä¸ªç‰ˆæœ¬</span></span><br><span class=\"line\">kubectl rollout undo deploy nginx</span><br><span class=\"line\"><span class=\"comment\"># å›åˆ°æŒ‡å®šç‰ˆæœ¬ï¼Œè¿™é‡Œ --to-revision=1 è¡¨ç¤ºå›åˆ°ç‰ˆæœ¬1</span></span><br><span class=\"line\">kubectl rollout undo deploy nginx --to-revision=1</span><br></pre></td></tr></table></figure>\n<h3 id=\"é‡å¯-Deployment\">é‡å¯ Deployment</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ»šåŠ¨é‡å¯</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># kubectl rollout restart deployment &lt;deployment-name&gt; -n &lt;namespace&gt;</span></span><br><span class=\"line\">kubectl rollout restart deploy nginx</span><br></pre></td></tr></table></figure>\n","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» K8S çš„ Deploymentï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚ K8Så®˜ç½‘ k8s Github k8s Deployment ä»‹ç» Deployment(ç¼©å†™ä¸º deploy) ä»‹ç» åœ¨ä½¿ç”¨k8såˆ›å»ºå®¹å™¨æ—¶ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä¸ä¼šç›´æ¥åˆ›å»ºpodï¼Œè€Œæ˜¯åˆ›å»º deploymentï¼ŒdaemonSetï¼ŒStatefulSetç­‰ç­‰ã€‚ Deployment ç”¨äºç®¡ç†è¿è¡Œä¸€ä¸ªåº”ç”¨è´Ÿè½½çš„ä¸€ç»„ Podï¼Œé€šå¸¸é€‚ç”¨äºä¸ä¿æŒçŠ¶æ€çš„è´Ÿè½½ã€‚ Deployment æ˜¯æœ€å¸¸ç”¨çš„æ— çŠ¶æ€æœåŠ¡æ§åˆ¶å™¨ï¼Œç”±Deploymentã€ReplicaSetã€Podç»„æˆã€æ”¯æŒé›†ç¾¤æ‰©å®¹ç¼©å®¹ã€æ»šåŠ¨ã€æ›´æ–°ã€è‡ªåŠ¨ç»´æŠ¤Podå¯ç”¨æ€§åŠå‰¯æœ¬æ•°é‡ç­‰åŠŸèƒ½ï¼ŒReplicaSetå’ŒPodç”±Deploymentè‡ªåŠ¨ç®¡ç†ï¼Œç”¨æˆ·æ— éœ€å¹²é¢„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåˆ›å»ºä¸€ä¸ªDeploymentåï¼ŒK8Sä¼šè‡ªåŠ¨åˆ›å»ºReplicaSetï¼Œå¹¶åˆ›å»ºæŒ‡å®šæ•°é‡çš„Podã€‚ Deployment ç®¡ç† Deployment åˆ›å»º create åˆ›å»º 12345678# åˆ›å»º deploymentkubectl create deployment nginx --image=nginx# å¤šå‰¯æœ¬ï¼Œ--replicas=3 åˆ›å»º3ä¸ªå‰¯æœ¬kubectl create deployment nginx --image=nginx --replicas=3# -o ç”Ÿæˆ yaml æ–‡ä»¶, --dry-run: ä¸çœŸçš„æ‰§è¡Œåˆ›å»ºkubectl create deployment nginx --image=nginx --replicas=3 --dry-run=client -o yaml &gt; deployment.yaml# é€šè¿‡ yaml æ–‡ä»¶åˆ›å»ºkubectl apply -f deployment.yaml ä¸€ä¸ªç®€å•çš„ deployment.yaml æ–‡ä»¶è¯´æ˜ 1234567891011121314151617181920212223242526272829apiVersion: apps/v1 # æŒ‡å®šä½¿ç”¨çš„ API ç‰ˆæœ¬ï¼Œè¿™é‡Œæ˜¯ apps/v1ï¼Œé€‚ç”¨äº Deployment èµ„æºkind: Deployment # Kubernetes èµ„æºç±»å‹ï¼Œè¿™é‡Œæ˜¯éƒ¨ç½²ï¼ˆDeploymentï¼‰metadata: labels: app: nginx # æ ‡ç­¾ï¼Œç”¨äºæ ‡è¯†èµ„æºï¼Œå¯ä¸ selector åŒ¹é… name: nginx # èµ„æºåç§°ï¼Œå¿…é¡»å”¯ä¸€ï¼ˆåœ¨åŒä¸€å‘½åç©ºé—´ä¸‹ï¼‰spec: # é…ç½®é¡¹ replicas: 3 # å‰¯æœ¬æ•°ï¼Œè¡¨ç¤ºå¸Œæœ›è¿è¡Œå¤šå°‘ä¸ª Pod å®ä¾‹ selector: # é€‰æ‹©å™¨ï¼ŒæŒ‡å®šè¦ç®¡ç†çš„ Pod matchLabels: # æ ‡ç­¾é€‰æ‹©å™¨ app: nginx # é€‰æ‹©å™¨ï¼ŒæŒ‡å®š Deployment ç®¡ç†å“ªäº› Podï¼ˆæ ‡ç­¾å¿…é¡»ä¸ template ä¸­åŒ¹é…ï¼‰ strategy: # ç”¨æ–°Podæ›¿æ¢ç°æœ‰Podçš„éƒ¨ç½²ç­–ç•¥ï¼Œå¯çœç•¥ï¼Œé»˜è®¤å°±æ˜¯æ»šåŠ¨æ›´æ–° type: RollingUpdate # é»˜è®¤ä¸ºæ»šåŠ¨æ›´æ–°ç­–ç•¥ï¼Œè¿˜å¯ä»¥è®¾ç½®ä¸º Recreateï¼šåœ¨åˆ›å»ºæ–°podä¹‹å‰ï¼Œå…ˆåˆ é™¤æ‰€æœ‰ç°æœ‰çš„pod rollingUpdate: # æ»šåŠ¨æ›´æ–°æ–¹å¼ï¼Œtype: RollingUpdate æ—¶æœ‰æ•ˆ maxSurge: 30% # æœ€å¤§é¢å¤–å¯ä»¥å­˜åœ¨çš„å‰¯æœ¬æ•°ï¼Œå¯ä»¥ä¸ºç™¾åˆ†æ¯”ï¼Œä¹Ÿå¯ä»¥ä¸ºæ•´æ•°ï¼Œé»˜è®¤ä¸º 25% maxUnavailable: 30% # æœ€å¤§ä¸å¯ç”¨çŠ¶æ€çš„ Pod çš„æœ€å¤§å€¼ï¼Œå¯ä»¥ä¸ºç™¾åˆ†æ¯”ï¼Œä¹Ÿå¯ä»¥ä¸ºæ•´æ•°ï¼Œé»˜è®¤ä¸º 25% template: # æ¨¡æ¿ï¼Œå®šä¹‰ Pod çš„å†…å®¹ï¼Œå…·ä½“å¯ä»¥å‚è€ƒ Pod çš„é…ç½® metadata: labels: app: nginx # Pod çš„æ ‡ç­¾ï¼Œå¿…é¡»ä¸ selector ä¸­çš„ matchLabels ä¸€è‡´ spec: containers: - image: nginx # å®¹å™¨ä½¿ç”¨çš„é•œåƒï¼Œè¿™é‡Œæ˜¯å®˜æ–¹çš„ nginx é•œåƒ name: nginx # å®¹å™¨çš„åç§°# éœ€è¦æ–°äº†è§£çš„é…ç½®é¡¹å°±æ˜¯specä¸‹é¢å‡ ä¸ªé€‰é¡¹ï¼š# replicasï¼šæŒ‡å®šå‰¯æœ¬æ•°é‡ï¼Œå…¶å®å°±æ˜¯å½“å‰rsåˆ›å»ºå‡ºæ¥çš„podçš„æ•°é‡ï¼Œé»˜è®¤ä¸º1# selectorï¼šé€‰æ‹©å™¨ï¼Œå®ƒçš„ä½œç”¨æ˜¯å»ºç«‹podæ§åˆ¶å™¨å’Œpodä¹‹é—´çš„å…³è”å…³ç³»ï¼Œé‡‡ç”¨çš„Label Selectoræœºåˆ¶ï¼Œåœ¨podæ¨¡æ¿ä¸Šå®šä¹‰labelï¼Œåœ¨æ§åˆ¶å™¨ä¸Šå®šä¹‰é€‰æ‹©å™¨ï¼Œå°±å¯ä»¥è¡¨æ˜å½“å‰æ§åˆ¶å™¨èƒ½ç®¡ç†å“ªäº›podäº†# templateï¼šæ¨¡æ¿ï¼Œå°±æ˜¯å½“å‰æ§åˆ¶å™¨åˆ›å»ºpodæ‰€ä½¿ç”¨çš„æ¨¡æ¿ï¼Œé‡Œé¢å…¶å®å°±æ˜¯å‰ä¸€ç« å­¦è¿‡çš„podçš„å®šä¹‰ è·å– deployment çš„ yaml æ–‡ä»¶é…ç½®é¡¹å¸®åŠ© 12345678910111213141516171819202122# æ¯”å¦‚ï¼Œè¿™é‡ŒæŸ¥çœ‹ç”¨æ–°Podæ›¿æ¢ç°æœ‰Podçš„éƒ¨ç½²ç­–ç•¥$ kubectl explain deployment.spec.strategy## è¾“å‡ºç»“æœDESCRIPTION: The deployment strategy to use to replace existing pods with new ones. DeploymentStrategy describes how to replace existing pods with new ones.FIELDS: rollingUpdate &lt;RollingUpdateDeployment&gt; Rolling update config params. Present only if DeploymentStrategyType = RollingUpdate. type &lt;string&gt; enum: Recreate, RollingUpdate Type of deployment. Can be &quot;Recreate&quot; or &quot;RollingUpdate&quot;. Default is RollingUpdate. Possible enum values: # åœ¨åˆ›å»ºæ–°podä¹‹å‰ï¼Œå…ˆåˆ é™¤æ‰€æœ‰ç°æœ‰çš„pod - `&quot;Recreate&quot;` Kill all existing pods before creating new ones. # ä½¿ç”¨æ»šåŠ¨æ›´æ–°æ–¹å¼ç”¨æ–°çš„ ReplicaSet æ›¿æ¢æ—§çš„ ReplicaSetæ›´æ–°ï¼Œå³é€æ­¥ç¼©å‡æ—§çš„ReplicaSetå¹¶æ‰©å¤§æ–°çš„ReplicaSet - `&quot;RollingUpdate&quot;` Replace the old ReplicaSets by new one using rolling update i.e gradually scale down the old ReplicaSets and scale up the new one. å°è´´å£« yaml æ–‡ä»¶ä¸­ï¼Œå‡ºç°äº† metadata.labels,spec.selector.matchLabels ä»¥åŠ template.metadata.labelsï¼Œä¸‰è€…æ˜¯ä»€ä¹ˆå…³ç³»ï¼Ÿ metadata.labelsï¼ˆDeployment çš„æ ‡ç­¾ï¼‰ ç»™ Deployment æœ¬èº« æ‰“çš„æ ‡ç­¾, å’Œ Pod æ²¡æœ‰ç›´æ¥ç®¡ç†å…³ç³» å¸¸ç”¨äºèµ„æºåˆ†ç»„ã€æŸ¥æ‰¾ï¼ˆæ¯”å¦‚ï¼škubectl get deploy -l app=nginxï¼‰ 123metadata: labels: app: nginx # å±äºè¿™ä¸ª Deployment çš„â€œæ ‡ç­¾â€ï¼Œåªæ˜¯æ ‡è¯†å®ƒè‡ªå·± spec.selector.matchLabelsï¼ˆé€‰æ‹©å™¨ï¼‰ æŒ‡å®š Deployment è¦ç®¡ç†å“ªäº› Pod å¿…é¡»ç²¾ç¡®åŒ¹é… Pod çš„æ ‡ç­¾ å†³å®š Deployment ä¼šä¸ä¼šâ€œæ¥ç®¡â€æŸäº› Pod 1234spec: selector: matchLabels: app: nginx template.metadata.labelsï¼ˆæ¨¡æ¿ä¸­çš„ Pod æ ‡ç­¾ï¼‰ Pod æ¨¡æ¿ä¸­å®šä¹‰çš„æ ‡ç­¾ Deployment æŒ‰è¿™ä¸ªæ¨¡æ¿åˆ›å»º Pod å¿…é¡»ä¸ matchLabels å®Œå…¨ä¸€è‡´ï¼Œå¦åˆ™ä¼šæŠ¥é”™ 1234template: metadata: labels: app: nginx # Pod çš„æ ‡ç­¾ï¼Œå¿…é¡»ä¸ selector åŒ¹é…ï¼ ğŸ” å…³ç³»å›¾ç¤ºæ„ï¼š 1234567Deploymentâ”‚â”œâ”€ metadata.labels â† Deployment æœ¬èº«çš„æ ‡ç­¾ï¼ˆéå…³é”®ï¼‰â”‚â”œâ”€ spec.selector.matchLabels â”€â”â”‚ â”‚â””â”€ spec.template.metadata.labels â† å¿…é¡»åŒ¹é… selectorï¼Œæ‰èƒ½è®© Pod è¢« Deployment ç®¡ç† Deployment æ‰©ç¼©å®¹ 1234# æ‰©å®¹åˆ°5ä¸ªï¼ŒåŸå…ˆæœ‰3ä¸ªï¼Œè¿™é‡Œä¼šå†åˆ›å»º2ä¸ªkubectl scale deployment nginx --replicas=5# ç¼©å®¹åˆ°3ä¸ªï¼ŒåŸå…ˆæœ‰5ä¸ªï¼Œè¿™é‡Œä¼šåˆ é™¤2ä¸ªkubectl scale deployment nginx --replicas=3 æŸ¥çœ‹ Deployment 12345678910111213141516171819202122232425262728# æŸ¥çœ‹ Deployment ï¼Œé»˜è®¤æ˜¾ç¤º default å‘½åç©ºé—´ä¸‹çš„ deploymentskubectl get deploymentskubectl get deploy # ç®€ç§°# æŸ¥çœ‹ kube-system å‘½åç©ºé—´ä¸‹çš„ Deploymentkubectl get deploy -n kube-system# æŸ¥çœ‹æ‰€æœ‰å‘½åç©ºé—´ä¸‹çš„ Deploymentkubectl get deploy -A# -o wide: æ˜¾ç¤º deploy çš„è¯¦ç»†ä¿¡æ¯kubectl get deployments -o wide# æ˜¾ç¤º Deployment çš„æ ‡ç­¾kubectl get deploy --show-labels# æŒ‰ Deployment çš„æ ‡ç­¾è¿›ç¨‹æŸ¥è¯¢kubectl get deploy -l &lt;label_name&gt;=&lt;label_value&gt;# æŒç»­æŸ¥çœ‹ Deployment çš„çŠ¶æ€ï¼Œå½“ Deployment çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶ï¼Œä¼šå®æ—¶æ˜¾ç¤ºkubectl get deploy -w# æŸ¥çœ‹ podã€deployã€replicaset$ k get pod,deploy,rs -owideNAME READY STATUS RESTARTS AGE IP NODE NOMINATED NODE READINESS GATESpod/nginx-5869d7778c-4sqwf 1/1 Running 0 105s 10.244.126.11 k8s-worker2 &lt;none&gt; &lt;none&gt;pod/nginx-5869d7778c-kn6pg 1/1 Running 0 105s 10.244.126.12 k8s-worker2 &lt;none&gt; &lt;none&gt;pod/nginx-5869d7778c-zkwkd 1/1 Running 0 18m 10.244.194.82 k8s-worker1 &lt;none&gt; &lt;none&gt;NAME READY UP-TO-DATE AVAILABLE AGE CONTAINERS IMAGES SELECTORdeployment.apps/nginx 3/3 3 3 18m nginx nginx app=nginxNAME DESIRED CURRENT READY AGE CONTAINERS IMAGES SELECTORreplicaset.apps/nginx-5869d7778c 3 3 3 18m nginx nginx app=nginx,pod-template-hash=5869d7778c è®¿é—®podä¸­çš„nginxæœåŠ¡ æ­¤æ—¶æˆ‘ä»¬è¿˜æ²¡æœ‰åˆ›å»º Service(åé¢ç« èŠ‚ä¼šä»‹ç»)ï¼Œæ‰€ä»¥åªèƒ½é€šè¿‡ Pod çš„ IP è®¿é—® 12# ä»»æ„podçš„IPï¼Œç«¯å£80curl http://10.244.194.82 æŸ¥çœ‹ Deployment è¯¦æƒ… å½“ Deployment è¿è¡Œé”™è¯¯æ—¶ï¼Œå¯ä»¥é€šè¿‡è¯¥å‘½ä»¤æŸ¥çœ‹ Deployment çš„è¯¦æƒ…ï¼Œæ‰¾åˆ°é”™è¯¯åŸå›  12kubectl describe deploy &lt;deploy-name&gt;kubectl describe deploy &lt;deploy-name&gt; -n &lt;namespace-name&gt; åˆ é™¤ Deployment 12345kubectl delete deploy &lt;deploy-name&gt;kubectl delete deploy &lt;deploy-name&gt; -n &lt;namespace-name&gt;# é€šè¿‡ yaml æ–‡ä»¶åˆ é™¤kubectl delete -f &lt;yaml-file&gt; æŸ¥çœ‹ Deployment æ—¥å¿— 12kubectl logs deploy/&lt;deploy-name&gt;kubectl logs deploy/&lt;deploy-name&gt; -n &lt;namespace-name&gt; æ»šåŠ¨å‡çº§ä¸å›æ»š Deployment å¯¹ RollingUpdate ç±»å‹çš„ Deployment çš„ .spec.template çš„ä»»ä½•æ›´æ–°éƒ½å°†è§¦å‘æ»šåŠ¨æ›´æ–°ã€‚ æˆ‘ä»¬ä¿®æ”¹è¿‡ Deployment çš„ .spec.templateï¼Œå¹¶ä¿å­˜åï¼Œé‡æ–°è¿è¡Œ kubectl apply -f &lt;yaml-file&gt;å³å¯è§¦å‘æ»šåŠ¨å‡çº§ã€‚ é€šè¿‡kubectl edit deploy &lt;deploy-name&gt;ä¿®æ”¹.spec.templateï¼Œä¹Ÿä¼šè§¦å‘æ»šåŠ¨å‡çº§ã€‚ å¦‚æœåªæ˜¯æ›´æ–°å®¹å™¨çš„é•œåƒï¼Œä¹Ÿå¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤è§¦å‘æ»šåŠ¨å‡çº§ 123# set image: è¿™é‡Œè¡¨ç¤ºè¦æ”¹å˜çš„æ˜¯é•œåƒï¼Œ --record=true è¡¨ç¤ºè®°å½•æ­¤æ¬¡æ“ä½œ# kubectl set image deploy &lt;deploy-name&gt; &lt;container-name&gt;=&lt;image-name&gt;:&lt;tag&gt;kubectl set image deploy nginx nginx=nginx:1.9.1 --record=true æŸ¥çœ‹å†å²ç‰ˆæœ¬ 123456789# å‰é¢çš„åºå·è¡¨ç¤ºç‰ˆæœ¬å·$ kubectl rollout history deploy nginxdeployment.apps/nginxREVISION CHANGE-CAUSE1 &lt;none&gt;2 kubectl set image deploy nginx nginx=nginx:1.9.1 --record=true# æŸ¥çœ‹æŒ‡å®šç‰ˆæœ¬çš„è¯¦æƒ…kubectl rollout history deploy nginx --revision=1 æŸ¥çœ‹æ›´æ–°çŠ¶æ€ 1kubectl rollout status deploy nginx å›æ»š 1234# å›é€€åˆ°å‰ä¸€ä¸ªç‰ˆæœ¬kubectl rollout undo deploy nginx# å›åˆ°æŒ‡å®šç‰ˆæœ¬ï¼Œè¿™é‡Œ --to-revision=1 è¡¨ç¤ºå›åˆ°ç‰ˆæœ¬1kubectl rollout undo deploy nginx --to-revision=1 é‡å¯ Deployment æ»šåŠ¨é‡å¯ 12# kubectl rollout restart deployment &lt;deployment-name&gt; -n &lt;namespace&gt;kubectl rollout restart deploy nginx","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» K8S çš„ Deploymentï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚ K8Så®˜ç½‘ k8s Github k8s Deployment ä»‹ç»","date_published":"2025-07-14T14:30:05.000Z","tags":["æŠ€æœ¯","k8s","K8S"]},{"id":"https://blog.hanqunfeng.com/2025/07/04/k8s-pod/","url":"https://blog.hanqunfeng.com/2025/07/04/k8s-pod/","title":"K8S ä¹‹ Pod","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç» K8S çš„ Podï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://kubernetes.io/zh-cn/\">K8Så®˜ç½‘</a></p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://github.com/kubernetes/kubernetes\">k8s Github</a></p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://kubernetes.io/zh-cn/docs/concepts/workloads/pods/\">k8s Pod ä»‹ç»</a></p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"Pod-ä»‹ç»\">Pod ä»‹ç»</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Pod(ç¼©å†™ä¸º po) æ˜¯å¯ä»¥åœ¨ Kubernetes ä¸­åˆ›å»ºå’Œç®¡ç†çš„ã€æœ€å°çš„å¯éƒ¨ç½²çš„è®¡ç®—å•å…ƒã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>Podï¼ˆå°±åƒåœ¨è±Œè±†èšä¸­ï¼‰æ˜¯ä¸€ç»„ï¼ˆä¸€ä¸ªæˆ–å¤šä¸ªï¼‰ å®¹å™¨ï¼Œè¿™äº›å®¹å™¨å…±äº«å­˜å‚¨ã€ç½‘ç»œã€ä»¥åŠæ€æ ·è¿è¡Œè¿™äº›å®¹å™¨çš„è§„çº¦ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>Pod ä¸­çš„å†…å®¹æ€»æ˜¯å¹¶ç½®ï¼ˆcolocatedï¼‰çš„å¹¶ä¸”ä¸€åŒè°ƒåº¦ï¼Œåœ¨å…±äº«çš„ä¸Šä¸‹æ–‡ä¸­è¿è¡Œã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>Kubernetes é›†ç¾¤ä¸­çš„ Pod ä¸»è¦æœ‰ä¸¤ç§ç”¨æ³•ï¼š</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">è¿è¡Œå•ä¸ªå®¹å™¨çš„ Pod: &quot;æ¯ä¸ª Pod ä¸€ä¸ªå®¹å™¨&quot;æ¨¡å‹æ˜¯æœ€å¸¸è§çš„ Kubernetes ç”¨ä¾‹ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥å°† Pod çœ‹ä½œå•ä¸ªå®¹å™¨çš„åŒ…è£…å™¨ï¼Œå¹¶ä¸” Kubernetes ç›´æ¥ç®¡ç† Podï¼Œè€Œä¸æ˜¯å®¹å™¨ã€‚</li>\n<li class=\"lvl-4\">è¿è¡Œå¤šä¸ªååŒå·¥ä½œçš„å®¹å™¨çš„ Pod: Pod å¯ä»¥å°è£…ç”±ç´§å¯†è€¦åˆä¸”éœ€è¦å…±äº«èµ„æºçš„å¤šä¸ªå¹¶ç½®å®¹å™¨ç»„æˆçš„åº”ç”¨ï¼Œè¿™äº›ä½äºåŒä¸€ä½ç½®çš„å®¹å™¨æ„æˆä¸€ä¸ªå†…èšå•å…ƒã€‚<br>\n<img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/uPic/nLmg0X.png\" alt=\"\"></li>\n</ul>\n</li>\n</ul>\n<h2 id=\"Pod-ç®¡ç†\">Pod ç®¡ç†</h2>\n<h3 id=\"Pod-åˆ›å»º\">Pod åˆ›å»º</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><code>run</code> åˆ›å»º</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl run nginx --image=nginx</span><br><span class=\"line\"><span class=\"comment\"># è¾“å‡º yaml</span></span><br><span class=\"line\">kubectl run nginx --image=nginx --dry-run=client -o yaml &gt; pod.yaml</span><br><span class=\"line\"><span class=\"comment\"># é€šè¿‡ yaml æ–‡ä»¶åˆ›å»º</span></span><br><span class=\"line\">kubectl apply -f pod.yaml</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>pod ä¸­è‡³å°‘åŒ…å«ä¸¤ä¸ªå®¹å™¨ï¼Œä¸€ä¸ªæ˜¯ä¸šåŠ¡å®¹å™¨ï¼Œæ¯”å¦‚è¿™é‡Œçš„ nginxï¼Œå¦ä¸€ä¸ªæ˜¯ <code>pause</code> å®¹å™¨ï¼Œè´Ÿè´£å…±äº«å®¹å™¨çš„ç½‘ç»œï¼Œè¿›ç¨‹ï¼Œå­˜å‚¨ç­‰èµ„æºã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># é€šè¿‡ crictl ps æ˜¯çœ‹ä¸åˆ° pause å®¹å™¨çš„ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ ctr å‘½ä»¤æŸ¥çœ‹ï¼Œctr æ˜¯ containerd çš„å‘½ä»¤è¡Œå·¥å…·</span></span><br><span class=\"line\">ctr --namespace=k8s.io c <span class=\"built_in\">ls</span></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹å®¹å™¨æ‰€å±çš„pod</span></span><br><span class=\"line\">ctr --namespace=k8s.io c info &lt;container-id&gt; | grep <span class=\"string\">&#x27;pod.name&#x27;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"pod-yaml-æ–‡ä»¶è¯´æ˜\"><code>pod.yaml</code> æ–‡ä»¶è¯´æ˜</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å› ä¸º Pod ä¸æ”¯æŒæ‰©ç¼©å®¹ï¼Œæ‰€ä»¥æ—¥å¸¸ä½¿ç”¨æ—¶ä¸€èˆ¬ä¸ä¼šç›´æ¥åˆ›å»º Podï¼Œè€Œæ˜¯åˆ›å»º <code>Deployment</code>, <code>DaemonSet</code>ç­‰è¿™äº›å·¥ä½œè´Ÿè½½èµ„æºï¼Œè¿™äº›åé¢ä¼šä»‹ç»åˆ°ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä½†æˆ‘ä»¬è¿™é‡Œè¿˜æ˜¯è¦é‡ç‚¹ä»‹ç»ä¸€ä¸‹ Pod çš„ yaml æ–‡ä»¶æ ¼å¼ï¼Œå› ä¸ºå®ƒæ˜¯åé¢æ‰€æœ‰èµ„æºåˆ›å»ºçš„åŸºç¡€ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä¸€ä¸ªæœ€åŸºç¡€çš„ Pod é…ç½®å¦‚ä¸‹ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span>                   <span class=\"comment\"># å¿…å¡«ã€‚æŒ‡å®šä½¿ç”¨çš„ API ç‰ˆæœ¬ï¼ŒPod æ˜¯æ ¸å¿ƒèµ„æºï¼Œä½¿ç”¨ v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Pod</span>                        <span class=\"comment\"># å¿…å¡«ã€‚èµ„æºç±»å‹ï¼šPod</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span>                        <span class=\"comment\"># å¿…å¡«ã€‚å…ƒæ•°æ®ï¼ŒåŒ…å« Pod çš„åç§°ã€å‘½åç©ºé—´ã€æ ‡ç­¾ã€æ³¨è§£ç­‰ä¿¡æ¯</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">nginx</span>                    <span class=\"comment\"># å¿…å¡«ã€‚Pod çš„åç§°ï¼Œå‘½åç©ºé—´ä¸­å”¯ä¸€</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span>                            <span class=\"comment\"># å¿…å¡«ã€‚èµ„æºçš„ç‰¹æ€§æè¿°ï¼ˆè§„çº¦ï¼‰ï¼Œå®šä¹‰Podå…·ä½“è¡Œä¸ºçš„éƒ¨åˆ†</span></span><br><span class=\"line\">  <span class=\"attr\">containers:</span>                    <span class=\"comment\"># å¿…å¡«ã€‚å®¹å™¨åˆ—è¡¨</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">image:</span> <span class=\"string\">nginx</span>                 <span class=\"comment\"># å¿…å¡«ã€‚å®¹å™¨ä½¿ç”¨çš„é•œåƒ</span></span><br><span class=\"line\">    <span class=\"attr\">name:</span> <span class=\"string\">nginx</span>                  <span class=\"comment\"># å¿…å¡«ã€‚å®¹å™¨åç§°ï¼Œåœ¨åŒä¸€ä¸ª Pod å†…å¿…é¡»å”¯ä¸€</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Podæ˜¯ç”¨æ¥é…ç½®å®¹å™¨çš„ï¼Œæˆ‘ä»¬åœ¨å­¦ä¹ dockeræ—¶çŸ¥é“ï¼Œå®¹å™¨æœ‰éå¸¸å¤šçš„é…ç½®é¡¹ï¼Œæ¯”å¦‚ç«¯å£ã€ç½‘ç»œã€å­˜å‚¨ç­‰ï¼Œè€Œ pod çš„é…ç½®é¡¹æ›´ä¸°å¯Œã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä¸€ä¸ªPodçš„é…ç½®ä¸»è¦åŒ…å«ä¸¤å¤§éƒ¨åˆ†ï¼š<code>metadata</code> å’Œ <code>spec</code>ï¼Œæ¯ä¸€é¡¹ä¸­åŒ…å«çš„é…ç½®é¡¹éå¸¸å¤šï¼Œè¿™é‡Œåªå¯¹å¸¸ç”¨çš„é…ç½®é¡¹è¿›è¡Œè¯´æ˜ï¼Œè‹¥è¦æŸ¥çœ‹æ¯ä¸ªé…ç½®é¡¹çš„è¯´æ˜å¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤è·å–ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># podå¼€å¤´ï¼Œé…ç½®é¡¹ä»¥ . è¿æ¥ï¼Œä¾‹å¦‚ï¼š</span></span><br><span class=\"line\">kubectl explain pod.metadata</span><br><span class=\"line\">kubectl explain pod.metadata.labels</span><br><span class=\"line\">kubectl explain pod.spec</span><br><span class=\"line\">kubectl explain pod.spec.containers</span><br><span class=\"line\">kubectl explain pod.spec.containers.ports</span><br></pre></td></tr></table></figure>\n<h4 id=\"metadata\">metadata</h4>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>metadata æ˜¯ Pod çš„å…ƒæ•°æ®ï¼Œæ¯”å¦‚ Pod çš„åç§°ã€å‘½åç©ºé—´ã€æ ‡ç­¾ã€æ³¨è§£ç­‰ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">metadata:</span>                 <span class=\"comment\"># å…ƒæ•°æ®éƒ¨åˆ†</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">myapp-pod</span>         <span class=\"comment\"># Pod çš„åç§°</span></span><br><span class=\"line\">  <span class=\"attr\">namespace:</span> <span class=\"string\">default</span>      <span class=\"comment\"># Pod æ‰€åœ¨çš„å‘½åç©ºé—´ï¼Œé»˜è®¤æ˜¯ default</span></span><br><span class=\"line\">  <span class=\"attr\">labels:</span>                 <span class=\"comment\"># æ ‡ç­¾ï¼Œç”¨äºé€‰æ‹©å™¨ã€ç®¡ç†ã€åˆ†ç»„</span></span><br><span class=\"line\">    <span class=\"attr\">app:</span> <span class=\"string\">myapp</span></span><br><span class=\"line\">    <span class=\"attr\">tier:</span> <span class=\"string\">frontend</span></span><br><span class=\"line\">  <span class=\"attr\">annotations:</span>            <span class=\"comment\"># æ³¨è§£ï¼Œç”¨äºæ·»åŠ éç»“æ„åŒ–å…ƒä¿¡æ¯</span></span><br><span class=\"line\">    <span class=\"attr\">description:</span> <span class=\"string\">&quot;A sample pod for demonstration&quot;</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"spec\">spec</h4>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>spec æè¿°äº† Pod çš„é…ç½®ä¿¡æ¯ï¼ŒåŒ…æ‹¬ Pod çš„å®¹å™¨ã€å­˜å‚¨ã€ç½‘ç»œã€èµ„æºé™åˆ¶ã€è°ƒåº¦ç­–ç•¥ç­‰</p>\n</li>\n</ul>\n<h5 id=\"spec-containers\">spec.containers</h5>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>containers æè¿°äº† Pod ä¸­å®¹å™¨çš„é…ç½®ä¿¡æ¯ï¼ŒåŒ…æ‹¬é•œåƒã€å¯åŠ¨å‘½ä»¤ã€ç¯å¢ƒå˜é‡ã€èµ„æºé™åˆ¶ã€å·æŒ‚è½½ç­‰</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">spec:</span>                      <span class=\"comment\">#å¿…é€‰ï¼ŒPodä¸­å®¹å™¨çš„è¯¦ç»†å®šä¹‰</span></span><br><span class=\"line\">  <span class=\"attr\">containers:</span>              <span class=\"comment\">#å¿…é€‰ï¼ŒPodä¸­å®¹å™¨åˆ—è¡¨</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">string</span>           <span class=\"comment\">#å¿…é€‰ï¼Œå®¹å™¨åç§°</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">string</span>          <span class=\"comment\">#å¿…é€‰ï¼Œå®¹å™¨çš„é•œåƒåç§°</span></span><br><span class=\"line\">    <span class=\"attr\">imagePullPolicy:</span> [ <span class=\"string\">Always|Never|IfNotPresent</span> ]   <span class=\"comment\">#è·å–é•œåƒçš„ç­–ç•¥ï¼Œå½“é•œåƒæ ‡ç­¾ä¸º latest æ—¶é»˜è®¤å€¼ä¸º Alwaysï¼Œå¦åˆ™ä¸º IfNotPresent</span></span><br><span class=\"line\">    <span class=\"attr\">command:</span> [<span class=\"string\">string</span>]      <span class=\"comment\">#å®¹å™¨çš„å¯åŠ¨å‘½ä»¤åˆ—è¡¨ï¼Œå¦‚ä¸æŒ‡å®šï¼Œä½¿ç”¨æ‰“åŒ…æ—¶ä½¿ç”¨çš„å¯åŠ¨å‘½ä»¤</span></span><br><span class=\"line\">    <span class=\"attr\">args:</span> [<span class=\"string\">string</span>]         <span class=\"comment\">#å®¹å™¨çš„å¯åŠ¨å‘½ä»¤å‚æ•°åˆ—è¡¨</span></span><br><span class=\"line\">    <span class=\"attr\">workingDir:</span> <span class=\"string\">string</span>     <span class=\"comment\">#å®¹å™¨çš„å·¥ä½œç›®å½•ï¼Œå¦‚æœä¸ºæŒ‡å®šï¼Œåˆ™é»˜è®¤ä¸ºé•œåƒä¸­çš„é…ç½®</span></span><br><span class=\"line\">    <span class=\"attr\">volumeMounts:</span>          <span class=\"comment\">#æŒ‚è½½åˆ°å®¹å™¨å†…éƒ¨çš„å­˜å‚¨å·é…ç½®</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">string</span>         <span class=\"comment\">#å¼•ç”¨podå®šä¹‰çš„å…±äº«å­˜å‚¨å·çš„åç§°ï¼Œéœ€ç”¨volumes[]éƒ¨åˆ†å®šä¹‰çš„çš„å·å</span></span><br><span class=\"line\">      <span class=\"attr\">mountPath:</span> <span class=\"string\">string</span>    <span class=\"comment\">#å­˜å‚¨å·åœ¨å®¹å™¨å†…mountçš„ç»å¯¹è·¯å¾„ï¼Œåº”å°‘äº512å­—ç¬¦</span></span><br><span class=\"line\">      <span class=\"attr\">readOnly:</span> <span class=\"string\">boolean</span>    <span class=\"comment\">#æ˜¯å¦ä¸ºåªè¯»æ¨¡å¼</span></span><br><span class=\"line\">    <span class=\"attr\">ports:</span>                 <span class=\"comment\">#éœ€è¦æš´éœ²çš„ç«¯å£åº“å·åˆ—è¡¨</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">string</span>         <span class=\"comment\">#ç«¯å£çš„åç§°</span></span><br><span class=\"line\">      <span class=\"attr\">containerPort:</span> <span class=\"number\">80</span>    <span class=\"comment\">#å®¹å™¨éœ€è¦ç›‘å¬çš„ç«¯å£å·</span></span><br><span class=\"line\">      <span class=\"attr\">hostPort:</span> <span class=\"string\">int</span>        <span class=\"comment\">#å®¹å™¨æ‰€åœ¨ä¸»æœºéœ€è¦ç›‘å¬çš„ç«¯å£å·ï¼Œé»˜è®¤ä¸Containerç›¸åŒ</span></span><br><span class=\"line\">      <span class=\"attr\">protocol:</span> <span class=\"string\">string</span>     <span class=\"comment\">#ç«¯å£åè®®ï¼Œæ”¯æŒTCPå’ŒUDPï¼Œé»˜è®¤TCP</span></span><br><span class=\"line\">    <span class=\"attr\">env:</span>                   <span class=\"comment\">#å®¹å™¨è¿è¡Œå‰éœ€è®¾ç½®çš„ç¯å¢ƒå˜é‡åˆ—è¡¨</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">string</span>         <span class=\"comment\">#ç¯å¢ƒå˜é‡åç§°</span></span><br><span class=\"line\">      <span class=\"attr\">value:</span> <span class=\"string\">string</span>        <span class=\"comment\">#ç¯å¢ƒå˜é‡çš„å€¼</span></span><br><span class=\"line\">    <span class=\"attr\">resources:</span>             <span class=\"comment\">#èµ„æºé™åˆ¶å’Œè¯·æ±‚çš„è®¾ç½®</span></span><br><span class=\"line\">      <span class=\"attr\">limits:</span>              <span class=\"comment\">#èµ„æºé™åˆ¶çš„è®¾ç½®(ä¸Šé™)</span></span><br><span class=\"line\">        <span class=\"attr\">cpu:</span> <span class=\"string\">string</span>        <span class=\"comment\">#Cpuçš„é™åˆ¶ï¼Œå•ä½ä¸ºcoreæ•°ï¼Œå°†ç”¨äºdocker run --cpu-shareså‚æ•°</span></span><br><span class=\"line\">        <span class=\"attr\">memory:</span> <span class=\"string\">string</span>     <span class=\"comment\">#å†…å­˜é™åˆ¶ï¼Œå•ä½å¯ä»¥ä¸ºMib/Gibï¼Œå°†ç”¨äºdocker run --memoryå‚æ•°</span></span><br><span class=\"line\">      <span class=\"attr\">requests:</span>            <span class=\"comment\">#èµ„æºè¯·æ±‚çš„è®¾ç½®(ä¸‹é™)</span></span><br><span class=\"line\">        <span class=\"attr\">cpu:</span> <span class=\"string\">string</span>        <span class=\"comment\">#Cpuè¯·æ±‚ï¼Œå®¹å™¨å¯åŠ¨çš„åˆå§‹å¯ç”¨æ•°é‡</span></span><br><span class=\"line\">        <span class=\"attr\">memory:</span> <span class=\"string\">string</span>     <span class=\"comment\">#å†…å­˜è¯·æ±‚,å®¹å™¨å¯åŠ¨çš„åˆå§‹å¯ç”¨æ•°é‡</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç¤ºä¾‹</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">spec:</span>                         <span class=\"comment\"># Pod çš„å…·ä½“è§„èŒƒ</span></span><br><span class=\"line\">  <span class=\"attr\">containers:</span>                 <span class=\"comment\"># Pod ä¸­çš„å®¹å™¨æ•°ç»„ï¼Œå¯ä»¥æœ‰å¤šä¸ªå®¹å™¨</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">myapp-container</span>   <span class=\"comment\"># å®¹å™¨åç§°</span></span><br><span class=\"line\">      <span class=\"attr\">image:</span> <span class=\"string\">nginx:1.25</span>       <span class=\"comment\"># ä½¿ç”¨çš„é•œåƒ</span></span><br><span class=\"line\">      <span class=\"attr\">ports:</span>                  <span class=\"comment\"># å®¹å™¨å¼€æ”¾çš„ç«¯å£</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">containerPort:</span> <span class=\"number\">80</span>   <span class=\"comment\"># å®¹å™¨å†…éƒ¨ç«¯å£ï¼Œåªæ˜¯å£°æ˜æ€§çš„å­—æ®µï¼Œä¸å…·æœ‰å†³å®šä½œç”¨</span></span><br><span class=\"line\">      <span class=\"attr\">env:</span>                    <span class=\"comment\"># ç¯å¢ƒå˜é‡é…ç½®</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">ENVIRONMENT</span></span><br><span class=\"line\">          <span class=\"attr\">value:</span> <span class=\"string\">production</span></span><br><span class=\"line\">      <span class=\"attr\">resources:</span>              <span class=\"comment\"># èµ„æºé™åˆ¶å’Œè¯·æ±‚</span></span><br><span class=\"line\">        <span class=\"attr\">limits:</span></span><br><span class=\"line\">          <span class=\"attr\">memory:</span> <span class=\"string\">&quot;512Mi&quot;</span>     <span class=\"comment\"># æœ€å¤§å†…å­˜é™åˆ¶</span></span><br><span class=\"line\">          <span class=\"attr\">cpu:</span> <span class=\"string\">&quot;1&quot;</span>            <span class=\"comment\"># æœ€å¤§ CPU æ ¸å¿ƒæ•°ï¼Œè¿™é‡Œæ˜¯ 1 æ ¸</span></span><br><span class=\"line\">          <span class=\"comment\"># cpu: 1000m        # 1000m = 1 æ ¸</span></span><br><span class=\"line\">        <span class=\"attr\">requests:</span></span><br><span class=\"line\">          <span class=\"attr\">memory:</span> <span class=\"string\">&quot;256Mi&quot;</span>     <span class=\"comment\"># åˆå§‹åˆ†é…å†…å­˜</span></span><br><span class=\"line\">          <span class=\"attr\">cpu:</span> <span class=\"string\">&quot;0.5&quot;</span>          <span class=\"comment\"># åˆå§‹åˆ†é… CPU, è¿™é‡Œ0.5 è¡¨ç¤º 0.5 æ ¸</span></span><br><span class=\"line\">          <span class=\"comment\"># cpu: 500m           # 500 æ¯«æ ¸ï¼Œä¹Ÿå°±æ˜¯ 0.5 æ ¸</span></span><br><span class=\"line\">      <span class=\"attr\">volumeMounts:</span>           <span class=\"comment\"># æŒ‚è½½åˆ°å®¹å™¨çš„å·</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">app-storage</span>   <span class=\"comment\"># å·åç§°ï¼Œéœ€è¦å’Œ volumes ä¸­å®šä¹‰çš„å·åç§°ä¸€è‡´</span></span><br><span class=\"line\">          <span class=\"attr\">mountPath:</span> <span class=\"string\">/usr/share/nginx/html</span> <span class=\"comment\"># æŒ‚è½½åˆ°å®¹å™¨çš„ç›®å½•</span></span><br></pre></td></tr></table></figure>\n<h5 id=\"spec-containers-command-args\">spec.containers.command | args</h5>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å®¹å™¨å¯åŠ¨æ—¶æ‰§è¡Œçš„å‘½ä»¤</p>\n</li>\n<li class=\"lvl-2\">\n<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œå®¹å™¨å¯åŠ¨æ—¶ï¼Œä¼šä»é•œåƒä¸­è·å–å‘½ä»¤å¹¶æ‰§è¡Œï¼Œå¦‚æœè¿™é‡Œé…ç½®äº†å‘½ä»¤ï¼Œåˆ™å®¹å™¨å¯åŠ¨æ—¶ï¼Œä¼šæ‰§è¡Œè¿™é‡Œçš„å‘½ä»¤ï¼Œè€Œä¸æ˜¯é•œåƒä¸­çš„å‘½ä»¤</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">containers:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">busybox-container</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">busybox:1.36</span></span><br><span class=\"line\">    <span class=\"attr\">command:</span> [<span class=\"string\">&quot;/bin/sh&quot;</span>, <span class=\"string\">&quot;-c&quot;</span>, <span class=\"string\">&quot;while true; do echo hello; sleep 10;done&quot;</span>]</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æˆ–è€…</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">containers:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">busybox-container</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">busybox:1.36</span></span><br><span class=\"line\">    <span class=\"attr\">command:</span> [<span class=\"string\">&quot;/bin/sh&quot;</span>,<span class=\"string\">&quot;-c&quot;</span>]</span><br><span class=\"line\">    <span class=\"attr\">args:</span> [<span class=\"string\">&quot;while true; do echo hello; sleep 10;done&quot;</span>]</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æˆ–è€…</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">containers:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">busybox-container</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">busybox:1.36</span></span><br><span class=\"line\">    <span class=\"attr\">command:</span> [<span class=\"string\">&quot;/bin/bash&quot;</span>, <span class=\"string\">&quot;-c&quot;</span>]</span><br><span class=\"line\">    <span class=\"attr\">args:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">|</span>                  <span class=\"comment\"># ä½¿ç”¨ | ç¬¦å·ï¼Œè¡¨ç¤ºå¤šè¡Œè¾“å…¥</span></span><br><span class=\"line\">        <span class=\"string\">while</span> <span class=\"literal\">true</span><span class=\"string\">;</span> <span class=\"string\">do</span></span><br><span class=\"line\">          <span class=\"string\">echo</span> <span class=\"string\">&quot;hello world&quot;</span></span><br><span class=\"line\">          <span class=\"string\">sleep</span> <span class=\"number\">5</span></span><br><span class=\"line\">        <span class=\"string\">done</span></span><br></pre></td></tr></table></figure>\n<h5 id=\"spec-restartPolicy\">spec.restartPolicy</h5>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æŒ‡åœ¨ç³»ç»Ÿå‘ç”Ÿæ•…éšœæˆ–æ„å¤–åœæœºæ—¶ï¼Œç³»ç»Ÿæˆ–åº”ç”¨ç¨‹åºå¦‚ä½•å¤„ç†å’Œæ¢å¤çš„ç­–ç•¥</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">Alwaysï¼šæ€»æ˜¯é‡å¯</li>\n<li class=\"lvl-4\">OnFailureï¼šå¤±è´¥æ—¶é‡å¯</li>\n<li class=\"lvl-4\">Neverï¼šä¸é‡å¯</li>\n</ul>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">containers:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">my-nginx</span></span><br><span class=\"line\">      <span class=\"attr\">image:</span> <span class=\"string\">nginx</span></span><br><span class=\"line\">  <span class=\"attr\">restartPolicy:</span> <span class=\"string\">OnFailure</span> <span class=\"comment\">#å¤±è´¥æ—¶é‡å¯</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"spec-terminationGracePeriodSeconds\">spec.terminationGracePeriodSeconds</h4>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Pod åˆ é™¤æ—¶ï¼Œç³»ç»Ÿç»™ Pod ç•™çš„æ—¶é—´ï¼Œç”¨äºå®Œæˆæ¸…ç†å·¥ä½œ</p>\n</li>\n<li class=\"lvl-2\">\n<p>å®½é™æœŸä¸ºé¿å…æœåŠ¡çªç„¶ä¸­æ–­,é€ æˆäº‹ç‰©ä¸ä¸€è‡´çš„é—®é¢˜,å½“å®¹å™¨è¿è¡Œå®Œè‡ªå·±çš„ä»»åŠ¡å,ä¼šç­‰å¾…ä¸€æ®µæ—¶é—´,ç„¶åä¼˜é›…çš„é€€å‡º</p>\n</li>\n<li class=\"lvl-2\">\n<p>é»˜è®¤å€¼ä¸º 30sï¼Œå•ä½ä¸ºç§’</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">containers:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">my-nginx</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">nginx</span></span><br><span class=\"line\">  <span class=\"attr\">terminationGracePeriodSeconds:</span> <span class=\"number\">60</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"spec-volumes\">spec.volumes</h4>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Kubernetes ä¸­çš„å·ï¼ˆvolumesï¼‰æ˜¯ä¸ºäº†åœ¨å®¹å™¨ä¹‹é—´å…±äº«æ•°æ®ï¼Œæˆ–å°†æ•°æ®ä»å®¹å™¨æŒä¹…åŒ–åˆ°å¤–éƒ¨å­˜å‚¨ã€‚</p>\n</li>\n</ul>\n<h5 id=\"emptyDirï¼ˆæœ€ç®€å•ï¼ŒPod-ç”Ÿå‘½å‘¨æœŸå†…æœ‰æ•ˆï¼‰\">emptyDirï¼ˆæœ€ç®€å•ï¼ŒPod ç”Ÿå‘½å‘¨æœŸå†…æœ‰æ•ˆï¼‰</h5>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>emptyDir å·æ˜¯ä¸€ä¸ªæ²¡æœ‰åå­—çš„ä¸´æ—¶ç›®å½•ï¼ŒPod åˆ›å»ºæ—¶åˆ›å»ºï¼ŒPod åˆ é™¤æ—¶åˆ é™¤ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">containers:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">app</span></span><br><span class=\"line\">      <span class=\"attr\">image:</span> <span class=\"string\">nginx</span></span><br><span class=\"line\">      <span class=\"attr\">volumeMounts:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">mountPath:</span> <span class=\"string\">/usr/share/nginx/html</span></span><br><span class=\"line\">          <span class=\"attr\">name:</span> <span class=\"string\">html-volume</span></span><br><span class=\"line\">  <span class=\"attr\">volumes:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">html-volume</span></span><br><span class=\"line\">      <span class=\"attr\">emptyDir:</span> &#123;&#125;  <span class=\"comment\"># è¡¨ç¤ºä¸€ä¸ªç©ºç›®å½•ï¼Œåœ¨ Pod ç”Ÿå‘½å‘¨æœŸå†…æœ‰æ•ˆ</span></span><br></pre></td></tr></table></figure>\n<h5 id=\"hostPathï¼ˆæŒ‚è½½å®¿ä¸»æœºè·¯å¾„ï¼‰\">hostPathï¼ˆæŒ‚è½½å®¿ä¸»æœºè·¯å¾„ï¼‰</h5>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç”¨äºæµ‹è¯•æˆ–éå¸¸äº†è§£å®¿ä¸»æœºç»“æ„çš„åœºæ™¯ã€‚ç”Ÿäº§ä¸æ¨èã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">volumes:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">mydata</span></span><br><span class=\"line\">      <span class=\"attr\">hostPath:</span></span><br><span class=\"line\">        <span class=\"attr\">path:</span> <span class=\"string\">/tmp/data</span>        <span class=\"comment\"># å®¿ä¸»æœºè·¯å¾„</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">DirectoryOrCreate</span>  <span class=\"comment\"># å¦‚æœç›®å½•ä¸å­˜åœ¨å°±åˆ›å»º</span></span><br></pre></td></tr></table></figure>\n<h5 id=\"configMapï¼ˆæŒ‚è½½é…ç½®æ–‡ä»¶ï¼‰\">configMapï¼ˆæŒ‚è½½é…ç½®æ–‡ä»¶ï¼‰</h5>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">volumes:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">config</span></span><br><span class=\"line\">      <span class=\"attr\">configMap:</span></span><br><span class=\"line\">        <span class=\"attr\">name:</span> <span class=\"string\">my-configmap</span>   <span class=\"comment\"># éœ€æå‰åˆ›å»º ConfigMapï¼Œè¿™ä¸ªåé¢ä¼šä»‹ç»</span></span><br></pre></td></tr></table></figure>\n<h5 id=\"ä½¿ç”¨-PVCï¼ˆæŒ‚è½½æŒä¹…åŒ–å­˜å‚¨ï¼‰\">ä½¿ç”¨ PVCï¼ˆæŒ‚è½½æŒä¹…åŒ–å­˜å‚¨ï¼‰</h5>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">volumes:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">persistent-storage</span></span><br><span class=\"line\">      <span class=\"attr\">persistentVolumeClaim:</span></span><br><span class=\"line\">        <span class=\"attr\">claimName:</span> <span class=\"string\">mypvc</span>  <span class=\"comment\"># PVC åç§°ï¼Œéœ€è¦æå‰åˆ›å»ºï¼Œè¿™ä¸ªåé¢ä¼šä»‹ç»</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"spec-tolerations-Podå®¹å¿ç­–ç•¥\">spec.tolerations: Podå®¹å¿ç­–ç•¥</h4>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>tolerations æ˜¯ Kubernetes Pod ä¸­ç”¨æ¥â€œå®¹å¿â€æŸäº› Node èŠ‚ç‚¹çš„æ±¡ç‚¹ï¼ˆTaintsï¼‰ çš„å­—æ®µã€‚å®ƒå…è®¸ Pod è¢«è°ƒåº¦åˆ°å¸¦æœ‰ç›¸åº” Taint çš„èŠ‚ç‚¹ä¸Šã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒPod ä¼šå› ä¸º Node èŠ‚ç‚¹çš„ Taint è€Œä¸è¢«è°ƒåº¦ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>æ¯”å¦‚ä¸€ä¸ª Node æœ‰ NoSchedule ç±»å‹çš„ taintï¼Œè€Œ Pod æ²¡æœ‰è®¾ç½®å¯¹åº”çš„ tolerationï¼Œè¯¥ Pod å°±ä¸ä¼šè¢«è°ƒåº¦åˆ°è¿™ä¸ª Node ä¸Šã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ç¤ºä¾‹ï¼š å®¹å¿ key=value:NoSchedule çš„ Taint</p>\n</li>\n<li class=\"lvl-2\">\n<p>å‡è®¾æŸèŠ‚ç‚¹æ‰“äº†å¦‚ä¸‹æ±¡ç‚¹ï¼ˆTaintï¼‰ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl taint nodes node1 key=value:NoSchedule</span><br><span class=\"line\"><span class=\"comment\"># NoSchedule\tä¸è°ƒåº¦åˆ°è¯¥èŠ‚ç‚¹ï¼Œé™¤éå®¹å¿ç­–ç•¥æ˜¾å¼å…è®¸</span></span><br><span class=\"line\"><span class=\"comment\"># PreferNoSchedule\tå°½é‡ä¸è°ƒåº¦åˆ°è¯¥èŠ‚ç‚¹ï¼Œä½†éå¼ºåˆ¶ï¼Œå³å¯èƒ½ä¼šè¢«è°ƒåº¦</span></span><br><span class=\"line\"><span class=\"comment\"># NoExecute\tä¸ä»…ä¸è°ƒåº¦åˆ°è¯¥èŠ‚ç‚¹ï¼Œè¿˜ä¼šæŠŠç°æœ‰ Pod é©±é€å‡ºå»ï¼Œé™¤éè®¾ç½®å®¹å¿æ—¶é—´</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># key=value æ˜¯ç”¨æ¥ åŒºåˆ†ä¸åŒç±»å‹çš„æ±¡ç‚¹çš„ã€‚æ¯”å¦‚ï¼š</span></span><br><span class=\"line\"><span class=\"comment\">#   ä½ å¯èƒ½ç»™ node1 è®¾ç½® env=prod:NoSchedule</span></span><br><span class=\"line\"><span class=\"comment\">#   ç»™ node2 è®¾ç½® gpu=true:NoSchedule</span></span><br><span class=\"line\"><span class=\"comment\">#   ç»™ node3 è®¾ç½® arch=arm64:NoSchedule</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># è¿™äº›éƒ½å±äºä¸åŒçš„â€œåŸå› â€æˆ–â€œæ ‡ç­¾â€ï¼Œè¿™æ ·ä½ å¯ä»¥ï¼š</span></span><br><span class=\"line\"><span class=\"comment\">#   ç”¨ä¸åŒçš„ toleration æ¥å®¹å¿ä¸åŒçš„ taintï¼›</span></span><br><span class=\"line\"><span class=\"comment\">#   ç²¾å‡†æ§åˆ¶æŸäº› Pod åªèƒ½è¢«è°ƒåº¦åˆ°ç¬¦åˆæ¡ä»¶çš„èŠ‚ç‚¹ã€‚</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å®¹å¿è¯¥ Taint</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Pod</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">tolerate-example</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">containers:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">busybox</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">busybox</span></span><br><span class=\"line\">    <span class=\"attr\">command:</span> [<span class=\"string\">&quot;sleep&quot;</span>, <span class=\"string\">&quot;3600&quot;</span>]</span><br><span class=\"line\">  <span class=\"attr\">tolerations:</span>        <span class=\"comment\"># å®šä¹‰å®¹å¿ç­–ç•¥</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">operator:</span> <span class=\"string\">&quot;Equal&quot;</span> <span class=\"comment\"># åŒ¹é…æ–¹å¼ï¼Œå¿…é€‰ï¼ˆEqual:ç²¾ç¡®åŒ¹é… key å’Œ valueã€‚Exists:åªåŒ¹é… key æ˜¯å¦å­˜åœ¨ï¼Œä¸å…³å¿ƒ value æ˜¯ä»€ä¹ˆï¼‰</span></span><br><span class=\"line\">    <span class=\"attr\">key:</span> <span class=\"string\">&quot;key&quot;</span>        <span class=\"comment\"># è®¾ç½®é”®å€¼å¯¹çš„keyï¼Œä¸ºç©ºä»£è¡¨ä»»æ„é”®å€¼å¯¹</span></span><br><span class=\"line\">    <span class=\"attr\">value:</span> <span class=\"string\">&quot;value&quot;</span>    <span class=\"comment\"># è®¾ç½®valuesçš„å€¼ï¼Œ</span></span><br><span class=\"line\">    <span class=\"attr\">effect:</span> <span class=\"string\">&quot;NoSchedule&quot;</span> <span class=\"comment\"># è®¾ç½®å®¹å¿çš„æ ‡ç­¾ï¼Œä¸ºç©ºä»£è¡¨æ‰€æœ‰æ±¡ç‚¹æ ‡ç­¾</span></span><br><span class=\"line\">    <span class=\"attr\">tolerationSeconds:</span> <span class=\"number\">60</span> <span class=\"comment\"># å®¹å¿æ—¶é—´ï¼Œè¿™é‡ŒPod æœ€å¤šå¯åœç•™ 60 ç§’ï¼Œä¹‹åä»ä¼šè¢«é©±é€ï¼Œä¸è®¾ç½®è¡¨ç¤ºæ°¸ä¹…å®¹å¿</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åœ¨ Kubernetes ä¸­ï¼Œeffect æœ‰ ä¸‰ä¸ªå¯é€‰å€¼ï¼š</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th><code>effect</code> å€¼</th>\n<th>å«ä¹‰</th>\n<th>å¸¸è§ç”¨é€”</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>NoSchedule</code></td>\n<td>èŠ‚ç‚¹ä¸Šçš„æ±¡ç‚¹ä¼šé˜»æ­¢ Pod è¢«è°ƒåº¦åˆ°è¯¥èŠ‚ç‚¹ï¼Œé™¤é Pod æœ‰ç›¸åº”çš„ tolerationã€‚</td>\n<td><strong>æœ€å¸¸ç”¨</strong>ï¼Œä¾‹å¦‚ Master èŠ‚ç‚¹çš„å®¹å¿ã€‚</td>\n</tr>\n<tr>\n<td><code>PreferNoSchedule</code></td>\n<td><strong>å€¾å‘äºä¸è°ƒåº¦</strong> åˆ°è¯¥èŠ‚ç‚¹ï¼Œä½†ä¸æ˜¯å¼ºåˆ¶æ€§çš„ï¼Œè°ƒåº¦å™¨ä¼šå°½é‡é¿å…æŠŠ Pod å®‰æ’åˆ°è¯¥èŠ‚ç‚¹ã€‚</td>\n<td>ç”¨äºè½¯çº¦æŸï¼Œå°½é‡ä¸è°ƒåº¦ã€‚</td>\n</tr>\n<tr>\n<td><code>NoExecute</code></td>\n<td>ä¸ä»…ä¸è°ƒåº¦æ–° Pod åˆ°è¯¥èŠ‚ç‚¹ï¼Œè¿˜ä¼šæŠŠå½“å‰èŠ‚ç‚¹ä¸Šæ²¡æœ‰ç›¸åº”å®¹å¿åº¦çš„ Pod é©±é€å‡ºå»ï¼ˆ<code>eviction</code>ï¼‰ã€‚</td>\n<td>èŠ‚ç‚¹å¼‚å¸¸è‡ªåŠ¨é©±é€ï¼Œæ¯”å¦‚ not-readyã€‚</td>\n</tr>\n</tbody>\n</table>\n<h4 id=\"spec-resources\">spec.resources</h4>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Podèµ„æºé…é¢å¯ä»¥é™åˆ¶å‘½åç©ºé—´æˆ–é¡¹ç›®ä¸­Podä½¿ç”¨çš„CPUã€å†…å­˜ã€å­˜å‚¨ç­‰èµ„æºç”¨é‡</p>\n</li>\n<li class=\"lvl-2\">\n<p>CPUèµ„æºçš„çº¦æŸå’Œè¯·æ±‚ä»¥è±ªæ ¸ï¼ˆmï¼‰ä¸ºå•ä½ã€‚åœ¨k8sä¸­1mæ˜¯æœ€å°çš„è°ƒåº¦å•å…ƒï¼ŒCPUçš„ä¸€ä¸ªæ ¸å¿ƒå¯ä»¥çœ‹ä½œ1000m</p>\n</li>\n</ul>\n<blockquote>\n<p>å¦‚æœä½ æœ‰2é¢—cpuï¼Œä¸”æ¯CPUä¸º4æ ¸å¿ƒï¼Œé‚£ä¹ˆä½ çš„CPUèµ„æºæ€»é‡å°±æ˜¯8000</p>\n</blockquote>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">spec:</span>                     <span class=\"comment\"># Pod çš„å…·ä½“è§„èŒƒ</span></span><br><span class=\"line\">  <span class=\"attr\">containers:</span>             <span class=\"comment\"># Pod ä¸­çš„å®¹å™¨æ•°ç»„ï¼Œå¯ä»¥æœ‰å¤šä¸ªå®¹å™¨</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">myapp-container</span>    <span class=\"comment\"># å®¹å™¨åç§°</span></span><br><span class=\"line\">      <span class=\"attr\">image:</span> <span class=\"string\">nginx:1.25</span>        <span class=\"comment\"># ä½¿ç”¨çš„é•œåƒ</span></span><br><span class=\"line\">      <span class=\"attr\">resources:</span>              <span class=\"comment\"># èµ„æºé™åˆ¶å’Œè¯·æ±‚</span></span><br><span class=\"line\">        <span class=\"attr\">limits:</span></span><br><span class=\"line\">          <span class=\"attr\">memory:</span> <span class=\"string\">&quot;512Mi&quot;</span>     <span class=\"comment\"># æœ€å¤§å†…å­˜é™åˆ¶</span></span><br><span class=\"line\">          <span class=\"attr\">cpu:</span> <span class=\"string\">&quot;1&quot;</span>            <span class=\"comment\"># æœ€å¤§ CPU æ ¸å¿ƒæ•°ï¼Œè¿™é‡Œæ˜¯ 1 æ ¸</span></span><br><span class=\"line\">          <span class=\"comment\"># cpu: 1000m          # 1000m = 1 æ ¸</span></span><br><span class=\"line\">        <span class=\"attr\">requests:</span></span><br><span class=\"line\">          <span class=\"attr\">memory:</span> <span class=\"string\">&quot;256Mi&quot;</span>     <span class=\"comment\"># åˆå§‹åˆ†é…å†…å­˜</span></span><br><span class=\"line\">          <span class=\"attr\">cpu:</span> <span class=\"string\">&quot;0.5&quot;</span>          <span class=\"comment\"># åˆå§‹åˆ†é… CPU, è¿™é‡Œ0.5 è¡¨ç¤º 0.5 æ ¸</span></span><br><span class=\"line\">          <span class=\"comment\"># cpu: 500m           # 500 æ¯«æ ¸ï¼Œä¹Ÿå°±æ˜¯ 0.5 æ ¸</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¦‚æœæœ‰å¤§é‡çš„å®¹å™¨éœ€è¦è®¾ç½®èµ„æºé…é¢ï¼Œä¸ºæ¯ä¸ªPodè®¾ç½®èµ„æºé…é¢ç­–ç•¥ä¸æ–¹ä¾¿ä¸”ä¸å¥½ç®¡ç†</p>\n</li>\n<li class=\"lvl-2\">\n<p>å¯ä»¥ä»¥åç§°ç©ºé—´ä¸ºå•ä½ï¼ˆnamespaceï¼‰ï¼Œé™åˆ¶å…¶èµ„æºçš„ä½¿ç”¨ä¸åˆ›å»ºï¼Œåœ¨è¯¥åç§°ç©ºé—´ä¸­åˆ›å»ºçš„å®¹å™¨éƒ½ä¼šå—åˆ°è§„åˆ™çš„é™åˆ¶ã€‚</p>\n</li>\n</ul>\n<h5 id=\"LimitRange\">LimitRange</h5>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¯¹å•ä¸ªPodå†…å­˜ã€CPUè¿›è¡Œé…é¢</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">LimitRange</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">mem-cpu-limit-range</span>          <span class=\"comment\"># LimitRange çš„åç§°</span></span><br><span class=\"line\">  <span class=\"attr\">namespace:</span> <span class=\"string\">demo</span>                    <span class=\"comment\"># ç”Ÿæ•ˆçš„å‘½åç©ºé—´</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">limits:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">type:</span> <span class=\"string\">Container</span>                  <span class=\"comment\"># è¡¨ç¤ºé™åˆ¶çš„æ˜¯æ¯ä¸ªå®¹å™¨ï¼ˆä¹Ÿå¯è®¾ç½®ä¸º Podï¼‰</span></span><br><span class=\"line\">    <span class=\"attr\">default:</span>                         <span class=\"comment\"># å®¹å™¨æœªæŒ‡å®š resources.limits æ—¶ä½¿ç”¨çš„é»˜è®¤å€¼</span></span><br><span class=\"line\">      <span class=\"attr\">cpu:</span> <span class=\"string\">500m</span>                      <span class=\"comment\"># é»˜è®¤é™åˆ¶ CPU ä¸º 0.5 æ ¸</span></span><br><span class=\"line\">      <span class=\"attr\">memory:</span> <span class=\"string\">512Mi</span>                  <span class=\"comment\"># é»˜è®¤é™åˆ¶å†…å­˜ä¸º 512 MiB</span></span><br><span class=\"line\">    <span class=\"attr\">defaultRequest:</span>                  <span class=\"comment\"># å®¹å™¨æœªæŒ‡å®š resources.requests æ—¶ä½¿ç”¨çš„é»˜è®¤è¯·æ±‚å€¼ï¼Œåˆå§‹å€¼</span></span><br><span class=\"line\">      <span class=\"attr\">cpu:</span> <span class=\"string\">100m</span>                      <span class=\"comment\"># é»˜è®¤è¯·æ±‚ CPU ä¸º 0.1 æ ¸</span></span><br><span class=\"line\">      <span class=\"attr\">memory:</span> <span class=\"string\">128Mi</span>                  <span class=\"comment\"># é»˜è®¤è¯·æ±‚å†…å­˜ä¸º 128 MiB</span></span><br><span class=\"line\">    <span class=\"attr\">max:</span>                             <span class=\"comment\"># å®¹å™¨å¯è®¾ç½®çš„æœ€å¤§é™åˆ¶å€¼ï¼Œå³ å®¹å™¨ä¸­æŒ‡å®šçš„ resources.limits çš„æœ€å¤§å…è®¸å€¼</span></span><br><span class=\"line\">      <span class=\"attr\">cpu:</span> <span class=\"string\">&quot;1&quot;</span>                       <span class=\"comment\"># æœ€å¤§å¯ä½¿ç”¨ CPU ä¸º 1 æ ¸</span></span><br><span class=\"line\">      <span class=\"attr\">memory:</span> <span class=\"string\">1Gi</span>                    <span class=\"comment\"># æœ€å¤§å¯ä½¿ç”¨å†…å­˜ä¸º 1 GiB</span></span><br><span class=\"line\">    <span class=\"attr\">min:</span>                             <span class=\"comment\"># å®¹å™¨å¯è®¾ç½®çš„æœ€å°è¯·æ±‚å€¼ï¼Œï¼Œå³ å®¹å™¨ä¸­æŒ‡å®šçš„ resources.requests çš„æœ€å°å…è®¸å€¼</span></span><br><span class=\"line\">      <span class=\"attr\">cpu:</span> <span class=\"string\">50m</span>                       <span class=\"comment\"># æœ€å°è¯·æ±‚ CPU ä¸º 0.05 æ ¸</span></span><br><span class=\"line\">      <span class=\"attr\">memory:</span> <span class=\"string\">64Mi</span>                   <span class=\"comment\"># æœ€å°è¯·æ±‚å†…å­˜ä¸º 64 MiB</span></span><br></pre></td></tr></table></figure>\n<h5 id=\"ResourceQuota\">ResourceQuota</h5>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>é™åˆ¶æ•´ä¸ª namespace çš„èµ„æºæ€»é‡</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">ResourceQuota</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">compute-resources</span>           <span class=\"comment\"># ResourceQuota çš„åç§°</span></span><br><span class=\"line\">  <span class=\"attr\">namespace:</span> <span class=\"string\">demo</span>                   <span class=\"comment\"># ç”Ÿæ•ˆçš„å‘½åç©ºé—´</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">hard:</span>                             <span class=\"comment\"># å®šä¹‰å„ç±»èµ„æºçš„æ€»é…é¢ä¸Šé™</span></span><br><span class=\"line\">    <span class=\"attr\">pods:</span> <span class=\"string\">&quot;10&quot;</span>                      <span class=\"comment\"># è¯¥å‘½åç©ºé—´æœ€å¤šå…è®¸åˆ›å»º 10 ä¸ª Pod</span></span><br><span class=\"line\">    <span class=\"attr\">requests.cpu:</span> <span class=\"string\">&quot;2&quot;</span>               <span class=\"comment\"># æ‰€æœ‰ Pod çš„ requests.cpu æ€»å’Œæœ€å¤šä¸º 2 æ ¸</span></span><br><span class=\"line\">    <span class=\"attr\">requests.memory:</span> <span class=\"string\">4Gi</span>            <span class=\"comment\"># æ‰€æœ‰ Pod çš„ requests.memory æ€»å’Œæœ€å¤šä¸º 4 GiB</span></span><br><span class=\"line\">    <span class=\"attr\">limits.cpu:</span> <span class=\"string\">&quot;4&quot;</span>                 <span class=\"comment\"># æ‰€æœ‰ Pod çš„ limits.cpu æ€»å’Œæœ€å¤šä¸º 4 æ ¸</span></span><br><span class=\"line\">    <span class=\"attr\">limits.memory:</span> <span class=\"string\">8Gi</span>              <span class=\"comment\"># æ‰€æœ‰ Pod çš„ limits.memory æ€»å’Œæœ€å¤šä¸º 8 GiB</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"spec-priorityClassName\">spec.priorityClassName</h4>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Pod çš„ä¼˜å…ˆçº§ï¼Œä¼˜å…ˆçº§å°±æ˜¯ä¸ºäº†ä¿è¯é‡è¦çš„Podè¢«ä¼˜å…ˆè°ƒåº¦å¹¶è¿è¡Œ</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä¼˜å…ˆçº§ç­–ç•¥ï¼š</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">éæŠ¢å ä¼˜å…ˆï¼šæŒ‡çš„æ˜¯åœ¨è°ƒåº¦é˜¶æ®µä¼˜å…ˆè¿›è¡Œè°ƒåº¦åˆ†é…ï¼Œä¸€æ—¦å®¹å™¨è°ƒåº¦å®Œæˆå°±ä¸å¯ä»¥æŠ¢å ï¼Œèµ„æºä¸è¶³æ—¶ï¼Œåªèƒ½ç­‰å¾…</li>\n<li class=\"lvl-4\">æŠ¢å ä¼˜å…ˆï¼šå¼ºåˆ¶è°ƒåº¦ä¸€ä¸ªPodï¼Œå¦‚æœèµ„æºä¸è¶³æ— æ³•è¢«è°ƒåº¦ï¼Œè°ƒåº¦ç¨‹åºä¼šæŠ¢å ï¼ˆåˆ é™¤ï¼‰è¾ƒä½ä¼˜å…ˆçº§çš„Podçš„èµ„ æºï¼Œæ¥ä¿è¯é«˜ä¼˜å…ˆçº§Podçš„è¿è¡Œ</li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<p>åˆ›å»ºä¼˜å…ˆçº§</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">PriorityClass</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">scheduling.k8s.io/v1</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">high-non</span> <span class=\"comment\"># ä¼˜å…ˆçº§åç§°</span></span><br><span class=\"line\"><span class=\"attr\">preemptionPolicy:</span> <span class=\"string\">Never</span> <span class=\"comment\"># ç­–ç•¥ï¼šéæŠ¢å ï¼ŒPreemptLowerPriority:æŠ¢å ï¼ˆåˆ é™¤ï¼‰è¾ƒä½ä¼˜å…ˆçº§çš„Podçš„èµ„æºï¼Œä¿è¯é«˜ä¼˜å…ˆçº§Podçš„è¿è¡Œ</span></span><br><span class=\"line\"><span class=\"attr\">value:</span> <span class=\"number\">1000</span> <span class=\"comment\"># ä¼˜å…ˆçº§ï¼Œå¯ä»¥è®¾ç½®å°äº10äº¿çš„æ•´æ•°å€¼ï¼Œå€¼è¶Šå¤§ï¼Œä¼˜å…ˆçº§è¶Šé«˜ï¼Œé»˜è®¤ä¼˜å…ˆçº§0</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Pod</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">nginx</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">nodeSelector:</span></span><br><span class=\"line\">    <span class=\"attr\">kubernetes.io/hostname:</span> <span class=\"string\">node01</span> <span class=\"comment\"># æŒ‡å®šåŒ¹é…å…·æœ‰å½“å‰æ ‡ç­¾çš„èŠ‚ç‚¹</span></span><br><span class=\"line\">  <span class=\"attr\">priorityClassName:</span> <span class=\"string\">high-non</span> <span class=\"comment\"># ä¼˜å…ˆçº§åç§°</span></span><br><span class=\"line\">  <span class=\"attr\">containers:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">my-nginx</span></span><br><span class=\"line\">      <span class=\"attr\">image:</span> <span class=\"string\">nginx</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"spec-nodeName-nodeSelector-Podè°ƒåº¦ç­–ç•¥\">spec.nodeName | nodeSelector :Podè°ƒåº¦ç­–ç•¥</h4>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åœ¨k8sä¸­ï¼Œè°ƒåº¦æ˜¯å°†Podåˆ†é…åˆ°åˆé€‚çš„èŠ‚ç‚¹å¹¶è¿è¡Œçš„è¿‡ç¨‹ï¼Œkube-scheduleræ˜¯é»˜è®¤è°ƒåº¦å™¨ï¼Œæ˜¯é›†ç¾¤çš„æ ¸å¿ƒç»„ä»¶ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>è°ƒåº¦å™¨é€šè¿‡k8sçš„ç›‘æµ‹ï¼ˆWatchï¼‰æœºåˆ¶æ¥å‘ç°é›†ç¾¤ä¸­å°šæœªè¢«è°ƒåº¦åˆ°èŠ‚ç‚¹ä¸Šçš„Podï¼Œè°ƒåº¦å™¨ä¾æ®è°ƒåº¦åŸåˆ™å°†Podåˆ†é…åˆ°ä¸€ä¸ªåˆé€‚çš„èŠ‚ç‚¹ä¸Šè¿è¡Œã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>è°ƒåº¦å™¨ç»™ä¸€ä¸ªpodåšè°ƒåº¦åŒ…å«ä¸¤ä¸ªæ­¥éª¤ï¼š è¿‡æ»¤ å’Œ æ‰“åˆ†</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">è¿‡æ»¤ï¼šé¦–å…ˆè¦ç­›é€‰å‡ºæ»¡è¶³Podæ‰€æœ‰çš„èµ„æºè¯·æ±‚çš„èŠ‚ç‚¹ï¼Œè¿™é‡ŒåŒ…å«è®¡ç®—èµ„æºã€å†…å­˜ã€å­˜å‚¨ã€ç½‘ç»œã€ç«¯å£å·ç­‰ç­‰ï¼Œå¦‚æœæ²¡æœ‰èŠ‚ç‚¹èƒ½æ»¡è¶³Podçš„éœ€æ±‚ï¼ŒPodå°†ä¸€ç›´åœç•™åœ¨PendingçŠ¶æ€ï¼Œç›´åˆ°è°ƒåº¦å™¨èƒ½å¤Ÿæ‰¾åˆ°åˆé€‚çš„èŠ‚ç‚¹è¿è¡Œå®ƒ</li>\n<li class=\"lvl-4\">æ‰“åˆ†ï¼šè°ƒåº¦å™¨å°†èŠ‚ç‚¹æŒ‰ç…§æ‰“åˆ†è§„åˆ™è¿›è¡Œæ‰“åˆ†ï¼Œç„¶åæŒ‰ç…§åˆ†æ•°è¿›è¡Œæ’åºï¼Œå°†åˆ†æ•°æœ€é«˜çš„èŠ‚ç‚¹ä½œä¸ºPodçš„è¿è¡ŒèŠ‚ç‚¹ã€‚å¦‚æœå­˜åœ¨å¤šä¸ªå¾—åˆ†æœ€é«˜çš„èŠ‚ç‚¹ï¼Œè°ƒåº¦å™¨ä¼šä»ä¸­éšæœºé€‰å–ä¸€ä¸ªã€‚</li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<p>Pod æ”¯æŒä¸¤ç§è°ƒåº¦ç­–ç•¥ï¼š<code>nodeName</code> å’Œ <code>nodeSelector</code></p>\n</li>\n</ul>\n<h5 id=\"spec-nodeName\">spec.nodeName</h5>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æŒ‡å®š Pod è¿è¡Œåœ¨æŒ‡å®šåç§°çš„èŠ‚ç‚¹ä¸Š</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">nodeName:</span> <span class=\"string\">node-1</span> <span class=\"comment\"># åŸºäºèŠ‚ç‚¹åè¿›è¡Œè°ƒåº¦</span></span><br><span class=\"line\">  <span class=\"attr\">containers:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">apache</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">myos:httpd</span></span><br></pre></td></tr></table></figure>\n<h5 id=\"spec-nodeSelector\">spec.nodeSelector</h5>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>èŠ‚ç‚¹é€‰æ‹©å™¨ï¼ŒåŸºäºèŠ‚ç‚¹çš„æ ‡ç­¾è¿›è¡Œè°ƒåº¦</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">nodeSelector:</span>         <span class=\"comment\"># åŸºäºèŠ‚ç‚¹æ ‡ç­¾è¿›è¡Œè°ƒåº¦</span></span><br><span class=\"line\">    <span class=\"attr\">kubernetes.io/hostname:</span> <span class=\"string\">node-2</span>  <span class=\"comment\"># æ ‡ç­¾</span></span><br><span class=\"line\">  <span class=\"attr\">containers:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">apache</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">myos:httpd</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¸ºèŠ‚ç‚¹è®¾ç½®æ ‡ç­¾</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æ‰€æœ‰èµ„æºéƒ½å¯ä»¥è®¾ç½®æ ‡ç­¾ï¼Œè¯­æ³•ä¸ºï¼š kubectl label &lt;èµ„æº&gt; &lt;èµ„æºåç§°&gt; &lt;æ ‡ç­¾key&gt;=&lt;æ ‡ç­¾value&gt;</span></span><br><span class=\"line\">kubectl label nodes node-2 kubernetes.io/hostname=node-2</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åˆ é™¤æ ‡ç­¾ï¼Œè¯­æ³•ä¸ºï¼š kubectl label &lt;èµ„æº&gt; &lt;èµ„æºåç§°&gt; &lt;æ ‡ç­¾key&gt;-</span></span><br><span class=\"line\"><span class=\"comment\"># è¿™é‡Œæ³¨æ„ï¼Œåˆ é™¤æ ‡ç­¾å°±æ˜¯åœ¨æ ‡ç­¾keyååŠ ä¸Š - ç¬¦å·</span></span><br><span class=\"line\">kubectl label nodes node-2 kubernetes.io/hostname-</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹èµ„æºæ ‡ç­¾ï¼škubectl get &lt;èµ„æº&gt; --show-labels</span></span><br><span class=\"line\">kubectl get nodes --show-labels</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹æŒ‡å®šèŠ‚ç‚¹çš„æ ‡ç­¾</span></span><br><span class=\"line\">kubectl get nodes node-2 --show-labels</span><br></pre></td></tr></table></figure>\n<h4 id=\"spec-affinity\">spec.affinity</h4>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>èŠ‚ç‚¹äº²å’Œæ€§ï¼Œç”¨äºæ§åˆ¶ Pod è°ƒåº¦åˆ°å…·æœ‰ç‰¹å®šæ ‡ç­¾çš„èŠ‚ç‚¹ä¸Šï¼Œæ˜¯ nodeSelector çš„å¢å¼ºç‰ˆæœ¬</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>ç±»å‹</th>\n<th>åŠŸèƒ½</th>\n<th>ç¤ºä¾‹ç”¨é€”</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Node Affinity</td>\n<td>æ§åˆ¶è°ƒåº¦åˆ°æœ‰æŒ‡å®šæ ‡ç­¾çš„èŠ‚ç‚¹</td>\n<td>SSDã€é«˜å†…å­˜èŠ‚ç‚¹</td>\n</tr>\n<tr>\n<td>Pod Affinity</td>\n<td>è°ƒåº¦åˆ°å’ŒæŸäº› Pod ä¸€èµ·çš„èŠ‚ç‚¹</td>\n<td>å¾®æœåŠ¡ååŒéƒ¨ç½²</td>\n</tr>\n<tr>\n<td>Pod Anti-Affinity</td>\n<td>é¿å…å’ŒæŸäº› Pod ä¸€èµ·çš„èŠ‚ç‚¹</td>\n<td>é«˜å¯ç”¨å‰¯æœ¬åˆ†æ•£éƒ¨ç½²</td>\n</tr>\n</tbody>\n</table>\n<h5 id=\"èŠ‚ç‚¹äº²å’Œæ€§-Node-Affinity\">èŠ‚ç‚¹äº²å’Œæ€§(Node Affinity)</h5>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Pod åªèƒ½è°ƒåº¦åˆ°å…·æœ‰æ ‡ç­¾ <code>disktype=ssd</code> çš„èŠ‚ç‚¹ä¸Š</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Pod</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">node-affinity-pod</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">containers:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">nginx</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">nginx</span></span><br><span class=\"line\">  <span class=\"attr\">affinity:</span>   <span class=\"comment\"># äº²å’Œæ€§é…ç½®</span></span><br><span class=\"line\">    <span class=\"attr\">nodeAffinity:</span> <span class=\"comment\"># èŠ‚ç‚¹äº²å’Œæ€§</span></span><br><span class=\"line\">      <span class=\"attr\">requiredDuringSchedulingIgnoredDuringExecution:</span> <span class=\"comment\"># åœ¨è°ƒåº¦æœŸé—´å¿…é¡»æ»¡è¶³ï¼Œè¿è¡Œä¸­å¿½ç•¥å˜åŒ–ï¼ˆå³è°ƒåº¦åæ ‡ç­¾å˜äº†ä¸ä¼šé©±é€ Podï¼‰ã€‚ä¹Ÿå¯ä»¥è®¾ç½®ä¸º preferredDuringSchedulingIgnoredDuringExecutionï¼Œè¡¨ç¤ºèŠ‚ç‚¹äº²å’Œæ€§ä¼˜å…ˆçº§é«˜ï¼Œä½†ä¸å¼ºåˆ¶è¦æ±‚å¿…é¡»æ»¡è¶³</span></span><br><span class=\"line\">        <span class=\"attr\">nodeSelectorTerms:</span> <span class=\"comment\"># èŠ‚ç‚¹é€‰æ‹©å™¨</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">matchExpressions:</span> <span class=\"comment\"># åŒ¹é…è¡¨è¾¾å¼ï¼Œæ”¯æŒå¤æ‚é€»è¾‘ï¼Œæ¯”å¦‚ Inã€NotInã€Existsã€DoesNotExistã€Gtã€Ltã€‚</span></span><br><span class=\"line\">          <span class=\"bullet\">-</span> <span class=\"attr\">key:</span> <span class=\"string\">disktype</span> <span class=\"comment\"># é”®</span></span><br><span class=\"line\">            <span class=\"attr\">operator:</span> <span class=\"string\">In</span> <span class=\"comment\"># æ“ä½œç¬¦</span></span><br><span class=\"line\">            <span class=\"attr\">values:</span> <span class=\"comment\"># å€¼</span></span><br><span class=\"line\">            <span class=\"bullet\">-</span> <span class=\"string\">ssd</span></span><br></pre></td></tr></table></figure>\n<h5 id=\"Pod-äº²å’Œæ€§-Pod-Affinity\">Pod äº²å’Œæ€§(Pod Affinity)</h5>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Pod ä¼šè¢«è°ƒåº¦åˆ° ä¸æ ‡ç­¾ä¸º app=web çš„ Pod æ‰€åœ¨åŒä¸€èŠ‚ç‚¹ï¼ˆæˆ–æ‹“æ‰‘å±‚ï¼‰ä¸Šã€‚</p>\n</li>\n</ul>\n<blockquote>\n<p>é€šå¸¸ç”¨äºéœ€è¦ç´§å¯†åä½œçš„æœåŠ¡éƒ¨ç½²åœ¨ä¸€èµ·ï¼ˆå¦‚åŒä¸€æœºå™¨å†…é€šä¿¡ï¼‰ã€‚</p>\n</blockquote>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Pod</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">pod-affinity-pod</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">containers:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">app</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">busybox</span></span><br><span class=\"line\">    <span class=\"attr\">command:</span> [<span class=\"string\">&quot;sleep&quot;</span>, <span class=\"string\">&quot;3600&quot;</span>]</span><br><span class=\"line\">  <span class=\"attr\">affinity:</span></span><br><span class=\"line\">    <span class=\"attr\">podAffinity:</span>  <span class=\"comment\"># pod äº²å’Œæ€§</span></span><br><span class=\"line\">      <span class=\"attr\">requiredDuringSchedulingIgnoredDuringExecution:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">labelSelector:</span>  <span class=\"comment\"># æ ‡ç­¾é€‰æ‹©å™¨</span></span><br><span class=\"line\">          <span class=\"attr\">matchExpressions:</span> <span class=\"comment\"># æ ‡ç­¾é€‰æ‹©æ¡ä»¶</span></span><br><span class=\"line\">          <span class=\"bullet\">-</span> <span class=\"attr\">key:</span> <span class=\"string\">app</span> <span class=\"comment\"># é”®</span></span><br><span class=\"line\">            <span class=\"attr\">operator:</span> <span class=\"string\">In</span> <span class=\"comment\"># æ“ä½œç¬¦</span></span><br><span class=\"line\">            <span class=\"attr\">values:</span>  <span class=\"comment\"># å€¼</span></span><br><span class=\"line\">            <span class=\"bullet\">-</span> <span class=\"string\">web</span></span><br><span class=\"line\">        <span class=\"attr\">topologyKey:</span> <span class=\"string\">&quot;kubernetes.io/hostname&quot;</span> <span class=\"comment\"># æ‹“æ‰‘é”®ï¼Œè¡¨ç¤ºâ€œåŒä¸€ä¸»æœºâ€</span></span><br></pre></td></tr></table></figure>\n<h5 id=\"Pod-åäº²å’Œæ€§-Pod-Anti-Affinity\">Pod åäº²å’Œæ€§(Pod Anti-Affinity)</h5>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¡¨ç¤ºä¸èƒ½å’Œ app=web çš„ Pod åœ¨åŒä¸€èŠ‚ç‚¹ä¸Š</p>\n</li>\n</ul>\n<blockquote>\n<p>å¸¸ç”¨äºé«˜å¯ç”¨éƒ¨ç½²ï¼Œé¿å…å¤šä¸ªå‰¯æœ¬éƒ¨ç½²åœ¨åŒä¸€ä¸ªèŠ‚ç‚¹ã€‚</p>\n</blockquote>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Pod</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">pod-anti-affinity-pod</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">containers:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">app</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">busybox</span></span><br><span class=\"line\">    <span class=\"attr\">command:</span> [<span class=\"string\">&quot;sleep&quot;</span>, <span class=\"string\">&quot;3600&quot;</span>]</span><br><span class=\"line\">  <span class=\"attr\">affinity:</span></span><br><span class=\"line\">    <span class=\"attr\">podAntiAffinity:</span> <span class=\"comment\"># Pod åäº²å’Œæ€§</span></span><br><span class=\"line\">      <span class=\"attr\">requiredDuringSchedulingIgnoredDuringExecution:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">labelSelector:</span></span><br><span class=\"line\">          <span class=\"attr\">matchExpressions:</span></span><br><span class=\"line\">          <span class=\"bullet\">-</span> <span class=\"attr\">key:</span> <span class=\"string\">app</span></span><br><span class=\"line\">            <span class=\"attr\">operator:</span> <span class=\"string\">In</span></span><br><span class=\"line\">            <span class=\"attr\">values:</span></span><br><span class=\"line\">            <span class=\"bullet\">-</span> <span class=\"string\">web</span></span><br><span class=\"line\">        <span class=\"attr\">topologyKey:</span> <span class=\"string\">&quot;kubernetes.io/hostname&quot;</span></span><br></pre></td></tr></table></figure>\n<h5 id=\"èŠ‚ç‚¹äº²å’Œæ€§-Node-Affinity-ä¸¤ç§ç­–ç•¥çš„å¯¹æ¯”\">èŠ‚ç‚¹äº²å’Œæ€§ (Node Affinity) ä¸¤ç§ç­–ç•¥çš„å¯¹æ¯”</h5>\n<table>\n<thead>\n<tr>\n<th>ç­–ç•¥å­—æ®µ</th>\n<th>å«ä¹‰</th>\n<th>è¡Œä¸ºç‰¹ç‚¹</th>\n<th>åœºæ™¯é€‚ç”¨</th>\n<th>æ˜¯å¦å¼ºåˆ¶</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>requiredDuringSchedulingIgnoredDuringExecution</code></td>\n<td><strong>â€œå¿…é¡»æ»¡è¶³â€äº²å’Œæ€§è§„åˆ™</strong></td>\n<td>Pod <strong>è°ƒåº¦æ—¶å¿…é¡»æ»¡è¶³æ¡ä»¶</strong>ï¼Œä¸æ»¡è¶³åˆ™ä¸è°ƒåº¦ï¼›è°ƒåº¦åèŠ‚ç‚¹å˜åŒ–ä¸è§¦å‘é©±é€</td>\n<td>ç¡¬æ€§çº¦æŸï¼Œæ¯”å¦‚å¿…é¡»è°ƒåº¦åˆ°æœ‰ GPU çš„èŠ‚ç‚¹</td>\n<td>âœ… å¼ºåˆ¶</td>\n</tr>\n<tr>\n<td><code>preferredDuringSchedulingIgnoredDuringExecution</code></td>\n<td><strong>â€œå°½é‡æ»¡è¶³â€äº²å’Œæ€§è§„åˆ™</strong></td>\n<td>Pod <strong>è°ƒåº¦æ—¶ä¼˜å…ˆè€ƒè™‘æ»¡è¶³æ¡ä»¶çš„èŠ‚ç‚¹</strong>ï¼Œä½†æ¡ä»¶ä¸æ»¡è¶³æ—¶ä»ç„¶å¯ä»¥è°ƒåº¦åˆ°å…¶ä»–èŠ‚ç‚¹ï¼›è°ƒåº¦ååŒæ ·ä¸ä¼šå¼ºåˆ¶è¿ç§»</td>\n<td>è½¯æ€§å€¾å‘ï¼Œæ¯”å¦‚å°½é‡è°ƒåº¦åˆ° SSD èŠ‚ç‚¹ï¼Œä½†å®åœ¨æ²¡æœ‰ä¹Ÿå¯è°ƒåº¦</td>\n<td>âŒ éå¼ºåˆ¶</td>\n</tr>\n</tbody>\n</table>\n<h4 id=\"spec-securityContext-è®¾ç½®å®‰å…¨ä¸Šä¸‹æ–‡\">spec.securityContext: è®¾ç½®å®‰å…¨ä¸Šä¸‹æ–‡</h4>\n<h5 id=\"runAsUser-è®¾ç½®è¿è¡Œç”¨æˆ·\">runAsUser: è®¾ç½®è¿è¡Œç”¨æˆ·</h5>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>é»˜è®¤æƒ…å†µä¸‹å®¹å™¨éƒ½æ˜¯ä»¥rootç”¨æˆ·è¿è¡Œçš„ï¼Œä½†æ˜¯å¾ˆå¤šåº”ç”¨éœ€è¦ä»¥érootç”¨æˆ·è¿è¡Œï¼Œæ¯”å¦‚ Elasticsearch ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Pod</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">pod1</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">containers:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">centos1</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">centos:v1</span></span><br><span class=\"line\">    <span class=\"attr\">command:</span> [<span class=\"string\">&quot;/bin/sh&quot;</span>, <span class=\"string\">&quot;-c&quot;</span>, <span class=\"string\">&quot;while true; do echo hello; sleep 10;done&quot;</span>]</span><br><span class=\"line\">    <span class=\"attr\">imagePullPolicy:</span> <span class=\"string\">IfNotPresent</span></span><br><span class=\"line\">    <span class=\"attr\">securityContext:</span></span><br><span class=\"line\">      <span class=\"attr\">runAsUser:</span> <span class=\"number\">1000</span>   <span class=\"comment\"># è®¾ç½®è¿è¡Œç”¨æˆ·ï¼Œè¿™ä¸ªUIDå¯ä»¥ä¸å­˜åœ¨</span></span><br></pre></td></tr></table></figure>\n<h5 id=\"privileged-æ˜¯å¦ä»¥ç‰¹æƒæ–¹å¼è¿è¡Œ\">privileged: æ˜¯å¦ä»¥ç‰¹æƒæ–¹å¼è¿è¡Œ</h5>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å®¹å™¨ä¸å®¿ä¸»æœºæ˜¯å…±äº«å†…æ ¸çš„ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œå®¹å™¨ç”¨æˆ·æ˜¯ä¸å…è®¸ä¿®æ”¹å†…æ ¸å‚æ•°çš„ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡è®¾ç½® <code>privileged: true</code> æ¥å…è®¸å®¹å™¨ä»¥ç‰¹æƒæ–¹å¼è¿è¡Œã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Pod</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">nginx</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">containers:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">centos1</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">centos:v1</span></span><br><span class=\"line\">    <span class=\"attr\">command:</span> [<span class=\"string\">&quot;/bin/sh&quot;</span>, <span class=\"string\">&quot;-c&quot;</span>, <span class=\"string\">&quot;while true; do echo hello; sleep 10;done&quot;</span>]</span><br><span class=\"line\">    <span class=\"attr\">imagePullPolicy:</span> <span class=\"string\">IfNotPresent</span></span><br><span class=\"line\">    <span class=\"attr\">securityContext:</span></span><br><span class=\"line\">      <span class=\"attr\">privileged:</span> <span class=\"literal\">true</span>   <span class=\"comment\"># ç‰¹æƒæ–¹å¼è¿è¡Œï¼Œé»˜è®¤ä¸º false</span></span><br></pre></td></tr></table></figure>\n<h5 id=\"allowPrivilegeEscalation-æ˜¯å¦å¯ä»¥ææƒï¼ˆSUIDï¼‰\">allowPrivilegeEscalation: æ˜¯å¦å¯ä»¥ææƒï¼ˆSUIDï¼‰</h5>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>sä½ï¼šå½“æŸå¯æ‰§è¡Œå‘½ä»¤çš„æ‰€æœ‰è€…çš„ä½ç½®ä¸Šæœ‰sä½æ—¶ï¼Œé‚£ä¹ˆå½“æ™®é€šç”¨æˆ·æ‰§è¡Œè¿™ä¸ªå‘½ä»¤æ—¶å°†å…·æœ‰æ‰€æœ‰è€…çš„æƒé™ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Pod</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">nginx</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">containers:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">centos1</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">centos:v1</span></span><br><span class=\"line\">    <span class=\"attr\">command:</span> [<span class=\"string\">&quot;/bin/sh&quot;</span>, <span class=\"string\">&quot;-c&quot;</span>, <span class=\"string\">&quot;while true; do echo hello; sleep 10;done&quot;</span>]</span><br><span class=\"line\">    <span class=\"attr\">imagePullPolicy:</span> <span class=\"string\">IfNotPresent</span></span><br><span class=\"line\">    <span class=\"attr\">securityContext:</span></span><br><span class=\"line\">      <span class=\"attr\">allowPrivilegeEscalation:</span> <span class=\"literal\">true</span>   <span class=\"comment\"># ææƒè¿è¡Œï¼Œå¯ä»¥ä½¿ç”¨suidï¼Œé»˜è®¤ä¸º false</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"æŸ¥çœ‹-Pod\">æŸ¥çœ‹ Pod</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹ Podï¼Œé»˜è®¤æ˜¾ç¤º default å‘½åç©ºé—´ä¸‹çš„ Pod</span></span><br><span class=\"line\">kubectl get pods</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹ kube-system å‘½åç©ºé—´ä¸‹çš„ Pod</span></span><br><span class=\"line\">kubectl get pods -n kube-system</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹æ‰€æœ‰å‘½åç©ºé—´ä¸‹çš„ Pod</span></span><br><span class=\"line\">kubectl get pods -A</span><br><span class=\"line\"><span class=\"comment\"># -o wide: æ˜¾ç¤º Pod çš„è¯¦ç»†ä¿¡æ¯ï¼Œæ­¤æ—¶ä¼šçœ‹åˆ° pod çš„ IP åœ°å€ã€èŠ‚ç‚¹åç§°ç­‰ä¿¡æ¯</span></span><br><span class=\"line\">kubectl get pods -o wide</span><br><span class=\"line\"><span class=\"comment\"># æ˜¾ç¤º Pod çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¾“å‡ºä¸º json/yaml æ ¼å¼</span></span><br><span class=\"line\">kubectl get pods -o json/yaml</span><br><span class=\"line\"><span class=\"comment\"># æ˜¾ç¤º Pod çš„æ ‡ç­¾</span></span><br><span class=\"line\">kubectl get pod --show-labels</span><br><span class=\"line\"><span class=\"comment\"># æŒ‰ Pod çš„æ ‡ç­¾è¿›ç¨‹æŸ¥è¯¢</span></span><br><span class=\"line\">kubectl get pod -l &lt;label_name&gt;=&lt;label_value&gt;</span><br><span class=\"line\"><span class=\"comment\"># æŒç»­æŸ¥çœ‹ Pod çš„çŠ¶æ€ï¼Œå½“ pod çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶ï¼Œä¼šå®æ—¶æ˜¾ç¤º</span></span><br><span class=\"line\">kubectl get pods -w</span><br><span class=\"line\"><span class=\"comment\">## çŠ¶æ€ç±»å‹</span></span><br><span class=\"line\">- Pending: Pod å°šæœªå°±ç»ª</span><br><span class=\"line\">- ContainerCreating: Pod æ­£åœ¨åˆ›å»ºå®¹å™¨</span><br><span class=\"line\">- Running: Pod æ­£åœ¨è¿è¡Œ</span><br><span class=\"line\">- Error: Pod è¿è¡Œé”™è¯¯</span><br><span class=\"line\">- Terminating: Pod æ­£åœ¨åˆ é™¤</span><br><span class=\"line\">- Completed: Pod æ‰§è¡Œå®Œæˆ</span><br><span class=\"line\">- Failed: Podä¸­çš„æ‰€æœ‰å®¹å™¨è‡³å°‘æœ‰ä¸€ä¸ªå®¹å™¨é€€å‡ºæ˜¯é0çŠ¶æ€</span><br><span class=\"line\">- Unkown: æ— æ³•æ­£å¸¸è·å–Podå¯¹è±¡çš„çŠ¶æ€ä¿¡æ¯</span><br></pre></td></tr></table></figure>\n<h3 id=\"æŸ¥çœ‹-Pod-è¯¦æƒ…\">æŸ¥çœ‹ Pod è¯¦æƒ…</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å½“ pod è¿è¡Œé”™è¯¯æ—¶ï¼Œå¯ä»¥é€šè¿‡è¯¥å‘½ä»¤æŸ¥çœ‹ pod çš„è¯¦æƒ…ï¼Œæ‰¾åˆ°é”™è¯¯åŸå› </p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl describe pod &lt;pod-name&gt;</span><br><span class=\"line\">kubectl describe pod &lt;pod-name&gt; -n &lt;namespace-name&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">## æ’æŸ¥åŸå› æ—¶ä¸»è¦è§‚å¯Ÿæœ€åçš„ Eventsï¼Œä»ä¸Šåˆ°ä¸‹å°±æ˜¯ Pod çš„è¿è¡Œè¿‡ç¨‹</span></span><br><span class=\"line\">Events:</span><br><span class=\"line\">  Type    Reason     Age        From               Message</span><br><span class=\"line\">  ----    ------     ----       ----               -------</span><br><span class=\"line\">  <span class=\"comment\"># è¢«è°ƒåº¦å™¨åˆ†é…åˆ° k8s-worker2 èŠ‚ç‚¹</span></span><br><span class=\"line\">  Normal  Scheduled  4s         default-scheduler  Successfully assigned default/nginx to k8s-worker2</span><br><span class=\"line\">  <span class=\"comment\"># å¼€å§‹æ‹‰å–é•œåƒ</span></span><br><span class=\"line\">  Normal  Pulling    &lt;invalid&gt;  kubelet            Pulling image <span class=\"string\">&quot;nginx&quot;</span></span><br><span class=\"line\">  <span class=\"comment\"># é•œåƒæ‹‰å–æˆåŠŸ</span></span><br><span class=\"line\">  Normal  Pulled     &lt;invalid&gt;  kubelet            Successfully pulled image <span class=\"string\">&quot;nginx&quot;</span> <span class=\"keyword\">in</span> 2.067s (2.067s including waiting). Image size: 72225394 bytes.</span><br><span class=\"line\">  <span class=\"comment\"># å¼€å§‹åˆ›å»ºå®¹å™¨</span></span><br><span class=\"line\">  Normal  Created    &lt;invalid&gt;  kubelet            Created container: nginx</span><br><span class=\"line\">  <span class=\"comment\"># å®¹å™¨å¯åŠ¨æˆåŠŸ</span></span><br><span class=\"line\">  Normal  Started    &lt;invalid&gt;  kubelet            Started container nginx</span><br></pre></td></tr></table></figure>\n<h3 id=\"è¿›å…¥å®¹å™¨\">è¿›å…¥å®¹å™¨</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># kubectl exec -it &lt;pod-name&gt; -n &lt;namespace-name&gt; -- &lt;command&gt;</span></span><br><span class=\"line\">kubectl <span class=\"built_in\">exec</span> -it nginx  -- /bin/bash</span><br></pre></td></tr></table></figure>\n<h3 id=\"åˆ é™¤-Pod\">åˆ é™¤ Pod</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl delete pod &lt;pod-name&gt;</span><br><span class=\"line\">kubectl delete pod &lt;pod-name&gt; -n &lt;namespace-name&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å¼ºåˆ¶åˆ é™¤</span></span><br><span class=\"line\"><span class=\"comment\">## 1.ç§»é™¤ Pod ä¸Šçš„ Finalizers</span></span><br><span class=\"line\"><span class=\"comment\">## finalizers æ˜¯ Kubernetes å¯¹è±¡ä¸Šçš„ä¸€ä¸ªå­—æ®µï¼Œç”¨æ¥å‘Šè¯‰ Kubernetesï¼Œåœ¨åˆ é™¤æˆ‘ä¹‹å‰ï¼Œè¯·å…ˆåšä¸€äº›æ¸…ç†å·¥ä½œï¼ˆå¦‚é‡Šæ”¾èµ„æºã€é€šçŸ¥å¤–éƒ¨ç³»ç»Ÿç­‰ï¼‰ï¼Œç­‰æˆ‘è‡ªå·±åˆ æ‰ finalizer åï¼Œä½ æ‰èƒ½çœŸæ­£åˆ é™¤æˆ‘ã€‚</span></span><br><span class=\"line\">kubectl patch pod &lt;pod-name&gt; \\</span><br><span class=\"line\">  -p <span class=\"string\">&#x27;&#123;&quot;metadata&quot;:&#123;&quot;finalizers&quot;:[]&#125;&#125;&#x27;</span> --<span class=\"built_in\">type</span>=merge</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">## 2.å¼ºåˆ¶åˆ é™¤</span></span><br><span class=\"line\">kubectl delete pod &lt;pod-name&gt; --force --grace-period=0 --<span class=\"built_in\">wait</span>=<span class=\"literal\">false</span></span><br><span class=\"line\"><span class=\"comment\">## å‚æ•°è¯´æ˜</span></span><br><span class=\"line\"><span class=\"comment\"># --force: å¼ºåˆ¶åˆ é™¤ï¼Œæ¯”å¦‚é‡åˆ°äº† pod å¤„äº Terminating çŠ¶æ€ï¼Œæ­¤æ—¶æ— æ³•åˆ é™¤ï¼Œå¯ä»¥ä½¿ç”¨ --force å‚æ•°å¼ºåˆ¶åˆ é™¤</span></span><br><span class=\"line\"><span class=\"comment\"># --grace-period=0: å¼ºåˆ¶åˆ é™¤çš„ç­‰å¾…æ—¶é—´ï¼Œé»˜è®¤æ˜¯ 30 ç§’ï¼Œè®¾ç½®ä¸º 0 è¡¨ç¤ºç«‹å³åˆ é™¤</span></span><br><span class=\"line\"><span class=\"comment\"># --wait=false: åˆ é™¤å®Œæˆåæ˜¯å¦ç­‰å¾… Pod å®Œå…¨åˆ é™¤ï¼Œæ¯”è¾ƒé€‚åˆè„šæœ¬ä¸­ä½¿ç”¨</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>é•¿æ—¶é—´å¤„äº Terminating çŠ¶æ€çš„ Podï¼Œè¿™ç±» Pod å¤§æ¦‚ç‡æ˜¯ç”±äºæ‰€åœ¨èŠ‚ç‚¹å¼‚å¸¸ï¼ˆå¤±è”ã€è¢«é‡è£…ã€æˆ– kubelet åœæ­¢ï¼‰ï¼Œå¯¼è‡´ Kubernetes æ§åˆ¶é¢æ— æ³•ä¸è¯¥ Pod å¯¹åº”çš„ kubelet é€šä¿¡å®Œæˆåˆ é™¤æ“ä½œï¼Œä»è€Œå¡åœ¨ Terminating çŠ¶æ€ï¼Œå…¶å®å®ƒå·²ç»æ­»äº†ï¼Œä½† etcd é‡Œçš„è®°å½•ä¸€ç›´ä¿ç•™ç€ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">### æŸ¥çœ‹ Pod æ—¥å¿—</span><br><span class=\"line\">```bash</span><br><span class=\"line\">kubectl logs &lt;pod-name&gt;</span><br><span class=\"line\">kubectl logs pod/&lt;pod-name&gt;</span><br><span class=\"line\">kubectl logs pod/&lt;pod-name&gt; -n &lt;namespace-name&gt;</span><br></pre></td></tr></table></figure>\n<h3 id=\"è®¿é—®-Pod\">è®¿é—® Pod</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æˆ‘ä»¬åˆšåˆšåˆ›å»ºäº†ä¸€ä¸ªnginxçš„podï¼Œè¯¥å¦‚ä½•è®¿é—®å‘¢ï¼Ÿ</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># è·å–podçš„ip</span></span><br><span class=\"line\">$ k get pod -o wide</span><br><span class=\"line\">NAME    READY   STATUS    RESTARTS   AGE   IP             NODE          NOMINATED NODE   READINESS GATES</span><br><span class=\"line\">nginx   1/1     Running   0          12m   10.244.126.8   k8s-worker2   &lt;none&gt;           &lt;none&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åœ¨ä»»æ„èŠ‚ç‚¹ä¸Šè®¿é—®ï¼Œnginx é»˜è®¤ç«¯å£æ˜¯80</span></span><br><span class=\"line\">$ curl 10.244.126.8</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æš‚æ—¶æˆ‘ä»¬è¿˜ä¸èƒ½é€šè¿‡èŠ‚ç‚¹çš„ IP è®¿é—® Podï¼Œå› ä¸º Pod è¿è¡Œåœ¨å®¹å™¨ç½‘ç»œä¸­ï¼Œç­‰æˆ‘åé¢è®²è§£ deployment å’Œ service ä¹‹åï¼Œä¼šä»‹ç»å¦‚ä½•é€šè¿‡ service è®¿é—®</p>\n</li>\n</ul>\n<h3 id=\"ä¸€ä¸ª-Pod-è¿è¡Œå¤šä¸ªå®¹å™¨\">ä¸€ä¸ª Pod è¿è¡Œå¤šä¸ªå®¹å™¨</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>yaml æ–‡ä»¶</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Pod</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">multi-pod</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">shareProcessNamespace:</span> <span class=\"literal\">true</span> <span class=\"comment\"># å…è®¸ç›¸åŒpodä¸­å¤šä¸ªå®¹å™¨å…±äº«è¿›ç¨‹ç©ºé—´ï¼Œå³åœ¨ä¸€ä¸ªå®¹å™¨é‡Œå¯ä»¥çœ‹åˆ°å¦ä¸€ä¸ªå®¹å™¨ä¸­çš„è¿›ç¨‹ï¼Œé»˜è®¤å€¼ä¸º false</span></span><br><span class=\"line\">  <span class=\"attr\">containers:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">nginx</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">nginx</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">tomcat</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">tomcat</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¿è¡Œ pod</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl apply -f multi_pod.yaml</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æŸ¥çœ‹è¿è¡Œç»“æœ</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># è¿™é‡Œçœ‹åˆ°ï¼ŒREADY é‡Œæœ‰ä¸¤ä¸ªï¼Œè¡¨ç¤ºä¸¤ä¸ªå®¹å™¨éƒ½è¿è¡ŒæˆåŠŸ</span></span><br><span class=\"line\">$ kubectl get pods -owide</span><br><span class=\"line\">NAME    READY   STATUS    RESTARTS   AGE    IP              NODE          NOMINATED NODE   READINESS GATES</span><br><span class=\"line\">multi-pod   2/2     Running   0          118s   10.244.194.81   k8s-worker1   &lt;none&gt;           &lt;none&gt;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è®¿é—®nginxå’Œtomcat</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># è®¿é—®nginxï¼Œngxiné»˜è®¤ç«¯å£æ˜¯80</span></span><br><span class=\"line\">curl http://10.244.194.81</span><br><span class=\"line\"><span class=\"comment\"># è®¿é—®tomcatï¼Œtomcaté»˜è®¤ç«¯å£æ˜¯8080ï¼Œå› ä¸ºtomcatçš„webappæ˜¯ç©ºçš„ï¼Œæ‰€ä»¥çœ‹åˆ°404å°±è¯´æ˜æ­£å¸¸</span></span><br><span class=\"line\">curl http://10.244.194.81:8080</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¿›å…¥å®¹å™¨æ‰§è¡Œå‘½ä»¤</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># è¿›å…¥nginxå®¹å™¨ï¼Œ-c æŒ‡å®šå®¹å™¨åç§°</span></span><br><span class=\"line\">kubectl <span class=\"built_in\">exec</span> -it multi-pod -c nginx -- /bin/bash</span><br><span class=\"line\"><span class=\"comment\">## è¿›å…¥nginxå®¹å™¨åè®¿é—®tomcatå¯ä»¥æ­£å¸¸è®¿é—®ï¼Œè¯´æ˜åŒä¸€ä¸ªpodä¸­çš„å®¹å™¨å…±äº«ç½‘ç»œå’Œå­˜å‚¨</span></span><br><span class=\"line\">curl http://localhost:8080</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># è¿›å…¥tomcatå®¹å™¨</span></span><br><span class=\"line\">kubectl <span class=\"built_in\">exec</span> -it multi-pod -c tomcat -- /bin/bash</span><br></pre></td></tr></table></figure>\n","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» K8S çš„ Podï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚ K8Så®˜ç½‘ k8s Github k8s Pod ä»‹ç» Pod ä»‹ç» Pod(ç¼©å†™ä¸º po) æ˜¯å¯ä»¥åœ¨ Kubernetes ä¸­åˆ›å»ºå’Œç®¡ç†çš„ã€æœ€å°çš„å¯éƒ¨ç½²çš„è®¡ç®—å•å…ƒã€‚ Podï¼ˆå°±åƒåœ¨è±Œè±†èšä¸­ï¼‰æ˜¯ä¸€ç»„ï¼ˆä¸€ä¸ªæˆ–å¤šä¸ªï¼‰ å®¹å™¨ï¼Œè¿™äº›å®¹å™¨å…±äº«å­˜å‚¨ã€ç½‘ç»œã€ä»¥åŠæ€æ ·è¿è¡Œè¿™äº›å®¹å™¨çš„è§„çº¦ã€‚ Pod ä¸­çš„å†…å®¹æ€»æ˜¯å¹¶ç½®ï¼ˆcolocatedï¼‰çš„å¹¶ä¸”ä¸€åŒè°ƒåº¦ï¼Œåœ¨å…±äº«çš„ä¸Šä¸‹æ–‡ä¸­è¿è¡Œã€‚ Kubernetes é›†ç¾¤ä¸­çš„ Pod ä¸»è¦æœ‰ä¸¤ç§ç”¨æ³•ï¼š è¿è¡Œå•ä¸ªå®¹å™¨çš„ Pod: &quot;æ¯ä¸ª Pod ä¸€ä¸ªå®¹å™¨&quot;æ¨¡å‹æ˜¯æœ€å¸¸è§çš„ Kubernetes ç”¨ä¾‹ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥å°† Pod çœ‹ä½œå•ä¸ªå®¹å™¨çš„åŒ…è£…å™¨ï¼Œå¹¶ä¸” Kubernetes ç›´æ¥ç®¡ç† Podï¼Œè€Œä¸æ˜¯å®¹å™¨ã€‚ è¿è¡Œå¤šä¸ªååŒå·¥ä½œçš„å®¹å™¨çš„ Pod: Pod å¯ä»¥å°è£…ç”±ç´§å¯†è€¦åˆä¸”éœ€è¦å…±äº«èµ„æºçš„å¤šä¸ªå¹¶ç½®å®¹å™¨ç»„æˆçš„åº”ç”¨ï¼Œè¿™äº›ä½äºåŒä¸€ä½ç½®çš„å®¹å™¨æ„æˆä¸€ä¸ªå†…èšå•å…ƒã€‚ Pod ç®¡ç† Pod åˆ›å»º run åˆ›å»º 12345kubectl run nginx --image=nginx# è¾“å‡º yamlkubectl run nginx --image=nginx --dry-run=client -o yaml &gt; pod.yaml# é€šè¿‡ yaml æ–‡ä»¶åˆ›å»ºkubectl apply -f pod.yaml pod ä¸­è‡³å°‘åŒ…å«ä¸¤ä¸ªå®¹å™¨ï¼Œä¸€ä¸ªæ˜¯ä¸šåŠ¡å®¹å™¨ï¼Œæ¯”å¦‚è¿™é‡Œçš„ nginxï¼Œå¦ä¸€ä¸ªæ˜¯ pause å®¹å™¨ï¼Œè´Ÿè´£å…±äº«å®¹å™¨çš„ç½‘ç»œï¼Œè¿›ç¨‹ï¼Œå­˜å‚¨ç­‰èµ„æºã€‚ 1234# é€šè¿‡ crictl ps æ˜¯çœ‹ä¸åˆ° pause å®¹å™¨çš„ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ ctr å‘½ä»¤æŸ¥çœ‹ï¼Œctr æ˜¯ containerd çš„å‘½ä»¤è¡Œå·¥å…·ctr --namespace=k8s.io c ls# æŸ¥çœ‹å®¹å™¨æ‰€å±çš„podctr --namespace=k8s.io c info &lt;container-id&gt; | grep &#x27;pod.name&#x27; pod.yaml æ–‡ä»¶è¯´æ˜ å› ä¸º Pod ä¸æ”¯æŒæ‰©ç¼©å®¹ï¼Œæ‰€ä»¥æ—¥å¸¸ä½¿ç”¨æ—¶ä¸€èˆ¬ä¸ä¼šç›´æ¥åˆ›å»º Podï¼Œè€Œæ˜¯åˆ›å»º Deployment, DaemonSetç­‰è¿™äº›å·¥ä½œè´Ÿè½½èµ„æºï¼Œè¿™äº›åé¢ä¼šä»‹ç»åˆ°ã€‚ ä½†æˆ‘ä»¬è¿™é‡Œè¿˜æ˜¯è¦é‡ç‚¹ä»‹ç»ä¸€ä¸‹ Pod çš„ yaml æ–‡ä»¶æ ¼å¼ï¼Œå› ä¸ºå®ƒæ˜¯åé¢æ‰€æœ‰èµ„æºåˆ›å»ºçš„åŸºç¡€ã€‚ ä¸€ä¸ªæœ€åŸºç¡€çš„ Pod é…ç½®å¦‚ä¸‹ï¼š 12345678apiVersion: v1 # å¿…å¡«ã€‚æŒ‡å®šä½¿ç”¨çš„ API ç‰ˆæœ¬ï¼ŒPod æ˜¯æ ¸å¿ƒèµ„æºï¼Œä½¿ç”¨ v1kind: Pod # å¿…å¡«ã€‚èµ„æºç±»å‹ï¼šPodmetadata: # å¿…å¡«ã€‚å…ƒæ•°æ®ï¼ŒåŒ…å« Pod çš„åç§°ã€å‘½åç©ºé—´ã€æ ‡ç­¾ã€æ³¨è§£ç­‰ä¿¡æ¯ name: nginx # å¿…å¡«ã€‚Pod çš„åç§°ï¼Œå‘½åç©ºé—´ä¸­å”¯ä¸€spec: # å¿…å¡«ã€‚èµ„æºçš„ç‰¹æ€§æè¿°ï¼ˆè§„çº¦ï¼‰ï¼Œå®šä¹‰Podå…·ä½“è¡Œä¸ºçš„éƒ¨åˆ† containers: # å¿…å¡«ã€‚å®¹å™¨åˆ—è¡¨ - image: nginx # å¿…å¡«ã€‚å®¹å™¨ä½¿ç”¨çš„é•œåƒ name: nginx # å¿…å¡«ã€‚å®¹å™¨åç§°ï¼Œåœ¨åŒä¸€ä¸ª Pod å†…å¿…é¡»å”¯ä¸€ Podæ˜¯ç”¨æ¥é…ç½®å®¹å™¨çš„ï¼Œæˆ‘ä»¬åœ¨å­¦ä¹ dockeræ—¶çŸ¥é“ï¼Œå®¹å™¨æœ‰éå¸¸å¤šçš„é…ç½®é¡¹ï¼Œæ¯”å¦‚ç«¯å£ã€ç½‘ç»œã€å­˜å‚¨ç­‰ï¼Œè€Œ pod çš„é…ç½®é¡¹æ›´ä¸°å¯Œã€‚ ä¸€ä¸ªPodçš„é…ç½®ä¸»è¦åŒ…å«ä¸¤å¤§éƒ¨åˆ†ï¼šmetadata å’Œ specï¼Œæ¯ä¸€é¡¹ä¸­åŒ…å«çš„é…ç½®é¡¹éå¸¸å¤šï¼Œè¿™é‡Œåªå¯¹å¸¸ç”¨çš„é…ç½®é¡¹è¿›è¡Œè¯´æ˜ï¼Œè‹¥è¦æŸ¥çœ‹æ¯ä¸ªé…ç½®é¡¹çš„è¯´æ˜å¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤è·å–ï¼š 123456# podå¼€å¤´ï¼Œé…ç½®é¡¹ä»¥ . è¿æ¥ï¼Œä¾‹å¦‚ï¼škubectl explain pod.metadatakubectl explain pod.metadata.labelskubectl explain pod.speckubectl explain pod.spec.containerskubectl explain pod.spec.containers.ports metadata metadata æ˜¯ Pod çš„å…ƒæ•°æ®ï¼Œæ¯”å¦‚ Pod çš„åç§°ã€å‘½åç©ºé—´ã€æ ‡ç­¾ã€æ³¨è§£ç­‰ã€‚ 12345678metadata: # å…ƒæ•°æ®éƒ¨åˆ† name: myapp-pod # Pod çš„åç§° namespace: default # Pod æ‰€åœ¨çš„å‘½åç©ºé—´ï¼Œé»˜è®¤æ˜¯ default labels: # æ ‡ç­¾ï¼Œç”¨äºé€‰æ‹©å™¨ã€ç®¡ç†ã€åˆ†ç»„ app: myapp tier: frontend annotations: # æ³¨è§£ï¼Œç”¨äºæ·»åŠ éç»“æ„åŒ–å…ƒä¿¡æ¯ description: &quot;A sample pod for demonstration&quot; spec spec æè¿°äº† Pod çš„é…ç½®ä¿¡æ¯ï¼ŒåŒ…æ‹¬ Pod çš„å®¹å™¨ã€å­˜å‚¨ã€ç½‘ç»œã€èµ„æºé™åˆ¶ã€è°ƒåº¦ç­–ç•¥ç­‰ spec.containers containers æè¿°äº† Pod ä¸­å®¹å™¨çš„é…ç½®ä¿¡æ¯ï¼ŒåŒ…æ‹¬é•œåƒã€å¯åŠ¨å‘½ä»¤ã€ç¯å¢ƒå˜é‡ã€èµ„æºé™åˆ¶ã€å·æŒ‚è½½ç­‰ 123456789101112131415161718192021222324252627spec: #å¿…é€‰ï¼ŒPodä¸­å®¹å™¨çš„è¯¦ç»†å®šä¹‰ containers: #å¿…é€‰ï¼ŒPodä¸­å®¹å™¨åˆ—è¡¨ - name: string #å¿…é€‰ï¼Œå®¹å™¨åç§° image: string #å¿…é€‰ï¼Œå®¹å™¨çš„é•œåƒåç§° imagePullPolicy: [ Always|Never|IfNotPresent ] #è·å–é•œåƒçš„ç­–ç•¥ï¼Œå½“é•œåƒæ ‡ç­¾ä¸º latest æ—¶é»˜è®¤å€¼ä¸º Alwaysï¼Œå¦åˆ™ä¸º IfNotPresent command: [string] #å®¹å™¨çš„å¯åŠ¨å‘½ä»¤åˆ—è¡¨ï¼Œå¦‚ä¸æŒ‡å®šï¼Œä½¿ç”¨æ‰“åŒ…æ—¶ä½¿ç”¨çš„å¯åŠ¨å‘½ä»¤ args: [string] #å®¹å™¨çš„å¯åŠ¨å‘½ä»¤å‚æ•°åˆ—è¡¨ workingDir: string #å®¹å™¨çš„å·¥ä½œç›®å½•ï¼Œå¦‚æœä¸ºæŒ‡å®šï¼Œåˆ™é»˜è®¤ä¸ºé•œåƒä¸­çš„é…ç½® volumeMounts: #æŒ‚è½½åˆ°å®¹å™¨å†…éƒ¨çš„å­˜å‚¨å·é…ç½® - name: string #å¼•ç”¨podå®šä¹‰çš„å…±äº«å­˜å‚¨å·çš„åç§°ï¼Œéœ€ç”¨volumes[]éƒ¨åˆ†å®šä¹‰çš„çš„å·å mountPath: string #å­˜å‚¨å·åœ¨å®¹å™¨å†…mountçš„ç»å¯¹è·¯å¾„ï¼Œåº”å°‘äº512å­—ç¬¦ readOnly: boolean #æ˜¯å¦ä¸ºåªè¯»æ¨¡å¼ ports: #éœ€è¦æš´éœ²çš„ç«¯å£åº“å·åˆ—è¡¨ - name: string #ç«¯å£çš„åç§° containerPort: 80 #å®¹å™¨éœ€è¦ç›‘å¬çš„ç«¯å£å· hostPort: int #å®¹å™¨æ‰€åœ¨ä¸»æœºéœ€è¦ç›‘å¬çš„ç«¯å£å·ï¼Œé»˜è®¤ä¸Containerç›¸åŒ protocol: string #ç«¯å£åè®®ï¼Œæ”¯æŒTCPå’ŒUDPï¼Œé»˜è®¤TCP env: #å®¹å™¨è¿è¡Œå‰éœ€è®¾ç½®çš„ç¯å¢ƒå˜é‡åˆ—è¡¨ - name: string #ç¯å¢ƒå˜é‡åç§° value: string #ç¯å¢ƒå˜é‡çš„å€¼ resources: #èµ„æºé™åˆ¶å’Œè¯·æ±‚çš„è®¾ç½® limits: #èµ„æºé™åˆ¶çš„è®¾ç½®(ä¸Šé™) cpu: string #Cpuçš„é™åˆ¶ï¼Œå•ä½ä¸ºcoreæ•°ï¼Œå°†ç”¨äºdocker run --cpu-shareså‚æ•° memory: string #å†…å­˜é™åˆ¶ï¼Œå•ä½å¯ä»¥ä¸ºMib/Gibï¼Œå°†ç”¨äºdocker run --memoryå‚æ•° requests: #èµ„æºè¯·æ±‚çš„è®¾ç½®(ä¸‹é™) cpu: string #Cpuè¯·æ±‚ï¼Œå®¹å™¨å¯åŠ¨çš„åˆå§‹å¯ç”¨æ•°é‡ memory: string #å†…å­˜è¯·æ±‚,å®¹å™¨å¯åŠ¨çš„åˆå§‹å¯ç”¨æ•°é‡ ç¤ºä¾‹ 123456789101112131415161718192021spec: # Pod çš„å…·ä½“è§„èŒƒ containers: # Pod ä¸­çš„å®¹å™¨æ•°ç»„ï¼Œå¯ä»¥æœ‰å¤šä¸ªå®¹å™¨ - name: myapp-container # å®¹å™¨åç§° image: nginx:1.25 # ä½¿ç”¨çš„é•œåƒ ports: # å®¹å™¨å¼€æ”¾çš„ç«¯å£ - containerPort: 80 # å®¹å™¨å†…éƒ¨ç«¯å£ï¼Œåªæ˜¯å£°æ˜æ€§çš„å­—æ®µï¼Œä¸å…·æœ‰å†³å®šä½œç”¨ env: # ç¯å¢ƒå˜é‡é…ç½® - name: ENVIRONMENT value: production resources: # èµ„æºé™åˆ¶å’Œè¯·æ±‚ limits: memory: &quot;512Mi&quot; # æœ€å¤§å†…å­˜é™åˆ¶ cpu: &quot;1&quot; # æœ€å¤§ CPU æ ¸å¿ƒæ•°ï¼Œè¿™é‡Œæ˜¯ 1 æ ¸ # cpu: 1000m # 1000m = 1 æ ¸ requests: memory: &quot;256Mi&quot; # åˆå§‹åˆ†é…å†…å­˜ cpu: &quot;0.5&quot; # åˆå§‹åˆ†é… CPU, è¿™é‡Œ0.5 è¡¨ç¤º 0.5 æ ¸ # cpu: 500m # 500 æ¯«æ ¸ï¼Œä¹Ÿå°±æ˜¯ 0.5 æ ¸ volumeMounts: # æŒ‚è½½åˆ°å®¹å™¨çš„å· - name: app-storage # å·åç§°ï¼Œéœ€è¦å’Œ volumes ä¸­å®šä¹‰çš„å·åç§°ä¸€è‡´ mountPath: /usr/share/nginx/html # æŒ‚è½½åˆ°å®¹å™¨çš„ç›®å½• spec.containers.command | args å®¹å™¨å¯åŠ¨æ—¶æ‰§è¡Œçš„å‘½ä»¤ é»˜è®¤æƒ…å†µä¸‹ï¼Œå®¹å™¨å¯åŠ¨æ—¶ï¼Œä¼šä»é•œåƒä¸­è·å–å‘½ä»¤å¹¶æ‰§è¡Œï¼Œå¦‚æœè¿™é‡Œé…ç½®äº†å‘½ä»¤ï¼Œåˆ™å®¹å™¨å¯åŠ¨æ—¶ï¼Œä¼šæ‰§è¡Œè¿™é‡Œçš„å‘½ä»¤ï¼Œè€Œä¸æ˜¯é•œåƒä¸­çš„å‘½ä»¤ 12345spec: containers: - name: busybox-container image: busybox:1.36 command: [&quot;/bin/sh&quot;, &quot;-c&quot;, &quot;while true; do echo hello; sleep 10;done&quot;] æˆ–è€… 123456spec: containers: - name: busybox-container image: busybox:1.36 command: [&quot;/bin/sh&quot;,&quot;-c&quot;] args: [&quot;while true; do echo hello; sleep 10;done&quot;] æˆ–è€… 1234567891011spec: containers: - name: busybox-container image: busybox:1.36 command: [&quot;/bin/bash&quot;, &quot;-c&quot;] args: - | # ä½¿ç”¨ | ç¬¦å·ï¼Œè¡¨ç¤ºå¤šè¡Œè¾“å…¥ while true; do echo &quot;hello world&quot; sleep 5 done spec.restartPolicy æŒ‡åœ¨ç³»ç»Ÿå‘ç”Ÿæ•…éšœæˆ–æ„å¤–åœæœºæ—¶ï¼Œç³»ç»Ÿæˆ–åº”ç”¨ç¨‹åºå¦‚ä½•å¤„ç†å’Œæ¢å¤çš„ç­–ç•¥ Alwaysï¼šæ€»æ˜¯é‡å¯ OnFailureï¼šå¤±è´¥æ—¶é‡å¯ Neverï¼šä¸é‡å¯ 12345spec: containers: - name: my-nginx image: nginx restartPolicy: OnFailure #å¤±è´¥æ—¶é‡å¯ spec.terminationGracePeriodSeconds Pod åˆ é™¤æ—¶ï¼Œç³»ç»Ÿç»™ Pod ç•™çš„æ—¶é—´ï¼Œç”¨äºå®Œæˆæ¸…ç†å·¥ä½œ å®½é™æœŸä¸ºé¿å…æœåŠ¡çªç„¶ä¸­æ–­,é€ æˆäº‹ç‰©ä¸ä¸€è‡´çš„é—®é¢˜,å½“å®¹å™¨è¿è¡Œå®Œè‡ªå·±çš„ä»»åŠ¡å,ä¼šç­‰å¾…ä¸€æ®µæ—¶é—´,ç„¶åä¼˜é›…çš„é€€å‡º é»˜è®¤å€¼ä¸º 30sï¼Œå•ä½ä¸ºç§’ 12345spec: containers: - name: my-nginx image: nginx terminationGracePeriodSeconds: 60 spec.volumes Kubernetes ä¸­çš„å·ï¼ˆvolumesï¼‰æ˜¯ä¸ºäº†åœ¨å®¹å™¨ä¹‹é—´å…±äº«æ•°æ®ï¼Œæˆ–å°†æ•°æ®ä»å®¹å™¨æŒä¹…åŒ–åˆ°å¤–éƒ¨å­˜å‚¨ã€‚ emptyDirï¼ˆæœ€ç®€å•ï¼ŒPod ç”Ÿå‘½å‘¨æœŸå†…æœ‰æ•ˆï¼‰ emptyDir å·æ˜¯ä¸€ä¸ªæ²¡æœ‰åå­—çš„ä¸´æ—¶ç›®å½•ï¼ŒPod åˆ›å»ºæ—¶åˆ›å»ºï¼ŒPod åˆ é™¤æ—¶åˆ é™¤ã€‚ 12345678910spec: containers: - name: app image: nginx volumeMounts: - mountPath: /usr/share/nginx/html name: html-volume volumes: - name: html-volume emptyDir: &#123;&#125; # è¡¨ç¤ºä¸€ä¸ªç©ºç›®å½•ï¼Œåœ¨ Pod ç”Ÿå‘½å‘¨æœŸå†…æœ‰æ•ˆ hostPathï¼ˆæŒ‚è½½å®¿ä¸»æœºè·¯å¾„ï¼‰ ç”¨äºæµ‹è¯•æˆ–éå¸¸äº†è§£å®¿ä¸»æœºç»“æ„çš„åœºæ™¯ã€‚ç”Ÿäº§ä¸æ¨èã€‚ 123456spec: volumes: - name: mydata hostPath: path: /tmp/data # å®¿ä¸»æœºè·¯å¾„ type: DirectoryOrCreate # å¦‚æœç›®å½•ä¸å­˜åœ¨å°±åˆ›å»º configMapï¼ˆæŒ‚è½½é…ç½®æ–‡ä»¶ï¼‰ 12345spec: volumes: - name: config configMap: name: my-configmap # éœ€æå‰åˆ›å»º ConfigMapï¼Œè¿™ä¸ªåé¢ä¼šä»‹ç» ä½¿ç”¨ PVCï¼ˆæŒ‚è½½æŒä¹…åŒ–å­˜å‚¨ï¼‰ 12345spec: volumes: - name: persistent-storage persistentVolumeClaim: claimName: mypvc # PVC åç§°ï¼Œéœ€è¦æå‰åˆ›å»ºï¼Œè¿™ä¸ªåé¢ä¼šä»‹ç» spec.tolerations: Podå®¹å¿ç­–ç•¥ tolerations æ˜¯ Kubernetes Pod ä¸­ç”¨æ¥â€œå®¹å¿â€æŸäº› Node èŠ‚ç‚¹çš„æ±¡ç‚¹ï¼ˆTaintsï¼‰ çš„å­—æ®µã€‚å®ƒå…è®¸ Pod è¢«è°ƒåº¦åˆ°å¸¦æœ‰ç›¸åº” Taint çš„èŠ‚ç‚¹ä¸Šã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼ŒPod ä¼šå› ä¸º Node èŠ‚ç‚¹çš„ Taint è€Œä¸è¢«è°ƒåº¦ã€‚ æ¯”å¦‚ä¸€ä¸ª Node æœ‰ NoSchedule ç±»å‹çš„ taintï¼Œè€Œ Pod æ²¡æœ‰è®¾ç½®å¯¹åº”çš„ tolerationï¼Œè¯¥ Pod å°±ä¸ä¼šè¢«è°ƒåº¦åˆ°è¿™ä¸ª Node ä¸Šã€‚ ç¤ºä¾‹ï¼š å®¹å¿ key=value:NoSchedule çš„ Taint å‡è®¾æŸèŠ‚ç‚¹æ‰“äº†å¦‚ä¸‹æ±¡ç‚¹ï¼ˆTaintï¼‰ï¼š 12345678910111213kubectl taint nodes node1 key=value:NoSchedule# NoSchedule ä¸è°ƒåº¦åˆ°è¯¥èŠ‚ç‚¹ï¼Œé™¤éå®¹å¿ç­–ç•¥æ˜¾å¼å…è®¸# PreferNoSchedule å°½é‡ä¸è°ƒåº¦åˆ°è¯¥èŠ‚ç‚¹ï¼Œä½†éå¼ºåˆ¶ï¼Œå³å¯èƒ½ä¼šè¢«è°ƒåº¦# NoExecute ä¸ä»…ä¸è°ƒåº¦åˆ°è¯¥èŠ‚ç‚¹ï¼Œè¿˜ä¼šæŠŠç°æœ‰ Pod é©±é€å‡ºå»ï¼Œé™¤éè®¾ç½®å®¹å¿æ—¶é—´# key=value æ˜¯ç”¨æ¥ åŒºåˆ†ä¸åŒç±»å‹çš„æ±¡ç‚¹çš„ã€‚æ¯”å¦‚ï¼š# ä½ å¯èƒ½ç»™ node1 è®¾ç½® env=prod:NoSchedule# ç»™ node2 è®¾ç½® gpu=true:NoSchedule# ç»™ node3 è®¾ç½® arch=arm64:NoSchedule# è¿™äº›éƒ½å±äºä¸åŒçš„â€œåŸå› â€æˆ–â€œæ ‡ç­¾â€ï¼Œè¿™æ ·ä½ å¯ä»¥ï¼š# ç”¨ä¸åŒçš„ toleration æ¥å®¹å¿ä¸åŒçš„ taintï¼›# ç²¾å‡†æ§åˆ¶æŸäº› Pod åªèƒ½è¢«è°ƒåº¦åˆ°ç¬¦åˆæ¡ä»¶çš„èŠ‚ç‚¹ã€‚ å®¹å¿è¯¥ Taint 123456789101112131415apiVersion: v1kind: Podmetadata: name: tolerate-examplespec: containers: - name: busybox image: busybox command: [&quot;sleep&quot;, &quot;3600&quot;] tolerations: # å®šä¹‰å®¹å¿ç­–ç•¥ - operator: &quot;Equal&quot; # åŒ¹é…æ–¹å¼ï¼Œå¿…é€‰ï¼ˆEqual:ç²¾ç¡®åŒ¹é… key å’Œ valueã€‚Exists:åªåŒ¹é… key æ˜¯å¦å­˜åœ¨ï¼Œä¸å…³å¿ƒ value æ˜¯ä»€ä¹ˆï¼‰ key: &quot;key&quot; # è®¾ç½®é”®å€¼å¯¹çš„keyï¼Œä¸ºç©ºä»£è¡¨ä»»æ„é”®å€¼å¯¹ value: &quot;value&quot; # è®¾ç½®valuesçš„å€¼ï¼Œ effect: &quot;NoSchedule&quot; # è®¾ç½®å®¹å¿çš„æ ‡ç­¾ï¼Œä¸ºç©ºä»£è¡¨æ‰€æœ‰æ±¡ç‚¹æ ‡ç­¾ tolerationSeconds: 60 # å®¹å¿æ—¶é—´ï¼Œè¿™é‡ŒPod æœ€å¤šå¯åœç•™ 60 ç§’ï¼Œä¹‹åä»ä¼šè¢«é©±é€ï¼Œä¸è®¾ç½®è¡¨ç¤ºæ°¸ä¹…å®¹å¿ åœ¨ Kubernetes ä¸­ï¼Œeffect æœ‰ ä¸‰ä¸ªå¯é€‰å€¼ï¼š effect å€¼ å«ä¹‰ å¸¸è§ç”¨é€” NoSchedule èŠ‚ç‚¹ä¸Šçš„æ±¡ç‚¹ä¼šé˜»æ­¢ Pod è¢«è°ƒåº¦åˆ°è¯¥èŠ‚ç‚¹ï¼Œé™¤é Pod æœ‰ç›¸åº”çš„ tolerationã€‚ æœ€å¸¸ç”¨ï¼Œä¾‹å¦‚ Master èŠ‚ç‚¹çš„å®¹å¿ã€‚ PreferNoSchedule å€¾å‘äºä¸è°ƒåº¦ åˆ°è¯¥èŠ‚ç‚¹ï¼Œä½†ä¸æ˜¯å¼ºåˆ¶æ€§çš„ï¼Œè°ƒåº¦å™¨ä¼šå°½é‡é¿å…æŠŠ Pod å®‰æ’åˆ°è¯¥èŠ‚ç‚¹ã€‚ ç”¨äºè½¯çº¦æŸï¼Œå°½é‡ä¸è°ƒåº¦ã€‚ NoExecute ä¸ä»…ä¸è°ƒåº¦æ–° Pod åˆ°è¯¥èŠ‚ç‚¹ï¼Œè¿˜ä¼šæŠŠå½“å‰èŠ‚ç‚¹ä¸Šæ²¡æœ‰ç›¸åº”å®¹å¿åº¦çš„ Pod é©±é€å‡ºå»ï¼ˆevictionï¼‰ã€‚ èŠ‚ç‚¹å¼‚å¸¸è‡ªåŠ¨é©±é€ï¼Œæ¯”å¦‚ not-readyã€‚ spec.resources Podèµ„æºé…é¢å¯ä»¥é™åˆ¶å‘½åç©ºé—´æˆ–é¡¹ç›®ä¸­Podä½¿ç”¨çš„CPUã€å†…å­˜ã€å­˜å‚¨ç­‰èµ„æºç”¨é‡ CPUèµ„æºçš„çº¦æŸå’Œè¯·æ±‚ä»¥è±ªæ ¸ï¼ˆmï¼‰ä¸ºå•ä½ã€‚åœ¨k8sä¸­1mæ˜¯æœ€å°çš„è°ƒåº¦å•å…ƒï¼ŒCPUçš„ä¸€ä¸ªæ ¸å¿ƒå¯ä»¥çœ‹ä½œ1000m å¦‚æœä½ æœ‰2é¢—cpuï¼Œä¸”æ¯CPUä¸º4æ ¸å¿ƒï¼Œé‚£ä¹ˆä½ çš„CPUèµ„æºæ€»é‡å°±æ˜¯8000 12345678910111213spec: # Pod çš„å…·ä½“è§„èŒƒ containers: # Pod ä¸­çš„å®¹å™¨æ•°ç»„ï¼Œå¯ä»¥æœ‰å¤šä¸ªå®¹å™¨ - name: myapp-container # å®¹å™¨åç§° image: nginx:1.25 # ä½¿ç”¨çš„é•œåƒ resources: # èµ„æºé™åˆ¶å’Œè¯·æ±‚ limits: memory: &quot;512Mi&quot; # æœ€å¤§å†…å­˜é™åˆ¶ cpu: &quot;1&quot; # æœ€å¤§ CPU æ ¸å¿ƒæ•°ï¼Œè¿™é‡Œæ˜¯ 1 æ ¸ # cpu: 1000m # 1000m = 1 æ ¸ requests: memory: &quot;256Mi&quot; # åˆå§‹åˆ†é…å†…å­˜ cpu: &quot;0.5&quot; # åˆå§‹åˆ†é… CPU, è¿™é‡Œ0.5 è¡¨ç¤º 0.5 æ ¸ # cpu: 500m # 500 æ¯«æ ¸ï¼Œä¹Ÿå°±æ˜¯ 0.5 æ ¸ å¦‚æœæœ‰å¤§é‡çš„å®¹å™¨éœ€è¦è®¾ç½®èµ„æºé…é¢ï¼Œä¸ºæ¯ä¸ªPodè®¾ç½®èµ„æºé…é¢ç­–ç•¥ä¸æ–¹ä¾¿ä¸”ä¸å¥½ç®¡ç† å¯ä»¥ä»¥åç§°ç©ºé—´ä¸ºå•ä½ï¼ˆnamespaceï¼‰ï¼Œé™åˆ¶å…¶èµ„æºçš„ä½¿ç”¨ä¸åˆ›å»ºï¼Œåœ¨è¯¥åç§°ç©ºé—´ä¸­åˆ›å»ºçš„å®¹å™¨éƒ½ä¼šå—åˆ°è§„åˆ™çš„é™åˆ¶ã€‚ LimitRange å¯¹å•ä¸ªPodå†…å­˜ã€CPUè¿›è¡Œé…é¢ 1234567891011121314151617181920apiVersion: v1kind: LimitRangemetadata: name: mem-cpu-limit-range # LimitRange çš„åç§° namespace: demo # ç”Ÿæ•ˆçš„å‘½åç©ºé—´spec: limits: - type: Container # è¡¨ç¤ºé™åˆ¶çš„æ˜¯æ¯ä¸ªå®¹å™¨ï¼ˆä¹Ÿå¯è®¾ç½®ä¸º Podï¼‰ default: # å®¹å™¨æœªæŒ‡å®š resources.limits æ—¶ä½¿ç”¨çš„é»˜è®¤å€¼ cpu: 500m # é»˜è®¤é™åˆ¶ CPU ä¸º 0.5 æ ¸ memory: 512Mi # é»˜è®¤é™åˆ¶å†…å­˜ä¸º 512 MiB defaultRequest: # å®¹å™¨æœªæŒ‡å®š resources.requests æ—¶ä½¿ç”¨çš„é»˜è®¤è¯·æ±‚å€¼ï¼Œåˆå§‹å€¼ cpu: 100m # é»˜è®¤è¯·æ±‚ CPU ä¸º 0.1 æ ¸ memory: 128Mi # é»˜è®¤è¯·æ±‚å†…å­˜ä¸º 128 MiB max: # å®¹å™¨å¯è®¾ç½®çš„æœ€å¤§é™åˆ¶å€¼ï¼Œå³ å®¹å™¨ä¸­æŒ‡å®šçš„ resources.limits çš„æœ€å¤§å…è®¸å€¼ cpu: &quot;1&quot; # æœ€å¤§å¯ä½¿ç”¨ CPU ä¸º 1 æ ¸ memory: 1Gi # æœ€å¤§å¯ä½¿ç”¨å†…å­˜ä¸º 1 GiB min: # å®¹å™¨å¯è®¾ç½®çš„æœ€å°è¯·æ±‚å€¼ï¼Œï¼Œå³ å®¹å™¨ä¸­æŒ‡å®šçš„ resources.requests çš„æœ€å°å…è®¸å€¼ cpu: 50m # æœ€å°è¯·æ±‚ CPU ä¸º 0.05 æ ¸ memory: 64Mi # æœ€å°è¯·æ±‚å†…å­˜ä¸º 64 MiB ResourceQuota é™åˆ¶æ•´ä¸ª namespace çš„èµ„æºæ€»é‡ 123456789101112apiVersion: v1kind: ResourceQuotametadata: name: compute-resources # ResourceQuota çš„åç§° namespace: demo # ç”Ÿæ•ˆçš„å‘½åç©ºé—´spec: hard: # å®šä¹‰å„ç±»èµ„æºçš„æ€»é…é¢ä¸Šé™ pods: &quot;10&quot; # è¯¥å‘½åç©ºé—´æœ€å¤šå…è®¸åˆ›å»º 10 ä¸ª Pod requests.cpu: &quot;2&quot; # æ‰€æœ‰ Pod çš„ requests.cpu æ€»å’Œæœ€å¤šä¸º 2 æ ¸ requests.memory: 4Gi # æ‰€æœ‰ Pod çš„ requests.memory æ€»å’Œæœ€å¤šä¸º 4 GiB limits.cpu: &quot;4&quot; # æ‰€æœ‰ Pod çš„ limits.cpu æ€»å’Œæœ€å¤šä¸º 4 æ ¸ limits.memory: 8Gi # æ‰€æœ‰ Pod çš„ limits.memory æ€»å’Œæœ€å¤šä¸º 8 GiB spec.priorityClassName Pod çš„ä¼˜å…ˆçº§ï¼Œä¼˜å…ˆçº§å°±æ˜¯ä¸ºäº†ä¿è¯é‡è¦çš„Podè¢«ä¼˜å…ˆè°ƒåº¦å¹¶è¿è¡Œ ä¼˜å…ˆçº§ç­–ç•¥ï¼š éæŠ¢å ä¼˜å…ˆï¼šæŒ‡çš„æ˜¯åœ¨è°ƒåº¦é˜¶æ®µä¼˜å…ˆè¿›è¡Œè°ƒåº¦åˆ†é…ï¼Œä¸€æ—¦å®¹å™¨è°ƒåº¦å®Œæˆå°±ä¸å¯ä»¥æŠ¢å ï¼Œèµ„æºä¸è¶³æ—¶ï¼Œåªèƒ½ç­‰å¾… æŠ¢å ä¼˜å…ˆï¼šå¼ºåˆ¶è°ƒåº¦ä¸€ä¸ªPodï¼Œå¦‚æœèµ„æºä¸è¶³æ— æ³•è¢«è°ƒåº¦ï¼Œè°ƒåº¦ç¨‹åºä¼šæŠ¢å ï¼ˆåˆ é™¤ï¼‰è¾ƒä½ä¼˜å…ˆçº§çš„Podçš„èµ„ æºï¼Œæ¥ä¿è¯é«˜ä¼˜å…ˆçº§Podçš„è¿è¡Œ åˆ›å»ºä¼˜å…ˆçº§ 1234567891011121314151617181920---kind: PriorityClassapiVersion: scheduling.k8s.io/v1metadata: name: high-non # ä¼˜å…ˆçº§åç§°preemptionPolicy: Never # ç­–ç•¥ï¼šéæŠ¢å ï¼ŒPreemptLowerPriority:æŠ¢å ï¼ˆåˆ é™¤ï¼‰è¾ƒä½ä¼˜å…ˆçº§çš„Podçš„èµ„æºï¼Œä¿è¯é«˜ä¼˜å…ˆçº§Podçš„è¿è¡Œvalue: 1000 # ä¼˜å…ˆçº§ï¼Œå¯ä»¥è®¾ç½®å°äº10äº¿çš„æ•´æ•°å€¼ï¼Œå€¼è¶Šå¤§ï¼Œä¼˜å…ˆçº§è¶Šé«˜ï¼Œé»˜è®¤ä¼˜å…ˆçº§0---kind: PodapiVersion: v1metadata: name: nginxspec: nodeSelector: kubernetes.io/hostname: node01 # æŒ‡å®šåŒ¹é…å…·æœ‰å½“å‰æ ‡ç­¾çš„èŠ‚ç‚¹ priorityClassName: high-non # ä¼˜å…ˆçº§åç§° containers: - name: my-nginx image: nginx spec.nodeName | nodeSelector :Podè°ƒåº¦ç­–ç•¥ åœ¨k8sä¸­ï¼Œè°ƒåº¦æ˜¯å°†Podåˆ†é…åˆ°åˆé€‚çš„èŠ‚ç‚¹å¹¶è¿è¡Œçš„è¿‡ç¨‹ï¼Œkube-scheduleræ˜¯é»˜è®¤è°ƒåº¦å™¨ï¼Œæ˜¯é›†ç¾¤çš„æ ¸å¿ƒç»„ä»¶ã€‚ è°ƒåº¦å™¨é€šè¿‡k8sçš„ç›‘æµ‹ï¼ˆWatchï¼‰æœºåˆ¶æ¥å‘ç°é›†ç¾¤ä¸­å°šæœªè¢«è°ƒåº¦åˆ°èŠ‚ç‚¹ä¸Šçš„Podï¼Œè°ƒåº¦å™¨ä¾æ®è°ƒåº¦åŸåˆ™å°†Podåˆ†é…åˆ°ä¸€ä¸ªåˆé€‚çš„èŠ‚ç‚¹ä¸Šè¿è¡Œã€‚ è°ƒåº¦å™¨ç»™ä¸€ä¸ªpodåšè°ƒåº¦åŒ…å«ä¸¤ä¸ªæ­¥éª¤ï¼š è¿‡æ»¤ å’Œ æ‰“åˆ† è¿‡æ»¤ï¼šé¦–å…ˆè¦ç­›é€‰å‡ºæ»¡è¶³Podæ‰€æœ‰çš„èµ„æºè¯·æ±‚çš„èŠ‚ç‚¹ï¼Œè¿™é‡ŒåŒ…å«è®¡ç®—èµ„æºã€å†…å­˜ã€å­˜å‚¨ã€ç½‘ç»œã€ç«¯å£å·ç­‰ç­‰ï¼Œå¦‚æœæ²¡æœ‰èŠ‚ç‚¹èƒ½æ»¡è¶³Podçš„éœ€æ±‚ï¼ŒPodå°†ä¸€ç›´åœç•™åœ¨PendingçŠ¶æ€ï¼Œç›´åˆ°è°ƒåº¦å™¨èƒ½å¤Ÿæ‰¾åˆ°åˆé€‚çš„èŠ‚ç‚¹è¿è¡Œå®ƒ æ‰“åˆ†ï¼šè°ƒåº¦å™¨å°†èŠ‚ç‚¹æŒ‰ç…§æ‰“åˆ†è§„åˆ™è¿›è¡Œæ‰“åˆ†ï¼Œç„¶åæŒ‰ç…§åˆ†æ•°è¿›è¡Œæ’åºï¼Œå°†åˆ†æ•°æœ€é«˜çš„èŠ‚ç‚¹ä½œä¸ºPodçš„è¿è¡ŒèŠ‚ç‚¹ã€‚å¦‚æœå­˜åœ¨å¤šä¸ªå¾—åˆ†æœ€é«˜çš„èŠ‚ç‚¹ï¼Œè°ƒåº¦å™¨ä¼šä»ä¸­éšæœºé€‰å–ä¸€ä¸ªã€‚ Pod æ”¯æŒä¸¤ç§è°ƒåº¦ç­–ç•¥ï¼šnodeName å’Œ nodeSelector spec.nodeName æŒ‡å®š Pod è¿è¡Œåœ¨æŒ‡å®šåç§°çš„èŠ‚ç‚¹ä¸Š 12345spec: nodeName: node-1 # åŸºäºèŠ‚ç‚¹åè¿›è¡Œè°ƒåº¦ containers: - name: apache image: myos:httpd spec.nodeSelector èŠ‚ç‚¹é€‰æ‹©å™¨ï¼ŒåŸºäºèŠ‚ç‚¹çš„æ ‡ç­¾è¿›è¡Œè°ƒåº¦ 123456spec: nodeSelector: # åŸºäºèŠ‚ç‚¹æ ‡ç­¾è¿›è¡Œè°ƒåº¦ kubernetes.io/hostname: node-2 # æ ‡ç­¾ containers: - name: apache image: myos:httpd ä¸ºèŠ‚ç‚¹è®¾ç½®æ ‡ç­¾ 1234567891011# æ‰€æœ‰èµ„æºéƒ½å¯ä»¥è®¾ç½®æ ‡ç­¾ï¼Œè¯­æ³•ä¸ºï¼š kubectl label &lt;èµ„æº&gt; &lt;èµ„æºåç§°&gt; &lt;æ ‡ç­¾key&gt;=&lt;æ ‡ç­¾value&gt;kubectl label nodes node-2 kubernetes.io/hostname=node-2# åˆ é™¤æ ‡ç­¾ï¼Œè¯­æ³•ä¸ºï¼š kubectl label &lt;èµ„æº&gt; &lt;èµ„æºåç§°&gt; &lt;æ ‡ç­¾key&gt;-# è¿™é‡Œæ³¨æ„ï¼Œåˆ é™¤æ ‡ç­¾å°±æ˜¯åœ¨æ ‡ç­¾keyååŠ ä¸Š - ç¬¦å·kubectl label nodes node-2 kubernetes.io/hostname-# æŸ¥çœ‹èµ„æºæ ‡ç­¾ï¼škubectl get &lt;èµ„æº&gt; --show-labelskubectl get nodes --show-labels# æŸ¥çœ‹æŒ‡å®šèŠ‚ç‚¹çš„æ ‡ç­¾kubectl get nodes node-2 --show-labels spec.affinity èŠ‚ç‚¹äº²å’Œæ€§ï¼Œç”¨äºæ§åˆ¶ Pod è°ƒåº¦åˆ°å…·æœ‰ç‰¹å®šæ ‡ç­¾çš„èŠ‚ç‚¹ä¸Šï¼Œæ˜¯ nodeSelector çš„å¢å¼ºç‰ˆæœ¬ ç±»å‹ åŠŸèƒ½ ç¤ºä¾‹ç”¨é€” Node Affinity æ§åˆ¶è°ƒåº¦åˆ°æœ‰æŒ‡å®šæ ‡ç­¾çš„èŠ‚ç‚¹ SSDã€é«˜å†…å­˜èŠ‚ç‚¹ Pod Affinity è°ƒåº¦åˆ°å’ŒæŸäº› Pod ä¸€èµ·çš„èŠ‚ç‚¹ å¾®æœåŠ¡ååŒéƒ¨ç½² Pod Anti-Affinity é¿å…å’ŒæŸäº› Pod ä¸€èµ·çš„èŠ‚ç‚¹ é«˜å¯ç”¨å‰¯æœ¬åˆ†æ•£éƒ¨ç½² èŠ‚ç‚¹äº²å’Œæ€§(Node Affinity) Pod åªèƒ½è°ƒåº¦åˆ°å…·æœ‰æ ‡ç­¾ disktype=ssd çš„èŠ‚ç‚¹ä¸Š 1234567891011121314151617apiVersion: v1kind: Podmetadata: name: node-affinity-podspec: containers: - name: nginx image: nginx affinity: # äº²å’Œæ€§é…ç½® nodeAffinity: # èŠ‚ç‚¹äº²å’Œæ€§ requiredDuringSchedulingIgnoredDuringExecution: # åœ¨è°ƒåº¦æœŸé—´å¿…é¡»æ»¡è¶³ï¼Œè¿è¡Œä¸­å¿½ç•¥å˜åŒ–ï¼ˆå³è°ƒåº¦åæ ‡ç­¾å˜äº†ä¸ä¼šé©±é€ Podï¼‰ã€‚ä¹Ÿå¯ä»¥è®¾ç½®ä¸º preferredDuringSchedulingIgnoredDuringExecutionï¼Œè¡¨ç¤ºèŠ‚ç‚¹äº²å’Œæ€§ä¼˜å…ˆçº§é«˜ï¼Œä½†ä¸å¼ºåˆ¶è¦æ±‚å¿…é¡»æ»¡è¶³ nodeSelectorTerms: # èŠ‚ç‚¹é€‰æ‹©å™¨ - matchExpressions: # åŒ¹é…è¡¨è¾¾å¼ï¼Œæ”¯æŒå¤æ‚é€»è¾‘ï¼Œæ¯”å¦‚ Inã€NotInã€Existsã€DoesNotExistã€Gtã€Ltã€‚ - key: disktype # é”® operator: In # æ“ä½œç¬¦ values: # å€¼ - ssd Pod äº²å’Œæ€§(Pod Affinity) Pod ä¼šè¢«è°ƒåº¦åˆ° ä¸æ ‡ç­¾ä¸º app=web çš„ Pod æ‰€åœ¨åŒä¸€èŠ‚ç‚¹ï¼ˆæˆ–æ‹“æ‰‘å±‚ï¼‰ä¸Šã€‚ é€šå¸¸ç”¨äºéœ€è¦ç´§å¯†åä½œçš„æœåŠ¡éƒ¨ç½²åœ¨ä¸€èµ·ï¼ˆå¦‚åŒä¸€æœºå™¨å†…é€šä¿¡ï¼‰ã€‚ 12345678910111213141516171819apiVersion: v1kind: Podmetadata: name: pod-affinity-podspec: containers: - name: app image: busybox command: [&quot;sleep&quot;, &quot;3600&quot;] affinity: podAffinity: # pod äº²å’Œæ€§ requiredDuringSchedulingIgnoredDuringExecution: - labelSelector: # æ ‡ç­¾é€‰æ‹©å™¨ matchExpressions: # æ ‡ç­¾é€‰æ‹©æ¡ä»¶ - key: app # é”® operator: In # æ“ä½œç¬¦ values: # å€¼ - web topologyKey: &quot;kubernetes.io/hostname&quot; # æ‹“æ‰‘é”®ï¼Œè¡¨ç¤ºâ€œåŒä¸€ä¸»æœºâ€ Pod åäº²å’Œæ€§(Pod Anti-Affinity) è¡¨ç¤ºä¸èƒ½å’Œ app=web çš„ Pod åœ¨åŒä¸€èŠ‚ç‚¹ä¸Š å¸¸ç”¨äºé«˜å¯ç”¨éƒ¨ç½²ï¼Œé¿å…å¤šä¸ªå‰¯æœ¬éƒ¨ç½²åœ¨åŒä¸€ä¸ªèŠ‚ç‚¹ã€‚ 12345678910111213141516171819apiVersion: v1kind: Podmetadata: name: pod-anti-affinity-podspec: containers: - name: app image: busybox command: [&quot;sleep&quot;, &quot;3600&quot;] affinity: podAntiAffinity: # Pod åäº²å’Œæ€§ requiredDuringSchedulingIgnoredDuringExecution: - labelSelector: matchExpressions: - key: app operator: In values: - web topologyKey: &quot;kubernetes.io/hostname&quot; èŠ‚ç‚¹äº²å’Œæ€§ (Node Affinity) ä¸¤ç§ç­–ç•¥çš„å¯¹æ¯” ç­–ç•¥å­—æ®µ å«ä¹‰ è¡Œä¸ºç‰¹ç‚¹ åœºæ™¯é€‚ç”¨ æ˜¯å¦å¼ºåˆ¶ requiredDuringSchedulingIgnoredDuringExecution â€œå¿…é¡»æ»¡è¶³â€äº²å’Œæ€§è§„åˆ™ Pod è°ƒåº¦æ—¶å¿…é¡»æ»¡è¶³æ¡ä»¶ï¼Œä¸æ»¡è¶³åˆ™ä¸è°ƒåº¦ï¼›è°ƒåº¦åèŠ‚ç‚¹å˜åŒ–ä¸è§¦å‘é©±é€ ç¡¬æ€§çº¦æŸï¼Œæ¯”å¦‚å¿…é¡»è°ƒåº¦åˆ°æœ‰ GPU çš„èŠ‚ç‚¹ âœ… å¼ºåˆ¶ preferredDuringSchedulingIgnoredDuringExecution â€œå°½é‡æ»¡è¶³â€äº²å’Œæ€§è§„åˆ™ Pod è°ƒåº¦æ—¶ä¼˜å…ˆè€ƒè™‘æ»¡è¶³æ¡ä»¶çš„èŠ‚ç‚¹ï¼Œä½†æ¡ä»¶ä¸æ»¡è¶³æ—¶ä»ç„¶å¯ä»¥è°ƒåº¦åˆ°å…¶ä»–èŠ‚ç‚¹ï¼›è°ƒåº¦ååŒæ ·ä¸ä¼šå¼ºåˆ¶è¿ç§» è½¯æ€§å€¾å‘ï¼Œæ¯”å¦‚å°½é‡è°ƒåº¦åˆ° SSD èŠ‚ç‚¹ï¼Œä½†å®åœ¨æ²¡æœ‰ä¹Ÿå¯è°ƒåº¦ âŒ éå¼ºåˆ¶ spec.securityContext: è®¾ç½®å®‰å…¨ä¸Šä¸‹æ–‡ runAsUser: è®¾ç½®è¿è¡Œç”¨æˆ· é»˜è®¤æƒ…å†µä¸‹å®¹å™¨éƒ½æ˜¯ä»¥rootç”¨æˆ·è¿è¡Œçš„ï¼Œä½†æ˜¯å¾ˆå¤šåº”ç”¨éœ€è¦ä»¥érootç”¨æˆ·è¿è¡Œï¼Œæ¯”å¦‚ Elasticsearch ã€‚ 123456789101112apiVersion: v1kind: Podmetadata: name: pod1spec: containers: - name: centos1 image: centos:v1 command: [&quot;/bin/sh&quot;, &quot;-c&quot;, &quot;while true; do echo hello; sleep 10;done&quot;] imagePullPolicy: IfNotPresent securityContext: runAsUser: 1000 # è®¾ç½®è¿è¡Œç”¨æˆ·ï¼Œè¿™ä¸ªUIDå¯ä»¥ä¸å­˜åœ¨ privileged: æ˜¯å¦ä»¥ç‰¹æƒæ–¹å¼è¿è¡Œ å®¹å™¨ä¸å®¿ä¸»æœºæ˜¯å…±äº«å†…æ ¸çš„ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œå®¹å™¨ç”¨æˆ·æ˜¯ä¸å…è®¸ä¿®æ”¹å†…æ ¸å‚æ•°çš„ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡è®¾ç½® privileged: true æ¥å…è®¸å®¹å™¨ä»¥ç‰¹æƒæ–¹å¼è¿è¡Œã€‚ 123456789101112apiVersion: v1kind: Podmetadata: name: nginxspec: containers: - name: centos1 image: centos:v1 command: [&quot;/bin/sh&quot;, &quot;-c&quot;, &quot;while true; do echo hello; sleep 10;done&quot;] imagePullPolicy: IfNotPresent securityContext: privileged: true # ç‰¹æƒæ–¹å¼è¿è¡Œï¼Œé»˜è®¤ä¸º false allowPrivilegeEscalation: æ˜¯å¦å¯ä»¥ææƒï¼ˆSUIDï¼‰ sä½ï¼šå½“æŸå¯æ‰§è¡Œå‘½ä»¤çš„æ‰€æœ‰è€…çš„ä½ç½®ä¸Šæœ‰sä½æ—¶ï¼Œé‚£ä¹ˆå½“æ™®é€šç”¨æˆ·æ‰§è¡Œè¿™ä¸ªå‘½ä»¤æ—¶å°†å…·æœ‰æ‰€æœ‰è€…çš„æƒé™ã€‚ 123456789101112apiVersion: v1kind: Podmetadata: name: nginxspec: containers: - name: centos1 image: centos:v1 command: [&quot;/bin/sh&quot;, &quot;-c&quot;, &quot;while true; do echo hello; sleep 10;done&quot;] imagePullPolicy: IfNotPresent securityContext: allowPrivilegeEscalation: true # ææƒè¿è¡Œï¼Œå¯ä»¥ä½¿ç”¨suidï¼Œé»˜è®¤ä¸º false æŸ¥çœ‹ Pod 12345678910111213141516171819202122232425# æŸ¥çœ‹ Podï¼Œé»˜è®¤æ˜¾ç¤º default å‘½åç©ºé—´ä¸‹çš„ Podkubectl get pods# æŸ¥çœ‹ kube-system å‘½åç©ºé—´ä¸‹çš„ Podkubectl get pods -n kube-system# æŸ¥çœ‹æ‰€æœ‰å‘½åç©ºé—´ä¸‹çš„ Podkubectl get pods -A# -o wide: æ˜¾ç¤º Pod çš„è¯¦ç»†ä¿¡æ¯ï¼Œæ­¤æ—¶ä¼šçœ‹åˆ° pod çš„ IP åœ°å€ã€èŠ‚ç‚¹åç§°ç­‰ä¿¡æ¯kubectl get pods -o wide# æ˜¾ç¤º Pod çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¾“å‡ºä¸º json/yaml æ ¼å¼kubectl get pods -o json/yaml# æ˜¾ç¤º Pod çš„æ ‡ç­¾kubectl get pod --show-labels# æŒ‰ Pod çš„æ ‡ç­¾è¿›ç¨‹æŸ¥è¯¢kubectl get pod -l &lt;label_name&gt;=&lt;label_value&gt;# æŒç»­æŸ¥çœ‹ Pod çš„çŠ¶æ€ï¼Œå½“ pod çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶ï¼Œä¼šå®æ—¶æ˜¾ç¤ºkubectl get pods -w## çŠ¶æ€ç±»å‹- Pending: Pod å°šæœªå°±ç»ª- ContainerCreating: Pod æ­£åœ¨åˆ›å»ºå®¹å™¨- Running: Pod æ­£åœ¨è¿è¡Œ- Error: Pod è¿è¡Œé”™è¯¯- Terminating: Pod æ­£åœ¨åˆ é™¤- Completed: Pod æ‰§è¡Œå®Œæˆ- Failed: Podä¸­çš„æ‰€æœ‰å®¹å™¨è‡³å°‘æœ‰ä¸€ä¸ªå®¹å™¨é€€å‡ºæ˜¯é0çŠ¶æ€- Unkown: æ— æ³•æ­£å¸¸è·å–Podå¯¹è±¡çš„çŠ¶æ€ä¿¡æ¯ æŸ¥çœ‹ Pod è¯¦æƒ… å½“ pod è¿è¡Œé”™è¯¯æ—¶ï¼Œå¯ä»¥é€šè¿‡è¯¥å‘½ä»¤æŸ¥çœ‹ pod çš„è¯¦æƒ…ï¼Œæ‰¾åˆ°é”™è¯¯åŸå›  1234567891011121314151617kubectl describe pod &lt;pod-name&gt;kubectl describe pod &lt;pod-name&gt; -n &lt;namespace-name&gt;## æ’æŸ¥åŸå› æ—¶ä¸»è¦è§‚å¯Ÿæœ€åçš„ Eventsï¼Œä»ä¸Šåˆ°ä¸‹å°±æ˜¯ Pod çš„è¿è¡Œè¿‡ç¨‹Events: Type Reason Age From Message ---- ------ ---- ---- ------- # è¢«è°ƒåº¦å™¨åˆ†é…åˆ° k8s-worker2 èŠ‚ç‚¹ Normal Scheduled 4s default-scheduler Successfully assigned default/nginx to k8s-worker2 # å¼€å§‹æ‹‰å–é•œåƒ Normal Pulling &lt;invalid&gt; kubelet Pulling image &quot;nginx&quot; # é•œåƒæ‹‰å–æˆåŠŸ Normal Pulled &lt;invalid&gt; kubelet Successfully pulled image &quot;nginx&quot; in 2.067s (2.067s including waiting). Image size: 72225394 bytes. # å¼€å§‹åˆ›å»ºå®¹å™¨ Normal Created &lt;invalid&gt; kubelet Created container: nginx # å®¹å™¨å¯åŠ¨æˆåŠŸ Normal Started &lt;invalid&gt; kubelet Started container nginx è¿›å…¥å®¹å™¨ 12# kubectl exec -it &lt;pod-name&gt; -n &lt;namespace-name&gt; -- &lt;command&gt;kubectl exec -it nginx -- /bin/bash åˆ é™¤ Pod 123456789101112131415kubectl delete pod &lt;pod-name&gt;kubectl delete pod &lt;pod-name&gt; -n &lt;namespace-name&gt;# å¼ºåˆ¶åˆ é™¤## 1.ç§»é™¤ Pod ä¸Šçš„ Finalizers## finalizers æ˜¯ Kubernetes å¯¹è±¡ä¸Šçš„ä¸€ä¸ªå­—æ®µï¼Œç”¨æ¥å‘Šè¯‰ Kubernetesï¼Œåœ¨åˆ é™¤æˆ‘ä¹‹å‰ï¼Œè¯·å…ˆåšä¸€äº›æ¸…ç†å·¥ä½œï¼ˆå¦‚é‡Šæ”¾èµ„æºã€é€šçŸ¥å¤–éƒ¨ç³»ç»Ÿç­‰ï¼‰ï¼Œç­‰æˆ‘è‡ªå·±åˆ æ‰ finalizer åï¼Œä½ æ‰èƒ½çœŸæ­£åˆ é™¤æˆ‘ã€‚kubectl patch pod &lt;pod-name&gt; \\ -p &#x27;&#123;&quot;metadata&quot;:&#123;&quot;finalizers&quot;:[]&#125;&#125;&#x27; --type=merge## 2.å¼ºåˆ¶åˆ é™¤kubectl delete pod &lt;pod-name&gt; --force --grace-period=0 --wait=false## å‚æ•°è¯´æ˜# --force: å¼ºåˆ¶åˆ é™¤ï¼Œæ¯”å¦‚é‡åˆ°äº† pod å¤„äº Terminating çŠ¶æ€ï¼Œæ­¤æ—¶æ— æ³•åˆ é™¤ï¼Œå¯ä»¥ä½¿ç”¨ --force å‚æ•°å¼ºåˆ¶åˆ é™¤# --grace-period=0: å¼ºåˆ¶åˆ é™¤çš„ç­‰å¾…æ—¶é—´ï¼Œé»˜è®¤æ˜¯ 30 ç§’ï¼Œè®¾ç½®ä¸º 0 è¡¨ç¤ºç«‹å³åˆ é™¤# --wait=false: åˆ é™¤å®Œæˆåæ˜¯å¦ç­‰å¾… Pod å®Œå…¨åˆ é™¤ï¼Œæ¯”è¾ƒé€‚åˆè„šæœ¬ä¸­ä½¿ç”¨ é•¿æ—¶é—´å¤„äº Terminating çŠ¶æ€çš„ Podï¼Œè¿™ç±» Pod å¤§æ¦‚ç‡æ˜¯ç”±äºæ‰€åœ¨èŠ‚ç‚¹å¼‚å¸¸ï¼ˆå¤±è”ã€è¢«é‡è£…ã€æˆ– kubelet åœæ­¢ï¼‰ï¼Œå¯¼è‡´ Kubernetes æ§åˆ¶é¢æ— æ³•ä¸è¯¥ Pod å¯¹åº”çš„ kubelet é€šä¿¡å®Œæˆåˆ é™¤æ“ä½œï¼Œä»è€Œå¡åœ¨ Terminating çŠ¶æ€ï¼Œå…¶å®å®ƒå·²ç»æ­»äº†ï¼Œä½† etcd é‡Œçš„è®°å½•ä¸€ç›´ä¿ç•™ç€ã€‚ 123456### æŸ¥çœ‹ Pod æ—¥å¿—```bashkubectl logs &lt;pod-name&gt;kubectl logs pod/&lt;pod-name&gt;kubectl logs pod/&lt;pod-name&gt; -n &lt;namespace-name&gt; è®¿é—® Pod æˆ‘ä»¬åˆšåˆšåˆ›å»ºäº†ä¸€ä¸ªnginxçš„podï¼Œè¯¥å¦‚ä½•è®¿é—®å‘¢ï¼Ÿ 1234567# è·å–podçš„ip$ k get pod -o wideNAME READY STATUS RESTARTS AGE IP NODE NOMINATED NODE READINESS GATESnginx 1/1 Running 0 12m 10.244.126.8 k8s-worker2 &lt;none&gt; &lt;none&gt;# åœ¨ä»»æ„èŠ‚ç‚¹ä¸Šè®¿é—®ï¼Œnginx é»˜è®¤ç«¯å£æ˜¯80$ curl 10.244.126.8 æš‚æ—¶æˆ‘ä»¬è¿˜ä¸èƒ½é€šè¿‡èŠ‚ç‚¹çš„ IP è®¿é—® Podï¼Œå› ä¸º Pod è¿è¡Œåœ¨å®¹å™¨ç½‘ç»œä¸­ï¼Œç­‰æˆ‘åé¢è®²è§£ deployment å’Œ service ä¹‹åï¼Œä¼šä»‹ç»å¦‚ä½•é€šè¿‡ service è®¿é—® ä¸€ä¸ª Pod è¿è¡Œå¤šä¸ªå®¹å™¨ yaml æ–‡ä»¶ 1234567891011apiVersion: v1kind: Podmetadata: name: multi-podspec: shareProcessNamespace: true # å…è®¸ç›¸åŒpodä¸­å¤šä¸ªå®¹å™¨å…±äº«è¿›ç¨‹ç©ºé—´ï¼Œå³åœ¨ä¸€ä¸ªå®¹å™¨é‡Œå¯ä»¥çœ‹åˆ°å¦ä¸€ä¸ªå®¹å™¨ä¸­çš„è¿›ç¨‹ï¼Œé»˜è®¤å€¼ä¸º false containers: - name: nginx image: nginx - name: tomcat image: tomcat è¿è¡Œ pod 1kubectl apply -f multi_pod.yaml æŸ¥çœ‹è¿è¡Œç»“æœ 1234# è¿™é‡Œçœ‹åˆ°ï¼ŒREADY é‡Œæœ‰ä¸¤ä¸ªï¼Œè¡¨ç¤ºä¸¤ä¸ªå®¹å™¨éƒ½è¿è¡ŒæˆåŠŸ$ kubectl get pods -owideNAME READY STATUS RESTARTS AGE IP NODE NOMINATED NODE READINESS GATESmulti-pod 2/2 Running 0 118s 10.244.194.81 k8s-worker1 &lt;none&gt; &lt;none&gt; è®¿é—®nginxå’Œtomcat 1234# è®¿é—®nginxï¼Œngxiné»˜è®¤ç«¯å£æ˜¯80curl http://10.244.194.81# è®¿é—®tomcatï¼Œtomcaté»˜è®¤ç«¯å£æ˜¯8080ï¼Œå› ä¸ºtomcatçš„webappæ˜¯ç©ºçš„ï¼Œæ‰€ä»¥çœ‹åˆ°404å°±è¯´æ˜æ­£å¸¸curl http://10.244.194.81:8080 è¿›å…¥å®¹å™¨æ‰§è¡Œå‘½ä»¤ 1234567# è¿›å…¥nginxå®¹å™¨ï¼Œ-c æŒ‡å®šå®¹å™¨åç§°kubectl exec -it multi-pod -c nginx -- /bin/bash## è¿›å…¥nginxå®¹å™¨åè®¿é—®tomcatå¯ä»¥æ­£å¸¸è®¿é—®ï¼Œè¯´æ˜åŒä¸€ä¸ªpodä¸­çš„å®¹å™¨å…±äº«ç½‘ç»œå’Œå­˜å‚¨curl http://localhost:8080# è¿›å…¥tomcatå®¹å™¨kubectl exec -it multi-pod -c tomcat -- /bin/bash","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» K8S çš„ Podï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚ K8Så®˜ç½‘ k8s Github k8s Pod ä»‹ç»","date_published":"2025-07-04T14:30:05.000Z","tags":["æŠ€æœ¯","k8s","K8S"]},{"id":"https://blog.hanqunfeng.com/2025/07/02/k8s-namespace/","url":"https://blog.hanqunfeng.com/2025/07/02/k8s-namespace/","title":"K8S ä¹‹ Namespace","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç» K8S çš„ Namespaceï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://kubernetes.io/zh-cn/\">K8Så®˜ç½‘</a></p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://github.com/kubernetes/kubernetes\">k8s Github</a></p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://kubernetes.io/zh-cn/docs/concepts/overview/working-with-objects/namespaces/\">k8s Namespace ä»‹ç»</a></p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"å‘½åç©ºé—´-Namespace-ä»‹ç»\">å‘½åç©ºé—´(Namespace) ä»‹ç»</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åœ¨ Kubernetes ä¸­ï¼Œå‘½åç©ºé—´æä¾›äº†ä¸€ç§åœ¨å•ä¸ªé›†ç¾¤ä¸­éš”ç¦»èµ„æºç»„çš„æœºåˆ¶ã€‚èµ„æºåç§°åœ¨å‘½åç©ºé—´å†…éœ€è¦å”¯ä¸€ï¼Œä½†ä¸éœ€è¦è·¨å‘½åç©ºé—´å”¯ä¸€ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>åŸºäºå‘½åç©ºé—´çš„ä½œç”¨åŸŸä»…é€‚ç”¨äºå‘½åç©ºé—´å¯¹è±¡ ï¼ˆä¾‹å¦‚ï¼ŒDeploymentsã€Services ç­‰ï¼‰ï¼Œè€Œä¸é€‚ç”¨äºé›†ç¾¤èŒƒå›´çš„å¯¹è±¡ï¼ˆä¾‹å¦‚ StorageClassã€Nodesã€PersistentVolumes ç­‰ï¼‰ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>Namespace(ç¼©å†™ä¸º ns) æ˜¯åœ¨å¤šä¸ªç”¨æˆ·ä¹‹é—´åˆ’åˆ†é›†ç¾¤èµ„æºçš„ä¸€ç§æ–¹æ³•ï¼Œé€‚ç”¨äºè·¨å¤šä¸ªå›¢é˜Ÿæˆ–é¡¹ç›®çš„åœºæ™¯ï¼ŒNamespace ä¸èƒ½ç›¸äº’åµŒå¥—ï¼Œæ¯ä¸ª Kubernetes èµ„æºåªèƒ½åœ¨ä¸€ä¸ª Namespace ä¸­ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>é¿å…ä½¿ç”¨å‰ç¼€ <code>kube-</code> åˆ›å»º Namespaceï¼Œå› ä¸ºå®ƒæ˜¯ä¸º Kubernetes ç³»ç»Ÿ Namespace ä¿ç•™çš„ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>Kubernetes å¯åŠ¨æ—¶ä¼šåˆ›å»ºå››ä¸ªåˆå§‹ Namespaceï¼š</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>åç§°ç©ºé—´åç§°</th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>default</code></td>\n<td>é»˜è®¤å‘½åç©ºé—´ï¼Œä¾›ç”¨æˆ·å¼€å§‹ä½¿ç”¨æ–°é›†ç¾¤æ—¶ç›´æ¥éƒ¨ç½²èµ„æºï¼Œæ— éœ€é¢å¤–åˆ›å»ºå‘½åç©ºé—´ã€‚</td>\n</tr>\n<tr>\n<td><code>kube-node-lease</code></td>\n<td>å­˜æ”¾ä¸å„ä¸ª Node å…³è”çš„ Leaseï¼ˆç§Ÿçº¦ï¼‰å¯¹è±¡ï¼Œç”¨äº Kubelet å‘é€å¿ƒè·³ï¼Œå¸®åŠ©æ§åˆ¶å¹³é¢æ£€æµ‹èŠ‚ç‚¹å¥åº·çŠ¶æ€ã€‚</td>\n</tr>\n<tr>\n<td><code>kube-public</code></td>\n<td>æ‰€æœ‰å®¢æˆ·ç«¯ï¼ˆåŒ…æ‹¬åŒ¿åç”¨æˆ·ï¼‰éƒ½å¯ä»¥è¯»å–ï¼Œä¸»è¦ç”¨äºé›†ç¾¤èŒƒå›´å†…éœ€è¦å…¬å¼€è®¿é—®çš„èµ„æºã€‚å…¬å…±å±æ€§æ˜¯ä¸€ç§ä½¿ç”¨çº¦å®šã€‚</td>\n</tr>\n<tr>\n<td><code>kube-system</code></td>\n<td>Kubernetes ç³»ç»Ÿç»„ä»¶ï¼ˆå¦‚ kube-dnsã€kube-proxy ç­‰ï¼‰è¿è¡Œæ‰€åœ¨çš„å‘½åç©ºé—´ã€‚ç”±ç³»ç»Ÿè‡ªåŠ¨ç®¡ç†ã€‚</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"æŸ¥çœ‹é›†ç¾¤ä¸­çš„å‘½åç©ºé—´\">æŸ¥çœ‹é›†ç¾¤ä¸­çš„å‘½åç©ºé—´</h2>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># namespace å¯ä»¥ç®€å†™ä¸º ns</span></span><br><span class=\"line\">kubectl get namespace</span><br><span class=\"line\">kubectl get ns</span><br></pre></td></tr></table></figure>\n<h2 id=\"åˆ›å»ºå‘½åç©ºé—´\">åˆ›å»ºå‘½åç©ºé—´</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å‘½ä»¤è¡Œæ–¹å¼</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl create namespace &lt;namespace-name&gt;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>yaml æ–¹å¼</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span>  <span class=\"comment\"># API ç‰ˆæœ¬ï¼Œå¯ä»¥é€šè¿‡ kubectl api-resources | grep Namespace è·å–</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Namespace</span> <span class=\"comment\"># èµ„æºç±»å‹</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span>       <span class=\"comment\"># å…ƒæ•°æ®</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">&lt;namespace-name&gt;</span> <span class=\"comment\"># å‘½åç©ºé—´åç§°</span></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl apply -f &lt;namespace.yaml&gt;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>é€šè¿‡å‘½ä»¤è¡Œç›´æ¥ç”Ÿæˆyamlæ–‡ä»¶</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># --dry-run=client: æœ¬åœ°æ¨¡æ‹Ÿè¿è¡Œå‘½ä»¤ï¼Œä¸ä¼šçœŸçš„æ‰§è¡Œï¼Œ-o yaml: è¾“å‡ºyamlæ ¼å¼</span></span><br><span class=\"line\">kubectl create namespace &lt;namespace-name&gt; --dry-run=client -o yaml &gt; &lt;namespace.yaml&gt;</span><br></pre></td></tr></table></figure>\n<h2 id=\"åˆ é™¤å‘½åç©ºé—´\">åˆ é™¤å‘½åç©ºé—´</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å‘½ä»¤è¡Œæ–¹å¼</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl delete namespace &lt;namespace-name&gt;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>yaml æ–¹å¼</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl delete -f &lt;namespace.yaml&gt;</span><br></pre></td></tr></table></figure>\n<h2 id=\"è®¾ç½®åå­—ç©ºé—´åå¥½\">è®¾ç½®åå­—ç©ºé—´åå¥½</h2>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># é»˜è®¤ä¸º defaultï¼Œå³æˆ‘ä»¬åœ¨æ‰§è¡Œ &#x27;kubbectl get pod&#x27; æ—¶ï¼Œé»˜è®¤ä¼šæŸ¥çœ‹ default è¿™ä¸ªåå­—ç©ºé—´ä¸‹çš„æ‰€æœ‰ Pod</span></span><br><span class=\"line\">kubectl config set-context --current --namespace=&lt;namespace-name&gt;</span><br></pre></td></tr></table></figure>\n<h2 id=\"æŸ¥çœ‹èµ„æºæ—¶æŒ‡å®šå‘½åç©ºé—´\">æŸ¥çœ‹èµ„æºæ—¶æŒ‡å®šå‘½åç©ºé—´</h2>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl get pod -n &lt;namespace-name&gt;</span><br><span class=\"line\">kubectl get service -n &lt;namespace-name&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹æ‰€æœ‰å‘½åç©ºé—´ä¸‹çš„èµ„æºï¼Œ-A, --all-namespaces</span></span><br><span class=\"line\">kubectl get pod -A</span><br><span class=\"line\">kubectl get service -A</span><br></pre></td></tr></table></figure>\n<h2 id=\"å¹¶éæ‰€æœ‰å¯¹è±¡éƒ½åœ¨åå­—ç©ºé—´ä¸­\">å¹¶éæ‰€æœ‰å¯¹è±¡éƒ½åœ¨åå­—ç©ºé—´ä¸­</h2>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ä½äºåå­—ç©ºé—´ä¸­çš„èµ„æº</span></span><br><span class=\"line\">kubectl api-resources --namespaced=<span class=\"literal\">true</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ä¸åœ¨åå­—ç©ºé—´ä¸­çš„èµ„æº</span></span><br><span class=\"line\">kubectl api-resources --namespaced=<span class=\"literal\">false</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><code>kubectl api-resources</code> è¿™ä¸ªå‘½ä»¤å¾ˆæœ‰ç”¨ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è¯¥å‘½ä»¤è·å–æ‰€æœ‰èµ„æºçš„ <code>ç®€å†™</code>ï¼Œä¹Ÿå¯ä»¥è·å–èµ„æºçš„ <code>apiVersion</code></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl api-resources</span><br><span class=\"line\">NAME: èµ„æºåç§°</span><br><span class=\"line\">SHORTNAMES: ç®€å†™</span><br><span class=\"line\">APIVERSION: apiVersion</span><br><span class=\"line\">NAMESPACED: æ˜¯å¦åœ¨åå­—ç©ºé—´ä¸­</span><br><span class=\"line\">KIND: èµ„æºç±»å‹</span><br></pre></td></tr></table></figure>\n<h2 id=\"Kubernetes-ä¸­å…³äº-å‘½åç©ºé—´ï¼ˆnamespaceï¼‰ä¸-DNS-çš„æœºåˆ¶\">Kubernetes ä¸­å…³äº å‘½åç©ºé—´ï¼ˆnamespaceï¼‰ä¸ DNS çš„æœºåˆ¶</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Kubernetes æœåŠ¡æœ‰è‡ªåŠ¨çš„ DNS åç§°ï¼Œå®ƒå’Œå‘½åç©ºé—´æœ‰å…³ã€‚é»˜è®¤æ˜¯èƒ½åœ¨æœ¬å‘½åç©ºé—´å†…ç›´æ¥è®¿é—®ï¼›è·¨å‘½åç©ºé—´è®¿é—®éœ€è¦å†™å®Œæ•´åŸŸåï¼ˆFQDNï¼‰ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å‘½åç©ºé—´åå­—ä¸èƒ½é‡å¤ï¼Œä¸”å‘½åç©ºé—´åå­—ä¸èƒ½ä¹±èµ·ï¼Œå°¤å…¶ä¸è¦ç”¨å…¬å…±äº’è”ç½‘åŸŸååè¯ï¼ˆå¦‚ comã€orgã€netã€cn ç­‰ï¼‰ã€‚</p>\n</li>\n</ul>\n<h3 id=\"ä¸¾ä¸ªä¾‹å­è¯´æ˜æœåŠ¡-DNS-æ˜¯æ€ä¹ˆå·¥ä½œçš„\">ä¸¾ä¸ªä¾‹å­è¯´æ˜æœåŠ¡ DNS æ˜¯æ€ä¹ˆå·¥ä½œçš„</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åœºæ™¯ï¼šä½ åœ¨ä¸¤ä¸ªå‘½åç©ºé—´ä¸­éƒ¨ç½²äº†ä¸¤ä¸ª nginx æœåŠ¡</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å‘½åç©ºé—´ dev ä¸­åˆ›å»ºæœåŠ¡ nginx</span></span><br><span class=\"line\">kubectl create ns dev</span><br><span class=\"line\">kubectl create deployment nginx --image=nginx --replicas=2 -n dev</span><br><span class=\"line\">kubectl expose deployment nginx --port=80 --<span class=\"built_in\">type</span>=NodePort -n dev</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å‘½åç©ºé—´ prod ä¸­ä¹Ÿåˆ›å»ºæœåŠ¡ nginx</span></span><br><span class=\"line\">kubectl create ns prod</span><br><span class=\"line\">kubectl create deployment nginx --image=nginx --replicas=2 -n prod</span><br><span class=\"line\">kubectl expose deployment nginx --port=80 --<span class=\"built_in\">type</span>=NodePort -n prod</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>1ï¸âƒ£ å¦‚æœä½ åœ¨ dev å‘½åç©ºé—´çš„ Pod é‡Œè®¿é—®å¦‚ä¸‹è¯·æ±‚ï¼Œå®ƒå®é™…è§£æçš„ DNS æ˜¯ <code>nginx.dev.svc.cluster.local</code>ï¼Œä¹Ÿå°±æ˜¯ <code>&lt;æœåŠ¡å&gt;.&lt;å‘½åç©ºé—´&gt;.svc.cluster.local</code></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl http://nginx</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>2ï¸âƒ£ å¦‚æœä½ æƒ³ä» dev å‘½åç©ºé—´è®¿é—® prod å‘½åç©ºé—´çš„ nginx æœåŠ¡ï¼Œä½ å¿…é¡»è¿™æ ·è®¿é—®</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl http://nginx.prod.svc.cluster.local</span><br></pre></td></tr></table></figure>\n<h2 id=\"å¿«é€Ÿç”Ÿæˆ-k8s-èµ„æºçš„yamlæ¨¡æ¿\">å¿«é€Ÿç”Ÿæˆ k8s èµ„æºçš„yamlæ¨¡æ¿</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å®‰è£… vscode æ’ä»¶ï¼šYAML(Red Hat)ï¼ŒKubernetes Templates(lunuan)</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä½¿ç”¨æ—¶æ‰“å¼€ä¸€ä¸ªyamlæ–‡ä»¶ï¼Œæˆ–è€…å°†æ–‡ä»¶æ ¼å¼åˆ‡æ¢ä¸ºyamlï¼Œç„¶åè¾“å…¥å…³é”®å­— podã€deployã€service ç­‰ç­‰ k8s èµ„æºåç§°ï¼Œå°±ä¼šå¼¹å‡ºæ¨¡æ¿é€‰æ‹©ï¼Œé€‰æ‹©åå›è½¦å°±ä¼šç”Ÿæˆæ¨¡æ¿</p>\n</li>\n</ul>\n","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» K8S çš„ Namespaceï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚ K8Så®˜ç½‘ k8s Github k8s Namespace ä»‹ç» å‘½åç©ºé—´(Namespace) ä»‹ç» åœ¨ Kubernetes ä¸­ï¼Œå‘½åç©ºé—´æä¾›äº†ä¸€ç§åœ¨å•ä¸ªé›†ç¾¤ä¸­éš”ç¦»èµ„æºç»„çš„æœºåˆ¶ã€‚èµ„æºåç§°åœ¨å‘½åç©ºé—´å†…éœ€è¦å”¯ä¸€ï¼Œä½†ä¸éœ€è¦è·¨å‘½åç©ºé—´å”¯ä¸€ã€‚ åŸºäºå‘½åç©ºé—´çš„ä½œç”¨åŸŸä»…é€‚ç”¨äºå‘½åç©ºé—´å¯¹è±¡ ï¼ˆä¾‹å¦‚ï¼ŒDeploymentsã€Services ç­‰ï¼‰ï¼Œè€Œä¸é€‚ç”¨äºé›†ç¾¤èŒƒå›´çš„å¯¹è±¡ï¼ˆä¾‹å¦‚ StorageClassã€Nodesã€PersistentVolumes ç­‰ï¼‰ã€‚ Namespace(ç¼©å†™ä¸º ns) æ˜¯åœ¨å¤šä¸ªç”¨æˆ·ä¹‹é—´åˆ’åˆ†é›†ç¾¤èµ„æºçš„ä¸€ç§æ–¹æ³•ï¼Œé€‚ç”¨äºè·¨å¤šä¸ªå›¢é˜Ÿæˆ–é¡¹ç›®çš„åœºæ™¯ï¼ŒNamespace ä¸èƒ½ç›¸äº’åµŒå¥—ï¼Œæ¯ä¸ª Kubernetes èµ„æºåªèƒ½åœ¨ä¸€ä¸ª Namespace ä¸­ã€‚ é¿å…ä½¿ç”¨å‰ç¼€ kube- åˆ›å»º Namespaceï¼Œå› ä¸ºå®ƒæ˜¯ä¸º Kubernetes ç³»ç»Ÿ Namespace ä¿ç•™çš„ã€‚ Kubernetes å¯åŠ¨æ—¶ä¼šåˆ›å»ºå››ä¸ªåˆå§‹ Namespaceï¼š åç§°ç©ºé—´åç§° è¯´æ˜ default é»˜è®¤å‘½åç©ºé—´ï¼Œä¾›ç”¨æˆ·å¼€å§‹ä½¿ç”¨æ–°é›†ç¾¤æ—¶ç›´æ¥éƒ¨ç½²èµ„æºï¼Œæ— éœ€é¢å¤–åˆ›å»ºå‘½åç©ºé—´ã€‚ kube-node-lease å­˜æ”¾ä¸å„ä¸ª Node å…³è”çš„ Leaseï¼ˆç§Ÿçº¦ï¼‰å¯¹è±¡ï¼Œç”¨äº Kubelet å‘é€å¿ƒè·³ï¼Œå¸®åŠ©æ§åˆ¶å¹³é¢æ£€æµ‹èŠ‚ç‚¹å¥åº·çŠ¶æ€ã€‚ kube-public æ‰€æœ‰å®¢æˆ·ç«¯ï¼ˆåŒ…æ‹¬åŒ¿åç”¨æˆ·ï¼‰éƒ½å¯ä»¥è¯»å–ï¼Œä¸»è¦ç”¨äºé›†ç¾¤èŒƒå›´å†…éœ€è¦å…¬å¼€è®¿é—®çš„èµ„æºã€‚å…¬å…±å±æ€§æ˜¯ä¸€ç§ä½¿ç”¨çº¦å®šã€‚ kube-system Kubernetes ç³»ç»Ÿç»„ä»¶ï¼ˆå¦‚ kube-dnsã€kube-proxy ç­‰ï¼‰è¿è¡Œæ‰€åœ¨çš„å‘½åç©ºé—´ã€‚ç”±ç³»ç»Ÿè‡ªåŠ¨ç®¡ç†ã€‚ æŸ¥çœ‹é›†ç¾¤ä¸­çš„å‘½åç©ºé—´ 123# namespace å¯ä»¥ç®€å†™ä¸º nskubectl get namespacekubectl get ns åˆ›å»ºå‘½åç©ºé—´ å‘½ä»¤è¡Œæ–¹å¼ 1kubectl create namespace &lt;namespace-name&gt; yaml æ–¹å¼ 1234apiVersion: v1 # API ç‰ˆæœ¬ï¼Œå¯ä»¥é€šè¿‡ kubectl api-resources | grep Namespace è·å–kind: Namespace # èµ„æºç±»å‹metadata: # å…ƒæ•°æ® name: &lt;namespace-name&gt; # å‘½åç©ºé—´åç§° 1kubectl apply -f &lt;namespace.yaml&gt; é€šè¿‡å‘½ä»¤è¡Œç›´æ¥ç”Ÿæˆyamlæ–‡ä»¶ 12# --dry-run=client: æœ¬åœ°æ¨¡æ‹Ÿè¿è¡Œå‘½ä»¤ï¼Œä¸ä¼šçœŸçš„æ‰§è¡Œï¼Œ-o yaml: è¾“å‡ºyamlæ ¼å¼kubectl create namespace &lt;namespace-name&gt; --dry-run=client -o yaml &gt; &lt;namespace.yaml&gt; åˆ é™¤å‘½åç©ºé—´ å‘½ä»¤è¡Œæ–¹å¼ 1kubectl delete namespace &lt;namespace-name&gt; yaml æ–¹å¼ 1kubectl delete -f &lt;namespace.yaml&gt; è®¾ç½®åå­—ç©ºé—´åå¥½ 12# é»˜è®¤ä¸º defaultï¼Œå³æˆ‘ä»¬åœ¨æ‰§è¡Œ &#x27;kubbectl get pod&#x27; æ—¶ï¼Œé»˜è®¤ä¼šæŸ¥çœ‹ default è¿™ä¸ªåå­—ç©ºé—´ä¸‹çš„æ‰€æœ‰ Podkubectl config set-context --current --namespace=&lt;namespace-name&gt; æŸ¥çœ‹èµ„æºæ—¶æŒ‡å®šå‘½åç©ºé—´ 123456kubectl get pod -n &lt;namespace-name&gt;kubectl get service -n &lt;namespace-name&gt;# æŸ¥çœ‹æ‰€æœ‰å‘½åç©ºé—´ä¸‹çš„èµ„æºï¼Œ-A, --all-namespaceskubectl get pod -Akubectl get service -A å¹¶éæ‰€æœ‰å¯¹è±¡éƒ½åœ¨åå­—ç©ºé—´ä¸­ 12345# ä½äºåå­—ç©ºé—´ä¸­çš„èµ„æºkubectl api-resources --namespaced=true# ä¸åœ¨åå­—ç©ºé—´ä¸­çš„èµ„æºkubectl api-resources --namespaced=false kubectl api-resources è¿™ä¸ªå‘½ä»¤å¾ˆæœ‰ç”¨ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è¯¥å‘½ä»¤è·å–æ‰€æœ‰èµ„æºçš„ ç®€å†™ï¼Œä¹Ÿå¯ä»¥è·å–èµ„æºçš„ apiVersion 123456kubectl api-resourcesNAME: èµ„æºåç§°SHORTNAMES: ç®€å†™APIVERSION: apiVersionNAMESPACED: æ˜¯å¦åœ¨åå­—ç©ºé—´ä¸­KIND: èµ„æºç±»å‹ Kubernetes ä¸­å…³äº å‘½åç©ºé—´ï¼ˆnamespaceï¼‰ä¸ DNS çš„æœºåˆ¶ Kubernetes æœåŠ¡æœ‰è‡ªåŠ¨çš„ DNS åç§°ï¼Œå®ƒå’Œå‘½åç©ºé—´æœ‰å…³ã€‚é»˜è®¤æ˜¯èƒ½åœ¨æœ¬å‘½åç©ºé—´å†…ç›´æ¥è®¿é—®ï¼›è·¨å‘½åç©ºé—´è®¿é—®éœ€è¦å†™å®Œæ•´åŸŸåï¼ˆFQDNï¼‰ã€‚ å‘½åç©ºé—´åå­—ä¸èƒ½é‡å¤ï¼Œä¸”å‘½åç©ºé—´åå­—ä¸èƒ½ä¹±èµ·ï¼Œå°¤å…¶ä¸è¦ç”¨å…¬å…±äº’è”ç½‘åŸŸååè¯ï¼ˆå¦‚ comã€orgã€netã€cn ç­‰ï¼‰ã€‚ ä¸¾ä¸ªä¾‹å­è¯´æ˜æœåŠ¡ DNS æ˜¯æ€ä¹ˆå·¥ä½œçš„ åœºæ™¯ï¼šä½ åœ¨ä¸¤ä¸ªå‘½åç©ºé—´ä¸­éƒ¨ç½²äº†ä¸¤ä¸ª nginx æœåŠ¡ 123456789# å‘½åç©ºé—´ dev ä¸­åˆ›å»ºæœåŠ¡ nginxkubectl create ns devkubectl create deployment nginx --image=nginx --replicas=2 -n devkubectl expose deployment nginx --port=80 --type=NodePort -n dev# å‘½åç©ºé—´ prod ä¸­ä¹Ÿåˆ›å»ºæœåŠ¡ nginxkubectl create ns prodkubectl create deployment nginx --image=nginx --replicas=2 -n prodkubectl expose deployment nginx --port=80 --type=NodePort -n prod 1ï¸âƒ£ å¦‚æœä½ åœ¨ dev å‘½åç©ºé—´çš„ Pod é‡Œè®¿é—®å¦‚ä¸‹è¯·æ±‚ï¼Œå®ƒå®é™…è§£æçš„ DNS æ˜¯ nginx.dev.svc.cluster.localï¼Œä¹Ÿå°±æ˜¯ &lt;æœåŠ¡å&gt;.&lt;å‘½åç©ºé—´&gt;.svc.cluster.local 1curl http://nginx 2ï¸âƒ£ å¦‚æœä½ æƒ³ä» dev å‘½åç©ºé—´è®¿é—® prod å‘½åç©ºé—´çš„ nginx æœåŠ¡ï¼Œä½ å¿…é¡»è¿™æ ·è®¿é—® 1curl http://nginx.prod.svc.cluster.local å¿«é€Ÿç”Ÿæˆ k8s èµ„æºçš„yamlæ¨¡æ¿ å®‰è£… vscode æ’ä»¶ï¼šYAML(Red Hat)ï¼ŒKubernetes Templates(lunuan) ä½¿ç”¨æ—¶æ‰“å¼€ä¸€ä¸ªyamlæ–‡ä»¶ï¼Œæˆ–è€…å°†æ–‡ä»¶æ ¼å¼åˆ‡æ¢ä¸ºyamlï¼Œç„¶åè¾“å…¥å…³é”®å­— podã€deployã€service ç­‰ç­‰ k8s èµ„æºåç§°ï¼Œå°±ä¼šå¼¹å‡ºæ¨¡æ¿é€‰æ‹©ï¼Œé€‰æ‹©åå›è½¦å°±ä¼šç”Ÿæˆæ¨¡æ¿","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» K8S çš„ Namespaceï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚ K8Så®˜ç½‘ k8s Github k8s Namespace ä»‹ç»","date_published":"2025-07-02T13:30:05.000Z","tags":["æŠ€æœ¯","k8s","K8S"]},{"id":"https://blog.hanqunfeng.com/2025/07/01/k8s-install-sealos/","url":"https://blog.hanqunfeng.com/2025/07/01/k8s-install-sealos/","title":"Linux å®‰è£… K8S ä¹‹ sealos","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç» Linux ä¸‹ ä½¿ç”¨ sealos å®‰è£… K8S çš„æ–¹æ³•ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://kubernetes.io/zh-cn/\">K8Så®˜ç½‘</a></p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://github.com/kubernetes/kubernetes\">k8s Github</a></p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://sealos.run/docs/k8s/quick-start/deploy-kubernetes\">sealoså®˜ç½‘</a></p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://github.com/labring/sealos\">sealos Github</a></p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"å®‰è£…å‰è®¾ç½®-æ‰€æœ‰èŠ‚ç‚¹\">å®‰è£…å‰è®¾ç½®(æ‰€æœ‰èŠ‚ç‚¹)</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å‡†å¤‡ä¸‰å°å¯ä»¥è¿æ¥å¤–ç½‘çš„ä¸»æœºï¼Œä¸è¦å®‰è£…docker,k8sç­‰ï¼Œå¦‚å·²å®‰è£…éœ€å…ˆå¸è½½</p>\n</li>\n<li class=\"lvl-2\">\n<p>(æ¨è)å‡çº§ç³»ç»Ÿå†…æ ¸ï¼Œæœ¬æ–‡ä¸­éå¿…é¡»ï¼Œå‡çº§å†…æ ¸æ–¹æ³•å‚çœ‹ <a href=\"/2025/06/29/k8s-install-kubeadm/\" title=\"Linux å®‰è£… K8S ä¹‹ kubeadm\">Linux å®‰è£… K8S ä¹‹ kubeadm</a></p>\n</li>\n</ul>\n<h3 id=\"æ¯ä¸ªé›†ç¾¤èŠ‚ç‚¹åº”è¯¥æœ‰ä¸åŒçš„ä¸»æœºåï¼Œä¸»æœºåä¸è¦å¸¦ä¸‹åˆ’çº¿\">æ¯ä¸ªé›†ç¾¤èŠ‚ç‚¹åº”è¯¥æœ‰ä¸åŒçš„ä¸»æœºåï¼Œä¸»æœºåä¸è¦å¸¦ä¸‹åˆ’çº¿</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æ·»åŠ ä¸»æœºåæ˜ å°„: vi /etc/hosts</span></span><br><span class=\"line\">10.211.55.12 k8s-m1</span><br><span class=\"line\">10.211.55.13 k8s-w1</span><br><span class=\"line\">10.211.55.14 k8s-w2</span><br></pre></td></tr></table></figure>\n<h3 id=\"ä¿®æ­£ç³»ç»Ÿçš„æ—¶é—´\">ä¿®æ­£ç³»ç»Ÿçš„æ—¶é—´</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å®‰è£…chrony</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> dnf install chrony -y</span><br><span class=\"line\"><span class=\"comment\"># å¯åŠ¨æœåŠ¡</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> systemctl <span class=\"built_in\">enable</span> --now chronyd</span><br><span class=\"line\"><span class=\"comment\"># ä¿®æ­£æ—¶é—´</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> chronyc makestep</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹æ—¶é—´</span></span><br><span class=\"line\"><span class=\"built_in\">date</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"å®‰è£…-sealos\">å®‰è£… sealos</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ä¸‹è½½</span></span><br><span class=\"line\">wget https://github.com/labring/sealos/releases/download/v5.0.1/sealos_5.0.1_linux_amd64.rpm</span><br><span class=\"line\"><span class=\"comment\"># å®‰è£…</span></span><br><span class=\"line\">yum install -y sealos_5.0.1_linux_amd64.rpm</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å®‰è£… sealos çš„è‡ªåŠ¨è¡¥å…¨</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&#x27;source &lt;(sealos completion bash)&#x27;</span> &gt;&gt; ~/.bashrc</span><br><span class=\"line\"><span class=\"built_in\">source</span> ~/.bashrc</span><br></pre></td></tr></table></figure>\n<h2 id=\"åˆ›å»ºk8sé›†ç¾¤-master\">åˆ›å»ºk8sé›†ç¾¤(master)</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ›å»ºé›†ç¾¤: ä½¿ç”¨sealosåˆ›å»ºé›†ç¾¤åªéœ€è¦ä¸€è¡Œå‘½ä»¤ï¼Œç›®å‰å®˜ç½‘ç¤ºä¾‹ä¸­çš„k8sç‰ˆæœ¬ä¸ºv1.29.9(å°ç‰ˆæœ¬å·è¶Šé«˜è¶Šç¨³å®š)</p>\n</li>\n<li class=\"lvl-2\">\n<p>å¯ä»¥åœ¨<a href=\"https://hub.docker.com\">docker hub</a>ä¸ŠæŸ¥è¯¢ï¼Œæˆ–è€…ä½¿ç”¨ <a href=\"https://explore.ggcr.dev/\">Registry Explorer</a> æŸ¥çœ‹å¦‚ä¸‹é•œåƒçš„æ‰€æœ‰ç‰ˆæœ¬ï¼Œä¸å»ºè®®ä½¿ç”¨å¤ªé«˜çš„ç‰ˆæœ¬ï¼Œæœ‰å¯èƒ½å®‰è£…å¤±è´¥ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>æ³¨æ„ sealos ä¸ kubernetes çš„ç‰ˆæœ¬æœ‰å¯¹åº”å…³ç³»ï¼Œç›®å‰ <code>Sealos &gt;=v5.0.0</code> å¯¹åº”çš„ <code>K8s &gt;=1.28</code>ï¼Œå…·ä½“å¯ä»¥ä»<a href=\"https://sealos.run/docs/k8s/quick-start/deploy-kubernetes\">sealoså®˜ç½‘</a>æŸ¥è¯¢</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å›½å†…å¯ä»¥åœ¨é•œåƒå‰é¢åŠ ä¸Š registry.cn-shanghai.aliyuncs.com/</span></span><br><span class=\"line\"><span class=\"comment\"># sealos æ¨èçš„ç½‘ç»œæ¥å£æ˜¯ cilium</span></span><br><span class=\"line\">$ sealos run labring/kubernetes:v1.29.9 labring/helm:v3.9.4 labring/cilium:v1.13.4 \\</span><br><span class=\"line\">     --masters 10.211.55.12 \\</span><br><span class=\"line\">     --nodes 10.211.55.13,10.211.55.14 -p [your-ssh-passwd]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">## å‚æ•°è¯´æ˜</span></span><br><span class=\"line\"><span class=\"comment\"># -masters: æŒ‡å®š master èŠ‚ç‚¹çš„ IP åœ°å€ï¼Œå¤šä¸ªèŠ‚ç‚¹ä¹‹é—´ç”¨é€—å·éš”å¼€ï¼Œä½†å¿…é¡»æ˜¯å¥‡æ•°</span></span><br><span class=\"line\"><span class=\"comment\"># -nodes: æŒ‡å®š worker èŠ‚ç‚¹çš„ IP åœ°å€ï¼Œå¤šä¸ªèŠ‚ç‚¹ä¹‹é—´ç”¨é€—å·éš”å¼€ã€‚</span></span><br><span class=\"line\"><span class=\"comment\"># -p, --passwd: æŒ‡å®š SSH ç™»å½•å¯†ç </span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">## å®‰è£…æˆåŠŸä¼šæ˜¾ç¤ºå¦‚ä¸‹å†…å®¹</span></span><br><span class=\"line\">â„¹ï¸  Using Cilium version 1.13.4</span><br><span class=\"line\">ğŸ”® Auto-detected cluster name: kubernetes</span><br><span class=\"line\">ğŸ”® Auto-detected datapath mode: tunnel</span><br><span class=\"line\">ğŸ”® Auto-detected kube-proxy has been installed</span><br><span class=\"line\">2025-07-01T16:59:27 info succeeded <span class=\"keyword\">in</span> creating a new cluster, enjoy it!</span><br><span class=\"line\">2025-07-01T16:59:27 info</span><br><span class=\"line\">      ___           ___           ___           ___       ___           ___</span><br><span class=\"line\">     /\\  \\         /\\  \\         /\\  \\         /\\__\\     /\\  \\         /\\  \\</span><br><span class=\"line\">    /::\\  \\       /::\\  \\       /::\\  \\       /:/  /    /::\\  \\       /::\\  \\</span><br><span class=\"line\">   /:/\\ \\  \\     /:/\\:\\  \\     /:/\\:\\  \\     /:/  /    /:/\\:\\  \\     /:/\\ \\  \\</span><br><span class=\"line\">  _\\:\\~\\ \\  \\   /::\\~\\:\\  \\   /::\\~\\:\\  \\   /:/  /    /:/  \\:\\  \\   _\\:\\~\\ \\  \\</span><br><span class=\"line\"> /\\ \\:\\ \\ \\__\\ /:/\\:\\ \\:\\__\\ /:/\\:\\ \\:\\__\\ /:/__/    /:/__/ \\:\\__\\ /\\ \\:\\ \\ \\__\\</span><br><span class=\"line\"> \\:\\ \\:\\ \\/__/ \\:\\~\\:\\ \\/__/ \\/__\\:\\/:/  / \\:\\  \\    \\:\\  \\ /:/  / \\:\\ \\:\\ \\/__/</span><br><span class=\"line\">  \\:\\ \\:\\__\\    \\:\\ \\:\\__\\        \\::/  /   \\:\\  \\    \\:\\  /:/  /   \\:\\ \\:\\__\\</span><br><span class=\"line\">   \\:\\/:/  /     \\:\\ \\/__/        /:/  /     \\:\\  \\    \\:\\/:/  /     \\:\\/:/  /</span><br><span class=\"line\">    \\::/  /       \\:\\__\\         /:/  /       \\:\\__\\    \\::/  /       \\::/  /</span><br><span class=\"line\">     \\/__/         \\/__/         \\/__/         \\/__/     \\/__/         \\/__/</span><br><span class=\"line\"></span><br><span class=\"line\">                  Website: https://www.sealos.io/</span><br><span class=\"line\">                  Address: github.com/labring/sealos</span><br><span class=\"line\">                  Version: 5.0.1-2b74a1281</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¯ç”¨ shell è‡ªåŠ¨è¡¥å…¨åŠŸèƒ½</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 1.å®‰è£… bash-completion</span></span><br><span class=\"line\"><span class=\"comment\"># 1.1 æ£€æŸ¥bash-completionæ˜¯å¦å·²å®‰è£…ï¼Œæœ‰è¾“å‡ºè¯´æ˜å·²ç»å®‰è£…</span></span><br><span class=\"line\">$ <span class=\"built_in\">type</span> _init_completion</span><br><span class=\"line\"><span class=\"comment\"># 1.2 å®‰è£…bash-completionï¼Œå®‰è£…åä¼šåˆ›å»ºæ–‡ä»¶ /usr/share/bash-completion/bash_completion</span></span><br><span class=\"line\">$ dnf install bash-completion</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 2.å®‰è£… kubectl çš„è‡ªåŠ¨è¡¥å…¨åŠŸèƒ½</span></span><br><span class=\"line\"><span class=\"comment\"># 2.1 å½“å‰ç”¨æˆ·</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&#x27;source &lt;(kubectl completion bash)&#x27;</span> &gt;&gt; ~/.bashrc</span><br><span class=\"line\"><span class=\"comment\"># 2.2 æ‰€æœ‰ç”¨æˆ·</span></span><br><span class=\"line\">kubectl completion bash | <span class=\"built_in\">sudo</span> <span class=\"built_in\">tee</span> /etc/bash_completion.d/kubectl &gt; /dev/null</span><br><span class=\"line\"><span class=\"built_in\">sudo</span> <span class=\"built_in\">chmod</span> a+r /etc/bash_completion.d/kubectl</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 3 å¦‚æœ kubectl æœ‰å…³è”çš„åˆ«åï¼Œä½ å¯ä»¥æ‰©å±• Shell è¡¥å…¨æ¥é€‚é…æ­¤åˆ«å</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&#x27;alias k=kubectl&#x27;</span> &gt;&gt;~/.bashrc</span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&#x27;complete -o default -F __start_kubectl k&#x27;</span> &gt;&gt;~/.bashrc</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 4.åˆ·æ–°é…ç½®æ–‡ä»¶</span></span><br><span class=\"line\"><span class=\"built_in\">source</span> ~/.bashrc</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ›å»ºé›†ç¾¤æˆåŠŸåï¼ŒæŸ¥çœ‹é›†ç¾¤çŠ¶æ€</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹ç‰ˆæœ¬</span></span><br><span class=\"line\">$ kubectl version</span><br><span class=\"line\">Client Version: v1.29.9</span><br><span class=\"line\">Kustomize Version: v5.0.4-0.20230601165947-6ce0bf390ce3</span><br><span class=\"line\">Server Version: v1.29.9</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹èŠ‚ç‚¹</span></span><br><span class=\"line\">$ kubectl get nodes -owide</span><br><span class=\"line\">NAME     STATUS   ROLES           AGE     VERSION   INTERNAL-IP    EXTERNAL-IP   OS-IMAGE                            KERNEL-VERSION             CONTAINER-RUNTIME</span><br><span class=\"line\">k8s-m1   Ready    control-plane   3m11s   v1.29.9   10.211.55.12   &lt;none&gt;        Rocky Linux 8.10 (Green Obsidian)   4.18.0-553.el8_10.x86_64   containerd://1.7.27</span><br><span class=\"line\">k8s-w1   Ready    &lt;none&gt;          2m52s   v1.29.9   10.211.55.13   &lt;none&gt;        Rocky Linux 8.10 (Green Obsidian)   4.18.0-553.el8_10.x86_64   containerd://1.7.27</span><br><span class=\"line\">k8s-w2   Ready    &lt;none&gt;          2m55s   v1.29.9   10.211.55.14   &lt;none&gt;        Rocky Linux 8.10 (Green Obsidian)   4.18.0-553.el8_10.x86_64   containerd://1.7.27</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹èµ„æº</span></span><br><span class=\"line\">$ kubectl get all -A -owide</span><br><span class=\"line\">NAMESPACE     NAME                                   READY   STATUS    RESTARTS   AGE     IP             NODE     NOMINATED NODE   READINESS GATES</span><br><span class=\"line\">kube-system   pod/cilium-bbbdl                       1/1     Running   0          3m47s   10.211.55.13   k8s-w1   &lt;none&gt;           &lt;none&gt;</span><br><span class=\"line\">kube-system   pod/cilium-cz47k                       1/1     Running   0          3m47s   10.211.55.14   k8s-w2   &lt;none&gt;           &lt;none&gt;</span><br><span class=\"line\">kube-system   pod/cilium-operator-6946ccbcc5-cxnn4   1/1     Running   0          3m47s   10.211.55.13   k8s-w1   &lt;none&gt;           &lt;none&gt;</span><br><span class=\"line\">kube-system   pod/cilium-vfc22                       1/1     Running   0          3m47s   10.211.55.12   k8s-m1   &lt;none&gt;           &lt;none&gt;</span><br><span class=\"line\">kube-system   pod/coredns-76f75df574-2ln5x           1/1     Running   0          3m54s   10.0.0.74      k8s-w1   &lt;none&gt;           &lt;none&gt;</span><br><span class=\"line\">kube-system   pod/coredns-76f75df574-plsds           1/1     Running   0          3m54s   10.0.0.146     k8s-w1   &lt;none&gt;           &lt;none&gt;</span><br><span class=\"line\">kube-system   pod/etcd-k8s-m1                        1/1     Running   0          4m6s    10.211.55.12   k8s-m1   &lt;none&gt;           &lt;none&gt;</span><br><span class=\"line\">kube-system   pod/kube-apiserver-k8s-m1              1/1     Running   0          4m6s    10.211.55.12   k8s-m1   &lt;none&gt;           &lt;none&gt;</span><br><span class=\"line\">kube-system   pod/kube-controller-manager-k8s-m1     1/1     Running   0          4m6s    10.211.55.12   k8s-m1   &lt;none&gt;           &lt;none&gt;</span><br><span class=\"line\">kube-system   pod/kube-proxy-4xbzt                   1/1     Running   0          3m51s   10.211.55.13   k8s-w1   &lt;none&gt;           &lt;none&gt;</span><br><span class=\"line\">kube-system   pod/kube-proxy-rjs8h                   1/1     Running   0          3m54s   10.211.55.14   k8s-w2   &lt;none&gt;           &lt;none&gt;</span><br><span class=\"line\">kube-system   pod/kube-proxy-xv4fg                   1/1     Running   0          3m55s   10.211.55.12   k8s-m1   &lt;none&gt;           &lt;none&gt;</span><br><span class=\"line\">kube-system   pod/kube-scheduler-k8s-m1              1/1     Running   0          4m6s    10.211.55.12   k8s-m1   &lt;none&gt;           &lt;none&gt;</span><br><span class=\"line\">kube-system   pod/kube-sealos-lvscare-k8s-w1         1/1     Running   0          3m31s   10.211.55.13   k8s-w1   &lt;none&gt;           &lt;none&gt;</span><br><span class=\"line\">kube-system   pod/kube-sealos-lvscare-k8s-w2         1/1     Running   0          3m34s   10.211.55.14   k8s-w2   &lt;none&gt;           &lt;none&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">NAMESPACE     NAME                  TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)                  AGE     SELECTOR</span><br><span class=\"line\">default       service/kubernetes    ClusterIP   10.96.0.1    &lt;none&gt;        443/TCP                  4m8s    &lt;none&gt;</span><br><span class=\"line\">kube-system   service/hubble-peer   ClusterIP   10.96.1.9    &lt;none&gt;        443/TCP                  3m47s   k8s-app=cilium</span><br><span class=\"line\">kube-system   service/kube-dns      ClusterIP   10.96.0.10   &lt;none&gt;        53/UDP,53/TCP,9153/TCP   4m7s    k8s-app=kube-dns</span><br><span class=\"line\"></span><br><span class=\"line\">NAMESPACE     NAME                        DESIRED   CURRENT   READY   UP-TO-DATE   AVAILABLE   NODE SELECTOR            AGE     CONTAINERS     IMAGES                               SELECTOR</span><br><span class=\"line\">kube-system   daemonset.apps/cilium       3         3         3       3            3           kubernetes.io/os=linux   3m47s   cilium-agent   quay.io/cilium/cilium:v1.13.4        k8s-app=cilium</span><br><span class=\"line\">kube-system   daemonset.apps/kube-proxy   3         3         3       3            3           kubernetes.io/os=linux   4m7s    kube-proxy     registry.k8s.io/kube-proxy:v1.29.9   k8s-app=kube-proxy</span><br><span class=\"line\"></span><br><span class=\"line\">NAMESPACE     NAME                              READY   UP-TO-DATE   AVAILABLE   AGE     CONTAINERS        IMAGES                                    SELECTOR</span><br><span class=\"line\">kube-system   deployment.apps/cilium-operator   1/1     1            1           3m47s   cilium-operator   quay.io/cilium/operator:v1.13.4           io.cilium/app=operator,name=cilium-operator</span><br><span class=\"line\">kube-system   deployment.apps/coredns           2/2     2            2           4m7s    coredns           registry.k8s.io/coredns/coredns:v1.11.1   k8s-app=kube-dns</span><br><span class=\"line\"></span><br><span class=\"line\">NAMESPACE     NAME                                         DESIRED   CURRENT   READY   AGE     CONTAINERS        IMAGES                                    SELECTOR</span><br><span class=\"line\">kube-system   replicaset.apps/cilium-operator-6946ccbcc5   1         1         1       3m47s   cilium-operator   quay.io/cilium/operator:v1.13.4           io.cilium/app=operator,name=cilium-operator,pod-template-hash=6946ccbcc5</span><br><span class=\"line\">kube-system   replicaset.apps/coredns-76f75df574           2         2         2       3m54s   coredns           registry.k8s.io/coredns/coredns:v1.11.1   k8s-app=kube-dns,pod-template-hash=76f75df574</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h2 id=\"æµ‹è¯•ï¼šç”¨K8Séƒ¨ç½²Nginx\">æµ‹è¯•ï¼šç”¨K8Séƒ¨ç½²Nginx</h2>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åˆ›å»ºdeployment</span></span><br><span class=\"line\">kubectl create deployment nginx --image=nginx</span><br><span class=\"line\"><span class=\"comment\"># åˆ›å»ºserviceï¼Œ--typeæŒ‡å®šä¸ºNodePortï¼Œå…¶å«ä¹‰ä¸ºå°†deploymentçš„80ç«¯å£æ˜ å°„åˆ°Nodeçš„éšæœºç«¯å£</span></span><br><span class=\"line\">kubectl expose deployment nginx --<span class=\"built_in\">type</span>=NodePort --port=80</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹podå’Œserviceï¼Œä¸åŠ  -n å‚æ•°ï¼Œé»˜è®¤æŸ¥çœ‹çš„æ˜¯defaultå‘½åç©ºé—´</span></span><br><span class=\"line\">$ k get pods,svc -owide</span><br><span class=\"line\">NAME                         READY   STATUS    RESTARTS   AGE   IP           NODE     NOMINATED NODE   READINESS GATES</span><br><span class=\"line\">pod/nginx-7854ff8877-wgfxc   1/1     Running   0          19s   10.0.1.204   k8s-w2   &lt;none&gt;           &lt;none&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">NAME                 TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)        AGE   SELECTOR</span><br><span class=\"line\">service/kubernetes   ClusterIP   10.96.0.1    &lt;none&gt;        443/TCP        44m   &lt;none&gt;</span><br><span class=\"line\">service/nginx        NodePort    10.96.2.54   &lt;none&gt;        80:31044/TCP   5s    app=nginx</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æµè§ˆå™¨è®¿é—®ä»»æ„nodeIP:31044</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åˆ é™¤æµ‹è¯•èµ„æº</span></span><br><span class=\"line\"><span class=\"comment\">## åˆ é™¤deployment</span></span><br><span class=\"line\">kubectl delete deployment nginx</span><br><span class=\"line\"><span class=\"comment\">## åˆ é™¤service</span></span><br><span class=\"line\">kubectl delete service nginx</span><br></pre></td></tr></table></figure>\n<h2 id=\"sealos-å‘½ä»¤\">sealos å‘½ä»¤</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>sealos å‘½ä»¤æ¦‚è§ˆ</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Cluster Management Commands:</span><br><span class=\"line\">  apply         ä½¿ç”¨ Clusterfile åœ¨ Kubernetes é›†ç¾¤ä¸­è¿è¡Œäº‘é•œåƒ</span><br><span class=\"line\">  cert          æ›´æ–° Kubernetes API Server çš„è¯ä¹¦</span><br><span class=\"line\">  run           è½»æ¾è¿è¡Œäº‘åŸç”Ÿåº”ç”¨ï¼Œå¯ç”¨äºå·²æœ‰æˆ–æ–°å»ºé›†ç¾¤</span><br><span class=\"line\">  reset         é‡ç½®é›†ç¾¤ä¸­çš„æ‰€æœ‰å†…å®¹</span><br><span class=\"line\">  status        æŸ¥çœ‹ sealos çš„çŠ¶æ€</span><br><span class=\"line\"></span><br><span class=\"line\">Node Management Commands:</span><br><span class=\"line\">  add           å‘é›†ç¾¤ä¸­æ·»åŠ èŠ‚ç‚¹</span><br><span class=\"line\">  delete        ä»é›†ç¾¤ä¸­ç§»é™¤èŠ‚ç‚¹</span><br><span class=\"line\"></span><br><span class=\"line\">Remote Operation Commands:</span><br><span class=\"line\">  <span class=\"built_in\">exec</span>          åœ¨æŒ‡å®šèŠ‚ç‚¹ä¸Šæ‰§è¡Œ shell å‘½ä»¤æˆ–è„šæœ¬</span><br><span class=\"line\">  scp           å°†æ–‡ä»¶å¤åˆ¶åˆ°æŒ‡å®šèŠ‚ç‚¹çš„è¿œç¨‹ä¸»æœºä¸Š</span><br><span class=\"line\"></span><br><span class=\"line\">Experimental Commands:</span><br><span class=\"line\">  registry      ä¸é•œåƒä»“åº“ç›¸å…³çš„å®éªŒæ€§åŠŸèƒ½</span><br><span class=\"line\"></span><br><span class=\"line\">Container and Image Commands:</span><br><span class=\"line\">  build         æ ¹æ® Containerfile æˆ– Kubefile æ„å»ºé•œåƒ</span><br><span class=\"line\">  create        åˆ›å»ºé›†ç¾¤ä½†ä¸æ‰§è¡Œå‘½ä»¤ï¼Œç”¨äºæ£€æŸ¥é•œåƒ</span><br><span class=\"line\">  diff          æŸ¥çœ‹å¯¹è±¡æ–‡ä»¶ç³»ç»Ÿçš„æ›´æ”¹</span><br><span class=\"line\">  inspect       æ£€æŸ¥å®¹å™¨æˆ–é•œåƒçš„é…ç½®ä¿¡æ¯</span><br><span class=\"line\">  images        åˆ—å‡ºæœ¬åœ°å­˜å‚¨ä¸­çš„é•œåƒ</span><br><span class=\"line\">  load          ä»å½’æ¡£æ–‡ä»¶åŠ è½½é•œåƒ</span><br><span class=\"line\">  login         ç™»å½•åˆ°å®¹å™¨é•œåƒä»“åº“</span><br><span class=\"line\">  <span class=\"built_in\">logout</span>        ç™»å‡ºå®¹å™¨é•œåƒä»“åº“</span><br><span class=\"line\">  manifest      æ“ä½œ manifest åˆ—è¡¨å’Œé•œåƒç´¢å¼•</span><br><span class=\"line\">  merge         åˆå¹¶å¤šä¸ªé•œåƒä¸ºä¸€ä¸ª</span><br><span class=\"line\">  pull          ä»æŒ‡å®šä½ç½®æ‹‰å–é•œåƒ</span><br><span class=\"line\">  push          å°†é•œåƒæ¨é€åˆ°æŒ‡å®šç›®æ ‡</span><br><span class=\"line\">  rmi           ä»æœ¬åœ°åˆ é™¤ä¸€ä¸ªæˆ–å¤šä¸ªé•œåƒ</span><br><span class=\"line\">  save          å°†é•œåƒä¿å­˜ä¸ºå½’æ¡£æ–‡ä»¶</span><br><span class=\"line\">  tag           ä¸ºæœ¬åœ°é•œåƒæ·»åŠ é¢å¤–çš„åç§°æ ‡ç­¾</span><br><span class=\"line\"></span><br><span class=\"line\">Other Commands:</span><br><span class=\"line\">  completion    ç”ŸæˆæŒ‡å®š shell çš„è‡ªåŠ¨è¡¥å…¨è„šæœ¬</span><br><span class=\"line\">  docs          ç”Ÿæˆ API å‚è€ƒæ–‡æ¡£</span><br><span class=\"line\">  <span class=\"built_in\">env</span>           è¾“å‡º sealos ä½¿ç”¨çš„æ‰€æœ‰ç¯å¢ƒå˜é‡ä¿¡æ¯</span><br><span class=\"line\">  gen           ç”ŸæˆåŒ…å«é»˜è®¤è®¾ç½®çš„ Clusterfile</span><br><span class=\"line\">  version       æ‰“å°ç‰ˆæœ¬ä¿¡æ¯</span><br></pre></td></tr></table></figure>\n<h3 id=\"é›†ç¾¤ç®¡ç†-masterèŠ‚ç‚¹æ‰§è¡Œå‘½ä»¤\">é›†ç¾¤ç®¡ç†(masterèŠ‚ç‚¹æ‰§è¡Œå‘½ä»¤)</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ›å»ºé›†ç¾¤</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sealos run labring/kubernetes:v1.29.9 labring/helm:v3.9.4 labring/cilium:v1.13.4 \\</span><br><span class=\"line\">     --masters 10.211.55.12 \\</span><br><span class=\"line\">     --nodes 10.211.55.13,10.211.55.14 -p [your-ssh-passwd]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">## å‚æ•°è¯´æ˜</span></span><br><span class=\"line\">-masters: æŒ‡å®š master èŠ‚ç‚¹çš„ IP åœ°å€ï¼Œå¤šä¸ªèŠ‚ç‚¹ä¹‹é—´ç”¨é€—å·éš”å¼€ï¼Œä½†å¿…é¡»æ˜¯å¥‡æ•°</span><br><span class=\"line\">-nodes: æŒ‡å®š worker èŠ‚ç‚¹çš„ IP åœ°å€ï¼Œå¤šä¸ªèŠ‚ç‚¹ä¹‹é—´ç”¨é€—å·éš”å¼€ã€‚</span><br><span class=\"line\">-p, --passwd: æŒ‡å®š SSH ç™»å½•å¯†ç </span><br><span class=\"line\">-u, --user: ç™»å½•ç”¨æˆ·åï¼Œé»˜è®¤ä¸º root</span><br><span class=\"line\">-i, --pk=<span class=\"string\">&#x27;/root/.ssh/id_rsa&#x27;</span>: æŒ‡å®š SSH å¯†é’¥æ–‡ä»¶è·¯å¾„</span><br><span class=\"line\">--port: æŒ‡å®š SSH ç«¯å£ï¼Œé»˜è®¤ä¸º 22</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Clusterfile æ–¹å¼åˆ›å»ºé›†ç¾¤</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ç”Ÿæˆé›†ç¾¤é…ç½®æ–‡ä»¶ï¼ŒClusterfileå°±æ˜¯ä¸€ä¸ªyamlæ–‡ä»¶ï¼Œé‡Œé¢åŒ…å«é›†ç¾¤çš„é…ç½®ä¿¡æ¯</span></span><br><span class=\"line\">sealos gen labring/kubernetes:v1.29.9 labring/helm:v3.9.4 labring/cilium:v1.13.4 \\</span><br><span class=\"line\">     --masters 10.211.55.12 \\</span><br><span class=\"line\">     --nodes 10.211.55.13,10.211.55.14 -p [your-ssh-passwd] &gt; Clusterfile</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ‰§è¡Œé…ç½®æ–‡ä»¶</span></span><br><span class=\"line\">sealos apply -f Clusterfile</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æŸ¥çœ‹é›†ç¾¤çŠ¶æ€</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sealos status</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ¸…é™¤K8sé›†ç¾¤</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sealos reset</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ›´æ–° Kubernetes API æœåŠ¡å™¨çš„è¯ä¹¦</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># sealos åˆ›å»ºçš„è¯ä¹¦å­˜æ”¾åœ¨ /etc/kubernetes/pki/ ä¸‹ï¼Œé»˜è®¤è¯ä¹¦æœ‰æ•ˆæœŸä¸º 100 å¹´</span></span><br><span class=\"line\"><span class=\"comment\"># æ›´æ–°è¯ä¹¦ä¸€èˆ¬åªä¼šåœ¨æ·»åŠ æ–°çš„è®¿é—®ipæˆ–åŸŸåæ—¶æ‰éœ€è¦</span></span><br><span class=\"line\">sealos cert --alt-names apiserver.cluster.local,10.211.55.12,127.0.0.1,localhost</span><br><span class=\"line\"><span class=\"comment\"># å‚æ•°è¯´æ˜</span></span><br><span class=\"line\"><span class=\"comment\"># --alt-names: æ·»åŠ æ–°çš„è®¿é—®ipæˆ–åŸŸåï¼Œå¤šä¸ªé€—å·åˆ†éš”</span></span><br><span class=\"line\"><span class=\"comment\"># -c, --cluster=&#x27;default&#x27;: è¦æ‰§è¡Œ exec æ“ä½œçš„é›†ç¾¤çš„åç§°ã€‚é»˜è®¤ä¸º defaultã€‚</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ›´æ–°è¯ä¹¦åï¼Œä½ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¿›è¡Œæ ¡éªŒï¼š</span></span><br><span class=\"line\">kubectl -n kube-system get cm kubeadm-config -o yaml</span><br><span class=\"line\">openssl x509 -<span class=\"keyword\">in</span> /etc/kubernetes/pki/apiserver.crt -text</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>åœ¨æ‰§è¡Œæ­¤æ“ä½œä¹‹å‰ï¼Œä½ æœ€å¥½å…ˆå¤‡ä»½æ—§çš„è¯ä¹¦ã€‚<br>\næ‰§è¡Œ sealos cert å‘½ä»¤åï¼Œä¼šæ›´æ–°é›†ç¾¤ API æœåŠ¡å™¨çš„è¯ä¹¦ï¼Œä½ æ— éœ€æ‰‹åŠ¨é‡å¯ API æœåŠ¡å™¨ï¼Œsealosä¼šè‡ªåŠ¨å¸®ä½ é‡å¯æœåŠ¡ã€‚</p>\n</blockquote>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æŸ¥çœ‹ç¯å¢ƒå˜é‡</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># -v æ˜¾ç¤ºå˜é‡çš„è¯´æ˜</span></span><br><span class=\"line\">sealos <span class=\"built_in\">env</span> -v</span><br><span class=\"line\"><span class=\"comment\">## è¯´æ˜</span></span><br><span class=\"line\">SEALOS_PROMPT=enabled <span class=\"comment\"># æ˜¯å¦å¯ç”¨ç»ˆç«¯ä¸­çš„äº¤äº’æç¤ºåŠŸèƒ½ã€‚</span></span><br><span class=\"line\">SEALOS_RUNTIME_ROOT=/root/.sealos <span class=\"comment\"># Sealos çš„è¿è¡Œæ—¶æ ¹ç›®å½•ï¼Œç”¨äºæŒä¹…åŒ–è¿è¡Œç›¸å…³çš„æ“ä½œæˆ–é…ç½®ã€‚</span></span><br><span class=\"line\">SEALOS_DATA_ROOT=/var/lib/sealos  <span class=\"comment\"># é›†ç¾¤åœ¨è¿œç¨‹èŠ‚ç‚¹ä¸Šçš„æ ¹ç›®å½•è·¯å¾„ï¼Œç”¨äºå­˜å‚¨é›†ç¾¤ç›¸å…³çš„æ•°æ®ã€‚</span></span><br><span class=\"line\">BUILDAH_FORMAT=oci <span class=\"comment\"># é•œåƒæ„å»ºæ—¶ä½¿ç”¨çš„æ ¼å¼ï¼Œ`oci` è¡¨ç¤ºç¬¦åˆ OCI é•œåƒè§„èŒƒã€‚</span></span><br><span class=\"line\">BUILDAH_LOG_LEVEL= <span class=\"comment\"># buildah æ¨¡å—ä¸­ä½¿ç”¨çš„æ—¥å¿—çº§åˆ«ï¼Œå¯ä»¥æ˜¯ &quot;trace&quot;, &quot;debug&quot;, &quot;info&quot;, &quot;warn&quot;, &quot;error&quot;, &quot;fatal&quot;, æˆ– &quot;panic&quot;ã€‚</span></span><br><span class=\"line\">CONTAINERS_STORAGE_CONF= <span class=\"comment\"># å®¹å™¨å­˜å‚¨é…ç½®æ–‡ä»¶çš„è·¯å¾„ï¼Œè®¾ç½®è¿™ä¸ªå˜é‡å¯ä»¥è¦†ç›–é»˜è®¤çš„é…ç½®ä½ç½®ã€‚</span></span><br><span class=\"line\">SEALOS_SYNC_WORKDIR=<span class=\"literal\">true</span> <span class=\"comment\"># æ˜¯å¦å°†è¿è¡Œæ—¶æ ¹ç›®å½•ï¼ˆSEALOS_RUNTIME_ROOTï¼‰åŒæ­¥åˆ°æ‰€æœ‰ master èŠ‚ç‚¹ï¼Œä½œä¸ºå¤‡ä»½ç”¨é€”ã€‚</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åœ¨é›†ç¾¤ä¸­æ‰§è¡Œå‘½ä»¤</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># sealos exec &quot;shell command or script&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åœ¨æ‰€æœ‰èŠ‚ç‚¹ä¸Šæ‰§è¡Œå‘½ä»¤</span></span><br><span class=\"line\">sealos <span class=\"built_in\">exec</span> <span class=\"string\">&quot;cat /etc/hosts&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åœ¨æŒ‡å®šçš„èŠ‚ç‚¹ä¸Šæ‰§è¡Œå‘½ä»¤ï¼Œ--ips: å‚æ•°æŒ‡å®šè¦æ‰§è¡Œçš„èŠ‚ç‚¹IPï¼Œå¤šä¸ªèŠ‚ç‚¹ä¹‹é—´ç”¨é€—å·åˆ†éš”</span></span><br><span class=\"line\">sealos <span class=\"built_in\">exec</span> <span class=\"string\">&quot;cat /etc/hosts&quot;</span> --ips=10.211.55.13,10.211.55.14</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åœ¨é›†ç¾¤é—´æ‹·è´æ–‡ä»¶</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># sealos scp &quot;source file path&quot; &quot;destination file path&quot;</span></span><br><span class=\"line\"><span class=\"comment\"># åœ¨æ‰€æœ‰èŠ‚ç‚¹ä¸Šæ‰§è¡Œå‘½ä»¤</span></span><br><span class=\"line\">sealos scp ~/Clusterfile /tmp/Clusterfile</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åœ¨æŒ‡å®šçš„èŠ‚ç‚¹ä¸Šæ‰§è¡Œå‘½ä»¤ï¼Œ--ips: å‚æ•°æŒ‡å®šè¦æ‰§è¡Œçš„èŠ‚ç‚¹IPï¼Œå¤šä¸ªèŠ‚ç‚¹ä¹‹é—´ç”¨é€—å·åˆ†éš”</span></span><br><span class=\"line\">sealos scp ~/Clusterfile /tmp/Clusterfile --ips=10.211.55.13,10.211.55.14</span><br></pre></td></tr></table></figure>\n<h3 id=\"èŠ‚ç‚¹ç®¡ç†-masterèŠ‚ç‚¹æ‰§è¡Œå‘½ä»¤\">èŠ‚ç‚¹ç®¡ç†(masterèŠ‚ç‚¹æ‰§è¡Œå‘½ä»¤)</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ·»åŠ  master èŠ‚ç‚¹</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æ·»åŠ  master èŠ‚ç‚¹åï¼Œæ€»çš„ master èŠ‚ç‚¹ä¸ªæ•°å¿…é¡»ä¸ºå¥‡æ•°ï¼Œå¦åˆ™ä¼šæŠ¥é”™</span></span><br><span class=\"line\">sealos add --masters 10.211.55.18,10.211.55.19</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ·»åŠ  worker èŠ‚ç‚¹</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æ·»åŠ  worker èŠ‚ç‚¹ï¼Œå¤šä¸ªéƒ½ä¼šåˆ†éš”</span></span><br><span class=\"line\">sealos add --nodes 10.211.55.20,10.211.55.21</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ é™¤ master èŠ‚ç‚¹</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åˆ é™¤ master èŠ‚ç‚¹åï¼Œå‰©ä½™çš„ master èŠ‚ç‚¹ä¸ªæ•°å¿…é¡»ä¸ºå¥‡æ•°ï¼Œå¦åˆ™ä¼šæŠ¥é”™</span></span><br><span class=\"line\">sealos delete --masters 10.211.55.18,10.211.55.19</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ é™¤ worker èŠ‚ç‚¹</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sealos delete --nodes 10.211.55.20,10.211.55.21</span><br></pre></td></tr></table></figure>\n<h3 id=\"é•œåƒç®¡ç†\">é•œåƒç®¡ç†</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æŸ¥çœ‹æ‰€æœ‰é•œåƒ</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sealos images</span><br><span class=\"line\">REPOSITORY                                                 TAG        IMAGE ID       CREATED         SIZE</span><br><span class=\"line\">docker.io/labring/kubernetes                               v1.29.9    bca192f35556   2 months ago    669 MB</span><br><span class=\"line\">docker.io/labring/cilium                                   v1.13.4    71aa52ad0a11   23 months ago   483 MB</span><br><span class=\"line\">docker.io/labring/helm                                     v3.9.4     3376f6822067   2 years ago     46.4 MB</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ é™¤é•œåƒ</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># sealos rmi [image_id] | [image_name]</span></span><br><span class=\"line\">sealos rmi docker.io/labring/kubernetes:v1.29.9</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ‹‰å–é•œåƒ</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sealos pull docker.io/labring/kubernetes:v1.29.9</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç™»å½•é•œåƒä»“åº“ï¼Œå»ºè®®ç™»å½•ä»“åº“ï¼Œè¿™æ ·å¯ä»¥æé«˜æ‹‰å–é•œåƒçš„æ¬¡æ•°ï¼Œé¿å…æ‹‰å–é•œåƒå¤±è´¥</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># docker.io å®˜æ–¹dockerhubé•œåƒä»“åº“</span></span><br><span class=\"line\">sealos login docker.io -u [username] -p [password]</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¸ºé•œåƒæ‰“tag</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sealos tag docker.io/labring/kubernetes:v1.29.9 docker.io/hanqunfeng/kubernetes:v1.29.9</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ¨é€é•œåƒ</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sealos push docker.io/hanqunfeng/kubernetes:v1.29.9</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æŸ¥çœ‹é•œåƒè¯¦æƒ…</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># sealos inspect [image_id] | [image_name]</span></span><br><span class=\"line\">sealos inspect docker.io/labring/kubernetes:v1.29.9</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç™»å‡ºé•œåƒä»“åº“</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ç™»å‡ºæŒ‡å®šçš„ä»“åº“</span></span><br><span class=\"line\">sealos <span class=\"built_in\">logout</span> docker.io</span><br><span class=\"line\"><span class=\"comment\"># ç™»å‡ºæ‰€æœ‰ä»“åº“</span></span><br><span class=\"line\">sealos <span class=\"built_in\">logout</span> --all</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>é€šè¿‡ Dockerfile æ„å»ºé•œåƒ</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ä¸ docker build ç±»ä¼¼ï¼Œæ„å»ºå¥½çš„é•œåƒä¼šå¢åŠ å‰ç¼€ localhost/</span></span><br><span class=\"line\">sealos build -t myapp:v1.0.0 -f Dockerfile .</span><br></pre></td></tr></table></figure>\n<h3 id=\"å®¹å™¨ç®¡ç†\">å®¹å™¨ç®¡ç†</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æŸ¥çœ‹æ‰€æœ‰å®¹å™¨</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sealos ps</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æŸ¥çœ‹å®¹å™¨è¯¦æƒ…</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># sealos inspect [container_id] | [container_name]</span></span><br><span class=\"line\">sealos inspect bca192f35556</span><br></pre></td></tr></table></figure>\n","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» Linux ä¸‹ ä½¿ç”¨ sealos å®‰è£… K8S çš„æ–¹æ³•ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚ K8Så®˜ç½‘ k8s Github sealoså®˜ç½‘ sealos Github å®‰è£…å‰è®¾ç½®(æ‰€æœ‰èŠ‚ç‚¹) å‡†å¤‡ä¸‰å°å¯ä»¥è¿æ¥å¤–ç½‘çš„ä¸»æœºï¼Œä¸è¦å®‰è£…docker,k8sç­‰ï¼Œå¦‚å·²å®‰è£…éœ€å…ˆå¸è½½ (æ¨è)å‡çº§ç³»ç»Ÿå†…æ ¸ï¼Œæœ¬æ–‡ä¸­éå¿…é¡»ï¼Œå‡çº§å†…æ ¸æ–¹æ³•å‚çœ‹ Linux å®‰è£… K8S ä¹‹ kubeadm æ¯ä¸ªé›†ç¾¤èŠ‚ç‚¹åº”è¯¥æœ‰ä¸åŒçš„ä¸»æœºåï¼Œä¸»æœºåä¸è¦å¸¦ä¸‹åˆ’çº¿ 1234# æ·»åŠ ä¸»æœºåæ˜ å°„: vi /etc/hosts10.211.55.12 k8s-m110.211.55.13 k8s-w110.211.55.14 k8s-w2 ä¿®æ­£ç³»ç»Ÿçš„æ—¶é—´ 12345678# å®‰è£…chronysudo dnf install chrony -y# å¯åŠ¨æœåŠ¡sudo systemctl enable --now chronyd# ä¿®æ­£æ—¶é—´sudo chronyc makestep# æŸ¥çœ‹æ—¶é—´date å®‰è£… sealos 1234# ä¸‹è½½wget https://github.com/labring/sealos/releases/download/v5.0.1/sealos_5.0.1_linux_amd64.rpm# å®‰è£…yum install -y sealos_5.0.1_linux_amd64.rpm å®‰è£… sealos çš„è‡ªåŠ¨è¡¥å…¨ 12echo &#x27;source &lt;(sealos completion bash)&#x27; &gt;&gt; ~/.bashrcsource ~/.bashrc åˆ›å»ºk8sé›†ç¾¤(master) åˆ›å»ºé›†ç¾¤: ä½¿ç”¨sealosåˆ›å»ºé›†ç¾¤åªéœ€è¦ä¸€è¡Œå‘½ä»¤ï¼Œç›®å‰å®˜ç½‘ç¤ºä¾‹ä¸­çš„k8sç‰ˆæœ¬ä¸ºv1.29.9(å°ç‰ˆæœ¬å·è¶Šé«˜è¶Šç¨³å®š) å¯ä»¥åœ¨docker hubä¸ŠæŸ¥è¯¢ï¼Œæˆ–è€…ä½¿ç”¨ Registry Explorer æŸ¥çœ‹å¦‚ä¸‹é•œåƒçš„æ‰€æœ‰ç‰ˆæœ¬ï¼Œä¸å»ºè®®ä½¿ç”¨å¤ªé«˜çš„ç‰ˆæœ¬ï¼Œæœ‰å¯èƒ½å®‰è£…å¤±è´¥ã€‚ æ³¨æ„ sealos ä¸ kubernetes çš„ç‰ˆæœ¬æœ‰å¯¹åº”å…³ç³»ï¼Œç›®å‰ Sealos &gt;=v5.0.0 å¯¹åº”çš„ K8s &gt;=1.28ï¼Œå…·ä½“å¯ä»¥ä»sealoså®˜ç½‘æŸ¥è¯¢ 123456789101112131415161718192021222324252627282930313233# å›½å†…å¯ä»¥åœ¨é•œåƒå‰é¢åŠ ä¸Š registry.cn-shanghai.aliyuncs.com/# sealos æ¨èçš„ç½‘ç»œæ¥å£æ˜¯ cilium$ sealos run labring/kubernetes:v1.29.9 labring/helm:v3.9.4 labring/cilium:v1.13.4 \\ --masters 10.211.55.12 \\ --nodes 10.211.55.13,10.211.55.14 -p [your-ssh-passwd]## å‚æ•°è¯´æ˜# -masters: æŒ‡å®š master èŠ‚ç‚¹çš„ IP åœ°å€ï¼Œå¤šä¸ªèŠ‚ç‚¹ä¹‹é—´ç”¨é€—å·éš”å¼€ï¼Œä½†å¿…é¡»æ˜¯å¥‡æ•°# -nodes: æŒ‡å®š worker èŠ‚ç‚¹çš„ IP åœ°å€ï¼Œå¤šä¸ªèŠ‚ç‚¹ä¹‹é—´ç”¨é€—å·éš”å¼€ã€‚# -p, --passwd: æŒ‡å®š SSH ç™»å½•å¯†ç ## å®‰è£…æˆåŠŸä¼šæ˜¾ç¤ºå¦‚ä¸‹å†…å®¹â„¹ï¸ Using Cilium version 1.13.4ğŸ”® Auto-detected cluster name: kubernetesğŸ”® Auto-detected datapath mode: tunnelğŸ”® Auto-detected kube-proxy has been installed2025-07-01T16:59:27 info succeeded in creating a new cluster, enjoy it!2025-07-01T16:59:27 info ___ ___ ___ ___ ___ ___ /\\ \\ /\\ \\ /\\ \\ /\\__\\ /\\ \\ /\\ \\ /::\\ \\ /::\\ \\ /::\\ \\ /:/ / /::\\ \\ /::\\ \\ /:/\\ \\ \\ /:/\\:\\ \\ /:/\\:\\ \\ /:/ / /:/\\:\\ \\ /:/\\ \\ \\ _\\:\\~\\ \\ \\ /::\\~\\:\\ \\ /::\\~\\:\\ \\ /:/ / /:/ \\:\\ \\ _\\:\\~\\ \\ \\ /\\ \\:\\ \\ \\__\\ /:/\\:\\ \\:\\__\\ /:/\\:\\ \\:\\__\\ /:/__/ /:/__/ \\:\\__\\ /\\ \\:\\ \\ \\__\\ \\:\\ \\:\\ \\/__/ \\:\\~\\:\\ \\/__/ \\/__\\:\\/:/ / \\:\\ \\ \\:\\ \\ /:/ / \\:\\ \\:\\ \\/__/ \\:\\ \\:\\__\\ \\:\\ \\:\\__\\ \\::/ / \\:\\ \\ \\:\\ /:/ / \\:\\ \\:\\__\\ \\:\\/:/ / \\:\\ \\/__/ /:/ / \\:\\ \\ \\:\\/:/ / \\:\\/:/ / \\::/ / \\:\\__\\ /:/ / \\:\\__\\ \\::/ / \\::/ / \\/__/ \\/__/ \\/__/ \\/__/ \\/__/ \\/__/ Website: https://www.sealos.io/ Address: github.com/labring/sealos Version: 5.0.1-2b74a1281 å¯ç”¨ shell è‡ªåŠ¨è¡¥å…¨åŠŸèƒ½ 12345678910111213141516171819# 1.å®‰è£… bash-completion# 1.1 æ£€æŸ¥bash-completionæ˜¯å¦å·²å®‰è£…ï¼Œæœ‰è¾“å‡ºè¯´æ˜å·²ç»å®‰è£…$ type _init_completion# 1.2 å®‰è£…bash-completionï¼Œå®‰è£…åä¼šåˆ›å»ºæ–‡ä»¶ /usr/share/bash-completion/bash_completion$ dnf install bash-completion# 2.å®‰è£… kubectl çš„è‡ªåŠ¨è¡¥å…¨åŠŸèƒ½# 2.1 å½“å‰ç”¨æˆ·echo &#x27;source &lt;(kubectl completion bash)&#x27; &gt;&gt; ~/.bashrc# 2.2 æ‰€æœ‰ç”¨æˆ·kubectl completion bash | sudo tee /etc/bash_completion.d/kubectl &gt; /dev/nullsudo chmod a+r /etc/bash_completion.d/kubectl# 3 å¦‚æœ kubectl æœ‰å…³è”çš„åˆ«åï¼Œä½ å¯ä»¥æ‰©å±• Shell è¡¥å…¨æ¥é€‚é…æ­¤åˆ«åecho &#x27;alias k=kubectl&#x27; &gt;&gt;~/.bashrcecho &#x27;complete -o default -F __start_kubectl k&#x27; &gt;&gt;~/.bashrc# 4.åˆ·æ–°é…ç½®æ–‡ä»¶source ~/.bashrc åˆ›å»ºé›†ç¾¤æˆåŠŸåï¼ŒæŸ¥çœ‹é›†ç¾¤çŠ¶æ€ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849# æŸ¥çœ‹ç‰ˆæœ¬$ kubectl versionClient Version: v1.29.9Kustomize Version: v5.0.4-0.20230601165947-6ce0bf390ce3Server Version: v1.29.9# æŸ¥çœ‹èŠ‚ç‚¹$ kubectl get nodes -owideNAME STATUS ROLES AGE VERSION INTERNAL-IP EXTERNAL-IP OS-IMAGE KERNEL-VERSION CONTAINER-RUNTIMEk8s-m1 Ready control-plane 3m11s v1.29.9 10.211.55.12 &lt;none&gt; Rocky Linux 8.10 (Green Obsidian) 4.18.0-553.el8_10.x86_64 containerd://1.7.27k8s-w1 Ready &lt;none&gt; 2m52s v1.29.9 10.211.55.13 &lt;none&gt; Rocky Linux 8.10 (Green Obsidian) 4.18.0-553.el8_10.x86_64 containerd://1.7.27k8s-w2 Ready &lt;none&gt; 2m55s v1.29.9 10.211.55.14 &lt;none&gt; Rocky Linux 8.10 (Green Obsidian) 4.18.0-553.el8_10.x86_64 containerd://1.7.27# æŸ¥çœ‹èµ„æº$ kubectl get all -A -owideNAMESPACE NAME READY STATUS RESTARTS AGE IP NODE NOMINATED NODE READINESS GATESkube-system pod/cilium-bbbdl 1/1 Running 0 3m47s 10.211.55.13 k8s-w1 &lt;none&gt; &lt;none&gt;kube-system pod/cilium-cz47k 1/1 Running 0 3m47s 10.211.55.14 k8s-w2 &lt;none&gt; &lt;none&gt;kube-system pod/cilium-operator-6946ccbcc5-cxnn4 1/1 Running 0 3m47s 10.211.55.13 k8s-w1 &lt;none&gt; &lt;none&gt;kube-system pod/cilium-vfc22 1/1 Running 0 3m47s 10.211.55.12 k8s-m1 &lt;none&gt; &lt;none&gt;kube-system pod/coredns-76f75df574-2ln5x 1/1 Running 0 3m54s 10.0.0.74 k8s-w1 &lt;none&gt; &lt;none&gt;kube-system pod/coredns-76f75df574-plsds 1/1 Running 0 3m54s 10.0.0.146 k8s-w1 &lt;none&gt; &lt;none&gt;kube-system pod/etcd-k8s-m1 1/1 Running 0 4m6s 10.211.55.12 k8s-m1 &lt;none&gt; &lt;none&gt;kube-system pod/kube-apiserver-k8s-m1 1/1 Running 0 4m6s 10.211.55.12 k8s-m1 &lt;none&gt; &lt;none&gt;kube-system pod/kube-controller-manager-k8s-m1 1/1 Running 0 4m6s 10.211.55.12 k8s-m1 &lt;none&gt; &lt;none&gt;kube-system pod/kube-proxy-4xbzt 1/1 Running 0 3m51s 10.211.55.13 k8s-w1 &lt;none&gt; &lt;none&gt;kube-system pod/kube-proxy-rjs8h 1/1 Running 0 3m54s 10.211.55.14 k8s-w2 &lt;none&gt; &lt;none&gt;kube-system pod/kube-proxy-xv4fg 1/1 Running 0 3m55s 10.211.55.12 k8s-m1 &lt;none&gt; &lt;none&gt;kube-system pod/kube-scheduler-k8s-m1 1/1 Running 0 4m6s 10.211.55.12 k8s-m1 &lt;none&gt; &lt;none&gt;kube-system pod/kube-sealos-lvscare-k8s-w1 1/1 Running 0 3m31s 10.211.55.13 k8s-w1 &lt;none&gt; &lt;none&gt;kube-system pod/kube-sealos-lvscare-k8s-w2 1/1 Running 0 3m34s 10.211.55.14 k8s-w2 &lt;none&gt; &lt;none&gt;NAMESPACE NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE SELECTORdefault service/kubernetes ClusterIP 10.96.0.1 &lt;none&gt; 443/TCP 4m8s &lt;none&gt;kube-system service/hubble-peer ClusterIP 10.96.1.9 &lt;none&gt; 443/TCP 3m47s k8s-app=ciliumkube-system service/kube-dns ClusterIP 10.96.0.10 &lt;none&gt; 53/UDP,53/TCP,9153/TCP 4m7s k8s-app=kube-dnsNAMESPACE NAME DESIRED CURRENT READY UP-TO-DATE AVAILABLE NODE SELECTOR AGE CONTAINERS IMAGES SELECTORkube-system daemonset.apps/cilium 3 3 3 3 3 kubernetes.io/os=linux 3m47s cilium-agent quay.io/cilium/cilium:v1.13.4 k8s-app=ciliumkube-system daemonset.apps/kube-proxy 3 3 3 3 3 kubernetes.io/os=linux 4m7s kube-proxy registry.k8s.io/kube-proxy:v1.29.9 k8s-app=kube-proxyNAMESPACE NAME READY UP-TO-DATE AVAILABLE AGE CONTAINERS IMAGES SELECTORkube-system deployment.apps/cilium-operator 1/1 1 1 3m47s cilium-operator quay.io/cilium/operator:v1.13.4 io.cilium/app=operator,name=cilium-operatorkube-system deployment.apps/coredns 2/2 2 2 4m7s coredns registry.k8s.io/coredns/coredns:v1.11.1 k8s-app=kube-dnsNAMESPACE NAME DESIRED CURRENT READY AGE CONTAINERS IMAGES SELECTORkube-system replicaset.apps/cilium-operator-6946ccbcc5 1 1 1 3m47s cilium-operator quay.io/cilium/operator:v1.13.4 io.cilium/app=operator,name=cilium-operator,pod-template-hash=6946ccbcc5kube-system replicaset.apps/coredns-76f75df574 2 2 2 3m54s coredns registry.k8s.io/coredns/coredns:v1.11.1 k8s-app=kube-dns,pod-template-hash=76f75df574 æµ‹è¯•ï¼šç”¨K8Séƒ¨ç½²Nginx 123456789101112131415161718192021# åˆ›å»ºdeploymentkubectl create deployment nginx --image=nginx# åˆ›å»ºserviceï¼Œ--typeæŒ‡å®šä¸ºNodePortï¼Œå…¶å«ä¹‰ä¸ºå°†deploymentçš„80ç«¯å£æ˜ å°„åˆ°Nodeçš„éšæœºç«¯å£kubectl expose deployment nginx --type=NodePort --port=80# æŸ¥çœ‹podå’Œserviceï¼Œä¸åŠ  -n å‚æ•°ï¼Œé»˜è®¤æŸ¥çœ‹çš„æ˜¯defaultå‘½åç©ºé—´$ k get pods,svc -owideNAME READY STATUS RESTARTS AGE IP NODE NOMINATED NODE READINESS GATESpod/nginx-7854ff8877-wgfxc 1/1 Running 0 19s 10.0.1.204 k8s-w2 &lt;none&gt; &lt;none&gt;NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE SELECTORservice/kubernetes ClusterIP 10.96.0.1 &lt;none&gt; 443/TCP 44m &lt;none&gt;service/nginx NodePort 10.96.2.54 &lt;none&gt; 80:31044/TCP 5s app=nginx# æµè§ˆå™¨è®¿é—®ä»»æ„nodeIP:31044# åˆ é™¤æµ‹è¯•èµ„æº## åˆ é™¤deploymentkubectl delete deployment nginx## åˆ é™¤servicekubectl delete service nginx sealos å‘½ä»¤ sealos å‘½ä»¤æ¦‚è§ˆ 1234567891011121314151617181920212223242526272829303132333435363738394041Cluster Management Commands: apply ä½¿ç”¨ Clusterfile åœ¨ Kubernetes é›†ç¾¤ä¸­è¿è¡Œäº‘é•œåƒ cert æ›´æ–° Kubernetes API Server çš„è¯ä¹¦ run è½»æ¾è¿è¡Œäº‘åŸç”Ÿåº”ç”¨ï¼Œå¯ç”¨äºå·²æœ‰æˆ–æ–°å»ºé›†ç¾¤ reset é‡ç½®é›†ç¾¤ä¸­çš„æ‰€æœ‰å†…å®¹ status æŸ¥çœ‹ sealos çš„çŠ¶æ€Node Management Commands: add å‘é›†ç¾¤ä¸­æ·»åŠ èŠ‚ç‚¹ delete ä»é›†ç¾¤ä¸­ç§»é™¤èŠ‚ç‚¹Remote Operation Commands: exec åœ¨æŒ‡å®šèŠ‚ç‚¹ä¸Šæ‰§è¡Œ shell å‘½ä»¤æˆ–è„šæœ¬ scp å°†æ–‡ä»¶å¤åˆ¶åˆ°æŒ‡å®šèŠ‚ç‚¹çš„è¿œç¨‹ä¸»æœºä¸ŠExperimental Commands: registry ä¸é•œåƒä»“åº“ç›¸å…³çš„å®éªŒæ€§åŠŸèƒ½Container and Image Commands: build æ ¹æ® Containerfile æˆ– Kubefile æ„å»ºé•œåƒ create åˆ›å»ºé›†ç¾¤ä½†ä¸æ‰§è¡Œå‘½ä»¤ï¼Œç”¨äºæ£€æŸ¥é•œåƒ diff æŸ¥çœ‹å¯¹è±¡æ–‡ä»¶ç³»ç»Ÿçš„æ›´æ”¹ inspect æ£€æŸ¥å®¹å™¨æˆ–é•œåƒçš„é…ç½®ä¿¡æ¯ images åˆ—å‡ºæœ¬åœ°å­˜å‚¨ä¸­çš„é•œåƒ load ä»å½’æ¡£æ–‡ä»¶åŠ è½½é•œåƒ login ç™»å½•åˆ°å®¹å™¨é•œåƒä»“åº“ logout ç™»å‡ºå®¹å™¨é•œåƒä»“åº“ manifest æ“ä½œ manifest åˆ—è¡¨å’Œé•œåƒç´¢å¼• merge åˆå¹¶å¤šä¸ªé•œåƒä¸ºä¸€ä¸ª pull ä»æŒ‡å®šä½ç½®æ‹‰å–é•œåƒ push å°†é•œåƒæ¨é€åˆ°æŒ‡å®šç›®æ ‡ rmi ä»æœ¬åœ°åˆ é™¤ä¸€ä¸ªæˆ–å¤šä¸ªé•œåƒ save å°†é•œåƒä¿å­˜ä¸ºå½’æ¡£æ–‡ä»¶ tag ä¸ºæœ¬åœ°é•œåƒæ·»åŠ é¢å¤–çš„åç§°æ ‡ç­¾Other Commands: completion ç”ŸæˆæŒ‡å®š shell çš„è‡ªåŠ¨è¡¥å…¨è„šæœ¬ docs ç”Ÿæˆ API å‚è€ƒæ–‡æ¡£ env è¾“å‡º sealos ä½¿ç”¨çš„æ‰€æœ‰ç¯å¢ƒå˜é‡ä¿¡æ¯ gen ç”ŸæˆåŒ…å«é»˜è®¤è®¾ç½®çš„ Clusterfile version æ‰“å°ç‰ˆæœ¬ä¿¡æ¯ é›†ç¾¤ç®¡ç†(masterèŠ‚ç‚¹æ‰§è¡Œå‘½ä»¤) åˆ›å»ºé›†ç¾¤ 1234567891011sealos run labring/kubernetes:v1.29.9 labring/helm:v3.9.4 labring/cilium:v1.13.4 \\ --masters 10.211.55.12 \\ --nodes 10.211.55.13,10.211.55.14 -p [your-ssh-passwd]## å‚æ•°è¯´æ˜-masters: æŒ‡å®š master èŠ‚ç‚¹çš„ IP åœ°å€ï¼Œå¤šä¸ªèŠ‚ç‚¹ä¹‹é—´ç”¨é€—å·éš”å¼€ï¼Œä½†å¿…é¡»æ˜¯å¥‡æ•°-nodes: æŒ‡å®š worker èŠ‚ç‚¹çš„ IP åœ°å€ï¼Œå¤šä¸ªèŠ‚ç‚¹ä¹‹é—´ç”¨é€—å·éš”å¼€ã€‚-p, --passwd: æŒ‡å®š SSH ç™»å½•å¯†ç -u, --user: ç™»å½•ç”¨æˆ·åï¼Œé»˜è®¤ä¸º root-i, --pk=&#x27;/root/.ssh/id_rsa&#x27;: æŒ‡å®š SSH å¯†é’¥æ–‡ä»¶è·¯å¾„--port: æŒ‡å®š SSH ç«¯å£ï¼Œé»˜è®¤ä¸º 22 Clusterfile æ–¹å¼åˆ›å»ºé›†ç¾¤ 1234567# ç”Ÿæˆé›†ç¾¤é…ç½®æ–‡ä»¶ï¼ŒClusterfileå°±æ˜¯ä¸€ä¸ªyamlæ–‡ä»¶ï¼Œé‡Œé¢åŒ…å«é›†ç¾¤çš„é…ç½®ä¿¡æ¯sealos gen labring/kubernetes:v1.29.9 labring/helm:v3.9.4 labring/cilium:v1.13.4 \\ --masters 10.211.55.12 \\ --nodes 10.211.55.13,10.211.55.14 -p [your-ssh-passwd] &gt; Clusterfile# æ‰§è¡Œé…ç½®æ–‡ä»¶sealos apply -f Clusterfile æŸ¥çœ‹é›†ç¾¤çŠ¶æ€ 1sealos status æ¸…é™¤K8sé›†ç¾¤ 1sealos reset æ›´æ–° Kubernetes API æœåŠ¡å™¨çš„è¯ä¹¦ 12345678910# sealos åˆ›å»ºçš„è¯ä¹¦å­˜æ”¾åœ¨ /etc/kubernetes/pki/ ä¸‹ï¼Œé»˜è®¤è¯ä¹¦æœ‰æ•ˆæœŸä¸º 100 å¹´# æ›´æ–°è¯ä¹¦ä¸€èˆ¬åªä¼šåœ¨æ·»åŠ æ–°çš„è®¿é—®ipæˆ–åŸŸåæ—¶æ‰éœ€è¦sealos cert --alt-names apiserver.cluster.local,10.211.55.12,127.0.0.1,localhost# å‚æ•°è¯´æ˜# --alt-names: æ·»åŠ æ–°çš„è®¿é—®ipæˆ–åŸŸåï¼Œå¤šä¸ªé€—å·åˆ†éš”# -c, --cluster=&#x27;default&#x27;: è¦æ‰§è¡Œ exec æ“ä½œçš„é›†ç¾¤çš„åç§°ã€‚é»˜è®¤ä¸º defaultã€‚# æ›´æ–°è¯ä¹¦åï¼Œä½ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¿›è¡Œæ ¡éªŒï¼škubectl -n kube-system get cm kubeadm-config -o yamlopenssl x509 -in /etc/kubernetes/pki/apiserver.crt -text åœ¨æ‰§è¡Œæ­¤æ“ä½œä¹‹å‰ï¼Œä½ æœ€å¥½å…ˆå¤‡ä»½æ—§çš„è¯ä¹¦ã€‚ æ‰§è¡Œ sealos cert å‘½ä»¤åï¼Œä¼šæ›´æ–°é›†ç¾¤ API æœåŠ¡å™¨çš„è¯ä¹¦ï¼Œä½ æ— éœ€æ‰‹åŠ¨é‡å¯ API æœåŠ¡å™¨ï¼Œsealosä¼šè‡ªåŠ¨å¸®ä½ é‡å¯æœåŠ¡ã€‚ æŸ¥çœ‹ç¯å¢ƒå˜é‡ 12345678910# -v æ˜¾ç¤ºå˜é‡çš„è¯´æ˜sealos env -v## è¯´æ˜SEALOS_PROMPT=enabled # æ˜¯å¦å¯ç”¨ç»ˆç«¯ä¸­çš„äº¤äº’æç¤ºåŠŸèƒ½ã€‚SEALOS_RUNTIME_ROOT=/root/.sealos # Sealos çš„è¿è¡Œæ—¶æ ¹ç›®å½•ï¼Œç”¨äºæŒä¹…åŒ–è¿è¡Œç›¸å…³çš„æ“ä½œæˆ–é…ç½®ã€‚SEALOS_DATA_ROOT=/var/lib/sealos # é›†ç¾¤åœ¨è¿œç¨‹èŠ‚ç‚¹ä¸Šçš„æ ¹ç›®å½•è·¯å¾„ï¼Œç”¨äºå­˜å‚¨é›†ç¾¤ç›¸å…³çš„æ•°æ®ã€‚BUILDAH_FORMAT=oci # é•œåƒæ„å»ºæ—¶ä½¿ç”¨çš„æ ¼å¼ï¼Œ`oci` è¡¨ç¤ºç¬¦åˆ OCI é•œåƒè§„èŒƒã€‚BUILDAH_LOG_LEVEL= # buildah æ¨¡å—ä¸­ä½¿ç”¨çš„æ—¥å¿—çº§åˆ«ï¼Œå¯ä»¥æ˜¯ &quot;trace&quot;, &quot;debug&quot;, &quot;info&quot;, &quot;warn&quot;, &quot;error&quot;, &quot;fatal&quot;, æˆ– &quot;panic&quot;ã€‚CONTAINERS_STORAGE_CONF= # å®¹å™¨å­˜å‚¨é…ç½®æ–‡ä»¶çš„è·¯å¾„ï¼Œè®¾ç½®è¿™ä¸ªå˜é‡å¯ä»¥è¦†ç›–é»˜è®¤çš„é…ç½®ä½ç½®ã€‚SEALOS_SYNC_WORKDIR=true # æ˜¯å¦å°†è¿è¡Œæ—¶æ ¹ç›®å½•ï¼ˆSEALOS_RUNTIME_ROOTï¼‰åŒæ­¥åˆ°æ‰€æœ‰ master èŠ‚ç‚¹ï¼Œä½œä¸ºå¤‡ä»½ç”¨é€”ã€‚ åœ¨é›†ç¾¤ä¸­æ‰§è¡Œå‘½ä»¤ 1234567# sealos exec &quot;shell command or script&quot;# åœ¨æ‰€æœ‰èŠ‚ç‚¹ä¸Šæ‰§è¡Œå‘½ä»¤sealos exec &quot;cat /etc/hosts&quot;# åœ¨æŒ‡å®šçš„èŠ‚ç‚¹ä¸Šæ‰§è¡Œå‘½ä»¤ï¼Œ--ips: å‚æ•°æŒ‡å®šè¦æ‰§è¡Œçš„èŠ‚ç‚¹IPï¼Œå¤šä¸ªèŠ‚ç‚¹ä¹‹é—´ç”¨é€—å·åˆ†éš”sealos exec &quot;cat /etc/hosts&quot; --ips=10.211.55.13,10.211.55.14 åœ¨é›†ç¾¤é—´æ‹·è´æ–‡ä»¶ 123456# sealos scp &quot;source file path&quot; &quot;destination file path&quot;# åœ¨æ‰€æœ‰èŠ‚ç‚¹ä¸Šæ‰§è¡Œå‘½ä»¤sealos scp ~/Clusterfile /tmp/Clusterfile# åœ¨æŒ‡å®šçš„èŠ‚ç‚¹ä¸Šæ‰§è¡Œå‘½ä»¤ï¼Œ--ips: å‚æ•°æŒ‡å®šè¦æ‰§è¡Œçš„èŠ‚ç‚¹IPï¼Œå¤šä¸ªèŠ‚ç‚¹ä¹‹é—´ç”¨é€—å·åˆ†éš”sealos scp ~/Clusterfile /tmp/Clusterfile --ips=10.211.55.13,10.211.55.14 èŠ‚ç‚¹ç®¡ç†(masterèŠ‚ç‚¹æ‰§è¡Œå‘½ä»¤) æ·»åŠ  master èŠ‚ç‚¹ 12# æ·»åŠ  master èŠ‚ç‚¹åï¼Œæ€»çš„ master èŠ‚ç‚¹ä¸ªæ•°å¿…é¡»ä¸ºå¥‡æ•°ï¼Œå¦åˆ™ä¼šæŠ¥é”™sealos add --masters 10.211.55.18,10.211.55.19 æ·»åŠ  worker èŠ‚ç‚¹ 12# æ·»åŠ  worker èŠ‚ç‚¹ï¼Œå¤šä¸ªéƒ½ä¼šåˆ†éš”sealos add --nodes 10.211.55.20,10.211.55.21 åˆ é™¤ master èŠ‚ç‚¹ 12# åˆ é™¤ master èŠ‚ç‚¹åï¼Œå‰©ä½™çš„ master èŠ‚ç‚¹ä¸ªæ•°å¿…é¡»ä¸ºå¥‡æ•°ï¼Œå¦åˆ™ä¼šæŠ¥é”™sealos delete --masters 10.211.55.18,10.211.55.19 åˆ é™¤ worker èŠ‚ç‚¹ 1sealos delete --nodes 10.211.55.20,10.211.55.21 é•œåƒç®¡ç† æŸ¥çœ‹æ‰€æœ‰é•œåƒ 12345$ sealos imagesREPOSITORY TAG IMAGE ID CREATED SIZEdocker.io/labring/kubernetes v1.29.9 bca192f35556 2 months ago 669 MBdocker.io/labring/cilium v1.13.4 71aa52ad0a11 23 months ago 483 MBdocker.io/labring/helm v3.9.4 3376f6822067 2 years ago 46.4 MB åˆ é™¤é•œåƒ 12# sealos rmi [image_id] | [image_name]sealos rmi docker.io/labring/kubernetes:v1.29.9 æ‹‰å–é•œåƒ 1sealos pull docker.io/labring/kubernetes:v1.29.9 ç™»å½•é•œåƒä»“åº“ï¼Œå»ºè®®ç™»å½•ä»“åº“ï¼Œè¿™æ ·å¯ä»¥æé«˜æ‹‰å–é•œåƒçš„æ¬¡æ•°ï¼Œé¿å…æ‹‰å–é•œåƒå¤±è´¥ 12# docker.io å®˜æ–¹dockerhubé•œåƒä»“åº“sealos login docker.io -u [username] -p [password] ä¸ºé•œåƒæ‰“tag 1sealos tag docker.io/labring/kubernetes:v1.29.9 docker.io/hanqunfeng/kubernetes:v1.29.9 æ¨é€é•œåƒ 1sealos push docker.io/hanqunfeng/kubernetes:v1.29.9 æŸ¥çœ‹é•œåƒè¯¦æƒ… 12# sealos inspect [image_id] | [image_name]sealos inspect docker.io/labring/kubernetes:v1.29.9 ç™»å‡ºé•œåƒä»“åº“ 1234# ç™»å‡ºæŒ‡å®šçš„ä»“åº“sealos logout docker.io# ç™»å‡ºæ‰€æœ‰ä»“åº“sealos logout --all é€šè¿‡ Dockerfile æ„å»ºé•œåƒ 12# ä¸ docker build ç±»ä¼¼ï¼Œæ„å»ºå¥½çš„é•œåƒä¼šå¢åŠ å‰ç¼€ localhost/sealos build -t myapp:v1.0.0 -f Dockerfile . å®¹å™¨ç®¡ç† æŸ¥çœ‹æ‰€æœ‰å®¹å™¨ 1sealos ps æŸ¥çœ‹å®¹å™¨è¯¦æƒ… 12# sealos inspect [container_id] | [container_name]sealos inspect bca192f35556","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» Linux ä¸‹ ä½¿ç”¨ sealos å®‰è£… K8S çš„æ–¹æ³•ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚ K8Så®˜ç½‘ k8s Github sealoså®˜ç½‘ sealos Github","date_published":"2025-07-01T13:30:05.000Z","tags":["æŠ€æœ¯","k8s","K8S"]}]}